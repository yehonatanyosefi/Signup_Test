/*! For license information please see 680.6114197c.chunk.js.LICENSE.txt */
(self.webpackChunkeramorph=self.webpackChunkeramorph||[]).push([[680],{9986:function(e,t,n){var r=n(4993).default,i=n(1589).default,a=n(6115).default,o=n(3515).default,s=n(1588).default,u=n(3808).default,c=n(1655).default,l=n(6389).default,f=n(7424).default,d=n(7156).default,h=n(861).default,p=n(4704).default,m=n(7061).default,v=n(6690).default,g=n(9728).default,y=n(8416).default;window,e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=581)}([function(e,t,n){"use strict";n.r(t),function(e,r,i,a){n.d(t,"AdadeltaOptimizer",(function(){return Dd})),n.d(t,"AdagradOptimizer",(function(){return Td})),n.d(t,"AdamOptimizer",(function(){return jd})),n.d(t,"AdamaxOptimizer",(function(){return Md})),n.d(t,"Add",(function(){return kr})),n.d(t,"AddN",(function(){return Er})),n.d(t,"BroadcastTo",(function(){return jr})),n.d(t,"DataStorage",(function(){return da})),n.d(t,"Div",(function(){return Sr})),n.d(t,"ENV",(function(){return d})),n.d(t,"Environment",(function(){return l})),n.d(t,"FromPixels",(function(){return Rr})),n.d(t,"FusedBatchNorm",(function(){return Cr})),n.d(t,"Identity",(function(){return Fr})),n.d(t,"KernelBackend",(function(){return ha})),n.d(t,"MaxPoolWithArgmax",(function(){return Pr})),n.d(t,"MomentumOptimizer",(function(){return Id})),n.d(t,"NonMaxSuppressionV5",(function(){return Tr})),n.d(t,"OneHot",(function(){return Mr})),n.d(t,"Optimizer",(function(){return Od})),n.d(t,"PadV2",(function(){return Nr})),n.d(t,"RMSPropOptimizer",(function(){return Nd})),n.d(t,"Rank",(function(){return Ce})),n.d(t,"Reduction",(function(){return pl})),n.d(t,"SGDOptimizer",(function(){return Fd})),n.d(t,"Square",(function(){return Or})),n.d(t,"SquaredDifference",(function(){return Ar})),n.d(t,"Tensor",(function(){return Se})),n.d(t,"TensorBuffer",(function(){return we})),n.d(t,"Tile",(function(){return Ir})),n.d(t,"Transpose",(function(){return Dr})),n.d(t,"Variable",(function(){return je})),n.d(t,"abs",(function(){return Wr})),n.d(t,"acos",(function(){return Vr})),n.d(t,"acosh",(function(){return Gr})),n.d(t,"add",(function(){return Br})),n.d(t,"addN",(function(){return Bs})),n.d(t,"addStrict",(function(){return _i})),n.d(t,"all",(function(){return Fc})),n.d(t,"any",(function(){return Ic})),n.d(t,"argMax",(function(){return Nc})),n.d(t,"argMin",(function(){return Rc})),n.d(t,"asin",(function(){return qr})),n.d(t,"asinh",(function(){return Hr})),n.d(t,"atan",(function(){return Xr})),n.d(t,"atan2",(function(){return ki})),n.d(t,"atanh",(function(){return Kr})),n.d(t,"avgPool",(function(){return _c})),n.d(t,"avgPool3d",(function(){return Sc})),n.d(t,"backend",(function(){return mn})),n.d(t,"backend_util",(function(){return Ta})),n.d(t,"basicLSTMCell",(function(){return Zc})),n.d(t,"batchNorm",(function(){return Gs})),n.d(t,"batchNorm2d",(function(){return Xs})),n.d(t,"batchNorm3d",(function(){return $s})),n.d(t,"batchNorm4d",(function(){return Qs})),n.d(t,"batchNormalization",(function(){return Vs})),n.d(t,"batchNormalization2d",(function(){return Hs})),n.d(t,"batchNormalization3d",(function(){return Ys})),n.d(t,"batchNormalization4d",(function(){return Zs})),n.d(t,"batchToSpaceND",(function(){return sr})),n.d(t,"booleanMaskAsync",(function(){return $u})),n.d(t,"broadcastTo",(function(){return eu})),n.d(t,"browser",(function(){return wd})),n.d(t,"buffer",(function(){return ar})),n.d(t,"cast",(function(){return ur})),n.d(t,"ceil",(function(){return Yr})),n.d(t,"clipByValue",(function(){return $r})),n.d(t,"clone",(function(){return tu})),n.d(t,"complex",(function(){return Fn})),n.d(t,"concat",(function(){return Qn})),n.d(t,"concat1d",(function(){return er})),n.d(t,"concat2d",(function(){return tr})),n.d(t,"concat3d",(function(){return nr})),n.d(t,"concat4d",(function(){return rr})),n.d(t,"conv1d",(function(){return ec})),n.d(t,"conv2d",(function(){return tc})),n.d(t,"conv2dTranspose",(function(){return cc})),n.d(t,"conv3d",(function(){return nc})),n.d(t,"conv3dTranspose",(function(){return lc})),n.d(t,"cos",(function(){return Jr})),n.d(t,"cosh",(function(){return Zr})),n.d(t,"cumsum",(function(){return cr})),n.d(t,"customGrad",(function(){return sa})),n.d(t,"deprecationWarn",(function(){return Zt})),n.d(t,"depthToSpace",(function(){return lr})),n.d(t,"depthwiseConv2d",(function(){return ac})),n.d(t,"diag",(function(){return fl})),n.d(t,"disableDeprecationWarnings",(function(){return Jt})),n.d(t,"dispose",(function(){return an})),n.d(t,"disposeVariables",(function(){return Qt})),n.d(t,"div",(function(){return Li})),n.d(t,"divNoNan",(function(){return uu})),n.d(t,"divStrict",(function(){return Ei})),n.d(t,"dot",(function(){return dc})),n.d(t,"dropout",(function(){return dl})),n.d(t,"elu",(function(){return Gc})),n.d(t,"enableDebugMode",(function(){return $t})),n.d(t,"enableProdMode",(function(){return Yt})),n.d(t,"engine",(function(){return en})),n.d(t,"env",(function(){return f})),n.d(t,"equal",(function(){return Iu})),n.d(t,"equalStrict",(function(){return Nu})),n.d(t,"erf",(function(){return Qr})),n.d(t,"exp",(function(){return ei})),n.d(t,"expandDims",(function(){return fr})),n.d(t,"expm1",(function(){return ti})),n.d(t,"eye",(function(){return lu})),n.d(t,"fft",(function(){return il})),n.d(t,"fill",(function(){return Kn})),n.d(t,"findBackend",(function(){return dn})),n.d(t,"findBackendFactory",(function(){return hn})),n.d(t,"floor",(function(){return ni})),n.d(t,"floorDiv",(function(){return Si})),n.d(t,"frame",(function(){return gl})),n.d(t,"fused",(function(){return $l})),n.d(t,"gather",(function(){return Ku})),n.d(t,"gatherND",(function(){return ll})),n.d(t,"gather_util",(function(){return Ui})),n.d(t,"getBackend",(function(){return ln})),n.d(t,"getGradient",(function(){return v})),n.d(t,"getKernel",(function(){return m})),n.d(t,"getKernelsForBackend",(function(){return g})),n.d(t,"grad",(function(){return na})),n.d(t,"grads",(function(){return ra})),n.d(t,"greater",(function(){return Ru})),n.d(t,"greaterEqual",(function(){return Pu})),n.d(t,"greaterEqualStrict",(function(){return Bu})),n.d(t,"greaterStrict",(function(){return Lu})),n.d(t,"hammingWindow",(function(){return vl})),n.d(t,"hannWindow",(function(){return ml})),n.d(t,"ifft",(function(){return al})),n.d(t,"imag",(function(){return Nn})),n.d(t,"image",(function(){return Wl})),n.d(t,"inTopKAsync",(function(){return xl})),n.d(t,"io",(function(){return gd})),n.d(t,"irfft",(function(){return sl})),n.d(t,"isFinite",(function(){return pi})),n.d(t,"isInf",(function(){return hi})),n.d(t,"isNaN",(function(){return di})),n.d(t,"keep",(function(){return on})),n.d(t,"leakyRelu",(function(){return qc})),n.d(t,"less",(function(){return zu})),n.d(t,"lessEqual",(function(){return Uu})),n.d(t,"lessEqualStrict",(function(){return Wu})),n.d(t,"lessStrict",(function(){return Vu})),n.d(t,"linalg",(function(){return Nl})),n.d(t,"linspace",(function(){return Yn})),n.d(t,"localResponseNormalization",(function(){return $c})),n.d(t,"log",(function(){return ri})),n.d(t,"log1p",(function(){return ii})),n.d(t,"logSigmoid",(function(){return ai})),n.d(t,"logSoftmax",(function(){return la})),n.d(t,"logSumExp",(function(){return Pc})),n.d(t,"logicalAnd",(function(){return nu})),n.d(t,"logicalNot",(function(){return ru})),n.d(t,"logicalOr",(function(){return iu})),n.d(t,"logicalXor",(function(){return au})),n.d(t,"losses",(function(){return Tl})),n.d(t,"matMul",(function(){return fc})),n.d(t,"math",(function(){return bd})),n.d(t,"max",(function(){return Bc})),n.d(t,"maxPool",(function(){return wc})),n.d(t,"maxPool3d",(function(){return Ec})),n.d(t,"maxPoolWithArgmax",(function(){return Cc})),n.d(t,"maximum",(function(){return Ci})),n.d(t,"maximumStrict",(function(){return Ai})),n.d(t,"mean",(function(){return Lc})),n.d(t,"memory",(function(){return tn})),n.d(t,"min",(function(){return zc})),n.d(t,"minimum",(function(){return Oi})),n.d(t,"minimumStrict",(function(){return Di})),n.d(t,"mod",(function(){return Ti})),n.d(t,"modStrict",(function(){return ji})),n.d(t,"moments",(function(){return Uc})),n.d(t,"movingAverage",(function(){return el})),n.d(t,"mul",(function(){return Mi})),n.d(t,"mulStrict",(function(){return Fi})),n.d(t,"multiRNNCell",(function(){return Qc})),n.d(t,"multinomial",(function(){return fu})),n.d(t,"neg",(function(){return oi})),n.d(t,"nextFrame",(function(){return Ld})),n.d(t,"norm",(function(){return Jc})),n.d(t,"notEqual",(function(){return Gu})),n.d(t,"notEqualStrict",(function(){return qu})),n.d(t,"oneHot",(function(){return du})),n.d(t,"ones",(function(){return Hn})),n.d(t,"onesLike",(function(){return Jn})),n.d(t,"op",(function(){return Mn})),n.d(t,"outerProduct",(function(){return hc})),n.d(t,"pad",(function(){return hu})),n.d(t,"pad1d",(function(){return pu})),n.d(t,"pad2d",(function(){return mu})),n.d(t,"pad3d",(function(){return vu})),n.d(t,"pad4d",(function(){return gu})),n.d(t,"pool",(function(){return kc})),n.d(t,"pow",(function(){return Ii})),n.d(t,"powStrict",(function(){return Ni})),n.d(t,"prelu",(function(){return Hc})),n.d(t,"print",(function(){return or})),n.d(t,"prod",(function(){return Vc})),n.d(t,"profile",(function(){return nn})),n.d(t,"rand",(function(){return yu})),n.d(t,"randomGamma",(function(){return Ou})),n.d(t,"randomNormal",(function(){return Du})),n.d(t,"randomUniform",(function(){return Tu})),n.d(t,"range",(function(){return $n})),n.d(t,"ready",(function(){return cn})),n.d(t,"real",(function(){return In})),n.d(t,"reciprocal",(function(){return si})),n.d(t,"registerBackend",(function(){return pn})),n.d(t,"registerGradient",(function(){return b})),n.d(t,"registerKernel",(function(){return y})),n.d(t,"relu",(function(){return Xc})),n.d(t,"relu6",(function(){return Kc})),n.d(t,"removeBackend",(function(){return fn})),n.d(t,"reshape",(function(){return dr})),n.d(t,"reverse",(function(){return pc})),n.d(t,"reverse1d",(function(){return mc})),n.d(t,"reverse2d",(function(){return vc})),n.d(t,"reverse3d",(function(){return gc})),n.d(t,"reverse4d",(function(){return yc})),n.d(t,"rfft",(function(){return ol})),n.d(t,"round",(function(){return ui})),n.d(t,"rsqrt",(function(){return ci})),n.d(t,"scalar",(function(){return Bn})),n.d(t,"scatterND",(function(){return rl})),n.d(t,"scatter_util",(function(){return Xi})),n.d(t,"selu",(function(){return Yc})),n.d(t,"separableConv2d",(function(){return uc})),n.d(t,"serialization",(function(){return Sd})),n.d(t,"setBackend",(function(){return un})),n.d(t,"setPlatform",(function(){return vn})),n.d(t,"setdiff1dAsync",(function(){return gr})),n.d(t,"sigmoid",(function(){return li})),n.d(t,"sign",(function(){return fi})),n.d(t,"signal",(function(){return bl})),n.d(t,"sin",(function(){return mi})),n.d(t,"sinh",(function(){return vi})),n.d(t,"slice",(function(){return Ac})),n.d(t,"slice1d",(function(){return Oc})),n.d(t,"slice2d",(function(){return Dc})),n.d(t,"slice3d",(function(){return Tc})),n.d(t,"slice4d",(function(){return jc})),n.d(t,"slice_util",(function(){return ta})),n.d(t,"softmax",(function(){return ca})),n.d(t,"softplus",(function(){return gi})),n.d(t,"spaceToBatchND",(function(){return hr})),n.d(t,"sparseToDense",(function(){return cl})),n.d(t,"spectral",(function(){return ul})),n.d(t,"split",(function(){return ir})),n.d(t,"sqrt",(function(){return yi})),n.d(t,"square",(function(){return ju})),n.d(t,"squaredDifference",(function(){return Mu})),n.d(t,"squaredDifferenceStrict",(function(){return Ri})),n.d(t,"squeeze",(function(){return pr})),n.d(t,"stack",(function(){return mr})),n.d(t,"step",(function(){return bi})),n.d(t,"stft",(function(){return yl})),n.d(t,"stridedSlice",(function(){return tl})),n.d(t,"sub",(function(){return Pi})),n.d(t,"subStrict",(function(){return Bi})),n.d(t,"sum",(function(){return Wc})),n.d(t,"sumOutType",(function(){return Ie})),n.d(t,"tan",(function(){return xi})),n.d(t,"tanh",(function(){return wi})),n.d(t,"tensor",(function(){return Rn})),n.d(t,"tensor1d",(function(){return Ln})),n.d(t,"tensor2d",(function(){return zn})),n.d(t,"tensor3d",(function(){return Un})),n.d(t,"tensor4d",(function(){return Wn})),n.d(t,"tensor5d",(function(){return Vn})),n.d(t,"tensor6d",(function(){return Gn})),n.d(t,"tensor_util",(function(){return Le})),n.d(t,"test_util",(function(){return Eu})),n.d(t,"tidy",(function(){return rn})),n.d(t,"tile",(function(){return cu})),n.d(t,"time",(function(){return sn})),n.d(t,"topk",(function(){return nl})),n.d(t,"train",(function(){return Pd})),n.d(t,"transpose",(function(){return fa})),n.d(t,"truncatedNormal",(function(){return Fu})),n.d(t,"unregisterGradient",(function(){return w})),n.d(t,"unregisterKernel",(function(){return x})),n.d(t,"unsortedSegmentSum",(function(){return Yu})),n.d(t,"unstack",(function(){return vr})),n.d(t,"util",(function(){return de})),n.d(t,"valueAndGrad",(function(){return ia})),n.d(t,"valueAndGrads",(function(){return aa})),n.d(t,"variable",(function(){return qn})),n.d(t,"variableGrads",(function(){return oa})),n.d(t,"version_core",(function(){return Cd})),n.d(t,"webgl",(function(){return Ad})),n.d(t,"where",(function(){return ou})),n.d(t,"whereAsync",(function(){return su})),n.d(t,"zeros",(function(){return Xn})),n.d(t,"zerosLike",(function(){return Zn}));var o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function s(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function u(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))}function c(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}var l=function(){function e(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return e.prototype.setPlatform=function(e,t){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},e.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+r+"."),this.set(e,r)}},e.prototype.get=function(e){return e in this.flags||(this.flags[e]=this.evaluateFlag(e)),this.flags[e]},e.prototype.getNumber=function(e){return this.get(e)},e.prototype.getBool=function(e){return this.get(e)},e.prototype.getFlags=function(){return this.flags},Object.defineProperty(e.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),e.prototype.set=function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)},e.prototype.evaluateFlag=function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},e.prototype.setFlags=function(e){this.flags=Object.assign({},e)},e.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},e.prototype.populateURLFlags=function(){var e=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var t,n,r=(t=this.global.location.search,n={},t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(n,t[0],t[1]),t.join("=")})),n);"tfjsflags"in r&&r.tfjsflags.split(",").forEach((function(t){var n=t.split(":"),r=n[0],i=n[1];e.urlFlags[r]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if(""+ +t===t)return+t;throw new Error("Could not parse value flag value "+t+" for flag "+e+".")}(r,i)}))}},e}();function f(){return d}var d=null,h=new Map,p=new Map;function m(e,t){var n=_(e,t);return h.get(n)}function v(e){return p.get(e)}function g(e){for(var t=h.entries(),n=[];;){var r=t.next(),i=r.done,a=r.value;if(i)break;var o=a[0],s=a[1];o.split("_")[0]===e&&n.push(s)}return n}function y(e){var t=e.kernelName,n=e.backendName,r=_(t,n);if(h.has(r))throw new Error("The kernel '"+t+"' for backend '"+n+"' is already registered");h.set(r,e)}function b(e){var t=e.kernelName;p.has(t)&&console.warn("Overriding the gradient for '"+t+"'"),p.set(t,e)}function x(e,t){var n=_(e,t);if(!h.has(n))throw new Error("The kernel '"+e+"' for backend '"+t+"' is not registered");h.delete(n)}function w(e){if(!p.has(e))throw new Error("The gradient '"+e+"' for backend is not registered");p.delete(e)}function _(e,t){return t+"_"+e}function k(e){for(var t=e.length,n=0,r=0;t>0;)r=Math.random()*t|0,n=e[--t],e[t]=e[r],e[r]=n}function E(e,t,n){return Math.max(e,Math.min(t,n))}function S(e){return e%2==0?e:e+1}function C(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function A(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function O(e,t,n){void 0===n&&(n=""),A(M(e,t),(function(){return n+" Shapes "+e+" and "+t+" must match"}))}function D(e){A(null!=e,(function(){return"The input to the tensor constructor must be a non-null value."}))}function T(e,t,n){if(void 0===t&&(t=[]),void 0===n&&(n=!1),null==t&&(t=[]),Array.isArray(e)||H(e)&&!n)for(var r=0;r<e.length;++r)T(e[r],t,n);else t.push(e);return t}function j(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function M(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function F(e){return e%1==0}function I(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function N(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function R(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function P(e,t,n){return void 0===t&&(t=function(e){return 0}),new Promise((function(r,i){var a=0,o=function o(){if(e())r();else{var s=t(++a);null!=n&&a>=n?i():setTimeout(o,s)}};o()}))}function B(e,t){for(var n=1,r=-1,i=0;i<e.length;++i)if(e[i]>=0)n*=e[i];else if(-1===e[i]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+i);r=i}else if(e[i]<0)throw Error("Shapes can not be < 0. Found "+e[i]+" at dim "+i);if(-1===r){if(t>0&&t!==n)throw Error("Size("+t+") must match the product of shape "+e);return e}if(0===n)throw Error("Cannot infer the missing size in ["+e+"] when there are 0 elements");if(t%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+n);var a=e.slice();return a[r]=t/n,a}function L(e,t){var n=t.length;return A((e=null==e?t.map((function(e,t){return t})):[].concat(e)).every((function(e){return e>=-n&&e<n})),(function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+e})),A(e.every((function(e){return F(e)})),(function(){return"All values in axis param must be integers but got axis "+e})),e.map((function(e){return e<0?n+e:e}))}function z(e,t){for(var n=[],r=[],i=null!=t&&Array.isArray(t)&&0===t.length,a=null==t||i?null:L(t,e).sort(),o=0,s=0;s<e.length;++s){if(null!=a){if(a[o]===s&&1!==e[s])throw new Error("Can't squeeze axis "+s+" since its dim '"+e[s]+"' is not 1");(null==a[o]||a[o]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),a[o]<=s&&o++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function U(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type "+e);n=new Uint8Array(t)}return n}function W(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type "+e);n=new Array(t)}return n}function V(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+t+" being uploaded contains "+r+".")}}function G(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}function q(e,t){return!("complex64"===t||"float32"===t&&"complex64"!==e||"int32"===t&&"float32"!==e&&"complex64"!==e||"bool"===t&&"bool"===e)}function H(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function X(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype "+e)}function K(e){if(null==e)return 0;var t=0;return e.forEach((function(e){return t+=e.length})),t}function Y(e){return"string"==typeof e||e instanceof String}function $(e){return"boolean"==typeof e}function J(e){return"number"==typeof e}function Z(e){return Array.isArray(e)?Z(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":J(e)?"float32":Y(e)?"string":$(e)?"bool":"float32"}function Q(e){return!!(e&&e.constructor&&e.call&&e.apply)}function ee(e,t){for(var n=t;n<e;++n)if(e%n==0)return n;return e}function te(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function ne(e,t,n){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=T(e)),n&&V(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var r=new Uint8Array(e.length),i=0;i<r.length;++i)0!==Math.round(e[i])&&(r[i]=1);return r}throw new Error("Unknown data type "+t)}function re(e,t){if(0===e.length)return t[0];var n=e.reduce((function(e,t){return e*t}));if(0===n)return[];if(n!==t.length)throw new Error("["+e+"] does not match the input size.");return function e(t,n,r){var i=new Array;if(1===n.length)for(var a=n[0],o=0;o<a;o++)i[o]=r[t+o];else{a=n[0];var s=n.slice(1),u=s.reduce((function(e,t){return e*t}));for(o=0;o<a;o++)i[o]=e(t+o*u,s,r)}return i}(0,e,t)}function ie(e,t){for(var n=ae(e,t),r=0;r<n.length;r++)n[r]=1;return n}function ae(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type "+t)}function oe(){return f().platform.now()}function se(e){e.forEach((function(t){A(Number.isInteger(t)&&t>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape ["+e+"]."}))}))}function ue(e,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",f().platform.encode(e,t)}function ce(e,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",f().platform.decode(e,t)}function le(e,t,n){if(0===t)return 0;if(1===t)return e[0];for(var r=e[e.length-1],i=0;i<e.length-1;++i)r+=n[i]*e[i];return r}function fe(e,t,n){if(0===t)return[];if(1===t)return[e];for(var r=new Array(t),i=0;i<r.length-1;++i)r[i]=Math.floor(e/n[i]),e-=r[i]*n[i];return r[r.length-1]=e,r}var de=Object.freeze({shuffle:k,clamp:E,nearestLargerEven:S,sum:C,randUniform:function(e,t){var n=Math.random();return t*n+(1-n)*e},distSquared:function(e,t){for(var n=0,r=0;r<e.length;r++){var i=Number(e[r])-Number(t[r]);n+=i*i}return n},assert:A,assertShapesMatch:O,assertNonNull:D,flatten:T,sizeFromShape:j,isScalarShape:function(e){return 0===e.length},arraysEqual:M,isInt:F,tanh:I,sizeToSquarishShape:N,createShuffledIndices:function(e){for(var t=new Uint32Array(e),n=0;n<e;++n)t[n]=n;return k(t),t},rightPad:R,repeatedTry:P,inferFromImplicitShape:B,parseAxisParam:L,squeezeShape:z,getTypedArrayFromDType:U,getArrayFromDType:W,checkConversionForErrors:V,isValidDtype:G,hasEncodingLoss:q,isTypedArray:H,bytesPerElement:X,bytesFromStringArray:K,isString:Y,isBoolean:$,isNumber:J,inferDtype:Z,isFunction:Q,nearestDivisor:ee,computeStrides:te,toTypedArray:ne,toNestedArray:re,makeOnesTypedArray:ie,makeZerosTypedArray:ae,now:oe,assertNonNegativeIntegerDimensions:se,fetch:function(e,t){return f().platform.fetch(e,t)},encodeString:ue,decodeString:ce,locToIndex:le,indexToLoc:fe}),he=function(){function e(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new pe)}return e.prototype.profileKernel=function(e,t,n){var r,i=this,a=this.backendTimer.time((function(){r=n()}));return r.forEach((function(n){n.data().then((function(r){!function(e,t,n){if("float32"!==t)return!1;for(var r=0;r<e.length;r++){var i=e[r];if(isNaN(i)||!isFinite(i))return console.warn("Found "+i+" in the result of '"+n+"'"),!0}}(r,n.dtype,e),a.then((function(a){var o="";null!=a.getExtraProfileInfo&&(o=a.getExtraProfileInfo()),i.logger.logKernelProfile(e,n,r,a.kernelMs,t,o)}))}))})),r},e}(),pe=function(){function e(){}return e.prototype.logKernelProfile=function(e,t,n,r,i,a){var o="number"==typeof r?R(r+"ms",9):r.error,s=R(e,25),u=t.rank,c=t.size,l=R(t.shape.toString(),14),f="";for(var d in i){var h=i[d].shape||t.shape,p=h.length;f+=d+": "+p+"D "+(p>0?h:"")+" "}console.log("%c"+s+"\t%c"+o+"\t%c"+u+"D "+l+"\t%c"+c+"\t%c"+f+"\t%c"+a,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},e}(),me=20,ve=3,ge=7;function ye(e,t,n){return R(Array.isArray(e)?parseFloat(e[0].toFixed(ge))+" + "+parseFloat(e[1].toFixed(ge))+"j":Y(e)?"'"+e+"'":"bool"===n?be(e):parseFloat(e.toFixed(ge)).toString(),t)}function be(e){return 0===e?"false":"true"}function xe(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var we=function(){function e(e,t,n){var r=this;if(this.dtype=t,this.shape=e.slice(),this.size=j(e),null!=n){var i=n.length;A(i===this.size,(function(){return"Length of values '"+i+"' does not match the size inferred by the shape '"+r.size+"'."}))}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||W(t,this.size),this.strides=te(e)}return e.prototype.set=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];0===n.length&&(n=[0]),A(n.length===this.rank,(function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+t.rank+")"}));var i=this.locToIndex(n);this.values[i]=e},e.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];0===e.length&&(e=[0]);for(var n=0,r=0,i=e;r<i.length;r++){var a=i[r];if(a<0||a>=this.shape[n]){var o="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(o)}n++}for(var s=e[e.length-1],u=0;u<e.length-1;++u)s+=this.strides[u]*e[u];return this.values[s]},e.prototype.locToIndex=function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},e.prototype.indexToLoc=function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.toTensor=function(){return _e().makeTensor(this.values,this.shape,this.dtype)},e}(),_e=null,ke=null,Ee=null,Se=function(){function e(e,t,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=j(e),this.strides=te(e),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}return e.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},e.prototype.asScalar=function(){return this.throwIfDisposed(),A(1===this.size,(function(){return"The array must have only 1 element."})),this.reshape([])},e.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},e.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},e.prototype.as3D=function(e,t,n){return this.throwIfDisposed(),this.reshape([e,t,n])},e.prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),this.reshape([e,t,n,r])},e.prototype.as5D=function(e,t,n,r,i){return this.throwIfDisposed(),this.reshape([e,t,n,r,i])},e.prototype.asType=function(e){return this.throwIfDisposed(),ke.cast(this,e)},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.buffer=function(){return u(this,void 0,void 0,(function(){var e;return c(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,ke.buffer(this.shape,this.dtype,e)]}}))}))},e.prototype.bufferSync=function(){return ke.buffer(this.shape,this.dtype,this.dataSync())},e.prototype.array=function(){return u(this,void 0,void 0,(function(){var e;return c(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,re(this.shape,e)]}}))}))},e.prototype.arraySync=function(){return re(this.shape,this.dataSync())},e.prototype.data=function(){return u(this,void 0,void 0,(function(){var e,t;return c(this,(function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=_e().read(this.dataId),"string"!==this.dtype?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map((function(e){return ce(e)}))]}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,e]}}))}))},e.prototype.dataSync=function(){this.throwIfDisposed();var e=_e().readSync(this.dataId);if("string"===this.dtype)try{return e.map((function(e){return ce(e)}))}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},e.prototype.bytes=function(){return u(this,void 0,void 0,(function(){var e;return c(this,(function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,_e().read(this.dataId)];case 1:return e=t.sent(),"string"===this.dtype?[2,e]:[2,new Uint8Array(e.buffer)]}}))}))},e.prototype.dispose=function(){this.isDisposed||(_e().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),e.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},e.prototype.toFloat=function(){return this.asType("float32")},e.prototype.toInt=function(){return this.asType("int32")},e.prototype.toBool=function(){return this.asType("bool")},e.prototype.print=function(e){return void 0===e&&(e=!1),ke.print(this,e)},e.prototype.reshape=function(e){return this.throwIfDisposed(),ke.reshape(this,e)},e.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},e.prototype.expandDims=function(e){return void 0===e&&(e=0),ke.expandDims(this,e)},e.prototype.cumsum=function(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=!1),void 0===n&&(n=!1),ke.cumsum(this,e,t,n)},e.prototype.squeeze=function(e){return this.throwIfDisposed(),ke.squeeze(this,e)},e.prototype.clone=function(){return this.throwIfDisposed(),ke.clone(this)},e.prototype.toString=function(e){return void 0===e&&(e=!1),function(e,t,n,r){var i=te(t),a=function(e,t,n,r){var i=j(t),a=r[r.length-1],o=new Array(a).fill(0),s=t.length,u="complex64"===n?xe(e):e;if(s>1)for(var c=0;c<i/a;c++)for(var l=c*a,f=0;f<a;f++)o[f]=Math.max(o[f],ye(u[l+f],0,n).length);return o}(e,t,n,i),o=t.length,s=function e(t,n,r,i,a,o){void 0===o&&(o=!0);var s="complex64"===r?2:1,u=n[0],c=n.length;if(0===c)return"complex64"===r?[ye(xe(t)[0],0,r)]:"bool"===r?[be(t[0])]:[t[0].toString()];if(1===c){if(u>me){var l=ve*s,f=Array.from(t.slice(0,l)),d=Array.from(t.slice((u-ve)*s,u*s));return"complex64"===r&&(f=xe(f),d=xe(d)),["["+f.map((function(e,t){return ye(e,a[t],r)})).join(", ")+", ..., "+d.map((function(e,t){return ye(e,a[u-ve+t],r)})).join(", ")+"]"]}return["["+("complex64"===r?xe(t):Array.from(t)).map((function(e,t){return ye(e,a[t],r)})).join(", ")+"]"]}var h=n.slice(1),p=i.slice(1),m=i[0]*s,v=[];if(u>me){for(var g=0;g<ve;g++){var y=(b=g*m)+m;v.push.apply(v,e(t.slice(b,y),h,r,p,a,!1))}for(v.push("..."),g=u-ve;g<u;g++)y=(b=g*m)+m,v.push.apply(v,e(t.slice(b,y),h,r,p,a,g===u-1))}else for(g=0;g<u;g++){var b;y=(b=g*m)+m,v.push.apply(v,e(t.slice(b,y),h,r,p,a,g===u-1))}var x=2===c?",":"";for(v[0]="["+v[0]+x,g=1;g<v.length-1;g++)v[g]=" "+v[g]+x;var w=",\n";for(g=2;g<c;g++)w+="\n";return v[v.length-1]=" "+v[v.length-1]+"]"+(o?"":w),v}(e,t,n,i,a),u=["Tensor"];return r&&(u.push("  dtype: "+n),u.push("  rank: "+o),u.push("  shape: ["+t+"]"),u.push("  values:")),u.push(s.map((function(e){return"    "+e})).join("\n")),u.join("\n")}(this.dataSync(),this.shape,this.dtype,e)},e.prototype.gather=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),ke.gather(this,e,t)},e.prototype.matMul=function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n=!1),this.throwIfDisposed(),ke.matMul(this,e,t,n)},e.prototype.dot=function(e){return this.throwIfDisposed(),ke.dot(this,e)},e.prototype.norm=function(e,t,n){return void 0===e&&(e="euclidean"),void 0===t&&(t=null),void 0===n&&(n=!1),this.throwIfDisposed(),ke.norm(this,e,t,n)},e.prototype.slice=function(e,t){return this.throwIfDisposed(),ke.slice(this,e,t)},e.prototype.reverse=function(e){return this.throwIfDisposed(),ke.reverse(this,e)},e.prototype.concat=function(t,n){return void 0===n&&(n=0),this.throwIfDisposed(),t instanceof e&&(t=[t]),ke.concat([this].concat(t),n)},e.prototype.split=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),ke.split(this,e,t)},e.prototype.stack=function(e,t){return void 0===t&&(t=0),ke.stack([this,e],t)},e.prototype.unstack=function(e){return void 0===e&&(e=0),ke.unstack(this,e)},e.prototype.batchNormalization=function(e,t,n,r,i){return void 0===n&&(n=.001),Ee("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,i,r,n)},e.prototype.all=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ke.all(this,e,t)},e.prototype.any=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ke.any(this,e,t)},e.prototype.logSumExp=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ke.logSumExp(this,e,t)},e.prototype.sum=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ke.sum(this,e,t)},e.prototype.prod=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ke.prod(this,e,t)},e.prototype.mean=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ke.mean(this,e,t)},e.prototype.min=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ke.min(this,e,t)},e.prototype.max=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ke.max(this,e,t)},e.prototype.argMin=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),ke.argMin(this,e)},e.prototype.argMax=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),ke.argMax(this,e)},e.prototype.cast=function(e){return this.throwIfDisposed(),ke.cast(this,e)},e.prototype.addStrict=function(e){return this.throwIfDisposed(),ke.addStrict(this,e)},e.prototype.atan2=function(e){return this.throwIfDisposed(),ke.atan2(this,e)},e.prototype.sub=function(e){return this.throwIfDisposed(),ke.sub(this,e)},e.prototype.subStrict=function(e){return this.throwIfDisposed(),ke.subStrict(this,e)},e.prototype.pow=function(e){return this.throwIfDisposed(),ke.pow(this,e)},e.prototype.powStrict=function(e){return this.throwIfDisposed(),ke.powStrict(this,e)},e.prototype.mul=function(e){return this.throwIfDisposed(),ke.mul(this,e)},e.prototype.mulStrict=function(e){return this.throwIfDisposed(),ke.mulStrict(this,e)},e.prototype.floorDiv=function(e){return this.throwIfDisposed(),ke.floorDiv(this,e)},e.prototype.divStrict=function(e){return this.throwIfDisposed(),ke.divStrict(this,e)},e.prototype.minimum=function(e){return this.throwIfDisposed(),ke.minimum(this,e)},e.prototype.minimumStrict=function(e){return this.throwIfDisposed(),ke.minimumStrict(this,e)},e.prototype.maximum=function(e){return this.throwIfDisposed(),ke.maximum(this,e)},e.prototype.maximumStrict=function(e){return this.throwIfDisposed(),ke.maximumStrict(this,e)},e.prototype.mod=function(e){return this.throwIfDisposed(),ke.mod(this,e)},e.prototype.modStrict=function(e){return this.throwIfDisposed(),ke.modStrict(this,e)},e.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),ke.squaredDifferenceStrict(this,e)},e.prototype.notEqual=function(e){return this.throwIfDisposed(),ke.notEqual(this,e)},e.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),ke.notEqualStrict(this,e)},e.prototype.less=function(e){return this.throwIfDisposed(),ke.less(this,e)},e.prototype.lessStrict=function(e){return this.throwIfDisposed(),ke.lessStrict(this,e)},e.prototype.equal=function(e){return this.throwIfDisposed(),ke.equal(this,e)},e.prototype.equalStrict=function(e){return this.throwIfDisposed(),ke.equalStrict(this,e)},e.prototype.lessEqual=function(e){return this.throwIfDisposed(),ke.lessEqual(this,e)},e.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),ke.lessEqualStrict(this,e)},e.prototype.greater=function(e){return this.throwIfDisposed(),ke.greater(this,e)},e.prototype.greaterStrict=function(e){return this.throwIfDisposed(),ke.greaterStrict(this,e)},e.prototype.greaterEqual=function(e){return this.throwIfDisposed(),ke.greaterEqual(this,e)},e.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),ke.greaterEqualStrict(this,e)},e.prototype.logicalAnd=function(e){return this.throwIfDisposed(),ke.logicalAnd(this,e)},e.prototype.logicalOr=function(e){return this.throwIfDisposed(),ke.logicalOr(this,e)},e.prototype.logicalNot=function(){return this.throwIfDisposed(),ke.logicalNot(this)},e.prototype.logicalXor=function(e){return this.throwIfDisposed(),ke.logicalXor(this,e)},e.prototype.where=function(e,t){return this.throwIfDisposed(),ke.where(e,this,t)},e.prototype.neg=function(){return this.throwIfDisposed(),ke.neg(this)},e.prototype.ceil=function(){return this.throwIfDisposed(),ke.ceil(this)},e.prototype.floor=function(){return this.throwIfDisposed(),ke.floor(this)},e.prototype.sign=function(){return this.throwIfDisposed(),ke.sign(this)},e.prototype.isNaN=function(){return this.throwIfDisposed(),ke.isNaN(this)},e.prototype.isInf=function(){return this.throwIfDisposed(),ke.isInf(this)},e.prototype.isFinite=function(){return this.throwIfDisposed(),ke.isFinite(this)},e.prototype.exp=function(){return this.throwIfDisposed(),ke.exp(this)},e.prototype.expm1=function(){return this.throwIfDisposed(),ke.expm1(this)},e.prototype.log=function(){return this.throwIfDisposed(),ke.log(this)},e.prototype.log1p=function(){return this.throwIfDisposed(),ke.log1p(this)},e.prototype.sqrt=function(){return this.throwIfDisposed(),ke.sqrt(this)},e.prototype.rsqrt=function(){return this.throwIfDisposed(),ke.rsqrt(this)},e.prototype.square=function(){return this.throwIfDisposed(),ke.square(this)},e.prototype.reciprocal=function(){return this.throwIfDisposed(),ke.reciprocal(this)},e.prototype.abs=function(){return this.throwIfDisposed(),ke.abs(this)},e.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),ke.clipByValue(this,e,t)},e.prototype.relu=function(){return this.throwIfDisposed(),ke.relu(this)},e.prototype.relu6=function(){return this.throwIfDisposed(),ke.relu6(this)},e.prototype.elu=function(){return this.throwIfDisposed(),ke.elu(this)},e.prototype.selu=function(){return this.throwIfDisposed(),ke.selu(this)},e.prototype.leakyRelu=function(e){return void 0===e&&(e=.2),this.throwIfDisposed(),ke.leakyRelu(this,e)},e.prototype.prelu=function(e){return this.throwIfDisposed(),ke.prelu(this,e)},e.prototype.sigmoid=function(){return this.throwIfDisposed(),ke.sigmoid(this)},e.prototype.logSigmoid=function(){return this.throwIfDisposed(),ke.logSigmoid(this)},e.prototype.softplus=function(){return this.throwIfDisposed(),ke.softplus(this)},e.prototype.zerosLike=function(){return this.throwIfDisposed(),ke.zerosLike(this)},e.prototype.onesLike=function(){return this.throwIfDisposed(),ke.onesLike(this)},e.prototype.sin=function(){return this.throwIfDisposed(),ke.sin(this)},e.prototype.cos=function(){return this.throwIfDisposed(),ke.cos(this)},e.prototype.tan=function(){return this.throwIfDisposed(),ke.tan(this)},e.prototype.asin=function(){return this.throwIfDisposed(),ke.asin(this)},e.prototype.acos=function(){return this.throwIfDisposed(),ke.acos(this)},e.prototype.atan=function(){return this.throwIfDisposed(),ke.atan(this)},e.prototype.sinh=function(){return this.throwIfDisposed(),ke.sinh(this)},e.prototype.cosh=function(){return this.throwIfDisposed(),ke.cosh(this)},e.prototype.tanh=function(){return this.throwIfDisposed(),ke.tanh(this)},e.prototype.asinh=function(){return this.throwIfDisposed(),ke.asinh(this)},e.prototype.acosh=function(){return this.throwIfDisposed(),ke.acosh(this)},e.prototype.atanh=function(){return this.throwIfDisposed(),ke.atanh(this)},e.prototype.erf=function(){return this.throwIfDisposed(),ke.erf(this)},e.prototype.round=function(){return this.throwIfDisposed(),ke.round(this)},e.prototype.step=function(e){return void 0===e&&(e=0),this.throwIfDisposed(),ke.step(this,e)},e.prototype.softmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),ke.softmax(this,e)},e.prototype.logSoftmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),ke.logSoftmax(this,e)},e.prototype.resizeBilinear=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),ke.image.resizeBilinear(this,e,t)},e.prototype.resizeNearestNeighbor=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),ke.image.resizeNearestNeighbor(this,e,t)},e.prototype.conv1d=function(e,t,n,r,i,a){return void 0===r&&(r="NWC"),void 0===i&&(i=1),this.throwIfDisposed(),ke.conv1d(this,e,t,n,r,i,a)},e.prototype.conv2d=function(e,t,n,r,i,a){return void 0===r&&(r="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),ke.conv2d(this,e,t,n,r,i,a)},e.prototype.conv2dTranspose=function(e,t,n,r,i){return this.throwIfDisposed(),ke.conv2dTranspose(this,e,t,n,r,i)},e.prototype.depthwiseConv2D=function(e,t,n,r,i,a){return void 0===r&&(r="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),ke.depthwiseConv2d(this,e,t,n,r,i,a)},e.prototype.separableConv2d=function(e,t,n,r,i,a){return void 0===i&&(i=[1,1]),void 0===a&&(a="NHWC"),this.throwIfDisposed(),ke.separableConv2d(this,e,t,n,r,i,a)},e.prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),ke.avgPool(this,e,t,n,r)},e.prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),ke.maxPool(this,e,t,n,r)},e.prototype.localResponseNormalization=function(e,t,n,r){return void 0===e&&(e=5),void 0===t&&(t=1),void 0===n&&(n=1),void 0===r&&(r=.5),ke.localResponseNormalization(this,e,t,n,r)},e.prototype.pool=function(e,t,n,r,i){return this.throwIfDisposed(),ke.pool(this,e,t,n,r,i)},e.prototype.variable=function(e,t,n){return void 0===e&&(e=!0),this.throwIfDisposed(),_e().makeVariable(this,e,t,n)},e.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),ke.unsortedSegmentSum(this,e,t)},e.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),ke.batchToSpaceND(this,e,t)},e.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),ke.spaceToBatchND(this,e,t)},e.prototype.topk=function(e,t){return void 0===e&&(e=1),void 0===t&&(t=!0),this.throwIfDisposed(),ke.topk(this,e,t)},e.prototype.stridedSlice=function(e,t,n,r,i,a,o,s){return void 0===r&&(r=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=0),this.throwIfDisposed(),ke.stridedSlice(this,e,t,n,r,i,a,o,s)},e.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),ke.depthToSpace(this,e,t)},e.prototype.fft=function(){return this.throwIfDisposed(),ke.spectral.fft(this)},e.prototype.ifft=function(){return this.throwIfDisposed(),ke.spectral.ifft(this)},e.prototype.rfft=function(){return this.throwIfDisposed(),ke.spectral.rfft(this)},e.prototype.irfft=function(){return this.throwIfDisposed(),ke.spectral.irfft(this)},e}();Object.defineProperty(Se,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.dataId&&null!=e.shape&&null!=e.dtype}});var Ce,Ae,Oe,De,Te,je=function(e){function t(t,n,r,i){var a=e.call(this,t.shape,t.dtype,t.dataId,i)||this;return a.trainable=n,a.name=r,a}return s(t,e),t.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!M(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");_e().disposeTensor(this),this.dataId=e.dataId,_e().incRef(this,null)},t.prototype.dispose=function(){_e().disposeVariable(this),this.isDisposedInternal=!0},t}(Se);Object.defineProperty(je,Symbol.hasInstance,{value:function(e){return e instanceof Se&&null!=e.assign&&e.assign instanceof Function}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(Ce||(Ce={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(Ae||(Ae={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(Oe||(Oe={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(De||(De={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(Te||(Te={}));var Me={float32:De,int32:Ae,bool:Oe,complex64:Te};function Fe(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast "+e+" with "+t)}return Me[e][t]}function Ie(e){return Fe(e,"int32")}function Ne(e,t){if(e.dtype===t.dtype)return[e,t];var n=Fe(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function Re(e,t){A(e.dtype===t.dtype,(function(){return"The dtypes of the first("+e.dtype+") and second("+t.dtype+") input must match"}))}function Pe(e){var t=[];return function e(t,n,r){if(null!=t)if(t instanceof Se)n.push(t);else if(i=t,Array.isArray(i)||"object"==typeof i){var i,a=t;for(var o in a){var s=a[o];r.has(s)||(r.add(s),e(s,n,r))}}}(e,t,new Set),t}var Be,Le=Object.freeze({makeTypesMatch:Ne,assertTypesMatch:Re,isTensorInList:function(e,t){return t.some((function(t){return t.id===e.id}))},getTensorsInContainer:Pe}),ze=function(){function e(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return e.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},e}(),Ue=function(){function e(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new ze}return e.prototype.ready=function(){return u(this,void 0,void 0,(function(){var e,t,n;return c(this,(function(r){switch(r.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then((function(){}))];if(null!=this.backendInstance)return[2];e=this.getSortedBackends(),t=0,r.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return r.sent()?[4,this.setBackend(n)]:[3,4];case 3:return r.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}}))}))},Object.defineProperty(e.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),e.prototype.backendNames=function(){return Object.keys(this.registryFactory)},e.prototype.findBackend=function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]},e.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},e.prototype.registerBackend=function(e,t,n){return void 0===n&&(n=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},e.prototype.setBackend=function(e){return u(this,void 0,void 0,(function(){var t,n,r;return c(this,(function(i){switch(i.label){case 0:if(null==this.registryFactory[e])throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,null!=this.registry[e]?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,t.asyncInit?[4,n]:[3,2]);case 1:return r=i.sent(),[3,3];case 2:r=n,i.label=3;case 3:if(!r)return[2,!1];i.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new he(this.backendInstance),[2,!0]}}))}))},e.prototype.setupRegisteredKernels=function(){var e=this;g(this.backendName).forEach((function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)}))},e.prototype.disposeRegisteredKernels=function(e){var t=this;g(e).forEach((function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])}))},e.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var r=n.factory();if(Promise.resolve(r)===r){var i=++this.pendingBackendInitId,a=r.then((function(n){return!(i<t.pendingBackendInitId||(t.registry[e]=n,t.pendingBackendInit=null,0))})).catch((function(n){return!(i<t.pendingBackendInitId||(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(n.stack||n.message),1))}));return this.pendingBackendInit=a,{success:a,asyncInit:!0}}return this.registry[e]=r,{success:!0,asyncInit:!1}}catch(t){return console.warn("Initialization of backend "+e+" failed"),console.warn(t.stack||t.message),{success:!1,asyncInit:!1}}},e.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},e.prototype.getSortedBackends=function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority}))},e.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),i=r.success,a=r.asyncInit;if(a||i)return{name:n,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},e.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,i=this.readSync(t);r.disposeData(t),n.backend=e,e.move(t,i,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},e.prototype.tidy=function(e,t){var n,r=this,i=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=e}return this.scopedRun((function(){return r.startScope(i)}),(function(){return r.endScope(n)}),(function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))},e.prototype.scopedRun=function(e,t,n){e();try{var r=n();return t(),r}catch(e){throw t(),e}},e.prototype.nextTensorId=function(){return e.nextTensorId++},e.prototype.nextVariableId=function(){return e.nextVariableId++},e.prototype.clone=function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],(function(e){return{x:function(){return e.toFloat()}}}),[],{}),t},e.prototype.runKernel=function(e,t,n,r,i){return this.runKernelFunc(null,t,null,e,n,r,i)},e.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},e.prototype.checkKernelForMemLeak=function(e,t,n){var r=this.backend.numDataIds(),i=0;n.forEach((function(e){i+="complex64"===e.dtype?3:1}));var a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],o=r-t-i-a;if(o>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+o+" data ids) after running '"+e+"'")},e.prototype.runKernelFunc=function(e,t,n,r,i,a,o){var s,u=this,c=[],l=this.isTapeOn();null==r&&(r=null!=this.state.activeScope?this.state.activeScope.name:"");var f,d=this.state.numBytes,h=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var p,v=m(r,this.backendName);if(null!=v)f=function(){var e=u.backend.numDataIds();p=v.kernelFunc({inputs:t,attrs:i,backend:u.backend});var n=Array.isArray(p)?p:[p];u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,e,n);var s=n.map((function(e){var t=e.dataId,n=e.shape,r=e.dtype;return u.makeTensorFromDataId(t,n,r)}));if(l){var f=u.getTensorsForGradient(r,t,s);if(null==f){null==o&&(o=[]);var d=s.filter((function(e,t){return o[t]}));f=(a||[]).slice().concat(d)}c=u.saveTensorsForBackwardMode(f)}return s};else{var g=function(e){l&&(c=e.map((function(e){return u.keep(u.clone(e))})))};f=function(){var t=u.backend.numDataIds();p=u.tidy((function(){return e(u.backend,g)}));var n=Array.isArray(p)?p:[p];return u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,t,n),n}}return this.scopedRun((function(){return u.state.kernelDepth++}),(function(){return u.state.kernelDepth--}),(function(){s=u.ENV.getBool("DEBUG")?u.profiler.profileKernel(r,t,(function(){return f()})):f()})),l&&this.addTapeNode(r,t,s,n,c,i),this.state.profiling&&this.state.activeProfile.kernels.push({name:r,bytesAdded:this.state.numBytes-d,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-h,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map((function(e){return t[e].shape})),outputShapes:s.map((function(e){return e.shape}))}),Array.isArray(p)?s:s[0]},e.prototype.saveTensorsForBackwardMode=function(e){var t=this;return e.map((function(e){return t.keep(t.clone(e))}))},e.prototype.getTensorsForGradient=function(e,t,n){var r=v(e);if(null!=r){var i=r.inputsToSave||[],a=r.outputsToSave||[],o=void 0;r.saveAllInputs?(A(Array.isArray(t),(function(){return"saveAllInputs is true, expected inputs to be an array."})),o=Object.keys(t).map((function(e){return t[e]}))):o=i.map((function(e){return t[e]}));var s=n.filter((function(e,t){return a[t]}));return o.concat(s)}return null},e.prototype.makeTensor=function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var i=e;"string"===n&&Y(e[0])&&(i=e.map((function(e){return ue(e)})));var a=r.write(i,t,n),o=new Se(t,n,a,this.nextTensorId());if(this.incRef(o,r),"string"===n){var s=this.state.tensorInfo.get(a),u=K(i);this.state.numBytes+=u-s.bytes,s.bytes=u}return o},e.prototype.makeTensorFromDataId=function(e,t,n,r){var i=new Se(t,n=n||"float32",e,this.nextTensorId());return this.incRef(i,r),i},e.prototype.makeVariable=function(e,t,n,r){void 0===t&&(t=!0),n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.asType(r));var i=new je(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[i.name])throw new Error("Variable with name "+i.name+" was already registered");return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},e.prototype.incRef=function(e,t){var n=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;var r=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(r=e.size*X(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r,refCount:0}),this.state.numBytes+=r}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof je||this.track(e)},e.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,"string"===e.dtype&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?("complex64"!==e.dtype&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},e.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},e.prototype.disposeVariable=function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]},e.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},e.prototype.profile=function(e){return u(this,void 0,void 0,(function(){var t,n;return c(this,(function(r){return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map((function(e){return e.totalBytesSnapshot}))),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,[2,this.state.activeProfile]}))}))},e.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},e.prototype.addTapeNode=function(e,t,n,r,i,a){var o=this,s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:i},u=v(e);null!=u&&(r=u.gradFunc),null!=r&&(s.gradient=function(e){return e=e.map((function(e,t){if(null==e){var r=n[t],i=ae(r.size,r.dtype);return o.makeTensor(i,r.shape,r.dtype)}return e})),r(e.length>1?e:e[0],i,a)}),this.state.activeTape.push(s)},e.prototype.keep=function(e){return e.kept=!0,e},e.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},e.prototype.endTape=function(){this.state.gradientDepth--},e.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},e.prototype.endScope=function(e){for(var t=this,n=Pe(e),r=new Set(n.map((function(e){return e.id}))),i=0;i<this.state.activeScope.track.length;i++){var a=this.state.activeScope.track[i];a.kept||r.has(a.id)||a.dispose()}var o=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(e){e.kept||e.scopeId!==o.id||t.track(e)}))},e.prototype.gradients=function(e,t,n,r){var i=this;if(void 0===r&&(r=!1),A(t.length>0,(function(){return"gradients() received an empty list of xs."})),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var a=this.scopedRun((function(){return i.startTape()}),(function(){return i.endTape()}),(function(){return i.tidy("forward",e)}));A(a instanceof Se,(function(){return"The result y returned by f() must be a tensor."}));var o=function(e,t,n){for(var r={},i={},a=0;a<t.length;a++)r[t[a].id]=!0;for(a=0;a<e.length;a++){var o=(p=e[a]).inputs;for(var s in o){for(var u=o[s],c=!1,l=0;l<t.length;l++)if(r[u.id]){p.outputs.forEach((function(e){return r[e.id]=!0})),c=!0,i[p.id]=!0;break}if(c)break}}var f={};f[n.id]=!0;var d={};for(a=e.length-1;a>=0;a--)for(o=(p=e[a]).inputs,l=0;l<p.outputs.length;l++)if(f[p.outputs[l].id]){for(var s in o)f[o[s].id]=!0,d[p.id]=!0;break}var h=[];for(a=0;a<e.length;a++){var p;if(i[(p=e[a]).id]&&d[p.id]){var m={};for(var s in p.inputs){var v=p.inputs[s];r[v.id]&&(m[s]=v)}var g=Object.assign({},p);g.inputs=m,g.outputs=p.outputs,h.push(g)}}return h}(this.state.activeTape,t,a);if(!r&&0===o.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var e,r,s={};s[a.id]=null==n?(r=ie(j(e=a.shape),"float32"),We.makeTensor(r,e,"float32")):n,function(e,t,n){for(var r=function(r){var i=t[r],a=[];if(i.outputs.forEach((function(t){var n=e[t.id];null!=n?a.push(n):a.push(null)})),null==i.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+i.kernelName+".");var o=i.gradient(a),s=function(t){if(!(t in o))throw new Error("Cannot backprop through input "+t+". Available gradients found: "+Object.keys(o)+".");var r=n((function(){return o[t]()}));if("float32"!==r.dtype)throw new Error("Error in gradient for op "+i.kernelName+". The gradient of input "+t+" must have 'float32' dtype, but has '"+r.dtype+"'");var a=i.inputs[t];if(!M(r.shape,a.shape))throw new Error("Error in gradient for op "+i.kernelName+". The gradient of input '"+t+"' has shape '"+r.shape+"', which does not match the shape of the input '"+a.shape+"'");if(null==e[a.id])e[a.id]=r;else{var s=e[a.id];e[a.id]=s.add(r),s.dispose()}};for(var u in i.inputs)s(u)},i=t.length-1;i>=0;i--)r(i)}(s,o,(function(e){return i.tidy(e)}));var u=t.map((function(e){return s[e.id]}));return 0===i.state.gradientDepth&&(i.state.activeTape.forEach((function(e){for(var t=0,n=e.saved;t<n.length;t++)n[t].dispose()})),i.state.activeTape=null),{value:a,grads:u}}))},e.prototype.customGrad=function(e){var t=this;return A(Q(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];A(r.every((function(e){return e instanceof Se})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var a={};return r.forEach((function(e,t){a[t]=e})),t.runKernelFunc((function(t,i){return A((n=e.apply(void 0,r.concat([i]))).value instanceof Se,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),A(Q(n.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),n.value}),a,(function(e,t){var i=n.gradFunc(e,t),a=Array.isArray(i)?i:[i];A(a.length===r.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),A(a.every((function(e){return e instanceof Se})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var o={};return a.forEach((function(e,t){o[t]=function(){return e}})),o}))}},e.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},e.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},e.prototype.time=function(e){return u(this,void 0,void 0,(function(){var t,n;return c(this,(function(r){switch(r.label){case 0:return t=oe(),[4,this.backend.time(e)];case 1:return(n=r.sent()).wallMs=oe()-t,[2,n]}}))}))},e.prototype.track=function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(e.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),e.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new ze,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},e.nextTensorId=0,e.nextVariableId=0,e}(),We=function(){var t=function(){if(null==Be){var t=void 0;if("undefined"!=typeof window)t=window;else if(void 0!==e)t=e;else if(void 0!==r)t=r;else{if("undefined"==typeof self)throw new Error("Could not find a global object");t=self}Be=t}return Be}();if(null==t._tfengine){var n=new l(t);t._tfengine=new Ue(n)}return function(e){d=e}(t._tfengine.ENV),_e=function(){return t._tfengine},t._tfengine}();function Ve(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var Ge=f();Ge.registerFlag("DEBUG",(function(){return!1}),(function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),Ge.registerFlag("IS_BROWSER",(function(){return Ve()})),Ge.registerFlag("IS_NODE",(function(){return void 0!==r&&void 0!==r.versions&&void 0!==r.versions.node})),Ge.registerFlag("IS_CHROME",(function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),Ge.registerFlag("PROD",(function(){return!1})),Ge.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return Ge.getBool("DEBUG")})),Ge.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),Ge.registerFlag("IS_TEST",(function(){return!1}));var qe,He,Xe,Ke={},Ye={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function $e(e,t){Ke[e]=t}function Je(e){e in Ke||(Ke[e]=function(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=function(e){if("undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return t.addEventListener("webglcontextlost",(function(t){t.preventDefault(),delete Ke[e]}),!1),1===e?t.getContext("webgl",Ye)||t.getContext("experimental-webgl",Ye):t.getContext("webgl2",Ye)}(e));var t=Ke[e];return t.isContextLost()?(delete Ke[e],Je(e)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),Ke[e])}function Ze(e,t){return[t,e]}function Qe(e){var t=j(e);return N(Math.ceil(t/4))}function et(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function tt(e,t){var n,r,i,a,o,s,u,c,l,d=e;return 2===f().getNumber("WEBGL_VERSION")?(n=d.R32F,r=d.R16F,i=d.RGBA16F,a=d.RGBA32F,o=d.RED,s=4,u=1,c=d.HALF_FLOAT,l=d.FLOAT):(n=e.RGBA,r=e.RGBA,i=e.RGBA,a=d.RGBA,o=e.RGBA,s=4,u=4,c=null!=t?t.HALF_FLOAT_OES:null,l=e.FLOAT),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:a,textureFormatFloat:o,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:c,textureTypeFloat:l}}function nt(e,t,n){var r=n();return t&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+ot(e,t))}(e),r}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(qe||(qe={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(He||(He={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Xe||(Xe={}));var rt=5.96e-8,it=65504;function at(e){return!!(f().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||rt<Math.abs(e)&&Math.abs(e)<it)}function ot(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}function st(e,t,n){return Tt(e,t,(function(){return e.getExtension(n)}),'Extension "'+n+'" not supported on this browser.')}function ut(e,t,n){var r=Tt(e,t,(function(){return e.createShader(e.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(nt(e,t,(function(){return e.shaderSource(r,n)})),nt(e,t,(function(){return e.compileShader(r)})),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function ct(e,t,n){var r=Tt(e,t,(function(){return e.createShader(e.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(nt(e,t,(function(){return e.shaderSource(r,n)})),nt(e,t,(function(){return e.compileShader(r)})),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw function(e,t){var n=dt.exec(t);if(null==n)return console.log("Couldn't parse line number in error: "+t),void console.log(e);for(var r=+n[1],i=e.split("\n"),a=i.length.toString().length+2,o=i.map((function(e,t){return R((t+1).toString(),a)+e})),s=0,u=0;u<o.length;u++)s=Math.max(o[u].length,s);var c=o.slice(0,r-1),l=o.slice(r-1,r),f=o.slice(r);console.log(c.join("\n")),console.log(t.split("\n")[0]),console.log("%c "+R(l[0],s),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(f.join("\n"))}(n,e.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var lt,ft,dt=/ERROR: [0-9]+:([0-9]+):/g;function ht(e,t){return Tt(e,t,(function(){return e.createProgram()}),"Unable to create WebGLProgram.")}function pt(e,t,n){if(nt(e,t,(function(){return e.linkProgram(n)})),!1===e.getProgramParameter(n,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function mt(e,t,n){if(nt(e,t,(function(){return e.validateProgram(n)})),!1===e.getProgramParameter(n,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function vt(e,t,n){var r=Tt(e,t,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return nt(e,t,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),nt(e,t,(function(){return e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW)})),r}function gt(e,t,n){var r=Tt(e,t,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return nt(e,t,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r)})),nt(e,t,(function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,n,e.STATIC_DRAW)})),r}function yt(e,t){return Tt(e,t,(function(){return e.createTexture()}),"Unable to create WebGLTexture.")}function bt(e,t){var n=f().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="["+e+"x"+t+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n)throw r="["+e+"x"+t+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU ["+n+"x"+n+"].")}function xt(e,t){return Tt(e,t,(function(){return e.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}function wt(e,t,n,r,i,a,o,s){var u=e.getAttribLocation(n,r);return-1!==u&&(nt(e,t,(function(){return e.bindBuffer(e.ARRAY_BUFFER,i)})),nt(e,t,(function(){return e.vertexAttribPointer(u,a,e.FLOAT,!1,o,s)})),nt(e,t,(function(){return e.enableVertexAttribArray(u)})),!0)}function _t(e,t,n,r){jt(e,r),nt(e,t,(function(){return e.activeTexture(e.TEXTURE0+r)})),nt(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,n)}))}function kt(e,t,n,r){return Tt(e,t,(function(){return e.getUniformLocation(n,r)}),'uniform "'+r+'" not present in program.')}function Et(e,t,n){return e.getUniformLocation(t,n)}function St(e,t,n,r,i,a){nt(e,t,(function(){return _t(e,t,r,a)})),nt(e,t,(function(){return e.uniform1i(i,a)}))}function Ct(e,t,n,r){nt(e,t,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,r)})),nt(e,t,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)}))}function At(e,t,n){nt(e,t,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)})),nt(e,t,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}))}function Ot(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Dt(e,t))}function Dt(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}function Tt(e,t,n,r){var i=nt(e,t,(function(){return n()}));if(null==i)throw new Error(r);return i}function jt(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+n+"].")}function Mt(e,t){return void 0===t&&(t=2),j(e.slice(0,e.length-t))}function Ft(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function It(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[Mt(e)].concat(Ft(e))),t}function Nt(e,t){var n;void 0===t&&(t=!1);var r=f().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(r*=2,1===(e=e.map((function(t,n){return n>=e.length-2?S(e[n]):e[n]}))).length&&(e=[2,e[0]])),2!==e.length){var i=z(e);e=i.newShape}var a=j(e);if(e.length<=1&&a<=r)return[1,a];if(2===e.length&&e[0]<=r&&e[1]<=r)return e;if(3===e.length&&e[0]*e[1]<=r&&e[2]<=r)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=r&&e[1]*e[2]<=r)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=r&&e[3]<=r)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=r&&e[1]*e[2]*e[3]<=r)return[e[0],e[1]*e[2]*e[3]];if(t){var o=Mt(e),s=2,u=2;return e.length&&(s=(n=Ft(e))[0],u=n[1]),N(a=o*(s/2)*(u/2)).map((function(e){return 2*e}))}return N(a)}function Rt(e){return e%2==0}function Pt(e,t){if(M(e=e.slice(-2),t=t.slice(-2)))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r)return!0;if(Rt(n)&&Rt(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&Rt(e[0])&&Rt(t[0])}function Bt(e){if(null==lt){var t=Je(e);lt=t.getParameter(t.MAX_TEXTURE_SIZE)}return lt}function Lt(e){if(null==ft){var t=Je(e);ft=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,ft)}function zt(e){if(0===e)return 0;var t=Je(e);return Ut(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:Ut(t,"EXT_disjoint_timer_query")?1:0}function Ut(e,t){return null!=e.getExtension(t)}function Wt(e){try{if(null!=Je(e))return!0}catch(e){return!1}return!1}function Vt(e){if(0===e)return!1;var t=Je(e);if(1===e){if(!Ut(t,"OES_texture_float"))return!1}else if(!Ut(t,"EXT_color_buffer_float"))return!1;return qt(t)}function Gt(e){if(0===e)return!1;var t=Je(e);return 1!==e?Ut(t,"EXT_color_buffer_float")?qt(t):!!Ut(t,"EXT_color_buffer_half_float")&&function(e,t){var n=tt(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var i=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,i),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(i),a}(t,t.getExtension("EXT_color_buffer_half_float")):!!Ut(t,"OES_texture_float")&&!!Ut(t,"WEBGL_color_buffer_float")&&qt(t)}function qt(e){var t=tt(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var i=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),i}function Ht(e){return 2===e&&null!=Je(e).fenceSync}var Xt=Object.freeze({callAndCheck:nt,canBeRepresented:at,getWebGLErrorMessage:ot,getExtensionOrThrow:st,createVertexShader:ut,createFragmentShader:ct,createProgram:ht,linkProgram:pt,validateProgram:mt,createStaticVertexBuffer:vt,createStaticIndexBuffer:gt,getNumChannels:function(){return 2===f().getNumber("WEBGL_VERSION")?1:4},createTexture:yt,validateTextureSize:bt,createFramebuffer:xt,bindVertexBufferToProgramAttribute:wt,bindTextureUnit:_t,unbindTextureUnit:function(e,t,n){jt(e,n),nt(e,t,(function(){return e.activeTexture(e.TEXTURE0+n)})),nt(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))},getProgramUniformLocationOrThrow:kt,getProgramUniformLocation:Et,bindTextureToProgramUniformSampler:St,bindCanvasToFramebuffer:function(e,t){nt(e,t,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)})),nt(e,t,(function(){return e.viewport(0,0,e.canvas.width,e.canvas.height)})),nt(e,t,(function(){return e.scissor(0,0,e.canvas.width,e.canvas.height)}))},bindColorTextureToFramebuffer:Ct,unbindColorTextureFromFramebuffer:At,validateFramebuffer:Ot,getFramebufferErrorMessage:Dt,getBatchDim:Mt,getRowsCols:Ft,getShapeAs3D:It,getTextureShapeFromLogicalShape:Nt,isReshapeFree:Pt,getWebGLMaxTextureSize:Bt,resetMaxTextureSize:function(){lt=null},resetMaxTexturesInShader:function(){ft=null},getMaxTexturesInShader:Lt,getWebGLDisjointQueryTimerVersion:zt,hasExtension:Ut,isWebGLVersionEnabled:Wt,isCapableOfRenderingToFloatTexture:Vt,isDownloadFloatTextureEnabled:Gt,isWebGLFenceEnabled:Ht}),Kt=f();function Yt(){f().set("PROD",!0)}function $t(){f().set("DEBUG",!0)}function Jt(){f().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function Zt(e){f().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Qt(){We.disposeVariables()}function en(){return We}function tn(){return We.memory()}function nn(e){return We.profile(e)}function rn(e,t){return We.tidy(e,t)}function an(e){Pe(e).forEach((function(e){return e.dispose()}))}function on(e){return We.keep(e)}function sn(e){return We.time(e)}function un(e){return We.setBackend(e)}function cn(){return We.ready()}function ln(){return We.backendName}function fn(e){We.removeBackend(e)}function dn(e){return We.findBackend(e)}function hn(e){return We.findBackendFactory(e)}function pn(e,t,n){return void 0===n&&(n=1),We.registerBackend(e,t,n)}function mn(){return We.backend}function vn(e,t){f().setPlatform(e,t)}function gn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];f().getBool("IS_TEST")||console.warn.apply(console,e)}function yn(e,t){var n=e;if(H(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||H(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&f().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function e(t,n,r){if(r=r||[],Array.isArray(t)||H(t)){A(n.length>0,(function(){return"Element arr["+r.join("][")+"] should be a primitive, but is an array of "+t.length+" elements"})),A(t.length===n[0],(function(){return"Element arr["+r.join("][")+"] should have "+n[0]+" elements, but has "+t.length+" elements"}));for(var i=n.slice(1),a=0;a<t.length;++a)e(t[a],i,r.concat(a))}else A(0===n.length,(function(){return"Element arr["+r.join("][")+"] is a primitive, but should be an array/TypedArray of "+n[0]+" elements"}))}(e,r,[]),r}function bn(e,t,n,r){if(null!=e&&("numeric"!==e&&e!==t||"numeric"===e&&"string"===t))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+e+" tensor, but got "+t+" tensor")}function xn(e,t,n,r){if(void 0===r&&(r="numeric"),e instanceof Se)return bn(r,e.dtype,t,n),e;var i=Z(e);if("string"!==i&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),bn(r,i,t,n),null==e||!H(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e){var a=null==e?"null":e.constructor.name;throw new Error("Argument '"+t+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+a+"'")}var o=yn(e,i);H(e)||Array.isArray(e)||(e=[e]);var s="string"!==i?ne(e,i,f().getBool("DEBUG")):T(e,[],!0);return We.makeTensor(s,o,i)}function wn(e,t,n,r){if(void 0===r&&(r="numeric"),!Array.isArray(e))throw new Error("Argument "+t+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return e.map((function(e,r){return xn(e,t+"["+r+"]",n)}),r)}function _n(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function kn(e,t,n){for(var r=e.length+t.length,i=[],a=0,o=0,s=0;s<r;s++)-1===n.indexOf(s)?i.push(e[a++]):i.push(t[o++]);return i}function En(e,t){for(var n=[],r=e.length,i=0;i<r;i++)-1===t.indexOf(i)&&n.push(e[i]);return[n,t.map((function(t){return e[t]}))]}function Sn(e,t){return kn(e,t.map((function(e){return 1})),t)}function Cn(e,t,n){A(_n(t,n),(function(){return e+" supports only inner-most axes for now. Got axes "+t+" and rank-"+n+" input."}))}function An(e,t){if(_n(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((function(e){return n.push(e)})),n}function On(e){return e.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}function Dn(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}function Tn(e,t){var n=e[0].length;e.forEach((function(e,t){A(e.length===n,(function(){return"Error in concat"+n+"D: rank of tensors["+t+"] must be the same as the rank of the rest ("+n+")"}))})),A(t>=0&&t<n,(function(){return"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+"."}));var r=e[0];e.forEach((function(e,i){for(var a=0;a<n;a++)A(a===t||e[a]===r[a],(function(){return"Error in concat"+n+"D: Shape of tensors["+i+"] ("+e+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+i+"."}))}))}function jn(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}function Mn(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var i=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];We.startScope(n);try{var i=r.apply(void 0,e);return i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),We.endScope(i),i}catch(e){throw We.endScope(null),e}};return Object.defineProperty(i,"name",{value:n,configurable:!0}),i}Kt.registerFlag("HAS_WEBGL",(function(){return Kt.getNumber("WEBGL_VERSION")>0})),Kt.registerFlag("WEBGL_VERSION",(function(){return Wt(2)?2:Wt(1)?1:0})),Kt.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return 2===Kt.get("WEBGL_VERSION")})),Kt.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),Kt.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),Kt.registerFlag("WEBGL_PACK",(function(){return Kt.getBool("HAS_WEBGL")})),Kt.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return Kt.getBool("WEBGL_PACK")})),Kt.registerFlag("WEBGL_PACK_CLIP",(function(){return Kt.getBool("WEBGL_PACK")})),Kt.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return!1})),Kt.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return Kt.getBool("WEBGL_PACK")})),Kt.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return Kt.getBool("WEBGL_PACK")})),Kt.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return Kt.getBool("WEBGL_PACK")})),Kt.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return Kt.getBool("WEBGL_PACK")})),Kt.registerFlag("WEBGL_PACK_REDUCE",(function(){return Kt.getBool("WEBGL_PACK")})),Kt.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return Kt.getBool("WEBGL_PACK")})),Kt.registerFlag("WEBGL_CONV_IM2COL",(function(){return Kt.getBool("WEBGL_PACK")})),Kt.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return Bt(Kt.getNumber("WEBGL_VERSION"))})),Kt.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return Lt(Kt.getNumber("WEBGL_VERSION"))})),Kt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var e=Kt.getNumber("WEBGL_VERSION");return 0===e?0:zt(e)})),Kt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return Kt.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(e=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))));var e})),Kt.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return Vt(Kt.getNumber("WEBGL_VERSION"))})),Kt.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!Kt.getBool("WEBGL_FORCE_F16_TEXTURES")&&Kt.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),Kt.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return Gt(Kt.getNumber("WEBGL_VERSION"))})),Kt.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return Ht(Kt.getNumber("WEBGL_VERSION"))})),Kt.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return Kt.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),Ee=Zt;var Fn=Mn({complex_:function(e,t){var n=xn(e,"real","complex"),r=xn(t,"imag","complex");return O(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),We.runKernelFunc((function(e){return e.complex(n,r)}),{$real:n,$imag:r})}}),In=Mn({real_:function(e){var t=xn(e,"input","real");return We.runKernelFunc((function(e){return e.real(t)}),{$input:t})}}),Nn=Mn({imag_:function(e){var t=xn(e,"input","imag");return We.runKernelFunc((function(e){return e.imag(t)}),{$input:t})}});function Rn(e,t,n){return Pn(e,t,yn(e,n),n)}function Pn(e,t,n,r){if(null==r&&(r=Z(e)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!H(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){se(t);var i=j(t),a=j(n);A(i===a,(function(){return"Based on the provided shape, ["+t+"], the tensor should have "+i+" values but has "+a}));for(var o=0;o<n.length;++o){var s=n[o],u=o!==n.length-1||s!==j(t.slice(o));A(n[o]===t[o]||!u,(function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+t+"). "}))}}return H(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?ne(e,r,f().getBool("DEBUG")):T(e,[],!0),We.makeTensor(e,t,r)}function Bn(e,t){if((H(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&H(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Pn(e,[],[],t)}function Ln(e,t){D(e);var n=yn(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Pn(e,null,n,t)}function zn(e,t,n){if(D(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=yn(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Pn(e,t,r,n)}function Un(e,t,n){if(D(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=yn(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Pn(e,t,r,n)}function Wn(e,t,n){if(D(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var r=yn(e,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Pn(e,t,r,n)}function Vn(e,t,n){if(D(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var r=yn(e,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Pn(e,t,r,n)}function Gn(e,t,n){if(D(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var r=yn(e,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Pn(e,t=t||r,r,n)}function qn(e,t,n,r){return void 0===t&&(t=!0),We.makeVariable(e,t,n,r)}function Hn(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=Hn(e,"float32"),r=Xn(e,"float32");return Fn(n,r)}var i=ie(j(e),t);return We.makeTensor(i,e,t)}function Xn(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=Xn(e,"float32"),r=Xn(e,"float32");return Fn(n,r)}var i=ae(j(e),t);return We.makeTensor(i,e,t)}function Kn(e,t,n){return We.runKernelFunc((function(r){return r.fill(e,t,n)}),{})}function Yn(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");return We.runKernelFunc((function(r){return r.linspace(e,t,n)}),{})}function $n(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r="float32"),0===n)throw new Error("Cannot have a step of zero");if(e===t||e<t&&n<0||t<e&&n>1)return Xn([0],r);var i=ae(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),i[0]=e;for(var a=1;a<i.length;a++)i[a]=i[a-1]+n;return Ln(i,r)}var Jn=Mn({onesLike_:function(e){var t=xn(e,"x","onesLike");if("complex64"===t.dtype){var n=Jn(In(t)),r=Zn(Nn(t));return Fn(n,r)}return We.runKernelFunc((function(e){return e.onesLike(t)}),{x:t},(function(e,t){return{x:function(){return Zn(e)}}}),"OnesLike")}}),Zn=Mn({zerosLike_:function(e){var t=xn(e,"x","zerosLike");return We.runKernelFunc((function(e){return e.zerosLike(t)}),{x:t},(function(e,t){return{x:function(){return Zn(e)}}}),"ZerosLike")}}),Qn=Mn({concat_:function(e,t){void 0===t&&(t=0),A(e.length>=1,(function(){return"Pass at least one tensor to concat"}));var n=wn(e,"tensors","concat");"complex64"===n[0].dtype&&n.forEach((function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+e.dtype+". ")})),t=L(t,n[0].shape)[0];var r=jn(n.map((function(e){return e.shape})),t);if(0===j(r))return Rn([],r);if(1===(n=n.filter((function(e){return e.size>0}))).length)return n[0];var i=n.map((function(e){return e.shape}));Tn(i,t);var a=n,o={axis:t};return We.runKernelFunc((function(e){return e.concat(n,t)}),a,(function(e){var n=i.map((function(e){return e[t]}));return ir(e,n,t).map((function(e){return function(){return e}}))}),"Concat",o)}}),er=Mn({concat1d_:function(e){return Qn(e,0)}}),tr=Mn({concat2d_:function(e,t){return Qn(e,t)}}),nr=Mn({concat3d_:function(e,t){return Qn(e,t)}}),rr=Mn({concat4d_:function(e,t){return Qn(e,t)}}),ir=Mn({split_:function(e,t,n){void 0===n&&(n=0);var r,i=xn(e,"x","split");return n=L(n,i.shape)[0],"number"==typeof t?(A(i.shape[n]%t==0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(t).fill(i.shape[n]/t)):(A(i.shape[n]===t.reduce((function(e,t){return e+t})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=t),We.runKernelFunc((function(e){return e.split(i,r,n)}),{$x:i},(function(e){return{$x:function(){return Qn(e,n)}}}))}});function ar(e,t,n){return void 0===t&&(t="float32"),t=t||"float32",se(e),new we(e,t,n)}function or(e,t){void 0===t&&(t=!1),console.log(e.toString(t))}var sr=Mn({batchToSpaceND_:function(e,t,n){var r=xn(e,"x","batchToSpaceND"),i=t.reduce((function(e,t){return e*t}));return A(r.rank>=1+t.length,(function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+t.length})),A(n.length===t.length,(function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+t.length})),A(r.shape[0]%i==0,(function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+i})),We.runKernelFunc((function(e){return e.batchToSpaceND(r,t,n)}),{$x:r},(function(e){return{$x:function(){return e.spaceToBatchND(t,n)}}}))}}),ur=Mn({cast_:function(e,t){var n=xn(e,"x","cast");if(!G(t))throw new Error("Failed to cast to unknown dtype "+t);if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={dtype:t};return We.runKernelFunc((function(e){return e.cast(n,t)}),{x:n},(function(e){return{x:function(){return e.clone()}}}),"Cast",r)}}),cr=Mn({cumsum_:function(e,t,n,r){void 0===t&&(t=0),void 0===n&&(n=!1),void 0===r&&(r=!1);var i=xn(e,"x","cumsum"),a=An([t|=0],i.rank),o=i;null!=a&&(o=i.transpose(a));var s=Dn(1,i.rank)[0],u=We.runKernelFunc((function(e){return e.cumsum(o,s,n,r)}),{permutedX:o},(function(e){return{permutedX:function(){return e.cumsum(t,n,!r)}}}));return null!=a&&(u=u.transpose(a)),u}}),lr=Mn({depthToSpace_:function(e,t,n){void 0===n&&(n="NHWC");var r=xn(e,"x","depthToSpace"),i="NHWC"===n?r.shape[1]:r.shape[2],a="NHWC"===n?r.shape[2]:r.shape[3],o="NHWC"===n?r.shape[3]:r.shape[1];return A(i*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n      "+i+" and "+t+"  for depthToSpace with input shape\n      "+r.shape})),A(a*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n      "+a+" and "+t+" for depthToSpace with input shape\n          "+r.shape})),A(o%(t*t)==0,(function(){return"Dimension size must be evenly divisible by "+t*t+" but is "+o+" for depthToSpace with input shape "+r.shape})),We.runKernelFunc((function(e){return e.depthToSpace(r,t,n)}),{$x:r})}}),fr=Mn({expandDims_:function(e,t){void 0===t&&(t=0);var n=xn(e,"x","expandDims",null);A(t<=n.rank,(function(){return"Axis must be <= rank of the tensor"}));var r=n.shape.slice();return t<0&&(A(-(n.rank+1)<=t,(function(){return"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"})),t=n.rank+t+1),r.splice(t,0,1),dr(n,r)}}),dr=Mn({reshape_:function(e,t){var n=xn(e,"x","reshape",null);t=B(t,n.size),A(n.size===j(t),(function(){return"new shape and old shape must have the same number of elements."}));var r={shape:t};return We.runKernelFunc((function(e){return e.reshape(n,t)}),{x:n},(function(e){return{x:function(){return e.reshape(n.shape)}}}),"Reshape",r)}}),hr=Mn({spaceToBatchND_:function(e,t,n){var r=xn(e,"x","spaceToBatchND");return A(r.rank>=1+t.length,(function(){return"input rank "+r.rank+" should be > than [blockShape] "+t.length})),A(n.length===t.length,(function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+t.length})),A(r.shape.reduce((function(e,r,i){return i>0&&i<=t.length?e&&(r+n[i-1][0]+n[i-1][1])%t[i-1]==0:e}),!0),(function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+t.toString()})),We.runKernelFunc((function(e){return e.spaceToBatchND(r,t,n)}),{$x:r},(function(e){return{$x:function(){return e.batchToSpaceND(t,n)}}}))}}),pr=Mn({squeeze_:function(e,t){var n=xn(e,"x","squeeze");return dr(n,z(n.shape,t).newShape)}}),mr=Mn({stack_:function(e,t){void 0===t&&(t=0);var n=wn(e,"tensors","stack");if(A(n.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),1===n.length)return n[0].expandDims(t);var r=n[0].rank,i=n[0].shape,a=n[0].dtype;A(t<=r,(function(){return"Axis must be <= rank of the tensor"})),n.forEach((function(e){O(i,e.shape,"All tensors passed to stack must have matching shapes")})),n.forEach((function(e){A(a===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=n.map((function(e){return e.expandDims(t)}));return Qn(o,t)}}),vr=Mn({unstack_:function(e,t){void 0===t&&(t=0),t=t||0;var n=xn(e,"x","unstack");A(t>=-n.shape.length&&t<n.shape.length,(function(){return"Axis = "+t+" is not in [-"+n.shape.length+", "+n.shape.length+")"})),t<0&&(t+=n.shape.length);var r={axis:t};return We.runKernelFunc((function(e){return e.unstack(n,t)}),{x:n},(function(e){return{x:function(){return mr(e,t)}}}),"Unpack",r)}}),gr=function(e,t){return u(this,void 0,void 0,(function(){var n,r,i,a,o,s,u,l,f,d;return c(this,(function(c){switch(c.label){case 0:return n=xn(e,"x","setdiff1d"),r=xn(t,"y","setdiff1d"),A(n.dtype===r.dtype,(function(){return"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."})),A(1===n.rank,(function(){return"x should be 1D tensor, but got x ("+n.shape+")."})),A(1===r.rank,(function(){return"y should be 1D tensor, but got y ("+r.shape+")."})),[4,n.data()];case 1:return i=c.sent(),[4,r.data()];case 2:for(a=c.sent(),o=new Set(a),s=0,f=0;f<i.length;f++)o.has(i[f])||s++;for(u=new we([s],n.dtype),l=new we([s],"int32"),f=0,d=0;f<i.length;f++)o.has(i[f])||(u.values[d]=i[f],l.values[d]=f,d++);return[2,[u.toTensor(),l.toTensor()]]}}))}))};function yr(e,t,n,r){void 0===r&&(r=!0);var i=[];if(r)(i=i.concat(t.slice(0))).push(e[0]/n),i=i.concat(e.slice(1));else{i=i.concat(e[0]);for(var a=t.length,o=0;o<a;++o)i=i.concat([e[o+1]/t[o],t[o]]);i=i.concat(e.slice(a+1))}return i}function br(e,t,n){void 0===n&&(n=!0);var r=[];if(n){r.push(t);for(var i=t+1;i<e;++i)i<=2*t?(r.push(i),r.push(i-(t+1))):r.push(i)}else{var a=[],o=[];for(i=1;i<e;++i)i>=2*t+1||i%2==1?o.push(i):a.push(i);r.push.apply(r,a),r.push(0),r.push.apply(r,o)}return r}function xr(e,t,n,r){void 0===r&&(r=!0);var i=[];r?i.push(e[0]/n):i.push(e[0]*n);for(var a=1;a<e.length;++a)a<=t.length?r?i.push(t[a-1]*e[a]):i.push(e[a]/t[a-1]):i.push(e[a]);return i}function wr(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function _r(e,t,n){for(var r=e.slice(0,1),i=0;i<n;++i)r.push(e[i+1]-t[i][0]-t[i][1]);return r}var kr="Add",Er="AddN",Sr="Div",Cr="FusedBatchNorm",Ar="SquaredDifference",Or="Square",Dr="Transpose",Tr="NonMaxSuppressionV5",jr="BroadcastTo",Mr="OneHot",Fr="Identity",Ir="Tile",Nr="PadV2",Rr="FromPixels",Pr="MaxPoolWithArgmax",Br=Mn({add_:function(e,t){var n,r=xn(e,"a","add"),i=xn(t,"b","add");n=Ne(r,i),r=n[0],i=n[1];var a={a:r,b:i};return We.runKernelFunc((function(e,t){var n=e.add(r,i);return t([r,i]),n}),a,null,kr)}});function Lr(e,t){for(var n=e.length,r=[],i=0;i<n;i++){var a=n-1-i,o=e[a]||1;(t[t.length-1-i]||1)>1&&1===o&&r.unshift(a)}return r}function zr(e,t){for(var n=[],r=0;r<t.length;r++){var i=e[e.length-r-1],a=t.length-r-1,o=t[a];(null==i||1===i&&o>1)&&n.unshift(a)}return n}function Ur(e,t){for(var n=[],r=Math.max(e.length,t.length),i=0;i<r;i++){var a=e[e.length-i-1];null==a&&(a=1);var o=t[t.length-i-1];if(null==o&&(o=1),1===a)n.unshift(o);else if(1===o)n.unshift(a);else{if(a!==o)throw Error("Operands could not be broadcast together with shapes "+e+" and "+t+".");n.unshift(a)}}return n}var Wr=Mn({abs_:function(e){var t=xn(e,"x","abs");return"complex64"===t.dtype?We.runKernelFunc((function(e){return e.complexAbs(t)}),{$x:t}):We.runKernelFunc((function(e,n){var r=e.abs(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().step(-1))}}}),"Abs")}}),Vr=Mn({acos_:function(e){var t=xn(e,"x","acos");return We.runKernelFunc((function(e,n){var r=e.acos(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(Bn(1).sub(n.toFloat().square()).sqrt()).neg()}}}))}}),Gr=Mn({acosh_:function(e){var t=xn(e,"x","acosh");return We.runKernelFunc((function(e,n){var r=e.acosh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(n.toFloat().square().sub(1).sqrt())}}}))}}),qr=Mn({asin_:function(e){var t=xn(e,"x","asin");return We.runKernelFunc((function(e,n){var r=e.asin(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(Bn(1).sub(n.toFloat().square()).sqrt())}}}))}}),Hr=Mn({asinh_:function(e){var t=xn(e,"x","asinh");return We.runKernelFunc((function(e,n){var r=e.asinh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(Bn(1).add(n.toFloat().square()).sqrt())}}}))}}),Xr=Mn({atan_:function(e){var t=xn(e,"x","atan");return We.runKernelFunc((function(e,n){var r=e.atan(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().square().add(1))}}}))}}),Kr=Mn({atanh_:function(e){var t=xn(e,"x","atanh");return We.runKernelFunc((function(e,n){var r=e.atanh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(Bn(1).sub(n.toFloat().square()))}}}))}}),Yr=Mn({ceil_:function(e){var t=xn(e,"x","ceil");return We.runKernelFunc((function(e){return e.ceil(t)}),{$x:t},(function(e){return{$x:function(){return Zn(e)}}}))}}),$r=Mn({clipByValue_:function(e,t,n){var r=xn(e,"x","clipByValue");A(t<=n,(function(){return"Error in clip: min ("+t+") must be less than or equal to max ("+n+")."}));var i=[r],a={min:t,max:n};return We.runKernelFunc((function(e,i){var a=e.clip(r,t,n);return i([r]),a}),{x:r},(function(e,r){var i=r[0];return{x:function(){return e.where(i.greaterEqual(t).logicalAnd(i.lessEqual(n)),Zn(e))}}}),"ClipByValue",a,i)}}),Jr=Mn({cos_:function(e){var t=xn(e,"x","cos"),n=[t];return We.runKernelFunc((function(e,n){var r=e.cos(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return n.toFloat().sin().neg().mul(e)}}}),"Cos",{},n)}}),Zr=Mn({cosh_:function(e){var t=xn(e,"x","cosh");return We.runKernelFunc((function(e,n){var r=e.cosh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return n.toFloat().sinh().mulStrict(e)}}}))}}),Qr=Mn({erf_:function(e){var t=xn(e,"x","erf");return A("int32"===t.dtype||"float32"===t.dtype,(function(){return"Input dtype must be `int32` or `float32`."})),"int32"===t.dtype&&(t=t.toFloat()),We.runKernelFunc((function(e,n){var r=e.erf(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}}))}}),ei=Mn({exp_:function(e){var t=xn(e,"x","exp");return We.runKernelFunc((function(e,n){var r=e.exp(t);return n([r]),r}),{x:t},(function(e,t){return{x:function(){return e.mulStrict(t[0])}}}),"Exp",{},[],[!0])}}),ti=Mn({expm1_:function(e){var t=xn(e,"x","expm1");return We.runKernelFunc((function(e,n){var r=e.expm1(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.exp())}}}))}}),ni=Mn({floor_:function(e){var t=xn(e,"x","floor");return We.runKernelFunc((function(e){return e.floor(t)}),{$x:t},(function(e){return{$x:function(){return Zn(e)}}}))}}),ri=Mn({log_:function(e){var t=xn(e,"x","log"),n=[t];return We.runKernelFunc((function(e,n){var r=e.log(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.div(n.toFloat())}}}),"Log",{},n)}}),ii=Mn({log1p_:function(e){var t=xn(e,"x","log1p");return We.runKernelFunc((function(e,n){var r=e.log1p(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.add(1))}}}))}}),ai=Mn({logSigmoid_:function(e){var t=xn(e,"x","logSigmoid");return We.runKernelFunc((function(e,n){var r=e.softplus(t.neg()).neg();return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.neg().sigmoid())}}}))}}),oi=Mn({neg_:function(e){var t=xn(e,"x","neg"),n=[t];return We.runKernelFunc((function(e){return e.neg(t)}),{x:t},(function(e){return{x:function(){return e.neg()}}}),"Neg",{},n)}}),si=Mn({reciprocal_:function(e){var t=xn(e,"x","reciprocal");return We.runKernelFunc((function(e,n){var r=e.reciprocal(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.square().neg())}}}))}}),ui=Mn({round_:function(e){var t=xn(e,"x","round");return We.runKernelFunc((function(e){return e.round(t)}),{$x:t},(function(e){return{$x:function(){return Zn(e)}}}))}}),ci=Mn({rsqrt_:function(e){var t=xn(e,"x","rsqrt"),n=[t];return We.runKernelFunc((function(e,n){var r=e.rsqrt(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.div(n.pow(1.5).mul(2)).neg()}}}),"Rsqrt",{},n)}}),li=Mn({sigmoid_:function(e){var t=xn(e,"x","sigmoid");return We.runKernelFunc((function(e,n){var r=e.sigmoid(t);return n([r]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.mul(n.mul(Bn(1).sub(n)))}}}),"Sigmoid")}}),fi=Mn({sign_:function(e){var t=xn(e,"x","sign");return We.runKernelFunc((function(e){return e.sign(t)}),{$x:t},(function(e){return{$x:function(){return Zn(e)}}}))}}),di=Mn({isNaN_:function(e){var t=xn(e,"x","isNaN");return We.runKernelFunc((function(e){return e.isNaN(t)}),{$x:t},(function(e){return{$x:function(){return Zn(e)}}}))}}),hi=Mn({isInf_:function(e){var t=xn(e,"x","isInf");return We.runKernelFunc((function(e){return e.isInf(t)}),{$x:t},(function(e){return{$x:function(){return Zn(e)}}}))}}),pi=Mn({isFinite_:function(e){var t=xn(e,"x","isFinite");return We.runKernelFunc((function(e){return e.isFinite(t)}),{$x:t},(function(e){return{$x:function(){return Zn(e)}}}))}}),mi=Mn({sin_:function(e){var t=xn(e,"x","sin"),n=[t];return We.runKernelFunc((function(e,n){var r=e.sin(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return n.toFloat().cos().mul(e)}}}),"Sin",{},n)}}),vi=Mn({sinh_:function(e){var t=xn(e,"x","sinh");return We.runKernelFunc((function(e,n){var r=e.sinh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return n.toFloat().cosh().mulStrict(e)}}}))}}),gi=Mn({softplus_:function(e){var t=xn(e,"x","softplus");return We.runKernelFunc((function(e,n){var r=e.softplus(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.sigmoid())}}}))}}),yi=Mn({sqrt_:function(e){var t=xn(e,"x","sqrt");return We.runKernelFunc((function(e,n){var r=e.sqrt(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().sqrt().mul(2))}}}))}}),bi=Mn({step_:function(e,t){void 0===t&&(t=0);var n=xn(e,"x","step");return We.runKernelFunc((function(e){return e.step(n,t)}),{$x:n},(function(e){return{$x:function(){return Zn(e)}}}))}}),xi=Mn({tan_:function(e){var t=xn(e,"x","tan");return We.runKernelFunc((function(e,n){var r=e.tan(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.cos().square())}}}))}}),wi=Mn({tanh_:function(e){var t=xn(e,"x","tanh");return We.runKernelFunc((function(e,n){var r=e.tanh(t);return n([r]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return Bn(1).sub(n.square()).mulStrict(e)}}}),"Tanh",{},null,[!0])}}),_i=Mn({addStrict_:function(e,t){var n=xn(e,"a","addStrict"),r=xn(t,"b","addStrict");return O(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),ki=Mn({atan2_:function(e,t){var n,r=xn(e,"a","atan2"),i=xn(t,"b","atan2");n=Ne(r,i),r=n[0],i=n[1];var a=Ur(r.shape,i.shape);return We.runKernelFunc((function(e,t){var n=e.atan2(r,i);return t([r,i]),n}),{$a:r,$b:i},(function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=Br(n.square(),r.square()),i=e.mul(r.div(t)),o=zr(n.shape,a);return o.length>0&&(i=i.sum(o)),i.reshape(n.shape)},$b:function(){var t=Br(n.square(),r.square()),i=oi(e.mul(n.div(t))),o=zr(r.shape,a);return o.length>0&&(i=i.sum(o)),i.reshape(r.shape)}}}))}}),Ei=Mn({divStrict_:function(e,t){var n=xn(e,"a","div"),r=xn(t,"b","div");return O(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),Si=Mn({floorDiv_:function(e,t){var n,r=xn(e,"a","floorDiv"),i=xn(t,"b","floorDiv");n=Ne(r,i),r=n[0],i=n[1];var a=Ur(r.shape,i.shape);return We.runKernelFunc((function(e,t){var n=e.floorDiv(r,i);return t([r,i]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.div(r.toFloat()),i=zr(n.shape,a);return i.length>0?t.sum(i).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),i=zr(r.shape,a);i.length>0&&(t=t.sum(i).reshape(r.shape));var o=r.square();return t.div(o.toFloat()).neg()}}}),"FloorDiv")}}),Ci=Mn({maximum_:function(e,t){var n,r=xn(e,"a","maximum"),i=xn(t,"b","maximum");return n=Ne(r,i),r=n[0],i=n[1],"bool"===r.dtype&&(r=r.toInt(),i=i.toInt()),Ur(r.shape,i.shape),We.runKernelFunc((function(e,t){var n=e.maximum(r,i);return t([r,i]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1];return{a:function(){return e.mul(n.greaterEqual(r).toFloat())},b:function(){return e.mul(n.less(r).toFloat())}}}),"Maximum")}}),Ai=Mn({maximumStrict_:function(e,t){var n=xn(e,"a","maximumStrict"),r=xn(t,"b","maximumStrict");return O(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),Oi=Mn({minimum_:function(e,t){var n,r=xn(e,"a","minimum"),i=xn(t,"b","minimum");return n=Ne(r,i),r=n[0],i=n[1],"bool"===r.dtype&&(r=r.toInt(),i=i.toInt()),Ur(r.shape,i.shape),We.runKernelFunc((function(e,t){var n=e.minimum(r,i);return t([r,i]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1];return{a:function(){return e.mul(n.lessEqual(r).toFloat())},b:function(){return e.mul(n.greater(r).toFloat())}}}),"Minimum")}}),Di=Mn({minimumStrict_:function(e,t){var n=xn(e,"a","minimumStrict"),r=xn(t,"b","minimumStrict");return O(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),Ti=Mn({mod_:function(e,t){var n,r=xn(e,"a","mod"),i=xn(t,"b","mod");n=Ne(r,i),r=n[0],i=n[1];var a=Ur(r.shape,i.shape);return We.runKernelFunc((function(e,t){var n=e.mod(r,i);return t([r,i]),n}),{$a:r,$b:i},(function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=zr(n.shape,a);return t.length>0?e.sum(t).reshape(n.shape):e},$b:function(){var t=e.mul(n.div(r).floor().neg()),i=zr(r.shape,a);return i.length>0?t.sum(i).reshape(r.shape):t}}}))}}),ji=Mn({modStrict_:function(e,t){var n=xn(e,"a","modStrict"),r=xn(t,"b","modStrict");return O(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),Mi=Mn({mul_:function(e,t){var n,r=xn(e,"a","mul"),i=xn(t,"b","mul");n=Ne(r,i),r=n[0],i=n[1];var a=Ur(r.shape,i.shape);return We.runKernelFunc((function(e,t){var n=e.multiply(r,i);return t([r,i]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.mul(r.toFloat()),i=zr(n.shape,a);return i.length>0?t.sum(i).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),i=zr(r.shape,a);return i.length>0?t.sum(i).reshape(r.shape):t}}}),"Mul")}}),Fi=Mn({mulStrict_:function(e,t){var n=xn(e,"a","mul"),r=xn(t,"b","mul");return O(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),Ii=Mn({pow_:function(e,t){var n,r=xn(e,"base","pow"),i=xn(t,"exp","pow");n=Ne(r,i),r=n[0],i=n[1];var a=Ur(r.shape,i.shape),o=[r,i];return We.runKernelFunc((function(e,t){var n=e.pow(r,i);return t([r,i,n]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1],i=t[2];return{a:function(){var t=r.toFloat(),i=e.mul(t.mul(n.pow(t.sub(Bn(1))))),o=zr(n.shape,a);return o.length>0&&(i=i.sum(o)),i.reshape(n.shape)},b:function(){var t=n.greater(0),o=n.log().where(t,Zn(n)),s=e.mul(i.mul(o)),u=zr(r.shape,a);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)}}}),"Pow",{},o,[!0])}}),Ni=Mn({powStrict_:function(e,t){return O(e.shape,t.shape,"Error in powStrict: "),e.pow(t)}}),Ri=Mn({squaredDifferenceStrict_:function(e,t){var n=xn(e,"a","squaredDifferenceStrict"),r=xn(t,"b","squaredDifferenceStrict");return O(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),Pi=Mn({sub_:function(e,t){var n,r=xn(e,"a","sub"),i=xn(t,"b","sub");n=Ne(r,i),r=n[0],i=n[1];var a=Ur(r.shape,i.shape);return We.runKernelFunc((function(e){return e.subtract(r,i)}),{a:r,b:i},(function(e){return{a:function(){var t=e,n=zr(r.shape,a);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},b:function(){var t=e,n=zr(i.shape,a);return n.length>0&&(t=t.sum(n)),t.neg().reshape(i.shape)}}}),"Sub")}}),Bi=Mn({subStrict_:function(e,t){var n=xn(e,"a","subStrict"),r=xn(t,"b","subStrict");return O(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}}),Li=Mn({div_:function(e,t){var n,r=xn(e,"a","div"),i=xn(t,"b","div");if(n=Ne(r,i),r=n[0],i=n[1],"int32"===r.dtype&&"int32"===i.dtype)return Si(r,i);var a={a:r,b:i};return We.runKernelFunc((function(e,t){var n=e.realDivide(r,i);return t([r,i]),n}),a,null,Sr,{})}});function zi(e,t){if(e.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.shape[t.rank-1]>e.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+t.shape[t.rank-1]+" vs. "+e.rank);if(0===e.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+e.shape+".");for(var n=t.shape,r=n[n.length-1],i=1,a=0;a<n.length-1;++a)i*=n[a];var o=e.shape,s=n.slice();s.pop();var u=1;for(a=r;a<e.rank;++a)u*=o[a],s.push(o[a]);var c=te(e.shape).map((function(e){return e/u})).concat([1]).slice(0,r);return[s,i,u,c]}var Ui=Object.freeze({prepareAndValidate:zi}),Wi=30;function Vi(e){return e<=Wi?e:ee(e,Math.floor(Math.sqrt(e)))}function Gi(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,i=t.rank>1?t.rank-1:1,a="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+t.shape+", shape: "+e+", sliceDim: "+r+", and batchDim: "+i+".";if(n.rank<i)throw new Error(a+" update.rank < "+i+". ");if(e.length<r+(n.rank-i))throw new Error(a+" Output shape length < "+(r+(n.rank-i)));if(n.rank!==i+e.length-r)throw new Error(a+" update.rank != "+(i+e.length-r));for(var o=0;o<i;++o)if(n.shape[o]!==t.shape[o])throw new Error(a+" updates.shape["+o+"] ("+n.shape[o]+") != indices.shape["+o+"] ("+t.shape[o]+").");for(o=0;o<n.rank-i;++o)if(n.shape[o+i]!==e[o+r])throw new Error(a+" updates.shape["+(o+i)+"] ("+n.shape[o+i]+") != shape["+(o+i)+"] ("+e[o+i]+")")}function qi(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+e.rank+".");if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(0===e.size)throw new Error("Updates specified for empty output. updates shape: "+e.shape)}Gi(n,t,e)}function Hi(e,t,n){for(var r=t.shape.length,i=r>1?t.shape[r-1]:1,a=n.length,o=1,s=i;s<a;++s)o*=n[s];var u=i<1?1:i;return{sliceRank:i,numUpdates:j(t.shape)/u,sliceSize:o,strides:te(n.slice(0,i)).concat([1]),outputSize:j(n)}}var Xi=Object.freeze({validateUpdateShape:Gi,validateInput:qi,calculateShapes:Hi});function Ki(e,t,n){A(e.rank===t.length,(function(){return"Error in slice"+e.rank+"D: Length of begin "+t+" must match the rank of the array ("+e.rank+")."})),A(e.rank===n.length,(function(){return"Error in slice"+e.rank+"D: Length of size "+n+" must match the rank of the array ("+e.rank+")."}));for(var r=function(r){A(t[r]+n[r]<=e.shape[r],(function(){return"Error in slice"+e.rank+"D: begin["+r+"] + size["+r+"] ("+(t[r]+n[r])+") would overflow input.shape["+r+"] ("+e.shape[r]+")"}))},i=0;i<e.rank;++i)r(i)}function Yi(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t}function $i(e,t,n){for(var r=[],i=0;i<e.length;i++)r[i]=Math.ceil((t[i]-e[i])/n[i]);return r}function Ji(e,t,n,r,i){var a=t[i],o=n[i]||1;(e&1<<i||null==a)&&(a=o>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[i];return a<0&&(a+=s),E(0,a,s-1)}function Zi(e,t,n,r,i){var a=t[i],o=n[i]||1;(e&1<<i||null==a)&&(a=o>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[i];return a<0&&(a+=s),o>0?E(0,a,s):E(-1,a,s-1)}function Qi(e,t,n){for(var r=n.length,i=0;i<n.length;i++)if(n[i]>1){r=i;break}for(i=r+1;i<n.length;i++)if(t[i]>0||n[i]!==e[i])return!1;return!0}function ea(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}var ta=Object.freeze({assertParamsValid:Ki,maskToAxes:Yi,computeOutShape:$i,startForAxis:Ji,stopForAxis:Zi,isSliceContinous:Qi,computeFlatOffset:ea});function na(e){return A(Q(e),(function(){return"The f passed in grad(f) must be a function"})),function(t,n){var r=xn(t,"x","tf.grad",null),i=null!=n?xn(n,"dy","tf.grad"):null;return We.tidy((function(){var t=We.gradients((function(){return e(r)}),[r],i),n=t.value,a=t.grads;return null!=i&&O(n.shape,i.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),ua(a),a[0]}))}}function ra(e){return A(Q(e),(function(){return"The f passed in grads(f) must be a function"})),function(t,n){A(Array.isArray(t),(function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"}));var r=wn(t,"args","tf.grads",null),i=null!=n?xn(n,"dy","tf.grads"):null;return We.tidy((function(){var t=We.gradients((function(){return e.apply(void 0,r)}),r,i),n=t.value,a=t.grads;return null!=i&&O(n.shape,i.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),ua(a),a}))}}function ia(e){return A(Q(e),(function(){return"The f passed in valueAndGrad(f) must be a function"})),function(t,n){A(t instanceof Se,(function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"})),A(null==n||n instanceof Se,(function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"}));var r=We.gradients((function(){return e(t)}),[t],n),i=r.grads,a=r.value;return ua(i),{grad:i[0],value:a}}}function aa(e){return A(Q(e),(function(){return"The f passed in valueAndGrads(f) must be a function"})),function(t,n){A(Array.isArray(t)&&t.every((function(e){return e instanceof Se})),(function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"})),A(null==n||n instanceof Se,(function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"}));var r=We.gradients((function(){return e.apply(void 0,t)}),t,n);return null!=n&&O(r.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),ua(r.grads),r}}function oa(e,t){A(Q(e),(function(){return"The f passed in variableGrads(f) must be a function"})),A(null==t||Array.isArray(t)&&t.every((function(e){return e instanceof je})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var n=null!=t;if(!n)for(var r in t=[],We.registeredVariables)t.push(We.registeredVariables[r]);var i=n?t.filter((function(e){return!e.trainable})):null,a=t.length;A((t=t.filter((function(e){return e.trainable}))).length>0,(function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+a+" variables is trainable."}));var o=We.gradients(e,t,null,!0),s=o.value,u=o.grads;A(u.some((function(e){return null!=e})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),A(0===s.rank,(function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"}));var c={};return t.forEach((function(e,t){null!=u[t]&&(c[e.name]=u[t])})),null!=i&&i.forEach((function(e){return c[e.name]=null})),{value:s,grads:c}}function sa(e){return We.customGrad(e)}function ua(e){if(e.filter((function(e){return null==e})).length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}var ca=Mn({softmax_:function(e,t){void 0===t&&(t=-1);var n=xn(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+t);return We.runKernelFunc((function(e,r){var i=e.softmax(n,t);return r([i]),i}),{logits:n},(function(e,n){var r=n[0],i=e.mul(r);return{logits:function(){return i.sub(i.sum([t],!0).mul(r))}}}),"Softmax",{dim:t},[],[!0])}}),la=Mn({logSoftmax_:function(e,t){void 0===t&&(t=-1);var n=xn(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+t);return sa((function(e,n){var r=e.max(t,!0),i=e.sub(r),a=i.toFloat().sub(i.exp().sum(t,!0).log());return n([a]),{value:a,gradFunc:function(e,n){var r=n[0].exp();return e.sub(e.sum(t,!0).mul(r))}}}))(n)}}),fa=Mn({transpose_:function(e,t){var n=xn(e,"x","transpose");if(null==t&&(t=n.shape.map((function(e,t){return t})).reverse()),A(n.rank===t.length,(function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+t+"."})),t.forEach((function(e){A(e>=0&&e<n.rank,(function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+t}))})),n.rank<=1)return n.clone();var r={perm:t};return We.runKernelFunc((function(e){return e.transpose(n,t)}),{x:n},null,"Transpose",r)}}),da=function(){function e(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return e.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},e.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},e.prototype.has=function(e){return this.data.has(e)},e.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},e.prototype.numDataIds=function(){return this.dataIdsCount},e}(),ha=function(){function e(){}return e.prototype.time=function(e){return pa("time")},e.prototype.read=function(e){return pa("read")},e.prototype.readSync=function(e){return pa("readSync")},e.prototype.numDataIds=function(){return pa("numDataIds")},e.prototype.disposeData=function(e){return pa("disposeData")},e.prototype.write=function(e,t,n){return pa("write")},e.prototype.move=function(e,t,n,r){return pa("move")},e.prototype.memory=function(){return pa("memory")},e.prototype.floatPrecision=function(){return pa("floatPrecision")},e.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},e.prototype.batchMatMul=function(e,t,n,r){return pa("batchMatMul")},e.prototype.fusedBatchMatMul=function(e){return e.a,e.b,e.transposeA,e.transposeB,e.bias,e.activation,e.preluActivationWeights,pa("fusedBatchMatMul")},e.prototype.slice=function(e,t,n){return pa("slice")},e.prototype.stridedSlice=function(e,t,n,r){return pa("stridedSlice")},e.prototype.unstack=function(e,t){return pa("unstack")},e.prototype.reverse=function(e,t){return pa("reverse")},e.prototype.concat=function(e,t){return pa("concat")},e.prototype.neg=function(e){return pa("neg")},e.prototype.add=function(e,t){return pa("add")},e.prototype.addN=function(e){return pa("addN")},e.prototype.subtract=function(e,t){return pa("subtract")},e.prototype.multiply=function(e,t){return pa("multiply")},e.prototype.realDivide=function(e,t){return pa("realDivide")},e.prototype.floorDiv=function(e,t){return pa("floorDiv")},e.prototype.sum=function(e,t){return pa("sum")},e.prototype.prod=function(e,t){return pa("prod")},e.prototype.unsortedSegmentSum=function(e,t,n){return pa("unsortedSegmentSum")},e.prototype.argMin=function(e,t){return pa("argMin")},e.prototype.argMax=function(e,t){return pa("argMax")},e.prototype.equal=function(e,t){return pa("equal")},e.prototype.notEqual=function(e,t){return pa("notEqual")},e.prototype.less=function(e,t){return pa("less")},e.prototype.lessEqual=function(e,t){return pa("lessEqual")},e.prototype.greater=function(e,t){return pa("greater")},e.prototype.greaterEqual=function(e,t){return pa("greaterEqual")},e.prototype.logicalNot=function(e){return pa("logicalNot")},e.prototype.logicalAnd=function(e,t){return pa("logicalAnd")},e.prototype.logicalOr=function(e,t){return pa("logicalOr")},e.prototype.where=function(e){return pa("where")},e.prototype.select=function(e,t,n){return pa("select")},e.prototype.topk=function(e,t,n){return pa("topk")},e.prototype.min=function(e,t){return pa("min")},e.prototype.minimum=function(e,t){return pa("minimum")},e.prototype.mod=function(e,t){return pa("mod")},e.prototype.max=function(e,t){return pa("max")},e.prototype.maximum=function(e,t){return pa("maximum")},e.prototype.all=function(e,t){return pa("all")},e.prototype.any=function(e,t){return pa("any")},e.prototype.squaredDifference=function(e,t){return pa("squaredDifference")},e.prototype.ceil=function(e){return pa("ceil")},e.prototype.floor=function(e){return pa("floor")},e.prototype.round=function(e){return pa("round")},e.prototype.sign=function(e){return pa("sign")},e.prototype.isNaN=function(e){return pa("isNaN")},e.prototype.isInf=function(e){return pa("isInf")},e.prototype.isFinite=function(e){return pa("isFinite")},e.prototype.pow=function(e,t){return pa("pow")},e.prototype.exp=function(e){return pa("exp")},e.prototype.expm1=function(e){return pa("expm1")},e.prototype.softmax=function(e,t){return pa("softmax")},e.prototype.log=function(e){return pa("log")},e.prototype.log1p=function(e){return pa("log1p")},e.prototype.sqrt=function(e){return pa("sqrt")},e.prototype.rsqrt=function(e){return pa("rsqrt")},e.prototype.square=function(e){return pa("square")},e.prototype.reciprocal=function(e){return pa("reciprocal")},e.prototype.relu=function(e){return pa("relu")},e.prototype.relu6=function(e){return pa("relu6")},e.prototype.prelu=function(e,t){return pa("prelu")},e.prototype.elu=function(e){return pa("elu")},e.prototype.eluDer=function(e,t){return pa("eluDer")},e.prototype.selu=function(e){return pa("selu")},e.prototype.int=function(e){return pa("int")},e.prototype.clip=function(e,t,n){return pa("clip")},e.prototype.abs=function(e){return pa("abs")},e.prototype.complexAbs=function(e){return pa("complexAbs")},e.prototype.sigmoid=function(e){return pa("sigmoid")},e.prototype.softplus=function(e){return pa("softplus")},e.prototype.sin=function(e){return pa("sin")},e.prototype.cos=function(e){return pa("cos")},e.prototype.tan=function(e){return pa("tan")},e.prototype.asin=function(e){return pa("asin")},e.prototype.acos=function(e){return pa("acos")},e.prototype.atan=function(e){return pa("atan")},e.prototype.atan2=function(e,t){return pa("atan2")},e.prototype.sinh=function(e){return pa("sinh")},e.prototype.cosh=function(e){return pa("cosh")},e.prototype.tanh=function(e){return pa("tanh")},e.prototype.asinh=function(e){return pa("asinh")},e.prototype.acosh=function(e){return pa("acosh")},e.prototype.atanh=function(e){return pa("atanh")},e.prototype.erf=function(e){return pa("erf")},e.prototype.step=function(e,t){return pa("step")},e.prototype.fusedConv2d=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,pa("fusedConv2d")},e.prototype.conv2d=function(e,t,n){return pa("conv2d")},e.prototype.conv2dDerInput=function(e,t,n){return pa("conv2dDerInput")},e.prototype.conv2dDerFilter=function(e,t,n){return pa("conv2dDerFilter")},e.prototype.fusedDepthwiseConv2D=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,pa("fusedDepthwiseConv2D")},e.prototype.depthwiseConv2D=function(e,t,n){return pa("depthwiseConv2D")},e.prototype.depthwiseConv2DDerInput=function(e,t,n){return pa("depthwiseConv2DDerInput")},e.prototype.depthwiseConv2DDerFilter=function(e,t,n){return pa("depthwiseConv2DDerFilter")},e.prototype.conv3d=function(e,t,n){return pa("conv3d")},e.prototype.conv3dDerInput=function(e,t,n){return pa("conv3dDerInput")},e.prototype.conv3dDerFilter=function(e,t,n){return pa("conv3dDerFilter")},e.prototype.maxPool=function(e,t){return pa("maxPool")},e.prototype.maxPoolBackprop=function(e,t,n,r){return pa("maxPoolBackprop")},e.prototype.avgPool=function(e,t){return pa("avgPool")},e.prototype.avgPoolBackprop=function(e,t,n){return pa("avgPoolBackprop")},e.prototype.avgPool3d=function(e,t){return pa("avgPool3d")},e.prototype.avgPool3dBackprop=function(e,t,n){return pa("avgPool3dBackprop")},e.prototype.maxPool3d=function(e,t){return pa("maxPool3d")},e.prototype.maxPool3dBackprop=function(e,t,n,r){return pa("maxPool3dBackprop")},e.prototype.reshape=function(e,t){return pa("reshape")},e.prototype.cast=function(e,t){return pa("cast")},e.prototype.tile=function(e,t){return pa("tile")},e.prototype.pad=function(e,t,n){return pa("pad")},e.prototype.transpose=function(e,t){return pa("transpose")},e.prototype.gather=function(e,t,n){return pa("gather")},e.prototype.gatherND=function(e,t){return pa("gatherND")},e.prototype.scatterND=function(e,t,n){return pa("scatterND")},e.prototype.batchToSpaceND=function(e,t,n){return pa("batchToSpaceND")},e.prototype.spaceToBatchND=function(e,t,n){return pa("spaceToBatchND")},e.prototype.resizeBilinear=function(e,t,n,r){return pa("resizeBilinear")},e.prototype.resizeBilinearBackprop=function(e,t,n){return pa("resizeBilinearBackprop")},e.prototype.resizeNearestNeighbor=function(e,t,n,r){return pa("resizeNearestNeighbor")},e.prototype.resizeNearestNeighborBackprop=function(e,t,n){return pa("resizeNearestNeighborBackprop")},e.prototype.batchNormalization=function(e,t,n,r,i,a){return pa("batchNormalization")},e.prototype.localResponseNormalization4D=function(e,t,n,r,i){return pa("localResponseNormalization4D")},e.prototype.LRNGrad=function(e,t,n,r,i,a,o){return pa("LRNGrad")},e.prototype.multinomial=function(e,t,n,r){return pa("multinomial")},e.prototype.oneHot=function(e,t,n,r){return pa("oneHot")},e.prototype.cumsum=function(e,t,n,r){return pa("cumsum")},e.prototype.nonMaxSuppression=function(e,t,n,r,i){return pa("nonMaxSuppression")},e.prototype.fft=function(e){return pa("fft")},e.prototype.ifft=function(e){return pa("ifft")},e.prototype.complex=function(e,t){return pa("complex")},e.prototype.real=function(e){return pa("real")},e.prototype.imag=function(e){return pa("imag")},e.prototype.cropAndResize=function(e,t,n,r,i,a){return pa("cropAndResize")},e.prototype.depthToSpace=function(e,t,n){return pa("depthToSpace")},e.prototype.split=function(e,t,n){return pa("split")},e.prototype.sparseToDense=function(e,t,n,r){return pa("sparseToDense")},e.prototype.diag=function(e){return pa("diag")},e.prototype.fill=function(e,t,n){return pa("fill")},e.prototype.onesLike=function(e){return pa("onesLike")},e.prototype.zerosLike=function(e){return pa("zerosLike")},e.prototype.linspace=function(e,t,n){return pa("linspace")},e.prototype.dispose=function(){return pa("dispose")},e}();function pa(e){throw new Error("'"+e+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function ma(e,t,n,r,i,a,o){void 0===o&&(o="channelsLast");var s,u=xa(t),c=u[0],l=u[1];if("channelsLast"===o)s=[c,l,e[3],e[3]];else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat "+o);s=[c,l,e[1],e[1]]}return ga(e,s,n,r,i,a,!1,o)}function va(e,t,n,r,i,a,o){void 0===o&&(o="NDHWC");var s,u,c=wa(t),l=c[0],f=c[1],d=c[2];if("NDHWC"===o)u="channelsLast",s=[l,f,d,e[4],e[4]];else{if("NCDHW"!==o)throw new Error("Unknown dataFormat "+o);u="channelsFirst",s=[l,f,d,e[1],e[1]]}return ya(e,s,n,r,i,!1,u,a)}function ga(e,t,n,r,i,a,o,s){void 0===o&&(o=!1),void 0===s&&(s="channelsLast");var u=[-1,-1,-1,-1],c=u[0],l=u[1],f=u[2],d=u[3];if("channelsLast"===s)c=e[0],l=e[1],f=e[2],d=e[3];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);c=e[0],d=e[1],l=e[2],f=e[3]}var h,p=t[0],m=t[1],v=t[3],g=xa(n),y=g[0],b=g[1],x=xa(r),w=x[0],_=x[1],k=_a(p,w),E=_a(m,_),S=function(e,t,n,r,i,a,o,s){var u,c,l;if("number"==typeof e){u={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var f=function(e,t,n,r,i){null==r&&(r=ba(e,t,n));var a=e[1],o=ka((e[0]-t+2*r)/n+1,i);A(F(o),(function(){return"The output # of rows ("+o+") must be an integer. Change the stride and/or zero pad parameters"}));var s=ka((a-t+2*r)/n+1,i);return A(F(s),(function(){return"The output # of columns ("+s+") must be an integer. Change the stride and/or zero pad parameters"})),[o,s]}([t,n],a,r,e,s);c=f[0],l=f[1]}else if("same"===e){c=Math.ceil(t/r),l=Math.ceil(n/i);var d=Math.max(0,(c-1)*r+a-t),h=Math.max(0,(l-1)*i+o-n),p=Math.floor(d/2),m=d-p,v=Math.floor(h/2);u={top:p,bottom:m,left:v,right:h-v,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);u={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((t-a+1)/r),l=Math.ceil((n-o+1)/i)}return{padInfo:u,outHeight:c,outWidth:l}}(i,l,f,y,b,k,E,a),C=S.padInfo,O=S.outHeight,D=S.outWidth,T=o?v*d:v;return"channelsFirst"===s?h=[c,T,O,D]:"channelsLast"===s&&(h=[c,O,D,T]),{batchSize:c,dataFormat:s,inHeight:l,inWidth:f,inChannels:d,outHeight:O,outWidth:D,outChannels:T,padInfo:C,strideHeight:y,strideWidth:b,filterHeight:p,filterWidth:m,effectiveFilterHeight:k,effectiveFilterWidth:E,dilationHeight:w,dilationWidth:_,inShape:e,outShape:h,filterShape:t}}function ya(e,t,n,r,i,a,o,s){void 0===a&&(a=!1),void 0===o&&(o="channelsLast");var u=[-1,-1,-1,-1,-1],c=u[0],l=u[1],f=u[2],d=u[3],h=u[4];if("channelsLast"===o)c=e[0],l=e[1],f=e[2],d=e[3],h=e[4];else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat "+o);c=e[0],h=e[1],l=e[2],f=e[3],d=e[4]}var p,m=t[0],v=t[1],g=t[2],y=t[4],b=wa(n),x=b[0],w=b[1],_=b[2],k=wa(r),E=k[0],S=k[1],C=k[2],O=_a(m,E),D=_a(v,S),T=_a(g,C),j=function(e,t,n,r,i,a,o,s,u,c,l){var f,d,h,p;if("number"==typeof e){f={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var m=function(e,t,n,r,i,a){null==i&&(i=ba(e,t,r));var o=e[1],s=e[2],u=ka((e[0]-t+2*i)/r+1,a);A(F(u),(function(){return"The output # of depths ("+u+") must be an integer. Change the stride and/or zero pad parameters"}));var c=ka((o-t+2*i)/r+1,a);A(F(c),(function(){return"The output # of rows ("+c+") must be an integer. Change the stride and/or zero pad parameters"}));var l=ka((s-t+2*i)/r+1,a);return A(F(l),(function(){return"The output # of columns ("+l+") must be an integer. Change the stride and/or zero pad parameters"})),[u,c,l,1]}([t,n,r,1],s,0,i,e,l);d=m[0],h=m[1],p=m[2]}else if("same"===e){var v=((d=Math.ceil(t/i))-1)*i+s-t,g=((h=Math.ceil(n/a))-1)*a+u-n,y=((p=Math.ceil(r/o))-1)*o+c-r,b=Math.floor(v/2),x=v-b,w=Math.floor(g/2),_=g-w,k=Math.floor(y/2);f={top:w,bottom:_,left:k,right:y-k,front:b,back:x,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);f={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},d=Math.ceil((t-s+1)/i),h=Math.ceil((n-u+1)/a),p=Math.ceil((r-c+1)/o)}return{padInfo:f,outDepth:d,outHeight:h,outWidth:p}}(i,l,f,d,x,w,_,O,D,T,s),M=j.padInfo,I=j.outDepth,N=j.outHeight,R=j.outWidth,P=a?y*h:y;return"channelsFirst"===o?p=[c,P,I,N,R]:"channelsLast"===o&&(p=[c,I,N,R,P]),{batchSize:c,dataFormat:o,inDepth:l,inHeight:f,inWidth:d,inChannels:h,outDepth:I,outHeight:N,outWidth:R,outChannels:P,padInfo:M,strideDepth:x,strideHeight:w,strideWidth:_,filterDepth:m,filterHeight:v,filterWidth:g,effectiveFilterDepth:O,effectiveFilterHeight:D,effectiveFilterWidth:T,dilationDepth:E,dilationHeight:S,dilationWidth:C,inShape:e,outShape:p,filterShape:t}}function ba(e,t,n,r){void 0===r&&(r=1);var i=_a(t,r);return Math.floor((e[0]*(n-1)-n+i)/2)}function xa(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function wa(e){return"number"==typeof e?[e,e,e]:e}function _a(e,t){return t<=1?e:e+(e-1)*(t-1)}function ka(e,t){if(!t)return e;switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode "+t)}}function Ea(e){var t=xa(e),n=t[0],r=t[1],i=t[2];return 1===n&&1===r&&1===i}function Sa(e,t){return Ea(e)||Ea(t)}function Ca(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat "+e)}function Aa(e,t,n){if("complex64"===t){if("complex64"===e.dtype)return e.clone();var r=Xn(e.shape),i=e.toFloat(),a=n.complex(i,r);return r.dispose(),i.dispose(),a}if(!q(e.dtype,t))return We.makeTensorFromDataId(e.dataId,e.shape,t);if("complex64"===e.dtype){var o=n.real(e);return a=o.cast(t),o.dispose(),a}if("int32"===t)return n.int(e);if("bool"===t){var s=Bn(0,e.dtype);return a=n.notEqual(e,s),s.dispose(),a}throw new Error("Error in Cast: failed to cast "+e.dtype+" to "+t)}function Oa(e,t){return We.makeTensorFromDataId(e.dataId,t,e.dtype)}function Da(e,t,n){var r=(t-e)/(n-1),i=ae(n,"float32");i[0]=e;for(var a=1;a<i.length;a++)i[a]=i[a-1]+r;return Ln(i,"float32")}var Ta=Object.freeze({castTensor:Aa,reshapeTensor:Oa,linspaceImpl:Da,upcastType:Fe,axesAreInnerMostDims:_n,combineLocations:kn,computeOutAndReduceShapes:En,expandShapeToKeepDim:Sn,assertAxesAreInnerMostDims:Cn,getAxesPermutation:An,getUndoAxesPermutation:On,getInnerMostAxes:Dn,getBroadcastDims:Lr,getReductionAxes:zr,assertAndGetBroadcastShape:Ur,assertParamsConsistent:Tn,computeOutShape:jn,computePool2DInfo:ma,computePool3DInfo:va,computeConv2DInfo:ga,computeConv3DInfo:ya,computeDefaultPad:ba,tupleValuesAreOne:Ea,eitherStridesOrDilationsAreOne:Sa,convertConv2DDataFormat:Ca,PARALLELIZE_THRESHOLD:Wi,computeOptimalWindowSize:Vi});function ja(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+e.length+", imag: "+t.length+".");for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function Ma(e,t){return{real:e[2*t],imag:e[2*t+1]}}function Fa(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function Ia(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}function Na(e,t,n){var r=function(e,t,n){return function(e,t,n){for(var r=0,i=e.length,a=0,o=!1;r<i;){var s=n(t,e[a=r+(i-r>>>1)]);s>0?r=a+1:(i=a,o=!s)}return o?r:-r-1}(e,t,n||Ra)}(e,t,n),i=r<0?-(r+1):r;e.splice(i,0,t)}function Ra(e,t){return e>t?1:e<t?-1:0}function Pa(e,t,n,r,i){return La(e,t,n,r,i,0).selectedIndices}function Ba(e,t,n,r,i,a){var o=La(e,t,n,r,i,a,!0);return o.numValidOutputs.dispose(),{selectedIndices:o.selectedIndices,selectedScores:o.selectedScores}}function La(e,t,n,r,i,a,o,s){void 0===o&&(o=!1),void 0===s&&(s=!1);for(var u=Array.from(t).map((function(e,t){return{score:e,boxIndex:t,suppressBeginIndex:0}})).filter((function(e){return e.score>i})).sort(Wa),c=a>0?-.5/a:0,l=[],f=[];l.length<n&&u.length>0;){var d=u.pop(),h=d.score,p=d.boxIndex,m=d.suppressBeginIndex;if(h<i)break;for(var v=!1,g=l.length-1;g>=m;--g){var y=za(e,p,l[g]);if(y>=r){v=!0;break}if(d.score=d.score*Ua(r,c,y),d.score<=i)break}d.suppressBeginIndex=l.length,v||(d.score===h?(l.push(p),f.push(d.score)):d.score>i&&Na(u,d,Wa))}var b=l.length;return s&&(l.fill(0,b),f.fill(0,b)),{selectedIndices:Ln(l,"int32"),selectedScores:Ln(f,"float32"),numValidOutputs:Bn(b,"int32")}}function za(e,t,n){var r=e.subarray(4*t,4*t+4),i=e.subarray(4*n,4*n+4),a=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(i[0],i[2]),l=Math.min(i[1],i[3]),f=Math.max(i[0],i[2]),d=Math.max(i[1],i[3]),h=(s-a)*(u-o),p=(f-c)*(d-l);if(h<=0||p<=0)return 0;var m=Math.max(a,c),v=Math.max(o,l),g=Math.min(s,f),y=Math.min(u,d),b=Math.max(g-m,0)*Math.max(y-v,0);return b/(h+p-b)}function Ua(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function Wa(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}function Va(e,t,n){var r=new Array(e.rank).fill(0),i=e.shape.slice();return t.map((function(t){i[n]=t;var a=e.slice(r,i);return r[n]+=t,a}))}function Ga(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];var i=ar(n,e.dtype);for(r=0;r<i.values.length;++r){for(var a=i.indexToLoc(r),o=new Array(e.rank),s=0;s<o.length;s++)o[s]=a[s]%e.shape[s];var u=e.locToIndex(o);i.values[r]=e.values[u]}return i.toTensor()}function qa(e,t,n,r,i){for(var a=t[t.length-1],o=[e.length/a,a],s=o[0],u=o[1],c=U(n,s*r),l=U("int32",s*r),f=0;f<s;f++){for(var d=f*u,h=e.subarray(d,d+u),p=[],m=0;m<h.length;m++)p.push({value:h[m],index:m});p.sort((function(e,t){return t.value-e.value}));var v=f*r,g=c.subarray(v,v+r),y=l.subarray(v,v+r);for(m=0;m<r;m++)g[m]=p[m].value,y[m]=p[m].index}var b=t.slice();return b[b.length-1]=r,[Rn(c,b,n),Rn(l,b,"int32")]}function Ha(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);var i=ar(e,"int32"),a=ar([n.length,e.length],"int32");for(r=0;r<n.length;r++){var o=i.indexToLoc(n[r]),s=r*e.length;a.values.set(o,s)}return a.toTensor()}function Xa(e,t){return["x","y","z","w","u","v"].slice(0,t).map((function(t){return e+"."+t}))}function Ka(e,t){return 1===t?[e]:Xa(e,t)}function Ya(){var e,t,n,r,i,a,o,s,u,c;return 2===f().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",i="texture",a="outputColor",o="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",i="texture2D",a="gl_FragColor",o="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:i,output:a,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function $a(e,t,n){void 0===n&&(n="index");var r=te(t);return r.map((function(t,i){return"int "+e[i]+" = "+n+" / "+t+"; "+(i===r.length-1?"int "+e[i+1]+" = "+n+" - "+e[i]+" * "+t:"index -= "+e[i]+" * "+t)+";"})).join("")}function Ja(e){var t=te(e).map((function(e){return e.toString()}));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+t[0]+" + coords.y * "+t[1]+" + coords.z;\n  }\n"}var Za="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";function Qa(e,t,n,r){var i=[];e.forEach((function(e){var t=j(e.shapeInfo.logicalShape);e.shapeInfo.isUniform?i.push("uniform float "+e.name+(t>1?"["+t+"]":"")+";"):(i.push("uniform sampler2D "+e.name+";"),i.push("uniform int offset"+e.name+";"))}));var a,o,s=i.join("\n"),u=e.map((function(e){return function(e,t,n){void 0===n&&(n=!1);var r="";r+=n?function e(t){var n;switch(t.shapeInfo.logicalShape.length){case 0:return"\n    vec4 get"+(n=t.name).charAt(0).toUpperCase()+n.slice(1)+"() {\n      return "+Ya().texture2D+"("+n+", halfCR);\n    }\n  ";case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e.shapeInfo.texShape,i=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],a=Ya();return"\n    vec4 "+n+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+i[0]+", "+i[1]+", index);\n      return "+a.texture2D+"("+t+", uv);\n    }\n  "}(t);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e.shapeInfo.texShape,a=i[0],o=i[1],s=Ya();if(null!=i&&M(t,i))return"\n      vec4 "+r+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+o+".0, "+a+".0);\n\n        return "+s.texture2D+"("+n+", uv);\n      }\n    ";var u=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];return"\n    vec4 "+r+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(t[1]/2)+", "+u[0]+", "+u[1]+", row, col);\n      return "+s.texture2D+"("+n+", uv);\n    }\n  "}(t);case 3:return function(t){var n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=t.shapeInfo.texShape,o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];if(1===n[0]){var s=so(t,n.slice(1));return"\n        "+e(s)+"\n        vec4 "+i+"(int b, int row, int col) {\n          return "+i+"("+uo(["b","row","col"],[1,2])+");\n        }\n      "}var u=o[0],c=o[1],l=Math.ceil(n[2]/2);return"\n    vec4 "+i+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+u+", "+c+", "+l*Math.ceil(n[1]/2)+", "+l+", b, row, col);\n      return "+Ya().texture2D+"("+r+", uv);\n    }\n  "}(t);default:return function(e){for(var t=e.shapeInfo.logicalShape,n=t.length,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=e.shapeInfo.texShape,o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],s=o[0],u=o[1],c=Math.ceil(t[n-1]/2),l=c*Math.ceil(t[n-2]/2),f="int b, int row, int col",d="b * "+l+" + (row / 2) * "+c+" + (col / 2)",h=2;h<n-1;h++)f="int b"+h+", "+f,d="b"+h+" * "+(l*=t[n-h-1])+" + "+d;return"\n    vec4 "+i+"("+f+") {\n      int index = "+d+";\n      int texR = index / "+u+";\n      int texC = index - texR * "+u+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+u+", "+s+");\n      return "+Ya().texture2D+"("+r+", uv);\n    }\n  "}(t)}}(e):function e(t){var n=t.shapeInfo.logicalShape;switch(n.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"float "+n+"() {return "+t+";}";var r=e.shapeInfo.texShape,i=r[0],a=r[1];if(1===i&&1===a)return"\n      float "+n+"() {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var o=e.shapeInfo.texShape;return"\n    float "+n+"() {\n      vec2 uv = uvFromFlat("+o[0]+", "+o[1]+", "+io(t)+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(t);case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"\n      float "+n+"(int index) {\n        "+ao(e)+"\n      }\n    ";var r=e.shapeInfo.texShape,i=r[0],a=r[1];if(1===a&&1===i)return"\n      float "+n+"(int index) {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var o=io(t);return 1===a?"\n      float "+n+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+o+") + 0.5) / "+i+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":1===i?"\n      float "+n+"(int index) {\n        vec2 uv = vec2((float(index + "+o+") + 0.5) / "+a+".0, 0.5);\n        return sampleTexture("+t+", uv);\n      }\n    ":"\n    float "+n+"(int index) {\n      vec2 uv = uvFromFlat("+i+", "+a+", index + "+o+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(t);case 2:return function(t){var n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=t.shapeInfo.texShape;if(null!=a&&M(n,a)){var o=a[0];return"\n    float "+i+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+a[1]+".0, "+o+".0);\n      return sampleTexture("+r+", uv);\n    }\n  "}var s=z(n),u=s.newShape,c=s.keptDims,l=u;if(l.length<n.length){var f=so(t,l);return"\n      "+e(f)+"\n      float "+i+"(int row, int col) {\n        return "+i+"("+uo(["row","col"],c)+");\n      }\n    "}if(t.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+n[1]+", 1)));\n        "+ao(t)+"\n      }\n    ";var d=a[0],h=a[1],p=io(r);return 1===h?"\n    float "+i+"(int row, int col) {\n      float index = dot(vec3(row, col, "+p+"), vec3("+n[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+d+".0);\n      return sampleTexture("+r+", uv);\n    }\n  ":1===d?"\n    float "+i+"(int row, int col) {\n      float index = dot(vec3(row, col, "+p+"), vec3("+n[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+h+".0, 0.5);\n      return sampleTexture("+r+", uv);\n    }\n  ":"\n  float "+i+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+n[1]+" + col + "+p+";\n    vec2 uv = uvFromFlat("+d+", "+h+", index);\n    return sampleTexture("+r+", uv);\n  }\n"}(t);case 3:return function(t){var n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=n[1]*n[2],o=n[2],s=z(n),u=s.newShape,c=s.keptDims,l=u;if(l.length<n.length){var f=so(t,l);return"\n        "+e(f)+"\n        float "+i+"(int row, int col, int depth) {\n          return "+i+"("+uo(["row","col","depth"],c)+");\n        }\n      "}if(t.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+a+", "+o+", 1)));\n        "+ao(t)+"\n      }\n    ";var d=t.shapeInfo.texShape,h=d[0],p=d[1],m=t.shapeInfo.flatOffset;return p===a&&null==m?"\n        float "+i+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+o+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+p+".0, "+h+".0);\n          return sampleTexture("+r+", uv);\n        }\n      ":p===o&&null==m?"\n    float "+i+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+n[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+p+".0, "+h+".0);\n      return sampleTexture("+r+", uv);\n    }\n  ":"\n      float "+i+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+a+" + col * "+o+" + depth + "+io(r)+";\n        vec2 uv = uvFromFlat("+h+", "+p+", index);\n        return sampleTexture("+r+", uv);\n      }\n  "}(t);case 4:return function(t){var n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=n[3],o=n[2]*a,s=n[1]*o,u=z(n),c=u.newShape,l=u.keptDims;if(c.length<n.length){var f=so(t,c);return"\n      "+e(f)+"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        return "+i+"("+uo(["row","col","depth","depth2"],l)+");\n      }\n    "}if(t.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+s+", "+o+", "+a+", 1)));\n        "+ao(t)+"\n      }\n    ";var d=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,p=h[0],m=h[1];return m===s&&null==d?"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+o+", "+a+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+m+".0, "+p+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":m===a&&null==d?"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+n[1]*n[2]+", "+n[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+m+".0, "+p+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+i+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+s+" + col * "+o+" +\n          depth * "+a+" + depth2;\n      vec2 uv = uvFromFlat("+p+", "+m+", index + "+io(r)+");\n      return sampleTexture("+r+", uv);\n    }\n  "}(t);case 5:return function(t){var n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=n[4],o=n[3]*a,s=n[2]*o,u=n[1]*s,c=z(n),l=c.newShape,f=c.keptDims;if(l.length<n.length){var d=so(t,l);return"\n      "+e(d)+"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+i+"("+uo(["row","col","depth","depth2","depth3"],f)+");\n      }\n    "}if(t.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+u+", "+s+", "+o+", "+a+")) +\n          depth3;\n        "+ao(t)+"\n      }\n    ";var h=t.shapeInfo.flatOffset,p=t.shapeInfo.texShape,m=p[0],v=p[1];return v===u&&null==h?"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+s+", "+o+", "+a+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+v+".0, "+m+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":v===a&&null==h?"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+n[1]*n[2]*n[3]+",\n               "+n[2]*n[3]+", "+n[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+v+".0, "+m+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+u+" + col * "+s+" + depth * "+o+" +\n          depth2 * "+a+" + depth3 + "+io(r)+";\n      vec2 uv = uvFromFlat("+m+", "+v+", index);\n      return sampleTexture("+r+", uv);\n    }\n  "}(t);case 6:return function(t){var n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=z(n),o=a.newShape,s=a.keptDims;if(o.length<n.length){var u=so(t,o);return"\n      "+e(u)+"\n      float "+i+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+i+"("+uo(["row","col","depth","depth2","depth3","depth4"],s)+");\n      }\n    "}var c=n[5],l=n[4]*c,f=n[3]*l,d=n[2]*f,h=n[1]*d;if(t.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+h+", "+d+", "+f+", "+l+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+c+", 1)));\n        "+ao(t)+"\n      }\n    ";var p=t.shapeInfo.flatOffset,m=t.shapeInfo.texShape,v=m[0],g=m[1];return g===h&&null==p?"\n      float "+i+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+d+", "+f+", "+l+", "+c+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+g+".0, "+v+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":g===c&&null==p?"\n      float "+i+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+n[1]*n[2]*n[3]*n[4]+",\n               "+n[2]*n[3]*n[4]+",\n               "+n[3]*n[4]+",\n               "+n[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+g+".0, "+v+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+i+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+h+" + col * "+d+" + depth * "+f+" +\n          depth2 * "+l+" + depth3 * "+c+" + depth4 + "+io(r)+";\n      vec2 uv = uvFromFlat("+v+", "+g+", index);\n      return sampleTexture("+r+", uv);\n    }\n  "}(t);default:throw new Error(n.length+"-D input sampling is not yet supported")}}(e);var i=e.shapeInfo.logicalShape,a=t.logicalShape;return i.length<=a.length&&(r+=n?function(e,t){var n,r,i=e.name,a=i.charAt(0).toUpperCase()+i.slice(1),o="get"+a+"AtOutCoords",s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length,c=Lr(e.shapeInfo.logicalShape,t.logicalShape),l=oo(u),f=u-s,d=["x","y","z","w","u","v"];n=0===s?"":u<2&&c.length>=1?"coords = 0;":c.map((function(e){return"coords."+d[e+f]+" = 0;"})).join("\n"),r=u<2&&s>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords."+d[t+f]})).join(", ");var h="return outputValue;",p=1===j(e.shapeInfo.logicalShape),m=1===j(t.logicalShape);if(1!==s||p||m){if(p&&!m)h=1===u?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(c.length){var v=s-2,g=s-1;c.indexOf(v)>-1&&c.indexOf(g)>-1?h="return vec4(outputValue.x);":c.indexOf(v)>-1?h="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":c.indexOf(g)>-1&&(h="return vec4(outputValue.xx, outputValue.zz);")}}else h="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+o+"() {\n      "+l+" coords = getOutputCoords();\n      "+n+"\n      vec4 outputValue = get"+a+"("+r+");\n      "+h+"\n    }\n  "}(e,t):function(e,t){var n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),i="get"+r+"AtOutCoords",a=t.texShape,o=e.shapeInfo.texShape,s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!e.shapeInfo.isUniform&&s===u&&null==e.shapeInfo.flatOffset&&M(o,a))return"\n      float "+i+"() {\n        return sampleTexture("+n+", resultUV);\n      }\n    ";var c=oo(u),l=Lr(e.shapeInfo.logicalShape,t.logicalShape),f=u-s,d=["x","y","z","w","u","v"];return"\n    float "+i+"() {\n      "+c+" coords = getOutputCoords();\n      "+(0===s?"":u<2&&l.length>=1?"coords = 0;":l.map((function(e){return"coords."+d[e+f]+" = 0;"})).join("\n"))+"\n      return get"+r+"("+(u<2&&s>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords."+d[t+f]})).join(", "))+");\n    }\n  "}(e,t)),r}(e,t,r)})).join("\n"),c=t.texShape,l=Ya(),f="\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+l.texture2D+"(textureSampler, uv).r;\n    }\n  ",d=function(e){return e.version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+e.varyingFs+" vec2 resultUV;\n    "+e.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    "+e.defineSpecialNaN+"\n    "+e.defineSpecialInf+"\n    "+e.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+eo+"\n    "+to+"\n    "+no+"\n  "}(l);return t.isPacked?(a=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return 1===n[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+n[1]+".0);\n      }\n    ":1===n[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+n[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      return 2 * (resTexRC.x * "+n[1]+" + resTexRC.y);\n    }\n  "}(0,t);case 2:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(M(e,t))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+n[0]+", "+n[1]+"));\n      }\n    ";var r=Math.ceil(e[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return n=e,r=t,i=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],o=(a=Math.ceil(n[2]/2))*Math.ceil(n[1]/2),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+i[0]+", "+i[1]+"));\n      int index = resTexRC.x * "+i[1]+" + resTexRC.y;\n\n      int b = index / "+o+";\n      index -= b * "+o+";\n\n      int r = 2 * (index / "+a+");\n      int c = imod(index, "+a+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";default:return function(e,t){for(var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[e.length-1]/2),i=r*Math.ceil(e[e.length-2]/2),a=i,o="",s="b, r, c",u=2;u<e.length-1;u++)o="\n      int b"+u+" = index / "+(a*=e[e.length-u-1])+";\n      index -= b"+u+" * "+a+";\n    "+o,s="b"+u+", "+s;return"\n    ivec"+e.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n\n      "+o+"\n\n      int b = index / "+i+";\n      index -= b * "+i+";\n\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec"+e.length+"("+s+");\n    }\n  "}(e,t)}var n,r,i,a,o}(t.logicalShape,c),o="\n    void setOutput(vec4 val) {\n      "+l.output+" = val;\n    }\n  "):(a=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){return 1===t[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+t[1]+".0);\n      }\n    ":1===t[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+t[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      return resTexRC.x * "+t[1]+" + resTexRC.y;\n    }\n  "}(0,t);case 2:return function(e,t){return M(e,t)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+t[0]+", "+t[1]+"));\n      }\n    ":1===e[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===e[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      int r = index / "+e[1]+";\n      int c = index - r * "+e[1]+";\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return n=t,r=$a(["r","c","d"],e),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      "+r+"\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(e,t){var n=$a(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      "+n+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(e,t);case 5:return function(e,t){var n=$a(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+t[0]+",\n                             "+t[1]+"));\n\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(e,t);case 6:return function(e,t){var n=$a(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(e,t);default:throw new Error(e.length+"-D output sampling is not yet supported")}var n,r}(t.logicalShape,c),o="\n    void setOutput(float val) {\n      "+l.output+" = vec4(val, 0, 0, 0);\n    }\n  "),r&&(d+=ro),[d,f,o,s,a,u,n].join("\n")}var eo="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",to="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",no="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",ro="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function io(e){return"offset"+e}function ao(e){var t=e.name,n=j(e.shapeInfo.logicalShape);return n<2?"return "+t+";":"\n    for (int i = 0; i < "+n+"; i++) {\n      if (i == index) {\n        return "+t+"[i];\n      }\n    }\n  "}function oo(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank "+e+" is not yet supported")}function so(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function uo(e,t){return t.map((function(t){return e[t]})).join(", ")}var co=function(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Ur(t,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+e+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},lo="return a + b;",fo="return a - b;",ho="return a * b;",po="return (a < 0.) ? b * a : a;",mo=function(e,t,n){this.variableNames=["A","B"],this.outputShape=Ur(t,n),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+e+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},vo="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",go=function(e,t,n,r){void 0===r&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Ur(t,n);var i=this.outputShape.length,a="";if(r)if(0===i||1===j(this.outputShape))a="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(a="\n          "+oo(i)+" coords = getOutputCoords();\n        ",1===i)a+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var o=Ka("coords",i);a+="\n            bool nextRowOutOfBounds =\n              ("+o[i-2]+" + 1) >= "+this.outputShape[i-2]+";\n            bool nextColOutOfBounds =\n              ("+o[i-1]+" + 1) >= "+this.outputShape[i-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+e+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+a+"\n\n        setOutput(result);\n      }\n    "},yo=function(){function e(e){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,i){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(i,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(i,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}(),bo=function(){function e(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,i){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(i,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(i,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}();function xo(e,t,n){var r=e.indexOf(t);return e.map((function(e,t){return t===r?e+" - "+n:e})).join()}var wo=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var i=e.padInfo.top,a=e.padInfo.left,o=e.strideHeight,s=e.strideWidth,u=e.dilationHeight,c=e.dilationWidth,l=e.filterHeight,f=e.filterWidth,d=4*Math.floor(e.inChannels/4),h=e.inChannels%4,p="channelsLast"===e.dataFormat,m=p?1:2,v=p?2:3,g=p?3:1,y="",b="";n&&(y=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",b="result = activation(result);");var x=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+y+"\n\n      const ivec2 strides = ivec2("+o+", "+s+");\n      const ivec2 pads = ivec2("+i+", "+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords["+g+"];\n\n        ivec2 xRCCorner =\n            ivec2(coords["+m+"], coords["+v+"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+l+"; wR++) {\n          int xR = xRCorner + wR * "+u+";\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+f+"; wC++) {\n            int xC = xCCorner + wC * "+c+";\n\n            if (xC < 0 || xC >= "+e.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+d+"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if ("+p+") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if ("+(1===h)+") {\n\n              if ("+p+") {\n                dotProd +=\n                    getX(batch, xR, xC, "+d+") *\n                    getW(wR, wC, "+d+", d2);\n              } else {\n                dotProd +=\n                    getX(batch, "+d+", xR, xC) *\n                    getW(wR, wC, "+d+", d2);\n              }\n\n            } else if ("+(2===h)+") {\n              vec2 wValues = vec2(\n                getW(wR, wC, "+d+", d2),\n                getW(wR, wC, "+d+" + 1, d2)\n              );\n\n              if ("+p+") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, "+d+"),\n                  getX(batch, xR, xC, "+d+" + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, "+d+", xR, xC),\n                  getX(batch, "+d+" + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if ("+(3===h)+") {\n              vec3 wValues = vec3(\n                getW(wR, wC, "+d+", d2),\n                getW(wR, wC, "+d+" + 1, d2),\n                getW(wR, wC, "+d+" + 2, d2)\n              );\n\n              if ("+p+") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, "+d+"),\n                  getX(batch, xR, xC, "+d+" + 1),\n                  getX(batch, xR, xC, "+d+" + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, "+d+", xR, xC),\n                  getX(batch, "+d+" + 1, xR, xC),\n                  getX(batch, "+d+" + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        "+x+"\n        "+b+"\n        setOutput(result);\n      }\n    "},_o=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var i=e.inHeight,a=e.inWidth,o=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,c=e.strideWidth,l=e.dilationHeight,f=e.dilationWidth,d=e.filterHeight,h=e.filterWidth,p=e.outChannels/e.inChannels,m="",v="";n&&(m=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",v="result = activation(result);");var g=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+m+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+o+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+p+";\n        int q = d2 - d1 * "+p+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+d+"; wR++) {\n          int xR = xRCorner + wR * "+l+";\n\n          if (xR < 0 || xR >= "+i+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+h+"; wC++) {\n            int xC = xCCorner + wC * "+f+";\n\n            if (xC < 0 || xC >= "+a+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        "+g+"\n        "+v+"\n        setOutput(result);\n      }\n    "},ko=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.outShape;for(var i=e.inHeight,a=e.inWidth,o=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,c=e.strideWidth,l=e.dilationHeight,f=e.dilationWidth,d=e.filterHeight,h=e.filterWidth,p=h,m="int xR; int xC; int xCOffset;",v=0;v<d;v++)for(var g=0;g<h;g++)m+="\n          vec4 xTexelR"+v+"C"+2*g+" = vec4(0.);\n          vec4 wR"+v+"C"+g+" = vec4(0.);\n          vec4 xR"+v+"C"+g+" = vec4(0.);";for(v=0;v<d;v++)for(var y=0;y<p;y++){if(m+="\n          xR = xRCorner + "+v*l+";\n          xC = xCCorner + "+(g=2*y)*f+";\n        ",1===c){if(g<h&&(m+=s%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+i+" && xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+v+"C"+g+" = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+a+") {\n                    xTexelR"+v+"C"+g+".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR"+v+"C"+g+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+i+" && xCOffset >= 0 && xCOffset < "+a+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+a+") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR"+v+"C"+g+" = vec4(previous.zw, xTexelR"+v+"C"+g+".xy);\n                } else {\n                  xR"+v+"C"+g+" = vec4(0, 0, xTexelR"+v+"C"+g+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+i+" && xC >= 0 && xC < "+a+") {\n                  xTexelR"+v+"C"+g+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+v+"C"+g+" = vec4(0.);\n                }\n\n                xR"+v+"C"+g+" = xTexelR"+v+"C"+g+";\n              ",g+1<h)){var b=s%2==0?S(f):f;f%2==0&&s%2==1||f%2!=0&&s%2!=1?(m+="\n                  xCOffset = xC + "+s%2+" + "+b+";\n\n                  if(xR >= 0 && xR < "+i+" &&\n                    xCOffset >= 0 && xCOffset < "+a+") {\n                    xTexelR"+v+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",f>1&&(m+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+i+" &&\n                      xCOffset >= 0 && xCOffset < "+a+") {\n                      xTexelR"+v+"C"+g+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+v+"C"+g+" = vec4(0.);\n                    }\n                  "),m+="\n                  xR"+v+"C"+(g+1)+" = vec4(\n                    xTexelR"+v+"C"+g+".zw, xTexelR"+v+"C"+(g+2)+".xy);\n                "):m+="\n                  xCOffset = xC + "+b+";\n\n                  if(xR >= 0 && xR < "+i+" &&\n                    xCOffset >= 0 && xCOffset < "+a+") {\n                    xTexelR"+v+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+v+"C"+(g+1)+" = xTexelR"+v+"C"+(g+2)+";\n                "}}else g<h&&(m+="\n              if(xR >= 0 && xR < "+i+") {\n            ",s%2==1?(m+="\n                xCOffset = xC + 1 - "+c+";\n                if(xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+v+"C"+g+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+v+"C"+g+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+a+") {\n                  xTexelR"+v+"C"+(g+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+v+"C"+(g+2)+" = vec4(0.);\n                }\n\n                xR"+v+"C"+g+" = vec4(\n                  xTexelR"+v+"C"+g+".zw, xTexelR"+v+"C"+(g+2)+".zw);\n              ",g+1<h&&(m+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+c+";\n                  if(xCOffset >= 0 && xCOffset < "+a+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+v+"C"+(g+1)+" = vec4(xTexelR"+v+"C"+(g+2)+".xy, final.xy);\n                ")):(m+="\n                if(xC >= 0 && xC < "+a+") {\n                  xTexelR"+v+"C"+g+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+v+"C"+g+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+c+";\n                if(xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+v+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+v+"C"+(g+2)+" = vec4(0.);\n                }\n\n                xR"+v+"C"+g+" = vec4(\n                  xTexelR"+v+"C"+g+".xy, xTexelR"+v+"C"+(g+2)+".xy);\n              ",g+1<h&&(m+="\n                  xR"+v+"C"+(g+1)+" = vec4(\n                    xTexelR"+v+"C"+g+".zw, xTexelR"+v+"C"+(g+2)+".zw);\n                ")),m+="}");g<h&&(m+="\n            vec4 wTexelR"+v+"C"+g+" = getW("+v+", "+g+", d1, q);\n            wR"+v+"C"+g+" = vec4(wTexelR"+v+"C"+g+".xz, wTexelR"+v+"C"+g+".xz);\n          ",g+1<h&&(m+="\n              vec4 wTexelR"+v+"C"+(g+1)+" = getW("+v+", "+(g+1)+", d1, q);\n              wR"+v+"C"+(g+1)+" =\n                vec4(wTexelR"+v+"C"+(g+1)+".xz, wTexelR"+v+"C"+(g+1)+".xz);"))}for(v=0;v<d;v++)for(g=0;g<h;g++)m+="dotProd += xR"+v+"C"+g+" * wR"+v+"C"+g+";";var x="",w="";n&&(x=r?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"vec4 activation(vec4 x) {\n          "+n+"\n        }",w="result = activation(result);");var _=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+x+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+o+", "+s+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        "+m+"\n\n        vec4 result = dotProd;\n        "+_+"\n        "+w+"\n        setOutput(result);\n      }\n    "};function Eo(e,t){if(1===e)return""+t;if(2===e)return t+".y";if(3===e)return t+".z";if(4===e)return t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}var So=function(){function e(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+t+";\n      int offset_h = imod(h, "+t+");\n      int in_w = w / "+t+";\n      int offset_w = imod(w, "+t+");\n      int offset_d = (offset_h * "+t+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return e.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},e.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},e.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},e.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},e.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},e}(),Co=function(e,t,n){this.variableNames=["real","imag"];var r=t[1];this.outputShape=t;var i=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,a=n?r+".0":"1.0";this.userCode="\n      const float exponentMultiplier = "+i+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+e+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+a+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},Ao=function(){function e(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.valueLoc&&(t.valueLoc=n.getUniformLocationNoThrow(r,"value")),n.gl.uniform1f(t.valueLoc,e)}},e}();function Oo(e,t){var n=Ya();return ut(e,t,n.version+"\n    precision highp float;\n    "+n.attribute+" vec3 clipSpacePos;\n    "+n.attribute+" vec2 uv;\n    "+n.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function Do(e,t){return vt(e,t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function To(e,t){return gt(e,t,new Uint16Array([0,1,2,2,1,3]))}function jo(e,t,n,r,i,a,o){bt(n,r);var s=yt(e,t),u=e.TEXTURE_2D;return nt(e,t,(function(){return e.bindTexture(u,s)})),nt(e,t,(function(){return e.texParameteri(u,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)})),nt(e,t,(function(){return e.texParameteri(u,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)})),nt(e,t,(function(){return e.texParameteri(u,e.TEXTURE_MIN_FILTER,e.NEAREST)})),nt(e,t,(function(){return e.texParameteri(u,e.TEXTURE_MAG_FILTER,e.NEAREST)})),nt(e,t,(function(){return e.texImage2D(u,0,i,n,r,0,a,o,null)})),nt(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)})),s}function Mo(e,t,n,r,i){var a=Ze(n,r);return jo(e,t,a[0],a[1],i.internalFormatFloat,i.textureFormatFloat,e.FLOAT)}function Fo(e,t,n,r,i){var a=Ze(n,r);return jo(e,t,a[0],a[1],i.internalFormatHalfFloat,i.textureFormatFloat,i.textureTypeHalfFloat)}function Io(e,t,n,r,i){var a=Ze(n,r);return jo(e,t,a[0],a[1],e.RGBA,e.RGBA,e.UNSIGNED_BYTE)}function No(e,t,n,r,i){var a=et(n,r);return jo(e,t,a[0],a[1],i.internalFormatPackedFloat,e.RGBA,e.FLOAT)}function Ro(e,t,n,r,i){var a=et(n,r);return jo(e,t,a[0],a[1],i.internalFormatPackedHalfFloat,e.RGBA,i.textureTypeHalfFloat)}function Po(e,t,n,r){return nt(e,t,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),wt(e,t,n,"clipSpacePos",r,3,20,0)&&wt(e,t,n,"uv",r,2,20,12)}function Bo(e,t,n,r,i,a,o){var s,u,c;nt(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,n)})),a instanceof Uint8Array?(s=new Uint8Array(r*i*4),u=e.UNSIGNED_BYTE,c=e.RGBA):(s=new Float32Array(r*i*4),u=e.FLOAT,c=o.internalFormatPackedFloat),s.set(a),nt(e,t,(function(){return e.texImage2D(e.TEXTURE_2D,0,c,r,i,0,e.RGBA,u,s)})),nt(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function Lo(e,t,n,r){nt(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,n)})),r.data instanceof Uint8Array?nt(e,t,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r.width,r.height,0,e.RGBA,e.UNSIGNED_BYTE,r.data)})):nt(e,t,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)})),nt(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function zo(e,t,n,r,i){var a=e.createBuffer();nt(e,t,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,a)}));var o=16*n*r;return nt(e,t,(function(){return e.bufferData(e.PIXEL_PACK_BUFFER,o,e.STREAM_READ)})),nt(e,t,(function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,0)})),nt(e,t,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)})),a}function Uo(e,t,n){var r=e,i=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}function Wo(e,t,n,r,i){var a=Ze(n,r),o=a[0],s=a[1],u=new Uint8Array(n*r*4);return nt(e,t,(function(){return e.readPixels(0,0,o,s,i.downloadTextureFormat,e.UNSIGNED_BYTE,u)})),new Float32Array(u.buffer)}function Vo(e,t,n,r,i,a,o,s){var u=e,c=new Float32Array(function(e,t){var n=et(a,o);return n[0]*n[1]*4}());return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function Go(e,t,n,r){var i=new Float32Array(n*r*4);return nt(e,t,(function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,i)})),i}var qo=Object.freeze({createVertexShader:Oo,createVertexBuffer:Do,createIndexBuffer:To,createFloat32MatrixTexture:Mo,createFloat16MatrixTexture:Fo,createUnsignedBytesMatrixTexture:Io,createPackedMatrixTexture:No,createFloat16PackedMatrixTexture:Ro,bindVertexProgramAttributeStreams:Po,uploadDenseMatrixToTexture:Bo,uploadPixelDataToTexture:Lo,createBufferFromOutputTexture:zo,downloadFloat32MatrixFromBuffer:Uo,downloadByteEncodedFloatMatrixFromOutputTexture:Wo,downloadPackedMatrixFromBuffer:Vo,downloadMatrixFromPackedOutputTexture:Go}),Ho=function(){function e(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=f().getNumber("WEBGL_VERSION");null!=e?(this.gl=e,$e(t,e)):this.gl=Je(t);var n="WEBGL_color_buffer_float";if(1===f().getNumber("WEBGL_VERSION")){if(this.textureFloatExtension=st(this.gl,this.debug,"OES_texture_float"),Ut(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=st(this.gl,this.debug,"OES_texture_half_float");else if(f().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),Ut(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=st(this.gl,this.debug,"EXT_color_buffer_half_float");else if(f().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",Ut(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!Ut(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=Do(this.gl,this.debug),this.indexBuffer=To(this.gl,this.debug),this.framebuffer=xt(this.gl,this.debug),this.textureConfig=tt(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(e.prototype,"debug",{get:function(){return f().getBool("DEBUG")},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;nt(t,this.debug,(function(){return t.finish()})),nt(t,this.debug,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),nt(t,this.debug,(function(){return t.deleteFramebuffer(e.framebuffer)})),nt(t,this.debug,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),nt(t,this.debug,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),nt(t,this.debug,(function(){return t.deleteBuffer(e.indexBuffer)})),this.disposed=!0}},e.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),Mo(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),Fo(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),Io(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),Lo(this.gl,this.debug,e,t)},e.prototype.uploadDenseMatrixToTexture=function(e,t,n,r){this.throwIfDisposed(),Bo(this.gl,this.debug,e,t,n,r,this.textureConfig)},e.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),Ro(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),No(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(At(this.gl,this.debug,this.framebuffer),this.outputTexture=null),nt(this.gl,this.debug,(function(){return t.gl.deleteTexture(e)}))},e.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return Wo(r.gl,r.debug,t,n,r.textureConfig)}))},e.prototype.downloadPackedMatrixFromBuffer=function(e,t,n,r,i,a){return Vo(this.gl,e,0,0,0,i,a,this.textureConfig)},e.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return Uo(this.gl,e,t)},e.prototype.createBufferFromTexture=function(e,t,n){this.bindTextureToFrameBuffer(e);var r=zo(this.gl,this.debug,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r},e.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},e.prototype.createFence=function(e){var t,n,r=this;if(f().getBool("WEBGL_FENCE_API_ENABLED")){var i=e,a=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=i.clientWaitSync(a,0,0);return e===i.ALREADY_SIGNALED||e===i.CONDITION_SATISFIED},t=a}else f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}},e.prototype.downloadMatrixFromPackedTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return Go(r.gl,r.debug,t,n)}))},e.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,n=ct(t,this.debug,e),r=Oo(t,this.debug),i=ht(t,this.debug);return nt(t,this.debug,(function(){return t.attachShader(i,r)})),nt(t,this.debug,(function(){return t.attachShader(i,n)})),pt(t,this.debug,i),this.debug&&mt(t,this.debug,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=Po(t,this.debug,this.program,this.vertexBuffer)),i},e.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&nt(this.gl,this.debug,(function(){return t.gl.deleteProgram(e)}))},e.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&mt(this.gl,this.debug,this.program),nt(this.gl,this.debug,(function(){return t.gl.useProgram(e)}))},e.prototype.getUniformLocation=function(e,t,n){return void 0===n&&(n=!0),this.throwIfDisposed(),n?kt(this.gl,this.debug,e,t):Et(this.gl,e,t)},e.prototype.getAttributeLocation=function(e,t){var n=this;return this.throwIfDisposed(),nt(this.gl,this.debug,(function(){return n.gl.getAttribLocation(e,t)}))},e.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},e.prototype.setInputMatrixTexture=function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),St(this.gl,this.debug,this.program,e,t,n)},e.prototype.setOutputMatrixTexture=function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)},e.prototype.setOutputPackedMatrixTexture=function(e,t,n){this.throwIfDisposed();var r=et(t,n),i=r[0],a=r[1];this.setOutputMatrixTextureDriver(e,i,a)},e.prototype.setOutputMatrixWriteRegion=function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)},e.prototype.setOutputPackedMatrixWriteRegion=function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},e.prototype.debugValidate=function(){null!=this.program&&mt(this.gl,this.debug,this.program),Ot(this.gl)},e.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),nt(e,this.debug,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))},e.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),nt(this.gl,this.debug,(function(){return e.gl.finish()}))},e.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=st(this.gl,this.debug,2===f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},e.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},e.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},e.prototype.beginQuery=function(){if(2===f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),i=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,i),i},e.prototype.endQuery=function(){if(2!==f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}},e.prototype.waitForQueryAndGetTime=function(e){return u(this,void 0,void 0,(function(){var t=this;return c(this,(function(n){switch(n.label){case 0:return[4,P((function(){return t.disposed||t.isQueryAvailable(e,f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}))];case 1:return n.sent(),[2,this.getQueryTime(e,f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}}))}))},e.prototype.getQueryTime=function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6},e.prototype.isQueryAvailable=function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint}return i=(r=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,r.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint},e.prototype.pollFence=function(e){var t=this;return new Promise((function(n){t.addItemToPoll((function(){return e.isFencePassed()}),(function(){return n()}))}))},e.prototype.pollItems=function(){for(var e=function(e){for(var t=0;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map((function(e){return e.isDoneFn}))),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},e.prototype.addItemToPoll=function(e,t){var n=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||P((function(){return n.pollItems(),0===n.itemsToPoll.length}))},e.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),Ct(this.gl,this.debug,e,this.framebuffer),this.debug&&Ot(this.gl)},e.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(Ct(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Ot(this.gl)):At(this.gl,this.debug,this.framebuffer)},e.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n},e.prototype.setOutputMatrixTextureDriver=function(e,t,n){this.throwIfDisposed();var r=this.gl;Ct(r,this.debug,e,this.framebuffer),this.debug&&Ot(r),this.outputTexture=e,nt(r,this.debug,(function(){return r.viewport(0,0,t,n)})),nt(r,this.debug,(function(){return r.scissor(0,0,t,n)}))},e.prototype.setOutputMatrixWriteRegionDriver=function(e,t,n,r){var i=this;this.throwIfDisposed(),nt(this.gl,this.debug,(function(){return i.gl.scissor(e,t,n,r)}))},e.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},e.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},e}();function Xo(e,t){if(e.length!==t.length)throw Error("Binary was compiled with "+e.length+" inputs, but was executed with "+t.length+" inputs");e.forEach((function(e,n){var r=e.logicalShape,i=t[n],a=i.shape;if(!M(r,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+r+" and "+a+" must match");if(!e.isUniform||!i.isUniform){var o=e.texShape,s=i.isUniform?null:i.texData.texShape;if(!M(o,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+o+" and "+s+" must match")}}))}var Ko=function(e,t,n,r,i,a,o){void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===i&&(i=!1),void 0===a&&(a=null),void 0===o&&(o=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;var s=n?e[1]:e[2],u=Math.ceil(s/2),c=n?"i * 2, rc.y":"rc.y, i * 2",l=r?"rc.z, i * 2":"i * 2, rc.z",f=n?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],d=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],h="",p="";a&&(h=o?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+a+"\n        }":"vec4 activation(vec4 x) {\n          "+a+"\n        }",p="result = activation(result);");var m=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+h+"\n\n      const float sharedDimension = "+u+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+u+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+c+");\n          vec4 b = getMatrixB(rc.x, "+l+");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += ("+f[0]+" * "+d[0]+");\n          result += ("+f[1]+" * "+d[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+m+"\n\n        "+p+"\n\n        setOutput(result);\n      }\n    "},Yo=function(){function e(e,t,n){this.variableNames=["probs"],this.outputShape=[e,n],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(t-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(t-1)+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.seedLoc&&(t.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(t.seedLoc,e)}},e}(),$o=function(e,t,n,r,i){if(void 0===r&&(r=!1),void 0===i&&(i=!1),this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var a=e.filterWidth,o=e.strideHeight,s=e.strideWidth,u=e.dilationHeight,c=e.dilationWidth,l=e.effectiveFilterHeight,f=e.effectiveFilterWidth,d=e.padInfo.top,h=e.padInfo.left;this.outputShape=e.outShape;var p="avg"===t,m="((batch  * "+e.inHeight+" + xR) * "+e.inWidth+" + xC) * "+e.inChannels+" + d",v="(xR * "+e.inWidth+" + xC) * "+e.inChannels+" + d",g="0.0";if(p||(g="-1.0 / 1e-20"),n)this.userCode="\n        const ivec2 strides = ivec2("+o+", "+s+");\n        const ivec2 pads = ivec2("+d+", "+h+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+l+";\n              wR += "+u+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+f+";\n                wC += "+c+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = "+(r?i?m:v:"wR * "+f+" + wC")+";\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var y=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(y="avgValue / count");var b=4*Math.floor(a/4),x=a%4,w="\n      if ("+p+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+o+", "+s+");\n      const ivec2 pads = ivec2("+d+", "+h+");\n      const float initializationValue = "+g+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+g+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+l+";\n            wR += "+u+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+b+"; wC += 4) {\n            int xC = xCCorner + wC * "+c+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+c+", d),\n              getValue(batch, xR, xC + 2 * "+c+", d),\n              getValue(batch, xR, xC + 3 * "+c+", d)\n            );\n\n            "+w+"\n          }\n\n          int xC = xCCorner + "+b+";\n          if ("+(1===x)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+w+"\n          } else if ("+(2===x)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+c+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+w+"\n          } else if ("+(3===x)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+c+", d),\n              getValue(batch, xR, xC + 2 * "+c+", d),\n              initializationValue\n            );\n\n            "+w+"\n          }\n        }\n        setOutput("+y+");\n      }\n    "}},Jo=function(e,t,n,r,i){if(void 0===r&&(r=!1),void 0===i&&(i=!1),this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var a=e.filterWidth,o=e.strideDepth,s=e.strideHeight,u=e.strideWidth,c=e.dilationDepth,l=e.dilationHeight,f=e.dilationWidth,d=e.effectiveFilterDepth,h=e.effectiveFilterHeight,p=e.effectiveFilterWidth,m=e.padInfo.front,v=e.padInfo.top,g=e.padInfo.left;this.outputShape=e.outShape;var y="avg"===t,b="0.0";if(y||(b="-1.0 / 1e-20"),n)this.userCode="\n        const ivec3 strides =\n            ivec3("+o+", "+s+", "+u+");\n        const ivec3 pads = ivec3("+m+", "+v+", "+g+");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < "+d+";\n              wD += "+c+") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= "+e.inDepth+") {\n              continue;\n            }\n\n            for (int wR = 0; wR < "+h+";\n                wR += "+l+") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= "+e.inHeight+") {\n                continue;\n              }\n\n              for (int wC = 0; wC < "+p+";\n                  wC += "+f+") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= "+e.inWidth+") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = "+(r?i?"(((batch * "+e.inDepth+" + xD) * "+e.inHeight+" + xR) * "+e.inWidth+" + xC) * "+e.inChannels+" + ch":"((xD * "+e.inHeight+" + xR) * "+e.inWidth+" + xC) * "+e.inChannels+" + ch":"wD * "+h+" * "+p+" +\n                      wR * "+p+" + wC")+";\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var x=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(x="avgValue / count");var w=4*Math.floor(a/4),_=a%4,k="\n      if ("+y+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec3 strides =\n        ivec3("+o+", "+s+", "+u+");\n      const ivec3 pads = ivec3("+m+", "+v+", "+g+");\n      const float initializationValue = "+b+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+b+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < "+d+";\n            wD += "+c+") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= "+e.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+h+";\n            wR += "+l+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+w+"; wC += 4) {\n              int xC = xCCorner + wC * "+f+";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+f+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+f+", ch),\n                getValue(batch, xD, xR, xC + 3 * "+f+", ch)\n              );\n\n              "+k+"\n            }\n\n            int xC = xCCorner + "+w+";\n            if ("+(1===_)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              "+k+"\n            } else if ("+(2===_)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+f+", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              "+k+"\n            } else if ("+(3===_)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+f+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+f+", ch),\n                initializationValue\n              );\n\n              "+k+"\n            }\n          }\n          setOutput("+x+");\n        }\n      }\n    "}},Zo=function(e,t,n,r,i,a,o){void 0===o&&(o=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=a;var s=oo(i.length),u=oo(a.length),c="";1===n?c="i":2===n&&(c="i, j");var l="getIndices("+c+")",f="";1===r?f="i":2===r&&(f="i, coords[1]");var d="getUpdates("+f+")",h=t>1?"strides[j]":"strides";this.userCode="\n        "+s+" strides = "+s+"("+i+");\n\n        void main() {\n          "+u+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+e+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+t+"; j++) {\n              int index = round("+l+");\n              flattenedIndex += index * "+h+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += "+d+";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},Qo=function(){function e(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,n=oo(this.rank),r="uniform int start["+this.rank+"];",i=function(e){if(1===e)return"sourceLoc";if(e<=6)return es.slice(0,e).map((function(e){return"sourceLoc."+e})).join(",");throw Error("Slicing for rank "+e+" is not yet supported")}(this.rank);t="\n        "+n+" sourceLoc;\n        "+n+" coords = getOutputCoords();\n        "+e.map((function(e,t){return"sourceLoc."+es[t]+" = start["+t+"] + coords."+es[t]+";"})).join("\n")+"\n      ",this.userCode="\n      "+r+"\n      void main() {\n        "+t+"\n        setOutput(getSource("+i+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),es=["x","y","z","w","u","v"],ts=function(){function e(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var t=oo(this.rank),n=Ka("coords",this.rank),r=Ka("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":"vec2("+r.slice(-2).join()+")",a="getChannel(getSource("+r.join()+"), "+i+")",o="\n      result.x = "+a+";\n      if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n        ++"+r[this.rank-1]+";\n        result.y = "+a+";\n        --"+r[this.rank-1]+";\n      }\n    ",s=1===this.rank?"":"\n      --"+n[this.rank-1]+";\n      if (++"+n[this.rank-2]+" < "+e[this.rank-2]+") {\n        ++"+r[this.rank-2]+";\n        result.z = "+a+";\n        if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n          ++"+r[this.rank-1]+";\n          result.w = "+a+";\n        }\n      }\n    ",u=this.rank<=4?"sourceLoc = coords +\n            "+t+"("+e.map((function(e,t){return"start["+t+"]"})).join()+");":e.map((function(e,t){return r[t]+" = "+n[t]+" + start["+t+"];"})).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+t+" coords = getOutputCoords();\n        "+t+" sourceLoc;\n        "+u+"\n        vec4 result = vec4(0.);\n        "+o+"\n        "+s+"\n        setOutput(result);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),ns=function(){function e(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return e.prototype.acquireTexture=function(e,t,n){var r,i=rs(t,n),a=is(e,i,n);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var o=this.freeTextures[a].shift();return this.usedTextures[a].push(o),o}return this.numUsedTextures++,this.log(),i===Xe.PACKED_2X2_FLOAT32?r=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):i===Xe.PACKED_2X2_FLOAT16?r=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):i===Xe.UNPACKED_FLOAT32?r=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):i===Xe.UNPACKED_FLOAT16?r=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):i===Xe.PACKED_4X1_UNSIGNED_BYTE&&(r=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(r),r},e.prototype.releaseTexture=function(e,t,n,r){if(null!=this.freeTextures){var i=is(t,rs(n,r),r);i in this.freeTextures||(this.freeTextures[i]=[]),this.freeTextures[i].push(e),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[i],o=a.indexOf(e);if(o<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(o,1),this.log()}},e.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},e.prototype.getNumUsedTextures=function(){return this.numUsedTextures},e.prototype.getNumFreeTextures=function(){return this.numFreeTextures},e.prototype.dispose=function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t)}));for(var t in this.usedTextures)this.usedTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},e}();function rs(e,t){if(e===He.UPLOAD)return Xe.PACKED_2X2_FLOAT32;if(e===He.RENDER||null==e)return function(e){return f().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?Xe.PACKED_2X2_FLOAT32:Xe.UNPACKED_FLOAT32:e?Xe.PACKED_2X2_FLOAT16:Xe.UNPACKED_FLOAT16}(t);if(e===He.DOWNLOAD||e===He.PIXELS)return Xe.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+e)}function is(e,t,n){return e[0]+"_"+e[1]+"_"+t+"_"+n}var as=1.7580993408473768,os=1.0507009873554805,ss=function(e,t){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      float unaryOperation(float x) {\n        "+t+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},us="if (isnan(x)) return x;",cs="return x;",ls="return abs(x);",fs=us+"\n  return (x < 0.0) ? 0.0 : x;\n",ds=us+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",hs="return (x >= 0.0) ? x : (exp(x) - 1.0);",ps="return -x;",ms="return ceil(x);",vs="return floor(x);",gs="return exp(x);",ys="return exp(x) - 1.0;",bs="return x;",xs="return x;",ws="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",_s="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",ks="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",Es=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+t+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},Ss={};function Cs(e,t){if(void 0===t&&(t=!1),"linear"===e)return t?xs:cs;if("relu"===e)return t?ws:fs;if("elu"===e)return t?ks:hs;if("relu6"===e)return t?_s:ds;if("prelu"===e)return t?vo:po;throw new Error("Activation "+e+" has not been implemented for the WebGL backend.")}var As=600,Os=function(e){function t(t){var n,r=e.call(this)||this;if(r.pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.warnedAboutMemory=!1,r.pendingDeletes=0,r.disposed=!1,!f().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==t){var i=Je(f().getNumber("WEBGL_VERSION"));r.binaryCache=((n=f().getNumber("WEBGL_VERSION"))in Ss||(Ss[n]={}),Ss[n]),r.gpgpu=new Ho(i),r.canvas=i.canvas,r.gpgpuCreatedLocally=!0}else r.gpgpu=t,r.binaryCache={},r.gpgpuCreatedLocally=!1,r.canvas=t.gl.canvas;return r.textureManager=new ns(r.gpgpu),r.numMBBeforeWarning=null==f().global.screen?1024:f().global.screen.height*f().global.screen.width*window.devicePixelRatio*As/1024/1024,r.texData=new da(r,We),r}return s(t,e),t.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},t.prototype.write=function(e,t,n){if(f().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:He.UPLOAD}),r},t.prototype.move=function(e,t,n,r){if(f().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:He.UPLOAD})},t.prototype.readSync=function(e){var t=this.texData.get(e),n=t.values,r=t.dtype,i=t.complexTensors,a=t.slice,o=t.shape,s=t.isPacked;if(null!=a){var u;u=s?new Es(o,bs):new ss(o,bs);var c=this.runWebGLProgram(u,[{dataId:e,shape:o,dtype:r}],r),l=this.readSync(c.dataId);return this.disposeData(c.dataId),l}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;var f,d,h=null!=this.activeTimers;return h&&(f=oe()),d="complex64"===r?ja(i.real.dataSync(),i.imag.dataSync()):this.getValuesFromTexture(e),h&&(this.downloadWaitMs+=oe()-f),this.convertAndCacheOnCPU(e,d)},t.prototype.read=function(e){return u(this,void 0,void 0,(function(){var t,n,r,i,a,o,s,u,l,d,h,p,m,v,g,y,b,x,w,_,k,E;return c(this,(function(c){switch(c.label){case 0:if(this.pendingRead.has(e))return t=this.pendingRead.get(e),[2,new Promise((function(e){return t.push(e)}))];if(n=this.texData.get(e),r=n.values,i=n.shape,a=n.slice,o=n.dtype,s=n.complexTensors,u=n.isPacked,null!=a)return l=void 0,l=u?new Es(i,bs):new ss(i,bs),d=this.runWebGLProgram(l,[{dataId:e,shape:i,dtype:o}],o),h=this.read(d.dataId),this.disposeData(d.dataId),[2,h];if(null!=r)return[2,this.convertAndCacheOnCPU(e)];if(!f().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===f().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return p=null,"complex64"!==o&&f().get("WEBGL_BUFFER_SUPPORTED")&&(m=this.decode(e),v=this.texData.get(m.dataId),p=(E=this.gpgpu).createBufferFromTexture.apply(E,[v.texture].concat(Qe(i)))),this.pendingRead.set(e,[]),"complex64"===o?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:c.sent(),c.label=2;case 2:return"complex64"!==o?[3,4]:[4,Promise.all([s.real.data(),s.imag.data()])];case 3:return y=c.sent(),b=y[0],x=y[1],g=ja(b,x),[3,5];case 4:null==p?g=this.getValuesFromTexture(e):(w=j(i),g=this.gpgpu.downloadFloat32MatrixFromBuffer(p,w)),c.label=5;case 5:return null!=m&&this.disposeData(m.dataId),_=this.convertAndCacheOnCPU(e,g),k=this.pendingRead.get(e),this.pendingRead.delete(e),k.forEach((function(e){return e(_)})),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e),this.pendingDeletes--),[2,_]}}))}))},t.prototype.checkNumericalProblems=function(e){if(null!=e)for(var t=0;t<e.length;t++){var n=e[t];if(!at(n)){if(f().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value "+n+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value "+n+" cannot be represented on this device.")}}},t.prototype.getValuesFromTexture=function(e){var t,n=this.texData.get(e),r=n.shape,i=n.dtype,a=n.isPacked,o=j(r);if(f().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var s=this.decode(e),u=this.texData.get(s.dataId),c=(t=this.gpgpu).downloadMatrixFromPackedTexture.apply(t,[u.texture].concat(Qe(r))).subarray(0,o);return this.disposeData(s.dataId),c}var l=f().getBool("WEBGL_PACK")&&!0===a,d=l?It(r):r,h=l?new function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=He.DOWNLOAD;var t=Ya();this.outputShape=e,this.userCode="\n      "+Za+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+t.output+" = encode_float(x);\n      }\n    "}(d):new function(e){this.variableNames=["A"],this.outTexUsage=He.DOWNLOAD;var t=Ya();this.outputShape=e,this.userCode="\n      "+Za+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+t.output+" = encode_float(x);\n      }\n    "}(d),p=this.runWebGLProgram(h,[{shape:d,dtype:i,dataId:e}],"float32"),m=this.texData.get(p.dataId),v=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(m.texture,m.texShape[0],m.texShape[1]).subarray(0,o);return this.disposeData(p.dataId),v},t.prototype.time=function(e){return u(this,void 0,void 0,(function(){var t,n,r,i,a,o,s;return c(this,(function(u){switch(u.label){case 0:return t=this.activeTimers,n=[],r=!1,null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,e(),i=T(this.activeTimers.map((function(e){return e.query}))).filter((function(e){return null!=e})),a=T(this.activeTimers.map((function(e){return e.name}))).filter((function(e){return null!=e})),this.activeTimers=t,r&&(this.programTimersStack=null),o={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(i)]:[3,2];case 1:return s=u.sent(),o.kernelMs=C(s),o.getExtraProfileInfo=function(){return s.map((function(e,t){return{name:a[t],ms:e}})).map((function(e){return e.name+": "+e.ms})).join(", ")},[3,3];case 2:o.kernelMs={error:"WebGL query timers are not supported in this environment."},u.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,o]}}))}))},t.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},t.prototype.startTimer=function(){return f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:oe(),endMs:null}},t.prototype.endTimer=function(e){return f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=oe(),e)},t.prototype.getQueryTime=function(e){return u(this,void 0,void 0,(function(){var t;return c(this,(function(n){return f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(t=e).endMs-t.startMs]}))}))},t.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(this.texData.has(e)){this.releaseGPUData(e);var t=this.texData.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.texData.delete(e)}}},t.prototype.releaseGPUData=function(e){var t=this.texData.get(e),n=t.texture,r=t.dtype,i=t.texShape,a=t.usage,o=t.isPacked,s=t.slice,u=s&&s.origDataId||e,c=this.dataRefCount.get(u);c>1?this.dataRefCount.set(u,c-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(i,r),this.textureManager.releaseTexture(n,i,a,o)));var l=this.texData.get(e);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null},t.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},t.prototype.getDataInfo=function(e){return this.texData.get(e)},t.prototype.getCPUBackend=function(){return f().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=We.findBackend("cpu")),this.cpuBackend):null},t.prototype.shouldExecuteOnCPU=function(e,t){var n=this;return void 0===t&&(t=128),null!=this.getCPUBackend()&&e.every((function(e){return null==n.texData.get(e.dataId).texture&&j(e.shape)<t}))},t.prototype.getGPGPUContext=function(){return this.gpgpu},t.prototype.complex=function(e,t){var n=this.makeOutput(e.shape,"complex64");return this.texData.get(n.dataId).complexTensors={real:We.keep(e.clone()),imag:We.keep(t.clone())},n},t.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,t,n){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,t,n);if(0===j(n))return Rn([],n,e.dtype);var r=this.texData.get(e.dataId).isPacked,i=Qi(e.shape,t,n);if(r||!i){var a=f().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ts(n):new Qo(n),o=a.getCustomSetupFunc(t);return this.compileAndRun(a,[e],null,o)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,t,n)},t.prototype.shallowSlice=function(e,t,n){var r=this.texData.get(e.dataId),i=this.makeOutput(n,e.dtype),a=this.texData.get(i.dataId);Object.assign(a,r),a.shape=n,a.dtype=e.dtype;var o=ea(t,e.strides);r.slice&&(o+=r.slice.flatOffset),a.slice={flatOffset:o,origDataId:r.slice&&r.slice.origDataId||e.dataId};var s=this.dataRefCount.get(a.slice.origDataId)||1;return this.dataRefCount.set(a.slice.origDataId,s+1),i},t.prototype.stridedSlice=function(e,t,n,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,t,n,r);var i=$i(t,n,r);if(i.some((function(e){return 0===e})))return Rn([],i);var a=new function(e,t,n){this.variableNames=["x"],this.outputShape=n;var r=n.length,i=oo(n.length),a=oo(n.length),o="";if(1===r)o="coords * strides + begin";else{var s=0;o=n.map((function(e,t){return s++,1===n.length?"coords * strides["+t+"] + begin["+t+"]":"coords["+(s-1)+"] * strides["+t+"] + begin["+t+"]"})).join(",")}this.userCode="\n      "+i+" begin = "+i+"("+e+");\n      "+i+" strides = "+i+"("+t+");\n\n      void main() {\n        "+a+" coords = getOutputCoords();\n        setOutput(getX("+o+"));\n      }\n    "}(t,r,i);return this.compileAndRun(a,[e])},t.prototype.reverse=function(e,t){var n=f().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new function(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");this.outputShape=e;var r=Ka("rc",n),i=r[n-1]+" + 1 < "+this.outputShape[n-1],a=r[n-2]+" + 1 < "+this.outputShape[n-2],o=oo(n);function s(n){var r=e.map((function(r,i){return function(n,r){return-1!==t.indexOf(n)&&1!==e[n]?e[n]+" - "+r[n]+" - 1":""+r[n]}(i,n)}));return"getChannel(getX("+r.join(",")+"), vec2("+r.slice(-2).join(",")+"))"}this.userCode=1===n?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+e[0]+" - rc - 1),\n            "+e[0]+" - rc - 1);\n          if("+i+"){\n              result.g = getChannel(getX("+e[0]+" - (rc  + 1) - 1),\n                "+e[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+o+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+s(r.slice())+";\n          if("+i+"){\n            result.g = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",s(e)}(r.slice())+";\n          }\n          if("+a+") {\n            result.b = "+function(e){return e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())+";\n            if("+i+") {\n              result.a = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "}(e.shape,t):new function(e,t){this.variableNames=["x"];var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=e,1!==n){var r=e.map((function(n,r){return function(n){return-1!==t.indexOf(n)&&1!==e[n]?e[n]+" - coords["+n+"] - 1":"coords["+n+"]"}(r)})).join(","),i=oo(n);this.userCode="\n      void main() {\n        "+i+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+e[0]+" - coord - 1));\n        }\n      "}(e.shape,t);return this.compileAndRun(n,[e])},t.prototype.concat=function(e,t){if("complex64"===e[0].dtype){var n=e.map((function(e){return In(e)})),r=e.map((function(e){return Nn(e)}));return Fn(this.concat(n,t),this.concat(r,t))}if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,t);if(1===e.length)return e[0];if(e.length>f().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var i=Math.floor(e.length/2),a=this.concat(e.slice(0,i),t),o=this.concat(e.slice(i),t);return this.concat([a,o],t)}if(f().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var s=new function(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=jn(e,t);var n=this.outputShape,r=n.length,i=oo(r),a=Ka("coords",r),o=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((function(e,t){return"T"+t}));var s=new Array(e.length-1);s[0]=e[0][t];for(var u=1;u<s.length;u++)s[u]=s[u-1]+e[u][t];var c=o[t],l=o.slice(-2),f=o.join(),d="if ("+c+" < "+s[0]+") {\n        return getChannel(\n            getT0("+f+"), vec2("+l.join()+"));\n        }";for(u=1;u<s.length;u++){var h=s[u-1];d+="\n        if ("+c+" < "+s[u]+"  && "+c+" >= "+s[u-1]+") {\n          return getChannel(\n            getT"+u+"("+xo(o,c,h)+"),\n            vec2("+xo(l,c,h)+"));\n        }"}var p=s.length,m=s[s.length-1];d+="\n        return getChannel(\n          getT"+p+"("+xo(o,c,m)+"),\n          vec2("+xo(l,c,m)+"));",this.userCode="\n      float getValue("+o.map((function(e){return"int "+e}))+") {\n        "+d+"\n      }\n\n      void main() {\n        "+i+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+a+"), 0., 0., 0.);\n\n        "+a[r-1]+" = "+a[r-1]+" + 1;\n        if ("+a[r-1]+" < "+n[r-1]+") {\n          result.g = getValue("+a+");\n        }\n\n        "+a[r-2]+" = "+a[r-2]+" + 1;\n        if ("+a[r-2]+" < "+n[r-2]+") {\n          result.a = getValue("+a+");\n        }\n\n        "+a[r-1]+" = "+a[r-1]+" - 1;\n        if ("+a[r-2]+" < "+n[r-2]+" &&\n            "+a[r-1]+" < "+n[r-1]+") {\n          result.b = getValue("+a+");\n        }\n        setOutput(result);\n      }\n    "}(e.map((function(e){return e.shape})),t);return this.compileAndRun(s,e)}var u=jn(e.map((function(e){return e.shape})),t),c=e.map((function(e){return e.as2D(-1,j(e.shape.slice(t)))})),l=new function(e){this.outputShape=[],this.outputShape=jn(e,1),this.variableNames=e.map((function(e,t){return"T"+t}));var t=new Array(e.length-1);t[0]=e[0][1];for(var n=1;n<t.length;n++)t[n]=t[n-1]+e[n][1];var r=["if (yC < "+t[0]+") setOutput(getT0(yR, yC));"];for(n=1;n<t.length;n++){var i=t[n-1];r.push("else if (yC < "+t[n]+") setOutput(getT"+n+"(yR, yC-"+i+"));")}var a=t.length,o=t[t.length-1];r.push("else setOutput(getT"+a+"(yR, yC-"+o+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+r.join("\n        ")+"\n      }\n    "}(c.map((function(e){return e.shape})));return this.compileAndRun(l,c).reshape(u)},t.prototype.neg=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.neg(e);if(f().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,ps,e.dtype);var t=new ss(e.shape,ps);return this.compileAndRun(t,[e])},t.prototype.batchMatMul=function(e,t,n,r){var i=n?e.shape[2]:e.shape[1],a=r?t.shape[1]:t.shape[2],o=n?e.shape[1]:e.shape[2],s=e.shape[0];if((1===i||1===a)&&o>1e3){n&&(e=fa(e,[0,2,1])),r&&(t=fa(t,[0,2,1]));var u=1===a?e:e.as3D(s,o,1),c=1===a?2:1,l=1===a?t.as3D(s,1,o):t;return this.multiply(u,l).sum(c,!0)}var f=Fe(e.dtype,t.dtype),d=new Ko(e.shape,[s,i,a],n,r);return this.compileAndRun(d,[e,t],f)},t.prototype.fusedBatchMatMul=function(e){var t=e.a,n=e.b,r=e.transposeA,i=e.transposeB,a=e.bias,o=e.activation,s=e.preluActivationWeights,u=r?t.shape[2]:t.shape[1],c=i?n.shape[1]:n.shape[2],l=t.shape[0],f=Fe(t.dtype,n.dtype),d=null!=a,h=null!=s,p=o?Cs(o,!0):null,m=new Ko(t.shape,[l,u,c],r,i,d,p,h),v=[t,n];return a&&v.push(a),s&&v.push(s),this.compileAndRun(m,v,f)},t.prototype.multiply=function(e,t){if("complex64"===e.dtype){var n=this.texData.get(e.dataId),r=this.texData.get(t.dataId),i=new co("return areal * breal - aimag * bimag;",e.shape,t.shape),a=new co("return areal * bimag + aimag * breal;",e.shape,t.shape),o=[this.makeComplexComponentTensorInfo(e,n.complexTensors.real),this.makeComplexComponentTensorInfo(e,n.complexTensors.imag),this.makeComplexComponentTensorInfo(t,r.complexTensors.real),this.makeComplexComponentTensorInfo(t,r.complexTensors.imag)],s=this.compileAndRun(i,o),u=this.compileAndRun(a,o),c=this.complex(s,u);return s.dispose(),u.dispose(),c}if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.multiply(e,t);if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,ho,e.dtype);var l=new mo(ho,e.shape,t.shape);return this.compileAndRun(l,[e,t],e.dtype)},t.prototype.batchNormalization=function(e,t,n,r,i,a){var o=[e,t,n],s=null;null!=a&&(s=a.shape,o.push(a));var u=null;if(null!=i&&(u=i.shape,o.push(i)),f().getBool("WEBGL_PACK_NORMALIZATION")){var c=new function(e,t,n,r,i,a){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Ur(e,t),Ur(e,n);var o="vec4(0.0)";null!=r&&(Ur(e,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var s="vec4(1.0)";null!=i&&(Ur(e,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        vec4 offset = "+o+";\n        vec4 scale = "+s+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+a+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "}(e.shape,t.shape,n.shape,s,u,r);return this.compileAndRun(c,o)}var l=new function(e,t,n,r,i,a){this.outputShape=[],this.variableNames=["x","mean","variance"],Ur(e,t),Ur(e,n);var o="0.0";null!=r&&(Ur(e,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var s="1.0";null!=i&&(Ur(e,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+o+";\n        float scale = "+s+";\n        float inv = scale * inversesqrt(variance + float("+a+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "}(e.shape,t.shape,n.shape,s,u,r);return this.compileAndRun(l,o)},t.prototype.localResponseNormalization4D=function(e,t,n,r,i){var a=f().getBool("WEBGL_PACK_NORMALIZATION")?new function(e,t,n,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var a,o=t,s=e[3]-1;this.outputShape=e;var u="float("+n+") + float("+r+") * sum";a=.5===i?"inversesqrt("+u+")":1===i?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+o+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+o+"; j <= "+o+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+s+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+a+";\n        setOutput(result);\n      }\n    "}(e.shape,t,n,r,i):new function(e,t,n,r,i){this.variableNames=["x"],this.outputShape=[];var a,o=t,s=e[3]-1;this.outputShape=e;var u="float("+n+") + float("+r+") * sum";a=.5===i?"inversesqrt("+u+")":1===i?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+o+"; j <= "+o+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+s+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+a+";\n        setOutput(val);\n      }\n    "}(e.shape,t,n,r,i);return this.compileAndRun(a,[e])},t.prototype.LRNGrad=function(e,t,n,r,i,a,o){var s=new function(e,t,n,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=i,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+t+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+t+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+n+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+i+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+i+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "}(t.shape,r,i,a,o);return this.compileAndRun(s,[t,n,e])},t.prototype.tile=function(e,t){if("string"===e.dtype){var n=this.readSync(e.dataId).map((function(e){return ce(e)}));return Ga(ar(e.shape,e.dtype,n),t)}var r=new function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[r]*t[r];this.outputShape=n,this.rank=n.length;var i=oo(this.rank),a=function(e){var t=e.length;if(t>5)throw Error("Tile for rank "+t+" is not yet supported");if(1===t)return"imod(resRC, "+e[0]+")";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],i=0;i<e.length;i++)r.push("imod("+n[i]+", "+e[i]+")");return r.join()}(e);this.userCode="\n      void main() {\n        "+i+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "}(e.shape,t);return this.compileAndRun(r,[e])},t.prototype.pad=function(e,t,n){var r=f().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new function(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((function(t,n){return t[0]+e[n]+t[1]}));for(var r=e.length,i=oo(r),a=t.map((function(e){return e[0]})).join(","),o=t.map((function(t,n){return t[0]+e[n]})).join(","),s=Ka("rc",r),u=Ka("source",r),c=s[r-1]+" < "+this.outputShape[r-1],l=1===r?"source":"vec2("+u.slice(-2).join()+")",f=[i+" rc = outputLoc;",s[r-1]+" += 1;\n       if("+c+") {\n      ",1===r?"":"}\n       rc = outputLoc;\n       "+s[r-2]+" += 1;\n       if("+s[r-2]+" < "+this.outputShape[r-2]+") {",1===r?"":"  "+s[r-1]+" += 1;\n         if("+c+") {"],d=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",h="",p=0,m=1===r?2:4;p<m;p++)h+="\n        "+f[p]+"\n        if ("+d+") {\n          result["+p+"] = float("+n+");\n        } else {\n          "+i+" source = rc - start;\n          result["+p+"] = getChannel(getX("+u.join()+"), "+l+");\n        }\n      ";h+=1===r?"} ":"}}",this.userCode="\n      const "+i+" start = "+i+"("+a+");\n      const "+i+" end = "+i+"("+o+");\n\n      void main() {\n        "+i+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+h+"\n        setOutput(result);\n      }\n    "}(e.shape,t,n):new function(e,t,n){this.variableNames=["x"],this.outputShape=t.map((function(t,n){return t[0]+e[n]+t[1]}));var r=e.length,i=oo(r),a=t.map((function(e){return e[0]})).join(","),o=t.map((function(t,n){return t[0]+e[n]})).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+i+" start = "+i+"("+a+");\n      "+i+" end = "+i+"("+o+");\n\n      void main() {\n        "+i+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+n+"));\n        } else {\n          "+i+" coords = outC - start;\n          setOutput(getX("+s+"));\n        }\n      }\n    ":"\n        int start = "+a+";\n        int end = "+o+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+n+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "}(e.shape,t,n);return this.compileAndRun(r,[e])},t.prototype.gather=function(e,t,n){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.gather(e,t,n);var r=new function(e,t,n){this.variableNames=["A","indices"];var r=e.slice();r[n]=t,this.outputShape=r,this.rank=r.length;var i=oo(this.rank),a=function(e,t){var n=e.length;if(n>4)throw Error("Gather for rank "+n+" is not yet supported");if(1===n)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],a=0;a<e.length;a++)a===t?i.push("int(getIndices("+r[a]+"))"):i.push(""+r[a]);return i.join()}(e,n);this.userCode="\n      void main() {\n        "+i+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "}(e.shape,t.size,n);return this.compileAndRun(r,[e,t])},t.prototype.batchToSpaceND=function(e,t,n){A(e.rank<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var r=t.reduce((function(e,t){return e*t})),i=yr(e.shape,t,r),a=br(i.length,t.length),o=xr(e.shape,t,r),s=wr(n,t.length),u=_r(o,n,t.length);return fa(e.reshape(i),a).reshape(o).slice(s,u)},t.prototype.spaceToBatchND=function(e,t,n){A(e.rank<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var r=t.reduce((function(e,t){return e*t})),i=[[0,0]];i.push.apply(i,n);for(var a=1+t.length;a<e.shape.length;++a)i.push([0,0]);var o=e.pad(i),s=yr(o.shape,t,r,!1),u=br(s.length,t.length,!1),c=xr(o.shape,t,r,!1);return fa(o.reshape(s),u).reshape(c)},t.prototype.reduce=function(e,t,n){var r=e.shape[0],i=e.shape[1],a=new function(e,t){this.variableNames=["x"];var n=e.windowSize,r=e.batchSize,i=e.inSize,a=Math.ceil(i/n);this.outputShape=[r,a];var o="0.0",s="";"prod"===t?o="1.0":"min"===t?(o="1.0 / 1e-20",s="min"):"max"===t&&(o="-1.0 / 1e-20",s="max");var u=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===t?u="sumValue":"prod"===t?u="prodValue":"all"===t?u="allValue":"any"===t&&(u="anyValue");var c=4*Math.floor(n/4),l=n%4,f="\n      if ("+("sum"===t)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===t)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",d="vec4";"all"===t?(o="1.0",f="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",d="bvec4"):"any"===t&&(o="0.0",f="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",d="bvec4");var h="";i%n>0&&(h="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+o+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+h+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+n+";\n\n        vec4 minMaxValue = vec4("+o+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+c+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+f+"\n        }\n\n        int inIdx = inOffset + "+c+";\n        if ("+(1===l)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+f+"\n        } else if ("+(2===l)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+f+"\n        } else if ("+(3===l)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+f+"\n        }\n        setOutput("+u+");\n      }\n    "}({windowSize:Vi(i),inSize:i,batchSize:r},t),o=this.compileAndRun(a,[e],n);return 1===o.shape[1]?o:this.reduce(o,t,n)},t.prototype.argReduce=function(e,t,n){void 0===n&&(n=null);var r=e.shape[0],i=e.shape[1];null!=n&&(r=n.shape[0],i=n.shape[1]);var a=new function(e,t,n){this.variableNames=["A"];var r=e.windowSize,i=e.batchSize,a=e.inSize,o=Math.ceil(a/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];var s="max"===t?">":"<",u=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+u+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+s+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "}({windowSize:Vi(i),inSize:i,batchSize:r},t,null==n),o=[e];null!=n&&o.push(n);var s=this.compileAndRun(a,o,"int32");return 1===s.shape[1]?s:this.argReduce(e,t,s)},t.prototype.argReducePacked=function(e,t,n){void 0===n&&(n=null);var r=null!=n?n.shape:e.shape,i=new function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,A(e.length>2,(function(){return"Packed arg"+(n.charAt(0).toUpperCase()+n.slice(1))+" supports only inputs with rank above 2."}));var i=e[e.length-1],a=Math.ceil(i/t);this.outputShape=e.slice(0,-1),a>1&&this.outputShape.push(a),r||this.variableNames.push("bestIndicesA");var o,s,u=this.outputShape,c=u.length,l=oo(c),f=Ka("coords",c);if(1===a){var d=oo(s=c+1);o="\n        "+d+" sourceLocR = "+d+"("+f.join()+", 0);\n        ++"+f[c-1]+";\n        "+d+" sourceLocG = "+d+"("+f.join()+", 0);\n        ++"+f[c-2]+";\n        "+d+" sourceLocA = "+d+"("+f.join()+", 0);\n        --"+f[c-1]+";\n        "+d+" sourceLocB = "+d+"("+f.join()+", 0);\n        --"+f[c-2]+";"}else s=c,o="\n        "+l+" sourceLocR = coords;\n        ++"+f[c-1]+";\n        "+l+" sourceLocG = coords;\n        ++"+f[c-2]+";\n        "+l+" sourceLocA = coords;\n        --"+f[c-1]+";\n        "+l+" sourceLocB = coords;\n        --"+f[c-2]+";";var h=["x","y","z","w","u","v"].slice(0,s),p="."+h[s-1],m=h.map((function(e){return"int "+e})),v=Ka("sourceLocR",s-1).concat("inIdx.r"),g=Ka("sourceLocG",s-1).concat("inIdx.g"),y=Ka("sourceLocB",s-1).concat("inIdx.b"),b=Ka("sourceLocA",s-1).concat("inIdx.a"),x="max"===n?"greaterThan":"lessThan",w=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+v.join()+"),\n                             getBestIndicesAChannel("+g.join()+"),\n                             getBestIndicesAChannel("+y.join()+"),\n                             getBestIndicesAChannel("+b.join()+")));",_="vec4(\n            getAChannel("+v.join()+"),\n            hasNextCol ? getAChannel("+g.join()+") : 0.,\n            hasNextRow ? getAChannel("+y.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+b.join()+") : 0.)",k=r?"":"\n      float getBestIndicesAChannel("+m.join()+") {\n        return getChannel(getBestIndicesA("+h.join()+"),\n                                          vec2("+h.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+m.join()+") {\n        return getChannel(getA("+h.join()+"),\n                               vec2("+h.slice(-2).join()+"));\n      }\n      "+k+"\n      void main() {\n        "+l+" coords = getOutputCoords();\n        bool hasNextCol = "+f[c-1]+" < "+(u[c-1]-1)+";\n        bool hasNextRow = "+f[c-2]+" < "+(u[c-2]-1)+";\n        "+o+"\n        ivec4 srcIdx = ivec4(sourceLocR"+p+", sourceLocG"+p+",\n          sourceLocB"+p+", sourceLocA"+p+") * "+t+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+_+";\n\n        for (int i = 0; i < "+t+"; i++) {\n          inIdx = srcIdx;\n          "+w+"\n          vec4 candidate = "+_+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+x+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "}(r,Vi(r[r.length-1]),t,null==n),a=null==n?[e]:[e,n],o=this.compileAndRun(i,a,"int32");return o.rank===e.rank?this.argReducePacked(e,t,o):o},t.prototype.sum=function(e,t){Cn("sum",t,e.rank);var n=En(e.shape,t),r=n[0],i=j(n[1]),a=e.as2D(-1,i),o=Ie(e.dtype);return this.reduce(a,"sum",o).reshape(r)},t.prototype.prod=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,t);var n=En(e.shape,t),r=n[0],i=j(n[1]),a=e.as2D(-1,i),o=Ie(e.dtype);return this.reduce(a,"prod",o).reshape(r)},t.prototype.unsortedSegmentSum=function(e,t,n){var r=0,i=An([r],e.rank),a=e;null!=i&&(a=fa(e,i),r=Dn(1,e.rank)[0]);var o=function(e,t,n){for(var r=[],i=e.length,a=0;a<i;a++)a!==t?r.push(e[a]):r.push(n);return r}(a.shape,r,n),s=j([a.shape[r]]),u=a.as2D(-1,s),c=Ie(e.dtype),l=this.segOpCompute(u,"unsortedSegmentSum",t,c,n).reshape(o);return null!=i&&(l=fa(l,On(i))),l},t.prototype.segOpCompute=function(e,t,n,r,i){var a=e.shape[0],o=e.shape[1],s=function(e,t){var n,r=!1;for(e<=Wi?(n=e,r=!0):n=ee(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=ee(e,n+1);return n}(o,i),u=new function(e,t){this.variableNames=["x","segmentIds"];var n=e.windowSize,r=e.batchSize,i=e.inSize,a=e.numSegments,o=a*Math.ceil(i/n);this.outputShape=[r,o];var s=4*Math.floor(n/4),u=n%4,c="\n        sumValue += dot(values, segFilter);\n    ",l="";i%n>0&&(l="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return initializationValue;\n        }\n      ");var f="";i%n>0&&(f="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+l+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+f+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+a+")) * float("+n+"));\n        int currentSeg = int(mod(float(outIdx), float("+a+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+s+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+c+"\n        }\n\n        int inIdx = inOffset + "+s+";\n        if ("+(1===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+c+"\n        } else if ("+(2===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+c+"\n        } else if ("+(3===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+c+"\n        }\n        setOutput(sumValue);\n      }\n    "}({windowSize:s,inSize:o,batchSize:a,numSegments:i},t),c=this.compileAndRun(u,[e,n],r);return c.shape[1]===i?c:(n=$n(0,i).tile([o/s]),this.segOpCompute(c,t,n,r,i))},t.prototype.argMinMaxReduce=function(e,t,n){var r=[t];if(Cn("arg"+n.charAt(0).toUpperCase()+n.slice(1),r,e.rank),!f().getBool("WEBGL_PACK_REDUCE")||e.rank<=2){var i=En(e.shape,r),a=i[0],o=j(i[1]),s=e.as2D(-1,o);return this.argReduce(s,n).reshape(a)}return this.argReducePacked(e,n)},t.prototype.argMin=function(e,t){return this.argMinMaxReduce(e,t,"min")},t.prototype.argMax=function(e,t){return this.argMinMaxReduce(e,t,"max")},t.prototype.cumsum=function(e,t,n,r){if(t!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+t);var i=new function(e,t,n){this.variableNames=["x"],this.outputShape=e;var r=e.length,i=e[e.length-1],a=n?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(n?"return "+i+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+oo(r)+" coords = getOutputCoords();\n        int end = "+Eo(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+i+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+a+" end) {\n            continue;\n          }\n          if (idx == end && "+t+") {\n            continue;\n          }\n          "+Eo(r,"coords")+" = idx;\n          val += getX("+function(e,t){if(1===e)return""+t;if(2===e)return t+".x, "+t+".y";if(3===e)return t+".x, "+t+".y, "+t+".z";if(4===e)return t+".x, "+t+".y, "+t+".z, "+t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}(r,"coords")+");\n        }\n        setOutput(val);\n      }\n    "}(e.shape,n,r);return this.compileAndRun(i,[e])},t.prototype.equal=function(e,t){if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(equal(a, b));\n","bool");var n=new mo("return float(a == b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.notEqual=function(e,t){if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(notEqual(a, b));\n","bool");var n=new mo("return float(a != b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.less=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.less(e,t);if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThan(a, b));\n","bool");var n=new mo("return float(a < b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.lessEqual=function(e,t){if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThanEqual(a, b));\n","bool");var n=new mo("return float(a <= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.greater=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.greater(e,t);if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThan(a, b));\n","bool");var n=new mo("return float(a > b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.greaterEqual=function(e,t){if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var n=new mo("return float(a >= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.logicalNot=function(e){var t=new ss(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(t,[e])},t.prototype.logicalAnd=function(e,t){if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var n=new mo("return float(a >= 1.0 && b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.logicalOr=function(e,t){if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var n=new mo("return float(a >= 1.0 || b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.select=function(e,t,n){var r=new function(e,t,n){var r,i;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error("Where for rank "+n+" is not yet supported");if(1===n)i="resRC",r="resRC";else{for(var a=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],s=[],u=0;u<t.length;u++)s.push(""+a[u]),u<e&&o.push(""+a[u]);r=o.join(),i=s.join()}var c=oo(n);this.userCode="\n      void main() {\n        "+c+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+i+"));\n        } else {\n          setOutput(getB("+i+"));\n        }\n      }\n    "}(e.rank,t.shape,t.rank);return this.compileAndRun(r,[e,t,n],Fe(t.dtype,n.dtype))},t.prototype.where=function(e){gn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return Ha(e.shape,t)},t.prototype.topk=function(e,t,n){return qa(e.dataSync(),e.shape,e.dtype,t)},t.prototype.min=function(e,t){Cn("min",t,e.rank);var n=En(e.shape,t),r=n[0],i=j(n[1]),a=e.as2D(-1,i);return this.reduce(a,"min",a.dtype).reshape(r)},t.prototype.minimum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.minimum(e,t);var n=f().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new go("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new mo("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.mod=function(e,t){var n=f().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new go("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new mo("if (b == 0.0) return NAN;\n  return mod(a, b);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.max=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,t);Cn("max",t,e.rank);var n=En(e.shape,t),r=n[0],i=j(n[1]),a=e.as2D(-1,i);return this.reduce(a,"max",a.dtype).reshape(r)},t.prototype.maximum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.maximum(e,t);var n=f().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new go("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new mo("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.all=function(e,t){Cn("all",t,e.rank);var n=En(e.shape,t),r=n[0],i=j(n[1]),a=e.as2D(-1,i);return this.reduce(a,"all",a.dtype).reshape(r)},t.prototype.any=function(e,t){Cn("any",t,e.rank);var n=En(e.shape,t),r=n[0],i=j(n[1]),a=e.as2D(-1,i);return this.reduce(a,"any",a.dtype).reshape(r)},t.prototype.floorDiv=function(e,t){if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var n=new mo("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",e.shape,t.shape);return this.compileAndRun(n,[e,t],"int32")},t.prototype.add=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,lo);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.add(e,t);var n=Fe(e.dtype,t.dtype);if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,lo,n);var r=new mo(lo,e.shape,t.shape);return this.compileAndRun(r,[e,t],n)},t.prototype.packedUnaryOp=function(e,t,n){var r=new Es(e.shape,t);return this.compileAndRun(r,[e],n)},t.prototype.packedBinaryOp=function(e,t,n,r,i){void 0===i&&(i=!1);var a=new go(n,e.shape,t.shape,i);return this.compileAndRun(a,[e,t],r)},t.prototype.complexSeparableBinaryOp=function(e,t,n){var r=this,i=this.texData.get(e.dataId),a=this.texData.get(t.dataId),o=[[i.complexTensors.real,a.complexTensors.real],[i.complexTensors.imag,a.complexTensors.imag]].map((function(i){var a=i[0],o=i[1],s=r.makeComplexComponentTensorInfo(e,a),u=r.makeComplexComponentTensorInfo(t,o),c=new mo(n,e.shape,t.shape);return r.compileAndRun(c,[s,u],Fe(a.dtype,o.dtype))})),s=o[0],u=o[1],c=this.complex(s,u);return s.dispose(),u.dispose(),c},t.prototype.makeComplexComponentTensorInfo=function(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}},t.prototype.addN=function(e){if(1===e.length)return e[0];if(e.length>f().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var t=Math.floor(e.length/2),n=this.addN(e.slice(0,t)),r=this.addN(e.slice(t));return this.addN([n,r])}var i=e.map((function(e){return e.dtype})).reduce((function(e,t){return Fe(e,t)})),a=e.map((function(e){return e.shape})),o=f().getBool("WEBGL_PACK")?new function(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((function(e,t){return"T"+t}));var n=[];this.variableNames.forEach((function(e){n.push("vec4 v"+e+" = get"+e+"AtOutCoords();")}));var r=this.variableNames.map((function(e){return"v"+e})).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        vec4 result = "+r+";\n        setOutput(result);\n      }\n    "}(e[0].shape,a):new function(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((function(e,t){return"T"+t}));var n=[];this.variableNames.forEach((function(e){n.push("float v"+e+" = get"+e+"AtOutCoords();")}));var r=this.variableNames.map((function(e){return"v"+e})).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        float result = "+r+";\n        setOutput(result);\n      }\n    "}(e[0].shape,a);return this.compileAndRun(o,e,i)},t.prototype.subtract=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,fo);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.subtract(e,t);var n=Fe(e.dtype,t.dtype);if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,fo,e.dtype);var r=new mo(fo,e.shape,t.shape);return this.compileAndRun(r,[e,t],n)},t.prototype.pow=function(e,t){var n=f().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new go("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new mo("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",e.shape,t.shape),r=Fe(e.dtype,t.dtype);return this.compileAndRun(n,[e,t],r)},t.prototype.ceil=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.ceil(e);if(f().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,ms,e.dtype);var t=new ss(e.shape,ms);return this.compileAndRun(t,[e])},t.prototype.floor=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.floor(e);if(f().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,vs,e.dtype);var t=new ss(e.shape,vs);return this.compileAndRun(t,[e])},t.prototype.sign=function(e){var t=new ss(e.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(t,[e])},t.prototype.isNaN=function(e){var t=new ss(e.shape,"return float(isnan(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.isInf=function(e){var t=new ss(e.shape,"return float(isinf(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.isFinite=function(e){var t=new ss(e.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.round=function(e){var t=new ss(e.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(t,[e])},t.prototype.exp=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.exp(e);if(f().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,gs,e.dtype);var t=new ss(e.shape,gs);return this.compileAndRun(t,[e])},t.prototype.expm1=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.expm1(e);if(f().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,ys,e.dtype);var t=new ss(e.shape,ys);return this.compileAndRun(t,[e])},t.prototype.softmax=function(e,t){var n=L([t],e.shape),r=this.max(e,n),i=Sn(r.shape,n),a=this.subtract(e,r.reshape(i)),o=this.exp(a),s=this.sum(o,n).reshape(i);return Li(o,s)},t.prototype.log=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.log(e);if(f().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",e.dtype);var t=new ss(e.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(t,[e])},t.prototype.log1p=function(e){var t=new ss(e.shape,"return log(1.0 + x);");return this.compileAndRun(t,[e])},t.prototype.sqrt=function(e){var t=new ss(e.shape,"return sqrt(x);");return this.compileAndRun(t,[e])},t.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var t=new ss(e.shape,"return inversesqrt(x);");return this.compileAndRun(t,[e])},t.prototype.reciprocal=function(e){var t=new ss(e.shape,"return 1.0 / x;");return this.compileAndRun(t,[e])},t.prototype.relu=function(e){var t;return t=f().getBool("WEBGL_PACK")?new Es(e.shape,ws):new ss(e.shape,fs),this.compileAndRun(t,[e])},t.prototype.relu6=function(e){var t;return t=f().getBool("WEBGL_PACK")?new Es(e.shape,_s):new ss(e.shape,ds),this.compileAndRun(t,[e])},t.prototype.prelu=function(e,t){var n=f().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new go(vo,e.shape,t.shape):new mo(po,e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.elu=function(e){if(f().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,ks,e.dtype);var t=new ss(e.shape,hs);return this.compileAndRun(t,[e])},t.prototype.eluDer=function(e,t){var n=f().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new go("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",e.shape,t.shape):new mo("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.selu=function(e){var t=new ss(e.shape,"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = 1.7580993408473768;\n  float scale = 1.0507009873554805;\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n");return this.compileAndRun(t,[e])},t.prototype.int=function(e){var t=new ss(e.shape,"return float(int(x));");return this.compileAndRun(t,[e],"int32")},t.prototype.clip=function(e,t,n){var r,i=(r=f().getBool("WEBGL_PACK_CLIP")?new bo(e.shape):new yo(e.shape)).getCustomSetupFunc(t,n);return this.compileAndRun(r,[e],null,i)},t.prototype.abs=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.abs(e);if(f().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,ls,e.dtype);var t=new ss(e.shape,ls);return this.compileAndRun(t,[e])},t.prototype.complexAbs=function(e){var t=this.texData.get(e.dataId),n=new function(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}(e.shape),r=[this.makeComplexComponentTensorInfo(e,t.complexTensors.real),this.makeComplexComponentTensorInfo(e,t.complexTensors.imag)];return this.compileAndRun(n,r)},t.prototype.sigmoid=function(e){var t=new ss(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(t,[e])},t.prototype.softplus=function(e){var t=new ss(e.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(t,[e])},t.prototype.sin=function(e){var t=new ss(e.shape,"if (isnan(x)) return x;\n  return sin(x);\n");return this.compileAndRun(t,[e])},t.prototype.cos=function(e){var t=new ss(e.shape,"if (isnan(x)) return x;\n  return cos(x);\n");return this.compileAndRun(t,[e])},t.prototype.tan=function(e){var t=new ss(e.shape,"return tan(x);");return this.compileAndRun(t,[e])},t.prototype.asin=function(e){var t=new ss(e.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n");return this.compileAndRun(t,[e])},t.prototype.acos=function(e){var t=new ss(e.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n");return this.compileAndRun(t,[e])},t.prototype.atan=function(e){var t=new ss(e.shape,"if (isnan(x)) return x;\n  return atan(x);\n");return this.compileAndRun(t,[e])},t.prototype.atan2=function(e,t){var n=f().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new go("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new mo("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.sinh=function(e){var t=new ss(e.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},t.prototype.cosh=function(e){var t=new ss(e.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},t.prototype.tanh=function(e){var t=new ss(e.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(t,[e])},t.prototype.asinh=function(e){var t=new ss(e.shape,"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(t,[e])},t.prototype.acosh=function(e){var t=new ss(e.shape,"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));");return this.compileAndRun(t,[e])},t.prototype.atanh=function(e){var t=new ss(e.shape,"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;");return this.compileAndRun(t,[e])},t.prototype.erf=function(e){var t=new ss(e.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n');return this.compileAndRun(t,[e])},t.prototype.step=function(e,t){var n=new ss(e.shape,function(e){return void 0===e&&(e=0),us+"\n    return x > 0.0 ? 1.0 : float("+e+");\n  "}(t));return this.compileAndRun(n,[e])},t.prototype.conv2dByMatMul=function(e,t,n,r,i,a){var o=e.shape,s=this.texData.get(e.dataId),u=n.inChannels,c=o[0]*o[1]*o[2],l=n.outChannels,d="channelsLast"===n.dataFormat,h=(1===c||1===l)&&u>1e3,p=o[2]%2!=0&&!!s.isPacked;if(h||!f().getBool("WEBGL_LAZILY_UNPACK")||!f().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!p){var m=d?o[0]*o[1]*o[2]:o[0]*o[2]*o[3],v=this.reshape(e,[1,m,n.inChannels]),g=this.reshape(t,[1,n.inChannels,n.outChannels]);return this.reshape(this.fusedBatchMatMul({a:v,b:g,transposeA:!1,transposeB:!1,bias:r,activation:i,preluActivationWeights:a}),n.outShape)}var y=d?o[0]*o[1]*(o[2]+1):o[0]*o[2]*(o[3]+1),b={dataId:e.dataId,shape:[1,y,n.inChannels],dtype:e.dtype},x=s.shape;s.shape=s.shape.slice(),s.shape[s.shape.length-2]++,A(Pt(s.shape,b.shape),(function(){return"packed reshape "+s.shape+" to "+b.shape+" isn't free"}));var w=this.reshape(t,[1,n.inChannels,n.outChannels]),_=this.fusedBatchMatMul({a:b,b:w,transposeA:!1,transposeB:!1,bias:r,activation:i,preluActivationWeights:a}),k=this.texData.get(_.dataId);return A(k.isPacked,(function(){return"batchMatMul result is expected to be packed"})),s.shape=x,k.shape=n.outShape,We.makeTensorFromDataId(_.dataId,n.outShape,_.dtype)},t.prototype.conv2dWithIm2Row=function(e,t,n,r,i,a){var o=n.filterWidth,s=n.filterHeight,u=n.inChannels,c=n.outWidth,l=n.outHeight,f="channelsLast"===n.dataFormat,d=o*s*u,h=l*c,p=[d,h],m=e.squeeze([0]),v=t.reshape([1,d,-1]),g=new function(e,t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var r=n.filterWidth,i=n.inChannels,a=n.strideWidth,o=n.strideHeight,s=n.padInfo,u=n.outWidth,c=n.dilationWidth,l=n.dilationHeight,f=n.dataFormat,d=s.left,h=s.top,p=i*r,m=Ya(),v="channelsLast"===f,g=v?0:1,y=v?1:2,b="",x=0;x<=1;x++)for(var w=0;w<=1;w++)b+="\n          blockIndex = rc.y + "+w+";\n          pos = rc.x + "+x+";\n\n          if(blockIndex < "+e[1]+" && pos < "+e[0]+") {\n            offsetY = int(blockIndex / ("+u+")) * "+o+" - "+h+";\n            d0 = offsetY + "+l+" * (pos / "+p+");\n\n            if(d0 < "+t[g]+" && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), "+u+".) * "+a+". - "+d+".);\n              d1 = offsetX + "+c+" * (int(mod(float(pos), "+p+".) / "+i+".));\n\n              if(d1 < "+t[y]+" && d1 >= 0) {\n\n                ch = int(mod(float(pos), "+i+".));\n\n                if ("+v+") {\n                  innerDims = vec2(d1, ch);\n                  result["+(2*x+w)+"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result["+(2*x+w)+"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ";this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        "+b+"\n\n        "+m.output+" = result;\n      }\n    "}(p,m.shape,n),y=this.compileAndRun(g,[m]).reshape([1,p[0],p[1]]),b=null!=r,x=null!=a,w=i?Cs(i,!0):null,_=new Ko(y.shape,[1,h,n.outChannels],!0,!1,b,w,x),k=[y,v];r&&k.push(r),x&&k.push(a);var E=this.compileAndRun(_,k);return f?E.reshape([1,l,c,n.outChannels]):E.reshape([1,n.outChannels,l,c])},t.prototype.fusedConv2d=function(e){var t=e.input,n=e.filter,r=e.convInfo,i=e.bias,a=e.activation,o=e.preluActivationWeights;if(1===r.filterHeight&&1===r.filterWidth&&1===r.dilationHeight&&1===r.dilationWidth&&1===r.strideHeight&&1===r.strideWidth&&("SAME"===r.padInfo.type||"VALID"===r.padInfo.type))return this.conv2dByMatMul(t,n,r,i,a,o);if(f().getBool("WEBGL_CONV_IM2COL")&&1===t.shape[0])return this.conv2dWithIm2Row(t,n,r,i,a,o);var s=null!=i,u=null!=o,c=a?Cs(a,!1):null,l=new wo(r,s,c,u),d=[t,n];return i&&d.push(i),o&&d.push(o),this.compileAndRun(l,d)},t.prototype.conv2d=function(e,t,n){if(1===n.filterHeight&&1===n.filterWidth&&1===n.dilationHeight&&1===n.dilationWidth&&1===n.strideHeight&&1===n.strideWidth&&("SAME"===n.padInfo.type||"VALID"===n.padInfo.type))return this.conv2dByMatMul(e,t,n);if(f().getBool("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,t,n);var r=new wo(n);return this.compileAndRun(r,[e,t])},t.prototype.conv2dDerInput=function(e,t,n){var r=new function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,i=e.strideWidth,a="channelsLast"===e.dataFormat,o=t-1-e.padInfo.top,s=n-1-e.padInfo.left,u=a?1:2,c=a?2:3,l=a?3:1;this.userCode="\n      const ivec2 pads = ivec2("+o+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords["+l+"];\n\n        ivec2 dyCorner = ivec2(coords["+u+"], coords["+c+"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n\n              if ("+a+") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}(n);return this.compileAndRun(r,[e,t])},t.prototype.conv2dDerFilter=function(e,t,n){var r=new function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,a="channelsLast"===e.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+i+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              if ("+a+") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}(n);return this.compileAndRun(r,[e,t])},t.prototype.fusedDepthwiseConv2D=function(e){var t,n=e.input,r=e.filter,i=e.convInfo,a=e.bias,o=e.activation,s=e.preluActivationWeights,u=f().getBool("WEBGL_PACK_DEPTHWISECONV")&&i.strideWidth<=2&&i.outChannels/i.inChannels==1,c=o?Cs(o,u):null,l=[n,r],d=null!=a,h=null!=s;return d&&l.push(a),h&&l.push(s),u?(t=new ko(i,d,c,h),this.compileAndRun(t,l)):(t=new _o(i,d,c,h),this.compileAndRun(t,l))},t.prototype.depthwiseConv2D=function(e,t,n){var r;return f().getBool("WEBGL_PACK_DEPTHWISECONV")&&n.strideWidth<=2&&n.outChannels/n.inChannels==1?(r=new ko(n),this.compileAndRun(r,[e,t])):(r=new _o(n),this.compileAndRun(r,[e,t]))},t.prototype.depthwiseConv2DDerInput=function(e,t,n){var r=new function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,i=e.strideWidth,a=t-1-e.padInfo.top,o=n-1-e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+a+", "+o+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+s+"; dm++) {\n              int d2 = d1 * "+s+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}(n);return this.compileAndRun(r,[e,t])},t.prototype.depthwiseConv2DDerFilter=function(e,t,n){var r=new function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,a=e.outChannels/e.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+a+" + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+i+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3d=function(e,t,n){var r=new function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,i=e.strideDepth,a=e.strideHeight,o=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,l=e.filterDepth,f=e.filterHeight,d=e.filterWidth,h=4*Math.floor(e.inChannels/4),p=e.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+i+", "+a+", "+o+");\n      const ivec3 pads = ivec3("+t+", "+n+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+l+"; wF++) {\n          int xF = xFCorner + wF * "+s+";\n\n          if (xF < 0 || xF >= "+e.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+f+"; wR++) {\n            int xR = xRCorner + wR * "+u+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+d+"; wC++) {\n              int xC = xCCorner + wC * "+c+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+h+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===p)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+h+") *\n                  getW(wF, wR, wC, "+h+", d2);\n              } else if ("+(2===p)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+h+"),\n                  getX(batch, xF, xR, xC, "+h+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+h+", d2),\n                  getW(wF, wR, wC, "+h+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===p)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+h+"),\n                  getX(batch, xF, xR, xC, "+h+" + 1),\n                  getX(batch, xF, xR, xC, "+h+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+h+", d2),\n                  getW(wF, wR, wC, "+h+" + 1, d2),\n                  getW(wF, wR, wC, "+h+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3dDerInput=function(e,t,n){var r=new function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,i=e.strideDepth,a=e.strideHeight,o=e.strideWidth,s=t-1-e.padInfo.front,u=n-1-e.padInfo.top,c=r-1-e.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3("+s+", "+u+", "+c+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+t+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+i+".0;\n\n          if (dyF < 0.0 || dyF >= "+e.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+t+" - 1 - wF;\n\n          for (int wR = 0; wR < "+n+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+a+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+n+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+o+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3dDerFilter=function(e,t,n){var r=new function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,i=e.padInfo.front,a=e.padInfo.top,o=e.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yF = 0; yF < "+e.outDepth+"; yF++) {\n            int xF = wF + yF * "+t+" - "+i+";\n\n            if (xF < 0 || xF >= "+e.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n              int xR = wR + yR * "+n+" - "+a+";\n\n              if (xR < 0 || xR >= "+e.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n                int xC = wC + yC * "+r+" - "+o+";\n\n                if (xC < 0 || xC >= "+e.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}(n);return this.compileAndRun(r,[e,t])},t.prototype.maxPool=function(e,t){var n=new $o(t,"max",!1);return this.compileAndRun(n,[e])},t.prototype.avgPool=function(e,t){var n=new $o(t,"avg",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.maxPoolBackprop=function(e,t,n,r){var i=new $o(r,"max",!0),a=this.compileAndRun(i,[t]),o=new function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,i=e.effectiveFilterHeight,a=e.effectiveFilterWidth,o=i-1-e.padInfo.top,s=a-1-e.padInfo.left,u=i*a-1;this.userCode="\n      const ivec2 pads = ivec2("+o+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+i+";\n          wR += "+r+") {\n          float dyR = float(dyRCorner + wR) / "+t+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+a+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+u+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+a+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}(r),s=this.compileAndRun(o,[e,a],t.dtype);return a.dispose(),s},t.prototype.avgPoolBackprop=function(e,t,n){var r=new function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,i=e.strideWidth,a=e.dilationHeight,o=e.dilationWidth,s=e.effectiveFilterHeight,u=e.effectiveFilterWidth,c=s-1-e.padInfo.top,l=u-1-e.padInfo.left,f=1/(t*n);this.userCode="\n      const ivec2 pads = ivec2("+c+", "+l+");\n      const float avgMultiplier = float("+f+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+";\n            wR += "+a+") {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+u+";\n            wC+= "+o+") {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}(n);return this.compileAndRun(r,[e],t.dtype)},t.prototype.cast=function(e,t){return Aa(e,t,this)},t.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),i=0,a=0;a<e.rank;a++)a!==t&&(r[i++]=e.shape[a]);var o=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;var u=new Array(n);for(a=0;a<u.length;a++)o[t]=a,u[a]=this.slice(e,o,s).reshape(r);return u},t.prototype.avgPool3d=function(e,t){var n=new Jo(t,"avg",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.avgPool3dBackprop=function(e,t,n){var r=new function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,i=e.strideDepth,a=e.strideHeight,o=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,l=e.effectiveFilterDepth,f=e.effectiveFilterHeight,d=e.effectiveFilterWidth,h=l-1-e.padInfo.front,p=f-1-e.padInfo.top,m=d-1-e.padInfo.left,v=1/(t*n*r);this.userCode="\n      const ivec3 pads = ivec3("+h+", "+p+", "+m+");\n      const float avgMultiplier = float("+v+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+l+";\n            wD += "+s+") {\n          float dyD = float(dyDCorner + wD) / "+i+".0;\n\n          if (dyD < 0.0 || dyD >= "+e.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+f+";\n              wR += "+u+") {\n            float dyR = float(dyRCorner + wR) / "+a+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+d+";\n                wC += "+c+") {\n              float dyC = float(dyCCorner + wC) / "+o+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}(n);return this.compileAndRun(r,[e],t.dtype)},t.prototype.maxPool3d=function(e,t){var n=new Jo(t,"max",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.maxPool3dBackprop=function(e,t,n,r){var i=new Jo(r,"max",!0),a=this.compileAndRun(i,[t]),o=new function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,i=e.dilationDepth,a=e.dilationHeight,o=e.dilationWidth,s=e.effectiveFilterDepth,u=e.effectiveFilterHeight,c=e.effectiveFilterWidth,l=s-1-e.padInfo.front,f=u-1-e.padInfo.top,d=c-1-e.padInfo.left,h=s*u*c-1;this.userCode="\n      const ivec3 pads = ivec3("+l+", "+f+", "+d+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+s+";\n           wD += "+i+") {\n          float dyD = float(dyDCorner + wD) / "+t+".0;\n\n          if (dyD < 0.0 || dyD >= "+e.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+a+") {\n            float dyR = float(dyRCorner + wR) / "+n+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+c+";\n                wC += "+o+") {\n              float dyC = float(dyCCorner + wC) / "+r+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = "+h+" -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * "+u+" * "+c+" +\n                  wR * "+c+" + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}(r),s=this.compileAndRun(o,[e,a],t.dtype);return a.dispose(),s},t.prototype.reshape=function(e,t){var n=this.texData.get(e.dataId);if(n.isPacked&&!Pt(e.shape,t)&&(null===n.texture||!Pt(n.shape,t))){var r=this.packedReshape(e,t);return We.makeTensorFromDataId(r.dataId,r.shape,r.dtype)}return Oa(e,t)},t.prototype.resizeBilinear=function(e,t,n,r){var i=f().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var i=e[0],a=e[1],o=e[2],s=e[3];this.outputShape=[i,t,n,s];var u=[r&&t>1?a-1:a,r&&n>1?o-1:o],c=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+",\n          "+u[1]/c[1]+");\n      const vec3 inputShapeRC = vec3("+a+".0, "+o+".0,\n                                     "+o+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(s-1)+";\n        bool hasNextRow = coords.z < "+(n-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "}(e.shape,t,n,r):new function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var i=e[0],a=e[1],o=e[2],s=e[3];this.outputShape=[i,t,n,s];var u=[r&&t>1?a-1:a,r&&n>1?o-1:o],c=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+a+".0, "+o+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "}(e.shape,t,n,r);return this.compileAndRun(i,[e],"float32")},t.prototype.resizeBilinearBackprop=function(e,t,n){var r=new function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,i=r[1],a=r[2],o=e.shape,s=o[1],u=o[2],c=[n&&s>1?i-1:i,n&&u>1?a-1:a],l=[n&&s>1?s-1:s,n&&u>1?u-1:u],f=c[0]/l[0],d=c[1]/l[1],h=1/f,p=1/d,m=2*Math.ceil(h)+2,v=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+f+");\n        const float widthScale = float("+d+");\n\n        const float invHeightScale = float("+h+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+v+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(i-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(a-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "}(e,t,n);return this.compileAndRun(r,[e])},t.prototype.resizeNearestNeighbor=function(e,t,n,r){var i=new function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var i=e[0],a=e[1],o=e[2],s=e[3];this.outputShape=[i,t,n,s];var u=[r&&t>1?a-1:a,r&&n>1?o-1:o],c=[r&&t>1?t-1:t,r&&n>1?n-1:n],l=r?"0.5":"0.0";this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+a+".0, "+o+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+l+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "}(e.shape,t,n,r);return this.compileAndRun(i,[e])},t.prototype.resizeNearestNeighborBackprop=function(e,t,n){var r=new function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,i=r[1],a=r[2],o=e.shape,s=o[1],u=o[2],c=[n&&s>1?i-1:i,n&&u>1?a-1:a],l=[n&&s>1?s-1:s,n&&u>1?u-1:u],f=c[0]/l[0],d=c[1]/l[1],h=1/f,p=1/d,m=2*Math.ceil(h)+2,v=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+f+");\n        const float widthScale = float("+d+");\n\n        const float invHeightScale = float("+h+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+v+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+c[0]+") *\n                (float(dyR) / float("+l[0]+"));\n\n            float sourceFracCol =\n                float("+c[1]+") *\n                  (float(dyC) / float("+l[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+i+") - 1),\n                "+n+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+a+") - 1),\n                "+n+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "}(e,t,n);return this.compileAndRun(r,[e])},t.prototype.multinomial=function(e,t,n,r){var i=t?e:ca(e),a=i.shape[0],o=i.shape[1],s=new Yo(a,o,n),u=s.getCustomSetupFunc(r);return this.compileAndRun(s,[i],"int32",u)},t.prototype.oneHot=function(e,t,n,r){var i=new function(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+n+"),\n                      float(index == coords.y)));\n      }\n    "}(e.size,t,n,r);return this.compileAndRun(i,[e])},t.prototype.diag=function(e){var t=new function(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}(e.size);return this.compileAndRun(t,[e])},t.prototype.nonMaxSuppression=function(e,t,n,r,i){return gn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),Pa(e.dataSync(),t.dataSync(),n,r,i)},t.prototype.cropAndResize=function(e,t,n,r,i,a){var o=new function(e,t,n,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var a=e[0],o=e[1],s=e[2],u=e[3],c=t[0],l=n[0],f=n[1];this.outputShape=[c,l,f,u];var d="bilinear"===r?1:0,h=[o-1+".0",s-1+".0"],p=h[0],m=h[1],v=l>1?[""+(o-1)/(l-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],g=v[0],y=v[1],b=v[2],x=f>1?[""+(s-1)/(f-1),"(x2-x1) * width_ratio","x1*"+m+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+m],w=x[0],_=x[1],k=x[2];this.userCode="\n      const float height_ratio = float("+g+");\n      const float width_ratio = float("+w+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+a+") {\n          return;\n        }\n\n        float height_scale = "+y+";\n        float width_scale = "+_+";\n\n        float in_y = "+b+";\n        if( in_y < 0.0 || in_y > "+p+" ) {\n          setOutput(float("+i+"));\n          return;\n        }\n        float in_x = "+k+";\n        if( in_x < 0.0 || in_x > "+m+" ) {\n          setOutput(float("+i+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+d+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "}(e.shape,t.shape,r,i,a);return this.compileAndRun(o,[e,t,n],"float32")},t.prototype.depthToSpace=function(e,t,n){A(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+t}));var r=e.shape[0],i="NHWC"===n?e.shape[1]:e.shape[2],a="NHWC"===n?e.shape[2]:e.shape[3],o="NHWC"===n?e.shape[3]:e.shape[1],s=i*t,u=a*t,c=o/(t*t),l=new So("NHWC"===n?[r,s,u,c]:[r,c,s,u],t,n);return this.compileAndRun(l,[e])},t.prototype.split=function(e,t,n){return Va(e,t,n)},t.prototype.scatterND=function(e,t,n){var r=Hi(0,e,n),i=r.sliceRank,a=r.numUpdates,o=r.sliceSize,s=r.strides,u=r.outputSize,c=[u/o,o],l=e.reshape([a,i]),f=t.reshape([a,o]);if(0===u)return Oa(Rn([]),n);var d=Bn(0),h=new Zo(a,i,l.rank,f.rank,s,c);return this.compileAndRun(h,[f,l,d]).reshape(n)},t.prototype.sparseToDense=function(e,t,n,r){var i=Hi(0,e,n),a=i.sliceRank,o=i.numUpdates,s=i.strides,u=i.outputSize,c=new Zo(o,a,e.rank,t.rank,s,[u,1],!1);return this.compileAndRun(c,[t,e,r]).reshape(n)},t.prototype.fft=function(e){return this.fftImpl(e,!1)},t.prototype.ifft=function(e){return this.fftImpl(e,!0)},t.prototype.fftImpl=function(e,t){var n=this.texData.get(e.dataId),r=new Co("return real * expR - imag * expI;",e.shape,t),i=new Co("return real * expI + imag * expR;",e.shape,t),a=[this.makeComplexComponentTensorInfo(e,n.complexTensors.real),this.makeComplexComponentTensorInfo(e,n.complexTensors.imag)],o=this.compileAndRun(r,a),s=this.compileAndRun(i,a),u=this.complex(o,s).as2D(e.shape[0],e.shape[1]);return o.dispose(),s.dispose(),u},t.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],i=zi(e,t),a=i[0],o=i[1],s=i[2],u=i[3],c=t.reshape([o,r]),l=e.reshape([e.size/s,s]),f=new function(e,t,n){this.sliceDim=e,this.strides=t,this.variableNames=["x","indices"],this.outputShape=n;var r=oo(t.length),i=oo(n.length),a=this.sliceDim>1?"strides[j]":"strides";this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+i+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+a+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "}(r,u,[o,s]);return this.compileAndRun(f,[l,c]).reshape(a)},t.prototype.fill=function(e,t,n){if("string"===(n=n||Z(t))){var r=W(n,j(e));return r.fill(t),We.makeTensor(r,e,n,this)}var i=new Ao(e,t),a=i.getCustomSetupFunc(t);return this.compileAndRun(i,[],n,a)},t.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){return this.fill(e.shape,"string"===e.dtype?"":0,e.dtype)},t.prototype.linspace=function(e,t,n){return Da(e,t,n)},t.prototype.makeTensorInfo=function(e,t){var n=this.write(null,e,t);return this.texData.get(n).usage=null,{dataId:n,shape:e,dtype:t}},t.prototype.makeOutput=function(e,t){var n=this.makeTensorInfo(e,t).dataId;return We.makeTensorFromDataId(n,e,t,this)},t.prototype.unpackTensor=function(e){var t=new function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e;var t=e.length,n=Ka("rc",t),r=oo(t),i=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(t,n),a=n.slice(-2),o=t<=1?"rc":"vec2("+a.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+i+");\n\n        setOutput(getChannel(packedInput, "+o+"));\n      }\n    "}(e.shape);return this.runWebGLProgram(t,[e],e.dtype)},t.prototype.packTensor=function(e){var t=new function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e;var t=e.length;if(0===t)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=Ka("rc",t),r=oo(t),i=function(e,t,n){if(1===e)return"rc > "+t[0];for(var r="",i=e-2;i<e;i++)r+=n[i]+" >= "+t[i],i<e-1&&(r+="||");return r}(t,e,n),a=function(e,t,n,r){if(1===e)return"";var i=r.slice(-2);return"\n    int r = "+i[0]+";\n    int c = "+i[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+t+";\n    bool rEdge = rp1 >= "+n+";\n  "}(t,e[e.length-1],e[e.length-2],n),o=function(e,t){var n=e.length,r=function(e,t){for(var n=[],r=0;r<=1;r++)for(var i=0;i<=1;i++){for(var a=(0===r?"r":"rp1")+", "+(0===i?"c":"cp1"),o=2;o<e;o++)a=t[t.length-1-o]+","+a;n.push(a)}return n}(n,t);return 1===n?"getA(rc),\n            rc + 1 >= "+e[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+r[0]+"),\n          cEdge ? 0. : getA("+r[1]+"),\n          rEdge ? 0. : getA("+r[2]+"),\n          rEdge || cEdge ? 0. : getA("+r[3]+")"}(e,n);this.userCode="\n        void main() {\n          "+r+" rc = getOutputCoords();\n\n          if("+i+") {\n            setOutput(vec4(0));\n          } else {\n            "+a+"\n\n            setOutput(vec4("+o+"));\n          }\n        }\n      "}}(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)},t.prototype.packedReshape=function(e,t){var n=[Mt(e.shape)].concat(Ft(e.shape)),r={dtype:e.dtype,shape:n,dataId:e.dataId},i=new function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var n="",r=0;r<4;r++){var i="thisRC = rc;";r%2==1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),n+="\n        "+i+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+$a(["r","c","d"],t)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+Ja(e)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+e[1]+";\n        int cols = "+e[2]+";\n\n        "+n+"\n\n        setOutput(result);\n      }\n    "}([Mt(t)].concat(Ft(t)),n),a=this.runWebGLProgram(i,[r],e.dtype,null,!0);return{dataId:a.dataId,shape:t,dtype:a.dtype}},t.prototype.decode=function(e){var t,n=this.texData.get(e),r=n.isPacked,i=n.shape,a=n.dtype,o=It(i);return t=r?new function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=qe.DENSE;var t=Qe(e),n=Ya();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+$a(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+n.output+" = result;\n      }\n    "}(o):new function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=qe.DENSE;var t=Qe(e),n=Ya();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+$a(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+n.output+" = result;\n      }\n    "}(o),{dtype:a,shape:i,dataId:this.runWebGLProgram(t,[{shape:o,dtype:a,dataId:e}],a,null,!0).dataId}},t.prototype.runWebGLProgram=function(e,t,n,r,i){var a=this;void 0===i&&(i=!1);var o=this.makeTensorInfo(e.outputShape,n),s=this.texData.get(o.dataId);if(e.packedOutput&&(s.isPacked=!0),e.outPackingScheme===qe.DENSE){var u=Qe(e.outputShape);s.texShape=u.map((function(e){return 2*e}))}if(null!=e.outTexUsage&&(s.usage=e.outTexUsage),0===j(o.shape))return s.values=U(o.dtype,0),o;var c=[],l=t.map((function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=a.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&j(t.shape)<=f().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}else if(!!n.isPacked!=!!e.packedInputs)t=n.isPacked?a.unpackTensor(t):a.packTensor(t),c.push(t),n=a.texData.get(t.dataId);else if(n.isPacked&&!Pt(n.shape,t.shape)){var r=t,i=t.shape;t.shape=n.shape,t=a.packedReshape(t,i),c.push(t),n=a.texData.get(t.dataId),r.shape=i}return a.uploadToGPU(t.dataId),{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(o.dataId);var d,h={shape:o.shape,texData:s,isUniform:!1},p=function(e,t,n){var r="";l.concat(n).forEach((function(e){var t=null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0,n=e.isUniform?"uniform":e.texData.texShape;r+=e.shape+"_"+n+"_"+t}));var i=e.userCode;return e.constructor.name+"_"+r+"_"+i}(e,0,h),m=this.getAndSaveBinary(p,(function(){return function(e,t,n,r){var i=t.userCode,a=n.map((function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}})),o=a.map((function(e){return e.shapeInfo})),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},u=Qa(a,s,i,t.packedInputs),c=e.createProgram(u),l=null,d=e.getUniformLocation(c,"NAN",!1);1===f().getNumber("WEBGL_VERSION")&&(l=e.getUniformLocation(c,"INFINITY",!1));for(var h={},p=0;p<t.variableNames.length;p++){var m=t.variableNames[p];h[m]=e.getUniformLocation(c,m,!1),h["offset"+m]=e.getUniformLocation(c,"offset"+m,!1)}return{program:t,source:u,webGLProgram:c,uniformLocations:h,inShapeInfos:o,outShapeInfo:s,infLoc:l,nanLoc:d}}(a.gpgpu,e,l,h)})),v=null!=this.activeTimers;if(v&&(d=this.startTimer()),function(e,t,n,r,i){Xo(t.inShapeInfos,n),Xo([t.outShapeInfo],[r]);var a=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(a,o[0],o[1]):e.setOutputMatrixTexture(a,o[0],o[1]),e.setProgram(t.webGLProgram),1===f().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach((function(n,r){var i=t.program.variableNames[r],a=t.uniformLocations[i],o=t.uniformLocations["offset"+i];if(null!=a)if(n.isUniform)if(j(n.shape)<2)e.gl.uniform1f(a,n.uniformValues[0]);else{var s=n.uniformValues;s instanceof Float32Array||(s=new Float32Array(s)),e.gl.uniform1fv(a,s)}else null!=n.texData.slice&&null!=o&&e.gl.uniform1i(o,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture,a,r)})),null!=i&&i(e,t.webGLProgram),e.executeProgram()}(this.gpgpu,m,l,h,r),c.forEach((function(e){return a.disposeData(e.dataId)})),v&&(d=this.endTimer(d),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(d)})),!f().getBool("WEBGL_LAZILY_UNPACK")&&s.isPacked&&!1===i){var g=this.unpackTensor(o);return this.disposeData(o.dataId),g}return o},t.prototype.compileAndRun=function(e,t,n,r,i){void 0===i&&(i=!1),n=n||t[0].dtype;var a=this.runWebGLProgram(e,t,n,r,i);return We.makeTensorFromDataId(a.dataId,a.shape,a.dtype)},t.prototype.getAndSaveBinary=function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]},t.prototype.getTextureManager=function(){return this.textureManager},t.prototype.dispose=function(){var e=this;this.disposed||(f().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((function(t){e.gpgpu.deleteProgram(e.binaryCache[t].webGLProgram),delete e.binaryCache[t]})),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},t.prototype.floatPrecision=function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=rn((function(){if(!f().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=f().getBool("DEBUG");f().set("DEBUG",!1);var n=e.abs(Bn(1e-8)).dataSync()[0];if(f().set("DEBUG",t),n>0)return 32}return 16}))),this.floatPrecisionValue},t.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},t.prototype.uploadToGPU=function(e){var t,n=this.texData.get(e),r=n.shape,i=n.dtype,a=n.values,o=n.texture,s=n.usage,u=n.isPacked;if(null==o){var c,l=null!=this.activeTimers;l&&(c=oe());var f=n.texShape;if(null==f&&(f=Nt(r,u),n.texShape=f),null!=a){var d=It(r),h=void 0,p=f[1],m=f[0],v=a instanceof Uint8Array;u?(p=(t=et(f[0],f[1]))[0],h=new function(e,t,n){void 0===n&&(n=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=Ya(),i=t[0],a=t[1];this.outputShape=e;var o="",s="result";n&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var c=0;c<=1;c++){var l=2*u+c;o+="\n          localCoords = coords;\n          if(localCoords[2] + "+c+" < "+e[2]+") {\n            localCoords[2] += "+c+";\n            if(localCoords[1] + "+u+" < "+e[1]+") {\n              localCoords[1] += "+u+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / "+a+";\n              c = imod(flatIndex, "+a+");\n              uv = (vec2(c, r) + halfCR) / vec2("+a+".0, "+i+".0);\n              values = "+r.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+l+"] = values[0];\n              } else if(offset == 1) {\n                result["+l+"] = values[1];\n              } else if(offset == 2) {\n                result["+l+"] = values[2];\n              } else {\n                result["+l+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+Ja(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        "+o+"\n\n        "+r.output+" = "+s+";\n      }\n    "}(d,[m=t[1],p],v)):h=new function(e,t,n){void 0===n&&(n=!1),this.variableNames=["A"];var r=Ya(),i=t[0],a=t[1];this.outputShape=e;var o="result";n&&(o="floor(result * 255. + 0.5)"),this.userCode="\n      "+Ja(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n        \n        int r = flatIndex / "+a+";\n        int c = imod(flatIndex, "+a+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+a+".0, "+i+".0);\n        vec4 values = "+r.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+r.output+" = vec4("+o+", 0., 0., 0.);\n      }\n    "}(d,[m,p],v);var g=this.makeTensorInfo([m,p],i);this.texData.get(g.dataId).usage=v?He.PIXELS:He.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(g.dataId),p,m,a);var y=this.runWebGLProgram(h,[g],i,null,!0),b=this.texData.get(y.dataId);n.texture=b.texture,n.texShape=b.texShape,n.isPacked=b.isPacked,n.usage=b.usage,this.disposeData(g.dataId),this.texData.delete(y.dataId),n.values=null,l&&(this.uploadWaitMs+=oe()-c)}else{var x=this.acquireTexture(f,s,i,u);n.texture=x}}},t.prototype.convertAndCacheOnCPU=function(e,t){var n=this.texData.get(e),r=n.dtype;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype "+t)}(t,r)),n.values},t.prototype.acquireTexture=function(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+i+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(e,t,r)},t.prototype.computeBytes=function(e,t){return e[0]*e[1]*X(t)},t}(ha);function Ds(e,t){return e(t={exports:{}},t.exports),t.exports}Ve()&&We.registerBackend("webgl",(function(){return new Os}),2),"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==e||"undefined"!=typeof self&&self;var Ts=Ds((function(e){!function(e,t,n){function r(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function i(e,t){var n=new function(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}(e),i=t&&t.state,a=n.next;return a.int32=function(){return 4294967296*n.next()|0},a.double=function(){return a()+11102230246251565e-32*(2097152*a()|0)},a.quick=a,i&&("object"==typeof i&&r(i,n),a.state=function(){return r(n,{})}),a}t&&t.exports?t.exports=i:this.alea=i}(0,e)})),js=Ds((function(e){!function(e,t,n){function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function i(e,t){var n=new function(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}(e),i=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,i&&("object"==typeof i&&r(i,n),a.state=function(){return r(n,{})}),a}t&&t.exports?t.exports=i:this.xor128=i}(0,e)})),Ms=Ds((function(e){!function(e,t,n){function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function i(e,t){var n=new function(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}(e),i=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,i&&("object"==typeof i&&r(i,n),a.state=function(){return r(n,{})}),a}t&&t.exports?t.exports=i:this.xorwow=i}(0,e)})),Fs=Ds((function(e){!function(e,t,n){function r(e,t){return t.x=e.x.slice(),t.i=e.i,t}function i(e,t){null==e&&(e=+new Date);var n=new function(e){var t=this;t.next=function(){var e,n,r=t.x,i=t.i;return e=r[i],n=(e^=e>>>7)^e<<24,n^=(e=r[i+1&7])^e>>>10,n^=(e=r[i+3&7])^e>>>3,n^=(e=r[i+4&7])^e<<7,e=r[i+7&7],n^=(e^=e<<13)^e<<9,r[i]=n,t.i=i+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}(e),i=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,i&&(i.x&&r(i,n),a.state=function(){return r(n,{})}),a}t&&t.exports?t.exports=i:this.xorshift7=i}(0,e)})),Is=Ds((function(e){!function(e,t,n){function r(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function i(e,t){null==e&&(e=+new Date);var n=new function(e){var t=this;t.next=function(){var e,n,r=t.w,i=t.X,a=t.i;return t.w=r=r+1640531527|0,n=i[a+34&127],e=i[a=a+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=i[a]=n^e,t.i=a,n+(r^r>>>16)|0},function(e,t){var n,r,i,a,o,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),i=0,a=-32;a<u;++a)t&&(r^=t.charCodeAt((a+32)%t.length)),0===a&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,a>=0&&(o=o+1640531527|0,i=0==(n=s[127&a]^=r+o)?i+1:0);for(i>=128&&(s[127&(t&&t.length||0)]=-1),i=127,a=512;a>0;--a)r=s[i+34&127],n=s[i=i+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[i]=r^n;e.w=o,e.X=s,e.i=i}(t,e)}(e),i=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,i&&(i.X&&r(i,n),a.state=function(){return r(n,{})}),a}t&&t.exports?t.exports=i:this.xor4096=i}(0,e)})),Ns=Ds((function(e){!function(e,t,n){function r(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function i(e,t){var n=new function(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,i=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^i,i=i-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^i,t.a=i-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}(e),i=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,i&&("object"==typeof i&&r(i,n),a.state=function(){return r(n,{})}),a}t&&t.exports?t.exports=i:this.tychei=i}(0,e)})),Rs=Ds((function(e){!function(t,r){var i,a=this,o=256,s=6,u="random",c=r.pow(o,s),l=r.pow(2,52),f=2*l,d=o-1;function h(e,n,d){var h=[],y=v(function e(t,n){var r,i=[],a=typeof t;if(n&&"object"==a)for(r in t)try{i.push(e(t[r],n-1))}catch(e){}return i.length?i:"string"==a?t:t+"\0"}((n=1==n?{entropy:!0}:n||{}).entropy?[e,g(t)]:null==e?function(){try{var e;return i&&(e=i.randomBytes)?e=e(o):(e=new Uint8Array(o),(a.crypto||a.msCrypto).getRandomValues(e)),g(e)}catch(e){var n=a.navigator,r=n&&n.plugins;return[+new Date,a,r,a.screen,g(t)]}}():e,3),h),b=new p(h),x=function(){for(var e=b.g(s),t=c,n=0;e<l;)e=(e+n)*o,t*=o,n=b.g(1);for(;e>=f;)e/=2,t/=2,n>>>=1;return(e+n)/t};return x.int32=function(){return 0|b.g(4)},x.quick=function(){return b.g(4)/4294967296},x.double=x,v(g(b.S),t),(n.pass||d||function(e,t,n,i){return i&&(i.S&&m(i,b),e.state=function(){return m(b,{})}),n?(r[u]=e,t):e})(x,y,"global"in n?n.global:this==r,n.state)}function p(e){var t,n=e.length,r=this,i=0,a=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);i<o;)s[i]=i++;for(i=0;i<o;i++)s[i]=s[a=d&a+e[i%n]+(t=s[i])],s[a]=t;(r.g=function(e){for(var t,n=0,i=r.i,a=r.j,s=r.S;e--;)t=s[i=d&i+1],n=n*o+s[d&(s[i]=s[a=d&a+t])+(s[a]=t)];return r.i=i,r.j=a,n})(o)}function m(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function v(e,t){for(var n,r=e+"",i=0;i<r.length;)t[d&i]=d&(n^=19*t[d&i])+r.charCodeAt(i++);return g(t)}function g(e){return String.fromCharCode.apply(0,e)}if(r["seed"+u]=h,v(r.random(),t),e.exports){e.exports=h;try{i=n(390)}catch(e){}}}([],Math)}));Rs.alea=Ts,Rs.xor128=js,Rs.xorwow=Ms,Rs.xorshift7=Fs,Rs.xor4096=Is,Rs.tychei=Ns;var Ps=Rs.alea,Bs=Mn({addN_:function(e){A(Array.isArray(e),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),A(e.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got "+e.length}));var t=e.map((function(e,t){return xn(e,"tensors"+t,"addN")})),n=t[0];t.forEach((function(e){if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),t.forEach((function(e){if(!M(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));var r=t;return We.runKernelFunc((function(e,n){return e.addN(t)}),r,null,"AddN")}});function Ls(){Zt("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}function zs(e){return 0===e.rank||1===e.rank?e.as4D(1,1,1,e.size):2===e.rank?e.as4D(1,1,e.shape[0],e.shape[1]):3===e.rank?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}function Us(e,t,n,r,i,a){null==a&&(a=.001);var o,s,u=xn(e,"x","batchNorm"),c=xn(t,"mean","batchNorm"),l=xn(n,"variance","batchNorm");null!=i&&(o=xn(i,"scale","batchNorm")),null!=r&&(s=xn(r,"offset","batchNorm")),A(c.rank===l.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),A(null==s||c.rank===s.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),A(null==o||c.rank===o.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var f={x:u,scale:o,offset:s,mean:c,variance:l},d={varianceEpsilon:a};return We.runKernelFunc((function(e,t){var n=zs(u),r=e.batchNormalization(n,Ws(c),Ws(l),a,Ws(o),Ws(s));return t([u,c,l,o]),r}),f,null,"FusedBatchNorm",d).reshape(u.shape)}function Ws(e){return null==e?null:0===e.rank?e.as1D():1===e.rank?e:2===e.rank?e.as4D(1,1,e.shape[0],e.shape[1]):3===e.rank?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}var Vs=Mn({batchNormalization_:function(e,t,n,r,i,a){return void 0===r&&(r=.001),Ls(),Us(e,t,n,a,i,r)}}),Gs=Mn({batchNorm_:Us});function qs(e,t,n,r,i,a){var o,s,u=xn(e,"x","batchNorm"),c=xn(t,"mean","batchNorm"),l=xn(n,"variance","batchNorm");return null!=i&&(o=xn(i,"scale","batchNorm")),null!=r&&(s=xn(r,"offset","batchNorm")),A(2===u.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."})),A(2===c.rank||1===c.rank,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+c.rank+"."})),A(2===l.rank||1===l.rank,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+l.rank+"."})),null!=o&&A(2===o.rank||1===o.rank,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+o.rank+"."})),null!=s&&A(2===s.rank||1===s.rank,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."})),Gs(u,c,l,s,o,a)}var Hs=Mn({batchNormalization2d_:function(e,t,n,r,i,a){return void 0===r&&(r=.001),Ls(),qs(e,t,n,a,i,r)}}),Xs=Mn({batchNorm2d_:qs});function Ks(e,t,n,r,i,a){var o,s,u=xn(e,"x","batchNorm"),c=xn(t,"mean","batchNorm"),l=xn(n,"variance","batchNorm");return null!=i&&(o=xn(i,"scale","batchNorm")),null!=r&&(s=xn(r,"offset","batchNorm")),A(3===u.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."})),A(3===c.rank||1===c.rank,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+c.rank+"."})),A(3===l.rank||1===l.rank,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+l.rank+"."})),null!=o&&A(3===o.rank||1===o.rank,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+o.rank+"."})),null!=s&&A(3===s.rank||1===s.rank,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."})),Gs(u,c,l,s,o,a)}var Ys=Mn({batchNormalization3d_:function(e,t,n,r,i,a){return void 0===r&&(r=.001),Ls(),Ks(e,t,n,a,i,r)}}),$s=Mn({batchNorm3d_:Ks});function Js(e,t,n,r,i,a){var o,s,u=xn(e,"x","batchNorm"),c=xn(t,"mean","batchNorm"),l=xn(n,"variance","batchNorm");return null!=i&&(o=xn(i,"scale","batchNorm")),null!=r&&(s=xn(r,"offset","batchNorm")),A(4===u.rank,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."})),A(4===c.rank||1===c.rank,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+c.rank+"."})),A(4===l.rank||1===l.rank,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+l.rank+"."})),null!=o&&A(4===o.rank||1===o.rank,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+o.rank+"."})),null!=s&&A(4===s.rank||1===s.rank,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."})),Gs(u,c,l,s,o,a)}var Zs=Mn({batchNormalization4d_:function(e,t,n,r,i,a){return void 0===r&&(r=.001),Ls(),Js(e,t,n,a,i,r)}}),Qs=Mn({batchNorm4d_:Js}),eu=Mn({broadcastTo_:function(e,t){var n=xn(e,"broadcastTo","x"),r=n.shape;if(t.some((function(e){return!(e>0)||e%1!=0})))throw new Error("broadcastTo(): Invalid broadcast shape ["+t+"].");if(t.length<n.rank)throw new Error("broadcastTo(): shape.length="+t.length+" < input.rank="+n.rank+".");if(t.length>n.rank){for(var i=n.shape.slice();i.length<t.length;)i.unshift(1);n=n.reshape(i)}for(var a=n.shape,o=Array.from(t),s=t.length-1;s>=0;s--)if(a[s]===t[s])o[s]=1;else if(1!==n.shape[s])throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+t+"].");var u=o.map((function(e,t){return e>1?t:-1})).filter((function(e){return e>=0}));if(0===u.length)return n.clone();var c={x:n},l={shape:t,inputShape:a};return We.runKernelFunc((function(e){return e.tile(n,o)}),c,(function(e){return{x:function(){return e.sum(u,!0)}}}),jr,l)}}),tu=Mn({clone_:function(e){var t=xn(e,"x","clone",null);return We.runKernelFunc((function(){return We.makeTensorFromDataId(t.dataId,t.shape,t.dtype)}),{x:t},null,Fr)}}),nu=Mn({logicalAnd_:function(e,t){var n=xn(e,"a","logicalAnd","bool"),r=xn(t,"b","logicalAnd","bool");return Ur(n.shape,r.shape),We.runKernelFunc((function(e){return e.logicalAnd(n,r)}),{a:n,b:r},null,"LogicalAnd")}}),ru=Mn({logicalNot_:function(e){var t=xn(e,"x","logicalNot","bool");return We.runKernelFunc((function(e){return e.logicalNot(t)}),{$x:t})}}),iu=Mn({logicalOr_:function(e,t){var n=xn(e,"a","logicalOr","bool"),r=xn(t,"b","logicalOr","bool");return Ur(n.shape,r.shape),We.runKernelFunc((function(e){return e.logicalOr(n,r)}),{$a:n,$b:r})}}),au=Mn({logicalXor_:function(e,t){var n=xn(e,"a","logicalXor","bool"),r=xn(t,"b","logicalXor","bool");return Ur(n.shape,r.shape),iu(e,t).logicalAnd(nu(e,t).logicalNot())}}),ou=Mn({where_:function(e,t,n){var r=xn(t,"a","where"),i=xn(n,"b","where"),a=xn(e,"condition","where","bool");return O(r.shape,i.shape,"Error in where: "),1===a.rank?A(a.shape[0]===r.shape[0],(function(){return"The first dimension of `a` must match the size of `condition`."})):O(a.shape,i.shape,"Error in where: "),We.runKernelFunc((function(e,t){var n=e.select(a,r,i);return t([a]),n}),{$condition:a,$a:r,$b:i},(function(e,t){var n=t[0];return{$condition:function(){return Zn(n).toFloat()},$a:function(){return e.mul(n.cast(e.dtype))},$b:function(){return e.mul(n.logicalNot().cast(e.dtype))}}}))}}),su=function(e){return u(this,void 0,void 0,(function(){var t,n,r;return c(this,(function(i){switch(i.label){case 0:return[4,(t=xn(e,"condition","whereAsync","bool")).data()];case 1:return n=i.sent(),r=Ha(t.shape,n),e!==t&&t.dispose(),[2,r]}}))}))},uu=Mn({divNoNan_:function(e,t){var n,r=xn(e,"a","div"),i=xn(t,"b","div");r=(n=Ne(r,i))[0],i=n[1];var a=Li(r,i),o=Zn(a),s=i.equal(o);return ou(s,o,a)}}),cu=Mn({tile_:function(e,t){var n=xn(e,"x","tile",null);A(n.rank===t.length,(function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+t+"."}));var r=[n],i={x:n},a={reps:t};return We.runKernelFunc((function(e,r){var i=e.tile(n,t);return r([n]),i}),i,null,Ir,a,r)}}),lu=Mn({eye_:function(e,t,n,r){void 0===r&&(r="float32"),null==t&&(t=e);for(var i=ar([e,t],r),a=e<=t?e:t,o=0;o<a;++o)i.set(1,o,o);var s=i.toTensor().as2D(e,t);if(null==n)return s;if(1===n.length)return cu(fr(s,0),[n[0],1,1]);if(2===n.length)return cu(fr(fr(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return cu(fr(fr(fr(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}}),fu=Mn({multinomial_:function(e,t,n,r){void 0===r&&(r=!1);var i=xn(e,"logits","multinomial"),a=i.size,o=i.rank;if(a<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+a+".");if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+o);n=n||Math.random();var s=1===o?i.as2D(1,-1):i,u=We.runKernelFunc((function(e){return e.multinomial(s,r,t,n)}),{logits2D:s});return 1===o?u.as1D():u}}),du=Mn({oneHot_:function(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r=0),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var i=xn(e,"indices","oneHot","int32"),a=i.shape.concat([t]),o={indices:i=i.flatten()},s={depth:t,onValue:n,offValue:r};return We.runKernelFunc((function(e,a){return a([i]),e.oneHot(i,t,n,r)}),o,null,Mr,s).reshape(a)}}),hu=Mn({pad_:function(e,t,n){void 0===n&&(n=0);var r=xn(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var i={paddings:t,constantValue:n},a={x:r};return We.runKernelFunc((function(e,i){return i([r]),e.pad(r,t,n)}),a,null,Nr,i)}}),pu=Mn({pad1d_:function(e,t,n){return void 0===n&&(n=0),A(2===t.length,(function(){return"Invalid number of paddings. Must be length of 2."})),hu(e,[t],n)}}),mu=Mn({pad2d_:function(e,t,n){return void 0===n&&(n=0),A(2===t.length&&2===t[0].length&&2===t[1].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),hu(e,t,n)}}),vu=Mn({pad3d_:function(e,t,n){return void 0===n&&(n=0),A(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),hu(e,t,n)}}),gu=Mn({pad4d_:function(e,t,n){return void 0===n&&(n=0),A(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),hu(e,t,n)}}),yu=Mn({rand_:function(e,t,n){var r=j(e),i=null;if(null==n||"float32"===n)i=new Float32Array(r);else if("int32"===n)i=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type "+n);i=new Uint8Array(r)}for(var a=0;a<r;a++)i[a]=t();return We.makeTensor(i,e,n)}}),bu=.001,xu=.1;function wu(){return 32===We.backend.floatPrecision()?bu:xu}function _u(e,t,n){var r=!0;if((H(e)||H(t))&&(r=!1),H(e)&&H(t)&&(r=!0),r){var i=e.constructor.name,a=t.constructor.name;if(i!==a)throw new Error("Arrays are of different type. Actual: "+i+". Expected: "+a)}if(Array.isArray(e)&&Array.isArray(t)){var o=yn(e),s=yn(t);if(!M(o,s))throw new Error("Arrays have different shapes. Actual: ["+o+"]. Expected: ["+s+"]")}var u=H(e)?e:T(e),c=H(t)?t:T(t);if(u.length!==c.length)throw new Error("Arrays have different lengths actual: "+u.length+" vs expected: "+c.length+".\nActual:   "+u+".\nExpected: "+c+".");for(var l=0;l<c.length;++l){var f=u[l],d=c[l];if(!n(f,d))throw new Error("Arrays differ: actual["+l+"] = "+f+", expected["+l+"] = "+d+".\nActual:   "+u+".\nExpected: "+c+".")}}function ku(e,t,n){return!isFinite(e)&&!isFinite(t)||!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}var Eu=Object.freeze({TEST_EPSILON_FLOAT16:xu,expectArraysClose:function(e,t,n){return null==n&&(n=wu()),_u(e,t,(function(e,t){return ku(e,t,n)}))},testEpsilon:wu,expectPromiseToFail:function(e,t){e().then((function(){return t.fail()}),(function(){return t()}))},expectArraysEqual:function(e,t){var n="string"==typeof t||"number"==typeof t||"boolean"==typeof t?[t]:t;return Y(e)||Y(e[0])||Y(t)||Y(t[0])?_u(e,n,(function(e,t){return e==t})):_u(e,t,(function(e,t){return ku(e,t,0)}))},expectNumbersClose:function(e,t,n){if(null==n&&(n=wu()),!ku(e,t,n))throw new Error("Numbers differ: actual === "+e+", expected === "+t)},expectValuesInRange:function(e,t,n){for(var r=0;r<e.length;r++)if(e[r]<t||e[r]>n)throw new Error("Value out of range:"+e[r]+" low: "+t+", high: "+n)},expectArrayBuffersEqual:function(e,t){expect(new Float32Array(e)).toEqual(new Float32Array(t))}}),Su=function(){function e(e,t,n,r,i){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=i||Math.random();this.random=Ps(a.toString())}return e.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){var i=void 0,a=void 0,o=void 0;do{o=(i=2*this.random()-1)*i+(a=2*this.random()-1)*a}while(o>=1||0===o);var s=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*i*s,n=this.mean+this.stdDev*a*s,this.truncated&&!this.isValidTruncated(t)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)},e.prototype.convertValue=function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)},e.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},e}(),Cu=function(){function e(e,t,n,r){this.alpha=e,this.beta=1/t,this.dtype=n;var i=r||Math.random();this.randu=Ps(i.toString()),this.randn=new Su(0,1,n,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return e.prototype.nextValue=function(){for(var e,t,n,r,i,a;;){do{r=this.randn.nextValue(),a=1+this.c*r}while(a<=0);if(a*=a*a,t=1-.331*(e=r*r)*e,n=.5*e+this.d*(1-a+Math.log(a)),(i=this.randu())<t||Math.log(i)<n)break}return a=1/this.beta*this.d*a,this.alpha<1&&(a*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(a)},e.prototype.convertValue=function(e){return"float32"===this.dtype?e:Math.round(e)},e}(),Au=function(){function e(e,t,n,r){var i=this;if(void 0===e&&(e=0),void 0===t&&(t=1),this.canReturnFloat=function(){return null==i.dtype||"float32"===i.dtype},this.min=e,this.range=t-e,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=Ps(r)}return e.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},e.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},e}(),Ou=Mn({randomGamma_:function(e,t,n,r,i){if(void 0===n&&(n=1),void 0===r&&(r="float32"),null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type "+r);for(var a=new Cu(t,n,r,i),o=ar(e,r),s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}}),Du=Mn({randomNormal_:function(e,t,n,r,i){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var a=new Su(t,n,r,!1,i),o=ar(e,r),s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}}),Tu=Mn({randomUniform_:function(e,t,n,r,i){void 0===t&&(t=0),void 0===n&&(n=1),void 0===r&&(r="float32");for(var a=ar(e,r),o=new Au(t,n,null,i),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),ju=Mn({square_:function(e){var t=xn(e,"x","square"),n=[t];return We.runKernelFunc((function(e,n){return n([t]),e.square(t)}),{x:t},null,"Square",{},n,[])}}),Mu=Mn({squaredDifference_:function(e,t){var n,r=xn(e,"a","squaredDifference"),i=xn(t,"b","squaredDifference");n=Ne(r,i),r=n[0],i=n[1],Ur(r.shape,i.shape);var a={a:r,b:i},o=[r,i];return We.runKernelFunc((function(e,t){var n=e.squaredDifference(r,i);return t([r,i]),n}),a,(function(e,t){var n=t[0],r=t[1],i=Bn(2);return{a:function(){return e.mul(n.sub(r).mul(i))},b:function(){return e.mul(r.sub(n).mul(i))}}}),Ar,{},o,[])}}),Fu=Mn({truncatedNormal_:function(e,t,n,r,i){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");for(var a=new Su(t,n,r,!0,i),o=ar(e,r),s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}}),Iu=Mn({equal_:function(e,t){var n,r=xn(e,"a","equal"),i=xn(t,"b","equal");return n=Ne(r,i),r=n[0],i=n[1],Ur(r.shape,i.shape),We.runKernelFunc((function(e){return e.equal(r,i)}),{$a:r,$b:i})}}),Nu=Mn({equalStrict_:function(e,t){var n=xn(e,"a","equalStrict"),r=xn(t,"b","equalStrict");return O(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),Ru=Mn({greater_:function(e,t){var n,r=xn(e,"a","greater"),i=xn(t,"b","greater");return n=Ne(r,i),r=n[0],i=n[1],Ur(r.shape,i.shape),We.runKernelFunc((function(e){return e.greater(r,i)}),{a:r,b:i},null,"Greater")}}),Pu=Mn({greaterEqual_:function(e,t){var n,r=xn(e,"a","greaterEqual"),i=xn(t,"b","greaterEqual");return n=Ne(r,i),r=n[0],i=n[1],Ur(r.shape,i.shape),We.runKernelFunc((function(e,t){var n=e.greaterEqual(r,i);return t([r,i]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1];return{a:function(){return Zn(n)},b:function(){return Zn(r)}}}),"GreaterEqual")}}),Bu=Mn({greaterEqualStrict_:function(e,t){var n=xn(e,"a","greaterEqualStrict"),r=xn(t,"b","greaterEqualStrict");return O(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),Lu=Mn({greaterStrict_:function(e,t){var n=xn(e,"a","greaterStrict"),r=xn(t,"b","greaterStrict");return O(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),zu=Mn({less_:function(e,t){var n,r=xn(e,"a","less"),i=xn(t,"b","less");return n=Ne(r,i),r=n[0],i=n[1],Ur(r.shape,i.shape),We.runKernelFunc((function(e){return e.less(r,i)}),{a:r,b:i},null,"Less")}}),Uu=Mn({lessEqual_:function(e,t){var n,r=xn(e,"a","lessEqual"),i=xn(t,"b","lessEqual");return n=Ne(r,i),r=n[0],i=n[1],Ur(r.shape,i.shape),We.runKernelFunc((function(e,t){var n=e.lessEqual(r,i);return t([r,i]),n}),{a:r,b:i},null,"LessEqual")}}),Wu=Mn({lessEqualStrict_:function(e,t){var n=xn(e,"a","lessEqualStrict"),r=xn(t,"b","lessEqualStrict");return O(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),Vu=Mn({lessStrict_:function(e,t){var n=xn(e,"a","lessStrict"),r=xn(t,"b","lessStrict");return O(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),Gu=Mn({notEqual_:function(e,t){var n,r=xn(e,"a","notEqual"),i=xn(t,"b","notEqual");return n=Ne(r,i),r=n[0],i=n[1],Ur(r.shape,i.shape),We.runKernelFunc((function(e){return e.notEqual(r,i)}),{a:r,b:i},null,"NotEqual")}}),qu=Mn({notEqualStrict_:function(e,t){var n=xn(e,"a","notEqualStrict"),r=xn(t,"b","notEqualStrict");return O(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}});function Hu(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function Xu(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var Ku=Mn({gather_:function(e,t,n){void 0===n&&(n=0);var r=xn(e,"x","gather"),i=xn(t,"indices","gather","int32");n=L(n,r.shape)[0];var a=function(e,t,n){for(var r=e.shape[n],i=[],a=1,o=1,s=0;s<n;s++)i.push(e.shape[s]),a*=e.shape[s];for(s=0;s<t.rank;s++)i.push(t.shape[s]);for(s=n+1;s<e.rank;s++)i.push(e.shape[s]),o*=e.shape[s];return{batchSize:a,sliceSize:o,dimSize:r,outputShape:i}}(r,i,n);return We.runKernelFunc((function(e,t){var a=e.gather(r,i.flatten(),n);return t([i]),a}),{x:r,indices:i},(function(e,t){var i=t[0];return{x:function(){var t=r.shape,a=i.size,o=t.slice(0,n),s=o.length,u=t.slice(n,t.length).slice(1),c=u.length,l=Hu(0,s),f=Hu(s+1,s+1+c),d=Xu([o,[a],u]),h=e.reshape(d),p=i.reshape([a]),m=Xu([[s],l,f]),v=h.transpose(m),g=Yu(v,p,r.shape[n]),y=On(m);return g.transpose(y)},indices:function(){return i}}}),"Gather",{axis:n}).reshape(a.outputShape)}}),Yu=Mn({unsortedSegmentSum_:function(e,t,n){var r=xn(e,"x","unsortedSegmentSum"),i=xn(t,"segmentIds","unsortedSegmentSum","int32");return A(F(n),(function(){return"numSegments must be of dtype int"})),We.runKernelFunc((function(e,t){var a=e.unsortedSegmentSum(r,i,n);return t([i]),a}),{$x:r},(function(e,t){var n=t[0];return{$x:function(){return function(e,t){for(var n=Ci(t,Zn(t)),r=Ku(e,n),i=Pu(t,Bn(0,"int32")),a=r.rank-i.rank,o=0;o<a;++o)i=fr(i,o+1);i=nu(i,Hn(r.shape,"bool"));var s=Zn(r);return ou(i,r,s)}(e,n)}}}))}}),$u=function(e,t,n){return u(this,void 0,void 0,(function(){var r,i,a,o,s,u,l,f,d,h,p,m,v;return c(this,(function(c){switch(c.label){case 0:for(r=xn(e,"tensor","boolMask"),i=xn(t,"mask","boolMask","bool"),a=null==n?0:n,o=i.rank,s=r.shape,A(o>0,(function(){return"mask cannot be scalar"})),O(s.slice(a,a+o),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,l=a;l<a+o;l++)u*=s[l];return f=s.slice(0,a).concat([u],s.slice(a+o)),d=r.reshape(f),h=i.reshape([-1]),[4,su(h)];case 1:return p=c.sent(),m=p.squeeze([1]),v=Ku(d,m,a),e!==r&&r.dispose(),t!==i&&i.dispose(),m.dispose(),d.dispose(),h.dispose(),p.dispose(),[2,v]}}))}))};function Ju(e,t,n,r,i,a,o){void 0===a&&(a="NHWC"),A(e.length===t.rank,(function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"}));var s=e,u=t,c=!1;3===t.rank&&(c=!0,u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),s=[1,e[0],e[1],e[2]]),A(4===s.length,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."})),A(4===u.rank,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank})),A(4===n.rank,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank}));var l="NHWC"===a?s[3]:s[1],f="NHWC"===a?u.shape[3]:u.shape[1];A(l===n.shape[2],(function(){return"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+n.shape[2]+"."})),A(f===n.shape[3],(function(){return"Error in conv2dDerInput: depth of output ("+f+") must match output depth for filter "+n.shape[3]+"."})),null!=o&&A(F(i),(function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."}));var d=Ca(a),h=ga(s,n.shape,r,1,i,o,!1,d),p=We.runKernelFunc((function(e,t){var r=e.conv2dDerInput(u,n,h);return t([n,u]),r}),{dy4D:u,filter:n},(function(e,t){var n=t[0],s=t[1];return{dy4D:function(){return tc(e,n,r,i,a,1,o)},filter:function(){return rc(e,s,n.shape,r,i,a,o)}}}));return c?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function Zu(e){var t=function(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}(e),n=t[0],r=t[1],i=t[2];return 1===n&&1===r&&1===i}function Qu(e,t,n,r,i){A(e.length===t.rank,(function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"}));var a=e,o=t,s=!1;4===t.rank&&(s=!0,o=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]),a=[1,e[0],e[1],e[2],e[3]]);var u=a[4],c=o.shape[4];A(5===a.length,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+a.length+"."})),A(5===o.rank,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+o.rank})),A(5===n.rank,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank})),A(u===n.shape[3],(function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+n.shape[3]+"."})),A(c===n.shape[4],(function(){return"Error in conv3dDerInput: depth of output ("+c+") must match output depth for filter "+n.shape[4]+"."}));var l=ya(a,n.shape,r,1,i),f=We.runKernelFunc((function(e){return e.conv3dDerInput(o,n,l)}),{dy5D:o});return s?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}var ec=Mn({conv1d_:function(e,t,n,r,i,a,o){void 0===i&&(i="NWC"),void 0===a&&(a=1);var s=xn(e,"x","conv1d"),u=xn(t,"filter","conv1d"),c=s,l=!1;2===s.rank&&(l=!0,c=s.as3D(1,s.shape[0],s.shape[1])),A(3===c.rank,(function(){return"Error in conv1d: input must be rank 3, but got rank "+c.rank+"."})),A(3===u.rank,(function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."})),null!=o&&A(F(r),(function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."})),A(c.shape[2]===u.shape[1],(function(){return"Error in conv1d: depth of input ("+c.shape[2]+") must match input depth for filter "+u.shape[1]+"."})),A(Sa(n,a),(function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+a+"'"})),A("NWC"===i,(function(){return"Error in conv1d: got dataFormat of "+i+" but only NWC is currently supported."}));var f=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),d=c.as4D(c.shape[0],1,c.shape[1],c.shape[2]),h=tc(d,f,[1,n],r,"NHWC",[1,a],o);return l?h.as2D(h.shape[2],h.shape[3]):h.as3D(h.shape[0],h.shape[2],h.shape[3])}}),tc=Mn({conv2d_:function(e,t,n,r,i,a,o){void 0===i&&(i="NHWC"),void 0===a&&(a=[1,1]);var s=xn(e,"x","conv2d"),u=xn(t,"filter","conv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),A(4===c.rank,(function(){return"Error in conv2d: input must be rank 4, but got rank "+c.rank+"."})),A(4===u.rank,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."})),null!=o&&A(F(r),(function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."}));var f="NHWC"===i?c.shape[3]:c.shape[1];A(f===u.shape[2],(function(){return"Error in conv2d: depth of input ("+f+") must match input depth for filter "+u.shape[2]+"."})),A(Sa(n,a),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}));var d=Ca(i),h=ga(c.shape,u.shape,n,a,r,o,!1,d),p=[u,c],m=We.runKernelFunc((function(e,t){var n=e.conv2d(c,u,h);return t([u,c]),n}),{x:c,filter:u},(function(e,t){var o=t,s=o[0],u=o[1];return A(Ea(a),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"})),{x:function(){return ic(u.shape,e,s,n,r,i)},filter:function(){return rc(u,e,s.shape,n,r,i)}}}),"Conv2D",h,p);return l?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),nc=Mn({conv3d_:function(e,t,n,r,i,a){void 0===i&&(i="NDHWC"),void 0===a&&(a=[1,1,1]);var o=xn(e,"x","conv3d"),s=xn(t,"filter","conv3d"),u=o,c=!1;4===o.rank&&(c=!0,u=o.as5D(1,o.shape[0],o.shape[1],o.shape[2],o.shape[3])),A(5===u.rank,(function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."})),A(5===s.rank,(function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."})),A(u.shape[4]===s.shape[3],(function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."})),A(function(e,t){return Zu(n)||Zu(t)}(0,a),(function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"})),A("NDHWC"===i,(function(){return"Error in conv3d: got dataFormat of "+i+" but only NDHWC is currently supported."}));var l=ya(u.shape,s.shape,n,a,r),f=We.runKernelFunc((function(e,t){var n=e.conv3d(u,s,l);return t([u,s]),n}),{x:u,$filter:s},(function(e,t){A(Zu(a),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"}));var i=t[0],o=t[1];return{x:function(){return Qu(i.shape,e,o,n,r)},$filter:function(){return function(e,t,n,r,i){var a=e;4===e.rank&&(a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]));var o=t;4===o.rank&&(o=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3])),A(5===a.rank,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+a.shape+"."})),A(5===o.rank,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+o.shape+"."})),A(5===n.length,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+n+"."})),A(a.shape[4]===n[3],(function(){return"Error in conv3dDerFilter: depth of input "+a.shape[4]+") must match input depth in filter ("+n[3]+"."})),A(o.shape[4]===n[4],(function(){return"Error in conv3dDerFilter: depth of dy ("+o.shape[4]+") must match output depth for filter ("+n[4]+")."}));var s=ya(a.shape,n,r,1,i);return We.runKernelFunc((function(e){return e.conv3dDerFilter(a,o,s)}),{x5D:a,dy5D:o})}(i,e,o.shape,n,r)}}}));return c?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),rc=Mn({conv2dDerFilter_:function(e,t,n,r,i,a,o){void 0===a&&(a="NHWC");var s=e;3===e.rank&&(s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var u=t;3===u.rank&&(u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),A(4===s.rank,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."})),A(4===u.rank,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."})),A(4===n.length,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."}));var c="NHWC"===a?s.shape[3]:s.shape[1],l="NHWC"===a?u.shape[3]:u.shape[1];A(c===n[2],(function(){return"Error in conv2dDerFilter: depth of input "+c+") must match input depth in filter ("+n[2]+"."})),A(l===n[3],(function(){return"Error in conv2dDerFilter: depth of dy ("+l+") must match output depth for filter ("+n[3]+")."})),null!=o&&A(F(i),(function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."}));var f=Ca(a),d=ga(s.shape,n,r,1,i,o,!1,f);return We.runKernelFunc((function(e){return e.conv2dDerFilter(s,u,d)}),{x4D:s,dy4D:u})}}),ic=Mn({conv2dDerInput_:Ju}),ac=Mn({depthwiseConv2d_:function(e,t,n,r,i,a,o){void 0===i&&(i="NHWC"),void 0===a&&(a=[1,1]);var s=xn(e,"x","depthwiseConv2d"),u=xn(t,"filter","depthwiseConv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),A(4===c.rank,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+c.rank+"."})),A(4===u.rank,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."})),A(c.shape[3]===u.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels ("+c.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."})),null==a&&(a=[1,1]),A(Sa(n,a),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"})),null!=o&&A(F(r),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."}));var f=ga(c.shape,u.shape,n,a,r,o,!0),d=[c,u],h=We.runKernelFunc((function(e,t){var n=e.depthwiseConv2D(c,u,f);return t([c,u]),n}),{x:c,filter:u},(function(e,t){A(Ea(a),(function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+a+"'"}));var n=t[0],r=t[1];return{x:function(){return oc(n.shape,e,r,f)},filter:function(){return sc(n,e,r.shape,f)}}}),"DepthwiseConv2dNative",f,d);return l?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}}),oc=Mn({depthwiseConv2dDerInput_:function(e,t,n,r){var i=t,a=!1;3===t.rank&&(a=!0,i=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var o=We.runKernelFunc((function(e){return e.depthwiseConv2DDerInput(i,n,r)}),{dy4D:i});return a?o.as3D(o.shape[1],o.shape[2],o.shape[3]):o}}),sc=Mn({depthwiseConv2dDerFilter_:function(e,t,n,r){var i=e;3===e.rank&&(i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=t;return 3===a.rank&&(a=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),We.runKernelFunc((function(e){return e.depthwiseConv2DDerFilter(i,a,r)}),{x4D:i,dy4D:a})}}),uc=Mn({separableConv2d_:function(e,t,n,r,i,a,o){void 0===a&&(a=[1,1]),void 0===o&&(o="NHWC");var s=xn(e,"x","separableConv2d"),u=xn(t,"depthwiseFilter","separableConv2d"),c=xn(n,"pointwiseFilter","separableConv2d"),l=s,f=!1;if(3===s.rank&&(f=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),"NCHW"===o)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");A(4===l.rank,(function(){return"Error in separableConv2d: input must be rank 4, but got rank "+l.rank+"."})),A(4===u.rank,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."})),A(4===c.rank,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."})),A(1===c.shape[0],(function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+c.shape[0]+"."})),A(1===c.shape[1],(function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+c.shape[1]+"."}));var d=u.shape[2],h=u.shape[3];A(c.shape[2]===d*h,(function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+d*h+", but got "+c.shape[2]+"."}));var p=ac(l,u,r,i,o,a),m=tc(p,c,1,"valid",o);return f?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),cc=Mn({conv2dTranspose_:function(e,t,n,r,i,a){return Ju(n,xn(e,"x","conv2dTranspose"),xn(t,"filter","conv2dTranspose"),r,i,"NHWC",a)}}),lc=Mn({conv3dTranspose_:function(e,t,n,r,i){return Qu(n,xn(e,"x","conv3dTranspose"),xn(t,"filter","conv3dTranspose"),r,i)}}),fc=Mn({matMul_:function(e,t,n,r){var i;void 0===n&&(n=!1),void 0===r&&(r=!1);var a=xn(e,"a","matMul"),o=xn(t,"b","matMul");i=Ne(a,o),a=i[0],o=i[1];var s=n?a.shape[a.rank-2]:a.shape[a.rank-1],u=r?o.shape[o.rank-1]:o.shape[o.rank-2],c=n?a.shape[a.rank-1]:a.shape[a.rank-2],l=r?o.shape[o.rank-2]:o.shape[o.rank-1],f=a.shape.slice(0,-2),d=o.shape.slice(0,-2),h=j(f),p=j(d);A(a.rank>=2&&o.rank>=2&&a.rank===o.rank,(function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+a.rank+" and "+o.rank+"."})),A(M(f,d),(function(){return"Error in matMul: outer dimensions ("+f+") and ("+d+") of Tensors with shapes "+a.shape+" and "+o.shape+" must match."})),A(s===u,(function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+a.shape+" and "+o.shape+" and transposeA="+n+" and transposeB="+r+" must match."}));var m=a.shape.slice(0,-2).concat([c,l]),v=n?a.as3D(h,s,c):a.as3D(h,c,s),g=r?o.as3D(p,l,u):o.as3D(p,u,l),y={transposeA:n,transposeB:r};return We.runKernelFunc((function(e,t){var i=e.batchMatMul(v,g,n,r);return t([v,g]),i}),{a:v,b:g},(function(e,t){var i=t,a=i[0],o=i[1];return n||r?!n&&r?{a:function(){return e.matMul(o,!1,!1)},b:function(){return e.matMul(a,!0,!1)}}:n&&!r?{a:function(){return o.matMul(e,!1,!0)},b:function(){return a.matMul(e,!1,!1)}}:{a:function(){return o.matMul(e,!0,!0)},b:function(){return e.matMul(a,!0,!0)}}:{a:function(){return e.matMul(o,!1,!0)},b:function(){return a.matMul(e,!0,!1)}}}),"BatchMatMul",y).reshape(m)}}),dc=Mn({dot_:function(e,t){var n=xn(e,"t1","dot"),r=xn(t,"t2","dot");A(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+"."}));var i=1===n.rank?n.size:n.shape[1],a=1===r.rank?r.size:r.shape[0];return A(i===a,(function(){return"Error in dot: inner dimensions of inputs must match, but got "+i+" and "+a+"."})),1===n.rank&&1===r.rank?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===n.rank&&2===r.rank?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===n.rank&&1===r.rank?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),hc=Mn({outerProduct_:function(e,t){var n=xn(e,"v1","outerProduct"),r=xn(t,"v2","outerProduct");return A(1===n.rank&&1===r.rank,(function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."})),n.as2D(-1,1).matMul(r.as2D(1,-1))}}),pc=Mn({reverse_:function(e,t){var n=xn(e,"x","reverse");if(0===n.rank)return n.clone();var r=L(t,n.shape);return We.runKernelFunc((function(e){return e.reverse(n,r)}),{$x:n},(function(e){return{$x:function(){return e.reverse(r)}}})).reshapeAs(n)}}),mc=Mn({reverse1d_:function(e){var t=xn(e,"x","reverse");return A(1===t.rank,(function(){return"Error in reverse1D: x must be rank 1 but got rank "+t.rank+"."})),pc(t,0)}}),vc=Mn({reverse2d_:function(e,t){var n=xn(e,"x","reverse");return A(2===n.rank,(function(){return"Error in reverse2D: x must be rank 2 but got rank "+n.rank+"."})),pc(n,t)}}),gc=Mn({reverse3d_:function(e,t){var n=xn(e,"x","reverse");return A(3===n.rank,(function(){return"Error in reverse3D: x must be rank 3 but got rank "+n.rank+"."})),pc(n,t)}}),yc=Mn({reverse4d_:function(e,t){var n=xn(e,"x","reverse");return A(4===n.rank,(function(){return"Error in reverse4D: x must be rank 4 but got rank "+n.rank+"."})),pc(n,t)}});function bc(e,t,n,r,i,a){var o=xn(e,"x","maxPool"),s=o,u=!1;3===o.rank&&(u=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),null==r&&(r=[1,1]),A(4===s.rank,(function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."})),A(Sa(n,r),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"})),null!=a&&A(F(i),(function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."}));var c=ma(s.shape,t,n,r,i,a);if(1===c.filterWidth&&1===c.filterHeight&&M(c.inShape,c.outShape))return o.clone();var l=[s],f=We.runKernelFunc((function(e,t){var n=e.maxPool(s,c);return t([s,n]),n}),{x:s},(function(e,a){var o=a[0],s=a[1];return{x:function(){return function(e,t,n,r,i,a,o,s){var u=xn(e,"dy","maxPoolBackprop"),c=xn(t,"input","maxPoolBackprop"),l=xn(n,"output","maxPoolBackprop");A(c.rank===u.rank,(function(){return"Rank of input ("+c.rank+") does not match rank of dy ("+u.rank+")"})),null==a&&(a=[1,1]),A(Sa(i,a),(function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+a+"'"})),A(4===u.rank,(function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+u.rank+"."})),A(4===c.rank,(function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+c.rank+"."}));var f=ma(c.shape,r,i,a,o,s);return We.runKernelFunc((function(e){return e.maxPoolBackprop(u,c,l,f)}),{$dy:u,$input:c})}(e,o,s,t,n,r,i)}}}),"MaxPool",c,l);return u?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}function xc(e,t,n,r,i,a){var o=xn(e,"x","avgPool","float32");null==r&&(r=[1,1]),A(Sa(n,r),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"}));var s=o,u=!1;3===o.rank&&(u=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),A(4===s.rank,(function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."})),null!=a&&A(F(i),(function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."}));var c=ma(s.shape,t,n,r,i,a);if(1===c.filterWidth&&1===c.filterHeight&&M(c.inShape,c.outShape))return o.clone();var l=We.runKernelFunc((function(e){return e.avgPool(s,c)}),{x:s},(function(e){return{x:function(){return function(e,t,n,r,i,a){var o=xn(e,"dy","avgPoolBackprop"),s=xn(t,"input","avgPoolBackprop");A(s.rank===o.rank,(function(){return"Rank of input ("+s.rank+") does not match rank of dy ("+o.rank+")"})),null==i&&(i=[1,1]),A(Sa(r,i),(function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+i+"'"}));var u=s,c=o,l=!1;3===s.rank&&(l=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]),c=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),A(4===c.rank,(function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+c.rank+"."})),A(4===u.rank,(function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+u.rank+"."}));var f=ma(u.shape,n,r,i,a),d=We.runKernelFunc((function(e){return e.avgPoolBackprop(c,u,f)}),{dy4D:c,input4D:u});return l?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}(e,s,t,n,r,i)}}}),"AvgPool",c);return l=l.cast(o.dtype),u?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}var wc=Mn({maxPool_:function(e,t,n,r,i){return bc(e,t,n,1,r,i)}}),_c=Mn({avgPool_:function(e,t,n,r,i){return xc(e,t,n,1,r,i)}}),kc=Mn({pool_:function(e,t,n,r,i,a){null==i&&(i=[1,1]),null==a&&(a=1),0===r&&(r="valid");var o=xn(e,"x","maxPool"),s=o,u=!1;3===o.rank&&(u=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),A(Sa(a,i),(function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+i+"'"}));var c,l=ma(s.shape,t,a,i,r),f=[l.dilationHeight,l.dilationWidth];c="same"===r?function(e,t){var n=e.map((function(e,n){return e+(e-1)*(t[n]-1)})).map((function(e){return e-1})),r=n.map((function(e){return Math.floor(e/2)})),i=n.map((function(e,t){return e-r[t]}));return n.map((function(e,t){return[r[t],i[t]]}))}([l.filterHeight,l.filterWidth],f):[[0,0],[0,0]];var d=1===f[0]&&1===f[1],h=function(e,t,n){var r=n.map((function(e){return e[0]})),i=n.map((function(e){return e[1]})),a=e.concat(r,i),o=t.map((function(e,t){return(e-a[t]%e)%e})),s=i.map((function(e,t){return e+o[t]}));return[t.map((function(e,t){return[r[t],s[t]]})),t.map((function(e,t){return[0,o[t]]}))]}([l.inHeight,l.inWidth],f,c),p=h[0],m=h[1],v=d?r:"valid",g=d?s:hr(s,f,p),y=("avg"===n?function(){return xc(g,t,a,1,v)}:function(){return bc(g,t,a,1,v)})(),b=d?y:sr(y,f,m);return u?b.as3D(b.shape[1],b.shape[2],b.shape[3]):b}}),Ec=Mn({maxPool3d_:function(e,t,n,r,i,a,o){void 0===a&&(a="NDHWC");var s=xn(e,"x","maxPool3d"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==o&&(o=[1,1,1]),A(5===u.rank,(function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."})),A("NDHWC"===a,(function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+a})),A(Sa(n,o),(function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"})),null!=i&&A(F(r),(function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}));var l=va(u.shape,t,n,o,r,i,a),f=We.runKernelFunc((function(e,t){var n=e.maxPool3d(u,l);return t([u,n]),n}),{x:u},(function(e,a){var s=a[0],u=a[1];return{x:function(){return function(e,t,n,r,i,a,o,s){var u=xn(e,"dy","maxPool3dBackprop"),c=xn(t,"input","maxPool3dBackprop"),l=xn(n,"output","maxPool3dBackprop"),f=u,d=c,h=l,p=!1;4===c.rank&&(p=!0,f=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]),d=c.as5D(1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]),h=l.as5D(1,l.shape[0],l.shape[1],l.shape[2],l.shape[3])),A(5===f.rank,(function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+f.rank+"."})),A(5===d.rank,(function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+d.rank+"."})),A(5===h.rank,(function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+h.rank+"."})),null==a&&(a=[1,1,1]),A(Sa(i,a),(function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+a+"'"})),null!=s&&A(F(o),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+o+"."}));var m=va(d.shape,r,i,a,o,s),v=We.runKernelFunc((function(e){return e.maxPool3dBackprop(f,d,h,m)}),{dy5D:f,input5D:d});return p?v.as4D(v.shape[1],v.shape[2],v.shape[3],v.shape[4]):v}(e,s,u,t,n,o,r,i)}}}));return c?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),Sc=Mn({avgPool3d_:function(e,t,n,r,i,a,o){void 0===a&&(a="NDHWC");var s=xn(e,"x","avgPool3d","float32"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==o&&(o=[1,1,1]),A(5===u.rank,(function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."})),A("NDHWC"===a,(function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+a})),A(Sa(n,o),(function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"})),null!=i&&A(F(r),(function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}));var l=va(u.shape,t,n,o,r,i,a),f=We.runKernelFunc((function(e){return e.avgPool3d(u,l)}),{x:u},(function(e){return{x:function(){return function(e,t,n,r,i,a,o){var s=xn(e,"dy","avgPool3dBackprop"),u=xn(t,"input","avgPool3dBackprop"),c=s,l=u,f=!1;4===u.rank&&(f=!0,c=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]),l=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3])),A(5===c.rank,(function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+c.rank+"."})),A(5===l.rank,(function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+l.rank+"."})),null==i&&(i=[1,1,1]),A(Sa(r,i),(function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+i+"'"})),null!=o&&A(F(a),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+a+"."}));var d=va(l.shape,n,r,i,a,o),h=We.runKernelFunc((function(e){return e.avgPool3dBackprop(c,l,d)}),{dy5D:c,input5D:l});return f?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}(e,u,t,n,o,r,i)}}}));return f=f.cast(u.dtype),c?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),Cc=Mn({maxPoolWithArgmax_:function(e,t,n,r,i){void 0===i&&(i=!1);var a=xn(e,"x","maxPoolWithArgmax"),o={filterSize:t,strides:n,pad:r,includeBatchInIndex:i},s=We.runKernel("MaxPoolWithArgmax",{x:a},o);return{result:s[0],indexes:s[1]}}}),Ac=Mn({slice_:function(e,t,n){var r,i,a=xn(e,"x","slice");if(0===a.rank)throw new Error("Slicing scalar is not possible");(r="number"==typeof t?[t].concat(new Array(a.rank-1).fill(0)):t.length<a.rank?t.concat(new Array(a.rank-t.length).fill(0)):t.slice()).forEach((function(e){A(-1!==e,(function(){return"slice() does not support negative begin indexing."}))})),i=(i=null==n?new Array(a.rank).fill(-1):"number"==typeof n?[n].concat(new Array(a.rank-1).fill(-1)):n.length<a.rank?n.concat(new Array(a.rank-n.length).fill(-1)):n).map((function(e,t){return e>=0?e:(A(-1===e,(function(){return"Negative size values should be exactly -1 but got "+e+" for the slice() size at index "+t+"."})),a.shape[t]-r[t])})),Ki(a,r,i);var o=a.shape,s={begin:r,size:i};return We.runKernelFunc((function(e){return e.slice(a,r,i)}),{x:a},(function(e){for(var t=[],n=0;n<e.rank;n++)t.push([r[n],o[n]-r[n]-i[n]]);return{x:function(){return hu(e,t)}}}),"Slice",s)}}),Oc=Mn({slice1d_:function(e,t,n){var r=xn(e,"x","slice1d");return A(1===r.rank,(function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"})),Ac(r,[t],[n])}}),Dc=Mn({slice2d_:function(e,t,n){var r=xn(e,"x","slice2d");return A(2===r.rank,(function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"})),Ac(r,t,n)}}),Tc=Mn({slice3d_:function(e,t,n){var r=xn(e,"x","slice3d");return A(3===r.rank,(function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"})),Ac(r,t,n)}}),jc=Mn({slice4d_:function(e,t,n){var r=xn(e,"x","slice4d");return A(4===r.rank,(function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"})),Ac(r,t,n)}});function Mc(e,t,n,r,i){return t.rank<n.rank&&(t=t.reshape(Sn(t.shape,r))),e.rank<n.rank&&(e=e.reshape(Sn(e.shape,r))),{x:function(){var r=e.mul(n.equal(t).cast(e.dtype));return null==i?r:r.transpose(i)}}}var Fc=Mn({all_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=xn(e,"x","all","bool"),i=L(t,r.shape),a=i,o=An(a,r.rank);null!=o&&(r=r.transpose(o),a=Dn(a.length,r.rank));var s=We.runKernelFunc((function(e){return e.all(r,a)}),{$x:r});if(n){var u=Sn(s.shape,i);return s.reshape(u)}return s}}),Ic=Mn({any_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=xn(e,"x","any","bool"),i=L(t,r.shape),a=i,o=An(a,r.rank);null!=o&&(r=r.transpose(o),a=Dn(a.length,r.rank));var s=We.runKernelFunc((function(e){return e.any(r,a)}),{$x:r});if(n){var u=Sn(s.shape,i);return s.reshape(u)}return s}}),Nc=Mn({argMax_:function(e,t){void 0===t&&(t=0);var n=xn(e,"x","argMax");null==t&&(t=0);var r=L(t,n.shape),i=An(r,n.rank);null!=i&&(n=n.transpose(i),r=Dn(r.length,n.rank));var a={axis:r[0]},o=[n];return We.runKernelFunc((function(e,t){var i=e.argMax(n,r[0]);return t([n]),i}),{x:n},(function(e,t){var n=t[0];return{x:function(){return Zn(n)}}}),"ArgMax",a,o)}}),Rc=Mn({argMin_:function(e,t){void 0===t&&(t=0);var n=xn(e,"x","argMin");null==t&&(t=0);var r=L(t,n.shape),i=An(r,n.rank);return null!=i&&(n=n.transpose(i),r=Dn(r.length,n.rank)),We.runKernelFunc((function(e,t){var i=e.argMin(n,r[0]);return t([n]),i}),{$x:n},(function(e,t){var n=t[0];return{$x:function(){return Zn(n)}}}))}}),Pc=Mn({logSumExp_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=xn(e,"x","logSumExp"),i=L(t,r.shape),a=r.max(i,!0),o=r.sub(a).exp().sum(i).log(),s=a.reshape(o.shape).add(o);if(n){var u=Sn(s.shape,i);return s.reshape(u)}return s}}),Bc=Mn({max_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=xn(e,"x","max"),i=r,a=L(t,r.shape),o=a,s=An(o,r.rank);null!=s&&(r=r.transpose(s),o=Dn(o.length,r.rank));var u=[r],c=We.runKernelFunc((function(e,t){var n=e.max(r,o);return t([i,n]),n}),{x:r},(function(e,t){return Mc(e,t[1],t[0],a,s)}),"Max",{axes:o},u,[!0]);if(n){var l=Sn(c.shape,a);c=c.reshape(l)}return c}}),Lc=Mn({mean_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=xn(e,"x","mean"),i=L(t,r.shape),a=j(En(r.shape,i)[1]);return sa((function(e){var r=Bn(a);return{value:(r.dtype===e.dtype?e:e.cast(r.dtype)).div(r).sum(t,n),gradFunc:function(t){var n=e.shape.slice();return i.forEach((function(e){n[e]=1})),t.reshape(n).mul(Hn(e.shape,"float32")).div(a)}}}))(r)}}),zc=Mn({min_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=xn(e,"x","min"),i=r,a=L(t,r.shape),o=a,s=An(o,r.rank);null!=s&&(r=r.transpose(s),o=Dn(o.length,r.rank));var u=[r],c=We.runKernelFunc((function(e,t){var n=e.min(r,o);return t([i,n]),n}),{x:r},(function(e,t){return Mc(e,t[1],t[0],a,s)}),"Min",{axes:o},u,[!0]);if(n){var l=Sn(c.shape,a);c=c.reshape(l)}return c}}),Uc=Mn({moments_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=L(t,(e=xn(e,"x","moments")).shape),i=e.mean(r,n),a=i.shape;return n||(a=Sn(i.shape,r)),{mean:i,variance:e.toFloat().sub(i.reshape(a)).square().mean(r,n)}}}),Wc=Mn({sum_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=xn(e,"x","sum");"bool"===r.dtype&&(r=r.toInt());var i=L(t,r.shape);return sa((function(e){var t=An(i,e.rank),r=i,a=e;null!=t&&(a=e.transpose(t),r=Dn(r.length,e.rank));var o=function(t){var n=e.shape.slice();return i.forEach((function(e){n[e]=1})),t.reshape(n).mul(Hn(e.shape,"float32"))},s={axes:r},u=We.runKernelFunc((function(e){return e.sum(a,r)}),{x:a},(function(e){return{x:function(){return o(e)}}}),"Sum",s);if(n){var c=Sn(u.shape,i);u=u.reshape(c)}return{value:u,gradFunc:o}}))(r)}}),Vc=Mn({prod_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=xn(e,"x","prod");"bool"===r.dtype&&(r=r.toInt());var i=L(t,r.shape),a=An(i,r.rank),o=i,s=r;null!=a&&(s=r.transpose(a),o=Dn(o.length,r.rank));var u=We.runKernelFunc((function(e){return e.prod(s,o)}),{permutedX:s});if(n){var c=Sn(u.shape,i);u=u.reshape(c)}return u}}),Gc=Mn({elu_:function(e){var t=xn(e,"x","elu");return We.runKernelFunc((function(e,n){var r=e.elu(t);return n([r]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return We.runKernelFunc((function(t){return t.eluDer(e,n)}),{dy:e,y:n})}}}))}}),qc=Mn({leakyRelu_:function(e,t){void 0===t&&(t=.2);var n=xn(e,"x","leakyRelu");return Ci(Bn(t).mul(n),n)}}),Hc=Mn({prelu_:function(e,t){var n=xn(e,"x","prelu"),r=xn(t,"alpha","prelu");return We.runKernelFunc((function(e,t){var i=e.prelu(n,r);return t([n,r]),i}),{x:n,alpha:r},(function(e,t){var n=t[0],r=t[1],i=n.greater(0);return{x:function(){return ou(i,e,e.mul(r))},alpha:function(){var t=ou(i,Zn(e),e.mul(n)),a=zr(r.shape,e.shape);return a.length>0&&(t=t.sum(a)),t.reshape(r.shape)}}}),"Prelu")}}),Xc=Mn({relu_:function(e){var t=xn(e,"x","relu");return"bool"===t.dtype?t.toInt():We.runKernelFunc((function(e,n){var r=e.relu(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.mulStrict(n.step().toFloat())}}}),"Relu")}}),Kc=Mn({relu6_:function(e){var t=xn(e,"x","relu6");return"bool"===t.dtype?t.toInt():We.runKernelFunc((function(e,n){var r=e.relu6(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0],r=n.lessEqual(6).mul(n.step());return{x:function(){return e.mulStrict(r.toFloat())}}}),"Relu6")}}),Yc=Mn({selu_:function(e){var t=xn(e,"x","selu");return We.runKernelFunc((function(e,n){var r=e.selu(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){var t=n.greater(Bn(0)),r=Bn(as),i=Bn(os),a=e.mul(i),o=e.mul(r).mul(n.toFloat().exp());return ou(t,a,o)}}}))}}),$c=Mn({localResponseNormalization_:function(e,t,n,r,i){void 0===t&&(t=5),void 0===n&&(n=1),void 0===r&&(r=1),void 0===i&&(i=.5);var a=xn(e,"x","localResponseNormalization");A(4===a.rank||3===a.rank,(function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+a.rank+"."})),A(F(t),(function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+t+"."}));var o=a,s=!1;3===a.rank&&(s=!0,o=a.as4D(1,a.shape[0],a.shape[1],a.shape[2]));var u=We.runKernelFunc((function(e,a){var s=e.localResponseNormalization4D(o,t,n,r,i);return a([o,s]),s}),{x4D:o},(function(e,a){var o=a[0],s=a[1];return{x4D:function(){return We.runKernelFunc((function(a){return a.LRNGrad(e,o,s,t,n,r,i)}),{})}}}));return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Jc=Mn({norm_:function(e,t,n,r){void 0===t&&(t="euclidean"),void 0===n&&(n=null),void 0===r&&(r=!1);var i=function e(t,n,r){if(void 0===r&&(r=null),0===t.rank)return t.abs();if(1!==t.rank&&null===r)return e(t.reshape([-1]),n,r);if(1===t.rank||"number"==typeof r||Array.isArray(r)&&1===r.length){if(1===n)return t.abs().sum(r);if(n===1/0)return t.abs().max(r);if(n===-1/0)return t.abs().min(r);if("euclidean"===n||2===n)return t.abs().pow(Bn(2,"int32")).sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}if(Array.isArray(r)&&2===r.length){if(1===n)return t.abs().sum(r[0]).max(r[1]-1);if(n===1/0)return t.abs().sum(r[1]).max(r[0]);if(n===-1/0)return t.abs().sum(r[1]).min(r[0]);if("fro"===n||"euclidean"===n)return t.square().sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}throw new Error("Error in norm: invalid axis: "+r)}(e=xn(e,"x","norm"),t,n),a=i.shape;if(r){var o=L(n,e.shape);a=Sn(i.shape,o)}return i.reshape(a)}}),Zc=Mn({basicLSTMCell_:function(e,t,n,r,i,a){var o=xn(e,"forgetBias","basicLSTMCell"),s=xn(t,"lstmKernel","basicLSTMCell"),u=xn(n,"lstmBias","basicLSTMCell"),c=xn(r,"data","basicLSTMCell"),l=xn(i,"c","basicLSTMCell"),f=xn(a,"h","basicLSTMCell"),d=c.concat(f,1).matMul(s).add(u),h=d.shape[0],p=d.shape[1]/4,m=[h,p],v=d.slice([0,0],m),g=d.slice([0,p],m),y=d.slice([0,2*p],m),b=d.slice([0,3*p],m),x=v.sigmoid().mulStrict(g.tanh()).addStrict(l.mulStrict(o.add(y).sigmoid()));return[x,x.tanh().mulStrict(b.sigmoid())]}}),Qc=Mn({multiRNNCell_:function(e,t,n,r){for(var i=xn(t,"data","multiRNNCell"),a=wn(n,"c","multiRNNCell"),o=wn(r,"h","multiRNNCell"),s=i,u=[],c=0;c<e.length;c++){var l=e[c](s,a[c],o[c]);u.push(l[0]),u.push(l[1]),s=l[1]}var f=[],d=[];for(c=0;c<u.length;c+=2)f.push(u[c]),d.push(u[c+1]);return[f,d]}}),el=Mn({movingAverage_:function(e,t,n,r,i){void 0===i&&(i=!0);var a=xn(e,"v","movingAverage"),o=xn(t,"x","movingAverage"),s=xn(n,"decay","movingAverage");Re(a,o),A(M(a.shape,o.shape),(function(){return"Shape mismatch in v and x"}));var u=Bn(1),c=u.sub(s),l=o.sub(a).mul(c);if(i){A(null!=r,(function(){return"When using zeroDebias: true, step is required."}));var f=xn(r,"step","movingAverage");l=l.div(u.sub(Ii(s,f)))}return a.add(l)}}),tl=Mn({stridedSlice_:function(e,t,n,r,i,a,o,s,u){if(void 0===i&&(i=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===u&&(u=0),null==r&&(r=new Array(t.length)),0!==o)throw new Error("ellipsis mask is not yet supported");var c=xn(e,"x","stridedSlice"),l=Yi(s),f=c.shape.slice();l.forEach((function(e){t[e]=0,n[e]=1,f.splice(e,0,1)})),c=c.reshape(f);for(var d=0;d<c.rank;d++)t[d]=Ji(i,t,r,c.shape,d),n[d]=Zi(a,n,r,c.shape,d),r[d]=r[d]||1;var h=Yi(u);h.forEach((function(e){n[e]=t[e]+1,r[e]=1}));var p=$i(t,n,r),m=p.filter((function(e,t){return-1===h.indexOf(t)}));return r.every((function(e){return 1===e}))?Ac(c,t,p).reshape(m):We.runKernelFunc((function(e){return e.stridedSlice(c,t,n,r)}),{$x:c}).reshape(m)}}),nl=Mn({topk_:function(e,t,n){void 0===t&&(t=1),void 0===n&&(n=!0);var r=xn(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var i=r.shape[r.shape.length-1];if(t>i)throw new Error("'k' passed to topk() must be <= the last dimension ("+i+") but got "+t);var a=We.runKernelFunc((function(e){return e.topk(r,t,n)}),{$x:r});return{values:a[0],indices:a[1]}}}),rl=Mn({scatterND_:function(e,t,n){var r=xn(e,"indices","scatterND","int32"),i=xn(t,"updates","scatterND");return qi(i,r,n),We.runKernelFunc((function(e){return e.scatterND(r,i,n)}),{indices:r,updates:i},null,"ScatterNd",{shape:n})}}),il=Mn({fft_:function(e){A("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+e.dtype+"."}));var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return We.runKernelFunc((function(e){return e.fft(r)}),{input:e}).reshape(e.shape)}}),al=Mn({ifft_:function(e){A("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+e.dtype+"."}));var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return We.runKernelFunc((function(e){return e.ifft(r)}),{input:e}).reshape(e.shape)}}),ol=Mn({rfft_:function(e,t){A("float32"===e.dtype,(function(){return"The dtype for rfft() must be real value but got "+e.dtype}));var n,r=e.shape[e.shape.length-1],i=e.size/r;if(null!=t&&t<r){var a=e.shape.map((function(e){return 0})),o=e.shape.map((function(e){return e}));o[e.shape.length-1]=t,n=e.slice(a,o),r=t}else if(null!=t&&t>r){var s=e.shape.map((function(e){return e}));s[e.shape.length-1]=t-r,n=e.concat(Xn(s),e.shape.length-1),r=t}else n=e;var u=n.zerosLike(),c=Fn(n,u).as2D(i,r),l=il(c),f=Math.floor(r/2)+1,d=In(l),h=Nn(l),p=d.split([f,r-f],d.shape.length-1),m=h.split([f,r-f],h.shape.length-1),v=n.shape.slice();return v[n.shape.length-1]=f,Fn(p[0],m[0]).reshape(v)}}),sl=Mn({irfft_:function(e){var t=e.shape[e.shape.length-1],n=e.size/t;if(t<=2){var r=e.as2D(n,t),i=al(r);return In(i)}var a=[n,2*(t-1)],o=In(e).as2D(n,t),s=Nn(e).as2D(n,t),u=o.slice([0,1],[n,t-2]).reverse(1),c=s.slice([0,1],[n,t-2]).reverse(1).mul(Bn(-1)),l=o.concat(u,1),f=s.concat(c,1);return r=Fn(l,f).as2D(a[0],a[1]),i=al(r),In(i)}}),ul=Object.freeze({fft:il,ifft:al,rfft:ol,irfft:sl}),cl=Mn({sparseToDense_:function(e,t,n,r){void 0===r&&(r=0);var i=xn(e,"sparseIndices","sparseToDense","int32"),a=xn(t,"sparseValues","sparseToDense"),o=xn(r,"defaultValue","sparseToDense",a.dtype);return function(e,t,n,r){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+e.shape+".");var i=e.rank>0?e.shape[0]:1,a=e.rank>1?e.shape[1]:1;if(n.length!==a)throw new Error("outputShape has incorrect number of elements:, "+n.length+", should be: "+a+".");var o=t.size;if(0!==t.rank&&(1!==t.rank||o!==i))throw new Error("sparseValues has incorrect shape "+t.shape+", should be [] or ["+i+"]");if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(i,a,n,o),We.runKernelFunc((function(e){return e.sparseToDense(i,a,n,o)}),{$sparseIndices:i,$sparseValues:a,$defaultValue:o})}}),ll=Mn({gatherND_:function(e,t){var n=xn(t,"indices","gatherND","int32"),r=xn(e,"x","gatherND");return We.runKernelFunc((function(e){return e.gatherND(r,n)}),{x:r,indices:n},null,"GatherNd")}}),fl=Mn({diag_:function(e){var t=xn(e,"x","diag").flatten(),n=e.shape.concat(e.shape);return We.runKernelFunc((function(e){return e.diag(t)}),{$x:t}).reshape(n)}}),dl=Mn({dropout_:function(e,t,n,r){var i=xn(e,"x","dropout");if(A("float32"===i.dtype,(function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+i.dtype+" tensor instead."})),A(t>=0&&t<1,(function(){return"rate must be a float in the range [0, 1), but got "+t+"."})),0===t)return e instanceof Se?i.clone():i;var a=function(e,t){if(null==t)return e.shape.slice();if(M(e.shape,t))return t;if(e.shape.length===t.length){for(var n=[],r=0;r<e.shape.length;r++)null==t[r]&&null!=e.shape[r]?n.push(e.shape[r]):n.push(t[r]);return n}return t}(i,n),o=1-t,s=Tu(a,0,1,"float32",r).add(o).floor().div(o);return i.mul(s)}});function hl(e,t,n){for(var r=1-e%2,i=new Float32Array(e),a=0;a<e;++a){var o=2*Math.PI*a/(e+r-1);i[a]=t-n*Math.cos(o)}return Ln(i,"float32")}var pl,ml=Mn({hannWindow_:function(e){return hl(e,.5,.5)}}),vl=Mn({hammingWindow_:function(e){return hl(e,.54,.46)}}),gl=Mn({frame_:function(e,t,n,r,i){void 0===r&&(r=!1),void 0===i&&(i=0);for(var a=0,o=[];a+t<=e.size;)o.push(Ac(e,a,t)),a+=n;if(r)for(;a<e.size;){var s=a+t-e.size,u=Qn([Ac(e,a,t-s),Kn([s],i)]);o.push(u),a+=n}return 0===o.length?zn([],[0,t]):Qn(o).as2D(o.length,t)}}),yl=Mn({stft_:function(e,t,n,r,i){var a;void 0===i&&(i=ml),null==r&&(a=t,r=Math.floor(Math.pow(2,Math.ceil(Math.log(a)/Math.log(2)))));for(var o=gl(e,t,n),s=Mi(o,i(t)),u=[],c=0;c<o.shape[0];c++)u.push(ol(s.slice([c,0],[1,t]),r));return Qn(u)}}),bl=Object.freeze({hannWindow:ml,hammingWindow:vl,frame:gl,stft:yl}),xl=function(e,t,n){return void 0===n&&(n=1),u(this,void 0,void 0,(function(){var r,i,a,o,s,u,l,f,d,h,p,m,v,g;return c(this,(function(c){switch(c.label){case 0:return r=xn(e,"predictions","inTopK"),i=xn(t,"targets","inTopK"),A(r.rank>1,(function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank})),A(r.rank-1===i.rank,(function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+i.rank})),O(r.shape.slice(0,r.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),a=r.shape[r.shape.length-1],A(n>0&&n<=a,(function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+a+"), but got "+n})),[4,r.data()];case 1:return o=c.sent(),[4,i.data()];case 2:for(s=c.sent(),u=[o.length/a,a],f=u[1],d=U("bool",l=u[0]),h=0;h<l;h++){for(p=h*f,m=o.subarray(p,p+f),v=[],g=0;g<m.length;g++)v.push({value:m[g],index:g});for(v.sort((function(e,t){return t.value-e.value})),d[h]=0,g=0;g<n;g++)if(v[g].index===s[h]){d[h]=1;break}}return e!==r&&r.dispose(),t!==i&&i.dispose(),[2,Rn(d,i.shape,"bool")]}}))}))};!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(pl||(pl={}));var wl=Mn({absoluteDifference_:function(e,t,n,r){void 0===r&&(r=pl.SUM_BY_NONZERO_WEIGHTS);var i=xn(e,"labels","absoluteDifference"),a=xn(t,"predictions","absoluteDifference"),o=null;null!=n&&(o=xn(n,"weights","absoluteDifference")),O(i.shape,a.shape,"Error in absoluteDifference: ");var s=i.sub(a).abs();return _l(s,o,r)}}),_l=Mn({computeWeightedLoss_:function(e,t,n){void 0===n&&(n=pl.SUM_BY_NONZERO_WEIGHTS);var r=xn(e,"losses","computeWeightedLoss"),i=null;null!=t&&(i=xn(t,"weights","computeWeightedLoss"));var a=null==i?r:r.mul(i);if(n===pl.NONE)return a;if(n===pl.SUM)return a.sum();if(n===pl.MEAN){if(null==i)return a.mean();var o=r.size/i.size,s=a.sum().div(i.sum());return o>1?s.div(Bn(o)):s}if(n===pl.SUM_BY_NONZERO_WEIGHTS){if(null==i)return a.sum().div(Bn(r.size));var u=i.mul(Hn(r.shape)).notEqual(Bn(0)).sum().toFloat();return a.sum().div(u)}throw Error("Unknown reduction: "+n)}}),kl=Mn({cosineDistance_:function(e,t,n,r,i){void 0===i&&(i=pl.SUM_BY_NONZERO_WEIGHTS);var a=xn(e,"labels","cosineDistance"),o=xn(t,"predictions","cosineDistance"),s=null;null!=r&&(s=xn(r,"weights","cosineDistance")),O(a.shape,o.shape,"Error in cosineDistance: ");var u=Bn(1).sub(a.mul(o).sum(n,!0));return _l(u,s,i)}}),El=Mn({hingeLoss_:function(e,t,n,r){void 0===r&&(r=pl.SUM_BY_NONZERO_WEIGHTS);var i=xn(e,"labels","hingeLoss"),a=xn(t,"predictions","hingeLoss"),o=null;null!=n&&(o=xn(n,"weights","hingeLoss")),O(i.shape,a.shape,"Error in hingeLoss: ");var s=Bn(1);i=Bn(2).mul(i).sub(s);var u=s.sub(i.mul(a)).relu();return _l(u,o,r)}}),Sl=Mn({huberLoss_:function(e,t,n,r,i){void 0===r&&(r=1),void 0===i&&(i=pl.SUM_BY_NONZERO_WEIGHTS);var a=xn(e,"labels","huberLoss"),o=xn(t,"predictions","huberLoss"),s=null;null!=n&&(s=xn(n,"weights","huberLoss")),O(a.shape,o.shape,"Error in huberLoss: ");var u=Bn(r),c=o.sub(a).abs(),l=Oi(c,u),f=c.sub(l),d=Bn(.5).mul(l.square()).add(u.mul(f));return _l(d,s,i)}}),Cl=Mn({logLoss_:function(e,t,n,r,i){void 0===r&&(r=1e-7),void 0===i&&(i=pl.SUM_BY_NONZERO_WEIGHTS);var a=xn(e,"labels","logLoss"),o=xn(t,"predictions","logLoss"),s=null;null!=n&&(s=xn(n,"weights","logLoss")),O(a.shape,o.shape,"Error in logLoss: ");var u=Bn(1),c=Bn(r),l=a.mul(o.add(c).log()).neg().sub(u.sub(a).mul(u.sub(o).add(c).log()));return _l(l,s,i)}}),Al=Mn({meanSquaredError_:function(e,t,n,r){void 0===r&&(r=pl.SUM_BY_NONZERO_WEIGHTS);var i=xn(e,"labels","meanSquaredError"),a=xn(t,"predictions","meanSquaredError"),o=null;null!=n&&(o=xn(n,"weights","meanSquaredError")),O(i.shape,a.shape,"Error in meanSquaredError: ");var s=i.squaredDifference(a);return _l(s,o,r)}}),Ol=Mn({sigmoidCrossEntropy_:function(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=pl.SUM_BY_NONZERO_WEIGHTS);var a=xn(e,"multiClassLabels","sigmoidCrossEntropy"),o=xn(t,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=xn(n,"weights","sigmoidCrossEntropy")),O(a.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=Bn(r),c=Bn(1),l=Bn(.5);a=a.mul(c.sub(u)).add(l.mul(u))}var f=function(e,t){var n=xn(e,"labels","sigmoidCrossEntropyWithLogits"),r=xn(t,"logits","sigmoidCrossEntropyWithLogits");O(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var i=r.relu(),a=r.mul(n),o=r.abs().neg().exp().log1p();return i.sub(a).add(o)}(a,o);return _l(f,s,i)}}),Dl=Mn({softmaxCrossEntropy_:function(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=pl.SUM_BY_NONZERO_WEIGHTS);var a=xn(e,"onehotLabels","softmaxCrossEntropy"),o=xn(t,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=xn(n,"weights","softmaxCrossEntropy")),O(a.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){var u=Bn(r),c=Bn(1),l=Bn(a.shape[1]);a=a.mul(c.sub(u)).add(u.div(l))}var f=function(e,t,n){if(void 0===n&&(n=-1),-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+t.rank+" and dim was "+n);return sa((function(e,t,r){var i=t.logSumExp([n],!0),a=t.toFloat().sub(i);return r([e,a]),{value:a.mul(e).neg().sum([n]),gradFunc:function(e,t){var r=t[0],i=t[1],a=Sn(e.shape,[n]);return[e.reshape(a).mul(r.toFloat().sub(i.exp())),e.reshape(a).mul(i.exp().sub(r.toFloat()))]}}}))(e,t)}(a,o);return _l(f,s,i)}}),Tl=Object.freeze({get Reduction(){return pl},absoluteDifference:wl,computeWeightedLoss:_l,cosineDistance:kl,hingeLoss:El,huberLoss:Sl,logLoss:Cl,meanSquaredError:Al,sigmoidCrossEntropy:Ol,softmaxCrossEntropy:Dl});function jl(e,t){return void 0===t&&(t=!1),We.tidy((function(){if(2!==e.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+e.shape.length+"D Tensor.");for(var n=e.shape[0],r=e.shape[1],i=lu(n),a=e.clone(),o=zn([[1]],[1,1]),s=o.clone(),u=n>=r?r:n,c=function(e){var t,u=a,c=s,l=i;t=We.tidy((function(){var t=a.slice([e,e],[n-e,1]),u=t.norm(),c=a.slice([e,e],[1,1]),l=zn([[-1]]).where(c.greater(0),zn([[1]])),f=c.sub(l.mul(u)),d=t.div(f);s=1===d.shape[0]?o.clone():o.concat(d.slice([1,0],[d.shape[0]-1,d.shape[1]]),0);var h=l.matMul(f).div(u).neg(),p=a.slice([e,0],[n-e,r]),m=h.mul(s),v=s.transpose();if(0===e)a=p.sub(m.matMul(v.matMul(p)));else{var g=p.sub(m.matMul(v.matMul(p)));a=a.slice([0,0],[e,r]).concat(g,0)}var y=m.transpose(),b=i.slice([0,e],[n,i.shape[1]-e]);if(0===e)i=b.sub(b.matMul(s).matMul(y));else{var x=b.sub(b.matMul(s).matMul(y));i=i.slice([0,0],[n,e]).concat(x,1)}return[s,a,i]})),s=t[0],a=t[1],i=t[2],an([u,c,l])},l=0;l<u;++l)c(l);return!t&&n>r&&(i=i.slice([0,0],[n,r]),a=a.slice([0,0],[r,r])),[i,a]}))}var Ml=Mn({bandPart_:function(e,t,n){if(t%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+t+".");if(n%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+n+".");var r=xn(e,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var i=r.shape,a=r.shape.slice(-2),o=a[0],s=a[1];if(!(t<=o))throw new Error("bandPart(): numLower ("+t+") must not be greater than the number of rows ("+o+").");if(!(n<=s))throw new Error("bandPart(): numUpper ("+n+") must not be greater than the number of columns ("+s+").");t<0&&(t=o),n<0&&(n=s);var u=$n(0,o,1,"int32").reshape([-1,1]),c=$n(0,s,1,"int32"),l=Pi(u,c),f=nu(l.lessEqual(Bn(+t,"int32")),l.greaterEqual(Bn(-n,"int32"))),d=Xn([o,s],r.dtype);return mr(vr(r.reshape([-1,o,s])).map((function(e){return ou(f,e,d)}))).reshape(i)}}),Fl=Mn({gramSchmidt_:function(e){var t;if(Array.isArray(e)){t=!1,A(null!=e&&e.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var n=e[0].shape[0],r=function(t){A(e[t].shape[0]===n,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+e[t].shape[0]+" vs. "+n+")"}))},i=1;i<e.length;++i)r(i)}else t=!0,e=ir(e,e.shape[0],0).map((function(e){return pr(e,[0])}));A(e.length<=e[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors ("+e.length+") exceeds number of dimensions ("+e[0].shape[0]+")."}));var a=[],o=e,s=function(e){a.push(We.tidy((function(){var t=o[e];if(e>0)for(var n=0;n<e;++n){var r=Wc(a[n].mulStrict(t)).mul(a[n]);t=t.sub(r)}return t.div(Jc(t,"euclidean"))})))};for(i=0;i<e.length;++i)s(i);return t?mr(a,0):a}}),Il=Mn({qr_:function(e,t){if(void 0===t&&(t=!1),e.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+e.rank);if(2===e.rank)return jl(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce((function(e,t){return e*t})),r=[],i=[];return vr(e.reshape([n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0).forEach((function(e){var n=jl(e,t),a=n[0],o=n[1];r.push(a),i.push(o)})),[mr(r,0).reshape(e.shape),mr(i,0).reshape(e.shape)]}}),Nl=Object.freeze({bandPart:Ml,gramSchmidt:Fl,qr:Il});function Rl(e,t,n,r,i,a){null==r&&(r=.5),null==i&&(i=Number.NEGATIVE_INFINITY),null==a&&(a=0);var o=e.shape[0];return n=Math.min(n,o),A(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"})),A(2===e.rank,(function(){return"boxes must be a 2D tensor, but was of rank '"+e.rank+"'"})),A(4===e.shape[1],(function(){return"boxes must have 4 columns, but 2nd dimension was "+e.shape[1]})),A(1===t.rank,(function(){return"scores must be a 1D tensor"})),A(t.shape[0]===o,(function(){return"scores has incompatible shape with boxes. Expected "+o+", but was "+t.shape[0]})),A(0<=a&&a<=1,(function(){return"softNmsSigma must be in [0, 1], but was '"+a+"'"})),{maxOutputSize:n,iouThreshold:r,scoreThreshold:i,softNmsSigma:a}}var Pl=Mn({resizeBilinear_:function(e,t,n){void 0===n&&(n=!1);var r=xn(e,"images","resizeBilinear");A(3===r.rank||4===r.rank,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."})),A(2===t.length,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."}));var i=r,a=!1;3===r.rank&&(a=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var o=t[0],s=t[1],u=We.runKernelFunc((function(e,t){return t([i]),e.resizeBilinear(i,o,s,n)}),{x:i},(function(e,t){return{x:function(){return We.runKernelFunc((function(r){return r.resizeBilinearBackprop(e,t[0],n)}),{})}}}),"ResizeBilinear",{alignCorners:n,newHeight:o,newWidth:s});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Bl=Mn({resizeNearestNeighbor_:function(e,t,n){void 0===n&&(n=!1);var r=xn(e,"images","resizeNearestNeighbor");A(3===r.rank||4===r.rank,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."})),A(2===t.length,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."})),A("float32"===r.dtype||"int32"===r.dtype,(function(){return"`images` must have `int32` or `float32` as dtype"}));var i=r,a=!1;3===r.rank&&(a=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var o=t[0],s=t[1],u=We.runKernelFunc((function(e,t){return t([i]),e.resizeNearestNeighbor(i,o,s,n)}),{batchImages:i},(function(e,t){return{batchImages:function(){return We.runKernelFunc((function(r){return r.resizeNearestNeighborBackprop(e,t[0],n)}),{})}}}));return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Ll=Mn({nonMaxSuppression_:function(e,t,n,r,i){void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY);var a=xn(e,"boxes","nonMaxSuppression"),o=xn(t,"scores","nonMaxSuppression"),s=Rl(a,o,n,r,i);n=s.maxOutputSize,r=s.iouThreshold,i=s.scoreThreshold;var u={maxOutputSize:n,iouThreshold:r,scoreThreshold:i};return We.runKernelFunc((function(e){return e.nonMaxSuppression(a,o,n,r,i)}),{boxes:a,scores:o},null,"NonMaxSuppressionV3",u)}}),zl=Mn({nonMaxSuppressionWithScore_:function(e,t,n,r,i,a){void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),void 0===a&&(a=0);var o=xn(e,"boxes","nonMaxSuppression"),s=xn(t,"scores","nonMaxSuppression"),u=Rl(o,s,n,r,i,a),c={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:i=u.scoreThreshold,softNmsSigma:a=u.softNmsSigma},l=We.runKernel("NonMaxSuppressionV5",{boxes:o,scores:s},c);return{selectedIndices:l[0],selectedScores:l[1]}}}),Ul=Mn({cropAndResize_:function(e,t,n,r,i,a){var o=xn(e,"image","cropAndResize"),s=xn(t,"boxes","cropAndResize","float32"),u=xn(n,"boxInd","cropAndResize","int32");i=i||"bilinear",a=a||0;var c=s.shape[0];return A(4===o.rank,(function(){return"Error in cropAndResize: image must be rank 4,but got rank "+o.rank+"."})),A(2===s.rank&&4===s.shape[1],(function(){return"Error in cropAndResize: boxes must be have size ["+c+",4] but had shape "+s.shape+"."})),A(1===u.rank&&u.shape[0]===c,(function(){return"Error in cropAndResize: boxInd must be have size ["+c+"] but had shape "+s.shape+"."})),A(2===r.length,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."})),A(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was "+r})),A("bilinear"===i||"nearest"===i,(function(){return"method must be bilinear or nearest, but was "+i})),We.runKernelFunc((function(e,t){return e.cropAndResize(o,s,u,r,i,a)}),{images:o,boxes:s,boxInd:u},null,"CropAndResize",{method:i,extrapolationValue:a,cropSize:r})}}),Wl=Object.freeze({resizeBilinear:Pl,resizeNearestNeighbor:Bl,nonMaxSuppression:Ll,nonMaxSuppressionAsync:function(e,t,n,r,i){return void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),u(this,void 0,void 0,(function(){var a,o,s,u,l,f,d;return c(this,(function(c){switch(c.label){case 0:return a=xn(e,"boxes","nonMaxSuppressionAsync"),o=xn(t,"scores","nonMaxSuppressionAsync"),s=Rl(a,o,n,r,i),n=s.maxOutputSize,r=s.iouThreshold,i=s.scoreThreshold,[4,Promise.all([a.data(),o.data()])];case 1:return u=c.sent(),l=u[0],f=u[1],d=Pa(l,f,n,r,i),a!==e&&a.dispose(),o!==t&&o.dispose(),[2,d]}}))}))},nonMaxSuppressionWithScore:zl,nonMaxSuppressionWithScoreAsync:function(e,t,n,r,i,a){return void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),void 0===a&&(a=0),u(this,void 0,void 0,(function(){var o,s,u,l,f,d,h;return c(this,(function(c){switch(c.label){case 0:return o=xn(e,"boxes","nonMaxSuppressionAsync"),s=xn(t,"scores","nonMaxSuppressionAsync"),u=Rl(o,s,n,r,i,a),n=u.maxOutputSize,r=u.iouThreshold,i=u.scoreThreshold,a=u.softNmsSigma,[4,Promise.all([o.data(),s.data()])];case 1:return l=c.sent(),f=l[0],d=l[1],h=Ba(f,d,n,r,i,a),o!==e&&o.dispose(),s!==t&&s.dispose(),[2,h]}}))}))},cropAndResize:Ul}),Vl=function(e,t){return!(e>0)||"linear"===t},Gl=function(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return e.mul(t.step());throw new Error("Gradient for activation "+n+" has not been implemented yet.")},ql=function(e,t){var n=t,r=zr(e.shape,t.shape);return r.length>0&&(n=n.sum(r)),n.reshape(e.shape)},Hl=function(e,t,n){if("linear"===t)return e;if("relu"===t)return Xc(e);if("elu"===t)return Gc(e);if("relu6"===t)return Kc(e);if("prelu"===t)return Hc(e,n);throw new Error("Unknown fused activation "+t+".")},Xl=Mn({fusedMatMul_:function(e){var t,n=e.a,r=e.b,i=e.transposeA,a=void 0!==i&&i,o=e.transposeB,s=void 0!==o&&o,u=e.bias,c=e.activation,l=void 0===c?"linear":c,f=e.preluActivationWeights;if(!1===Vl(We.state.gradientDepth,l)){var d=fc(n,r,a,s);return null!=u&&(d=Br(d,u)),Hl(d,l,f)}var h=xn(n,"a","fused matMul"),p=xn(r,"b","fused matMul");t=Ne(h,p),h=t[0],p=t[1];var m=a?h.shape[h.rank-2]:h.shape[h.rank-1],v=s?p.shape[p.rank-1]:p.shape[p.rank-2],g=a?h.shape[h.rank-1]:h.shape[h.rank-2],y=s?p.shape[p.rank-2]:p.shape[p.rank-1],b=h.shape.slice(0,-2),x=p.shape.slice(0,-2),w=j(b),_=j(x);A(h.rank>=2&&p.rank>=2&&h.rank===p.rank,(function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+h.rank+" and "+p.rank+"."})),A(M(b,x),(function(){return"Error in fused matMul: outer dimensions ("+b+") and ("+x+") of Tensors with shapes "+h.shape+" and "+p.shape+" must match."})),A(m===v,(function(){return"Error in fused matMul: inner shapes ("+m+") and ("+v+") of Tensors with shapes "+h.shape+" and "+p.shape+" and transposeA="+a+" and transposeB="+s+" must match."}));var k,E,S=h.shape.slice(0,-2).concat([g,y]),C=a?h.as3D(w,m,g):h.as3D(w,g,m),O=s?p.as3D(_,y,v):p.as3D(_,v,y);null!=u&&Ur(S,(k=Ne(k=xn(u,"bias","fused matMul"),h)[0]).shape),null!=f&&(E=xn(f,"prelu weights","fused matMul"));var D={a:C,b:O};null!=u&&(D.bias=k),null!=f&&(D.preluActivationWeights=E);var T=[C,O];return We.runKernelFunc((function(e,t){var n=e.fusedBatchMatMul({a:C,b:O,transposeA:a,transposeB:s,bias:k,activation:l,preluActivationWeights:E});return t([C,O,n]),n}),D,(function(e,t){var n=t[0],r=t[1],i=t[2],o=Gl(e,i,l),c={};return null!=u&&(c={bias:function(){return ql(k,o)}}),a||s?!a&&s?Object.assign({a:function(){return o.matMul(r,!1,!1)},b:function(){return o.matMul(n,!0,!1)}},c):a&&!s?Object.assign({a:function(){return r.matMul(o,!1,!0)},b:function(){return n.matMul(o,!1,!1)}},c):Object.assign({a:function(){return r.matMul(o,!0,!0)},b:function(){return o.matMul(n,!0,!0)}},c):Object.assign({a:function(){return o.matMul(r,!1,!0)},b:function(){return n.matMul(o,!0,!1)}},c)}),"_FusedMatMul",{transposeA:a,transposeB:s,activation:l},T,[!0]).reshape(S)}}),Kl=Mn({fusedConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,i=e.pad,a=e.dataFormat,o=void 0===a?"NHWC":a,s=e.dilations,u=void 0===s?[1,1]:s,c=e.dimRoundingMode,l=e.bias,f=e.activation,d=void 0===f?"linear":f,h=e.preluActivationWeights;if(d=d||"linear",!1===Vl(We.state.gradientDepth,d)){var p=tc(t,n,r,i,o,u,c);return null!=l&&(p=Br(p,l)),Hl(p,d,h)}var m=xn(t,"x","conv2d"),v=xn(n,"filter","conv2d"),g=m,y=!1;3===m.rank&&(y=!0,g=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),A(4===g.rank,(function(){return"Error in fused conv2d: input must be rank 4, but got rank "+g.rank+"."})),A(4===v.rank,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+v.rank+"."})),null!=c&&A(F(i),(function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+c+" but got pad "+i+"."})),A(g.shape[3]===v.shape[2],(function(){return"Error in conv2d: depth of input ("+g.shape[3]+") must match input depth for filter "+v.shape[2]+"."})),A(Sa(r,u),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"})),A("NHWC"===o,(function(){return"Error in conv2d: got dataFormat of "+o+" but only NHWC is currently supported."}));var b,x,w=ga(g.shape,v.shape,r,u,i,c);null!=l&&(b=Ne(b=xn(l,"bias","fused conv2d"),m)[0],Ur(w.outShape,b.shape)),null!=h&&(x=xn(h,"prelu weights","fused conv2d"));var _={x:g,filter:v};null!=l&&(_.bias=b),null!=h&&(_.preluActivationWeights=x);var k=[v,g],E=We.runKernelFunc((function(e,t){var n=e.fusedConv2d({input:g,filter:v,convInfo:w,bias:b,activation:d,preluActivationWeights:x});return t([v,g,n]),n}),_,(function(e,t){var n=t,a=n[0],o=n[1],s=n[2],c=Gl(e,s,d);A(Ea(u),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"}));var f={};return null!=l&&(f={bias:function(){return ql(b,c)}}),Object.assign({x:function(){return ic(o.shape,c,a,r,i)},filter:function(){return rc(o,c,a.shape,r,i)}},f)}),"FusedConv2D",{convInfo:w,activation:d},k,[!0]);return y?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}}),Yl=Mn({fusedDepthwiseConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,i=e.pad,a=e.dataFormat,o=void 0===a?"NHWC":a,s=e.dilations,u=void 0===s?[1,1]:s,c=e.dimRoundingMode,l=e.bias,f=e.activation,d=void 0===f?"linear":f,h=e.preluActivationWeights;if(!1===Vl(We.state.gradientDepth,d)){var p=ac(t,n,r,i,o,u,c);return null!=l&&(p=Br(p,l)),Hl(p,d,h)}var m=xn(t,"x","depthwiseConv2d"),v=xn(n,"filter","depthwiseConv2d"),g=m,y=!1;3===m.rank&&(y=!0,g=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),A(4===g.rank,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+g.rank+"."})),A(4===v.rank,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+v.rank+"."})),A(g.shape[3]===v.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels ("+g.shape[3]+") must match the inChannels dimension in filter "+v.shape[2]+"."})),null==u&&(u=[1,1]),A(Sa(r,u),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"})),null!=c&&A(F(i),(function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+c+" but got pad "+i+"."}));var b,x,w=ga(g.shape,v.shape,r,u,i,c,!0);null!=l&&(b=Ne(b=xn(l,"bias","fused conv2d"),m)[0],Ur(w.outShape,b.shape)),null!=h&&(x=xn(h,"prelu weights","fused depthwiseConv2d"));var _={x:g,filter:v};null!=l&&(_.bias=b),null!=h&&(_.preluActivationWeights=x);var k=[v,g],E=We.runKernelFunc((function(e,t){var n=e.fusedDepthwiseConv2D({input:g,filter:v,convInfo:w,bias:b,activation:d,preluActivationWeights:x});return t([v,g,n]),n}),_,(function(e,t){A(Ea(u),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"}));var n=t[0],r=t[1],i=t[2],a=Gl(e,i,d),o={};return null!=l&&(o={bias:function(){return ql(b,a)}}),Object.assign({x:function(){return oc(r.shape,a,n,w)},filter:function(){return sc(r,a,n.shape,w)}},o)}),"FusedDepthwiseConv2D",{convInfo:w,activation:d},k,[!0]);return y?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}}),$l=Object.freeze({matMul:Xl,conv2d:Kl,depthwiseConv2d:Yl}),Jl=Object.freeze({image:Wl,linalg:Nl,losses:Tl,spectral:ul,fused:$l,signal:bl,add:Br,addN:Bs,batchNorm:Gs,batchNormalization:Vs,batchNorm2d:Xs,batchNormalization2d:Hs,batchNorm3d:$s,batchNormalization3d:Ys,batchNorm4d:Qs,batchNormalization4d:Zs,broadcastTo:eu,clone:tu,div:Li,divNoNan:uu,eye:lu,multinomial:fu,oneHot:du,pad:hu,pad1d:pu,pad2d:mu,pad3d:vu,pad4d:gu,rand:yu,randomGamma:Ou,randomNormal:Du,randomUniform:Tu,square:ju,squaredDifference:Mu,tile:cu,truncatedNormal:Fu,conv1d:ec,conv2d:tc,conv3d:nc,depthwiseConv2d:ac,separableConv2d:uc,conv2dTranspose:cc,conv3dTranspose:lc,op:Mn,booleanMaskAsync:$u,complex:Fn,real:In,imag:Nn,concat:Qn,concat1d:er,concat2d:tr,concat3d:nr,concat4d:rr,split:ir,matMul:fc,dot:dc,outerProduct:hc,reverse:pc,reverse1d:mc,reverse2d:vc,reverse3d:gc,reverse4d:yc,maxPool:wc,avgPool:_c,pool:kc,maxPool3d:Ec,avgPool3d:Sc,maxPoolWithArgmax:Cc,slice:Ac,slice1d:Oc,slice2d:Dc,slice3d:Tc,slice4d:jc,abs:Wr,acos:Vr,acosh:Gr,asin:qr,asinh:Hr,atan:Xr,atanh:Kr,ceil:Yr,clipByValue:$r,cos:Jr,cosh:Zr,erf:Qr,exp:ei,expm1:ti,floor:ni,log:ri,log1p:ii,logSigmoid:ai,neg:oi,reciprocal:si,round:ui,rsqrt:ci,sigmoid:li,sign:fi,isNaN:di,isInf:hi,isFinite:pi,sin:mi,sinh:vi,softplus:gi,sqrt:yi,step:bi,tan:xi,tanh:wi,all:Fc,any:Ic,argMax:Nc,argMin:Rc,logSumExp:Pc,max:Bc,mean:Lc,min:zc,moments:Uc,sum:Wc,prod:Vc,equal:Iu,equalStrict:Nu,greater:Ru,greaterEqual:Pu,greaterEqualStrict:Bu,greaterStrict:Lu,less:zu,lessEqual:Uu,lessEqualStrict:Wu,lessStrict:Vu,notEqual:Gu,notEqualStrict:qu,addStrict:_i,atan2:ki,divStrict:Ei,floorDiv:Si,maximum:Ci,maximumStrict:Ai,minimum:Oi,minimumStrict:Di,mod:Ti,modStrict:ji,mul:Mi,mulStrict:Fi,pow:Ii,powStrict:Ni,squaredDifferenceStrict:Ri,sub:Pi,subStrict:Bi,elu:Gc,leakyRelu:qc,prelu:Hc,relu:Xc,relu6:Kc,selu:Yc,logicalAnd:nu,logicalNot:ru,logicalOr:iu,logicalXor:au,where:ou,whereAsync:su,buffer:ar,print:or,batchToSpaceND:sr,cast:ur,cumsum:cr,depthToSpace:lr,expandDims:fr,reshape:dr,spaceToBatchND:hr,squeeze:pr,stack:mr,unstack:vr,setdiff1dAsync:gr,fill:Kn,linspace:Yn,ones:Hn,range:$n,scalar:Bn,tensor:Rn,tensor1d:Ln,tensor2d:zn,tensor3d:Un,tensor4d:Wn,tensor5d:Vn,tensor6d:Gn,variable:qn,zeros:Xn,onesLike:Jn,zerosLike:Zn,transpose:fa,softmax:ca,logSoftmax:la,localResponseNormalization:$c,norm:Jc,gather:Ku,unsortedSegmentSum:Yu,basicLSTMCell:Zc,multiRNNCell:Qc,movingAverage:el,stridedSlice:tl,topk:nl,scatterND:rl,fft:il,ifft:al,rfft:ol,irfft:sl,sparseToDense:cl,gatherND:ll,diag:fl,dropout:dl,hannWindow:ml,hammingWindow:vl,frame:gl,stft:yl,inTopKAsync:xl});function Zl(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&A("complex64"!==e.dtype,(function(){return t+" does not support complex64 tensors."}))}))}function Ql(e,t,n,r,i,a){for(var o=i.strideHeight,s=i.strideWidth,u=i.dilationHeight,c=i.dilationWidth,l=i.effectiveFilterHeight,f=i.effectiveFilterWidth,d=i.padInfo.top,h=i.padInfo.left,p="max"===a?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=ar(i.outShape,n),v=m.values,g=i.outShape[1]*i.outShape[2]*i.outShape[3],y=i.outShape[2]*i.outShape[3],b=i.outShape[3],x=0;x<i.batchSize;++x)for(var w=x*g,_=x*r[0],k=0;k<i.inChannels;++k)for(var E=0;E<i.outHeight;++E)for(var S=E*o-d,C=Math.max(0,S),A=Math.min(i.inHeight,l+S),O=w+E*y,D=0;D<i.outWidth;++D){for(var T=D*s-h,j=Math.max(0,T),M=Math.min(i.inWidth,f+T),F=p,I=0,N=0,R=C;R<A;R+=u){for(var P=_+R*r[1],B=j;B<M;B+=c){var L=e[P+B*r[2]+k];"max"===a&&L>F?F=L:"avg"===a&&(I+=L,N++)}if(isNaN(F))break}v[O+D*b+k]="avg"===a?I/N:F}return m}function ef(e,t,n,r,i,a){void 0===i&&(i=!1),void 0===a&&(a=!1);for(var o=ar(r.outShape,"int32"),s=r.strideHeight,u=r.strideWidth,c=r.dilationHeight,l=r.dilationWidth,f=r.effectiveFilterHeight,d=r.effectiveFilterWidth,h=r.padInfo.top,p=r.padInfo.left,m=ar(t,n,e),v=0;v<r.batchSize;++v)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.outHeight;++y){for(var b=y*s-h,x=b;x<0;)x+=c;for(var w=Math.min(r.inHeight,f+b),_=0;_<r.outWidth;++_){for(var k=_*u-p,E=k;E<0;)E+=l;for(var S=Math.min(r.inWidth,d+k),C=Number.NEGATIVE_INFINITY,A=-1,O=x;O<w;O+=c)for(var D=O-b,T=E;T<S;T+=l){var j=T-k,M=m.get(v,O,T,g);M>C&&(C=M,A=i?a?((v*r.inHeight+O)*r.inWidth+T)*r.inChannels+g:(O*r.inWidth+T)*r.inChannels+g:D*d+j)}o.set(A,v,y,_,g)}}return o}function tf(e,t,n,r){if("linear"===n)return e.linear(t);if("relu"===n)return e.relu(t);if("elu"===n)return e.elu(t);if("relu6"===n)return e.relu6(t);if("prelu"===n)return e.prelu(t,r);throw new Error("Activation "+n+" has not been implemented for the CPU backend.")}var nf=function(e){function t(){var t=e.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new da(t,We),t}return s(t,e),t.prototype.write=function(e,t,n){this.firstUse&&(this.firstUse=!1,f().get("IS_NODE")&&gn("\n============================\nHi there \ud83d\udc4b. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var r={};return this.data.set(r,{values:e,dtype:n}),r},t.prototype.move=function(e,t,n,r){this.data.set(e,{values:t,dtype:r})},t.prototype.numDataIds=function(){return this.data.numDataIds()},t.prototype.read=function(e){return u(this,void 0,void 0,(function(){return c(this,(function(t){return[2,this.readSync(e)]}))}))},t.prototype.readSync=function(e){var t=this.data.get(e),n=t.dtype,r=t.complexTensors;return"complex64"===n?ja(this.readSync(r.real.dataId),this.readSync(r.imag.dataId)):this.data.get(e).values},t.prototype.bufferSync=function(e){var t=this.readSync(e.dataId),n=t;if("string"===e.dtype)try{n=t.map((function(e){return ce(e)}))}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8")}return ar(e.shape,e.dtype,n)},t.prototype.makeOutput=function(e,t,n){var r=this.write(e,t,n);return We.makeTensorFromDataId(r,t,n,this)},t.prototype.disposeData=function(e){if(this.data.has(e)){var t=this.data.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.data.delete(e)}},t.prototype.time=function(e){return u(this,void 0,void 0,(function(){var t;return c(this,(function(n){return t=oe(),e(),[2,{kernelMs:oe()-t}]}))}))},t.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},t.prototype.complex=function(e,t){var n=this.makeOutput(null,e.shape,"complex64");return this.data.get(n.dataId).complexTensors={real:We.keep(e.clone()),imag:We.keep(t.clone())},n},t.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,t,n){if(Zl(e,"slice"),Qi(e.shape,t,n)){var r=ea(t,e.strides),i=j(n);return Rn(this.readSync(e.dataId).subarray(r,r+i),n,e.dtype)}for(var a=ar(n,e.dtype),o=this.bufferSync(e),s=0;s<a.size;++s){var u=a.indexToLoc(s).map((function(e,n){return e+t[n]}));a.values[s]=o.get.apply(o,u)}return a.toTensor()},t.prototype.stridedSlice=function(e,t,n,r){Zl(e,"stridedSlice");var i=$i(t,n,r);if(i.some((function(e){return 0===e})))return Rn([],i);for(var a=ar(i,e.dtype),o=this.bufferSync(e),s=0;s<a.size;s++){for(var u=a.indexToLoc(s),c=new Array(u.length),l=0;l<c.length;l++)c[l]=u[l]*r[l]+t[l];a.set.apply(a,[o.get.apply(o,c)].concat(u))}return a.toTensor()},t.prototype.diag=function(e){for(var t=this.readSync(e.dataId),n=ar([e.size,e.size],e.dtype),r=n.values,i=0;i<t.length;i++)r[i*e.size+i]=t[i];return n.toTensor()},t.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),i=0,a=0;a<e.rank;a++)a!==t&&(r[i++]=e.shape[a]);var o=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;var u=new Array(n);for(a=0;a<u.length;a++)o[t]=a,u[a]=this.slice(e,o,s).reshape(r);return u},t.prototype.reverse=function(e,t){Zl(e,"reverse");for(var n=ar(e.shape,e.dtype),r=this.bufferSync(e),i=function(i){var a=n.indexToLoc(i),o=a.slice();t.forEach((function(t){return o[t]=e.shape[t]-1-o[t]})),n.set.apply(n,[r.get.apply(r,o)].concat(a))},a=0;a<n.size;a++)i(a);return n.toTensor()},t.prototype.concat=function(e,t){var n=this;if("complex64"===e[0].dtype){var r=e.map((function(e){return In(e)})),i=e.map((function(e){return Nn(e)}));return Fn(this.concat(r,t),this.concat(i,t))}var a=e.map((function(e){var n=j(e.shape.slice(t));return e.as2D(-1,n)})),o=jn(a.map((function(e){return e.shape})),1),s=ar(o,e[0].dtype).values;if(1===a[0].shape[0]){var u=0;a.forEach((function(e){s.set(n.readSync(e.dataId),u),u+=e.size}))}else{var c=0;a.forEach((function(e){for(var t=n.readSync(e.dataId),r=0,i=0;i<e.shape[0];++i)for(var a=i*o[1]+c,u=0;u<e.shape[1];++u)s[a+u]=t[r++];c+=e.shape[1]}))}var l=jn(e.map((function(e){return e.shape})),t);return Rn(s,l,e[0].dtype)},t.prototype.neg=function(e){return Zl(e,"neg"),this.multiply(Bn(-1),e)},t.prototype.add=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),(function(e,t,n,r){return{real:e+n,imag:t+r}})):this.broadcastedBinaryOp(e,t,Fe(e.dtype,t.dtype),(function(e,t){return e+t}))},t.prototype.addN=function(e){var t=this;Zl(e,"addN");for(var n=e.map((function(e){return t.readSync(e.dataId)})),r=ar(e[0].shape,e[0].dtype),i=r.values,a=0;a<e.length;a++)for(var o=n[a],s=0;s<i.length;s++)i[s]+=o[s];return r.toTensor()},t.prototype.softmax=function(e,t){var n=L([t],e.shape),r=this.max(e,n),i=Sn(r.shape,n),a=this.subtract(e,r.reshape(i)),o=this.exp(a),s=this.sum(o,n).reshape(i);return Li(o,s)},t.prototype.subtract=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),(function(e,t,n,r){return{real:e-n,imag:t-r}})):this.broadcastedBinaryOp(e,t,Fe(e.dtype,t.dtype),(function(e,t){return e-t}))},t.prototype.pow=function(e,t){return Zl([e,t],"pow"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.pow(e,t)}))},t.prototype.batchMatMul=function(e,t,n,r){Zl([e,t],"matMul");for(var i=n?e.shape[1]:e.shape[2],a=n?e.shape[2]:e.shape[1],o=r?t.shape[1]:t.shape[2],s=e.shape[0],u=this.readSync(e.dataId),c=this.readSync(t.dataId),l=n?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],f=l[0],d=l[1],h=l[2],p=r?[1,t.strides[1],t.strides[0]]:[t.strides[1],1,t.strides[0]],m=p[0],v=p[1],g=p[2],y=a*o,b=ar([s,a,o],e.dtype),x=b.values,w=this.blockSize,_=0;_<s;_++)for(var k=0;k<a;k+=w)for(var E=0;E<o;E+=w)for(var S=0;S<i;S+=w)for(var C=Math.min(k+w,a),A=Math.min(E+w,o),O=Math.min(S+w,i),D=k;D<C;D++)for(var T=E;T<A;T++){for(var j=0,M=S;M<O;M++)j+=u[_*f+D*d+M*h]*c[M*m+T*v+_*g];x[_*y+(D*o+T)]+=j}return b.toTensor()},t.prototype.fusedBatchMatMul=function(e){var t=e.a,n=e.b,r=e.transposeA,i=e.transposeB,a=e.bias,o=e.activation,s=e.preluActivationWeights,u=this.batchMatMul(t,n,r,i);return a&&(u=this.add(u,a)),o&&(u=tf(this,u,o,s)),u},t.prototype.multiply=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),(function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}})):this.broadcastedBinaryOp(e,t,Fe(e.dtype,t.dtype),(function(e,t){return e*t}))},t.prototype.floorDiv=function(e,t){return Zl([e,t],"floorDiv"),this.broadcastedBinaryOp(e,t,"int32",(function(e,t){return Math.floor(e/t)}))},t.prototype.sum=function(e,t){Zl(e,"sum"),Cn("sum",t,e.rank);for(var n=En(e.shape,t),r=n[0],i=n[1],a=Xn(r,Fe(e.dtype,"int32")),o=j(i),s=this.readSync(a.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*o,f=0,d=0;d<o;++d)f+=u[l+d];s[c]=f}return a},t.prototype.prod=function(e,t){Zl(e,"sum");for(var n=En(e.shape,t),r=n[0],i=n[1],a=Xn(r,Fe(e.dtype,"int32")),o=j(i),s=this.readSync(a.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*o,f=1,d=0;d<o;++d)f*=u[l+d];s[c]=f}return a},t.prototype.unsortedSegmentSum=function(e,t,n){Zl(e,"unsortedSegmentSum");for(var r=[],i=e.rank-t.rank,a=0;a<i;++a)t=t.expandDims(a+1);for(a=0;a<n;++a){var o=Bn(a,"int32"),s=Iu(o,t).asType("float32").mul(e).sum(0);r.push(s)}return mr(r)},t.prototype.argMin=function(e,t){Zl(e,"argMin");var n=[t];Cn("argMin",n,e.rank);for(var r=En(e.shape,n),i=r[0],a=r[1],o=Xn(i,"int32"),s=j(a),u=this.readSync(o.dataId),c=this.readSync(e.dataId),l=0;l<u.length;++l){for(var f=l*s,d=c[f],h=0,p=0;p<s;++p){var m=c[f+p];m<d&&(d=m,h=p)}u[l]=h}return o},t.prototype.argMax=function(e,t){Zl(e,"argMax");var n=[t];Cn("argMax",n,e.rank);for(var r=En(e.shape,n),i=r[0],a=r[1],o=Xn(i,"int32"),s=j(a),u=this.readSync(o.dataId),c=this.readSync(e.dataId),l=0;l<u.length;++l){for(var f=l*s,d=c[f],h=0,p=0;p<s;++p){var m=c[f+p];m>d&&(d=m,h=p)}u[l]=h}return o},t.prototype.cumsum=function(e,t,n,r){if(Zl(e,"cumsum"),t!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+t);for(var i=Fe(e.dtype,"int32"),a=Xn(e.shape,i),o=this.readSync(a.dataId),s=this.readSync(e.dataId),u=e.shape[e.rank-1],c=r?function(e,t){return e+u-t-1}:function(e,t){return e+t},l=0;l<s.length;l+=u)for(var f=0;f<u;f++){var d=c(l,f);if(0===f)o[d]=n?0:s[d];else{var h=c(l,f-1);o[d]=n?s[h]+o[h]:s[d]+o[h]}}return a},t.prototype.equal=function(e,t){return Zl([e,t],"equal"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e===t?1:0}))},t.prototype.notEqual=function(e,t){return Zl([e,t],"notEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e!==t?1:0}))},t.prototype.less=function(e,t){return Zl([e,t],"less"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e<t?1:0}))},t.prototype.lessEqual=function(e,t){return Zl([e,t],"lessEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e<=t?1:0}))},t.prototype.greater=function(e,t){return Zl([e,t],"greater"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e>t?1:0}))},t.prototype.greaterEqual=function(e,t){return Zl([e,t],"greaterEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e>=t?1:0}))},t.prototype.logicalNot=function(e){Zl(e,"logicalNot");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t[r]?0:1;return this.makeOutput(n,e.shape,"bool")},t.prototype.logicalAnd=function(e,t){return Zl([e,t],"logicalAnd"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e&&t}))},t.prototype.logicalOr=function(e,t){return Zl([e,t],"logicalOr"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e||t}))},t.prototype.select=function(e,t,n){Zl([e,t,n],"select");for(var r=this.readSync(e.dataId),i=this.readSync(t.dataId),a=this.readSync(n.dataId),o=Xn(t.shape,Fe(t.dtype,n.dtype)),s=this.readSync(o.dataId),u=0,c=0===e.rank||e.rank>1||1===t.rank?1:j(t.shape.slice(1)),l=0;l<r.length;l++)for(var f=0;f<c;f++)1===r[l]?s[u++]=i[l]:s[u++]=a[l];return o},t.prototype.where=function(e){Zl([e],"where");var t=this.readSync(e.dataId);return Ha(e.shape,t)},t.prototype.topk=function(e,t,n){return Zl(e,"topk"),qa(this.readSync(e.dataId),e.shape,e.dtype,t)},t.prototype.min=function(e,t){Zl(e,"min"),Cn("min",t,e.rank);for(var n=En(e.shape,t),r=n[0],i=n[1],a=Xn(r,e.dtype),o=j(i),s=this.readSync(a.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*o,f=u[l],d=0;d<o;++d){var h=u[l+d];h<f&&(f=h)}s[c]=f}return a},t.prototype.minimum=function(e,t){return Zl([e,t],"minimum"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.min(e,t)}))},t.prototype.mod=function(e,t){return Zl([e,t],"mod"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t}))},t.prototype.max=function(e,t){Zl(e,"max"),Cn("max",t,e.rank);for(var n=En(e.shape,t),r=n[0],i=n[1],a=Xn(r,e.dtype),o=j(i),s=this.readSync(a.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*o,f=u[l],d=0;d<o;++d){var h=u[l+d];h>f&&(f=h)}s[c]=f}return a},t.prototype.maximum=function(e,t){return Zl([e,t],"maximum"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.max(e,t)}))},t.prototype.all=function(e,t){Zl(e,"all"),Cn("all",t,e.rank);for(var n=En(e.shape,t),r=n[0],i=n[1],a=Xn(r,e.dtype),o=j(i),s=this.readSync(a.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*o,f=u[l],d=0;d<o;++d){var h=u[l+d];f=f&&h}s[c]=f}return a},t.prototype.any=function(e,t){Zl(e,"any"),Cn("any",t,e.rank);for(var n=En(e.shape,t),r=n[0],i=n[1],a=Xn(r,e.dtype),o=j(i),s=this.readSync(a.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*o,f=u[l],d=0;d<o;++d){var h=u[l+d];f=f||h}s[c]=f}return a},t.prototype.squaredDifference=function(e,t){return Zl([e,t],"squaredDifference"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){var n=e-t;return n*n}))},t.prototype.ceil=function(e){Zl(e,"ceil");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.ceil(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.floor=function(e){Zl(e,"floor");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.floor(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.sign=function(e){Zl(e,"x");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)t[r]<0?n[r]=-1:t[r]>0?n[r]=1:n[r]=0;return this.makeOutput(n,e.shape,"float32")},t.prototype.isNaN=function(e){Zl(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isNaN(t[r])&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.isInf=function(e){Zl(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Math.abs(t[r])===1/0&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.isFinite=function(e){Zl(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isFinite(t[r])&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.round=function(e){Zl(e,"round");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=Math.floor(t[r]);t[r]-i<.5?n[r]=Math.floor(t[r]):t[r]-i>.5?n[r]=Math.ceil(t[r]):n[r]=i%2==0?i:i+1}return this.makeOutput(n,e.shape,"float32")},t.prototype.exp=function(e){Zl(e,"exp");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.exp(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.expm1=function(e){Zl(e,"expm1");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.expm1(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.log=function(e){Zl(e,"log");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=t[r];n[r]=Math.log(i)}return this.makeOutput(n,e.shape,"float32")},t.prototype.log1p=function(e){Zl(e,"log1p");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=t[r];n[r]=Math.log1p(i)}return this.makeOutput(n,e.shape,"float32")},t.prototype.sqrt=function(e){Zl(e,"sqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=t[r];n[r]=Math.sqrt(i)}return this.makeOutput(n,e.shape,"float32")},t.prototype.rsqrt=function(e){Zl(e,"rsqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=t[r];n[r]=1/Math.sqrt(i)}return this.makeOutput(n,e.shape,"float32")},t.prototype.reciprocal=function(e){Zl(e,"reciprocal");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=1/t[r];return this.makeOutput(n,e.shape,"float32")},t.prototype.linear=function(e){return e},t.prototype.relu=function(e){Zl(e,"relu");for(var t=Xn(e.shape,e.dtype),n=this.readSync(t.dataId),r=this.readSync(e.dataId),i=0;i<r.length;++i)n[i]=Math.max(0,r[i]);return t},t.prototype.relu6=function(e){Zl(e,"relu");for(var t=Xn(e.shape,e.dtype),n=this.readSync(t.dataId),r=this.readSync(e.dataId),i=0;i<r.length;++i)n[i]=Math.min(Math.max(0,r[i]),6);return t},t.prototype.prelu=function(e,t){return Zl([e,t],"prelu"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return e<0?t*e:e}))},t.prototype.elu=function(e){Zl(e,"elu");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var i=n[r];t[r]=i>=0?i:Math.exp(i)-1}return this.makeOutput(t,e.shape,"float32")},t.prototype.eluDer=function(e,t){Zl([e,t],"eluDer");for(var n=new Float32Array(t.size),r=this.readSync(t.dataId),i=this.readSync(e.dataId),a=0;a<r.length;++a){var o=r[a];n[a]=o>=1?i[a]:i[a]*(o+1)}return this.makeOutput(n,t.shape,"float32")},t.prototype.selu=function(e){Zl(e,"selu");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var i=n[r];t[r]=i>=0?1.0507009873554805*i:1.7580993408473768*(Math.exp(i)-1)}return this.makeOutput(t,e.shape,"float32")},t.prototype.clip=function(e,t,n){Zl(e,"clip");for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),a=0;a<i.length;++a){var o=i[a];r[a]=o>n?n:o<t?t:o}return this.makeOutput(r,e.shape,"float32")},t.prototype.abs=function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.abs(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.complexAbs=function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<e.size;++r){var i=n[2*r],a=n[2*r+1];t[r]=Math.hypot(i,a)}return this.makeOutput(t,e.shape,"float32")},t.prototype.int=function(e){Zl(e,"int");for(var t=new Int32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=n[r];return this.makeOutput(t,e.shape,"int32")},t.prototype.sigmoid=function(e){Zl(e,"sigmoid");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=1/(1+Math.exp(-n[r]));return this.makeOutput(t,e.shape,"float32")},t.prototype.softplus=function(e){Zl(e,"softplus");for(var t=Math.log(1.1920928955078125e-7)+2,n=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i){var a,o=r[i]>-t,s=r[i]<t,u=Math.exp(r[i]);a=s?u:o?r[i]:Math.log(1+u),n[i]=a}return this.makeOutput(n,e.shape,"float32")},t.prototype.sin=function(e){Zl(e,"sin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.sin(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.cos=function(e){Zl(e,"cos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.cos(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.tan=function(e){Zl(e,"tan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.tan(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.asin=function(e){Zl(e,"asin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.asin(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.acos=function(e){Zl(e,"acos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.acos(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atan=function(e){Zl(e,"atan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.atan(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atan2=function(e,t){return Zl([e,t],"atan2"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.atan2(e,t)}))},t.prototype.sinh=function(e){Zl(e,"sinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.sinh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.cosh=function(e){Zl(e,"cosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.cosh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.tanh=function(e){Zl(e,"tanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=I(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.asinh=function(e){Zl(e,"asinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.asinh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.acosh=function(e){Zl(e,"acosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.acosh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atanh=function(e){Zl(e,"atanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.atanh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.erf=function(e){Zl(e,"erf");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var i=Math.sign(n[r]),a=Math.abs(n[r]),o=1/(1+.3275911*a);t[r]=i*(1-((((1.061405429*o-1.453152027)*o+1.421413741)*o-.284496736)*o+.254829592)*o*Math.exp(-a*a))}return this.makeOutput(t,e.shape,"float32")},t.prototype.step=function(e,t){void 0===t&&(t=0),Zl(e,"step");for(var n=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i){var a=r[i];isNaN(a)?n[i]=NaN:n[i]=a>0?1:t}return this.makeOutput(n,e.shape,"float32")},t.prototype.fusedConv2d=function(e){var t=e.input,n=e.filter,r=e.convInfo,i=e.bias,a=e.activation,o=e.preluActivationWeights,s=this.conv2d(t,n,r);return i&&(s=this.add(s,i)),a&&(s=tf(this,s,a,o)),s},t.prototype.conv2d=function(e,t,n){Zl([e,t],"conv2d");for(var r=n.filterHeight,i=n.filterWidth,a=n.dilationHeight,o=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,c="channelsLast"===n.dataFormat,l=ar(n.outShape,e.dtype),f=e.strides[0],d=c?e.strides[1]:e.strides[2],h=c?e.strides[2]:1,p=c?1:e.strides[1],m=l.strides[0],v=c?l.strides[1]:l.strides[2],g=c?l.strides[2]:1,y=c?1:l.strides[1],b=this.readSync(e.dataId),x=this.readSync(t.dataId),w=l.values,_=0;_<n.batchSize;++_)for(var k=_*f,E=_*m,S=0;S<n.outHeight;++S)for(var C=E+S*v,A=S*n.strideHeight-u,O=0;O<r;O++){var D=A+O*a;if(!(D<0||D>=n.inHeight))for(var T=O*t.strides[0],j=k+D*d,M=0;M<n.outWidth;++M)for(var F=C+M*g,I=M*n.strideWidth-s,N=0;N<i;N++){var R=I+N*o;if(!(R<0||R>=n.inWidth))for(var P=j+R*h,B=T+N*t.strides[1],L=0;L<n.inChannels;++L){for(var z=b[P+L*p],U=0;U<n.outChannels;++U)w[F+U*y]+=z*x[B+U];B+=n.outChannels}}}return l.toTensor()},t.prototype.conv3d=function(e,t,n){for(var r=n.filterDepth,i=n.filterHeight,a=n.filterWidth,o=n.dilationDepth,s=n.dilationHeight,u=n.dilationWidth,c=n.padInfo.front,l=n.padInfo.left,f=n.padInfo.top,d=ar(n.outShape,e.dtype),h=this.readSync(e.dataId),p=this.readSync(t.dataId),m=d.values,v=0;v<n.batchSize;++v)for(var g=v*e.strides[0],y=v*d.strides[0],b=0;b<n.outDepth;++b)for(var x=y+b*d.strides[1],w=b*n.strideDepth-c,_=0;_<r;_++){var k=w+_*o;if(!(k<0||k>=n.inDepth))for(var E=_*t.strides[0],S=g+k*e.strides[1],C=0;C<n.outHeight;++C)for(var A=x+C*d.strides[2],O=C*n.strideHeight-f,D=0;D<i;D++){var T=O+D*s;if(!(T<0||T>=n.inHeight))for(var j=E+D*t.strides[1],M=S+T*e.strides[2],F=0;F<n.outWidth;++F)for(var I=A+F*n.outChannels,N=F*n.strideWidth-l,R=0;R<a;R++){var P=N+R*u;if(!(P<0||P>=n.inWidth))for(var B=j+R*t.strides[2],L=M+P*n.inChannels,z=B,U=0;U<n.inChannels;++U){for(var W=h[L+U],V=0;V<n.outChannels;++V)m[I+V]+=W*p[z+V];z+=n.outChannels}}}}return d.toTensor()},t.prototype.conv2dDerInput=function(e,t,n){Zl([e,t],"conv2dDerInput");for(var r=ar(n.inShape,"float32"),i=r.values,a=this.readSync(e.dataId),o=this.readSync(t.dataId),s=t.strides,u=s[0],c=s[1],l=s[2],f=n.batchSize,d=n.filterHeight,h=n.filterWidth,p=n.inChannels,m=n.inHeight,v=n.inWidth,g=n.outChannels,y=n.outHeight,b=n.outWidth,x=n.strideHeight,w=n.strideWidth,_=n.dataFormat,k=d-1-n.padInfo.top,E=h-1-n.padInfo.left,S="channelsLast"===_,C=r.strides[0],A=S?r.strides[1]:r.strides[2],O=S?r.strides[2]:1,D=S?1:r.strides[1],T=e.strides[0],j=S?e.strides[1]:e.strides[2],M=S?e.strides[2]:1,F=S?1:e.strides[1],I=0;I<f;++I)for(var N=0;N<p;++N)for(var R=0;R<m;++R)for(var P=R-k,B=Math.max(0,Math.ceil(P/x)),L=Math.min(y,(d+P)/x),z=0;z<v;++z){for(var U=z-E,W=Math.max(0,Math.ceil(U/w)),V=Math.min(b,(h+U)/w),G=0,q=B;q<L;++q)for(var H=q*x-P,X=W;X<V;++X)for(var K=T*I+j*q+M*X,Y=u*(d-1-H)+c*(h-1-(X*w-U))+l*N,$=0;$<g;++$)G+=a[K+F*$]*o[Y+$];i[C*I+A*R+O*z+D*N]=G}return r.toTensor()},t.prototype.conv3dDerInput=function(e,t,n){for(var r=ar(n.inShape,"float32"),i=r.values,a=r.strides,o=a[0],s=a[1],u=a[2],c=a[3],l=this.readSync(e.dataId),f=e.strides,d=f[0],h=f[1],p=f[2],m=f[3],v=this.readSync(t.dataId),g=t.strides,y=g[0],b=g[1],x=g[2],w=g[3],_=n.batchSize,k=n.filterDepth,E=n.filterHeight,S=n.filterWidth,C=n.inChannels,A=n.inDepth,O=n.inHeight,D=n.inWidth,T=n.outChannels,j=n.outDepth,M=n.outHeight,F=n.outWidth,I=n.strideDepth,N=n.strideHeight,R=n.strideWidth,P=k-1-n.padInfo.front,B=E-1-n.padInfo.top,L=S-1-n.padInfo.left,z=0;z<_;++z)for(var U=0;U<C;++U)for(var W=0;W<A;++W)for(var V=W-P,G=Math.max(0,Math.ceil(V/I)),q=Math.min(j,(k+V)/I),H=0;H<O;++H)for(var X=H-B,K=Math.max(0,Math.ceil(X/N)),Y=Math.min(M,(E+X)/N),$=0;$<D;++$){for(var J=$-L,Z=Math.max(0,Math.ceil(J/R)),Q=Math.min(F,(S+J)/R),ee=0,te=G;te<q;++te)for(var ne=te*I-V,re=K;re<Y;++re)for(var ie=re*N-X,ae=Z;ae<Q;++ae)for(var oe=d*z+h*te+p*re+m*ae,se=y*(k-1-ne)+b*(E-1-ie)+x*(S-1-(ae*R-J))+w*U,ue=0;ue<T;++ue)ee+=l[oe+ue]*v[se+ue];i[o*z+s*W+u*H+c*$+U]=ee}return r.toTensor()},t.prototype.conv2dDerFilter=function(e,t,n){Zl([e,t],"conv2dDerFilter");for(var r=n.strideHeight,i=n.strideWidth,a=n.filterHeight,o=n.filterWidth,s="channelsLast"===n.dataFormat,u=ar(n.filterShape,"float32"),c=n.padInfo.left,l=n.padInfo.top,f=this.bufferSync(e),d=this.bufferSync(t),h=0;h<a;++h)for(var p=Math.max(0,Math.ceil((l-h)/r)),m=Math.min(n.outHeight,(n.inHeight+l-h)/r),v=0;v<o;++v)for(var g=Math.max(0,Math.ceil((c-v)/i)),y=Math.min(n.outWidth,(n.inWidth+c-v)/i),b=0;b<n.inChannels;++b)for(var x=0;x<n.outChannels;++x){for(var w=0,_=0;_<n.batchSize;++_)for(var k=p;k<m;++k)for(var E=h+k*r-l,S=g;S<y;++S){var C=v+S*i-c;w+=s?f.get(_,E,C,b)*d.get(_,k,S,x):f.get(_,b,E,C)*d.get(_,x,k,S)}u.set(w,h,v,b,x)}return u.toTensor()},t.prototype.conv3dDerFilter=function(e,t,n){for(var r=n.strideDepth,i=n.strideHeight,a=n.strideWidth,o=n.filterDepth,s=n.filterHeight,u=n.filterWidth,c=ar(n.filterShape,"float32"),l=c.values,f=c.strides,d=f[0],h=f[1],p=f[2],m=f[3],v=this.readSync(t.dataId),g=t.strides,y=g[0],b=g[1],x=g[2],w=g[3],_=this.readSync(e.dataId),k=e.strides,E=k[0],S=k[1],C=k[2],A=k[3],O=n.padInfo.front,D=n.padInfo.left,T=n.padInfo.top,j=0;j<o;++j)for(var M=Math.max(0,Math.ceil((O-j)/r)),F=Math.min(n.outDepth,(n.inDepth+O-j)/r),I=j*d,N=0;N<s;++N)for(var R=Math.max(0,Math.ceil((T-N)/i)),P=Math.min(n.outHeight,(n.inHeight+T-N)/i),B=N*h+I,L=0;L<u;++L)for(var z=Math.max(0,Math.ceil((D-L)/a)),U=Math.min(n.outWidth,(n.inWidth+D-L)/a),W=L*p+B,V=0;V<n.inChannels;++V)for(var G=V*m+W,q=0;q<n.outChannels;++q){for(var H=0,X=0;X<n.batchSize;++X)for(var K=X*E,Y=X*y,$=M;$<F;++$)for(var J=(j+$*r-O)*S+K,Z=$*b+Y,Q=R;Q<P;++Q)for(var ee=(N+Q*i-T)*C+J,te=Q*x+Z,ne=z;ne<U;++ne){var re=ne*w+te;H+=_[(L+ne*a-D)*A+ee+V]*v[re+q]}l[G+q]=H}return c.toTensor()},t.prototype.fusedDepthwiseConv2D=function(e){var t=e.input,n=e.filter,r=e.convInfo,i=e.bias,a=e.activation,o=e.preluActivationWeights,s=this.depthwiseConv2D(t,n,r);return i&&(s=this.add(s,i)),a&&(s=tf(this,s,a,o)),s},t.prototype.depthwiseConv2D=function(e,t,n){Zl([e,t],"depthwiseConv2D");for(var r=n.filterHeight,i=n.filterWidth,a=n.dilationHeight,o=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,c=n.outChannels/n.inChannels,l=ar(n.outShape,e.dtype),f=this.readSync(e.dataId),d=this.readSync(t.dataId),h=l.values,p=0;p<n.batchSize;++p)for(var m=p*e.strides[0],v=p*l.strides[0],g=0;g<n.outHeight;++g)for(var y=v+g*l.strides[1],b=g*n.strideHeight-s,x=0;x<r;++x){var w=b+x*a;if(!(w<0||w>=n.inHeight))for(var _=x*t.strides[0],k=m+w*e.strides[1],E=0;E<n.outWidth;++E)for(var S=y+E*l.strides[2],C=E*n.strideWidth-u,A=0;A<i;++A){var O=C+A*o;if(!(O<0||O>=n.inWidth))for(var D=_+A*t.strides[1],T=k+O*n.inChannels,j=S,M=D,F=0;F<n.inChannels;++F){for(var I=f[T+F],N=0;N<c;++N)h[j+N]+=I*d[M+N];j+=c,M+=c}}}return l.toTensor()},t.prototype.depthwiseConv2DDerInput=function(e,t,n){Zl([e,t],"depthwiseConv2DDerInput");for(var r=ar(n.inShape,"float32"),i=r.values,a=r.strides,o=a[0],s=a[1],u=a[2],c=this.readSync(e.dataId),l=e.strides,f=l[0],d=l[1],h=l[2],p=this.readSync(t.dataId),m=t.strides,v=m[0],g=m[1],y=m[2],b=n.batchSize,x=n.filterHeight,w=n.filterWidth,_=n.inChannels,k=n.inHeight,E=n.inWidth,S=n.outChannels,C=n.outHeight,A=n.outWidth,O=n.strideHeight,D=n.strideWidth,T=x-1-n.padInfo.top,j=w-1-n.padInfo.left,M=S/_,F=0;F<b;++F)for(var I=0;I<_;++I)for(var N=0;N<k;++N)for(var R=N-T,P=Math.max(0,Math.ceil(R/O)),B=Math.min(C,(x+R)/O),L=0;L<E;++L){for(var z=L-j,U=Math.max(0,Math.ceil(z/D)),W=Math.min(A,(w+z)/D),V=0,G=P;G<B;++G)for(var q=G*O-R,H=U;H<W;++H)for(var X=f*F+d*G+h*H,K=v*(x-1-q)+g*(w-1-(H*D-z))+y*I,Y=0;Y<M;++Y)V+=c[X+(I*M+Y)]*p[K+Y];i[o*F+s*N+u*L+I]=V}return r.toTensor()},t.prototype.depthwiseConv2DDerFilter=function(e,t,n){Zl([e,t],"depthwiseConv2DDerFilter");for(var r=n.strideHeight,i=n.strideWidth,a=n.filterHeight,o=n.filterWidth,s=ar(n.filterShape,"float32"),u=n.padInfo.left,c=n.padInfo.top,l=n.outChannels/n.inChannels,f=this.bufferSync(e),d=this.bufferSync(t),h=0;h<a;++h)for(var p=Math.max(0,Math.ceil((c-h)/r)),m=Math.min(n.outHeight,(n.inHeight+c-h)/r),v=0;v<o;++v)for(var g=Math.max(0,Math.ceil((u-v)/i)),y=Math.min(n.outWidth,(n.inWidth+u-v)/i),b=0;b<n.outChannels;++b){for(var x=Math.trunc(b/l),w=b%l,_=0,k=0;k<n.batchSize;++k)for(var E=p;E<m;++E)for(var S=h+E*r-c,C=g;C<y;++C){var A=v+C*i-u;_+=f.get(k,S,A,x)*d.get(k,E,C,b)}s.set(_,h,v,x,w)}return s.toTensor()},t.prototype.tile=function(e,t){return Zl(e,"tile"),Ga(this.bufferSync(e),t)},t.prototype.pad=function(e,t,n){Zl(e,"pad");var r=t.map((function(t,n){return t[0]+e.shape[n]+t[1]})),i=t.map((function(e){return e[0]})),a=this.bufferSync(e),o=ar(r,e.dtype);0!==n&&o.values.fill(n);for(var s=0;s<e.size;s++){var u=a.indexToLoc(s),c=u.map((function(e,t){return e+i[t]}));o.set.apply(o,[a.get.apply(a,u)].concat(c))}return o.toTensor()},t.prototype.gather=function(e,t,n){Zl([e,t],"gather");var r=e.shape.slice(),i=this.readSync(t.dataId);r[n]=i.length;for(var a=ar(r,e.dtype),o=this.bufferSync(e),s=0;s<a.size;++s){var u=a.indexToLoc(s),c=u.slice();c[n]=i[u[n]];var l=o.locToIndex(c);a.values[s]=o.values[l]}return a.toTensor()},t.prototype.batchToSpaceND=function(e,t,n){Zl([e],"batchToSpaceND");var r=t.reduce((function(e,t){return e*t})),i=yr(e.shape,t,r),a=br(i.length,t.length),o=xr(e.shape,t,r),s=wr(n,t.length),u=_r(o,n,t.length);return fa(e.reshape(i),a).reshape(o).slice(s,u)},t.prototype.spaceToBatchND=function(e,t,n){Zl([e],"spaceToBatchND");var r=t.reduce((function(e,t){return e*t})),i=[[0,0]];i.push.apply(i,n);for(var a=1+t.length;a<e.shape.length;++a)i.push([0,0]);var o=e.pad(i),s=yr(o.shape,t,r,!1),u=br(s.length,t.length,!1),c=xr(o.shape,t,r,!1);return fa(o.reshape(s),u).reshape(c)},t.prototype.maxPool=function(e,t){return Zl(e,"maxPool"),Ql(this.readSync(e.dataId),e.shape,e.dtype,e.strides,t,"max").toTensor()},t.prototype.maxPoolBackprop=function(e,t,n,r){Zl([t,n],"maxPoolBackprop");for(var i=this.readSync(t.dataId),a=ar(r.outShape,t.dtype,ef(i,t.shape,t.dtype,r).values),o=r.strideHeight,s=r.strideWidth,u=r.dilationHeight,c=r.dilationWidth,l=r.effectiveFilterHeight,f=r.effectiveFilterWidth,d=f-1-r.padInfo.left,h=l-1-r.padInfo.top,p=ar(t.shape,"float32"),m=this.bufferSync(e),v=0;v<r.batchSize;++v)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.inHeight;++y)for(var b=0;b<r.inWidth;++b){for(var x=y-h,w=b-d,_=0,k=0;k<l;k+=u){var E=(x+k)/o;if(!(E<0||E>=r.outHeight||Math.floor(E)!==E))for(var S=0;S<f;S+=c){var C=(w+S)/s;if(!(C<0||C>=r.outWidth||Math.floor(C)!==C)){var A=l*f-1-a.get(v,E,C,g)===k*f+S?1:0;0!==A&&(_+=m.get(v,E,C,g)*A)}}}p.set(_,v,y,b,g)}return p.toTensor()},t.prototype.avgPoolBackprop=function(e,t,n){Zl([e,t],"avgPoolBackprop");for(var r=n.strideHeight,i=n.strideWidth,a=n.filterHeight,o=n.filterWidth,s=n.dilationHeight,u=n.dilationWidth,c=n.effectiveFilterHeight,l=n.effectiveFilterWidth,f=l-1-n.padInfo.left,d=c-1-n.padInfo.top,h=ar(t.shape,"float32"),p=1/(a*o),m=this.bufferSync(e),v=0;v<n.batchSize;++v)for(var g=0;g<n.inChannels;++g)for(var y=0;y<n.inHeight;++y)for(var b=0;b<n.inWidth;++b){for(var x=y-d,w=b-f,_=0,k=0;k<c;k+=s){var E=(x+k)/r;if(!(E<0||E>=n.outHeight||Math.floor(E)!==E))for(var S=0;S<l;S+=u){var C=(w+S)/i;C<0||C>=n.outWidth||Math.floor(C)!==C||(_+=m.get(v,E,C,g))}}h.set(_*p,v,y,b,g)}return h.toTensor()},t.prototype.pool3d=function(e,t,n){Zl(e,"pool3d");for(var r=t.strideDepth,i=t.strideHeight,a=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterDepth,l=t.effectiveFilterHeight,f=t.effectiveFilterWidth,d=t.padInfo.front,h=t.padInfo.top,p=t.padInfo.left,m="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=this.readSync(e.dataId),g=ar(t.outShape,e.dtype),y=g.values,b=t.outShape[1]*t.outShape[2]*t.outShape[3]*t.outShape[4],x=t.outShape[2]*t.outShape[3]*t.outShape[4],w=t.outShape[3]*t.outShape[4],_=t.outShape[4],k=0;k<t.batchSize;++k)for(var E=k*b,S=k*e.strides[0],C=0;C<t.inChannels;++C)for(var A=0;A<t.outDepth;++A){for(var O=A*r-d,D=O;D<0;)D+=o;for(var T=Math.min(t.inDepth,c+O),j=E+A*x,M=0;M<t.outHeight;++M){for(var F=M*i-h,I=F;I<0;)I+=s;for(var N=Math.min(t.inHeight,l+F),R=j+M*w,P=0;P<t.outWidth;++P){for(var B=P*a-p,L=B;L<0;)L+=u;for(var z=Math.min(t.inWidth,f+B),U=R+P*_,W=m,V=0,G=0,q=D;q<T;q+=o){for(var H=S+q*e.strides[1],X=I;X<N;X+=s){for(var K=H+X*e.strides[2],Y=L;Y<z;Y+=u){var $=v[K+Y*e.strides[3]+C];if("max"===n&&$>W?W=$:"avg"===n&&(V+=$,G++),isNaN(W))break}if(isNaN(W))break}if(isNaN(W))break}y[U+C]="avg"===n?V/G:W}}}return g.toTensor()},t.prototype.avgPool3d=function(e,t){return Zl(e,"avgPool3d"),this.pool3d(e,t,"avg").toFloat()},t.prototype.avgPool3dBackprop=function(e,t,n){Zl([e,t],"avgPool3dBackprop");for(var r=n.strideDepth,i=n.strideHeight,a=n.strideWidth,o=n.filterDepth,s=n.filterHeight,u=n.filterWidth,c=n.dilationDepth,l=n.dilationHeight,f=n.dilationWidth,d=n.effectiveFilterDepth,h=n.effectiveFilterHeight,p=n.effectiveFilterWidth,m=d-1-n.padInfo.front,v=p-1-n.padInfo.left,g=h-1-n.padInfo.top,y=ar(t.shape,"float32"),b=1/(o*s*u),x=this.bufferSync(e),w=0;w<n.batchSize;++w)for(var _=0;_<n.inChannels;++_)for(var k=0;k<n.inDepth;++k)for(var E=0;E<n.inHeight;++E)for(var S=0;S<n.inWidth;++S){for(var C=k-m,A=E-g,O=S-v,D=0,T=0;T<d;T+=c){var j=(C+T)/r;if(!(j<0||j>=n.outDepth||Math.floor(j)!==j))for(var M=0;M<h;M+=l){var F=(A+M)/i;if(!(F<0||F>=n.outHeight||Math.floor(F)!==F))for(var I=0;I<p;I+=f){var N=(O+I)/a;N<0||N>=n.outWidth||Math.floor(N)!==N||(D+=x.get(w,j,F,N,_))}}}y.set(D*b,w,k,E,S,_)}return y.toTensor()},t.prototype.maxPool3d=function(e,t){return Zl(e,"maxPool3d"),this.pool3d(e,t,"max").toFloat()},t.prototype.maxPool3dPositions=function(e,t){for(var n=ar(t.outShape,"int32"),r=t.strideDepth,i=t.strideHeight,a=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterDepth,l=t.effectiveFilterHeight,f=t.effectiveFilterWidth,d=t.padInfo.front,h=t.padInfo.top,p=t.padInfo.left,m=this.bufferSync(e),v=0;v<t.batchSize;++v)for(var g=0;g<t.inChannels;++g)for(var y=0;y<t.outDepth;++y){for(var b=y*r-d,x=b;x<0;)x+=o;for(var w=Math.min(t.inDepth,c+b),_=0;_<t.outHeight;++_){for(var k=_*i-h,E=k;E<0;)E+=s;for(var S=Math.min(t.inHeight,l+k),C=0;C<t.outWidth;++C){for(var A=C*a-p,O=A;O<0;)O+=u;for(var D=Math.min(t.inWidth,f+A),T=Number.NEGATIVE_INFINITY,j=-1,M=x;M<w;M+=o)for(var F=M-b,I=E;I<S;I+=s)for(var N=I-k,R=O;R<D;R+=u){var P=R-A,B=m.get(v,M,I,R,g);B>=T&&(T=B,j=F*l*f+N*l+P)}n.set(j,v,y,_,C,g)}}}return n.toTensor()},t.prototype.maxPool3dBackprop=function(e,t,n,r){Zl([t,n],"maxPool3dBackprop");for(var i=this.maxPool3dPositions(t,r),a=r.strideDepth,o=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,l=r.dilationWidth,f=r.effectiveFilterDepth,d=r.effectiveFilterHeight,h=r.effectiveFilterWidth,p=f-1-r.padInfo.front,m=h-1-r.padInfo.left,v=d-1-r.padInfo.top,g=ar(t.shape,"float32"),y=this.bufferSync(i),b=this.bufferSync(e),x=0;x<r.batchSize;++x)for(var w=0;w<r.inChannels;++w)for(var _=0;_<r.inDepth;++_)for(var k=0;k<r.inHeight;++k)for(var E=0;E<r.inWidth;++E){for(var S=_-p,C=k-v,A=E-m,O=0,D=0;D<f;D+=u){var T=(S+D)/a;if(!(T<0||T>=r.outDepth||Math.floor(T)!==T))for(var j=0;j<d;j+=c){var M=(C+j)/o;if(!(M<0||M>=r.outHeight||Math.floor(M)!==M))for(var F=0;F<h;F+=l){var I=(A+F)/s;if(!(I<0||I>=r.outWidth||Math.floor(I)!==I)){var N=f*d*h-1-y.get(x,T,M,I,w)===D*d*h+j*h+F?1:0;0!==N&&(O+=b.get(x,T,M,I,w)*N)}}}}g.set(O,x,_,k,E,w)}return g.toTensor()},t.prototype.cast=function(e,t){return Aa(e,t,this)},t.prototype.reshape=function(e,t){return Oa(e,t)},t.prototype.avgPool=function(e,t){return Zl(e,"avgPool"),Zl(e,"maxPool"),Ql(this.readSync(e.dataId),e.shape,e.dtype,e.strides,t,"avg").toTensor().toFloat()},t.prototype.resizeBilinear=function(e,t,n,r){Zl(e,"resizeBilinear");for(var i=e.shape,a=i[0],o=i[1],s=i[2],u=i[3],c=this.readSync(e.dataId),l=new Float32Array(j([a,t,n,u])),f=[r&&t>1?o-1:o,r&&n>1?s-1:s],d=[r&&t>1?t-1:t,r&&n>1?n-1:n],h=0,p=f[0]/d[0],m=f[1]/d[1],v=0;v<a;v++)for(var g=0;g<t;g++)for(var y=p*g,b=Math.floor(y),x=y-b,w=Math.min(o-1,Math.ceil(y)),_=v*e.strides[0]+b*e.strides[1],k=v*e.strides[0]+w*e.strides[1],E=0;E<n;E++)for(var S=m*E,C=Math.floor(S),A=S-C,O=Math.min(s-1,Math.ceil(S)),D=_+C*e.strides[2],T=k+C*e.strides[2],M=_+O*e.strides[2],F=k+O*e.strides[2],I=0;I<u;I++){var N=c[D+I],R=c[T+I],P=N+(c[M+I]-N)*A,B=P+(R+(c[F+I]-R)*A-P)*x;l[h++]=B}return Rn(l,[a,t,n,u])},t.prototype.resizeBilinearBackprop=function(e,t,n){Zl([e,t],"resizeBilinearBackprop");for(var r=t.shape,i=r[0],a=r[1],o=r[2],s=r[3],u=e.shape,c=u[1],l=u[2],f=new Float32Array(i*a*o*s),d=[n&&c>1?a-1:a,n&&l>1?o-1:o],h=[n&&c>1?c-1:c,n&&l>1?l-1:l],p=d[0]/h[0],m=d[1]/h[1],v=this.readSync(e.dataId),g=0,y=0;y<i;y++)for(var b=y*t.strides[0],x=0;x<c;x++)for(var w=x*p,_=Math.floor(w),k=Math.min(Math.ceil(w),a-1),E=b+_*t.strides[1],S=b+k*t.strides[1],C=w-_,A=1-C,O=0;O<l;O++)for(var D=O*m,T=Math.floor(D),j=Math.min(Math.ceil(D),o-1),M=D-T,F=1-M,I=E+T*t.strides[2],N=E+j*t.strides[2],R=S+T*t.strides[2],P=S+j*t.strides[2],B=A*F,L=A*M,z=C*F,U=C*M,W=0;W<s;W++){var V=v[g++];f[I+W]+=V*B,f[N+W]+=V*L,f[R+W]+=V*z,f[P+W]+=V*U}return Wn(f,[i,o,a,s],t.dtype)},t.prototype.resizeNearestNeighbor=function(e,t,n,r){Zl(e,"resizeNearestNeighbor");for(var i=e.shape,a=i[0],o=i[1],s=i[2],u=i[3],c=this.readSync(e.dataId),l=new Float32Array(a*t*n*u),f=[r&&t>1?o-1:o,r&&n>1?s-1:s],d=[r&&t>1?t-1:t,r&&n>1?n-1:n],h=f[0]/d[0],p=f[1]/d[1],m=0,v=0;v<a;v++)for(var g=v*e.strides[0],y=0;y<t;y++)for(var b=h*y,x=g+Math.min(o-1,r?Math.round(b):Math.floor(b))*e.strides[1],w=0;w<n;w++)for(var _=p*w,k=x+Math.min(s-1,r?Math.round(_):Math.floor(_))*e.strides[2],E=0;E<u;E++){var S=c[k+E];l[m++]=S}return Rn(l,[a,t,n,u],e.dtype)},t.prototype.resizeNearestNeighborBackprop=function(e,t,n){Zl([e,t],"resizeNearestNeighborBackprop");for(var r=t.shape,i=r[0],a=r[1],o=r[2],s=r[3],u=e.shape,c=u[1],l=u[2],f=new Float32Array(i*a*o*s),d=this.readSync(e.dataId),h=[n&&c>1?a-1:a,n&&l>1?o-1:o],p=[n&&c>1?c-1:c,n&&l>1?l-1:l],m=h[0]/p[0],v=h[1]/p[1],g=1/m,y=1/v,b=2*Math.ceil(g)+2,x=2*Math.ceil(y)+2,w=0;w<i;w++)for(var _=w*t.strides[0],k=0;k<a;k++)for(var E=_+k*t.strides[1],S=Math.floor(k*g),C=Math.floor(S-b/2),A=0;A<o;A++)for(var O=E+A*t.strides[2],D=Math.floor(A*y),T=Math.floor(D-x/2),j=0;j<s;j++){for(var M=0,F=0;F<b;F++){var I=F+C;if(!(I<0||I>=c)){var N=_+I*e.strides[1],R=I*m;if(k===Math.min(a-1,n?Math.round(R):Math.floor(R)))for(var P=0;P<x;P++){var B=P+T;if(!(B<0||B>=l)){var L=N+B*e.strides[2],z=B*v;A===Math.min(o-1,n?Math.round(z):Math.floor(z))&&(M+=d[L+j])}}}}f[O+j]=M}return Wn(f,t.shape,t.dtype)},t.prototype.batchNormalization=function(e,t,n,r,i,a){Zl([e,t,n,i,a],"batchNorm");for(var o=this.readSync(e.dataId),s=this.readSync(t.dataId),u=this.readSync(n.dataId),c=i?this.readSync(i.dataId):new Float32Array([1]),l=a?this.readSync(a.dataId):new Float32Array([0]),f=new Float32Array(o.length),d=l.length,h=c.length,p=u.length,m=s.length,v=0,g=0,y=0,b=0,x=0;x<o.length;++x)f[x]=l[v++]+(o[x]-s[g++])*c[y++]/Math.sqrt(u[b++]+r),v>=d&&(v=0),g>=m&&(g=0),y>=h&&(y=0),b>=p&&(b=0);return Wn(f,e.shape)},t.prototype.localResponseNormalization4D=function(e,t,n,r,i){Zl(e,"localResponseNormalization4D");var a=e.shape[3],o=a-1,s=this.readSync(e.dataId),u=e.size,c=new Float32Array(u);function l(e){for(var n=e%a,r=e-n+Math.max(0,n-t),i=e-n+Math.min(n+t,o),u=0;r<=i;r++){var c=s[r];u+=c*c}return u}for(var f=0;f<u;f++){var d=l(f),h=s[f]*Math.pow(n+r*d,-i);c[f]=h}return Wn(c,e.shape)},t.prototype.LRNGrad=function(e,t,n,r,i,a,o){Zl(e,"LRNGrad");for(var s=e.shape[3],u=this.readSync(e.dataId),c=this.readSync(t.dataId),l=this.readSync(n.dataId),f=new Float32Array(e.size),d=e.size,h=0;h<d;h++){for(var p=h%s,m=h-p+Math.max(0,p-r),v=h-p+Math.min(s,p+r+1),g=0,y=m;y<v;y++)g+=Math.pow(c[y],2);for(g=a*g+i,y=m;y<v;y++){var b=-2*a*o*c[y]*l[h]/g;h===y&&(b+=Math.pow(g,-o)),b*=u[h],f[y]+=b}}return Wn(f,e.shape)},t.prototype.multinomial=function(e,t,n,r){Zl(e,"multinomial");for(var i=t?e:ca(e),a=i.shape[0],o=i.shape[1],s=Xn([a,n],"int32"),u=this.readSync(s.dataId),c=this.readSync(i.dataId),l=0;l<a;++l){var f=l*o,d=new Float32Array(o-1);d[0]=c[f];for(var h=1;h<d.length;++h)d[h]=d[h-1]+c[f+h];for(var p=Ps(r.toString()),m=l*n,v=0;v<n;++v){var g=p();u[m+v]=d.length;for(var y=0;y<d.length;y++)if(g<d[y]){u[m+v]=y;break}}}return s},t.prototype.oneHot=function(e,t,n,r){Zl(e,"oneHot");var i=new Float32Array(e.size*t);i.fill(r);for(var a=this.readSync(e.dataId),o=0;o<e.size;++o)a[o]>=0&&a[o]<t&&(i[o*t+a[o]]=n);return zn(i,[e.size,t],"int32")},t.prototype.nonMaxSuppression=function(e,t,n,r,i){return Zl(e,"nonMaxSuppression"),Pa(this.readSync(e.dataId),this.readSync(t.dataId),n,r,i)},t.prototype.fft=function(e){return this.fftBatch(e,!1)},t.prototype.ifft=function(e){return this.fftBatch(e,!0)},t.prototype.fftBatch=function(e,t){for(var n=e.shape[0],r=e.shape[1],i=ar(e.shape,"float32"),a=ar(e.shape,"float32"),o=In(e).as2D(n,r),s=Nn(e).as2D(n,r),u=0;u<n;u++)for(var c=o.slice([u,0],[1,r]),l=s.slice([u,0],[1,r]),f=Fn(c,l),d=this.readSync(this.fftImpl(f,t).dataId),h=0;h<r;h++){var p=Ma(d,h);i.values[u*r+h]=p.real,a.values[u*r+h]=p.imag}return Fn(i.toTensor(),a.toTensor()).as2D(n,r)},t.prototype.fftImpl=function(e,t){var n=e.as1D(),r=n.size;if(this.isExponentOf2(r)){var i=this.fftRadix2(n,r,t).as2D(e.shape[0],e.shape[1]);return t&&(i=Fn(In(i).div(Bn(r)),Nn(i).div(Bn(r)))),i}var a=this.readSync(e.dataId),o=function(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}(this.fourierTransformByMatmul(a,r,t));return Fn(o.real,o.imag).as2D(e.shape[0],e.shape[1])},t.prototype.isExponentOf2=function(e){return 0==(e&e-1)},t.prototype.fftRadix2=function(e,t,n){if(1===t)return e;var r=this.readSync(e.dataId),i=t/2,a=function(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),i=0;i<e.length;i+=4)n[Math.floor(i/4)]=e[i],r[Math.floor(i/4)]=e[i+1];return{real:n,imag:r}}(r),o=Fn(a.real,a.imag).as1D(),s=function(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),i=2;i<e.length;i+=4)n[Math.floor(i/4)]=e[i],r[Math.floor(i/4)]=e[i+1];return{real:n,imag:r}}(r),u=Fn(s.real,s.imag).as1D();o=this.fftRadix2(o,i,n),u=this.fftRadix2(u,i,n);var c=function(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),i=0;i<Math.ceil(e/2);i++){var a=(t?2:-2)*Math.PI*(i/e);n[i]=Math.cos(a),r[i]=Math.sin(a)}return{real:n,imag:r}}(t,n),l=Fn(c.real,c.imag).mul(u),f=o.add(l),d=o.sub(l),h=In(f).concat(In(d)),p=Nn(f).concat(Nn(d));return Fn(h,p).as1D()},t.prototype.fourierTransformByMatmul=function(e,t,n){for(var r=new Float32Array(2*t),i=0;i<t;i++){for(var a=0,o=0,s=0;s<t;s++){var u=Ia(i*s,t,n),c=Ma(e,s);a+=c.real*u.real-c.imag*u.imag,o+=c.real*u.imag+c.imag*u.real}n&&(a/=t,o/=t),Fa(r,a,o,i)}return r},t.prototype.depthToSpace=function(e,t,n){A("NHWC"===n,(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+n})),A(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+t}));for(var r=e.shape[0],i=e.shape[1],a=e.shape[2],o=e.shape[3],s=i*t,u=a*t,c=o/(t*t),l=this.readSync(e.dataId),f=new Float32Array(r*s*u*c),d=0,h=0;h<r;++h)for(var p=0;p<s;++p)for(var m=Math.floor(p/t),v=p%t,g=0;g<u;++g)for(var y=Math.floor(g/t),b=(v*t+g%t)*c,x=0;x<c;++x){var w=x+b+o*(y+a*(m+i*h));f[d++]=l[w]}return Wn(f,[r,s,u,c])},t.prototype.broadcastedBinaryOp=function(e,t,n,r){var i=Ur(e.shape,t.shape),a=ar(i,n),o=this.readSync(e.dataId),s=this.readSync(t.dataId),u=Lr(e.shape,i),c=Lr(t.shape,i),l=a.values;if(u.length+c.length===0)for(var f=0;f<l.length;++f)l[f]=r(o[f%o.length],s[f%s.length]);else{var d=this.bufferSync(e),h=this.bufferSync(t),p=function(n){var i=a.indexToLoc(n),f=i.slice(-e.rank);u.forEach((function(e){return f[e]=0}));var p=d.locToIndex(f),m=i.slice(-t.rank);c.forEach((function(e){return m[e]=0}));var v=h.locToIndex(m);l[n]=r(o[p],s[v])};for(f=0;f<l.length;++f)p(f)}return a.toTensor()},t.prototype.broadcastedBinaryComplexOp=function(e,t,n){var r=Ur(e.shape,t.shape),i=ar(r,"float32"),a=ar(r,"float32"),o=this.readSync(e.dataId),s=this.readSync(t.dataId),u=Lr(e.shape,r),c=Lr(t.shape,r),l=i.values,f=a.values;if(u.length+c.length===0)for(var d=0;d<l.length;d++){var h=d%o.length,p=d%s.length,m=n(o[2*h],o[2*h+1],s[2*p],s[2*p+1]);l[d]=m.real,f[d]=m.imag}else{var v=this.bufferSync(this.data.get(e.dataId).complexTensors.real),g=this.bufferSync(this.data.get(t.dataId).complexTensors.real),y=function(r){var a=i.indexToLoc(r),d=a.slice(-e.rank);u.forEach((function(e){return d[e]=0}));var h=v.locToIndex(d),p=a.slice(-t.rank);c.forEach((function(e){return p[e]=0}));var m=g.locToIndex(p),y=n(o[2*h],o[2*h+1],s[2*m],s[2*m+1]);l[r]=y.real,f[r]=y.imag};for(d=0;d<l.length;d++)y(d)}return this.complex(i.toTensor(),a.toTensor())},t.prototype.split=function(e,t,n){return Va(e,t,n)},t.prototype.dispose=function(){},t.prototype.floatPrecision=function(){return 32},t.prototype.epsilon=function(){return 1e-7},t.prototype.cropAndResize=function(e,t,n,r,i,a){for(var o=e.shape,s=o[0],u=o[1],c=o[2],l=o[3],f=t.shape[0],d=r[0],h=r[1],p=ar([f,d,h,l],"float32"),m=this.readSync(t.dataId),v=this.readSync(n.dataId),g=this.readSync(e.dataId),y=e.strides,b=p.strides,x=0;x<f;x++){var w=4*x,_=m[w],k=m[w+1],E=m[w+2],S=m[w+3],C=v[x];if(!(C>=s))for(var A=d>1?(E-_)*(u-1)/(d-1):0,O=h>1?(S-k)*(c-1)/(h-1):0,D=0;D<d;D++){var T=d>1?_*(u-1)+D*A:.5*(_+E)*(u-1);if(T<0||T>u-1)for(var j=0;j<h;j++)for(var M=0;M<l;M++){var F=M+j*b[2]+D*b[1]+x*b[0];p.values[F]=a}else if("bilinear"===i){var I=Math.floor(T),N=Math.ceil(T),R=T-I;for(j=0;j<h;j++)if((q=h>1?k*(c-1)+j*O:.5*(k+S)*(c-1))<0||q>c-1)for(M=0;M<l;M++)F=M+j*b[2]+D*b[1]+x*b[0],p.values[F]=a;else{var P=Math.floor(q),B=Math.ceil(q),L=q-P;for(M=0;M<l;M++){var z=g[F=M+P*y[2]+I*y[1]+C*y[0]],U=g[F=M+B*y[2]+I*y[1]+C*y[0]],W=g[F=M+P*y[2]+N*y[1]+C*y[0]],V=z+(U-z)*L,G=W+(g[F=M+B*y[2]+N*y[1]+C*y[0]]-W)*L;F=M+j*b[2]+D*b[1]+x*b[0],p.values[F]=V+(G-V)*R}}}else for(j=0;j<h;++j){var q;if((q=h>1?k*(c-1)+j*O:.5*(k+S)*(c-1))<0||q>c-1)for(M=0;M<l;M++)F=M+j*b[2]+D*b[1]+x*b[0],p.values[F]=a;else{var H=Math.round(q),X=Math.round(T);for(M=0;M<l;M++){var K=M+H*y[2]+X*y[1]+C*y[0],Y=M+j*b[2]+D*b[1]+x*b[0];p.values[Y]=g[K]}}}}}return p.toTensor()},t.prototype.sparseToDense=function(e,t,n,r){var i=Hi(0,e,n),a=i.sliceRank,o=i.numUpdates,s=i.sliceSize,u=i.strides,c=i.outputSize;return this.scatter(e,t,n,c,s,o,a,u,r,!1)},t.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],i=zi(e,t),a=i[0],o=i[1],s=i[2],u=i[3];if(0===o)return Rn([],a,e.dtype);for(var c=new we([o,s],e.dtype),l=this.readSync(t.dataId),f=this.readSync(e.dataId),d=0;d<o;d++){for(var h=[],p=0,m=0;m<r;m++){var v=l[d*r+m];p+=v*u[m],h.push(v)}if(p<0||p>=e.size/s)throw new Error("Invalid indices: "+h+" does not index into "+e.shape);for(var g=0;g<s;g++)c.values[d*s+g]=f[p*s+g]}return c.toTensor().reshape(a)},t.prototype.scatterND=function(e,t,n){var r=Hi(0,e,n),i=r.sliceRank,a=r.numUpdates,o=r.sliceSize,s=r.strides,u=r.outputSize,c=Bn(0);return this.scatter(e,t,n,u,o,a,i,s,c,!0)},t.prototype.fill=function(e,t,n){var r=W(n=n||Z(t),j(e));return r.fill(t),We.makeTensor(r,e,n,this)},t.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){var t=W(e.dtype,j(e.shape));return this.makeOutput(t,e.shape,e.dtype)},t.prototype.linspace=function(e,t,n){return Da(e,t,n)},t.prototype.scatter=function(e,t,n,r,i,a,o,s,u,c){var l=[r/i,i],f=this.readSync(e.dataId),d=this.readSync(t.dataId);if(0===r)return Rn([],n,t.dtype);var h=new we(l,t.dtype);h.values.fill(this.readSync(u.dataId)[0]);for(var p=0;p<a;p++){for(var m=[],v=0,g=0;g<o;g++){var y=f[p*o+g];m.push(y),v+=y*s[g]}if(v<0||v>=r/i)throw new Error("Invalid indices: "+m+" does not index into "+n);for(var b=0;b<i;b++)c?h.values[v*i+b]+=d[p*i+b]:h.values[v*i+b]=0===t.rank?d[0]:d[p*i+b]}return h.toTensor().reshape(n)},t}(ha);function rf(e,t){return{kernelName:e,backendName:"cpu",kernelFunc:function(n){var r=n.inputs,i=n.backend,a=r,o=a.a,s=a.b,u=i;Zl([o,s],e);var c=u.data.get(o.dataId).values,l=u.data.get(s.dataId).values,f=t(o.shape,s.shape,c,l,o.dtype),d=f[0],h=f[1];return{dataId:u.write(d,h,o.dtype),shape:h,dtype:o.dtype}}}}function af(e){return function(t,n,r,i,a){var o=Ur(t,n),s=o.length,u=te(o),c=U(a,j(o)),l=t.length,f=n.length,d=te(t),h=te(n),p=Lr(t,o),m=Lr(n,o);if(p.length+m.length===0)for(var v=0;v<c.length;++v)c[v]=e(r[v%r.length],i[v%i.length]);else{var g=function(t){var n=fe(t,s,u),a=n.slice(-l);p.forEach((function(e){return a[e]=0}));var o=le(a,l,d),v=n.slice(-f);m.forEach((function(e){return v[e]=0}));var g=le(v,f,h);c[t]=e(r[o],i[g])};for(v=0;v<c.length;++v)g(v)}return[c,o]}}We.registerBackend("cpu",(function(){return new nf}),1);var of=af((function(e,t){return e/t})),sf=rf(Sr,of),uf={kernelName:"MaxPoolWithArgmax",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,i=t.x,a=n,o=a.filterSize,s=a.strides,u=a.pad,c=a.includeBatchInIndex,l=r;Zl(i,"MaxPoolWithArgmax");var f=l.data.get(i.dataId).values,d=ma(i.shape,o,s,[1,1],u),h=function(e,t,n,r,i){var a=Ql(e,0,n,te(t),i,"max"),o=ef(e,t,n,i,!0,r);return[a.values,o.values]}(f,i.shape,i.dtype,c,d),p=h[0],m=h[1],v=l.write(p,d.outShape,i.dtype),g=l.write(m,d.outShape,i.dtype);return[{dataId:v,shape:d.outShape,dtype:i.dtype},{dataId:g,shape:d.outShape,dtype:"int32"}]}},cf={kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t,a=i.boxes,o=i.scores,s=r,u=s.maxOutputSize,c=s.iouThreshold,l=s.scoreThreshold,f=s.softNmsSigma,d=n;Zl(a,"NonMaxSuppressionWithScore");var h=Ba(d.data.get(a.dataId).values,d.data.get(o.dataId).values,u,c,l,f);return[h.selectedIndices,h.selectedScores]}},lf={kernelName:"Square",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,i=n;Zl(r,"square");for(var a=i.data.get(r.dataId).values,o=new Float32Array(a.length),s=0;s<a.length;++s){var u=a[s];o[s]=u*u}return{dataId:i.write(o,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},ff=af((function(e,t){var n=e-t;return n*n}));function df(e,t,n,r,i){for(var a=j(t),o=t.length,s=te(t),u=te(i),c=U(n,j(i)),l=0;l<a;++l){for(var f=fe(l,o,s),d=new Array(f.length),h=0;h<d.length;h++)d[h]=f[r[h]];c[le(d,o,u)]=e[l]}return c}for(var hf=0,pf=[cf,lf,rf(Ar,ff),sf,{kernelName:"Transpose",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,i=t.x,a=n.perm,o=r;Zl(i,"transpose");for(var s=i.shape.length,u=new Array(s),c=0;c<u.length;c++)u[c]=i.shape[a[c]];var l=df(o.data.get(i.dataId).values,i.shape,i.dtype,a,u);return{dataId:o.write(l,u,i.dtype),shape:u,dtype:i.dtype}}},uf];hf<pf.length;hf++)y(pf[hf]);for(var mf,vf=0,gf=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.pixels,a=r.numChannels,o="undefined"!=typeof HTMLVideoElement&&i instanceof HTMLVideoElement,s="undefined"!=typeof HTMLImageElement&&i instanceof HTMLImageElement,u=o?[i.videoWidth,i.videoHeight]:[i.width,i.height],c=u[0],l=u[1],d=[l,c],h=[l,c,a];(s||o)&&(null==mf&&(mf=document.createElement("canvas").getContext("2d")),mf.canvas.width=c,mf.canvas.height=l,mf.drawImage(i,0,0,c,l),i=mf.canvas);var p=n.makeTensorInfo(d,"int32");n.texData.get(p.dataId).usage=He.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(p.dataId),i);var m=f().getBool("WEBGL_PACK")?new function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=Ya(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2("+r+".0, "+n+".0);\n            vec4 values = "+t.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+t.output+" = result;\n      }\n    "}(h):new function(e){this.variableNames=["A"];var t=Ya(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+n+".0);\n\n        vec4 values = "+t.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "}(h),v=n.runWebGLProgram(m,[p],"int32");return n.disposeData(p.dataId),v}},{kernelName:Sr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t;return function(e,t,n){var r=new mo("\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",e.shape,t.shape);return f().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&(r=new go("\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",e.shape,t.shape,!0)),n.runWebGLProgram(r,[e,t],"float32")}(r.a,r.b,n)}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;gn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var i=t,a=i.boxes,o=i.scores,s=r,u=s.maxOutputSize,c=s.iouThreshold,l=s.scoreThreshold,f=s.softNmsSigma,d=n,h=Ba(d.readSync(a.dataId),d.readSync(o.dataId),u,c,l,f);return[h.selectedIndices,h.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,i=n,a=new ss(r.shape,"return x * x;");return i.runWebGLProgram(a,[r],r.dtype)}},{kernelName:Ar,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,i=r.a,a=r.b,o=n,s=f().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new go("return (a - b) * (a - b);",i.shape,a.shape):new mo("return (a - b) * (a - b);",i.shape,a.shape);return o.compileAndRun(s,[i,a])}},{kernelName:"Transpose",backendName:"webgl",kernelFunc:function(e){for(var t,n=e.inputs,r=e.attrs,i=e.backend,a=n.x,o=r.perm,s=i,u=a.shape.length,c=new Array(u),l=0;l<c.length;l++)c[l]=a.shape[o[l]];if(s.shouldExecuteOnCPU([a])){var d=df(s.texData.get(a.dataId).values,a.shape,a.dtype,o,c);t=s.makeTensorInfo(c,a.dtype),s.texData.get(t.dataId).values=d}else t=function(e,t,n){var r=f().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var i=oo(this.rank),a=Xa("rc",this.rank),o=new Array(this.rank);for(r=0;r<t.length;r++)o[t[r]]=a[r];var s="vec2("+o.slice(-2).join()+")",u="++"+a[this.rank-1]+" < "+n[this.rank-1],c="getChannel(getA("+o.join()+"), "+s+")";this.userCode="\n    void main() {\n      "+i+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+c+";\n      if("+u+") {\n        result[1] = "+c+";\n      }\n      --"+a[this.rank-1]+";\n      if(++"+a[this.rank-2]+" < "+n[this.rank-2]+") {\n        result[2] = "+c+";\n        if("+u+") {\n          result[3] = "+c+";\n        }\n      }\n      setOutput(result);\n    }\n    "}(e.shape,t):new function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];this.outputShape=n,this.rank=n.length;var i=oo(this.rank),a=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank "+t+" is not yet supported");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),i=0;i<e.length;i++)r[e[i]]=n[i];return r.join()}(t);this.userCode="\n    void main() {\n      "+i+" resRC = getOutputCoords();\n      setOutput(getA("+a+"));\n    }\n    "}(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}(a,o,s);return t}},{kernelName:"MaxPoolWithArgmax",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,i=t.x,a=n,o=a.filterSize,s=a.strides,u=a.pad,c=a.includeBatchInIndex,l=r;A(4===i.shape.length,(function(){return"Error in maxPool: input must be rank 4 but got rank "+i.shape.length+"."}));var f=[1,1];A(Sa(s,f),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+s+" and dilations '"+f+"'"}));var d=ma(i.shape,o,s,f,u),h=function(e,t,n,r){var i=new $o(n,"max",!1),a=r.runWebGLProgram(i,[e],"float32");return i=new $o(n,"max",!0,!0,t),[a,r.runWebGLProgram(i,[e],"float32")]}(i,c,d,l);return[h[0],h[1]]}}];vf<gf.length;vf++)y(gf[vf]);for(var yf=0,bf=[{kernelName:kr,inputsToSave:["a","b"],gradFunc:function(e,t){var n=t[0],r=t[1],i=Ur(n.shape,r.shape);return{a:function(){var t=e,r=zr(n.shape,i);return r.length>0&&(t=t.sum(r)),t.reshape(n.shape)},b:function(){var t=e,n=zr(r.shape,i);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)}}}},{kernelName:"AddN",saveAllInputs:!0,gradFunc:function(e,t){var n={};return t.forEach((function(t,r){n[r]=function(){return e.clone()}})),n}},{kernelName:jr,gradFunc:function(e,t,n){for(var r=n,i=r.inputShape,a=r.shape,o=Array.from(a),s=i.length-1;s>=0;s--)if(i[s]===a[s])o[s]=1;else if(1!==i[s])throw new Error("broadcastTo(): ["+i+"] cannot be broadcast to ["+a+"].");var u=[];for(s=0;s<o.length;s++)o[s]>1&&u.push(s);return{x:function(){return e.sum(u,!0)}}}},{kernelName:Sr,inputsToSave:["a","b"],gradFunc:function(e,t){var n=t[0],r=t[1],i=Ur(n.shape,r.shape);return{a:function(){var t=Li(e,r.toFloat()),a=zr(n.shape,i);return a.length>0?Wc(t,a).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),a=zr(r.shape,i);a.length>0&&(t=Wc(t,a).reshape(r.shape));var o=ju(r);return oi(Li(t,o.toFloat()))}}}},{kernelName:"FusedBatchNorm",inputsToSave:["x","mean","variance","scale"],gradFunc:function(e,t,n){var r=n.varianceEpsilon,i=t[0],a=t[1],o=t[2],s=t[3],u=zs(i),c=null==s?Bn(1):s,l=zr(a.shape,u.shape),f=[];if(1===a.rank){for(var d=0;d<u.shape.length-1;++d)f.push(u.shape[d]);f.push(1)}var h=Pi(i,a),p=Mi(e,c),m=ci(Br(o,Bn(r))),v=Mi(Mi(Mi(m,m),m),Bn(-.5));return{x:function(){return 1===a.rank?dr(Mi(Mi(e,cu(m.as4D(1,1,1,a.shape[0]),f)),c),i.shape):dr(Mi(Mi(e,m),c),i.shape)},mean:function(){var e=Mi(Mi(m,Bn(-1)),p);return 1===a.rank&&(e=Wc(e,l)),dr(e,a.shape)},variance:function(){var e=Mi(Mi(v,h),p);return 1===a.rank&&(e=Wc(e,l)),dr(e,a.shape)},scale:function(){var t=Mi(h,m),n=Mi(e,t);return 1===a.rank&&(n=Wc(n,l)),dr(n,a.shape)},offset:function(){var t=e;return 1===a.rank&&(t=Wc(t,l)),dr(t,a.shape)}}}},{kernelName:Fr,gradFunc:function(e){return{x:function(){return e.toFloat()}}}},{kernelName:Mr,inputsToSave:["indices"],gradFunc:function(e,t){var n=t[0];return{indices:function(){return Xn(n.shape,"float32")}}}},{kernelName:Nr,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],i=n.paddings.map((function(e){return e[0]}));return{x:function(){return e.slice(i,r.shape)}}}},{kernelName:"Square",inputsToSave:["x"],gradFunc:function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().mul(2))}}}},{kernelName:Ar,inputsToSave:["a","b"],gradFunc:function(e,t){var n=t[0],r=t[1],i=Bn(2);return{a:function(){return Mi(e,Mi(i,Pi(n,r)))},b:function(){return Mi(e,Mi(i,Pi(r,n)))}}}},{kernelName:Ir,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],i=n.reps;return{x:function(){var t=Zn(r);if(1===r.rank)for(var n=0;n<i[0];++n)t=t.add(e.slice([n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(n=0;n<i[0];++n)for(var a=0;a<i[1];++a)t=t.add(e.slice([n*r.shape[0],a*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(n=0;n<i[0];++n)for(a=0;a<i[1];++a)for(var o=0;o<i[2];++o)t=t.add(e.slice([n*r.shape[0],a*r.shape[1],o*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+r.rank+" tensors yet.");for(n=0;n<i[0];++n)for(a=0;a<i[1];++a)for(o=0;o<i[2];++o)for(var s=0;s<i[3];++s)t=t.add(e.slice([n*r.shape[0],a*r.shape[1],o*r.shape[2],s*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return t}}}},{kernelName:"Transpose",gradFunc:function(e,t,n){var r=On(n.perm);return{x:function(){return fa(e,r)}}}}];yf<bf.length;yf++)b(bf[yf]);var xf=function(){function e(){}return e.prototype.fetch=function(e,t){return fetch(e,t)},e.prototype.now=function(){return performance.now()},e.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got "+t);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},e.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},e}();f().get("IS_BROWSER")&&f().setPlatform("browser",new xf);var wf,_f=function(){function e(){this.util=n(388),this.textEncoder=new this.util.TextEncoder}return e.prototype.fetch=function(e,t){return null!=f().global.fetch?f().global.fetch(e,t):(null==wf&&(wf=n(389)),wf(e,t))},e.prototype.now=function(){var e=r.hrtime();return 1e3*e[0]+e[1]/1e6},e.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},e.prototype.decode=function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)},e}();f().get("IS_NODE")&&f().setPlatform("node",new _f);var kf={float32:4,int32:4,uint16:2,uint8:1,bool:1},Ef=4;function Sf(e,t){for(var n={},r=0,i=function(t){var i=t.name,a=t.dtype,o=t.shape,s=j(o),u=void 0;if("quantization"in t){var c=t.quantization;if("uint8"!==c.dtype&&"uint16"!==c.dtype)throw new Error("Weight "+t.name+" has unknown quantization dtype "+c.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var l=kf[c.dtype],f=e.slice(r,r+s*l),d="uint8"===c.dtype?new Uint8Array(f):new Uint16Array(f);if("float32"===a)u=Float32Array.from(d,(function(e){return e*c.scale+c.min}));else{if("int32"!==a)throw new Error("Unsupported dtype in weight '"+i+"': "+a);u=Int32Array.from(d,(function(e){return Math.round(e*c.scale+c.min)}))}r+=s*l}else if("string"===a){var h=j(t.shape);u=[];for(var p=0;p<h;p++){var m=new Uint32Array(e.slice(r,r+Ef))[0];r+=Ef;var v=new Uint8Array(e.slice(r,r+m));u.push(v),r+=m}}else{var g=kf[a];if(f=e.slice(r,r+s*g),"float32"===a)u=new Float32Array(f);else if("int32"===a)u=new Int32Array(f);else{if("bool"!==a)throw new Error("Unsupported dtype in weight '"+i+"': "+a);u=new Uint8Array(f)}r+=s*g}n[i]=Rn(u,o,a)},a=0,o=t;a<o.length;a++)i(o[a]);return n}var Cf=void 0!==i&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function Af(e){return Cf?i.byteLength(e):new Blob([e]).size}function Of(e){var t=0;e.forEach((function(e){t+=e.byteLength}));var n=new Uint8Array(t),r=0;return e.forEach((function(e){n.set(new Uint8Array(e),r),r+=e.byteLength})),n.buffer}function Df(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function Tf(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:Af(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:Af(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}var jf=function(){function e(){this.saveRouters=[],this.loadRouters=[]}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerSaveRouter=function(t){e.getInstance().saveRouters.push(t)},e.registerLoadRouter=function(t){e.getInstance().loadRouters.push(t)},e.getSaveHandlers=function(t){return e.getHandlers(t,"save")},e.getLoadHandlers=function(t,n){return e.getHandlers(t,"load",n)},e.getHandlers=function(t,n,r){var i=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach((function(e){var n=e(t,r);null!==n&&i.push(n)})),i},e}(),Mf="://",Ff=function(){function e(){this.managers={}}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerManager=function(t,n){A(null!=t,(function(){return"scheme must not be undefined or null."})),t.endsWith(Mf)&&(t=t.slice(0,t.indexOf(Mf))),A(t.length>0,(function(){return"scheme must not be an empty string."}));var r=e.getInstance();A(null==r.managers[t],(function(){return"A model store manager is already registered for scheme '"+t+"'."})),r.managers[t]=n},e.getManager=function(e){var t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},e.getSchemes=function(){return Object.keys(this.getInstance().managers)},e}();function If(e){if(-1===e.indexOf(Mf))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Ff.getSchemes().join(","));return{scheme:e.split(Mf)[0],path:e.split(Mf)[1]}}function Nf(e,t,n){return void 0===n&&(n=!1),u(this,void 0,void 0,(function(){var r,i,a,o,s,u,l,f,d;return c(this,(function(c){switch(c.label){case 0:return A(e!==t,(function(){return"Old path and new path are the same: '"+e+"'"})),A((r=jf.getLoadHandlers(e)).length>0,(function(){return"Copying failed because no load handler is found for source URL "+e+"."})),A(r.length<2,(function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+e+"."})),i=r[0],A((a=jf.getSaveHandlers(t)).length>0,(function(){return"Copying failed because no save handler is found for destination URL "+t+"."})),A(a.length<2,(function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+t+"."})),o=a[0],s=If(e).scheme,u=If(e).path,l=s===If(e).scheme,[4,i.load()];case 1:return f=c.sent(),n&&l?[4,Ff.getManager(s).removeModel(u)]:[3,3];case 2:c.sent(),c.label=3;case 3:return[4,o.save(f)];case 4:return d=c.sent(),!n||l?[3,6]:[4,Ff.getManager(s).removeModel(u)];case 5:c.sent(),c.label=6;case 6:return[2,d.modelArtifactsInfo]}}))}))}var Rf="models_store",Pf="model_info_store";function Bf(){if(!f().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e=window||self,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function Lf(e){var t=e.result;t.createObjectStore(Rf,{keyPath:"modelPath"}),t.createObjectStore(Pf,{keyPath:"modelPath"})}var zf=function(){function e(e){if(this.indexedDB=Bf(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return e.prototype.save=function(e){return u(this,void 0,void 0,(function(){return c(this,(function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]}))}))},e.prototype.load=function(){return u(this,void 0,void 0,(function(){return c(this,(function(e){return[2,this.databaseAction(this.modelPath)]}))}))},e.prototype.databaseAction=function(e,t){var n=this;return new Promise((function(e,r){var i=n.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return Lf(i)},i.onsuccess=function(){var a=i.result;if(null==t){var o=a.transaction(Rf,"readonly"),s=o.objectStore(Rf).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return a.close(),r(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));e(s.result.modelArtifacts)},s.onerror=function(e){return a.close(),r(s.error)},o.oncomplete=function(){return a.close()}}else{var u,c=Tf(t),l=a.transaction(Pf,"readwrite"),f=l.objectStore(Pf),d=f.put({modelPath:n.modelPath,modelArtifactsInfo:c});d.onsuccess=function(){var i=(u=a.transaction(Rf,"readwrite")).objectStore(Rf).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:c});i.onsuccess=function(){return e({modelArtifactsInfo:c})},i.onerror=function(e){var t=(f=l.objectStore(Pf)).delete(n.modelPath);t.onsuccess=function(){return a.close(),r(i.error)},t.onerror=function(e){return a.close(),r(i.error)}}},d.onerror=function(e){return a.close(),r(d.error)},l.oncomplete=function(){null==u?a.close():u.oncomplete=function(){return a.close()}}}},i.onerror=function(e){return r(i.error)}}))},e.URL_SCHEME="indexeddb://",e}(),Uf=function(e){return f().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(zf.URL_SCHEME)?(t=e.slice(zf.URL_SCHEME.length),new zf(t)):null;var t};jf.registerSaveRouter(Uf),jf.registerLoadRouter(Uf);var Wf=function(){function e(){this.indexedDB=Bf()}return e.prototype.listModels=function(){return u(this,void 0,void 0,(function(){var e=this;return c(this,(function(t){return[2,new Promise((function(t,n){var r=e.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=function(){return Lf(r)},r.onsuccess=function(){var e=r.result,i=e.transaction(Pf,"readonly"),a=i.objectStore(Pf).getAll();a.onsuccess=function(){for(var e={},n=0,r=a.result;n<r.length;n++){var i=r[n];e[i.modelPath]=i.modelArtifactsInfo}t(e)},a.onerror=function(t){return e.close(),n(a.error)},i.oncomplete=function(){return e.close()}},r.onerror=function(e){return n(r.error)}}))]}))}))},e.prototype.removeModel=function(e){return u(this,void 0,void 0,(function(){var t=this;return c(this,(function(n){var r;return e=(r=e).startsWith(zf.URL_SCHEME)?r.slice(zf.URL_SCHEME.length):r,[2,new Promise((function(n,r){var i=t.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return Lf(i)},i.onsuccess=function(){var t,a=i.result,o=a.transaction(Pf,"readwrite"),s=o.objectStore(Pf),u=s.get(e);u.onsuccess=function(){if(null==u.result)return a.close(),r(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var i=s.delete(e),o=function(){var i=(t=a.transaction(Rf,"readwrite")).objectStore(Rf).delete(e);i.onsuccess=function(){return n(u.result.modelArtifactsInfo)},i.onerror=function(e){return r(u.error)}};i.onsuccess=o,i.onerror=function(e){return o(),a.close(),r(u.error)}},u.onerror=function(e){return a.close(),r(u.error)},o.oncomplete=function(){null==t?a.close():t.oncomplete=function(){return a.close()}}},i.onerror=function(e){return r(i.error)}}))]}))}))},e}();if(f().getBool("IS_BROWSER"))try{Ff.registerManager(zf.URL_SCHEME,new Wf)}catch(zd){}var Vf="/",Gf="tensorflowjs_models",qf="info",Hf="model_topology",Xf="weight_specs",Kf="weight_data",Yf="model_metadata";function $f(e){return{info:[Gf,e,qf].join(Vf),topology:[Gf,e,Hf].join(Vf),weightSpecs:[Gf,e,Xf].join(Vf),weightData:[Gf,e,Kf].join(Vf),modelMetadata:[Gf,e,Yf].join(Vf)}}function Jf(e){var t=e.split(Vf);if(t.length<3)throw new Error("Invalid key format: "+e);return t.slice(1,t.length-1).join(Vf)}var Zf=function(){function e(e){if(!f().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=$f(this.modelPath)}return e.prototype.save=function(e){return u(this,void 0,void 0,(function(){var t,n,r;return c(this,(function(a){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),r=Tf(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(e){if(Cf)return i.from(e).toString("base64");for(var t=new Uint8Array(e),n="",r=0,a=t.length;r<a;r++)n+=String.fromCharCode(t[r]);return btoa(n)}(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:r}]}catch(e){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+r.modelTopologyBytes+", weightSpecsBytes="+r.weightSpecsBytes+", weightDataBytes="+r.weightDataBytes+".")}return[2]}))}))},e.prototype.load=function(){return u(this,void 0,void 0,(function(){var e,t,n,r,a,o,s;return c(this,(function(u){if(null==(e=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},null==(n=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=n,null==(r=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=r,null!=(a=this.LS.getItem(this.keys.modelMetadata))&&(o=JSON.parse(a),t.format=o.format,t.generatedBy=o.generatedBy,t.convertedBy=o.convertedBy,t.userDefinedMetadata=o.userDefinedMetadata),null==(s=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=function(e){if(Cf){var t=i.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),a=0;a<n.length;++a)r.set([n.charCodeAt(a)],a);return r.buffer}(s),[2,t]}))}))},e.URL_SCHEME="localstorage://",e}(),Qf=function(e){return f().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Zf.URL_SCHEME)?(t=e.slice(Zf.URL_SCHEME.length),new Zf(t)):null;var t};jf.registerSaveRouter(Qf),jf.registerLoadRouter(Qf);var ed=function(){function e(){A(f().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),A("undefined"==typeof window||void 0!==window.localStorage,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return e.prototype.listModels=function(){return u(this,void 0,void 0,(function(){var e,t,n,r,i,a;return c(this,(function(o){for(e={},t=Gf+Vf,n=Vf+qf,r=0;r<this.LS.length;++r)(i=this.LS.key(r)).startsWith(t)&&i.endsWith(n)&&(a=Jf(i),e[a]=JSON.parse(this.LS.getItem(i)));return[2,e]}))}))},e.prototype.removeModel=function(e){return u(this,void 0,void 0,(function(){var t,n;return c(this,(function(r){var i;if(e=(i=e).startsWith(Zf.URL_SCHEME)?i.slice(Zf.URL_SCHEME.length):i,t=$f(e),null==this.LS.getItem(t.info))throw new Error("Cannot find model at path '"+e+"'");return n=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,n]}))}))},e}();if(f().getBool("IS_BROWSER"))try{Ff.registerManager(Zf.URL_SCHEME,new ed)}catch(zd){}var td="model",nd=".json",rd=".weights.bin";function id(e){return new Promise((function(e){return setTimeout(e)})).then(e)}var ad=function(){function e(t){if(!f().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),null!=t&&0!==t.length||(t=td),this.modelTopologyFileName=t+nd,this.weightDataFileName=t+rd}return e.prototype.save=function(e){return u(this,void 0,void 0,(function(){var t,n,r,i,a,o;return c(this,(function(s){switch(s.label){case 0:if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:n},i=window.URL.createObjectURL(new Blob([JSON.stringify(r)],{type:"application/json"})),(a=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=i,[4,id((function(){return a.dispatchEvent(new MouseEvent("click"))}))];case 2:return s.sent(),null==e.weightData?[3,4]:((o=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,o.href=t,[4,id((function(){return o.dispatchEvent(new MouseEvent("click"))}))]);case 3:s.sent(),s.label=4;case 4:return[2,{modelArtifactsInfo:Tf(e)}]}}))}))},e.URL_SCHEME="downloads://",e}(),od=function(){function e(e){if(null==e||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return e.prototype.load=function(){return u(this,void 0,void 0,(function(){var e,t,n=this;return c(this,(function(r){return e=this.files[0],t=this.files.slice(1),[2,new Promise((function(r,i){var a=new FileReader;a.onload=function(a){var o=JSON.parse(a.target.result),s=o.modelTopology;if(null!=s){0===t.length&&r({modelTopology:s});var u=o.weightsManifest;if(null!=u){var c;try{c=n.checkManifestAndWeightFiles(u,t)}catch(e){return void i(e)}var l=[],f=[],d=[];u.forEach((function(e){e.paths.forEach((function(e){f.push(e),d.push(null)})),l.push.apply(l,e.weights)})),u.forEach((function(e){e.paths.forEach((function(e){var t=new FileReader;t.onload=function(t){var n=t.target.result,i=f.indexOf(e);d[i]=n,-1===d.indexOf(null)&&r({modelTopology:s,weightSpecs:l,weightData:Of(d),format:o.format,generatedBy:o.generatedBy,convertedBy:o.convertedBy,userDefinedMetadata:o.userDefinedMetadata})},t.onerror=function(t){return i("Failed to weights data from file of path '"+e+"'.")},t.readAsArrayBuffer(c[e])}))}))}else i(new Error("weightManifest field is missing from file "+e.name))}else i(new Error("modelTopology field is missing from file "+e.name))},a.onerror=function(t){return i("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},a.readAsText(e)}))]}))}))},e.prototype.checkManifestAndWeightFiles=function(e,t){for(var n=[],r=t.map((function(e){return Df(e.name)})),i={},a=0,o=e;a<o.length;a++)o[a].paths.forEach((function(e){var a=Df(e);if(-1!==n.indexOf(a))throw new Error("Duplicate file basename found in weights manifest: '"+a+"'");if(n.push(a),-1===r.indexOf(a))throw new Error("Weight file with basename '"+a+"' is not provided.");i[e]=t[r.indexOf(a)]}));if(n.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+t.length+").");return i},e}();function sd(e,t,n,r){!function(e){A(null!=e&&Array.isArray(e)&&e.length>0,(function(){return"promises must be a none empty array"}))}(e),function(e,t){A(e>=0&&e<=1,(function(){return"Progress fraction must be in range [0, 1], but got startFraction "+e})),A(t>=0&&t<=1,(function(){return"Progress fraction must be in range [0, 1], but got endFraction "+t})),A(t>=e,(function(){return"startFraction must be no more than endFraction, but got startFraction "+e+" and endFraction "+t}))}(n=null==n?0:n,r=null==r?1:r);var i=0;return Promise.all(e.map((function(a){return a.then((function(a){var o=n+ ++i/e.length*(r-n);return t(o),a})),a})))}function ud(e,t){return u(this,void 0,void 0,(function(){var n,r,i,a,o,s,u,l,d;return c(this,(function(c){switch(c.label){case 0:return null==t&&(t={}),n=null==t.fetchFunc?f().platform.fetch:t.fetchFunc,r=e.map((function(e){return n(e,t.requestInit,{isBinary:!0})})),i=0,a=.5,null!=t.onProgress?[3,2]:[4,Promise.all(r)];case 1:return o=c.sent(),[3,4];case 2:return[4,sd(r,t.onProgress,i,a)];case 3:o=c.sent(),c.label=4;case 4:return s=o.map((function(e){return e.arrayBuffer()})),u=.5,l=1,null!=t.onProgress?[3,6]:[4,Promise.all(s)];case 5:return d=c.sent(),[3,8];case 6:return[4,sd(s,t.onProgress,u,l)];case 7:d=c.sent(),c.label=8;case 8:return[2,d]}}))}))}function cd(e){var t=this;return function(n,r,i){return void 0===r&&(r=""),u(t,void 0,void 0,(function(){var t,a,o,s,u,l,f,d,h,p;return c(this,(function(c){switch(c.label){case 0:if(t=n.map((function(){return!1})),a={},o=null!=i?i.map((function(){return!1})):[],s=[],n.forEach((function(e,n){var r=0;e.weights.forEach((function(e){var u="quantization"in e?e.quantization.dtype:e.dtype,c=kf[u]*j(e.shape),l=function(){t[n]=!0,null==a[n]&&(a[n]=[]),a[n].push({manifestEntry:e,groupOffset:r,sizeBytes:c})};null!=i?i.forEach((function(t,n){t===e.name&&(l(),o[n]=!0)})):l(),s.push(e.name),r+=c}))})),!o.every((function(e){return e})))throw u=i.filter((function(e,t){return!o[t]})),new Error("Could not find weights in manifest with names: "+u.join(", ")+". \nManifest JSON has weights with names: "+s.join(", ")+".");return l=t.reduce((function(e,t,n){return t&&e.push(n),e}),[]),f=[],l.forEach((function(e){n[e].paths.forEach((function(e){var t=r+(r.endsWith("/")?"":"/")+e;f.push(t)}))})),[4,e(f)];case 1:return d=c.sent(),h={},p=0,l.forEach((function(e){for(var t=n[e].paths.length,r=0,i=0;i<t;i++)r+=d[p+i].byteLength;for(var o=new ArrayBuffer(r),s=new Uint8Array(o),u=0,c=0;c<t;c++){var l=new Uint8Array(d[p+c]);s.set(l,u),u+=l.byteLength}a[e].forEach((function(e){var t=Sf(o.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(var n in t)h[n]=t[n]})),p+=t})),[2,h]}}))}))}}jf.registerSaveRouter((function(e){return f().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(ad.URL_SCHEME)?function(e){return void 0===e&&(e="model"),new ad(e)}(e.slice(ad.URL_SCHEME.length)):null}));var ld=function(){function e(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,null!=t.fetchFunc?(A("function"==typeof t.fetchFunc,(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=t.fetchFunc):this.fetch=f().platform.fetch,A(null!=e&&e.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(e)&&A(2===e.length,(function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."})),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return e.prototype.save=function(e){return u(this,void 0,void 0,(function(){var t,n,r,i;return c(this,(function(a){switch(a.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:n},t.body.append("model.json",new Blob([JSON.stringify(r)],{type:"application/json"}),"model.json"),null!=e.weightData&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((i=a.sent()).ok)return[2,{modelArtifactsInfo:Tf(e),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+i.status+".")}}))}))},e.prototype.load=function(){return u(this,void 0,void 0,(function(){var e,t,n,r,i,a,o,s,u,l,f,d;return c(this,(function(c){switch(c.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=c.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");c.label=2;case 2:return c.trys.push([2,4,,5]),[4,e.json()];case 3:return t=c.sent(),[3,5];case 4:throw c.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(r=t.modelTopology,i=t.weightsManifest,a=t.generatedBy,o=t.convertedBy,s=t.format,u=t.userDefinedMetadata,null==r&&null==i)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==i?[3,7]:[4,this.loadWeights(i)];case 6:d=c.sent(),l=d[0],f=d[1],c.label=7;case 7:return[2,{modelTopology:r,weightSpecs:l,weightData:f,userDefinedMetadata:u,generatedBy:a,convertedBy:o,format:s}]}}))}))},e.prototype.loadWeights=function(e){return u(this,void 0,void 0,(function(){var t,n,r,i,a,o,s,u,l,f,d;return c(this,(function(c){switch(c.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,n=function(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}(t),r=n[0],i=n[1],a=this.weightPathPrefix||r,o=[],s=0,u=e;s<u.length;s++)l=u[s],o.push.apply(o,l.weights);return f=[],e.forEach((function(e){e.paths.forEach((function(e){f.push(a+e+i)}))})),[4,ud(f,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return d=c.sent(),[2,[o,Of(d)]]}}))}))},e.URL_SCHEME_REGEX=/^https?:\/\//,e}();function fd(e){return null!=e.match(ld.URL_SCHEME_REGEX)}var dd=function(e,t){return"undefined"==typeof fetch?null:(Array.isArray(e)?e.every((function(e){return fd(e)})):fd(e))?hd(e,{onProgress:t}):null};function hd(e,t){return new ld(e,t)}jf.registerSaveRouter(dd),jf.registerLoadRouter(dd);var pd,md=function(){function e(e){this.modelArtifacts=e}return e.prototype.load=function(){return u(this,void 0,void 0,(function(){return c(this,(function(e){return[2,this.modelArtifacts]}))}))},e}(),vd=function(){function e(e){this.saveHandler=e}return e.prototype.save=function(e){return u(this,void 0,void 0,(function(){return c(this,(function(t){return[2,this.saveHandler(e)]}))}))},e}(),gd=Object.freeze({browserFiles:function(e){return new od(e)},browserHTTPRequest:function(e,t){return hd(e,t)},concatenateArrayBuffers:Of,decodeWeights:Sf,encodeWeights:function(e,t){return u(this,void 0,void 0,(function(){var n,r,i,a,o,s=this;return c(this,(function(l){switch(l.label){case 0:for(n=[],r=[],i=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e),a=function(a){var o=i[a],l=Array.isArray(e)?e[a].tensor:e[o];if("float32"!==l.dtype&&"int32"!==l.dtype&&"bool"!==l.dtype&&"string"!==l.dtype)throw new Error("Unsupported dtype in weight '"+o+"': "+l.dtype);var f={name:o,shape:l.shape,dtype:l.dtype};if("string"===l.dtype){var d=new Promise((function(e){return u(s,void 0,void 0,(function(){var t,n,r,i,a,o,s;return c(this,(function(u){switch(u.label){case 0:return[4,l.bytes()];case 1:for(t=u.sent(),n=t.reduce((function(e,t){return e+t.length}),0)+Ef*t.length,r=new Uint8Array(n),i=0,a=0;a<t.length;a++)o=t[a],s=new Uint8Array(new Uint32Array([o.length]).buffer),r.set(s,i),i+=Ef,r.set(o,i),i+=o.length;return e(r),[2]}}))}))}));r.push(d)}else r.push(l.data());null!=t&&(f.group=t),n.push(f)},o=0;o<i.length;++o)a(o);return[4,Promise.all(r)];case 1:return[2,{data:function(e){if(null===e)throw new Error("Invalid input value: "+JSON.stringify(e));var t=0,n=[];e.forEach((function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+e.constructor.name)}));var r=new Uint8Array(t),i=0;return n.forEach((function(e){r.set(new Uint8Array(e.buffer),i),i+=e.byteLength})),r.buffer}(l.sent()),specs:n}]}}))}))},fromMemory:function(e,t,n,r){return 1===arguments.length?null!=e.modelTopology||null!=e.weightSpecs?new md(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new md({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new md({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))},getLoadHandlers:function(e,t){return jf.getLoadHandlers(e,t)},getModelArtifactsInfoForJSON:Tf,getSaveHandlers:function(e){return jf.getSaveHandlers(e)},http:hd,isHTTPScheme:fd,loadWeights:function(e,t,n,r){return void 0===t&&(t=""),u(this,void 0,void 0,(function(){return c(this,(function(i){return[2,cd((function(e){return ud(e,{requestInit:r})}))(e,t,n)]}))}))},registerLoadRouter:function(e){return jf.registerLoadRouter(e)},registerSaveRouter:function(e){return jf.registerSaveRouter(e)},weightsLoaderFactory:cd,withSaveHandler:function(e){return new vd(e)},copyModel:function(e,t){return u(this,void 0,void 0,(function(){return c(this,(function(n){return[2,Nf(e,t,!1)]}))}))},listModels:function(){return u(this,void 0,void 0,(function(){var e,t,n,r,i,a,o;return c(this,(function(s){switch(s.label){case 0:e=Ff.getSchemes(),t={},n=0,r=e,s.label=1;case 1:return n<r.length?(i=r[n],[4,Ff.getManager(i).listModels()]):[3,4];case 2:for(o in a=s.sent())t[i+Mf+o]=a[o];s.label=3;case 3:return n++,[3,1];case 4:return[2,t]}}))}))},moveModel:function(e,t){return u(this,void 0,void 0,(function(){return c(this,(function(n){return[2,Nf(e,t,!0)]}))}))},removeModel:function(e){return u(this,void 0,void 0,(function(){var t;return c(this,(function(n){return t=If(e),[2,Ff.getManager(t.scheme).removeModel(t.path)]}))}))}}),yd=Mn({confusionMatrix_:function(e,t,n){var r=xn(e,"labels","confusionMatrix"),i=xn(t,"predictions","confusionMatrix");A(null==n||n>0&&Number.isInteger(n),(function(){return"If provided, numClasses must be a positive integer, but got "+n})),A(1===r.rank,(function(){return"Expected the rank of labels to be 1, but got "+r.rank})),A(1===i.rank,(function(){return"Expected the rank of predictions to be 1, but got "+i.rank})),A(r.shape[0]===i.shape[0],(function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+i.shape[0]+". Labels and predictions should have the same number of elements."})),A(n>0&&Number.isInteger(n),(function(){return"numClasses is required to be a positive integer, but got "+n}));var a=du(r.asType("int32"),n),o=du(i.asType("int32"),n);return a.transpose().matMul(o).asType("int32")}}),bd=Object.freeze({confusionMatrix:yd}),xd=Mn({fromPixels_:function(e,t){if(void 0===t&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,i=!1,a=!1,o=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)i=!0;else if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)a=!0;else{if(null==e.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);o=!0}if(i&&i&&e.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(null!=m("FromPixels",We.backendName))return We.runKernel("FromPixels",{pixels:e},{numChannels:t});var s,u,c=i?[e.videoWidth,e.videoHeight]:[e.width,e.height],l=c[0],f=c[1];if(o?s=e.getContext("2d").getImageData(0,0,l,f).data:r||n?s=e.data:(a||i)&&(null==pd&&(pd=document.createElement("canvas").getContext("2d")),pd.canvas.width=l,pd.canvas.height=f,pd.drawImage(e,0,0,l,f),s=pd.getImageData(0,0,l,f).data),4===t)u=new Int32Array(s);else{var d=l*f;u=new Int32Array(d*t);for(var h=0;h<d;h++)for(var p=0;p<t;++p)u[h*t+p]=s[4*h+p]}return Un(u,[f,l,t],"int32")}}),wd=Object.freeze({toPixels:function(e,t){return u(this,void 0,void 0,(function(){var n,r,i,a,o,s,u,l,f,d,h,p,m,v,g,y,b,x,w,_,k,E,S;return c(this,(function(c){switch(c.label){case 0:if(n=xn(e,"img","toPixels"),e instanceof Se||(n=n.toInt()),2!==n.rank&&3!==n.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),i=r[0],a=r[1],(o=2===n.rank?1:n.shape[2])>4||2===o)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+o);return[4,n.data()];case 1:return s=c.sent(),u=n.min(),l=n.max(),[4,Promise.all([u.data(),l.data()])];case 2:if(f=c.sent(),d=f[0],h=f[1],p=d[0],m=h[0],u.dispose(),l.dispose(),"float32"===n.dtype){if(p<0||m>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+p+" - "+m+"].")}else{if("int32"!==n.dtype)throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(p<0||m>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+p+" - "+m+"].")}for(v="float32"===n.dtype?255:1,g=new Uint8ClampedArray(a*i*4),y=0;y<i*a;++y)b=void 0,x=void 0,w=void 0,_=void 0,1===o?(b=s[y]*v,x=s[y]*v,w=s[y]*v,_=255):3===o?(b=s[3*y]*v,x=s[3*y+1]*v,w=s[3*y+2]*v,_=255):4===o&&(b=s[4*y]*v,x=s[4*y+1]*v,w=s[4*y+2]*v,_=s[4*y+3]*v),g[0+(k=4*y)]=Math.round(b),g[k+1]=Math.round(x),g[k+2]=Math.round(w),g[k+3]=Math.round(_);return null!=t&&(t.width=a,t.height=i,E=t.getContext("2d"),S=new ImageData(g,a,i),E.putImageData(S,0,0)),n!==e&&n.dispose(),[2,g]}}))}))},fromPixels:xd}),_d=function(){function e(){}return e.prototype.getClassName=function(){return this.constructor.className},e.fromConfig=function(e,t){return new e(t)},e}(),kd=function(){function e(){this.classNameMap={}}return e.getMap=function(){return null==e.instance&&(e.instance=new e),e.instance},e.register=function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]},e}();function Ed(e){A(null!=e.className,(function(){return"Class being registered does not have the static className property defined."})),A("string"==typeof e.className,(function(){return"className is required to be a string, but got type "+typeof e.className})),A(e.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),kd.register(e)}var Sd=Object.freeze({Serializable:_d,SerializationMap:kd,registerClass:Ed}),Cd="1.7.4",Ad=Object.freeze({gpgpu_util:qo,webgl_util:Xt,forceHalfFloat:function(){f().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:Os,setWebGLContext:$e,GPGPUContext:Ho}),Od=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.minimize=function(e,t,n){void 0===t&&(t=!1);var r=this.computeGradients(e,n),i=r.value,a=r.grads;if(null!=n){var o=n.map((function(e){return{name:e.name,tensor:a[e.name]}}));this.applyGradients(o)}else this.applyGradients(a);return an(a),t?i:(i.dispose(),null)},Object.defineProperty(t.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),t.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},t.prototype.computeGradients=function(e,t){return oa(e,t)},t.prototype.dispose=function(){null!=this.iterations_&&an(this.iterations_)},t.prototype.saveIterations=function(){return u(this,void 0,void 0,(function(){return c(this,(function(e){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:Bn(this.iterations_,"int32")}]}))}))},t.prototype.getWeights=function(){return u(this,void 0,void 0,(function(){return c(this,(function(e){throw new Error("getWeights() is not implemented for this optimizer yet.")}))}))},t.prototype.setWeights=function(e){return u(this,void 0,void 0,(function(){return c(this,(function(e){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())}))}))},t.prototype.extractIterations=function(e){return u(this,void 0,void 0,(function(){var t;return c(this,(function(n){switch(n.label){case 0:return t=this,[4,e[0].tensor.data()];case 1:return t.iterations_=n.sent()[0],[2,e.slice(1)]}}))}))},t}(_d);Object.defineProperty(Od,Symbol.hasInstance,{value:function(e){return null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients}});var Dd=function(e){function t(t,n,r){void 0===r&&(r=null);var i=e.call(this)||this;return i.learningRate=t,i.rho=n,i.epsilon=r,i.accumulatedGrads=[],i.accumulatedUpdates=[],null==r&&(i.epsilon=We.backend.epsilon()),i}return s(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var i=We.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:n+"/accum_grad",variable:rn((function(){return Zn(i).variable(!1)}))}),null==t.accumulatedUpdates[r]&&(t.accumulatedUpdates[r]={originalName:n+"/accum_var",variable:rn((function(){return Zn(i).variable(!1)}))});var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var o=t.accumulatedGrads[r].variable,s=t.accumulatedUpdates[r].variable;rn((function(){var e=o.mul(t.rho).add(a.square().mul(1-t.rho)),n=s.add(t.epsilon).sqrt().div(o.add(t.epsilon).sqrt()).mul(a),r=s.mul(t.rho).add(n.square().mul(1-t.rho));o.assign(e),s.assign(r);var u=n.mul(-t.learningRate).add(i);i.assign(u)}))}})),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedUpdates&&(an(this.accumulatedGrads.map((function(e){return e.variable}))),an(this.accumulatedUpdates.map((function(e){return e.variable}))))},t.prototype.getWeights=function(){return u(this,void 0,void 0,(function(){var e;return c(this,(function(t){switch(t.label){case 0:return e=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return u(this,void 0,void 0,(function(){var t;return c(this,(function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),t=e.length/2,this.accumulatedGrads=e.slice(0,t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedUpdates=e.slice(t,2*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.rho,t.epsilon)},t.className="Adadelta",t}(Od);Ed(Dd);var Td=function(e){function t(t,n){void 0===n&&(n=.1);var r=e.call(this)||this;return r.learningRate=t,r.initialAccumulatorValue=n,r.accumulatedGrads=[],r}return s(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var i=We.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:n+"/accumulator",variable:rn((function(){return Kn(i.shape,t.initialAccumulatorValue).variable(!1)}))});var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var o=t.accumulatedGrads[r].variable;rn((function(){var e=o.add(a.square());o.assign(e);var n=a.div(e.add(We.backend.epsilon()).sqrt()).mul(-t.learningRate).add(i);i.assign(n)}))}})),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedGrads&&an(this.accumulatedGrads.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return u(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulatedGrads.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return u(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulatedGrads=e.map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},t.fromConfig=function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)},t.className="Adagrad",t}(Od);Ed(Td);var jd=function(e){function t(t,n,r,i){void 0===i&&(i=null);var a=e.call(this)||this;return a.learningRate=t,a.beta1=n,a.beta2=r,a.epsilon=i,a.accumulatedFirstMoment=[],a.accumulatedSecondMoment=[],rn((function(){a.accBeta1=Bn(n).variable(),a.accBeta2=Bn(r).variable()})),null==i&&(a.epsilon=We.backend.epsilon()),a}return s(t,e),t.prototype.applyGradients=function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);rn((function(){var r=Pi(1,t.accBeta1),i=Pi(1,t.accBeta2);n.forEach((function(n,a){var o=We.registeredVariables[n];null==t.accumulatedFirstMoment[a]&&(t.accumulatedFirstMoment[a]={originalName:n+"/m",variable:rn((function(){return Zn(o).variable(!1)}))}),null==t.accumulatedSecondMoment[a]&&(t.accumulatedSecondMoment[a]={originalName:n+"/v",variable:rn((function(){return Zn(o).variable(!1)}))});var s=Array.isArray(e)?e[a].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[a].variable,c=t.accumulatedSecondMoment[a].variable,l=u.mul(t.beta1).add(s.mul(1-t.beta1)),f=c.mul(t.beta2).add(s.square().mul(1-t.beta2)),d=l.div(r),h=f.div(i);u.assign(l),c.assign(f);var p=d.div(h.sqrt().add(t.epsilon)).mul(-t.learningRate).add(o);o.assign(p)}})),t.accBeta1.assign(t.accBeta1.mul(t.beta1)),t.accBeta2.assign(t.accBeta2.mul(t.beta2))})),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&an(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedSecondMoment&&an(this.accumulatedSecondMoment.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return u(this,void 0,void 0,(function(){var e;return c(this,(function(t){switch(t.label){case 0:return e=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return u(this,void 0,void 0,(function(){var t,n=this;return c(this,(function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:return e=r.sent(),rn((function(){n.accBeta1.assign(Ii(n.beta1,n.iterations_+1)),n.accBeta2.assign(Ii(n.beta2,n.iterations_+1))})),t=e.length/2,this.accumulatedFirstMoment=e.slice(0,t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedSecondMoment=e.slice(t,2*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)},t.className="Adam",t}(Od);Ed(jd);var Md=function(e){function t(t,n,r,i,a){void 0===i&&(i=null),void 0===a&&(a=0);var o=e.call(this)||this;return o.learningRate=t,o.beta1=n,o.beta2=r,o.epsilon=i,o.decay=a,o.accumulatedFirstMoment=[],o.accumulatedWeightedInfNorm=[],rn((function(){o.iteration=Bn(0).variable(),o.accBeta1=Bn(n).variable()})),null==i&&(o.epsilon=We.backend.epsilon()),o}return s(t,e),t.prototype.applyGradients=function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);rn((function(){var r=Pi(1,t.accBeta1),i=Li(-t.learningRate,t.iteration.mul(t.decay).add(1));n.forEach((function(n,a){var o=We.registeredVariables[n];null==t.accumulatedFirstMoment[a]&&(t.accumulatedFirstMoment[a]={originalName:n+"/m",variable:Zn(o).variable(!1)}),null==t.accumulatedWeightedInfNorm[a]&&(t.accumulatedWeightedInfNorm[a]={originalName:n+"/v",variable:Zn(o).variable(!1)});var s=Array.isArray(e)?e[a].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[a].variable,c=t.accumulatedWeightedInfNorm[a].variable,l=u.mul(t.beta1).add(s.mul(1-t.beta1)),f=c.mul(t.beta2),d=s.abs(),h=f.maximum(d);u.assign(l),c.assign(h);var p=i.div(r).mul(l.div(h.add(t.epsilon))).add(o);o.assign(p)}})),t.iteration.assign(t.iteration.add(1)),t.accBeta1.assign(t.accBeta1.mul(t.beta1))})),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&an(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedWeightedInfNorm&&an(this.accumulatedWeightedInfNorm.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return u(this,void 0,void 0,(function(){return c(this,(function(e){throw new Error("getWeights() is not implemented for Adamax yet.")}))}))},t.prototype.setWeights=function(e){return u(this,void 0,void 0,(function(){return c(this,(function(e){throw new Error("setWeights() is not implemented for Adamax yet.")}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)},t.className="Adamax",t}(Od);Ed(Md);var Fd=function(e){function t(t){var n=e.call(this)||this;return n.learningRate=t,n.setLearningRate(t),n}return s(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var a=We.registeredVariables[n];rn((function(){var e=t.c.mul(i).add(a);a.assign(e)}))}})),this.incrementIterations()},t.prototype.setLearningRate=function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=on(Bn(-e))},t.prototype.dispose=function(){this.c.dispose()},t.prototype.getWeights=function(){return u(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()]]}}))}))},t.prototype.setWeights=function(e){return u(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:if(0!==(e=t.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate}},t.fromConfig=function(e,t){return new e(t.learningRate)},t.className="SGD",t}(Od);Ed(Fd);var Id=function(e){function t(t,n,r){void 0===r&&(r=!1);var i=e.call(this,t)||this;return i.learningRate=t,i.momentum=n,i.useNesterov=r,i.accumulations=[],i.m=Bn(i.momentum),i}return s(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var i=We.registeredVariables[n];null==t.accumulations[r]&&(t.accumulations[r]={originalName:n+"/momentum",variable:rn((function(){return Zn(i).variable(!1)}))});var a=t.accumulations[r].variable,o=Array.isArray(e)?e[r].tensor:e[n];null!=o&&rn((function(){var e,n=t.m.mul(a).add(o);e=t.useNesterov?t.c.mul(o.add(n.mul(t.m))).add(i):t.c.mul(n).add(i),a.assign(n),i.assign(e)}))})),this.incrementIterations()},t.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&an(this.accumulations.map((function(e){return e.variable})))},t.prototype.setMomentum=function(e){this.momentum=e},t.prototype.getWeights=function(){return u(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulations.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return u(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulations=e.map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},t.fromConfig=function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)},t.className="Momentum",t}(Fd);Ed(Id);var Nd=function(e){function t(t,n,r,i,a){void 0===n&&(n=.9),void 0===r&&(r=0),void 0===i&&(i=null),void 0===a&&(a=!1);var o=e.call(this)||this;if(o.learningRate=t,o.decay=n,o.momentum=r,o.epsilon=i,o.accumulatedMeanSquares=[],o.accumulatedMoments=[],o.accumulatedMeanGrads=[],o.centered=a,null==i&&(o.epsilon=We.backend.epsilon()),null==t)throw new Error("learningRate for RMSPropOptimizer must be defined.");return o}return s(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var i=We.registeredVariables[n];null==t.accumulatedMeanSquares[r]&&(t.accumulatedMeanSquares[r]={originalName:n+"/rms",variable:rn((function(){return Zn(i).variable(!1)}))}),null==t.accumulatedMoments[r]&&(t.accumulatedMoments[r]={originalName:n+"/momentum",variable:rn((function(){return Zn(i).variable(!1)}))}),null==t.accumulatedMeanGrads[r]&&t.centered&&(t.accumulatedMeanGrads[r]={originalName:n+"/mg",variable:rn((function(){return Zn(i).variable(!1)}))});var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var o=t.accumulatedMeanSquares[r].variable,s=t.accumulatedMoments[r].variable;rn((function(){var e=o.mul(t.decay).add(a.square().mul(1-t.decay));if(t.centered){var n=t.accumulatedMeanGrads[r].variable,u=n.mul(t.decay).add(a.mul(1-t.decay)),c=s.mul(t.momentum).add(a.mul(t.learningRate).div(e.sub(u.square().add(t.epsilon)).sqrt()));o.assign(e),n.assign(u),s.assign(c);var l=i.sub(c);i.assign(l)}else{var f=o.mul(t.decay).add(a.square().mul(1-t.decay));c=s.mul(t.momentum).add(a.mul(t.learningRate).div(f.add(t.epsilon).sqrt())),o.assign(f),s.assign(c),l=i.sub(c),i.assign(l)}}))}})),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&an(this.accumulatedMeanSquares.map((function(e){return e.variable}))),null!=this.accumulatedMeanGrads&&this.centered&&an(this.accumulatedMeanGrads.map((function(e){return e.variable}))),null!=this.accumulatedMoments&&an(this.accumulatedMoments.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return u(this,void 0,void 0,(function(){var e;return c(this,(function(t){switch(t.label){case 0:return e=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&e.push.apply(e,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return u(this,void 0,void 0,(function(){var t;return c(this,(function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),t=this.centered?e.length/3:e.length/2,this.accumulatedMeanSquares=e.slice(0,t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedMoments=e.slice(t,2*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.centered&&(this.accumulatedMeanGrads=e.slice(2*t,3*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}))),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)},t.className="RMSProp",t}(Od);Ed(Nd);var Rd=function(){function e(){}return e.sgd=function(e){return new Fd(e)},e.momentum=function(e,t,n){return void 0===n&&(n=!1),new Id(e,t,n)},e.rmsprop=function(e,t,n,r,i){return void 0===t&&(t=.9),void 0===n&&(n=0),void 0===r&&(r=null),void 0===i&&(i=!1),new Nd(e,t,n,r,i)},e.adam=function(e,t,n,r){return void 0===e&&(e=.001),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),new jd(e,t,n,r)},e.adadelta=function(e,t,n){return void 0===e&&(e=.001),void 0===t&&(t=.95),void 0===n&&(n=null),new Dd(e,t,n)},e.adamax=function(e,t,n,r,i){return void 0===e&&(e=.002),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),void 0===i&&(i=0),new Md(e,t,n,r,i)},e.adagrad=function(e,t){return void 0===t&&(t=.1),new Td(e,t)},e}(),Pd={sgd:Rd.sgd,momentum:Rd.momentum,adadelta:Rd.adadelta,adagrad:Rd.adagrad,rmsprop:Rd.rmsprop,adamax:Rd.adamax,adam:Rd.adam},Bd="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:void 0!==a?a:function(e){return e()};function Ld(){return new Promise((function(e){return Bd((function(){return e()}))}))}Se.prototype.add=function(e){return Br(this,e)},Se.prototype.broadcastTo=function(e){return eu(this,e)},Se.prototype.div=function(e){return Li(this,e)},Se.prototype.divNoNan=function(e){return uu(this,e)},Se.prototype.squaredDifference=function(e){return Mu(this,e)},Se.prototype.tile=function(e){return cu(this,e)},Se.prototype.oneHot=function(e,t,n){return void 0===t&&(t=1),void 0===n&&(n=0),du(this,e,t,n)},Se.prototype.transpose=function(e){return fa(this,e)},Se.prototype.pad=function(e,t){return hu(this,e,t)},Se.prototype.batchNorm=function(e,t,n,r,i){return Gs(this,e,t,n,r,i)},ke=Jl}.call(this,n(59),n(75),n(92).Buffer,n(207).setImmediate)},function(e,t,n){"use strict";function r(e,t,n){return e.fields=t||[],e.fname=n,e}function i(e){return null==e?null:e.fname}function a(e){return null==e?null:e.fields}function o(e){return 1===e.length?s(e[0]):u(e)}n.d(t,"a",(function(){return k})),n.d(t,"b",(function(){return x})),n.d(t,"c",(function(){return _})),n.d(t,"d",(function(){return b})),n.d(t,"e",(function(){return w})),n.d(t,"f",(function(){return r})),n.d(t,"g",(function(){return a})),n.d(t,"h",(function(){return i})),n.d(t,"i",(function(){return $})),n.d(t,"j",(function(){return te})),n.d(t,"k",(function(){return J})),n.d(t,"l",(function(){return ee})),n.d(t,"m",(function(){return ae})),n.d(t,"n",(function(){return oe})),n.d(t,"o",(function(){return c})),n.d(t,"p",(function(){return se})),n.d(t,"q",(function(){return ue})),n.d(t,"r",(function(){return ce})),n.d(t,"s",(function(){return g})),n.d(t,"t",(function(){return he})),n.d(t,"u",(function(){return f})),n.d(t,"v",(function(){return pe})),n.d(t,"w",(function(){return fe})),n.d(t,"x",(function(){return d})),n.d(t,"y",(function(){return h})),n.d(t,"z",(function(){return me})),n.d(t,"A",(function(){return ve})),n.d(t,"B",(function(){return S})),n.d(t,"C",(function(){return ge})),n.d(t,"D",(function(){return ye})),n.d(t,"E",(function(){return Z})),n.d(t,"F",(function(){return be})),n.d(t,"G",(function(){return xe})),n.d(t,"H",(function(){return C})),n.d(t,"I",(function(){return we})),n.d(t,"J",(function(){return _e})),n.d(t,"K",(function(){return ke})),n.d(t,"L",(function(){return Ee})),n.d(t,"M",(function(){return E})),n.d(t,"N",(function(){return Ce})),n.d(t,"O",(function(){return Ae})),n.d(t,"P",(function(){return O})),n.d(t,"Q",(function(){return m})),n.d(t,"R",(function(){return De})),n.d(t,"S",(function(){return L})),n.d(t,"T",(function(){return z})),n.d(t,"U",(function(){return U})),n.d(t,"V",(function(){return W})),n.d(t,"W",(function(){return j})),n.d(t,"X",(function(){return K})),n.d(t,"Y",(function(){return Oe})),n.d(t,"Z",(function(){return Te})),n.d(t,"Aa",(function(){return l})),n.d(t,"Ba",(function(){return je})),n.d(t,"Ca",(function(){return Me})),n.d(t,"Da",(function(){return Ie})),n.d(t,"Ea",(function(){return M})),n.d(t,"Fa",(function(){return Re})),n.d(t,"Ga",(function(){return Ne})),n.d(t,"Ha",(function(){return Pe})),n.d(t,"Ia",(function(){return v})),n.d(t,"Ja",(function(){return Y})),n.d(t,"Ka",(function(){return Be})),n.d(t,"La",(function(){return D})),n.d(t,"Ma",(function(){return p})),n.d(t,"Na",(function(){return G})),n.d(t,"Oa",(function(){return q})),n.d(t,"Pa",(function(){return H})),n.d(t,"Qa",(function(){return X}));var s=function(e){return function(t){return t[e]}},u=function(e){var t=e.length;return function(n){for(var r=0;r<t;++r)n=n[e[r]];return n}};function c(e){throw Error(e)}function l(e){var t,n,r,i=[],a=e.length,o=null,s=0,u="";function l(){i.push(u+e.substring(t,n)),u="",t=n+1}for(e+="",t=n=0;n<a;++n)if("\\"===(r=e[n]))u+=e.substring(t,n),u+=e.substring(++n,++n),t=n;else if(r===o)l(),o=null,s=-1;else{if(o)continue;t===s&&'"'===r||t===s&&"'"===r?(t=n+1,o=r):"."!==r||s?"["===r?(n>t&&l(),s=t=n+1):"]"===r&&(s||c("Access path missing open bracket: "+e),s>0&&l(),s=0,t=n+1):n>t?l():t=n+1}return s&&c("Access path missing closing bracket: "+e),o&&c("Access path missing closing quote: "+e),n>t&&(n++,l()),i}function f(e,t,n){var i=l(e);return e=1===i.length?i[0]:e,r((n&&n.get||o)(i),[e],t||e)}var d=f("id"),h=r((function(e){return e}),[],"identity"),p=r((function(){return 0}),[],"zero"),m=r((function(){return 1}),[],"one"),v=r((function(){return!0}),[],"true"),g=r((function(){return!1}),[],"false");function y(e,t,n){var r=[t].concat([].slice.call(n));console[e].apply(console,r)}var b=0,x=1,w=2,_=3,k=4;function E(e,t){var n=e||b;return{level:function(e){return arguments.length?(n=+e,this):n},error:function(){return n>=x&&y(t||"error","ERROR",arguments),this},warn:function(){return n>=w&&y(t||"warn","WARN",arguments),this},info:function(){return n>=_&&y(t||"log","INFO",arguments),this},debug:function(){return n>=k&&y(t||"log","DEBUG",arguments),this}}}var S=Array.isArray;function C(e){return e===Object(e)}var A=function(e){return"__proto__"!==e};function O(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((function(e,t){for(var n in t)if("signals"===n)e.signals=T(e.signals,t.signals);else{var r="legend"===n?{layout:1}:"style"===n||null;D(e,n,t[n],r)}return e}),{})}function D(e,t,n,r){var i,a;if(A(t))if(C(n)&&!S(n))for(i in a=C(e[t])?e[t]:e[t]={},n)r&&(!0===r||r[i])?D(a,i,n[i]):A(i)&&(a[i]=n[i]);else e[t]=n}function T(e,t){if(null==e)return t;var n={},r=[];function i(e){n[e.name]||(n[e.name]=1,r.push(e))}return t.forEach(i),e.forEach(i),r}function j(e){return e[e.length-1]}function M(e){return null==e||""===e?null:+e}var F=function(e){return function(t){return e*Math.exp(t)}},I=function(e){return function(t){return Math.log(e*t)}},N=function(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}},R=function(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}},P=function(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}};function B(e,t,n,r){var i=n(e[0]),a=n(j(e)),o=(a-i)*t;return[r(i-o),r(a-o)]}function L(e,t){return B(e,t,M,h)}function z(e,t){var n=Math.sign(e[0]);return B(e,t,I(n),F(n))}function U(e,t,n){return B(e,t,P(n),P(1/n))}function W(e,t,n){return B(e,t,N(n),R(n))}function V(e,t,n,r,i){var a=r(e[0]),o=r(j(e)),s=null!=t?r(t):(a+o)/2;return[i(s+(a-s)*n),i(s+(o-s)*n)]}function G(e,t,n){return V(e,t,n,M,h)}function q(e,t,n){var r=Math.sign(e[0]);return V(e,t,n,I(r),F(r))}function H(e,t,n,r){return V(e,t,n,P(r),P(1/r))}function X(e,t,n,r){return V(e,t,n,N(r),R(r))}function K(e){return 1+~~(new Date(e).getMonth()/3)}function Y(e){return 1+~~(new Date(e).getUTCMonth()/3)}function $(e){return null!=e?S(e)?e:[e]:[]}function J(e,t,n){var r,i=e[0],a=e[1];return a<i&&(r=a,a=i,i=r),(r=a-i)>=n-t?[t,n]:[i=Math.min(Math.max(i,t),n-r),i+r]}function Z(e){return"function"==typeof e}var Q="descending";function ee(e,t,n){n=n||{},t=$(t)||[];var i=[],o=[],s={},u=n.comparator||ne;return $(e).forEach((function(e,r){null!=e&&(i.push(t[r]===Q?-1:1),o.push(e=Z(e)?e:f(e,null,n)),(a(e)||[]).forEach((function(e){return s[e]=1})))})),0===o.length?null:r(u(o,i),Object.keys(s))}var te=function(e,t){return(e<t||null==e)&&null!=t?-1:(e>t||null==t)&&null!=e?1:(t=t instanceof Date?+t:t,(e=e instanceof Date?+e:e)!==e&&t==t?-1:t!=t&&e==e?1:0)},ne=function(e,t){return 1===e.length?re(e[0],t[0]):ie(e,t,e.length)},re=function(e,t){return function(n,r){return te(e(n),e(r))*t}},ie=function(e,t,n){return t.push(0),function(r,i){for(var a,o=0,s=-1;0===o&&++s<n;)a=e[s],o=te(a(r),a(i));return o*t[s]}};function ae(e){return Z(e)?e:function(){return e}}function oe(e,t){var n;return function(r){n&&clearTimeout(n),n=setTimeout((function(){return t(r),n=null}),e)}}function se(e){for(var t,n,r=1,i=arguments.length;r<i;++r)for(n in t=arguments[r])e[n]=t[n];return e}function ue(e,t){var n,r,i,a,o=0;if(e&&(n=e.length))if(null==t){for(r=e[o];o<n&&(null==r||r!=r);r=e[++o]);for(i=a=r;o<n;++o)null!=(r=e[o])&&(r<i&&(i=r),r>a&&(a=r))}else{for(r=t(e[o]);o<n&&(null==r||r!=r);r=t(e[++o]));for(i=a=r;o<n;++o)null!=(r=t(e[o]))&&(r<i&&(i=r),r>a&&(a=r))}return[i,a]}function ce(e,t){var n,r,i,a,o,s=e.length,u=-1;if(null==t){for(;++u<s;)if(null!=(r=e[u])&&r>=r){n=i=r;break}if(u===s)return[-1,-1];for(a=o=u;++u<s;)null!=(r=e[u])&&(n>r&&(n=r,a=u),i<r&&(i=r,o=u))}else{for(;++u<s;)if(null!=(r=t(e[u],u,e))&&r>=r){n=i=r;break}if(u===s)return[-1,-1];for(a=o=u;++u<s;)null!=(r=t(e[u],u,e))&&(n>r&&(n=r,a=u),i<r&&(i=r,o=u))}return[a,o]}var le=Object.prototype.hasOwnProperty;function fe(e,t){return le.call(e,t)}var de={};function he(e){var t,n={};function r(e){return fe(n,e)&&n[e]!==de}var i={size:0,empty:0,object:n,has:r,get:function(e){return r(e)?n[e]:void 0},set:function(e,t){return r(e)||(++i.size,n[e]===de&&--i.empty),n[e]=t,this},delete:function(e){return r(e)&&(--i.size,++i.empty,n[e]=de),this},clear:function(){i.size=i.empty=0,i.object=n={}},test:function(e){return arguments.length?(t=e,i):t},clean:function(){var e={},r=0;for(var a in n){var o=n[a];o===de||t&&t(o)||(e[a]=o,++r)}i.size=r,i.empty=0,i.object=n=e}};return e&&Object.keys(e).forEach((function(t){i.set(t,e[t])})),i}function pe(e,t,n,r,i,a){if(!n&&0!==n)return a;var o,s=+n,u=e[0],c=j(e);c<u&&(o=u,u=c,c=o),o=Math.abs(t-u);var l=Math.abs(c-t);return o<l&&o<=s?r:l<=s?i:a}function me(e,t,n){var r=e.prototype=Object.create(t.prototype);return Object.defineProperty(r,"constructor",{value:e,writable:!0,enumerable:!0,configurable:!0}),se(r,n)}function ve(e,t,n,r){var i,a=t[0],o=t[t.length-1];return a>o&&(i=a,a=o,o=i),r=void 0===r||r,((n=void 0===n||n)?a<=e:a<e)&&(r?e<=o:e<o)}function ge(e){return"boolean"==typeof e}function ye(e){return"[object Date]"===Object.prototype.toString.call(e)}function be(e){return e&&Z(e[Symbol.iterator])}function xe(e){return"number"==typeof e}function we(e){return"[object RegExp]"===Object.prototype.toString.call(e)}function _e(e){return"string"==typeof e}function ke(e,t,n){e&&(e=t?$(e).map((function(e){return e.replace(/\\(.)/g,"$1")})):$(e));var i,a=e&&e.length,s=n&&n.get||o,u=function(e){return s(t?[e]:l(e))};if(a)if(1===a){var c=u(e[0]);i=function(e){return""+c(e)}}else{var f=e.map(u);i=function(e){for(var t=""+f[0](e),n=0;++n<a;)t+="|"+f[n](e);return t}}else i=function(){return""};return r(i,e,"key")}function Ee(e,t){var n=e[0],r=j(e),i=+t;return i?1===i?r:n+i*(r-n):n}var Se=1e4;function Ce(e){var t,n,r;e=+e||Se;var i=function(){t={},n={},r=0},a=function(i,a){return++r>e&&(n=t,t={},r=1),t[i]=a};return i(),{clear:i,has:function(e){return fe(t,e)||fe(n,e)},get:function(e){return fe(t,e)?t[e]:fe(n,e)?a(e,n[e]):void 0},set:function(e,n){return fe(t,e)?t[e]=n:a(e,n)}}}function Ae(e,t,n,r){var i=t.length,a=n.length;if(!a)return t;if(!i)return n;for(var o=r||new t.constructor(i+a),s=0,u=0,c=0;s<i&&u<a;++c)o[c]=e(t[s],n[u])>0?n[u++]:t[s++];for(;s<i;++s,++c)o[c]=t[s];for(;u<a;++u,++c)o[c]=n[u];return o}function Oe(e,t){for(var n="";--t>=0;)n+=e;return n}function De(e,t,n,r){var i=n||" ",a=e+"",o=t-a.length;return o<=0?a:"left"===r?Oe(i,o)+a:"center"===r?Oe(i,~~(o/2))+a+Oe(i,Math.ceil(o/2)):a+Oe(i,o)}function Te(e){return e&&j(e)-e[0]||0}function je(e){return S(e)?"["+e.map(je)+"]":C(e)||_e(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function Me(e){return null==e||""===e?null:!(!e||"false"===e||"0"===e)&&!!e}var Fe=function(e){return xe(e)||ye(e)?e:Date.parse(e)};function Ie(e,t){return t=t||Fe,null==e||""===e?null:t(e)}function Ne(e){return null==e||""===e?null:e+""}function Re(e){for(var t={},n=e.length,r=0;r<n;++r)t[e[r]]=!0;return t}function Pe(e,t,n,r){var i=null!=r?r:"\u2026",a=e+"",o=a.length,s=Math.max(0,t-i.length);return o<=t?a:"left"===n?i+a.slice(o-s):"center"===n?a.slice(0,Math.ceil(s/2))+i+a.slice(o-~~(s/2)):a.slice(0,s)+i}function Be(e,t,n){if(e)if(t)for(var r=e.length,i=0;i<r;++i){var a=t(e[i]);a&&n(a,i,e)}else e.forEach(n)}},function(e,t,n){"use strict";n.r(t);var r=n(0),i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function a(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var o,s=function(){return(s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function u(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))}function c(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function l(){return null==o&&(o=Object(r.backend)().epsilon()),o}var f=function(e){function t(n){var r=e.call(this,n)||this;return Object.setPrototypeOf(r,t.prototype),r}return a(t,e),t}(Error),d=function(e){function t(n){var r=e.call(this,n)||this;return Object.setPrototypeOf(r,t.prototype),r}return a(t,e),t}(Error),h=function(e){function t(n){var r=e.call(this,n)||this;return Object.setPrototypeOf(r,t.prototype),r}return a(t,e),t}(Error),p=function(e){function t(n){var r=e.call(this,n)||this;return Object.setPrototypeOf(r,t.prototype),r}return a(t,e),t}(Error),m=function(e){function t(n){var r=e.call(this,n)||this;return Object.setPrototypeOf(r,t.prototype),r}return a(t,e),t}(Error);function v(e,t){if(Array.isArray(e)){for(var n=[],r=0;r<t;r++)n=n.concat(e);return n}return(n=new Array(t)).fill(e),n}function g(e,t){if(!e)throw new m(t)}function y(e,t){for(var n=0,r=0,i=e;r<i.length;r++)i[r]===t&&n++;return n}function b(e){return 1===e.length?e[0]:e}function x(e){return Array.isArray(e)?e:[e]}function w(e){var t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==t[0]?t:"private"+t}function _(e){return e.length<=1||-1===e.indexOf("_")?e:e.replace(/[_]+(\w|$)/g,(function(e,t){return t.toUpperCase()}))}!function(e){function t(n){var r=e.call(this,n)||this;return Object.setPrototypeOf(r,t.prototype),r}a(t,e)}(Error);var k={};function E(e){if(null===e||void 0===e)return null;var t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function S(e,t,n,r,i){var a,o,u;if(void 0===t&&(t={}),void 0===n&&(n={}),void 0===r&&(r="object"),void 0===i&&(i=!1),"string"==typeof e){var c=e,l=void 0;if(c in n)l=n[c];else if(c in k)l=k[c];else if(null==(l=t[c]))throw new h("Unknown "+r+": "+e+". This may be due to one of the following reasons:\n1. The "+r+" is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom "+r+" is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().");return l}var f=e;if(null==f.className||null==f.config)throw new h(r+": Improper config format: "+JSON.stringify(f)+".\n'className' and 'config' must set.");var d=f.className,p=void 0,m=void 0;if(d in n?(p=(a=n[d])[0],m=a[1]):d in k?(p=(o=k.className)[0],m=o[1]):d in t&&(p=(u=t[d])[0],m=u[1]),null==p)throw new h("Unknown "+r+": "+d+". This may be due to one of the following reasons:\n1. The "+r+" is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom "+r+" is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().");if(null!=m){for(var v={},g=0,y=Object.keys(k);g<y.length;g++)v[S=y[g]]=k[S];for(var b=0,x=Object.keys(n);b<x.length;b++)v[S=x[b]]=n[S];f.config.customObjects=v;for(var w=s({},k),_=0,E=Object.keys(n);_<E.length;_++){var S=E[_];k[S]=n[S]}!function e(t){if(null!=t&&"object"==typeof t)if(Array.isArray(t))t.forEach((function(t){return e(t)}));else for(var n=0,r=Object.keys(t);n<r.length;n++){var i=r[n],a=t[i];null!=a&&"object"==typeof a&&(Array.isArray(a)||"ndarray"!==a.type||"number"!=typeof a.value?e(a):t[i]=a.value)}}(f.config);var C=m(p,f.config,n,i);return k=s({},w),C}w=s({},k);for(var A=0,O=Object.keys(n);A<O.length;A++)S=O[A],k[S]=n[S];return C=new p(f.config),k=s({},w),C}function C(e,t){return-1*function(e,t){return e<t?-1:e>t?1:0}(e,t)}function A(e){if(null==e)return e;for(var t=[],n=0,r=e;n<r.length;n++){var i=r[n];-1===t.indexOf(i)&&t.push(i)}return t}function O(e){if(null==e)throw new h("Invalid value in obj: "+JSON.stringify(e));for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function D(e,t,n){if(null!=n&&e.indexOf(n)<0)throw new h(n+" is not a valid "+t+".  Valid values are "+e+" or null/undefined.")}function T(e,t,n,r){return void 0===n&&(n=0),void 0===r&&(r=1/0),g(n>=0),g(r>=n),Array.isArray(e)&&e.length>=n&&e.length<=r&&e.every((function(e){return typeof e===t}))}function j(e,t){Array.isArray(e)?(r.util.assert(e.length>0,(function(){return t+" is unexpectedly an empty array."})),e.forEach((function(e,n){return j(e,"element "+(n+1)+" of "+t)}))):r.util.assert(Number.isInteger(e)&&e>0,(function(){return"Expected "+t+" to be a positive integer, but got "+function e(t){return null===t?"null":Array.isArray(t)?"["+t.map((function(t){return e(t)})).join(",")+"]":"string"==typeof t?'"'+t+'"':""+t}(e)+"."}))}function M(e){return"relu"===e?"relu":"linear"===e?"linear":"elu"===e?"elu":null}function F(e,t){return Object(r.tidy)((function(){return Object(r.sqrt)(Object(r.sum)(Object(r.mulStrict)(e,e),t,!0))}))}var I=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.getConfig=function(){return{}},t}(r.serialization.Serializable),N=function(e){function t(t){var n=e.call(this)||this;return n.defaultMaxValue=2,n.defaultAxis=0,n.maxValue=null!=t.maxValue?t.maxValue:n.defaultMaxValue,n.axis=null!=t.axis?t.axis:n.defaultAxis,n}return a(t,e),t.prototype.apply=function(e){var t=this;return Object(r.tidy)((function(){var n=F(e,t.axis),i=Object(r.clipByValue)(n,0,t.maxValue);return Object(r.mul)(e,Object(r.div)(i,Object(r.add)(l(),n)))}))},t.prototype.getConfig=function(){return{maxValue:this.maxValue,axis:this.axis}},t.className="MaxNorm",t}(I);r.serialization.registerClass(N);var R=function(e){function t(t){var n=e.call(this)||this;return n.defaultAxis=0,n.axis=null!=t.axis?t.axis:n.defaultAxis,n}return a(t,e),t.prototype.apply=function(e){var t=this;return Object(r.tidy)((function(){return Object(r.div)(e,Object(r.add)(l(),F(e,t.axis)))}))},t.prototype.getConfig=function(){return{axis:this.axis}},t.className="UnitNorm",t}(I);r.serialization.registerClass(R);var P=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.apply=function(e){return Object(r.relu)(e)},t.className="NonNeg",t}(I);r.serialization.registerClass(P);var B=function(e){function t(t){var n=e.call(this)||this;return n.defaultMinValue=0,n.defaultMaxValue=1,n.defaultRate=1,n.defaultAxis=0,n.minValue=null!=t.minValue?t.minValue:n.defaultMinValue,n.maxValue=null!=t.maxValue?t.maxValue:n.defaultMaxValue,n.rate=null!=t.rate?t.rate:n.defaultRate,n.axis=null!=t.axis?t.axis:n.defaultAxis,n}return a(t,e),t.prototype.apply=function(e){var t=this;return Object(r.tidy)((function(){var n=F(e,t.axis),i=Object(r.add)(Object(r.mul)(t.rate,Object(r.clipByValue)(n,t.minValue,t.maxValue)),Object(r.mul)(1-t.rate,n));return Object(r.mul)(e,Object(r.div)(i,Object(r.add)(l(),n)))}))},t.prototype.getConfig=function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}},t.className="MinMaxNorm",t}(I);r.serialization.registerClass(B);var L={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function z(e){return E(e)}function U(e,t){return void 0===t&&(t={}),S(e,r.serialization.SerializationMap.getMap().classNameMap,t,"constraint")}function W(e){return null==e?null:"string"==typeof e?U({className:e in L?L[e]:e,config:{}}):e instanceof I?e:U(e)}var V=Object.freeze({maxNorm:function(e){return new N(e)},unitNorm:function(e){return new R(e)},nonNeg:function(){return new P},minMaxNorm:function(e){return new B(e)}}),G=["channelsFirst","channelsLast"],q=["valid","same","causal"],H=["max","avg"],X=["sum","mul","concat","ave"],K=new Map;function Y(e){D(G,"DataFormat",e)}function $(e){D(q,"PaddingMode",e)}function J(e){D(H,"PoolMode",e)}var Z=[],Q="/";function ee(e,t){Z.push(e);try{var n=t();return Z.pop(),n}catch(e){throw Z.pop(),e}}function te(e){if(!ie(e))throw new Error("Not a valid tensor name: '"+e+"'");return(0===Z.length?"":Z.join(Q)+Q)+e}function ne(e){if(!ie(e))throw new Error("Not a valid tensor name: '"+e+"'");K.has(e)||K.set(e,0);var t=K.get(e);if(K.set(e,K.get(e)+1),t>0){var n=e+"_"+t;return K.set(n,1),n}return e}var re=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function ie(e){return!!e.match(re)}function ae(e){return e===parseInt(e.toString(),10)}function oe(e,t,n){null==t&&(t=0),null==n&&(n=e.length);for(var r=1,i=t;i<n;++i)r*=e[i];return r}function se(e){return e=Array.isArray(e)?new Float32Array(e):e,Object(r.tensor1d)(e)}function ue(e){return Object(r.min)(se(e)).dataSync()[0]}function ce(e){return Object(r.max)(se(e)).dataSync()[0]}function le(e,t){if(t<e)throw new h("end ("+t+") < begin ("+e+") is forbidden.");for(var n=[],r=e;r<t;++r)n.push(r);return n}function fe(e,t){return e.asType(t)}function de(e,t){void 0===t&&(t=-1);var n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),e.reshape(n)}function he(e,t,n){return Object(r.tidy)((function(){switch(e.rank){case 1:return Object(r.slice1d)(e,t,n);case 2:return Object(r.slice2d)(e,[t,0],[n,e.shape[1]]);case 3:return Object(r.slice3d)(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return Object(r.slice4d)(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return Object(r.slice)(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return Object(r.slice)(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new h("sliceAlongFirstAxis() received an unsupported tensor rank: "+e.rank)}}))}function pe(e,t,n){return Object(r.tidy)((function(){switch(e.rank){case 1:return Object(r.slice1d)(e,t,n);case 2:return Object(r.slice2d)(e,[0,t],[e.shape[0],n]);case 3:return Object(r.slice3d)(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return Object(r.slice4d)(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new h("sliceAlongLastAxis() received an unsupported tensor rank: "+e.rank)}}))}function me(e,t,n,i){return Object(r.tidy)((function(){switch(e.rank){case 1:return Object(r.slice1d)(e,t,n);case 2:switch(i){case 1:return he(e,t,n);case 2:return pe(e,t,n);default:throw new h("The axis is not within the rank of the tensor "+i)}case 3:switch(i){case 1:return he(e,t,n);case 2:return Object(r.slice3d)(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return pe(e,t,n);default:throw new h("The axis is not within the rank of the tensor "+i)}case 4:switch(i){case 1:return he(e,t,n);case 2:return Object(r.slice4d)(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return Object(r.slice4d)(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return pe(e,t,n);default:throw new h("The axis is not within the rank of the tensor "+i)}default:throw new h("sliceAlongLastAxis() received an unsupported tensor rank: "+e.rank)}}))}function ve(e,t){var n;return void 0===t&&(t=-1),t<0&&(t=0!==(n=e[0].rank)?n:0),t===e[0].rank&&(t=-1),Object(r.concat)(e,t)}function ge(e,t){switch(e.rank){case 1:return Object(r.concat1d)([e,t]);case 2:return Object(r.concat2d)([e,t],0);case 3:return Object(r.concat3d)([e,t],0);case 4:return Object(r.concat4d)([e,t],0);default:throw new h("concatAlongFirstAxis() received an unsupported tensor rank: "+e.rank)}}function ye(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new h("The length of input n ("+t.length+") does not match the number of dimensions in input x ("+e.rank+")");return Object(r.tile)(e,t)}function be(e,t,n,i,a){return void 0===t&&(t=0),void 0===n&&(n=1),Object(r.randomNormal)(e,t,n,i,a)}function xe(e,t,n,i){if(e.rank<2||t.rank<2)throw new p("dot requires both inputs to be rank >= 2 but got x shape = "+e.shape+" and y shape = "+t.shape);if(t.rank>=3&&e.shape.slice(-1)[0]!==(f=t.shape.slice(-2)[0]))throw new p("If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = "+e.shape+" and  y shape = "+t.shape);if(2===e.rank&&2===t.rank){var a=!1,o=!1;return r.fused.matMul({a:e,b:t,transposeA:a,transposeB:o,bias:i?ke(e.rank,i,"channelsLast"):null,activation:n})}var s=e.shape.slice(),u=s.pop();e=e.reshape([-1,u]);var c=t.shape.slice(),l=c.pop(),f=c.pop(),d=c.concat([l]),h=Array.from({length:t.rank},(function(e,n){return 0===n?t.rank-2:n<=t.rank-2?n-1:n}));t=t.transpose(h).reshape([f,-1]);var m=s.concat(d);return a=!1,o=!1,r.fused.matMul({a:e,b:t,transposeA:a,transposeB:o,bias:i?ke(e.rank,i,"channelsLast"):null,activation:n}).reshape(m)}function we(e,t,n){return Object(r.tidy)((function(){return t=Array.isArray(t)?Object(r.tensor1d)(t,"int32"):t.toInt(),Object(r.gather)(e,t,n)}))}function _e(e){return Object(r.mulStrict)(e,e)}function ke(e,t,n){var r=t.shape;if(1!==t.rank&&t.rank!==e)throw new h("Unexpected bias dimensions: "+t.rank+"; expected it to be 1 or "+e);if(5===e){if("channelsFirst"===n)return 1===r.length?t.reshape([1,r[0],1,1,1]):t.reshape([1,r[3],r[0],r[1],r[2]]);if("channelsLast"===n)return 1===r.length?t.reshape([1,1,1,1,r[0]]):t.reshape([1].concat(r))}else if(4===e){if("channelsFirst"===n)return 1===r.length?t.reshape([1,r[0],1,1]):t.reshape([1,r[2],r[0],r[1]]);if("channelsLast"===n)return 1===r.length?t.reshape([1,1,1,r[0]]):t.reshape([1].concat(r))}else if(3===e){if("channelsFirst"===n)return 1===r.length?t.reshape([1,r[0],1]):t.reshape([1,r[1],r[0]]);if("channelsLast"===n)return 1===r.length?t.reshape([1,1,r[0]]):t.reshape([1].concat(r))}else if(e<3)return t;throw new h("Unsupported input rank by biasAdd: "+t.rank)}function Ee(e,t,n){return Object(r.tidy)((function(){return null==n&&(n="channelsLast"),Y(n),e.add(ke(e.rank,t,n))}))}function Se(e,t,n,i){return Object(r.tidy)((function(){return Object(r.dropout)(e,t,n,i)}))}function Ce(e,t,n){return void 0===n&&(n=!1),n?e():t()}var Ae=["fanIn","fanOut","fanAvg"],Oe=["normal","uniform","truncatedNormal"],De=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.fromConfigUsesCustomObjects=function(){return!1},t.prototype.getConfig=function(){return{}},t}(r.serialization.Serializable),Te=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.apply=function(e,t){return Object(r.zeros)(e,t)},t.className="Zeros",t}(De);r.serialization.registerClass(Te);var je=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.apply=function(e,t){return Object(r.ones)(e,t)},t.className="Ones",t}(De);r.serialization.registerClass(je);var Me=function(e){function t(t){var n=e.call(this)||this;if("object"!=typeof t)throw new h("Expected argument of type ConstantConfig but got "+t);if(void 0===t.value)throw new h("config must have value set but got "+t);return n.value=t.value,n}return a(t,e),t.prototype.apply=function(e,t){var n=this;return Object(r.tidy)((function(){return Object(r.mul)(Object(r.scalar)(n.value),Object(r.ones)(e,t))}))},t.prototype.getConfig=function(){return{value:this.value}},t.className="Constant",t}(De);r.serialization.registerClass(Me);var Fe=function(e){function t(t){var n=e.call(this)||this;return n.DEFAULT_MINVAL=-.05,n.DEFAULT_MAXVAL=.05,n.minval=t.minval||n.DEFAULT_MINVAL,n.maxval=t.maxval||n.DEFAULT_MAXVAL,n.seed=t.seed,n}return a(t,e),t.prototype.apply=function(e,t){return Object(r.randomUniform)(e,this.minval,this.maxval,t)},t.prototype.getConfig=function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}},t.className="RandomUniform",t}(De);r.serialization.registerClass(Fe);var Ie=function(e){function t(t){var n=e.call(this)||this;return n.DEFAULT_MEAN=0,n.DEFAULT_STDDEV=.05,n.mean=t.mean||n.DEFAULT_MEAN,n.stddev=t.stddev||n.DEFAULT_STDDEV,n.seed=t.seed,n}return a(t,e),t.prototype.apply=function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new p("randomNormal does not support dType "+t+".");return be(e,this.mean,this.stddev,t,this.seed)},t.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},t.className="RandomNormal",t}(De);r.serialization.registerClass(Ie);var Ne=function(e){function t(t){var n=e.call(this)||this;return n.DEFAULT_MEAN=0,n.DEFAULT_STDDEV=.05,n.mean=t.mean||n.DEFAULT_MEAN,n.stddev=t.stddev||n.DEFAULT_STDDEV,n.seed=t.seed,n}return a(t,e),t.prototype.apply=function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new p("truncatedNormal does not support dType "+t+".");return Object(r.truncatedNormal)(e,this.mean,this.stddev,t,this.seed)},t.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},t.className="TruncatedNormal",t}(De);r.serialization.registerClass(Ne);var Re=function(e){function t(t){var n=e.call(this)||this;return n.gain=null!=t.gain?t.gain:1,n}return a(t,e),t.prototype.apply=function(e,t){var n=this;return Object(r.tidy)((function(){if(2!==e.length||e[0]!==e[1])throw new h("Identity matrix initializer can only be used for 2D square matrices.");return Object(r.mul)(n.gain,Object(r.eye)(e[0]))}))},t.prototype.getConfig=function(){return{gain:this.gain}},t.className="Identity",t}(De);r.serialization.registerClass(Re);var Pe=function(e){function t(t){var n=e.call(this)||this;if(t.scale<0)throw new h("scale must be a positive float. Got: "+t.scale);return n.scale=null==t.scale?1:t.scale,n.mode=null==t.mode?"fanIn":t.mode,function(e){D(Ae,"FanMode",e)}(n.mode),n.distribution=null==t.distribution?"normal":t.distribution,function(e){D(Oe,"Distribution",e)}(n.distribution),n.seed=t.seed,n}return a(t,e),t.prototype.apply=function(e,t){var n=function(e,t){var n,r;if(void 0===t&&(t="channelsLast"),Y(t),2===e.length)n=e[0],r=e[1];else if(-1!==[3,4,5].indexOf(e.length))if("channelsFirst"===t){var i=oe(e,2);n=e[1]*i,r=e[0]*i}else"channelsLast"===t&&(i=oe(e,0,e.length-2),n=e[e.length-2]*i,r=e[e.length-1]*i);else{var a=oe(e);n=Math.sqrt(a),r=Math.sqrt(a)}return[n,r]}(e),i=n[0],a=n[1],o=this.scale;if("fanIn"===this.mode?o/=Math.max(1,i):"fanOut"===this.mode?o/=Math.max(1,a):o/=Math.max(1,(i+a)/2),"normal"===this.distribution){var s=Math.sqrt(o);if("float32"!==(t=t||"float32")&&"int32"!==t)throw new p(this.getClassName()+" does not support dType "+t+".");return Object(r.truncatedNormal)(e,0,s,t,this.seed)}var u=Math.sqrt(3*o);return Object(r.randomUniform)(e,-u,u,t)},t.prototype.getConfig=function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}},t.className="VarianceScaling",t}(De);r.serialization.registerClass(Pe);var Be=function(e){function t(t){return e.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:null==t?null:t.seed})||this}return a(t,e),t.prototype.getClassName=function(){return Pe.className},t.className="GlorotUniform",t}(Pe);r.serialization.registerClass(Be);var Le=function(e){function t(t){return e.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:null==t?null:t.seed})||this}return a(t,e),t.prototype.getClassName=function(){return Pe.className},t.className="GlorotNormal",t}(Pe);r.serialization.registerClass(Le);var ze=function(e){function t(t){return e.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:null==t?null:t.seed})||this}return a(t,e),t.prototype.getClassName=function(){return Pe.className},t.className="HeNormal",t}(Pe);r.serialization.registerClass(ze);var Ue=function(e){function t(t){return e.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:null==t?null:t.seed})||this}return a(t,e),t.prototype.getClassName=function(){return Pe.className},t.className="HeUniform",t}(Pe);r.serialization.registerClass(Ue);var We=function(e){function t(t){return e.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:null==t?null:t.seed})||this}return a(t,e),t.prototype.getClassName=function(){return Pe.className},t.className="LeCunNormal",t}(Pe);r.serialization.registerClass(We);var Ve=function(e){function t(t){return e.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:null==t?null:t.seed})||this}return a(t,e),t.prototype.getClassName=function(){return Pe.className},t.className="LeCunNormal",t}(Pe);r.serialization.registerClass(Ve);var Ge=function(e){function t(t){var n=e.call(this)||this;if(n.DEFAULT_GAIN=1,n.gain=null==t.gain?n.DEFAULT_GAIN:t.gain,n.seed=t.seed,null!=n.seed)throw new p("Random seed is not implemented for Orthogonal Initializer yet.");return n}return a(t,e),t.prototype.apply=function(e,t){var n=this;return Object(r.tidy)((function(){if(2!==e.length)throw new p("The Orthogonal Initializer does not support non-2D shapes yet.");e[0]*e[1]>2e3&&console.warn("Orthogonal initializer is being called on a matrix with more than 2000 ("+e[0]*e[1]+") elements: Slowness may result.");var t=be(e[0]>e[1]?[e[1],e[0]]:e,0,1,"float32"),i=r.linalg.gramSchmidt(t);return e[0]>e[1]&&(i=i.transpose()),Object(r.mul)(n.gain,i)}))},t.prototype.getConfig=function(){return{gain:this.gain,seed:this.seed}},t.className="Orthogonal",t}(De);r.serialization.registerClass(Ge);var qe={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function He(e,t){return void 0===t&&(t={}),S(e,r.serialization.SerializationMap.getMap().classNameMap,t,"initializer")}function Xe(e){return E(e)}function Ke(e){if("string"==typeof e){var t=e in qe?qe[e]:e;if("GlorotNormal"===t)return new Le;if("GlorotUniform"===t)return new Be;if("HeNormal"===t)return new ze;if("HeUniform"===t)return new Ue;if("LeCunNormal"===t)return new We;if("LeCunUniform"===t)return new Ve;var n={};return n.className=t,n.config={},He(n)}return e instanceof De?e:He(e)}var Ye=Object.freeze({zeros:function(){return new Te},ones:function(){return new je},constant:function(e){return new Me(e)},randomUniform:function(e){return new Fe(e)},randomNormal:function(e){return new Ie(e)},truncatedNormal:function(e){return new Ne(e)},identity:function(e){return new Re(e)},varianceScaling:function(e){return new Pe(e)},glorotUniform:function(e){return new Be(e)},glorotNormal:function(e){return new Le(e)},heNormal:function(e){return new ze(e)},heUniform:function(e){return new Ue(e)},leCunNormal:function(e){return new We(e)},leCunUniform:function(e){return new Ve(e)},orthogonal:function(e){return new Ge(e)}}),$e=0;function Je(){return $e++}var Ze={};function Qe(e){return void 0===e&&(e=""),e in Ze||(Ze[e]=0),Ze[e]+=1,e+Ze[e].toString()}function et(e){return Array.isArray(e)&&Array.isArray(e[0])}function tt(e){return 0===e.length?[]:Array.isArray(e[0])?e:[e]}function nt(e){var t;if(Array.isArray(e)){if(1!==e.length)throw new h("Expected Tensor length to be 1; got "+e.length);t=e[0]}else t=e;return t}function rt(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(1===e.length)return e[0];throw new h("Expected exactly 1 Shape; got "+e.length)}return e}function it(e){for(var t=0,n=0,r=e;n<r.length;n++){var i=r[n];0===i.shape.length?t+=1:t+=i.shape.reduce((function(e,t){return e*t}))}return t}var at="Variable",ot=function(){function e(e,t,n,i,a){void 0===t&&(t="float32"),void 0===n&&(n=at),void 0===i&&(i=!0),void 0===a&&(a=null),this.dtype=null==t?"float32":t,this.shape=e.shape,this.id=Je(),n=null==n?at:n,this.originalName=te(n),this.name=ne(this.originalName),this.trainable_=i,this.constraint=a,this.val=Object(r.variable)(e,this.trainable_,this.name,this.dtype)}return e.prototype.read=function(){return this.assertNotDisposed(),this.val},e.prototype.write=function(e){return this.assertNotDisposed(),function(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}(this.val,e),this.val.id!==e.id&&(this.val.assign(e),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this},e.prototype.dispose=function(){this.assertNotDisposed(),this.val.dispose()},e.prototype.assertNotDisposed=function(){if(this.val.isDisposed)throw new Error("LayersVariable "+this.name+" is already disposed.")},Object.defineProperty(e.prototype,"trainable",{get:function(){return this.trainable_},set:function(e){this.trainable_=e,this.val.trainable=e},enumerable:!0,configurable:!0}),e}();function st(e){return e.map((function(e){return e.read()}))}function ut(e){e.forEach((function(e){e[0].write(e[1])}))}var ct,lt=function(e){this.dtype=e.dtype,this.shape=e.shape,null!=e.shape?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}},ft=function(e,t,n,r,i,a,o){this.dtype=e,this.shape=t,this.sourceLayer=n,this.inputs=r,this.callArgs=i,this.outputTensorIndex=o,this.id=Je(),null!=a&&(this.originalName=te(a),this.name=ne(this.originalName)),this.rank=t.length},dt=0,ht=function(){function e(e,t){this.callArgs=t,this.id=dt++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(var n=0,r=e.inboundLayers;n<r.length;n++){var i=r[n];null!=i&&i.outboundNodes.push(this)}e.outboundLayer.inboundNodes.push(this)}return e.prototype.getConfig=function(){for(var e=[],t=0,n=this.inboundLayers;t<n.length;t++){var r=n[t];null!=r?e.push(r.name):e.push(null)}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}},e}(),pt=0,mt=function(e){function t(t){var n=e.call(this)||this;n._callHook=null,n._addedWeightNames=[],n._stateful=!1,n.id=pt++,n.activityRegularizer=null,n.inputSpec=null,n.supportsMasking=!1,n._trainableWeights=[],n._nonTrainableWeights=[],n._losses=[],n._updates=[],n._built=!1,n.inboundNodes=[],n.outboundNodes=[];var r=t.name;if(!r){var i=n.getClassName();r=w(i)+"_"+Qe(i)}if(n.name=r,n.trainable_=null==t.trainable||t.trainable,null!=t.inputShape||null!=t.batchInputShape){var a=void 0;if(null!=t.batchInputShape)a=t.batchInputShape;else if(null!=t.inputShape){var o=null;null!=t.batchSize&&(o=t.batchSize),a=[o].concat(t.inputShape)}n.batchInputShape=a;var s=t.dtype;null==s&&(s=t.inputDType),null==s&&(s="float32"),n.dtype=s}return null!=t.weights?n.initialWeights=t.weights:n.initialWeights=null,n._refCount=null,n.fastWeightInitDuringBuild=!1,n}return a(t,e),t.nodeKey=function(e,t){return e.name+"_ib-"+t.toString()},t.prototype.getNodeAtIndex=function(e,t){if(0===this.inboundNodes.length)throw new d("The layer has never been called and thus has no defined "+t+".");if(this.inboundNodes.length<=e)throw new h("Asked to get "+t+" at node "+e+", but the layer has only "+this.inboundNodes.length+" inbound nodes.");return this.inboundNodes[e]},t.prototype.getInputAt=function(e){return b(this.getNodeAtIndex(e,"input").inputTensors)},t.prototype.getOutputAt=function(e){return b(this.getNodeAtIndex(e,"output").outputTensors)},Object.defineProperty(t.prototype,"input",{get:function(){if(this.inboundNodes.length>1)throw new f("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(0===this.inboundNodes.length)throw new f("Layer "+this.name+" is not connected, no input to return.");return b(this.getNodeAtIndex(0,"input").inputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){if(0===this.inboundNodes.length)throw new f("Layer "+this.name+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new f("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return b(this.getNodeAtIndex(0,"output").outputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"losses",{get:function(){return this._losses},enumerable:!0,configurable:!0}),t.prototype.calculateLosses=function(){return this.losses.map((function(e){return e()}))},Object.defineProperty(t.prototype,"updates",{get:function(){return this._updates},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"built",{get:function(){return this._built},set:function(e){this._built=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"trainable",{get:function(){return this.trainable_},set:function(e){this._trainableWeights.forEach((function(t){return t.trainable=e})),this.trainable_=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"trainableWeights",{get:function(){return this.trainable_?this._trainableWeights.filter((function(e){return e.trainable})):[]},set:function(e){this._trainableWeights=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this._trainableWeights.filter((function(e){return!e.trainable})).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)},set:function(e){this._nonTrainableWeights=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stateful",{get:function(){return this._stateful},enumerable:!0,configurable:!0}),t.prototype.resetStates=function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")},t.prototype.assertInputCompatibility=function(e){if(e=x(e),null!=this.inputSpec&&0!==this.inputSpec.length){var t=x(this.inputSpec);if(e.length!==t.length)throw new h("Layer "+this.name+" expects "+t.length+" inputs, but it received "+e.length+" input tensors. Input received: "+e);for(var n=0;n<e.length;n++){var r=e[n],i=t[n];if(null!=i){var a=r.rank;if(null!=i.ndim&&a!==i.ndim)throw new h("Input "+n+" is incompatible with layer "+this.name+": expected ndim="+i.ndim+", found ndim="+a);if(null!=i.maxNDim&&a>i.maxNDim)throw new h("Input "+n+" is incompatible with layer "+this.name+": expected max_ndim="+i.maxNDim+", found ndim="+a);if(null!=i.minNDim&&a<i.minNDim)throw new h("Input "+n+" is incompatible with layer "+this.name+": expected min_ndim="+i.minNDim+", found ndim="+a+".");if(null!=i.dtype&&r.dtype!==i.dtype)throw new h("Input "+n+" is incompatible with layer "+this.name+" : expected dtype="+i.dtype+", found dtype="+r.dtype+".");if(i.axes){var o=r.shape;for(var s in i.axes){var u=Number(s),c=i.axes[s],l=u>=0?o[u]:o[o.length+u];if(null!=c&&-1===[c,null].indexOf(l))throw new h("Input "+n+" is incompatible with layer "+this.name+": expected axis "+u+" of input shape to have value "+c+" but got shape "+o+".")}}if(null!=i.shape)for(var f=0;f<i.shape.length;++f){var d=i.shape[f],p=r.shape[f];if(null!=d&&null!=p&&d!==p)throw new h("Input "+n+" is incompatible with layer "+this.name+": expected shape="+i.shape+", found shape="+r.shape+".")}}}}},t.prototype.call=function(e,t){return e},t.prototype.invokeCallHook=function(e,t){null!=this._callHook&&this._callHook(e,t)},t.prototype.setCallHook=function(e){this._callHook=e},t.prototype.clearCallHook=function(){this._callHook=null},t.prototype.apply=function(e,t){var n=this;t=t||{},this.assertNotDisposed();for(var r=x(e),i=!0,a=0,o=r;a<o.length;a++)if(!(o[a]instanceof ft)){i=!1;break}for(var s=!0,u=0,c=r;u<c.length;u++)if(c[u]instanceof ft){s=!1;break}if(i===s)throw new h("Arguments to apply() must be all SymbolicTensors or all Tensors");return ee(this.name,(function(){if(!n.built){n.assertInputCompatibility(e);for(var i=[],a=0,o=x(e);a<o.length;a++){var u=o[a];i.push(u.shape)}n.build(b(i)),n.built=!0,n.initialWeights&&n.setWeights(n.initialWeights),null===n._refCount&&s&&(n._refCount=1)}if(n.assertInputCompatibility(e),s){for(var c=[],l=0,f=x(v=n.call(e,t));l<f.length;l++){var d=f[l];-1!==r.indexOf(d)&&(d=d.clone()),c.push(d)}if(v=b(c),null!=n.activityRegularizer)throw new p("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return v}var h=function(e){for(var t=[],n=0,r=e=x(e);n<r.length;n++){var i=r[n];t.push(i.shape)}return b(t)}(e),m=n.computeOutputShape(h),v=void 0,g="float32";if(n.warnOnIncompatibleInputShape(Array.isArray(e)?h[0]:h),v=null!=m&&m.length>0&&Array.isArray(m[0])?m.map((function(r,i){return new ft(g,r,n,x(e),t,n.name,i)})):new ft(g,m,n,x(e),t,n.name),n.addInboundNode(e,v,null,null,h,m,t),n._refCount++,null!=n.activityRegularizer)throw new p("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return v}))},t.prototype.warnOnIncompatibleInputShape=function(e){if(null!=this.batchInputShape)if(e.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+JSON.stringify(e)+") does not match that of the batchInputShape ("+JSON.stringify(this.batchInputShape)+") of the layer "+this.name);else{var t=!1;this.batchInputShape.forEach((function(n,r){null!=n&&null!=e[r]&&e[r]!==n&&(t=!0)})),t&&console.warn("The shape of the input tensor ("+JSON.stringify(e)+") does not match the expectation of layer "+this.name+": "+JSON.stringify(this.batchInputShape))}},Object.defineProperty(t.prototype,"outputShape",{get:function(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new f("The layer "+this.name+" has never been called and thus has no defined output shape.");for(var e=[],t=0,n=this.inboundNodes;t<n.length;t++){var r=n[t],i=JSON.stringify(r.outputShapes);-1===e.indexOf(i)&&e.push(i)}if(1===e.length){var a=this.inboundNodes[0].outputShapes;return Array.isArray(a)&&Array.isArray(a[0])&&1===a.length?a[0]:a}throw new f("The layer "+this.name+' has multiple inbound nodes with different output shapes. Hence the notion of "outut shape" is ill-defined for the layer.')},enumerable:!0,configurable:!0}),t.prototype.countParams=function(){if(!this.built)throw new d("You tried to call countParams() on "+this.name+", but the layer is not built yet. Build it first by calling build(batchInputShape).");return it(this.weights)},t.prototype.build=function(e){this.built=!0},t.prototype.getWeights=function(e){return void 0===e&&(e=!1),st(e?this.trainableWeights:this.weights)},t.prototype.setWeights=function(e){var t=this;Object(r.tidy)((function(){var n=t.weights;if(n.length!==e.length)throw new h('You called setWeights(weights) on layer "'+t.name+'" with a weight list of length '+e.length+", but the layer was expecting "+n.length+" weights. Provided weights: "+e+"...");if(0!==n.length){for(var i=[],a=st(n),o=0;o<a.length;++o){var s=a[o],u=n[o],c=e[o];if(!r.util.arraysEqual(s.shape,c.shape))throw new h("Layer weight shape "+s.shape+" not compatible with provided weight shape "+c.shape);i.push([u,c])}ut(i)}}))},t.prototype.addWeight=function(e,t,n,r,i,a,o){if(-1!==this._addedWeightNames.indexOf(e))throw new h("Duplicate weight name "+e+" for layer "+this.name);this._addedWeightNames.push(e),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(r=Ke("zeros"));var s=r.apply(t,n),u=new ot(s,n,e,a,o);return s.dispose(),null!=i&&this.addLoss((function(){return i.apply(u.read())})),null==a&&(a=!0),a?this._trainableWeights.push(u):this._nonTrainableWeights.push(u),u},t.prototype.setFastWeightInitDuringBuild=function(e){this.fastWeightInitDuringBuild=e},t.prototype.addLoss=function(e){var t;null==e||Array.isArray(e)&&0===e.length||(e=x(e),void 0!==this._losses&&null!==this._losses&&(t=this.losses).push.apply(t,e))},t.prototype.computeOutputShape=function(e){return e},t.prototype.computeMask=function(e,t){var n=this;if(!this.supportsMasking){if(null!=t){if(!Array.isArray(t))throw new TypeError("Layer "+this.name+" does not support masking, but was passed an inputMask.");t.forEach((function(e){if(null!=e)throw new TypeError("Layer "+n.name+" does not support masking, but was passed an inputMask.")}))}return null}return t},t.prototype.addInboundNode=function(e,t,n,r,i,a,o){void 0===o&&(o=null);var s=x(e);t=x(t),n=x(n),r=x(r),i=tt(i),a=tt(a);for(var u=[],c=[],l=[],f=0,d=s;f<d.length;f++){var h=d[f];u.push(h.sourceLayer),c.push(h.nodeIndex),l.push(h.tensorIndex)}new ht({outboundLayer:this,inboundLayers:u,nodeIndices:c,tensorIndices:l,inputTensors:s,outputTensors:t,inputMasks:n,outputMasks:r,inputShapes:i,outputShapes:a},o);for(var p=0;p<t.length;p++)t[p].sourceLayer=this,t[p].nodeIndex=this.inboundNodes.length-1,t[p].tensorIndex=p},t.prototype.getConfig=function(){var e={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(e.batchInputShape=this.batchInputShape),null!=this.dtype&&(e.dtype=this.dtype),e},t.prototype.disposeWeights=function(){return this.weights.forEach((function(e){return e.dispose()})),this.weights.length},t.prototype.assertNotDisposed=function(){if(0===this._refCount)throw new Error("Layer '"+this.name+"' is already disposed.")},t.prototype.dispose=function(){if(!this.built)throw new Error("Cannot dispose Layer "+this.name+" because it has not been built yet.");if(null===this._refCount)throw new Error("Cannot dispose Layer "+this.name+" because it has not been used yet.");this.assertNotDisposed();var e=0;return 0==--this._refCount&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}},t}(r.serialization.Serializable),vt=function(e){function t(t){var n=e.call(this,{dtype:t.dtype,name:null!=t.name?t.name:Qe("input").toString()})||this;if(null==t.batchSize&&(t.batchSize=null),null==t.sparse&&(t.sparse=!1),n.trainable=!1,n.built=!0,n.sparse=t.sparse,null!=t.inputShape&&null!=t.batchInputShape)throw new h("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var r=t.batchInputShape;if(null==r){if(null==t.inputShape)throw new h("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");r=[t.batchSize].concat(t.inputShape)}else if(null!=t.batchSize)throw new h("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var i=t.dtype||"float32";n.batchInputShape=r,n.dtype=i,n.inputSpec=[{shape:r}];var a=new ft(n.dtype,n.batchInputShape,n,[],{},n.name);return a.nodeIndex=0,a.tensorIndex=0,new ht({outboundLayer:n,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[a],outputTensors:[a],inputMasks:[null],outputMasks:[null],inputShapes:[r],outputShapes:[r]}),n}return a(t,e),t.prototype.apply=function(e,t){throw new h("Cannot pass any input to an InputLayer's apply() method. InputLayer name: "+this.name)},t.prototype.dispose=function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}},t.prototype.getConfig=function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}},t.className="InputLayer",t}(mt);function gt(e){if(null==e.batchShape&&null==e.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=e.batchShape&&null!=e.shape)throw new h("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var t=e.batchShape;null!=e.shape&&null==t&&(t=[null].concat(e.shape));var n=e.dtype;return null==n&&(n="float32"),new vt({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}function yt(e){return u(this,void 0,void 0,(function(){var t,n,i,a,o,s,u,l;return c(this,(function(c){switch(c.label){case 0:if(null==e)return[2];for(a in t=[],n=[],i=[],e)"number"!=typeof(o=e[a])&&(s=o,t.push(s.data()),n.push(a),i.push(s));return t.length>0?[4,Promise.all(t)]:[3,2];case 1:for(u=c.sent(),l=0;l<u.length;++l)e[n[l]]=u[l][0];Object(r.dispose)(i),c.label=2;case 2:return[2]}}))}))}function bt(e){if(null!=e)for(var t in e){var n=e[t];"number"!=typeof n&&n.dispose()}}r.serialization.registerClass(vt),function(e){e[e.SILENT=0]="SILENT",e[e.VERBOSE=1]="VERBOSE"}(ct||(ct={}));var xt=125,wt=function(){function e(){this.validationData=null}return e.prototype.setParams=function(e){this.params=e},e.prototype.onEpochBegin=function(e,t){return u(this,void 0,void 0,(function(){return c(this,(function(e){return[2]}))}))},e.prototype.onEpochEnd=function(e,t){return u(this,void 0,void 0,(function(){return c(this,(function(e){return[2]}))}))},e.prototype.onBatchBegin=function(e,t){return u(this,void 0,void 0,(function(){return c(this,(function(e){return[2]}))}))},e.prototype.onBatchEnd=function(e,t){return u(this,void 0,void 0,(function(){return c(this,(function(e){return[2]}))}))},e.prototype.onTrainBegin=function(e){return u(this,void 0,void 0,(function(){return c(this,(function(e){return[2]}))}))},e.prototype.onTrainEnd=function(e){return u(this,void 0,void 0,(function(){return c(this,(function(e){return[2]}))}))},e.prototype.setModel=function(e){},e}(),_t=function(){function e(e,t){void 0===t&&(t=10),null==e&&(e=[]),this.callbacks=e,this.queueLength=t}return e.prototype.append=function(e){this.callbacks.push(e)},e.prototype.setParams=function(e){for(var t=0,n=this.callbacks;t<n.length;t++)n[t].setParams(e)},e.prototype.setModel=function(e){for(var t=0,n=this.callbacks;t<n.length;t++)n[t].setModel(e)},e.prototype.onEpochBegin=function(e,t){return u(this,void 0,void 0,(function(){var n,r;return c(this,(function(i){switch(i.label){case 0:null==t&&(t={}),n=0,r=this.callbacks,i.label=1;case 1:return n<r.length?[4,r[n].onEpochBegin(e,t)]:[3,4];case 2:i.sent(),i.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},e.prototype.onEpochEnd=function(e,t){return u(this,void 0,void 0,(function(){var n,r;return c(this,(function(i){switch(i.label){case 0:null==t&&(t={}),n=0,r=this.callbacks,i.label=1;case 1:return n<r.length?[4,r[n].onEpochEnd(e,t)]:[3,4];case 2:i.sent(),i.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},e.prototype.onBatchBegin=function(e,t){return u(this,void 0,void 0,(function(){var n,r;return c(this,(function(i){switch(i.label){case 0:null==t&&(t={}),n=0,r=this.callbacks,i.label=1;case 1:return n<r.length?[4,r[n].onBatchBegin(e,t)]:[3,4];case 2:i.sent(),i.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},e.prototype.onBatchEnd=function(e,t){return u(this,void 0,void 0,(function(){var n,r;return c(this,(function(i){switch(i.label){case 0:null==t&&(t={}),n=0,r=this.callbacks,i.label=1;case 1:return n<r.length?[4,r[n].onBatchEnd(e,t)]:[3,4];case 2:i.sent(),i.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},e.prototype.onTrainBegin=function(e){return u(this,void 0,void 0,(function(){var t,n;return c(this,(function(r){switch(r.label){case 0:null==e&&(e={}),t=0,n=this.callbacks,r.label=1;case 1:return t<n.length?[4,n[t].onTrainBegin(e)]:[3,4];case 2:r.sent(),r.label=3;case 3:return t++,[3,1];case 4:return[2]}}))}))},e.prototype.onTrainEnd=function(e){return u(this,void 0,void 0,(function(){var t,n;return c(this,(function(r){switch(r.label){case 0:null==e&&(e={}),t=0,n=this.callbacks,r.label=1;case 1:return t<n.length?[4,n[t].onTrainEnd(e)]:[3,4];case 2:r.sent(),r.label=3;case 3:return t++,[3,1];case 4:return[2]}}))}))},e}(),kt=function(e){function t(){return e.call(this)||this}return a(t,e),t.prototype.onEpochBegin=function(e){return u(this,void 0,void 0,(function(){return c(this,(function(e){return this.seen=0,this.totals={},[2]}))}))},t.prototype.onBatchEnd=function(e,t){return u(this,void 0,void 0,(function(){var e,n,i,a,o=this;return c(this,(function(s){for(a in null==t&&(t={}),e=null==t.size?0:t.size,this.seen+=e,n=function(n){var a=t[n];if("number"==typeof a)i.totals.hasOwnProperty(n)||(i.totals[n]=0),i.totals[n]=i.totals[n]+a*e;else{var s=void 0;n in i.totals?s=i.totals[n]:i.totals[n]=0;var u=Object(r.tidy)((function(){return Object(r.add)(o.totals[n],Object(r.mul)(a,e))}));i.totals[n]=u,null!=s&&s.dispose()}},i=this,t)n(a);return[2]}))}))},t.prototype.onEpochEnd=function(e,t){return u(this,void 0,void 0,(function(){var e,n,i,a,o,s=this;return c(this,(function(u){if(null!=t)for(e=function(e){if(null==n.totals[e])return"continue";"number"==typeof n.totals[e]?t[e]=n.totals[e]/n.seen:Object(r.tidy)((function(){var n=Object(r.mul)(Object(r.div)(1,s.seen),s.totals[e]);t[e]=n,s.totals[e].dispose(),Object(r.keep)(t[e])}))},n=this,i=0,a=this.params.metrics;i<a.length;i++)o=a[i],e(o);return[2]}))}))},t}(wt),Et=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.onTrainBegin=function(e){return u(this,void 0,void 0,(function(){return c(this,(function(e){return this.epoch=[],this.history={},[2]}))}))},t.prototype.onEpochEnd=function(e,t){return u(this,void 0,void 0,(function(){var n;return c(this,(function(r){for(n in null==t&&(t={}),this.epoch.push(e),t)null==this.history[n]&&(this.history[n]=[]),this.history[n].push(t[n]);return[2]}))}))},t.prototype.syncData=function(){return u(this,void 0,void 0,(function(){var e,t,n,r,i,a,o,s,u;return c(this,(function(c){switch(c.label){case 0:for(r in e=[],t=[],n=[],this.history)for(i=this.history[r],a=0;a<i.length;++a)"number"!=typeof i[a]&&(o=i[a],e.push(o.data()),t.push(r),n.push(a));return[4,Promise.all(e)];case 1:for(s=c.sent(),u=0;u<s.length;++u)this.history[t[u]][n[u]].dispose(),this.history[t[u]][n[u]]=s[u][0];return[2]}}))}))},t}(wt),St=function(e){function t(t,n){var i=e.call(this)||this;if(i.currentEpoch=0,i.yieldEvery=n||"auto","auto"===i.yieldEvery&&(i.yieldEvery=xt),"never"===i.yieldEvery&&null!=t.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");return r.util.isNumber(i.yieldEvery)&&(i.maybeWait=function(e,t){var n,i=r.util.now();return function(){for(var a=[],o=0;o<arguments.length;o++)a[o]=arguments[o];var s=r.util.now();return s-i<t?n:(i=s,n=e.apply(void 0,a))}}(i.maybeWait.bind(i),i.yieldEvery)),i.trainBegin=t.onTrainBegin,i.trainEnd=t.onTrainEnd,i.epochBegin=t.onEpochBegin,i.epochEnd=t.onEpochEnd,i.batchBegin=t.onBatchBegin,i.batchEnd=t.onBatchEnd,i.yield=t.onYield,i}return a(t,e),t.prototype.maybeWait=function(e,t,n){return u(this,void 0,void 0,(function(){var i;return c(this,(function(a){switch(a.label){case 0:return i=[],null==this.yield?[3,2]:[4,yt(n)];case 1:a.sent(),i.push(this.yield(e,t,n)),a.label=2;case 2:return i.push(Object(r.nextFrame)()),[4,Promise.all(i)];case 3:return a.sent(),[2]}}))}))},t.prototype.onEpochBegin=function(e,t){return u(this,void 0,void 0,(function(){return c(this,(function(n){switch(n.label){case 0:return this.currentEpoch=e,null==this.epochBegin?[3,3]:[4,yt(t)];case 1:return n.sent(),[4,this.epochBegin(e,t)];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))},t.prototype.onEpochEnd=function(e,t){return u(this,void 0,void 0,(function(){var n;return c(this,(function(i){switch(i.label){case 0:return n=[],null==this.epochEnd?[3,2]:[4,yt(t)];case 1:i.sent(),n.push(this.epochEnd(e,t)),i.label=2;case 2:return"epoch"===this.yieldEvery&&n.push(Object(r.nextFrame)()),[4,Promise.all(n)];case 3:return i.sent(),[2]}}))}))},t.prototype.onBatchBegin=function(e,t){return u(this,void 0,void 0,(function(){return c(this,(function(n){switch(n.label){case 0:return null==this.batchBegin?[3,3]:[4,yt(t)];case 1:return n.sent(),[4,this.batchBegin(e,t)];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))},t.prototype.onBatchEnd=function(e,t){return u(this,void 0,void 0,(function(){var n;return c(this,(function(i){switch(i.label){case 0:return n=[],null==this.batchEnd?[3,2]:[4,yt(t)];case 1:i.sent(),n.push(this.batchEnd(e,t)),i.label=2;case 2:return"batch"===this.yieldEvery?n.push(Object(r.nextFrame)()):r.util.isNumber(this.yieldEvery)&&n.push(this.maybeWait(this.currentEpoch,e,t)),[4,Promise.all(n)];case 3:return i.sent(),[2]}}))}))},t.prototype.onTrainBegin=function(e){return u(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return null==this.trainBegin?[3,3]:[4,yt(e)];case 1:return t.sent(),[4,this.trainBegin(e)];case 2:t.sent(),t.label=3;case 3:return[2]}}))}))},t.prototype.onTrainEnd=function(e){return u(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return null==this.trainEnd?[3,3]:[4,yt(e)];case 1:return t.sent(),[4,this.trainEnd(e)];case 2:t.sent(),t.label=3;case 3:return[2]}}))}))},t}(wt);function Ct(e,t){return null==e&&(e={}),e instanceof wt?[e]:Array.isArray(e)&&e[0]instanceof wt?e:x(e).map((function(e){return new St(e,t)}))}var At=function(){function e(){}return e.registerCallbackConstructor=function(t,n){r.util.assert(t>=0&&Number.isInteger(t),(function(){return"Verbosity level is expected to be an integer >= 0, but got "+t})),e.checkForDuplicate(n),null==e.constructors[t]&&(e.constructors[t]=[]),e.constructors[t].push(n)},e.checkForDuplicate=function(t){for(var n in e.constructors)e.constructors[+n].forEach((function(e){if(e===t)throw new h("Duplicate callback constructor.")}))},e.clear=function(){e.constructors={}},e.createCallbacks=function(t){var n=[];for(var r in e.constructors){var i=+r;t>=i&&n.push.apply(n,e.constructors[i])}return n.map((function(e){return new e}))},e.constructors={},e}();function Ot(e,t,n,r,i,a,o,s,u){var c=new Et,l=[new kt].concat(At.createCallbacks(t));null!=e&&l.push.apply(l,e),l.push(c);var f=new _t(l);return f.setParams({epochs:n,initialEpoch:r,samples:i,steps:a,batchSize:o,verbose:t,doValidation:s,metrics:u}),{callbackList:f,history:c}}function Dt(e,t,n){return void 0===t&&(t={}),void 0===n&&(n=!1),S(e,r.serialization.SerializationMap.getMap().classNameMap,t,"layer",n)}function Tt(e,t){return Object(r.tidy)((function(){"float32"!==e.dtype&&(e=e.asType("float32"));var n=Object(r.sum)(_e(e),t,!0),i=Object(r.fill)(n.shape,l()),a=Object(r.sqrt)(Object(r.maximum)(n,i));return Object(r.div)(e,a)}))}function jt(e,t){return Object(r.tidy)((function(){return Object(r.mean)(_e(Object(r.sub)(t,e)),-1)}))}function Mt(e,t){return Object(r.tidy)((function(){return Object(r.mean)(Object(r.abs)(Object(r.sub)(t,e)),-1)}))}function Ft(e,t){return Object(r.tidy)((function(){var n=Object(r.sub)(e,t),i=Object(r.clipByValue)(Object(r.abs)(e),l(),Number.MAX_VALUE),a=Object(r.abs)(Object(r.div)(n,i));return Object(r.mul)(100,Object(r.mean)(a,-1))}))}function It(e,t,n){return void 0===n&&(n=!1),Object(r.tidy)((function(){if(n)t=Object(r.softmax)(t);else{var i=Object(r.sum)(t,t.shape.length-1,!0);t=Object(r.div)(t,i)}return t=Object(r.clipByValue)(t,l(),1-l()),Object(r.neg)(Object(r.sum)(Object(r.mul)(e.toFloat(),Object(r.log)(t)),t.shape.length-1))}))}function Nt(e,t){return Object(r.tidy)((function(){var n=Object(r.floor)(function(e){var t=[oe(e.shape)];return e.reshape(t)}(e)).toInt(),i=(t=Object(r.clipByValue)(t,l(),1-l())).shape;return It(Object(r.oneHot)(n,i[i.length-1]).reshape(i),t,!1)}))}function Rt(e,t){return Object(r.tidy)((function(){var n;return n=Object(r.clipByValue)(t,l(),1-l()),n=Object(r.log)(Object(r.div)(n,Object(r.sub)(1,n))),Object(r.mean)(function(e,t){if(!r.util.arraysEqual(e.shape,t.shape))throw new h("logits and labels must have the same shape, but got shapes "+JSON.stringify(e.shape)+" and "+JSON.stringify(t.shape));return Object(r.tidy)((function(){var n=t.relu(),r=t.abs().neg();return n.sub(t.mul(e)).add(r.exp().log1p())}))}(e,n),-1)}))}function Pt(e,t){return Object(r.tidy)((function(){var n=Tt(e,-1),i=Tt(t,-1),a=Object(r.mul)(n,i);return Object(r.neg)(Object(r.sum)(a,-1))}))}var Bt={meanSquaredError:jt,meanAbsoluteError:Mt,meanAbsolutePercentageError:Ft,meanSquaredLogarithmicError:function(e,t){return Object(r.tidy)((function(){var n=Object(r.clipByValue)(t,l(),Number.MAX_VALUE),i=Object(r.log)(Object(r.add)(1,n)),a=Object(r.clipByValue)(e,l(),Number.MAX_VALUE),o=Object(r.log)(Object(r.add)(1,a));return Object(r.mean)(_e(Object(r.sub)(i,o)),-1)}))},squaredHinge:function(e,t){return Object(r.tidy)((function(){var n=Object(r.maximum)(0,Object(r.sub)(1,Object(r.mul)(e,t)));return Object(r.mean)(_e(n),-1)}))},hinge:function(e,t){return Object(r.tidy)((function(){var n=Object(r.maximum)(0,Object(r.sub)(1,Object(r.mul)(e,t)));return Object(r.mean)(n,-1)}))},categoricalHinge:function(e,t){return Object(r.tidy)((function(){var n=Object(r.sum)(Object(r.mul)(e,t),-1),i=Object(r.max)(Object(r.mul)(Object(r.sub)(1,e),t),-1);return Object(r.maximum)(0,Object(r.add)(1,Object(r.sub)(i,n)))}))},logcosh:function(e,t){return Object(r.tidy)((function(){var n=Math.log(2),i=Object(r.sub)(t,e),a=Object(r.sub)(Object(r.add)(i,Object(r.softplus)(Object(r.mul)(-2,i))),n);return Object(r.mean)(a,-1)}))},categoricalCrossentropy:It,sparseCategoricalCrossentropy:Nt,binaryCrossentropy:Rt,kullbackLeiblerDivergence:function(e,t){return Object(r.tidy)((function(){var n=Object(r.clipByValue)(e,l(),1),i=Object(r.clipByValue)(t,l(),1);return Object(r.sum)(Object(r.mul)(e,Object(r.log)(Object(r.div)(n,i))),-1)}))},poisson:function(e,t){return Object(r.tidy)((function(){var n=Object(r.log)(Object(r.add)(l(),t));return Object(r.mean)(Object(r.sub)(t,Object(r.mul)(e,n)),-1)}))},cosineProximity:Pt};function Lt(e){if("string"==typeof e){if(e in Bt)return Bt[e];var t="Unknown loss "+e;throw e.toLowerCase().includes("softmaxcrossentropy")&&(t="Unknown loss "+e+'. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy'),new h(t)}return e}function zt(e,t){return Object(r.tidy)((function(){var n=Object(r.mul)(.5,Object(r.onesLike)(t)),i=fe(Object(r.greater)(t,n),e.dtype);return Object(r.mean)(Object(r.equal)(e,i),-1)}))}function Ut(e,t){return Object(r.tidy)((function(){return fe(Object(r.equal)(Object(r.argMax)(e,-1),Object(r.argMax)(t,-1)),"float32")}))}function Wt(e,t){return Object(r.tidy)((function(){return Object(r.logicalAnd)(e.equal(1),t.equal(1)).sum().cast("float32")}))}function Vt(e,t){return Object(r.tidy)((function(){var n=Wt(e,t),i=function(e,t){return Object(r.tidy)((function(){return Object(r.logicalAnd)(e.equal(0),t.equal(1)).sum().cast("float32")}))}(e,t),a=n.add(i);return Object(r.where)(Object(r.greater)(a,0),n.div(a),0).cast("float32")}))}function Gt(e,t){return Object(r.tidy)((function(){var n=Wt(e,t),i=function(e,t){return Object(r.tidy)((function(){return Object(r.logicalAnd)(e.equal(1),t.equal(0)).sum().cast("float32")}))}(e,t),a=n.add(i);return Object(r.where)(Object(r.greater)(a,0),n.div(a),0).cast("float32")}))}function qt(e,t){return Rt(e,t)}function Ht(e,t){return e.rank===t.rank&&(e=e.squeeze([e.rank-1])),(t=t.argMax(-1)).dtype!==e.dtype&&(t=t.asType(e.dtype)),Object(r.equal)(e,t).asType("float32")}var Xt=It,Kt=Nt,Yt={binaryAccuracy:zt,categoricalAccuracy:Ut,precision:Vt,categoricalCrossentropy:Xt,sparseCategoricalCrossentropy:Kt,mse:jt,MSE:jt,mae:Mt,MAE:Mt,mape:Ft,MAPE:Ft,cosine:Pt};function $t(e){if(g(null!==e,"Unknown LossOrMetricFn "+e),"string"==typeof e)return e;for(var t=void 0,n=0,r=Object.keys(Bt);n<r.length;n++){var i=r[n];if(Bt[i]===e){t=i;break}}if(void 0!==t)return t;for(var a=0,o=Object.keys(Yt);a<o.length;a++)if(i=o[a],Yt[i]===e){t=i;break}return void 0!==t?t:e.name}var Jt=1048576;function Zt(e,t,n){if(void 0===n&&(n=!1),null==e||"object"!=typeof e||Object.getPrototypeOf(e)!==Object.prototype||!function e(t){if(null===t)return!0;if("object"==typeof t){if(Object.getPrototypeOf(t)===Object.prototype){for(var n=0,r=Object.keys(t);n<r.length;n++){var i=r[n];if("string"!=typeof i)return!1;if(!e(t[i]))return!1}return!0}if(Array.isArray(t)){for(var a=0,o=t;a<o.length;a++)if(!e(o[a]))return!1;return!0}return!1}var s=typeof t;return"string"===s||"number"===s||"boolean"===s}(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){var r=JSON.stringify(e);r.length>Jt&&console.warn('User-defined metadata of model "'+t+'" is too large in size (length='+r.length+" when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= "+Jt+".")}}function Qt(e,t,n,r){void 0===r&&(r=console.log);var i,a=function(e){var t=!0,n=[],r=[];for(var i in e.nodesByDepth)n.push(e.nodesByDepth[i]);for(var a=0,o=n;a<o.length;a++){var s=o[a];if(s.length>1||1===s.length&&s[0].inboundLayers.length>1){t=!1;break}r.push.apply(r,s)}if(t)for(var u=0,c=e.layers;u<c.length;u++){for(var l=!1,f=0,d=c[u].inboundNodes;f<d.length;f++){var h=d[f];if(-1!==r.indexOf(h)){if(l){t=!1;break}l=!0}}if(!t)break}return t}(e),o=["Layer (type)","Output shape","Param #"];if(a?(t=t||65,n=n||[.45,.85,1]):(t=t||98,n=n||[.33,.55,.67,1]),n[n.length-1]<=1&&(n=n.map((function(e){return Math.floor(t*e)}))),!a)for(var s in o.push("Receives inputs"),i=[],e.nodesByDepth)i.push.apply(i,e.nodesByDepth[s]);r("_".repeat(t)),en(o,n,r),r("=".repeat(t));for(var u=e.layers,c=0;c<u.length;++c)a?tn(u[c],n,r):nn(u[c],n,i,r),r((c===u.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();var l=function(e){return null!=e.collectedTrainableWeights?it(e.collectedTrainableWeights):it(e.trainableWeights)}(e),f=it(e.nonTrainableWeights);r("Total params: "+(l+f)),r("Trainable params: "+l),r("Non-trainable params: "+f),r("_".repeat(t))}function en(e,t,n){void 0===n&&(n=console.log);for(var r="",i=0;i<e.length;++i)i>0&&(r=r.slice(0,r.length-1)+" "),r=(r+=e[i]).slice(0,t[i]),r+=" ".repeat(t[i]-r.length);n(r)}function tn(e,t,n){var r;try{r=JSON.stringify(e.outputShape)}catch(e){r="multiple"}en([e.name+" ("+e.getClassName()+")",r,e.countParams().toString()],t,n)}function nn(e,t,n,r){var i;try{i=JSON.stringify(e.outputShape)}catch(e){i="multiple"}for(var a=[],o=0,s=e.inboundNodes;o<s.length;o++){var u=s[o];if(!(null!=n&&n.length>0&&-1===n.indexOf(u)))for(var c=0;c<u.inboundLayers.length;++c){var l=u.inboundLayers[c].name,f=u.nodeIndices[c],d=u.tensorIndices[c];a.push(l+"["+f+"]["+d+"]")}}var h=e.name,p=e.getClassName(),m=0===a.length?"":a[0];for(en([h+" ("+p+")",i,e.countParams().toString(),m],t,r),c=1;c<a.length;++c)en(["","","",a[c]],t,r)}function rn(e,t,n){return("inboundNodes"===e||"outputLayers"===e||"inputLayers"===e)&&0===t&&"string"==typeof n}function an(e,t){if(null===e)return null;if("string"==typeof e)return _(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){for(var n=[],r=e.length,i=0;i<r;++i){var a=e[i];rn(t,i,a)?n.push(a):n.push(an(a,t))}return n}for(var o={},s=0,u=Object.keys(e);s<u.length;s++){var c=u[s],l=e[c];if("name"===c&&"string"==typeof l)o[c]=l;else{var f=_(c);o[f]=an(l,f)}}return o}var on=function(){function e(t){if(this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof e)for(var n in t.id2Value)this.id2Value[n]=t.id2Value[n],n in t.id2Mask&&(this.id2Mask[n]=t.id2Mask[n]);else{if(null==t)return;for(var r=0,i=t;r<i.length;r++){var a=i[r];this.add(a.key,a.value)}}}return e.prototype.add=function(e,t,n){if(null!=this.id2Value[e.id])throw new h("Duplicate key: name="+e.name+", id="+e.id);return this.id2Value[e.id]=function(e,t){if(null==e.dtype||e.dtype===t.dtype)return t;try{return Object(r.cast)(t,e.dtype)}catch(n){throw new h("The dtype of the feed ("+t.dtype+") can not be cast to the dtype of the key '"+e.name+"' ("+e.dtype+").")}}(e,t),this.name2Id[e.name]=e.id,null!=n&&(this.id2Mask[e.id]=n),this},e.prototype.addFeed=function(e){this.add(e.key,e.value)},e.prototype.hasKey=function(e){return null!=this.id2Value[e.id]},e.prototype.names=function(){return Object.keys(this.name2Id)},e.prototype.getValue=function(e){if(e instanceof ft){if(null==this.id2Value[e.id])throw new h("Nonexistent key: "+e.name);return this.id2Value[e.id]}var t=this.name2Id[e];if(null==t)throw new h("Feed dict has no SymbolicTensor name: "+e);return this.id2Value[t]},e.prototype.getMask=function(e){if(e instanceof ft){if(null==this.id2Value[e.id])throw new h("Nonexistent key: "+e.name);return this.id2Mask[e.id]}var t=this.name2Id[e];if(null==t)throw new h("Feed dict has no SymbolicTensor name: "+e);return this.id2Mask[t]},e.prototype.disposeMasks=function(){null!=this.id2Mask&&Object(r.dispose)(this.id2Mask)},e}(),sn={},un={};function cn(e,t,n,i){for(var a=null!=n&&n.training,o=Array.isArray(e),s=o?e:[e],u=s.map((function(e){return e.name})),c=[],l=t.names(),f=0,d=u;f<d.length;f++){var h=d[f];-1!==l.indexOf(h)?c.push(t.getValue(h)):c.push(null)}null!=i&&(i.maxNumTensors=-1/0,i.minNumTensors=1/0);var p,m,v=u.join(",")+"|"+t.names().join(",");if(null==sn[v]){var g=function(e,t){r.util.assert(null!=e&&e.length>0,(function(){return"Expected at least one fetch, got none"}));var n=[],i={};if(1===e.length){var a=ln(e[0],t);n=a.sorted,i=a.recipientMap}else for(var o=new Set,s=0,u=e;s<u.length;s++){for(var c=ln(u[s],t),l=c.sorted,f=c.recipientMap,d=0,h=l;d<h.length;d++){var p=h[d];o.has(p.name)||(n.push(p),o.add(p.name))}var m=function(e){null==i[e]&&(i[e]=new Set),f[e].forEach((function(t){return i[e].add(t)}))};for(var v in f)m(v)}return{sorted:n,recipientCounts:function(e){var t={};for(var n in e)t[n]=e[n].size;return t}(i)}}(s,t);p=g.sorted,m=g.recipientCounts,sn[v]=p,un[v]=m}p=sn[v],m={},a||Object.assign(m,un[v]);for(var y=new on(t),b=0;b<p.length;++b){if(null!=i){var w=Object(r.memory)().numTensors;w>i.maxNumTensors&&(i.maxNumTensors=w),w<i.minNumTensors&&(i.minNumTensors=w)}var _=p[b],k=_.sourceLayer;if(!(k instanceof vt)){for(var E=[],S=[],C=[],A=!1,O=0,D=_.inputs;O<D.length;O++){var T=D[O],j=y.getValue(T),M=y.getMask(T);E.push(j),S.push(M),null!=M&&(A=!0),a||(m[T.name]--,0!==m[T.name]||t.hasKey(T)||-1!==u.indexOf(T.name)||j.isDisposed||!0===T.sourceLayer.stateful||C.push(j))}A&&((n=n||{}).mask=S[0]);var F=x(k.apply(E,n)),I=null;k.supportsMasking&&(I=k.computeMask(E,S));for(var N=fn(_),R=Array.isArray(N)?N:[N],P=0;P<R.length;++P){y.hasKey(R[P])||y.add(R[P],F[P],Array.isArray(I)?I[0]:I);var B=u.indexOf(R[P].name);-1!==B&&(c[B]=F[P])}a||Object(r.dispose)(C)}}return y.disposeMasks(),o?c:c[0]}function ln(e,t){for(var n=new Set,r=[],i={},a=0,o=t.names();a<o.length;a++){var s=o[a];n.add(s)}var u=[],c=[];for(u.push(e);u.length>0;){var l=u[u.length-1];if(n.has(l.name))u.pop();else{var f=c[c.length-1]===u.length-1;if(0===l.inputs.length||f)u.pop(),r.push(l),n.add(l.name),f&&c.pop();else{c.push(u.length-1);for(var d=0,h=l.inputs;d<h.length;d++){var p=h[d];null==i[p.name]&&(i[p.name]=new Set),i[p.name].add(l.name),n.has(p.name)||u.push(p)}}}}return{sorted:r,recipientMap:i}}function fn(e){var t;if(1===e.sourceLayer.inboundNodes.length)t=e.sourceLayer.output;else{for(var n=null,r=0;r<e.sourceLayer.inboundNodes.length;++r)for(var i=0,a=e.sourceLayer.inboundNodes[r].outputTensors;i<a.length;i++)if(a[i].id===e.id){n=r;break}t=e.sourceLayer.getOutputAt(n)}return t}function dn(e,t){return function(e,t,n){var r=t.length;if(null==e||Array.isArray(e)&&0===e.length)return t.map((function(e){return null}));if(1===r)return Array.isArray(e)&&1===e.length?e:"object"==typeof e&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==r)throw new Error("Provided "+n+" is an array of "+e.length+" element(s), but the model has "+r+" outputs. Make sure a set of weights is provided for each model output.");return e}if("object"==typeof e&&Object.keys(e).length>0&&"object"==typeof e[Object.keys(e)[0]]){var i=[];return t.forEach((function(t){t in e?i.push(e[t]):i.push(null)})),i}throw new Error("The model has multiple ("+r+") outputs, so "+n+" must be either an array with "+r+" elements or an object with "+t+" keys. Provided "+n+" not understood: "+JSON.stringify(e))}(e,t,"classWeight")}function hn(e,t,n,i){return u(this,void 0,void 0,(function(){var a,o,s,u,l;return c(this,(function(c){switch(c.label){case 0:if(null!=t||null!=i)throw new Error("Support sampleWeight is not implemented yet");return null==n?[3,2]:(a=Object(r.tidy)((function(){if(1===e.shape.length)return e.clone();if(2===e.shape.length){if(e.shape[1]>1)return e.argMax(1);if(1===e.shape[1])return e.reshape([e.shape[0]]);throw new Error("Encountered unexpected last-dimension size ("+e.shape[1]+") during handling of class weights. The size is expected to be >= 1.")}throw new Error("Unexpected rank of target (y) tensor ("+e.rank+") during handling of class weights. The rank is expected to be 1 or 2.")})),u=(s=Array).from,[4,a.data()]);case 1:return o=u.apply(s,[c.sent()]),Object(r.dispose)(a),l=[],o.forEach((function(e){if(null==n[e])throw new Error("classWeight must contain all classes in the training data. The class "+e+" exists in the data but not in classWeight");l.push(n[e])})),[2,Object(r.tensor1d)(l,"float32")];case 2:return[2,null]}}))}))}function pn(e,t){return Object(r.mul)(e,t)}var mn=32;function vn(e,t){var n,i,a=t;n=a.xs,i=a.ys,r.util.assert(null!=n&&null!=i,(function(){return"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+t}));var o=gn("input",e.inputNames,n),s=gn("output",e.outputNames,i),u=o[0].shape[0];r.util.assert(o.length===e.inputs.length,(function(){return"LayersModel has "+e.inputs.length+" inputs, but the dataset provides "+o.length+" inputs.  (Expected input keys: "+JSON.stringify(e.inputNames)+")"})),r.util.assert(s.length===e.outputs.length,(function(){return"LayersModel has "+e.outputs.length+" outputs, but the dataset provides "+s.length+" outputs.  (Expected output keys: "+JSON.stringify(e.outputNames)+")"}));for(var c=function(t){r.util.assert(o[t].shape[0]===u,(function(){return"Batch size mismatch: input "+e.inputNames[t]+" has "+o[t].shape[0]+"; expected  "+u+" based on input "+e.inputNames[0]+"."}))},l=0;l<o.length;l++)c(l);for(var f=function(t){r.util.assert(s[t].shape[0]===u,(function(){return"Batch size mismatch: output "+e.outputNames[t]+" has "+s[t].shape[0]+"; expected  "+u+" based on input "+e.inputNames[0]+"."}))},d=0;d<s.length;d++)f(d);return{xs:o,ys:s}}function gn(e,t,n){if(n instanceof r.Tensor)return[n];if(Array.isArray(n))return r.util.assert(n.length===t.length,(function(){return"Received an array of "+n.length+" Tensors, but expected "+t.length+" to match the "+e+" keys "+t+"."})),n;for(var i=[],a=0,o=t;a<o.length;a++){var s=o[a];if(null==n[s])throw new h("The feature data generated by the dataset lacks the required "+e+" key '"+s+"'.");i.push(n[s])}return i}function yn(e,t,n){return u(this,void 0,void 0,(function(){var i,a,o,s,u,l,f,d,h,m,v,g,y,b,w,_,k,E,S,C,A,O,D,T,j,M,F,I,N,R,P,B,L,z;return c(this,(function(c){switch(c.label){case 0:if(i=null!=n.batchesPerEpoch,r.util.assert(null!=e.optimizer,(function(){return"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."})),r.util.assert(null!=n,(function(){return"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."})),r.util.assert(null!=n.epochs&&n.epochs>0&&Number.isInteger(n.epochs),(function(){return"For fitDataset(), config.epochs is expected to be a positive integer, but got "+n.epochs})),r.util.assert(!i||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),(function(){return"For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got "+n.batchesPerEpoch})),r.util.assert(null==n.validationSplit,(function(){return"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."})),e.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");e.isTraining=!0,c.label=1;case 1:return c.trys.push([1,,26,27]),a=null!=n.validationData,o=void 0,s=void 0,a&&(bn(n.validationData)?r.util.assert(null==n.validationBatches||n.validationBatches>0&&Number.isInteger(n.validationBatches),(function(){return"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got "+n.validationBatches})):(u=function(e){if(3===e.length)throw new p("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}(n.validationData),o=u.xs,s=u.ys)),l=e.makeTrainFunction(),f=e.getDedupedMetricsNames(),d=void 0,d=a?f.slice().concat(f.map((function(e){return"val_"+e}))):f.slice(),h=Ct(n.callbacks,n.yieldEvery),m=null==n.verbose?1:n.verbose,v=Ot(h,m,n.epochs,null,null,function(e,t){var n=null;return null!=t.batchesPerEpoch?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size),n}(t,n),null,a,d),g=v.callbackList,y=v.history,g.setModel(e),e.history=y,[4,g.onTrainBegin()];case 2:return c.sent(),e.stopTraining_=!1,b=null==n.initialEpoch?0:n.initialEpoch,[4,t.iterator()];case 3:w=c.sent(),c.label=4;case 4:return b<n.epochs?(_={},[4,g.onEpochBegin(b)]):[3,23];case 5:return c.sent(),k=0,E=0,i?[3,7]:[4,t.iterator()];case 6:w=c.sent(),c.label=7;case 7:return!i||k<n.batchesPerEpoch?[4,w.next()]:[3,21];case 8:return S=c.sent(),i&&S.done?(console.warn("You provided `batchesPerEpoch` as "+n.batchesPerEpoch+", but your dataset iterator ran out of data after "+k+" batches; interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+n.batchesPerEpoch*n.epochs+" batches). You may need to use the repeat() function when building your dataset."),[3,21]):null==S.value?[3,15]:(C=vn(e,S.value),A=C.xs,O=C.ys,(D={}).batch=E,D.size=A[0].shape[0],[4,g.onBatchBegin(E,D)]);case 9:if(c.sent(),T=[],null==n.classWeight)return[3,13];j=dn(n.classWeight,e.outputNames),z=0,c.label=10;case 10:return z<j.length?(F=(M=T).push,[4,hn(O[z],null,j[z])]):[3,13];case 11:F.apply(M,[c.sent()]),c.label=12;case 12:return++z,[3,10];case 13:for(I=A.concat(O).concat(T),N=l(I),Object(r.dispose)(I),z=0;z<f.length;++z)R=f[z],P=N[z],D[R]=P,Object(r.keep)(P);return[4,g.onBatchEnd(E,D)];case 14:c.sent(),bt(D),E++,k++,c.label=15;case 15:return(i?k>=n.batchesPerEpoch:S.done)?a?(B=void 0,bn(n.validationData)?(L=x,[4,e.evaluateDataset(n.validationData,{batches:n.validationBatches})]):[3,17]):[3,19]:[3,20];case 16:return B=L.apply(void 0,[c.sent()]),[3,18];case 17:B=x(e.evaluate(o,s,{batchSize:null==n.validationBatchSize?mn:n.validationBatchSize,verbose:0})),c.label=18;case 18:for(z=0;z<e.metricsNames.length;++z)_["val_"+e.metricsNames[z]]=B[z];c.label=19;case 19:return[3,21];case 20:return e.stopTraining_?[3,21]:[3,7];case 21:return[4,g.onEpochEnd(b,_)];case 22:return c.sent(),b++,e.stopTraining_?[3,23]:[3,4];case 23:return[4,g.onTrainEnd()];case 24:return c.sent(),[4,e.history.syncData()];case 25:return c.sent(),[2,e.history];case 26:return e.isTraining=!1,[7];case 27:return[2]}}))}))}function bn(e){return"function"==typeof e.iterator}function xn(e){r.util.assert(e>0&&Number.isInteger(e),(function(){return"batchSize is required to be a positive integer, but got "+e}))}function wn(e,t,n){return null==e?[null]:Array.isArray(e)?e.map((function(e){return he(e,t,n-t)})):he(e,t,n-t)}function _n(e,t){return Object(r.tidy)((function(){return null==e?null:Array.isArray(e)?e.map((function(e){return _n(e,t)})):we(e,"int32"===t.dtype?t:t.toInt())}))}function kn(e,t){for(var n=[],r=0,i=null;r<e;)(i=r+t)>=e&&(i=e),n.push([r,i]),r=i;return n}function En(e,t,n,i){return void 0===i&&(i={}),u(this,void 0,void 0,(function(){var a,o,s,l,f,d,m,v,g,y,b,x,w,_,k,E,S,C,A,O,D,T;return c(this,(function(j){switch(j.label){case 0:if(e.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");e.isTraining=!0,j.label=1;case 1:return j.trys.push([1,,7,8]),xn(v=null==i.batchSize?32:i.batchSize),g=!1,[4,e.standardizeUserData(t,n,i.sampleWeight,i.classWeight,g,v)];case 2:if(y=j.sent(),a=y[0],o=y[1],m=y[2],b=!1,x=void 0,!(null!=i.validationData&&i.validationData.length>0))return[3,4];if(b=!0,2!==i.validationData.length)throw 3===i.validationData.length?new p("validationData including sample weights is not supported yet."):new h("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+i.validationData+" is invalid.");return s=i.validationData[0],l=i.validationData[1],w=!0,[4,e.standardizeUserData(s,l,null,null,w,v)];case 3:return _=j.sent(),f=_[0],d=_[1],x=f.concat(d),[3,5];case 4:null!=i.validationSplit&&i.validationSplit>0&&i.validationSplit<1?(b=!0,k=Math.floor(a[0].shape[0]*(1-i.validationSplit)),E=a[0].shape[0],f=wn(a,k,E),a=wn(a,0,k),d=wn(o,k,E),o=wn(o,0,k),x=f.concat(d)):null!=i.validationSteps&&(b=!0),j.label=5;case 5:return S=a.concat(o).concat(m),e.checkTrainableWeightsConsistency(),C=e.makeTrainFunction(),A=e.getDedupedMetricsNames(),O=void 0,D=void 0,b?(e.makeTestFunction(),O=e.testFunction,D=A.slice().concat(A.map((function(e){return"val_"+e})))):(O=null,x=[],D=A.slice()),T=Ct(i.callbacks,i.yieldEvery),[4,function(e,t,n,i,a,o,s,l,f,d,m,v,g,y,b){return u(this,void 0,void 0,(function(){var u,x,w,_,k,E,S,C;return c(this,(function(A){switch(A.label){case 0:if(null==a&&(a=32),null==o&&(o=1),null==m&&(m=!0),null==g&&(g=0),u=!1,null!=f&&null!=d&&(u=!0),null!=b&&(u=!0,null==y))throw new h("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");return null!=(x=e.checkNumSamples(n,a,y,"steps_per_epoch"))&&(w=le(0,x)),null==s&&(s=1),_=Ot(l,s,o,g,x,y,a,u,v),k=_.callbackList,E=_.history,k.setModel(e),e.history=E,[4,k.onTrainBegin()];case 1:A.sent(),e.stopTraining_=!1,S=function(o){var s,l,h,v,g;return c(this,(function(b){switch(b.label){case 0:return[4,k.onEpochBegin(o)];case 1:if(b.sent(),s={},null==y)return[3,2];throw new p("stepsPerEpoch mode is not implemented yet.");case 2:if("batch"===m)throw new p("batch shuffling is not implemneted yet");m&&r.util.shuffle(w),l=Object(r.tensor1d)(w),h=kn(x,a),v=function(o){var p;return c(this,(function(c){switch(c.label){case 0:return p={},[4,k.onBatchBegin(o,p)];case 1:return c.sent(),Object(r.tidy)((function(){var c=h[o][0],m=h[o][1],v=he(l,c,m-c);p.batch=o,p.size=m-c;for(var g=_n(n,v),y=t(g),b=0;b<i.length;++b){var x=i[b],w=y[b];p[x]=w,Object(r.keep)(w)}if(o===h.length-1&&u){var _=e.testLoop(f,d,a);for(b=0;b<i.length;++b)x=i[b],w=_[b],Object(r.keep)(w),s["val_"+x]=w}})),[4,k.onBatchEnd(o,p)];case 2:return c.sent(),bt(p),e.stopTraining_?[2,"break"]:[2]}}))},g=0,b.label=3;case 3:return g<h.length?[5,v(g)]:[3,6];case 4:if("break"===b.sent())return[3,6];b.label=5;case 5:return++g,[3,3];case 6:l.dispose(),b.label=7;case 7:return[4,k.onEpochEnd(o,s)];case 8:return b.sent(),e.stopTraining_?[2,"break"]:[2]}}))},C=g,A.label=2;case 2:return C<o?[5,S(C)]:[3,5];case 3:if("break"===A.sent())return[3,5];A.label=4;case 4:return++C,[3,2];case 5:return[4,k.onTrainEnd()];case 6:return A.sent(),[4,e.history.syncData()];case 7:return A.sent(),[2,e.history]}}))}))}(e,C,S,A,v,i.epochs,i.verbose,T,O,x,i.shuffle,D,i.initialEpoch,null,null)];case 6:return[2,j.sent()];case 7:return e.isTraining=!1,Cn(a,t),Cn(o,n),Cn(f,s),Cn(d,l),null!=m&&Object(r.dispose)(m),[7];case 8:return[2]}}))}))}function Sn(e){var t=[];e instanceof r.Tensor&&(e=[e]);for(var n=0;n<e.length;++n){var i=e[n];if(1===i.rank)t.push(de(i,1));else{if(0===i.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(i)}}return t}function Cn(e,t){if(null!=e){var n=[];if(t instanceof r.Tensor)n.push(t.id);else if(Array.isArray(t))t.forEach((function(e){return n.push(e.id)}));else if(null!=t)for(var i in t){var a=t[i];n.push(a.id)}var o=[];if(e instanceof r.Tensor)-1===n.indexOf(e.id)&&o.push(e);else if(Array.isArray(e))e.forEach((function(e){-1===n.indexOf(e.id)&&o.push(e)}));else if(null!=e)for(var s in e){var u=e[s];-1===n.indexOf(u.id)&&o.push(u)}o.forEach((function(e){e.isDisposed||e.dispose()}))}}function An(e){return Array.isArray(e)}function On(e){return!function(e){return e instanceof r.Tensor}(e)&&!An(e)}function Dn(e,t,n,r,i){if(void 0===r&&(r=!0),void 0===i&&(i=""),null==t||0===t.length){if(null!=e){var a=!1;if(An(e)&&e.length>0)a=!0;else if(On(e)){for(var o in e)if(e.hasOwnProperty(o)){a=!0;break}}else a=!0;if(a)throw new h("Error when checking model "+i+" expected no data, but got "+e)}return[]}if(null==e)return t.map((function(e){return null}));var s;if(On(e)){s=[];for(var u=0,c=t;u<c.length;u++){var l=c[u];if(null==e[l])throw new h('No data provided for "'+l+'". Need data for each key in: '+t);s.push(e[l])}}else if(An(e)){if(e.length!==t.length)throw new h("Error when checking model "+i+": the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see "+t.length+" Tensor(s), but instead got the following list of Tensor(s): "+e);s=e}else{if(t.length>1)throw new h("The model "+i+" expects "+t.length+" Tensor(s), but only received one Tensor. Found: Tensor with shape "+e.shape);s=[e]}if(s=Sn(s),null!=n)for(var f=0;f<t.length;++f)if(null!=n[f]){var d=s[f];if(d.shape.length!==n[f].length)throw new h("Error when checking "+i+": expected "+t[f]+" to have "+n[f].length+" dimension(s). but got array with shape "+d.shape);for(var p=0;p<n[f].length;++p)if(0!==p||r){var m=d.shape[p],v=n[f][p];if(null!=v&&v>=0&&m!==v)throw new h("Error when checking "+i+": expected "+t[f]+" to have shape ["+n[f]+"], but got array with shape ["+d.shape+"].")}}return s}function Tn(e,t,n,r,i){var a;if(void 0===r&&(r=!0),void 0===i&&(i=""),Array.isArray(e)){if(e.length!==t.length)throw new h("Error when checking model "+i+": the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see "+t.length+" Tensor(s), but instead got "+e.length+" Tensors(s).");a=e}else{if(t.length>1)throw new h("The model expects "+t.length+" "+i+" Tensors, but only received one Tensor. Found: array with shape "+JSON.stringify(e.shape)+".");a=[e]}if(null!=n)for(var o=0;o<t.length;++o)if(null!=n[o]){var s=a[o];if(s.shape.length!==n[o].length)throw new h("Error when checking "+i+": expected "+t[o]+" to have "+n[o].length+" dimension(s), but got array with shape "+JSON.stringify(s.shape));for(var u=0;u<n[o].length;++u)if(0!==u||r){var c=s.shape[u],l=n[o][u];if(null!=l&&l!==c)throw new h("Error when checking "+i+": expected "+t[o]+" to have shape "+JSON.stringify(n[o])+" but got array with shape "+JSON.stringify(s.shape)+".")}}}var jn=function(e){function t(t){var n=e.call(this,t)||this;return n.isTraining=!1,n}return a(t,e),t.prototype.summary=function(e,t,n){if(void 0===n&&(n=console.log),!this.built)throw new h("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");Qt(this,e,t,n)},t.prototype.compile=function(e){var t=this;if(null==e.loss&&(e.loss=[]),this.loss=e.loss,"string"==typeof e.optimizer)this.optimizer_=function(e){var t={Adagrad:function(){return r.train.adagrad(.01)},Adadelta:function(){return r.train.adadelta(1,.95,l())},Adam:function(){return r.train.adam(.001,.9,.999,l())},Adamax:function(){return r.train.adamax(.002,.9,.999,l(),0)},RMSProp:function(){return r.train.rmsprop(.001,.9,0,l())},SGD:function(){return r.train.sgd(.01)}};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new h("Unknown Optimizer "+e)}(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof r.Optimizer))throw new h("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}var n=[];if(Array.isArray(e.loss)||"string"==typeof e.loss||"function"==typeof e.loss)if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new h("When passing an Array as loss, it should have one entry per model output. The model has "+this.outputs.length+" output(s), but you passed loss="+e.loss+".");var i=e.loss;n=i.map((function(e){return Lt(e)}))}else{var a=Lt(e.loss);this.outputs.forEach((function(e){n.push(a)}))}else{for(var o in e.loss=e.loss,e.loss)if(-1===this.outputNames.indexOf(o))throw new h('Unknown entry in loss dictionary: "'+o+'". Only expected the following keys: '+this.outputNames);for(var s=0,u=this.outputNames;s<u.length;s++){var c=u[s];null==e.loss[c]&&console.warn('Output "'+c+'" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to '+c+" during training"),n.push(Lt(e.loss[c]))}}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var f=0;f<this.outputs.length;++f){var d=this.internalOutputShapes[f],p=this.outputNames[f];this.feedOutputNames.push(p),this.feedOutputShapes.push(d),this.feedLossFns.push(this.lossFunctions[f])}var m=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],ee("loss",(function(){for(var e=0;e<t.outputs.length;++e)if(-1===m.indexOf(e)){var n=t.lossFunctions[e];t.outputs.length>1&&(t.metricsTensors.push([n,e]),t.metricsNames.push(t.outputNames[e]+"_loss"))}}));var v=function(e,t){if(null==e||Array.isArray(e)&&0===e.length)return t.map((function(e){return[]}));var n;if("string"==typeof e||"function"==typeof e)n=[e];else{if(!Array.isArray(e)&&"object"!=typeof e)throw new TypeError("Type of metrics argument not understood. Expected an string,function, Array, or Object, found: "+e);n=e}if(Array.isArray(n))return t.map((function(e){return n}));for(var r=[],i=0,a=t;i<a.length;i++){var o=a[i],s=n.hasOwnProperty(o)?n[o]:[];Array.isArray(s)||(s=[s]),r.push(s)}return r}(e.metrics,this.outputNames);ee("metric",(function(){for(var e=function(e){if(-1!==m.indexOf(e))return"continue";!function(n){for(var r,i,a,o=function(n){if("string"==typeof n&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(n)){var o=t.internalOutputShapes[e];1===o[o.length-1]||t.lossFunctions[e]===Rt?-1!==["accuracy","acc"].indexOf(n)?i=zt:-1!==["crossentropy","ce"].indexOf(n)&&(i=qt):t.lossFunctions[e]===Nt?-1!==["accuracy","acc"].indexOf(n)?i=Ht:-1!==["crossentropy","ce"].indexOf(n)&&(i=Kt):-1!==["accuracy","acc"].indexOf(n)?i=Ut:-1!==["crossentropy","ce"].indexOf(n)&&(i=Xt);var s=void 0;-1!==["accuracy","acc"].indexOf(n)?s="acc":-1!==["crossentropy","ce"].indexOf(n)&&(s="ce"),a=i,r=""+s}else{var u=function(e){if("string"==typeof e&&e in Yt)return Yt[e];if("string"!=typeof e&&null!=e)return e;throw new h("Unknown metric "+e)}(n);a=u,r=""+$t(n)}var c;ee(r,(function(){c=a})),function(e,n,r){t.outputNames.length>1&&(n=t.outputNames[e]+"_"+n),t.metricsNames.push(n),t.metricsTensors.push([r,e])}(e,r,c)},s=0,u=v[e];s<u.length;s++)o(u[s])}()},n=0;n<t.outputs.length;++n)e(n)})),this.collectedTrainableWeights=this.trainableWeights},t.prototype.checkTrainableWeightsConsistency=function(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")},t.prototype.evaluate=function(e,t,n){void 0===n&&(n={});var r=null==n.batchSize?32:n.batchSize;xn(r);var i=this.standardizeUserDataXY(e,t,!0,r);try{var a=i[0].concat(i[1]);this.makeTestFunction();var o=this.testFunction;return b(this.testLoop(o,a,r,n.verbose,n.steps))}finally{Cn(i[0],e),Cn(i[1],t)}},t.prototype.evaluateDataset=function(e,t){return u(this,void 0,void 0,(function(){return c(this,(function(n){return this.makeTestFunction(),[2,function(e,t,n){return u(this,void 0,void 0,(function(){var i,a,o,s,u,l,f,d,h,m;return c(this,(function(v){switch(v.label){case 0:if(i=null!=(n=n||{}).batches,a=e.testFunction,o=[],n.verbose>0)throw new p("Verbose mode is not implemented yet.");return r.util.assert(!i||n.batches>0&&Number.isInteger(n.batches),(function(){return"Test loop expects `batches` to be a positive integer, but received "+JSON.stringify(n.batches)})),function(e){return"function"==typeof e.next}(t)?(u=t,[3,3]):[3,1];case 1:return[4,t.iterator()];case 2:u=v.sent(),v.label=3;case 3:s=u,l=0,f=0,d=function(){var t;return c(this,(function(u){switch(u.label){case 0:return[4,s.next()];case 1:return t=u.sent(),o=Object(r.tidy)((function(){if(t.value){var n=vn(e,t.value),i=n.xs,s=n.ys,u=i.concat(s),c=Object(r.tidy)((function(){return a(u)}));if(Object(r.dispose)(u),0===f)for(var d=0;d<c.length;++d)o.push(Object(r.scalar)(0));var h=u[0].shape[0],p=function(e){var t=c[e],n=o[e];o[e]=Object(r.tidy)((function(){return Object(r.add)(o[e],Object(r.mul)(h,t))})),f>0&&Object(r.dispose)(n)};for(d=0;d<c.length;++d)p(d);Object(r.dispose)(c),l+=h,++f}return o})),t.done?(i&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` batches (in this case, "+n.batches+" batches). You may need to use the repeat() function when building your dataset."),[2,"break"]):[2]}}))},v.label=4;case 4:return!i||f<n.batches?[5,d()]:[3,6];case 5:return"break"===v.sent()?[3,6]:[3,4];case 6:for(h=0;h<o.length;++h)m=o[h],o[h]=Object(r.div)(o[h],l),Object(r.dispose)(m);return[2,b(o)]}}))}))}(this,e,t)]}))}))},t.prototype.checkNumSamples=function(e,t,n,r){var i;if(void 0===r&&(r="steps"),null!=n){if(i=null,null!=t)throw new h("If "+r+" is set, batchSize must be null or undefined.Got batchSize = "+t)}else{if(null==e)throw new h("Either the input data should have a defined shape, or "+r+" shoud be specified.");i=Array.isArray(e)?e[0].shape[0]:e.shape[0]}return i},t.prototype.execute=function(e,t){if(Array.isArray(t)&&0===t.length)throw new h("`outputs` is an empty Array, which is not allowed.");var n=Array.isArray(t),i=n?t:[t],a=this.retrieveSymbolicTensors(i),o=new on;if(e instanceof r.Tensor&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new h("The number of inputs provided ("+e.length+") does not match the number of inputs of this model ("+this.inputs.length+").");for(var s=0;s<this.inputs.length;++s)o.add(this.inputs[s],e[s])}else for(var u=0,c=this.inputs;u<c.length;u++){var l=c[u],f=e[l.name];if(null==f)throw new h("No value is provided for the model's input "+l.name);o.add(l,f)}var d=cn(a,o);return n?d:d[0]},t.prototype.retrieveSymbolicTensors=function(e){for(var t=v(null,e.length),n=e.length,r=0,i=this.layers;r<i.length;r++){for(var a=i[r],o=Array.isArray(a.output)?a.output:[a.output],s=o.map((function(e){return e.name})),u=0;u<e.length;++u){var c=s.indexOf(e[u]);if(-1!==c&&(t[u]=o[c],n--),0===n)break}if(0===n)break}if(n>0){var l=[];throw t.forEach((function(t,n){null==t&&l.push(e[n])})),new h("Cannot find SymbolicTensors for output name(s): "+JSON.stringify(l))}return t},t.prototype.predictLoop=function(e,t,n){var i=this;return void 0===t&&(t=32),void 0===n&&(n=!1),Object(r.tidy)((function(){var a=i.checkNumSamples(e);if(n)throw new p("Verbose predictLoop() is not implemented yet.");for(var o=kn(a,t),s=i.outputs.map((function(e){return[]})),u=function(t){Object(r.tidy)((function(){var n=o[t][0],r=o[t][1],a=wn(e,n,r),s=[];if(Array.isArray(a))for(var u=0;u<a.length;++u)s.push({key:i.inputs[u],value:a[u]});else s.push({key:i.inputs[0],value:a});var c=new on(s);return cn(i.outputs,c)})).forEach((function(e,t){return s[t].push(e)}))},c=0;c<o.length;++c)u(c);return b(s.map((function(e){return Object(r.concat)(e,0)})))}))},t.prototype.predict=function(e,t){void 0===t&&(t={});var n=Sn(e);Tn(n,this.inputNames,this.feedInputShapes,!1);try{var r=null==t.batchSize?32:t.batchSize;return xn(r),this.predictLoop(n,r)}finally{Cn(n,e)}},t.prototype.predictOnBatch=function(e){Tn(e,this.inputNames,this.feedInputShapes,!0);var t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)},t.prototype.standardizeUserDataXY=function(e,t,n,i){if(void 0===n&&(n=!0),null==this.optimizer_)throw new d("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");for(var a=[],o=0;o<this.feedOutputShapes.length;++o){var s=this.feedOutputShapes[o];this.feedLossFns[o]===Nt?a.push(s.slice(0,s.length-1).concat([1])):a.push(s)}if(function(e,t,n){var i=A(e.map((function(e){return e.shape[0]})));i.sort();var a=A(t.map((function(e){return e.shape[0]})));if(a.sort(),i.length>1)throw new h("All input Tensors (x) should have the same number of samples. Got array shapes: "+JSON.stringify(e.map((function(e){return e.shape}))));if(a.length>1)throw new h("All target Tensors (y) should have the same number of samples. Got array shapes: "+JSON.stringify(t.map((function(e){return e.shape}))));if(i.length>0&&a.length>0&&!r.util.arraysEqual(i,a))throw new h("Input Tensors should have the same number of samples as target Tensors. Found "+i[0]+" input sample(s) and "+a[0]+" target sample(s).")}(e=Dn(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=Dn(t,this.feedOutputNames,a,!1,"target")),function(e,t,n){for(var r=[jt,Rt,It],i=0;i<e.length;++i){var a=e[i],o=t[i],s=n[i];if(null!=o){if(o===It&&1===a.shape[a.shape.length-1])throw new h("You are passing a target array of shape "+a.shape+" while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(-1!==r.indexOf(o))for(var u=a.shape.slice(1),c=s.slice(1),l=0;l<u.length;++l){var f=u[l],d=c[l];if(null!=d&&f!==d)throw new h("A target Tensor with shape "+a.shape+" was passed for an output of shape "+s+", while using a loss function that expects targets to have the same shape as the output.")}}}}(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=i&&i>0&&e[0].shape[0]%i!=0)throw new h("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+i+". Found: "+e[0].shape[0]+" sample(s).");return[e,t]},t.prototype.standardizeUserData=function(e,t,n,r,i,a){return void 0===i&&(i=!0),u(this,void 0,void 0,(function(){var o,s,u,l,f,d,h,p;return c(this,(function(c){switch(c.label){case 0:if(o=this.standardizeUserDataXY(e,t,i,a),s=o[0],u=o[1],null!=n)throw new Error("sample weight is not supported yet.");if(l=null,null==r)return[3,4];f=dn(r,this.outputNames),l=[],d=0,c.label=1;case 1:return d<f.length?(p=(h=l).push,[4,hn(u[d],null,f[d])]):[3,4];case 2:p.apply(h,[c.sent()]),c.label=3;case 3:return++d,[3,1];case 4:return[2,[s,u,l]]}}))}))},t.prototype.testLoop=function(e,t,n,i,a){var o=this;return void 0===i&&(i=0),Object(r.tidy)((function(){var s=o.checkNumSamples(t,n,a,"steps"),u=[];if(i>0)throw new p("Verbose mode is not implemented yet.");if(null!=a)throw new p("steps mode in testLoop() is not implemented yet");for(var c=kn(s,n),l=Object(r.tensor1d)(le(0,s)),f=0;f<c.length;++f){var d=c[f][0],h=c[f][1],m=he(l,d,h-d),v=_n(t,m),g=e(v);if(0===f)for(var y=0;y<g.length;++y)u.push(Object(r.scalar)(0));for(y=0;y<g.length;++y){var b=g[y];u[y]=Object(r.add)(u[y],Object(r.mul)(h-d,b))}}for(y=0;y<u.length;++y)u[y]=Object(r.div)(u[y],s);return u}))},t.prototype.getDedupedMetricsNames=function(){for(var e=this.metricsNames,t=[],n=0;n<e.length;++n){var r=e[n],i=r;y(e,r)>1&&(i+="_"+y(e.slice(0,n),r)),t.push(i)}return t},t.prototype.makeTrainFunction=function(){var e=this;return function(t){var n=[],i=t.slice(0,e.inputs.length),a=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),o=t.slice(e.inputs.length+e.outputs.length,e.inputs.length+2*e.outputs.length),s=[],u=e.collectedTrainableWeights.map((function(e){return e.read()}));return[e.optimizer_.minimize((function(){for(var t=[],u=0;u<e.inputs.length;++u)t.push({key:e.inputs[u],value:i[u]});var c,l=new on(t),f=cn(e.outputs,l,{training:!0});for(u=0;u<e.lossFunctions.length;++u){var d=(0,e.lossFunctions[u])(a[u],f[u]);null!=o[u]&&(d=pn(d,o[u]));var h=Object(r.mean)(d);n.push(h),c=0===u?d:Object(r.add)(c,d)}for(u=0;u<e.metricsTensors.length;++u){var p=void 0;if(e.outputs.length>1&&u<e.outputs.length)p=n[u];else{var m=e.metricsTensors[u][0],v=e.metricsTensors[u][1];p=Object(r.mean)(m(a[v],f[v]))}Object(r.keep)(p),s.push(p)}return c=Object(r.mean)(c),e.calculateLosses().forEach((function(e){c=Object(r.add)(c,e)})),c}),!0,u)].concat(s)}},t.prototype.makeTestFunction=function(){var e=this;this.testFunction=function(t){return Object(r.tidy)((function(){for(var n,i=[],a=t.slice(0,e.inputs.length),o=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),s=[],u=0;u<e.inputs.length;++u)s.push({key:e.inputs[u],value:a[u]});var c=new on(s),l=cn(e.outputs,c);for(u=0;u<e.lossFunctions.length;++u){var f=e.lossFunctions[u],d=Object(r.mean)(f(o[u],l[u]));n=0===u?d:Object(r.add)(n,d),i.push(n)}for(u=0;u<e.metricsTensors.length;++u){var h=e.metricsTensors[u][0],p=e.metricsTensors[u][1],m=Object(r.mean)(h(o[p],l[p]));i.push(m)}return i}))}},t.prototype.fit=function(e,t,n){return void 0===n&&(n={}),u(this,void 0,void 0,(function(){return c(this,(function(r){return[2,En(this,e,t,n)]}))}))},t.prototype.fitDataset=function(e,t){return u(this,void 0,void 0,(function(){return c(this,(function(n){return[2,yn(this,e,t)]}))}))},t.prototype.trainOnBatch=function(e,t){return u(this,void 0,void 0,(function(){var n,i,a,o,s,u,l,f,d;return c(this,(function(c){switch(c.label){case 0:return[4,this.standardizeUserData(e,t)];case 1:n=c.sent(),i=n[0],a=n[1],o=this.makeTrainFunction(),s=o(i.concat(a)),u=[],l=0,f=s,c.label=2;case 2:return l<f.length?[4,f[l].data()]:[3,5];case 3:d=c.sent(),u.push(d[0]),c.label=4;case 4:return l++,[3,2];case 5:return Object(r.dispose)(s),[2,b(u)]}}))}))},t.prototype.getNamedWeights=function(e){for(var t=[],n=null!=e&&e.trainableOnly,r=n?this.trainableWeights:this.weights,i=this.getWeights(n),a=0;a<r.length;++a)n&&!r[a].trainable||t.push({name:r[a].originalName,tensor:i[a]});return t},Object.defineProperty(t.prototype,"stopTraining",{get:function(){return this.stopTraining_},set:function(e){this.stopTraining_=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"optimizer",{get:function(){return this.optimizer_},set:function(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){var t=e.prototype.dispose.call(this);if(0===t.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){var n=Object(r.memory)().numTensors;this.optimizer_.dispose(),t.numDisposedVariables+=n-Object(r.memory)().numTensors}return t},t.prototype.getLossIdentifiers=function(){var e;if("string"==typeof this.loss)e=w(this.loss);else if(Array.isArray(this.loss)){for(var t=0,n=this.loss;t<n.length;t++)if("string"!=typeof n[t])throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map((function(e){return w(e)}))}else{var r=Object.keys(this.loss);e={};for(var i=this.loss,a=0,o=r;a<o.length;a++){var s=o[a];if("string"!=typeof i[s])throw new Error("Serialization of non-string loss is not supported.");e[s]=w(i[s])}}return e},t.prototype.getMetricIdentifiers=function(){if("string"==typeof this.metrics||"function"==typeof this.metrics)return[w($t(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map((function(e){return w($t(e))}));var e={};for(var t in this.metrics)e[t]=w($t(this.metrics[t]));return e},t.prototype.getTrainingConfig=function(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}},t.prototype.loadTrainingConfig=function(e){if(null!=e.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=e.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=e.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");var t,n,r=Dt(an(e.optimizer_config));if("string"==typeof e.loss)t=_(e.loss);else if(Array.isArray(e.loss))t=e.loss.map((function(e){return _(e)}));else if(null!=e.loss)for(var i in t={},e.loss)t[i]=_(e.loss[i]);if(Array.isArray(e.metrics))n=e.metrics.map((function(e){return _(e)}));else if(null!=e.metrics)for(var i in n={},e.metrics)n[i]=_(e.metrics[i]);this.compile({loss:t,metrics:n,optimizer:r})},t.prototype.save=function(e,t){return u(this,void 0,void 0,(function(){var n,i,a,o,s,u,l,f,d,p,m,v,g,y;return c(this,(function(c){switch(c.label){case 0:if("string"==typeof e){if(0===(n=r.io.getSaveHandlers(e)).length)throw new h("Cannot find any save handlers for URL '"+e+"'");if(n.length>1)throw new h("Found more than one ("+n.length+") save handlers for URL '"+e+"'");e=n[0]}if(null==e.save)throw new h("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[4,r.io.encodeWeights(this.getNamedWeights(t))];case 1:return i=c.sent(),a=!1,o=null,s=this.toJSON(o,a),u={modelTopology:s,format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v1.7.4",convertedBy:null},null!=t&&t.includeOptimizer&&null!=this.optimizer?(u.trainingConfig=this.getTrainingConfig(),l="optimizer",v=(m=r.io).encodeWeights,[4,this.optimizer.getWeights()]):[3,4];case 2:return[4,v.apply(m,[c.sent(),l])];case 3:f=c.sent(),d=f.data,p=f.specs,(y=i.specs).push.apply(y,p),i.data=r.io.concatenateArrayBuffers([i.data,d]),c.label=4;case 4:return null!=this.userDefinedMetadata&&(g=!0,Zt(this.userDefinedMetadata,this.name,g),u.userDefinedMetadata=this.userDefinedMetadata),u.weightData=i.data,u.weightSpecs=i.specs,[2,e.save(u)]}}))}))},t.prototype.setUserDefinedMetadata=function(e){Zt(e,this.name),this.userDefinedMetadata=e},t.prototype.getUserDefinedMetadata=function(){return this.userDefinedMetadata},t.className="Model",t}(function(e){function t(n){var r=e.call(this,{})||this;if(r.containerNodes=new Set,r.name=n.name,null==r.name){var i=r.getClassName().toLowerCase();r.name=Qe(i)}if(r.supportsMasking=!1,r.trainable_=!0,Array.isArray(n.inputs)?r.inputs=n.inputs.slice():r.inputs=[n.inputs],Array.isArray(n.outputs)?r.outputs=n.outputs.slice():r.outputs=[n.outputs],A(r.inputs).length!==r.inputs.length)throw new h("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+r.inputs.map((function(e){return e.name})));A(r.outputs).length!==r.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+r.outputs.map((function(e){return e.name}))),r.inputLayers=[],r.inputLayersNodeIndices=[],r.inputLayersTensorIndices=[],r.outputLayers=[],r.outputLayersNodeIndices=[],r.outputLayersTensorIndices=[],r.layers=[],r.internalContainerRefs=[];for(var a=0,o=r.outputs;a<o.length;a++){var s=(j=o[a]).sourceLayer,u=j.nodeIndex,c=j.tensorIndex;r.outputLayers.push(s),r.outputLayersNodeIndices.push(u),r.outputLayersTensorIndices.push(c)}for(var l=0,f=r.inputs;l<f.length;l++)s=(j=f[l]).sourceLayer,u=j.nodeIndex,c=j.tensorIndex,g(0===u,"input layer has >1 nodes"),g(0===c,"input layer has >1 tensors"),r.inputLayers.push(s),r.inputLayersNodeIndices.push(u),r.inputLayersTensorIndices.push(c);r.inputNames=[],r.outputNames=[],r.feedInputShapes=[],r.feedInputNames=[],r.feedOutputNames=[];for(var p=0;p<r.inputLayers.length;p++){if(!((s=r.inputLayers[p])instanceof vt))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. Received inputs: "+n.inputs+". Input "+p+" (0-based) originates from layer type "+s.getClassName()+".");r.inputNames.push(s.name),r.feedInputShapes.push(s.batchInputShape),r.feedInputNames.push(s.name)}for(var m=0,v=r.outputLayers;m<v.length;m++)s=v[m],r.outputNames.push(s.name);r.internalInputShapes=r.inputs.map((function(e){return e.shape})),r.internalOutputShapes=r.outputs.map((function(e){return e.shape}));for(var y={},b={},x={},w={},_={},k=[],E=function e(n,i,a,o,s,u){null!=o&&null!=s&&null!=u||(o=n.sourceLayer,s=n.nodeIndex,u=n.tensorIndex);var c=o.inboundNodes[s];if(-1!==a.indexOf(c))throw new d("The tensor "+n.name+' at layer "'+o.name+'" is part of a cycle.');if(-1===i.indexOf(c)){r.containerNodes.add(t.nodeKey(o,s)),o.id in _||(_[o.id]=Object.keys(_).length),-1===a.indexOf(c)&&a.push(c);for(var l=c.inboundLayers.length,f=0;f<l;f++)e(c.inputTensors[f],i,a,c.inboundLayers[f],c.nodeIndices[f],c.tensorIndices[f]);for(i.push(c);a.indexOf(c)>=0;)a.splice(a.indexOf(c),1);k.push(c)}},S=[],O=[],D=0,T=r.outputs;D<T.length;D++){var j=T[D];E(j,S,O)}for(var M=0,F=k.slice().reverse();M<F.length;M++){b[(te=F[M]).id]=te,te.id in y||(y[te.id]=0);var I=y[te.id],N=null==x[te.outboundLayer.id]?0:x[te.outboundLayer.id];for(I=Math.max(I,N),x[te.outboundLayer.id]=I,w[te.outboundLayer.id]=te.outboundLayer,y[te.id]=I,p=0;p<te.inboundLayers.length;p++){var R=te.inboundLayers[p],P=(u=te.nodeIndices[p],R.inboundNodes[u]),B=null==y[P.id]?0:y[P.id];y[P.id]=Math.max(I+1,B),b[P.id]=P}}var L={};for(var z in y)(I=y[z])in L||(L[I]=[]),L[I].push(b[z]);var U={};for(var W in x)(I=x[W])in U||(U[I]=[]),U[I].push(w[W]);var V=Object.keys(U).map((function(e){return parseInt(e,10)})).sort(C);r.layers=[];for(var G=0,q=V;G<q.length;G++){var H=U[I=q[G]];H.sort((function(e,t){var n=_[e.id],r=_[t.id];return n<r?-1:n>r?1:0}));for(var X=0,K=H;X<K.length;X++)(s=K[X])instanceof t&&r.internalContainerRefs.push(s),r.layers.push(s)}r.layersByDepth=U,V=Object.keys(L).map((function(e){return parseInt(e,10)})).sort(C);for(var Y=r.inputs.slice(),$=[],J=0,Z=V;J<Z.length;J++)for(var Q=0,ee=L[I=Z[J]];Q<ee.length;Q++){var te;if(null!=(s=(te=ee[Q]).outboundLayer)){for(var ne=0,re=te.inputTensors;ne<re.length;ne++)if(j=re[ne],-1===Y.indexOf(j))throw new d("Graph disconnected: cannot obtain value for tensor "+j+' at layer "'+s.name+'". The following previous layers were accessed without issue: '+$);for(var ie=0,ae=te.outputTensors;ie<ae.length;ie++)j=ae[ie],Y.push(j);$.push(s.name)}}r.nodesByDepth=L;for(var oe=r.layers.map((function(e){return e.name})),se=function(e){var t=oe.filter((function(t){return t===e})).length;if(1!==t)throw new d('The name "'+e+'" is used '+t+" times in the model. All layer names should be unique. Layer names: "+JSON.stringify(oe))},ue=0,ce=oe;ue<ce.length;ue++)se(ce[ue]);return r.outboundNodes=[],r.inboundNodes=[],new ht({outboundLayer:r,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:r.inputs,outputTensors:r.outputs,inputMasks:r.inputs.map((function(e){return null})),outputMasks:r.outputs.map((function(e){return null})),inputShapes:r.inputs.map((function(e){return e.shape})),outputShapes:r.outputs.map((function(e){return e.shape}))}),r.built=!0,r._refCount=1,r}return a(t,e),t.prototype.assertNotDisposed=function(){if(0===this._refCount)throw new Error("Container '"+this.name+"' is already disposed.")},t.prototype.dispose=function(){this.assertNotDisposed();var e={refCountAfterDispose:null,numDisposedVariables:0};if(0==--this._refCount){for(var t=0,n=this.layers;t<n.length;t++){var r=n[t];e.numDisposedVariables+=r.dispose().numDisposedVariables}for(var i=0,a=this.internalContainerRefs;i<a.length;i++){var o=a[i];e.numDisposedVariables+=o.dispose().numDisposedVariables}}return e.refCountAfterDispose=this._refCount,e},Object.defineProperty(t.prototype,"trainable",{get:function(){return this.trainable_},set:function(e){this.layers.forEach((function(t){t._trainableWeights.forEach((function(t){return t.trainable=e}))})),this.trainable_=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"trainableWeights",{get:function(){if(this._trainableWeights.length>0)throw new h("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];for(var e=[],t=0,n=this.layers;t<n.length;t++){var r=n[t];e=e.concat(r.trainableWeights)}return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nonTrainableWeights",{get:function(){for(var e=[],t=0,n=this.layers;t<n.length;t++){var r=n[t];e.push.apply(e,r.nonTrainableWeights)}if(!this.trainable){for(var i=[],a=0,o=this.layers;a<o.length;a++)r=o[a],i.push.apply(i,r.trainableWeights);return i.concat(e)}return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),t.prototype.loadWeights=function(e,t){void 0===t&&(t=!0);for(var n={},r=0,i=0,a=this.layers;i<a.length;i++)for(var o=0,s=a[i].weights;o<s.length;o++){var u=s[o];if(null!=n[u.originalName])throw new h("Duplicate weight name: "+u.originalName);n[u.originalName]=u,r++}var c=[];for(var l in e){if(null!=n[l])c.push([n[l],e[l]]);else if(t)throw new h("Provided weight data has no target variable: "+l);delete n[l]}if(t){var f=[];for(var d in n)f.push(d);if(f.length>0)throw new h(f.length+" of "+r+" weights are not set: "+f)}ut(c)},t.prototype.updatedConfig=function(){var e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion="tfjs-layers 1.7.4",t.backend="TensorFlow.js",t},t.prototype.toJSON=function(e,t){void 0===t&&(t=!0);var n=function e(t,n){if(null===t||void 0===t)return null;if("string"==typeof t)return w(t);if("number"==typeof t||"boolean"==typeof t)return t;if(t instanceof Array){for(var r=[],i=t.length,a=0;a<i;++a){var o=t[a];rn(n,a,o)?r.push(o):r.push(e(o,n))}return r}for(var s={},u=0,c=Object.keys(t);u<c.length;u++){var l=c[u],f=t[l];s[w(l)]="name"!==l&&"className"!==l||"string"!=typeof f?e(f,l):f}return s}(this.updatedConfig());return t?JSON.stringify(n):n},t.prototype.call=function(e,t){var n=this;return Object(r.tidy)((function(){e=x(e);for(var r=new on,i=0;i<n.inputs.length;++i)r.add(n.inputs[i],e[i]);return cn(n.outputs,r,t)}))},t.prototype.computeMask=function(e,t){var n=this;return Object(r.tidy)((function(){var r;return e=x(e),r=null==t?v(null,e.length):x(t),n.runInternalGraph(e,r)[1]}))},t.prototype.computeOutputShape=function(e){var t=tt(e);if(t.length!==this.inputLayers.length)throw new h("Invalid inputShape argument "+e+": model has "+this.inputLayers.length+" tensor inputs.");for(var n={},r=0;r<t.length;r++){var i=this.inputLayers[r],a=t[r];n[A=i.name+"_0_0"]=a}var o=Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(C);if(o.length>1)for(var s=0,u=o;s<u.length;s++)for(var c=u[s],l=0,f=this.nodesByDepth[c];l<f.length;l++){var d=f[l];if(i=d.outboundLayer,-1===this.inputLayers.map((function(e){return e.id})).indexOf(i.id)){for(var p=[],m=0;m<d.inboundLayers.length;m++){var v=d.inboundLayers[m],y=d.nodeIndices[m],x=d.tensorIndices[m],w=n[A=v.name+"_"+y+"_"+x];p.push(w)}var _=tt(i.computeOutputShape(b(p))),k=i.inboundNodes.indexOf(d);for(m=0;m<_.length;m++)n[A=i.name+"_"+k+"_"+m]=_[m]}}var E=[],S=[];for(r=0;r<this.outputLayers.length;r++){i=this.outputLayers[r],k=this.outputLayersNodeIndices[r],x=this.outputLayersTensorIndices[r];var A=i.name+"_"+k+"_"+x;S.push(A)}for(r=0;r<S.length;r++){var O=S[r];g(O in n),E.push(n[O])}return b(E)},t.prototype.runInternalGraph=function(e,t){null==t&&(t=v(null,e.length));for(var n={},r=0;r<this.inputs.length;++r){var i=this.inputs[r],a=e[r],o=t[r];n[i.id]=[a,o]}for(var s=0,u=Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(C);s<u.length;s++)for(var c=u[s],l=0,f=this.nodesByDepth[c];l<f.length;l++){for(var d=f[l],h=d.outboundLayer,m=d.inputTensors,y=d.outputTensors,b=new Array,w=0,_=m;w<_.length;w++)(i=_[w]).id in n&&b.push(n[i.id]);if(b.length===m.length){var k={},E=void 0,S=void 0,A=void 0,O=void 0;if(null!=d.callArgs&&(k=d.callArgs),1===b.length){var D=b[0],T=D[0],j=D[1];null==k.mask&&(k.mask=j),A=x(h.call(T,k)),O=x(h.computeMask(T,j)),E=[T],S=[j]}else E=b.map((function(e){return e[0]})),S=b.map((function(e){return e[1]})),null==k.mask&&(k.mask=S),A=x(h.call(E,k)),O=x(h.computeMask(E,S));if(h.activityRegularizer)throw new p("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(r=0;r<y.length;++r)i=y[r],a=A[r],o=O[r],n[i.id]=[a,o]}}for(var M=[],F=[],I=[],N=0,R=this.outputs;N<R.length;N++){g((i=R[N]).id in n,"Could not compute output "+i.name+" : "+i.id);var P=n[i.id],B=P[0];o=P[1],I.push(B.shape),M.push(B),F.push(o)}return[M,F,I]},t.prototype.buildNodeConversionMap=function(e){for(var n,r={},i=0,a=this.layers;i<a.length;i++){var o=a[i];n=o instanceof t?1:0;for(var s=0;s<o.inboundNodes.length;s++){var u=t.nodeKey(o,s);this.containerNodes.has(u)&&(r[u]=n,n+=1)}}return r},t.prototype.getLayer=function(e,t){if(null!=t){if(this.layers.length<=t)throw new h("Was asked to retrieve layer at index "+t+", but model only has "+this.layers.length+" layer(s).");return this.layers[t]}if(null==e)throw new h("Provide either a layer name or layer index");for(var n=0,r=this.layers;n<r.length;n++){var i=r[n];if(i.name===e)return i}throw new h("No such layer: "+e)},t.prototype.calculateLosses=function(){var e=this;return Object(r.tidy)((function(){for(var n=[],r=0,i=e.layers;r<i.length;r++)for(var a=i[r],o=0;o<a.inboundNodes.length;++o){var s=t.nodeKey(a,o);e.containerNodes.has(s)&&n.push.apply(n,a.calculateLosses())}return n}))},t.prototype.getConfig=function(){for(var e={name:this.name},n=this.buildNodeConversionMap(this.layers),r=[],i=0,a=this.layers;i<a.length;i++){for(var o=(x=a[i]).getClassName(),s=x.getConfig(),u=[],c=0;c<x.inboundNodes.length;c++){var l=x.inboundNodes[c],f=t.nodeKey(x,c),d={};if(this.containerNodes.has(f)){if(l.callArgs)try{JSON.stringify(l.callArgs),d=l.callArgs}catch(e){console.warn("Layer "+x.name+" was passed non-serializable keyword arguments: "+l.callArgs+". They will not be included in the serialized model (and thus will be missing at deserialization time)."),d={}}if(l.inboundLayers.length>0){for(var h=[],p=0;p<l.inboundLayers.length;p++){var m=l.inboundLayers[p],v=l.nodeIndices[p],g=l.tensorIndices[p];null==(_=n[t.nodeKey(m,v)])&&(_=0),h.push([m.name,_,g,d])}u.push(h)}}}var y={};y.name=x.name,y.className=o,y.config=s,y.inboundNodes=u,r.push(y)}e.layers=r;var b=[];for(p=0;p<this.inputLayers.length;p++){var x=this.inputLayers[p];v=this.inputLayersNodeIndices[p],f=t.nodeKey(x,v),this.containerNodes.has(f)&&(null!==(_=n[f])&&void 0!==_||(_=0),g=this.inputLayersTensorIndices[p],b.push([x.name,_,g]))}e.inputLayers=b;var w=[];for(p=0;p<this.outputLayers.length;p++){var _;x=this.outputLayers[p],v=this.outputLayersNodeIndices[p],f=t.nodeKey(x,v),this.containerNodes.has(f)&&(null!==(_=n[f])&&void 0!==_||(_=0),g=this.outputLayersTensorIndices[p],w.push([x.name,_,g]))}return e.outputLayers=w,e},t.fromConfig=function(e,t,n,r){void 0===n&&(n={}),void 0===r&&(r=!1);var i={},a={};function o(e,t){e.name in a?a[e.name].push(t):a[e.name]=[t]}function s(e,t){for(var n,r=[],a=0,s=t;a<s.length;a++){var u=s[a],c=u[0],l=u[1],f=u[2];if(n=null==u[3]?{}:u[3],!(c in i))return void o(e,t);var d=i[c];if(d.inboundNodes.length<=l)return void o(e,t);var h=d.inboundNodes[l];r.push(h.outputTensors[f])}r.length>0&&e.apply(b(r),n)}function u(e){var n=e.name,a=Dt(e,null!=t.customObjects?t.customObjects:{});a.setFastWeightInitDuringBuild(r),i[n]=a,e.inboundNodes.forEach((function(e){if(!(e instanceof Array))throw new h("Corrupted configuration, expected array for nodeData: "+e);o(a,e)}))}for(var c=t.name,l=t.layers,f=0,d=l;f<d.length;f++)u(v=d[f]);for(;!O(a);)for(var p=0,m=l;p<m.length;p++){var v=m[p];if((F=i[v.name]).name in a){var y=a[F.name];delete a[F.name];for(var x=0,w=y;x<w.length;x++)s(F,w[x])}}for(var _=[],k=[],E=0,S=t.inputLayers;E<S.length;E++){var C=(v=S[E])[0],A=v[1],D=v[2];g(C in i);var T=(F=i[C]).inboundNodes[A].outputTensors;_.push(T[D])}for(var j=0,M=t.outputLayers;j<M.length;j++){var F;C=(v=M[j])[0],A=v[1],D=v[2],g(C in i),T=(F=i[C]).inboundNodes[A].outputTensors,k.push(T[D])}return new e({inputs:_,outputs:k,name:c})},Object.defineProperty(t.prototype,"stateful",{get:function(){if(this._stateful)throw new h("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(var e=0,t=this.layers;e<t.length;e++)if(t[e].stateful)return!0;return!1},enumerable:!0,configurable:!0}),t.prototype.resetStates=function(){var e=this;Object(r.tidy)((function(){e.layers.forEach((function(e){e.stateful&&e.resetStates()}))}))},t}(mt));function Mn(e,t){return u(this,void 0,void 0,(function(){var n;return c(this,(function(i){if(null==t&&(t={}),"string"==typeof e){if(0===(n=r.io.getLoadHandlers(e,t.onProgress)).length)n.push(r.io.browserHTTPRequest(e,t));else if(n.length>1)throw new h("Found more than one ("+n.length+") load handlers for URL '"+e+"'");e=n[0]}return[2,function(e,t,n){return u(this,void 0,void 0,(function(){var i,a,o,s,u,l,f,d,p;return c(this,(function(c){switch(c.label){case 0:if(null==n&&(n={}),null==e.load)throw new h("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return[4,e.load()];case 1:if(i=c.sent(),null!=(a=i.modelTopology).model_config&&(a=a.model_config),o=null==n.strict||n.strict,s=null!=i.weightData&&null!=i.weightSpecs&&o,u=Dt(an(a),t,s),null!=(l=i.trainingConfig)&&u.loadTrainingConfig(l),null!=i.userDefinedMetadata&&u.setUserDefinedMetadata(i.userDefinedMetadata),null==i.weightData)return[3,4];if(null==i.weightSpecs)throw new h("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");return f=function(e,t){var n=r.io.decodeWeights(e,t),i={},a=[];return t.forEach((function(e){"optimizer"===e.group?a.push({name:e.name,tensor:n[e.name]}):i[e.name]=n[e.name]})),{modelWeights:i,optimizerWeights:a}}(i.weightData,i.weightSpecs),d=f.modelWeights,p=f.optimizerWeights,u.loadWeights(d,o),null!=u.optimizer&&p.length>0?[4,u.optimizer.setWeights(p)]:[3,3];case 2:c.sent(),c.label=3;case 3:Object(r.dispose)(d),Object(r.dispose)(p.map((function(e){return e.tensor}))),c.label=4;case 4:return[2,u]}}))}))}(e,void 0,t)]}))}))}r.serialization.registerClass(jn);var Fn=function(e){function t(t){var n=e.call(this,{inputs:[],outputs:[]})||this;if(t=t||{},n.trainable=!0,n.built=!1,n.name=null!=t.name?t.name:Qe("sequential_"),null!=t.layers)for(var r=0,i=t.layers;r<i.length;r++){var a=i[r];n.add(a)}return n}return a(t,e),t.prototype.checkShape=function(e){if(e.inboundNodes[0].outputTensors[0].shape.some((function(e){return e<0})))throw new h("Negative dimension size caused by adding layer "+e.name+" with input shape ["+e.inboundNodes[0].inputTensors[0].shape+"]")},t.prototype.add=function(e){var n,r=e instanceof t||e instanceof jn;if(r){if(1!==(n=e).outputs.length)throw new h("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==n.inputs.length)throw new h("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===e.inboundNodes.length){if(null==e.batchInputShape)throw new h("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var i=gt({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(i)}if(r)this.outputs=n.outputs,this.inputs=n.inputs;else{if(1!==e.inboundNodes.length)throw new h("A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer "+e.name+" which has "+e.inboundNodes.length+" pre-existing inbound connections.");if(1!==e.inboundNodes[0].outputTensors.length)throw new h("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=function e(t,n,r){if((null==n||null!=r&&r>0)&&(n=t.sourceLayer,r=t.nodeIndex),0===n.inboundNodes.length)return[t];var i=n.inboundNodes[r];if(0===i.inboundLayers.length)return i.inputTensors;for(var a=[],o=0;o<i.inboundLayers.length;o++)for(var s=0,u=e(i.inputTensors[o],i.inboundLayers[o],i.nodeIndices[o]);s<u.length;s++){var c=u[s];-1===a.indexOf(c)&&a.push(c)}return a}(this.outputs[0])}this.inboundNodes=[],new ht({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:v(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map((function(e){return e.shape})),outputShapes:this.outputs[0].shape})}else{var a=e.apply(this.outputs[0]);if(Array.isArray(a))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[a],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1},t.prototype.pop=function(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}},t.prototype.call=function(e,t){return null==this.model&&this.build(),this.model.call(e,t)},t.prototype.build=function(e){if(rt(e),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new jn({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0},t.prototype.countParams=function(){return this.built||this.build(),e.prototype.countParams.call(this)},t.prototype.summary=function(t,n,r){void 0===r&&(r=console.log),this.built||this.build(),e.prototype.summary.call(this,t,n,r)},t.prototype.setWeights=function(e){null==this.model&&this.build(),this.model.setWeights(e)},t.prototype.evaluate=function(e,t,n){if(void 0===n&&(n={}),!this.built)throw new d("The model needs to be compiled before being used.");return this.model.evaluate(e,t,n)},t.prototype.evaluateDataset=function(e,t){return u(this,void 0,void 0,(function(){return c(this,(function(n){if(!this.built)throw new d("The model needs to be compiled before being used.");return[2,this.model.evaluateDataset(e,t)]}))}))},t.prototype.predict=function(e,t){return void 0===t&&(t={}),null==this.model&&this.build(),this.model.predict(e,t)},t.prototype.predictOnBatch=function(e){return null==this.model&&this.build(),this.model.predictOnBatch(e)},t.prototype.compile=function(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames},Object.defineProperty(t.prototype,"optimizer",{get:function(){return null==this.model?void 0:this.model.optimizer},set:function(e){this.model.optimizer=e},enumerable:!0,configurable:!0}),t.prototype.fit=function(e,t,n){return void 0===n&&(n={}),u(this,void 0,void 0,(function(){return c(this,(function(r){if(!this.built)throw new d("The model needs to be compiled before being used.");return[2,this.model.fit(e,t,n)]}))}))},t.prototype.fitDataset=function(e,t){return u(this,void 0,void 0,(function(){return c(this,(function(n){if(!this.built)throw new d("The model needs to be compiled before being used.");return[2,this.model.fitDataset(e,t)]}))}))},t.prototype.trainOnBatch=function(e,t){return u(this,void 0,void 0,(function(){return c(this,(function(n){return[2,this.model.trainOnBatch(e,t)]}))}))},t.fromConfig=function(e,n,i,a){var o;void 0===i&&(i={}),void 0===a&&(a=!1);var s={};if(n instanceof Array){if(null==n[0].className||"Merge"===n[0].className)throw new h("Legacy serialization format not supported yet.");o=n}else r.util.assert(null!=n.layers,(function(){return"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."})),o=n.layers,delete n.layers,s=n;var u=new e(s);if(!(u instanceof t))throw new p("Sequential.fromConfig called on non-Sequential input: "+u);for(var c=0,l=o;c<l.length;c++){var f=Dt(l[c],void 0,a);a&&f.setFastWeightInitDuringBuild(!0),u.add(f)}return u},Object.defineProperty(t.prototype,"stopTraining",{get:function(){if(null==this.model)throw new h("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining},set:function(e){if(null==this.model)throw new h("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e},enumerable:!0,configurable:!0}),t.prototype.getConfig=function(){for(var e=[],t=0,n=this.layers;t<n.length;t++){var r=n[t],i={};i.className=r.getClassName(),i.config=r.getConfig(),e.push(i)}return{name:this.name,layers:e}},t.className="Sequential",t}(jn);function In(e){return new jn(e)}function Nn(e){return new Fn(e)}function Rn(e,t){return null==t&&(t={}),Mn(e,t)}function Pn(e){return gt(e)}function Bn(e,t){At.registerCallbackConstructor(e,t)}r.serialization.registerClass(Fn);var Ln=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.getConfig=function(){return{}},t}(r.serialization.Serializable),zn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.apply=function(e,t){return void 0===t&&(t=1),function(e,t){if(void 0===t&&(t=1),1!==t)throw new p("Support for alpha values other than 1 ("+t+") is not implemented yet.");return Object(r.elu)(e)}(e,t)},t.className="elu",t}(Ln);r.serialization.registerClass(zn);var Un=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.apply=function(e){return Object(r.selu)(e)},t.className="selu",t}(Ln);r.serialization.registerClass(Un);var Wn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.apply=function(e){return Object(r.relu)(e)},t.className="relu",t}(Ln);r.serialization.registerClass(Wn);var Vn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.apply=function(e){return Object(r.tidy)((function(){return Object(r.minimum)(6,Object(r.relu)(e))}))},t.className="relu6",t}(Ln);r.serialization.registerClass(Vn);var Gn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.apply=function(e){return e},t.className="linear",t}(Ln);r.serialization.registerClass(Gn);var qn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.apply=function(e){return Object(r.sigmoid)(e)},t.className="sigmoid",t}(Ln);r.serialization.registerClass(qn);var Hn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.apply=function(e){return function(e){return Object(r.tidy)((function(){var t=Object(r.add)(.5,Object(r.mul)(.2,e));return Object(r.clipByValue)(t,0,1)}))}(e)},t.className="hardSigmoid",t}(Ln);r.serialization.registerClass(Hn);var Xn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.apply=function(e){return Object(r.softplus)(e)},t.className="softplus",t}(Ln);r.serialization.registerClass(Xn);var Kn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.apply=function(e){return function(e){return Object(r.tidy)((function(){return Object(r.div)(e,Object(r.abs)(e).add(1))}))}(e)},t.className="softsign",t}(Ln);r.serialization.registerClass(Kn);var Yn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.apply=function(e){return Object(r.tanh)(e)},t.className="tanh",t}(Ln);r.serialization.registerClass(Yn);var $n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.apply=function(e,t){return void 0===t&&(t=-1),Object(r.softmax)(e,t)},t.className="softmax",t}(Ln);r.serialization.registerClass($n);var Jn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.apply=function(e,t){return void 0===t&&(t=-1),Object(r.logSoftmax)(e,t)},t.className="logSoftmax",t}(Ln);function Zn(e){return e.getClassName()}function Qn(e,t){return void 0===t&&(t={}),S(e,r.serialization.SerializationMap.getMap().classNameMap,t,"activation")}function er(e){var t;return null==e?Qn(t={className:"linear",config:{}}):"string"==typeof e?((t={}).className=e,t.config={},Qn(t)):e instanceof Ln?e:Qn(e)}function tr(e){if(null!=e&&"object"!=typeof e)throw new Error("Argument to L1L2 regularizer's constructor is expected to be an object, but received: "+e)}r.serialization.registerClass(Jn);var nr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t}(r.serialization.Serializable),rr=function(e){function t(t){var n=e.call(this)||this;return tr(t),n.l1=null==t||null==t.l1?.01:t.l1,n.l2=null==t||null==t.l2?.01:t.l2,n.hasL1=0!==n.l1,n.hasL2=0!==n.l2,n}return a(t,e),t.prototype.apply=function(e){var t=this;return Object(r.tidy)((function(){var n=Object(r.zeros)([1]);return t.hasL1&&(n=Object(r.add)(n,Object(r.sum)(Object(r.mul)(t.l1,Object(r.abs)(e))))),t.hasL2&&(n=Object(r.add)(n,Object(r.sum)(Object(r.mul)(t.l2,_e(e))))),n.asScalar()}))},t.prototype.getConfig=function(){return{l1:this.l1,l2:this.l2}},t.fromConfig=function(e,t){return new e({l1:t.l1,l2:t.l2})},t.className="L1L2",t}(nr);r.serialization.registerClass(rr);var ir={l1l2:"L1L2"};function ar(e){return E(e)}function or(e,t){return void 0===t&&(t={}),S(e,r.serialization.SerializationMap.getMap().classNameMap,t,"regularizer")}function sr(e){return null==e?null:"string"==typeof e?or({className:e in ir?ir[e]:e,config:{}}):e instanceof nr?e:or(e)}var ur=function(e){function t(t){var n=e.call(this,null==t?{}:t)||this;return n.supportsMasking=!0,null!=t&&(n.maxValue=t.maxValue),n}return a(t,e),t.prototype.call=function(e,t){e=nt(e);var n=Object(r.relu)(e);return null!=this.maxValue&&(n=Object(r.clipByValue)(n,0,this.maxValue)),n},t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var t={maxValue:this.maxValue},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="ReLU",t}(mt);r.serialization.registerClass(ur);var cr=function(e){function t(t){var n=e.call(this,null==t?{}:t)||this;return n.DEFAULT_ALPHA=.3,null==t&&(t={}),n.alpha=null==t.alpha?n.DEFAULT_ALPHA:t.alpha,n}return a(t,e),t.prototype.call=function(e,t){var n=nt(e);return Object(r.leakyRelu)(n,this.alpha)},t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var t={alpha:this.alpha},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="LeakyReLU",t}(mt);r.serialization.registerClass(cr);var lr=function(e){function t(t){var n=e.call(this,null==t?{}:t)||this;if(n.DEFAULT_ALPHA_INITIALIZER="zeros",null==t&&(t={}),n.supportsMasking=!0,n.alphaInitializer=Ke(t.alphaInitializer||n.DEFAULT_ALPHA_INITIALIZER),n.alphaRegularizer=sr(t.alphaRegularizer),n.alphaConstraint=W(t.alphaConstraint),null==t.sharedAxes)n.sharedAxes=null;else if(Array.isArray(t.sharedAxes))n.sharedAxes=t.sharedAxes;else{if("number"!=typeof t.sharedAxes)throw new h("Expected sharedAxes to be a number or an array of numbers, but got "+t.sharedAxes);n.sharedAxes=[t.sharedAxes]}return n}return a(t,e),t.prototype.build=function(e){var t=(e=rt(e)).slice(1);if(null!=this.sharedAxes)for(var n=0,r=this.sharedAxes;n<r.length;n++)t[(a=r[n])-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);var i={};if(null!=this.sharedAxes)for(var a=1;a<e.length;++a)i[a]=e[a];this.inputSpec=[new lt({ndim:e.length,axes:i})],this.built=!0},t.prototype.call=function(e,t){return e=nt(e),Object(r.prelu)(e,this.alpha.read())},t.prototype.getConfig=function(){var t={alphaInitializer:Xe(this.alphaInitializer),alphaRegularizer:ar(this.alphaRegularizer),alphaConstraint:z(this.alphaConstraint),sharedAxes:this.sharedAxes},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="PReLU",t}(mt);r.serialization.registerClass(lr);var fr=function(e){function t(t){var n=e.call(this,null==t?{}:t)||this;if(n.DEFAULT_ALPHA=1,null==t&&(t={}),null!=t.alpha&&t.alpha!==n.DEFAULT_ALPHA)throw new p("Non-default alpha value ("+t.alpha+") is not supported by the ELU layer yet.");return n.alpha=null==t.alpha?n.DEFAULT_ALPHA:t.alpha,n}return a(t,e),t.prototype.call=function(e,t){var n=nt(e);return Object(r.elu)(n)},t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var t={alpha:this.alpha},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="ELU",t}(mt);r.serialization.registerClass(fr);var dr=function(e){function t(t){var n=e.call(this,null==t?{}:t)||this;return n.DEFAULT_THETA=1,null==t&&(t={}),n.theta=null==t.theta?n.DEFAULT_THETA:t.theta,n}return a(t,e),t.prototype.call=function(e,t){var n=nt(e);return n.mul(fe(n.greater(this.theta),"float32"))},t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var t={theta:this.theta},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="ThresholdedReLU",t}(mt);r.serialization.registerClass(dr);var hr=function(e){function t(t){var n=e.call(this,null==t?{}:t)||this;return n.DEFAULT_AXIS=1,null==t&&(t={}),n.softmax=(new $n).apply,n.axis=null==t.axis?n.DEFAULT_AXIS:t.axis,n}return a(t,e),t.prototype.call=function(e,t){var n=nt(e);return this.softmax(n,this.axis)},t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var t={axis:this.axis},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="Softmax",t}(mt);function pr(e,t,n){if("number"==typeof e)return v(e,t);if(e.length!==t)throw new h("The "+n+" argument must be an integer or tuple of "+t+" integers. Received: "+e.length+" elements.");for(var r=0;r<t;++r){var i=e[r];if(!ae(i))throw new h("The "+n+" argument must be an integer or tuple of "+t+" integers. Received: "+JSON.stringify(e)+" including a non-integer number "+i)}return e}function mr(e,t,n,r,i){return void 0===i&&(i=1),null==e?e:(a="same"===n?e:e-(t+(t-1)*(i-1))+1,Math.floor((a+r-1)/r));var a}function vr(e,t,n,r){if(null==e)return null;if("valid"===r)e=e*t+ce([n-t,0]);else{if("same"!==r)throw new h("Unsupport padding mode: "+r+".");e*=t}return e}function gr(e,t){return Object(r.tidy)((function(){return Y(t),"channelsFirst"===t?Object(r.transpose)(e,[0,2,3,1]):e}))}function yr(e,t){return Object(r.tidy)((function(){return Y(t),"channelsFirst"===t?Object(r.transpose)(e,[0,2,3,4,1]):e}))}function br(e,t,n,i,a,o,s,u){return void 0===i&&(i=[1,1]),void 0===a&&(a="valid"),void 0===u&&(u=null),Object(r.tidy)((function(){if(null==o&&(o="channelsLast"),Y(o),3!==e.rank&&4!==e.rank)throw new h("conv2dWithBiasActivation expects input to be of rank 3 or 4, but received "+e.rank+".");if(3!==t.rank&&4!==t.rank)throw new h("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received "+e.rank+".");var c=gr(e,o);if("causal"===a)throw new p("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return c=r.fused.conv2d({x:c,filter:t,strides:i,pad:"same"===a?"same":"valid",dilations:s,dataFormat:"NHWC",bias:n,activation:u}),"channelsFirst"===o&&(c=Object(r.transpose)(c,[0,3,1,2])),c}))}r.serialization.registerClass(hr);var xr=function(e){function t(n,r){var i=e.call(this,r)||this;if(i.bias=null,i.DEFAULT_KERNEL_INITIALIZER="glorotNormal",i.DEFAULT_BIAS_INITIALIZER="zeros",t.verifyArgs(r),i.rank=n,j(i.rank,"rank"),1!==i.rank&&2!==i.rank&&3!==i.rank)throw new p("Convolution layer for rank other than 1, 2, or 3 ("+i.rank+") is not implemented yet.");if(i.kernelSize=pr(r.kernelSize,n,"kernelSize"),i.strides=pr(null==r.strides?1:r.strides,n,"strides"),i.padding=null==r.padding?"valid":r.padding,$(i.padding),i.dataFormat=null==r.dataFormat?"channelsLast":r.dataFormat,Y(i.dataFormat),i.activation=er(r.activation),i.useBias=null==r.useBias||r.useBias,i.biasInitializer=Ke(r.biasInitializer||i.DEFAULT_BIAS_INITIALIZER),i.biasConstraint=W(r.biasConstraint),i.biasRegularizer=sr(r.biasRegularizer),i.activityRegularizer=sr(r.activityRegularizer),i.dilationRate=pr(null==r.dilationRate?1:r.dilationRate,n,"dilationRate"),1===i.rank&&Array.isArray(i.dilationRate)&&1!==i.dilationRate.length)throw new h("dilationRate must be a number or an array of a single number for 1D convolution, but received "+JSON.stringify(i.dilationRate));if(2===i.rank){if("number"==typeof i.dilationRate)i.dilationRate=[i.dilationRate,i.dilationRate];else if(2!==i.dilationRate.length)throw new h("dilationRate must be a number or array of two numbers for 2D convolution, but received "+JSON.stringify(i.dilationRate))}else if(3===i.rank)if("number"==typeof i.dilationRate)i.dilationRate=[i.dilationRate,i.dilationRate,i.dilationRate];else if(3!==i.dilationRate.length)throw new h("dilationRate must be a number or array of three numbers for 3D convolution, but received "+JSON.stringify(i.dilationRate));return i}return a(t,e),t.verifyArgs=function(e){if(g("kernelSize"in e,"required key 'kernelSize' not in config"),"number"!=typeof e.kernelSize&&!T(e.kernelSize,"number",1,3))throw new h("BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received "+JSON.stringify(e.kernelSize)+".")},t.prototype.getConfig=function(){var t={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Zn(this.activation),useBias:this.useBias,biasInitializer:Xe(this.biasInitializer),biasRegularizer:ar(this.biasRegularizer),activityRegularizer:ar(this.activityRegularizer),biasConstraint:z(this.biasConstraint)},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t}(mt),wr=function(e){function t(n,r){var i=e.call(this,n,r)||this;return i.kernel=null,t.verifyArgs(r),i.filters=r.filters,j(i.filters,"filters"),i.kernelInitializer=Ke(r.kernelInitializer||i.DEFAULT_KERNEL_INITIALIZER),i.kernelConstraint=W(r.kernelConstraint),i.kernelRegularizer=sr(r.kernelRegularizer),i}return a(t,e),t.prototype.build=function(e){var t;e=rt(e);var n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n])throw new h("The channel dimension of the input should be defined. Found "+e[n]);var r=e[n],i=this.kernelSize.concat([r,this.filters]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:(t={},t[n]=r,t)}],this.built=!0},t.prototype.call=function(e,t){var n=this;return Object(r.tidy)((function(){var t;e=nt(e);var i=null==n.bias?null:n.bias.read(),a=M(n.activation.getClassName());if(null!=a&&2===n.rank)t=br(e,n.kernel.read(),i,n.strides,n.padding,n.dataFormat,n.dilationRate,a);else{if(1===n.rank)t=function(e,t,n,i,a,o,s){return void 0===i&&(i=1),void 0===a&&(a="valid"),void 0===s&&(s=1),Object(r.tidy)((function(){if(null==o&&(o="channelsLast"),Y(o),3!==e.shape.length)throw new h("The input of a conv1dWithBias operation should be 3, but is "+e.shape.length+" instead.");if(3!==t.shape.length)throw new h("The kernel for a conv1dWithBias operation should be 3, but is "+t.shape.length+" instead");if(null!=n&&1!==n.shape.length)throw new h("The bias for a conv1dWithBias operation should be 1, but is "+t.shape.length+" instead");if("channelsFirst"===o&&(e=Object(r.transpose)(e,[0,2,1])),"causal"===a)throw new p("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var u=Object(r.conv1d)(e,t,i,"same"===a?"same":"valid","NWC",s);return null!=n&&(u=Ee(u,n)),u}))}(e,n.kernel.read(),i,n.strides[0],n.padding,n.dataFormat,n.dilationRate[0]);else if(2===n.rank)t=br(e,n.kernel.read(),i,n.strides,n.padding,n.dataFormat,n.dilationRate);else{if(3!==n.rank)throw new p("convolutions greater than 3D are not implemented yet.");t=function(e,t,n,i,a,o,s){return void 0===i&&(i=[1,1,1]),void 0===a&&(a="valid"),Object(r.tidy)((function(){if(null==o&&(o="channelsLast"),Y(o),4!==e.rank&&5!==e.rank)throw new h("conv3dWithBias expects input to be of rank 4 or 5, but received "+e.rank+".");if(4!==t.rank&&5!==t.rank)throw new h("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+e.rank+".");var u=yr(e,o);if("causal"===a)throw new p("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return u=Object(r.conv3d)(u,t,i,"same"===a?"same":"valid","NDHWC",s),null!=n&&(u=Ee(u,n)),"channelsFirst"===o&&(u=Object(r.transpose)(u,[0,4,1,2,3])),u}))}(e,n.kernel.read(),i,n.strides,n.padding,n.dataFormat,n.dilationRate)}null!=n.activation&&(t=n.activation.apply(t))}return t}))},t.prototype.computeOutputShape=function(e){e=rt(e);for(var t=[],n="channelsLast"===this.dataFormat?e.slice(1,e.length-1):e.slice(2),r=0;r<n.length;++r){var i=mr(n[r],this.kernelSize[r],this.padding,this.strides[r],"number"==typeof this.dilationRate?this.dilationRate:this.dilationRate[r]);t.push(i)}var a=[e[0]];return"channelsLast"===this.dataFormat?(a=a.concat(t)).push(this.filters):(a.push(this.filters),a=a.concat(t)),a},t.prototype.getConfig=function(){var t={filters:this.filters,kernelInitializer:Xe(this.kernelInitializer),kernelRegularizer:ar(this.kernelRegularizer),kernelConstraint:z(this.kernelConstraint)},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.verifyArgs=function(e){if(!("filters"in e)||"number"!=typeof e.filters||e.filters<1)throw new h("Convolution layer expected config.filters to be a 'number' > 0 but got "+JSON.stringify(e.filters))},t}(xr),_r=function(e){function t(n){var r=e.call(this,2,n)||this;return t.verifyArgs(n),r}return a(t,e),t.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this);return delete t.rank,t},t.verifyArgs=function(e){if("number"!=typeof e.kernelSize&&!T(e.kernelSize,"number",1,2))throw new h("Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received "+JSON.stringify(e.kernelSize)+".")},t.className="Conv2D",t}(wr);r.serialization.registerClass(_r);var kr=function(e){function t(n){var r=e.call(this,3,n)||this;return t.verifyArgs(n),r}return a(t,e),t.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this);return delete t.rank,t},t.verifyArgs=function(e){if("number"!=typeof e.kernelSize&&(!Array.isArray(e.kernelSize)||1!==e.kernelSize.length&&3!==e.kernelSize.length))throw new h("Conv3D expects config.kernelSize to be number or [number, number, number], but received "+JSON.stringify(e.kernelSize)+".")},t.className="Conv3D",t}(wr);r.serialization.registerClass(kr);var Er=function(e){function t(t){var n=e.call(this,t)||this;if(n.inputSpec=[new lt({ndim:4})],"same"!==n.padding&&"valid"!==n.padding)throw new h("Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode "+n.padding);return n}return a(t,e),t.prototype.build=function(e){var t;if(4!==(e=rt(e)).length)throw new h("Input should have rank 4; Received input shape: "+JSON.stringify(e));var n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n])throw new h("The channel dimension of the inputs should be defined. Found `None`.");var r=e[n],i=this.kernelSize.concat([this.filters,r]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new lt({ndim:4,axes:(t={},t[n]=r,t)})],this.built=!0},t.prototype.call=function(e,t){var n=this;return Object(r.tidy)((function(){var t=nt(e);if(4!==t.shape.length)throw new h("Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-"+t.shape.length);var i,a,o=t.shape,s=o[0];"channelsFirst"===n.dataFormat?(i=2,a=3):(i=1,a=2);var u=o[i],c=o[a],l=n.kernelSize[0],f=n.kernelSize[1],d=n.strides[0],p=n.strides[1],m=[s,vr(u,d,l,n.padding),vr(c,p,f,n.padding),n.filters];"channelsLast"!==n.dataFormat&&(t=Object(r.transpose)(t,[0,2,3,1]));var v=Object(r.conv2dTranspose)(t,n.kernel.read(),m,n.strides,n.padding);return"channelsLast"!==n.dataFormat&&(v=Object(r.transpose)(v,[0,3,1,2])),null!=n.bias&&(v=Ee(v,n.bias.read(),n.dataFormat)),null!=n.activation&&(v=n.activation.apply(v)),v}))},t.prototype.computeOutputShape=function(e){var t,n,r,i=(e=rt(e)).slice();"channelsFirst"===this.dataFormat?(t=1,n=2,r=3):(t=3,n=1,r=2);var a=this.kernelSize[0],o=this.kernelSize[1],s=this.strides[0],u=this.strides[1];return i[t]=this.filters,i[n]=vr(i[n],s,a,this.padding),i[r]=vr(i[r],u,o,this.padding),i},t.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this);return delete t.dilationRate,t},t.className="Conv2DTranspose",t}(_r);r.serialization.registerClass(Er);var Sr=function(e){function t(t){return e.call(this,2,t)||this}return a(t,e),t.className="SeparableConv2D",t}(function(e){function t(t,n){var r=e.call(this,t,n)||this;if(r.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",r.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",r.depthwiseKernel=null,r.pointwiseKernel=null,null==n.filters)throw new h("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=n.kernelInitializer||null!=n.kernelRegularizer||null!=n.kernelConstraint)throw new h("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=n.padding&&"same"!==n.padding&&"valid"!==n.padding)throw new h("SeparableConv"+r.rank+"D supports only padding modes: 'same' and 'valid', but received "+JSON.stringify(n.padding));return r.depthMultiplier=null==n.depthMultiplier?1:n.depthMultiplier,r.depthwiseInitializer=Ke(n.depthwiseInitializer||r.DEFAULT_DEPTHWISE_INITIALIZER),r.depthwiseRegularizer=sr(n.depthwiseRegularizer),r.depthwiseConstraint=W(n.depthwiseConstraint),r.pointwiseInitializer=Ke(n.depthwiseInitializer||r.DEFAULT_POINTWISE_INITIALIZER),r.pointwiseRegularizer=sr(n.pointwiseRegularizer),r.pointwiseConstraint=W(n.pointwiseConstraint),r}return a(t,e),t.prototype.build=function(e){var t;if((e=rt(e)).length<this.rank+2)throw new h("Inputs to SeparableConv"+this.rank+"D should have rank "+(this.rank+2)+", but received input shape: "+JSON.stringify(e));var n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n]||e[n]<0)throw new h("The channel dimension of the inputs should be defined, but found "+JSON.stringify(e[n]));for(var r=e[n],i=this.kernelSize.concat([r,this.depthMultiplier]),a=[],o=0;o<this.rank;++o)a.push(1);a.push(r*this.depthMultiplier,this.filters),this.depthwiseKernel=this.addWeight("depthwise_kernel",i,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",a,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,!0,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.inputSpec=[new lt({ndim:this.rank+2,axes:(t={},t[n]=r,t)})],this.built=!0},t.prototype.call=function(e,t){var n=this;return Object(r.tidy)((function(){var t;if(e=nt(e),1===n.rank)throw new p("1D separable convolution is not implemented yet.");return 2===n.rank&&("channelsFirst"===n.dataFormat&&(e=Object(r.transpose)(e,[0,2,3,1])),t=Object(r.separableConv2d)(e,n.depthwiseKernel.read(),n.pointwiseKernel.read(),n.strides,n.padding,n.dilationRate,"NHWC")),n.useBias&&(t=Ee(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),"channelsFirst"===n.dataFormat&&(t=Object(r.transpose)(t,[0,3,1,2])),t}))},t.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this);return delete t.rank,delete t.kernelInitializer,delete t.kernelRegularizer,delete t.kernelConstraint,t.depthwiseInitializer=Xe(this.depthwiseInitializer),t.pointwiseInitializer=Xe(this.pointwiseInitializer),t.depthwiseRegularizer=ar(this.depthwiseRegularizer),t.pointwiseRegularizer=ar(this.pointwiseRegularizer),t.depthwiseConstraint=z(this.depthwiseConstraint),t.pointwiseConstraint=z(this.pointwiseConstraint),t},t.className="SeparableConv",t}(wr));r.serialization.registerClass(Sr);var Cr=function(e){function t(n){var r=e.call(this,1,n)||this;return t.verifyArgs(n),r.inputSpec=[{ndim:3}],r}return a(t,e),t.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this);return delete t.rank,delete t.dataFormat,t},t.verifyArgs=function(e){if("number"!=typeof e.kernelSize&&!T(e.kernelSize,"number",1,1))throw new h("Conv1D expects config.kernelSize to be number or number[] with length 1, but received "+JSON.stringify(e.kernelSize)+".")},t.className="Conv1D",t}(wr);r.serialization.registerClass(Cr);var Ar=function(e){function t(t){var n=e.call(this,t)||this;return"number"==typeof t.cropping?n.cropping=[[t.cropping,t.cropping],[t.cropping,t.cropping]]:"number"==typeof t.cropping[0]?n.cropping=[[t.cropping[0],t.cropping[0]],[t.cropping[1],t.cropping[1]]]:n.cropping=t.cropping,n.dataFormat=void 0===t.dataFormat?"channelsLast":t.dataFormat,n.inputSpec=[{ndim:4}],n}return a(t,e),t.prototype.computeOutputShape=function(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]},t.prototype.call=function(e,t){var n=this;return Object(r.tidy)((function(){return e=nt(e),"channelsLast"===n.dataFormat?me(me(e,n.cropping[0][0],e.shape[1]-n.cropping[0][0]-n.cropping[0][1],2),n.cropping[1][0],e.shape[2]-n.cropping[1][1]-n.cropping[1][0],3):me(me(e,n.cropping[0][0],e.shape[2]-n.cropping[0][0]-n.cropping[0][1],3),n.cropping[1][0],e.shape[3]-n.cropping[1][1]-n.cropping[1][0],4)}))},t.prototype.getConfig=function(){var t={cropping:this.cropping,dataFormat:this.dataFormat},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="Cropping2D",t}(mt);r.serialization.registerClass(Ar);var Or=function(e){function t(t){var n=e.call(this,t)||this;return n.DEFAULT_SIZE=[2,2],n.inputSpec=[{ndim:4}],n.size=null==t.size?n.DEFAULT_SIZE:t.size,n.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,n}return a(t,e),t.prototype.computeOutputShape=function(e){if("channelsFirst"===this.dataFormat){var t=null==e[2]?null:this.size[0]*e[2],n=null==e[3]?null:this.size[1]*e[3];return[e[0],e[1],t,n]}return t=null==e[1]?null:this.size[0]*e[1],n=null==e[2]?null:this.size[1]*e[2],[e[0],t,n,e[3]]},t.prototype.call=function(e,t){var n=this;return Object(r.tidy)((function(){var t=nt(e),i=t.shape;if("channelsFirst"===n.dataFormat){t=Object(r.transpose)(t,[0,2,3,1]);var a=n.size[0]*i[2],o=n.size[1]*i[3],s=t.resizeNearestNeighbor([a,o]);return Object(r.transpose)(s,[0,3,1,2])}return a=n.size[0]*i[1],o=n.size[1]*i[2],t.resizeNearestNeighbor([a,o])}))},t.prototype.getConfig=function(){var t={size:this.size,dataFormat:this.dataFormat},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="UpSampling2D",t}(mt);r.serialization.registerClass(Or);var Dr=function(e){function t(t){var n=e.call(this,2,t)||this;return n.depthwiseKernel=null,n.depthMultiplier=null==t.depthMultiplier?1:t.depthMultiplier,n.depthwiseInitializer=Ke(t.depthwiseInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.depthwiseConstraint=W(t.depthwiseConstraint),n.depthwiseRegularizer=sr(t.depthwiseRegularizer),n}return a(t,e),t.prototype.build=function(e){if((e=rt(e)).length<4)throw new h("Inputs to DepthwiseConv2D should have rank 4. Received input shape: "+JSON.stringify(e)+".");var t="channelsFirst"===this.dataFormat?1:3;if(null==e[t]||e[t]<0)throw new h("The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not ("+e[t]+").");var n=e[t],r=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},t.prototype.call=function(e,t){var n=this;return Object(r.tidy)((function(){var t=function(e,t,n,i,a,o){return void 0===n&&(n=[1,1]),void 0===i&&(i="valid"),Object(r.tidy)((function(){null==a&&(a="channelsLast"),Y(a);var s=gr(e,a);if(4!==e.rank)throw new h("Input for depthwiseConv2d is required to be 4-D, but is instead "+e.rank+"-D");if(4!==t.rank)throw new h("depthwiseKernel is required to be 4-D, but is instead "+t.rank+"-D");return s=Object(r.depthwiseConv2d)(s,t,n,"same"===i?"same":"valid","NHWC",o),"channelsFirst"===a&&(s=Object(r.transpose)(s,[0,3,1,2])),s}))}(e=nt(e),n.depthwiseKernel.read(),n.strides,n.padding,n.dataFormat,null);return n.useBias&&(t=Ee(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),t}))},t.prototype.computeOutputShape=function(e){e=rt(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,i=mr(t,this.kernelSize[0],this.padding,this.strides[0]),a=mr(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[e[0],r,i,a]:[e[0],i,a,r]},t.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this);return t.depthMultiplier=this.depthMultiplier,t.depthwiseInitializer=Xe(this.depthwiseInitializer),t.depthwiseRegularizer=ar(this.depthwiseRegularizer),t.depthwiseConstraint=z(this.depthwiseRegularizer),t},t.className="DepthwiseConv2D",t}(xr);r.serialization.registerClass(Dr);var Tr=function(e){function t(t){var n=e.call(this,t)||this;return n.rate=Math.max(Math.min(t.rate,1),0),n.noiseShape=t.noiseShape,n.seed=t.seed,n.supportsMasking=!0,n}return a(t,e),t.prototype.getNoiseShape=function(e){if(null==this.noiseShape)return this.noiseShape;for(var t=e.shape,n=[],r=0;r<this.noiseShape.length;++r)n.push(null==this.noiseShape[r]?t[r]:this.noiseShape[r]);return n},t.prototype.call=function(e,t){var n=this;return Object(r.tidy)((function(){n.invokeCallHook(e,t);var r=nt(e);if(0<n.rate&&n.rate<1){var i=null!=t.training&&t.training,a=n.getNoiseShape(r);return Ce((function(){return Se(r,n.rate,a,n.seed)}),(function(){return r}),i)}return e}))},t.prototype.getConfig=function(){var t={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.prototype.dispose=function(){return e.prototype.dispose.call(this)},t.className="Dropout",t}(mt);r.serialization.registerClass(Tr);var jr=function(e){function t(t){var n=e.call(this,t)||this;return n.inputSpec=[{ndim:3}],n}return a(t,e),t.prototype.getNoiseShape=function(e){var t=e.shape;return[t[0],1,t[2]]},t.className="SpatialDropout1D",t}(Tr);r.serialization.registerClass(jr);var Mr=function(e){function t(t){var n=e.call(this,t)||this;if(n.activation=null,n.useBias=!0,n.kernel=null,n.bias=null,n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_BIAS_INITIALIZER="zeros",null==t.batchInputShape&&null==t.inputShape&&null!=t.inputDim){var r=null;null!=t.batchSize&&(r=t.batchSize),n.batchInputShape=[r,t.inputDim]}return n.units=t.units,j(n.units,"units"),n.activation=er(t.activation),null!=t.useBias&&(n.useBias=t.useBias),n.kernelInitializer=Ke(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.biasInitializer=Ke(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelConstraint=W(t.kernelConstraint),n.biasConstraint=W(t.biasConstraint),n.kernelRegularizer=sr(t.kernelRegularizer),n.biasRegularizer=sr(t.biasRegularizer),n.activityRegularizer=sr(t.activityRegularizer),n.supportsMasking=!0,n.inputSpec=[{minNDim:2}],n}return a(t,e),t.prototype.build=function(e){var t,n=(e=rt(e))[e.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[n,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:(t={},t[-1]=n,t)}],this.built=!0},t.prototype.computeOutputShape=function(e){var t=(e=rt(e)).slice();return t[t.length-1]=this.units,t},t.prototype.call=function(e,t){var n=this;return Object(r.tidy)((function(){n.invokeCallHook(e,t);var r,i=nt(e),a=M(n.activation.getClassName());return null!=a?r=xe(i,n.kernel.read(),a,n.bias?n.bias.read():null):(r=xe(i,n.kernel.read()),null!=n.bias&&(r=Ee(r,n.bias.read())),null!=n.activation&&(r=n.activation.apply(r))),r}))},t.prototype.getConfig=function(){var t={units:this.units,activation:Zn(this.activation),useBias:this.useBias,kernelInitializer:Xe(this.kernelInitializer),biasInitializer:Xe(this.biasInitializer),kernelRegularizer:ar(this.kernelRegularizer),biasRegularizer:ar(this.biasRegularizer),activityRegularizer:ar(this.activityRegularizer),kernelConstraint:z(this.kernelConstraint),biasConstraint:z(this.biasConstraint)},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="Dense",t}(mt);r.serialization.registerClass(Mr);var Fr=function(e){function t(t){var n=this;return t=t||{},(n=e.call(this,t)||this).inputSpec=[{minNDim:3}],n.dataFormat=t.dataFormat,n}return a(t,e),t.prototype.computeOutputShape=function(e){for(var t=0,n=(e=rt(e)).slice(1);t<n.length;t++)if(null==n[t])throw new h('The shape of the input to "Flatten" is not fully defined (got '+e.slice(1)+'). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.');return[e[0],oe(e,1)]},t.prototype.call=function(e,t){var n=this;return Object(r.tidy)((function(){n.invokeCallHook(e,t);var r=nt(e);if("channelsFirst"===n.dataFormat&&r.rank>1){for(var i=[0],a=2;a<r.rank;++a)i.push(a);i.push(1),r=r.transpose(i)}return function(e){if(e.rank<=1)throw new h("batchFlatten requires a minimum rank of 2. Got rank: "+e.rank+".");var t=[e.shape[0],oe(e.shape,1)];return e.reshape(t)}(r)}))},t.prototype.getConfig=function(){var t={};null!=this.dataFormat&&(t.dataFormat=this.dataFormat);var n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="Flatten",t}(mt);r.serialization.registerClass(Fr);var Ir=function(e){function t(t){var n=e.call(this,t)||this;return n.supportsMasking=!0,n.activation=er(t.activation),n}return a(t,e),t.prototype.call=function(e,t){var n=this;return Object(r.tidy)((function(){n.invokeCallHook(e,t);var r=nt(e);return n.activation.apply(r)}))},t.prototype.getConfig=function(){var t={activation:Zn(this.activation)},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="Activation",t}(mt);r.serialization.registerClass(Ir);var Nr=function(e){function t(t){var n=e.call(this,t)||this;return n.n=t.n,n.inputSpec=[{ndim:2}],n}return a(t,e),t.prototype.computeOutputShape=function(e){return[e[0],this.n,e[1]]},t.prototype.call=function(e,t){var n=this;return Object(r.tidy)((function(){return function(e,t){return Object(r.tidy)((function(){if(2!==e.shape.length)throw new h("repeat() expects a rank-2 tensor, but received a rank-"+e.shape.length+" tensor.");return ye(de(e,1),[1,t,1])}))}(e=nt(e),n.n)}))},t.prototype.getConfig=function(){var t={n:this.n},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="RepeatVector",t}(mt);r.serialization.registerClass(Nr);var Rr=function(e){function t(t){var n=e.call(this,t)||this;n.targetShape=t.targetShape;for(var r=0;r<n.targetShape.length;++r)n.isUnknown(n.targetShape[r])&&(n.targetShape[r]=null);return n}return a(t,e),t.prototype.isUnknown=function(e){return e<0||null==e},t.prototype.fixUnknownDimension=function(e,t){for(var n="Total size of new array must be unchanged.",r=t.slice(),i=1,a=null,o=0;o<r.length;++o){var s=r[o];if(this.isUnknown(s)){if(null!==a)throw new h("Can only specifiy one unknown dimension.");a=o}else i*=s}var u=oe(e);if(null!==a){if(0===i||u%i!=0)throw new h(n);r[a]=u/i}else if(u!==i)throw new h(n);return r},t.prototype.computeOutputShape=function(e){for(var t=!1,n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))},t.prototype.call=function(e,t){var n=this;return Object(r.tidy)((function(){n.invokeCallHook(e,t);var r=nt(e),i=r.shape,a=i.slice(0,1).concat(n.fixUnknownDimension(i.slice(1),n.targetShape));return r.reshape(a)}))},t.prototype.getConfig=function(){var t={targetShape:this.targetShape},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="Reshape",t}(mt);r.serialization.registerClass(Rr);var Pr=function(e){function t(t){var n=e.call(this,t)||this;if(null==t.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(t.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+t.dims+" instead.");var i=le(1,t.dims.length+1);if(!r.util.arraysEqual(t.dims.slice().sort(),i))throw new Error("Invalid permutation `dims`: "+JSON.stringify(t.dims)+" `dims` must contain consecutive integers starting from 1.");return n.dims=t.dims,n.dimsIncludingBatch=[0].concat(n.dims),n.inputSpec=[new lt({ndim:n.dims.length+1})],n}return a(t,e),t.prototype.computeOutputShape=function(e){var t=(e=rt(e)).slice();return this.dims.forEach((function(n,r){t[r+1]=e[n]})),t},t.prototype.call=function(e,t){return Object(r.transpose)(nt(e),this.dimsIncludingBatch)},t.prototype.getConfig=function(){var t={dims:this.dims},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="Permute",t}(mt);r.serialization.registerClass(Pr);var Br=function(e){function t(t){var n=e.call(this,null==t?{}:t)||this;return n.supportsMasking=!0,n.maskValue=null!=t?null==t.maskValue?0:t.maskValue:0,n}return a(t,e),t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this),n={maskValue:this.maskValue};return Object.assign(n,t),n},t.prototype.computeMask=function(e,t){var n=nt(e);return Object(r.any)(Object(r.notEqual)(n,this.maskValue),-1)},t.prototype.call=function(e,t){var n=this;return Object(r.tidy)((function(){n.invokeCallHook(e,t);var i=nt(e),a=Object(r.any)(Object(r.notEqual)(i,n.maskValue),-1,!0);return i.mul(a.asType(i.dtype))}))},t.className="Masking",t}(mt);r.serialization.registerClass(Br);var Lr=function(e){function t(t){var n=e.call(this,t)||this;if(n.embeddings=null,n.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==t.batchInputShape&&null==t.inputShape){var r=null;null!=t.batchSize&&(r=t.batchSize),null==t.inputLength?n.batchInputShape=[r,null]:n.batchInputShape=[r].concat(x(t.inputLength))}return n.inputDim=t.inputDim,j(n.inputDim,"inputDim"),n.outputDim=t.outputDim,j(n.outputDim,"outputDim"),n.embeddingsInitializer=Ke(t.embeddingsInitializer||n.DEFAULT_EMBEDDINGS_INITIALIZER),n.embeddingsRegularizer=sr(t.embeddingsRegularizer),n.activityRegularizer=sr(t.activityRegularizer),n.embeddingsConstraint=W(t.embeddingsConstraint),n.maskZero=t.maskZero,n.supportsMasking=t.maskZero,n.inputLength=t.inputLength,n}return a(t,e),t.prototype.build=function(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0},t.prototype.warnOnIncompatibleInputShape=function(e){},t.prototype.computeMask=function(e,t){var n=this;return Object(r.tidy)((function(){return n.maskZero?(e=nt(e),Object(r.notEqual)(e,Object(r.zerosLike)(e))):null}))},t.prototype.computeOutputShape=function(e){if(e=rt(e),null==this.inputLength)return e.concat([this.outputDim]);var t=x(this.inputLength);if(t.length!==e.length-1)throw new h('"inputLength" is '+this.inputLength+", but received input shape has shape "+e);for(var n=0,r=0;r<t.length;++r){var i=t[r],a=e[r+1];if(null!=i&&null!=a&&i!==a)throw new h('"inputLength" is '+this.inputLength+", but received input shape has shape "+e);null==i&&(t[n]=a),n++}return[e[0]].concat(t,[this.outputDim])},t.prototype.call=function(e,t){var n=this;return Object(r.tidy)((function(){n.invokeCallHook(e,t);var r=nt(e);return"int32"!==r.dtype&&(r=fe(r,"int32")),we(n.embeddings.read(),r.as1D()).reshape(rt(n.computeOutputShape(r.shape)))}))},t.prototype.getConfig=function(){var t={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Xe(this.embeddingsInitializer),embeddingsRegularizer:ar(this.embeddingsRegularizer),activityRegularizer:ar(this.activityRegularizer),embeddingsConstraint:z(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="Embedding",t}(mt);r.serialization.registerClass(Lr);var zr=function(e){function t(t){var n=e.call(this,t||{})||this;return n.supportsMasking=!0,n}return a(t,e),t.prototype.mergeFunction=function(e){throw new p},t.prototype.computeElementwiseOpOutputShape=function(e,t){if(null==e||null==t)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(0===t.length)return e;for(var n=e.slice(0,e.length-t.length),r=0;r<t.length;++r){var i=e[e.length-t.length+r],a=t[r];if(null==i||null==a||i<0||a<0)n.push(null);else if(1===i)n.push(a);else if(1===a)n.push(i);else{if(i!==a)throw new h("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(i)}}return n},t.prototype.build=function(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[rt(e)]),e.length<2)throw new h("A merge layer should be called on an Array of at least 2 inputs. Got "+e.length+" input(s).");for(var t=[],n=0,r=e;n<r.length;n++)null!=(o=r[n])&&null!==o[0]&&t.push(o[0]);if((t=A(t)).length>1)throw new h("Can not merge tensors with different batch sizes. Got tensors with shapes: "+JSON.stringify(e)+".");for(var i=null==e[0]?null:e[0].slice(1),a=1;a<e.length;++a){var o=null==e[a]?null:e[a].slice(1);i=this.computeElementwiseOpOutputShape(i,o)}var s=e.map((function(e){return e.length}));-1===e.indexOf(null)&&1===A(s).length?this.reshapeRequired=!1:this.reshapeRequired=!0},t.prototype.call=function(e,t){var n=this;return Object(r.tidy)((function(){if(n.reshapeRequired){var t=[],i=e.map((function(e){return e.rank}));if(-1===i.indexOf(null)){for(var a=ce(i),o=0,s=e;o<s.length;o++){for(var u=(h=s[o]).rank,c=0;c<a-u;++c)h=de(h,1);t.push(h)}return n.mergeFunction(t)}for(var l=!1,f=0,d=e;f<d.length;f++){var h;if(null==(u=(h=d[f]).rank)){var p=h.shape,m=p[0],v=p.slice(1).concat([m]),g=h.reshape([m].concat(oe(p.slice(1))));g=(g=Object(r.transpose)(g,[1,0])).reshape(v),t.push(g),l=!0}else if(u>1){var y=le(1,u).concat([0]);t.push(Object(r.transpose)(h,y)),l=!0}else t.push(h)}var b=n.mergeFunction(t),x=b.rank;if(l)if(null==x){var w=b.shape;v=[m=w[w.length-1]].concat(w.slice(0,w.length-1)),b=Object(r.transpose)(b.reshape([-1,m]),[1,0]).reshape(v)}else x>1&&(y=[x-1].concat(le(0,x-1)),b=Object(r.transpose)(b,y));return b}return n.mergeFunction(e)}))},t.prototype.computeOutputShape=function(e){var t;t=null==e[0]?null:e[0].slice(1);for(var n=1;n<e.length;++n){var r=null==e[n]?null:e[n].slice(1);t=this.computeElementwiseOpOutputShape(t,r)}for(var i=[],a=0,o=e;a<o.length;a++)null!=(r=o[a])&&null!==r[0]&&i.push(r[0]);return 1===(i=A(i)).length?i.concat(t):[null].concat(t)},t.prototype.computeMask=function(e,t){return Object(r.tidy)((function(){if(null==t)return null;if(!Array.isArray(t))throw new h("`mask` should be an Array");if(!Array.isArray(e))throw new h("`inputs` should be an Array");if(t.length!==e.length)throw new h("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths ("+e.length+" vs "+t.length+")");if(t.every((function(e){return null==e})))return null;for(var n=(t=t.map((function(e){return null==e?e:Object(r.expandDims)(e,0)})))[0],i=1;i<t.length-1;++i)n=Object(r.logicalAnd)(n,t[i]);return n}))},t}(mt),Ur=function(e){function t(t){return e.call(this,t)||this}return a(t,e),t.prototype.mergeFunction=function(e){return Object(r.tidy)((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=Object(r.add)(t,e[n]);return t}))},t.className="Add",t}(zr);r.serialization.registerClass(Ur);var Wr=function(e){function t(t){return e.call(this,t)||this}return a(t,e),t.prototype.mergeFunction=function(e){return Object(r.tidy)((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=Object(r.mul)(t,e[n]);return t}))},t.className="Multiply",t}(zr);r.serialization.registerClass(Wr);var Vr=function(e){function t(t){return e.call(this,t)||this}return a(t,e),t.prototype.mergeFunction=function(e){return Object(r.tidy)((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=Object(r.add)(t,e[n]);return Object(r.mul)(1/e.length,t)}))},t.className="Average",t}(zr);r.serialization.registerClass(Vr);var Gr=function(e){function t(t){return e.call(this,t)||this}return a(t,e),t.prototype.mergeFunction=function(e){return Object(r.tidy)((function(){for(var t=e[0],n=1;n<e.length;++n)t=Object(r.maximum)(t,e[n]);return t}))},t.className="Maximum",t}(zr);r.serialization.registerClass(Gr);var qr=function(e){function t(t){return e.call(this,t)||this}return a(t,e),t.prototype.mergeFunction=function(e){return Object(r.tidy)((function(){for(var t=e[0],n=1;n<e.length;++n)t=Object(r.minimum)(t,e[n]);return t}))},t.className="Minimum",t}(zr);r.serialization.registerClass(qr);var Hr=function(e){function t(t){var n=e.call(this,t)||this;return n.DEFAULT_AXIS=-1,null==t&&(t={}),n.axis=null==t.axis?n.DEFAULT_AXIS:t.axis,n.supportsMasking=!0,n.reshapeRequired=!1,n}return a(t,e),t.prototype.build=function(e){if(!Array.isArray(e)||!Array.isArray(e[0])||1===e.length)throw new h("A `Concatenate` layer should be called on a list of at least 2 inputs");for(var t=!0,n=0,i=e;n<i.length;n++)if(null!=(f=i[n])){t=!1;break}if(!t){for(var a=[],o=0;o<e.length;++o){var s=e[o].slice();s.splice(this.axis,1);for(var u=!1,c=0,l=a;c<l.length;c++){var f=l[c];if(r.util.arraysEqual(f,s)){u=!0;break}}u||a.push(s)}if(a.length>1)throw new h("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}},t.prototype.mergeFunction=function(e){var t=this;return Object(r.tidy)((function(){return ve(e,t.axis)}))},t.prototype.computeOutputShape=function(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new h("A `Concatenate` layer should be called on a list of inputs.");for(var t=e,n=t[0].slice(),r=this.axis<0?n.length+this.axis:this.axis,i=0,a=t.slice(1);i<a.length;i++){var o=a[i];if(null==n[r]||null==o[r]){n[r]=null;break}n[r]+=o[r]}return n},t.prototype.computeMask=function(e,t){var n=this;if(null==t)return null;if(!Array.isArray(t))throw new h("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new h("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new h("Mismatch in the length of mask ("+t.length+") and the legnth of inputs ("+e.length+")");return Object(r.tidy)((function(){var i=!0;if(t.forEach((function(e){null==e||(i=!1)})),i)return null;for(var a=[],o=0;o<e.length;++o)null==t[o]?a.push(Object(r.onesLike)(e[o]).asType("bool")):t[o].rank<e[o].rank?a.push(Object(r.expandDims)(t[o],-1)):a.push(t[o]);var s=Object(r.concat)(a,n.axis);return Object(r.all)(s,-1,!1)}))},t.prototype.getConfig=function(){var t={axis:this.axis},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="Concatenate",t}(zr);function Xr(e,t){for(;e<0;)e+=t;return e}r.serialization.registerClass(Hr);var Kr=function(e){function t(t){var n=e.call(this,t)||this;return n.axes=t.axes,n.normalize=null!=t.normalize&&t.normalize,n.supportsMasking=!0,n.reshapeRequired=!1,n}return a(t,e),t.prototype.build=function(e){r.util.assert(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var t=e[0],n=e[1];if(t.length>3||n.length>3)throw new p("Dot layer does not support tensors of 4D or higher rank yet.");var i=this.interpretAxes(t,n);if(t[i[0]]!==n[i[1]])throw new h("Dimension incompatibility: "+t[i[0]]+" !== "+n[i[1]])},t.prototype.mergeFunction=function(e){if(2!==e.length)throw new h("A `Dot` layer must be called on exactly 2 inputs, but received "+e.length+" input(s).");var t,n=e[0],i=e[1];return t=Array.isArray(this.axes)?this.axes.map((function(t,n){return Xr(t,e[n].shape.length)})):[Xr(this.axes,n.shape.length),Xr(this.axes,i.shape.length)],this.normalize&&(n=Tt(n,t[0]),i=Tt(i,t[1])),function(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new p("batchDot is not implemented for tensors of 4D or higher rank yet");if(r.util.assert(e.shape.length>=2,(function(){return"batchDot requires the rank of x to be >= 2, but got "+e.shape.length})),r.util.assert(e.shape.length>=2,(function(){return"batchDot requires the rank of y to be >= 2, but got "+t.shape.length})),"number"==typeof n&&(n=[n,n]),"complex64"===e.dtype||"complex64"===t.dtype)throw new p("batchDot is not implemented for complex64-type Tensors yet.");var i=e.shape.length,a=t.shape.length;null==n&&(n=[i-1,a-2]);var o=n;return Object(r.tidy)((function(){var n,r;if(i>a){n=i-a;for(var s=[],u=0;u<n;++u)s.push(1);t=t.reshape(t.shape.concat(s))}else if(a>i){for(n=a-i,s=[],u=0;u<n;++u)s.push(1);e=e.reshape(e.shape.concat(s))}else n=0;if(2===e.shape.length&&2===t.shape.length)r=o[0]===o[1]?e.mulStrict(t).sum(o[0]):e.transpose([1,0]).mulStrict(t).sum(o[1]);else{var c=o[0]!==e.shape.length-1,l=o[1]===t.shape.length-1;r=e.matMul(t,c,l)}if(n>0){var f,d=[];for(u=f=i>a?i+a-3:i-1;u<f+n;++u)d.push(u);r=r.squeeze(d)}return 1===r.shape.length&&(r=r.expandDims(1)),r}))}(n,i,t)},t.prototype.interpretAxes=function(e,t){return Array.isArray(this.axes)?this.axes:[Xr(this.axes,e.length),Xr(this.axes,t.length)]},t.prototype.computeOutputShape=function(e){r.util.assert(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var t=e[0].slice(),n=e[1].slice();if(t.length>3||n.length>3)throw new p("Dot layer does not support tensors of 4D or higher rank yet.");var i=this.interpretAxes(t,n);t.splice(i[0],1),n.splice(i[1],1),n.splice(0,1);var a=t.concat(n);return 1===a.length&&a.push(1),a},t.prototype.computeMask=function(e,t){return null},t.prototype.getConfig=function(){var t={axes:this.axes,normalize:this.normalize},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="Dot",t}(zr);r.serialization.registerClass(Kr);var Yr=function(e){function t(t){var n=e.call(this,t)||this;return n.supportsMasking=!0,n.stddev=t.stddev,n}return a(t,e),t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this),n={stddev:this.stddev};return Object.assign(n,t),n},t.prototype.call=function(e,t){var n=this;return Object(r.tidy)((function(){n.invokeCallHook(e,t);var r=nt(e);return Ce((function(){return be(r.shape,0,n.stddev).add(r)}),(function(){return r}),t.training||!1)}))},t.className="GaussianNoise",t}(mt);r.serialization.registerClass(Yr);var $r=function(e){function t(t){var n=e.call(this,t)||this;return n.supportsMasking=!0,n.rate=t.rate,n}return a(t,e),t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this),n={rate:this.rate};return Object.assign(n,t),n},t.prototype.call=function(e,t){var n=this;return Object(r.tidy)((function(){n.invokeCallHook(e,t);var r=nt(e);return n.rate>0&&n.rate<1?Ce((function(){var e=Math.sqrt(n.rate/(1-n.rate));return r.mul(be(r.shape,1,e))}),(function(){return r}),t.training||!1):r}))},t.className="GaussianDropout",t}(mt);r.serialization.registerClass($r);var Jr=function(e){function t(t){var n=e.call(this,t)||this;return n.supportsMasking=!0,n.rate=t.rate,n.noiseShape=t.noiseShape,n}return a(t,e),t.prototype._getNoiseShape=function(e){return this.noiseShape||nt(e).shape},t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this),n={rate:this.rate};return Object.assign(n,t),n},t.prototype.call=function(e,t){var n=this;return Object(r.tidy)((function(){if(n.rate<1&&n.rate>0){var i=n._getNoiseShape(e);return Ce((function(){var t=nt(e),a=-1.7580993408473766,o=Object(r.greaterEqual)(Object(r.randomUniform)(i),n.rate);o=fe(o,"float32");var s=Math.pow((1-n.rate)*(1+n.rate*Math.pow(a,2)),-.5),u=-s*a*n.rate;return t.mul(o).add(o.add(-1).mul(a)).mul(s).add(u)}),(function(){return nt(e)}),t.training||!1)}return e}))},t.className="AlphaDropout",t}(mt);function Zr(e,t,n,i,a,o){var s;if(void 0===o&&(o=.001),2===e.rank)s=Object(r.batchNorm2d)(e,t,n,i,a,o);else if(3===e.rank)s=Object(r.batchNorm3d)(e,t,n,i,a,o);else{if(4!==e.rank)throw new p("batchNormalization is not implemented for array of rank "+e.rank+" yet");s=Object(r.batchNorm4d)(e,t,n,i,a,o)}return s}function Qr(e,t,n,i,a){return void 0===a&&(a=.001),r.util.arraysEqual(i.slice().sort(),le(0,e.rank-1))?function(e,t,n,i,a){return void 0===a&&(a=.001),Object(r.tidy)((function(){var o=Object(r.moments)(e,i),s=o.mean,u=o.variance;return[Zr(e,s,u,n,t,a),s,u]}))}(e,t,n,i,a):function(e,t,n,i,a){return void 0===a&&(a=.001),Object(r.tidy)((function(){for(var o=Object(r.moments)(e,i),s=o.mean,u=o.variance,c=[],l=0,f=le(0,e.rank);l<f.length;l++){var d=f[l];-1!==i.indexOf(d)?c.push(1):c.push(e.shape[d])}var h=s.reshape(c),p=u.reshape(c),m=null==t?null:t.reshape(c),v=null==n?null:n.reshape(c);return[Zr(e,h,p,v,m,a),s,u]}))}(e,t,n,i,a)}r.serialization.registerClass(Jr);var ei=function(e){function t(t){var n=this;return null==t&&(t={}),(n=e.call(this,t)||this).supportsMasking=!0,n.axis=null==t.axis?-1:t.axis,n.momentum=null==t.momentum?.99:t.momentum,n.epsilon=null==t.epsilon?.001:t.epsilon,n.center=null==t.center||t.center,n.scale=null==t.scale||t.scale,n.betaInitializer=Ke(t.betaInitializer||"zeros"),n.gammaInitializer=Ke(t.gammaInitializer||"ones"),n.movingMeanInitializer=Ke(t.movingMeanInitializer||"zeros"),n.movingVarianceInitializer=Ke(t.movingVarianceInitializer||"ones"),n.betaConstraint=W(t.betaConstraint),n.gammaConstraint=W(t.gammaConstraint),n.betaRegularizer=sr(t.betaRegularizer),n.gammaRegularizer=sr(t.gammaRegularizer),n}return a(t,e),t.prototype.build=function(e){var t;e=rt(e);var n=this.axis>=0?this.axis:this.axis+e.length,r=e[n];if(null==r)throw new h("Axis "+n+" of input tensor should have a defined dimension but the layer received an input with shape "+JSON.stringify(e)+".");this.inputSpec=[new lt({ndim:e.length,axes:(t={},t[n]=r,t)})];var i=[r];this.scale&&(this.gamma=this.addWeight("gamma",i,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",i,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",i,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",i,null,this.movingVarianceInitializer,null,!1),this.built=!0},t.prototype.call=function(e,t){var n=this;return Object(r.tidy)((function(){var i=null!=t.training&&t.training,a=nt(e),o=a.shape,s=o.length,u=le(0,s),c=n.axis>=0?n.axis:n.axis+s;u.splice(c,1);var l=v(1,s);l[c]=o[c];var f=u.slice();f.sort();var d=!r.util.arraysEqual(f,le(0,s).slice(0,s-1));if(!i)return function(){if(d){var e=n.movingMean.read().reshape(l),t=n.movingVariance.read().reshape(l),r=n.center?n.beta.read().reshape(l):null,i=n.scale?n.gamma.read().reshape(l):null;return Zr(a,e,t,r,i,n.epsilon)}return Zr(a,n.movingMean.read(),n.movingVariance.read(),null==n.beta?null:n.beta.read(),null==n.gamma?null:n.gamma.read(),n.epsilon)}();var h=Qr(a,n.gamma.read(),n.beta.read(),u,n.epsilon),p=h[0],m=h[1],g=h[2],y=function(e,t,n){Object(r.tidy)((function(){var r=1-n,i=e.read(),a=i.sub(t).mul(r);e.write(i.sub(a))}))};return y(n.movingMean,m,n.momentum),y(n.movingVariance,g,n.momentum),p}))},t.prototype.getConfig=function(){var t={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Xe(this.betaInitializer),gammaInitializer:Xe(this.gammaInitializer),movingMeanInitializer:Xe(this.movingMeanInitializer),movingVarianceInitializer:Xe(this.movingVarianceInitializer),betaRegularizer:ar(this.betaRegularizer),gammaRegularizer:ar(this.gammaRegularizer),betaConstraint:z(this.betaConstraint),gammaConstraint:z(this.gammaConstraint)},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="BatchNormalization",t}(mt);r.serialization.registerClass(ei);var ti=function(e){function t(t){var n=this;if(null==t&&(t={}),(n=e.call(this,t)||this).axis=null==t.axis?-1:t.axis,"number"==typeof n.axis){if(!Number.isInteger(n.axis))throw new Error("Expected axis to be an integer, but received "+n.axis)}else{if(!Array.isArray(n.axis))throw new Error("Expected axis to be an integer or an array of integers, but received "+JSON.stringify(n.axis));for(var r=0,i=n.axis;r<i.length;r++){var a=i[r];if(!Number.isInteger(a))throw new Error("Expected axis to be an array of integers, but received "+JSON.stringify(n.axis))}}return n.epsilon=null==t.epsilon?.001:t.epsilon,n.center=null==t.center||t.center,n.scale=null==t.scale||t.scale,n.betaInitializer=Ke(t.betaInitializer||"zeros"),n.gammaInitializer=Ke(t.gammaInitializer||"ones"),n.betaRegularizer=sr(t.betaRegularizer),n.gammaRegularizer=sr(t.gammaRegularizer),n.supportsMasking=!0,n}return a(t,e),t.prototype.build=function(e){var t=(e=rt(e)).length;"number"==typeof this.axis&&(this.axis=[this.axis]);for(var n=0;n<this.axis.length;++n)this.axis[n]<0&&(this.axis[n]+=t);for(var r=0,i=this.axis;r<i.length;r++){var a=i[r];if(a<0||a>=t)throw new Error("Invalid axis: "+a)}if(this.axis.length!==A(this.axis).length)throw new Error("Found duplicate axes in: "+this.axis);var o=this.axis.map((function(t){return e[t]}));this.scale?this.gamma=this.addWeight("gamma",o,"float32",this.gammaInitializer,this.gammaRegularizer,!0):this.gamma=null,this.center?this.beta=this.addWeight("beta",o,"float32",this.betaInitializer,this.betaRegularizer,!0):this.beta=null,this.built=!0},t.prototype.call=function(e,t){var n=this,i=nt(e),a=i.shape,o=a.length;return Object(r.tidy)((function(){for(var e=Object(r.moments)(i,n.axis,!0),t=e.mean,s=e.variance,u=v(1,o),c=0,l=n.axis;c<l.length;c++){var f=l[c];u[f]=a[f]}for(var d=function(e){return null!=e&&e.shape.length!==o&&n.axis!==[o-1]?e.reshape(u):e},h=d(n.gamma.read()),p=d(n.beta.read()),m=[],g=[],y=0;y<o;++y)-1!==n.axis.indexOf(y)?(m.push(a[y]),g.push(1)):(m.push(1),g.push(a[y]));return t=t.tile(m),s=s.tile(m),h=h.tile(g),p=p.tile(g),Zr(i,t,s,p,h,n.epsilon)}))},t.prototype.getConfig=function(){var t={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Xe(this.betaInitializer),gammaInitializer:Xe(this.gammaInitializer),betaRegularizer:ar(this.betaRegularizer),gammaRegularizer:ar(this.gammaRegularizer)},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="LayerNormalization",t}(mt);r.serialization.registerClass(ti);var ni=function(e){function t(t){var n=this;if(null==t&&(t={}),(n=e.call(this,t)||this).dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,null==t.padding)n.padding=[[1,1],[1,1]];else if("number"==typeof t.padding)n.padding=[[t.padding,t.padding],[t.padding,t.padding]];else{if(t.padding=t.padding,2!==t.padding.length)throw new h("ZeroPadding2D expects padding to be a length-2 array, but received a length-"+t.padding.length+" array.");var r=void 0,i=void 0;if("number"==typeof t.padding[0])r=[t.padding[0],t.padding[0]],i=[t.padding[1],t.padding[1]];else{if(t.padding=t.padding,2!==t.padding[0].length)throw new h("ZeroPadding2D expects height padding to be a length-2 array, but received a length-"+t.padding[0].length+" array.");if(r=t.padding[0],2!==t.padding[1].length)throw new h("ZeroPadding2D expects width padding to be a length-2 array, but received a length-"+t.padding[1].length+" array.");i=t.padding[1]}n.padding=[r,i]}return n.inputSpec=[new lt({ndim:4})],n}return a(t,e),t.prototype.computeOutputShape=function(e){var t,n;return e=rt(e),"channelsFirst"===this.dataFormat?(t=null!=e[2]&&e[2]>=0?e[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[3]&&e[3]>=0?e[3]+this.padding[1][0]+this.padding[1][1]:null,[e[0],e[1],t,n]):(t=null!=e[1]&&e[1]>=0?e[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[2]&&e[2]>=0?e[2]+this.padding[1][0]+this.padding[1][1]:null,[e[0],t,n,e[3]])},t.prototype.call=function(e,t){var n=this;return Object(r.tidy)((function(){return function(e,t,n){return Object(r.tidy)((function(){if(4!==e.rank)throw new h("temporalPadding expects input tensor to be 4-D, but received a "+e.rank+"-D tensor.");if(null==t&&(t=[[1,1],[1,1]]),2!==t.length||2!==t[0].length||2!==t[1].length)throw new h("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==n&&(n="channelsLast"),"channelsLast"!==n&&"channelsFirst"!==n)throw new h("Unknown data format: "+n+". Supported data formats are 'channelsLast' and 'channelsFirst.");var i;return i="channelsFirst"===n?[[0,0],[0,0],t[0],t[1]]:[[0,0],t[0],t[1],[0,0]],Object(r.pad)(e,i)}))}(nt(e),n.padding,n.dataFormat)}))},t.prototype.getConfig=function(){var t={padding:this.padding,dataFormat:this.dataFormat},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="ZeroPadding2D",t}(mt);function ri(e,t,n,i,a,o){return Object(r.tidy)((function(){var s;Y(a),J(o),$(i),null==n&&(n=[1,1]),null==i&&(i="valid"),null==a&&(a="channelsLast"),null==o&&(o="max"),e=gr(e,a);var u="same"===i?"same":"valid";return s="max"===o?Object(r.maxPool)(e,t,n,u):Object(r.avgPool)(e,t,n,u),"channelsFirst"===a&&(s=Object(r.transpose)(s,[0,3,1,2])),s}))}function ii(e,t,n,i,a,o){return Object(r.tidy)((function(){var s;Y(a),J(o),$(i),null==n&&(n=[1,1,1]),null==i&&(i="valid"),null==a&&(a="channelsLast"),null==o&&(o="max"),e=yr(e,a);var u="same"===i?"same":"valid";return s="max"===o?Object(r.maxPool3d)(e,t,n,u):Object(r.avgPool3d)(e,t,n,u),"channelsFirst"===a&&(s=Object(r.transpose)(s,[0,4,1,2,3])),s}))}r.serialization.registerClass(ni);var ai=function(e){function t(t){var n=this;if(null==t.poolSize&&(t.poolSize=2),n=e.call(this,t)||this,"number"==typeof t.poolSize)n.poolSize=[t.poolSize];else{if(!Array.isArray(t.poolSize)||1!==t.poolSize.length||"number"!=typeof t.poolSize[0])throw new h("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(t.poolSize));n.poolSize=t.poolSize}if(j(n.poolSize,"poolSize"),null==t.strides)n.strides=n.poolSize;else if("number"==typeof t.strides)n.strides=[t.strides];else{if(!Array.isArray(t.strides)||1!==t.strides.length||"number"!=typeof t.strides[0])throw new h("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(t.strides));n.strides=t.strides}return j(n.strides,"strides"),n.padding=null==t.padding?"valid":t.padding,$(n.padding),n.inputSpec=[new lt({ndim:3})],n}return a(t,e),t.prototype.computeOutputShape=function(e){var t=mr((e=rt(e))[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]},t.prototype.call=function(e,t){var n=this;return Object(r.tidy)((function(){n.invokeCallHook(e,t),e=de(nt(e),2);var i=n.poolingFunction(nt(e),[n.poolSize[0],1],[n.strides[0],1],n.padding,"channelsLast");return Object(r.squeeze)(i,[2])}))},t.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t}(mt),oi=function(e){function t(t){return e.call(this,t)||this}return a(t,e),t.prototype.poolingFunction=function(e,t,n,r,i){return Y(i),$(r),ri(e,t,n,r,i,"max")},t.className="MaxPooling1D",t}(ai);r.serialization.registerClass(oi);var si=function(e){function t(t){return e.call(this,t)||this}return a(t,e),t.prototype.poolingFunction=function(e,t,n,r,i){return Y(i),$(r),ri(e,t,n,r,i,"avg")},t.className="AveragePooling1D",t}(ai);r.serialization.registerClass(si);var ui=function(e){function t(t){var n=this;if(null==t.poolSize&&(t.poolSize=[2,2]),(n=e.call(this,t)||this).poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize],null==t.strides)n.strides=n.poolSize;else if(Array.isArray(t.strides)){if(2!==t.strides.length)throw new h("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+t.strides.length+".");n.strides=t.strides}else n.strides=[t.strides,t.strides];return j(n.poolSize,"poolSize"),j(n.strides,"strides"),n.padding=null==t.padding?"valid":t.padding,n.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,Y(n.dataFormat),$(n.padding),n.inputSpec=[new lt({ndim:4})],n}return a(t,e),t.prototype.computeOutputShape=function(e){e=rt(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2];return t=mr(t,this.poolSize[0],this.padding,this.strides[0]),n=mr(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n]:[e[0],t,n,e[3]]},t.prototype.call=function(e,t){var n=this;return Object(r.tidy)((function(){return n.invokeCallHook(e,t),n.poolingFunction(nt(e),n.poolSize,n.strides,n.padding,n.dataFormat)}))},t.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t}(mt),ci=function(e){function t(t){return e.call(this,t)||this}return a(t,e),t.prototype.poolingFunction=function(e,t,n,r,i){return Y(i),$(r),ri(e,t,n,r,i,"max")},t.className="MaxPooling2D",t}(ui);r.serialization.registerClass(ci);var li=function(e){function t(t){return e.call(this,t)||this}return a(t,e),t.prototype.poolingFunction=function(e,t,n,r,i){return Y(i),$(r),ri(e,t,n,r,i,"avg")},t.className="AveragePooling2D",t}(ui);r.serialization.registerClass(li);var fi=function(e){function t(t){var n=this;if(null==t.poolSize&&(t.poolSize=[2,2,2]),(n=e.call(this,t)||this).poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize,t.poolSize],null==t.strides)n.strides=n.poolSize;else if(Array.isArray(t.strides)){if(3!==t.strides.length)throw new h("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length "+t.strides.length+".");n.strides=t.strides}else n.strides=[t.strides,t.strides,t.strides];return j(n.poolSize,"poolSize"),j(n.strides,"strides"),n.padding=null==t.padding?"valid":t.padding,n.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,Y(n.dataFormat),$(n.padding),n.inputSpec=[new lt({ndim:5})],n}return a(t,e),t.prototype.computeOutputShape=function(e){e=rt(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[4]:e[3];return t=mr(t,this.poolSize[0],this.padding,this.strides[0]),n=mr(n,this.poolSize[1],this.padding,this.strides[1]),r=mr(r,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n,r]:[e[0],t,n,r,e[4]]},t.prototype.call=function(e,t){var n=this;return Object(r.tidy)((function(){return n.invokeCallHook(e,t),n.poolingFunction(nt(e),n.poolSize,n.strides,n.padding,n.dataFormat)}))},t.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t}(mt),di=function(e){function t(t){return e.call(this,t)||this}return a(t,e),t.prototype.poolingFunction=function(e,t,n,r,i){return Y(i),$(r),ii(e,t,n,r,i,"max")},t.className="MaxPooling3D",t}(fi);r.serialization.registerClass(di);var hi=function(e){function t(t){return e.call(this,t)||this}return a(t,e),t.prototype.poolingFunction=function(e,t,n,r,i){return Y(i),$(r),ii(e,t,n,r,i,"avg")},t.className="AveragePooling3D",t}(fi);r.serialization.registerClass(hi);var pi=function(e){function t(t){var n=e.call(this,t)||this;return n.inputSpec=[new lt({ndim:3})],n}return a(t,e),t.prototype.computeOutputShape=function(e){return[e[0],e[2]]},t.prototype.call=function(e,t){throw new p},t}(mt),mi=function(e){function t(t){return e.call(this,t||{})||this}return a(t,e),t.prototype.call=function(e,t){return Object(r.tidy)((function(){var t=nt(e);return Object(r.mean)(t,1)}))},t.className="GlobalAveragePooling1D",t}(pi);r.serialization.registerClass(mi);var vi=function(e){function t(t){return e.call(this,t||{})||this}return a(t,e),t.prototype.call=function(e,t){return Object(r.tidy)((function(){var t=nt(e);return Object(r.max)(t,1)}))},t.className="GlobalMaxPooling1D",t}(pi);r.serialization.registerClass(vi);var gi=function(e){function t(t){var n=e.call(this,t)||this;return n.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,Y(n.dataFormat),n.inputSpec=[new lt({ndim:4})],n}return a(t,e),t.prototype.computeOutputShape=function(e){return"channelsLast"===this.dataFormat?[e[0],e[3]]:[e[0],e[1]]},t.prototype.call=function(e,t){throw new p},t.prototype.getConfig=function(){var t={dataFormat:this.dataFormat},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t}(mt),yi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.call=function(e,t){var n=this;return Object(r.tidy)((function(){var t=nt(e);return"channelsLast"===n.dataFormat?Object(r.mean)(t,[1,2]):Object(r.mean)(t,[2,3])}))},t.className="GlobalAveragePooling2D",t}(gi);r.serialization.registerClass(yi);var bi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.call=function(e,t){var n=this;return Object(r.tidy)((function(){var t=nt(e);return"channelsLast"===n.dataFormat?Object(r.max)(t,[1,2]):Object(r.max)(t,[2,3])}))},t.className="GlobalMaxPooling2D",t}(gi);function xi(e,t,n,r){if(Array.isArray(e)){if(null!=t||null!=n)throw new h("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=e.slice(e.length-r,e.length),e=e.slice(0,e.length-r)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function i(e){return null==e||Array.isArray(e)?e:[e]}return{inputs:e,initialState:t=i(t),constants:n=i(n)}}function wi(e,t,n,i,a,o,s,u){return void 0===i&&(i=!1),void 0===s&&(s=!1),void 0===u&&(u=!1),Object(r.tidy)((function(){var c=t.shape.length;if(c<3)throw new h("Input should be at least 3D, but is "+c+"D.");var l=[1,0].concat(le(2,c));if(t=Object(r.transpose)(t,l),null!=o)throw new p("The rnn() functoin of the deeplearn.js backend does not support constants yet.");s&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=a&&((a=a.asType("bool").asType("float32")).rank===c-1&&(a=Object(r.expandDims)(a,-1)),a=Object(r.transpose)(a,l)),i&&(t=Object(r.reverse)(t,0),null!=a&&(a=Object(r.reverse)(a,0)));var f,d,m=[],v=n,g=t.shape[0],y=Object(r.unstack)(t);null!=a&&(d=Object(r.unstack)(a));for(var b,x=function(t){var n=y[t],i=Object(r.tidy)((function(){return e(n,v)}));if(null==a)f=i[0],v=i[1];else{var o=Object(r.tidy)((function(){var e=d[t],n=Object(r.onesLike)(e).sub(e);return{output:i[0].mul(e).addStrict(v[0].mul(n)),newStates:v.map((function(t,r){return i[1][r].mul(e).addStrict(t.mul(n))}))}}));f=o.output,v=o.newStates}u&&m.push(f)},w=0;w<g;++w)x(w);return u&&(b=Object(r.stack)(m,1)),[f,b,v]}))}r.serialization.registerClass(bi);var _i=function(e){function t(t){var n,r=e.call(this,t)||this;if(null==t.cell)throw new h("cell property is missing for the constructor of RNN.");if(null==(n=Array.isArray(t.cell)?new Ti({cells:t.cell}):t.cell).stateSize)throw new h("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return r.cell=n,r.returnSequences=null!=t.returnSequences&&t.returnSequences,r.returnState=null!=t.returnState&&t.returnState,r.goBackwards=null!=t.goBackwards&&t.goBackwards,r._stateful=null!=t.stateful&&t.stateful,r.unroll=null!=t.unroll&&t.unroll,r.supportsMasking=!0,r.inputSpec=[new lt({ndim:3})],r.stateSpec=null,r.states_=null,r.numConstants=null,r.keptStates=[],r}return a(t,e),t.prototype.getStates=function(){return null==this.states_?le(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map((function(e){return null})):this.states_},t.prototype.setStates=function(e){this.states_=e},t.prototype.computeOutputShape=function(e){et(e)&&(e=e[0]);var t=this.cell.stateSize;Array.isArray(t)||(t=[t]);var n,r=t[0];if(n=this.returnSequences?[e[0],e[1],r]:[e[0],r],this.returnState){for(var i=[],a=0,o=t;a<o.length;a++){var s=o[a];i.push([e[0],s])}return[n].concat(i)}return n},t.prototype.computeMask=function(e,t){var n=this;return Object(r.tidy)((function(){Array.isArray(t)&&(t=t[0]);var e=n.returnSequences?t:null;if(n.returnState){var r=n.states.map((function(e){return null}));return[e].concat(r)}return e}))},Object.defineProperty(t.prototype,"states",{get:function(){if(null==this.states_){for(var e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[],n=0;n<e;++n)t.push(null);return t}return this.states_},set:function(e){this.states_=e},enumerable:!0,configurable:!0}),t.prototype.build=function(e){if(null!=this.numConstants)throw new p("Constants support is not implemented in RNN yet.");et(e)&&(e=e[0]);var t=this.stateful?e[0]:null,n=e[e.length-1];this.inputSpec[0]=new lt({shape:[t,null,n]});var i,a=[e[0]].concat(e.slice(2));if(this.cell.build(a),i=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!r.util.arraysEqual(this.stateSpec.map((function(e){return e.shape[e.shape.length-1]})),i))throw new h("An initialState was passed that is not compatible with cell.stateSize. Received stateSpec="+this.stateSpec+"; However cell.stateSize is "+this.cell.stateSize)}else this.stateSpec=i.map((function(e){return new lt({shape:[null,e]})}));this.stateful&&this.resetStates()},t.prototype.resetStates=function(e,t){var n=this;void 0===t&&(t=!1),Object(r.tidy)((function(){if(!n.stateful)throw new f("Cannot call resetStates() on an RNN Layer that is not stateful.");var i=n.inputSpec[0].shape[0];if(null==i)throw new h("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==n.states_)Array.isArray(n.cell.stateSize)?n.states_=n.cell.stateSize.map((function(e){return Object(r.zeros)([i,e])})):n.states_=[Object(r.zeros)([i,n.cell.stateSize])];else if(null==e)Object(r.dispose)(n.states_),null!=n.keptStates&&(Object(r.dispose)(n.keptStates),n.keptStates=[]),Array.isArray(n.cell.stateSize)?n.states_=n.cell.stateSize.map((function(e){return Object(r.zeros)([i,e])})):n.states_[0]=Object(r.zeros)([i,n.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==n.states_.length)throw new h("Layer "+n.name+" expects "+n.states_.length+" state(s), but it received "+e.length+" state value(s). Input received: "+e);!0===t?n.keptStates.push(n.states_.slice()):Object(r.dispose)(n.states_);for(var a=0;a<n.states_.length;++a){var o=e[a],s=Array.isArray(n.cell.stateSize)?n.cell.stateSize[a]:n.cell.stateSize,u=[i,s];if(!r.util.arraysEqual(o.shape,u))throw new h("State "+a+" is incompatible with layer "+n.name+": expected shape="+u+", received shape="+o.shape);n.states_[a]=o}}n.states_=n.states_.map((function(e){return Object(r.keep)(e.clone())}))}))},t.prototype.apply=function(t,n){var r=null==n?null:n.initialState,i=null==n?null:n.constants;null==n&&(n={});var a=xi(t,r,i,this.numConstants);t=a.inputs,r=a.initialState,i=a.constants;var o=[],s=[];if(null!=r){n.initialState=r,o=o.concat(r),this.stateSpec=[];for(var u=0,c=r;u<c.length;u++){var l=c[u];this.stateSpec.push(new lt({shape:l.shape}))}s=s.concat(this.stateSpec)}if(null!=i&&(n.constants=i,o=o.concat(i),this.numConstants=i.length),o[0]instanceof ft){var f=[t].concat(o),d=this.inputSpec.concat(s),h=this.inputSpec;this.inputSpec=d;var p=e.prototype.apply.call(this,f,n);return this.inputSpec=h,p}return e.prototype.apply.call(this,t,n)},t.prototype.call=function(e,t){var n=this;return Object(r.tidy)((function(){var r=null==t?null:t.mask,i=null==t?null:t.training,a=null==t?null:t.initialState;e=nt(e),null==a&&(a=n.stateful?n.states_:n.getInitialState(e));var o=Array.isArray(n.cell.stateSize)?n.cell.stateSize.length:1;if(a.length!==o)throw new h("RNN Layer has "+o+" state(s) but was passed "+a.length+" initial state(s).");n.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var s={training:i},u=wi((function(e,t){var r=n.cell.call([e].concat(t),s);return[r[0],r.slice(1)]}),e,a,n.goBackwards,r,null,n.unroll,n.returnSequences),c=u[0],l=u[1],f=u[2];n.stateful&&n.resetStates(f,i);var d=n.returnSequences?l:c;return n.returnState?[d].concat(f):d}))},t.prototype.getInitialState=function(e){var t=this;return Object(r.tidy)((function(){var n=Object(r.zeros)(e.shape);return n=de(n=Object(r.sum)(n,[1,2])),Array.isArray(t.cell.stateSize)?t.cell.stateSize.map((function(e){return e>1?ye(n,[1,e]):n})):t.cell.stateSize>1?[ye(n,[1,t.cell.stateSize])]:[n]}))},Object.defineProperty(t.prototype,"trainableWeights",{get:function(){return this.trainable?this.cell.trainableWeights:[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights},enumerable:!0,configurable:!0}),t.prototype.setFastWeightInitDuringBuild=function(t){e.prototype.setFastWeightInitDuringBuild.call(this,t),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(t)},t.prototype.getConfig=function(){var t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(t.numConstants=this.numConstants);var n=this.cell.getConfig();t.cell={className:this.cell.getClassName(),config:n};var r=e.prototype.getConfig.call(this);return Object.assign(t,r),t},t.fromConfig=function(e,t,n){void 0===n&&(n={});var r=Dt(t.cell,n);return new e(Object.assign(t,{cell:r}))},t.className="RNN",t}(mt);r.serialization.registerClass(_i);var ki=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t}(mt),Ei=function(e){function t(t){var n=e.call(this,t)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=t.units,j(n.units,"units"),n.activation=er(null==t.activation?n.DEFAULT_ACTIVATION:t.activation),n.useBias=null==t.useBias||t.useBias,n.kernelInitializer=Ke(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=Ke(t.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=Ke(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelRegularizer=sr(t.kernelRegularizer),n.recurrentRegularizer=sr(t.recurrentRegularizer),n.biasRegularizer=sr(t.biasRegularizer),n.kernelConstraint=W(t.kernelConstraint),n.recurrentConstraint=W(t.recurrentConstraint),n.biasConstraint=W(t.biasConstraint),n.dropout=ue([1,ce([0,null==t.dropout?0:t.dropout])]),n.recurrentDropout=ue([1,ce([0,null==t.recurrentDropout?0:t.recurrentDropout])]),n.stateSize=n.units,n.dropoutMask=null,n.recurrentDropoutMask=null,n}return a(t,e),t.prototype.build=function(e){e=rt(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},t.prototype.call=function(e,t){var n=this;return Object(r.tidy)((function(){if(2!==e.length)throw new h("SimpleRNNCell expects 2 input Tensors, got "+e.length+".");var i=e[1];e=e[0];var a,o=null!=t.training&&t.training;0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=ji((function(){return Object(r.onesLike)(e)}),n.dropout,o)),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=ji((function(){return Object(r.onesLike)(i)}),n.recurrentDropout,o));var s=n.dropoutMask,u=n.recurrentDropoutMask;a=xe(null!=s?Object(r.mul)(e,s):e,n.kernel.read()),null!=n.bias&&(a=Ee(a,n.bias.read())),null!=u&&(i=Object(r.mul)(i,u));var c=Object(r.add)(a,xe(i,n.recurrentKernel.read()));return null!=n.activation&&(c=n.activation.apply(c)),[c,c]}))},t.prototype.getConfig=function(){var t={units:this.units,activation:Zn(this.activation),useBias:this.useBias,kernelInitializer:Xe(this.kernelInitializer),recurrentInitializer:Xe(this.recurrentInitializer),biasInitializer:Xe(this.biasInitializer),kernelRegularizer:ar(this.kernelRegularizer),recurrentRegularizer:ar(this.recurrentRegularizer),biasRegularizer:ar(this.biasRegularizer),activityRegularizer:ar(this.activityRegularizer),kernelConstraint:z(this.kernelConstraint),recurrentConstraint:z(this.recurrentConstraint),biasConstraint:z(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="SimpleRNNCell",t}(ki);r.serialization.registerClass(Ei);var Si=function(e){function t(t){return t.cell=new Ei(t),e.call(this,t)||this}return a(t,e),t.prototype.call=function(t,n){var i=this;return Object(r.tidy)((function(){null!=i.cell.dropoutMask&&(Object(r.dispose)(i.cell.dropoutMask),i.cell.dropoutMask=null),null!=i.cell.recurrentDropoutMask&&(Object(r.dispose)(i.cell.recurrentDropoutMask),i.cell.recurrentDropoutMask=null);var a=null==n?null:n.mask,o=null==n?null:n.training,s=null==n?null:n.initialState;return e.prototype.call.call(i,t,{mask:a,training:o,initialState:s})}))},Object.defineProperty(t.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),t.prototype.getConfig=function(){var t={units:this.units,activation:Zn(this.activation),useBias:this.useBias,kernelInitializer:Xe(this.kernelInitializer),recurrentInitializer:Xe(this.recurrentInitializer),biasInitializer:Xe(this.biasInitializer),kernelRegularizer:ar(this.kernelRegularizer),recurrentRegularizer:ar(this.recurrentRegularizer),biasRegularizer:ar(this.biasRegularizer),activityRegularizer:ar(this.activityRegularizer),kernelConstraint:z(this.kernelConstraint),recurrentConstraint:z(this.recurrentConstraint),biasConstraint:z(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},n=e.prototype.getConfig.call(this);return delete n.cell,Object.assign(t,n),t},t.fromConfig=function(e,t){return new e(t)},t.className="SimpleRNN",t}(_i);r.serialization.registerClass(Si);var Ci=function(e){function t(t){var n=e.call(this,t)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=t.units,j(n.units,"units"),n.activation=er(void 0===t.activation?n.DEFAULT_ACTIVATION:t.activation),n.recurrentActivation=er(void 0===t.recurrentActivation?n.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),n.useBias=null==t.useBias||t.useBias,n.kernelInitializer=Ke(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=Ke(t.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=Ke(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelRegularizer=sr(t.kernelRegularizer),n.recurrentRegularizer=sr(t.recurrentRegularizer),n.biasRegularizer=sr(t.biasRegularizer),n.kernelConstraint=W(t.kernelConstraint),n.recurrentConstraint=W(t.recurrentConstraint),n.biasConstraint=W(t.biasConstraint),n.dropout=ue([1,ce([0,null==t.dropout?0:t.dropout])]),n.recurrentDropout=ue([1,ce([0,null==t.recurrentDropout?0:t.recurrentDropout])]),n.implementation=t.implementation,n.stateSize=n.units,n.dropoutMask=null,n.recurrentDropoutMask=null,n}return a(t,e),t.prototype.build=function(e){var t=(e=rt(e))[e.length-1];this.kernel=this.addWeight("kernel",[t,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},t.prototype.call=function(e,t){var n=this;return Object(r.tidy)((function(){if(2!==e.length)throw new h("GRUCell expects 2 input Tensors (inputs, h, c), got "+e.length+".");var i=null!=t.training&&t.training,a=e[1];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=ji((function(){return Object(r.onesLike)(e)}),n.dropout,i,3)),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=ji((function(){return Object(r.onesLike)(a)}),n.recurrentDropout,i,3));var o,s,u,c=n.dropoutMask,l=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(e=Object(r.mul)(e,c[0]));var f=xe(e,n.kernel.read());n.useBias&&(f=Ee(f,n.bias.read())),0<n.recurrentDropout&&n.recurrentDropout<1&&(a=Object(r.mul)(a,l[0]));var d=n.recurrentKernel.read(),p=Object(r.split)(d,[2*n.units,n.units],d.rank-1),m=p[0],v=p[1],g=xe(a,m),y=Object(r.split)(f,3,f.rank-1),b=y[0],x=y[1],w=y[2],_=Object(r.split)(g,2,g.rank-1),k=_[0],E=_[1];o=n.recurrentActivation.apply(Object(r.add)(b,k)),s=n.recurrentActivation.apply(Object(r.add)(x,E));var S=xe(Object(r.mul)(s,a),v);u=n.activation.apply(Object(r.add)(w,S));var C=Object(r.add)(Object(r.mul)(o,a),Object(r.mul)(Object(r.add)(1,Object(r.neg)(o)),u));return[C,C]}))},t.prototype.getConfig=function(){var t={units:this.units,activation:Zn(this.activation),recurrentActivation:Zn(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Xe(this.kernelInitializer),recurrentInitializer:Xe(this.recurrentInitializer),biasInitializer:Xe(this.biasInitializer),kernelRegularizer:ar(this.kernelRegularizer),recurrentRegularizer:ar(this.recurrentRegularizer),biasRegularizer:ar(this.biasRegularizer),activityRegularizer:ar(this.activityRegularizer),kernelConstraint:z(this.kernelConstraint),recurrentConstraint:z(this.recurrentConstraint),biasConstraint:z(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="GRUCell",t}(ki);r.serialization.registerClass(Ci);var Ai=function(e){function t(t){return 0===t.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new Ci(t),e.call(this,t)||this}return a(t,e),t.prototype.call=function(t,n){var i=this;return Object(r.tidy)((function(){null!=i.cell.dropoutMask&&(Object(r.dispose)(i.cell.dropoutMask),i.cell.dropoutMask=null),null!=i.cell.recurrentDropoutMask&&(Object(r.dispose)(i.cell.recurrentDropoutMask),i.cell.recurrentDropoutMask=null);var a=null==n?null:n.mask,o=null==n?null:n.training,s=null==n?null:n.initialState;return e.prototype.call.call(i,t,{mask:a,training:o,initialState:s})}))},Object.defineProperty(t.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentActivation",{get:function(){return this.cell.recurrentActivation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"implementation",{get:function(){return this.cell.implementation},enumerable:!0,configurable:!0}),t.prototype.getConfig=function(){var t={units:this.units,activation:Zn(this.activation),recurrentActivation:Zn(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Xe(this.kernelInitializer),recurrentInitializer:Xe(this.recurrentInitializer),biasInitializer:Xe(this.biasInitializer),kernelRegularizer:ar(this.kernelRegularizer),recurrentRegularizer:ar(this.recurrentRegularizer),biasRegularizer:ar(this.biasRegularizer),activityRegularizer:ar(this.activityRegularizer),kernelConstraint:z(this.kernelConstraint),recurrentConstraint:z(this.recurrentConstraint),biasConstraint:z(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=e.prototype.getConfig.call(this);return delete n.cell,Object.assign(t,n),t},t.fromConfig=function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)},t.className="GRU",t}(_i);r.serialization.registerClass(Ai);var Oi=function(e){function t(t){var n=e.call(this,t)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=t.units,j(n.units,"units"),n.activation=er(void 0===t.activation?n.DEFAULT_ACTIVATION:t.activation),n.recurrentActivation=er(void 0===t.recurrentActivation?n.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),n.useBias=null==t.useBias||t.useBias,n.kernelInitializer=Ke(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=Ke(t.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=Ke(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.unitForgetBias=t.unitForgetBias,n.kernelRegularizer=sr(t.kernelRegularizer),n.recurrentRegularizer=sr(t.recurrentRegularizer),n.biasRegularizer=sr(t.biasRegularizer),n.kernelConstraint=W(t.kernelConstraint),n.recurrentConstraint=W(t.recurrentConstraint),n.biasConstraint=W(t.biasConstraint),n.dropout=ue([1,ce([0,null==t.dropout?0:t.dropout])]),n.recurrentDropout=ue([1,ce([0,null==t.recurrentDropout?0:t.recurrentDropout])]),n.implementation=t.implementation,n.stateSize=[n.units,n.units],n.dropoutMask=null,n.recurrentDropoutMask=null,n}return a(t,e),t.prototype.build=function(e){var t,n,r=(e=rt(e))[e.length-1];if(this.kernel=this.addWeight("kernel",[r,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){var i=this.biasInitializer,o=this.units;n=new((t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.apply=function(e,t){var n=i.apply([o]),r=(new je).apply([o]),a=i.apply([2*o]);return ge(ge(n,r),a)},t}(De)).className="CustomInit",t)}else n=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,n,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0},t.prototype.call=function(e,t){var n=this;return Object(r.tidy)((function(){var i=null!=t.training&&t.training;if(3!==e.length)throw new h("LSTMCell expects 3 input Tensors (inputs, h, c), got "+e.length+".");var a=e[1],o=e[2];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=ji((function(){return Object(r.onesLike)(e)}),n.dropout,i,4)),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=ji((function(){return Object(r.onesLike)(a)}),n.recurrentDropout,i,4));var s,u,c,l,f=n.dropoutMask,d=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(e=Object(r.mul)(e,f[0]));var p=xe(e,n.kernel.read());0<n.recurrentDropout&&n.recurrentDropout<1&&(a=Object(r.mul)(a,d[0])),p=Object(r.add)(p,xe(a,n.recurrentKernel.read())),n.useBias&&(p=Ee(p,n.bias.read()));var m=Object(r.split)(p,4,p.rank-1),v=m[0],g=m[1],y=m[2],b=m[3];s=n.recurrentActivation.apply(v),u=n.recurrentActivation.apply(g),c=Object(r.add)(Object(r.mul)(u,o),Object(r.mul)(s,n.activation.apply(y))),l=n.recurrentActivation.apply(b);var x=Object(r.mul)(l,n.activation.apply(c));return[x,x,c]}))},t.prototype.getConfig=function(){var t={units:this.units,activation:Zn(this.activation),recurrentActivation:Zn(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Xe(this.kernelInitializer),recurrentInitializer:Xe(this.recurrentInitializer),biasInitializer:Xe(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:ar(this.kernelRegularizer),recurrentRegularizer:ar(this.recurrentRegularizer),biasRegularizer:ar(this.biasRegularizer),activityRegularizer:ar(this.activityRegularizer),kernelConstraint:z(this.kernelConstraint),recurrentConstraint:z(this.recurrentConstraint),biasConstraint:z(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="LSTMCell",t}(ki);r.serialization.registerClass(Oi);var Di=function(e){function t(t){return 0===t.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new Oi(t),e.call(this,t)||this}return a(t,e),t.prototype.call=function(t,n){var i=this;return Object(r.tidy)((function(){null!=i.cell.dropoutMask&&(Object(r.dispose)(i.cell.dropoutMask),i.cell.dropoutMask=null),null!=i.cell.recurrentDropoutMask&&(Object(r.dispose)(i.cell.recurrentDropoutMask),i.cell.recurrentDropoutMask=null);var a=null==n?null:n.mask,o=null==n?null:n.training,s=null==n?null:n.initialState;return e.prototype.call.call(i,t,{mask:a,training:o,initialState:s})}))},Object.defineProperty(t.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentActivation",{get:function(){return this.cell.recurrentActivation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"unitForgetBias",{get:function(){return this.cell.unitForgetBias},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"implementation",{get:function(){return this.cell.implementation},enumerable:!0,configurable:!0}),t.prototype.getConfig=function(){var t={units:this.units,activation:Zn(this.activation),recurrentActivation:Zn(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Xe(this.kernelInitializer),recurrentInitializer:Xe(this.recurrentInitializer),biasInitializer:Xe(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:ar(this.kernelRegularizer),recurrentRegularizer:ar(this.recurrentRegularizer),biasRegularizer:ar(this.biasRegularizer),activityRegularizer:ar(this.activityRegularizer),kernelConstraint:z(this.kernelConstraint),recurrentConstraint:z(this.recurrentConstraint),biasConstraint:z(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=e.prototype.getConfig.call(this);return delete n.cell,Object.assign(t,n),t},t.fromConfig=function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)},t.className="LSTM",t}(_i);r.serialization.registerClass(Di);var Ti=function(e){function t(t){var n=e.call(this,t)||this;return n.cells=t.cells,n}return a(t,e),Object.defineProperty(t.prototype,"stateSize",{get:function(){for(var e=[],t=0,n=this.cells.slice().reverse();t<n.length;t++){var r=n[t];Array.isArray(r.stateSize)?e.push.apply(e,r.stateSize):e.push(r.stateSize)}return e},enumerable:!0,configurable:!0}),t.prototype.call=function(e,t){var n=this;return Object(r.tidy)((function(){for(var r=e.slice(1),i=[],a=0,o=n.cells.slice().reverse();a<o.length;a++){var s=o[a];Array.isArray(s.stateSize)?i.push(r.splice(0,s.stateSize.length)):i.push(r.splice(0,1))}i.reverse();for(var u,c=[],l=0;l<n.cells.length;++l)s=n.cells[l],r=i[l],u=0===l?[e[0]].concat(r):[u[0]].concat(r),u=s.call(u,t),c.push(u.slice(1));r=[];for(var f=0,d=c.slice().reverse();f<d.length;f++){var h=d[f];r.push.apply(r,h)}return[u[0]].concat(r)}))},t.prototype.build=function(e){var t;et(e)&&(e=e[0]),this.cells.forEach((function(n,r){ee("RNNCell_"+r,(function(){n.build(e),t=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,e=[e[0],t]}))})),this.built=!0},t.prototype.getConfig=function(){for(var t=[],n=0,r=this.cells;n<r.length;n++){var i=r[n];t.push({className:i.getClassName(),config:i.getConfig()})}var a={cells:t},o=e.prototype.getConfig.call(this);return Object.assign(a,o),a},t.fromConfig=function(e,t,n){void 0===n&&(n={});for(var r=[],i=0,a=t.cells;i<a.length;i++){var o=a[i];r.push(Dt(o,n))}return new e({cells:r})},Object.defineProperty(t.prototype,"trainableWeights",{get:function(){if(!this.trainable)return[];for(var e=[],t=0,n=this.cells;t<n.length;t++){var r=n[t];e.push.apply(e,r.trainableWeights)}return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nonTrainableWeights",{get:function(){for(var e=[],t=0,n=this.cells;t<n.length;t++){var r=n[t];e.push.apply(e,r.nonTrainableWeights)}if(!this.trainable){for(var i=[],a=0,o=this.cells;a<o.length;a++)r=o[a],i.push.apply(i,r.trainableWeights);return i.concat(e)}return e},enumerable:!0,configurable:!0}),t.prototype.getWeights=function(){for(var e=[],t=0,n=this.cells;t<n.length;t++){var r=n[t];e.push.apply(e,r.weights)}return st(e)},t.prototype.setWeights=function(e){for(var t=[],n=0,r=this.cells;n<r.length;n++)for(var i=r[n],a=i.weights.length,o=e.splice(a),s=0;s<i.weights.length;++s)t.push([i.weights[s],o[s]]);ut(t)},t.className="StackedRNNCells",t}(ki);function ji(e,t,n,i){function a(){return Se(e(),t)}if(void 0===n&&(n=null),void 0===i&&(i=1),i>1){for(var o=[],s=0;s<i;s++)o.push(Ce(a,e,n));return o.map((function(e){return Object(r.keep)(e.clone())}))}return Object(r.keep)(Ce(a,e,n).clone())}r.serialization.registerClass(Ti);var Mi=function(e){function t(t){var n=e.call(this,t)||this;return n.layer=t.layer,n}return a(t,e),t.prototype.build=function(e){this.built=!0},Object.defineProperty(t.prototype,"trainable",{get:function(){return null!=this.layer&&this.layer.trainable},set:function(e){null!=this.layer&&(this.layer.trainable=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"trainableWeights",{get:function(){return this.layer.trainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nonTrainableWeights",{get:function(){return this.layer.nonTrainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updates",{get:function(){return this.layer._updates},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"losses",{get:function(){return this.layer.losses},enumerable:!0,configurable:!0}),t.prototype.getWeights=function(){return this.layer.getWeights()},t.prototype.setWeights=function(e){this.layer.setWeights(e)},t.prototype.getConfig=function(){var t={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.prototype.setFastWeightInitDuringBuild=function(t){e.prototype.setFastWeightInitDuringBuild.call(this,t),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(t)},t.fromConfig=function(e,t,n){void 0===n&&(n={});var r=Dt(t.layer,n);delete t.layer;var i={layer:r};return Object.assign(i,t),new e(i)},t}(mt),Fi=function(e){function t(t){var n=e.call(this,t)||this;return n.supportsMasking=!0,n}return a(t,e),t.prototype.build=function(t){if((t=rt(t)).length<3)throw new h("TimeDistributed layer expects an input shape >= 3D, but received input shape "+JSON.stringify(t));this.inputSpec=[{shape:t}];var n=[t[0]].concat(t.slice(2));this.layer.built||(this.layer.build(n),this.layer.built=!0),e.prototype.build.call(this,t)},t.prototype.computeOutputShape=function(e){var t=[(e=rt(e))[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t),r=e[1];return[n[0],r].concat(n.slice(1))},t.prototype.call=function(e,t){var n=this;return Object(r.tidy)((function(){return wi((function(e,r){return[nt(n.layer.call(e,t)),[]]}),e=nt(e),[],!1,null,null,!1,!0)[1]}))},t.className="TimeDistributed",t}(Mi);r.serialization.registerClass(Fi);var Ii="concat",Ni=function(e){function t(t){var n=e.call(this,t)||this,r=t.layer.getConfig(),i={};i.className=t.layer.getClassName(),i.config=r,n.forwardLayer=Dt(i),r.goBackwards=!0!==r.goBackwards;var a={};if(a.className=t.layer.getClassName(),a.config=r,n.backwardLayer=Dt(a),n.forwardLayer.name="forward_"+n.forwardLayer.name,n.backwardLayer.name="backward_"+n.backwardLayer.name,n.mergeMode=void 0===t.mergeMode?Ii:t.mergeMode,function(e){D(X,"BidirectionalMergeMode",e)}(n.mergeMode),t.weights)throw new p("weights support is not implemented for Bidirectional layer yet.");return n._stateful=t.layer.stateful,n.returnSequences=t.layer.returnSequences,n.returnState=t.layer.returnState,n.supportsMasking=!0,n._trainable=!0,n.inputSpec=t.layer.inputSpec,n.numConstants=null,n}return a(t,e),Object.defineProperty(t.prototype,"trainable",{get:function(){return this._trainable},set:function(e){this._trainable=e,null!=this.forwardLayer&&(this.forwardLayer.trainable=e),null!=this.backwardLayer&&(this.backwardLayer.trainable=e)},enumerable:!0,configurable:!0}),t.prototype.getWeights=function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())},t.prototype.setWeights=function(e){var t=e.length,n=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,n)),this.backwardLayer.setWeights(e.slice(n))},t.prototype.computeOutputShape=function(e){var t,n,r,i=this.forwardLayer.computeOutputShape(e);return Array.isArray(i)&&Array.isArray(i[0])||(i=[i]),this.returnState?(r=i.slice(1),t=i[0]):t=i[0],"concat"===this.mergeMode?(t[t.length-1]*=2,n=[t]):n=null==this.mergeMode?[t,t.slice()]:[t],this.returnState?null==this.mergeMode?n.concat(r).concat(r.slice()):[t].concat(r).concat(r.slice()):b(n)},t.prototype.apply=function(t,n){var r=null==n?null:n.initialState,i=null==n?null:n.constants;null==n&&(n={});var a=xi(t,r,i,this.numConstants);if(t=a.inputs,r=a.initialState,i=a.constants,Array.isArray(t)&&(r=t.slice(1),t=t[0]),(null==r||0===r.length)&&null==i)return e.prototype.apply.call(this,t,n);var o=[],s=[];if(null!=r){var u=r.length;if(u%2>0)throw new h("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");n.initialState=r,o.push.apply(o,r);var c=r.map((function(e){return new lt({shape:e.shape})}));this.forwardLayer.stateSpec=c.slice(0,u/2),this.backwardLayer.stateSpec=c.slice(u/2),s.push.apply(s,c)}if(null!=i)throw new p("Support for constants in Bidirectional layers is not implemented yet.");for(var l=o[0]instanceof ft,f=0,d=o;f<d.length;f++)if(d[f]instanceof ft!==l)throw new h("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){var m=[t].concat(o),v=this.inputSpec.concat(s),g=this.inputSpec;this.inputSpec=v;var y=e.prototype.apply.call(this,m,n);return this.inputSpec=g,y}return e.prototype.apply.call(this,t,n)},t.prototype.call=function(e,t){var n=this;return Object(r.tidy)((function(){var i,a,o,s,u=t.initialState;if(null==u)i=n.forwardLayer.call(e,t),a=n.backwardLayer.call(e,t);else{var c=u.slice(0,u.length/2),l=u.slice(u.length/2);i=n.forwardLayer.call(e,Object.assign(t,{initialState:c})),a=n.backwardLayer.call(e,Object.assign(t,{initialState:l}))}return n.returnState&&(Array.isArray(i)&&(o=i.slice(1).concat(a.slice(1))),i=i[0],a=a[0]),n.returnSequences&&(a=Object(r.reverse)(a,1)),"concat"===n.mergeMode?s=ve([i,a]):"sum"===n.mergeMode?s=Object(r.add)(i,a):"ave"===n.mergeMode?s=Object(r.mul)(.5,Object(r.add)(i,a)):"mul"===n.mergeMode?s=Object(r.mul)(i,a):null==n.mergeMode&&(s=[i,a]),n.returnState?null==n.mergeMode?s.concat(o):[s].concat(o):s}))},t.prototype.resetStates=function(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()},t.prototype.build=function(e){var t=this;ee(this.forwardLayer.name,(function(){t.forwardLayer.build(e)})),ee(this.backwardLayer.name,(function(){t.backwardLayer.build(e)})),this.built=!0},t.prototype.computeMask=function(e,t){var n;if(Array.isArray(t)&&(t=t[0]),n=this.returnSequences?null==this.mergeMode?[t,t]:t:null==this.mergeMode?[null,null]:null,this.returnState){var r=this.forwardLayer.states.map((function(e){return null}));return Array.isArray(n)?n.concat(r).concat(r):[n].concat(r).concat(r)}return n},Object.defineProperty(t.prototype,"trainableWeights",{get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nonTrainableWeights",{get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)},enumerable:!0,configurable:!0}),t.prototype.setFastWeightInitDuringBuild=function(t){e.prototype.setFastWeightInitDuringBuild.call(this,t),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(t),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(t)},t.prototype.getConfig=function(){var t={mergeMode:this.mergeMode},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.fromConfig=function(e,t){var n=Dt(t.layer);if(delete t.layer,null!=t.numConstants)throw new p("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var r=t;return r.layer=n,new e(r)},t.className="Bidirectional",t}(Mi);function Ri(e){return new si(e)}function Pi(e){return new li(e)}function Bi(e){return new hi(e)}function Li(e){return new vi(e)}function zi(e){return new bi(e)}function Ui(e){return new oi(e)}function Wi(e){return new ci(e)}r.serialization.registerClass(Ni);var Vi=Li,Gi=zi,qi=Ui,Hi=Wi,Xi=Object.freeze({inputLayer:function(e){return new vt(e)},elu:function(e){return new fr(e)},reLU:function(e){return new ur(e)},leakyReLU:function(e){return new cr(e)},prelu:function(e){return new lr(e)},softmax:function(e){return new hr(e)},thresholdedReLU:function(e){return new dr(e)},conv1d:function(e){return new Cr(e)},conv2d:function(e){return new _r(e)},conv2dTranspose:function(e){return new Er(e)},conv3d:function(e){return new kr(e)},separableConv2d:function(e){return new Sr(e)},cropping2D:function(e){return new Ar(e)},upSampling2d:function(e){return new Or(e)},depthwiseConv2d:function(e){return new Dr(e)},activation:function(e){return new Ir(e)},dense:function(e){return new Mr(e)},dropout:function(e){return new Tr(e)},spatialDropout1d:function(e){return new jr(e)},flatten:function(e){return new Fr(e)},repeatVector:function(e){return new Nr(e)},reshape:function(e){return new Rr(e)},permute:function(e){return new Pr(e)},embedding:function(e){return new Lr(e)},add:function(e){return new Ur(e)},average:function(e){return new Vr(e)},concatenate:function(e){return new Hr(e)},maximum:function(e){return new Gr(e)},minimum:function(e){return new qr(e)},multiply:function(e){return new Wr(e)},dot:function(e){return new Kr(e)},batchNormalization:function(e){return new ei(e)},layerNormalization:function(e){return new ti(e)},zeroPadding2d:function(e){return new ni(e)},averagePooling1d:Ri,avgPool1d:function(e){return Ri(e)},avgPooling1d:function(e){return Ri(e)},averagePooling2d:Pi,avgPool2d:function(e){return Pi(e)},avgPooling2d:function(e){return Pi(e)},averagePooling3d:Bi,avgPool3d:function(e){return Bi(e)},avgPooling3d:function(e){return Bi(e)},globalAveragePooling1d:function(e){return new mi(e)},globalAveragePooling2d:function(e){return new yi(e)},globalMaxPooling1d:Li,globalMaxPooling2d:zi,maxPooling1d:Ui,maxPooling2d:Wi,maxPooling3d:function(e){return new di(e)},gru:function(e){return new Ai(e)},gruCell:function(e){return new Ci(e)},lstm:function(e){return new Di(e)},lstmCell:function(e){return new Oi(e)},simpleRNN:function(e){return new Si(e)},simpleRNNCell:function(e){return new Ei(e)},rnn:function(e){return new _i(e)},stackedRNNCells:function(e){return new Ti(e)},bidirectional:function(e){return new Ni(e)},timeDistributed:function(e){return new Fi(e)},globalMaxPool1d:Vi,globalMaxPool2d:Gi,maxPool1d:qi,maxPool2d:Hi,Layer:mt,RNN:_i,RNNCell:ki,input:Pn,gaussianNoise:function(e){return new Yr(e)},gaussianDropout:function(e){return new $r(e)},alphaDropout:function(e){return new Jr(e)},masking:function(e){return new Br(e)}}),Ki=Object.freeze({binaryAccuracy:function(e,t){return zt(e,t)},binaryCrossentropy:function(e,t){return qt(e,t)},sparseCategoricalAccuracy:function(e,t){return Ht(e,t)},categoricalAccuracy:function(e,t){return Ut(e,t)},categoricalCrossentropy:function(e,t){return Xt(e,t)},precision:function(e,t){return Vt(e,t)},recall:function(e,t){return Gt(e,t)},cosineProximity:function(e,t){return Pt(e,t)},meanAbsoluteError:function(e,t){return Mt(e,t)},meanAbsolutePercentageError:function(e,t){return Ft(e,t)},MAPE:function(e,t){return Ft(e,t)},mape:function(e,t){return Ft(e,t)},meanSquaredError:function(e,t){return jt(e,t)},MSE:function(e,t){return jt(e,t)},mse:function(e,t){return jt(e,t)}}),Yi=Object.freeze({modelFromJSON:function(e,t){return u(this,void 0,void 0,(function(){var n,i,a,o,s,u,l,f;return c(this,(function(c){switch(c.label){case 0:return"modelTopology"in e||(e={modelTopology:e}),null!=(n=e.modelTopology).model_config&&(n=n.model_config),i=an(n),a=Dt(i,t),null==e.weightsManifest?[3,2]:[4,r.io.loadWeights(e.weightsManifest,e.pathPrefix,a.weights.map((function(e){return e.originalName})))];case 1:for(o=c.sent(),s={},u=0,l=a.weights;u<l.length;u++)f=l[u],s[f.originalName]=o[f.originalName];a.loadWeights(s),Object(r.dispose)(o),c.label=2;case 2:return[2,a]}}))}))}}),$i=Object.freeze({l1l2:function(e){return new rr(e)},l1:function(e){return function(e){return tr(e),new rr({l1:null!=e?e.l1:null,l2:0})}(e)},l2:function(e){return function(e){return tr(e),new rr({l2:null!=e?e.l2:null,l1:0})}(e)}}),Ji=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.model=null,t}return a(t,e),t.prototype.setModel=function(e){if(!(e instanceof jn))throw new Error("model must be a LayersModel, not some other Container");this.model=e},t}(wt);function Zi(e,t){return e<t}function Qi(e,t){return e>t}var ea=function(e){function t(t){var n=e.call(this)||this;if(null==t&&(t={}),t.restoreBestWeights)throw new p("restoreBestWeights = True is not implemented in EarlyStopping yet.");return n.monitor=t.monitor||"val_loss",n.minDelta=Math.abs(t.minDelta||0),n.patience=t.patience||0,n.verbose=t.verbose||0,n.mode=t.mode||"auto",n.baseline=t.baseline,-1===["auto","min","max"].indexOf(n.mode)&&(console.warn("EarlyStopping mode '"+n.mode+"' is invalid. Falling back to mode 'auto'."),n.mode="auto"),"min"===n.mode?n.monitorFunc=Zi:"max"===n.mode||-1!==n.monitor.indexOf("acc")?n.monitorFunc=Qi:n.monitorFunc=Zi,n.monitorFunc===Zi&&(n.minDelta*=-1),n}return a(t,e),t.prototype.onTrainBegin=function(e){return u(this,void 0,void 0,(function(){return c(this,(function(e){return this.wait=0,this.stoppedEpoch=0,null!=this.baseline?this.best=this.baseline:this.best=this.monitorFunc===Zi?1/0:-1/0,[2]}))}))},t.prototype.onEpochEnd=function(e,t){return u(this,void 0,void 0,(function(){var n;return c(this,(function(r){switch(r.label){case 0:return[4,yt(t)];case 1:return r.sent(),null==(n=this.getMonitorValue(t))||(this.monitorFunc(n-this.minDelta,this.best)?(this.best=n,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=e,this.model.stopTraining=!0))),[2]}}))}))},t.prototype.onTrainEnd=function(e){return u(this,void 0,void 0,(function(){return c(this,(function(e){return this.stoppedEpoch>0&&this.verbose&&console.log("Epoch "+this.stoppedEpoch+": early stopping."),[2]}))}))},t.prototype.getMonitorValue=function(e){null==e&&(e={});var t=e[this.monitor];return null==t&&console.warn("Metric for EarlyStopping "+this.monitor+" is not available. Available metrics are: "+Object.keys(e)),t},t}(Ji),ta={earlyStopping:function(e){return new ea(e)}},na=n(20),ra=n(130);n.d(t,"version",(function(){return ia})),n.d(t,"AdadeltaOptimizer",(function(){return r.AdadeltaOptimizer})),n.d(t,"AdagradOptimizer",(function(){return r.AdagradOptimizer})),n.d(t,"AdamOptimizer",(function(){return r.AdamOptimizer})),n.d(t,"AdamaxOptimizer",(function(){return r.AdamaxOptimizer})),n.d(t,"Add",(function(){return r.Add})),n.d(t,"AddN",(function(){return r.AddN})),n.d(t,"BroadcastTo",(function(){return r.BroadcastTo})),n.d(t,"DataStorage",(function(){return r.DataStorage})),n.d(t,"Div",(function(){return r.Div})),n.d(t,"ENV",(function(){return r.ENV})),n.d(t,"Environment",(function(){return r.Environment})),n.d(t,"FromPixels",(function(){return r.FromPixels})),n.d(t,"FusedBatchNorm",(function(){return r.FusedBatchNorm})),n.d(t,"Identity",(function(){return r.Identity})),n.d(t,"KernelBackend",(function(){return r.KernelBackend})),n.d(t,"MaxPoolWithArgmax",(function(){return r.MaxPoolWithArgmax})),n.d(t,"MomentumOptimizer",(function(){return r.MomentumOptimizer})),n.d(t,"NonMaxSuppressionV5",(function(){return r.NonMaxSuppressionV5})),n.d(t,"OneHot",(function(){return r.OneHot})),n.d(t,"Optimizer",(function(){return r.Optimizer})),n.d(t,"PadV2",(function(){return r.PadV2})),n.d(t,"RMSPropOptimizer",(function(){return r.RMSPropOptimizer})),n.d(t,"Rank",(function(){return r.Rank})),n.d(t,"Reduction",(function(){return r.Reduction})),n.d(t,"SGDOptimizer",(function(){return r.SGDOptimizer})),n.d(t,"Square",(function(){return r.Square})),n.d(t,"SquaredDifference",(function(){return r.SquaredDifference})),n.d(t,"Tensor",(function(){return r.Tensor})),n.d(t,"TensorBuffer",(function(){return r.TensorBuffer})),n.d(t,"Tile",(function(){return r.Tile})),n.d(t,"Transpose",(function(){return r.Transpose})),n.d(t,"Variable",(function(){return r.Variable})),n.d(t,"abs",(function(){return r.abs})),n.d(t,"acos",(function(){return r.acos})),n.d(t,"acosh",(function(){return r.acosh})),n.d(t,"add",(function(){return r.add})),n.d(t,"addN",(function(){return r.addN})),n.d(t,"addStrict",(function(){return r.addStrict})),n.d(t,"all",(function(){return r.all})),n.d(t,"any",(function(){return r.any})),n.d(t,"argMax",(function(){return r.argMax})),n.d(t,"argMin",(function(){return r.argMin})),n.d(t,"asin",(function(){return r.asin})),n.d(t,"asinh",(function(){return r.asinh})),n.d(t,"atan",(function(){return r.atan})),n.d(t,"atan2",(function(){return r.atan2})),n.d(t,"atanh",(function(){return r.atanh})),n.d(t,"avgPool",(function(){return r.avgPool})),n.d(t,"avgPool3d",(function(){return r.avgPool3d})),n.d(t,"backend",(function(){return r.backend})),n.d(t,"backend_util",(function(){return r.backend_util})),n.d(t,"basicLSTMCell",(function(){return r.basicLSTMCell})),n.d(t,"batchNorm",(function(){return r.batchNorm})),n.d(t,"batchNorm2d",(function(){return r.batchNorm2d})),n.d(t,"batchNorm3d",(function(){return r.batchNorm3d})),n.d(t,"batchNorm4d",(function(){return r.batchNorm4d})),n.d(t,"batchNormalization",(function(){return r.batchNormalization})),n.d(t,"batchNormalization2d",(function(){return r.batchNormalization2d})),n.d(t,"batchNormalization3d",(function(){return r.batchNormalization3d})),n.d(t,"batchNormalization4d",(function(){return r.batchNormalization4d})),n.d(t,"batchToSpaceND",(function(){return r.batchToSpaceND})),n.d(t,"booleanMaskAsync",(function(){return r.booleanMaskAsync})),n.d(t,"broadcastTo",(function(){return r.broadcastTo})),n.d(t,"browser",(function(){return r.browser})),n.d(t,"buffer",(function(){return r.buffer})),n.d(t,"cast",(function(){return r.cast})),n.d(t,"ceil",(function(){return r.ceil})),n.d(t,"clipByValue",(function(){return r.clipByValue})),n.d(t,"clone",(function(){return r.clone})),n.d(t,"complex",(function(){return r.complex})),n.d(t,"concat",(function(){return r.concat})),n.d(t,"concat1d",(function(){return r.concat1d})),n.d(t,"concat2d",(function(){return r.concat2d})),n.d(t,"concat3d",(function(){return r.concat3d})),n.d(t,"concat4d",(function(){return r.concat4d})),n.d(t,"conv1d",(function(){return r.conv1d})),n.d(t,"conv2d",(function(){return r.conv2d})),n.d(t,"conv2dTranspose",(function(){return r.conv2dTranspose})),n.d(t,"conv3d",(function(){return r.conv3d})),n.d(t,"conv3dTranspose",(function(){return r.conv3dTranspose})),n.d(t,"cos",(function(){return r.cos})),n.d(t,"cosh",(function(){return r.cosh})),n.d(t,"cumsum",(function(){return r.cumsum})),n.d(t,"customGrad",(function(){return r.customGrad})),n.d(t,"deprecationWarn",(function(){return r.deprecationWarn})),n.d(t,"depthToSpace",(function(){return r.depthToSpace})),n.d(t,"depthwiseConv2d",(function(){return r.depthwiseConv2d})),n.d(t,"diag",(function(){return r.diag})),n.d(t,"disableDeprecationWarnings",(function(){return r.disableDeprecationWarnings})),n.d(t,"dispose",(function(){return r.dispose})),n.d(t,"disposeVariables",(function(){return r.disposeVariables})),n.d(t,"div",(function(){return r.div})),n.d(t,"divNoNan",(function(){return r.divNoNan})),n.d(t,"divStrict",(function(){return r.divStrict})),n.d(t,"dot",(function(){return r.dot})),n.d(t,"dropout",(function(){return r.dropout})),n.d(t,"elu",(function(){return r.elu})),n.d(t,"enableDebugMode",(function(){return r.enableDebugMode})),n.d(t,"enableProdMode",(function(){return r.enableProdMode})),n.d(t,"engine",(function(){return r.engine})),n.d(t,"env",(function(){return r.env})),n.d(t,"equal",(function(){return r.equal})),n.d(t,"equalStrict",(function(){return r.equalStrict})),n.d(t,"erf",(function(){return r.erf})),n.d(t,"exp",(function(){return r.exp})),n.d(t,"expandDims",(function(){return r.expandDims})),n.d(t,"expm1",(function(){return r.expm1})),n.d(t,"eye",(function(){return r.eye})),n.d(t,"fft",(function(){return r.fft})),n.d(t,"fill",(function(){return r.fill})),n.d(t,"findBackend",(function(){return r.findBackend})),n.d(t,"findBackendFactory",(function(){return r.findBackendFactory})),n.d(t,"floor",(function(){return r.floor})),n.d(t,"floorDiv",(function(){return r.floorDiv})),n.d(t,"frame",(function(){return r.frame})),n.d(t,"fused",(function(){return r.fused})),n.d(t,"gather",(function(){return r.gather})),n.d(t,"gatherND",(function(){return r.gatherND})),n.d(t,"gather_util",(function(){return r.gather_util})),n.d(t,"getBackend",(function(){return r.getBackend})),n.d(t,"getGradient",(function(){return r.getGradient})),n.d(t,"getKernel",(function(){return r.getKernel})),n.d(t,"getKernelsForBackend",(function(){return r.getKernelsForBackend})),n.d(t,"grad",(function(){return r.grad})),n.d(t,"grads",(function(){return r.grads})),n.d(t,"greater",(function(){return r.greater})),n.d(t,"greaterEqual",(function(){return r.greaterEqual})),n.d(t,"greaterEqualStrict",(function(){return r.greaterEqualStrict})),n.d(t,"greaterStrict",(function(){return r.greaterStrict})),n.d(t,"hammingWindow",(function(){return r.hammingWindow})),n.d(t,"hannWindow",(function(){return r.hannWindow})),n.d(t,"ifft",(function(){return r.ifft})),n.d(t,"imag",(function(){return r.imag})),n.d(t,"image",(function(){return r.image})),n.d(t,"inTopKAsync",(function(){return r.inTopKAsync})),n.d(t,"io",(function(){return r.io})),n.d(t,"irfft",(function(){return r.irfft})),n.d(t,"isFinite",(function(){return r.isFinite})),n.d(t,"isInf",(function(){return r.isInf})),n.d(t,"isNaN",(function(){return r.isNaN})),n.d(t,"keep",(function(){return r.keep})),n.d(t,"leakyRelu",(function(){return r.leakyRelu})),n.d(t,"less",(function(){return r.less})),n.d(t,"lessEqual",(function(){return r.lessEqual})),n.d(t,"lessEqualStrict",(function(){return r.lessEqualStrict})),n.d(t,"lessStrict",(function(){return r.lessStrict})),n.d(t,"linalg",(function(){return r.linalg})),n.d(t,"linspace",(function(){return r.linspace})),n.d(t,"localResponseNormalization",(function(){return r.localResponseNormalization})),n.d(t,"log",(function(){return r.log})),n.d(t,"log1p",(function(){return r.log1p})),n.d(t,"logSigmoid",(function(){return r.logSigmoid})),n.d(t,"logSoftmax",(function(){return r.logSoftmax})),n.d(t,"logSumExp",(function(){return r.logSumExp})),n.d(t,"logicalAnd",(function(){return r.logicalAnd})),n.d(t,"logicalNot",(function(){return r.logicalNot})),n.d(t,"logicalOr",(function(){return r.logicalOr})),n.d(t,"logicalXor",(function(){return r.logicalXor})),n.d(t,"losses",(function(){return r.losses})),n.d(t,"matMul",(function(){return r.matMul})),n.d(t,"math",(function(){return r.math})),n.d(t,"max",(function(){return r.max})),n.d(t,"maxPool",(function(){return r.maxPool})),n.d(t,"maxPool3d",(function(){return r.maxPool3d})),n.d(t,"maxPoolWithArgmax",(function(){return r.maxPoolWithArgmax})),n.d(t,"maximum",(function(){return r.maximum})),n.d(t,"maximumStrict",(function(){return r.maximumStrict})),n.d(t,"mean",(function(){return r.mean})),n.d(t,"memory",(function(){return r.memory})),n.d(t,"min",(function(){return r.min})),n.d(t,"minimum",(function(){return r.minimum})),n.d(t,"minimumStrict",(function(){return r.minimumStrict})),n.d(t,"mod",(function(){return r.mod})),n.d(t,"modStrict",(function(){return r.modStrict})),n.d(t,"moments",(function(){return r.moments})),n.d(t,"movingAverage",(function(){return r.movingAverage})),n.d(t,"mul",(function(){return r.mul})),n.d(t,"mulStrict",(function(){return r.mulStrict})),n.d(t,"multiRNNCell",(function(){return r.multiRNNCell})),n.d(t,"multinomial",(function(){return r.multinomial})),n.d(t,"neg",(function(){return r.neg})),n.d(t,"nextFrame",(function(){return r.nextFrame})),n.d(t,"norm",(function(){return r.norm})),n.d(t,"notEqual",(function(){return r.notEqual})),n.d(t,"notEqualStrict",(function(){return r.notEqualStrict})),n.d(t,"oneHot",(function(){return r.oneHot})),n.d(t,"ones",(function(){return r.ones})),n.d(t,"onesLike",(function(){return r.onesLike})),n.d(t,"op",(function(){return r.op})),n.d(t,"outerProduct",(function(){return r.outerProduct})),n.d(t,"pad",(function(){return r.pad})),n.d(t,"pad1d",(function(){return r.pad1d})),n.d(t,"pad2d",(function(){return r.pad2d})),n.d(t,"pad3d",(function(){return r.pad3d})),n.d(t,"pad4d",(function(){return r.pad4d})),n.d(t,"pool",(function(){return r.pool})),n.d(t,"pow",(function(){return r.pow})),n.d(t,"powStrict",(function(){return r.powStrict})),n.d(t,"prelu",(function(){return r.prelu})),n.d(t,"print",(function(){return r.print})),n.d(t,"prod",(function(){return r.prod})),n.d(t,"profile",(function(){return r.profile})),n.d(t,"rand",(function(){return r.rand})),n.d(t,"randomGamma",(function(){return r.randomGamma})),n.d(t,"randomNormal",(function(){return r.randomNormal})),n.d(t,"randomUniform",(function(){return r.randomUniform})),n.d(t,"range",(function(){return r.range})),n.d(t,"ready",(function(){return r.ready})),n.d(t,"real",(function(){return r.real})),n.d(t,"reciprocal",(function(){return r.reciprocal})),n.d(t,"registerBackend",(function(){return r.registerBackend})),n.d(t,"registerGradient",(function(){return r.registerGradient})),n.d(t,"registerKernel",(function(){return r.registerKernel})),n.d(t,"relu",(function(){return r.relu})),n.d(t,"relu6",(function(){return r.relu6})),n.d(t,"removeBackend",(function(){return r.removeBackend})),n.d(t,"reshape",(function(){return r.reshape})),n.d(t,"reverse",(function(){return r.reverse})),n.d(t,"reverse1d",(function(){return r.reverse1d})),n.d(t,"reverse2d",(function(){return r.reverse2d})),n.d(t,"reverse3d",(function(){return r.reverse3d})),n.d(t,"reverse4d",(function(){return r.reverse4d})),n.d(t,"rfft",(function(){return r.rfft})),n.d(t,"round",(function(){return r.round})),n.d(t,"rsqrt",(function(){return r.rsqrt})),n.d(t,"scalar",(function(){return r.scalar})),n.d(t,"scatterND",(function(){return r.scatterND})),n.d(t,"scatter_util",(function(){return r.scatter_util})),n.d(t,"selu",(function(){return r.selu})),n.d(t,"separableConv2d",(function(){return r.separableConv2d})),n.d(t,"serialization",(function(){return r.serialization})),n.d(t,"setBackend",(function(){return r.setBackend})),n.d(t,"setPlatform",(function(){return r.setPlatform})),n.d(t,"setdiff1dAsync",(function(){return r.setdiff1dAsync})),n.d(t,"sigmoid",(function(){return r.sigmoid})),n.d(t,"sign",(function(){return r.sign})),n.d(t,"signal",(function(){return r.signal})),n.d(t,"sin",(function(){return r.sin})),n.d(t,"sinh",(function(){return r.sinh})),n.d(t,"slice",(function(){return r.slice})),n.d(t,"slice1d",(function(){return r.slice1d})),n.d(t,"slice2d",(function(){return r.slice2d})),n.d(t,"slice3d",(function(){return r.slice3d})),n.d(t,"slice4d",(function(){return r.slice4d})),n.d(t,"slice_util",(function(){return r.slice_util})),n.d(t,"softmax",(function(){return r.softmax})),n.d(t,"softplus",(function(){return r.softplus})),n.d(t,"spaceToBatchND",(function(){return r.spaceToBatchND})),n.d(t,"sparseToDense",(function(){return r.sparseToDense})),n.d(t,"spectral",(function(){return r.spectral})),n.d(t,"split",(function(){return r.split})),n.d(t,"sqrt",(function(){return r.sqrt})),n.d(t,"square",(function(){return r.square})),n.d(t,"squaredDifference",(function(){return r.squaredDifference})),n.d(t,"squaredDifferenceStrict",(function(){return r.squaredDifferenceStrict})),n.d(t,"squeeze",(function(){return r.squeeze})),n.d(t,"stack",(function(){return r.stack})),n.d(t,"step",(function(){return r.step})),n.d(t,"stft",(function(){return r.stft})),n.d(t,"stridedSlice",(function(){return r.stridedSlice})),n.d(t,"sub",(function(){return r.sub})),n.d(t,"subStrict",(function(){return r.subStrict})),n.d(t,"sum",(function(){return r.sum})),n.d(t,"sumOutType",(function(){return r.sumOutType})),n.d(t,"tan",(function(){return r.tan})),n.d(t,"tanh",(function(){return r.tanh})),n.d(t,"tensor",(function(){return r.tensor})),n.d(t,"tensor1d",(function(){return r.tensor1d})),n.d(t,"tensor2d",(function(){return r.tensor2d})),n.d(t,"tensor3d",(function(){return r.tensor3d})),n.d(t,"tensor4d",(function(){return r.tensor4d})),n.d(t,"tensor5d",(function(){return r.tensor5d})),n.d(t,"tensor6d",(function(){return r.tensor6d})),n.d(t,"tensor_util",(function(){return r.tensor_util})),n.d(t,"test_util",(function(){return r.test_util})),n.d(t,"tidy",(function(){return r.tidy})),n.d(t,"tile",(function(){return r.tile})),n.d(t,"time",(function(){return r.time})),n.d(t,"topk",(function(){return r.topk})),n.d(t,"train",(function(){return r.train})),n.d(t,"transpose",(function(){return r.transpose})),n.d(t,"truncatedNormal",(function(){return r.truncatedNormal})),n.d(t,"unregisterGradient",(function(){return r.unregisterGradient})),n.d(t,"unregisterKernel",(function(){return r.unregisterKernel})),n.d(t,"unsortedSegmentSum",(function(){return r.unsortedSegmentSum})),n.d(t,"unstack",(function(){return r.unstack})),n.d(t,"util",(function(){return r.util})),n.d(t,"valueAndGrad",(function(){return r.valueAndGrad})),n.d(t,"valueAndGrads",(function(){return r.valueAndGrads})),n.d(t,"variable",(function(){return r.variable})),n.d(t,"variableGrads",(function(){return r.variableGrads})),n.d(t,"version_core",(function(){return r.version_core})),n.d(t,"webgl",(function(){return r.webgl})),n.d(t,"where",(function(){return r.where})),n.d(t,"whereAsync",(function(){return r.whereAsync})),n.d(t,"zeros",(function(){return r.zeros})),n.d(t,"zerosLike",(function(){return r.zerosLike})),n.d(t,"constraints",(function(){return V})),n.d(t,"initializers",(function(){return Ye})),n.d(t,"layers",(function(){return Xi})),n.d(t,"metrics",(function(){return Ki})),n.d(t,"models",(function(){return Yi})),n.d(t,"regularizers",(function(){return $i})),n.d(t,"CallbackList",(function(){return _t})),n.d(t,"CustomCallback",(function(){return St})),n.d(t,"History",(function(){return Et})),n.d(t,"Callback",(function(){return Ji})),n.d(t,"callbacks",(function(){return ta})),n.d(t,"EarlyStopping",(function(){return ea})),n.d(t,"InputSpec",(function(){return lt})),n.d(t,"SymbolicTensor",(function(){return ft})),n.d(t,"LayersModel",(function(){return jn})),n.d(t,"input",(function(){return Pn})),n.d(t,"loadLayersModel",(function(){return Rn})),n.d(t,"model",(function(){return In})),n.d(t,"registerCallbackConstructor",(function(){return Bn})),n.d(t,"sequential",(function(){return Nn})),n.d(t,"RNN",(function(){return _i})),n.d(t,"Sequential",(function(){return Fn})),n.d(t,"LayerVariable",(function(){return ot})),n.d(t,"version_layers",(function(){return"1.7.4"})),n.d(t,"GraphModel",(function(){return na.GraphModel})),n.d(t,"loadGraphModel",(function(){return na.loadGraphModel})),n.d(t,"deregisterOp",(function(){return na.deregisterOp})),n.d(t,"registerOp",(function(){return na.registerOp})),n.d(t,"version_converter",(function(){return na.version_converter})),n.d(t,"data",(function(){return ra}));var ia={"tfjs-core":r.version_core,"tfjs-data":ra.version_data,"tfjs-layers":"1.7.4","tfjs-converter":na.version_converter,tfjs:"1.7.4"}},function(e,t,n){"use strict";n.r(t),function(e,r,i,a){n.d(t,"AdadeltaOptimizer",(function(){return nd})),n.d(t,"AdagradOptimizer",(function(){return rd})),n.d(t,"AdamOptimizer",(function(){return id})),n.d(t,"AdamaxOptimizer",(function(){return ad})),n.d(t,"DataStorage",(function(){return _i})),n.d(t,"ENV",(function(){return d})),n.d(t,"Environment",(function(){return l})),n.d(t,"KernelBackend",(function(){return ki})),n.d(t,"MomentumOptimizer",(function(){return sd})),n.d(t,"Optimizer",(function(){return td})),n.d(t,"RMSPropOptimizer",(function(){return ud})),n.d(t,"Rank",(function(){return Ce})),n.d(t,"Reduction",(function(){return Hc})),n.d(t,"SGDOptimizer",(function(){return od})),n.d(t,"Tensor",(function(){return Se})),n.d(t,"TensorBuffer",(function(){return we})),n.d(t,"Variable",(function(){return je})),n.d(t,"abs",(function(){return qo})),n.d(t,"acos",(function(){return Ho})),n.d(t,"acosh",(function(){return Xo})),n.d(t,"add",(function(){return qs})),n.d(t,"addN",(function(){return Hs})),n.d(t,"addStrict",(function(){return Xs})),n.d(t,"all",(function(){return lc})),n.d(t,"any",(function(){return fc})),n.d(t,"argMax",(function(){return dc})),n.d(t,"argMin",(function(){return hc})),n.d(t,"asin",(function(){return Ko})),n.d(t,"asinh",(function(){return Yo})),n.d(t,"atan",(function(){return $o})),n.d(t,"atan2",(function(){return Ks})),n.d(t,"atanh",(function(){return Jo})),n.d(t,"avgPool",(function(){return ec})),n.d(t,"avgPool3d",(function(){return rc})),n.d(t,"backend",(function(){return mn})),n.d(t,"backend_util",(function(){return Vi})),n.d(t,"basicLSTMCell",(function(){return Tc})),n.d(t,"batchNorm",(function(){return Ns})),n.d(t,"batchNorm2d",(function(){return Rs})),n.d(t,"batchNorm3d",(function(){return Ps})),n.d(t,"batchNorm4d",(function(){return Bs})),n.d(t,"batchNormalization",(function(){return Is})),n.d(t,"batchNormalization2d",(function(){return js})),n.d(t,"batchNormalization3d",(function(){return Ms})),n.d(t,"batchNormalization4d",(function(){return Fs})),n.d(t,"batchToSpaceND",(function(){return br})),n.d(t,"booleanMaskAsync",(function(){return Ou})),n.d(t,"broadcastTo",(function(){return xr})),n.d(t,"browser",(function(){return Wf})),n.d(t,"buffer",(function(){return gr})),n.d(t,"cast",(function(){return wr})),n.d(t,"ceil",(function(){return Zo})),n.d(t,"clipByValue",(function(){return Qo})),n.d(t,"clone",(function(){return _r})),n.d(t,"complex",(function(){return Fn})),n.d(t,"concat",(function(){return Qn})),n.d(t,"concat1d",(function(){return er})),n.d(t,"concat2d",(function(){return tr})),n.d(t,"concat3d",(function(){return nr})),n.d(t,"concat4d",(function(){return rr})),n.d(t,"conv1d",(function(){return Mu})),n.d(t,"conv2d",(function(){return Fu})),n.d(t,"conv2dTranspose",(function(){return Uu})),n.d(t,"conv3d",(function(){return Iu})),n.d(t,"conv3dTranspose",(function(){return Wu})),n.d(t,"cos",(function(){return es})),n.d(t,"cosh",(function(){return ts})),n.d(t,"cumsum",(function(){return kr})),n.d(t,"customGrad",(function(){return yi})),n.d(t,"deprecationWarn",(function(){return Zt})),n.d(t,"depthToSpace",(function(){return Er})),n.d(t,"depthwiseConv2d",(function(){return Pu})),n.d(t,"diag",(function(){return Vc})),n.d(t,"disableDeprecationWarnings",(function(){return Jt})),n.d(t,"dispose",(function(){return an})),n.d(t,"disposeVariables",(function(){return Qt})),n.d(t,"div",(function(){return Ys})),n.d(t,"divNoNan",(function(){return $s})),n.d(t,"divStrict",(function(){return Js})),n.d(t,"dot",(function(){return Gu})),n.d(t,"dropout",(function(){return Gc})),n.d(t,"elu",(function(){return wc})),n.d(t,"enableDebugMode",(function(){return $t})),n.d(t,"enableProdMode",(function(){return Yt})),n.d(t,"engine",(function(){return en})),n.d(t,"env",(function(){return f})),n.d(t,"equal",(function(){return du})),n.d(t,"equalStrict",(function(){return hu})),n.d(t,"erf",(function(){return ns})),n.d(t,"exp",(function(){return rs})),n.d(t,"expandDims",(function(){return Sr})),n.d(t,"expm1",(function(){return is})),n.d(t,"eye",(function(){return Cr})),n.d(t,"fft",(function(){return Rc})),n.d(t,"fill",(function(){return Kn})),n.d(t,"findBackend",(function(){return dn})),n.d(t,"findBackendFactory",(function(){return hn})),n.d(t,"floor",(function(){return as})),n.d(t,"floorDiv",(function(){return Zs})),n.d(t,"frame",(function(){return Yc})),n.d(t,"fused",(function(){return Ol})),n.d(t,"gather",(function(){return Cu})),n.d(t,"gatherND",(function(){return Wc})),n.d(t,"gather_util",(function(){return Zr})),n.d(t,"getBackend",(function(){return ln})),n.d(t,"getGradient",(function(){return v})),n.d(t,"getKernel",(function(){return m})),n.d(t,"getKernelsForBackend",(function(){return g})),n.d(t,"grad",(function(){return hi})),n.d(t,"grads",(function(){return pi})),n.d(t,"greater",(function(){return pu})),n.d(t,"greaterEqual",(function(){return mu})),n.d(t,"greaterEqualStrict",(function(){return vu})),n.d(t,"greaterStrict",(function(){return gu})),n.d(t,"hammingWindow",(function(){return Kc})),n.d(t,"hannWindow",(function(){return Xc})),n.d(t,"ifft",(function(){return Pc})),n.d(t,"imag",(function(){return Nn})),n.d(t,"image",(function(){return xl})),n.d(t,"inTopKAsync",(function(){return Zc})),n.d(t,"io",(function(){return Bf})),n.d(t,"irfft",(function(){return Lc})),n.d(t,"isFinite",(function(){return gs})),n.d(t,"isInf",(function(){return vs})),n.d(t,"isNaN",(function(){return ms})),n.d(t,"keep",(function(){return on})),n.d(t,"leakyRelu",(function(){return _c})),n.d(t,"less",(function(){return yu})),n.d(t,"lessEqual",(function(){return bu})),n.d(t,"lessEqualStrict",(function(){return xu})),n.d(t,"lessStrict",(function(){return wu})),n.d(t,"linalg",(function(){return hl})),n.d(t,"linspace",(function(){return Yn})),n.d(t,"localResponseNormalization",(function(){return Oc})),n.d(t,"log",(function(){return os})),n.d(t,"log1p",(function(){return ss})),n.d(t,"logSigmoid",(function(){return us})),n.d(t,"logSoftmax",(function(){return wi})),n.d(t,"logSumExp",(function(){return pc})),n.d(t,"logicalAnd",(function(){return Ls})),n.d(t,"logicalNot",(function(){return zs})),n.d(t,"logicalOr",(function(){return Us})),n.d(t,"logicalXor",(function(){return Ws})),n.d(t,"losses",(function(){return ul})),n.d(t,"matMul",(function(){return Vu})),n.d(t,"math",(function(){return zf})),n.d(t,"max",(function(){return mc})),n.d(t,"maxPool",(function(){return Qu})),n.d(t,"maxPool3d",(function(){return nc})),n.d(t,"maximum",(function(){return Qs})),n.d(t,"maximumStrict",(function(){return eu})),n.d(t,"mean",(function(){return vc})),n.d(t,"memory",(function(){return tn})),n.d(t,"min",(function(){return gc})),n.d(t,"minimum",(function(){return tu})),n.d(t,"minimumStrict",(function(){return nu})),n.d(t,"mod",(function(){return ru})),n.d(t,"modStrict",(function(){return iu})),n.d(t,"moments",(function(){return yc})),n.d(t,"movingAverage",(function(){return Mc})),n.d(t,"mul",(function(){return au})),n.d(t,"mulStrict",(function(){return ou})),n.d(t,"multiRNNCell",(function(){return jc})),n.d(t,"multinomial",(function(){return Ar})),n.d(t,"neg",(function(){return cs})),n.d(t,"nextFrame",(function(){return dd})),n.d(t,"norm",(function(){return Dc})),n.d(t,"notEqual",(function(){return _u})),n.d(t,"notEqualStrict",(function(){return ku})),n.d(t,"oneHot",(function(){return Or})),n.d(t,"ones",(function(){return Hn})),n.d(t,"onesLike",(function(){return Jn})),n.d(t,"op",(function(){return Mn})),n.d(t,"outerProduct",(function(){return qu})),n.d(t,"pad",(function(){return Dr})),n.d(t,"pad1d",(function(){return Tr})),n.d(t,"pad2d",(function(){return jr})),n.d(t,"pad3d",(function(){return Mr})),n.d(t,"pad4d",(function(){return Fr})),n.d(t,"pool",(function(){return tc})),n.d(t,"pow",(function(){return su})),n.d(t,"powStrict",(function(){return uu})),n.d(t,"prelu",(function(){return kc})),n.d(t,"print",(function(){return yr})),n.d(t,"prod",(function(){return xc})),n.d(t,"profile",(function(){return nn})),n.d(t,"rand",(function(){return Ir})),n.d(t,"randomGamma",(function(){return Rr})),n.d(t,"randomNormal",(function(){return Nr})),n.d(t,"randomUniform",(function(){return Pr})),n.d(t,"range",(function(){return $n})),n.d(t,"ready",(function(){return cn})),n.d(t,"real",(function(){return In})),n.d(t,"reciprocal",(function(){return ls})),n.d(t,"registerBackend",(function(){return pn})),n.d(t,"registerGradient",(function(){return b})),n.d(t,"registerKernel",(function(){return y})),n.d(t,"relu",(function(){return Ec})),n.d(t,"relu6",(function(){return Sc})),n.d(t,"removeBackend",(function(){return fn})),n.d(t,"reshape",(function(){return Br})),n.d(t,"reverse",(function(){return Hu})),n.d(t,"reverse1d",(function(){return Xu})),n.d(t,"reverse2d",(function(){return Ku})),n.d(t,"reverse3d",(function(){return Yu})),n.d(t,"reverse4d",(function(){return $u})),n.d(t,"rfft",(function(){return Bc})),n.d(t,"round",(function(){return fs})),n.d(t,"rsqrt",(function(){return ds})),n.d(t,"scalar",(function(){return Bn})),n.d(t,"scatterND",(function(){return Nc})),n.d(t,"scatter_util",(function(){return ii})),n.d(t,"selu",(function(){return Cc})),n.d(t,"separableConv2d",(function(){return zu})),n.d(t,"serialization",(function(){return Hf})),n.d(t,"setBackend",(function(){return un})),n.d(t,"setPlatform",(function(){return vn})),n.d(t,"setdiff1dAsync",(function(){return qr})),n.d(t,"sigmoid",(function(){return hs})),n.d(t,"sign",(function(){return ps})),n.d(t,"signal",(function(){return Jc})),n.d(t,"sin",(function(){return ys})),n.d(t,"sinh",(function(){return bs})),n.d(t,"slice",(function(){return ic})),n.d(t,"slice1d",(function(){return ac})),n.d(t,"slice2d",(function(){return oc})),n.d(t,"slice3d",(function(){return sc})),n.d(t,"slice4d",(function(){return uc})),n.d(t,"slice_util",(function(){return di})),n.d(t,"softmax",(function(){return xi})),n.d(t,"softplus",(function(){return xs})),n.d(t,"spaceToBatchND",(function(){return Lr})),n.d(t,"sparseToDense",(function(){return Uc})),n.d(t,"spectral",(function(){return zc})),n.d(t,"split",(function(){return ir})),n.d(t,"sqrt",(function(){return ws})),n.d(t,"square",(function(){return Wo})),n.d(t,"squaredDifference",(function(){return Go})),n.d(t,"squaredDifferenceStrict",(function(){return cu})),n.d(t,"squeeze",(function(){return zr})),n.d(t,"stack",(function(){return Ur})),n.d(t,"step",(function(){return _s})),n.d(t,"stft",(function(){return $c})),n.d(t,"stridedSlice",(function(){return Fc})),n.d(t,"sub",(function(){return lu})),n.d(t,"subStrict",(function(){return fu})),n.d(t,"sum",(function(){return bc})),n.d(t,"sumOutType",(function(){return Ie})),n.d(t,"tan",(function(){return ks})),n.d(t,"tanh",(function(){return Es})),n.d(t,"tensor",(function(){return Rn})),n.d(t,"tensor1d",(function(){return Ln})),n.d(t,"tensor2d",(function(){return zn})),n.d(t,"tensor3d",(function(){return Un})),n.d(t,"tensor4d",(function(){return Wn})),n.d(t,"tensor5d",(function(){return Vn})),n.d(t,"tensor6d",(function(){return Gn})),n.d(t,"tensor_util",(function(){return Le})),n.d(t,"test_util",(function(){return Zf})),n.d(t,"tidy",(function(){return rn})),n.d(t,"tile",(function(){return Wr})),n.d(t,"time",(function(){return sn})),n.d(t,"topk",(function(){return Ic})),n.d(t,"train",(function(){return ld})),n.d(t,"transpose",(function(){return Ac})),n.d(t,"truncatedNormal",(function(){return Vr})),n.d(t,"unregisterGradient",(function(){return w})),n.d(t,"unregisterKernel",(function(){return x})),n.d(t,"unsortedSegmentSum",(function(){return Au})),n.d(t,"unstack",(function(){return Gr})),n.d(t,"util",(function(){return de})),n.d(t,"valueAndGrad",(function(){return mi})),n.d(t,"valueAndGrads",(function(){return vi})),n.d(t,"variable",(function(){return qn})),n.d(t,"variableGrads",(function(){return gi})),n.d(t,"version_core",(function(){return Qf})),n.d(t,"webgl",(function(){return ed})),n.d(t,"where",(function(){return Vs})),n.d(t,"whereAsync",(function(){return Gs})),n.d(t,"zeros",(function(){return Xn})),n.d(t,"zerosLike",(function(){return Zn}));var o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function s(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function u(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))}function c(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}var l=function(){function e(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return e.prototype.setPlatform=function(e,t){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},e.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+r+"."),this.set(e,r)}},e.prototype.get=function(e){return e in this.flags||(this.flags[e]=this.evaluateFlag(e)),this.flags[e]},e.prototype.getNumber=function(e){return this.get(e)},e.prototype.getBool=function(e){return this.get(e)},e.prototype.getFlags=function(){return this.flags},Object.defineProperty(e.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),e.prototype.set=function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)},e.prototype.evaluateFlag=function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},e.prototype.setFlags=function(e){this.flags=Object.assign({},e)},e.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},e.prototype.populateURLFlags=function(){var e=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var t,n,r=(t=this.global.location.search,n={},t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(n,t[0],t[1]),t.join("=")})),n);"tfjsflags"in r&&r.tfjsflags.split(",").forEach((function(t){var n=t.split(":"),r=n[0],i=n[1];e.urlFlags[r]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if(""+ +t===t)return+t;throw new Error("Could not parse value flag value "+t+" for flag "+e+".")}(r,i)}))}},e}();function f(){return d}var d=null,h=new Map,p=new Map;function m(e,t){var n=_(e,t);return h.get(n)}function v(e){return p.get(e)}function g(e){for(var t=h.entries(),n=[];;){var r=t.next(),i=r.done,a=r.value;if(i)break;var o=a[0],s=a[1];o.split("_")[0]===e&&n.push(s)}return n}function y(e){var t=e.kernelName,n=e.backendName,r=_(t,n);if(h.has(r))throw new Error("The kernel '"+t+"' for backend '"+n+"' is already registered");h.set(r,e)}function b(e){var t=e.kernelName;p.has(t)&&console.warn("Overriding the gradient for '"+t+"'"),p.set(t,e)}function x(e,t){var n=_(e,t);if(!h.has(n))throw new Error("The kernel '"+e+"' for backend '"+t+"' is not registered");h.delete(n)}function w(e){if(!p.has(e))throw new Error("The gradient '"+e+"' for backend is not registered");p.delete(e)}function _(e,t){return t+"_"+e}function k(e){for(var t=e.length,n=0,r=0;t>0;)r=Math.random()*t|0,n=e[--t],e[t]=e[r],e[r]=n}function E(e,t,n){return Math.max(e,Math.min(t,n))}function S(e){return e%2==0?e:e+1}function C(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function A(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function O(e,t,n){void 0===n&&(n=""),A(M(e,t),(function(){return n+" Shapes "+e+" and "+t+" must match"}))}function D(e){A(null!=e,(function(){return"The input to the tensor constructor must be a non-null value."}))}function T(e,t,n){if(void 0===t&&(t=[]),void 0===n&&(n=!1),null==t&&(t=[]),Array.isArray(e)||H(e)&&!n)for(var r=0;r<e.length;++r)T(e[r],t,n);else t.push(e);return t}function j(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function M(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function F(e){return e%1==0}function I(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function N(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function R(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function P(e,t,n){return void 0===t&&(t=function(e){return 0}),new Promise((function(r,i){var a=0,o=function o(){if(e())r();else{var s=t(++a);null!=n&&a>=n?i():setTimeout(o,s)}};o()}))}function B(e,t){for(var n=1,r=-1,i=0;i<e.length;++i)if(e[i]>=0)n*=e[i];else if(-1===e[i]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+i);r=i}else if(e[i]<0)throw Error("Shapes can not be < 0. Found "+e[i]+" at dim "+i);if(-1===r){if(t>0&&t!==n)throw Error("Size("+t+") must match the product of shape "+e);return e}if(0===n)throw Error("Cannot infer the missing size in ["+e+"] when there are 0 elements");if(t%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+n);var a=e.slice();return a[r]=t/n,a}function L(e,t){var n=t.length;return A((e=null==e?t.map((function(e,t){return t})):[].concat(e)).every((function(e){return e>=-n&&e<n})),(function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+e})),A(e.every((function(e){return F(e)})),(function(){return"All values in axis param must be integers but got axis "+e})),e.map((function(e){return e<0?n+e:e}))}function z(e,t){for(var n=[],r=[],i=null!=t&&Array.isArray(t)&&0===t.length,a=null==t||i?null:L(t,e).sort(),o=0,s=0;s<e.length;++s){if(null!=a){if(a[o]===s&&1!==e[s])throw new Error("Can't squeeze axis "+s+" since its dim '"+e[s]+"' is not 1");(null==a[o]||a[o]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),a[o]<=s&&o++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function U(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type "+e);n=new Uint8Array(t)}return n}function W(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type "+e);n=new Array(t)}return n}function V(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+t+" being uploaded contains "+r+".")}}function G(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}function q(e,t){return!("complex64"===t||"float32"===t&&"complex64"!==e||"int32"===t&&"float32"!==e&&"complex64"!==e||"bool"===t&&"bool"===e)}function H(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function X(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype "+e)}function K(e){if(null==e)return 0;var t=0;return e.forEach((function(e){return t+=e.length})),t}function Y(e){return"string"==typeof e||e instanceof String}function $(e){return"boolean"==typeof e}function J(e){return"number"==typeof e}function Z(e){return Array.isArray(e)?Z(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":J(e)?"float32":Y(e)?"string":$(e)?"bool":"float32"}function Q(e){return!!(e&&e.constructor&&e.call&&e.apply)}function ee(e,t){for(var n=t;n<e;++n)if(e%n==0)return n;return e}function te(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function ne(e,t,n){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=T(e)),n&&V(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var r=new Uint8Array(e.length),i=0;i<r.length;++i)0!==Math.round(e[i])&&(r[i]=1);return r}throw new Error("Unknown data type "+t)}function re(e,t){if(0===e.length)return t[0];var n=e.reduce((function(e,t){return e*t}));if(0===n)return[];if(n!==t.length)throw new Error("["+e+"] does not match the input size.");return function e(t,n,r){var i=new Array;if(1===n.length)for(var a=n[0],o=0;o<a;o++)i[o]=r[t+o];else{a=n[0];var s=n.slice(1),u=s.reduce((function(e,t){return e*t}));for(o=0;o<a;o++)i[o]=e(t+o*u,s,r)}return i}(0,e,t)}function ie(e,t){for(var n=ae(e,t),r=0;r<n.length;r++)n[r]=1;return n}function ae(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type "+t)}function oe(){return f().platform.now()}function se(e){e.forEach((function(t){A(Number.isInteger(t)&&t>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape ["+e+"]."}))}))}function ue(e,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",f().platform.encode(e,t)}function ce(e,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",f().platform.decode(e,t)}function le(e,t,n){if(0===t)return 0;if(1===t)return e[0];for(var r=e[e.length-1],i=0;i<e.length-1;++i)r+=n[i]*e[i];return r}function fe(e,t,n){if(0===t)return[];if(1===t)return[e];for(var r=new Array(t),i=0;i<r.length-1;++i)r[i]=Math.floor(e/n[i]),e-=r[i]*n[i];return r[r.length-1]=e,r}var de=Object.freeze({shuffle:k,clamp:E,nearestLargerEven:S,sum:C,randUniform:function(e,t){var n=Math.random();return t*n+(1-n)*e},distSquared:function(e,t){for(var n=0,r=0;r<e.length;r++){var i=Number(e[r])-Number(t[r]);n+=i*i}return n},assert:A,assertShapesMatch:O,assertNonNull:D,flatten:T,sizeFromShape:j,isScalarShape:function(e){return 0===e.length},arraysEqual:M,isInt:F,tanh:I,sizeToSquarishShape:N,createShuffledIndices:function(e){for(var t=new Uint32Array(e),n=0;n<e;++n)t[n]=n;return k(t),t},rightPad:R,repeatedTry:P,inferFromImplicitShape:B,parseAxisParam:L,squeezeShape:z,getTypedArrayFromDType:U,getArrayFromDType:W,checkConversionForErrors:V,isValidDtype:G,hasEncodingLoss:q,isTypedArray:H,bytesPerElement:X,bytesFromStringArray:K,isString:Y,isBoolean:$,isNumber:J,inferDtype:Z,isFunction:Q,nearestDivisor:ee,computeStrides:te,toTypedArray:ne,toNestedArray:re,makeOnesTypedArray:ie,makeZerosTypedArray:ae,now:oe,assertNonNegativeIntegerDimensions:se,fetch:function(e,t){return f().platform.fetch(e,t)},encodeString:ue,decodeString:ce,locToIndex:le,indexToLoc:fe}),he=function(){function e(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new pe)}return e.prototype.profileKernel=function(e,t,n){var r,i=this,a=this.backendTimer.time((function(){r=n()}));return r.forEach((function(n){n.data().then((function(r){!function(e,t,n){if("float32"!==t)return!1;for(var r=0;r<e.length;r++){var i=e[r];if(isNaN(i)||!isFinite(i))return console.warn("Found "+i+" in the result of '"+n+"'"),!0}}(r,n.dtype,e),a.then((function(a){var o="";null!=a.getExtraProfileInfo&&(o=a.getExtraProfileInfo()),i.logger.logKernelProfile(e,n,r,a.kernelMs,t,o)}))}))})),r},e}(),pe=function(){function e(){}return e.prototype.logKernelProfile=function(e,t,n,r,i,a){var o="number"==typeof r?R(r+"ms",9):r.error,s=R(e,25),u=t.rank,c=t.size,l=R(t.shape.toString(),14),f="";for(var d in i){var h=i[d].shape||t.shape,p=h.length;f+=d+": "+p+"D "+(p>0?h:"")+" "}console.log("%c"+s+"\t%c"+o+"\t%c"+u+"D "+l+"\t%c"+c+"\t%c"+f+"\t%c"+a,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},e}(),me=20,ve=3,ge=7;function ye(e,t,n){return R(Array.isArray(e)?parseFloat(e[0].toFixed(ge))+" + "+parseFloat(e[1].toFixed(ge))+"j":Y(e)?"'"+e+"'":"bool"===n?be(e):parseFloat(e.toFixed(ge)).toString(),t)}function be(e){return 0===e?"false":"true"}function xe(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var we=function(){function e(e,t,n){var r=this;if(this.dtype=t,this.shape=e.slice(),this.size=j(e),null!=n){var i=n.length;A(i===this.size,(function(){return"Length of values '"+i+"' does not match the size inferred by the shape '"+r.size+"'."}))}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||W(t,this.size),this.strides=te(e)}return e.prototype.set=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];0===n.length&&(n=[0]),A(n.length===this.rank,(function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+t.rank+")"}));var i=this.locToIndex(n);this.values[i]=e},e.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];0===e.length&&(e=[0]);for(var n=0,r=0,i=e;r<i.length;r++){var a=i[r];if(a<0||a>=this.shape[n]){var o="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(o)}n++}for(var s=e[e.length-1],u=0;u<e.length-1;++u)s+=this.strides[u]*e[u];return this.values[s]},e.prototype.locToIndex=function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},e.prototype.indexToLoc=function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.toTensor=function(){return _e().makeTensor(this.values,this.shape,this.dtype)},e}(),_e=null,ke=null,Ee=null,Se=function(){function e(e,t,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=j(e),this.strides=te(e),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}return e.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},e.prototype.asScalar=function(){return this.throwIfDisposed(),A(1===this.size,(function(){return"The array must have only 1 element."})),this.reshape([])},e.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},e.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},e.prototype.as3D=function(e,t,n){return this.throwIfDisposed(),this.reshape([e,t,n])},e.prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),this.reshape([e,t,n,r])},e.prototype.as5D=function(e,t,n,r,i){return this.throwIfDisposed(),this.reshape([e,t,n,r,i])},e.prototype.asType=function(e){return this.throwIfDisposed(),ke.cast(this,e)},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.buffer=function(){return u(this,void 0,void 0,(function(){var e;return c(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,ke.buffer(this.shape,this.dtype,e)]}}))}))},e.prototype.bufferSync=function(){return ke.buffer(this.shape,this.dtype,this.dataSync())},e.prototype.array=function(){return u(this,void 0,void 0,(function(){var e;return c(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,re(this.shape,e)]}}))}))},e.prototype.arraySync=function(){return re(this.shape,this.dataSync())},e.prototype.data=function(){return u(this,void 0,void 0,(function(){var e,t;return c(this,(function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=_e().read(this.dataId),"string"!==this.dtype?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map((function(e){return ce(e)}))]}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,e]}}))}))},e.prototype.dataSync=function(){this.throwIfDisposed();var e=_e().readSync(this.dataId);if("string"===this.dtype)try{return e.map((function(e){return ce(e)}))}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},e.prototype.bytes=function(){return u(this,void 0,void 0,(function(){var e;return c(this,(function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,_e().read(this.dataId)];case 1:return e=t.sent(),"string"===this.dtype?[2,e]:[2,new Uint8Array(e.buffer)]}}))}))},e.prototype.dispose=function(){this.isDisposed||(_e().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),e.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},e.prototype.toFloat=function(){return this.asType("float32")},e.prototype.toInt=function(){return this.asType("int32")},e.prototype.toBool=function(){return this.asType("bool")},e.prototype.print=function(e){return void 0===e&&(e=!1),ke.print(this,e)},e.prototype.reshape=function(e){return this.throwIfDisposed(),ke.reshape(this,e)},e.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},e.prototype.expandDims=function(e){return void 0===e&&(e=0),ke.expandDims(this,e)},e.prototype.cumsum=function(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=!1),void 0===n&&(n=!1),ke.cumsum(this,e,t,n)},e.prototype.squeeze=function(e){return this.throwIfDisposed(),ke.squeeze(this,e)},e.prototype.clone=function(){return this.throwIfDisposed(),ke.clone(this)},e.prototype.oneHot=function(e,t,n){return this.throwIfDisposed(),ke.oneHot(this,e,t,n)},e.prototype.toString=function(e){return void 0===e&&(e=!1),function(e,t,n,r){var i=te(t),a=function(e,t,n,r){var i=j(t),a=r[r.length-1],o=new Array(a).fill(0),s=t.length,u="complex64"===n?xe(e):e;if(s>1)for(var c=0;c<i/a;c++)for(var l=c*a,f=0;f<a;f++)o[f]=Math.max(o[f],ye(u[l+f],0,n).length);return o}(e,t,n,i),o=t.length,s=function e(t,n,r,i,a,o){void 0===o&&(o=!0);var s="complex64"===r?2:1,u=n[0],c=n.length;if(0===c)return"complex64"===r?[ye(xe(t)[0],0,r)]:"bool"===r?[be(t[0])]:[t[0].toString()];if(1===c){if(u>me){var l=ve*s,f=Array.from(t.slice(0,l)),d=Array.from(t.slice((u-ve)*s,u*s));return"complex64"===r&&(f=xe(f),d=xe(d)),["["+f.map((function(e,t){return ye(e,a[t],r)})).join(", ")+", ..., "+d.map((function(e,t){return ye(e,a[u-ve+t],r)})).join(", ")+"]"]}return["["+("complex64"===r?xe(t):Array.from(t)).map((function(e,t){return ye(e,a[t],r)})).join(", ")+"]"]}var h=n.slice(1),p=i.slice(1),m=i[0]*s,v=[];if(u>me){for(var g=0;g<ve;g++){var y=(b=g*m)+m;v.push.apply(v,e(t.slice(b,y),h,r,p,a,!1))}for(v.push("..."),g=u-ve;g<u;g++)y=(b=g*m)+m,v.push.apply(v,e(t.slice(b,y),h,r,p,a,g===u-1))}else for(g=0;g<u;g++){var b;y=(b=g*m)+m,v.push.apply(v,e(t.slice(b,y),h,r,p,a,g===u-1))}var x=2===c?",":"";for(v[0]="["+v[0]+x,g=1;g<v.length-1;g++)v[g]=" "+v[g]+x;var w=",\n";for(g=2;g<c;g++)w+="\n";return v[v.length-1]=" "+v[v.length-1]+"]"+(o?"":w),v}(e,t,n,i,a),u=["Tensor"];return r&&(u.push("  dtype: "+n),u.push("  rank: "+o),u.push("  shape: ["+t+"]"),u.push("  values:")),u.push(s.map((function(e){return"    "+e})).join("\n")),u.join("\n")}(this.dataSync(),this.shape,this.dtype,e)},e.prototype.tile=function(e){return this.throwIfDisposed(),ke.tile(this,e)},e.prototype.gather=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),ke.gather(this,e,t)},e.prototype.matMul=function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n=!1),this.throwIfDisposed(),ke.matMul(this,e,t,n)},e.prototype.dot=function(e){return this.throwIfDisposed(),ke.dot(this,e)},e.prototype.norm=function(e,t,n){return void 0===e&&(e="euclidean"),void 0===t&&(t=null),void 0===n&&(n=!1),this.throwIfDisposed(),ke.norm(this,e,t,n)},e.prototype.slice=function(e,t){return this.throwIfDisposed(),ke.slice(this,e,t)},e.prototype.reverse=function(e){return this.throwIfDisposed(),ke.reverse(this,e)},e.prototype.concat=function(t,n){return void 0===n&&(n=0),this.throwIfDisposed(),t instanceof e&&(t=[t]),ke.concat([this].concat(t),n)},e.prototype.split=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),ke.split(this,e,t)},e.prototype.stack=function(e,t){return void 0===t&&(t=0),ke.stack([this,e],t)},e.prototype.unstack=function(e){return void 0===e&&(e=0),ke.unstack(this,e)},e.prototype.pad=function(e,t){return void 0===t&&(t=0),ke.pad(this,e,t)},e.prototype.batchNormalization=function(e,t,n,r,i){return void 0===n&&(n=.001),Ee("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,i,r,n)},e.prototype.batchNorm=function(e,t,n,r,i){return void 0===i&&(i=.001),this.throwIfDisposed(),ke.batchNorm(this,e,t,n,r,i)},e.prototype.all=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ke.all(this,e,t)},e.prototype.any=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ke.any(this,e,t)},e.prototype.logSumExp=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ke.logSumExp(this,e,t)},e.prototype.sum=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ke.sum(this,e,t)},e.prototype.prod=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ke.prod(this,e,t)},e.prototype.mean=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ke.mean(this,e,t)},e.prototype.min=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ke.min(this,e,t)},e.prototype.max=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ke.max(this,e,t)},e.prototype.argMin=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),ke.argMin(this,e)},e.prototype.argMax=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),ke.argMax(this,e)},e.prototype.cast=function(e){return this.throwIfDisposed(),ke.cast(this,e)},e.prototype.add=function(e){return this.throwIfDisposed(),ke.add(this,e)},e.prototype.addStrict=function(e){return this.throwIfDisposed(),ke.addStrict(this,e)},e.prototype.atan2=function(e){return this.throwIfDisposed(),ke.atan2(this,e)},e.prototype.sub=function(e){return this.throwIfDisposed(),ke.sub(this,e)},e.prototype.subStrict=function(e){return this.throwIfDisposed(),ke.subStrict(this,e)},e.prototype.pow=function(e){return this.throwIfDisposed(),ke.pow(this,e)},e.prototype.powStrict=function(e){return this.throwIfDisposed(),ke.powStrict(this,e)},e.prototype.mul=function(e){return this.throwIfDisposed(),ke.mul(this,e)},e.prototype.mulStrict=function(e){return this.throwIfDisposed(),ke.mulStrict(this,e)},e.prototype.div=function(e){return this.throwIfDisposed(),ke.div(this,e)},e.prototype.divNoNan=function(e){return this.throwIfDisposed(),ke.divNoNan(this,e)},e.prototype.floorDiv=function(e){return this.throwIfDisposed(),ke.floorDiv(this,e)},e.prototype.divStrict=function(e){return this.throwIfDisposed(),ke.divStrict(this,e)},e.prototype.minimum=function(e){return this.throwIfDisposed(),ke.minimum(this,e)},e.prototype.minimumStrict=function(e){return this.throwIfDisposed(),ke.minimumStrict(this,e)},e.prototype.maximum=function(e){return this.throwIfDisposed(),ke.maximum(this,e)},e.prototype.maximumStrict=function(e){return this.throwIfDisposed(),ke.maximumStrict(this,e)},e.prototype.mod=function(e){return this.throwIfDisposed(),ke.mod(this,e)},e.prototype.modStrict=function(e){return this.throwIfDisposed(),ke.modStrict(this,e)},e.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),ke.squaredDifferenceStrict(this,e)},e.prototype.transpose=function(e){return this.throwIfDisposed(),ke.transpose(this,e)},e.prototype.notEqual=function(e){return this.throwIfDisposed(),ke.notEqual(this,e)},e.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),ke.notEqualStrict(this,e)},e.prototype.less=function(e){return this.throwIfDisposed(),ke.less(this,e)},e.prototype.lessStrict=function(e){return this.throwIfDisposed(),ke.lessStrict(this,e)},e.prototype.equal=function(e){return this.throwIfDisposed(),ke.equal(this,e)},e.prototype.equalStrict=function(e){return this.throwIfDisposed(),ke.equalStrict(this,e)},e.prototype.lessEqual=function(e){return this.throwIfDisposed(),ke.lessEqual(this,e)},e.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),ke.lessEqualStrict(this,e)},e.prototype.greater=function(e){return this.throwIfDisposed(),ke.greater(this,e)},e.prototype.greaterStrict=function(e){return this.throwIfDisposed(),ke.greaterStrict(this,e)},e.prototype.greaterEqual=function(e){return this.throwIfDisposed(),ke.greaterEqual(this,e)},e.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),ke.greaterEqualStrict(this,e)},e.prototype.logicalAnd=function(e){return this.throwIfDisposed(),ke.logicalAnd(this,e)},e.prototype.logicalOr=function(e){return this.throwIfDisposed(),ke.logicalOr(this,e)},e.prototype.logicalNot=function(){return this.throwIfDisposed(),ke.logicalNot(this)},e.prototype.logicalXor=function(e){return this.throwIfDisposed(),ke.logicalXor(this,e)},e.prototype.where=function(e,t){return this.throwIfDisposed(),ke.where(e,this,t)},e.prototype.neg=function(){return this.throwIfDisposed(),ke.neg(this)},e.prototype.ceil=function(){return this.throwIfDisposed(),ke.ceil(this)},e.prototype.floor=function(){return this.throwIfDisposed(),ke.floor(this)},e.prototype.sign=function(){return this.throwIfDisposed(),ke.sign(this)},e.prototype.isNaN=function(){return this.throwIfDisposed(),ke.isNaN(this)},e.prototype.isInf=function(){return this.throwIfDisposed(),ke.isInf(this)},e.prototype.isFinite=function(){return this.throwIfDisposed(),ke.isFinite(this)},e.prototype.exp=function(){return this.throwIfDisposed(),ke.exp(this)},e.prototype.expm1=function(){return this.throwIfDisposed(),ke.expm1(this)},e.prototype.log=function(){return this.throwIfDisposed(),ke.log(this)},e.prototype.log1p=function(){return this.throwIfDisposed(),ke.log1p(this)},e.prototype.sqrt=function(){return this.throwIfDisposed(),ke.sqrt(this)},e.prototype.rsqrt=function(){return this.throwIfDisposed(),ke.rsqrt(this)},e.prototype.square=function(){return this.throwIfDisposed(),ke.square(this)},e.prototype.reciprocal=function(){return this.throwIfDisposed(),ke.reciprocal(this)},e.prototype.abs=function(){return this.throwIfDisposed(),ke.abs(this)},e.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),ke.clipByValue(this,e,t)},e.prototype.relu=function(){return this.throwIfDisposed(),ke.relu(this)},e.prototype.relu6=function(){return this.throwIfDisposed(),ke.relu6(this)},e.prototype.elu=function(){return this.throwIfDisposed(),ke.elu(this)},e.prototype.selu=function(){return this.throwIfDisposed(),ke.selu(this)},e.prototype.leakyRelu=function(e){return void 0===e&&(e=.2),this.throwIfDisposed(),ke.leakyRelu(this,e)},e.prototype.prelu=function(e){return this.throwIfDisposed(),ke.prelu(this,e)},e.prototype.sigmoid=function(){return this.throwIfDisposed(),ke.sigmoid(this)},e.prototype.logSigmoid=function(){return this.throwIfDisposed(),ke.logSigmoid(this)},e.prototype.softplus=function(){return this.throwIfDisposed(),ke.softplus(this)},e.prototype.zerosLike=function(){return this.throwIfDisposed(),ke.zerosLike(this)},e.prototype.onesLike=function(){return this.throwIfDisposed(),ke.onesLike(this)},e.prototype.sin=function(){return this.throwIfDisposed(),ke.sin(this)},e.prototype.cos=function(){return this.throwIfDisposed(),ke.cos(this)},e.prototype.tan=function(){return this.throwIfDisposed(),ke.tan(this)},e.prototype.asin=function(){return this.throwIfDisposed(),ke.asin(this)},e.prototype.acos=function(){return this.throwIfDisposed(),ke.acos(this)},e.prototype.atan=function(){return this.throwIfDisposed(),ke.atan(this)},e.prototype.sinh=function(){return this.throwIfDisposed(),ke.sinh(this)},e.prototype.cosh=function(){return this.throwIfDisposed(),ke.cosh(this)},e.prototype.tanh=function(){return this.throwIfDisposed(),ke.tanh(this)},e.prototype.asinh=function(){return this.throwIfDisposed(),ke.asinh(this)},e.prototype.acosh=function(){return this.throwIfDisposed(),ke.acosh(this)},e.prototype.atanh=function(){return this.throwIfDisposed(),ke.atanh(this)},e.prototype.erf=function(){return this.throwIfDisposed(),ke.erf(this)},e.prototype.round=function(){return this.throwIfDisposed(),ke.round(this)},e.prototype.step=function(e){return void 0===e&&(e=0),this.throwIfDisposed(),ke.step(this,e)},e.prototype.softmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),ke.softmax(this,e)},e.prototype.logSoftmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),ke.logSoftmax(this,e)},e.prototype.resizeBilinear=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),ke.image.resizeBilinear(this,e,t)},e.prototype.resizeNearestNeighbor=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),ke.image.resizeNearestNeighbor(this,e,t)},e.prototype.conv1d=function(e,t,n,r,i,a){return void 0===r&&(r="NWC"),void 0===i&&(i=1),this.throwIfDisposed(),ke.conv1d(this,e,t,n,r,i,a)},e.prototype.conv2d=function(e,t,n,r,i,a){return void 0===r&&(r="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),ke.conv2d(this,e,t,n,r,i,a)},e.prototype.conv2dTranspose=function(e,t,n,r,i){return this.throwIfDisposed(),ke.conv2dTranspose(this,e,t,n,r,i)},e.prototype.depthwiseConv2D=function(e,t,n,r,i,a){return void 0===r&&(r="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),ke.depthwiseConv2d(this,e,t,n,r,i,a)},e.prototype.separableConv2d=function(e,t,n,r,i,a){return void 0===i&&(i=[1,1]),void 0===a&&(a="NHWC"),this.throwIfDisposed(),ke.separableConv2d(this,e,t,n,r,i,a)},e.prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),ke.avgPool(this,e,t,n,r)},e.prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),ke.maxPool(this,e,t,n,r)},e.prototype.localResponseNormalization=function(e,t,n,r){return void 0===e&&(e=5),void 0===t&&(t=1),void 0===n&&(n=1),void 0===r&&(r=.5),ke.localResponseNormalization(this,e,t,n,r)},e.prototype.pool=function(e,t,n,r,i){return this.throwIfDisposed(),ke.pool(this,e,t,n,r,i)},e.prototype.variable=function(e,t,n){return void 0===e&&(e=!0),this.throwIfDisposed(),_e().makeVariable(this,e,t,n)},e.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),ke.unsortedSegmentSum(this,e,t)},e.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),ke.batchToSpaceND(this,e,t)},e.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),ke.spaceToBatchND(this,e,t)},e.prototype.topk=function(e,t){return void 0===e&&(e=1),void 0===t&&(t=!0),this.throwIfDisposed(),ke.topk(this,e,t)},e.prototype.stridedSlice=function(e,t,n,r,i,a,o,s){return void 0===r&&(r=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=0),this.throwIfDisposed(),ke.stridedSlice(this,e,t,n,r,i,a,o,s)},e.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),ke.depthToSpace(this,e,t)},e.prototype.fft=function(){return this.throwIfDisposed(),ke.spectral.fft(this)},e.prototype.ifft=function(){return this.throwIfDisposed(),ke.spectral.ifft(this)},e.prototype.rfft=function(){return this.throwIfDisposed(),ke.spectral.rfft(this)},e.prototype.irfft=function(){return this.throwIfDisposed(),ke.spectral.irfft(this)},e}();Object.defineProperty(Se,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.dataId&&null!=e.shape&&null!=e.dtype}});var Ce,Ae,Oe,De,Te,je=function(e){function t(t,n,r,i){var a=e.call(this,t.shape,t.dtype,t.dataId,i)||this;return a.trainable=n,a.name=r,a}return s(t,e),t.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!M(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");_e().disposeTensor(this),this.dataId=e.dataId,_e().incRef(this,null)},t.prototype.dispose=function(){_e().disposeVariable(this),this.isDisposedInternal=!0},t}(Se);Object.defineProperty(je,Symbol.hasInstance,{value:function(e){return e instanceof Se&&null!=e.assign&&e.assign instanceof Function}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(Ce||(Ce={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(Ae||(Ae={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(Oe||(Oe={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(De||(De={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(Te||(Te={}));var Me={float32:De,int32:Ae,bool:Oe,complex64:Te};function Fe(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast "+e+" with "+t)}return Me[e][t]}function Ie(e){return Fe(e,"int32")}function Ne(e,t){if(e.dtype===t.dtype)return[e,t];var n=Fe(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function Re(e,t){A(e.dtype===t.dtype,(function(){return"The dtypes of the first("+e.dtype+") and second("+t.dtype+") input must match"}))}function Pe(e){var t=[];return function e(t,n,r){if(null!=t)if(t instanceof Se)n.push(t);else if(i=t,Array.isArray(i)||"object"==typeof i){var i,a=t;for(var o in a){var s=a[o];r.has(s)||(r.add(s),e(s,n,r))}}}(e,t,new Set),t}var Be,Le=Object.freeze({makeTypesMatch:Ne,assertTypesMatch:Re,isTensorInList:function(e,t){return t.some((function(t){return t.id===e.id}))},getTensorsInContainer:Pe}),ze=function(){function e(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return e.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},e}(),Ue=function(){function e(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new ze}return e.prototype.ready=function(){return u(this,void 0,void 0,(function(){var e,t,n;return c(this,(function(r){switch(r.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then((function(){}))];if(null!=this.backendInstance)return[2];e=this.getSortedBackends(),t=0,r.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return r.sent()?[4,this.setBackend(n)]:[3,4];case 3:return r.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}}))}))},Object.defineProperty(e.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),e.prototype.backendNames=function(){return Object.keys(this.registryFactory)},e.prototype.findBackend=function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]},e.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},e.prototype.registerBackend=function(e,t,n){return void 0===n&&(n=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},e.prototype.setBackend=function(e){return u(this,void 0,void 0,(function(){var t,n,r;return c(this,(function(i){switch(i.label){case 0:if(null==this.registryFactory[e])throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,null!=this.registry[e]?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,t.asyncInit?[4,n]:[3,2]);case 1:return r=i.sent(),[3,3];case 2:r=n,i.label=3;case 3:if(!r)return[2,!1];i.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new he(this.backendInstance),[2,!0]}}))}))},e.prototype.setupRegisteredKernels=function(){var e=this;g(this.backendName).forEach((function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)}))},e.prototype.disposeRegisteredKernels=function(e){var t=this;g(e).forEach((function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])}))},e.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var r=n.factory();if(Promise.resolve(r)===r){var i=++this.pendingBackendInitId,a=r.then((function(n){return!(i<t.pendingBackendInitId||(t.registry[e]=n,t.pendingBackendInit=null,0))})).catch((function(n){return!(i<t.pendingBackendInitId||(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(n.stack||n.message),1))}));return this.pendingBackendInit=a,{success:a,asyncInit:!0}}return this.registry[e]=r,{success:!0,asyncInit:!1}}catch(t){return console.warn("Initialization of backend "+e+" failed"),console.warn(t.stack||t.message),{success:!1,asyncInit:!1}}},e.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},e.prototype.getSortedBackends=function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority}))},e.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),i=r.success,a=r.asyncInit;if(a||i)return{name:n,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},e.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,i=this.readSync(t);r.disposeData(t),n.backend=e,e.move(t,i,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},e.prototype.tidy=function(e,t){var n,r=this,i=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=e}return this.scopedRun((function(){return r.startScope(i)}),(function(){return r.endScope(n)}),(function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))},e.prototype.scopedRun=function(e,t,n){e();try{var r=n();return t(),r}catch(e){throw t(),e}},e.prototype.nextTensorId=function(){return e.nextTensorId++},e.prototype.nextVariableId=function(){return e.nextVariableId++},e.prototype.clone=function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],(function(e){return{x:function(){return e.toFloat()}}}),[]),t},e.prototype.runKernel=function(e,t,n,r,i){return this.runKernelFunc(null,t,null,e,n,r,i)},e.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},e.prototype.checkKernelForMemLeak=function(e,t,n){var r=this.backend.numDataIds(),i=0;n.forEach((function(e){i+="complex64"===e.dtype?3:1}));var a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],o=r-t-i-a;if(o>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+o+" data ids) after running '"+e+"'")},e.prototype.runKernelFunc=function(e,t,n,r,i,a,o){var s,u=this;void 0===a&&(a=[]),void 0===o&&(o=[]);var c=[],l=this.isTapeOn();null==r&&(r=null!=this.state.activeScope?this.state.activeScope.name:"");var f,d=function(e){l&&(c=e.map((function(e){return u.keep(u.clone(e))})))},h=this.state.numBytes,p=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var v,g=m(r,this.backendName);return f=null!=g?function(){var e=u.backend.numDataIds();v=g.kernelFunc({inputs:t,attrs:i,backend:u.backend});var n=Array.isArray(v)?v:[v];u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,e,n);var s=n.map((function(e){var t=e.dataId,n=e.shape,r=e.dtype;return u.makeTensorFromDataId(t,n,r)})),c=s.filter((function(e,t){return o[t]}));return d((a||[]).slice().concat(c)),s}:function(){var t=u.backend.numDataIds();v=u.tidy((function(){return e(u.backend,d)}));var n=Array.isArray(v)?v:[v];return u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,t,n),n},this.scopedRun((function(){return u.state.kernelDepth++}),(function(){return u.state.kernelDepth--}),(function(){s=u.ENV.getBool("DEBUG")?u.profiler.profileKernel(r,t,(function(){return f()})):f()})),l&&this.addTapeNode(r,t,s,n,c),this.state.profiling&&this.state.activeProfile.kernels.push({name:r,bytesAdded:this.state.numBytes-h,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-p,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map((function(e){return t[e].shape})),outputShapes:s.map((function(e){return e.shape}))}),Array.isArray(v)?s:s[0]},e.prototype.makeTensor=function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var i=e;"string"===n&&Y(e[0])&&(i=e.map((function(e){return ue(e)})));var a=r.write(i,t,n),o=new Se(t,n,a,this.nextTensorId());if(this.incRef(o,r),"string"===n){var s=this.state.tensorInfo.get(a),u=K(i);this.state.numBytes+=u-s.bytes,s.bytes=u}return o},e.prototype.makeTensorFromDataId=function(e,t,n,r){var i=new Se(t,n=n||"float32",e,this.nextTensorId());return this.incRef(i,r),i},e.prototype.makeVariable=function(e,t,n,r){void 0===t&&(t=!0),n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.asType(r));var i=new je(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[i.name])throw new Error("Variable with name "+i.name+" was already registered");return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},e.prototype.incRef=function(e,t){var n=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;var r=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(r=e.size*X(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r,refCount:0}),this.state.numBytes+=r}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof je||this.track(e)},e.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,"string"===e.dtype&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?("complex64"!==e.dtype&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},e.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},e.prototype.disposeVariable=function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]},e.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},e.prototype.profile=function(e){return u(this,void 0,void 0,(function(){var t,n;return c(this,(function(r){return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map((function(e){return e.totalBytesSnapshot}))),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,[2,this.state.activeProfile]}))}))},e.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},e.prototype.addTapeNode=function(e,t,n,r,i){var a=this,o={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:i},s=v(e);null!=s&&(r=s.gradFunc),null!=r&&(o.gradient=function(e){return e=e.map((function(e,t){if(null==e){var r=n[t],i=ae(r.size,r.dtype);return a.makeTensor(i,r.shape,r.dtype)}return e})),r(e.length>1?e:e[0],i)}),this.state.activeTape.push(o)},e.prototype.keep=function(e){return e.kept=!0,e},e.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},e.prototype.endTape=function(){this.state.gradientDepth--},e.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},e.prototype.endScope=function(e){for(var t=this,n=Pe(e),r=new Set(n.map((function(e){return e.id}))),i=0;i<this.state.activeScope.track.length;i++){var a=this.state.activeScope.track[i];a.kept||r.has(a.id)||a.dispose()}var o=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(e){e.kept||e.scopeId!==o.id||t.track(e)}))},e.prototype.gradients=function(e,t,n,r){var i=this;if(void 0===r&&(r=!1),A(t.length>0,(function(){return"gradients() received an empty list of xs."})),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var a=this.scopedRun((function(){return i.startTape()}),(function(){return i.endTape()}),(function(){return i.tidy("forward",e)}));A(a instanceof Se,(function(){return"The result y returned by f() must be a tensor."}));var o=function(e,t,n){for(var r={},i={},a=0;a<t.length;a++)r[t[a].id]=!0;for(a=0;a<e.length;a++){var o=(p=e[a]).inputs;for(var s in o){for(var u=o[s],c=!1,l=0;l<t.length;l++)if(r[u.id]){p.outputs.forEach((function(e){return r[e.id]=!0})),c=!0,i[p.id]=!0;break}if(c)break}}var f={};f[n.id]=!0;var d={};for(a=e.length-1;a>=0;a--)for(o=(p=e[a]).inputs,l=0;l<p.outputs.length;l++)if(f[p.outputs[l].id]){for(var s in o)f[o[s].id]=!0,d[p.id]=!0;break}var h=[];for(a=0;a<e.length;a++){var p;if(i[(p=e[a]).id]&&d[p.id]){var m={};for(var s in p.inputs){var v=p.inputs[s];r[v.id]&&(m[s]=v)}var g=Object.assign({},p);g.inputs=m,g.outputs=p.outputs,h.push(g)}}return h}(this.state.activeTape,t,a);if(!r&&0===o.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var e,r,s={};s[a.id]=null==n?(r=ie(j(e=a.shape),"float32"),We.makeTensor(r,e,"float32")):n,function(e,t,n){for(var r=function(r){var i=t[r],a=[];if(i.outputs.forEach((function(t){var n=e[t.id];null!=n?a.push(n):a.push(null)})),null==i.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+i.kernelName+".");var o=i.gradient(a),s=function(t){if(!(t in o))throw new Error("Cannot backprop through input "+t+". Available gradients found: "+Object.keys(o)+".");var r=n((function(){return o[t]()}));if("float32"!==r.dtype)throw new Error("Error in gradient for op "+i.kernelName+". The gradient of input "+t+" must have 'float32' dtype, but has '"+r.dtype+"'");var a=i.inputs[t];if(!M(r.shape,a.shape))throw new Error("Error in gradient for op "+i.kernelName+". The gradient of input '"+t+"' has shape '"+r.shape+"', which does not match the shape of the input '"+a.shape+"'");if(null==e[a.id])e[a.id]=r;else{var s=e[a.id];e[a.id]=s.add(r),s.dispose()}};for(var u in i.inputs)s(u)},i=t.length-1;i>=0;i--)r(i)}(s,o,(function(e){return i.tidy(e)}));var u=t.map((function(e){return s[e.id]}));return 0===i.state.gradientDepth&&(i.state.activeTape.forEach((function(e){for(var t=0,n=e.saved;t<n.length;t++)n[t].dispose()})),i.state.activeTape=null),{value:a,grads:u}}))},e.prototype.customGrad=function(e){var t=this;return A(Q(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];A(r.every((function(e){return e instanceof Se})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var a={};return r.forEach((function(e,t){a[t]=e})),t.runKernelFunc((function(t,i){return A((n=e.apply(void 0,r.concat([i]))).value instanceof Se,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),A(Q(n.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),n.value}),a,(function(e,t){var i=n.gradFunc(e,t),a=Array.isArray(i)?i:[i];A(a.length===r.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),A(a.every((function(e){return e instanceof Se})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var o={};return a.forEach((function(e,t){o[t]=function(){return e}})),o}))}},e.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},e.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},e.prototype.time=function(e){return u(this,void 0,void 0,(function(){var t,n;return c(this,(function(r){switch(r.label){case 0:return t=oe(),[4,this.backend.time(e)];case 1:return(n=r.sent()).wallMs=oe()-t,[2,n]}}))}))},e.prototype.track=function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(e.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),e.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new ze,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},e.nextTensorId=0,e.nextVariableId=0,e}(),We=function(){var t=function(){if(null==Be){var t=void 0;if("undefined"!=typeof window)t=window;else if(void 0!==e)t=e;else if(void 0!==r)t=r;else{if("undefined"==typeof self)throw new Error("Could not find a global object");t=self}Be=t}return Be}();if(null==t._tfengine){var n=new l(t);t._tfengine=new Ue(n)}return function(e){d=e}(t._tfengine.ENV),_e=function(){return t._tfengine},t._tfengine}();function Ve(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var Ge=f();Ge.registerFlag("DEBUG",(function(){return!1}),(function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),Ge.registerFlag("IS_BROWSER",(function(){return Ve()})),Ge.registerFlag("IS_NODE",(function(){return void 0!==r&&void 0!==r.versions&&void 0!==r.versions.node})),Ge.registerFlag("IS_CHROME",(function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),Ge.registerFlag("PROD",(function(){return!1})),Ge.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return Ge.getBool("DEBUG")})),Ge.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),Ge.registerFlag("IS_TEST",(function(){return!1}));var qe,He,Xe,Ke={},Ye={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function $e(e,t){Ke[e]=t}function Je(e){e in Ke||(Ke[e]=function(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=function(e){if("undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return t.addEventListener("webglcontextlost",(function(t){t.preventDefault(),delete Ke[e]}),!1),1===e?t.getContext("webgl",Ye)||t.getContext("experimental-webgl",Ye):t.getContext("webgl2",Ye)}(e));var t=Ke[e];return t.isContextLost()?(delete Ke[e],Je(e)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),Ke[e])}function Ze(e,t){return[t,e]}function Qe(e){var t=j(e);return N(Math.ceil(t/4))}function et(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function tt(e,t){var n,r,i,a,o,s,u,c,l,d=e;return 2===f().getNumber("WEBGL_VERSION")?(n=d.R32F,r=d.R16F,i=d.RGBA16F,a=d.RGBA32F,o=d.RED,s=4,u=1,c=d.HALF_FLOAT,l=d.FLOAT):(n=e.RGBA,r=e.RGBA,i=e.RGBA,a=d.RGBA,o=e.RGBA,s=4,u=4,c=null!=t?t.HALF_FLOAT_OES:null,l=e.FLOAT),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:a,textureFormatFloat:o,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:c,textureTypeFloat:l}}function nt(e,t,n){var r=n();return t&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+ot(e,t))}(e),r}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(qe||(qe={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(He||(He={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Xe||(Xe={}));var rt=5.96e-8,it=65504;function at(e){return!!(f().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||rt<Math.abs(e)&&Math.abs(e)<it)}function ot(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}function st(e,t,n){return Tt(e,t,(function(){return e.getExtension(n)}),'Extension "'+n+'" not supported on this browser.')}function ut(e,t,n){var r=Tt(e,t,(function(){return e.createShader(e.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(nt(e,t,(function(){return e.shaderSource(r,n)})),nt(e,t,(function(){return e.compileShader(r)})),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function ct(e,t,n){var r=Tt(e,t,(function(){return e.createShader(e.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(nt(e,t,(function(){return e.shaderSource(r,n)})),nt(e,t,(function(){return e.compileShader(r)})),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw function(e,t){var n=dt.exec(t);if(null==n)return console.log("Couldn't parse line number in error: "+t),void console.log(e);for(var r=+n[1],i=e.split("\n"),a=i.length.toString().length+2,o=i.map((function(e,t){return R((t+1).toString(),a)+e})),s=0,u=0;u<o.length;u++)s=Math.max(o[u].length,s);var c=o.slice(0,r-1),l=o.slice(r-1,r),f=o.slice(r);console.log(c.join("\n")),console.log(t.split("\n")[0]),console.log("%c "+R(l[0],s),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(f.join("\n"))}(n,e.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var lt,ft,dt=/ERROR: [0-9]+:([0-9]+):/g;function ht(e,t){return Tt(e,t,(function(){return e.createProgram()}),"Unable to create WebGLProgram.")}function pt(e,t,n){if(nt(e,t,(function(){return e.linkProgram(n)})),!1===e.getProgramParameter(n,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function mt(e,t,n){if(nt(e,t,(function(){return e.validateProgram(n)})),!1===e.getProgramParameter(n,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function vt(e,t,n){var r=Tt(e,t,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return nt(e,t,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),nt(e,t,(function(){return e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW)})),r}function gt(e,t,n){var r=Tt(e,t,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return nt(e,t,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r)})),nt(e,t,(function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,n,e.STATIC_DRAW)})),r}function yt(e,t){return Tt(e,t,(function(){return e.createTexture()}),"Unable to create WebGLTexture.")}function bt(e,t){var n=f().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="["+e+"x"+t+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n)throw r="["+e+"x"+t+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU ["+n+"x"+n+"].")}function xt(e,t){return Tt(e,t,(function(){return e.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}function wt(e,t,n,r,i,a,o,s){var u=e.getAttribLocation(n,r);return-1!==u&&(nt(e,t,(function(){return e.bindBuffer(e.ARRAY_BUFFER,i)})),nt(e,t,(function(){return e.vertexAttribPointer(u,a,e.FLOAT,!1,o,s)})),nt(e,t,(function(){return e.enableVertexAttribArray(u)})),!0)}function _t(e,t,n,r){jt(e,r),nt(e,t,(function(){return e.activeTexture(e.TEXTURE0+r)})),nt(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,n)}))}function kt(e,t,n,r){return Tt(e,t,(function(){return e.getUniformLocation(n,r)}),'uniform "'+r+'" not present in program.')}function Et(e,t,n){return e.getUniformLocation(t,n)}function St(e,t,n,r,i,a){nt(e,t,(function(){return _t(e,t,r,a)})),nt(e,t,(function(){return e.uniform1i(i,a)}))}function Ct(e,t,n,r){nt(e,t,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,r)})),nt(e,t,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)}))}function At(e,t,n){nt(e,t,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)})),nt(e,t,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}))}function Ot(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Dt(e,t))}function Dt(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}function Tt(e,t,n,r){var i=nt(e,t,(function(){return n()}));if(null==i)throw new Error(r);return i}function jt(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+n+"].")}function Mt(e,t){return void 0===t&&(t=2),j(e.slice(0,e.length-t))}function Ft(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function It(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[Mt(e)].concat(Ft(e))),t}function Nt(e,t){var n;void 0===t&&(t=!1);var r=f().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(r*=2,1===(e=e.map((function(t,n){return n>=e.length-2?S(e[n]):e[n]}))).length&&(e=[2,e[0]])),2!==e.length){var i=z(e);e=i.newShape}var a=j(e);if(e.length<=1&&a<=r)return[1,a];if(2===e.length&&e[0]<=r&&e[1]<=r)return e;if(3===e.length&&e[0]*e[1]<=r&&e[2]<=r)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=r&&e[1]*e[2]<=r)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=r&&e[3]<=r)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=r&&e[1]*e[2]*e[3]<=r)return[e[0],e[1]*e[2]*e[3]];if(t){var o=Mt(e),s=2,u=2;return e.length&&(s=(n=Ft(e))[0],u=n[1]),N(a=o*(s/2)*(u/2)).map((function(e){return 2*e}))}return N(a)}function Rt(e){return e%2==0}function Pt(e,t){if(M(e=e.slice(-2),t=t.slice(-2)))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r)return!0;if(Rt(n)&&Rt(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&Rt(e[0])&&Rt(t[0])}function Bt(e){if(null==lt){var t=Je(e);lt=t.getParameter(t.MAX_TEXTURE_SIZE)}return lt}function Lt(e){if(null==ft){var t=Je(e);ft=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,ft)}function zt(e){if(0===e)return 0;var t=Je(e);return Ut(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:Ut(t,"EXT_disjoint_timer_query")?1:0}function Ut(e,t){return null!=e.getExtension(t)}function Wt(e){try{if(null!=Je(e))return!0}catch(e){return!1}return!1}function Vt(e){if(0===e)return!1;var t=Je(e);if(1===e){if(!Ut(t,"OES_texture_float"))return!1}else if(!Ut(t,"EXT_color_buffer_float"))return!1;return qt(t)}function Gt(e){if(0===e)return!1;var t=Je(e);return 1!==e?Ut(t,"EXT_color_buffer_float")?qt(t):!!Ut(t,"EXT_color_buffer_half_float")&&function(e,t){var n=tt(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var i=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,i),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(i),a}(t,t.getExtension("EXT_color_buffer_half_float")):!!Ut(t,"OES_texture_float")&&!!Ut(t,"WEBGL_color_buffer_float")&&qt(t)}function qt(e){var t=tt(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var i=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),i}function Ht(e){return 2===e&&null!=Je(e).fenceSync}var Xt=Object.freeze({callAndCheck:nt,canBeRepresented:at,getWebGLErrorMessage:ot,getExtensionOrThrow:st,createVertexShader:ut,createFragmentShader:ct,createProgram:ht,linkProgram:pt,validateProgram:mt,createStaticVertexBuffer:vt,createStaticIndexBuffer:gt,getNumChannels:function(){return 2===f().getNumber("WEBGL_VERSION")?1:4},createTexture:yt,validateTextureSize:bt,createFramebuffer:xt,bindVertexBufferToProgramAttribute:wt,bindTextureUnit:_t,unbindTextureUnit:function(e,t,n){jt(e,n),nt(e,t,(function(){return e.activeTexture(e.TEXTURE0+n)})),nt(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))},getProgramUniformLocationOrThrow:kt,getProgramUniformLocation:Et,bindTextureToProgramUniformSampler:St,bindCanvasToFramebuffer:function(e,t){nt(e,t,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)})),nt(e,t,(function(){return e.viewport(0,0,e.canvas.width,e.canvas.height)})),nt(e,t,(function(){return e.scissor(0,0,e.canvas.width,e.canvas.height)}))},bindColorTextureToFramebuffer:Ct,unbindColorTextureFromFramebuffer:At,validateFramebuffer:Ot,getFramebufferErrorMessage:Dt,getBatchDim:Mt,getRowsCols:Ft,getShapeAs3D:It,getTextureShapeFromLogicalShape:Nt,isReshapeFree:Pt,getWebGLMaxTextureSize:Bt,resetMaxTextureSize:function(){lt=null},resetMaxTexturesInShader:function(){ft=null},getMaxTexturesInShader:Lt,getWebGLDisjointQueryTimerVersion:zt,hasExtension:Ut,isWebGLVersionEnabled:Wt,isCapableOfRenderingToFloatTexture:Vt,isDownloadFloatTextureEnabled:Gt,isWebGLFenceEnabled:Ht}),Kt=f();function Yt(){f().set("PROD",!0)}function $t(){f().set("DEBUG",!0)}function Jt(){f().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function Zt(e){f().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Qt(){We.disposeVariables()}function en(){return We}function tn(){return We.memory()}function nn(e){return We.profile(e)}function rn(e,t){return We.tidy(e,t)}function an(e){Pe(e).forEach((function(e){return e.dispose()}))}function on(e){return We.keep(e)}function sn(e){return We.time(e)}function un(e){return We.setBackend(e)}function cn(){return We.ready()}function ln(){return We.backendName}function fn(e){We.removeBackend(e)}function dn(e){return We.findBackend(e)}function hn(e){return We.findBackendFactory(e)}function pn(e,t,n){return void 0===n&&(n=1),We.registerBackend(e,t,n)}function mn(){return We.backend}function vn(e,t){f().setPlatform(e,t)}function gn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];f().getBool("IS_TEST")||console.warn.apply(console,e)}function yn(e,t){var n=e;if(H(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||H(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&f().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function e(t,n,r){if(r=r||[],Array.isArray(t)||H(t)){A(n.length>0,(function(){return"Element arr["+r.join("][")+"] should be a primitive, but is an array of "+t.length+" elements"})),A(t.length===n[0],(function(){return"Element arr["+r.join("][")+"] should have "+n[0]+" elements, but has "+t.length+" elements"}));for(var i=n.slice(1),a=0;a<t.length;++a)e(t[a],i,r.concat(a))}else A(0===n.length,(function(){return"Element arr["+r.join("][")+"] is a primitive, but should be an array/TypedArray of "+n[0]+" elements"}))}(e,r,[]),r}function bn(e,t,n,r){if(null!=e&&("numeric"!==e&&e!==t||"numeric"===e&&"string"===t))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+e+" tensor, but got "+t+" tensor")}function xn(e,t,n,r){if(void 0===r&&(r="numeric"),e instanceof Se)return bn(r,e.dtype,t,n),e;var i=Z(e);if("string"!==i&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),bn(r,i,t,n),null==e||!H(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e){var a=null==e?"null":e.constructor.name;throw new Error("Argument '"+t+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+a+"'")}var o=yn(e,i);H(e)||Array.isArray(e)||(e=[e]);var s="string"!==i?ne(e,i,f().getBool("DEBUG")):T(e,[],!0);return We.makeTensor(s,o,i)}function wn(e,t,n,r){if(void 0===r&&(r="numeric"),!Array.isArray(e))throw new Error("Argument "+t+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return e.map((function(e,r){return xn(e,t+"["+r+"]",n)}),r)}function _n(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function kn(e,t,n){for(var r=e.length+t.length,i=[],a=0,o=0,s=0;s<r;s++)-1===n.indexOf(s)?i.push(e[a++]):i.push(t[o++]);return i}function En(e,t){for(var n=[],r=e.length,i=0;i<r;i++)-1===t.indexOf(i)&&n.push(e[i]);return[n,t.map((function(t){return e[t]}))]}function Sn(e,t){return kn(e,t.map((function(e){return 1})),t)}function Cn(e,t,n){A(_n(t,n),(function(){return e+" supports only inner-most axes for now. Got axes "+t+" and rank-"+n+" input."}))}function An(e,t){if(_n(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((function(e){return n.push(e)})),n}function On(e){return e.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}function Dn(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}function Tn(e,t){var n=e[0].length;e.forEach((function(e,t){A(e.length===n,(function(){return"Error in concat"+n+"D: rank of tensors["+t+"] must be the same as the rank of the rest ("+n+")"}))})),A(t>=0&&t<n,(function(){return"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+"."}));var r=e[0];e.forEach((function(e,i){for(var a=0;a<n;a++)A(a===t||e[a]===r[a],(function(){return"Error in concat"+n+"D: Shape of tensors["+i+"] ("+e+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+i+"."}))}))}function jn(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}function Mn(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var i=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];We.startScope(n);try{var i=r.apply(void 0,e);return i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),We.endScope(i),i}catch(e){throw We.endScope(null),e}};return Object.defineProperty(i,"name",{value:n,configurable:!0}),i}Kt.registerFlag("HAS_WEBGL",(function(){return Kt.getNumber("WEBGL_VERSION")>0})),Kt.registerFlag("WEBGL_VERSION",(function(){return Wt(2)?2:Wt(1)?1:0})),Kt.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return 2===Kt.get("WEBGL_VERSION")})),Kt.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),Kt.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),Kt.registerFlag("WEBGL_PACK",(function(){return Kt.getBool("HAS_WEBGL")})),Kt.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return Kt.getBool("WEBGL_PACK")})),Kt.registerFlag("WEBGL_PACK_CLIP",(function(){return Kt.getBool("WEBGL_PACK")})),Kt.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return!1})),Kt.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return Kt.getBool("WEBGL_PACK")})),Kt.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return Kt.getBool("WEBGL_PACK")})),Kt.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return Kt.getBool("WEBGL_PACK")})),Kt.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return Kt.getBool("WEBGL_PACK")})),Kt.registerFlag("WEBGL_PACK_REDUCE",(function(){return Kt.getBool("WEBGL_PACK")})),Kt.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return Kt.getBool("WEBGL_PACK")})),Kt.registerFlag("WEBGL_CONV_IM2COL",(function(){return Kt.getBool("WEBGL_PACK")})),Kt.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return Bt(Kt.getNumber("WEBGL_VERSION"))})),Kt.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return Lt(Kt.getNumber("WEBGL_VERSION"))})),Kt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var e=Kt.getNumber("WEBGL_VERSION");return 0===e?0:zt(e)})),Kt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return Kt.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(e=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))));var e})),Kt.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return Vt(Kt.getNumber("WEBGL_VERSION"))})),Kt.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!Kt.getBool("WEBGL_FORCE_F16_TEXTURES")&&Kt.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),Kt.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return Gt(Kt.getNumber("WEBGL_VERSION"))})),Kt.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return Ht(Kt.getNumber("WEBGL_VERSION"))})),Kt.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return Kt.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),Ee=Zt;var Fn=Mn({complex_:function(e,t){var n=xn(e,"real","complex"),r=xn(t,"imag","complex");return O(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),We.runKernelFunc((function(e){return e.complex(n,r)}),{$real:n,$imag:r})}}),In=Mn({real_:function(e){var t=xn(e,"input","real");return We.runKernelFunc((function(e){return e.real(t)}),{$input:t})}}),Nn=Mn({imag_:function(e){var t=xn(e,"input","imag");return We.runKernelFunc((function(e){return e.imag(t)}),{$input:t})}});function Rn(e,t,n){return Pn(e,t,yn(e,n),n)}function Pn(e,t,n,r){if(null==r&&(r=Z(e)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!H(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){se(t);var i=j(t),a=j(n);A(i===a,(function(){return"Based on the provided shape, ["+t+"], the tensor should have "+i+" values but has "+a}));for(var o=0;o<n.length;++o){var s=n[o],u=o!==n.length-1||s!==j(t.slice(o));A(n[o]===t[o]||!u,(function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+t+"). "}))}}return H(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?ne(e,r,f().getBool("DEBUG")):T(e,[],!0),We.makeTensor(e,t,r)}function Bn(e,t){if((H(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&H(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Pn(e,[],[],t)}function Ln(e,t){D(e);var n=yn(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Pn(e,null,n,t)}function zn(e,t,n){if(D(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=yn(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Pn(e,t,r,n)}function Un(e,t,n){if(D(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=yn(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Pn(e,t,r,n)}function Wn(e,t,n){if(D(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var r=yn(e,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Pn(e,t,r,n)}function Vn(e,t,n){if(D(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var r=yn(e,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Pn(e,t,r,n)}function Gn(e,t,n){if(D(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var r=yn(e,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Pn(e,t=t||r,r,n)}function qn(e,t,n,r){return void 0===t&&(t=!0),We.makeVariable(e,t,n,r)}function Hn(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=Hn(e,"float32"),r=Xn(e,"float32");return Fn(n,r)}var i=ie(j(e),t);return We.makeTensor(i,e,t)}function Xn(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=Xn(e,"float32"),r=Xn(e,"float32");return Fn(n,r)}var i=ae(j(e),t);return We.makeTensor(i,e,t)}function Kn(e,t,n){return We.runKernelFunc((function(r){return r.fill(e,t,n)}),{})}function Yn(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");return We.runKernelFunc((function(r){return r.linspace(e,t,n)}),{})}function $n(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r="float32"),0===n)throw new Error("Cannot have a step of zero");if(e===t||e<t&&n<0||t<e&&n>1)return Xn([0],r);var i=ae(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),i[0]=e;for(var a=1;a<i.length;a++)i[a]=i[a-1]+n;return Ln(i,r)}var Jn=Mn({onesLike_:function(e){var t=xn(e,"x","onesLike");if("complex64"===t.dtype){var n=Jn(In(t)),r=Zn(Nn(t));return Fn(n,r)}return We.runKernelFunc((function(e){return e.onesLike(t)}),{$x:t},(function(e,t){return{$x:function(){return Zn(e)}}}))}}),Zn=Mn({zerosLike_:function(e){var t=xn(e,"x","zerosLike");return We.runKernelFunc((function(e){return e.zerosLike(t)}),{$x:t},(function(e,t){return{$x:function(){return Zn(e)}}}))}}),Qn=Mn({concat_:function(e,t){void 0===t&&(t=0),A(e.length>=1,(function(){return"Pass at least one tensor to concat"}));var n=wn(e,"tensors","concat");"complex64"===n[0].dtype&&n.forEach((function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+e.dtype+". ")})),t=L(t,n[0].shape)[0];var r=jn(n.map((function(e){return e.shape})),t);if(0===j(r))return Rn([],r);if(1===(n=n.filter((function(e){return e.size>0}))).length)return n[0];var i=n.map((function(e){return e.shape}));Tn(i,t);var a=n,o={axis:t};return We.runKernelFunc((function(e){return e.concat(n,t)}),a,(function(e){var n=i.map((function(e){return e[t]}));return ir(e,n,t).map((function(e){return function(){return e}}))}),"Concat",o)}}),er=Mn({concat1d_:function(e){return Qn(e,0)}}),tr=Mn({concat2d_:function(e,t){return Qn(e,t)}}),nr=Mn({concat3d_:function(e,t){return Qn(e,t)}}),rr=Mn({concat4d_:function(e,t){return Qn(e,t)}}),ir=Mn({split_:function(e,t,n){void 0===n&&(n=0);var r,i=xn(e,"x","split");return n=L(n,i.shape)[0],"number"==typeof t?(A(i.shape[n]%t==0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(t).fill(i.shape[n]/t)):(A(i.shape[n]===t.reduce((function(e,t){return e+t})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=t),We.runKernelFunc((function(e){return e.split(i,r,n)}),{$x:i},(function(e){return{$x:function(){return Qn(e,n)}}}))}});function ar(e,t){return e(t={exports:{}},t.exports),t.exports}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==e||"undefined"!=typeof self&&self;var or=ar((function(e){!function(e,t,n){function r(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function i(e,t){var n=new function(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}(e),i=t&&t.state,a=n.next;return a.int32=function(){return 4294967296*n.next()|0},a.double=function(){return a()+11102230246251565e-32*(2097152*a()|0)},a.quick=a,i&&("object"==typeof i&&r(i,n),a.state=function(){return r(n,{})}),a}t&&t.exports?t.exports=i:this.alea=i}(0,e)})),sr=ar((function(e){!function(e,t,n){function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function i(e,t){var n=new function(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}(e),i=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,i&&("object"==typeof i&&r(i,n),a.state=function(){return r(n,{})}),a}t&&t.exports?t.exports=i:this.xor128=i}(0,e)})),ur=ar((function(e){!function(e,t,n){function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function i(e,t){var n=new function(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}(e),i=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,i&&("object"==typeof i&&r(i,n),a.state=function(){return r(n,{})}),a}t&&t.exports?t.exports=i:this.xorwow=i}(0,e)})),cr=ar((function(e){!function(e,t,n){function r(e,t){return t.x=e.x.slice(),t.i=e.i,t}function i(e,t){null==e&&(e=+new Date);var n=new function(e){var t=this;t.next=function(){var e,n,r=t.x,i=t.i;return e=r[i],n=(e^=e>>>7)^e<<24,n^=(e=r[i+1&7])^e>>>10,n^=(e=r[i+3&7])^e>>>3,n^=(e=r[i+4&7])^e<<7,e=r[i+7&7],n^=(e^=e<<13)^e<<9,r[i]=n,t.i=i+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}(e),i=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,i&&(i.x&&r(i,n),a.state=function(){return r(n,{})}),a}t&&t.exports?t.exports=i:this.xorshift7=i}(0,e)})),lr=ar((function(e){!function(e,t,n){function r(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function i(e,t){null==e&&(e=+new Date);var n=new function(e){var t=this;t.next=function(){var e,n,r=t.w,i=t.X,a=t.i;return t.w=r=r+1640531527|0,n=i[a+34&127],e=i[a=a+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=i[a]=n^e,t.i=a,n+(r^r>>>16)|0},function(e,t){var n,r,i,a,o,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),i=0,a=-32;a<u;++a)t&&(r^=t.charCodeAt((a+32)%t.length)),0===a&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,a>=0&&(o=o+1640531527|0,i=0==(n=s[127&a]^=r+o)?i+1:0);for(i>=128&&(s[127&(t&&t.length||0)]=-1),i=127,a=512;a>0;--a)r=s[i+34&127],n=s[i=i+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[i]=r^n;e.w=o,e.X=s,e.i=i}(t,e)}(e),i=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,i&&(i.X&&r(i,n),a.state=function(){return r(n,{})}),a}t&&t.exports?t.exports=i:this.xor4096=i}(0,e)})),fr=ar((function(e){!function(e,t,n){function r(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function i(e,t){var n=new function(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,i=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^i,i=i-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^i,t.a=i-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}(e),i=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,i&&("object"==typeof i&&r(i,n),a.state=function(){return r(n,{})}),a}t&&t.exports?t.exports=i:this.tychei=i}(0,e)})),dr=ar((function(e){!function(t,r){var i,a=this,o=256,s=6,u="random",c=r.pow(o,s),l=r.pow(2,52),f=2*l,d=o-1;function h(e,n,d){var h=[],y=v(function e(t,n){var r,i=[],a=typeof t;if(n&&"object"==a)for(r in t)try{i.push(e(t[r],n-1))}catch(e){}return i.length?i:"string"==a?t:t+"\0"}((n=1==n?{entropy:!0}:n||{}).entropy?[e,g(t)]:null==e?function(){try{var e;return i&&(e=i.randomBytes)?e=e(o):(e=new Uint8Array(o),(a.crypto||a.msCrypto).getRandomValues(e)),g(e)}catch(e){var n=a.navigator,r=n&&n.plugins;return[+new Date,a,r,a.screen,g(t)]}}():e,3),h),b=new p(h),x=function(){for(var e=b.g(s),t=c,n=0;e<l;)e=(e+n)*o,t*=o,n=b.g(1);for(;e>=f;)e/=2,t/=2,n>>>=1;return(e+n)/t};return x.int32=function(){return 0|b.g(4)},x.quick=function(){return b.g(4)/4294967296},x.double=x,v(g(b.S),t),(n.pass||d||function(e,t,n,i){return i&&(i.S&&m(i,b),e.state=function(){return m(b,{})}),n?(r[u]=e,t):e})(x,y,"global"in n?n.global:this==r,n.state)}function p(e){var t,n=e.length,r=this,i=0,a=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);i<o;)s[i]=i++;for(i=0;i<o;i++)s[i]=s[a=d&a+e[i%n]+(t=s[i])],s[a]=t;(r.g=function(e){for(var t,n=0,i=r.i,a=r.j,s=r.S;e--;)t=s[i=d&i+1],n=n*o+s[d&(s[i]=s[a=d&a+t])+(s[a]=t)];return r.i=i,r.j=a,n})(o)}function m(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function v(e,t){for(var n,r=e+"",i=0;i<r.length;)t[d&i]=d&(n^=19*t[d&i])+r.charCodeAt(i++);return g(t)}function g(e){return String.fromCharCode.apply(0,e)}if(r["seed"+u]=h,v(r.random(),t),e.exports){e.exports=h;try{i=n(251)}catch(e){}}}([],Math)}));dr.alea=or,dr.xor128=sr,dr.xorwow=ur,dr.xorshift7=cr,dr.xor4096=lr,dr.tychei=fr;var hr=dr.alea,pr=function(){function e(e,t,n,r,i){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=i||Math.random();this.random=hr(a.toString())}return e.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){var i=void 0,a=void 0,o=void 0;do{o=(i=2*this.random()-1)*i+(a=2*this.random()-1)*a}while(o>=1||0===o);var s=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*i*s,n=this.mean+this.stdDev*a*s,this.truncated&&!this.isValidTruncated(t)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)},e.prototype.convertValue=function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)},e.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},e}(),mr=function(){function e(e,t,n,r){this.alpha=e,this.beta=1/t,this.dtype=n;var i=r||Math.random();this.randu=hr(i.toString()),this.randn=new pr(0,1,n,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return e.prototype.nextValue=function(){for(var e,t,n,r,i,a;;){do{r=this.randn.nextValue(),a=1+this.c*r}while(a<=0);if(a*=a*a,t=1-.331*(e=r*r)*e,n=.5*e+this.d*(1-a+Math.log(a)),(i=this.randu())<t||Math.log(i)<n)break}return a=1/this.beta*this.d*a,this.alpha<1&&(a*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(a)},e.prototype.convertValue=function(e){return"float32"===this.dtype?e:Math.round(e)},e}(),vr=function(){function e(e,t,n,r){var i=this;if(void 0===e&&(e=0),void 0===t&&(t=1),this.canReturnFloat=function(){return null==i.dtype||"float32"===i.dtype},this.min=e,this.range=t-e,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=hr(r)}return e.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},e.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},e}();function gr(e,t,n){return void 0===t&&(t="float32"),t=t||"float32",se(e),new we(e,t,n)}function yr(e,t){void 0===t&&(t=!1),console.log(e.toString(t))}var br=Mn({batchToSpaceND_:function(e,t,n){var r=xn(e,"x","batchToSpaceND"),i=t.reduce((function(e,t){return e*t}));return A(r.rank>=1+t.length,(function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+t.length})),A(n.length===t.length,(function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+t.length})),A(r.shape[0]%i==0,(function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+i})),We.runKernelFunc((function(e){return e.batchToSpaceND(r,t,n)}),{$x:r},(function(e){return{$x:function(){return e.spaceToBatchND(t,n)}}}))}}),xr=Mn({broadcastTo_:function(e,t){var n=xn(e,"broadcastTo","x"),r=n.shape;if(t.some((function(e){return!(e>0)||e%1!=0})))throw new Error("broadcastTo(): Invalid broadcast shape ["+t+"].");if(t.length<n.rank)throw new Error("broadcastTo(): shape.length="+t.length+" < input.rank="+n.rank+".");if(t.length>n.rank){for(var i=n.shape.slice();i.length<t.length;)i.unshift(1);n=n.reshape(i)}for(var a=Array.from(t),o=t.length-1;o>=0;o--)if(n.shape[o]===t[o])a[o]=1;else if(1!==n.shape[o])throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+t+"].");var s=a.map((function(e,t){return e>1?t:-1})).filter((function(e){return e>=0}));return 0===s.length?n.clone():We.runKernelFunc((function(e){return e.tile(n,a)}),{input:n},(function(e){return{input:function(){return e.sum(s,!0)}}}))}}),wr=Mn({cast_:function(e,t){var n=xn(e,"x","cast");if(!G(t))throw new Error("Failed to cast to unknown dtype "+t);if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={dtype:t};return We.runKernelFunc((function(e){return e.cast(n,t)}),{x:n},(function(e){return{x:function(){return e.clone()}}}),"Cast",r)}}),_r=Mn({clone_:function(e){var t=xn(e,"x","clone",null);return We.runKernelFunc((function(){return We.makeTensorFromDataId(t.dataId,t.shape,t.dtype)}),{$x:t},(function(e){return{$x:function(){return e.toFloat()}}}))}}),kr=Mn({cumsum_:function(e,t,n,r){void 0===t&&(t=0),void 0===n&&(n=!1),void 0===r&&(r=!1);var i=xn(e,"x","cumsum"),a=An([t|=0],i.rank),o=i;null!=a&&(o=i.transpose(a));var s=Dn(1,i.rank)[0],u=We.runKernelFunc((function(e){return e.cumsum(o,s,n,r)}),{permutedX:o},(function(e){return{permutedX:function(){return e.cumsum(t,n,!r)}}}));return null!=a&&(u=u.transpose(a)),u}}),Er=Mn({depthToSpace_:function(e,t,n){void 0===n&&(n="NHWC");var r=xn(e,"x","depthToSpace"),i="NHWC"===n?r.shape[1]:r.shape[2],a="NHWC"===n?r.shape[2]:r.shape[3],o="NHWC"===n?r.shape[3]:r.shape[1];return A(i*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n      "+i+" and "+t+"  for depthToSpace with input shape\n      "+r.shape})),A(a*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n      "+a+" and "+t+" for depthToSpace with input shape\n          "+r.shape})),A(o%(t*t)==0,(function(){return"Dimension size must be evenly divisible by "+t*t+" but is "+o+" for depthToSpace with input shape "+r.shape})),We.runKernelFunc((function(e){return e.depthToSpace(r,t,n)}),{$x:r})}}),Sr=Mn({expandDims_:function(e,t){void 0===t&&(t=0);var n=xn(e,"x","expandDims",null);A(t<=n.rank,(function(){return"Axis must be <= rank of the tensor"}));var r=n.shape.slice();return t<0&&(A(-(n.rank+1)<=t,(function(){return"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"})),t=n.rank+t+1),r.splice(t,0,1),Br(n,r)}}),Cr=Mn({eye_:function(e,t,n,r){void 0===r&&(r="float32"),null==t&&(t=e);for(var i=gr([e,t],r),a=e<=t?e:t,o=0;o<a;++o)i.set(1,o,o);var s=i.toTensor().as2D(e,t);if(null==n)return s;if(1===n.length)return Wr(Sr(s,0),[n[0],1,1]);if(2===n.length)return Wr(Sr(Sr(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return Wr(Sr(Sr(Sr(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}}),Ar=Mn({multinomial_:function(e,t,n,r){void 0===r&&(r=!1);var i=xn(e,"logits","multinomial"),a=i.size,o=i.rank;if(a<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+a+".");if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+o);n=n||Math.random();var s=1===o?i.as2D(1,-1):i,u=We.runKernelFunc((function(e){return e.multinomial(s,r,t,n)}),{logits2D:s});return 1===o?u.as1D():u}}),Or=Mn({oneHot_:function(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r=0),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var i=xn(e,"indices","oneHot","int32"),a=i.shape.concat([t]);return i=i.flatten(),We.runKernelFunc((function(e){return e.oneHot(i,t,n,r)}),{$indices:i},(function(e){return{$indices:function(){return Xn(i.shape,"float32")}}})).reshape(a)}}),Dr=Mn({pad_:function(e,t,n){void 0===n&&(n=0);var r=xn(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var i={paddings:t,constantValue:n};return We.runKernelFunc((function(e){return e.pad(r,t,n)}),{x:r},(function(e){var n=t.map((function(e){return e[0]}));return{x:function(){return e.slice(n,r.shape)}}}),"PadV2",i)}}),Tr=Mn({pad1d_:function(e,t,n){return void 0===n&&(n=0),A(2===t.length,(function(){return"Invalid number of paddings. Must be length of 2."})),Dr(e,[t],n)}}),jr=Mn({pad2d_:function(e,t,n){return void 0===n&&(n=0),A(2===t.length&&2===t[0].length&&2===t[1].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Dr(e,t,n)}}),Mr=Mn({pad3d_:function(e,t,n){return void 0===n&&(n=0),A(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Dr(e,t,n)}}),Fr=Mn({pad4d_:function(e,t,n){return void 0===n&&(n=0),A(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Dr(e,t,n)}}),Ir=Mn({rand_:function(e,t,n){var r=j(e),i=null;if(null==n||"float32"===n)i=new Float32Array(r);else if("int32"===n)i=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type "+n);i=new Uint8Array(r)}for(var a=0;a<r;a++)i[a]=t();return We.makeTensor(i,e,n)}}),Nr=Mn({randomNormal_:function(e,t,n,r,i){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var a=new pr(t,n,r,!1,i),o=gr(e,r),s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}}),Rr=Mn({randomGamma_:function(e,t,n,r,i){if(void 0===n&&(n=1),void 0===r&&(r="float32"),null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type "+r);for(var a=new mr(t,n,r,i),o=gr(e,r),s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}}),Pr=Mn({randomUniform_:function(e,t,n,r,i){void 0===t&&(t=0),void 0===n&&(n=1),void 0===r&&(r="float32");for(var a=gr(e,r),o=new vr(t,n,null,i),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),Br=Mn({reshape_:function(e,t){var n=xn(e,"x","reshape",null);t=B(t,n.size),A(n.size===j(t),(function(){return"new shape and old shape must have the same number of elements."}));var r={shape:t};return We.runKernelFunc((function(e){return e.reshape(n,t)}),{x:n},(function(e){return{x:function(){return e.reshape(n.shape)}}}),"Reshape",r)}}),Lr=Mn({spaceToBatchND_:function(e,t,n){var r=xn(e,"x","spaceToBatchND");return A(r.rank>=1+t.length,(function(){return"input rank "+r.rank+" should be > than [blockShape] "+t.length})),A(n.length===t.length,(function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+t.length})),A(r.shape.reduce((function(e,r,i){return i>0&&i<=t.length?e&&(r+n[i-1][0]+n[i-1][1])%t[i-1]==0:e}),!0),(function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+t.toString()})),We.runKernelFunc((function(e){return e.spaceToBatchND(r,t,n)}),{$x:r},(function(e){return{$x:function(){return e.batchToSpaceND(t,n)}}}))}}),zr=Mn({squeeze_:function(e,t){var n=xn(e,"x","squeeze");return Br(n,z(n.shape,t).newShape)}}),Ur=Mn({stack_:function(e,t){void 0===t&&(t=0);var n=wn(e,"tensors","stack");if(A(n.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),1===n.length)return n[0].expandDims(t);var r=n[0].rank,i=n[0].shape,a=n[0].dtype;A(t<=r,(function(){return"Axis must be <= rank of the tensor"})),n.forEach((function(e){O(i,e.shape,"All tensors passed to stack must have matching shapes")})),n.forEach((function(e){A(a===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=n.map((function(e){return e.expandDims(t)}));return Qn(o,t)}}),Wr=Mn({tile_:function(e,t){var n=xn(e,"x","tile",null);A(n.rank===t.length,(function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+t+"."}));var r=[n],i={reps:t};return We.runKernelFunc((function(e,r){var i=e.tile(n,t);return r([n]),i}),{x:n},(function(e,n){var r=n[0];return{x:function(){var n=Zn(r);if(1===r.rank)for(var i=0;i<t[0];++i)n=n.add(e.slice([i*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(i=0;i<t[0];++i)for(var a=0;a<t[1];++a)n=n.add(e.slice([i*r.shape[0],a*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(i=0;i<t[0];++i)for(a=0;a<t[1];++a)for(var o=0;o<t[2];++o)n=n.add(e.slice([i*r.shape[0],a*r.shape[1],o*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+r.rank+" tensors yet.");for(i=0;i<t[0];++i)for(a=0;a<t[1];++a)for(o=0;o<t[2];++o)for(var s=0;s<t[3];++s)n=n.add(e.slice([i*r.shape[0],a*r.shape[1],o*r.shape[2],s*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return n}}}),"Tile",i,r)}}),Vr=Mn({truncatedNormal_:function(e,t,n,r,i){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var a=new pr(t,n,r,!0,i),o=gr(e,r),s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}}),Gr=Mn({unstack_:function(e,t){void 0===t&&(t=0),t=t||0;var n=xn(e,"x","unstack");A(t>=-n.shape.length&&t<n.shape.length,(function(){return"Axis = "+t+" is not in [-"+n.shape.length+", "+n.shape.length+")"})),t<0&&(t+=n.shape.length);var r={axis:t};return We.runKernelFunc((function(e){return e.unstack(n,t)}),{x:n},(function(e){return{x:function(){return Ur(e,t)}}}),"Unpack",r)}}),qr=function(e,t){return u(this,void 0,void 0,(function(){var n,r,i,a,o,s,u,l,f,d;return c(this,(function(c){switch(c.label){case 0:return n=xn(e,"x","setdiff1d"),r=xn(t,"y","setdiff1d"),A(n.dtype===r.dtype,(function(){return"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."})),A(1===n.rank,(function(){return"x should be 1D tensor, but got x ("+n.shape+")."})),A(1===r.rank,(function(){return"y should be 1D tensor, but got y ("+r.shape+")."})),[4,n.data()];case 1:return i=c.sent(),[4,r.data()];case 2:for(a=c.sent(),o=new Set(a),s=0,f=0;f<i.length;f++)o.has(i[f])||s++;for(u=new we([s],n.dtype),l=new we([s],"int32"),f=0,d=0;f<i.length;f++)o.has(i[f])||(u.values[d]=i[f],l.values[d]=f,d++);return[2,[u.toTensor(),l.toTensor()]]}}))}))};function Hr(e,t,n,r){void 0===r&&(r=!0);var i=[];if(r)(i=i.concat(t.slice(0))).push(e[0]/n),i=i.concat(e.slice(1));else{i=i.concat(e[0]);for(var a=t.length,o=0;o<a;++o)i=i.concat([e[o+1]/t[o],t[o]]);i=i.concat(e.slice(a+1))}return i}function Xr(e,t,n){void 0===n&&(n=!0);var r=[];if(n){r.push(t);for(var i=t+1;i<e;++i)i<=2*t?(r.push(i),r.push(i-(t+1))):r.push(i)}else{var a=[],o=[];for(i=1;i<e;++i)i>=2*t+1||i%2==1?o.push(i):a.push(i);r.push.apply(r,a),r.push(0),r.push.apply(r,o)}return r}function Kr(e,t,n,r){void 0===r&&(r=!0);var i=[];r?i.push(e[0]/n):i.push(e[0]*n);for(var a=1;a<e.length;++a)a<=t.length?r?i.push(t[a-1]*e[a]):i.push(e[a]/t[a-1]):i.push(e[a]);return i}function Yr(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function $r(e,t,n){for(var r=e.slice(0,1),i=0;i<n;++i)r.push(e[i+1]-t[i][0]-t[i][1]);return r}function Jr(e,t){if(e.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.shape[t.rank-1]>e.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+t.shape[t.rank-1]+" vs. "+e.rank);if(0===e.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+e.shape+".");for(var n=t.shape,r=n[n.length-1],i=1,a=0;a<n.length-1;++a)i*=n[a];var o=e.shape,s=n.slice();s.pop();var u=1;for(a=r;a<e.rank;++a)u*=o[a],s.push(o[a]);var c=te(e.shape).map((function(e){return e/u})).concat([1]).slice(0,r);return[s,i,u,c]}var Zr=Object.freeze({prepareAndValidate:Jr}),Qr=30;function ei(e){return e<=Qr?e:ee(e,Math.floor(Math.sqrt(e)))}function ti(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,i=t.rank>1?t.rank-1:1,a="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+t.shape+", shape: "+e+", sliceDim: "+r+", and batchDim: "+i+".";if(n.rank<i)throw new Error(a+" update.rank < "+i+". ");if(e.length<r+(n.rank-i))throw new Error(a+" Output shape length < "+(r+(n.rank-i)));if(n.rank!==i+e.length-r)throw new Error(a+" update.rank != "+(i+e.length-r));for(var o=0;o<i;++o)if(n.shape[o]!==t.shape[o])throw new Error(a+" updates.shape["+o+"] ("+n.shape[o]+") != indices.shape["+o+"] ("+t.shape[o]+").");for(o=0;o<n.rank-i;++o)if(n.shape[o+i]!==e[o+r])throw new Error(a+" updates.shape["+(o+i)+"] ("+n.shape[o+i]+") != shape["+(o+i)+"] ("+e[o+i]+")")}function ni(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+e.rank+".");if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(0===e.size)throw new Error("Updates specified for empty output. updates shape: "+e.shape)}ti(n,t,e)}function ri(e,t,n){for(var r=t.shape.length,i=r>1?t.shape[r-1]:1,a=n.length,o=1,s=i;s<a;++s)o*=n[s];var u=i<1?1:i;return{sliceRank:i,numUpdates:j(t.shape)/u,sliceSize:o,strides:te(n.slice(0,i)).concat([1]),outputSize:j(n)}}var ii=Object.freeze({validateUpdateShape:ti,validateInput:ni,calculateShapes:ri});function ai(e,t,n){A(e.rank===t.length,(function(){return"Error in slice"+e.rank+"D: Length of begin "+t+" must match the rank of the array ("+e.rank+")."})),A(e.rank===n.length,(function(){return"Error in slice"+e.rank+"D: Length of size "+n+" must match the rank of the array ("+e.rank+")."}));for(var r=function(r){A(t[r]+n[r]<=e.shape[r],(function(){return"Error in slice"+e.rank+"D: begin["+r+"] + size["+r+"] ("+(t[r]+n[r])+") would overflow input.shape["+r+"] ("+e.shape[r]+")"}))},i=0;i<e.rank;++i)r(i)}function oi(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t}function si(e,t,n){for(var r=[],i=0;i<e.length;i++)r[i]=Math.ceil((t[i]-e[i])/n[i]);return r}function ui(e,t,n,r,i){var a=t[i],o=n[i]||1;(e&1<<i||null==a)&&(a=o>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[i];return a<0&&(a+=s),E(0,a,s-1)}function ci(e,t,n,r,i){var a=t[i],o=n[i]||1;(e&1<<i||null==a)&&(a=o>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[i];return a<0&&(a+=s),o>0?E(0,a,s):E(-1,a,s-1)}function li(e,t,n){for(var r=n.length,i=0;i<n.length;i++)if(n[i]>1){r=i;break}for(i=r+1;i<n.length;i++)if(t[i]>0||n[i]!==e[i])return!1;return!0}function fi(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}var di=Object.freeze({assertParamsValid:ai,maskToAxes:oi,computeOutShape:si,startForAxis:ui,stopForAxis:ci,isSliceContinous:li,computeFlatOffset:fi});function hi(e){return A(Q(e),(function(){return"The f passed in grad(f) must be a function"})),function(t,n){var r=xn(t,"x","tf.grad",null),i=null!=n?xn(n,"dy","tf.grad"):null;return We.tidy((function(){var t=We.gradients((function(){return e(r)}),[r],i),n=t.value,a=t.grads;return null!=i&&O(n.shape,i.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),bi(a),a[0]}))}}function pi(e){return A(Q(e),(function(){return"The f passed in grads(f) must be a function"})),function(t,n){A(Array.isArray(t),(function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"}));var r=wn(t,"args","tf.grads",null),i=null!=n?xn(n,"dy","tf.grads"):null;return We.tidy((function(){var t=We.gradients((function(){return e.apply(void 0,r)}),r,i),n=t.value,a=t.grads;return null!=i&&O(n.shape,i.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),bi(a),a}))}}function mi(e){return A(Q(e),(function(){return"The f passed in valueAndGrad(f) must be a function"})),function(t,n){A(t instanceof Se,(function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"})),A(null==n||n instanceof Se,(function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"}));var r=We.gradients((function(){return e(t)}),[t],n),i=r.grads,a=r.value;return bi(i),{grad:i[0],value:a}}}function vi(e){return A(Q(e),(function(){return"The f passed in valueAndGrads(f) must be a function"})),function(t,n){A(Array.isArray(t)&&t.every((function(e){return e instanceof Se})),(function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"})),A(null==n||n instanceof Se,(function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"}));var r=We.gradients((function(){return e.apply(void 0,t)}),t,n);return null!=n&&O(r.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),bi(r.grads),r}}function gi(e,t){A(Q(e),(function(){return"The f passed in variableGrads(f) must be a function"})),A(null==t||Array.isArray(t)&&t.every((function(e){return e instanceof je})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var n=null!=t;if(!n)for(var r in t=[],We.registeredVariables)t.push(We.registeredVariables[r]);var i=n?t.filter((function(e){return!e.trainable})):null,a=t.length;A((t=t.filter((function(e){return e.trainable}))).length>0,(function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+a+" variables is trainable."}));var o=We.gradients(e,t,null,!0),s=o.value,u=o.grads;A(u.some((function(e){return null!=e})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),A(0===s.rank,(function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"}));var c={};return t.forEach((function(e,t){null!=u[t]&&(c[e.name]=u[t])})),null!=i&&i.forEach((function(e){return c[e.name]=null})),{value:s,grads:c}}function yi(e){return We.customGrad(e)}function bi(e){if(e.filter((function(e){return null==e})).length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}var xi=Mn({softmax_:function(e,t){void 0===t&&(t=-1);var n=xn(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+t);return We.runKernelFunc((function(e,r){var i=e.softmax(n,t);return r([i]),i}),{logits:n},(function(e,n){var r=n[0],i=e.mul(r);return{logits:function(){return i.sub(i.sum([t],!0).mul(r))}}}),"Softmax",{dim:t},[],[!0])}}),wi=Mn({logSoftmax_:function(e,t){void 0===t&&(t=-1);var n=xn(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+t);return yi((function(e,n){var r=e.max(t,!0),i=e.sub(r),a=i.toFloat().sub(i.exp().sum(t,!0).log());return n([a]),{value:a,gradFunc:function(e,n){var r=n[0].exp();return e.sub(e.sum(t,!0).mul(r))}}}))(n)}}),_i=function(){function e(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return e.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},e.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},e.prototype.has=function(e){return this.data.has(e)},e.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},e.prototype.numDataIds=function(){return this.dataIdsCount},e}(),ki=function(){function e(){}return e.prototype.time=function(e){return Ei("time")},e.prototype.read=function(e){return Ei("read")},e.prototype.readSync=function(e){return Ei("readSync")},e.prototype.numDataIds=function(){return Ei("numDataIds")},e.prototype.disposeData=function(e){return Ei("disposeData")},e.prototype.write=function(e,t,n){return Ei("write")},e.prototype.move=function(e,t,n,r){return Ei("move")},e.prototype.memory=function(){return Ei("memory")},e.prototype.floatPrecision=function(){return Ei("floatPrecision")},e.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},e.prototype.batchMatMul=function(e,t,n,r){return Ei("batchMatMul")},e.prototype.fusedBatchMatMul=function(e){return e.a,e.b,e.transposeA,e.transposeB,e.bias,e.activation,e.preluActivationWeights,Ei("fusedBatchMatMul")},e.prototype.slice=function(e,t,n){return Ei("slice")},e.prototype.stridedSlice=function(e,t,n,r){return Ei("stridedSlice")},e.prototype.unstack=function(e,t){return Ei("unstack")},e.prototype.reverse=function(e,t){return Ei("reverse")},e.prototype.concat=function(e,t){return Ei("concat")},e.prototype.neg=function(e){return Ei("neg")},e.prototype.add=function(e,t){return Ei("add")},e.prototype.addN=function(e){return Ei("addN")},e.prototype.subtract=function(e,t){return Ei("subtract")},e.prototype.multiply=function(e,t){return Ei("multiply")},e.prototype.realDivide=function(e,t){return Ei("realDivide")},e.prototype.floorDiv=function(e,t){return Ei("floorDiv")},e.prototype.sum=function(e,t){return Ei("sum")},e.prototype.prod=function(e,t){return Ei("prod")},e.prototype.unsortedSegmentSum=function(e,t,n){return Ei("unsortedSegmentSum")},e.prototype.argMin=function(e,t){return Ei("argMin")},e.prototype.argMax=function(e,t){return Ei("argMax")},e.prototype.equal=function(e,t){return Ei("equal")},e.prototype.notEqual=function(e,t){return Ei("notEqual")},e.prototype.less=function(e,t){return Ei("less")},e.prototype.lessEqual=function(e,t){return Ei("lessEqual")},e.prototype.greater=function(e,t){return Ei("greater")},e.prototype.greaterEqual=function(e,t){return Ei("greaterEqual")},e.prototype.logicalNot=function(e){return Ei("logicalNot")},e.prototype.logicalAnd=function(e,t){return Ei("logicalAnd")},e.prototype.logicalOr=function(e,t){return Ei("logicalOr")},e.prototype.where=function(e){return Ei("where")},e.prototype.select=function(e,t,n){return Ei("select")},e.prototype.topk=function(e,t,n){return Ei("topk")},e.prototype.min=function(e,t){return Ei("min")},e.prototype.minimum=function(e,t){return Ei("minimum")},e.prototype.mod=function(e,t){return Ei("mod")},e.prototype.max=function(e,t){return Ei("max")},e.prototype.maximum=function(e,t){return Ei("maximum")},e.prototype.all=function(e,t){return Ei("all")},e.prototype.any=function(e,t){return Ei("any")},e.prototype.squaredDifference=function(e,t){return Ei("squaredDifference")},e.prototype.ceil=function(e){return Ei("ceil")},e.prototype.floor=function(e){return Ei("floor")},e.prototype.round=function(e){return Ei("round")},e.prototype.sign=function(e){return Ei("sign")},e.prototype.isNaN=function(e){return Ei("isNaN")},e.prototype.isInf=function(e){return Ei("isInf")},e.prototype.isFinite=function(e){return Ei("isFinite")},e.prototype.pow=function(e,t){return Ei("pow")},e.prototype.exp=function(e){return Ei("exp")},e.prototype.expm1=function(e){return Ei("expm1")},e.prototype.softmax=function(e,t){return Ei("softmax")},e.prototype.log=function(e){return Ei("log")},e.prototype.log1p=function(e){return Ei("log1p")},e.prototype.sqrt=function(e){return Ei("sqrt")},e.prototype.rsqrt=function(e){return Ei("rsqrt")},e.prototype.square=function(e){return Ei("square")},e.prototype.reciprocal=function(e){return Ei("reciprocal")},e.prototype.relu=function(e){return Ei("relu")},e.prototype.relu6=function(e){return Ei("relu6")},e.prototype.prelu=function(e,t){return Ei("prelu")},e.prototype.elu=function(e){return Ei("elu")},e.prototype.eluDer=function(e,t){return Ei("eluDer")},e.prototype.selu=function(e){return Ei("selu")},e.prototype.int=function(e){return Ei("int")},e.prototype.clip=function(e,t,n){return Ei("clip")},e.prototype.abs=function(e){return Ei("abs")},e.prototype.complexAbs=function(e){return Ei("complexAbs")},e.prototype.sigmoid=function(e){return Ei("sigmoid")},e.prototype.softplus=function(e){return Ei("softplus")},e.prototype.sin=function(e){return Ei("sin")},e.prototype.cos=function(e){return Ei("cos")},e.prototype.tan=function(e){return Ei("tan")},e.prototype.asin=function(e){return Ei("asin")},e.prototype.acos=function(e){return Ei("acos")},e.prototype.atan=function(e){return Ei("atan")},e.prototype.atan2=function(e,t){return Ei("atan2")},e.prototype.sinh=function(e){return Ei("sinh")},e.prototype.cosh=function(e){return Ei("cosh")},e.prototype.tanh=function(e){return Ei("tanh")},e.prototype.asinh=function(e){return Ei("asinh")},e.prototype.acosh=function(e){return Ei("acosh")},e.prototype.atanh=function(e){return Ei("atanh")},e.prototype.erf=function(e){return Ei("erf")},e.prototype.step=function(e,t){return Ei("step")},e.prototype.fusedConv2d=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,Ei("fusedConv2d")},e.prototype.conv2d=function(e,t,n){return Ei("conv2d")},e.prototype.conv2dDerInput=function(e,t,n){return Ei("conv2dDerInput")},e.prototype.conv2dDerFilter=function(e,t,n){return Ei("conv2dDerFilter")},e.prototype.fusedDepthwiseConv2D=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,Ei("fusedDepthwiseConv2D")},e.prototype.depthwiseConv2D=function(e,t,n){return Ei("depthwiseConv2D")},e.prototype.depthwiseConv2DDerInput=function(e,t,n){return Ei("depthwiseConv2DDerInput")},e.prototype.depthwiseConv2DDerFilter=function(e,t,n){return Ei("depthwiseConv2DDerFilter")},e.prototype.conv3d=function(e,t,n){return Ei("conv3d")},e.prototype.conv3dDerInput=function(e,t,n){return Ei("conv3dDerInput")},e.prototype.conv3dDerFilter=function(e,t,n){return Ei("conv3dDerFilter")},e.prototype.maxPool=function(e,t){return Ei("maxPool")},e.prototype.maxPoolBackprop=function(e,t,n,r){return Ei("maxPoolBackprop")},e.prototype.avgPool=function(e,t){return Ei("avgPool")},e.prototype.avgPoolBackprop=function(e,t,n){return Ei("avgPoolBackprop")},e.prototype.avgPool3d=function(e,t){return Ei("avgPool3d")},e.prototype.avgPool3dBackprop=function(e,t,n){return Ei("avgPool3dBackprop")},e.prototype.maxPool3d=function(e,t){return Ei("maxPool3d")},e.prototype.maxPool3dBackprop=function(e,t,n,r){return Ei("maxPool3dBackprop")},e.prototype.reshape=function(e,t){return Ei("reshape")},e.prototype.cast=function(e,t){return Ei("cast")},e.prototype.tile=function(e,t){return Ei("tile")},e.prototype.pad=function(e,t,n){return Ei("pad")},e.prototype.transpose=function(e,t){return Ei("transpose")},e.prototype.gather=function(e,t,n){return Ei("gather")},e.prototype.gatherND=function(e,t){return Ei("gatherND")},e.prototype.scatterND=function(e,t,n){return Ei("scatterND")},e.prototype.batchToSpaceND=function(e,t,n){return Ei("batchToSpaceND")},e.prototype.spaceToBatchND=function(e,t,n){return Ei("spaceToBatchND")},e.prototype.resizeBilinear=function(e,t,n,r){return Ei("resizeBilinear")},e.prototype.resizeBilinearBackprop=function(e,t,n){return Ei("resizeBilinearBackprop")},e.prototype.resizeNearestNeighbor=function(e,t,n,r){return Ei("resizeNearestNeighbor")},e.prototype.resizeNearestNeighborBackprop=function(e,t,n){return Ei("resizeNearestNeighborBackprop")},e.prototype.batchNormalization=function(e,t,n,r,i,a){return Ei("batchNormalization")},e.prototype.localResponseNormalization4D=function(e,t,n,r,i){return Ei("localResponseNormalization4D")},e.prototype.LRNGrad=function(e,t,n,r,i,a,o){return Ei("LRNGrad")},e.prototype.multinomial=function(e,t,n,r){return Ei("multinomial")},e.prototype.oneHot=function(e,t,n,r){return Ei("oneHot")},e.prototype.cumsum=function(e,t,n,r){return Ei("cumsum")},e.prototype.nonMaxSuppression=function(e,t,n,r,i){return Ei("nonMaxSuppression")},e.prototype.fft=function(e){return Ei("fft")},e.prototype.ifft=function(e){return Ei("ifft")},e.prototype.complex=function(e,t){return Ei("complex")},e.prototype.real=function(e){return Ei("real")},e.prototype.imag=function(e){return Ei("imag")},e.prototype.cropAndResize=function(e,t,n,r,i,a){return Ei("cropAndResize")},e.prototype.depthToSpace=function(e,t,n){return Ei("depthToSpace")},e.prototype.split=function(e,t,n){return Ei("split")},e.prototype.sparseToDense=function(e,t,n,r){return Ei("sparseToDense")},e.prototype.diag=function(e){return Ei("diag")},e.prototype.fill=function(e,t,n){return Ei("fill")},e.prototype.onesLike=function(e){return Ei("onesLike")},e.prototype.zerosLike=function(e){return Ei("zerosLike")},e.prototype.linspace=function(e,t,n){return Ei("linspace")},e.prototype.dispose=function(){return Ei("dispose")},e}();function Ei(e){throw new Error("'"+e+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Si(e,t){for(var n=e.length,r=[],i=0;i<n;i++){var a=n-1-i,o=e[a]||1;(t[t.length-1-i]||1)>1&&1===o&&r.unshift(a)}return r}function Ci(e,t){for(var n=[],r=0;r<t.length;r++){var i=e[e.length-r-1],a=t.length-r-1,o=t[a];(null==i||1===i&&o>1)&&n.unshift(a)}return n}function Ai(e,t){for(var n=[],r=Math.max(e.length,t.length),i=0;i<r;i++){var a=e[e.length-i-1];null==a&&(a=1);var o=t[t.length-i-1];if(null==o&&(o=1),1===a)n.unshift(o);else if(1===o)n.unshift(a);else{if(a!==o)throw Error("Operands could not be broadcast together with shapes "+e+" and "+t+".");n.unshift(a)}}return n}function Oi(e,t,n,r,i,a,o){void 0===o&&(o="channelsLast");var s,u=Fi(t),c=u[0],l=u[1];if("channelsLast"===o)s=[c,l,e[3],e[3]];else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat "+o);s=[c,l,e[1],e[1]]}return Ti(e,s,n,r,i,a,!1,o)}function Di(e,t,n,r,i,a,o){void 0===o&&(o="NDHWC");var s,u,c=Ii(t),l=c[0],f=c[1],d=c[2];if("NDHWC"===o)u="channelsLast",s=[l,f,d,e[4],e[4]];else{if("NCDHW"!==o)throw new Error("Unknown dataFormat "+o);u="channelsFirst",s=[l,f,d,e[1],e[1]]}return ji(e,s,n,r,i,!1,u,a)}function Ti(e,t,n,r,i,a,o,s){void 0===o&&(o=!1),void 0===s&&(s="channelsLast");var u=[-1,-1,-1,-1],c=u[0],l=u[1],f=u[2],d=u[3];if("channelsLast"===s)c=e[0],l=e[1],f=e[2],d=e[3];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);c=e[0],d=e[1],l=e[2],f=e[3]}var h,p=t[0],m=t[1],v=t[3],g=Fi(n),y=g[0],b=g[1],x=Fi(r),w=x[0],_=x[1],k=Ni(p,w),E=Ni(m,_),S=function(e,t,n,r,i,a,o,s){var u,c,l;if("number"==typeof e){u={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var f=function(e,t,n,r,i){null==r&&(r=Mi(e,t,n));var a=e[1],o=Ri((e[0]-t+2*r)/n+1,i);A(F(o),(function(){return"The output # of rows ("+o+") must be an integer. Change the stride and/or zero pad parameters"}));var s=Ri((a-t+2*r)/n+1,i);return A(F(s),(function(){return"The output # of columns ("+s+") must be an integer. Change the stride and/or zero pad parameters"})),[o,s]}([t,n],a,r,e,s);c=f[0],l=f[1]}else if("same"===e){c=Math.ceil(t/r),l=Math.ceil(n/i);var d=Math.max(0,(c-1)*r+a-t),h=Math.max(0,(l-1)*i+o-n),p=Math.floor(d/2),m=d-p,v=Math.floor(h/2);u={top:p,bottom:m,left:v,right:h-v,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);u={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((t-a+1)/r),l=Math.ceil((n-o+1)/i)}return{padInfo:u,outHeight:c,outWidth:l}}(i,l,f,y,b,k,E,a),C=S.padInfo,O=S.outHeight,D=S.outWidth,T=o?v*d:v;return"channelsFirst"===s?h=[c,T,O,D]:"channelsLast"===s&&(h=[c,O,D,T]),{batchSize:c,dataFormat:s,inHeight:l,inWidth:f,inChannels:d,outHeight:O,outWidth:D,outChannels:T,padInfo:C,strideHeight:y,strideWidth:b,filterHeight:p,filterWidth:m,effectiveFilterHeight:k,effectiveFilterWidth:E,dilationHeight:w,dilationWidth:_,inShape:e,outShape:h,filterShape:t}}function ji(e,t,n,r,i,a,o,s){void 0===a&&(a=!1),void 0===o&&(o="channelsLast");var u=[-1,-1,-1,-1,-1],c=u[0],l=u[1],f=u[2],d=u[3],h=u[4];if("channelsLast"===o)c=e[0],l=e[1],f=e[2],d=e[3],h=e[4];else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat "+o);c=e[0],h=e[1],l=e[2],f=e[3],d=e[4]}var p,m=t[0],v=t[1],g=t[2],y=t[4],b=Ii(n),x=b[0],w=b[1],_=b[2],k=Ii(r),E=k[0],S=k[1],C=k[2],O=Ni(m,E),D=Ni(v,S),T=Ni(g,C),j=function(e,t,n,r,i,a,o,s,u,c,l){var f,d,h,p;if("number"==typeof e){f={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var m=function(e,t,n,r,i,a){null==i&&(i=Mi(e,t,r));var o=e[1],s=e[2],u=Ri((e[0]-t+2*i)/r+1,a);A(F(u),(function(){return"The output # of depths ("+u+") must be an integer. Change the stride and/or zero pad parameters"}));var c=Ri((o-t+2*i)/r+1,a);A(F(c),(function(){return"The output # of rows ("+c+") must be an integer. Change the stride and/or zero pad parameters"}));var l=Ri((s-t+2*i)/r+1,a);return A(F(l),(function(){return"The output # of columns ("+l+") must be an integer. Change the stride and/or zero pad parameters"})),[u,c,l,1]}([t,n,r,1],s,0,i,e,l);d=m[0],h=m[1],p=m[2]}else if("same"===e){var v=((d=Math.ceil(t/i))-1)*i+s-t,g=((h=Math.ceil(n/a))-1)*a+u-n,y=((p=Math.ceil(r/o))-1)*o+c-r,b=Math.floor(v/2),x=v-b,w=Math.floor(g/2),_=g-w,k=Math.floor(y/2);f={top:w,bottom:_,left:k,right:y-k,front:b,back:x,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);f={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},d=Math.ceil((t-s+1)/i),h=Math.ceil((n-u+1)/a),p=Math.ceil((r-c+1)/o)}return{padInfo:f,outDepth:d,outHeight:h,outWidth:p}}(i,l,f,d,x,w,_,O,D,T,s),M=j.padInfo,I=j.outDepth,N=j.outHeight,R=j.outWidth,P=a?y*h:y;return"channelsFirst"===o?p=[c,P,I,N,R]:"channelsLast"===o&&(p=[c,I,N,R,P]),{batchSize:c,dataFormat:o,inDepth:l,inHeight:f,inWidth:d,inChannels:h,outDepth:I,outHeight:N,outWidth:R,outChannels:P,padInfo:M,strideDepth:x,strideHeight:w,strideWidth:_,filterDepth:m,filterHeight:v,filterWidth:g,effectiveFilterDepth:O,effectiveFilterHeight:D,effectiveFilterWidth:T,dilationDepth:E,dilationHeight:S,dilationWidth:C,inShape:e,outShape:p,filterShape:t}}function Mi(e,t,n,r){void 0===r&&(r=1);var i=Ni(t,r);return Math.floor((e[0]*(n-1)-n+i)/2)}function Fi(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function Ii(e){return"number"==typeof e?[e,e,e]:e}function Ni(e,t){return t<=1?e:e+(e-1)*(t-1)}function Ri(e,t){if(!t)return e;switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode "+t)}}function Pi(e){var t=Fi(e),n=t[0],r=t[1],i=t[2];return 1===n&&1===r&&1===i}function Bi(e,t){return Pi(e)||Pi(t)}function Li(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat "+e)}function zi(e,t,n){if("complex64"===t){if("complex64"===e.dtype)return e.clone();var r=Xn(e.shape),i=e.toFloat(),a=n.complex(i,r);return r.dispose(),i.dispose(),a}if(!q(e.dtype,t))return We.makeTensorFromDataId(e.dataId,e.shape,t);if("complex64"===e.dtype){var o=n.real(e);return a=o.cast(t),o.dispose(),a}if("int32"===t)return n.int(e);if("bool"===t){var s=Bn(0,e.dtype);return a=n.notEqual(e,s),s.dispose(),a}throw new Error("Error in Cast: failed to cast "+e.dtype+" to "+t)}function Ui(e,t){return We.makeTensorFromDataId(e.dataId,t,e.dtype)}function Wi(e,t,n){var r=(t-e)/(n-1),i=ae(n,"float32");i[0]=e;for(var a=1;a<i.length;a++)i[a]=i[a-1]+r;return Ln(i,"float32")}var Vi=Object.freeze({castTensor:zi,reshapeTensor:Ui,linspaceImpl:Wi,upcastType:Fe,axesAreInnerMostDims:_n,combineLocations:kn,computeOutAndReduceShapes:En,expandShapeToKeepDim:Sn,assertAxesAreInnerMostDims:Cn,getAxesPermutation:An,getUndoAxesPermutation:On,getInnerMostAxes:Dn,getBroadcastDims:Si,getReductionAxes:Ci,assertAndGetBroadcastShape:Ai,assertParamsConsistent:Tn,computeOutShape:jn,computePool2DInfo:Oi,computePool3DInfo:Di,computeConv2DInfo:Ti,computeConv3DInfo:ji,computeDefaultPad:Mi,tupleValuesAreOne:Pi,eitherStridesOrDilationsAreOne:Bi,convertConv2DDataFormat:Li,PARALLELIZE_THRESHOLD:Qr,computeOptimalWindowSize:ei});function Gi(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+e.length+", imag: "+t.length+".");for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function qi(e,t){return{real:e[2*t],imag:e[2*t+1]}}function Hi(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function Xi(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}function Ki(e,t,n){var r=function(e,t,n){return function(e,t,n){for(var r=0,i=e.length,a=0,o=!1;r<i;){var s=n(t,e[a=r+(i-r>>>1)]);s>0?r=a+1:(i=a,o=!s)}return o?r:-r-1}(e,t,n||Yi)}(e,t,n),i=r<0?-(r+1):r;e.splice(i,0,t)}function Yi(e,t){return e>t?1:e<t?-1:0}function $i(e,t,n,r,i){return Zi(e,t,n,r,i,0).selectedIndices}function Ji(e,t,n,r,i,a){var o=Zi(e,t,n,r,i,a,!0);return o.numValidOutputs.dispose(),{selectedIndices:o.selectedIndices,selectedScores:o.selectedScores}}function Zi(e,t,n,r,i,a,o,s){void 0===o&&(o=!1),void 0===s&&(s=!1);for(var u=Array.from(t).map((function(e,t){return{score:e,boxIndex:t,suppressBeginIndex:0}})).filter((function(e){return e.score>i})).sort(ta),c=a>0?-.5/a:0,l=[],f=[];l.length<n&&u.length>0;){var d=u.pop(),h=d.score,p=d.boxIndex,m=d.suppressBeginIndex;if(h<i)break;for(var v=!1,g=l.length-1;g>=m;--g){var y=Qi(e,p,l[g]);if(y>=r){v=!0;break}if(d.score=d.score*ea(r,c,y),d.score<=i)break}d.suppressBeginIndex=l.length,v||(d.score===h?(l.push(p),f.push(d.score)):d.score>i&&Ki(u,d,ta))}var b=l.length;return s&&(l.fill(0,b),f.fill(0,b)),{selectedIndices:Ln(l,"int32"),selectedScores:Ln(f,"float32"),numValidOutputs:Bn(b,"int32")}}function Qi(e,t,n){var r=e.subarray(4*t,4*t+4),i=e.subarray(4*n,4*n+4),a=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(i[0],i[2]),l=Math.min(i[1],i[3]),f=Math.max(i[0],i[2]),d=Math.max(i[1],i[3]),h=(s-a)*(u-o),p=(f-c)*(d-l);if(h<=0||p<=0)return 0;var m=Math.max(a,c),v=Math.max(o,l),g=Math.min(s,f),y=Math.min(u,d),b=Math.max(g-m,0)*Math.max(y-v,0);return b/(h+p-b)}function ea(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function ta(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}function na(e,t,n){var r=new Array(e.rank).fill(0),i=e.shape.slice();return t.map((function(t){i[n]=t;var a=e.slice(r,i);return r[n]+=t,a}))}function ra(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];var i=gr(n,e.dtype);for(r=0;r<i.values.length;++r){for(var a=i.indexToLoc(r),o=new Array(e.rank),s=0;s<o.length;s++)o[s]=a[s]%e.shape[s];var u=e.locToIndex(o);i.values[r]=e.values[u]}return i.toTensor()}function ia(e,t,n,r,i){for(var a=t[t.length-1],o=[e.length/a,a],s=o[0],u=o[1],c=U(n,s*r),l=U("int32",s*r),f=0;f<s;f++){for(var d=f*u,h=e.subarray(d,d+u),p=[],m=0;m<h.length;m++)p.push({value:h[m],index:m});p.sort((function(e,t){return t.value-e.value}));var v=f*r,g=c.subarray(v,v+r),y=l.subarray(v,v+r);for(m=0;m<r;m++)g[m]=p[m].value,y[m]=p[m].index}var b=t.slice();return b[b.length-1]=r,[Rn(c,b,n),Rn(l,b,"int32")]}function aa(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);var i=gr(e,"int32"),a=gr([n.length,e.length],"int32");for(r=0;r<n.length;r++){var o=i.indexToLoc(n[r]),s=r*e.length;a.values.set(o,s)}return a.toTensor()}function oa(e,t){return["x","y","z","w","u","v"].slice(0,t).map((function(t){return e+"."+t}))}function sa(e,t){return 1===t?[e]:oa(e,t)}function ua(){var e,t,n,r,i,a,o,s,u,c;return 2===f().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",i="texture",a="outputColor",o="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",i="texture2D",a="gl_FragColor",o="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:i,output:a,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function ca(e,t,n){void 0===n&&(n="index");var r=te(t);return r.map((function(t,i){return"int "+e[i]+" = "+n+" / "+t+"; "+(i===r.length-1?"int "+e[i+1]+" = "+n+" - "+e[i]+" * "+t:"index -= "+e[i]+" * "+t)+";"})).join("")}function la(e){var t=te(e).map((function(e){return e.toString()}));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+t[0]+" + coords.y * "+t[1]+" + coords.z;\n  }\n"}var fa="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";function da(e,t,n,r){var i=[];e.forEach((function(e){var t=j(e.shapeInfo.logicalShape);e.shapeInfo.isUniform?i.push("uniform float "+e.name+(t>1?"["+t+"]":"")+";"):(i.push("uniform sampler2D "+e.name+";"),i.push("uniform int offset"+e.name+";"))}));var a,o,s=i.join("\n"),u=e.map((function(e){return function(e,t,n){void 0===n&&(n=!1);var r="";r+=n?function e(t){var n;switch(t.shapeInfo.logicalShape.length){case 0:return"\n    vec4 get"+(n=t.name).charAt(0).toUpperCase()+n.slice(1)+"() {\n      return "+ua().texture2D+"("+n+", halfCR);\n    }\n  ";case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e.shapeInfo.texShape,i=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],a=ua();return"\n    vec4 "+n+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+i[0]+", "+i[1]+", index);\n      return "+a.texture2D+"("+t+", uv);\n    }\n  "}(t);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e.shapeInfo.texShape,a=i[0],o=i[1],s=ua();if(null!=i&&M(t,i))return"\n      vec4 "+r+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+o+".0, "+a+".0);\n\n        return "+s.texture2D+"("+n+", uv);\n      }\n    ";var u=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];return"\n    vec4 "+r+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(t[1]/2)+", "+u[0]+", "+u[1]+", row, col);\n      return "+s.texture2D+"("+n+", uv);\n    }\n  "}(t);case 3:return function(t){var n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=t.shapeInfo.texShape,o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];if(1===n[0]){var s=xa(t,n.slice(1));return"\n        "+e(s)+"\n        vec4 "+i+"(int b, int row, int col) {\n          return "+i+"("+wa(["b","row","col"],[1,2])+");\n        }\n      "}var u=o[0],c=o[1],l=Math.ceil(n[2]/2);return"\n    vec4 "+i+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+u+", "+c+", "+l*Math.ceil(n[1]/2)+", "+l+", b, row, col);\n      return "+ua().texture2D+"("+r+", uv);\n    }\n  "}(t);default:return function(e){for(var t=e.shapeInfo.logicalShape,n=t.length,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=e.shapeInfo.texShape,o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],s=o[0],u=o[1],c=Math.ceil(t[n-1]/2),l=c*Math.ceil(t[n-2]/2),f="int b, int row, int col",d="b * "+l+" + (row / 2) * "+c+" + (col / 2)",h=2;h<n-1;h++)f="int b"+h+", "+f,d="b"+h+" * "+(l*=t[n-h-1])+" + "+d;return"\n    vec4 "+i+"("+f+") {\n      int index = "+d+";\n      int texR = index / "+u+";\n      int texC = index - texR * "+u+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+u+", "+s+");\n      return "+ua().texture2D+"("+r+", uv);\n    }\n  "}(t)}}(e):function e(t){var n=t.shapeInfo.logicalShape;switch(n.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"float "+n+"() {return "+t+";}";var r=e.shapeInfo.texShape,i=r[0],a=r[1];if(1===i&&1===a)return"\n      float "+n+"() {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var o=e.shapeInfo.texShape;return"\n    float "+n+"() {\n      vec2 uv = uvFromFlat("+o[0]+", "+o[1]+", "+ga(t)+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(t);case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"\n      float "+n+"(int index) {\n        "+ya(e)+"\n      }\n    ";var r=e.shapeInfo.texShape,i=r[0],a=r[1];if(1===a&&1===i)return"\n      float "+n+"(int index) {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var o=ga(t);return 1===a?"\n      float "+n+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+o+") + 0.5) / "+i+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":1===i?"\n      float "+n+"(int index) {\n        vec2 uv = vec2((float(index + "+o+") + 0.5) / "+a+".0, 0.5);\n        return sampleTexture("+t+", uv);\n      }\n    ":"\n    float "+n+"(int index) {\n      vec2 uv = uvFromFlat("+i+", "+a+", index + "+o+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(t);case 2:return function(t){var n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=t.shapeInfo.texShape;if(null!=a&&M(n,a)){var o=a[0];return"\n    float "+i+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+a[1]+".0, "+o+".0);\n      return sampleTexture("+r+", uv);\n    }\n  "}var s=z(n),u=s.newShape,c=s.keptDims,l=u;if(l.length<n.length){var f=xa(t,l);return"\n      "+e(f)+"\n      float "+i+"(int row, int col) {\n        return "+i+"("+wa(["row","col"],c)+");\n      }\n    "}if(t.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+n[1]+", 1)));\n        "+ya(t)+"\n      }\n    ";var d=a[0],h=a[1],p=ga(r);return 1===h?"\n    float "+i+"(int row, int col) {\n      float index = dot(vec3(row, col, "+p+"), vec3("+n[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+d+".0);\n      return sampleTexture("+r+", uv);\n    }\n  ":1===d?"\n    float "+i+"(int row, int col) {\n      float index = dot(vec3(row, col, "+p+"), vec3("+n[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+h+".0, 0.5);\n      return sampleTexture("+r+", uv);\n    }\n  ":"\n  float "+i+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+n[1]+" + col + "+p+";\n    vec2 uv = uvFromFlat("+d+", "+h+", index);\n    return sampleTexture("+r+", uv);\n  }\n"}(t);case 3:return function(t){var n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=n[1]*n[2],o=n[2],s=z(n),u=s.newShape,c=s.keptDims,l=u;if(l.length<n.length){var f=xa(t,l);return"\n        "+e(f)+"\n        float "+i+"(int row, int col, int depth) {\n          return "+i+"("+wa(["row","col","depth"],c)+");\n        }\n      "}if(t.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+a+", "+o+", 1)));\n        "+ya(t)+"\n      }\n    ";var d=t.shapeInfo.texShape,h=d[0],p=d[1],m=t.shapeInfo.flatOffset;return p===a&&null==m?"\n        float "+i+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+o+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+p+".0, "+h+".0);\n          return sampleTexture("+r+", uv);\n        }\n      ":p===o&&null==m?"\n    float "+i+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+n[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+p+".0, "+h+".0);\n      return sampleTexture("+r+", uv);\n    }\n  ":"\n      float "+i+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+a+" + col * "+o+" + depth + "+ga(r)+";\n        vec2 uv = uvFromFlat("+h+", "+p+", index);\n        return sampleTexture("+r+", uv);\n      }\n  "}(t);case 4:return function(t){var n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=n[3],o=n[2]*a,s=n[1]*o,u=z(n),c=u.newShape,l=u.keptDims;if(c.length<n.length){var f=xa(t,c);return"\n      "+e(f)+"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        return "+i+"("+wa(["row","col","depth","depth2"],l)+");\n      }\n    "}if(t.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+s+", "+o+", "+a+", 1)));\n        "+ya(t)+"\n      }\n    ";var d=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,p=h[0],m=h[1];return m===s&&null==d?"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+o+", "+a+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+m+".0, "+p+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":m===a&&null==d?"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+n[1]*n[2]+", "+n[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+m+".0, "+p+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+i+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+s+" + col * "+o+" +\n          depth * "+a+" + depth2;\n      vec2 uv = uvFromFlat("+p+", "+m+", index + "+ga(r)+");\n      return sampleTexture("+r+", uv);\n    }\n  "}(t);case 5:return function(t){var n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=n[4],o=n[3]*a,s=n[2]*o,u=n[1]*s,c=z(n),l=c.newShape,f=c.keptDims;if(l.length<n.length){var d=xa(t,l);return"\n      "+e(d)+"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+i+"("+wa(["row","col","depth","depth2","depth3"],f)+");\n      }\n    "}if(t.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+u+", "+s+", "+o+", "+a+")) +\n          depth3;\n        "+ya(t)+"\n      }\n    ";var h=t.shapeInfo.flatOffset,p=t.shapeInfo.texShape,m=p[0],v=p[1];return v===u&&null==h?"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+s+", "+o+", "+a+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+v+".0, "+m+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":v===a&&null==h?"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+n[1]*n[2]*n[3]+",\n               "+n[2]*n[3]+", "+n[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+v+".0, "+m+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+u+" + col * "+s+" + depth * "+o+" +\n          depth2 * "+a+" + depth3 + "+ga(r)+";\n      vec2 uv = uvFromFlat("+m+", "+v+", index);\n      return sampleTexture("+r+", uv);\n    }\n  "}(t);case 6:return function(t){var n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=z(n),o=a.newShape,s=a.keptDims;if(o.length<n.length){var u=xa(t,o);return"\n      "+e(u)+"\n      float "+i+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+i+"("+wa(["row","col","depth","depth2","depth3","depth4"],s)+");\n      }\n    "}var c=n[5],l=n[4]*c,f=n[3]*l,d=n[2]*f,h=n[1]*d;if(t.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+h+", "+d+", "+f+", "+l+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+c+", 1)));\n        "+ya(t)+"\n      }\n    ";var p=t.shapeInfo.flatOffset,m=t.shapeInfo.texShape,v=m[0],g=m[1];return g===h&&null==p?"\n      float "+i+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+d+", "+f+", "+l+", "+c+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+g+".0, "+v+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":g===c&&null==p?"\n      float "+i+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+n[1]*n[2]*n[3]*n[4]+",\n               "+n[2]*n[3]*n[4]+",\n               "+n[3]*n[4]+",\n               "+n[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+g+".0, "+v+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+i+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+h+" + col * "+d+" + depth * "+f+" +\n          depth2 * "+l+" + depth3 * "+c+" + depth4 + "+ga(r)+";\n      vec2 uv = uvFromFlat("+v+", "+g+", index);\n      return sampleTexture("+r+", uv);\n    }\n  "}(t);default:throw new Error(n.length+"-D input sampling is not yet supported")}}(e);var i=e.shapeInfo.logicalShape,a=t.logicalShape;return i.length<=a.length&&(r+=n?function(e,t){var n,r,i=e.name,a=i.charAt(0).toUpperCase()+i.slice(1),o="get"+a+"AtOutCoords",s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length,c=Si(e.shapeInfo.logicalShape,t.logicalShape),l=ba(u),f=u-s,d=["x","y","z","w","u","v"];n=0===s?"":u<2&&c.length>=1?"coords = 0;":c.map((function(e){return"coords."+d[e+f]+" = 0;"})).join("\n"),r=u<2&&s>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords."+d[t+f]})).join(", ");var h="return outputValue;",p=1===j(e.shapeInfo.logicalShape),m=1===j(t.logicalShape);if(1!==s||p||m){if(p&&!m)h=1===u?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(c.length){var v=s-2,g=s-1;c.indexOf(v)>-1&&c.indexOf(g)>-1?h="return vec4(outputValue.x);":c.indexOf(v)>-1?h="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":c.indexOf(g)>-1&&(h="return vec4(outputValue.xx, outputValue.zz);")}}else h="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+o+"() {\n      "+l+" coords = getOutputCoords();\n      "+n+"\n      vec4 outputValue = get"+a+"("+r+");\n      "+h+"\n    }\n  "}(e,t):function(e,t){var n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),i="get"+r+"AtOutCoords",a=t.texShape,o=e.shapeInfo.texShape,s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!e.shapeInfo.isUniform&&s===u&&null==e.shapeInfo.flatOffset&&M(o,a))return"\n      float "+i+"() {\n        return sampleTexture("+n+", resultUV);\n      }\n    ";var c=ba(u),l=Si(e.shapeInfo.logicalShape,t.logicalShape),f=u-s,d=["x","y","z","w","u","v"];return"\n    float "+i+"() {\n      "+c+" coords = getOutputCoords();\n      "+(0===s?"":u<2&&l.length>=1?"coords = 0;":l.map((function(e){return"coords."+d[e+f]+" = 0;"})).join("\n"))+"\n      return get"+r+"("+(u<2&&s>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords."+d[t+f]})).join(", "))+");\n    }\n  "}(e,t)),r}(e,t,r)})).join("\n"),c=t.texShape,l=ua(),f="\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+l.texture2D+"(textureSampler, uv).r;\n    }\n  ",d=function(e){return e.version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+e.varyingFs+" vec2 resultUV;\n    "+e.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    "+e.defineSpecialNaN+"\n    "+e.defineSpecialInf+"\n    "+e.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+ha+"\n    "+pa+"\n    "+ma+"\n  "}(l);return t.isPacked?(a=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return 1===n[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+n[1]+".0);\n      }\n    ":1===n[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+n[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      return 2 * (resTexRC.x * "+n[1]+" + resTexRC.y);\n    }\n  "}(0,t);case 2:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(M(e,t))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+n[0]+", "+n[1]+"));\n      }\n    ";var r=Math.ceil(e[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return n=e,r=t,i=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],o=(a=Math.ceil(n[2]/2))*Math.ceil(n[1]/2),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+i[0]+", "+i[1]+"));\n      int index = resTexRC.x * "+i[1]+" + resTexRC.y;\n\n      int b = index / "+o+";\n      index -= b * "+o+";\n\n      int r = 2 * (index / "+a+");\n      int c = imod(index, "+a+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";default:return function(e,t){for(var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[e.length-1]/2),i=r*Math.ceil(e[e.length-2]/2),a=i,o="",s="b, r, c",u=2;u<e.length-1;u++)o="\n      int b"+u+" = index / "+(a*=e[e.length-u-1])+";\n      index -= b"+u+" * "+a+";\n    "+o,s="b"+u+", "+s;return"\n    ivec"+e.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n\n      "+o+"\n\n      int b = index / "+i+";\n      index -= b * "+i+";\n\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec"+e.length+"("+s+");\n    }\n  "}(e,t)}var n,r,i,a,o}(t.logicalShape,c),o="\n    void setOutput(vec4 val) {\n      "+l.output+" = val;\n    }\n  "):(a=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){return 1===t[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+t[1]+".0);\n      }\n    ":1===t[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+t[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      return resTexRC.x * "+t[1]+" + resTexRC.y;\n    }\n  "}(0,t);case 2:return function(e,t){return M(e,t)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+t[0]+", "+t[1]+"));\n      }\n    ":1===e[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===e[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      int r = index / "+e[1]+";\n      int c = index - r * "+e[1]+";\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return n=t,r=ca(["r","c","d"],e),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      "+r+"\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(e,t){var n=ca(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      "+n+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(e,t);case 5:return function(e,t){var n=ca(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+t[0]+",\n                             "+t[1]+"));\n\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(e,t);case 6:return function(e,t){var n=ca(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(e,t);default:throw new Error(e.length+"-D output sampling is not yet supported")}var n,r}(t.logicalShape,c),o="\n    void setOutput(float val) {\n      "+l.output+" = vec4(val, 0, 0, 0);\n    }\n  "),r&&(d+=va),[d,f,o,s,a,u,n].join("\n")}var ha="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",pa="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",ma="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",va="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function ga(e){return"offset"+e}function ya(e){var t=e.name,n=j(e.shapeInfo.logicalShape);return n<2?"return "+t+";":"\n    for (int i = 0; i < "+n+"; i++) {\n      if (i == index) {\n        return "+t+"[i];\n      }\n    }\n  "}function ba(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank "+e+" is not yet supported")}function xa(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function wa(e,t){return t.map((function(t){return e[t]})).join(", ")}var _a=function(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Ai(t,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+e+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},ka="return a + b;",Ea="return a - b;",Sa="return a * b;",Ca="return (a < 0.) ? b * a : a;",Aa=function(e,t,n){this.variableNames=["A","B"],this.outputShape=Ai(t,n),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+e+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},Oa="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",Da=function(e,t,n,r){void 0===r&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Ai(t,n);var i=this.outputShape.length,a="";if(r)if(0===i||1===j(this.outputShape))a="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(a="\n          "+ba(i)+" coords = getOutputCoords();\n        ",1===i)a+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var o=sa("coords",i);a+="\n            bool nextRowOutOfBounds =\n              ("+o[i-2]+" + 1) >= "+this.outputShape[i-2]+";\n            bool nextColOutOfBounds =\n              ("+o[i-1]+" + 1) >= "+this.outputShape[i-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+e+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+a+"\n\n        setOutput(result);\n      }\n    "},Ta=function(){function e(e){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,i){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(i,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(i,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}(),ja=function(){function e(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,i){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(i,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(i,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}();function Ma(e,t,n){var r=e.indexOf(t);return e.map((function(e,t){return t===r?e+" - "+n:e})).join()}var Fa=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var i=e.padInfo.top,a=e.padInfo.left,o=e.strideHeight,s=e.strideWidth,u=e.dilationHeight,c=e.dilationWidth,l=e.filterHeight,f=e.filterWidth,d=4*Math.floor(e.inChannels/4),h=e.inChannels%4,p="channelsLast"===e.dataFormat,m=p?1:2,v=p?2:3,g=p?3:1,y="",b="";n&&(y=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",b="result = activation(result);");var x=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+y+"\n\n      const ivec2 strides = ivec2("+o+", "+s+");\n      const ivec2 pads = ivec2("+i+", "+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords["+g+"];\n\n        ivec2 xRCCorner =\n            ivec2(coords["+m+"], coords["+v+"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+l+"; wR++) {\n          int xR = xRCorner + wR * "+u+";\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+f+"; wC++) {\n            int xC = xCCorner + wC * "+c+";\n\n            if (xC < 0 || xC >= "+e.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+d+"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if ("+p+") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if ("+(1===h)+") {\n\n              if ("+p+") {\n                dotProd +=\n                    getX(batch, xR, xC, "+d+") *\n                    getW(wR, wC, "+d+", d2);\n              } else {\n                dotProd +=\n                    getX(batch, "+d+", xR, xC) *\n                    getW(wR, wC, "+d+", d2);\n              }\n\n            } else if ("+(2===h)+") {\n              vec2 wValues = vec2(\n                getW(wR, wC, "+d+", d2),\n                getW(wR, wC, "+d+" + 1, d2)\n              );\n\n              if ("+p+") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, "+d+"),\n                  getX(batch, xR, xC, "+d+" + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, "+d+", xR, xC),\n                  getX(batch, "+d+" + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if ("+(3===h)+") {\n              vec3 wValues = vec3(\n                getW(wR, wC, "+d+", d2),\n                getW(wR, wC, "+d+" + 1, d2),\n                getW(wR, wC, "+d+" + 2, d2)\n              );\n\n              if ("+p+") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, "+d+"),\n                  getX(batch, xR, xC, "+d+" + 1),\n                  getX(batch, xR, xC, "+d+" + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, "+d+", xR, xC),\n                  getX(batch, "+d+" + 1, xR, xC),\n                  getX(batch, "+d+" + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        "+x+"\n        "+b+"\n        setOutput(result);\n      }\n    "},Ia=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var i=e.inHeight,a=e.inWidth,o=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,c=e.strideWidth,l=e.dilationHeight,f=e.dilationWidth,d=e.filterHeight,h=e.filterWidth,p=e.outChannels/e.inChannels,m="",v="";n&&(m=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",v="result = activation(result);");var g=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+m+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+o+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+p+";\n        int q = d2 - d1 * "+p+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+d+"; wR++) {\n          int xR = xRCorner + wR * "+l+";\n\n          if (xR < 0 || xR >= "+i+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+h+"; wC++) {\n            int xC = xCCorner + wC * "+f+";\n\n            if (xC < 0 || xC >= "+a+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        "+g+"\n        "+v+"\n        setOutput(result);\n      }\n    "},Na=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.outShape;for(var i=e.inHeight,a=e.inWidth,o=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,c=e.strideWidth,l=e.dilationHeight,f=e.dilationWidth,d=e.filterHeight,h=e.filterWidth,p=h,m="int xR; int xC; int xCOffset;",v=0;v<d;v++)for(var g=0;g<h;g++)m+="\n          vec4 xTexelR"+v+"C"+2*g+" = vec4(0.);\n          vec4 wR"+v+"C"+g+" = vec4(0.);\n          vec4 xR"+v+"C"+g+" = vec4(0.);";for(v=0;v<d;v++)for(var y=0;y<p;y++){if(m+="\n          xR = xRCorner + "+v*l+";\n          xC = xCCorner + "+(g=2*y)*f+";\n        ",1===c){if(g<h&&(m+=s%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+i+" && xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+v+"C"+g+" = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+a+") {\n                    xTexelR"+v+"C"+g+".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR"+v+"C"+g+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+i+" && xCOffset >= 0 && xCOffset < "+a+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+a+") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR"+v+"C"+g+" = vec4(previous.zw, xTexelR"+v+"C"+g+".xy);\n                } else {\n                  xR"+v+"C"+g+" = vec4(0, 0, xTexelR"+v+"C"+g+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+i+" && xC >= 0 && xC < "+a+") {\n                  xTexelR"+v+"C"+g+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+v+"C"+g+" = vec4(0.);\n                }\n\n                xR"+v+"C"+g+" = xTexelR"+v+"C"+g+";\n              ",g+1<h)){var b=s%2==0?S(f):f;f%2==0&&s%2==1||f%2!=0&&s%2!=1?(m+="\n                  xCOffset = xC + "+s%2+" + "+b+";\n\n                  if(xR >= 0 && xR < "+i+" &&\n                    xCOffset >= 0 && xCOffset < "+a+") {\n                    xTexelR"+v+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",f>1&&(m+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+i+" &&\n                      xCOffset >= 0 && xCOffset < "+a+") {\n                      xTexelR"+v+"C"+g+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+v+"C"+g+" = vec4(0.);\n                    }\n                  "),m+="\n                  xR"+v+"C"+(g+1)+" = vec4(\n                    xTexelR"+v+"C"+g+".zw, xTexelR"+v+"C"+(g+2)+".xy);\n                "):m+="\n                  xCOffset = xC + "+b+";\n\n                  if(xR >= 0 && xR < "+i+" &&\n                    xCOffset >= 0 && xCOffset < "+a+") {\n                    xTexelR"+v+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+v+"C"+(g+1)+" = xTexelR"+v+"C"+(g+2)+";\n                "}}else g<h&&(m+="\n              if(xR >= 0 && xR < "+i+") {\n            ",s%2==1?(m+="\n                xCOffset = xC + 1 - "+c+";\n                if(xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+v+"C"+g+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+v+"C"+g+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+a+") {\n                  xTexelR"+v+"C"+(g+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+v+"C"+(g+2)+" = vec4(0.);\n                }\n\n                xR"+v+"C"+g+" = vec4(\n                  xTexelR"+v+"C"+g+".zw, xTexelR"+v+"C"+(g+2)+".zw);\n              ",g+1<h&&(m+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+c+";\n                  if(xCOffset >= 0 && xCOffset < "+a+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+v+"C"+(g+1)+" = vec4(xTexelR"+v+"C"+(g+2)+".xy, final.xy);\n                ")):(m+="\n                if(xC >= 0 && xC < "+a+") {\n                  xTexelR"+v+"C"+g+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+v+"C"+g+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+c+";\n                if(xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+v+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+v+"C"+(g+2)+" = vec4(0.);\n                }\n\n                xR"+v+"C"+g+" = vec4(\n                  xTexelR"+v+"C"+g+".xy, xTexelR"+v+"C"+(g+2)+".xy);\n              ",g+1<h&&(m+="\n                  xR"+v+"C"+(g+1)+" = vec4(\n                    xTexelR"+v+"C"+g+".zw, xTexelR"+v+"C"+(g+2)+".zw);\n                ")),m+="}");g<h&&(m+="\n            vec4 wTexelR"+v+"C"+g+" = getW("+v+", "+g+", d1, q);\n            wR"+v+"C"+g+" = vec4(wTexelR"+v+"C"+g+".xz, wTexelR"+v+"C"+g+".xz);\n          ",g+1<h&&(m+="\n              vec4 wTexelR"+v+"C"+(g+1)+" = getW("+v+", "+(g+1)+", d1, q);\n              wR"+v+"C"+(g+1)+" =\n                vec4(wTexelR"+v+"C"+(g+1)+".xz, wTexelR"+v+"C"+(g+1)+".xz);"))}for(v=0;v<d;v++)for(g=0;g<h;g++)m+="dotProd += xR"+v+"C"+g+" * wR"+v+"C"+g+";";var x="",w="";n&&(x=r?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"vec4 activation(vec4 x) {\n          "+n+"\n        }",w="result = activation(result);");var _=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+x+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+o+", "+s+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        "+m+"\n\n        vec4 result = dotProd;\n        "+_+"\n        "+w+"\n        setOutput(result);\n      }\n    "};function Ra(e,t){if(1===e)return""+t;if(2===e)return t+".y";if(3===e)return t+".z";if(4===e)return t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}var Pa=function(){function e(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+t+";\n      int offset_h = imod(h, "+t+");\n      int in_w = w / "+t+";\n      int offset_w = imod(w, "+t+");\n      int offset_d = (offset_h * "+t+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return e.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},e.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},e.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},e.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},e.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},e}(),Ba=function(e,t,n){this.variableNames=["real","imag"];var r=t[1];this.outputShape=t;var i=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,a=n?r+".0":"1.0";this.userCode="\n      const float exponentMultiplier = "+i+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+e+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+a+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},La=function(){function e(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.valueLoc&&(t.valueLoc=n.getUniformLocationNoThrow(r,"value")),n.gl.uniform1f(t.valueLoc,e)}},e}();function za(e,t){var n=ua();return ut(e,t,n.version+"\n    precision highp float;\n    "+n.attribute+" vec3 clipSpacePos;\n    "+n.attribute+" vec2 uv;\n    "+n.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function Ua(e,t){return vt(e,t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function Wa(e,t){return gt(e,t,new Uint16Array([0,1,2,2,1,3]))}function Va(e,t,n,r,i,a,o){bt(n,r);var s=yt(e,t),u=e.TEXTURE_2D;return nt(e,t,(function(){return e.bindTexture(u,s)})),nt(e,t,(function(){return e.texParameteri(u,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)})),nt(e,t,(function(){return e.texParameteri(u,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)})),nt(e,t,(function(){return e.texParameteri(u,e.TEXTURE_MIN_FILTER,e.NEAREST)})),nt(e,t,(function(){return e.texParameteri(u,e.TEXTURE_MAG_FILTER,e.NEAREST)})),nt(e,t,(function(){return e.texImage2D(u,0,i,n,r,0,a,o,null)})),nt(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)})),s}function Ga(e,t,n,r,i){var a=Ze(n,r);return Va(e,t,a[0],a[1],i.internalFormatFloat,i.textureFormatFloat,e.FLOAT)}function qa(e,t,n,r,i){var a=Ze(n,r);return Va(e,t,a[0],a[1],i.internalFormatHalfFloat,i.textureFormatFloat,i.textureTypeHalfFloat)}function Ha(e,t,n,r,i){var a=Ze(n,r);return Va(e,t,a[0],a[1],e.RGBA,e.RGBA,e.UNSIGNED_BYTE)}function Xa(e,t,n,r,i){var a=et(n,r);return Va(e,t,a[0],a[1],i.internalFormatPackedFloat,e.RGBA,e.FLOAT)}function Ka(e,t,n,r,i){var a=et(n,r);return Va(e,t,a[0],a[1],i.internalFormatPackedHalfFloat,e.RGBA,i.textureTypeHalfFloat)}function Ya(e,t,n,r){return nt(e,t,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),wt(e,t,n,"clipSpacePos",r,3,20,0)&&wt(e,t,n,"uv",r,2,20,12)}function $a(e,t,n,r,i,a,o){var s,u,c;nt(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,n)})),a instanceof Uint8Array?(s=new Uint8Array(r*i*4),u=e.UNSIGNED_BYTE,c=e.RGBA):(s=new Float32Array(r*i*4),u=e.FLOAT,c=o.internalFormatPackedFloat),s.set(a),nt(e,t,(function(){return e.texImage2D(e.TEXTURE_2D,0,c,r,i,0,e.RGBA,u,s)})),nt(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function Ja(e,t,n,r){nt(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,n)})),r.data instanceof Uint8Array?nt(e,t,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r.width,r.height,0,e.RGBA,e.UNSIGNED_BYTE,r.data)})):nt(e,t,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)})),nt(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function Za(e,t,n,r,i){var a=e.createBuffer();nt(e,t,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,a)}));var o=16*n*r;return nt(e,t,(function(){return e.bufferData(e.PIXEL_PACK_BUFFER,o,e.STREAM_READ)})),nt(e,t,(function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,0)})),nt(e,t,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)})),a}function Qa(e,t,n){var r=e,i=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}function eo(e,t,n,r,i){var a=Ze(n,r),o=a[0],s=a[1],u=new Uint8Array(n*r*4);return nt(e,t,(function(){return e.readPixels(0,0,o,s,i.downloadTextureFormat,e.UNSIGNED_BYTE,u)})),new Float32Array(u.buffer)}function to(e,t,n,r,i,a,o,s){var u=e,c=new Float32Array(function(e,t){var n=et(a,o);return n[0]*n[1]*4}());return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function no(e,t,n,r){var i=new Float32Array(n*r*4);return nt(e,t,(function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,i)})),i}var ro=Object.freeze({createVertexShader:za,createVertexBuffer:Ua,createIndexBuffer:Wa,createFloat32MatrixTexture:Ga,createFloat16MatrixTexture:qa,createUnsignedBytesMatrixTexture:Ha,createPackedMatrixTexture:Xa,createFloat16PackedMatrixTexture:Ka,bindVertexProgramAttributeStreams:Ya,uploadDenseMatrixToTexture:$a,uploadPixelDataToTexture:Ja,createBufferFromOutputTexture:Za,downloadFloat32MatrixFromBuffer:Qa,downloadByteEncodedFloatMatrixFromOutputTexture:eo,downloadPackedMatrixFromBuffer:to,downloadMatrixFromPackedOutputTexture:no}),io=function(){function e(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=f().getNumber("WEBGL_VERSION");null!=e?(this.gl=e,$e(t,e)):this.gl=Je(t);var n="WEBGL_color_buffer_float";if(1===f().getNumber("WEBGL_VERSION")){if(this.textureFloatExtension=st(this.gl,this.debug,"OES_texture_float"),Ut(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=st(this.gl,this.debug,"OES_texture_half_float");else if(f().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),Ut(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=st(this.gl,this.debug,"EXT_color_buffer_half_float");else if(f().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",Ut(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!Ut(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=Ua(this.gl,this.debug),this.indexBuffer=Wa(this.gl,this.debug),this.framebuffer=xt(this.gl,this.debug),this.textureConfig=tt(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(e.prototype,"debug",{get:function(){return f().getBool("DEBUG")},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;nt(t,this.debug,(function(){return t.finish()})),nt(t,this.debug,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),nt(t,this.debug,(function(){return t.deleteFramebuffer(e.framebuffer)})),nt(t,this.debug,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),nt(t,this.debug,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),nt(t,this.debug,(function(){return t.deleteBuffer(e.indexBuffer)})),this.disposed=!0}},e.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),Ga(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),qa(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),Ha(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),Ja(this.gl,this.debug,e,t)},e.prototype.uploadDenseMatrixToTexture=function(e,t,n,r){this.throwIfDisposed(),$a(this.gl,this.debug,e,t,n,r,this.textureConfig)},e.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),Ka(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),Xa(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(At(this.gl,this.debug,this.framebuffer),this.outputTexture=null),nt(this.gl,this.debug,(function(){return t.gl.deleteTexture(e)}))},e.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return eo(r.gl,r.debug,t,n,r.textureConfig)}))},e.prototype.downloadPackedMatrixFromBuffer=function(e,t,n,r,i,a){return to(this.gl,e,0,0,0,i,a,this.textureConfig)},e.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return Qa(this.gl,e,t)},e.prototype.createBufferFromTexture=function(e,t,n){this.bindTextureToFrameBuffer(e);var r=Za(this.gl,this.debug,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r},e.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},e.prototype.createFence=function(e){var t,n,r=this;if(f().getBool("WEBGL_FENCE_API_ENABLED")){var i=e,a=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=i.clientWaitSync(a,0,0);return e===i.ALREADY_SIGNALED||e===i.CONDITION_SATISFIED},t=a}else f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}},e.prototype.downloadMatrixFromPackedTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return no(r.gl,r.debug,t,n)}))},e.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,n=ct(t,this.debug,e),r=za(t,this.debug),i=ht(t,this.debug);return nt(t,this.debug,(function(){return t.attachShader(i,r)})),nt(t,this.debug,(function(){return t.attachShader(i,n)})),pt(t,this.debug,i),this.debug&&mt(t,this.debug,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=Ya(t,this.debug,this.program,this.vertexBuffer)),i},e.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&nt(this.gl,this.debug,(function(){return t.gl.deleteProgram(e)}))},e.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&mt(this.gl,this.debug,this.program),nt(this.gl,this.debug,(function(){return t.gl.useProgram(e)}))},e.prototype.getUniformLocation=function(e,t,n){return void 0===n&&(n=!0),this.throwIfDisposed(),n?kt(this.gl,this.debug,e,t):Et(this.gl,e,t)},e.prototype.getAttributeLocation=function(e,t){var n=this;return this.throwIfDisposed(),nt(this.gl,this.debug,(function(){return n.gl.getAttribLocation(e,t)}))},e.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},e.prototype.setInputMatrixTexture=function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),St(this.gl,this.debug,this.program,e,t,n)},e.prototype.setOutputMatrixTexture=function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)},e.prototype.setOutputPackedMatrixTexture=function(e,t,n){this.throwIfDisposed();var r=et(t,n),i=r[0],a=r[1];this.setOutputMatrixTextureDriver(e,i,a)},e.prototype.setOutputMatrixWriteRegion=function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)},e.prototype.setOutputPackedMatrixWriteRegion=function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},e.prototype.debugValidate=function(){null!=this.program&&mt(this.gl,this.debug,this.program),Ot(this.gl)},e.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),nt(e,this.debug,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))},e.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),nt(this.gl,this.debug,(function(){return e.gl.finish()}))},e.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=st(this.gl,this.debug,2===f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},e.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},e.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},e.prototype.beginQuery=function(){if(2===f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),i=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,i),i},e.prototype.endQuery=function(){if(2!==f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}},e.prototype.waitForQueryAndGetTime=function(e){return u(this,void 0,void 0,(function(){var t=this;return c(this,(function(n){switch(n.label){case 0:return[4,P((function(){return t.disposed||t.isQueryAvailable(e,f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}))];case 1:return n.sent(),[2,this.getQueryTime(e,f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}}))}))},e.prototype.getQueryTime=function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6},e.prototype.isQueryAvailable=function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint}return i=(r=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,r.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint},e.prototype.pollFence=function(e){var t=this;return new Promise((function(n){t.addItemToPoll((function(){return e.isFencePassed()}),(function(){return n()}))}))},e.prototype.pollItems=function(){for(var e=function(e){for(var t=0;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map((function(e){return e.isDoneFn}))),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},e.prototype.addItemToPoll=function(e,t){var n=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||P((function(){return n.pollItems(),0===n.itemsToPoll.length}))},e.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),Ct(this.gl,this.debug,e,this.framebuffer),this.debug&&Ot(this.gl)},e.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(Ct(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Ot(this.gl)):At(this.gl,this.debug,this.framebuffer)},e.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n},e.prototype.setOutputMatrixTextureDriver=function(e,t,n){this.throwIfDisposed();var r=this.gl;Ct(r,this.debug,e,this.framebuffer),this.debug&&Ot(r),this.outputTexture=e,nt(r,this.debug,(function(){return r.viewport(0,0,t,n)})),nt(r,this.debug,(function(){return r.scissor(0,0,t,n)}))},e.prototype.setOutputMatrixWriteRegionDriver=function(e,t,n,r){var i=this;this.throwIfDisposed(),nt(this.gl,this.debug,(function(){return i.gl.scissor(e,t,n,r)}))},e.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},e.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},e}();function ao(e,t){if(e.length!==t.length)throw Error("Binary was compiled with "+e.length+" inputs, but was executed with "+t.length+" inputs");e.forEach((function(e,n){var r=e.logicalShape,i=t[n],a=i.shape;if(!M(r,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+r+" and "+a+" must match");if(!e.isUniform||!i.isUniform){var o=e.texShape,s=i.isUniform?null:i.texData.texShape;if(!M(o,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+o+" and "+s+" must match")}}))}var oo=function(e,t,n,r,i,a,o){void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===i&&(i=!1),void 0===a&&(a=null),void 0===o&&(o=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;var s=n?e[1]:e[2],u=Math.ceil(s/2),c=n?"i * 2, rc.y":"rc.y, i * 2",l=r?"rc.z, i * 2":"i * 2, rc.z",f=n?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],d=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],h="",p="";a&&(h=o?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+a+"\n        }":"vec4 activation(vec4 x) {\n          "+a+"\n        }",p="result = activation(result);");var m=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+h+"\n\n      const float sharedDimension = "+u+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+u+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+c+");\n          vec4 b = getMatrixB(rc.x, "+l+");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += ("+f[0]+" * "+d[0]+");\n          result += ("+f[1]+" * "+d[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+m+"\n\n        "+p+"\n\n        setOutput(result);\n      }\n    "},so=function(){function e(e,t,n){this.variableNames=["probs"],this.outputShape=[e,n],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(t-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(t-1)+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.seedLoc&&(t.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(t.seedLoc,e)}},e}(),uo=function(e,t,n){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,i=e.strideHeight,a=e.strideWidth,o=e.dilationHeight,s=e.dilationWidth,u=e.effectiveFilterHeight,c=e.effectiveFilterWidth,l=e.padInfo.top,f=e.padInfo.left;this.outputShape=e.outShape;var d="avg"===t,h="0.0";if(d||(h="-1.0 / 1e-20"),n)this.userCode="\n        const ivec2 strides = ivec2("+i+", "+a+");\n        const ivec2 pads = ivec2("+l+", "+f+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+o+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+c+";\n                wC += "+s+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+c+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var p=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(p="avgValue / count");var m=4*Math.floor(r/4),v=r%4,g="\n      if ("+d+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+i+", "+a+");\n      const ivec2 pads = ivec2("+l+", "+f+");\n      const float initializationValue = "+h+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+h+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+u+";\n            wR += "+o+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+m+"; wC += 4) {\n            int xC = xCCorner + wC * "+s+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              getValue(batch, xR, xC + 3 * "+s+", d)\n            );\n\n            "+g+"\n          }\n\n          int xC = xCCorner + "+m+";\n          if ("+(1===v)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+g+"\n          } else if ("+(2===v)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+g+"\n          } else if ("+(3===v)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              initializationValue\n            );\n\n            "+g+"\n          }\n        }\n        setOutput("+p+");\n      }\n    "}},co=function(e,t,n){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,i=e.strideDepth,a=e.strideHeight,o=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,l=e.effectiveFilterDepth,f=e.effectiveFilterHeight,d=e.effectiveFilterWidth,h=e.padInfo.front,p=e.padInfo.top,m=e.padInfo.left;this.outputShape=e.outShape;var v="avg"===t,g="0.0";if(v||(g="-1.0 / 1e-20"),n)this.userCode="\n        const ivec3 strides =\n            ivec3("+i+", "+a+", "+o+");\n        const ivec3 pads = ivec3("+h+", "+p+", "+m+");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < "+l+";\n              wD += "+s+") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= "+e.inDepth+") {\n              continue;\n            }\n\n            for (int wR = 0; wR < "+f+";\n                wR += "+u+") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= "+e.inHeight+") {\n                continue;\n              }\n\n              for (int wC = 0; wC < "+d+";\n                  wC += "+c+") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= "+e.inWidth+") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition =\n                      wD * "+f+" * "+d+" +\n                      wR * "+d+" + wC;;\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var y=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(y="avgValue / count");var b=4*Math.floor(r/4),x=r%4,w="\n      if ("+v+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec3 strides =\n        ivec3("+i+", "+a+", "+o+");\n      const ivec3 pads = ivec3("+h+", "+p+", "+m+");\n      const float initializationValue = "+g+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+g+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < "+l+";\n            wD += "+s+") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= "+e.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+f+";\n            wR += "+u+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+b+"; wC += 4) {\n              int xC = xCCorner + wC * "+c+";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+c+", ch),\n                getValue(batch, xD, xR, xC + 3 * "+c+", ch)\n              );\n\n              "+w+"\n            }\n\n            int xC = xCCorner + "+b+";\n            if ("+(1===x)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              "+w+"\n            } else if ("+(2===x)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              "+w+"\n            } else if ("+(3===x)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+c+", ch),\n                initializationValue\n              );\n\n              "+w+"\n            }\n          }\n          setOutput("+y+");\n        }\n      }\n    "}},lo=function(e,t,n,r,i,a,o){void 0===o&&(o=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=a;var s=ba(i.length),u=ba(a.length),c="";1===n?c="i":2===n&&(c="i, j");var l="getIndices("+c+")",f="";1===r?f="i":2===r&&(f="i, coords[1]");var d="getUpdates("+f+")",h=t>1?"strides[j]":"strides";this.userCode="\n        "+s+" strides = "+s+"("+i+");\n\n        void main() {\n          "+u+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+e+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+t+"; j++) {\n              int index = round("+l+");\n              flattenedIndex += index * "+h+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += "+d+";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},fo=function(){function e(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,n=ba(this.rank),r="uniform int start["+this.rank+"];",i=function(e){if(1===e)return"sourceLoc";if(e<=6)return ho.slice(0,e).map((function(e){return"sourceLoc."+e})).join(",");throw Error("Slicing for rank "+e+" is not yet supported")}(this.rank);t="\n        "+n+" sourceLoc;\n        "+n+" coords = getOutputCoords();\n        "+e.map((function(e,t){return"sourceLoc."+ho[t]+" = start["+t+"] + coords."+ho[t]+";"})).join("\n")+"\n      ",this.userCode="\n      "+r+"\n      void main() {\n        "+t+"\n        setOutput(getSource("+i+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),ho=["x","y","z","w","u","v"],po=function(){function e(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var t=ba(this.rank),n=sa("coords",this.rank),r=sa("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":"vec2("+r.slice(-2).join()+")",a="getChannel(getSource("+r.join()+"), "+i+")",o="\n      result.x = "+a+";\n      if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n        ++"+r[this.rank-1]+";\n        result.y = "+a+";\n        --"+r[this.rank-1]+";\n      }\n    ",s=1===this.rank?"":"\n      --"+n[this.rank-1]+";\n      if (++"+n[this.rank-2]+" < "+e[this.rank-2]+") {\n        ++"+r[this.rank-2]+";\n        result.z = "+a+";\n        if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n          ++"+r[this.rank-1]+";\n          result.w = "+a+";\n        }\n      }\n    ",u=this.rank<=4?"sourceLoc = coords +\n            "+t+"("+e.map((function(e,t){return"start["+t+"]"})).join()+");":e.map((function(e,t){return r[t]+" = "+n[t]+" + start["+t+"];"})).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+t+" coords = getOutputCoords();\n        "+t+" sourceLoc;\n        "+u+"\n        vec4 result = vec4(0.);\n        "+o+"\n        "+s+"\n        setOutput(result);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),mo=function(){function e(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return e.prototype.acquireTexture=function(e,t,n){var r,i=vo(t,n),a=go(e,i,n);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var o=this.freeTextures[a].shift();return this.usedTextures[a].push(o),o}return this.numUsedTextures++,this.log(),i===Xe.PACKED_2X2_FLOAT32?r=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):i===Xe.PACKED_2X2_FLOAT16?r=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):i===Xe.UNPACKED_FLOAT32?r=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):i===Xe.UNPACKED_FLOAT16?r=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):i===Xe.PACKED_4X1_UNSIGNED_BYTE&&(r=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(r),r},e.prototype.releaseTexture=function(e,t,n,r){if(null!=this.freeTextures){var i=go(t,vo(n,r),r);i in this.freeTextures||(this.freeTextures[i]=[]),this.freeTextures[i].push(e),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[i],o=a.indexOf(e);if(o<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(o,1),this.log()}},e.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},e.prototype.getNumUsedTextures=function(){return this.numUsedTextures},e.prototype.getNumFreeTextures=function(){return this.numFreeTextures},e.prototype.dispose=function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t)}));for(var t in this.usedTextures)this.usedTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},e}();function vo(e,t){if(e===He.UPLOAD)return Xe.PACKED_2X2_FLOAT32;if(e===He.RENDER||null==e)return function(e){return f().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?Xe.PACKED_2X2_FLOAT32:Xe.UNPACKED_FLOAT32:e?Xe.PACKED_2X2_FLOAT16:Xe.UNPACKED_FLOAT16}(t);if(e===He.DOWNLOAD||e===He.PIXELS)return Xe.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+e)}function go(e,t,n){return e[0]+"_"+e[1]+"_"+t+"_"+n}var yo=1.7580993408473768,bo=1.0507009873554805,xo=function(e,t){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      float unaryOperation(float x) {\n        "+t+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},wo="if (isnan(x)) return x;",_o="return x;",ko="return abs(x);",Eo=wo+"\n  return (x < 0.0) ? 0.0 : x;\n",So=wo+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",Co="return (x >= 0.0) ? x : (exp(x) - 1.0);",Ao="return -x;",Oo="return ceil(x);",Do="return floor(x);",To="return exp(x);",jo="return exp(x) - 1.0;",Mo="return x;",Fo="return x;",Io="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",No="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Ro="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",Po=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+t+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},Bo={};function Lo(e,t){if(void 0===t&&(t=!1),"linear"===e)return t?Fo:_o;if("relu"===e)return t?Io:Eo;if("elu"===e)return t?Ro:Co;if("relu6"===e)return t?No:So;if("prelu"===e)return t?Oa:Ca;throw new Error("Activation "+e+" has not been implemented for the WebGL backend.")}var zo=600,Uo=function(e){function t(t){var n,r=e.call(this)||this;if(r.pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.warnedAboutMemory=!1,r.pendingDeletes=0,r.disposed=!1,!f().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==t){var i=Je(f().getNumber("WEBGL_VERSION"));r.binaryCache=((n=f().getNumber("WEBGL_VERSION"))in Bo||(Bo[n]={}),Bo[n]),r.gpgpu=new io(i),r.canvas=i.canvas,r.gpgpuCreatedLocally=!0}else r.gpgpu=t,r.binaryCache={},r.gpgpuCreatedLocally=!1,r.canvas=t.gl.canvas;return r.textureManager=new mo(r.gpgpu),r.numMBBeforeWarning=null==f().global.screen?1024:f().global.screen.height*f().global.screen.width*window.devicePixelRatio*zo/1024/1024,r.texData=new _i(r,We),r}return s(t,e),t.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},t.prototype.write=function(e,t,n){if(f().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:He.UPLOAD}),r},t.prototype.move=function(e,t,n,r){if(f().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:He.UPLOAD})},t.prototype.readSync=function(e){var t=this.texData.get(e),n=t.values,r=t.dtype,i=t.complexTensors,a=t.slice,o=t.shape,s=t.isPacked;if(null!=a){var u;u=s?new Po(o,Mo):new xo(o,Mo);var c=this.runWebGLProgram(u,[{dataId:e,shape:o,dtype:r}],r),l=this.readSync(c.dataId);return this.disposeData(c.dataId),l}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;var f,d,h=null!=this.activeTimers;return h&&(f=oe()),d="complex64"===r?Gi(i.real.dataSync(),i.imag.dataSync()):this.getValuesFromTexture(e),h&&(this.downloadWaitMs+=oe()-f),this.convertAndCacheOnCPU(e,d)},t.prototype.read=function(e){return u(this,void 0,void 0,(function(){var t,n,r,i,a,o,s,u,l,d,h,p,m,v,g,y,b,x,w,_,k,E;return c(this,(function(c){switch(c.label){case 0:if(this.pendingRead.has(e))return t=this.pendingRead.get(e),[2,new Promise((function(e){return t.push(e)}))];if(n=this.texData.get(e),r=n.values,i=n.shape,a=n.slice,o=n.dtype,s=n.complexTensors,u=n.isPacked,null!=a)return l=void 0,l=u?new Po(i,Mo):new xo(i,Mo),d=this.runWebGLProgram(l,[{dataId:e,shape:i,dtype:o}],o),h=this.read(d.dataId),this.disposeData(d.dataId),[2,h];if(null!=r)return[2,this.convertAndCacheOnCPU(e)];if(!f().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===f().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return p=null,"complex64"!==o&&f().get("WEBGL_BUFFER_SUPPORTED")&&(m=this.decode(e),v=this.texData.get(m.dataId),p=(E=this.gpgpu).createBufferFromTexture.apply(E,[v.texture].concat(Qe(i)))),this.pendingRead.set(e,[]),"complex64"===o?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:c.sent(),c.label=2;case 2:return"complex64"!==o?[3,4]:[4,Promise.all([s.real.data(),s.imag.data()])];case 3:return y=c.sent(),b=y[0],x=y[1],g=Gi(b,x),[3,5];case 4:null==p?g=this.getValuesFromTexture(e):(w=j(i),g=this.gpgpu.downloadFloat32MatrixFromBuffer(p,w)),c.label=5;case 5:return null!=m&&this.disposeData(m.dataId),_=this.convertAndCacheOnCPU(e,g),k=this.pendingRead.get(e),this.pendingRead.delete(e),k.forEach((function(e){return e(_)})),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e),this.pendingDeletes--),[2,_]}}))}))},t.prototype.checkNumericalProblems=function(e){if(null!=e)for(var t=0;t<e.length;t++){var n=e[t];if(!at(n)){if(f().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value "+n+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value "+n+" cannot be represented on this device.")}}},t.prototype.getValuesFromTexture=function(e){var t,n=this.texData.get(e),r=n.shape,i=n.dtype,a=n.isPacked,o=j(r);if(f().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var s=this.decode(e),u=this.texData.get(s.dataId),c=(t=this.gpgpu).downloadMatrixFromPackedTexture.apply(t,[u.texture].concat(Qe(r))).subarray(0,o);return this.disposeData(s.dataId),c}var l=f().getBool("WEBGL_PACK")&&!0===a,d=l?It(r):r,h=l?new function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=He.DOWNLOAD;var t=ua();this.outputShape=e,this.userCode="\n      "+fa+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+t.output+" = encode_float(x);\n      }\n    "}(d):new function(e){this.variableNames=["A"],this.outTexUsage=He.DOWNLOAD;var t=ua();this.outputShape=e,this.userCode="\n      "+fa+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+t.output+" = encode_float(x);\n      }\n    "}(d),p=this.runWebGLProgram(h,[{shape:d,dtype:i,dataId:e}],"float32"),m=this.texData.get(p.dataId),v=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(m.texture,m.texShape[0],m.texShape[1]).subarray(0,o);return this.disposeData(p.dataId),v},t.prototype.time=function(e){return u(this,void 0,void 0,(function(){var t,n,r,i,a,o,s;return c(this,(function(u){switch(u.label){case 0:return t=this.activeTimers,n=[],r=!1,null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,e(),i=T(this.activeTimers.map((function(e){return e.query}))).filter((function(e){return null!=e})),a=T(this.activeTimers.map((function(e){return e.name}))).filter((function(e){return null!=e})),this.activeTimers=t,r&&(this.programTimersStack=null),o={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(i)]:[3,2];case 1:return s=u.sent(),o.kernelMs=C(s),o.getExtraProfileInfo=function(){return s.map((function(e,t){return{name:a[t],ms:e}})).map((function(e){return e.name+": "+e.ms})).join(", ")},[3,3];case 2:o.kernelMs={error:"WebGL query timers are not supported in this environment."},u.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,o]}}))}))},t.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},t.prototype.startTimer=function(){return f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:oe(),endMs:null}},t.prototype.endTimer=function(e){return f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=oe(),e)},t.prototype.getQueryTime=function(e){return u(this,void 0,void 0,(function(){var t;return c(this,(function(n){return f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(t=e).endMs-t.startMs]}))}))},t.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(this.texData.has(e)){this.releaseGPUData(e);var t=this.texData.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.texData.delete(e)}}},t.prototype.releaseGPUData=function(e){var t=this.texData.get(e),n=t.texture,r=t.dtype,i=t.texShape,a=t.usage,o=t.isPacked,s=t.slice,u=s&&s.origDataId||e,c=this.dataRefCount.get(u);c>1?this.dataRefCount.set(u,c-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(i,r),this.textureManager.releaseTexture(n,i,a,o)));var l=this.texData.get(e);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null},t.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},t.prototype.getDataInfo=function(e){return this.texData.get(e)},t.prototype.getCPUBackend=function(){return f().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=We.findBackend("cpu")),this.cpuBackend):null},t.prototype.shouldExecuteOnCPU=function(e,t){var n=this;return void 0===t&&(t=128),null!=this.getCPUBackend()&&e.every((function(e){return null==n.texData.get(e.dataId).texture&&e.size<t}))},t.prototype.getGPGPUContext=function(){return this.gpgpu},t.prototype.complex=function(e,t){var n=this.makeOutput(e.shape,"complex64");return this.texData.get(n.dataId).complexTensors={real:We.keep(e.clone()),imag:We.keep(t.clone())},n},t.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,t,n){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,t,n);if(0===j(n))return Rn([],n,e.dtype);var r=this.texData.get(e.dataId).isPacked,i=li(e.shape,t,n);if(r||!i){var a=f().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new po(n):new fo(n),o=a.getCustomSetupFunc(t);return this.compileAndRun(a,[e],null,o)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,t,n)},t.prototype.shallowSlice=function(e,t,n){var r=this.texData.get(e.dataId),i=this.makeOutput(n,e.dtype),a=this.texData.get(i.dataId);Object.assign(a,r),a.shape=n,a.dtype=e.dtype;var o=fi(t,e.strides);r.slice&&(o+=r.slice.flatOffset),a.slice={flatOffset:o,origDataId:r.slice&&r.slice.origDataId||e.dataId};var s=this.dataRefCount.get(a.slice.origDataId)||1;return this.dataRefCount.set(a.slice.origDataId,s+1),i},t.prototype.stridedSlice=function(e,t,n,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,t,n,r);var i=si(t,n,r);if(i.some((function(e){return 0===e})))return Rn([],i);var a=new function(e,t,n){this.variableNames=["x"],this.outputShape=n;var r=n.length,i=ba(n.length),a=ba(n.length),o="";if(1===r)o="coords * strides + begin";else{var s=0;o=n.map((function(e,t){return s++,1===n.length?"coords * strides["+t+"] + begin["+t+"]":"coords["+(s-1)+"] * strides["+t+"] + begin["+t+"]"})).join(",")}this.userCode="\n      "+i+" begin = "+i+"("+e+");\n      "+i+" strides = "+i+"("+t+");\n\n      void main() {\n        "+a+" coords = getOutputCoords();\n        setOutput(getX("+o+"));\n      }\n    "}(t,r,i);return this.compileAndRun(a,[e])},t.prototype.reverse=function(e,t){var n=f().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new function(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");this.outputShape=e;var r=sa("rc",n),i=r[n-1]+" + 1 < "+this.outputShape[n-1],a=r[n-2]+" + 1 < "+this.outputShape[n-2],o=ba(n);function s(n){var r=e.map((function(r,i){return function(n,r){return-1!==t.indexOf(n)&&1!==e[n]?e[n]+" - "+r[n]+" - 1":""+r[n]}(i,n)}));return"getChannel(getX("+r.join(",")+"), vec2("+r.slice(-2).join(",")+"))"}this.userCode=1===n?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+e[0]+" - rc - 1),\n            "+e[0]+" - rc - 1);\n          if("+i+"){\n              result.g = getChannel(getX("+e[0]+" - (rc  + 1) - 1),\n                "+e[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+o+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+s(r.slice())+";\n          if("+i+"){\n            result.g = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",s(e)}(r.slice())+";\n          }\n          if("+a+") {\n            result.b = "+function(e){return e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())+";\n            if("+i+") {\n              result.a = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "}(e.shape,t):new function(e,t){this.variableNames=["x"];var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=e,1!==n){var r=e.map((function(n,r){return function(n){return-1!==t.indexOf(n)&&1!==e[n]?e[n]+" - coords["+n+"] - 1":"coords["+n+"]"}(r)})).join(","),i=ba(n);this.userCode="\n      void main() {\n        "+i+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+e[0]+" - coord - 1));\n        }\n      "}(e.shape,t);return this.compileAndRun(n,[e])},t.prototype.concat=function(e,t){if("complex64"===e[0].dtype){var n=e.map((function(e){return In(e)})),r=e.map((function(e){return Nn(e)}));return Fn(this.concat(n,t),this.concat(r,t))}if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,t);if(1===e.length)return e[0];if(e.length>f().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var i=Math.floor(e.length/2),a=this.concat(e.slice(0,i),t),o=this.concat(e.slice(i),t);return this.concat([a,o],t)}if(f().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var s=new function(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=jn(e,t);var n=this.outputShape,r=n.length,i=ba(r),a=sa("coords",r),o=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((function(e,t){return"T"+t}));var s=new Array(e.length-1);s[0]=e[0][t];for(var u=1;u<s.length;u++)s[u]=s[u-1]+e[u][t];var c=o[t],l=o.slice(-2),f=o.join(),d="if ("+c+" < "+s[0]+") {\n        return getChannel(\n            getT0("+f+"), vec2("+l.join()+"));\n        }";for(u=1;u<s.length;u++){var h=s[u-1];d+="\n        if ("+c+" < "+s[u]+"  && "+c+" >= "+s[u-1]+") {\n          return getChannel(\n            getT"+u+"("+Ma(o,c,h)+"),\n            vec2("+Ma(l,c,h)+"));\n        }"}var p=s.length,m=s[s.length-1];d+="\n        return getChannel(\n          getT"+p+"("+Ma(o,c,m)+"),\n          vec2("+Ma(l,c,m)+"));",this.userCode="\n      float getValue("+o.map((function(e){return"int "+e}))+") {\n        "+d+"\n      }\n\n      void main() {\n        "+i+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+a+"), 0., 0., 0.);\n\n        "+a[r-1]+" = "+a[r-1]+" + 1;\n        if ("+a[r-1]+" < "+n[r-1]+") {\n          result.g = getValue("+a+");\n        }\n\n        "+a[r-2]+" = "+a[r-2]+" + 1;\n        if ("+a[r-2]+" < "+n[r-2]+") {\n          result.a = getValue("+a+");\n        }\n\n        "+a[r-1]+" = "+a[r-1]+" - 1;\n        if ("+a[r-2]+" < "+n[r-2]+" &&\n            "+a[r-1]+" < "+n[r-1]+") {\n          result.b = getValue("+a+");\n        }\n        setOutput(result);\n      }\n    "}(e.map((function(e){return e.shape})),t);return this.compileAndRun(s,e)}var u=jn(e.map((function(e){return e.shape})),t),c=e.map((function(e){return e.as2D(-1,j(e.shape.slice(t)))})),l=new function(e){this.outputShape=[],this.outputShape=jn(e,1),this.variableNames=e.map((function(e,t){return"T"+t}));var t=new Array(e.length-1);t[0]=e[0][1];for(var n=1;n<t.length;n++)t[n]=t[n-1]+e[n][1];var r=["if (yC < "+t[0]+") setOutput(getT0(yR, yC));"];for(n=1;n<t.length;n++){var i=t[n-1];r.push("else if (yC < "+t[n]+") setOutput(getT"+n+"(yR, yC-"+i+"));")}var a=t.length,o=t[t.length-1];r.push("else setOutput(getT"+a+"(yR, yC-"+o+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+r.join("\n        ")+"\n      }\n    "}(c.map((function(e){return e.shape})));return this.compileAndRun(l,c).reshape(u)},t.prototype.neg=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.neg(e);if(f().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Ao,e.dtype);var t=new xo(e.shape,Ao);return this.compileAndRun(t,[e])},t.prototype.batchMatMul=function(e,t,n,r){var i=n?e.shape[2]:e.shape[1],a=r?t.shape[1]:t.shape[2],o=n?e.shape[1]:e.shape[2],s=e.shape[0];if((1===i||1===a)&&o>1e3){n&&(e=e.transpose([0,2,1])),r&&(t=t.transpose([0,2,1]));var u=1===a?e:e.as3D(s,o,1),c=1===a?2:1,l=1===a?t.as3D(s,1,o):t;return this.multiply(u,l).sum(c,!0)}var f=Fe(e.dtype,t.dtype),d=new oo(e.shape,[s,i,a],n,r);return this.compileAndRun(d,[e,t],f)},t.prototype.fusedBatchMatMul=function(e){var t=e.a,n=e.b,r=e.transposeA,i=e.transposeB,a=e.bias,o=e.activation,s=e.preluActivationWeights,u=r?t.shape[2]:t.shape[1],c=i?n.shape[1]:n.shape[2],l=t.shape[0],f=Fe(t.dtype,n.dtype),d=null!=a,h=null!=s,p=o?Lo(o,!0):null,m=new oo(t.shape,[l,u,c],r,i,d,p,h),v=[t,n];return a&&v.push(a),s&&v.push(s),this.compileAndRun(m,v,f)},t.prototype.multiply=function(e,t){if("complex64"===e.dtype){var n=this.texData.get(e.dataId),r=this.texData.get(t.dataId),i=new _a("return areal * breal - aimag * bimag;",e.shape,t.shape),a=new _a("return areal * bimag + aimag * breal;",e.shape,t.shape),o=[this.makeComplexComponentTensorInfo(e,n.complexTensors.real),this.makeComplexComponentTensorInfo(e,n.complexTensors.imag),this.makeComplexComponentTensorInfo(t,r.complexTensors.real),this.makeComplexComponentTensorInfo(t,r.complexTensors.imag)],s=this.compileAndRun(i,o),u=this.compileAndRun(a,o),c=this.complex(s,u);return s.dispose(),u.dispose(),c}if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.multiply(e,t);if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,Sa,e.dtype);var l=new Aa(Sa,e.shape,t.shape);return this.compileAndRun(l,[e,t],e.dtype)},t.prototype.batchNormalization=function(e,t,n,r,i,a){var o=[e,t,n],s=null;null!=a&&(s=a.shape,o.push(a));var u=null;if(null!=i&&(u=i.shape,o.push(i)),f().getBool("WEBGL_PACK_NORMALIZATION")){var c=new function(e,t,n,r,i,a){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Ai(e,t),Ai(e,n);var o="vec4(0.0)";null!=r&&(Ai(e,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var s="vec4(1.0)";null!=i&&(Ai(e,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        vec4 offset = "+o+";\n        vec4 scale = "+s+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+a+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "}(e.shape,t.shape,n.shape,s,u,r);return this.compileAndRun(c,o)}var l=new function(e,t,n,r,i,a){this.outputShape=[],this.variableNames=["x","mean","variance"],Ai(e,t),Ai(e,n);var o="0.0";null!=r&&(Ai(e,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var s="1.0";null!=i&&(Ai(e,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+o+";\n        float scale = "+s+";\n        float inv = scale * inversesqrt(variance + float("+a+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "}(e.shape,t.shape,n.shape,s,u,r);return this.compileAndRun(l,o)},t.prototype.localResponseNormalization4D=function(e,t,n,r,i){var a=f().getBool("WEBGL_PACK_NORMALIZATION")?new function(e,t,n,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var a,o=t,s=e[3]-1;this.outputShape=e;var u="float("+n+") + float("+r+") * sum";a=.5===i?"inversesqrt("+u+")":1===i?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+o+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+o+"; j <= "+o+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+s+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+a+";\n        setOutput(result);\n      }\n    "}(e.shape,t,n,r,i):new function(e,t,n,r,i){this.variableNames=["x"],this.outputShape=[];var a,o=t,s=e[3]-1;this.outputShape=e;var u="float("+n+") + float("+r+") * sum";a=.5===i?"inversesqrt("+u+")":1===i?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+o+"; j <= "+o+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+s+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+a+";\n        setOutput(val);\n      }\n    "}(e.shape,t,n,r,i);return this.compileAndRun(a,[e])},t.prototype.LRNGrad=function(e,t,n,r,i,a,o){var s=new function(e,t,n,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=i,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+t+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+t+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+n+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+i+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+i+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "}(t.shape,r,i,a,o);return this.compileAndRun(s,[t,n,e])},t.prototype.tile=function(e,t){if("string"===e.dtype){var n=this.readSync(e.dataId).map((function(e){return ce(e)}));return ra(gr(e.shape,e.dtype,n),t)}var r=new function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[r]*t[r];this.outputShape=n,this.rank=n.length;var i=ba(this.rank),a=function(e){var t=e.length;if(t>5)throw Error("Tile for rank "+t+" is not yet supported");if(1===t)return"imod(resRC, "+e[0]+")";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],i=0;i<e.length;i++)r.push("imod("+n[i]+", "+e[i]+")");return r.join()}(e);this.userCode="\n      void main() {\n        "+i+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "}(e.shape,t);return this.compileAndRun(r,[e])},t.prototype.pad=function(e,t,n){var r=f().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new function(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((function(t,n){return t[0]+e[n]+t[1]}));for(var r=e.length,i=ba(r),a=t.map((function(e){return e[0]})).join(","),o=t.map((function(t,n){return t[0]+e[n]})).join(","),s=sa("rc",r),u=sa("source",r),c=s[r-1]+" < "+this.outputShape[r-1],l=1===r?"source":"vec2("+u.slice(-2).join()+")",f=[i+" rc = outputLoc;",s[r-1]+" += 1;\n       if("+c+") {\n      ",1===r?"":"}\n       rc = outputLoc;\n       "+s[r-2]+" += 1;\n       if("+s[r-2]+" < "+this.outputShape[r-2]+") {",1===r?"":"  "+s[r-1]+" += 1;\n         if("+c+") {"],d=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",h="",p=0,m=1===r?2:4;p<m;p++)h+="\n        "+f[p]+"\n        if ("+d+") {\n          result["+p+"] = float("+n+");\n        } else {\n          "+i+" source = rc - start;\n          result["+p+"] = getChannel(getX("+u.join()+"), "+l+");\n        }\n      ";h+=1===r?"} ":"}}",this.userCode="\n      const "+i+" start = "+i+"("+a+");\n      const "+i+" end = "+i+"("+o+");\n\n      void main() {\n        "+i+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+h+"\n        setOutput(result);\n      }\n    "}(e.shape,t,n):new function(e,t,n){this.variableNames=["x"],this.outputShape=t.map((function(t,n){return t[0]+e[n]+t[1]}));var r=e.length,i=ba(r),a=t.map((function(e){return e[0]})).join(","),o=t.map((function(t,n){return t[0]+e[n]})).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+i+" start = "+i+"("+a+");\n      "+i+" end = "+i+"("+o+");\n\n      void main() {\n        "+i+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+n+"));\n        } else {\n          "+i+" coords = outC - start;\n          setOutput(getX("+s+"));\n        }\n      }\n    ":"\n        int start = "+a+";\n        int end = "+o+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+n+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "}(e.shape,t,n);return this.compileAndRun(r,[e])},t.prototype.transpose=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.transpose(e,t);var n=f().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var i=ba(this.rank),a=oa("rc",this.rank),o=new Array(this.rank);for(r=0;r<t.length;r++)o[t[r]]=a[r];var s="vec2("+o.slice(-2).join()+")",u="++"+a[this.rank-1]+" < "+n[this.rank-1],c="getChannel(getA("+o.join()+"), "+s+")";this.userCode="\n    void main() {\n      "+i+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+c+";\n      if("+u+") {\n        result[1] = "+c+";\n      }\n      --"+a[this.rank-1]+";\n      if(++"+a[this.rank-2]+" < "+n[this.rank-2]+") {\n        result[2] = "+c+";\n        if("+u+") {\n          result[3] = "+c+";\n        }\n      }\n      setOutput(result);\n    }\n    "}(e.shape,t):new function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];this.outputShape=n,this.rank=n.length;var i=ba(this.rank),a=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank "+t+" is not yet supported");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),i=0;i<e.length;i++)r[e[i]]=n[i];return r.join()}(t);this.userCode="\n    void main() {\n      "+i+" resRC = getOutputCoords();\n      setOutput(getA("+a+"));\n    }\n    "}(e.shape,t);return this.compileAndRun(n,[e])},t.prototype.gather=function(e,t,n){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.gather(e,t,n);var r=new function(e,t,n){this.variableNames=["A","indices"];var r=e.slice();r[n]=t,this.outputShape=r,this.rank=r.length;var i=ba(this.rank),a=function(e,t){var n=e.length;if(n>4)throw Error("Gather for rank "+n+" is not yet supported");if(1===n)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],a=0;a<e.length;a++)a===t?i.push("int(getIndices("+r[a]+"))"):i.push(""+r[a]);return i.join()}(e,n);this.userCode="\n      void main() {\n        "+i+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "}(e.shape,t.size,n);return this.compileAndRun(r,[e,t])},t.prototype.batchToSpaceND=function(e,t,n){A(e.rank<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var r=t.reduce((function(e,t){return e*t})),i=Hr(e.shape,t,r),a=Xr(i.length,t.length),o=Kr(e.shape,t,r),s=Yr(n,t.length),u=$r(o,n,t.length);return e.reshape(i).transpose(a).reshape(o).slice(s,u)},t.prototype.spaceToBatchND=function(e,t,n){A(e.rank<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var r=t.reduce((function(e,t){return e*t})),i=[[0,0]];i.push.apply(i,n);for(var a=1+t.length;a<e.shape.length;++a)i.push([0,0]);var o=e.pad(i),s=Hr(o.shape,t,r,!1),u=Xr(s.length,t.length,!1),c=Kr(o.shape,t,r,!1);return o.reshape(s).transpose(u).reshape(c)},t.prototype.reduce=function(e,t,n){var r=e.shape[0],i=e.shape[1],a=new function(e,t){this.variableNames=["x"];var n=e.windowSize,r=e.batchSize,i=e.inSize,a=Math.ceil(i/n);this.outputShape=[r,a];var o="0.0",s="";"prod"===t?o="1.0":"min"===t?(o="1.0 / 1e-20",s="min"):"max"===t&&(o="-1.0 / 1e-20",s="max");var u=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===t?u="sumValue":"prod"===t?u="prodValue":"all"===t?u="allValue":"any"===t&&(u="anyValue");var c=4*Math.floor(n/4),l=n%4,f="\n      if ("+("sum"===t)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===t)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",d="vec4";"all"===t?(o="1.0",f="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",d="bvec4"):"any"===t&&(o="0.0",f="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",d="bvec4");var h="";i%n>0&&(h="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+o+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+h+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+n+";\n\n        vec4 minMaxValue = vec4("+o+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+c+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+f+"\n        }\n\n        int inIdx = inOffset + "+c+";\n        if ("+(1===l)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+f+"\n        } else if ("+(2===l)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+f+"\n        } else if ("+(3===l)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+f+"\n        }\n        setOutput("+u+");\n      }\n    "}({windowSize:ei(i),inSize:i,batchSize:r},t),o=this.compileAndRun(a,[e],n);return 1===o.shape[1]?o:this.reduce(o,t,n)},t.prototype.argReduce=function(e,t,n){void 0===n&&(n=null);var r=e.shape[0],i=e.shape[1];null!=n&&(r=n.shape[0],i=n.shape[1]);var a=new function(e,t,n){this.variableNames=["A"];var r=e.windowSize,i=e.batchSize,a=e.inSize,o=Math.ceil(a/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];var s="max"===t?">":"<",u=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+u+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+s+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "}({windowSize:ei(i),inSize:i,batchSize:r},t,null==n),o=[e];null!=n&&o.push(n);var s=this.compileAndRun(a,o,"int32");return 1===s.shape[1]?s:this.argReduce(e,t,s)},t.prototype.argReducePacked=function(e,t,n){void 0===n&&(n=null);var r=null!=n?n.shape:e.shape,i=new function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,A(e.length>2,(function(){return"Packed arg"+(n.charAt(0).toUpperCase()+n.slice(1))+" supports only inputs with rank above 2."}));var i=e[e.length-1],a=Math.ceil(i/t);this.outputShape=e.slice(0,-1),a>1&&this.outputShape.push(a),r||this.variableNames.push("bestIndicesA");var o,s,u=this.outputShape,c=u.length,l=ba(c),f=sa("coords",c);if(1===a){var d=ba(s=c+1);o="\n        "+d+" sourceLocR = "+d+"("+f.join()+", 0);\n        ++"+f[c-1]+";\n        "+d+" sourceLocG = "+d+"("+f.join()+", 0);\n        ++"+f[c-2]+";\n        "+d+" sourceLocA = "+d+"("+f.join()+", 0);\n        --"+f[c-1]+";\n        "+d+" sourceLocB = "+d+"("+f.join()+", 0);\n        --"+f[c-2]+";"}else s=c,o="\n        "+l+" sourceLocR = coords;\n        ++"+f[c-1]+";\n        "+l+" sourceLocG = coords;\n        ++"+f[c-2]+";\n        "+l+" sourceLocA = coords;\n        --"+f[c-1]+";\n        "+l+" sourceLocB = coords;\n        --"+f[c-2]+";";var h=["x","y","z","w","u","v"].slice(0,s),p="."+h[s-1],m=h.map((function(e){return"int "+e})),v=sa("sourceLocR",s-1).concat("inIdx.r"),g=sa("sourceLocG",s-1).concat("inIdx.g"),y=sa("sourceLocB",s-1).concat("inIdx.b"),b=sa("sourceLocA",s-1).concat("inIdx.a"),x="max"===n?"greaterThan":"lessThan",w=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+v.join()+"),\n                             getBestIndicesAChannel("+g.join()+"),\n                             getBestIndicesAChannel("+y.join()+"),\n                             getBestIndicesAChannel("+b.join()+")));",_="vec4(\n            getAChannel("+v.join()+"),\n            hasNextCol ? getAChannel("+g.join()+") : 0.,\n            hasNextRow ? getAChannel("+y.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+b.join()+") : 0.)",k=r?"":"\n      float getBestIndicesAChannel("+m.join()+") {\n        return getChannel(getBestIndicesA("+h.join()+"),\n                                          vec2("+h.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+m.join()+") {\n        return getChannel(getA("+h.join()+"),\n                               vec2("+h.slice(-2).join()+"));\n      }\n      "+k+"\n      void main() {\n        "+l+" coords = getOutputCoords();\n        bool hasNextCol = "+f[c-1]+" < "+(u[c-1]-1)+";\n        bool hasNextRow = "+f[c-2]+" < "+(u[c-2]-1)+";\n        "+o+"\n        ivec4 srcIdx = ivec4(sourceLocR"+p+", sourceLocG"+p+",\n          sourceLocB"+p+", sourceLocA"+p+") * "+t+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+_+";\n\n        for (int i = 0; i < "+t+"; i++) {\n          inIdx = srcIdx;\n          "+w+"\n          vec4 candidate = "+_+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+x+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "}(r,ei(r[r.length-1]),t,null==n),a=null==n?[e]:[e,n],o=this.compileAndRun(i,a,"int32");return o.rank===e.rank?this.argReducePacked(e,t,o):o},t.prototype.sum=function(e,t){Cn("sum",t,e.rank);var n=En(e.shape,t),r=n[0],i=j(n[1]),a=e.as2D(-1,i),o=Ie(e.dtype);return this.reduce(a,"sum",o).reshape(r)},t.prototype.prod=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,t);var n=En(e.shape,t),r=n[0],i=j(n[1]),a=e.as2D(-1,i),o=Ie(e.dtype);return this.reduce(a,"prod",o).reshape(r)},t.prototype.unsortedSegmentSum=function(e,t,n){var r=0,i=An([r],e.rank),a=e;null!=i&&(a=e.transpose(i),r=Dn(1,e.rank)[0]);var o=function(e,t,n){for(var r=[],i=e.length,a=0;a<i;a++)a!==t?r.push(e[a]):r.push(n);return r}(a.shape,r,n),s=j([a.shape[r]]),u=a.as2D(-1,s),c=Ie(e.dtype),l=this.segOpCompute(u,"unsortedSegmentSum",t,c,n).reshape(o);return null!=i&&(l=l.transpose(On(i))),l},t.prototype.segOpCompute=function(e,t,n,r,i){var a=e.shape[0],o=e.shape[1],s=function(e,t){var n,r=!1;for(e<=Qr?(n=e,r=!0):n=ee(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=ee(e,n+1);return n}(o,i),u=new function(e,t){this.variableNames=["x","segmentIds"];var n=e.windowSize,r=e.batchSize,i=e.inSize,a=e.numSegments,o=a*Math.ceil(i/n);this.outputShape=[r,o];var s=4*Math.floor(n/4),u=n%4,c="\n        sumValue += dot(values, segFilter);\n    ",l="";i%n>0&&(l="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return initializationValue;\n        }\n      ");var f="";i%n>0&&(f="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+l+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+f+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+a+")) * float("+n+"));\n        int currentSeg = int(mod(float(outIdx), float("+a+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+s+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+c+"\n        }\n\n        int inIdx = inOffset + "+s+";\n        if ("+(1===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+c+"\n        } else if ("+(2===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+c+"\n        } else if ("+(3===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+c+"\n        }\n        setOutput(sumValue);\n      }\n    "}({windowSize:s,inSize:o,batchSize:a,numSegments:i},t),c=this.compileAndRun(u,[e,n],r);return c.shape[1]===i?c:(n=$n(0,i).tile([o/s]),this.segOpCompute(c,t,n,r,i))},t.prototype.argMinMaxReduce=function(e,t,n){var r=[t];if(Cn("arg"+n.charAt(0).toUpperCase()+n.slice(1),r,e.rank),!f().getBool("WEBGL_PACK_REDUCE")||e.rank<=2){var i=En(e.shape,r),a=i[0],o=j(i[1]),s=e.as2D(-1,o);return this.argReduce(s,n).reshape(a)}return this.argReducePacked(e,n)},t.prototype.argMin=function(e,t){return this.argMinMaxReduce(e,t,"min")},t.prototype.argMax=function(e,t){return this.argMinMaxReduce(e,t,"max")},t.prototype.cumsum=function(e,t,n,r){if(t!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+t);var i=new function(e,t,n){this.variableNames=["x"],this.outputShape=e;var r=e.length,i=e[e.length-1],a=n?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(n?"return "+i+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+ba(r)+" coords = getOutputCoords();\n        int end = "+Ra(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+i+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+a+" end) {\n            continue;\n          }\n          if (idx == end && "+t+") {\n            continue;\n          }\n          "+Ra(r,"coords")+" = idx;\n          val += getX("+function(e,t){if(1===e)return""+t;if(2===e)return t+".x, "+t+".y";if(3===e)return t+".x, "+t+".y, "+t+".z";if(4===e)return t+".x, "+t+".y, "+t+".z, "+t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}(r,"coords")+");\n        }\n        setOutput(val);\n      }\n    "}(e.shape,n,r);return this.compileAndRun(i,[e])},t.prototype.equal=function(e,t){if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(equal(a, b));\n","bool");var n=new Aa("return float(a == b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.notEqual=function(e,t){if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(notEqual(a, b));\n","bool");var n=new Aa("return float(a != b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.less=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.less(e,t);if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThan(a, b));\n","bool");var n=new Aa("return float(a < b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.lessEqual=function(e,t){if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThanEqual(a, b));\n","bool");var n=new Aa("return float(a <= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.greater=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.greater(e,t);if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThan(a, b));\n","bool");var n=new Aa("return float(a > b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.greaterEqual=function(e,t){if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var n=new Aa("return float(a >= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.logicalNot=function(e){var t=new xo(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(t,[e])},t.prototype.logicalAnd=function(e,t){if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var n=new Aa("return float(a >= 1.0 && b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.logicalOr=function(e,t){if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var n=new Aa("return float(a >= 1.0 || b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.select=function(e,t,n){var r=new function(e,t,n){var r,i;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error("Where for rank "+n+" is not yet supported");if(1===n)i="resRC",r="resRC";else{for(var a=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],s=[],u=0;u<t.length;u++)s.push(""+a[u]),u<e&&o.push(""+a[u]);r=o.join(),i=s.join()}var c=ba(n);this.userCode="\n      void main() {\n        "+c+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+i+"));\n        } else {\n          setOutput(getB("+i+"));\n        }\n      }\n    "}(e.rank,t.shape,t.rank);return this.compileAndRun(r,[e,t,n],Fe(t.dtype,n.dtype))},t.prototype.where=function(e){gn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return aa(e.shape,t)},t.prototype.topk=function(e,t,n){return ia(e.dataSync(),e.shape,e.dtype,t)},t.prototype.min=function(e,t){Cn("min",t,e.rank);var n=En(e.shape,t),r=n[0],i=j(n[1]),a=e.as2D(-1,i);return this.reduce(a,"min",a.dtype).reshape(r)},t.prototype.minimum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.minimum(e,t);var n=f().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Da("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new Aa("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.mod=function(e,t){var n=f().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Da("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new Aa("if (b == 0.0) return NAN;\n  return mod(a, b);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.max=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,t);Cn("max",t,e.rank);var n=En(e.shape,t),r=n[0],i=j(n[1]),a=e.as2D(-1,i);return this.reduce(a,"max",a.dtype).reshape(r)},t.prototype.maximum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.maximum(e,t);var n=f().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Da("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new Aa("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.all=function(e,t){Cn("all",t,e.rank);var n=En(e.shape,t),r=n[0],i=j(n[1]),a=e.as2D(-1,i);return this.reduce(a,"all",a.dtype).reshape(r)},t.prototype.any=function(e,t){Cn("any",t,e.rank);var n=En(e.shape,t),r=n[0],i=j(n[1]),a=e.as2D(-1,i);return this.reduce(a,"any",a.dtype).reshape(r)},t.prototype.realDivide=function(e,t){if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n","float32",!0);var n=new Aa("\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",e.shape,t.shape);return this.compileAndRun(n,[e,t],"float32")},t.prototype.floorDiv=function(e,t){if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var n=new Aa("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",e.shape,t.shape);return this.compileAndRun(n,[e,t],"int32")},t.prototype.add=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,ka);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.add(e,t);var n=Fe(e.dtype,t.dtype);if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,ka,n);var r=new Aa(ka,e.shape,t.shape);return this.compileAndRun(r,[e,t],n)},t.prototype.packedUnaryOp=function(e,t,n){var r=new Po(e.shape,t);return this.compileAndRun(r,[e],n)},t.prototype.packedBinaryOp=function(e,t,n,r,i){void 0===i&&(i=!1);var a=new Da(n,e.shape,t.shape,i);return this.compileAndRun(a,[e,t],r)},t.prototype.complexSeparableBinaryOp=function(e,t,n){var r=this,i=this.texData.get(e.dataId),a=this.texData.get(t.dataId),o=[[i.complexTensors.real,a.complexTensors.real],[i.complexTensors.imag,a.complexTensors.imag]].map((function(i){var a=i[0],o=i[1],s=r.makeComplexComponentTensorInfo(e,a),u=r.makeComplexComponentTensorInfo(t,o),c=new Aa(n,e.shape,t.shape);return r.compileAndRun(c,[s,u],Fe(a.dtype,o.dtype))})),s=o[0],u=o[1],c=this.complex(s,u);return s.dispose(),u.dispose(),c},t.prototype.makeComplexComponentTensorInfo=function(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}},t.prototype.addN=function(e){if(1===e.length)return e[0];if(e.length>f().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var t=Math.floor(e.length/2),n=this.addN(e.slice(0,t)),r=this.addN(e.slice(t));return this.addN([n,r])}var i=e.map((function(e){return e.dtype})).reduce((function(e,t){return Fe(e,t)})),a=e.map((function(e){return e.shape})),o=f().getBool("WEBGL_PACK")?new function(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((function(e,t){return"T"+t}));var n=[];this.variableNames.forEach((function(e){n.push("vec4 v"+e+" = get"+e+"AtOutCoords();")}));var r=this.variableNames.map((function(e){return"v"+e})).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        vec4 result = "+r+";\n        setOutput(result);\n      }\n    "}(e[0].shape,a):new function(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((function(e,t){return"T"+t}));var n=[];this.variableNames.forEach((function(e){n.push("float v"+e+" = get"+e+"AtOutCoords();")}));var r=this.variableNames.map((function(e){return"v"+e})).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        float result = "+r+";\n        setOutput(result);\n      }\n    "}(e[0].shape,a);return this.compileAndRun(o,e,i)},t.prototype.subtract=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,Ea);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.subtract(e,t);var n=Fe(e.dtype,t.dtype);if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,Ea,e.dtype);var r=new Aa(Ea,e.shape,t.shape);return this.compileAndRun(r,[e,t],n)},t.prototype.pow=function(e,t){var n=f().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Da("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new Aa("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",e.shape,t.shape),r=Fe(e.dtype,t.dtype);return this.compileAndRun(n,[e,t],r)},t.prototype.ceil=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.ceil(e);if(f().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Oo,e.dtype);var t=new xo(e.shape,Oo);return this.compileAndRun(t,[e])},t.prototype.floor=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.floor(e);if(f().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Do,e.dtype);var t=new xo(e.shape,Do);return this.compileAndRun(t,[e])},t.prototype.sign=function(e){var t=new xo(e.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(t,[e])},t.prototype.isNaN=function(e){var t=new xo(e.shape,"return float(isnan(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.isInf=function(e){var t=new xo(e.shape,"return float(isinf(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.isFinite=function(e){var t=new xo(e.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.round=function(e){var t=new xo(e.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(t,[e])},t.prototype.exp=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.exp(e);if(f().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,To,e.dtype);var t=new xo(e.shape,To);return this.compileAndRun(t,[e])},t.prototype.expm1=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.expm1(e);if(f().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,jo,e.dtype);var t=new xo(e.shape,jo);return this.compileAndRun(t,[e])},t.prototype.softmax=function(e,t){var n=L([t],e.shape),r=this.max(e,n),i=Sn(r.shape,n),a=this.subtract(e,r.reshape(i)),o=this.exp(a),s=this.sum(o,n).reshape(i);return this.realDivide(o,s)},t.prototype.log=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.log(e);if(f().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",e.dtype);var t=new xo(e.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(t,[e])},t.prototype.log1p=function(e){var t=new xo(e.shape,"return log(1.0 + x);");return this.compileAndRun(t,[e])},t.prototype.sqrt=function(e){var t=new xo(e.shape,"return sqrt(x);");return this.compileAndRun(t,[e])},t.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var t=new xo(e.shape,"return inversesqrt(x);");return this.compileAndRun(t,[e])},t.prototype.reciprocal=function(e){var t=new xo(e.shape,"return 1.0 / x;");return this.compileAndRun(t,[e])},t.prototype.relu=function(e){var t;return t=f().getBool("WEBGL_PACK")?new Po(e.shape,Io):new xo(e.shape,Eo),this.compileAndRun(t,[e])},t.prototype.relu6=function(e){var t;return t=f().getBool("WEBGL_PACK")?new Po(e.shape,No):new xo(e.shape,So),this.compileAndRun(t,[e])},t.prototype.prelu=function(e,t){var n=f().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Da(Oa,e.shape,t.shape):new Aa(Ca,e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.elu=function(e){if(f().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Ro,e.dtype);var t=new xo(e.shape,Co);return this.compileAndRun(t,[e])},t.prototype.eluDer=function(e,t){var n=f().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Da("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",e.shape,t.shape):new Aa("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.selu=function(e){var t=new xo(e.shape,"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = 1.7580993408473768;\n  float scale = 1.0507009873554805;\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n");return this.compileAndRun(t,[e])},t.prototype.int=function(e){var t=new xo(e.shape,"return float(int(x));");return this.compileAndRun(t,[e],"int32")},t.prototype.clip=function(e,t,n){var r,i=(r=f().getBool("WEBGL_PACK_CLIP")?new ja(e.shape):new Ta(e.shape)).getCustomSetupFunc(t,n);return this.compileAndRun(r,[e],null,i)},t.prototype.abs=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.abs(e);if(f().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,ko,e.dtype);var t=new xo(e.shape,ko);return this.compileAndRun(t,[e])},t.prototype.complexAbs=function(e){var t=this.texData.get(e.dataId),n=new function(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}(e.shape),r=[this.makeComplexComponentTensorInfo(e,t.complexTensors.real),this.makeComplexComponentTensorInfo(e,t.complexTensors.imag)];return this.compileAndRun(n,r)},t.prototype.sigmoid=function(e){var t=new xo(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(t,[e])},t.prototype.softplus=function(e){var t=new xo(e.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(t,[e])},t.prototype.sin=function(e){var t=new xo(e.shape,"if (isnan(x)) return x;\n  return sin(x);\n");return this.compileAndRun(t,[e])},t.prototype.cos=function(e){var t=new xo(e.shape,"if (isnan(x)) return x;\n  return cos(x);\n");return this.compileAndRun(t,[e])},t.prototype.tan=function(e){var t=new xo(e.shape,"return tan(x);");return this.compileAndRun(t,[e])},t.prototype.asin=function(e){var t=new xo(e.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n");return this.compileAndRun(t,[e])},t.prototype.acos=function(e){var t=new xo(e.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n");return this.compileAndRun(t,[e])},t.prototype.atan=function(e){var t=new xo(e.shape,"if (isnan(x)) return x;\n  return atan(x);\n");return this.compileAndRun(t,[e])},t.prototype.atan2=function(e,t){var n=f().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Da("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new Aa("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.sinh=function(e){var t=new xo(e.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},t.prototype.cosh=function(e){var t=new xo(e.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},t.prototype.tanh=function(e){var t=new xo(e.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(t,[e])},t.prototype.asinh=function(e){var t=new xo(e.shape,"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(t,[e])},t.prototype.acosh=function(e){var t=new xo(e.shape,"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));");return this.compileAndRun(t,[e])},t.prototype.atanh=function(e){var t=new xo(e.shape,"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;");return this.compileAndRun(t,[e])},t.prototype.erf=function(e){var t=new xo(e.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n');return this.compileAndRun(t,[e])},t.prototype.step=function(e,t){var n=new xo(e.shape,function(e){return void 0===e&&(e=0),wo+"\n    return x > 0.0 ? 1.0 : float("+e+");\n  "}(t));return this.compileAndRun(n,[e])},t.prototype.conv2dByMatMul=function(e,t,n,r,i,a){var o=e.shape,s=this.texData.get(e.dataId),u=n.inChannels,c=o[0]*o[1]*o[2],l=n.outChannels,d="channelsLast"===n.dataFormat,h=(1===c||1===l)&&u>1e3,p=o[2]%2!=0&&!!s.isPacked;if(h||!f().getBool("WEBGL_LAZILY_UNPACK")||!f().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!p){var m=d?o[0]*o[1]*o[2]:o[0]*o[2]*o[3],v=this.reshape(e,[1,m,n.inChannels]),g=this.reshape(t,[1,n.inChannels,n.outChannels]);return this.reshape(this.fusedBatchMatMul({a:v,b:g,transposeA:!1,transposeB:!1,bias:r,activation:i,preluActivationWeights:a}),n.outShape)}var y=d?o[0]*o[1]*(o[2]+1):o[0]*o[2]*(o[3]+1),b={dataId:e.dataId,shape:[1,y,n.inChannels],dtype:e.dtype},x=s.shape;s.shape=s.shape.slice(),s.shape[s.shape.length-2]++,A(Pt(s.shape,b.shape),(function(){return"packed reshape "+s.shape+" to "+b.shape+" isn't free"}));var w=this.reshape(t,[1,n.inChannels,n.outChannels]),_=this.fusedBatchMatMul({a:b,b:w,transposeA:!1,transposeB:!1,bias:r,activation:i,preluActivationWeights:a}),k=this.texData.get(_.dataId);return A(k.isPacked,(function(){return"batchMatMul result is expected to be packed"})),s.shape=x,k.shape=n.outShape,We.makeTensorFromDataId(_.dataId,n.outShape,_.dtype)},t.prototype.conv2dWithIm2Row=function(e,t,n,r,i,a){var o=n.filterWidth,s=n.filterHeight,u=n.inChannels,c=n.outWidth,l=n.outHeight,f="channelsLast"===n.dataFormat,d=o*s*u,h=l*c,p=[d,h],m=e.squeeze([0]),v=t.reshape([1,d,-1]),g=new function(e,t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var r=n.filterWidth,i=n.inChannels,a=n.strideWidth,o=n.strideHeight,s=n.padInfo,u=n.outWidth,c=n.dilationWidth,l=n.dilationHeight,f=n.dataFormat,d=s.left,h=s.top,p=i*r,m=ua(),v="channelsLast"===f,g=v?0:1,y=v?1:2,b="",x=0;x<=1;x++)for(var w=0;w<=1;w++)b+="\n          blockIndex = rc.y + "+w+";\n          pos = rc.x + "+x+";\n\n          if(blockIndex < "+e[1]+" && pos < "+e[0]+") {\n            offsetY = int(blockIndex / ("+u+")) * "+o+" - "+h+";\n            d0 = offsetY + "+l+" * (pos / "+p+");\n\n            if(d0 < "+t[g]+" && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), "+u+".) * "+a+". - "+d+".);\n              d1 = offsetX + "+c+" * (int(mod(float(pos), "+p+".) / "+i+".));\n\n              if(d1 < "+t[y]+" && d1 >= 0) {\n\n                ch = int(mod(float(pos), "+i+".));\n\n                if ("+v+") {\n                  innerDims = vec2(d1, ch);\n                  result["+(2*x+w)+"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result["+(2*x+w)+"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ";this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        "+b+"\n\n        "+m.output+" = result;\n      }\n    "}(p,m.shape,n),y=this.compileAndRun(g,[m]).reshape([1,p[0],p[1]]),b=null!=r,x=null!=a,w=i?Lo(i,!0):null,_=new oo(y.shape,[1,h,n.outChannels],!0,!1,b,w,x),k=[y,v];r&&k.push(r),x&&k.push(a);var E=this.compileAndRun(_,k);return f?E.reshape([1,l,c,n.outChannels]):E.reshape([1,n.outChannels,l,c])},t.prototype.fusedConv2d=function(e){var t=e.input,n=e.filter,r=e.convInfo,i=e.bias,a=e.activation,o=e.preluActivationWeights;if(1===r.filterHeight&&1===r.filterWidth&&1===r.dilationHeight&&1===r.dilationWidth&&1===r.strideHeight&&1===r.strideWidth&&("SAME"===r.padInfo.type||"VALID"===r.padInfo.type))return this.conv2dByMatMul(t,n,r,i,a,o);if(f().getBool("WEBGL_CONV_IM2COL")&&1===t.shape[0])return this.conv2dWithIm2Row(t,n,r,i,a,o);var s=null!=i,u=null!=o,c=a?Lo(a,!1):null,l=new Fa(r,s,c,u),d=[t,n];return i&&d.push(i),o&&d.push(o),this.compileAndRun(l,d)},t.prototype.conv2d=function(e,t,n){if(1===n.filterHeight&&1===n.filterWidth&&1===n.dilationHeight&&1===n.dilationWidth&&1===n.strideHeight&&1===n.strideWidth&&("SAME"===n.padInfo.type||"VALID"===n.padInfo.type))return this.conv2dByMatMul(e,t,n);if(f().getBool("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,t,n);var r=new Fa(n);return this.compileAndRun(r,[e,t])},t.prototype.conv2dDerInput=function(e,t,n){var r=new function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,i=e.strideWidth,a="channelsLast"===e.dataFormat,o=t-1-e.padInfo.top,s=n-1-e.padInfo.left,u=a?1:2,c=a?2:3,l=a?3:1;this.userCode="\n      const ivec2 pads = ivec2("+o+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords["+l+"];\n\n        ivec2 dyCorner = ivec2(coords["+u+"], coords["+c+"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n\n              if ("+a+") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}(n);return this.compileAndRun(r,[e,t])},t.prototype.conv2dDerFilter=function(e,t,n){var r=new function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,a="channelsLast"===e.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+i+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              if ("+a+") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}(n);return this.compileAndRun(r,[e,t])},t.prototype.fusedDepthwiseConv2D=function(e){var t,n=e.input,r=e.filter,i=e.convInfo,a=e.bias,o=e.activation,s=e.preluActivationWeights,u=f().getBool("WEBGL_PACK_DEPTHWISECONV")&&i.strideWidth<=2&&i.outChannels/i.inChannels==1,c=o?Lo(o,u):null,l=[n,r],d=null!=a,h=null!=s;return d&&l.push(a),h&&l.push(s),u?(t=new Na(i,d,c,h),this.compileAndRun(t,l)):(t=new Ia(i,d,c,h),this.compileAndRun(t,l))},t.prototype.depthwiseConv2D=function(e,t,n){var r;return f().getBool("WEBGL_PACK_DEPTHWISECONV")&&n.strideWidth<=2&&n.outChannels/n.inChannels==1?(r=new Na(n),this.compileAndRun(r,[e,t])):(r=new Ia(n),this.compileAndRun(r,[e,t]))},t.prototype.depthwiseConv2DDerInput=function(e,t,n){var r=new function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,i=e.strideWidth,a=t-1-e.padInfo.top,o=n-1-e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+a+", "+o+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+s+"; dm++) {\n              int d2 = d1 * "+s+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}(n);return this.compileAndRun(r,[e,t])},t.prototype.depthwiseConv2DDerFilter=function(e,t,n){var r=new function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,a=e.outChannels/e.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+a+" + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+i+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3d=function(e,t,n){var r=new function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,i=e.strideDepth,a=e.strideHeight,o=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,l=e.filterDepth,f=e.filterHeight,d=e.filterWidth,h=4*Math.floor(e.inChannels/4),p=e.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+i+", "+a+", "+o+");\n      const ivec3 pads = ivec3("+t+", "+n+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+l+"; wF++) {\n          int xF = xFCorner + wF * "+s+";\n\n          if (xF < 0 || xF >= "+e.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+f+"; wR++) {\n            int xR = xRCorner + wR * "+u+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+d+"; wC++) {\n              int xC = xCCorner + wC * "+c+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+h+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===p)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+h+") *\n                  getW(wF, wR, wC, "+h+", d2);\n              } else if ("+(2===p)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+h+"),\n                  getX(batch, xF, xR, xC, "+h+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+h+", d2),\n                  getW(wF, wR, wC, "+h+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===p)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+h+"),\n                  getX(batch, xF, xR, xC, "+h+" + 1),\n                  getX(batch, xF, xR, xC, "+h+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+h+", d2),\n                  getW(wF, wR, wC, "+h+" + 1, d2),\n                  getW(wF, wR, wC, "+h+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3dDerInput=function(e,t,n){var r=new function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,i=e.strideDepth,a=e.strideHeight,o=e.strideWidth,s=t-1-e.padInfo.front,u=n-1-e.padInfo.top,c=r-1-e.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3("+s+", "+u+", "+c+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+t+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+i+".0;\n\n          if (dyF < 0.0 || dyF >= "+e.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+t+" - 1 - wF;\n\n          for (int wR = 0; wR < "+n+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+a+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+n+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+o+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3dDerFilter=function(e,t,n){var r=new function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,i=e.padInfo.front,a=e.padInfo.top,o=e.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yF = 0; yF < "+e.outDepth+"; yF++) {\n            int xF = wF + yF * "+t+" - "+i+";\n\n            if (xF < 0 || xF >= "+e.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n              int xR = wR + yR * "+n+" - "+a+";\n\n              if (xR < 0 || xR >= "+e.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n                int xC = wC + yC * "+r+" - "+o+";\n\n                if (xC < 0 || xC >= "+e.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}(n);return this.compileAndRun(r,[e,t])},t.prototype.maxPool=function(e,t){var n=new uo(t,"max",!1);return this.compileAndRun(n,[e])},t.prototype.avgPool=function(e,t){var n=new uo(t,"avg",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.maxPoolBackprop=function(e,t,n,r){var i=new uo(r,"max",!0),a=this.compileAndRun(i,[t]),o=new function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,i=e.effectiveFilterHeight,a=e.effectiveFilterWidth,o=i-1-e.padInfo.top,s=a-1-e.padInfo.left,u=i*a-1;this.userCode="\n      const ivec2 pads = ivec2("+o+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+i+";\n          wR += "+r+") {\n          float dyR = float(dyRCorner + wR) / "+t+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+a+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+u+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+a+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}(r),s=this.compileAndRun(o,[e,a],t.dtype);return a.dispose(),s},t.prototype.avgPoolBackprop=function(e,t,n){var r=new function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,i=e.strideWidth,a=e.dilationHeight,o=e.dilationWidth,s=e.effectiveFilterHeight,u=e.effectiveFilterWidth,c=s-1-e.padInfo.top,l=u-1-e.padInfo.left,f=1/(t*n);this.userCode="\n      const ivec2 pads = ivec2("+c+", "+l+");\n      const float avgMultiplier = float("+f+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+";\n            wR += "+a+") {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+u+";\n            wC+= "+o+") {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}(n);return this.compileAndRun(r,[e],t.dtype)},t.prototype.cast=function(e,t){return zi(e,t,this)},t.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),i=0,a=0;a<e.rank;a++)a!==t&&(r[i++]=e.shape[a]);var o=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;var u=new Array(n);for(a=0;a<u.length;a++)o[t]=a,u[a]=this.slice(e,o,s).reshape(r);return u},t.prototype.avgPool3d=function(e,t){var n=new co(t,"avg",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.avgPool3dBackprop=function(e,t,n){var r=new function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,i=e.strideDepth,a=e.strideHeight,o=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,l=e.effectiveFilterDepth,f=e.effectiveFilterHeight,d=e.effectiveFilterWidth,h=l-1-e.padInfo.front,p=f-1-e.padInfo.top,m=d-1-e.padInfo.left,v=1/(t*n*r);this.userCode="\n      const ivec3 pads = ivec3("+h+", "+p+", "+m+");\n      const float avgMultiplier = float("+v+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+l+";\n            wD += "+s+") {\n          float dyD = float(dyDCorner + wD) / "+i+".0;\n\n          if (dyD < 0.0 || dyD >= "+e.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+f+";\n              wR += "+u+") {\n            float dyR = float(dyRCorner + wR) / "+a+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+d+";\n                wC += "+c+") {\n              float dyC = float(dyCCorner + wC) / "+o+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}(n);return this.compileAndRun(r,[e],t.dtype)},t.prototype.maxPool3d=function(e,t){var n=new co(t,"max",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.maxPool3dBackprop=function(e,t,n,r){var i=new co(r,"max",!0),a=this.compileAndRun(i,[t]),o=new function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,i=e.dilationDepth,a=e.dilationHeight,o=e.dilationWidth,s=e.effectiveFilterDepth,u=e.effectiveFilterHeight,c=e.effectiveFilterWidth,l=s-1-e.padInfo.front,f=u-1-e.padInfo.top,d=c-1-e.padInfo.left,h=s*u*c-1;this.userCode="\n      const ivec3 pads = ivec3("+l+", "+f+", "+d+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+s+";\n           wD += "+i+") {\n          float dyD = float(dyDCorner + wD) / "+t+".0;\n\n          if (dyD < 0.0 || dyD >= "+e.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+a+") {\n            float dyR = float(dyRCorner + wR) / "+n+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+c+";\n                wC += "+o+") {\n              float dyC = float(dyCCorner + wC) / "+r+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = "+h+" -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * "+u+" * "+c+" +\n                  wR * "+c+" + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}(r),s=this.compileAndRun(o,[e,a],t.dtype);return a.dispose(),s},t.prototype.reshape=function(e,t){var n=this.texData.get(e.dataId);if(n.isPacked&&!Pt(e.shape,t)&&(null===n.texture||!Pt(n.shape,t))){var r=this.packedReshape(e,t);return We.makeTensorFromDataId(r.dataId,r.shape,r.dtype)}return Ui(e,t)},t.prototype.resizeBilinear=function(e,t,n,r){var i=f().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var i=e[0],a=e[1],o=e[2],s=e[3];this.outputShape=[i,t,n,s];var u=[r&&t>1?a-1:a,r&&n>1?o-1:o],c=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+",\n          "+u[1]/c[1]+");\n      const vec3 inputShapeRC = vec3("+a+".0, "+o+".0,\n                                     "+o+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(s-1)+";\n        bool hasNextRow = coords.z < "+(n-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "}(e.shape,t,n,r):new function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var i=e[0],a=e[1],o=e[2],s=e[3];this.outputShape=[i,t,n,s];var u=[r&&t>1?a-1:a,r&&n>1?o-1:o],c=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+a+".0, "+o+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "}(e.shape,t,n,r);return this.compileAndRun(i,[e],"float32")},t.prototype.resizeBilinearBackprop=function(e,t,n){var r=new function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,i=r[1],a=r[2],o=e.shape,s=o[1],u=o[2],c=[n&&s>1?i-1:i,n&&u>1?a-1:a],l=[n&&s>1?s-1:s,n&&u>1?u-1:u],f=c[0]/l[0],d=c[1]/l[1],h=1/f,p=1/d,m=2*Math.ceil(h)+2,v=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+f+");\n        const float widthScale = float("+d+");\n\n        const float invHeightScale = float("+h+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+v+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(i-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(a-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "}(e,t,n);return this.compileAndRun(r,[e])},t.prototype.resizeNearestNeighbor=function(e,t,n,r){var i=new function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var i=e[0],a=e[1],o=e[2],s=e[3];this.outputShape=[i,t,n,s];var u=[r&&t>1?a-1:a,r&&n>1?o-1:o],c=[r&&t>1?t-1:t,r&&n>1?n-1:n],l=r?"0.5":"0.0";this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+a+".0, "+o+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+l+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "}(e.shape,t,n,r);return this.compileAndRun(i,[e])},t.prototype.resizeNearestNeighborBackprop=function(e,t,n){var r=new function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,i=r[1],a=r[2],o=e.shape,s=o[1],u=o[2],c=[n&&s>1?i-1:i,n&&u>1?a-1:a],l=[n&&s>1?s-1:s,n&&u>1?u-1:u],f=c[0]/l[0],d=c[1]/l[1],h=1/f,p=1/d,m=2*Math.ceil(h)+2,v=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+f+");\n        const float widthScale = float("+d+");\n\n        const float invHeightScale = float("+h+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+v+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+c[0]+") *\n                (float(dyR) / float("+l[0]+"));\n\n            float sourceFracCol =\n                float("+c[1]+") *\n                  (float(dyC) / float("+l[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+i+") - 1),\n                "+n+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+a+") - 1),\n                "+n+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "}(e,t,n);return this.compileAndRun(r,[e])},t.prototype.multinomial=function(e,t,n,r){var i=t?e:xi(e),a=i.shape[0],o=i.shape[1],s=new so(a,o,n),u=s.getCustomSetupFunc(r);return this.compileAndRun(s,[i],"int32",u)},t.prototype.oneHot=function(e,t,n,r){var i=new function(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+n+"),\n                      float(index == coords.y)));\n      }\n    "}(e.size,t,n,r);return this.compileAndRun(i,[e])},t.prototype.diag=function(e){var t=new function(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}(e.size);return this.compileAndRun(t,[e])},t.prototype.nonMaxSuppression=function(e,t,n,r,i){return gn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),$i(e.dataSync(),t.dataSync(),n,r,i)},t.prototype.cropAndResize=function(e,t,n,r,i,a){var o=new function(e,t,n,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var a=e[0],o=e[1],s=e[2],u=e[3],c=t[0],l=n[0],f=n[1];this.outputShape=[c,l,f,u];var d="bilinear"===r?1:0,h=[o-1+".0",s-1+".0"],p=h[0],m=h[1],v=l>1?[""+(o-1)/(l-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],g=v[0],y=v[1],b=v[2],x=f>1?[""+(s-1)/(f-1),"(x2-x1) * width_ratio","x1*"+m+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+m],w=x[0],_=x[1],k=x[2];this.userCode="\n      const float height_ratio = float("+g+");\n      const float width_ratio = float("+w+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+a+") {\n          return;\n        }\n\n        float height_scale = "+y+";\n        float width_scale = "+_+";\n\n        float in_y = "+b+";\n        if( in_y < 0.0 || in_y > "+p+" ) {\n          setOutput(float("+i+"));\n          return;\n        }\n        float in_x = "+k+";\n        if( in_x < 0.0 || in_x > "+m+" ) {\n          setOutput(float("+i+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+d+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "}(e.shape,t.shape,r,i,a);return this.compileAndRun(o,[e,t,n],"float32")},t.prototype.depthToSpace=function(e,t,n){A(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+t}));var r=e.shape[0],i="NHWC"===n?e.shape[1]:e.shape[2],a="NHWC"===n?e.shape[2]:e.shape[3],o="NHWC"===n?e.shape[3]:e.shape[1],s=i*t,u=a*t,c=o/(t*t),l=new Pa("NHWC"===n?[r,s,u,c]:[r,c,s,u],t,n);return this.compileAndRun(l,[e])},t.prototype.split=function(e,t,n){return na(e,t,n)},t.prototype.scatterND=function(e,t,n){var r=ri(0,e,n),i=r.sliceRank,a=r.numUpdates,o=r.sliceSize,s=r.strides,u=r.outputSize,c=[u/o,o],l=e.reshape([a,i]),f=t.reshape([a,o]);if(0===u)return Ui(Rn([]),n);var d=Bn(0),h=new lo(a,i,l.rank,f.rank,s,c);return this.compileAndRun(h,[f,l,d]).reshape(n)},t.prototype.sparseToDense=function(e,t,n,r){var i=ri(0,e,n),a=i.sliceRank,o=i.numUpdates,s=i.strides,u=i.outputSize,c=new lo(o,a,e.rank,t.rank,s,[u,1],!1);return this.compileAndRun(c,[t,e,r]).reshape(n)},t.prototype.fft=function(e){return this.fftImpl(e,!1)},t.prototype.ifft=function(e){return this.fftImpl(e,!0)},t.prototype.fftImpl=function(e,t){var n=this.texData.get(e.dataId),r=new Ba("return real * expR - imag * expI;",e.shape,t),i=new Ba("return real * expI + imag * expR;",e.shape,t),a=[this.makeComplexComponentTensorInfo(e,n.complexTensors.real),this.makeComplexComponentTensorInfo(e,n.complexTensors.imag)],o=this.compileAndRun(r,a),s=this.compileAndRun(i,a),u=this.complex(o,s).as2D(e.shape[0],e.shape[1]);return o.dispose(),s.dispose(),u},t.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],i=Jr(e,t),a=i[0],o=i[1],s=i[2],u=i[3],c=t.reshape([o,r]),l=e.reshape([e.size/s,s]),f=new function(e,t,n){this.sliceDim=e,this.strides=t,this.variableNames=["x","indices"],this.outputShape=n;var r=ba(t.length),i=ba(n.length),a=this.sliceDim>1?"strides[j]":"strides";this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+i+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+a+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "}(r,u,[o,s]);return this.compileAndRun(f,[l,c]).reshape(a)},t.prototype.fill=function(e,t,n){if("string"===(n=n||Z(t))){var r=W(n,j(e));return r.fill(t),We.makeTensor(r,e,n,this)}var i=new La(e,t),a=i.getCustomSetupFunc(t);return this.compileAndRun(i,[],n,a)},t.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){return this.fill(e.shape,"string"===e.dtype?"":0,e.dtype)},t.prototype.linspace=function(e,t,n){return Wi(e,t,n)},t.prototype.makeTensorInfo=function(e,t){var n=this.write(null,e,t);return this.texData.get(n).usage=null,{dataId:n,shape:e,dtype:t}},t.prototype.makeOutput=function(e,t){var n=this.makeTensorInfo(e,t).dataId;return We.makeTensorFromDataId(n,e,t,this)},t.prototype.unpackTensor=function(e){var t=new function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e;var t=e.length,n=sa("rc",t),r=ba(t),i=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(t,n),a=n.slice(-2),o=t<=1?"rc":"vec2("+a.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+i+");\n\n        setOutput(getChannel(packedInput, "+o+"));\n      }\n    "}(e.shape);return this.runWebGLProgram(t,[e],e.dtype)},t.prototype.packTensor=function(e){var t=new function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e;var t=e.length;if(0===t)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=sa("rc",t),r=ba(t),i=function(e,t,n){if(1===e)return"rc > "+t[0];for(var r="",i=e-2;i<e;i++)r+=n[i]+" >= "+t[i],i<e-1&&(r+="||");return r}(t,e,n),a=function(e,t,n,r){if(1===e)return"";var i=r.slice(-2);return"\n    int r = "+i[0]+";\n    int c = "+i[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+t+";\n    bool rEdge = rp1 >= "+n+";\n  "}(t,e[e.length-1],e[e.length-2],n),o=function(e,t){var n=e.length,r=function(e,t){for(var n=[],r=0;r<=1;r++)for(var i=0;i<=1;i++){for(var a=(0===r?"r":"rp1")+", "+(0===i?"c":"cp1"),o=2;o<e;o++)a=t[t.length-1-o]+","+a;n.push(a)}return n}(n,t);return 1===n?"getA(rc),\n            rc + 1 >= "+e[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+r[0]+"),\n          cEdge ? 0. : getA("+r[1]+"),\n          rEdge ? 0. : getA("+r[2]+"),\n          rEdge || cEdge ? 0. : getA("+r[3]+")"}(e,n);this.userCode="\n        void main() {\n          "+r+" rc = getOutputCoords();\n\n          if("+i+") {\n            setOutput(vec4(0));\n          } else {\n            "+a+"\n\n            setOutput(vec4("+o+"));\n          }\n        }\n      "}}(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)},t.prototype.packedReshape=function(e,t){var n=[Mt(e.shape)].concat(Ft(e.shape)),r={dtype:e.dtype,shape:n,dataId:e.dataId},i=new function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var n="",r=0;r<4;r++){var i="thisRC = rc;";r%2==1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),n+="\n        "+i+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+ca(["r","c","d"],t)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+la(e)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+e[1]+";\n        int cols = "+e[2]+";\n\n        "+n+"\n\n        setOutput(result);\n      }\n    "}([Mt(t)].concat(Ft(t)),n),a=this.runWebGLProgram(i,[r],e.dtype,null,!0);return{dataId:a.dataId,shape:t,dtype:a.dtype}},t.prototype.decode=function(e){var t,n=this.texData.get(e),r=n.isPacked,i=n.shape,a=n.dtype,o=It(i);return t=r?new function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=qe.DENSE;var t=Qe(e),n=ua();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+ca(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+n.output+" = result;\n      }\n    "}(o):new function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=qe.DENSE;var t=Qe(e),n=ua();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+ca(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+n.output+" = result;\n      }\n    "}(o),{dtype:a,shape:i,dataId:this.runWebGLProgram(t,[{shape:o,dtype:a,dataId:e}],a,null,!0).dataId}},t.prototype.runWebGLProgram=function(e,t,n,r,i){var a=this;void 0===i&&(i=!1);var o=this.makeTensorInfo(e.outputShape,n),s=this.texData.get(o.dataId);if(e.packedOutput&&(s.isPacked=!0),e.outPackingScheme===qe.DENSE){var u=Qe(e.outputShape);s.texShape=u.map((function(e){return 2*e}))}if(null!=e.outTexUsage&&(s.usage=e.outTexUsage),0===j(o.shape))return s.values=U(o.dtype,0),o;var c=[],l=t.map((function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=a.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&j(t.shape)<=f().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}else if(!!n.isPacked!=!!e.packedInputs)t=n.isPacked?a.unpackTensor(t):a.packTensor(t),c.push(t),n=a.texData.get(t.dataId);else if(n.isPacked&&!Pt(n.shape,t.shape)){var r=t,i=t.shape;t.shape=n.shape,t=a.packedReshape(t,i),c.push(t),n=a.texData.get(t.dataId),r.shape=i}return a.uploadToGPU(t.dataId),{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(o.dataId);var d,h={shape:o.shape,texData:s,isUniform:!1},p=function(e,t,n){var r="";l.concat(n).forEach((function(e){var t=null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0,n=e.isUniform?"uniform":e.texData.texShape;r+=e.shape+"_"+n+"_"+t}));var i=e.userCode;return e.constructor.name+"_"+r+"_"+i}(e,0,h),m=this.getAndSaveBinary(p,(function(){return function(e,t,n,r){var i=t.userCode,a=n.map((function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}})),o=a.map((function(e){return e.shapeInfo})),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},u=da(a,s,i,t.packedInputs),c=e.createProgram(u),l=null,d=e.getUniformLocation(c,"NAN",!1);1===f().getNumber("WEBGL_VERSION")&&(l=e.getUniformLocation(c,"INFINITY",!1));for(var h={},p=0;p<t.variableNames.length;p++){var m=t.variableNames[p];h[m]=e.getUniformLocation(c,m,!1),h["offset"+m]=e.getUniformLocation(c,"offset"+m,!1)}return{program:t,source:u,webGLProgram:c,uniformLocations:h,inShapeInfos:o,outShapeInfo:s,infLoc:l,nanLoc:d}}(a.gpgpu,e,l,h)})),v=null!=this.activeTimers;if(v&&(d=this.startTimer()),function(e,t,n,r,i){ao(t.inShapeInfos,n),ao([t.outShapeInfo],[r]);var a=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(a,o[0],o[1]):e.setOutputMatrixTexture(a,o[0],o[1]),e.setProgram(t.webGLProgram),1===f().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach((function(n,r){var i=t.program.variableNames[r],a=t.uniformLocations[i],o=t.uniformLocations["offset"+i];if(null!=a)if(n.isUniform)if(j(n.shape)<2)e.gl.uniform1f(a,n.uniformValues[0]);else{var s=n.uniformValues;s instanceof Float32Array||(s=new Float32Array(s)),e.gl.uniform1fv(a,s)}else null!=n.texData.slice&&null!=o&&e.gl.uniform1i(o,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture,a,r)})),null!=i&&i(e,t.webGLProgram),e.executeProgram()}(this.gpgpu,m,l,h,r),c.forEach((function(e){return a.disposeData(e.dataId)})),v&&(d=this.endTimer(d),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(d)})),!f().getBool("WEBGL_LAZILY_UNPACK")&&s.isPacked&&!1===i){var g=this.unpackTensor(o);return this.disposeData(o.dataId),g}return o},t.prototype.compileAndRun=function(e,t,n,r,i){void 0===i&&(i=!1),n=n||t[0].dtype;var a=this.runWebGLProgram(e,t,n,r,i);return We.makeTensorFromDataId(a.dataId,a.shape,a.dtype)},t.prototype.getAndSaveBinary=function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]},t.prototype.getTextureManager=function(){return this.textureManager},t.prototype.dispose=function(){var e=this;this.disposed||(f().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((function(t){e.gpgpu.deleteProgram(e.binaryCache[t].webGLProgram),delete e.binaryCache[t]})),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},t.prototype.floatPrecision=function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=rn((function(){if(!f().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=f().getBool("DEBUG");f().set("DEBUG",!1);var n=e.abs(Bn(1e-8)).dataSync()[0];if(f().set("DEBUG",t),n>0)return 32}return 16}))),this.floatPrecisionValue},t.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},t.prototype.uploadToGPU=function(e){var t,n=this.texData.get(e),r=n.shape,i=n.dtype,a=n.values,o=n.texture,s=n.usage,u=n.isPacked;if(null==o){var c,l=null!=this.activeTimers;l&&(c=oe());var f=n.texShape;if(null==f&&(f=Nt(r,u),n.texShape=f),null!=a){var d=It(r),h=void 0,p=f[1],m=f[0],v=a instanceof Uint8Array;u?(p=(t=et(f[0],f[1]))[0],h=new function(e,t,n){void 0===n&&(n=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=ua(),i=t[0],a=t[1];this.outputShape=e;var o="",s="result";n&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var c=0;c<=1;c++){var l=2*u+c;o+="\n          localCoords = coords;\n          if(localCoords[2] + "+c+" < "+e[2]+") {\n            localCoords[2] += "+c+";\n            if(localCoords[1] + "+u+" < "+e[1]+") {\n              localCoords[1] += "+u+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / "+a+";\n              c = imod(flatIndex, "+a+");\n              uv = (vec2(c, r) + halfCR) / vec2("+a+".0, "+i+".0);\n              values = "+r.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+l+"] = values[0];\n              } else if(offset == 1) {\n                result["+l+"] = values[1];\n              } else if(offset == 2) {\n                result["+l+"] = values[2];\n              } else {\n                result["+l+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+la(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        "+o+"\n\n        "+r.output+" = "+s+";\n      }\n    "}(d,[m=t[1],p],v)):h=new function(e,t,n){void 0===n&&(n=!1),this.variableNames=["A"];var r=ua(),i=t[0],a=t[1];this.outputShape=e;var o="result";n&&(o="floor(result * 255. + 0.5)"),this.userCode="\n      "+la(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n        \n        int r = flatIndex / "+a+";\n        int c = imod(flatIndex, "+a+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+a+".0, "+i+".0);\n        vec4 values = "+r.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+r.output+" = vec4("+o+", 0., 0., 0.);\n      }\n    "}(d,[m,p],v);var g=this.makeTensorInfo([m,p],i);this.texData.get(g.dataId).usage=v?He.PIXELS:He.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(g.dataId),p,m,a);var y=this.runWebGLProgram(h,[g],i,null,!0),b=this.texData.get(y.dataId);n.texture=b.texture,n.texShape=b.texShape,n.isPacked=b.isPacked,n.usage=b.usage,this.disposeData(g.dataId),this.texData.delete(y.dataId),n.values=null,l&&(this.uploadWaitMs+=oe()-c)}else{var x=this.acquireTexture(f,s,i,u);n.texture=x}}},t.prototype.convertAndCacheOnCPU=function(e,t){var n=this.texData.get(e),r=n.dtype;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype "+t)}(t,r)),n.values},t.prototype.acquireTexture=function(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+i+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(e,t,r)},t.prototype.computeBytes=function(e,t){return e[0]*e[1]*X(t)},t}(ki);Ve()&&We.registerBackend("webgl",(function(){return new Uo}),2);var Wo=Mn({square_:function(e){var t=xn(e,"x","square"),n=[t];return We.runKernelFunc((function(e,n){return n([t]),e.square(t)}),{x:t},null,"Square",{},n,[])}}),Vo="SquaredDifference",Go=Mn({squaredDifference_:function(e,t){var n,r=xn(e,"a","squaredDifference"),i=xn(t,"b","squaredDifference");n=Ne(r,i),r=n[0],i=n[1],Ai(r.shape,i.shape);var a={a:r,b:i},o=[r,i];return We.runKernelFunc((function(e,t){var n=e.squaredDifference(r,i);return t([r,i]),n}),a,(function(e,t){var n=t[0],r=t[1],i=Bn(2);return{a:function(){return e.mul(n.sub(r).mul(i))},b:function(){return e.mul(r.sub(n).mul(i))}}}),Vo,{},o,[])}}),qo=Mn({abs_:function(e){var t=xn(e,"x","abs");return"complex64"===t.dtype?We.runKernelFunc((function(e){return e.complexAbs(t)}),{$x:t}):We.runKernelFunc((function(e,n){var r=e.abs(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().step(-1))}}}),"Abs")}}),Ho=Mn({acos_:function(e){var t=xn(e,"x","acos");return We.runKernelFunc((function(e,n){var r=e.acos(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(Bn(1).sub(n.toFloat().square()).sqrt()).neg()}}}))}}),Xo=Mn({acosh_:function(e){var t=xn(e,"x","acosh");return We.runKernelFunc((function(e,n){var r=e.acosh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(n.toFloat().square().sub(1).sqrt())}}}))}}),Ko=Mn({asin_:function(e){var t=xn(e,"x","asin");return We.runKernelFunc((function(e,n){var r=e.asin(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(Bn(1).sub(n.toFloat().square()).sqrt())}}}))}}),Yo=Mn({asinh_:function(e){var t=xn(e,"x","asinh");return We.runKernelFunc((function(e,n){var r=e.asinh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(Bn(1).add(n.toFloat().square()).sqrt())}}}))}}),$o=Mn({atan_:function(e){var t=xn(e,"x","atan");return We.runKernelFunc((function(e,n){var r=e.atan(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().square().add(1))}}}))}}),Jo=Mn({atanh_:function(e){var t=xn(e,"x","atanh");return We.runKernelFunc((function(e,n){var r=e.atanh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(Bn(1).sub(n.toFloat().square()))}}}))}}),Zo=Mn({ceil_:function(e){var t=xn(e,"x","ceil");return We.runKernelFunc((function(e){return e.ceil(t)}),{$x:t},(function(e){return{$x:function(){return Zn(e)}}}))}}),Qo=Mn({clipByValue_:function(e,t,n){var r=xn(e,"x","clipByValue");A(t<=n,(function(){return"Error in clip: min ("+t+") must be less than or equal to max ("+n+")."}));var i=[r],a={min:t,max:n};return We.runKernelFunc((function(e,i){var a=e.clip(r,t,n);return i([r]),a}),{x:r},(function(e,r){var i=r[0];return{x:function(){return e.where(i.greaterEqual(t).logicalAnd(i.lessEqual(n)),Zn(e))}}}),"ClipByValue",a,i)}}),es=Mn({cos_:function(e){var t=xn(e,"x","cos"),n=[t];return We.runKernelFunc((function(e,n){var r=e.cos(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return n.toFloat().sin().neg().mul(e)}}}),"Cos",{},n)}}),ts=Mn({cosh_:function(e){var t=xn(e,"x","cosh");return We.runKernelFunc((function(e,n){var r=e.cosh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return n.toFloat().sinh().mulStrict(e)}}}))}}),ns=Mn({erf_:function(e){var t=xn(e,"x","erf");return A("int32"===t.dtype||"float32"===t.dtype,(function(){return"Input dtype must be `int32` or `float32`."})),"int32"===t.dtype&&(t=t.toFloat()),We.runKernelFunc((function(e,n){var r=e.erf(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}}))}}),rs=Mn({exp_:function(e){var t=xn(e,"x","exp");return We.runKernelFunc((function(e,n){var r=e.exp(t);return n([r]),r}),{x:t},(function(e,t){return{x:function(){return e.mulStrict(t[0])}}}),"Exp",{},[],[!0])}}),is=Mn({expm1_:function(e){var t=xn(e,"x","expm1");return We.runKernelFunc((function(e,n){var r=e.expm1(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.exp())}}}))}}),as=Mn({floor_:function(e){var t=xn(e,"x","floor");return We.runKernelFunc((function(e){return e.floor(t)}),{$x:t},(function(e){return{$x:function(){return Zn(e)}}}))}}),os=Mn({log_:function(e){var t=xn(e,"x","log"),n=[t];return We.runKernelFunc((function(e,n){var r=e.log(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.div(n.toFloat())}}}),"Log",{},n)}}),ss=Mn({log1p_:function(e){var t=xn(e,"x","log1p");return We.runKernelFunc((function(e,n){var r=e.log1p(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.add(1))}}}))}}),us=Mn({logSigmoid_:function(e){var t=xn(e,"x","logSigmoid");return We.runKernelFunc((function(e,n){var r=e.softplus(t.neg()).neg();return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.neg().sigmoid())}}}))}}),cs=Mn({neg_:function(e){var t=xn(e,"x","neg"),n=[t];return We.runKernelFunc((function(e){return e.neg(t)}),{x:t},(function(e){return{x:function(){return e.neg()}}}),"Neg",{},n)}}),ls=Mn({reciprocal_:function(e){var t=xn(e,"x","reciprocal");return We.runKernelFunc((function(e,n){var r=e.reciprocal(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.square().neg())}}}))}}),fs=Mn({round_:function(e){var t=xn(e,"x","round");return We.runKernelFunc((function(e){return e.round(t)}),{$x:t},(function(e){return{$x:function(){return Zn(e)}}}))}}),ds=Mn({rsqrt_:function(e){var t=xn(e,"x","rsqrt"),n=[t];return We.runKernelFunc((function(e,n){var r=e.rsqrt(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.div(n.pow(1.5).mul(2)).neg()}}}),"Rsqrt",{},n)}}),hs=Mn({sigmoid_:function(e){var t=xn(e,"x","sigmoid");return We.runKernelFunc((function(e,n){var r=e.sigmoid(t);return n([r]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.mul(n.mul(Bn(1).sub(n)))}}}),"Sigmoid")}}),ps=Mn({sign_:function(e){var t=xn(e,"x","sign");return We.runKernelFunc((function(e){return e.sign(t)}),{$x:t},(function(e){return{$x:function(){return Zn(e)}}}))}}),ms=Mn({isNaN_:function(e){var t=xn(e,"x","isNaN");return We.runKernelFunc((function(e){return e.isNaN(t)}),{$x:t},(function(e){return{$x:function(){return Zn(e)}}}))}}),vs=Mn({isInf_:function(e){var t=xn(e,"x","isInf");return We.runKernelFunc((function(e){return e.isInf(t)}),{$x:t},(function(e){return{$x:function(){return Zn(e)}}}))}}),gs=Mn({isFinite_:function(e){var t=xn(e,"x","isFinite");return We.runKernelFunc((function(e){return e.isFinite(t)}),{$x:t},(function(e){return{$x:function(){return Zn(e)}}}))}}),ys=Mn({sin_:function(e){var t=xn(e,"x","sin"),n=[t];return We.runKernelFunc((function(e,n){var r=e.sin(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return n.toFloat().cos().mul(e)}}}),"Sin",{},n)}}),bs=Mn({sinh_:function(e){var t=xn(e,"x","sinh");return We.runKernelFunc((function(e,n){var r=e.sinh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return n.toFloat().cosh().mulStrict(e)}}}))}}),xs=Mn({softplus_:function(e){var t=xn(e,"x","softplus");return We.runKernelFunc((function(e,n){var r=e.softplus(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.sigmoid())}}}))}}),ws=Mn({sqrt_:function(e){var t=xn(e,"x","sqrt");return We.runKernelFunc((function(e,n){var r=e.sqrt(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().sqrt().mul(2))}}}))}}),_s=Mn({step_:function(e,t){void 0===t&&(t=0);var n=xn(e,"x","step");return We.runKernelFunc((function(e){return e.step(n,t)}),{$x:n},(function(e){return{$x:function(){return Zn(e)}}}))}}),ks=Mn({tan_:function(e){var t=xn(e,"x","tan");return We.runKernelFunc((function(e,n){var r=e.tan(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.cos().square())}}}))}}),Es=Mn({tanh_:function(e){var t=xn(e,"x","tanh");return We.runKernelFunc((function(e,n){var r=e.tanh(t);return n([r]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return Bn(1).sub(n.square()).mulStrict(e)}}}),"Tanh",{},null,[!0])}});function Ss(e,t,n,r,i,a){var o,s,u=xn(e,"x","batchNorm"),c=xn(t,"mean","batchNorm"),l=xn(n,"variance","batchNorm");return null!=i&&(o=xn(i,"scale","batchNorm")),null!=r&&(s=xn(r,"offset","batchNorm")),A(2===u.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."})),A(2===c.rank||1===c.rank,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+c.rank+"."})),A(2===l.rank||1===l.rank,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+l.rank+"."})),null!=o&&A(2===o.rank||1===o.rank,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+o.rank+"."})),null!=s&&A(2===s.rank||1===s.rank,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."})),Os(u,c,l,s,o,a)}function Cs(e,t,n,r,i,a){var o,s,u=xn(e,"x","batchNorm"),c=xn(t,"mean","batchNorm"),l=xn(n,"variance","batchNorm");return null!=i&&(o=xn(i,"scale","batchNorm")),null!=r&&(s=xn(r,"offset","batchNorm")),A(3===u.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."})),A(3===c.rank||1===c.rank,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+c.rank+"."})),A(3===l.rank||1===l.rank,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+l.rank+"."})),null!=o&&A(3===o.rank||1===o.rank,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+o.rank+"."})),null!=s&&A(3===s.rank||1===s.rank,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."})),Os(u,c,l,s,o,a)}function As(e,t,n,r,i,a){var o,s,u=xn(e,"x","batchNorm"),c=xn(t,"mean","batchNorm"),l=xn(n,"variance","batchNorm");return null!=i&&(o=xn(i,"scale","batchNorm")),null!=r&&(s=xn(r,"offset","batchNorm")),A(4===u.rank,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."})),A(4===c.rank||1===c.rank,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+c.rank+"."})),A(4===l.rank||1===l.rank,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+l.rank+"."})),null!=o&&A(4===o.rank||1===o.rank,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+o.rank+"."})),null!=s&&A(4===s.rank||1===s.rank,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."})),Os(u,c,l,s,o,a)}function Os(e,t,n,r,i,a){null==a&&(a=.001);var o,s,u,c=xn(e,"x","batchNorm"),l=xn(t,"mean","batchNorm"),f=xn(n,"variance","batchNorm");null!=i&&(o=xn(i,"scale","batchNorm")),null!=r&&(s=xn(r,"offset","batchNorm")),A(l.rank===f.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),A(null==s||l.rank===s.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),A(null==o||l.rank===o.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."})),u=0===c.rank||1===c.rank?c.as4D(1,1,1,c.size):2===c.rank?c.as4D(1,1,c.shape[0],c.shape[1]):3===c.rank?c.as4D(1,c.shape[0],c.shape[1],c.shape[2]):c;var d=[c,l,f,o];return We.runKernelFunc((function(e,t){var n=e.batchNormalization(u,Ds(l),Ds(f),a,Ds(o),Ds(s));return t([c,l,f,o]),n}),{x:c,mean:l,variance:f,scale:o,offset:s},(function(e,t){var n=t,r=n[0],i=n[1],o=n[2],s=n[3],c=null==s?Bn(1):s,l=Ci(i.shape,u.shape),f=[];if(1===i.rank){for(var d=0;d<u.shape.length-1;++d)f.push(u.shape[d]);f.push(1)}var h=r.sub(i),p=e.mul(c),m=ds(o.add(Bn(a))),v=m.mul(m).mul(m).mul(Bn(-.5));return{x:function(){return 1===i.rank?e.mul(Wr(m.as4D(1,1,1,i.shape[0]),f)).mul(c).reshape(r.shape):e.mul(m).mul(c).reshape(r.shape)},mean:function(){var e=m.mul(Bn(-1)).mul(p);return 1===i.rank&&(e=e.sum(l)),e.reshape(i.shape)},variance:function(){var e=v.mul(h).mul(p);return 1===i.rank&&(e=e.sum(l)),e.reshape(i.shape)},scale:function(){var t=h.mul(m),n=e.mul(t);return 1===i.rank&&(n=n.sum(l)),n.reshape(i.shape)},offset:function(){var t=e;return 1===i.rank&&(t=t.sum(l)),t.reshape(i.shape)}}}),"BatchNormalization",{varianceEpsilon:a},d).reshape(c.shape)}function Ds(e){return null==e?null:0===e.rank?e.as1D():1===e.rank?e:2===e.rank?e.as4D(1,1,e.shape[0],e.shape[1]):3===e.rank?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}function Ts(){Zt("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var js=Mn({batchNormalization2d_:function(e,t,n,r,i,a){return void 0===r&&(r=.001),Ts(),Ss(e,t,n,a,i,r)}}),Ms=Mn({batchNormalization3d_:function(e,t,n,r,i,a){return void 0===r&&(r=.001),Ts(),Cs(e,t,n,a,i,r)}}),Fs=Mn({batchNormalization4d_:function(e,t,n,r,i,a){return void 0===r&&(r=.001),Ts(),As(e,t,n,a,i,r)}}),Is=Mn({batchNormalization_:function(e,t,n,r,i,a){return void 0===r&&(r=.001),Ts(),Os(e,t,n,a,i,r)}}),Ns=Mn({batchNorm_:Os}),Rs=Mn({batchNorm2d_:Ss}),Ps=Mn({batchNorm3d_:Cs}),Bs=Mn({batchNorm4d_:As}),Ls=Mn({logicalAnd_:function(e,t){var n=xn(e,"a","logicalAnd","bool"),r=xn(t,"b","logicalAnd","bool");return Ai(n.shape,r.shape),We.runKernelFunc((function(e){return e.logicalAnd(n,r)}),{a:n,b:r},null,"LogicalAnd")}}),zs=Mn({logicalNot_:function(e){var t=xn(e,"x","logicalNot","bool");return We.runKernelFunc((function(e){return e.logicalNot(t)}),{$x:t})}}),Us=Mn({logicalOr_:function(e,t){var n=xn(e,"a","logicalOr","bool"),r=xn(t,"b","logicalOr","bool");return Ai(n.shape,r.shape),We.runKernelFunc((function(e){return e.logicalOr(n,r)}),{$a:n,$b:r})}}),Ws=Mn({logicalXor_:function(e,t){var n=xn(e,"a","logicalXor","bool"),r=xn(t,"b","logicalXor","bool");return Ai(n.shape,r.shape),Us(e,t).logicalAnd(Ls(e,t).logicalNot())}}),Vs=Mn({where_:function(e,t,n){var r=xn(t,"a","where"),i=xn(n,"b","where"),a=xn(e,"condition","where","bool");return O(r.shape,i.shape,"Error in where: "),1===a.rank?A(a.shape[0]===r.shape[0],(function(){return"The first dimension of `a` must match the size of `condition`."})):O(a.shape,i.shape,"Error in where: "),We.runKernelFunc((function(e,t){var n=e.select(a,r,i);return t([a]),n}),{$condition:a,$a:r,$b:i},(function(e,t){var n=t[0];return{$condition:function(){return Zn(n).toFloat()},$a:function(){return e.mul(n.cast(e.dtype))},$b:function(){return e.mul(n.logicalNot().cast(e.dtype))}}}))}}),Gs=function(e){return u(this,void 0,void 0,(function(){var t,n,r;return c(this,(function(i){switch(i.label){case 0:return[4,(t=xn(e,"condition","whereAsync","bool")).data()];case 1:return n=i.sent(),r=aa(t.shape,n),e!==t&&t.dispose(),[2,r]}}))}))},qs=Mn({add_:function(e,t){var n,r=xn(e,"a","add"),i=xn(t,"b","add");n=Ne(r,i),r=n[0],i=n[1];var a=Ai(r.shape,i.shape);return We.runKernelFunc((function(e){return e.add(r,i)}),{a:r,b:i},(function(e){return{a:function(){var t=e,n=Ci(r.shape,a);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},b:function(){var t=e,n=Ci(i.shape,a);return n.length>0&&(t=t.sum(n)),t.reshape(i.shape)}}}),"Add")}}),Hs=Mn({addN_:function(e){A(Array.isArray(e),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),A(e.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got "+e.length}));var t=e.map((function(e,t){return xn(e,"tensors"+t,"addN")})),n=t[0];t.forEach((function(e){if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),t.forEach((function(e){if(!M(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));var r=t;return We.runKernelFunc((function(e){return e.addN(t)}),r,(function(e){var n={};return t.forEach((function(t,r){n[r]=function(){return e.clone()}})),n}),"AddN")}}),Xs=Mn({addStrict_:function(e,t){var n=xn(e,"a","addStrict"),r=xn(t,"b","addStrict");return O(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),Ks=Mn({atan2_:function(e,t){var n,r=xn(e,"a","atan2"),i=xn(t,"b","atan2");n=Ne(r,i),r=n[0],i=n[1];var a=Ai(r.shape,i.shape);return We.runKernelFunc((function(e,t){var n=e.atan2(r,i);return t([r,i]),n}),{$a:r,$b:i},(function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=qs(n.square(),r.square()),i=e.mul(r.div(t)),o=Ci(n.shape,a);return o.length>0&&(i=i.sum(o)),i.reshape(n.shape)},$b:function(){var t=qs(n.square(),r.square()),i=cs(e.mul(n.div(t))),o=Ci(r.shape,a);return o.length>0&&(i=i.sum(o)),i.reshape(r.shape)}}}))}}),Ys=Mn({div_:function(e,t){var n,r=xn(e,"a","div"),i=xn(t,"b","div");if(n=Ne(r,i),r=n[0],i=n[1],"int32"===r.dtype&&"int32"===i.dtype)return Zs(r,i);var a=Ai(r.shape,i.shape);return We.runKernelFunc((function(e,t){var n=e.realDivide(r,i);return t([r,i]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.div(r.toFloat()),i=Ci(n.shape,a);return i.length>0?t.sum(i).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),i=Ci(r.shape,a);i.length>0&&(t=t.sum(i).reshape(r.shape));var o=r.square();return t.div(o.toFloat()).neg()}}}),"Div")}}),$s=Mn({divNoNan_:function(e,t){var n,r=xn(e,"a","div"),i=xn(t,"b","div");r=(n=Ne(r,i))[0],i=n[1];var a=Ys(r,i),o=Zn(a),s=i.equal(o);return Vs(s,o,a)}}),Js=Mn({divStrict_:function(e,t){var n=xn(e,"a","div"),r=xn(t,"b","div");return O(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),Zs=Mn({floorDiv_:function(e,t){var n,r=xn(e,"a","floorDiv"),i=xn(t,"b","floorDiv");n=Ne(r,i),r=n[0],i=n[1];var a=Ai(r.shape,i.shape);return We.runKernelFunc((function(e,t){var n=e.floorDiv(r,i);return t([r,i]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.div(r.toFloat()),i=Ci(n.shape,a);return i.length>0?t.sum(i).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),i=Ci(r.shape,a);i.length>0&&(t=t.sum(i).reshape(r.shape));var o=r.square();return t.div(o.toFloat()).neg()}}}),"FloorDiv")}}),Qs=Mn({maximum_:function(e,t){var n,r=xn(e,"a","maximum"),i=xn(t,"b","maximum");return n=Ne(r,i),r=n[0],i=n[1],"bool"===r.dtype&&(r=r.toInt(),i=i.toInt()),Ai(r.shape,i.shape),We.runKernelFunc((function(e,t){var n=e.maximum(r,i);return t([r,i]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1];return{a:function(){return e.mul(n.greaterEqual(r).toFloat())},b:function(){return e.mul(n.less(r).toFloat())}}}),"Maximum")}}),eu=Mn({maximumStrict_:function(e,t){var n=xn(e,"a","maximumStrict"),r=xn(t,"b","maximumStrict");return O(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),tu=Mn({minimum_:function(e,t){var n,r=xn(e,"a","minimum"),i=xn(t,"b","minimum");return n=Ne(r,i),r=n[0],i=n[1],"bool"===r.dtype&&(r=r.toInt(),i=i.toInt()),Ai(r.shape,i.shape),We.runKernelFunc((function(e,t){var n=e.minimum(r,i);return t([r,i]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1];return{a:function(){return e.mul(n.lessEqual(r).toFloat())},b:function(){return e.mul(n.greater(r).toFloat())}}}),"Minimum")}}),nu=Mn({minimumStrict_:function(e,t){var n=xn(e,"a","minimumStrict"),r=xn(t,"b","minimumStrict");return O(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),ru=Mn({mod_:function(e,t){var n,r=xn(e,"a","mod"),i=xn(t,"b","mod");n=Ne(r,i),r=n[0],i=n[1];var a=Ai(r.shape,i.shape);return We.runKernelFunc((function(e,t){var n=e.mod(r,i);return t([r,i]),n}),{$a:r,$b:i},(function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=Ci(n.shape,a);return t.length>0?e.sum(t).reshape(n.shape):e},$b:function(){var t=e.mul(n.div(r).floor().neg()),i=Ci(r.shape,a);return i.length>0?t.sum(i).reshape(r.shape):t}}}))}}),iu=Mn({modStrict_:function(e,t){var n=xn(e,"a","modStrict"),r=xn(t,"b","modStrict");return O(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),au=Mn({mul_:function(e,t){var n,r=xn(e,"a","mul"),i=xn(t,"b","mul");n=Ne(r,i),r=n[0],i=n[1];var a=Ai(r.shape,i.shape);return We.runKernelFunc((function(e,t){var n=e.multiply(r,i);return t([r,i]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.mul(r.toFloat()),i=Ci(n.shape,a);return i.length>0?t.sum(i).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),i=Ci(r.shape,a);return i.length>0?t.sum(i).reshape(r.shape):t}}}),"Mul")}}),ou=Mn({mulStrict_:function(e,t){var n=xn(e,"a","mul"),r=xn(t,"b","mul");return O(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),su=Mn({pow_:function(e,t){var n,r=xn(e,"base","pow"),i=xn(t,"exp","pow");n=Ne(r,i),r=n[0],i=n[1];var a=Ai(r.shape,i.shape),o=[r,i];return We.runKernelFunc((function(e,t){var n=e.pow(r,i);return t([r,i,n]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1],i=t[2];return{a:function(){var t=r.toFloat(),i=e.mul(t.mul(n.pow(t.sub(Bn(1))))),o=Ci(n.shape,a);return o.length>0&&(i=i.sum(o)),i.reshape(n.shape)},b:function(){var t=n.greater(0),o=n.log().where(t,Zn(n)),s=e.mul(i.mul(o)),u=Ci(r.shape,a);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)}}}),"Pow",{},o,[!0])}}),uu=Mn({powStrict_:function(e,t){return O(e.shape,t.shape,"Error in powStrict: "),e.pow(t)}}),cu=Mn({squaredDifferenceStrict_:function(e,t){var n=xn(e,"a","squaredDifferenceStrict"),r=xn(t,"b","squaredDifferenceStrict");return O(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),lu=Mn({sub_:function(e,t){var n,r=xn(e,"a","sub"),i=xn(t,"b","sub");n=Ne(r,i),r=n[0],i=n[1];var a=Ai(r.shape,i.shape);return We.runKernelFunc((function(e){return e.subtract(r,i)}),{a:r,b:i},(function(e){return{a:function(){var t=e,n=Ci(r.shape,a);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},b:function(){var t=e,n=Ci(i.shape,a);return n.length>0&&(t=t.sum(n)),t.neg().reshape(i.shape)}}}),"Sub")}}),fu=Mn({subStrict_:function(e,t){var n=xn(e,"a","subStrict"),r=xn(t,"b","subStrict");return O(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}}),du=Mn({equal_:function(e,t){var n,r=xn(e,"a","equal"),i=xn(t,"b","equal");return n=Ne(r,i),r=n[0],i=n[1],Ai(r.shape,i.shape),We.runKernelFunc((function(e){return e.equal(r,i)}),{$a:r,$b:i})}}),hu=Mn({equalStrict_:function(e,t){var n=xn(e,"a","equalStrict"),r=xn(t,"b","equalStrict");return O(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),pu=Mn({greater_:function(e,t){var n,r=xn(e,"a","greater"),i=xn(t,"b","greater");return n=Ne(r,i),r=n[0],i=n[1],Ai(r.shape,i.shape),We.runKernelFunc((function(e){return e.greater(r,i)}),{a:r,b:i},null,"Greater")}}),mu=Mn({greaterEqual_:function(e,t){var n,r=xn(e,"a","greaterEqual"),i=xn(t,"b","greaterEqual");return n=Ne(r,i),r=n[0],i=n[1],Ai(r.shape,i.shape),We.runKernelFunc((function(e,t){var n=e.greaterEqual(r,i);return t([r,i]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1];return{a:function(){return Zn(n)},b:function(){return Zn(r)}}}),"GreaterEqual")}}),vu=Mn({greaterEqualStrict_:function(e,t){var n=xn(e,"a","greaterEqualStrict"),r=xn(t,"b","greaterEqualStrict");return O(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),gu=Mn({greaterStrict_:function(e,t){var n=xn(e,"a","greaterStrict"),r=xn(t,"b","greaterStrict");return O(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),yu=Mn({less_:function(e,t){var n,r=xn(e,"a","less"),i=xn(t,"b","less");return n=Ne(r,i),r=n[0],i=n[1],Ai(r.shape,i.shape),We.runKernelFunc((function(e){return e.less(r,i)}),{a:r,b:i},null,"Less")}}),bu=Mn({lessEqual_:function(e,t){var n,r=xn(e,"a","lessEqual"),i=xn(t,"b","lessEqual");return n=Ne(r,i),r=n[0],i=n[1],Ai(r.shape,i.shape),We.runKernelFunc((function(e,t){var n=e.lessEqual(r,i);return t([r,i]),n}),{a:r,b:i},null,"LessEqual")}}),xu=Mn({lessEqualStrict_:function(e,t){var n=xn(e,"a","lessEqualStrict"),r=xn(t,"b","lessEqualStrict");return O(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),wu=Mn({lessStrict_:function(e,t){var n=xn(e,"a","lessStrict"),r=xn(t,"b","lessStrict");return O(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),_u=Mn({notEqual_:function(e,t){var n,r=xn(e,"a","notEqual"),i=xn(t,"b","notEqual");return n=Ne(r,i),r=n[0],i=n[1],Ai(r.shape,i.shape),We.runKernelFunc((function(e){return e.notEqual(r,i)}),{a:r,b:i},null,"NotEqual")}}),ku=Mn({notEqualStrict_:function(e,t){var n=xn(e,"a","notEqualStrict"),r=xn(t,"b","notEqualStrict");return O(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}});function Eu(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function Su(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var Cu=Mn({gather_:function(e,t,n){void 0===n&&(n=0);var r=xn(e,"x","gather"),i=xn(t,"indices","gather","int32");n=L(n,r.shape)[0];var a=function(e,t,n){for(var r=e.shape[n],i=[],a=1,o=1,s=0;s<n;s++)i.push(e.shape[s]),a*=e.shape[s];for(s=0;s<t.rank;s++)i.push(t.shape[s]);for(s=n+1;s<e.rank;s++)i.push(e.shape[s]),o*=e.shape[s];return{batchSize:a,sliceSize:o,dimSize:r,outputShape:i}}(r,i,n);return We.runKernelFunc((function(e,t){var a=e.gather(r,i.flatten(),n);return t([i]),a}),{x:r,indices:i},(function(e,t){var i=t[0];return{x:function(){var t=r.shape,a=i.size,o=t.slice(0,n),s=o.length,u=t.slice(n,t.length).slice(1),c=u.length,l=Eu(0,s),f=Eu(s+1,s+1+c),d=Su([o,[a],u]),h=e.reshape(d),p=i.reshape([a]),m=Su([[s],l,f]),v=h.transpose(m),g=Au(v,p,r.shape[n]),y=On(m);return g.transpose(y)},indices:function(){return i}}}),"Gather",{axis:n}).reshape(a.outputShape)}}),Au=Mn({unsortedSegmentSum_:function(e,t,n){var r=xn(e,"x","unsortedSegmentSum"),i=xn(t,"segmentIds","unsortedSegmentSum","int32");return A(F(n),(function(){return"numSegments must be of dtype int"})),We.runKernelFunc((function(e,t){var a=e.unsortedSegmentSum(r,i,n);return t([i]),a}),{$x:r},(function(e,t){var n=t[0];return{$x:function(){return function(e,t){for(var n=Qs(t,Zn(t)),r=Cu(e,n),i=mu(t,Bn(0,"int32")),a=r.rank-i.rank,o=0;o<a;++o)i=Sr(i,o+1);i=Ls(i,Hn(r.shape,"bool"));var s=Zn(r);return Vs(i,r,s)}(e,n)}}}))}}),Ou=function(e,t,n){return u(this,void 0,void 0,(function(){var r,i,a,o,s,u,l,f,d,h,p,m,v;return c(this,(function(c){switch(c.label){case 0:for(r=xn(e,"tensor","boolMask"),i=xn(t,"mask","boolMask","bool"),a=null==n?0:n,o=i.rank,s=r.shape,A(o>0,(function(){return"mask cannot be scalar"})),O(s.slice(a,a+o),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,l=a;l<a+o;l++)u*=s[l];return f=s.slice(0,a).concat([u],s.slice(a+o)),d=r.reshape(f),h=i.reshape([-1]),[4,Gs(h)];case 1:return p=c.sent(),m=p.squeeze([1]),v=Cu(d,m,a),e!==r&&r.dispose(),t!==i&&i.dispose(),m.dispose(),d.dispose(),h.dispose(),p.dispose(),[2,v]}}))}))};function Du(e,t,n,r,i,a,o){void 0===a&&(a="NHWC"),A(e.length===t.rank,(function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"}));var s=e,u=t,c=!1;3===t.rank&&(c=!0,u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),s=[1,e[0],e[1],e[2]]),A(4===s.length,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."})),A(4===u.rank,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank})),A(4===n.rank,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank}));var l="NHWC"===a?s[3]:s[1],f="NHWC"===a?u.shape[3]:u.shape[1];A(l===n.shape[2],(function(){return"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+n.shape[2]+"."})),A(f===n.shape[3],(function(){return"Error in conv2dDerInput: depth of output ("+f+") must match output depth for filter "+n.shape[3]+"."})),null!=o&&A(F(i),(function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."}));var d=Li(a),h=Ti(s,n.shape,r,1,i,o,!1,d),p=We.runKernelFunc((function(e,t){var r=e.conv2dDerInput(u,n,h);return t([n,u]),r}),{dy4D:u,filter:n},(function(e,t){var n=t[0],s=t[1];return{dy4D:function(){return Fu(e,n,r,i,a,1,o)},filter:function(){return Nu(e,s,n.shape,r,i,a,o)}}}));return c?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function Tu(e){var t=function(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}(e),n=t[0],r=t[1],i=t[2];return 1===n&&1===r&&1===i}function ju(e,t,n,r,i){A(e.length===t.rank,(function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"}));var a=e,o=t,s=!1;4===t.rank&&(s=!0,o=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]),a=[1,e[0],e[1],e[2],e[3]]);var u=a[4],c=o.shape[4];A(5===a.length,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+a.length+"."})),A(5===o.rank,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+o.rank})),A(5===n.rank,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank})),A(u===n.shape[3],(function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+n.shape[3]+"."})),A(c===n.shape[4],(function(){return"Error in conv3dDerInput: depth of output ("+c+") must match output depth for filter "+n.shape[4]+"."}));var l=ji(a,n.shape,r,1,i),f=We.runKernelFunc((function(e){return e.conv3dDerInput(o,n,l)}),{dy5D:o});return s?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}var Mu=Mn({conv1d_:function(e,t,n,r,i,a,o){void 0===i&&(i="NWC"),void 0===a&&(a=1);var s=xn(e,"x","conv1d"),u=xn(t,"filter","conv1d"),c=s,l=!1;2===s.rank&&(l=!0,c=s.as3D(1,s.shape[0],s.shape[1])),A(3===c.rank,(function(){return"Error in conv1d: input must be rank 3, but got rank "+c.rank+"."})),A(3===u.rank,(function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."})),null!=o&&A(F(r),(function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."})),A(c.shape[2]===u.shape[1],(function(){return"Error in conv1d: depth of input ("+c.shape[2]+") must match input depth for filter "+u.shape[1]+"."})),A(Bi(n,a),(function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+a+"'"})),A("NWC"===i,(function(){return"Error in conv1d: got dataFormat of "+i+" but only NWC is currently supported."}));var f=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),d=c.as4D(c.shape[0],1,c.shape[1],c.shape[2]),h=Fu(d,f,[1,n],r,"NHWC",[1,a],o);return l?h.as2D(h.shape[2],h.shape[3]):h.as3D(h.shape[0],h.shape[2],h.shape[3])}}),Fu=Mn({conv2d_:function(e,t,n,r,i,a,o){void 0===i&&(i="NHWC"),void 0===a&&(a=[1,1]);var s=xn(e,"x","conv2d"),u=xn(t,"filter","conv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),A(4===c.rank,(function(){return"Error in conv2d: input must be rank 4, but got rank "+c.rank+"."})),A(4===u.rank,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."})),null!=o&&A(F(r),(function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."}));var f="NHWC"===i?c.shape[3]:c.shape[1];A(f===u.shape[2],(function(){return"Error in conv2d: depth of input ("+f+") must match input depth for filter "+u.shape[2]+"."})),A(Bi(n,a),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}));var d=Li(i),h=Ti(c.shape,u.shape,n,a,r,o,!1,d),p=[u,c],m=We.runKernelFunc((function(e,t){var n=e.conv2d(c,u,h);return t([u,c]),n}),{x:c,filter:u},(function(e,t){var o=t,s=o[0],u=o[1];return A(Pi(a),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"})),{x:function(){return Ru(u.shape,e,s,n,r,i)},filter:function(){return Nu(u,e,s.shape,n,r,i)}}}),"Conv2D",h,p);return l?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),Iu=Mn({conv3d_:function(e,t,n,r,i,a){void 0===i&&(i="NDHWC"),void 0===a&&(a=[1,1,1]);var o=xn(e,"x","conv3d"),s=xn(t,"filter","conv3d"),u=o,c=!1;4===o.rank&&(c=!0,u=o.as5D(1,o.shape[0],o.shape[1],o.shape[2],o.shape[3])),A(5===u.rank,(function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."})),A(5===s.rank,(function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."})),A(u.shape[4]===s.shape[3],(function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."})),A(function(e,t){return Tu(n)||Tu(t)}(0,a),(function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"})),A("NDHWC"===i,(function(){return"Error in conv3d: got dataFormat of "+i+" but only NDHWC is currently supported."}));var l=ji(u.shape,s.shape,n,a,r),f=We.runKernelFunc((function(e,t){var n=e.conv3d(u,s,l);return t([u,s]),n}),{x:u,$filter:s},(function(e,t){A(Tu(a),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"}));var i=t[0],o=t[1];return{x:function(){return ju(i.shape,e,o,n,r)},$filter:function(){return function(e,t,n,r,i){var a=e;4===e.rank&&(a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]));var o=t;4===o.rank&&(o=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3])),A(5===a.rank,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+a.shape+"."})),A(5===o.rank,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+o.shape+"."})),A(5===n.length,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+n+"."})),A(a.shape[4]===n[3],(function(){return"Error in conv3dDerFilter: depth of input "+a.shape[4]+") must match input depth in filter ("+n[3]+"."})),A(o.shape[4]===n[4],(function(){return"Error in conv3dDerFilter: depth of dy ("+o.shape[4]+") must match output depth for filter ("+n[4]+")."}));var s=ji(a.shape,n,r,1,i);return We.runKernelFunc((function(e){return e.conv3dDerFilter(a,o,s)}),{x5D:a,dy5D:o})}(i,e,o.shape,n,r)}}}));return c?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),Nu=Mn({conv2dDerFilter_:function(e,t,n,r,i,a,o){void 0===a&&(a="NHWC");var s=e;3===e.rank&&(s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var u=t;3===u.rank&&(u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),A(4===s.rank,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."})),A(4===u.rank,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."})),A(4===n.length,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."}));var c="NHWC"===a?s.shape[3]:s.shape[1],l="NHWC"===a?u.shape[3]:u.shape[1];A(c===n[2],(function(){return"Error in conv2dDerFilter: depth of input "+c+") must match input depth in filter ("+n[2]+"."})),A(l===n[3],(function(){return"Error in conv2dDerFilter: depth of dy ("+l+") must match output depth for filter ("+n[3]+")."})),null!=o&&A(F(i),(function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."}));var f=Li(a),d=Ti(s.shape,n,r,1,i,o,!1,f);return We.runKernelFunc((function(e){return e.conv2dDerFilter(s,u,d)}),{x4D:s,dy4D:u})}}),Ru=Mn({conv2dDerInput_:Du}),Pu=Mn({depthwiseConv2d_:function(e,t,n,r,i,a,o){void 0===i&&(i="NHWC"),void 0===a&&(a=[1,1]);var s=xn(e,"x","depthwiseConv2d"),u=xn(t,"filter","depthwiseConv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),A(4===c.rank,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+c.rank+"."})),A(4===u.rank,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."})),A(c.shape[3]===u.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels ("+c.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."})),null==a&&(a=[1,1]),A(Bi(n,a),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"})),null!=o&&A(F(r),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."}));var f=Ti(c.shape,u.shape,n,a,r,o,!0),d=[c,u],h=We.runKernelFunc((function(e,t){var n=e.depthwiseConv2D(c,u,f);return t([c,u]),n}),{x:c,filter:u},(function(e,t){A(Pi(a),(function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+a+"'"}));var n=t[0],r=t[1];return{x:function(){return Bu(n.shape,e,r,f)},filter:function(){return Lu(n,e,r.shape,f)}}}),"DepthwiseConv2dNative",f,d);return l?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}}),Bu=Mn({depthwiseConv2dDerInput_:function(e,t,n,r){var i=t,a=!1;3===t.rank&&(a=!0,i=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var o=We.runKernelFunc((function(e){return e.depthwiseConv2DDerInput(i,n,r)}),{dy4D:i});return a?o.as3D(o.shape[1],o.shape[2],o.shape[3]):o}}),Lu=Mn({depthwiseConv2dDerFilter_:function(e,t,n,r){var i=e;3===e.rank&&(i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=t;return 3===a.rank&&(a=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),We.runKernelFunc((function(e){return e.depthwiseConv2DDerFilter(i,a,r)}),{x4D:i,dy4D:a})}}),zu=Mn({separableConv2d_:function(e,t,n,r,i,a,o){void 0===a&&(a=[1,1]),void 0===o&&(o="NHWC");var s=xn(e,"x","separableConv2d"),u=xn(t,"depthwiseFilter","separableConv2d"),c=xn(n,"pointwiseFilter","separableConv2d"),l=s,f=!1;if(3===s.rank&&(f=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),"NCHW"===o)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");A(4===l.rank,(function(){return"Error in separableConv2d: input must be rank 4, but got rank "+l.rank+"."})),A(4===u.rank,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."})),A(4===c.rank,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."})),A(1===c.shape[0],(function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+c.shape[0]+"."})),A(1===c.shape[1],(function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+c.shape[1]+"."}));var d=u.shape[2],h=u.shape[3];A(c.shape[2]===d*h,(function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+d*h+", but got "+c.shape[2]+"."}));var p=Pu(l,u,r,i,o,a),m=Fu(p,c,1,"valid",o);return f?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),Uu=Mn({conv2dTranspose_:function(e,t,n,r,i,a){return Du(n,xn(e,"x","conv2dTranspose"),xn(t,"filter","conv2dTranspose"),r,i,"NHWC",a)}}),Wu=Mn({conv3dTranspose_:function(e,t,n,r,i){return ju(n,xn(e,"x","conv3dTranspose"),xn(t,"filter","conv3dTranspose"),r,i)}}),Vu=Mn({matMul_:function(e,t,n,r){var i;void 0===n&&(n=!1),void 0===r&&(r=!1);var a=xn(e,"a","matMul"),o=xn(t,"b","matMul");i=Ne(a,o),a=i[0],o=i[1];var s=n?a.shape[a.rank-2]:a.shape[a.rank-1],u=r?o.shape[o.rank-1]:o.shape[o.rank-2],c=n?a.shape[a.rank-1]:a.shape[a.rank-2],l=r?o.shape[o.rank-2]:o.shape[o.rank-1],f=a.shape.slice(0,-2),d=o.shape.slice(0,-2),h=j(f),p=j(d);A(a.rank>=2&&o.rank>=2&&a.rank===o.rank,(function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+a.rank+" and "+o.rank+"."})),A(M(f,d),(function(){return"Error in matMul: outer dimensions ("+f+") and ("+d+") of Tensors with shapes "+a.shape+" and "+o.shape+" must match."})),A(s===u,(function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+a.shape+" and "+o.shape+" and transposeA="+n+" and transposeB="+r+" must match."}));var m=a.shape.slice(0,-2).concat([c,l]),v=n?a.as3D(h,s,c):a.as3D(h,c,s),g=r?o.as3D(p,l,u):o.as3D(p,u,l),y={transposeA:n,transposeB:r};return We.runKernelFunc((function(e,t){var i=e.batchMatMul(v,g,n,r);return t([v,g]),i}),{a:v,b:g},(function(e,t){var i=t,a=i[0],o=i[1];return n||r?!n&&r?{a:function(){return e.matMul(o,!1,!1)},b:function(){return e.matMul(a,!0,!1)}}:n&&!r?{a:function(){return o.matMul(e,!1,!0)},b:function(){return a.matMul(e,!1,!1)}}:{a:function(){return o.matMul(e,!0,!0)},b:function(){return e.matMul(a,!0,!0)}}:{a:function(){return e.matMul(o,!1,!0)},b:function(){return a.matMul(e,!0,!1)}}}),"BatchMatMul",y).reshape(m)}}),Gu=Mn({dot_:function(e,t){var n=xn(e,"t1","dot"),r=xn(t,"t2","dot");A(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+"."}));var i=1===n.rank?n.size:n.shape[1],a=1===r.rank?r.size:r.shape[0];return A(i===a,(function(){return"Error in dot: inner dimensions of inputs must match, but got "+i+" and "+a+"."})),1===n.rank&&1===r.rank?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===n.rank&&2===r.rank?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===n.rank&&1===r.rank?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),qu=Mn({outerProduct_:function(e,t){var n=xn(e,"v1","outerProduct"),r=xn(t,"v2","outerProduct");return A(1===n.rank&&1===r.rank,(function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."})),n.as2D(-1,1).matMul(r.as2D(1,-1))}}),Hu=Mn({reverse_:function(e,t){var n=xn(e,"x","reverse");if(0===n.rank)return n.clone();var r=L(t,n.shape);return We.runKernelFunc((function(e){return e.reverse(n,r)}),{$x:n},(function(e){return{$x:function(){return e.reverse(r)}}})).reshapeAs(n)}}),Xu=Mn({reverse1d_:function(e){var t=xn(e,"x","reverse");return A(1===t.rank,(function(){return"Error in reverse1D: x must be rank 1 but got rank "+t.rank+"."})),Hu(t,0)}}),Ku=Mn({reverse2d_:function(e,t){var n=xn(e,"x","reverse");return A(2===n.rank,(function(){return"Error in reverse2D: x must be rank 2 but got rank "+n.rank+"."})),Hu(n,t)}}),Yu=Mn({reverse3d_:function(e,t){var n=xn(e,"x","reverse");return A(3===n.rank,(function(){return"Error in reverse3D: x must be rank 3 but got rank "+n.rank+"."})),Hu(n,t)}}),$u=Mn({reverse4d_:function(e,t){var n=xn(e,"x","reverse");return A(4===n.rank,(function(){return"Error in reverse4D: x must be rank 4 but got rank "+n.rank+"."})),Hu(n,t)}});function Ju(e,t,n,r,i,a){var o=xn(e,"x","maxPool"),s=o,u=!1;3===o.rank&&(u=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),null==r&&(r=[1,1]),A(4===s.rank,(function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."})),A(Bi(n,r),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"})),null!=a&&A(F(i),(function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."}));var c=Oi(s.shape,t,n,r,i,a);if(1===c.filterWidth&&1===c.filterHeight&&M(c.inShape,c.outShape))return o.clone();var l=[s],f=We.runKernelFunc((function(e,t){var n=e.maxPool(s,c);return t([s,n]),n}),{x:s},(function(e,a){var o=a[0],s=a[1];return{x:function(){return function(e,t,n,r,i,a,o,s){var u=xn(e,"dy","maxPoolBackprop"),c=xn(t,"input","maxPoolBackprop"),l=xn(n,"output","maxPoolBackprop");A(c.rank===u.rank,(function(){return"Rank of input ("+c.rank+") does not match rank of dy ("+u.rank+")"})),null==a&&(a=[1,1]),A(Bi(i,a),(function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+a+"'"})),A(4===u.rank,(function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+u.rank+"."})),A(4===c.rank,(function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+c.rank+"."}));var f=Oi(c.shape,r,i,a,o,s);return We.runKernelFunc((function(e){return e.maxPoolBackprop(u,c,l,f)}),{$dy:u,$input:c})}(e,o,s,t,n,r,i)}}}),"MaxPool",c,l);return u?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}function Zu(e,t,n,r,i,a){var o=xn(e,"x","avgPool","float32");null==r&&(r=[1,1]),A(Bi(n,r),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"}));var s=o,u=!1;3===o.rank&&(u=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),A(4===s.rank,(function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."})),null!=a&&A(F(i),(function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."}));var c=Oi(s.shape,t,n,r,i,a);if(1===c.filterWidth&&1===c.filterHeight&&M(c.inShape,c.outShape))return o.clone();var l=We.runKernelFunc((function(e){return e.avgPool(s,c)}),{x:s},(function(e){return{x:function(){return function(e,t,n,r,i,a){var o=xn(e,"dy","avgPoolBackprop"),s=xn(t,"input","avgPoolBackprop");A(s.rank===o.rank,(function(){return"Rank of input ("+s.rank+") does not match rank of dy ("+o.rank+")"})),null==i&&(i=[1,1]),A(Bi(r,i),(function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+i+"'"}));var u=s,c=o,l=!1;3===s.rank&&(l=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]),c=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),A(4===c.rank,(function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+c.rank+"."})),A(4===u.rank,(function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+u.rank+"."}));var f=Oi(u.shape,n,r,i,a),d=We.runKernelFunc((function(e){return e.avgPoolBackprop(c,u,f)}),{dy4D:c,input4D:u});return l?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}(e,s,t,n,r,i)}}}),"AvgPool",c);return l=l.cast(o.dtype),u?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}var Qu=Mn({maxPool_:function(e,t,n,r,i){return Ju(e,t,n,1,r,i)}}),ec=Mn({avgPool_:function(e,t,n,r,i){return Zu(e,t,n,1,r,i)}}),tc=Mn({pool_:function(e,t,n,r,i,a){null==i&&(i=[1,1]),null==a&&(a=1),0===r&&(r="valid");var o=xn(e,"x","maxPool"),s=o,u=!1;3===o.rank&&(u=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),A(Bi(a,i),(function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+i+"'"}));var c,l=Oi(s.shape,t,a,i,r),f=[l.dilationHeight,l.dilationWidth];c="same"===r?function(e,t){var n=e.map((function(e,n){return e+(e-1)*(t[n]-1)})).map((function(e){return e-1})),r=n.map((function(e){return Math.floor(e/2)})),i=n.map((function(e,t){return e-r[t]}));return n.map((function(e,t){return[r[t],i[t]]}))}([l.filterHeight,l.filterWidth],f):[[0,0],[0,0]];var d=1===f[0]&&1===f[1],h=function(e,t,n){var r=n.map((function(e){return e[0]})),i=n.map((function(e){return e[1]})),a=e.concat(r,i),o=t.map((function(e,t){return(e-a[t]%e)%e})),s=i.map((function(e,t){return e+o[t]}));return[t.map((function(e,t){return[r[t],s[t]]})),t.map((function(e,t){return[0,o[t]]}))]}([l.inHeight,l.inWidth],f,c),p=h[0],m=h[1],v=d?r:"valid",g=d?s:Lr(s,f,p),y=("avg"===n?function(){return Zu(g,t,a,1,v)}:function(){return Ju(g,t,a,1,v)})(),b=d?y:br(y,f,m);return u?b.as3D(b.shape[1],b.shape[2],b.shape[3]):b}}),nc=Mn({maxPool3d_:function(e,t,n,r,i,a,o){void 0===a&&(a="NDHWC");var s=xn(e,"x","maxPool3d"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==o&&(o=[1,1,1]),A(5===u.rank,(function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."})),A("NDHWC"===a,(function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+a})),A(Bi(n,o),(function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"})),null!=i&&A(F(r),(function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}));var l=Di(u.shape,t,n,o,r,i,a),f=We.runKernelFunc((function(e,t){var n=e.maxPool3d(u,l);return t([u,n]),n}),{x:u},(function(e,a){var s=a[0],u=a[1];return{x:function(){return function(e,t,n,r,i,a,o,s){var u=xn(e,"dy","maxPool3dBackprop"),c=xn(t,"input","maxPool3dBackprop"),l=xn(n,"output","maxPool3dBackprop"),f=u,d=c,h=l,p=!1;4===c.rank&&(p=!0,f=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]),d=c.as5D(1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]),h=l.as5D(1,l.shape[0],l.shape[1],l.shape[2],l.shape[3])),A(5===f.rank,(function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+f.rank+"."})),A(5===d.rank,(function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+d.rank+"."})),A(5===h.rank,(function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+h.rank+"."})),null==a&&(a=[1,1,1]),A(Bi(i,a),(function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+a+"'"})),null!=s&&A(F(o),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+o+"."}));var m=Di(d.shape,r,i,a,o,s),v=We.runKernelFunc((function(e){return e.maxPool3dBackprop(f,d,h,m)}),{dy5D:f,input5D:d});return p?v.as4D(v.shape[1],v.shape[2],v.shape[3],v.shape[4]):v}(e,s,u,t,n,o,r,i)}}}));return c?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),rc=Mn({avgPool3d_:function(e,t,n,r,i,a,o){void 0===a&&(a="NDHWC");var s=xn(e,"x","avgPool3d","float32"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==o&&(o=[1,1,1]),A(5===u.rank,(function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."})),A("NDHWC"===a,(function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+a})),A(Bi(n,o),(function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"})),null!=i&&A(F(r),(function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}));var l=Di(u.shape,t,n,o,r,i,a),f=We.runKernelFunc((function(e){return e.avgPool3d(u,l)}),{x:u},(function(e){return{x:function(){return function(e,t,n,r,i,a,o){var s=xn(e,"dy","avgPool3dBackprop"),u=xn(t,"input","avgPool3dBackprop"),c=s,l=u,f=!1;4===u.rank&&(f=!0,c=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]),l=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3])),A(5===c.rank,(function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+c.rank+"."})),A(5===l.rank,(function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+l.rank+"."})),null==i&&(i=[1,1,1]),A(Bi(r,i),(function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+i+"'"})),null!=o&&A(F(a),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+a+"."}));var d=Di(l.shape,n,r,i,a,o),h=We.runKernelFunc((function(e){return e.avgPool3dBackprop(c,l,d)}),{dy5D:c,input5D:l});return f?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}(e,u,t,n,o,r,i)}}}));return f=f.cast(u.dtype),c?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),ic=Mn({slice_:function(e,t,n){var r,i,a=xn(e,"x","slice");if(0===a.rank)throw new Error("Slicing scalar is not possible");(r="number"==typeof t?[t].concat(new Array(a.rank-1).fill(0)):t.length<a.rank?t.concat(new Array(a.rank-t.length).fill(0)):t.slice()).forEach((function(e){A(-1!==e,(function(){return"slice() does not support negative begin indexing."}))})),i=(i=null==n?new Array(a.rank).fill(-1):"number"==typeof n?[n].concat(new Array(a.rank-1).fill(-1)):n.length<a.rank?n.concat(new Array(a.rank-n.length).fill(-1)):n).map((function(e,t){return e>=0?e:(A(-1===e,(function(){return"Negative size values should be exactly -1 but got "+e+" for the slice() size at index "+t+"."})),a.shape[t]-r[t])})),ai(a,r,i);var o=a.shape,s={begin:r,size:i};return We.runKernelFunc((function(e){return e.slice(a,r,i)}),{x:a},(function(e){for(var t=[],n=0;n<e.rank;n++)t.push([r[n],o[n]-r[n]-i[n]]);return{x:function(){return e.pad(t)}}}),"Slice",s)}}),ac=Mn({slice1d_:function(e,t,n){var r=xn(e,"x","slice1d");return A(1===r.rank,(function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"})),ic(r,[t],[n])}}),oc=Mn({slice2d_:function(e,t,n){var r=xn(e,"x","slice2d");return A(2===r.rank,(function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"})),ic(r,t,n)}}),sc=Mn({slice3d_:function(e,t,n){var r=xn(e,"x","slice3d");return A(3===r.rank,(function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"})),ic(r,t,n)}}),uc=Mn({slice4d_:function(e,t,n){var r=xn(e,"x","slice4d");return A(4===r.rank,(function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"})),ic(r,t,n)}});function cc(e,t,n,r,i){return t.rank<n.rank&&(t=t.reshape(Sn(t.shape,r))),e.rank<n.rank&&(e=e.reshape(Sn(e.shape,r))),{x:function(){var r=e.mul(n.equal(t).cast(e.dtype));return null==i?r:r.transpose(i)}}}var lc=Mn({all_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=xn(e,"x","all","bool"),i=L(t,r.shape),a=i,o=An(a,r.rank);null!=o&&(r=r.transpose(o),a=Dn(a.length,r.rank));var s=We.runKernelFunc((function(e){return e.all(r,a)}),{$x:r});if(n){var u=Sn(s.shape,i);return s.reshape(u)}return s}}),fc=Mn({any_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=xn(e,"x","any","bool"),i=L(t,r.shape),a=i,o=An(a,r.rank);null!=o&&(r=r.transpose(o),a=Dn(a.length,r.rank));var s=We.runKernelFunc((function(e){return e.any(r,a)}),{$x:r});if(n){var u=Sn(s.shape,i);return s.reshape(u)}return s}}),dc=Mn({argMax_:function(e,t){void 0===t&&(t=0);var n=xn(e,"x","argMax");null==t&&(t=0);var r=L(t,n.shape),i=An(r,n.rank);null!=i&&(n=n.transpose(i),r=Dn(r.length,n.rank));var a={axis:r[0]},o=[n];return We.runKernelFunc((function(e,t){var i=e.argMax(n,r[0]);return t([n]),i}),{x:n},(function(e,t){var n=t[0];return{x:function(){return Zn(n)}}}),"ArgMax",a,o)}}),hc=Mn({argMin_:function(e,t){void 0===t&&(t=0);var n=xn(e,"x","argMin");null==t&&(t=0);var r=L(t,n.shape),i=An(r,n.rank);return null!=i&&(n=n.transpose(i),r=Dn(r.length,n.rank)),We.runKernelFunc((function(e,t){var i=e.argMin(n,r[0]);return t([n]),i}),{$x:n},(function(e,t){var n=t[0];return{$x:function(){return Zn(n)}}}))}}),pc=Mn({logSumExp_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=xn(e,"x","logSumExp"),i=L(t,r.shape),a=r.max(i,!0),o=r.sub(a).exp().sum(i).log(),s=a.reshape(o.shape).add(o);if(n){var u=Sn(s.shape,i);return s.reshape(u)}return s}}),mc=Mn({max_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=xn(e,"x","max"),i=r,a=L(t,r.shape),o=a,s=An(o,r.rank);null!=s&&(r=r.transpose(s),o=Dn(o.length,r.rank));var u=[r],c=We.runKernelFunc((function(e,t){var n=e.max(r,o);return t([i,n]),n}),{x:r},(function(e,t){return cc(e,t[1],t[0],a,s)}),"Max",{axes:o},u,[!0]);if(n){var l=Sn(c.shape,a);c=c.reshape(l)}return c}}),vc=Mn({mean_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=xn(e,"x","mean"),i=L(t,r.shape),a=j(En(r.shape,i)[1]);return yi((function(e){var r=Bn(a);return{value:(r.dtype===e.dtype?e:e.cast(r.dtype)).div(r).sum(t,n),gradFunc:function(t){var n=e.shape.slice();return i.forEach((function(e){n[e]=1})),t.reshape(n).mul(Hn(e.shape,"float32")).div(a)}}}))(r)}}),gc=Mn({min_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=xn(e,"x","min"),i=r,a=L(t,r.shape),o=a,s=An(o,r.rank);null!=s&&(r=r.transpose(s),o=Dn(o.length,r.rank));var u=[r],c=We.runKernelFunc((function(e,t){var n=e.min(r,o);return t([i,n]),n}),{x:r},(function(e,t){return cc(e,t[1],t[0],a,s)}),"Min",{axes:o},u,[!0]);if(n){var l=Sn(c.shape,a);c=c.reshape(l)}return c}}),yc=Mn({moments_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=L(t,(e=xn(e,"x","moments")).shape),i=e.mean(r,n),a=i.shape;return n||(a=Sn(i.shape,r)),{mean:i,variance:e.toFloat().sub(i.reshape(a)).square().mean(r,n)}}}),bc=Mn({sum_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=xn(e,"x","sum");"bool"===r.dtype&&(r=r.toInt());var i=L(t,r.shape);return yi((function(e){var t=An(i,e.rank),r=i,a=e;null!=t&&(a=e.transpose(t),r=Dn(r.length,e.rank));var o=function(t){var n=e.shape.slice();return i.forEach((function(e){n[e]=1})),t.reshape(n).mul(Hn(e.shape,"float32"))},s={axes:r},u=We.runKernelFunc((function(e){return e.sum(a,r)}),{x:a},(function(e){return{x:function(){return o(e)}}}),"Sum",s);if(n){var c=Sn(u.shape,i);u=u.reshape(c)}return{value:u,gradFunc:o}}))(r)}}),xc=Mn({prod_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=xn(e,"x","prod");"bool"===r.dtype&&(r=r.toInt());var i=L(t,r.shape),a=An(i,r.rank),o=i,s=r;null!=a&&(s=r.transpose(a),o=Dn(o.length,r.rank));var u=We.runKernelFunc((function(e){return e.prod(s,o)}),{permutedX:s});if(n){var c=Sn(u.shape,i);u=u.reshape(c)}return u}}),wc=Mn({elu_:function(e){var t=xn(e,"x","elu");return We.runKernelFunc((function(e,n){var r=e.elu(t);return n([r]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return We.runKernelFunc((function(t){return t.eluDer(e,n)}),{dy:e,y:n})}}}))}}),_c=Mn({leakyRelu_:function(e,t){void 0===t&&(t=.2);var n=xn(e,"x","leakyRelu");return Qs(Bn(t).mul(n),n)}}),kc=Mn({prelu_:function(e,t){var n=xn(e,"x","prelu"),r=xn(t,"alpha","prelu");return We.runKernelFunc((function(e,t){var i=e.prelu(n,r);return t([n,r]),i}),{x:n,alpha:r},(function(e,t){var n=t[0],r=t[1],i=n.greater(0);return{x:function(){return Vs(i,e,e.mul(r))},alpha:function(){var t=Vs(i,Zn(e),e.mul(n)),a=Ci(r.shape,e.shape);return a.length>0&&(t=t.sum(a)),t.reshape(r.shape)}}}),"Prelu")}}),Ec=Mn({relu_:function(e){var t=xn(e,"x","relu");return"bool"===t.dtype?t.toInt():We.runKernelFunc((function(e,n){var r=e.relu(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.mulStrict(n.step().toFloat())}}}),"Relu")}}),Sc=Mn({relu6_:function(e){var t=xn(e,"x","relu6");return"bool"===t.dtype?t.toInt():We.runKernelFunc((function(e,n){var r=e.relu6(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0],r=n.lessEqual(6).mul(n.step());return{x:function(){return e.mulStrict(r.toFloat())}}}),"Relu6")}}),Cc=Mn({selu_:function(e){var t=xn(e,"x","selu");return We.runKernelFunc((function(e,n){var r=e.selu(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){var t=n.greater(Bn(0)),r=Bn(yo),i=Bn(bo),a=e.mul(i),o=e.mul(r).mul(n.toFloat().exp());return Vs(t,a,o)}}}))}}),Ac=Mn({transpose_:function(e,t){var n=xn(e,"x","transpose");if(null==t&&(t=n.shape.map((function(e,t){return t})).reverse()),A(n.rank===t.length,(function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+t+"."})),t.forEach((function(e){A(e>=0&&e<n.rank,(function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+t}))})),n.rank<=1)return n.clone();var r={perm:t};return We.runKernelFunc((function(e){return e.transpose(n,t)}),{x:n},(function(e){var n=On(t);return{x:function(){return e.transpose(n)}}}),"Transpose",r)}}),Oc=Mn({localResponseNormalization_:function(e,t,n,r,i){void 0===t&&(t=5),void 0===n&&(n=1),void 0===r&&(r=1),void 0===i&&(i=.5);var a=xn(e,"x","localResponseNormalization");A(4===a.rank||3===a.rank,(function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+a.rank+"."})),A(F(t),(function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+t+"."}));var o=a,s=!1;3===a.rank&&(s=!0,o=a.as4D(1,a.shape[0],a.shape[1],a.shape[2]));var u=We.runKernelFunc((function(e,a){var s=e.localResponseNormalization4D(o,t,n,r,i);return a([o,s]),s}),{x4D:o},(function(e,a){var o=a[0],s=a[1];return{x4D:function(){return We.runKernelFunc((function(a){return a.LRNGrad(e,o,s,t,n,r,i)}),{})}}}));return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Dc=Mn({norm_:function(e,t,n,r){void 0===t&&(t="euclidean"),void 0===n&&(n=null),void 0===r&&(r=!1);var i=function e(t,n,r){if(void 0===r&&(r=null),0===t.rank)return t.abs();if(1!==t.rank&&null===r)return e(t.reshape([-1]),n,r);if(1===t.rank||"number"==typeof r||Array.isArray(r)&&1===r.length){if(1===n)return t.abs().sum(r);if(n===1/0)return t.abs().max(r);if(n===-1/0)return t.abs().min(r);if("euclidean"===n||2===n)return t.abs().pow(Bn(2,"int32")).sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}if(Array.isArray(r)&&2===r.length){if(1===n)return t.abs().sum(r[0]).max(r[1]-1);if(n===1/0)return t.abs().sum(r[1]).max(r[0]);if(n===-1/0)return t.abs().sum(r[1]).min(r[0]);if("fro"===n||"euclidean"===n)return t.square().sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}throw new Error("Error in norm: invalid axis: "+r)}(e=xn(e,"x","norm"),t,n),a=i.shape;if(r){var o=L(n,e.shape);a=Sn(i.shape,o)}return i.reshape(a)}}),Tc=Mn({basicLSTMCell_:function(e,t,n,r,i,a){var o=xn(e,"forgetBias","basicLSTMCell"),s=xn(t,"lstmKernel","basicLSTMCell"),u=xn(n,"lstmBias","basicLSTMCell"),c=xn(r,"data","basicLSTMCell"),l=xn(i,"c","basicLSTMCell"),f=xn(a,"h","basicLSTMCell"),d=c.concat(f,1).matMul(s).add(u),h=d.shape[0],p=d.shape[1]/4,m=[h,p],v=d.slice([0,0],m),g=d.slice([0,p],m),y=d.slice([0,2*p],m),b=d.slice([0,3*p],m),x=v.sigmoid().mulStrict(g.tanh()).addStrict(l.mulStrict(o.add(y).sigmoid()));return[x,x.tanh().mulStrict(b.sigmoid())]}}),jc=Mn({multiRNNCell_:function(e,t,n,r){for(var i=xn(t,"data","multiRNNCell"),a=wn(n,"c","multiRNNCell"),o=wn(r,"h","multiRNNCell"),s=i,u=[],c=0;c<e.length;c++){var l=e[c](s,a[c],o[c]);u.push(l[0]),u.push(l[1]),s=l[1]}var f=[],d=[];for(c=0;c<u.length;c+=2)f.push(u[c]),d.push(u[c+1]);return[f,d]}}),Mc=Mn({movingAverage_:function(e,t,n,r,i){void 0===i&&(i=!0);var a=xn(e,"v","movingAverage"),o=xn(t,"x","movingAverage"),s=xn(n,"decay","movingAverage");Re(a,o),A(M(a.shape,o.shape),(function(){return"Shape mismatch in v and x"}));var u=Bn(1),c=u.sub(s),l=o.sub(a).mul(c);if(i){A(null!=r,(function(){return"When using zeroDebias: true, step is required."}));var f=xn(r,"step","movingAverage");l=l.div(u.sub(su(s,f)))}return a.add(l)}}),Fc=Mn({stridedSlice_:function(e,t,n,r,i,a,o,s,u){if(void 0===i&&(i=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===u&&(u=0),null==r&&(r=new Array(t.length)),0!==o)throw new Error("ellipsis mask is not yet supported");var c=xn(e,"x","stridedSlice"),l=oi(s),f=c.shape.slice();l.forEach((function(e){t[e]=0,n[e]=1,f.splice(e,0,1)})),c=c.reshape(f);for(var d=0;d<c.rank;d++)t[d]=ui(i,t,r,c.shape,d),n[d]=ci(a,n,r,c.shape,d),r[d]=r[d]||1;var h=oi(u);h.forEach((function(e){n[e]=t[e]+1,r[e]=1}));var p=si(t,n,r),m=p.filter((function(e,t){return-1===h.indexOf(t)}));return r.every((function(e){return 1===e}))?ic(c,t,p).reshape(m):We.runKernelFunc((function(e){return e.stridedSlice(c,t,n,r)}),{$x:c}).reshape(m)}}),Ic=Mn({topk_:function(e,t,n){void 0===t&&(t=1),void 0===n&&(n=!0);var r=xn(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var i=r.shape[r.shape.length-1];if(t>i)throw new Error("'k' passed to topk() must be <= the last dimension ("+i+") but got "+t);var a=We.runKernelFunc((function(e){return e.topk(r,t,n)}),{$x:r});return{values:a[0],indices:a[1]}}}),Nc=Mn({scatterND_:function(e,t,n){var r=xn(e,"indices","scatterND","int32"),i=xn(t,"updates","scatterND");return ni(i,r,n),We.runKernelFunc((function(e){return e.scatterND(r,i,n)}),{indices:r,updates:i},null,"ScatterNd",{shape:n})}}),Rc=Mn({fft_:function(e){A("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+e.dtype+"."}));var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return We.runKernelFunc((function(e){return e.fft(r)}),{input:e}).reshape(e.shape)}}),Pc=Mn({ifft_:function(e){A("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+e.dtype+"."}));var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return We.runKernelFunc((function(e){return e.ifft(r)}),{input:e}).reshape(e.shape)}}),Bc=Mn({rfft_:function(e,t){A("float32"===e.dtype,(function(){return"The dtype for rfft() must be real value but got "+e.dtype}));var n,r=e.shape[e.shape.length-1],i=e.size/r;if(null!=t&&t<r){var a=e.shape.map((function(e){return 0})),o=e.shape.map((function(e){return e}));o[e.shape.length-1]=t,n=e.slice(a,o),r=t}else if(null!=t&&t>r){var s=e.shape.map((function(e){return e}));s[e.shape.length-1]=t-r,n=e.concat(Xn(s),e.shape.length-1),r=t}else n=e;var u=n.zerosLike(),c=Fn(n,u).as2D(i,r),l=Rc(c),f=Math.floor(r/2)+1,d=In(l),h=Nn(l),p=d.split([f,r-f],d.shape.length-1),m=h.split([f,r-f],h.shape.length-1),v=n.shape.slice();return v[n.shape.length-1]=f,Fn(p[0],m[0]).reshape(v)}}),Lc=Mn({irfft_:function(e){var t=e.shape[e.shape.length-1],n=e.size/t;if(t<=2){var r=e.as2D(n,t),i=Pc(r);return In(i)}var a=[n,2*(t-1)],o=In(e).as2D(n,t),s=Nn(e).as2D(n,t),u=o.slice([0,1],[n,t-2]).reverse(1),c=s.slice([0,1],[n,t-2]).reverse(1).mul(Bn(-1)),l=o.concat(u,1),f=s.concat(c,1);return r=Fn(l,f).as2D(a[0],a[1]),i=Pc(r),In(i)}}),zc=Object.freeze({fft:Rc,ifft:Pc,rfft:Bc,irfft:Lc}),Uc=Mn({sparseToDense_:function(e,t,n,r){void 0===r&&(r=0);var i=xn(e,"sparseIndices","sparseToDense","int32"),a=xn(t,"sparseValues","sparseToDense"),o=xn(r,"defaultValue","sparseToDense",a.dtype);return function(e,t,n,r){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+e.shape+".");var i=e.rank>0?e.shape[0]:1,a=e.rank>1?e.shape[1]:1;if(n.length!==a)throw new Error("outputShape has incorrect number of elements:, "+n.length+", should be: "+a+".");var o=t.size;if(0!==t.rank&&(1!==t.rank||o!==i))throw new Error("sparseValues has incorrect shape "+t.shape+", should be [] or ["+i+"]");if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(i,a,n,o),We.runKernelFunc((function(e){return e.sparseToDense(i,a,n,o)}),{$sparseIndices:i,$sparseValues:a,$defaultValue:o})}}),Wc=Mn({gatherND_:function(e,t){var n=xn(t,"indices","gatherND","int32"),r=xn(e,"x","gatherND");return We.runKernelFunc((function(e){return e.gatherND(r,n)}),{x:r,indices:n},null,"GatherNd")}}),Vc=Mn({diag_:function(e){var t=xn(e,"x","diag").flatten(),n=e.shape.concat(e.shape);return We.runKernelFunc((function(e){return e.diag(t)}),{$x:t}).reshape(n)}}),Gc=Mn({dropout_:function(e,t,n,r){var i=xn(e,"x","dropout");if(A("float32"===i.dtype,(function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+i.dtype+" tensor instead."})),A(t>=0&&t<1,(function(){return"rate must be a float in the range [0, 1), but got "+t+"."})),0===t)return e instanceof Se?i.clone():i;var a=function(e,t){if(null==t)return e.shape.slice();if(M(e.shape,t))return t;if(e.shape.length===t.length){for(var n=[],r=0;r<e.shape.length;r++)null==t[r]&&null!=e.shape[r]?n.push(e.shape[r]):n.push(t[r]);return n}return t}(i,n),o=1-t,s=Pr(a,0,1,"float32",r).add(o).floor().div(o);return i.mul(s)}});function qc(e,t,n){for(var r=1-e%2,i=new Float32Array(e),a=0;a<e;++a){var o=2*Math.PI*a/(e+r-1);i[a]=t-n*Math.cos(o)}return Ln(i,"float32")}var Hc,Xc=Mn({hannWindow_:function(e){return qc(e,.5,.5)}}),Kc=Mn({hammingWindow_:function(e){return qc(e,.54,.46)}}),Yc=Mn({frame_:function(e,t,n,r,i){void 0===r&&(r=!1),void 0===i&&(i=0);for(var a=0,o=[];a+t<=e.size;)o.push(ic(e,a,t)),a+=n;if(r)for(;a<e.size;){var s=a+t-e.size,u=Qn([ic(e,a,t-s),Kn([s],i)]);o.push(u),a+=n}return 0===o.length?zn([],[0,t]):Qn(o).as2D(o.length,t)}}),$c=Mn({stft_:function(e,t,n,r,i){var a;void 0===i&&(i=Xc),null==r&&(a=t,r=Math.floor(Math.pow(2,Math.ceil(Math.log(a)/Math.log(2)))));for(var o=Yc(e,t,n),s=au(o,i(t)),u=[],c=0;c<o.shape[0];c++)u.push(Bc(s.slice([c,0],[1,t]),r));return Qn(u)}}),Jc=Object.freeze({hannWindow:Xc,hammingWindow:Kc,frame:Yc,stft:$c}),Zc=function(e,t,n){return void 0===n&&(n=1),u(this,void 0,void 0,(function(){var r,i,a,o,s,u,l,f,d,h,p,m,v,g;return c(this,(function(c){switch(c.label){case 0:return r=xn(e,"predictions","inTopK"),i=xn(t,"targets","inTopK"),A(r.rank>1,(function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank})),A(r.rank-1===i.rank,(function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+i.rank})),O(r.shape.slice(0,r.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),a=r.shape[r.shape.length-1],A(n>0&&n<=a,(function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+a+"), but got "+n})),[4,r.data()];case 1:return o=c.sent(),[4,i.data()];case 2:for(s=c.sent(),u=[o.length/a,a],f=u[1],d=U("bool",l=u[0]),h=0;h<l;h++){for(p=h*f,m=o.subarray(p,p+f),v=[],g=0;g<m.length;g++)v.push({value:m[g],index:g});for(v.sort((function(e,t){return t.value-e.value})),d[h]=0,g=0;g<n;g++)if(v[g].index===s[h]){d[h]=1;break}}return e!==r&&r.dispose(),t!==i&&i.dispose(),[2,Rn(d,i.shape,"bool")]}}))}))};!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(Hc||(Hc={}));var Qc=Mn({absoluteDifference_:function(e,t,n,r){void 0===r&&(r=Hc.SUM_BY_NONZERO_WEIGHTS);var i=xn(e,"labels","absoluteDifference"),a=xn(t,"predictions","absoluteDifference"),o=null;null!=n&&(o=xn(n,"weights","absoluteDifference")),O(i.shape,a.shape,"Error in absoluteDifference: ");var s=i.sub(a).abs();return el(s,o,r)}}),el=Mn({computeWeightedLoss_:function(e,t,n){void 0===n&&(n=Hc.SUM_BY_NONZERO_WEIGHTS);var r=xn(e,"losses","computeWeightedLoss"),i=null;null!=t&&(i=xn(t,"weights","computeWeightedLoss"));var a=null==i?r:r.mul(i);if(n===Hc.NONE)return a;if(n===Hc.SUM)return a.sum();if(n===Hc.MEAN){if(null==i)return a.mean();var o=r.size/i.size,s=a.sum().div(i.sum());return o>1?s.div(Bn(o)):s}if(n===Hc.SUM_BY_NONZERO_WEIGHTS){if(null==i)return a.sum().div(Bn(r.size));var u=i.mul(Hn(r.shape)).notEqual(Bn(0)).sum().toFloat();return a.sum().div(u)}throw Error("Unknown reduction: "+n)}}),tl=Mn({cosineDistance_:function(e,t,n,r,i){void 0===i&&(i=Hc.SUM_BY_NONZERO_WEIGHTS);var a=xn(e,"labels","cosineDistance"),o=xn(t,"predictions","cosineDistance"),s=null;null!=r&&(s=xn(r,"weights","cosineDistance")),O(a.shape,o.shape,"Error in cosineDistance: ");var u=Bn(1).sub(a.mul(o).sum(n,!0));return el(u,s,i)}}),nl=Mn({hingeLoss_:function(e,t,n,r){void 0===r&&(r=Hc.SUM_BY_NONZERO_WEIGHTS);var i=xn(e,"labels","hingeLoss"),a=xn(t,"predictions","hingeLoss"),o=null;null!=n&&(o=xn(n,"weights","hingeLoss")),O(i.shape,a.shape,"Error in hingeLoss: ");var s=Bn(1);i=Bn(2).mul(i).sub(s);var u=s.sub(i.mul(a)).relu();return el(u,o,r)}}),rl=Mn({huberLoss_:function(e,t,n,r,i){void 0===r&&(r=1),void 0===i&&(i=Hc.SUM_BY_NONZERO_WEIGHTS);var a=xn(e,"labels","huberLoss"),o=xn(t,"predictions","huberLoss"),s=null;null!=n&&(s=xn(n,"weights","huberLoss")),O(a.shape,o.shape,"Error in huberLoss: ");var u=Bn(r),c=o.sub(a).abs(),l=tu(c,u),f=c.sub(l),d=Bn(.5).mul(l.square()).add(u.mul(f));return el(d,s,i)}}),il=Mn({logLoss_:function(e,t,n,r,i){void 0===r&&(r=1e-7),void 0===i&&(i=Hc.SUM_BY_NONZERO_WEIGHTS);var a=xn(e,"labels","logLoss"),o=xn(t,"predictions","logLoss"),s=null;null!=n&&(s=xn(n,"weights","logLoss")),O(a.shape,o.shape,"Error in logLoss: ");var u=Bn(1),c=Bn(r),l=a.mul(o.add(c).log()).neg().sub(u.sub(a).mul(u.sub(o).add(c).log()));return el(l,s,i)}}),al=Mn({meanSquaredError_:function(e,t,n,r){void 0===r&&(r=Hc.SUM_BY_NONZERO_WEIGHTS);var i=xn(e,"labels","meanSquaredError"),a=xn(t,"predictions","meanSquaredError"),o=null;null!=n&&(o=xn(n,"weights","meanSquaredError")),O(i.shape,a.shape,"Error in meanSquaredError: ");var s=i.squaredDifference(a);return el(s,o,r)}}),ol=Mn({sigmoidCrossEntropy_:function(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=Hc.SUM_BY_NONZERO_WEIGHTS);var a=xn(e,"multiClassLabels","sigmoidCrossEntropy"),o=xn(t,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=xn(n,"weights","sigmoidCrossEntropy")),O(a.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=Bn(r),c=Bn(1),l=Bn(.5);a=a.mul(c.sub(u)).add(l.mul(u))}var f=function(e,t){var n=xn(e,"labels","sigmoidCrossEntropyWithLogits"),r=xn(t,"logits","sigmoidCrossEntropyWithLogits");O(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var i=r.relu(),a=r.mul(n),o=r.abs().neg().exp().log1p();return i.sub(a).add(o)}(a,o);return el(f,s,i)}}),sl=Mn({softmaxCrossEntropy_:function(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=Hc.SUM_BY_NONZERO_WEIGHTS);var a=xn(e,"onehotLabels","softmaxCrossEntropy"),o=xn(t,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=xn(n,"weights","softmaxCrossEntropy")),O(a.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){var u=Bn(r),c=Bn(1),l=Bn(a.shape[1]);a=a.mul(c.sub(u)).add(u.div(l))}var f=function(e,t,n){if(void 0===n&&(n=-1),-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+t.rank+" and dim was "+n);return yi((function(e,t,r){var i=t.logSumExp([n],!0),a=t.toFloat().sub(i);return r([e,a]),{value:a.mul(e).neg().sum([n]),gradFunc:function(e,t){var r=t[0],i=t[1],a=Sn(e.shape,[n]);return[e.reshape(a).mul(r.toFloat().sub(i.exp())),e.reshape(a).mul(i.exp().sub(r.toFloat()))]}}}))(e,t)}(a,o);return el(f,s,i)}}),ul=Object.freeze({get Reduction(){return Hc},absoluteDifference:Qc,computeWeightedLoss:el,cosineDistance:tl,hingeLoss:nl,huberLoss:rl,logLoss:il,meanSquaredError:al,sigmoidCrossEntropy:ol,softmaxCrossEntropy:sl});function cl(e,t){return void 0===t&&(t=!1),We.tidy((function(){if(2!==e.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+e.shape.length+"D Tensor.");for(var n=e.shape[0],r=e.shape[1],i=Cr(n),a=e.clone(),o=zn([[1]],[1,1]),s=o.clone(),u=n>=r?r:n,c=function(e){var t,u=a,c=s,l=i;t=We.tidy((function(){var t=a.slice([e,e],[n-e,1]),u=t.norm(),c=a.slice([e,e],[1,1]),l=zn([[-1]]).where(c.greater(0),zn([[1]])),f=c.sub(l.mul(u)),d=t.div(f);s=1===d.shape[0]?o.clone():o.concat(d.slice([1,0],[d.shape[0]-1,d.shape[1]]),0);var h=l.matMul(f).div(u).neg(),p=a.slice([e,0],[n-e,r]),m=h.mul(s);if(0===e)a=p.sub(m.matMul(s.transpose().matMul(p)));else{var v=p.sub(m.matMul(s.transpose().matMul(p)));a=a.slice([0,0],[e,r]).concat(v,0)}var g=i.slice([0,e],[n,i.shape[1]-e]);if(0===e)i=g.sub(g.matMul(s).matMul(m.transpose()));else{var y=g.sub(g.matMul(s).matMul(m.transpose()));i=i.slice([0,0],[n,e]).concat(y,1)}return[s,a,i]})),s=t[0],a=t[1],i=t[2],an([u,c,l])},l=0;l<u;++l)c(l);return!t&&n>r&&(i=i.slice([0,0],[n,r]),a=a.slice([0,0],[r,r])),[i,a]}))}var ll=Mn({bandPart_:function(e,t,n){if(t%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+t+".");if(n%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+n+".");var r=xn(e,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var i=r.shape,a=r.shape.slice(-2),o=a[0],s=a[1];if(!(t<=o))throw new Error("bandPart(): numLower ("+t+") must not be greater than the number of rows ("+o+").");if(!(n<=s))throw new Error("bandPart(): numUpper ("+n+") must not be greater than the number of columns ("+s+").");t<0&&(t=o),n<0&&(n=s);var u=$n(0,o,1,"int32").reshape([-1,1]),c=$n(0,s,1,"int32"),l=lu(u,c),f=Ls(l.lessEqual(Bn(+t,"int32")),l.greaterEqual(Bn(-n,"int32"))),d=Xn([o,s],r.dtype);return Ur(Gr(r.reshape([-1,o,s])).map((function(e){return Vs(f,e,d)}))).reshape(i)}}),fl=Mn({gramSchmidt_:function(e){var t;if(Array.isArray(e)){t=!1,A(null!=e&&e.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var n=e[0].shape[0],r=function(t){A(e[t].shape[0]===n,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+e[t].shape[0]+" vs. "+n+")"}))},i=1;i<e.length;++i)r(i)}else t=!0,e=ir(e,e.shape[0],0).map((function(e){return zr(e,[0])}));A(e.length<=e[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors ("+e.length+") exceeds number of dimensions ("+e[0].shape[0]+")."}));var a=[],o=e,s=function(e){a.push(We.tidy((function(){var t=o[e];if(e>0)for(var n=0;n<e;++n){var r=bc(a[n].mulStrict(t)).mul(a[n]);t=t.sub(r)}return t.div(Dc(t,"euclidean"))})))};for(i=0;i<e.length;++i)s(i);return t?Ur(a,0):a}}),dl=Mn({qr_:function(e,t){if(void 0===t&&(t=!1),e.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+e.rank);if(2===e.rank)return cl(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce((function(e,t){return e*t})),r=[],i=[];return Gr(e.reshape([n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0).forEach((function(e){var n=cl(e,t),a=n[0],o=n[1];r.push(a),i.push(o)})),[Ur(r,0).reshape(e.shape),Ur(i,0).reshape(e.shape)]}}),hl=Object.freeze({bandPart:ll,gramSchmidt:fl,qr:dl});function pl(e,t,n,r,i,a){null==r&&(r=.5),null==i&&(i=Number.NEGATIVE_INFINITY),null==a&&(a=0);var o=e.shape[0];return n=Math.min(n,o),A(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"})),A(2===e.rank,(function(){return"boxes must be a 2D tensor, but was of rank '"+e.rank+"'"})),A(4===e.shape[1],(function(){return"boxes must have 4 columns, but 2nd dimension was "+e.shape[1]})),A(1===t.rank,(function(){return"scores must be a 1D tensor"})),A(t.shape[0]===o,(function(){return"scores has incompatible shape with boxes. Expected "+o+", but was "+t.shape[0]})),A(0<=a&&a<=1,(function(){return"softNmsSigma must be in [0, 1], but was '"+a+"'"})),{maxOutputSize:n,iouThreshold:r,scoreThreshold:i,softNmsSigma:a}}var ml=Mn({resizeBilinear_:function(e,t,n){void 0===n&&(n=!1);var r=xn(e,"images","resizeBilinear");A(3===r.rank||4===r.rank,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."})),A(2===t.length,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."}));var i=r,a=!1;3===r.rank&&(a=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var o=t[0],s=t[1],u=We.runKernelFunc((function(e,t){return t([i]),e.resizeBilinear(i,o,s,n)}),{x:i},(function(e,t){return{x:function(){return We.runKernelFunc((function(r){return r.resizeBilinearBackprop(e,t[0],n)}),{})}}}),"ResizeBilinear",{alignCorners:n,newHeight:o,newWidth:s});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),vl=Mn({resizeNearestNeighbor_:function(e,t,n){void 0===n&&(n=!1);var r=xn(e,"images","resizeNearestNeighbor");A(3===r.rank||4===r.rank,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."})),A(2===t.length,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."})),A("float32"===r.dtype||"int32"===r.dtype,(function(){return"`images` must have `int32` or `float32` as dtype"}));var i=r,a=!1;3===r.rank&&(a=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var o=t[0],s=t[1],u=We.runKernelFunc((function(e,t){return t([i]),e.resizeNearestNeighbor(i,o,s,n)}),{batchImages:i},(function(e,t){return{batchImages:function(){return We.runKernelFunc((function(r){return r.resizeNearestNeighborBackprop(e,t[0],n)}),{})}}}));return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),gl=Mn({nonMaxSuppression_:function(e,t,n,r,i){void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY);var a=xn(e,"boxes","nonMaxSuppression"),o=xn(t,"scores","nonMaxSuppression"),s=pl(a,o,n,r,i);n=s.maxOutputSize,r=s.iouThreshold,i=s.scoreThreshold;var u={maxOutputSize:n,iouThreshold:r,scoreThreshold:i};return We.runKernelFunc((function(e){return e.nonMaxSuppression(a,o,n,r,i)}),{boxes:a,scores:o},null,"NonMaxSuppressionV3",u)}}),yl=Mn({nonMaxSuppressionWithScore_:function(e,t,n,r,i,a){void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),void 0===a&&(a=0);var o=xn(e,"boxes","nonMaxSuppression"),s=xn(t,"scores","nonMaxSuppression"),u=pl(o,s,n,r,i,a),c={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:i=u.scoreThreshold,softNmsSigma:a=u.softNmsSigma},l=We.runKernel("NonMaxSuppressionV5",{boxes:o,scores:s},c);return{selectedIndices:l[0],selectedScores:l[1]}}}),bl=Mn({cropAndResize_:function(e,t,n,r,i,a){var o=xn(e,"image","cropAndResize"),s=xn(t,"boxes","cropAndResize","float32"),u=xn(n,"boxInd","cropAndResize","int32");i=i||"bilinear",a=a||0;var c=s.shape[0];return A(4===o.rank,(function(){return"Error in cropAndResize: image must be rank 4,but got rank "+o.rank+"."})),A(2===s.rank&&4===s.shape[1],(function(){return"Error in cropAndResize: boxes must be have size ["+c+",4] but had shape "+s.shape+"."})),A(1===u.rank&&u.shape[0]===c,(function(){return"Error in cropAndResize: boxInd must be have size ["+c+"] but had shape "+s.shape+"."})),A(2===r.length,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."})),A(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was "+r})),A("bilinear"===i||"nearest"===i,(function(){return"method must be bilinear or nearest, but was "+i})),We.runKernelFunc((function(e,t){return e.cropAndResize(o,s,u,r,i,a)}),{images:o,boxes:s,boxInd:u},null,"CropAndResize",{method:i,extrapolationValue:a,cropSize:r})}}),xl=Object.freeze({resizeBilinear:ml,resizeNearestNeighbor:vl,nonMaxSuppression:gl,nonMaxSuppressionAsync:function(e,t,n,r,i){return void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),u(this,void 0,void 0,(function(){var a,o,s,u,l,f,d;return c(this,(function(c){switch(c.label){case 0:return a=xn(e,"boxes","nonMaxSuppressionAsync"),o=xn(t,"scores","nonMaxSuppressionAsync"),s=pl(a,o,n,r,i),n=s.maxOutputSize,r=s.iouThreshold,i=s.scoreThreshold,[4,Promise.all([a.data(),o.data()])];case 1:return u=c.sent(),l=u[0],f=u[1],d=$i(l,f,n,r,i),a!==e&&a.dispose(),o!==t&&o.dispose(),[2,d]}}))}))},nonMaxSuppressionWithScore:yl,nonMaxSuppressionWithScoreAsync:function(e,t,n,r,i,a){return void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),void 0===a&&(a=0),u(this,void 0,void 0,(function(){var o,s,u,l,f,d,h;return c(this,(function(c){switch(c.label){case 0:return o=xn(e,"boxes","nonMaxSuppressionAsync"),s=xn(t,"scores","nonMaxSuppressionAsync"),u=pl(o,s,n,r,i,a),n=u.maxOutputSize,r=u.iouThreshold,i=u.scoreThreshold,a=u.softNmsSigma,[4,Promise.all([o.data(),s.data()])];case 1:return l=c.sent(),f=l[0],d=l[1],h=Ji(f,d,n,r,i,a),o!==e&&o.dispose(),s!==t&&s.dispose(),[2,h]}}))}))},cropAndResize:bl}),wl=function(e,t){return!(e>0)||"linear"===t},_l=function(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return e.mul(t.step());throw new Error("Gradient for activation "+n+" has not been implemented yet.")},kl=function(e,t){var n=t,r=Ci(e.shape,t.shape);return r.length>0&&(n=n.sum(r)),n.reshape(e.shape)},El=function(e,t,n){if("linear"===t)return e;if("relu"===t)return Ec(e);if("elu"===t)return wc(e);if("relu6"===t)return Sc(e);if("prelu"===t)return kc(e,n);throw new Error("Unknown fused activation "+t+".")},Sl=Mn({fusedMatMul_:function(e){var t,n=e.a,r=e.b,i=e.transposeA,a=void 0!==i&&i,o=e.transposeB,s=void 0!==o&&o,u=e.bias,c=e.activation,l=void 0===c?"linear":c,f=e.preluActivationWeights;if(!1===wl(We.state.gradientDepth,l)){var d=Vu(n,r,a,s);return null!=u&&(d=qs(d,u)),El(d,l,f)}var h=xn(n,"a","fused matMul"),p=xn(r,"b","fused matMul");t=Ne(h,p),h=t[0],p=t[1];var m=a?h.shape[h.rank-2]:h.shape[h.rank-1],v=s?p.shape[p.rank-1]:p.shape[p.rank-2],g=a?h.shape[h.rank-1]:h.shape[h.rank-2],y=s?p.shape[p.rank-2]:p.shape[p.rank-1],b=h.shape.slice(0,-2),x=p.shape.slice(0,-2),w=j(b),_=j(x);A(h.rank>=2&&p.rank>=2&&h.rank===p.rank,(function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+h.rank+" and "+p.rank+"."})),A(M(b,x),(function(){return"Error in fused matMul: outer dimensions ("+b+") and ("+x+") of Tensors with shapes "+h.shape+" and "+p.shape+" must match."})),A(m===v,(function(){return"Error in fused matMul: inner shapes ("+m+") and ("+v+") of Tensors with shapes "+h.shape+" and "+p.shape+" and transposeA="+a+" and transposeB="+s+" must match."}));var k,E,S=h.shape.slice(0,-2).concat([g,y]),C=a?h.as3D(w,m,g):h.as3D(w,g,m),O=s?p.as3D(_,y,v):p.as3D(_,v,y);null!=u&&Ai(S,(k=Ne(k=xn(u,"bias","fused matMul"),h)[0]).shape),null!=f&&(E=xn(f,"prelu weights","fused matMul"));var D={a:C,b:O};null!=u&&(D.bias=k),null!=f&&(D.preluActivationWeights=E);var T=[C,O];return We.runKernelFunc((function(e,t){var n=e.fusedBatchMatMul({a:C,b:O,transposeA:a,transposeB:s,bias:k,activation:l,preluActivationWeights:E});return t([C,O,n]),n}),D,(function(e,t){var n=t[0],r=t[1],i=t[2],o=_l(e,i,l),c={};return null!=u&&(c={bias:function(){return kl(k,o)}}),a||s?!a&&s?Object.assign({a:function(){return o.matMul(r,!1,!1)},b:function(){return o.matMul(n,!0,!1)}},c):a&&!s?Object.assign({a:function(){return r.matMul(o,!1,!0)},b:function(){return n.matMul(o,!1,!1)}},c):Object.assign({a:function(){return r.matMul(o,!0,!0)},b:function(){return o.matMul(n,!0,!0)}},c):Object.assign({a:function(){return o.matMul(r,!1,!0)},b:function(){return n.matMul(o,!0,!1)}},c)}),"_FusedMatMul",{transposeA:a,transposeB:s,activation:l},T,[!0]).reshape(S)}}),Cl=Mn({fusedConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,i=e.pad,a=e.dataFormat,o=void 0===a?"NHWC":a,s=e.dilations,u=void 0===s?[1,1]:s,c=e.dimRoundingMode,l=e.bias,f=e.activation,d=void 0===f?"linear":f,h=e.preluActivationWeights;if(d=d||"linear",!1===wl(We.state.gradientDepth,d)){var p=Fu(t,n,r,i,o,u,c);return null!=l&&(p=qs(p,l)),El(p,d,h)}var m=xn(t,"x","conv2d"),v=xn(n,"filter","conv2d"),g=m,y=!1;3===m.rank&&(y=!0,g=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),A(4===g.rank,(function(){return"Error in fused conv2d: input must be rank 4, but got rank "+g.rank+"."})),A(4===v.rank,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+v.rank+"."})),null!=c&&A(F(i),(function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+c+" but got pad "+i+"."})),A(g.shape[3]===v.shape[2],(function(){return"Error in conv2d: depth of input ("+g.shape[3]+") must match input depth for filter "+v.shape[2]+"."})),A(Bi(r,u),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"})),A("NHWC"===o,(function(){return"Error in conv2d: got dataFormat of "+o+" but only NHWC is currently supported."}));var b,x,w=Ti(g.shape,v.shape,r,u,i,c);null!=l&&(b=Ne(b=xn(l,"bias","fused conv2d"),m)[0],Ai(w.outShape,b.shape)),null!=h&&(x=xn(h,"prelu weights","fused conv2d"));var _={x:g,filter:v};null!=l&&(_.bias=b),null!=h&&(_.preluActivationWeights=x);var k=[v,g],E=We.runKernelFunc((function(e,t){var n=e.fusedConv2d({input:g,filter:v,convInfo:w,bias:b,activation:d,preluActivationWeights:x});return t([v,g,n]),n}),_,(function(e,t){var n=t,a=n[0],o=n[1],s=n[2],c=_l(e,s,d);A(Pi(u),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"}));var f={};return null!=l&&(f={bias:function(){return kl(b,c)}}),Object.assign({x:function(){return Ru(o.shape,c,a,r,i)},filter:function(){return Nu(o,c,a.shape,r,i)}},f)}),"FusedConv2D",{convInfo:w,activation:d},k,[!0]);return y?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}}),Al=Mn({fusedDepthwiseConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,i=e.pad,a=e.dataFormat,o=void 0===a?"NHWC":a,s=e.dilations,u=void 0===s?[1,1]:s,c=e.dimRoundingMode,l=e.bias,f=e.activation,d=void 0===f?"linear":f,h=e.preluActivationWeights;if(!1===wl(We.state.gradientDepth,d)){var p=Pu(t,n,r,i,o,u,c);return null!=l&&(p=qs(p,l)),El(p,d,h)}var m=xn(t,"x","depthwiseConv2d"),v=xn(n,"filter","depthwiseConv2d"),g=m,y=!1;3===m.rank&&(y=!0,g=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),A(4===g.rank,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+g.rank+"."})),A(4===v.rank,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+v.rank+"."})),A(g.shape[3]===v.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels ("+g.shape[3]+") must match the inChannels dimension in filter "+v.shape[2]+"."})),null==u&&(u=[1,1]),A(Bi(r,u),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"})),null!=c&&A(F(i),(function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+c+" but got pad "+i+"."}));var b,x,w=Ti(g.shape,v.shape,r,u,i,c,!0);null!=l&&(b=Ne(b=xn(l,"bias","fused conv2d"),m)[0],Ai(w.outShape,b.shape)),null!=h&&(x=xn(h,"prelu weights","fused depthwiseConv2d"));var _={x:g,filter:v};null!=l&&(_.bias=b),null!=h&&(_.preluActivationWeights=x);var k=[v,g],E=We.runKernelFunc((function(e,t){var n=e.fusedDepthwiseConv2D({input:g,filter:v,convInfo:w,bias:b,activation:d,preluActivationWeights:x});return t([v,g,n]),n}),_,(function(e,t){A(Pi(u),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"}));var n=t[0],r=t[1],i=t[2],a=_l(e,i,d),o={};return null!=l&&(o={bias:function(){return kl(b,a)}}),Object.assign({x:function(){return Bu(r.shape,a,n,w)},filter:function(){return Lu(r,a,n.shape,w)}},o)}),"FusedDepthwiseConv2D",{convInfo:w,activation:d},k,[!0]);return y?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}}),Ol=Object.freeze({matMul:Sl,conv2d:Cl,depthwiseConv2d:Al}),Dl=Object.freeze({image:xl,linalg:hl,losses:ul,spectral:zc,fused:Ol,signal:Jc,square:Wo,squaredDifference:Go,conv1d:Mu,conv2d:Fu,conv3d:Iu,depthwiseConv2d:Pu,separableConv2d:zu,conv2dTranspose:Uu,conv3dTranspose:Wu,op:Mn,batchNormalization2d:js,batchNormalization3d:Ms,batchNormalization4d:Fs,batchNormalization:Is,batchNorm:Ns,batchNorm2d:Rs,batchNorm3d:Ps,batchNorm4d:Bs,booleanMaskAsync:Ou,complex:Fn,real:In,imag:Nn,concat:Qn,concat1d:er,concat2d:tr,concat3d:nr,concat4d:rr,split:ir,matMul:Vu,dot:Gu,outerProduct:qu,reverse:Hu,reverse1d:Xu,reverse2d:Ku,reverse3d:Yu,reverse4d:$u,maxPool:Qu,avgPool:ec,pool:tc,maxPool3d:nc,avgPool3d:rc,slice:ic,slice1d:ac,slice2d:oc,slice3d:sc,slice4d:uc,abs:qo,acos:Ho,acosh:Xo,asin:Ko,asinh:Yo,atan:$o,atanh:Jo,ceil:Zo,clipByValue:Qo,cos:es,cosh:ts,erf:ns,exp:rs,expm1:is,floor:as,log:os,log1p:ss,logSigmoid:us,neg:cs,reciprocal:ls,round:fs,rsqrt:ds,sigmoid:hs,sign:ps,isNaN:ms,isInf:vs,isFinite:gs,sin:ys,sinh:bs,softplus:xs,sqrt:ws,step:_s,tan:ks,tanh:Es,all:lc,any:fc,argMax:dc,argMin:hc,logSumExp:pc,max:mc,mean:vc,min:gc,moments:yc,sum:bc,prod:xc,equal:du,equalStrict:hu,greater:pu,greaterEqual:mu,greaterEqualStrict:vu,greaterStrict:gu,less:yu,lessEqual:bu,lessEqualStrict:xu,lessStrict:wu,notEqual:_u,notEqualStrict:ku,add:qs,addN:Hs,addStrict:Xs,atan2:Ks,div:Ys,divNoNan:$s,divStrict:Js,floorDiv:Zs,maximum:Qs,maximumStrict:eu,minimum:tu,minimumStrict:nu,mod:ru,modStrict:iu,mul:au,mulStrict:ou,pow:su,powStrict:uu,squaredDifferenceStrict:cu,sub:lu,subStrict:fu,elu:wc,leakyRelu:_c,prelu:kc,relu:Ec,relu6:Sc,selu:Cc,logicalAnd:Ls,logicalNot:zs,logicalOr:Us,logicalXor:Ws,where:Vs,whereAsync:Gs,buffer:gr,print:yr,batchToSpaceND:br,broadcastTo:xr,cast:wr,clone:_r,cumsum:kr,depthToSpace:Er,expandDims:Sr,eye:Cr,multinomial:Ar,oneHot:Or,pad:Dr,pad1d:Tr,pad2d:jr,pad3d:Mr,pad4d:Fr,rand:Ir,randomNormal:Nr,randomGamma:Rr,randomUniform:Pr,reshape:Br,spaceToBatchND:Lr,squeeze:zr,stack:Ur,tile:Wr,truncatedNormal:Vr,unstack:Gr,setdiff1dAsync:qr,fill:Kn,linspace:Yn,ones:Hn,range:$n,scalar:Bn,tensor:Rn,tensor1d:Ln,tensor2d:zn,tensor3d:Un,tensor4d:Wn,tensor5d:Vn,tensor6d:Gn,variable:qn,zeros:Xn,onesLike:Jn,zerosLike:Zn,transpose:Ac,softmax:xi,logSoftmax:wi,localResponseNormalization:Oc,norm:Dc,gather:Cu,unsortedSegmentSum:Au,basicLSTMCell:Tc,multiRNNCell:jc,movingAverage:Mc,stridedSlice:Fc,topk:Ic,scatterND:Nc,fft:Rc,ifft:Pc,rfft:Bc,irfft:Lc,sparseToDense:Uc,gatherND:Wc,diag:Vc,dropout:Gc,hannWindow:Xc,hammingWindow:Kc,frame:Yc,stft:$c,inTopKAsync:Zc});function Tl(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&A("complex64"!==e.dtype,(function(){return t+" does not support complex64 tensors."}))}))}function jl(e,t,n,r){if("linear"===n)return e.linear(t);if("relu"===n)return e.relu(t);if("elu"===n)return e.elu(t);if("relu6"===n)return e.relu6(t);if("prelu"===n)return e.prelu(t,r);throw new Error("Activation "+n+" has not been implemented for the CPU backend.")}var Ml=function(e){function t(){var t=e.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new _i(t,We),t}return s(t,e),t.prototype.write=function(e,t,n){this.firstUse&&(this.firstUse=!1,f().get("IS_NODE")&&gn("\n============================\nHi there \ud83d\udc4b. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var r={};return this.data.set(r,{values:e,dtype:n}),r},t.prototype.move=function(e,t,n,r){this.data.set(e,{values:t,dtype:r})},t.prototype.numDataIds=function(){return this.data.numDataIds()},t.prototype.read=function(e){return u(this,void 0,void 0,(function(){return c(this,(function(t){return[2,this.readSync(e)]}))}))},t.prototype.readSync=function(e){var t=this.data.get(e),n=t.dtype,r=t.complexTensors;return"complex64"===n?Gi(this.readSync(r.real.dataId),this.readSync(r.imag.dataId)):this.data.get(e).values},t.prototype.bufferSync=function(e){var t=this.readSync(e.dataId),n=t;if("string"===e.dtype)try{n=t.map((function(e){return ce(e)}))}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8")}return gr(e.shape,e.dtype,n)},t.prototype.makeOutput=function(e,t,n){var r=this.write(e,t,n);return We.makeTensorFromDataId(r,t,n,this)},t.prototype.disposeData=function(e){if(this.data.has(e)){var t=this.data.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.data.delete(e)}},t.prototype.time=function(e){return u(this,void 0,void 0,(function(){var t;return c(this,(function(n){return t=oe(),e(),[2,{kernelMs:oe()-t}]}))}))},t.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},t.prototype.complex=function(e,t){var n=this.makeOutput(null,e.shape,"complex64");return this.data.get(n.dataId).complexTensors={real:We.keep(e.clone()),imag:We.keep(t.clone())},n},t.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,t,n){if(Tl(e,"slice"),li(e.shape,t,n)){var r=fi(t,e.strides),i=j(n);return Rn(this.readSync(e.dataId).subarray(r,r+i),n,e.dtype)}for(var a=gr(n,e.dtype),o=this.bufferSync(e),s=0;s<a.size;++s){var u=a.indexToLoc(s).map((function(e,n){return e+t[n]}));a.values[s]=o.get.apply(o,u)}return a.toTensor()},t.prototype.stridedSlice=function(e,t,n,r){Tl(e,"stridedSlice");var i=si(t,n,r);if(i.some((function(e){return 0===e})))return Rn([],i);for(var a=gr(i,e.dtype),o=this.bufferSync(e),s=0;s<a.size;s++){for(var u=a.indexToLoc(s),c=new Array(u.length),l=0;l<c.length;l++)c[l]=u[l]*r[l]+t[l];a.set.apply(a,[o.get.apply(o,c)].concat(u))}return a.toTensor()},t.prototype.diag=function(e){for(var t=this.readSync(e.dataId),n=gr([e.size,e.size],e.dtype),r=n.values,i=0;i<t.length;i++)r[i*e.size+i]=t[i];return n.toTensor()},t.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),i=0,a=0;a<e.rank;a++)a!==t&&(r[i++]=e.shape[a]);var o=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;var u=new Array(n);for(a=0;a<u.length;a++)o[t]=a,u[a]=this.slice(e,o,s).reshape(r);return u},t.prototype.reverse=function(e,t){Tl(e,"reverse");for(var n=gr(e.shape,e.dtype),r=this.bufferSync(e),i=function(i){var a=n.indexToLoc(i),o=a.slice();t.forEach((function(t){return o[t]=e.shape[t]-1-o[t]})),n.set.apply(n,[r.get.apply(r,o)].concat(a))},a=0;a<n.size;a++)i(a);return n.toTensor()},t.prototype.concat=function(e,t){var n=this;if("complex64"===e[0].dtype){var r=e.map((function(e){return In(e)})),i=e.map((function(e){return Nn(e)}));return Fn(this.concat(r,t),this.concat(i,t))}var a=e.map((function(e){var n=j(e.shape.slice(t));return e.as2D(-1,n)})),o=jn(a.map((function(e){return e.shape})),1),s=gr(o,e[0].dtype).values;if(1===a[0].shape[0]){var u=0;a.forEach((function(e){s.set(n.readSync(e.dataId),u),u+=e.size}))}else{var c=0;a.forEach((function(e){for(var t=n.readSync(e.dataId),r=0,i=0;i<e.shape[0];++i)for(var a=i*o[1]+c,u=0;u<e.shape[1];++u)s[a+u]=t[r++];c+=e.shape[1]}))}var l=jn(e.map((function(e){return e.shape})),t);return Rn(s,l,e[0].dtype)},t.prototype.neg=function(e){return Tl(e,"neg"),this.multiply(Bn(-1),e)},t.prototype.add=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),(function(e,t,n,r){return{real:e+n,imag:t+r}})):this.broadcastedBinaryOp(e,t,Fe(e.dtype,t.dtype),(function(e,t){return e+t}))},t.prototype.addN=function(e){var t=this;Tl(e,"addN");for(var n=e.map((function(e){return t.readSync(e.dataId)})),r=gr(e[0].shape,e[0].dtype),i=r.values,a=0;a<e.length;a++)for(var o=n[a],s=0;s<i.length;s++)i[s]+=o[s];return r.toTensor()},t.prototype.softmax=function(e,t){var n=L([t],e.shape),r=this.max(e,n),i=Sn(r.shape,n),a=this.subtract(e,r.reshape(i)),o=this.exp(a),s=this.sum(o,n).reshape(i);return this.realDivide(o,s)},t.prototype.subtract=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),(function(e,t,n,r){return{real:e-n,imag:t-r}})):this.broadcastedBinaryOp(e,t,Fe(e.dtype,t.dtype),(function(e,t){return e-t}))},t.prototype.pow=function(e,t){return Tl([e,t],"pow"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.pow(e,t)}))},t.prototype.batchMatMul=function(e,t,n,r){Tl([e,t],"matMul");for(var i=n?e.shape[1]:e.shape[2],a=n?e.shape[2]:e.shape[1],o=r?t.shape[1]:t.shape[2],s=e.shape[0],u=this.readSync(e.dataId),c=this.readSync(t.dataId),l=n?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],f=l[0],d=l[1],h=l[2],p=r?[1,t.strides[1],t.strides[0]]:[t.strides[1],1,t.strides[0]],m=p[0],v=p[1],g=p[2],y=a*o,b=gr([s,a,o],e.dtype),x=b.values,w=this.blockSize,_=0;_<s;_++)for(var k=0;k<a;k+=w)for(var E=0;E<o;E+=w)for(var S=0;S<i;S+=w)for(var C=Math.min(k+w,a),A=Math.min(E+w,o),O=Math.min(S+w,i),D=k;D<C;D++)for(var T=E;T<A;T++){for(var j=0,M=S;M<O;M++)j+=u[_*f+D*d+M*h]*c[M*m+T*v+_*g];x[_*y+(D*o+T)]+=j}return b.toTensor()},t.prototype.fusedBatchMatMul=function(e){var t=e.a,n=e.b,r=e.transposeA,i=e.transposeB,a=e.bias,o=e.activation,s=e.preluActivationWeights,u=this.batchMatMul(t,n,r,i);return a&&(u=this.add(u,a)),o&&(u=jl(this,u,o,s)),u},t.prototype.multiply=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),(function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}})):this.broadcastedBinaryOp(e,t,Fe(e.dtype,t.dtype),(function(e,t){return e*t}))},t.prototype.realDivide=function(e,t){return Tl([e,t],"realDivide"),this.broadcastedBinaryOp(e,t,"float32",(function(e,t){return e/t}))},t.prototype.floorDiv=function(e,t){return Tl([e,t],"floorDiv"),this.broadcastedBinaryOp(e,t,"int32",(function(e,t){return Math.floor(e/t)}))},t.prototype.sum=function(e,t){Tl(e,"sum"),Cn("sum",t,e.rank);for(var n=En(e.shape,t),r=n[0],i=n[1],a=Xn(r,Fe(e.dtype,"int32")),o=j(i),s=this.readSync(a.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*o,f=0,d=0;d<o;++d)f+=u[l+d];s[c]=f}return a},t.prototype.prod=function(e,t){Tl(e,"sum");for(var n=En(e.shape,t),r=n[0],i=n[1],a=Xn(r,Fe(e.dtype,"int32")),o=j(i),s=this.readSync(a.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*o,f=1,d=0;d<o;++d)f*=u[l+d];s[c]=f}return a},t.prototype.unsortedSegmentSum=function(e,t,n){Tl(e,"unsortedSegmentSum");for(var r=[],i=e.rank-t.rank,a=0;a<i;++a)t=t.expandDims(a+1);for(a=0;a<n;++a){var o=Bn(a,"int32"),s=du(o,t).asType("float32").mul(e).sum(0);r.push(s)}return Ur(r)},t.prototype.argMin=function(e,t){Tl(e,"argMin");var n=[t];Cn("argMin",n,e.rank);for(var r=En(e.shape,n),i=r[0],a=r[1],o=Xn(i,"int32"),s=j(a),u=this.readSync(o.dataId),c=this.readSync(e.dataId),l=0;l<u.length;++l){for(var f=l*s,d=c[f],h=0,p=0;p<s;++p){var m=c[f+p];m<d&&(d=m,h=p)}u[l]=h}return o},t.prototype.argMax=function(e,t){Tl(e,"argMax");var n=[t];Cn("argMax",n,e.rank);for(var r=En(e.shape,n),i=r[0],a=r[1],o=Xn(i,"int32"),s=j(a),u=this.readSync(o.dataId),c=this.readSync(e.dataId),l=0;l<u.length;++l){for(var f=l*s,d=c[f],h=0,p=0;p<s;++p){var m=c[f+p];m>d&&(d=m,h=p)}u[l]=h}return o},t.prototype.cumsum=function(e,t,n,r){if(Tl(e,"cumsum"),t!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+t);for(var i=Fe(e.dtype,"int32"),a=Xn(e.shape,i),o=this.readSync(a.dataId),s=this.readSync(e.dataId),u=e.shape[e.rank-1],c=r?function(e,t){return e+u-t-1}:function(e,t){return e+t},l=0;l<s.length;l+=u)for(var f=0;f<u;f++){var d=c(l,f);if(0===f)o[d]=n?0:s[d];else{var h=c(l,f-1);o[d]=n?s[h]+o[h]:s[d]+o[h]}}return a},t.prototype.equal=function(e,t){return Tl([e,t],"equal"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e===t?1:0}))},t.prototype.notEqual=function(e,t){return Tl([e,t],"notEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e!==t?1:0}))},t.prototype.less=function(e,t){return Tl([e,t],"less"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e<t?1:0}))},t.prototype.lessEqual=function(e,t){return Tl([e,t],"lessEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e<=t?1:0}))},t.prototype.greater=function(e,t){return Tl([e,t],"greater"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e>t?1:0}))},t.prototype.greaterEqual=function(e,t){return Tl([e,t],"greaterEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e>=t?1:0}))},t.prototype.logicalNot=function(e){Tl(e,"logicalNot");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t[r]?0:1;return this.makeOutput(n,e.shape,"bool")},t.prototype.logicalAnd=function(e,t){return Tl([e,t],"logicalAnd"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e&&t}))},t.prototype.logicalOr=function(e,t){return Tl([e,t],"logicalOr"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e||t}))},t.prototype.select=function(e,t,n){Tl([e,t,n],"select");for(var r=this.readSync(e.dataId),i=this.readSync(t.dataId),a=this.readSync(n.dataId),o=Xn(t.shape,Fe(t.dtype,n.dtype)),s=this.readSync(o.dataId),u=0,c=0===e.rank||e.rank>1||1===t.rank?1:j(t.shape.slice(1)),l=0;l<r.length;l++)for(var f=0;f<c;f++)1===r[l]?s[u++]=i[l]:s[u++]=a[l];return o},t.prototype.where=function(e){Tl([e],"where");var t=this.readSync(e.dataId);return aa(e.shape,t)},t.prototype.topk=function(e,t,n){return Tl(e,"topk"),ia(this.readSync(e.dataId),e.shape,e.dtype,t)},t.prototype.min=function(e,t){Tl(e,"min"),Cn("min",t,e.rank);for(var n=En(e.shape,t),r=n[0],i=n[1],a=Xn(r,e.dtype),o=j(i),s=this.readSync(a.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*o,f=u[l],d=0;d<o;++d){var h=u[l+d];h<f&&(f=h)}s[c]=f}return a},t.prototype.minimum=function(e,t){return Tl([e,t],"minimum"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.min(e,t)}))},t.prototype.mod=function(e,t){return Tl([e,t],"mod"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t}))},t.prototype.max=function(e,t){Tl(e,"max"),Cn("max",t,e.rank);for(var n=En(e.shape,t),r=n[0],i=n[1],a=Xn(r,e.dtype),o=j(i),s=this.readSync(a.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*o,f=u[l],d=0;d<o;++d){var h=u[l+d];h>f&&(f=h)}s[c]=f}return a},t.prototype.maximum=function(e,t){return Tl([e,t],"maximum"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.max(e,t)}))},t.prototype.all=function(e,t){Tl(e,"all"),Cn("all",t,e.rank);for(var n=En(e.shape,t),r=n[0],i=n[1],a=Xn(r,e.dtype),o=j(i),s=this.readSync(a.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*o,f=u[l],d=0;d<o;++d){var h=u[l+d];f=f&&h}s[c]=f}return a},t.prototype.any=function(e,t){Tl(e,"any"),Cn("any",t,e.rank);for(var n=En(e.shape,t),r=n[0],i=n[1],a=Xn(r,e.dtype),o=j(i),s=this.readSync(a.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*o,f=u[l],d=0;d<o;++d){var h=u[l+d];f=f||h}s[c]=f}return a},t.prototype.squaredDifference=function(e,t){return Tl([e,t],"squaredDifference"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){var n=e-t;return n*n}))},t.prototype.ceil=function(e){Tl(e,"ceil");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.ceil(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.floor=function(e){Tl(e,"floor");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.floor(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.sign=function(e){Tl(e,"x");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)t[r]<0?n[r]=-1:t[r]>0?n[r]=1:n[r]=0;return this.makeOutput(n,e.shape,"float32")},t.prototype.isNaN=function(e){Tl(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isNaN(t[r])&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.isInf=function(e){Tl(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Math.abs(t[r])===1/0&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.isFinite=function(e){Tl(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isFinite(t[r])&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.round=function(e){Tl(e,"round");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=Math.floor(t[r]);t[r]-i<.5?n[r]=Math.floor(t[r]):t[r]-i>.5?n[r]=Math.ceil(t[r]):n[r]=i%2==0?i:i+1}return this.makeOutput(n,e.shape,"float32")},t.prototype.exp=function(e){Tl(e,"exp");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.exp(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.expm1=function(e){Tl(e,"expm1");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.expm1(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.log=function(e){Tl(e,"log");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=t[r];n[r]=Math.log(i)}return this.makeOutput(n,e.shape,"float32")},t.prototype.log1p=function(e){Tl(e,"log1p");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=t[r];n[r]=Math.log1p(i)}return this.makeOutput(n,e.shape,"float32")},t.prototype.sqrt=function(e){Tl(e,"sqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=t[r];n[r]=Math.sqrt(i)}return this.makeOutput(n,e.shape,"float32")},t.prototype.rsqrt=function(e){Tl(e,"rsqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=t[r];n[r]=1/Math.sqrt(i)}return this.makeOutput(n,e.shape,"float32")},t.prototype.reciprocal=function(e){Tl(e,"reciprocal");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=1/t[r];return this.makeOutput(n,e.shape,"float32")},t.prototype.linear=function(e){return e},t.prototype.relu=function(e){Tl(e,"relu");for(var t=Xn(e.shape,e.dtype),n=this.readSync(t.dataId),r=this.readSync(e.dataId),i=0;i<r.length;++i)n[i]=Math.max(0,r[i]);return t},t.prototype.relu6=function(e){Tl(e,"relu");for(var t=Xn(e.shape,e.dtype),n=this.readSync(t.dataId),r=this.readSync(e.dataId),i=0;i<r.length;++i)n[i]=Math.min(Math.max(0,r[i]),6);return t},t.prototype.prelu=function(e,t){return Tl([e,t],"prelu"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return e<0?t*e:e}))},t.prototype.elu=function(e){Tl(e,"elu");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var i=n[r];t[r]=i>=0?i:Math.exp(i)-1}return this.makeOutput(t,e.shape,"float32")},t.prototype.eluDer=function(e,t){Tl([e,t],"eluDer");for(var n=new Float32Array(t.size),r=this.readSync(t.dataId),i=this.readSync(e.dataId),a=0;a<r.length;++a){var o=r[a];n[a]=o>=1?i[a]:i[a]*(o+1)}return this.makeOutput(n,t.shape,"float32")},t.prototype.selu=function(e){Tl(e,"selu");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var i=n[r];t[r]=i>=0?1.0507009873554805*i:1.7580993408473768*(Math.exp(i)-1)}return this.makeOutput(t,e.shape,"float32")},t.prototype.clip=function(e,t,n){Tl(e,"clip");for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),a=0;a<i.length;++a){var o=i[a];r[a]=o>n?n:o<t?t:o}return this.makeOutput(r,e.shape,"float32")},t.prototype.abs=function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.abs(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.complexAbs=function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<e.size;++r){var i=n[2*r],a=n[2*r+1];t[r]=Math.hypot(i,a)}return this.makeOutput(t,e.shape,"float32")},t.prototype.int=function(e){Tl(e,"int");for(var t=new Int32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=n[r];return this.makeOutput(t,e.shape,"int32")},t.prototype.sigmoid=function(e){Tl(e,"sigmoid");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=1/(1+Math.exp(-n[r]));return this.makeOutput(t,e.shape,"float32")},t.prototype.softplus=function(e){Tl(e,"softplus");for(var t=Math.log(1.1920928955078125e-7)+2,n=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i){var a,o=r[i]>-t,s=r[i]<t,u=Math.exp(r[i]);a=s?u:o?r[i]:Math.log(1+u),n[i]=a}return this.makeOutput(n,e.shape,"float32")},t.prototype.sin=function(e){Tl(e,"sin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.sin(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.cos=function(e){Tl(e,"cos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.cos(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.tan=function(e){Tl(e,"tan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.tan(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.asin=function(e){Tl(e,"asin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.asin(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.acos=function(e){Tl(e,"acos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.acos(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atan=function(e){Tl(e,"atan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.atan(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atan2=function(e,t){return Tl([e,t],"atan2"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.atan2(e,t)}))},t.prototype.sinh=function(e){Tl(e,"sinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.sinh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.cosh=function(e){Tl(e,"cosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.cosh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.tanh=function(e){Tl(e,"tanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=I(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.asinh=function(e){Tl(e,"asinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.asinh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.acosh=function(e){Tl(e,"acosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.acosh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atanh=function(e){Tl(e,"atanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.atanh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.erf=function(e){Tl(e,"erf");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var i=Math.sign(n[r]),a=Math.abs(n[r]),o=1/(1+.3275911*a);t[r]=i*(1-((((1.061405429*o-1.453152027)*o+1.421413741)*o-.284496736)*o+.254829592)*o*Math.exp(-a*a))}return this.makeOutput(t,e.shape,"float32")},t.prototype.step=function(e,t){void 0===t&&(t=0),Tl(e,"step");for(var n=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i){var a=r[i];isNaN(a)?n[i]=NaN:n[i]=a>0?1:t}return this.makeOutput(n,e.shape,"float32")},t.prototype.fusedConv2d=function(e){var t=e.input,n=e.filter,r=e.convInfo,i=e.bias,a=e.activation,o=e.preluActivationWeights,s=this.conv2d(t,n,r);return i&&(s=this.add(s,i)),a&&(s=jl(this,s,a,o)),s},t.prototype.conv2d=function(e,t,n){Tl([e,t],"conv2d");for(var r=n.filterHeight,i=n.filterWidth,a=n.dilationHeight,o=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,c="channelsLast"===n.dataFormat,l=gr(n.outShape,e.dtype),f=e.strides[0],d=c?e.strides[1]:e.strides[2],h=c?e.strides[2]:1,p=c?1:e.strides[1],m=l.strides[0],v=c?l.strides[1]:l.strides[2],g=c?l.strides[2]:1,y=c?1:l.strides[1],b=this.readSync(e.dataId),x=this.readSync(t.dataId),w=l.values,_=0;_<n.batchSize;++_)for(var k=_*f,E=_*m,S=0;S<n.outHeight;++S)for(var C=E+S*v,A=S*n.strideHeight-u,O=0;O<r;O++){var D=A+O*a;if(!(D<0||D>=n.inHeight))for(var T=O*t.strides[0],j=k+D*d,M=0;M<n.outWidth;++M)for(var F=C+M*g,I=M*n.strideWidth-s,N=0;N<i;N++){var R=I+N*o;if(!(R<0||R>=n.inWidth))for(var P=j+R*h,B=T+N*t.strides[1],L=0;L<n.inChannels;++L){for(var z=b[P+L*p],U=0;U<n.outChannels;++U)w[F+U*y]+=z*x[B+U];B+=n.outChannels}}}return l.toTensor()},t.prototype.conv3d=function(e,t,n){for(var r=n.filterDepth,i=n.filterHeight,a=n.filterWidth,o=n.dilationDepth,s=n.dilationHeight,u=n.dilationWidth,c=n.padInfo.front,l=n.padInfo.left,f=n.padInfo.top,d=gr(n.outShape,e.dtype),h=this.readSync(e.dataId),p=this.readSync(t.dataId),m=d.values,v=0;v<n.batchSize;++v)for(var g=v*e.strides[0],y=v*d.strides[0],b=0;b<n.outDepth;++b)for(var x=y+b*d.strides[1],w=b*n.strideDepth-c,_=0;_<r;_++){var k=w+_*o;if(!(k<0||k>=n.inDepth))for(var E=_*t.strides[0],S=g+k*e.strides[1],C=0;C<n.outHeight;++C)for(var A=x+C*d.strides[2],O=C*n.strideHeight-f,D=0;D<i;D++){var T=O+D*s;if(!(T<0||T>=n.inHeight))for(var j=E+D*t.strides[1],M=S+T*e.strides[2],F=0;F<n.outWidth;++F)for(var I=A+F*n.outChannels,N=F*n.strideWidth-l,R=0;R<a;R++){var P=N+R*u;if(!(P<0||P>=n.inWidth))for(var B=j+R*t.strides[2],L=M+P*n.inChannels,z=B,U=0;U<n.inChannels;++U){for(var W=h[L+U],V=0;V<n.outChannels;++V)m[I+V]+=W*p[z+V];z+=n.outChannels}}}}return d.toTensor()},t.prototype.conv2dDerInput=function(e,t,n){Tl([e,t],"conv2dDerInput");for(var r=gr(n.inShape,"float32"),i=r.values,a=this.readSync(e.dataId),o=this.readSync(t.dataId),s=t.strides,u=s[0],c=s[1],l=s[2],f=n.batchSize,d=n.filterHeight,h=n.filterWidth,p=n.inChannels,m=n.inHeight,v=n.inWidth,g=n.outChannels,y=n.outHeight,b=n.outWidth,x=n.strideHeight,w=n.strideWidth,_=n.dataFormat,k=d-1-n.padInfo.top,E=h-1-n.padInfo.left,S="channelsLast"===_,C=r.strides[0],A=S?r.strides[1]:r.strides[2],O=S?r.strides[2]:1,D=S?1:r.strides[1],T=e.strides[0],j=S?e.strides[1]:e.strides[2],M=S?e.strides[2]:1,F=S?1:e.strides[1],I=0;I<f;++I)for(var N=0;N<p;++N)for(var R=0;R<m;++R)for(var P=R-k,B=Math.max(0,Math.ceil(P/x)),L=Math.min(y,(d+P)/x),z=0;z<v;++z){for(var U=z-E,W=Math.max(0,Math.ceil(U/w)),V=Math.min(b,(h+U)/w),G=0,q=B;q<L;++q)for(var H=q*x-P,X=W;X<V;++X)for(var K=T*I+j*q+M*X,Y=u*(d-1-H)+c*(h-1-(X*w-U))+l*N,$=0;$<g;++$)G+=a[K+F*$]*o[Y+$];i[C*I+A*R+O*z+D*N]=G}return r.toTensor()},t.prototype.conv3dDerInput=function(e,t,n){for(var r=gr(n.inShape,"float32"),i=r.values,a=r.strides,o=a[0],s=a[1],u=a[2],c=a[3],l=this.readSync(e.dataId),f=e.strides,d=f[0],h=f[1],p=f[2],m=f[3],v=this.readSync(t.dataId),g=t.strides,y=g[0],b=g[1],x=g[2],w=g[3],_=n.batchSize,k=n.filterDepth,E=n.filterHeight,S=n.filterWidth,C=n.inChannels,A=n.inDepth,O=n.inHeight,D=n.inWidth,T=n.outChannels,j=n.outDepth,M=n.outHeight,F=n.outWidth,I=n.strideDepth,N=n.strideHeight,R=n.strideWidth,P=k-1-n.padInfo.front,B=E-1-n.padInfo.top,L=S-1-n.padInfo.left,z=0;z<_;++z)for(var U=0;U<C;++U)for(var W=0;W<A;++W)for(var V=W-P,G=Math.max(0,Math.ceil(V/I)),q=Math.min(j,(k+V)/I),H=0;H<O;++H)for(var X=H-B,K=Math.max(0,Math.ceil(X/N)),Y=Math.min(M,(E+X)/N),$=0;$<D;++$){for(var J=$-L,Z=Math.max(0,Math.ceil(J/R)),Q=Math.min(F,(S+J)/R),ee=0,te=G;te<q;++te)for(var ne=te*I-V,re=K;re<Y;++re)for(var ie=re*N-X,ae=Z;ae<Q;++ae)for(var oe=d*z+h*te+p*re+m*ae,se=y*(k-1-ne)+b*(E-1-ie)+x*(S-1-(ae*R-J))+w*U,ue=0;ue<T;++ue)ee+=l[oe+ue]*v[se+ue];i[o*z+s*W+u*H+c*$+U]=ee}return r.toTensor()},t.prototype.conv2dDerFilter=function(e,t,n){Tl([e,t],"conv2dDerFilter");for(var r=n.strideHeight,i=n.strideWidth,a=n.filterHeight,o=n.filterWidth,s="channelsLast"===n.dataFormat,u=gr(n.filterShape,"float32"),c=n.padInfo.left,l=n.padInfo.top,f=this.bufferSync(e),d=this.bufferSync(t),h=0;h<a;++h)for(var p=Math.max(0,Math.ceil((l-h)/r)),m=Math.min(n.outHeight,(n.inHeight+l-h)/r),v=0;v<o;++v)for(var g=Math.max(0,Math.ceil((c-v)/i)),y=Math.min(n.outWidth,(n.inWidth+c-v)/i),b=0;b<n.inChannels;++b)for(var x=0;x<n.outChannels;++x){for(var w=0,_=0;_<n.batchSize;++_)for(var k=p;k<m;++k)for(var E=h+k*r-l,S=g;S<y;++S){var C=v+S*i-c;w+=s?f.get(_,E,C,b)*d.get(_,k,S,x):f.get(_,b,E,C)*d.get(_,x,k,S)}u.set(w,h,v,b,x)}return u.toTensor()},t.prototype.conv3dDerFilter=function(e,t,n){for(var r=n.strideDepth,i=n.strideHeight,a=n.strideWidth,o=n.filterDepth,s=n.filterHeight,u=n.filterWidth,c=gr(n.filterShape,"float32"),l=c.values,f=c.strides,d=f[0],h=f[1],p=f[2],m=f[3],v=this.readSync(t.dataId),g=t.strides,y=g[0],b=g[1],x=g[2],w=g[3],_=this.readSync(e.dataId),k=e.strides,E=k[0],S=k[1],C=k[2],A=k[3],O=n.padInfo.front,D=n.padInfo.left,T=n.padInfo.top,j=0;j<o;++j)for(var M=Math.max(0,Math.ceil((O-j)/r)),F=Math.min(n.outDepth,(n.inDepth+O-j)/r),I=j*d,N=0;N<s;++N)for(var R=Math.max(0,Math.ceil((T-N)/i)),P=Math.min(n.outHeight,(n.inHeight+T-N)/i),B=N*h+I,L=0;L<u;++L)for(var z=Math.max(0,Math.ceil((D-L)/a)),U=Math.min(n.outWidth,(n.inWidth+D-L)/a),W=L*p+B,V=0;V<n.inChannels;++V)for(var G=V*m+W,q=0;q<n.outChannels;++q){for(var H=0,X=0;X<n.batchSize;++X)for(var K=X*E,Y=X*y,$=M;$<F;++$)for(var J=(j+$*r-O)*S+K,Z=$*b+Y,Q=R;Q<P;++Q)for(var ee=(N+Q*i-T)*C+J,te=Q*x+Z,ne=z;ne<U;++ne){var re=ne*w+te;H+=_[(L+ne*a-D)*A+ee+V]*v[re+q]}l[G+q]=H}return c.toTensor()},t.prototype.fusedDepthwiseConv2D=function(e){var t=e.input,n=e.filter,r=e.convInfo,i=e.bias,a=e.activation,o=e.preluActivationWeights,s=this.depthwiseConv2D(t,n,r);return i&&(s=this.add(s,i)),a&&(s=jl(this,s,a,o)),s},t.prototype.depthwiseConv2D=function(e,t,n){Tl([e,t],"depthwiseConv2D");for(var r=n.filterHeight,i=n.filterWidth,a=n.dilationHeight,o=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,c=n.outChannels/n.inChannels,l=gr(n.outShape,e.dtype),f=this.readSync(e.dataId),d=this.readSync(t.dataId),h=l.values,p=0;p<n.batchSize;++p)for(var m=p*e.strides[0],v=p*l.strides[0],g=0;g<n.outHeight;++g)for(var y=v+g*l.strides[1],b=g*n.strideHeight-s,x=0;x<r;++x){var w=b+x*a;if(!(w<0||w>=n.inHeight))for(var _=x*t.strides[0],k=m+w*e.strides[1],E=0;E<n.outWidth;++E)for(var S=y+E*l.strides[2],C=E*n.strideWidth-u,A=0;A<i;++A){var O=C+A*o;if(!(O<0||O>=n.inWidth))for(var D=_+A*t.strides[1],T=k+O*n.inChannels,j=S,M=D,F=0;F<n.inChannels;++F){for(var I=f[T+F],N=0;N<c;++N)h[j+N]+=I*d[M+N];j+=c,M+=c}}}return l.toTensor()},t.prototype.depthwiseConv2DDerInput=function(e,t,n){Tl([e,t],"depthwiseConv2DDerInput");for(var r=gr(n.inShape,"float32"),i=r.values,a=r.strides,o=a[0],s=a[1],u=a[2],c=this.readSync(e.dataId),l=e.strides,f=l[0],d=l[1],h=l[2],p=this.readSync(t.dataId),m=t.strides,v=m[0],g=m[1],y=m[2],b=n.batchSize,x=n.filterHeight,w=n.filterWidth,_=n.inChannels,k=n.inHeight,E=n.inWidth,S=n.outChannels,C=n.outHeight,A=n.outWidth,O=n.strideHeight,D=n.strideWidth,T=x-1-n.padInfo.top,j=w-1-n.padInfo.left,M=S/_,F=0;F<b;++F)for(var I=0;I<_;++I)for(var N=0;N<k;++N)for(var R=N-T,P=Math.max(0,Math.ceil(R/O)),B=Math.min(C,(x+R)/O),L=0;L<E;++L){for(var z=L-j,U=Math.max(0,Math.ceil(z/D)),W=Math.min(A,(w+z)/D),V=0,G=P;G<B;++G)for(var q=G*O-R,H=U;H<W;++H)for(var X=f*F+d*G+h*H,K=v*(x-1-q)+g*(w-1-(H*D-z))+y*I,Y=0;Y<M;++Y)V+=c[X+(I*M+Y)]*p[K+Y];i[o*F+s*N+u*L+I]=V}return r.toTensor()},t.prototype.depthwiseConv2DDerFilter=function(e,t,n){Tl([e,t],"depthwiseConv2DDerFilter");for(var r=n.strideHeight,i=n.strideWidth,a=n.filterHeight,o=n.filterWidth,s=gr(n.filterShape,"float32"),u=n.padInfo.left,c=n.padInfo.top,l=n.outChannels/n.inChannels,f=this.bufferSync(e),d=this.bufferSync(t),h=0;h<a;++h)for(var p=Math.max(0,Math.ceil((c-h)/r)),m=Math.min(n.outHeight,(n.inHeight+c-h)/r),v=0;v<o;++v)for(var g=Math.max(0,Math.ceil((u-v)/i)),y=Math.min(n.outWidth,(n.inWidth+u-v)/i),b=0;b<n.outChannels;++b){for(var x=Math.trunc(b/l),w=b%l,_=0,k=0;k<n.batchSize;++k)for(var E=p;E<m;++E)for(var S=h+E*r-c,C=g;C<y;++C){var A=v+C*i-u;_+=f.get(k,S,A,x)*d.get(k,E,C,b)}s.set(_,h,v,x,w)}return s.toTensor()},t.prototype.tile=function(e,t){return Tl(e,"tile"),ra(this.bufferSync(e),t)},t.prototype.pad=function(e,t,n){Tl(e,"pad");var r=t.map((function(t,n){return t[0]+e.shape[n]+t[1]})),i=t.map((function(e){return e[0]})),a=this.bufferSync(e),o=gr(r,e.dtype);0!==n&&o.values.fill(n);for(var s=0;s<e.size;s++){var u=a.indexToLoc(s),c=u.map((function(e,t){return e+i[t]}));o.set.apply(o,[a.get.apply(a,u)].concat(c))}return o.toTensor()},t.prototype.transpose=function(e,t){Tl(e,"transpose");for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[t[r]];var i=this.readSync(e.dataId),a=gr(n,e.dtype),o=this.bufferSync(e);for(r=0;r<e.size;++r){for(var s=o.indexToLoc(r),u=new Array(s.length),c=0;c<u.length;c++)u[c]=s[t[c]];var l=a.locToIndex(u);a.values[l]=i[r]}return a.toTensor()},t.prototype.gather=function(e,t,n){Tl([e,t],"gather");var r=e.shape.slice(),i=this.readSync(t.dataId);r[n]=i.length;for(var a=gr(r,e.dtype),o=this.bufferSync(e),s=0;s<a.size;++s){var u=a.indexToLoc(s),c=u.slice();c[n]=i[u[n]];var l=o.locToIndex(c);a.values[s]=o.values[l]}return a.toTensor()},t.prototype.batchToSpaceND=function(e,t,n){Tl([e],"batchToSpaceND");var r=t.reduce((function(e,t){return e*t})),i=Hr(e.shape,t,r),a=Xr(i.length,t.length),o=Kr(e.shape,t,r),s=Yr(n,t.length),u=$r(o,n,t.length);return e.reshape(i).transpose(a).reshape(o).slice(s,u)},t.prototype.spaceToBatchND=function(e,t,n){Tl([e],"spaceToBatchND");var r=t.reduce((function(e,t){return e*t})),i=[[0,0]];i.push.apply(i,n);for(var a=1+t.length;a<e.shape.length;++a)i.push([0,0]);var o=e.pad(i),s=Hr(o.shape,t,r,!1),u=Xr(s.length,t.length,!1),c=Kr(o.shape,t,r,!1);return o.reshape(s).transpose(u).reshape(c)},t.prototype.pool=function(e,t,n){Tl(e,"pool");for(var r=t.strideHeight,i=t.strideWidth,a=t.dilationHeight,o=t.dilationWidth,s=t.effectiveFilterHeight,u=t.effectiveFilterWidth,c=t.padInfo.top,l=t.padInfo.left,f="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,d=this.readSync(e.dataId),h=gr(t.outShape,e.dtype),p=h.values,m=t.outShape[1]*t.outShape[2]*t.outShape[3],v=t.outShape[2]*t.outShape[3],g=t.outShape[3],y=0;y<t.batchSize;++y)for(var b=y*m,x=y*e.strides[0],w=0;w<t.inChannels;++w)for(var _=0;_<t.outHeight;++_)for(var k=_*r-c,E=Math.max(0,k),S=Math.min(t.inHeight,s+k),C=b+_*v,A=0;A<t.outWidth;++A){for(var O=A*i-l,D=Math.max(0,O),T=Math.min(t.inWidth,u+O),j=f,M=0,F=0,I=E;I<S;I+=a){for(var N=x+I*e.strides[1],R=D;R<T;R+=o){var P=d[N+R*e.strides[2]+w];"max"===n&&P>j?j=P:"avg"===n&&(M+=P,F++)}if(isNaN(j))break}p[C+A*g+w]="avg"===n?M/F:j}return h.toTensor()},t.prototype.maxPool=function(e,t){return this.pool(e,t,"max")},t.prototype.maxPoolPositions=function(e,t){for(var n=gr(t.outShape,"int32"),r=t.strideHeight,i=t.strideWidth,a=t.dilationHeight,o=t.dilationWidth,s=t.effectiveFilterHeight,u=t.effectiveFilterWidth,c=t.padInfo.top,l=t.padInfo.left,f=this.bufferSync(e),d=0;d<t.batchSize;++d)for(var h=0;h<t.inChannels;++h)for(var p=0;p<t.outHeight;++p){for(var m=p*r-c,v=m;v<0;)v+=a;for(var g=Math.min(t.inHeight,s+m),y=0;y<t.outWidth;++y){for(var b=y*i-l,x=b;x<0;)x+=o;for(var w=Math.min(t.inWidth,u+b),_=Number.NEGATIVE_INFINITY,k=-1,E=v;E<g;E+=a)for(var S=E-m,C=x;C<w;C+=o){var A=C-b,O=f.get(d,E,C,h);O>_&&(_=O,k=S*u+A)}n.set(k,d,p,y,h)}}return n.toTensor()},t.prototype.maxPoolBackprop=function(e,t,n,r){Tl([t,n],"maxPoolBackprop");for(var i=this.maxPoolPositions(t,r),a=r.strideHeight,o=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,c=r.effectiveFilterHeight,l=r.effectiveFilterWidth,f=l-1-r.padInfo.left,d=c-1-r.padInfo.top,h=gr(t.shape,"float32"),p=this.bufferSync(i),m=this.bufferSync(e),v=0;v<r.batchSize;++v)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.inHeight;++y)for(var b=0;b<r.inWidth;++b){for(var x=y-d,w=b-f,_=0,k=0;k<c;k+=s){var E=(x+k)/a;if(!(E<0||E>=r.outHeight||Math.floor(E)!==E))for(var S=0;S<l;S+=u){var C=(w+S)/o;if(!(C<0||C>=r.outWidth||Math.floor(C)!==C)){var A=c*l-1-p.get(v,E,C,g)===k*l+S?1:0;0!==A&&(_+=m.get(v,E,C,g)*A)}}}h.set(_,v,y,b,g)}return h.toTensor()},t.prototype.avgPoolBackprop=function(e,t,n){Tl([e,t],"avgPoolBackprop");for(var r=n.strideHeight,i=n.strideWidth,a=n.filterHeight,o=n.filterWidth,s=n.dilationHeight,u=n.dilationWidth,c=n.effectiveFilterHeight,l=n.effectiveFilterWidth,f=l-1-n.padInfo.left,d=c-1-n.padInfo.top,h=gr(t.shape,"float32"),p=1/(a*o),m=this.bufferSync(e),v=0;v<n.batchSize;++v)for(var g=0;g<n.inChannels;++g)for(var y=0;y<n.inHeight;++y)for(var b=0;b<n.inWidth;++b){for(var x=y-d,w=b-f,_=0,k=0;k<c;k+=s){var E=(x+k)/r;if(!(E<0||E>=n.outHeight||Math.floor(E)!==E))for(var S=0;S<l;S+=u){var C=(w+S)/i;C<0||C>=n.outWidth||Math.floor(C)!==C||(_+=m.get(v,E,C,g))}}h.set(_*p,v,y,b,g)}return h.toTensor()},t.prototype.pool3d=function(e,t,n){Tl(e,"pool3d");for(var r=t.strideDepth,i=t.strideHeight,a=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterDepth,l=t.effectiveFilterHeight,f=t.effectiveFilterWidth,d=t.padInfo.front,h=t.padInfo.top,p=t.padInfo.left,m="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=this.readSync(e.dataId),g=gr(t.outShape,e.dtype),y=g.values,b=t.outShape[1]*t.outShape[2]*t.outShape[3]*t.outShape[4],x=t.outShape[2]*t.outShape[3]*t.outShape[4],w=t.outShape[3]*t.outShape[4],_=t.outShape[4],k=0;k<t.batchSize;++k)for(var E=k*b,S=k*e.strides[0],C=0;C<t.inChannels;++C)for(var A=0;A<t.outDepth;++A){for(var O=A*r-d,D=O;D<0;)D+=o;for(var T=Math.min(t.inDepth,c+O),j=E+A*x,M=0;M<t.outHeight;++M){for(var F=M*i-h,I=F;I<0;)I+=s;for(var N=Math.min(t.inHeight,l+F),R=j+M*w,P=0;P<t.outWidth;++P){for(var B=P*a-p,L=B;L<0;)L+=u;for(var z=Math.min(t.inWidth,f+B),U=R+P*_,W=m,V=0,G=0,q=D;q<T;q+=o){for(var H=S+q*e.strides[1],X=I;X<N;X+=s){for(var K=H+X*e.strides[2],Y=L;Y<z;Y+=u){var $=v[K+Y*e.strides[3]+C];if("max"===n&&$>W?W=$:"avg"===n&&(V+=$,G++),isNaN(W))break}if(isNaN(W))break}if(isNaN(W))break}y[U+C]="avg"===n?V/G:W}}}return g.toTensor()},t.prototype.avgPool3d=function(e,t){return Tl(e,"avgPool3d"),this.pool3d(e,t,"avg").toFloat()},t.prototype.avgPool3dBackprop=function(e,t,n){Tl([e,t],"avgPool3dBackprop");for(var r=n.strideDepth,i=n.strideHeight,a=n.strideWidth,o=n.filterDepth,s=n.filterHeight,u=n.filterWidth,c=n.dilationDepth,l=n.dilationHeight,f=n.dilationWidth,d=n.effectiveFilterDepth,h=n.effectiveFilterHeight,p=n.effectiveFilterWidth,m=d-1-n.padInfo.front,v=p-1-n.padInfo.left,g=h-1-n.padInfo.top,y=gr(t.shape,"float32"),b=1/(o*s*u),x=this.bufferSync(e),w=0;w<n.batchSize;++w)for(var _=0;_<n.inChannels;++_)for(var k=0;k<n.inDepth;++k)for(var E=0;E<n.inHeight;++E)for(var S=0;S<n.inWidth;++S){for(var C=k-m,A=E-g,O=S-v,D=0,T=0;T<d;T+=c){var j=(C+T)/r;if(!(j<0||j>=n.outDepth||Math.floor(j)!==j))for(var M=0;M<h;M+=l){var F=(A+M)/i;if(!(F<0||F>=n.outHeight||Math.floor(F)!==F))for(var I=0;I<p;I+=f){var N=(O+I)/a;N<0||N>=n.outWidth||Math.floor(N)!==N||(D+=x.get(w,j,F,N,_))}}}y.set(D*b,w,k,E,S,_)}return y.toTensor()},t.prototype.maxPool3d=function(e,t){return Tl(e,"maxPool3d"),this.pool3d(e,t,"max").toFloat()},t.prototype.maxPool3dPositions=function(e,t){for(var n=gr(t.outShape,"int32"),r=t.strideDepth,i=t.strideHeight,a=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterDepth,l=t.effectiveFilterHeight,f=t.effectiveFilterWidth,d=t.padInfo.front,h=t.padInfo.top,p=t.padInfo.left,m=this.bufferSync(e),v=0;v<t.batchSize;++v)for(var g=0;g<t.inChannels;++g)for(var y=0;y<t.outDepth;++y){for(var b=y*r-d,x=b;x<0;)x+=o;for(var w=Math.min(t.inDepth,c+b),_=0;_<t.outHeight;++_){for(var k=_*i-h,E=k;E<0;)E+=s;for(var S=Math.min(t.inHeight,l+k),C=0;C<t.outWidth;++C){for(var A=C*a-p,O=A;O<0;)O+=u;for(var D=Math.min(t.inWidth,f+A),T=Number.NEGATIVE_INFINITY,j=-1,M=x;M<w;M+=o)for(var F=M-b,I=E;I<S;I+=s)for(var N=I-k,R=O;R<D;R+=u){var P=R-A,B=m.get(v,M,I,R,g);B>=T&&(T=B,j=F*l*f+N*l+P)}n.set(j,v,y,_,C,g)}}}return n.toTensor()},t.prototype.maxPool3dBackprop=function(e,t,n,r){Tl([t,n],"maxPool3dBackprop");for(var i=this.maxPool3dPositions(t,r),a=r.strideDepth,o=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,l=r.dilationWidth,f=r.effectiveFilterDepth,d=r.effectiveFilterHeight,h=r.effectiveFilterWidth,p=f-1-r.padInfo.front,m=h-1-r.padInfo.left,v=d-1-r.padInfo.top,g=gr(t.shape,"float32"),y=this.bufferSync(i),b=this.bufferSync(e),x=0;x<r.batchSize;++x)for(var w=0;w<r.inChannels;++w)for(var _=0;_<r.inDepth;++_)for(var k=0;k<r.inHeight;++k)for(var E=0;E<r.inWidth;++E){for(var S=_-p,C=k-v,A=E-m,O=0,D=0;D<f;D+=u){var T=(S+D)/a;if(!(T<0||T>=r.outDepth||Math.floor(T)!==T))for(var j=0;j<d;j+=c){var M=(C+j)/o;if(!(M<0||M>=r.outHeight||Math.floor(M)!==M))for(var F=0;F<h;F+=l){var I=(A+F)/s;if(!(I<0||I>=r.outWidth||Math.floor(I)!==I)){var N=f*d*h-1-y.get(x,T,M,I,w)===D*d*h+j*h+F?1:0;0!==N&&(O+=b.get(x,T,M,I,w)*N)}}}}g.set(O,x,_,k,E,w)}return g.toTensor()},t.prototype.cast=function(e,t){return zi(e,t,this)},t.prototype.reshape=function(e,t){return Ui(e,t)},t.prototype.avgPool=function(e,t){return Tl(e,"avgPool"),this.pool(e,t,"avg").toFloat()},t.prototype.resizeBilinear=function(e,t,n,r){Tl(e,"resizeBilinear");for(var i=e.shape,a=i[0],o=i[1],s=i[2],u=i[3],c=this.readSync(e.dataId),l=new Float32Array(j([a,t,n,u])),f=[r&&t>1?o-1:o,r&&n>1?s-1:s],d=[r&&t>1?t-1:t,r&&n>1?n-1:n],h=0,p=f[0]/d[0],m=f[1]/d[1],v=0;v<a;v++)for(var g=0;g<t;g++)for(var y=p*g,b=Math.floor(y),x=y-b,w=Math.min(o-1,Math.ceil(y)),_=v*e.strides[0]+b*e.strides[1],k=v*e.strides[0]+w*e.strides[1],E=0;E<n;E++)for(var S=m*E,C=Math.floor(S),A=S-C,O=Math.min(s-1,Math.ceil(S)),D=_+C*e.strides[2],T=k+C*e.strides[2],M=_+O*e.strides[2],F=k+O*e.strides[2],I=0;I<u;I++){var N=c[D+I],R=c[T+I],P=N+(c[M+I]-N)*A,B=P+(R+(c[F+I]-R)*A-P)*x;l[h++]=B}return Rn(l,[a,t,n,u])},t.prototype.resizeBilinearBackprop=function(e,t,n){Tl([e,t],"resizeBilinearBackprop");for(var r=t.shape,i=r[0],a=r[1],o=r[2],s=r[3],u=e.shape,c=u[1],l=u[2],f=new Float32Array(i*a*o*s),d=[n&&c>1?a-1:a,n&&l>1?o-1:o],h=[n&&c>1?c-1:c,n&&l>1?l-1:l],p=d[0]/h[0],m=d[1]/h[1],v=this.readSync(e.dataId),g=0,y=0;y<i;y++)for(var b=y*t.strides[0],x=0;x<c;x++)for(var w=x*p,_=Math.floor(w),k=Math.min(Math.ceil(w),a-1),E=b+_*t.strides[1],S=b+k*t.strides[1],C=w-_,A=1-C,O=0;O<l;O++)for(var D=O*m,T=Math.floor(D),j=Math.min(Math.ceil(D),o-1),M=D-T,F=1-M,I=E+T*t.strides[2],N=E+j*t.strides[2],R=S+T*t.strides[2],P=S+j*t.strides[2],B=A*F,L=A*M,z=C*F,U=C*M,W=0;W<s;W++){var V=v[g++];f[I+W]+=V*B,f[N+W]+=V*L,f[R+W]+=V*z,f[P+W]+=V*U}return Wn(f,[i,o,a,s],t.dtype)},t.prototype.resizeNearestNeighbor=function(e,t,n,r){Tl(e,"resizeNearestNeighbor");for(var i=e.shape,a=i[0],o=i[1],s=i[2],u=i[3],c=this.readSync(e.dataId),l=new Float32Array(a*t*n*u),f=[r&&t>1?o-1:o,r&&n>1?s-1:s],d=[r&&t>1?t-1:t,r&&n>1?n-1:n],h=f[0]/d[0],p=f[1]/d[1],m=0,v=0;v<a;v++)for(var g=v*e.strides[0],y=0;y<t;y++)for(var b=h*y,x=g+Math.min(o-1,r?Math.round(b):Math.floor(b))*e.strides[1],w=0;w<n;w++)for(var _=p*w,k=x+Math.min(s-1,r?Math.round(_):Math.floor(_))*e.strides[2],E=0;E<u;E++){var S=c[k+E];l[m++]=S}return Rn(l,[a,t,n,u],e.dtype)},t.prototype.resizeNearestNeighborBackprop=function(e,t,n){Tl([e,t],"resizeNearestNeighborBackprop");for(var r=t.shape,i=r[0],a=r[1],o=r[2],s=r[3],u=e.shape,c=u[1],l=u[2],f=new Float32Array(i*a*o*s),d=this.readSync(e.dataId),h=[n&&c>1?a-1:a,n&&l>1?o-1:o],p=[n&&c>1?c-1:c,n&&l>1?l-1:l],m=h[0]/p[0],v=h[1]/p[1],g=1/m,y=1/v,b=2*Math.ceil(g)+2,x=2*Math.ceil(y)+2,w=0;w<i;w++)for(var _=w*t.strides[0],k=0;k<a;k++)for(var E=_+k*t.strides[1],S=Math.floor(k*g),C=Math.floor(S-b/2),A=0;A<o;A++)for(var O=E+A*t.strides[2],D=Math.floor(A*y),T=Math.floor(D-x/2),j=0;j<s;j++){for(var M=0,F=0;F<b;F++){var I=F+C;if(!(I<0||I>=c)){var N=_+I*e.strides[1],R=I*m;if(k===Math.min(a-1,n?Math.round(R):Math.floor(R)))for(var P=0;P<x;P++){var B=P+T;if(!(B<0||B>=l)){var L=N+B*e.strides[2],z=B*v;A===Math.min(o-1,n?Math.round(z):Math.floor(z))&&(M+=d[L+j])}}}}f[O+j]=M}return Wn(f,t.shape,t.dtype)},t.prototype.batchNormalization=function(e,t,n,r,i,a){Tl([e,t,n,i,a],"batchNorm");for(var o=this.readSync(e.dataId),s=this.readSync(t.dataId),u=this.readSync(n.dataId),c=i?this.readSync(i.dataId):new Float32Array([1]),l=a?this.readSync(a.dataId):new Float32Array([0]),f=new Float32Array(o.length),d=l.length,h=c.length,p=u.length,m=s.length,v=0,g=0,y=0,b=0,x=0;x<o.length;++x)f[x]=l[v++]+(o[x]-s[g++])*c[y++]/Math.sqrt(u[b++]+r),v>=d&&(v=0),g>=m&&(g=0),y>=h&&(y=0),b>=p&&(b=0);return Wn(f,e.shape)},t.prototype.localResponseNormalization4D=function(e,t,n,r,i){Tl(e,"localResponseNormalization4D");var a=e.shape[3],o=a-1,s=this.readSync(e.dataId),u=e.size,c=new Float32Array(u);function l(e){for(var n=e%a,r=e-n+Math.max(0,n-t),i=e-n+Math.min(n+t,o),u=0;r<=i;r++){var c=s[r];u+=c*c}return u}for(var f=0;f<u;f++){var d=l(f),h=s[f]*Math.pow(n+r*d,-i);c[f]=h}return Wn(c,e.shape)},t.prototype.LRNGrad=function(e,t,n,r,i,a,o){Tl(e,"LRNGrad");for(var s=e.shape[3],u=this.readSync(e.dataId),c=this.readSync(t.dataId),l=this.readSync(n.dataId),f=new Float32Array(e.size),d=e.size,h=0;h<d;h++){for(var p=h%s,m=h-p+Math.max(0,p-r),v=h-p+Math.min(s,p+r+1),g=0,y=m;y<v;y++)g+=Math.pow(c[y],2);for(g=a*g+i,y=m;y<v;y++){var b=-2*a*o*c[y]*l[h]/g;h===y&&(b+=Math.pow(g,-o)),b*=u[h],f[y]+=b}}return Wn(f,e.shape)},t.prototype.multinomial=function(e,t,n,r){Tl(e,"multinomial");for(var i=t?e:xi(e),a=i.shape[0],o=i.shape[1],s=Xn([a,n],"int32"),u=this.readSync(s.dataId),c=this.readSync(i.dataId),l=0;l<a;++l){var f=l*o,d=new Float32Array(o-1);d[0]=c[f];for(var h=1;h<d.length;++h)d[h]=d[h-1]+c[f+h];for(var p=hr(r.toString()),m=l*n,v=0;v<n;++v){var g=p();u[m+v]=d.length;for(var y=0;y<d.length;y++)if(g<d[y]){u[m+v]=y;break}}}return s},t.prototype.oneHot=function(e,t,n,r){Tl(e,"oneHot");var i=new Float32Array(e.size*t);i.fill(r);for(var a=this.readSync(e.dataId),o=0;o<e.size;++o)a[o]>=0&&a[o]<t&&(i[o*t+a[o]]=n);return zn(i,[e.size,t],"int32")},t.prototype.nonMaxSuppression=function(e,t,n,r,i){return Tl(e,"nonMaxSuppression"),$i(this.readSync(e.dataId),this.readSync(t.dataId),n,r,i)},t.prototype.fft=function(e){return this.fftBatch(e,!1)},t.prototype.ifft=function(e){return this.fftBatch(e,!0)},t.prototype.fftBatch=function(e,t){for(var n=e.shape[0],r=e.shape[1],i=gr(e.shape,"float32"),a=gr(e.shape,"float32"),o=In(e).as2D(n,r),s=Nn(e).as2D(n,r),u=0;u<n;u++)for(var c=o.slice([u,0],[1,r]),l=s.slice([u,0],[1,r]),f=Fn(c,l),d=this.readSync(this.fftImpl(f,t).dataId),h=0;h<r;h++){var p=qi(d,h);i.values[u*r+h]=p.real,a.values[u*r+h]=p.imag}return Fn(i.toTensor(),a.toTensor()).as2D(n,r)},t.prototype.fftImpl=function(e,t){var n=e.as1D(),r=n.size;if(this.isExponentOf2(r)){var i=this.fftRadix2(n,r,t).as2D(e.shape[0],e.shape[1]);return t&&(i=Fn(In(i).div(Bn(r)),Nn(i).div(Bn(r)))),i}var a=this.readSync(e.dataId),o=function(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}(this.fourierTransformByMatmul(a,r,t));return Fn(o.real,o.imag).as2D(e.shape[0],e.shape[1])},t.prototype.isExponentOf2=function(e){return 0==(e&e-1)},t.prototype.fftRadix2=function(e,t,n){if(1===t)return e;var r=this.readSync(e.dataId),i=t/2,a=function(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),i=0;i<e.length;i+=4)n[Math.floor(i/4)]=e[i],r[Math.floor(i/4)]=e[i+1];return{real:n,imag:r}}(r),o=Fn(a.real,a.imag).as1D(),s=function(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),i=2;i<e.length;i+=4)n[Math.floor(i/4)]=e[i],r[Math.floor(i/4)]=e[i+1];return{real:n,imag:r}}(r),u=Fn(s.real,s.imag).as1D();o=this.fftRadix2(o,i,n),u=this.fftRadix2(u,i,n);var c=function(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),i=0;i<Math.ceil(e/2);i++){var a=(t?2:-2)*Math.PI*(i/e);n[i]=Math.cos(a),r[i]=Math.sin(a)}return{real:n,imag:r}}(t,n),l=Fn(c.real,c.imag).mul(u),f=o.add(l),d=o.sub(l),h=In(f).concat(In(d)),p=Nn(f).concat(Nn(d));return Fn(h,p).as1D()},t.prototype.fourierTransformByMatmul=function(e,t,n){for(var r=new Float32Array(2*t),i=0;i<t;i++){for(var a=0,o=0,s=0;s<t;s++){var u=Xi(i*s,t,n),c=qi(e,s);a+=c.real*u.real-c.imag*u.imag,o+=c.real*u.imag+c.imag*u.real}n&&(a/=t,o/=t),Hi(r,a,o,i)}return r},t.prototype.depthToSpace=function(e,t,n){A("NHWC"===n,(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+n})),A(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+t}));for(var r=e.shape[0],i=e.shape[1],a=e.shape[2],o=e.shape[3],s=i*t,u=a*t,c=o/(t*t),l=this.readSync(e.dataId),f=new Float32Array(r*s*u*c),d=0,h=0;h<r;++h)for(var p=0;p<s;++p)for(var m=Math.floor(p/t),v=p%t,g=0;g<u;++g)for(var y=Math.floor(g/t),b=(v*t+g%t)*c,x=0;x<c;++x){var w=x+b+o*(y+a*(m+i*h));f[d++]=l[w]}return Wn(f,[r,s,u,c])},t.prototype.broadcastedBinaryOp=function(e,t,n,r){var i=Ai(e.shape,t.shape),a=gr(i,n),o=this.readSync(e.dataId),s=this.readSync(t.dataId),u=Si(e.shape,i),c=Si(t.shape,i),l=a.values;if(u.length+c.length===0)for(var f=0;f<l.length;++f)l[f]=r(o[f%o.length],s[f%s.length]);else{var d=this.bufferSync(e),h=this.bufferSync(t),p=function(n){var i=a.indexToLoc(n),f=i.slice(-e.rank);u.forEach((function(e){return f[e]=0}));var p=d.locToIndex(f),m=i.slice(-t.rank);c.forEach((function(e){return m[e]=0}));var v=h.locToIndex(m);l[n]=r(o[p],s[v])};for(f=0;f<l.length;++f)p(f)}return a.toTensor()},t.prototype.broadcastedBinaryComplexOp=function(e,t,n){var r=Ai(e.shape,t.shape),i=gr(r,"float32"),a=gr(r,"float32"),o=this.readSync(e.dataId),s=this.readSync(t.dataId),u=Si(e.shape,r),c=Si(t.shape,r),l=i.values,f=a.values;if(u.length+c.length===0)for(var d=0;d<l.length;d++){var h=d%o.length,p=d%s.length,m=n(o[2*h],o[2*h+1],s[2*p],s[2*p+1]);l[d]=m.real,f[d]=m.imag}else{var v=this.bufferSync(this.data.get(e.dataId).complexTensors.real),g=this.bufferSync(this.data.get(t.dataId).complexTensors.real),y=function(r){var a=i.indexToLoc(r),d=a.slice(-e.rank);u.forEach((function(e){return d[e]=0}));var h=v.locToIndex(d),p=a.slice(-t.rank);c.forEach((function(e){return p[e]=0}));var m=g.locToIndex(p),y=n(o[2*h],o[2*h+1],s[2*m],s[2*m+1]);l[r]=y.real,f[r]=y.imag};for(d=0;d<l.length;d++)y(d)}return this.complex(i.toTensor(),a.toTensor())},t.prototype.split=function(e,t,n){return na(e,t,n)},t.prototype.dispose=function(){},t.prototype.floatPrecision=function(){return 32},t.prototype.epsilon=function(){return 1e-7},t.prototype.cropAndResize=function(e,t,n,r,i,a){for(var o=e.shape,s=o[0],u=o[1],c=o[2],l=o[3],f=t.shape[0],d=r[0],h=r[1],p=gr([f,d,h,l],"float32"),m=this.readSync(t.dataId),v=this.readSync(n.dataId),g=this.readSync(e.dataId),y=e.strides,b=p.strides,x=0;x<f;x++){var w=4*x,_=m[w],k=m[w+1],E=m[w+2],S=m[w+3],C=v[x];if(!(C>=s))for(var A=d>1?(E-_)*(u-1)/(d-1):0,O=h>1?(S-k)*(c-1)/(h-1):0,D=0;D<d;D++){var T=d>1?_*(u-1)+D*A:.5*(_+E)*(u-1);if(T<0||T>u-1)for(var j=0;j<h;j++)for(var M=0;M<l;M++){var F=M+j*b[2]+D*b[1]+x*b[0];p.values[F]=a}else if("bilinear"===i){var I=Math.floor(T),N=Math.ceil(T),R=T-I;for(j=0;j<h;j++)if((q=h>1?k*(c-1)+j*O:.5*(k+S)*(c-1))<0||q>c-1)for(M=0;M<l;M++)F=M+j*b[2]+D*b[1]+x*b[0],p.values[F]=a;else{var P=Math.floor(q),B=Math.ceil(q),L=q-P;for(M=0;M<l;M++){var z=g[F=M+P*y[2]+I*y[1]+C*y[0]],U=g[F=M+B*y[2]+I*y[1]+C*y[0]],W=g[F=M+P*y[2]+N*y[1]+C*y[0]],V=z+(U-z)*L,G=W+(g[F=M+B*y[2]+N*y[1]+C*y[0]]-W)*L;F=M+j*b[2]+D*b[1]+x*b[0],p.values[F]=V+(G-V)*R}}}else for(j=0;j<h;++j){var q;if((q=h>1?k*(c-1)+j*O:.5*(k+S)*(c-1))<0||q>c-1)for(M=0;M<l;M++)F=M+j*b[2]+D*b[1]+x*b[0],p.values[F]=a;else{var H=Math.round(q),X=Math.round(T);for(M=0;M<l;M++){var K=M+H*y[2]+X*y[1]+C*y[0],Y=M+j*b[2]+D*b[1]+x*b[0];p.values[Y]=g[K]}}}}}return p.toTensor()},t.prototype.sparseToDense=function(e,t,n,r){var i=ri(0,e,n),a=i.sliceRank,o=i.numUpdates,s=i.sliceSize,u=i.strides,c=i.outputSize;return this.scatter(e,t,n,c,s,o,a,u,r,!1)},t.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],i=Jr(e,t),a=i[0],o=i[1],s=i[2],u=i[3];if(0===o)return Rn([],a,e.dtype);for(var c=new we([o,s],e.dtype),l=this.readSync(t.dataId),f=this.readSync(e.dataId),d=0;d<o;d++){for(var h=[],p=0,m=0;m<r;m++){var v=l[d*r+m];p+=v*u[m],h.push(v)}if(p<0||p>=e.size/s)throw new Error("Invalid indices: "+h+" does not index into "+e.shape);for(var g=0;g<s;g++)c.values[d*s+g]=f[p*s+g]}return c.toTensor().reshape(a)},t.prototype.scatterND=function(e,t,n){var r=ri(0,e,n),i=r.sliceRank,a=r.numUpdates,o=r.sliceSize,s=r.strides,u=r.outputSize,c=Bn(0);return this.scatter(e,t,n,u,o,a,i,s,c,!0)},t.prototype.fill=function(e,t,n){var r=W(n=n||Z(t),j(e));return r.fill(t),We.makeTensor(r,e,n,this)},t.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){var t=W(e.dtype,j(e.shape));return this.makeOutput(t,e.shape,e.dtype)},t.prototype.linspace=function(e,t,n){return Wi(e,t,n)},t.prototype.scatter=function(e,t,n,r,i,a,o,s,u,c){var l=[r/i,i],f=this.readSync(e.dataId),d=this.readSync(t.dataId);if(0===r)return Rn([],n,t.dtype);var h=new we(l,t.dtype);h.values.fill(this.readSync(u.dataId)[0]);for(var p=0;p<a;p++){for(var m=[],v=0,g=0;g<o;g++){var y=f[p*o+g];m.push(y),v+=y*s[g]}if(v<0||v>=r/i)throw new Error("Invalid indices: "+m+" does not index into "+n);for(var b=0;b<i;b++)c?h.values[v*i+b]+=d[p*i+b]:h.values[v*i+b]=0===t.rank?d[0]:d[p*i+b]}return h.toTensor().reshape(n)},t}(ki);We.registerBackend("cpu",(function(){return new Ml}),1);for(var Fl=0,Il=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t,a=i.boxes,o=i.scores,s=r,u=s.maxOutputSize,c=s.iouThreshold,l=s.scoreThreshold,f=s.softNmsSigma,d=n;Tl(a,"NonMaxSuppressionWithScore");var h=Ji(d.data.get(a.dataId).values,d.data.get(o.dataId).values,u,c,l,f);return[h.selectedIndices,h.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,i=n;Tl(r,"square");for(var a=i.data.get(r.dataId).values,o=new Float32Array(a.length),s=0;s<a.length;++s){var u=a[s];o[s]=u*u}return{dataId:i.write(o,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:Vo,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,i=r.a,a=r.b,o=n;Tl([i,a],Vo);var s=o.data.get(i.dataId).values,u=o.data.get(a.dataId).values,c=function(e,t,n,r,i,a){var o=Ai(e,t),s=o.length,u=te(o),c=U(i,j(o)),l=e.length,f=t.length,d=te(e),h=te(t),p=Si(e,o),m=Si(t,o);if(p.length+m.length===0)for(var v=0;v<c.length;++v)c[v]=a(n[v%n.length],r[v%r.length]);else{var g=function(e){var t=fe(e,s,u),i=t.slice(-l);p.forEach((function(e){return i[e]=0}));var o=le(i,l,d),v=t.slice(-f);m.forEach((function(e){return v[e]=0}));var g=le(v,f,h);c[e]=a(n[o],r[g])};for(v=0;v<c.length;++v)g(v)}return[c,o]}(i.shape,a.shape,s,u,i.dtype,(function(e,t){var n=e-t;return n*n})),l=c[0],f=c[1];return{dataId:o.write(l,f,i.dtype),shape:f,dtype:i.dtype}}}];Fl<Il.length;Fl++)y(Il[Fl]);for(var Nl,Rl=0,Pl=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.pixels,a=r.numChannels,o="undefined"!=typeof HTMLVideoElement&&i instanceof HTMLVideoElement,s="undefined"!=typeof HTMLImageElement&&i instanceof HTMLImageElement,u=o?[i.videoWidth,i.videoHeight]:[i.width,i.height],c=u[0],l=u[1],d=[l,c],h=[l,c,a];(s||o)&&(null==Nl&&(Nl=document.createElement("canvas").getContext("2d")),Nl.canvas.width=c,Nl.canvas.height=l,Nl.drawImage(i,0,0,c,l),i=Nl.canvas);var p=n.makeTensorInfo(d,"int32");n.texData.get(p.dataId).usage=He.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(p.dataId),i);var m=f().getBool("WEBGL_PACK")?new function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=ua(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2("+r+".0, "+n+".0);\n            vec4 values = "+t.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+t.output+" = result;\n      }\n    "}(h):new function(e){this.variableNames=["A"];var t=ua(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+n+".0);\n\n        vec4 values = "+t.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "}(h),v=n.runWebGLProgram(m,[p],"int32");return n.disposeData(p.dataId),v}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;gn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var i=t,a=i.boxes,o=i.scores,s=r,u=s.maxOutputSize,c=s.iouThreshold,l=s.scoreThreshold,f=s.softNmsSigma,d=n,h=Ji(d.readSync(a.dataId),d.readSync(o.dataId),u,c,l,f);return[h.selectedIndices,h.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,i=n,a=new xo(r.shape,"return x * x;");return i.runWebGLProgram(a,[r],r.dtype)}},{kernelName:Vo,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,i=r.a,a=r.b,o=n,s=f().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Da("return (a - b) * (a - b);",i.shape,a.shape):new Aa("return (a - b) * (a - b);",i.shape,a.shape);return o.compileAndRun(s,[i,a])}}];Rl<Pl.length;Rl++)y(Pl[Rl]);for(var Bl=0,Ll=[{kernelName:"Square",gradFunc:function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().mul(2))}}}},{kernelName:Vo,gradFunc:function(e,t){var n=t[0],r=t[1],i=Bn(2);return{a:function(){return au(e,au(i,lu(n,r)))},b:function(){return au(e,au(i,lu(r,n)))}}}}];Bl<Ll.length;Bl++)b(Ll[Bl]);var zl=function(){function e(){}return e.prototype.fetch=function(e,t){return fetch(e,t)},e.prototype.now=function(){return performance.now()},e.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got "+t);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},e.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},e}();f().get("IS_BROWSER")&&f().setPlatform("browser",new zl);var Ul,Wl=function(){function e(){this.util=n(249),this.textEncoder=new this.util.TextEncoder}return e.prototype.fetch=function(e,t){return null!=f().global.fetch?f().global.fetch(e,t):(null==Ul&&(Ul=n(250)),Ul(e,t))},e.prototype.now=function(){var e=r.hrtime();return 1e3*e[0]+e[1]/1e6},e.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},e.prototype.decode=function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)},e}();f().get("IS_NODE")&&f().setPlatform("node",new Wl);var Vl={float32:4,int32:4,uint16:2,uint8:1,bool:1},Gl=4;function ql(e,t){for(var n={},r=0,i=function(t){var i=t.name,a=t.dtype,o=t.shape,s=j(o),u=void 0;if("quantization"in t){var c=t.quantization;if("uint8"!==c.dtype&&"uint16"!==c.dtype)throw new Error("Weight "+t.name+" has unknown quantization dtype "+c.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var l=Vl[c.dtype],f=e.slice(r,r+s*l),d="uint8"===c.dtype?new Uint8Array(f):new Uint16Array(f);if("float32"===a)u=Float32Array.from(d,(function(e){return e*c.scale+c.min}));else{if("int32"!==a)throw new Error("Unsupported dtype in weight '"+i+"': "+a);u=Int32Array.from(d,(function(e){return Math.round(e*c.scale+c.min)}))}r+=s*l}else if("string"===a){var h=j(t.shape);u=[];for(var p=0;p<h;p++){var m=new Uint32Array(e.slice(r,r+Gl))[0];r+=Gl;var v=new Uint8Array(e.slice(r,r+m));u.push(v),r+=m}}else{var g=Vl[a];if(f=e.slice(r,r+s*g),"float32"===a)u=new Float32Array(f);else if("int32"===a)u=new Int32Array(f);else{if("bool"!==a)throw new Error("Unsupported dtype in weight '"+i+"': "+a);u=new Uint8Array(f)}r+=s*g}n[i]=Rn(u,o,a)},a=0,o=t;a<o.length;a++)i(o[a]);return n}var Hl=void 0!==i&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function Xl(e){return Hl?i.byteLength(e):new Blob([e]).size}function Kl(e){var t=0;e.forEach((function(e){t+=e.byteLength}));var n=new Uint8Array(t),r=0;return e.forEach((function(e){n.set(new Uint8Array(e),r),r+=e.byteLength})),n.buffer}function Yl(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function $l(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:Xl(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:Xl(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}var Jl=function(){function e(){this.saveRouters=[],this.loadRouters=[]}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerSaveRouter=function(t){e.getInstance().saveRouters.push(t)},e.registerLoadRouter=function(t){e.getInstance().loadRouters.push(t)},e.getSaveHandlers=function(t){return e.getHandlers(t,"save")},e.getLoadHandlers=function(t,n){return e.getHandlers(t,"load",n)},e.getHandlers=function(t,n,r){var i=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach((function(e){var n=e(t,r);null!==n&&i.push(n)})),i},e}(),Zl="://",Ql=function(){function e(){this.managers={}}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerManager=function(t,n){A(null!=t,(function(){return"scheme must not be undefined or null."})),t.endsWith(Zl)&&(t=t.slice(0,t.indexOf(Zl))),A(t.length>0,(function(){return"scheme must not be an empty string."}));var r=e.getInstance();A(null==r.managers[t],(function(){return"A model store manager is already registered for scheme '"+t+"'."})),r.managers[t]=n},e.getManager=function(e){var t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},e.getSchemes=function(){return Object.keys(this.getInstance().managers)},e}();function ef(e){if(-1===e.indexOf(Zl))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Ql.getSchemes().join(","));return{scheme:e.split(Zl)[0],path:e.split(Zl)[1]}}function tf(e,t,n){return void 0===n&&(n=!1),u(this,void 0,void 0,(function(){var r,i,a,o,s,u,l,f,d;return c(this,(function(c){switch(c.label){case 0:return A(e!==t,(function(){return"Old path and new path are the same: '"+e+"'"})),A((r=Jl.getLoadHandlers(e)).length>0,(function(){return"Copying failed because no load handler is found for source URL "+e+"."})),A(r.length<2,(function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+e+"."})),i=r[0],A((a=Jl.getSaveHandlers(t)).length>0,(function(){return"Copying failed because no save handler is found for destination URL "+t+"."})),A(a.length<2,(function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+t+"."})),o=a[0],s=ef(e).scheme,u=ef(e).path,l=s===ef(e).scheme,[4,i.load()];case 1:return f=c.sent(),n&&l?[4,Ql.getManager(s).removeModel(u)]:[3,3];case 2:c.sent(),c.label=3;case 3:return[4,o.save(f)];case 4:return d=c.sent(),!n||l?[3,6]:[4,Ql.getManager(s).removeModel(u)];case 5:c.sent(),c.label=6;case 6:return[2,d.modelArtifactsInfo]}}))}))}var nf="models_store",rf="model_info_store";function af(){if(!f().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e=window||self,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function of(e){var t=e.result;t.createObjectStore(nf,{keyPath:"modelPath"}),t.createObjectStore(rf,{keyPath:"modelPath"})}var sf=function(){function e(e){if(this.indexedDB=af(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return e.prototype.save=function(e){return u(this,void 0,void 0,(function(){return c(this,(function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]}))}))},e.prototype.load=function(){return u(this,void 0,void 0,(function(){return c(this,(function(e){return[2,this.databaseAction(this.modelPath)]}))}))},e.prototype.databaseAction=function(e,t){var n=this;return new Promise((function(e,r){var i=n.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return of(i)},i.onsuccess=function(){var a=i.result;if(null==t){var o=a.transaction(nf,"readonly"),s=o.objectStore(nf).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return a.close(),r(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));e(s.result.modelArtifacts)},s.onerror=function(e){return a.close(),r(s.error)},o.oncomplete=function(){return a.close()}}else{var u,c=$l(t),l=a.transaction(rf,"readwrite"),f=l.objectStore(rf),d=f.put({modelPath:n.modelPath,modelArtifactsInfo:c});d.onsuccess=function(){var i=(u=a.transaction(nf,"readwrite")).objectStore(nf).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:c});i.onsuccess=function(){return e({modelArtifactsInfo:c})},i.onerror=function(e){var t=(f=l.objectStore(rf)).delete(n.modelPath);t.onsuccess=function(){return a.close(),r(i.error)},t.onerror=function(e){return a.close(),r(i.error)}}},d.onerror=function(e){return a.close(),r(d.error)},l.oncomplete=function(){null==u?a.close():u.oncomplete=function(){return a.close()}}}},i.onerror=function(e){return r(i.error)}}))},e.URL_SCHEME="indexeddb://",e}(),uf=function(e){return f().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(sf.URL_SCHEME)?(t=e.slice(sf.URL_SCHEME.length),new sf(t)):null;var t};Jl.registerSaveRouter(uf),Jl.registerLoadRouter(uf);var cf=function(){function e(){this.indexedDB=af()}return e.prototype.listModels=function(){return u(this,void 0,void 0,(function(){var e=this;return c(this,(function(t){return[2,new Promise((function(t,n){var r=e.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=function(){return of(r)},r.onsuccess=function(){var e=r.result,i=e.transaction(rf,"readonly"),a=i.objectStore(rf).getAll();a.onsuccess=function(){for(var e={},n=0,r=a.result;n<r.length;n++){var i=r[n];e[i.modelPath]=i.modelArtifactsInfo}t(e)},a.onerror=function(t){return e.close(),n(a.error)},i.oncomplete=function(){return e.close()}},r.onerror=function(e){return n(r.error)}}))]}))}))},e.prototype.removeModel=function(e){return u(this,void 0,void 0,(function(){var t=this;return c(this,(function(n){var r;return e=(r=e).startsWith(sf.URL_SCHEME)?r.slice(sf.URL_SCHEME.length):r,[2,new Promise((function(n,r){var i=t.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return of(i)},i.onsuccess=function(){var t,a=i.result,o=a.transaction(rf,"readwrite"),s=o.objectStore(rf),u=s.get(e);u.onsuccess=function(){if(null==u.result)return a.close(),r(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var i=s.delete(e),o=function(){var i=(t=a.transaction(nf,"readwrite")).objectStore(nf).delete(e);i.onsuccess=function(){return n(u.result.modelArtifactsInfo)},i.onerror=function(e){return r(u.error)}};i.onsuccess=o,i.onerror=function(e){return o(),a.close(),r(u.error)}},u.onerror=function(e){return a.close(),r(u.error)},o.oncomplete=function(){null==t?a.close():t.oncomplete=function(){return a.close()}}},i.onerror=function(e){return r(i.error)}}))]}))}))},e}();if(f().getBool("IS_BROWSER"))try{Ql.registerManager(sf.URL_SCHEME,new cf)}catch(hd){}var lf="/",ff="tensorflowjs_models",df="info",hf="model_topology",pf="weight_specs",mf="weight_data",vf="model_metadata";function gf(e){return{info:[ff,e,df].join(lf),topology:[ff,e,hf].join(lf),weightSpecs:[ff,e,pf].join(lf),weightData:[ff,e,mf].join(lf),modelMetadata:[ff,e,vf].join(lf)}}function yf(e){var t=e.split(lf);if(t.length<3)throw new Error("Invalid key format: "+e);return t.slice(1,t.length-1).join(lf)}var bf=function(){function e(e){if(!f().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=gf(this.modelPath)}return e.prototype.save=function(e){return u(this,void 0,void 0,(function(){var t,n,r;return c(this,(function(a){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),r=$l(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(e){if(Hl)return i.from(e).toString("base64");for(var t=new Uint8Array(e),n="",r=0,a=t.length;r<a;r++)n+=String.fromCharCode(t[r]);return btoa(n)}(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:r}]}catch(e){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+r.modelTopologyBytes+", weightSpecsBytes="+r.weightSpecsBytes+", weightDataBytes="+r.weightDataBytes+".")}return[2]}))}))},e.prototype.load=function(){return u(this,void 0,void 0,(function(){var e,t,n,r,a,o,s;return c(this,(function(u){if(null==(e=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},null==(n=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=n,null==(r=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=r,null!=(a=this.LS.getItem(this.keys.modelMetadata))&&(o=JSON.parse(a),t.format=o.format,t.generatedBy=o.generatedBy,t.convertedBy=o.convertedBy,t.userDefinedMetadata=o.userDefinedMetadata),null==(s=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=function(e){if(Hl){var t=i.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),a=0;a<n.length;++a)r.set([n.charCodeAt(a)],a);return r.buffer}(s),[2,t]}))}))},e.URL_SCHEME="localstorage://",e}(),xf=function(e){return f().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(bf.URL_SCHEME)?(t=e.slice(bf.URL_SCHEME.length),new bf(t)):null;var t};Jl.registerSaveRouter(xf),Jl.registerLoadRouter(xf);var wf=function(){function e(){A(f().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),A("undefined"==typeof window||void 0!==window.localStorage,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return e.prototype.listModels=function(){return u(this,void 0,void 0,(function(){var e,t,n,r,i,a;return c(this,(function(o){for(e={},t=ff+lf,n=lf+df,r=0;r<this.LS.length;++r)(i=this.LS.key(r)).startsWith(t)&&i.endsWith(n)&&(a=yf(i),e[a]=JSON.parse(this.LS.getItem(i)));return[2,e]}))}))},e.prototype.removeModel=function(e){return u(this,void 0,void 0,(function(){var t,n;return c(this,(function(r){var i;if(e=(i=e).startsWith(bf.URL_SCHEME)?i.slice(bf.URL_SCHEME.length):i,t=gf(e),null==this.LS.getItem(t.info))throw new Error("Cannot find model at path '"+e+"'");return n=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,n]}))}))},e}();if(f().getBool("IS_BROWSER"))try{Ql.registerManager(bf.URL_SCHEME,new wf)}catch(hd){}var _f="model",kf=".json",Ef=".weights.bin";function Sf(e){return new Promise((function(e){return setTimeout(e)})).then(e)}var Cf=function(){function e(t){if(!f().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),null!=t&&0!==t.length||(t=_f),this.modelTopologyFileName=t+kf,this.weightDataFileName=t+Ef}return e.prototype.save=function(e){return u(this,void 0,void 0,(function(){var t,n,r,i,a,o;return c(this,(function(s){switch(s.label){case 0:if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:n},i=window.URL.createObjectURL(new Blob([JSON.stringify(r)],{type:"application/json"})),(a=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=i,[4,Sf((function(){return a.dispatchEvent(new MouseEvent("click"))}))];case 2:return s.sent(),null==e.weightData?[3,4]:((o=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,o.href=t,[4,Sf((function(){return o.dispatchEvent(new MouseEvent("click"))}))]);case 3:s.sent(),s.label=4;case 4:return[2,{modelArtifactsInfo:$l(e)}]}}))}))},e.URL_SCHEME="downloads://",e}(),Af=function(){function e(e){if(null==e||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return e.prototype.load=function(){return u(this,void 0,void 0,(function(){var e,t,n=this;return c(this,(function(r){return e=this.files[0],t=this.files.slice(1),[2,new Promise((function(r,i){var a=new FileReader;a.onload=function(a){var o=JSON.parse(a.target.result),s=o.modelTopology;if(null!=s){0===t.length&&r({modelTopology:s});var u=o.weightsManifest;if(null!=u){var c;try{c=n.checkManifestAndWeightFiles(u,t)}catch(e){return void i(e)}var l=[],f=[],d=[];u.forEach((function(e){e.paths.forEach((function(e){f.push(e),d.push(null)})),l.push.apply(l,e.weights)})),u.forEach((function(e){e.paths.forEach((function(e){var t=new FileReader;t.onload=function(t){var n=t.target.result,i=f.indexOf(e);d[i]=n,-1===d.indexOf(null)&&r({modelTopology:s,weightSpecs:l,weightData:Kl(d),format:o.format,generatedBy:o.generatedBy,convertedBy:o.convertedBy,userDefinedMetadata:o.userDefinedMetadata})},t.onerror=function(t){return i("Failed to weights data from file of path '"+e+"'.")},t.readAsArrayBuffer(c[e])}))}))}else i(new Error("weightManifest field is missing from file "+e.name))}else i(new Error("modelTopology field is missing from file "+e.name))},a.onerror=function(t){return i("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},a.readAsText(e)}))]}))}))},e.prototype.checkManifestAndWeightFiles=function(e,t){for(var n=[],r=t.map((function(e){return Yl(e.name)})),i={},a=0,o=e;a<o.length;a++)o[a].paths.forEach((function(e){var a=Yl(e);if(-1!==n.indexOf(a))throw new Error("Duplicate file basename found in weights manifest: '"+a+"'");if(n.push(a),-1===r.indexOf(a))throw new Error("Weight file with basename '"+a+"' is not provided.");i[e]=t[r.indexOf(a)]}));if(n.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+t.length+").");return i},e}();function Of(e,t,n,r){!function(e){A(null!=e&&Array.isArray(e)&&e.length>0,(function(){return"promises must be a none empty array"}))}(e),function(e,t){A(e>=0&&e<=1,(function(){return"Progress fraction must be in range [0, 1], but got startFraction "+e})),A(t>=0&&t<=1,(function(){return"Progress fraction must be in range [0, 1], but got endFraction "+t})),A(t>=e,(function(){return"startFraction must be no more than endFraction, but got startFraction "+e+" and endFraction "+t}))}(n=null==n?0:n,r=null==r?1:r);var i=0;return Promise.all(e.map((function(a){return a.then((function(a){var o=n+ ++i/e.length*(r-n);return t(o),a})),a})))}function Df(e,t){return u(this,void 0,void 0,(function(){var n,r,i,a,o,s,u,l,d;return c(this,(function(c){switch(c.label){case 0:return null==t&&(t={}),n=null==t.fetchFunc?f().platform.fetch:t.fetchFunc,r=e.map((function(e){return n(e,t.requestInit,{isBinary:!0})})),i=0,a=.5,null!=t.onProgress?[3,2]:[4,Promise.all(r)];case 1:return o=c.sent(),[3,4];case 2:return[4,Of(r,t.onProgress,i,a)];case 3:o=c.sent(),c.label=4;case 4:return s=o.map((function(e){return e.arrayBuffer()})),u=.5,l=1,null!=t.onProgress?[3,6]:[4,Promise.all(s)];case 5:return d=c.sent(),[3,8];case 6:return[4,Of(s,t.onProgress,u,l)];case 7:d=c.sent(),c.label=8;case 8:return[2,d]}}))}))}function Tf(e){var t=this;return function(n,r,i){return void 0===r&&(r=""),u(t,void 0,void 0,(function(){var t,a,o,s,u,l,f,d,h,p;return c(this,(function(c){switch(c.label){case 0:if(t=n.map((function(){return!1})),a={},o=null!=i?i.map((function(){return!1})):[],s=[],n.forEach((function(e,n){var r=0;e.weights.forEach((function(e){var u="quantization"in e?e.quantization.dtype:e.dtype,c=Vl[u]*j(e.shape),l=function(){t[n]=!0,null==a[n]&&(a[n]=[]),a[n].push({manifestEntry:e,groupOffset:r,sizeBytes:c})};null!=i?i.forEach((function(t,n){t===e.name&&(l(),o[n]=!0)})):l(),s.push(e.name),r+=c}))})),!o.every((function(e){return e})))throw u=i.filter((function(e,t){return!o[t]})),new Error("Could not find weights in manifest with names: "+u.join(", ")+". \nManifest JSON has weights with names: "+s.join(", ")+".");return l=t.reduce((function(e,t,n){return t&&e.push(n),e}),[]),f=[],l.forEach((function(e){n[e].paths.forEach((function(e){var t=r+(r.endsWith("/")?"":"/")+e;f.push(t)}))})),[4,e(f)];case 1:return d=c.sent(),h={},p=0,l.forEach((function(e){for(var t=n[e].paths.length,r=0,i=0;i<t;i++)r+=d[p+i].byteLength;for(var o=new ArrayBuffer(r),s=new Uint8Array(o),u=0,c=0;c<t;c++){var l=new Uint8Array(d[p+c]);s.set(l,u),u+=l.byteLength}a[e].forEach((function(e){var t=ql(o.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(var n in t)h[n]=t[n]})),p+=t})),[2,h]}}))}))}}Jl.registerSaveRouter((function(e){return f().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Cf.URL_SCHEME)?function(e){return void 0===e&&(e="model"),new Cf(e)}(e.slice(Cf.URL_SCHEME.length)):null}));var jf=function(){function e(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,null!=t.fetchFunc?(A("function"==typeof t.fetchFunc,(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=t.fetchFunc):this.fetch=f().platform.fetch,A(null!=e&&e.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(e)&&A(2===e.length,(function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."})),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return e.prototype.save=function(e){return u(this,void 0,void 0,(function(){var t,n,r,i;return c(this,(function(a){switch(a.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:n},t.body.append("model.json",new Blob([JSON.stringify(r)],{type:"application/json"}),"model.json"),null!=e.weightData&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((i=a.sent()).ok)return[2,{modelArtifactsInfo:$l(e),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+i.status+".")}}))}))},e.prototype.load=function(){return u(this,void 0,void 0,(function(){var e,t,n,r,i,a,o,s,u,l,f,d;return c(this,(function(c){switch(c.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=c.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");c.label=2;case 2:return c.trys.push([2,4,,5]),[4,e.json()];case 3:return t=c.sent(),[3,5];case 4:throw c.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(r=t.modelTopology,i=t.weightsManifest,a=t.generatedBy,o=t.convertedBy,s=t.format,u=t.userDefinedMetadata,null==r&&null==i)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==i?[3,7]:[4,this.loadWeights(i)];case 6:d=c.sent(),l=d[0],f=d[1],c.label=7;case 7:return[2,{modelTopology:r,weightSpecs:l,weightData:f,userDefinedMetadata:u,generatedBy:a,convertedBy:o,format:s}]}}))}))},e.prototype.loadWeights=function(e){return u(this,void 0,void 0,(function(){var t,n,r,i,a,o,s,u,l,f,d;return c(this,(function(c){switch(c.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,n=function(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}(t),r=n[0],i=n[1],a=this.weightPathPrefix||r,o=[],s=0,u=e;s<u.length;s++)l=u[s],o.push.apply(o,l.weights);return f=[],e.forEach((function(e){e.paths.forEach((function(e){f.push(a+e+i)}))})),[4,Df(f,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return d=c.sent(),[2,[o,Kl(d)]]}}))}))},e.URL_SCHEME_REGEX=/^https?:\/\//,e}();function Mf(e){return null!=e.match(jf.URL_SCHEME_REGEX)}var Ff=function(e,t){return"undefined"==typeof fetch?null:(Array.isArray(e)?e.every((function(e){return Mf(e)})):Mf(e))?If(e,{onProgress:t}):null};function If(e,t){return new jf(e,t)}Jl.registerSaveRouter(Ff),Jl.registerLoadRouter(Ff);var Nf,Rf=function(){function e(e){this.modelArtifacts=e}return e.prototype.load=function(){return u(this,void 0,void 0,(function(){return c(this,(function(e){return[2,this.modelArtifacts]}))}))},e}(),Pf=function(){function e(e){this.saveHandler=e}return e.prototype.save=function(e){return u(this,void 0,void 0,(function(){return c(this,(function(t){return[2,this.saveHandler(e)]}))}))},e}(),Bf=Object.freeze({browserFiles:function(e){return new Af(e)},browserHTTPRequest:function(e,t){return If(e,t)},concatenateArrayBuffers:Kl,decodeWeights:ql,encodeWeights:function(e,t){return u(this,void 0,void 0,(function(){var n,r,i,a,o,s=this;return c(this,(function(l){switch(l.label){case 0:for(n=[],r=[],i=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e),a=function(a){var o=i[a],l=Array.isArray(e)?e[a].tensor:e[o];if("float32"!==l.dtype&&"int32"!==l.dtype&&"bool"!==l.dtype&&"string"!==l.dtype)throw new Error("Unsupported dtype in weight '"+o+"': "+l.dtype);var f={name:o,shape:l.shape,dtype:l.dtype};if("string"===l.dtype){var d=new Promise((function(e){return u(s,void 0,void 0,(function(){var t,n,r,i,a,o,s;return c(this,(function(u){switch(u.label){case 0:return[4,l.bytes()];case 1:for(t=u.sent(),n=t.reduce((function(e,t){return e+t.length}),0)+Gl*t.length,r=new Uint8Array(n),i=0,a=0;a<t.length;a++)o=t[a],s=new Uint8Array(new Uint32Array([o.length]).buffer),r.set(s,i),i+=Gl,r.set(o,i),i+=o.length;return e(r),[2]}}))}))}));r.push(d)}else r.push(l.data());null!=t&&(f.group=t),n.push(f)},o=0;o<i.length;++o)a(o);return[4,Promise.all(r)];case 1:return[2,{data:function(e){if(null===e)throw new Error("Invalid input value: "+JSON.stringify(e));var t=0,n=[];e.forEach((function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+e.constructor.name)}));var r=new Uint8Array(t),i=0;return n.forEach((function(e){r.set(new Uint8Array(e.buffer),i),i+=e.byteLength})),r.buffer}(l.sent()),specs:n}]}}))}))},fromMemory:function(e,t,n,r){return 1===arguments.length?null!=e.modelTopology||null!=e.weightSpecs?new Rf(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Rf({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Rf({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))},getLoadHandlers:function(e,t){return Jl.getLoadHandlers(e,t)},getModelArtifactsInfoForJSON:$l,getSaveHandlers:function(e){return Jl.getSaveHandlers(e)},http:If,isHTTPScheme:Mf,loadWeights:function(e,t,n,r){return void 0===t&&(t=""),u(this,void 0,void 0,(function(){return c(this,(function(i){return[2,Tf((function(e){return Df(e,{requestInit:r})}))(e,t,n)]}))}))},registerLoadRouter:function(e){return Jl.registerLoadRouter(e)},registerSaveRouter:function(e){return Jl.registerSaveRouter(e)},weightsLoaderFactory:Tf,withSaveHandler:function(e){return new Pf(e)},copyModel:function(e,t){return u(this,void 0,void 0,(function(){return c(this,(function(n){return[2,tf(e,t,!1)]}))}))},listModels:function(){return u(this,void 0,void 0,(function(){var e,t,n,r,i,a,o;return c(this,(function(s){switch(s.label){case 0:e=Ql.getSchemes(),t={},n=0,r=e,s.label=1;case 1:return n<r.length?(i=r[n],[4,Ql.getManager(i).listModels()]):[3,4];case 2:for(o in a=s.sent())t[i+Zl+o]=a[o];s.label=3;case 3:return n++,[3,1];case 4:return[2,t]}}))}))},moveModel:function(e,t){return u(this,void 0,void 0,(function(){return c(this,(function(n){return[2,tf(e,t,!0)]}))}))},removeModel:function(e){return u(this,void 0,void 0,(function(){var t;return c(this,(function(n){return t=ef(e),[2,Ql.getManager(t.scheme).removeModel(t.path)]}))}))}}),Lf=Mn({confusionMatrix_:function(e,t,n){var r=xn(e,"labels","confusionMatrix"),i=xn(t,"predictions","confusionMatrix");A(null==n||n>0&&Number.isInteger(n),(function(){return"If provided, numClasses must be a positive integer, but got "+n})),A(1===r.rank,(function(){return"Expected the rank of labels to be 1, but got "+r.rank})),A(1===i.rank,(function(){return"Expected the rank of predictions to be 1, but got "+i.rank})),A(r.shape[0]===i.shape[0],(function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+i.shape[0]+". Labels and predictions should have the same number of elements."})),A(n>0&&Number.isInteger(n),(function(){return"numClasses is required to be a positive integer, but got "+n}));var a=Or(r.asType("int32"),n),o=Or(i.asType("int32"),n);return a.transpose().matMul(o).asType("int32")}}),zf=Object.freeze({confusionMatrix:Lf}),Uf=Mn({fromPixels_:function(e,t){if(void 0===t&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,i=!1,a=!1,o=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)i=!0;else if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)a=!0;else{if(null==e.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);o=!0}if(i&&i&&e.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(null!=m("FromPixels",We.backendName))return We.runKernel("FromPixels",{pixels:e},{numChannels:t});var s,u,c=i?[e.videoWidth,e.videoHeight]:[e.width,e.height],l=c[0],f=c[1];if(o?s=e.getContext("2d").getImageData(0,0,l,f).data:r||n?s=e.data:(a||i)&&(null==Nf&&(Nf=document.createElement("canvas").getContext("2d")),Nf.canvas.width=l,Nf.canvas.height=f,Nf.drawImage(e,0,0,l,f),s=Nf.getImageData(0,0,l,f).data),4===t)u=new Int32Array(s);else{var d=l*f;u=new Int32Array(d*t);for(var h=0;h<d;h++)for(var p=0;p<t;++p)u[h*t+p]=s[4*h+p]}return Un(u,[f,l,t],"int32")}}),Wf=Object.freeze({toPixels:function(e,t){return u(this,void 0,void 0,(function(){var n,r,i,a,o,s,u,l,f,d,h,p,m,v,g,y,b,x,w,_,k,E,S;return c(this,(function(c){switch(c.label){case 0:if(n=xn(e,"img","toPixels"),e instanceof Se||(n=n.toInt()),2!==n.rank&&3!==n.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),i=r[0],a=r[1],(o=2===n.rank?1:n.shape[2])>4||2===o)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+o);return[4,n.data()];case 1:return s=c.sent(),u=n.min(),l=n.max(),[4,Promise.all([u.data(),l.data()])];case 2:if(f=c.sent(),d=f[0],h=f[1],p=d[0],m=h[0],u.dispose(),l.dispose(),"float32"===n.dtype){if(p<0||m>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+p+" - "+m+"].")}else{if("int32"!==n.dtype)throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(p<0||m>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+p+" - "+m+"].")}for(v="float32"===n.dtype?255:1,g=new Uint8ClampedArray(a*i*4),y=0;y<i*a;++y)b=void 0,x=void 0,w=void 0,_=void 0,1===o?(b=s[y]*v,x=s[y]*v,w=s[y]*v,_=255):3===o?(b=s[3*y]*v,x=s[3*y+1]*v,w=s[3*y+2]*v,_=255):4===o&&(b=s[4*y]*v,x=s[4*y+1]*v,w=s[4*y+2]*v,_=s[4*y+3]*v),g[0+(k=4*y)]=Math.round(b),g[k+1]=Math.round(x),g[k+2]=Math.round(w),g[k+3]=Math.round(_);return null!=t&&(t.width=a,t.height=i,E=t.getContext("2d"),S=new ImageData(g,a,i),E.putImageData(S,0,0)),n!==e&&n.dispose(),[2,g]}}))}))},fromPixels:Uf}),Vf=function(){function e(){}return e.prototype.getClassName=function(){return this.constructor.className},e.fromConfig=function(e,t){return new e(t)},e}(),Gf=function(){function e(){this.classNameMap={}}return e.getMap=function(){return null==e.instance&&(e.instance=new e),e.instance},e.register=function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]},e}();function qf(e){A(null!=e.className,(function(){return"Class being registered does not have the static className property defined."})),A("string"==typeof e.className,(function(){return"className is required to be a string, but got type "+typeof e.className})),A(e.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),Gf.register(e)}var Hf=Object.freeze({Serializable:Vf,SerializationMap:Gf,registerClass:qf}),Xf=.001,Kf=.1;function Yf(){return 32===We.backend.floatPrecision()?Xf:Kf}function $f(e,t,n){var r=!0;if((H(e)||H(t))&&(r=!1),H(e)&&H(t)&&(r=!0),r){var i=e.constructor.name,a=t.constructor.name;if(i!==a)throw new Error("Arrays are of different type. Actual: "+i+". Expected: "+a)}if(Array.isArray(e)&&Array.isArray(t)){var o=yn(e),s=yn(t);if(!M(o,s))throw new Error("Arrays have different shapes. Actual: ["+o+"]. Expected: ["+s+"]")}var u=H(e)?e:T(e),c=H(t)?t:T(t);if(u.length!==c.length)throw new Error("Arrays have different lengths actual: "+u.length+" vs expected: "+c.length+".\nActual:   "+u+".\nExpected: "+c+".");for(var l=0;l<c.length;++l){var f=u[l],d=c[l];if(!n(f,d))throw new Error("Arrays differ: actual["+l+"] = "+f+", expected["+l+"] = "+d+".\nActual:   "+u+".\nExpected: "+c+".")}}function Jf(e,t,n){return!isFinite(e)&&!isFinite(t)||!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}var Zf=Object.freeze({TEST_EPSILON_FLOAT16:Kf,expectArraysClose:function(e,t,n){return null==n&&(n=Yf()),$f(e,t,(function(e,t){return Jf(e,t,n)}))},testEpsilon:Yf,expectPromiseToFail:function(e,t){e().then((function(){return t.fail()}),(function(){return t()}))},expectArraysEqual:function(e,t){var n="string"==typeof t||"number"==typeof t||"boolean"==typeof t?[t]:t;return Y(e)||Y(e[0])||Y(t)||Y(t[0])?$f(e,n,(function(e,t){return e==t})):$f(e,t,(function(e,t){return Jf(e,t,0)}))},expectNumbersClose:function(e,t,n){if(null==n&&(n=Yf()),!Jf(e,t,n))throw new Error("Numbers differ: actual === "+e+", expected === "+t)},expectValuesInRange:function(e,t,n){for(var r=0;r<e.length;r++)if(e[r]<t||e[r]>n)throw new Error("Value out of range:"+e[r]+" low: "+t+", high: "+n)},expectArrayBuffersEqual:function(e,t){expect(new Float32Array(e)).toEqual(new Float32Array(t))}}),Qf="1.7.0",ed=Object.freeze({gpgpu_util:ro,webgl_util:Xt,forceHalfFloat:function(){f().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:Uo,setWebGLContext:$e,GPGPUContext:io}),td=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.minimize=function(e,t,n){void 0===t&&(t=!1);var r=this.computeGradients(e,n),i=r.value,a=r.grads;if(null!=n){var o=n.map((function(e){return{name:e.name,tensor:a[e.name]}}));this.applyGradients(o)}else this.applyGradients(a);return an(a),t?i:(i.dispose(),null)},Object.defineProperty(t.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),t.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},t.prototype.computeGradients=function(e,t){return gi(e,t)},t.prototype.dispose=function(){null!=this.iterations_&&an(this.iterations_)},t.prototype.saveIterations=function(){return u(this,void 0,void 0,(function(){return c(this,(function(e){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:Bn(this.iterations_,"int32")}]}))}))},t.prototype.getWeights=function(){return u(this,void 0,void 0,(function(){return c(this,(function(e){throw new Error("getWeights() is not implemented for this optimizer yet.")}))}))},t.prototype.setWeights=function(e){return u(this,void 0,void 0,(function(){return c(this,(function(e){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())}))}))},t.prototype.extractIterations=function(e){return u(this,void 0,void 0,(function(){var t;return c(this,(function(n){switch(n.label){case 0:return t=this,[4,e[0].tensor.data()];case 1:return t.iterations_=n.sent()[0],[2,e.slice(1)]}}))}))},t}(Vf);Object.defineProperty(td,Symbol.hasInstance,{value:function(e){return null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients}});var nd=function(e){function t(t,n,r){void 0===r&&(r=null);var i=e.call(this)||this;return i.learningRate=t,i.rho=n,i.epsilon=r,i.accumulatedGrads=[],i.accumulatedUpdates=[],null==r&&(i.epsilon=We.backend.epsilon()),i}return s(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var i=We.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:n+"/accum_grad",variable:rn((function(){return Zn(i).variable(!1)}))}),null==t.accumulatedUpdates[r]&&(t.accumulatedUpdates[r]={originalName:n+"/accum_var",variable:rn((function(){return Zn(i).variable(!1)}))});var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var o=t.accumulatedGrads[r].variable,s=t.accumulatedUpdates[r].variable;rn((function(){var e=o.mul(t.rho).add(a.square().mul(1-t.rho)),n=s.add(t.epsilon).sqrt().div(o.add(t.epsilon).sqrt()).mul(a),r=s.mul(t.rho).add(n.square().mul(1-t.rho));o.assign(e),s.assign(r);var u=n.mul(-t.learningRate).add(i);i.assign(u)}))}})),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedUpdates&&(an(this.accumulatedGrads.map((function(e){return e.variable}))),an(this.accumulatedUpdates.map((function(e){return e.variable}))))},t.prototype.getWeights=function(){return u(this,void 0,void 0,(function(){var e;return c(this,(function(t){switch(t.label){case 0:return e=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return u(this,void 0,void 0,(function(){var t;return c(this,(function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),t=e.length/2,this.accumulatedGrads=e.slice(0,t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedUpdates=e.slice(t,2*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.rho,t.epsilon)},t.className="Adadelta",t}(td);qf(nd);var rd=function(e){function t(t,n){void 0===n&&(n=.1);var r=e.call(this)||this;return r.learningRate=t,r.initialAccumulatorValue=n,r.accumulatedGrads=[],r}return s(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var i=We.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:n+"/accumulator",variable:rn((function(){return Kn(i.shape,t.initialAccumulatorValue).variable(!1)}))});var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var o=t.accumulatedGrads[r].variable;rn((function(){var e=o.add(a.square());o.assign(e);var n=a.div(e.add(We.backend.epsilon()).sqrt()).mul(-t.learningRate).add(i);i.assign(n)}))}})),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedGrads&&an(this.accumulatedGrads.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return u(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulatedGrads.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return u(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulatedGrads=e.map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},t.fromConfig=function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)},t.className="Adagrad",t}(td);qf(rd);var id=function(e){function t(t,n,r,i){void 0===i&&(i=null);var a=e.call(this)||this;return a.learningRate=t,a.beta1=n,a.beta2=r,a.epsilon=i,a.accumulatedFirstMoment=[],a.accumulatedSecondMoment=[],rn((function(){a.accBeta1=Bn(n).variable(),a.accBeta2=Bn(r).variable()})),null==i&&(a.epsilon=We.backend.epsilon()),a}return s(t,e),t.prototype.applyGradients=function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);rn((function(){var r=lu(1,t.accBeta1),i=lu(1,t.accBeta2);n.forEach((function(n,a){var o=We.registeredVariables[n];null==t.accumulatedFirstMoment[a]&&(t.accumulatedFirstMoment[a]={originalName:n+"/m",variable:rn((function(){return Zn(o).variable(!1)}))}),null==t.accumulatedSecondMoment[a]&&(t.accumulatedSecondMoment[a]={originalName:n+"/v",variable:rn((function(){return Zn(o).variable(!1)}))});var s=Array.isArray(e)?e[a].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[a].variable,c=t.accumulatedSecondMoment[a].variable,l=u.mul(t.beta1).add(s.mul(1-t.beta1)),f=c.mul(t.beta2).add(s.square().mul(1-t.beta2)),d=l.div(r),h=f.div(i);u.assign(l),c.assign(f);var p=d.div(h.sqrt().add(t.epsilon)).mul(-t.learningRate).add(o);o.assign(p)}})),t.accBeta1.assign(t.accBeta1.mul(t.beta1)),t.accBeta2.assign(t.accBeta2.mul(t.beta2))})),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&an(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedSecondMoment&&an(this.accumulatedSecondMoment.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return u(this,void 0,void 0,(function(){var e;return c(this,(function(t){switch(t.label){case 0:return e=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return u(this,void 0,void 0,(function(){var t,n=this;return c(this,(function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:return e=r.sent(),rn((function(){n.accBeta1.assign(su(n.beta1,n.iterations_+1)),n.accBeta2.assign(su(n.beta2,n.iterations_+1))})),t=e.length/2,this.accumulatedFirstMoment=e.slice(0,t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedSecondMoment=e.slice(t,2*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)},t.className="Adam",t}(td);qf(id);var ad=function(e){function t(t,n,r,i,a){void 0===i&&(i=null),void 0===a&&(a=0);var o=e.call(this)||this;return o.learningRate=t,o.beta1=n,o.beta2=r,o.epsilon=i,o.decay=a,o.accumulatedFirstMoment=[],o.accumulatedWeightedInfNorm=[],rn((function(){o.iteration=Bn(0).variable(),o.accBeta1=Bn(n).variable()})),null==i&&(o.epsilon=We.backend.epsilon()),o}return s(t,e),t.prototype.applyGradients=function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);rn((function(){var r=lu(1,t.accBeta1),i=Ys(-t.learningRate,t.iteration.mul(t.decay).add(1));n.forEach((function(n,a){var o=We.registeredVariables[n];null==t.accumulatedFirstMoment[a]&&(t.accumulatedFirstMoment[a]={originalName:n+"/m",variable:Zn(o).variable(!1)}),null==t.accumulatedWeightedInfNorm[a]&&(t.accumulatedWeightedInfNorm[a]={originalName:n+"/v",variable:Zn(o).variable(!1)});var s=Array.isArray(e)?e[a].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[a].variable,c=t.accumulatedWeightedInfNorm[a].variable,l=u.mul(t.beta1).add(s.mul(1-t.beta1)),f=c.mul(t.beta2),d=s.abs(),h=f.maximum(d);u.assign(l),c.assign(h);var p=i.div(r).mul(l.div(h.add(t.epsilon))).add(o);o.assign(p)}})),t.iteration.assign(t.iteration.add(1)),t.accBeta1.assign(t.accBeta1.mul(t.beta1))})),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&an(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedWeightedInfNorm&&an(this.accumulatedWeightedInfNorm.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return u(this,void 0,void 0,(function(){return c(this,(function(e){throw new Error("getWeights() is not implemented for Adamax yet.")}))}))},t.prototype.setWeights=function(e){return u(this,void 0,void 0,(function(){return c(this,(function(e){throw new Error("setWeights() is not implemented for Adamax yet.")}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)},t.className="Adamax",t}(td);qf(ad);var od=function(e){function t(t){var n=e.call(this)||this;return n.learningRate=t,n.setLearningRate(t),n}return s(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var a=We.registeredVariables[n];rn((function(){var e=t.c.mul(i).add(a);a.assign(e)}))}})),this.incrementIterations()},t.prototype.setLearningRate=function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=on(Bn(-e))},t.prototype.dispose=function(){this.c.dispose()},t.prototype.getWeights=function(){return u(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()]]}}))}))},t.prototype.setWeights=function(e){return u(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:if(0!==(e=t.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate}},t.fromConfig=function(e,t){return new e(t.learningRate)},t.className="SGD",t}(td);qf(od);var sd=function(e){function t(t,n,r){void 0===r&&(r=!1);var i=e.call(this,t)||this;return i.learningRate=t,i.momentum=n,i.useNesterov=r,i.accumulations=[],i.m=Bn(i.momentum),i}return s(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var i=We.registeredVariables[n];null==t.accumulations[r]&&(t.accumulations[r]={originalName:n+"/momentum",variable:rn((function(){return Zn(i).variable(!1)}))});var a=t.accumulations[r].variable,o=Array.isArray(e)?e[r].tensor:e[n];null!=o&&rn((function(){var e,n=t.m.mul(a).add(o);e=t.useNesterov?t.c.mul(o.add(n.mul(t.m))).add(i):t.c.mul(n).add(i),a.assign(n),i.assign(e)}))})),this.incrementIterations()},t.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&an(this.accumulations.map((function(e){return e.variable})))},t.prototype.setMomentum=function(e){this.momentum=e},t.prototype.getWeights=function(){return u(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulations.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return u(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulations=e.map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},t.fromConfig=function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)},t.className="Momentum",t}(od);qf(sd);var ud=function(e){function t(t,n,r,i,a){void 0===n&&(n=.9),void 0===r&&(r=0),void 0===i&&(i=null),void 0===a&&(a=!1);var o=e.call(this)||this;if(o.learningRate=t,o.decay=n,o.momentum=r,o.epsilon=i,o.accumulatedMeanSquares=[],o.accumulatedMoments=[],o.accumulatedMeanGrads=[],o.centered=a,null==i&&(o.epsilon=We.backend.epsilon()),null==t)throw new Error("learningRate for RMSPropOptimizer must be defined.");return o}return s(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var i=We.registeredVariables[n];null==t.accumulatedMeanSquares[r]&&(t.accumulatedMeanSquares[r]={originalName:n+"/rms",variable:rn((function(){return Zn(i).variable(!1)}))}),null==t.accumulatedMoments[r]&&(t.accumulatedMoments[r]={originalName:n+"/momentum",variable:rn((function(){return Zn(i).variable(!1)}))}),null==t.accumulatedMeanGrads[r]&&t.centered&&(t.accumulatedMeanGrads[r]={originalName:n+"/mg",variable:rn((function(){return Zn(i).variable(!1)}))});var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var o=t.accumulatedMeanSquares[r].variable,s=t.accumulatedMoments[r].variable;rn((function(){var e=o.mul(t.decay).add(a.square().mul(1-t.decay));if(t.centered){var n=t.accumulatedMeanGrads[r].variable,u=n.mul(t.decay).add(a.mul(1-t.decay)),c=s.mul(t.momentum).add(a.mul(t.learningRate).div(e.sub(u.square().add(t.epsilon)).sqrt()));o.assign(e),n.assign(u),s.assign(c);var l=i.sub(c);i.assign(l)}else{var f=o.mul(t.decay).add(a.square().mul(1-t.decay));c=s.mul(t.momentum).add(a.mul(t.learningRate).div(f.add(t.epsilon).sqrt())),o.assign(f),s.assign(c),l=i.sub(c),i.assign(l)}}))}})),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&an(this.accumulatedMeanSquares.map((function(e){return e.variable}))),null!=this.accumulatedMeanGrads&&this.centered&&an(this.accumulatedMeanGrads.map((function(e){return e.variable}))),null!=this.accumulatedMoments&&an(this.accumulatedMoments.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return u(this,void 0,void 0,(function(){var e;return c(this,(function(t){switch(t.label){case 0:return e=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&e.push.apply(e,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return u(this,void 0,void 0,(function(){var t;return c(this,(function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),t=this.centered?e.length/3:e.length/2,this.accumulatedMeanSquares=e.slice(0,t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedMoments=e.slice(t,2*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.centered&&(this.accumulatedMeanGrads=e.slice(2*t,3*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}))),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)},t.className="RMSProp",t}(td);qf(ud);var cd=function(){function e(){}return e.sgd=function(e){return new od(e)},e.momentum=function(e,t,n){return void 0===n&&(n=!1),new sd(e,t,n)},e.rmsprop=function(e,t,n,r,i){return void 0===t&&(t=.9),void 0===n&&(n=0),void 0===r&&(r=null),void 0===i&&(i=!1),new ud(e,t,n,r,i)},e.adam=function(e,t,n,r){return void 0===e&&(e=.001),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),new id(e,t,n,r)},e.adadelta=function(e,t,n){return void 0===e&&(e=.001),void 0===t&&(t=.95),void 0===n&&(n=null),new nd(e,t,n)},e.adamax=function(e,t,n,r,i){return void 0===e&&(e=.002),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),void 0===i&&(i=0),new ad(e,t,n,r,i)},e.adagrad=function(e,t){return void 0===t&&(t=.1),new rd(e,t)},e}(),ld={sgd:cd.sgd,momentum:cd.momentum,adadelta:cd.adadelta,adagrad:cd.adagrad,rmsprop:cd.rmsprop,adamax:cd.adamax,adam:cd.adam},fd="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:void 0!==a?a:function(e){return e()};function dd(){return new Promise((function(e){return fd((function(){return e()}))}))}Se.prototype.squaredDifference=function(e){return Go(this,e)},ke=Dl}.call(this,n(59),n(75),n(92).Buffer,n(207).setImmediate)},function(e,t,n){e.exports=n(281)},function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return o})),n.d(t,"d",(function(){return s})),n.d(t,"e",(function(){return u}));var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function i(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var a=function(){return(a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function o(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}u((r=r.apply(e,t||[])).next())}))}function s(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function u(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,i++)r[i]=a[o];return r}},function(e,t){function n(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}e.exports=function(e){return function(){var t=this,r=arguments;return new Promise((function(i,a){var o=e.apply(t,r);function s(e){n(o,i,a,s,u,"next",e)}function u(e){n(o,i,a,s,u,"throw",e)}s(void 0)}))}},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){function n(t){return e.exports=n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,n(t)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){var r=n(16),i=n(24),a=n(42),o=n(38),s=n(56),u=function e(t,n,u){var c,l,f,d,h=t&e.F,p=t&e.G,m=t&e.P,v=t&e.B,g=p?r:t&e.S?r[n]||(r[n]={}):(r[n]||{}).prototype,y=p?i:i[n]||(i[n]={}),b=y.prototype||(y.prototype={});for(c in p&&(u=n),u)f=((l=!h&&g&&void 0!==g[c])?g:u)[c],d=v&&l?s(f,r):m&&"function"==typeof f?s(Function.call,f):f,g&&o(g,c,f,t&e.U),y[c]!=f&&a(y,c,d),m&&b[c]!=f&&(b[c]=f)};r.core=i,u.F=1,u.G=2,u.S=4,u.P=8,u.B=16,u.W=32,u.U=64,u.R=128,e.exports=u},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){"use strict";var r,i,a,o,s,u,c;n.d(t,"a",(function(){return M})),n.d(t,"b",(function(){return F})),n.d(t,"c",(function(){return I})),n.d(t,"d",(function(){return N})),n.d(t,"e",(function(){return B})),n.d(t,"f",(function(){return R})),n.d(t,"g",(function(){return T})),n.d(t,"h",(function(){return D})),n.d(t,"i",(function(){return P})),n.d(t,"j",(function(){return L})),n.d(t,"k",(function(){return j})),n.d(t,"l",(function(){return O})),n.d(t,"m",(function(){return H})),n.d(t,"n",(function(){return je})),n.d(t,"o",(function(){return ue})),n.d(t,"p",(function(){return pe})),n.d(t,"q",(function(){return ge})),n.d(t,"r",(function(){return xe})),n.d(t,"s",(function(){return V})),n.d(t,"t",(function(){return U})),n.d(t,"u",(function(){return fe})),n.d(t,"v",(function(){return me})),n.d(t,"w",(function(){return ye})),n.d(t,"x",(function(){return we})),n.d(t,"y",(function(){return Z})),n.d(t,"z",(function(){return Q})),n.d(t,"A",(function(){return X}));var l=n(1),f=n(72),d=n(40),h=n(71),p=n(39),m=n(70),v=n(135),g=n(184),b=n(183),x=n(69),w=n(182),_=n(68),k=n(134),E=n(181),S=n(180),C=n(108),A=n(45),O="year",D="quarter",T="month",j="week",M="date",F="day",I="dayofyear",N="hours",R="minutes",P="seconds",B="milliseconds",L=[O,D,T,j,M,F,I,N,R,P,B],z=L.reduce((function(e,t,n){return e[t]=1+n,e}),{});function U(e){var t=Object(l.i)(e).slice(),n={};return t.length||Object(l.o)("Missing time unit."),t.forEach((function(e){Object(l.w)(z,e)?n[e]=1:Object(l.o)("Invalid time unit: ".concat(e,"."))})),(n[j]||n[F]?1:0)+(n[D]||n[T]||n[M]?1:0)+(n[I]?1:0)>1&&Object(l.o)("Incompatible time units: ".concat(e)),t.sort((function(e,t){return z[e]-z[t]})),t}var W=(y(r={},O,"%Y "),y(r,D,"Q%q "),y(r,T,"%b "),y(r,M,"%d "),y(r,j,"W%U "),y(r,F,"%a "),y(r,I,"%j "),y(r,N,"%H:00"),y(r,R,"00:%M"),y(r,P,":%S"),y(r,B,".%L"),y(r,"".concat(O,"-").concat(T),"%Y-%m "),y(r,"".concat(O,"-").concat(T,"-").concat(M),"%Y-%m-%d "),y(r,"".concat(N,"-").concat(R),"%H:%M"),r);function V(e,t){var n,r,i=Object(l.p)({},W,t),a=U(e),o=a.length,s="",u=0;for(u=0;u<o;)for(n=a.length;n>u;--n)if(null!=i[r=a.slice(u,n).join("-")]){s+=i[r],u=n;break}return s.trim()}var G=new Date;function q(e){return G.setFullYear(e),G.setMonth(0),G.setDate(1),G.setHours(0,0,0,0),G}function H(e){return K(new Date(e))}function X(e){return Y(new Date(e))}function K(e){return f.a.count(q(e.getFullYear())-1,e)}function Y(e){return d.b.count(q(e.getFullYear())-1,e)}function $(e){return q(e).getDay()}function J(e,t,n,r,i,a,o){if(0<=e&&e<100){var s=new Date(-1,t,n,r,i,a,o);return s.setFullYear(e),s}return new Date(e,t,n,r,i,a,o)}function Z(e){return ee(new Date(e))}function Q(e){return te(new Date(e))}function ee(e){var t=Date.UTC(e.getUTCFullYear(),0,1);return h.a.count(t-1,e)}function te(e){var t=Date.UTC(e.getUTCFullYear(),0,1);return p.b.count(t-1,e)}function ne(e){return G.setTime(Date.UTC(e,0,1)),G.getUTCDay()}function re(e,t,n,r,i,a,o){if(0<=e&&e<100){var s=new Date(Date.UTC(-1,t,n,r,i,a,o));return s.setUTCFullYear(n.y),s}return new Date(Date.UTC(e,t,n,r,i,a,o))}function ie(e,t,n,r,i){var a=t||1,o=Object(l.W)(e),s=function(e,t,i){return function(e,t,n,r){var i=n<=1?e:r?function(t,i){return r+n*Math.floor((e(t,i)-r)/n)}:function(t,r){return n*Math.floor(e(t,r)/n)};return t?function(e,n){return t(i(e,n),n)}:i}(n[i=i||e],r[i],e===o&&a,t)},u=new Date,c=Object(l.Fa)(e),f=c[O]?s(O):Object(l.m)(2012),d=c[T]?s(T):c[D]?s(D):l.Ma,h=c[j]&&c[F]?s(F,1,j+F):c[j]?s(j,1):c[F]?s(F,1):c[M]?s(M,1):c[I]?s(I,1):l.Q,p=c[N]?s(N):l.Ma,m=c[R]?s(R):l.Ma,v=c[P]?s(P):l.Ma,g=c[B]?s(B):l.Ma;return function(e){u.setTime(+e);var t=f(u);return i(t,d(u),h(u,t),p(u),m(u),v(u),g(u))}}function ae(e,t,n){return t+7*e-(n+6)%7}var oe=(y(i={},O,(function(e){return e.getFullYear()})),y(i,D,(function(e){return Math.floor(e.getMonth()/3)})),y(i,T,(function(e){return e.getMonth()})),y(i,M,(function(e){return e.getDate()})),y(i,N,(function(e){return e.getHours()})),y(i,R,(function(e){return e.getMinutes()})),y(i,P,(function(e){return e.getSeconds()})),y(i,B,(function(e){return e.getMilliseconds()})),y(i,I,(function(e){return K(e)})),y(i,j,(function(e){return Y(e)})),y(i,j+F,(function(e,t){return ae(Y(e),e.getDay(),$(t))})),y(i,F,(function(e,t){return ae(1,e.getDay(),$(t))})),i),se=(y(a={},D,(function(e){return 3*e})),y(a,j,(function(e,t){return ae(e,0,$(t))})),a);function ue(e,t){return ie(e,t||1,oe,se,J)}var ce=(y(o={},O,(function(e){return e.getUTCFullYear()})),y(o,D,(function(e){return Math.floor(e.getUTCMonth()/3)})),y(o,T,(function(e){return e.getUTCMonth()})),y(o,M,(function(e){return e.getUTCDate()})),y(o,N,(function(e){return e.getUTCHours()})),y(o,R,(function(e){return e.getUTCMinutes()})),y(o,P,(function(e){return e.getUTCSeconds()})),y(o,B,(function(e){return e.getUTCMilliseconds()})),y(o,I,(function(e){return ee(e)})),y(o,j,(function(e){return te(e)})),y(o,F,(function(e,t){return ae(1,e.getUTCDay(),ne(t))})),y(o,j+F,(function(e,t){return ae(te(e),e.getUTCDay(),ne(t))})),o),le=(y(s={},D,(function(e){return 3*e})),y(s,j,(function(e,t){return ae(e,0,ne(t))})),s);function fe(e,t){return ie(e,t||1,ce,le,re)}var de=(y(u={},O,m.a),y(u,D,v.a.every(3)),y(u,T,v.a),y(u,j,d.b),y(u,M,f.a),y(u,F,f.a),y(u,I,f.a),y(u,N,g.a),y(u,R,b.a),y(u,P,x.a),y(u,B,w.a),u),he=(y(c={},O,_.a),y(c,D,k.a.every(3)),y(c,T,k.a),y(c,j,p.b),y(c,M,h.a),y(c,F,h.a),y(c,I,h.a),y(c,N,E.a),y(c,R,S.a),y(c,P,x.a),y(c,B,w.a),c);function pe(e){return de[e]}function me(e){return he[e]}function ve(e,t,n){return e?e.offset(t,n):void 0}function ge(e,t,n){return ve(pe(e),t,n)}function ye(e,t,n){return ve(me(e),t,n)}function be(e,t,n,r){return e?e.range(t,n,r):void 0}function xe(e,t,n,r){return be(pe(e),t,n,r)}function we(e,t,n,r){return be(me(e),t,n,r)}var _e=31536e6,ke=[O,T,M,N,R,P,B],Ee=ke.slice(0,-1),Se=Ee.slice(0,-1),Ce=Se.slice(0,-1),Ae=Ce.slice(0,-1),Oe=[O,T],De=[O],Te=[[Ee,1,1e3],[Ee,5,5e3],[Ee,15,15e3],[Ee,30,3e4],[Se,1,6e4],[Se,5,3e5],[Se,15,9e5],[Se,30,18e5],[Ce,1,36e5],[Ce,3,108e5],[Ce,6,216e5],[Ce,12,432e5],[Ae,1,864e5],[[O,j],1,6048e5],[Oe,1,2592e6],[Oe,3,7776e6],[De,1,_e]];function je(e){var t,n,r=e.extent,i=e.maxbins||40,a=Math.abs(Object(l.Z)(r))/i,o=Object(C.a)((function(e){return e[2]})).right(Te,a);return o===Te.length?(t=De,n=Object(A.c)(r[0]/_e,r[1]/_e,i)):o?(t=(o=Te[a/Te[o-1][2]<Te[o][2]/a?o-1:o])[0],n=o[1]):(t=ke,n=Math.max(Object(A.c)(r[0],r[1],i),1)),{units:t,step:n}}},function(e,t,n){"use strict";n.d(t,"e",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return o})),n.d(t,"f",(function(){return s})),n.d(t,"d",(function(){return u})),n.d(t,"g",(function(){return c}));var r=1e3,i=60*r,a=60*i,o=24*a,s=7*o,u=30*o,c=365*o},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,n){var r=n(13);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t,n){e.exports=n(280)},function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){var r=n(129)("wks"),i=n(84),a=n(16).Symbol,o="function"==typeof a;(e.exports=function(e){return r[e]||(r[e]=o&&a[e]||(o?a:i)("Symbol."+e))}).store=r},function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"GraphModel",(function(){return ke})),n.d(t,"loadGraphModel",(function(){return Ee})),n.d(t,"deregisterOp",(function(){return d})),n.d(t,"registerOp",(function(){return l})),n.d(t,"version_converter",(function(){return Se}));var r,i,a=n(0),o=function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function s(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))}function u(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}!function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF"}(r||(r={})),function(e){!function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))}(i||(i={}));var c={};function l(e,t){var n={tfOpName:e,category:"custom",inputs:[],attrs:[],customExecutor:t};c[e]=n}function f(e){return c[e]}function d(e){delete c[e]}function h(e,t,n,r){var i=t.inputParams[e];if(i&&void 0!==i.inputIndexStart){var a=i.inputIndexStart,o=0===i.inputIndexEnd?void 0:void 0===i.inputIndexEnd?a+1:i.inputIndexEnd;if("tensor"===i.type)return p(t.inputNames[i.inputIndexStart],n,r);if("tensors"===i.type)return t.inputNames.slice(a,o).map((function(e){return p(e,n,r)}));var s=Array.prototype.slice.call(p(t.inputNames.slice(a)[0],n,r).dataSync());return"number"===i.type?s[0]:s}var u=t.attrParams[e];return u&&u.value}function p(e,t,n){var r=g(e),i=r[0],a=r[1],o=n.currentContextIds.find((function(e){return!!t[v(i,e)]}));return void 0!==o?t[v(i,o)][a]:void 0}function m(e,t){var n=g(e),r=n[0],i=n[1];return[v(r,t&&t.currentContextId),i]}function v(e,t){return t?e+"-"+t:e}function g(e){var t=e.lastIndexOf(":");return-1===t?[e,0]:[e.substring(0,t),Number(e.substring(t+1))]}function y(e,t){for(var n=[],r=0;r<e.length;r+=t)n.push(e.slice(r,r+t));return n}var b=Object.freeze({json:[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),x=Object.freeze({json:[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"clip_value_min",name:"clipValueMin",type:"number"},{tfName:"clip_value_max",name:"clipValueMax",type:"number"}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"clipValueMin",name:"clipValueMin",type:"number",defaultValue:0},{tfName:"clipValueMax",name:"clipValueMax",type:"number",defaultValue:6}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),w=Object.freeze({json:[{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"}]}]}),_=Object.freeze({json:[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]}]}),k=Object.freeze({json:[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}]}),E=Object.freeze({json:[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),S=Object.freeze({json:[{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]}]}),C=Object.freeze({json:[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}]}),A=Object.freeze({json:[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]}]}),O=Object.freeze({json:[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),D=Object.freeze({json:[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),T=Object.freeze({json:[{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}]}),j=Object.freeze({json:[{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]}]}),M=Object.freeze({json:[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool",notSupported:!0}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}]}),F=Object.freeze({json:[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}]}),I=Object.freeze({json:[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]}]}),N=function(){function e(){var e=[b,x,w,_,k,E,S,O,A,C,D,T,j,M,F,I],t=[].concat.apply([],e.map((function(e){return e.json})));this.opMappers=t.reduce((function(e,t){return e[t.tfOpName]=t,e}),{})}return Object.defineProperty(e,"Instance",{get:function(){return this._instance||(this._instance=new this)},enumerable:!0,configurable:!0}),e.prototype.transformGraph=function(e,t){var n=this;void 0===t&&(t={});var r=[],i=[],a=e.node.reduce((function(e,t){return e[t.name]=n.mapNode(t),t.op.startsWith("Placeholder")&&r.push(e[t.name]),"Const"===t.op&&i.push(e[t.name]),e}),{}),o=[],s=[],u={},c={};null!=t&&(u=this.mapSignatureEntries(t.inputs),c=this.mapSignatureEntries(t.outputs));var l=Object.keys(a);return l.forEach((function(e){var t=a[e];t.inputNames.forEach((function(e){var n=m(e)[0];t.inputs.push(a[n]),a[n].children.push(t)}))})),0===Object.keys(c).length?l.forEach((function(e){var t=a[e];0===t.children.length&&s.push(t)})):Object.keys(c).forEach((function(e){var t=m(e)[0],n=a[t];null!=n&&(n.signatureKey=c[e],s.push(n))})),Object.keys(u).length>0?Object.keys(u).forEach((function(e){var t=m(e)[0],n=a[t];n&&(n.signatureKey=u[e],o.push(n))})):o=r,{nodes:a,inputs:o,outputs:s,weights:i,placeholders:r,signature:t}},e.prototype.mapSignatureEntries=function(e){return Object.keys(e||{}).reduce((function(t,n){return t[e[n].name]=n,t}),{})},e.prototype.mapNode=function(e){var t=f(e.op)||this.opMappers[e.op]||{};null==e.attr&&(e.attr={});var n={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map((function(e){return e.startsWith("^")?e.substr(1):e})),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr};return null!=t.inputs&&(n.inputParams=t.inputs.reduce((function(e,t){return e[t.name]={type:t.type,inputIndexStart:t.start,inputIndexEnd:t.end},e}),{})),null!=t.attrs&&(n.attrParams=t.attrs.reduce((function(t,n){var r=n.type,i=void 0;switch(n.type){case"string":void 0===(i=P(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(i=P(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"string[]":void 0===(i=H(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(i=H(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number":void 0===(i=L(e.attr,n.tfName,n.defaultValue||0))&&n.tfDeprecatedName&&(i=L(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number[]":void 0===(i=q(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(i=q(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool":void 0===(i=B(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(i=B(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool[]":void 0===(i=K(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(i=K(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape":void 0===(i=G(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(i=G(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape[]":void 0===(i=X(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(i=X(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype":void 0===(i=U(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(i=U(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype[]":void 0===(i=W(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(i=W(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: "+n.type+" for op: "+e.op)}return t[n.name]={value:i,type:r},t}),{})),n},e}();function R(t,n){var r=Array.isArray(t)?String.fromCharCode.apply(null,t):function(t){var n=Object(a.env)().global;if(void 0!==n.atob)return n.atob(t);if(void 0!==e)return new e(t,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}(t);return n?r:r.toLowerCase()}function P(e,t,n,r){void 0===r&&(r=!1);var i=e[t];return null!=i?R(i.s,r):n}function B(e,t,n){var r=e[t];return r?r.b:n}function L(e,t,n){var r=e[t]||{},i=null!=r.i?r.i:null!=r.f?r.f:n;return"number"==typeof i?i:parseInt(i,10)}function z(e){switch("string"==typeof e&&(e=r[e]),e){case r.DT_FLOAT:return"float32";case r.DT_INT32:case r.DT_INT64:case r.DT_INT8:case r.DT_UINT8:return"int32";case r.DT_BOOL:return"bool";case r.DT_DOUBLE:return"float32";case r.DT_STRING:return"string";default:return null}}function U(e,t,n){var r=e[t];return r&&r.type?z(r.type):n}function W(e,t,n){var r=e[t];return r&&r.list&&r.list.type?r.list.type.map((function(e){return z(e)})):n}function V(e){if(!e.unknownRank)return null!=e.dim?e.dim.map((function(e){return"number"==typeof e.size?e.size:parseInt(e.size,10)})):[]}function G(e,t,n){var r=e[t];return r&&r.shape?V(r.shape):n}function q(e,t,n){var r=e[t];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map((function(e){return"number"==typeof e?e:parseInt(e,10)})):n}function H(e,t,n,r){void 0===r&&(r=!1);var i=e[t];return i&&i.list&&i.list.s?i.list.s.map((function(e){return R(e,r)})):n}function X(e,t,n){var r=e[t];return r&&r.list&&r.list.shape?r.list.shape.map((function(e){return V(e)})):n}function K(e,t,n){var r=e[t];return r&&r.list&&r.list.b?r.list.b:n}var Y=function(){function e(e,t,n){var r=this;this.node=e,this.tensorMap=t,this.context=n,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map((function(e){return r.getInput(e)})),null!=e.rawAttrs&&(this.attrs=Object.keys(e.rawAttrs).reduce((function(e,t){return e[t]=r.getAttr(t),e}),{}))}return e.prototype.getInput=function(e){return p(e,this.tensorMap,this.context)},e.prototype.getAttr=function(e,t){var n=this.node.rawAttrs[e];if(null!=n.tensor)return p(e,this.tensorMap,this.context);if(null!=n.i||null!=n.f)return L(this.node.rawAttrs,e,t);if(null!=n.s)return P(this.node.rawAttrs,e,t);if(null!=n.b)return B(this.node.rawAttrs,e,t);if(null!=n.shape)return G(this.node.rawAttrs,e,t);if(null!=n.type)return U(this.node.rawAttrs,e,t);if(null!=n.list){if(null!=n.list.i||null!=n.list.f)return q(this.node.rawAttrs,e,t);if(null!=n.list.s)return H(this.node.rawAttrs,e,t);if(null!=n.list.shape)return X(this.node.rawAttrs,e,t);if(null!=n.list.b)return K(this.node.rawAttrs,e,t);if(null!=n.list.type)return W(this.node.rawAttrs,e,t)}return t},e}(),$=function(e,t,n){switch(e.op){case"BiasAdd":case"AddV2":case"Add":return[Object(a.add)(h("a",e,t,n),h("b",e,t,n))];case"AddN":return[Object(a.addN)(h("tensors",e,t,n))];case"FloorMod":case"Mod":return[Object(a.mod)(h("a",e,t,n),h("b",e,t,n))];case"Mul":return[Object(a.mul)(h("a",e,t,n),h("b",e,t,n))];case"RealDiv":case"Div":return[Object(a.div)(h("a",e,t,n),h("b",e,t,n))];case"DivNoNan":return[Object(a.divNoNan)(h("a",e,t,n),h("b",e,t,n))];case"FloorDiv":return[Object(a.floorDiv)(h("a",e,t,n),h("b",e,t,n))];case"Sub":return[Object(a.sub)(h("a",e,t,n),h("b",e,t,n))];case"Minimum":return[Object(a.minimum)(h("a",e,t,n),h("b",e,t,n))];case"Maximum":return[Object(a.maximum)(h("a",e,t,n),h("b",e,t,n))];case"Pow":return[Object(a.pow)(h("a",e,t,n),h("b",e,t,n))];case"SquaredDifference":return[Object(a.squaredDifference)(h("a",e,t,n),h("b",e,t,n))];default:throw TypeError("Node type "+e.op+" is not implemented")}},J=function(e,t,n){switch(e.op){case"Abs":case"ComplexAbs":return[Object(a.abs)(h("x",e,t,n))];case"Acos":return[Object(a.acos)(h("x",e,t,n))];case"Acosh":return[Object(a.acosh)(h("x",e,t,n))];case"Asin":return[Object(a.asin)(h("x",e,t,n))];case"Asinh":return[Object(a.asinh)(h("x",e,t,n))];case"Atan":return[Object(a.atan)(h("x",e,t,n))];case"Atan2":return[Object(a.atan2)(h("x",e,t,n),h("y",e,t,n))];case"Atanh":return[Object(a.atanh)(h("x",e,t,n))];case"Ceil":return[Object(a.ceil)(h("x",e,t,n))];case"Complex":return[Object(a.complex)(h("real",e,t,n),h("imag",e,t,n))];case"Cos":return[Object(a.cos)(h("x",e,t,n))];case"Cosh":return[Object(a.cosh)(h("x",e,t,n))];case"Elu":return[Object(a.elu)(h("x",e,t,n))];case"Erf":return[Object(a.erf)(h("x",e,t,n))];case"Exp":return[Object(a.exp)(h("x",e,t,n))];case"Expm1":return[Object(a.expm1)(h("x",e,t,n))];case"Floor":return[Object(a.floor)(h("x",e,t,n))];case"Log":return[Object(a.log)(h("x",e,t,n))];case"Log1p":return[Object(a.log1p)(h("x",e,t,n))];case"Imag":return[Object(a.imag)(h("x",e,t,n))];case"Neg":return[Object(a.neg)(h("x",e,t,n))];case"Reciprocal":return[Object(a.reciprocal)(h("x",e,t,n))];case"Real":return[Object(a.real)(h("x",e,t,n))];case"Relu":return[Object(a.relu)(h("x",e,t,n))];case"Round":return[Object(a.round)(h("x",e,t,n))];case"Selu":return[Object(a.selu)(h("x",e,t,n))];case"Sigmoid":return[Object(a.sigmoid)(h("x",e,t,n))];case"Sin":return[Object(a.sin)(h("x",e,t,n))];case"Sign":return[Object(a.sign)(h("x",e,t,n))];case"Sinh":return[Object(a.sinh)(h("x",e,t,n))];case"Softplus":return[Object(a.softplus)(h("x",e,t,n))];case"Sqrt":return[Object(a.sqrt)(h("x",e,t,n))];case"Square":return[Object(a.square)(h("x",e,t,n))];case"Tanh":return[Object(a.tanh)(h("x",e,t,n))];case"Tan":return[Object(a.tan)(h("x",e,t,n))];case"Relu6":case"ClipByValue":return[Object(a.clipByValue)(h("x",e,t,n),h("clipValueMin",e,t,n),h("clipValueMax",e,t,n))];case"Rsqrt":return[Object(a.rsqrt)(p(e.inputNames[0],t,n))];case"Prod":return[Object(a.prod)(h("x",e,t,n),h("axes",e,t,n))];case"LeakyRelu":return[Object(a.leakyRelu)(h("x",e,t,n),h("alpha",e,t,n))];case"Prelu":return[Object(a.prelu)(h("x",e,t,n),h("alpha",e,t,n))];default:throw TypeError("Node type "+e.op+" is not implemented")}},Z=function(){function e(t,n,r,i,a,o,s){this.name=t,this.dtype=n,this.maxSize=r,this.elementShape=i,this.identicalElementShapes=a,this.dynamicSize=o,this.clearAfterRead=s,this.tensors=[],this.closed_=!1,this.id=e.nextId++}return Object.defineProperty(e.prototype,"closed",{get:function(){return this.closed_},enumerable:!0,configurable:!0}),e.prototype.clearAndClose=function(){this.tensors.forEach((function(e){return e.tensor.dispose()})),this.tensors=[],this.closed_=!0},e.prototype.size=function(){return this.tensors.length},e.prototype.read=function(e){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(e<0||e>=this.tensors.length)throw new Error("Tried to read from index "+e+", but array size is: "+this.tensors.length);var t=this.tensors[e];if(t.cleared)throw new Error("TensorArray "+this.name+": Could not read index "+e+" twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).");return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor},e.prototype.readMany=function(e){var t=this;return e.map((function(e){return t.read(e)}))},e.prototype.write=function(e,t){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error("Tried to write to index "+e+", but array is not resizeable and size is: "+this.maxSize);var n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+e+",\n          because the value dtype is "+t.dtype+", but TensorArray dtype is "+this.dtype+".");if(0!==this.size()||null!=this.elementShape&&0!==this.elementShape.length||(this.elementShape=t.shape),this.assertShapesMatchAllowUndefinedSize(this.elementShape,t.shape,"TensorArray "+this.name+": Could not write to TensorArray index "+e+"."),n&&n.read)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+e+", because it has already been read.");if(n&&n.written)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+e+", because it has already been written.");n.tensor=t,n.written=!0,this.tensors[e]=n},e.prototype.writeMany=function(e,t){var n=this;if(e.length!==t.length)throw new Error("TensorArray "+this.name+": could not write multiple tensors,because the index size: "+e.length+" is not the same as tensors size: "+t.length+".");e.forEach((function(e,r){return n.write(e,t[r])}))},e.prototype.gather=function(e,t){if(t&&t!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but gather requested dtype "+t);if(!e){e=[];for(var n=0;n<this.size();n++)e.push(n)}if(0===e.length)return Object(a.tensor)([],[0].concat(this.elementShape));var r=this.readMany(e);return this.assertShapesMatchAllowUndefinedSize(this.elementShape,r[0].shape,"TensorArray shape mismatch: "),Object(a.stack)(r,0)},e.prototype.concat=function(e){if(e&&e!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but concat requested dtype "+e);if(0===this.size())return Object(a.tensor)([],[0].concat(this.elementShape));for(var t=[],n=0;n<this.size();n++)t.push(n);var r=this.readMany(t);return this.assertShapesMatchAllowUndefinedSize(this.elementShape,r[0].shape,"TensorArray shape mismatch: tensor array shape ("+this.elementShape+") vs first tensor shape ("+r[0].shape+")"),Object(a.concat)(r,0)},e.prototype.scatter=function(e,t){if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+t.dtype);if(e.length!==t.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: "+e.length+" vs. "+t.shape[0]);var n=Math.max.apply(Math,e);if(!this.dynamicSize&&n>=this.maxSize)throw new Error("Max index must be < array size ("+n+"  vs. "+this.maxSize+")");this.writeMany(e,Object(a.unstack)(t,0))},e.prototype.split=function(e,t){var n=this;if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+t.dtype);var r=0,i=e.map((function(e){return r+=e}));if(r!==t.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        "+r+", and tensor's shape is: "+t.shape);if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths ("+this.maxSize+" vs. "+e.length+"), and the TensorArray is not marked as dynamically resizeable");var o=0===r?0:t.size/r,s=[];Object(a.tidy)((function(){t=t.reshape([1,r,o]);for(var u=0;u<e.length;++u){var c=[0,0===u?0:i[u-1],0],l=[1,e[u],o];s[u]=Object(a.slice)(t,c,l).reshape(n.elementShape)}return s}));for(var u=[],c=0;c<e.length;c++)u[c]=c;this.writeMany(u,s)},e.prototype.assertShapesMatchAllowUndefinedSize=function(e,t,n){void 0===n&&(n=""),a.util.assert(this.shapesEqualAllowUndefinedSize(e,t),(function(){return n+" Shapes "+e+" and "+t+" must match"}))},e.prototype.shapesEqualAllowUndefinedSize=function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(-1!==e[n]&&-1!==t[n]&&e[n]!==t[n])return!1;return!0},e.nextId=0,e}(),Q=function(e,t,n){return s(void 0,void 0,void 0,(function(){var r,i,o,s,c,l,f,d,m,v,g,y,b,x,w,_,k,E,S,C,A,O,D,T,j,M,F,I,N,R,P,B,L,z,U;return u(this,(function(u){switch(u.label){case 0:switch(e.op){case"LoopCond":return[3,1];case"Switch":return[3,2];case"Merge":return[3,4];case"Enter":return[3,5];case"Exit":return[3,6];case"NextIteration":return[3,7];case"TensorArrayV3":return[3,8];case"TensorArrayWriteV3":return[3,9];case"TensorArrayReadV3":return[3,10];case"TensorArrayGatherV3":return[3,11];case"TensorArrayScatterV3":return[3,12];case"TensorArrayConcatV3":return[3,13];case"TensorArraySplitV3":return[3,14];case"TensorArraySizeV3":return[3,15];case"TensorArrayCloseV3":return[3,16]}return[3,17];case 1:return[2,[h("pred",e,t,n).clone()]];case 2:return r=h("pred",e,t,n),i=h("data",e,t,n),[4,r.data()];case 3:return[2,u.sent()[0]?[void 0,i.clone()]:[i.clone(),void 0]];case 4:return[2,(o=e.inputNames.find((function(e){return void 0!==p(e,t,n)})))?[p(o,t,n).clone()]:void 0];case 5:return s=h("frameName",e,t,n),c=h("tensor",e,t,n),n.enterFrame(s),[2,[c.clone()]];case 6:return l=h("tensor",e,t,n),n.exitFrame(),[2,[l.clone()]];case 7:return f=h("tensor",e,t,n),n.nextIteration(),[2,[f.clone()]];case 8:return d=h("size",e,t,n),m=h("dtype",e,t,n),v=h("elementShape",e,t,n),g=h("dynamicSize",e,t,n),y=h("clearAfterRead",e,t,n),b=h("identicalElementShapes",e,t,n),x=h("name",e,t,n),w=new Z(x,m,d,v,b,g,y),n.addTensorArray(w),[2,[Object(a.scalar)(w.id),Object(a.scalar)(1)]];case 9:return _=h("tensorArrayId",e,t,n),k=h("index",e,t,n),E=h("tensor",e,t,n),n.getTensorArray(_).write(k,E),[2,[Object(a.scalar)(1)]];case 10:return S=h("tensorArrayId",e,t,n),C=h("index",e,t,n),[2,[n.getTensorArray(S).read(C)]];case 11:return A=h("tensorArrayId",e,t,n),O=h("indices",e,t,n),D=h("dtype",e,t,n),[2,[n.getTensorArray(A).gather(O,D)]];case 12:return T=h("tensorArrayId",e,t,n),j=h("indices",e,t,n),M=h("tensor",e,t,n),n.getTensorArray(T).scatter(j,M),[2,[Object(a.scalar)(1)]];case 13:return F=h("tensorArrayId",e,t,n),I=n.getTensorArray(F),N=h("dtype",e,t,n),[2,[I.concat(N)]];case 14:return R=h("tensorArrayId",e,t,n),P=h("tensor",e,t,n),B=h("lengths",e,t,n),n.getTensorArray(R).split(B,P),[2,[Object(a.scalar)(1)]];case 15:return L=h("tensorArrayId",e,t,n),z=n.getTensorArray(L),[2,[Object(a.scalar)(z.size(),"int32")]];case 16:return U=h("tensorArrayId",e,t,n),n.getTensorArray(U).clearAndClose(),[2,[Object(a.scalar)(0)]];case 17:throw TypeError("Node type "+e.op+" is not implemented")}}))}))},ee=function(e,t,n){switch(e.op){case"Conv1D":var r=h("stride",e,t,n),i=h("pad",e,t,n),o=h("dataFormat",e,t,n).toUpperCase(),s=h("dilation",e,t,n);return[Object(a.conv1d)(h("x",e,t,n),h("filter",e,t,n),r,i,o,s)];case"Conv2D":r=h("strides",e,t,n),i=h("pad",e,t,n),o=h("dataFormat",e,t,n).toUpperCase();var u=h("dilations",e,t,n);return[Object(a.conv2d)(h("x",e,t,n),h("filter",e,t,n),[r[1],r[2]],i,o,[u[1],u[2]])];case"_FusedConv2D":case"FusedDepthwiseConv2dNative":var c=h("fusedOps",e,t,n),l=c[0],f=c[1],d="biasadd"===l,p="prelu"===f,m="fusedbatchnorm"===l,v=h("numArgs",e,t,n);if(d){if(p&&2!==v)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!p&&1!==v)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(m)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported.");r=h("strides",e,t,n),i=h("pad",e,t,n),o=h("dataFormat",e,t,n).toUpperCase(),u=h("dilations",e,t,n);var g=h("args",e,t,n),y=g[0],b=g[1];return[("_FusedConv2D"===e.op?a.fused.conv2d:a.fused.depthwiseConv2d)({x:h("x",e,t,n),filter:h("filter",e,t,n),strides:[r[1],r[2]],pad:i,dataFormat:o,dilations:[u[1],u[2]],bias:y,activation:f,preluActivationWeights:b})];case"Conv2DBackpropInput":case"Conv2dTranspose":var x=h("outputShape",e,t,n);return r=h("strides",e,t,n),i=h("pad",e,t,n),[Object(a.conv2dTranspose)(h("x",e,t,n),h("filter",e,t,n),x,[r[1],r[2]],i)];case"DepthwiseConv2dNative":case"DepthwiseConv2d":return r=h("strides",e,t,n),i=h("pad",e,t,n),u=h("dilations",e,t,n),o=h("dataFormat",e,t,n).toUpperCase(),[Object(a.depthwiseConv2d)(h("input",e,t,n),h("filter",e,t,n),[r[1],r[2]],i,o,[u[1],u[2]])];case"Conv3D":return r=h("strides",e,t,n),i=h("pad",e,t,n),o=h("dataFormat",e,t,n).toUpperCase(),u=h("dilations",e,t,n),[Object(a.conv3d)(h("x",e,t,n),h("filter",e,t,n),[r[1],r[2],r[3]],i,o,[u[1],u[2],u[3]])];case"AvgPool":r=h("strides",e,t,n),i=h("pad",e,t,n);var w=h("kernelSize",e,t,n);return[Object(a.avgPool)(h("x",e,t,n),[w[1],w[2]],[r[1],r[2]],i)];case"MaxPool":return r=h("strides",e,t,n),i=h("pad",e,t,n),w=h("kernelSize",e,t,n),[Object(a.maxPool)(h("x",e,t,n),[w[1],w[2]],[r[1],r[2]],i)];case"MaxPoolWithArgmax":r=h("strides",e,t,n),i=h("pad",e,t,n),w=h("kernelSize",e,t,n);var _=h("includeBatchInIndex",e,t,n),k=Object(a.maxPoolWithArgmax)(h("x",e,t,n),[w[1],w[2]],[r[1],r[2]],i,_);return[k.result,k.indexes];case"AvgPool3D":return r=h("strides",e,t,n),i=h("pad",e,t,n),w=h("kernelSize",e,t,n),[Object(a.avgPool3d)(h("x",e,t,n),[w[1],w[2],w[3]],[r[1],r[2],r[3]],i)];case"MaxPool3D":return r=h("strides",e,t,n),i=h("pad",e,t,n),w=h("kernelSize",e,t,n),[Object(a.maxPool3d)(h("x",e,t,n),[w[1],w[2],w[3]],[r[1],r[2],r[3]],i)];default:throw TypeError("Node type "+e.op+" is not implemented")}},te=function(e,t,n){switch(e.op){case"Fill":var r=h("shape",e,t,n),i=h("dtype",e,t,n),o=h("value",e,t,n);return[Object(a.fill)(r,o,i)];case"LinSpace":var s=h("start",e,t,n),u=h("stop",e,t,n),c=h("num",e,t,n);return[Object(a.linspace)(s,u,c)];case"Multinomial":var l=h("logits",e,t,n),f=h("numSamples",e,t,n),d=h("seed",e,t,n);return[Object(a.multinomial)(l,f,d)];case"OneHot":var p=h("indices",e,t,n),m=h("depth",e,t,n),v=h("onValue",e,t,n),g=h("offValue",e,t,n);return[Object(a.oneHot)(p,m,v,g)];case"Ones":return[Object(a.ones)(h("shape",e,t,n),h("dtype",e,t,n))];case"OnesLike":return[Object(a.onesLike)(h("x",e,t,n))];case"RandomUniform":return[Object(a.randomUniform)(h("shape",e,t,n),h("minval",e,t,n),h("maxval",e,t,n),h("dtype",e,t,n))];case"Range":s=h("start",e,t,n);var y=h("stop",e,t,n),b=h("step",e,t,n);return[Object(a.range)(s,y,b,h("dtype",e,t,n))];case"TruncatedNormal":r=h("shape",e,t,n);var x=h("mean",e,t,n),w=h("stdDev",e,t,n);return d=h("seed",e,t,n),[Object(a.truncatedNormal)(r,x,w,h("dtype",e,t,n),d)];case"Zeros":return[Object(a.zeros)(h("shape",e,t,n),h("dtype",e,t,n))];case"ZerosLike":return[Object(a.zerosLike)(h("x",e,t,n))];default:throw TypeError("Node type "+e.op+" is not implemented")}},ne=function(e,t,n){return s(void 0,void 0,void 0,(function(){var r,i,o,s,c,l,f,d;return u(this,(function(u){switch(u.label){case 0:switch(e.op){case"NonMaxSuppressionV5":case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":return[3,1];case"Where":return[3,5];case"ListDiff":return[3,7]}return[3,8];case 1:return r=h("boxes",e,t,n),i=h("scores",e,t,n),o=h("maxOutputSize",e,t,n),s=h("iouThreshold",e,t,n),c=h("scoreThreshold",e,t,n),"NonMaxSuppressionV5"!==e.op?[3,3]:(l=h("softNmsSigma",e,t,n),[4,a.image.nonMaxSuppressionWithScoreAsync(r,i,o,s,c,l)]);case 2:return[2,[(d=u.sent()).selectedIndices,d.selectedScores]];case 3:return[4,a.image.nonMaxSuppressionAsync(r,i,o,s,c)];case 4:return[2,[u.sent()]];case 5:return f=h("condition",e,t,n).asType("bool"),[4,Object(a.whereAsync)(f)];case 6:return d=[u.sent()],f.dispose(),[2,d];case 7:return[2,Object(a.setdiff1dAsync)(h("x",e,t,n),h("y",e,t,n))];case 8:throw TypeError("Node type "+e.op+" is not implemented")}}))}))},re=function(e,t,n){if("TopKV2"===e.op){var r=h("x",e,t,n),i=h("k",e,t,n),o=h("sorted",e,t,n),s=Object(a.topk)(r,i,o);return[s.values,s.indices]}throw TypeError("Node type "+e.op+" is not implemented")},ie=function(e,t,n){switch(e.op){case"Const":return t[e.name];case"PlaceholderWithDefault":var r=h("default",e,t,n);return[p(e.name,t,n)||r];case"Placeholder":return[p(e.name,t,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":case"Snapshot":return[h("x",e,t,n).clone()];case"IdentityN":return h("x",e,t,n).map((function(e){return e.clone()}));case"Shape":return[Object(a.tensor1d)(h("x",e,t,n).shape,"int32")];case"ShapeN":return h("x",e,t,n).map((function(e){return Object(a.tensor1d)(e.shape)}));case"Size":return[Object(a.scalar)(h("x",e,t,n).size,"int32")];case"Rank":return[Object(a.scalar)(h("x",e,t,n).rank,"int32")];case"NoOp":return[Object(a.scalar)(1)];case"Print":var i=h("x",e,t,n),o=h("data",e,t,n),s=h("message",e,t,n),u=h("summarize",e,t,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(s);for(var c=0;c<o.length;c++)console.log(Array.prototype.slice.call(o[c].dataSync()).slice(0,u));return[i];default:throw TypeError("Node type "+e.op+" is not implemented")}},ae=function(e,t,n){switch(e.op){case"ResizeBilinear":var r=h("images",e,t,n),i=h("size",e,t,n),o=h("alignCorners",e,t,n);return[a.image.resizeBilinear(r,[i[0],i[1]],o)];case"ResizeNearestNeighbor":return r=h("images",e,t,n),i=h("size",e,t,n),o=h("alignCorners",e,t,n),[a.image.resizeNearestNeighbor(r,[i[0],i[1]],o)];case"CropAndResize":var s=h("image",e,t,n),u=h("boxes",e,t,n),c=h("boxInd",e,t,n),l=h("cropSize",e,t,n),f=h("method",e,t,n),d=h("extrapolationValue",e,t,n);return[a.image.cropAndResize(s,u,c,l,f,d)];default:throw TypeError("Node type "+e.op+" is not implemented")}},oe=function(e,t,n){switch(e.op){case"Equal":return[Object(a.equal)(h("a",e,t,n),h("b",e,t,n))];case"NotEqual":return[Object(a.notEqual)(h("a",e,t,n),h("b",e,t,n))];case"Greater":return[Object(a.greater)(h("a",e,t,n),h("b",e,t,n))];case"GreaterEqual":return[Object(a.greaterEqual)(h("a",e,t,n),h("b",e,t,n))];case"Less":return[Object(a.less)(h("a",e,t,n),h("b",e,t,n))];case"LessEqual":return[Object(a.lessEqual)(h("a",e,t,n),h("b",e,t,n))];case"LogicalAnd":return[Object(a.logicalAnd)(h("a",e,t,n),h("b",e,t,n))];case"LogicalNot":return[Object(a.logicalNot)(h("a",e,t,n))];case"LogicalOr":return[Object(a.logicalOr)(h("a",e,t,n),h("b",e,t,n))];case"Select":case"SelectV2":return[Object(a.where)(h("condition",e,t,n),h("a",e,t,n),h("b",e,t,n))];default:throw TypeError("Node type "+e.op+" is not implemented")}},se=function(e,t,n){switch(e.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[Object(a.matMul)(h("a",e,t,n),h("b",e,t,n),h("transposeA",e,t,n),h("transposeB",e,t,n))];case"Transpose":return[Object(a.transpose)(h("x",e,t,n),h("perm",e,t,n))];case"_FusedMatMul":var r=h("fusedOps",e,t,n),i=r[0],o=r[1],s="biasadd"===i,u="prelu"===o,c=h("numArgs",e,t,n);if(s){if(u&&2!==c)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!u&&1!==c)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}var l=h("args",e,t,n),f=l[0],d=l[1];return[a.fused.matMul({a:h("a",e,t,n),b:h("b",e,t,n),transposeA:h("transposeA",e,t,n),transposeB:h("transposeB",e,t,n),bias:f,activation:o,preluActivationWeights:d})];default:throw TypeError("Node type "+e.op+" is not implemented")}},ue=function(e,t,n){switch(e.op){case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[Object(a.batchNorm)(h("x",e,t,n),h("mean",e,t,n),h("variance",e,t,n),h("offset",e,t,n),h("scale",e,t,n),h("epsilon",e,t,n))];case"LRN":return[Object(a.localResponseNormalization)(h("x",e,t,n),h("radius",e,t,n),h("bias",e,t,n),h("alpha",e,t,n),h("beta",e,t,n))];case"Softmax":return[Object(a.softmax)(h("x",e,t,n))];case"LogSoftmax":return[Object(a.logSoftmax)(h("x",e,t,n))];case"SparseToDense":return[Object(a.sparseToDense)(h("sparseIndices",e,t,n),h("outputShape",e,t,n),h("sparseValues",e,t,n),h("defaultValue",e,t,n))];default:throw TypeError("Node type "+e.op+" is not implemented")}},ce=function(e,t,n){switch(e.op){case"Max":var r=h("axis",e,t,n),i=h("keepDims",e,t,n);return[Object(a.max)(h("x",e,t,n),r,i)];case"Mean":return r=h("axis",e,t,n),i=h("keepDims",e,t,n),[Object(a.mean)(h("x",e,t,n),r,i)];case"Min":return r=h("axis",e,t,n),i=h("keepDims",e,t,n),[Object(a.min)(h("x",e,t,n),r,i)];case"Sum":return r=h("axis",e,t,n),i=h("keepDims",e,t,n),[Object(a.sum)(h("x",e,t,n),r,i)];case"All":return r=h("axis",e,t,n),i=h("keepDims",e,t,n),[Object(a.all)(h("x",e,t,n),r,i)];case"Any":return r=h("axis",e,t,n),i=h("keepDims",e,t,n),[Object(a.any)(h("x",e,t,n),r,i)];case"ArgMax":return r=h("axis",e,t,n),[Object(a.argMax)(h("x",e,t,n),r)];case"ArgMin":return r=h("axis",e,t,n),[Object(a.argMin)(h("x",e,t,n),r)];case"Prod":return r=h("axis",e,t,n),i=h("keepDims",e,t,n),[Object(a.prod)(h("x",e,t,n),r,i)];default:throw TypeError("Node type "+e.op+" is not implemented")}},le=function(e,t,n){switch(e.op){case"ConcatV2":case"Concat":var r=h("n",e,t,n),i=h("axis",e,t,n),o=h("tensors",e,t,n);return o=o.slice(0,r),[Object(a.concat)(o,i)];case"GatherV2":case"Gather":i=h("axis",e,t,n);var s=h("x",e,t,n),u=h("indices",e,t,n);return[Object(a.gather)(s,u.asType("int32"),i)];case"ReverseV2":case"Reverse":return i=h("axis",e,t,n),s=h("x",e,t,n),[Object(a.reverse)(s,i)];case"Slice":var c=h("begin",e,t,n),l=h("size",e,t,n);return[Object(a.slice)(h("x",e,t,n),c,l)];case"StridedSlice":c=h("begin",e,t,n);var f=h("end",e,t,n),d=h("strides",e,t,n),p=h("beginMask",e,t,n),m=h("endMask",e,t,n),v=h("ellipsisMask",e,t,n),g=h("newAxisMask",e,t,n),y=h("shrinkAxisMask",e,t,n),b=h("x",e,t,n);if(1===c.length&&b.shape.length>1)for(var x=1;x<b.shape.length;x++)c.push(0),f.push(b.shape[x]),d.push(d[0]);return[Object(a.stridedSlice)(b,c,f,d,p,m,v,g,y)];case"Pack":return Object(a.tidy)((function(){var r=h("axis",e,t,n),i=h("tensors",e,t,n),o=i[0].shape,s=i[0].squeeze().shape,u=i.map((function(e){var t=a.util.arraysEqual(e.shape,o);if(!t&&!a.util.arraysEqual(e.squeeze().shape,s))throw new Error("the input tensors shape does not match");return t?e:e.reshape(o)}));return[Object(a.stack)(u,r)]}));case"Unpack":return Object(a.tidy)((function(){var r=h("axis",e,t,n),i=h("tensor",e,t,n);return Object(a.unstack)(i,r)}));case"Tile":var w=h("reps",e,t,n);return[Object(a.tile)(h("x",e,t,n),w)];case"Split":case"SplitV":i=h("axis",e,t,n);var _=h("numOrSizeSplits",e,t,n);return Object(a.split)(h("x",e,t,n),_,i);case"ScatterNd":u=h("indices",e,t,n);var k=h("values",e,t,n),E=h("shape",e,t,n);return[Object(a.scatterND)(u,k,E)];case"GatherNd":var S=h("x",e,t,n);return u=h("indices",e,t,n),[Object(a.gatherND)(S,u)];case"SparseToDense":u=h("sparseIndices",e,t,n),E=h("outputShape",e,t,n);var C=h("sparseValues",e,t,n),A=h("defaultValue",e,t,n);return[Object(a.sparseToDense)(u,C,E,C.dtype===A.dtype?A:A.asType(C.dtype))];default:throw TypeError("Node type "+e.op+" is not implemented")}},fe=function(e,t,n){switch(e.op){case"FFT":return[Object(a.fft)(h("x",e,t,n))];case"IFFT":return[Object(a.ifft)(h("x",e,t,n))];case"RFFT":return[Object(a.rfft)(h("x",e,t,n))];case"IRFFT":return[Object(a.irfft)(h("x",e,t,n))];default:throw TypeError("Node type "+e.op+" is not implemented")}},de=function(e,t,n){switch(e.op){case"Cast":return[Object(a.cast)(h("x",e,t,n),h("dtype",e,t,n))];case"ExpandDims":var r=h("axis",e,t,n);return[Object(a.expandDims)(h("x",e,t,n),r)];case"Squeeze":return r=h("axis",e,t,n),[Object(a.squeeze)(h("x",e,t,n),r)];case"Reshape":return[Object(a.reshape)(h("x",e,t,n),h("shape",e,t,n))];case"PadV2":case"Pad":return[Object(a.pad)(h("x",e,t,n),y(h("padding",e,t,n),2),h("constantValue",e,t,n))];case"SpaceToBatchND":var i=h("blockShape",e,t,n),o=y(h("paddings",e,t,n),2);return[Object(a.spaceToBatchND)(h("x",e,t,n),i,o)];case"BatchToSpaceND":i=h("blockShape",e,t,n);var s=y(h("crops",e,t,n),2);return[Object(a.batchToSpaceND)(h("x",e,t,n),i,s)];case"DepthToSpace":var u=h("blockSize",e,t,n),c=h("dataFormat",e,t,n).toUpperCase();return[Object(a.depthToSpace)(h("x",e,t,n),u,c)];default:throw TypeError("Node type "+e.op+" is not implemented")}};function he(e,t,n){var r=function(e,t,n){switch(e.category){case"arithmetic":return Object(a.tidy)((function(){return $(e,t,n)}));case"basic_math":return Object(a.tidy)((function(){return J(e,t,n)}));case"control":return Q(e,t,n);case"convolution":return Object(a.tidy)((function(){return ee(e,t,n)}));case"creation":return Object(a.tidy)((function(){return te(e,t,n)}));case"dynamic":return ne(e,t,n);case"evaluation":return Object(a.tidy)((function(){return re(e,t,n)}));case"image":return Object(a.tidy)((function(){return ae(e,t,n)}));case"graph":return Object(a.tidy)((function(){return ie(e,t,n)}));case"logical":return Object(a.tidy)((function(){return oe(e,t,n)}));case"matrices":return Object(a.tidy)((function(){return se(e,t,n)}));case"normalization":return Object(a.tidy)((function(){return ue(e,t,n)}));case"reduction":return Object(a.tidy)((function(){return ce(e,t,n)}));case"slice_join":return Object(a.tidy)((function(){return le(e,t,n)}));case"spectral":return Object(a.tidy)((function(){return fe(e,t,n)}));case"transformation":return Object(a.tidy)((function(){return de(e,t,n)}));case"custom":var r=f(e.op);if(r&&r.customExecutor)return r.customExecutor(new Y(e,t,n));throw TypeError("Custom op "+e.op+" is not registered.");default:throw TypeError("Unknown op '"+e.op+"'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()")}}(e,t,n);return r instanceof Promise?r.then((function(e){return[].concat(e)})):[].concat(r)}var pe=function(){function e(e,t){this.weightMap=e,this.tensorArrayMap=t,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return e.prototype.newFrame=function(e,t){return{id:e,frameName:t,iterationId:0}},Object.defineProperty(e.prototype,"currentContext",{get:function(){return this.contexts},set:function(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentContextId",{get:function(){return this._currentContextIds[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentContextIds",{get:function(){return this._currentContextIds},enumerable:!0,configurable:!0}),e.prototype.generateCurrentContextIds=function(){for(var e=[],t=0;t<this.contexts.length-1;t++){var n=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(n))}e.push(""),this._currentContextIds=e},e.prototype.contextIdforContexts=function(e){return e?e.map((function(e){return 0===e.id&&0===e.iterationId?"":e.frameName+"-"+e.iterationId})).join("/"):""},e.prototype.enterFrame=function(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))},e.prototype.exitFrame=function(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()},e.prototype.nextIteration=function(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");this.contexts=this.contexts.slice(),this.lastId++;var e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))},e.prototype.getWeight=function(e){return this.weightMap[e]},e.prototype.addTensorArray=function(e){this.tensorArrayMap[e.id]=e},e.prototype.getTensorArray=function(e){return this.tensorArrayMap[e]},e}();function me(e,t,n){for(var r=new Set,i=[],a=null,o=null,s=new Set,u=Object.keys(e).map((function(e){return g(e)[0]})),c=t.slice();c.length>0;){var l=c.pop();(ye(l)||be(l))&&null==a&&(o=(a=l).children.map((function(e){return e.name})).filter((function(e){return r.has(e)}))),r.add(l.name),null==n[l.name]&&-1===u.indexOf(l.name)&&(0!==l.inputs.length?l.inputs.forEach((function(e){s.has(e.name)||(s.add(e.name),c.push(e))})):i.push(l.name))}return{inputs:e,outputs:t,usedNodes:r,missingInputs:i,dynamicNode:a,syncInputs:o}}var ve=["Switch","Merge","Enter","Exit","NextIteration"],ge=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"];function ye(e){return ve.indexOf(e.op)>=0}function be(e){return ge.indexOf(e.op)>=0}var xe=function(){function e(e){this.graph=e,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._outputs=e.outputs,this._inputs=e.inputs,this._signature=e.signature}return Object.defineProperty(e.prototype,"weightMap",{get:function(){return this._weightMap},set:function(e){var t=Object.keys(e).map((function(t){return e[t].map((function(e){return e.id}))}));this.weightIds=[].concat.apply([],t),this._weightMap=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputs",{get:function(){return this._inputs.map((function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outputs",{get:function(){return this._outputs.map((function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputNodes",{get:function(){return this._inputs.map((function(e){return e.signatureKey||e.name}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outputNodes",{get:function(){return this._outputs.map((function(e){return e.signatureKey||e.name}))},enumerable:!0,configurable:!0}),e.prototype.getCompilationKey=function(e,t){var n=e.map((function(e){return e.name})).sort(),r=t.map((function(e){return e.name})).sort();return n.join(this.SEPERATOR)+"--"+r.join(this.SEPERATOR)},e.prototype.compile=function(e,t){var n=me(e,t,this.weightMap),r=n.missingInputs,i=n.dynamicNode,a=n.syncInputs;if(null!=i)throw new Error("This execution contains the node '"+i.name+"', which has the dynamic op '"+i.op+"'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs ["+a+"]");if(r.length>0){var o=t.map((function(e){return e.name})),s=Object.keys(e);throw new Error("Cannot compute the outputs ["+o+"] from the provided inputs ["+s+"]. Missing the following inputs: ["+r+"]")}return function(e,t,n){var r=n.usedNodes,i=n.inputs,a=[];Object.keys(i).map((function(e){return g(e)[0]})).map((function(t){return e.nodes[t]})).forEach((function(e){r.has(e.name)&&a.push(e)})),e.weights.forEach((function(e){r.has(e.name)&&a.push(e)}));for(var o=new Set,s=[];a.length>0;){var u=a.pop();o.add(u.name),t[u.name]||s.push(u),u.children.forEach((function(e){!o.has(e.name)&&r.has(e.name)&&e.inputs.every((function(e){return o.has(e.name)}))&&a.push(e)}))}return s}(this.graph,this.weightMap,n)},e.prototype.execute=function(e,t){var n=this;e=this.mapInputs(e);var r=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);var i=r.map((function(e){return n.graph.nodes[g(e)[0]]})),s=t.map((function(e){return n.graph.nodes[g(e)[0]]})),u=this.getCompilationKey(i,s),c=this.compiledMap.get(u);null==c&&(c=this.compile(e,s),this.compiledMap.set(u,c));var l={};return Object(a.tidy)((function(){var r=new pe(n._weightMap,l),i=o({},n.weightMap);Object.keys(e).forEach((function(t){var n=g(t),r=n[0],a=[];a[n[1]]=e[t],i[r]=a}));for(var a=n.getFrozenTensorIds(i),s={},u=0;u<c.length;u++){var f=c[u];if(!i[f.name]){var d=he(f,i,r);if(d instanceof Promise)throw new Error("The execution of the op '"+f.op+"' returned a promise. Please use model.executeAsync() instead.");i[f.name]=d,n.checkTensorForDisposal(f.name,f,i,r,a,t,s)}}return t.map((function(e){return p(e,i,r)}))}))},e.prototype.getFrozenTensorIds=function(e){var t=[].concat.apply([],Object.keys(e).map((function(t){return e[t]})).map((function(e){return e.map((function(e){return e.id}))})));return new Set(t)},e.prototype.checkTensorForDisposal=function(e,t,n,r,i,a,o){"control"!==t.category&&-1===a.indexOf(e)&&(n[e].forEach((function(e){null!=e&&(o[e.id]=(o[e.id]||0)+t.children.length)})),t.inputs.forEach((function(e){if("control"!==e.category){var t=function(e,t,n){return t[v(e,n.currentContextId)]}(e.name,n,r);null!=t&&t.forEach((function(e){if(e&&!i.has(e.id)){var t=o[e.id];1===t?(e.dispose(),delete o[e.id]):null!=t&&o[e.id]--}}))}})))},e.prototype.executeAsync=function(e,t){return s(this,void 0,void 0,(function(){var n,r,i,a,o,s,c=this;return u(this,(function(u){switch(u.label){case 0:return e=this.mapInputs(e),this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t),n={},r=new pe(this._weightMap,n),[4,this.executeWithControlFlow(e,r,t)];case 1:return i=u.sent(),a=t.map((function(e){return p(e,i,r)})),o=new Set(a.map((function(e){return e.id}))),s=new Set(Object.keys(e).map((function(t){return e[t].id}))),Object.keys(i).forEach((function(e){i[e].forEach((function(e){!e||e.isDisposed||o.has(e.id)||s.has(e.id)||-1!==c.weightIds.indexOf(e.id)||e.dispose()}))})),[2,a]}}))}))},e.prototype.executeWithControlFlow=function(e,t,n){return s(this,void 0,void 0,(function(){var r,i,a,s,c,l,f,d,h,m,v,y,b,x,w,_,k=this;return u(this,(function(u){switch(u.label){case 0:r=Object.keys(e),i=r.map((function(e){return k.graph.nodes[g(e)[0]]})),a=n.map((function(e){return k.graph.nodes[g(e)[0]]})),s=me(e,a,this.weightMap),c=s.usedNodes,l=s.missingInputs,f=s.dynamicNode,d=s.syncInputs,h=i.concat(this.graph.weights).map((function(e){return{node:e,contexts:t.currentContext}})),m=o({},this.weightMap),Object.keys(e).forEach((function(t){var n=g(t),r=n[0],i=[];i[n[1]]=e[t],m[r]=i})),v={},y=this.getFrozenTensorIds(m),b={},u.label=1;case 1:return h.length>0?(x=this.processStack(i,h,t,m,b,y,n,v,c),[4,Promise.all(x)]):[3,3];case 2:return u.sent(),[3,1];case 3:if(null==f&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead."),(w=a.filter((function(e){return!ye(e)&&!p(e.name,m,t)})).map((function(e){return e.name}))).length>0)throw _="",null!=f&&(_="Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs ["+d+"]"),new Error("Cannot compute the outputs ["+w+"] from the provided inputs ["+r+"]. Consider providing the following inputs: ["+l+"]. "+_);return[2,m]}}))}))},e.prototype.processStack=function(e,t,n,r,i,a,o,s,u){for(var c=this,l=[],f=function(){var f=t.pop();n.currentContext=f.contexts;var p="";if("Enter"===f.node.op&&h("isConstant",f.node,r,n)&&(p=m(f.node.name,n)[0]),-1===e.indexOf(f.node)){var v=he(f.node,r,n);p||(p=m(f.node.name,n)[0]);var g=n.currentContext;v instanceof Promise?l.push(v.then((function(e){return r[p]=e,n.currentContext=g,c.checkTensorForDisposal(p,f.node,r,n,a,o,s),c.processChildNodes(f.node,t,n,r,i,u),e}))):(r[p]=v,d.checkTensorForDisposal(p,f.node,r,n,a,o,s),d.processChildNodes(f.node,t,n,r,i,u))}else d.processChildNodes(f.node,t,n,r,i,u)},d=this;t.length>0;)f();return l},e.prototype.processChildNodes=function(e,t,n,r,i,a){e.children.forEach((function(e){var o=m(e.name,n)[0];!i[o]&&a.has(e.name)&&("Merge"===e.op?e.inputNames.some((function(e){return!!p(e,r,n)}))&&(i[o]=!0,t.push({contexts:n.currentContext,node:e})):e.inputNames.every((function(e){return!!p(e,r,n)}))&&(i[o]=!0,t.push({contexts:n.currentContext,node:e})))}))},e.prototype.dispose=function(){var e=this;Object.keys(this.weightMap).forEach((function(t){return e.weightMap[t].forEach((function(e){return e.dispose()}))}))},e.prototype.checkInputShapeAndType=function(e){var t=this;Object.keys(e).forEach((function(n){var r=e[n],i=g(n)[0],o=t.graph.nodes[i];if(o.attrParams.shape&&o.attrParams.shape.value){var s=o.attrParams.shape.value,u=s.length===r.shape.length&&r.shape.every((function(e,t){return-1===s[t]||s[t]===e}));a.util.assert(u,(function(){return"The shape of dict['"+o.name+"'] provided in model.execute(dict) must be ["+s+"], but was ["+r.shape+"]"}))}o.attrParams.dtype&&o.attrParams.dtype.value&&a.util.assert(r.dtype===o.attrParams.dtype.value,(function(){return"The dtype of dict['"+o.name+"'] provided in model.execute(dict) must be "+o.attrParams.dtype.value+", but was "+r.dtype}))}))},e.prototype.mapInputs=function(e){var t={};for(var n in e)null!=this._signature&&null!=this._signature.inputs&&null!=this._signature.inputs[n]?t[this._signature.inputs[n].name]=e[n]:t[n]=e[n];return t},e.prototype.checkInputs=function(e){var t=this,n=Object.keys(e).filter((function(e){var n=g(e)[0];return null==t.graph.nodes[n]}));if(n.length>0)throw new Error("The dict provided in model.execute(dict) has keys: ["+n+"] that are not part of graph")},e.prototype.mapOutputs=function(e){var t=this;return e.map((function(e){return null!=t._signature&&null!=t._signature.outputs&&null!=t._signature.outputs[e]?t._signature.outputs[e].name:e}),{})},e.prototype.checkOutputs=function(e){var t=this;e.forEach((function(e){var n=g(e)[0];if(!t.graph.nodes[n])throw new Error("The output '"+e+"' is not found in the graph")}))},e}(),we="?tfjs-format=file",_e="model.json",ke=function(){function e(e,t){void 0===t&&(t={}),this.modelUrl=e,this.loadOptions=t,this.version="n/a",null==t&&(this.loadOptions={})}return Object.defineProperty(e.prototype,"modelVersion",{get:function(){return this.version},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputNodes",{get:function(){return this.executor.inputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outputNodes",{get:function(){return this.executor.outputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputs",{get:function(){return this.executor.inputs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outputs",{get:function(){return this.executor.outputs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weights",{get:function(){return this.executor.weightMap},enumerable:!0,configurable:!0}),e.prototype.findIOHandler=function(){var e=this.modelUrl;if(null!=e.load)this.handler=e;else if(null!=this.loadOptions.requestInit)this.handler=a.io.browserHTTPRequest(e,this.loadOptions);else{var t=a.io.getLoadHandlers(e,this.loadOptions.onProgress);if(0===t.length)t.push(a.io.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error("Found more than one ("+t.length+") load handlers for URL '"+[e]+"'");this.handler=t[0]}},e.prototype.load=function(){return s(this,void 0,void 0,(function(){var e,t,n,r;return u(this,(function(i){switch(i.label){case 0:if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return e=this,[4,this.handler.load()];case 1:return e.artifacts=i.sent(),t=this.artifacts.modelTopology,n={},null!=this.artifacts.userDefinedMetadata&&(n=this.artifacts.userDefinedMetadata.signature),this.version=t.versions.producer+"."+t.versions.minConsumer,r=a.io.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs),this.executor=new xe(N.Instance.transformGraph(t,n)),this.executor.weightMap=this.convertTensorMapToTensorsMap(r),[2,!0]}}))}))},e.prototype.save=function(e,t){return s(this,void 0,void 0,(function(){var t;return u(this,(function(n){if("string"==typeof e){if(0===(t=a.io.getSaveHandlers(e)).length)throw new Error("Cannot find any save handlers for URL '"+e+"'");if(t.length>1)throw new Error("Found more than one ("+t.length+") save handlers for URL '"+e+"'");e=t[0]}if(null==e.save)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[2,e.save(this.artifacts)]}))}))},e.prototype.predict=function(e,t){return this.execute(e,this.outputNodes)},e.prototype.normalizeInputs=function(e){if(!(e instanceof a.Tensor||Array.isArray(e)))return e;if((e=Array.isArray(e)?e:[e]).length!==this.inputNodes.length)throw new Error("Input tensor count mismatch,the graph model has "+this.inputNodes.length+" placeholders, while there are "+e.length+" input tensors.");return this.inputNodes.reduce((function(t,n,r){return t[n]=e[r],t}),{})},e.prototype.normalizeOutputs=function(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]},e.prototype.execute=function(e,t){e=this.normalizeInputs(e),t=this.normalizeOutputs(t);var n=this.executor.execute(e,t);return n.length>1?n:n[0]},e.prototype.executeAsync=function(e,t){return s(this,void 0,void 0,(function(){var n;return u(this,(function(r){switch(r.label){case 0:return e=this.normalizeInputs(e),t=this.normalizeOutputs(t),[4,this.executor.executeAsync(e,t)];case 1:return[2,(n=r.sent()).length>1?n:n[0]]}}))}))},e.prototype.convertTensorMapToTensorsMap=function(e){return Object.keys(e).reduce((function(t,n){return t[n]=[e[n]],t}),{})},e.prototype.dispose=function(){this.executor.dispose()},e}();function Ee(e,t){return void 0===t&&(t={}),s(this,void 0,void 0,(function(){var n;return u(this,(function(r){switch(r.label){case 0:if(null==e)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");return null==t&&(t={}),t.fromTFHub&&null==e.load&&(e.endsWith("/")||(e+="/"),e=""+e+_e+we),[4,(n=new ke(e,t)).load()];case 1:return r.sent(),[2,n]}}))}))}var Se="1.7.4"}.call(this,n(92).Buffer)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(103);function i(e){for(var t=e.length,n=0,r=0;t>0;)r=Math.random()*t|0,n=e[--t],e[t]=e[r],e[r]=n}function a(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function o(e,t,n){if(void 0===t&&(t=[]),void 0===n&&(n=!1),null==t&&(t=[]),Array.isArray(e)||f(e)&&!n)for(var r=0;r<e.length;++r)o(e[r],t,n);else t.push(e);return t}function s(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function u(e){return e%1==0}function c(e,t){var n=t.length;return a((e=null==e?t.map((function(e,t){return t})):[].concat(e)).every((function(e){return e>=-n&&e<n})),(function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+e})),a(e.every((function(e){return u(e)})),(function(){return"All values in axis param must be integers but got axis "+e})),e.map((function(e){return e<0?n+e:e}))}function l(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+t+" being uploaded contains "+r+".")}}function f(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function d(e){return"string"==typeof e||e instanceof String}function h(e){return"boolean"==typeof e}function p(e){return"number"==typeof e}function m(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type "+t)}t.shuffle=i,t.clamp=function(e,t,n){return Math.max(e,Math.min(t,n))},t.nearestLargerEven=function(e){return e%2==0?e:e+1},t.sum=function(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t},t.randUniform=function(e,t){var n=Math.random();return t*n+(1-n)*e},t.distSquared=function(e,t){for(var n=0,r=0;r<e.length;r++){var i=Number(e[r])-Number(t[r]);n+=i*i}return n},t.assert=a,t.assertShapesMatch=function(e,t,n){void 0===n&&(n=""),a(s(e,t),(function(){return n+" Shapes "+e+" and "+t+" must match"}))},t.assertNonNull=function(e){a(null!=e,(function(){return"The input to the tensor constructor must be a non-null value."}))},t.flatten=o,t.sizeFromShape=function(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t},t.isScalarShape=function(e){return 0===e.length},t.arraysEqual=s,t.isInt=u,t.tanh=function(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)},t.sizeToSquarishShape=function(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]},t.createShuffledIndices=function(e){for(var t=new Uint32Array(e),n=0;n<e;++n)t[n]=n;return i(t),t},t.rightPad=function(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)},t.repeatedTry=function(e,t,n){return void 0===t&&(t=function(e){return 0}),new Promise((function(r,i){var a=0,o=function o(){if(e())r();else{var s=t(++a);null!=n&&a>=n?i():setTimeout(o,s)}};o()}))},t.inferFromImplicitShape=function(e,t){for(var n=1,r=-1,i=0;i<e.length;++i)if(e[i]>=0)n*=e[i];else if(-1===e[i]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+i);r=i}else if(e[i]<0)throw Error("Shapes can not be < 0. Found "+e[i]+" at dim "+i);if(-1===r){if(t>0&&t!==n)throw Error("Size("+t+") must match the product of shape "+e);return e}if(0===n)throw Error("Cannot infer the missing size in ["+e+"] when there are 0 elements");if(t%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+n);var a=e.slice();return a[r]=t/n,a},t.parseAxisParam=c,t.squeezeShape=function(e,t){for(var n=[],r=[],i=null!=t&&Array.isArray(t)&&0===t.length,a=null==t||i?null:c(t,e).sort(),o=0,s=0;s<e.length;++s){if(null!=a){if(a[o]===s&&1!==e[s])throw new Error("Can't squeeze axis "+s+" since its dim '"+e[s]+"' is not 1");(null==a[o]||a[o]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),a[o]<=s&&o++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}},t.getTypedArrayFromDType=function(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type "+e);n=new Uint8Array(t)}return n},t.getArrayFromDType=function(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type "+e);n=new Array(t)}return n},t.checkConversionForErrors=l,t.isValidDtype=function(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e},t.hasEncodingLoss=function(e,t){return!("complex64"===t||"float32"===t&&"complex64"!==e||"int32"===t&&"float32"!==e&&"complex64"!==e||"bool"===t&&"bool"===e)},t.isTypedArray=f,t.bytesPerElement=function(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype "+e)},t.bytesFromStringArray=function(e){if(null==e)return 0;var t=0;return e.forEach((function(e){return t+=e.length})),t},t.isString=d,t.isBoolean=h,t.isNumber=p,t.inferDtype=function e(t){return Array.isArray(t)?e(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array?"int32":p(t)?"float32":d(t)?"string":h(t)?"bool":"float32"},t.isFunction=function(e){return!!(e&&e.constructor&&e.call&&e.apply)},t.nearestDivisor=function(e,t){for(var n=t;n<e;++n)if(e%n==0)return n;return e},t.computeStrides=function(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n},t.toTypedArray=function(e,t,n){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=o(e)),n&&l(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var r=new Uint8Array(e.length),i=0;i<r.length;++i)0!==Math.round(e[i])&&(r[i]=1);return r}throw new Error("Unknown data type "+t)},t.toNestedArray=function(e,t){if(0===e.length)return t[0];var n=e.reduce((function(e,t){return e*t}));if(0===n)return[];if(n!==t.length)throw new Error("["+e+"] does not match the input size.");return function e(t,n,r){var i=new Array;if(1===n.length)for(var a=n[0],o=0;o<a;o++)i[o]=r[t+o];else{a=n[0];var s=n.slice(1),u=s.reduce((function(e,t){return e*t}));for(o=0;o<a;o++)i[o]=e(t+o*u,s,r)}return i}(0,e,t)},t.makeOnesTypedArray=function(e,t){for(var n=m(e,t),r=0;r<n.length;r++)n[r]=1;return n},t.makeZerosTypedArray=m,t.now=function(){return r.env().platform.now()},t.assertNonNegativeIntegerDimensions=function(e){e.forEach((function(t){a(Number.isInteger(t)&&t>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape ["+e+"]."}))}))},t.fetch=function(e,t){return r.env().platform.fetch(e,t)},t.encodeString=function(e,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",r.env().platform.encode(e,t)},t.decodeString=function(e,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",r.env().platform.decode(e,t)},t.locToIndex=function(e,t,n){if(0===t)return 0;if(1===t)return e[0];for(var r=e[e.length-1],i=0;i<e.length-1;++i)r+=n[i]*e[i];return r},t.indexToLoc=function(e,t,n){if(0===t)return[];if(1===t)return[e];for(var r=new Array(t),i=0;i<r.length-1;++i)r[i]=Math.floor(e/n[i]),e-=r[i]*n[i];return r[r.length-1]=e,r}},function(e,t,n){var r=n(54),i=Math.min;e.exports=function(e){return e>0?i(r(e),9007199254740991):0}},function(e,t,n){var r=n(262),i=n(261),a=n(187),o=n(260);e.exports=function(e,t){return r(e)||i(e,t)||a(e,t)||o()},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){var n=e.exports={version:"2.6.12"};"number"==typeof __e&&(__e=n)},function(e,t,n){"use strict";(function(e,r){var i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o,s=n(103),u=n(382),c=n(381),l=n(380),f=n(33),d=n(74),h=n(21),p=n(21),m=function(){function e(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return e.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},e}(),v=function(){function e(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new m}return e.prototype.ready=function(){return i(this,void 0,void 0,(function(){var e,t,n;return a(this,(function(r){switch(r.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then((function(){}))];if(null!=this.backendInstance)return[2];e=this.getSortedBackends(),t=0,r.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return r.sent()?[4,this.setBackend(n)]:[3,4];case 3:return r.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}}))}))},Object.defineProperty(e.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),e.prototype.backendNames=function(){return Object.keys(this.registryFactory)},e.prototype.findBackend=function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]},e.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},e.prototype.registerBackend=function(e,t,n){return void 0===n&&(n=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},e.prototype.setBackend=function(e){return i(this,void 0,void 0,(function(){var t,n,r;return a(this,(function(i){switch(i.label){case 0:if(null==this.registryFactory[e])throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,null!=this.registry[e]?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,t.asyncInit?[4,n]:[3,2]);case 1:return r=i.sent(),[3,3];case 2:r=n,i.label=3;case 3:if(!r)return[2,!1];i.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new c.Profiler(this.backendInstance),[2,!0]}}))}))},e.prototype.setupRegisteredKernels=function(){var e=this;u.getKernelsForBackend(this.backendName).forEach((function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)}))},e.prototype.disposeRegisteredKernels=function(e){var t=this;u.getKernelsForBackend(e).forEach((function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])}))},e.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var r=n.factory();if(Promise.resolve(r)===r){var i=++this.pendingBackendInitId,a=r.then((function(n){return!(i<t.pendingBackendInitId)&&(t.registry[e]=n,t.pendingBackendInit=null,!0)})).catch((function(n){return!(i<t.pendingBackendInitId)&&(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(n.stack||n.message),!1)}));return this.pendingBackendInit=a,{success:a,asyncInit:!0}}return this.registry[e]=r,{success:!0,asyncInit:!1}}catch(t){return console.warn("Initialization of backend "+e+" failed"),console.warn(t.stack||t.message),{success:!1,asyncInit:!1}}},e.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},e.prototype.getSortedBackends=function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority}))},e.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),i=r.success,a=r.asyncInit;if(a||i)return{name:n,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},e.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,i=this.readSync(t);r.disposeData(t),n.backend=e,e.move(t,i,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},e.prototype.tidy=function(e,t){var n,r=this,i=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=e}return this.scopedRun((function(){return r.startScope(i)}),(function(){return r.endScope(n)}),(function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))},e.prototype.scopedRun=function(e,t,n){e();try{var r=n();return t(),r}catch(e){throw t(),e}},e.prototype.nextTensorId=function(){return e.nextTensorId++},e.prototype.nextVariableId=function(){return e.nextVariableId++},e.prototype.clone=function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],(function(e){return{x:function(){return e.toFloat()}}}),[],{}),t},e.prototype.runKernel=function(e,t,n,r,i){return this.runKernelFunc(null,t,null,e,n,r,i)},e.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},e.prototype.checkKernelForMemLeak=function(e,t,n){var r=this.backend.numDataIds(),i=0;n.forEach((function(e){i+="complex64"===e.dtype?3:1}));var a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],o=r-t-i-a;if(o>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+o+" data ids) after running '"+e+"'")},e.prototype.runKernelFunc=function(e,t,n,r,i,a,o){var s,c=this,l=[],f=this.isTapeOn();null==r&&(r=null!=this.state.activeScope?this.state.activeScope.name:"");var d,h=this.state.numBytes,p=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var m,v=u.getKernel(r,this.backendName);if(null!=v)d=function(){var e=c.backend.numDataIds();m=v.kernelFunc({inputs:t,attrs:i,backend:c.backend});var n=Array.isArray(m)?m:[m];c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(r,e,n);var s=n.map((function(e){var t=e.dataId,n=e.shape,r=e.dtype;return c.makeTensorFromDataId(t,n,r)}));if(f){var u=c.getTensorsForGradient(r,t,s);if(null==u){null==o&&(o=[]);var d=s.filter((function(e,t){return o[t]}));u=(a||[]).slice().concat(d)}l=c.saveTensorsForBackwardMode(u)}return s};else{var g=function(e){f&&(l=e.map((function(e){return c.keep(c.clone(e))})))};d=function(){var t=c.backend.numDataIds();m=c.tidy((function(){return e(c.backend,g)}));var n=Array.isArray(m)?m:[m];return c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(r,t,n),n}}return this.scopedRun((function(){return c.state.kernelDepth++}),(function(){return c.state.kernelDepth--}),(function(){s=c.ENV.getBool("DEBUG")?c.profiler.profileKernel(r,t,(function(){return d()})):d()})),f&&this.addTapeNode(r,t,s,n,l,i),this.state.profiling&&this.state.activeProfile.kernels.push({name:r,bytesAdded:this.state.numBytes-h,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-p,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map((function(e){return t[e].shape})),outputShapes:s.map((function(e){return e.shape}))}),Array.isArray(m)?s:s[0]},e.prototype.saveTensorsForBackwardMode=function(e){var t=this;return e.map((function(e){return t.keep(t.clone(e))}))},e.prototype.getTensorsForGradient=function(e,t,n){var r=u.getGradient(e);if(null!=r){var i=r.inputsToSave||[],a=r.outputsToSave||[],o=void 0;r.saveAllInputs?(h.assert(Array.isArray(t),(function(){return"saveAllInputs is true, expected inputs to be an array."})),o=Object.keys(t).map((function(e){return t[e]}))):o=i.map((function(e){return t[e]}));var s=n.filter((function(e,t){return a[t]}));return o.concat(s)}return null},e.prototype.makeTensor=function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var i=e;"string"===n&&h.isString(e[0])&&(i=e.map((function(e){return h.encodeString(e)})));var a=r.write(i,t,n),o=new f.Tensor(t,n,a,this.nextTensorId());if(this.incRef(o,r),"string"===n){var s=this.state.tensorInfo.get(a),u=p.bytesFromStringArray(i);this.state.numBytes+=u-s.bytes,s.bytes=u}return o},e.prototype.makeTensorFromDataId=function(e,t,n,r){n=n||"float32";var i=new f.Tensor(t,n,e,this.nextTensorId());return this.incRef(i,r),i},e.prototype.makeVariable=function(e,t,n,r){void 0===t&&(t=!0),n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.asType(r));var i=new f.Variable(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[i.name])throw new Error("Variable with name "+i.name+" was already registered");return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},e.prototype.incRef=function(e,t){var n=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;var r=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(r=e.size*h.bytesPerElement(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r,refCount:0}),this.state.numBytes+=r}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof f.Variable||this.track(e)},e.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,"string"===e.dtype&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?("complex64"!==e.dtype&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},e.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},e.prototype.disposeVariable=function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]},e.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},e.prototype.profile=function(e){return i(this,void 0,void 0,(function(){var t,n;return a(this,(function(r){return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map((function(e){return e.totalBytesSnapshot}))),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,[2,this.state.activeProfile]}))}))},e.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},e.prototype.addTapeNode=function(e,t,n,r,i,a){var o=this,s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:i},c=u.getGradient(e);null!=c&&(r=c.gradFunc),null!=r&&(s.gradient=function(e){return e=e.map((function(e,t){if(null==e){var r=n[t],i=h.makeZerosTypedArray(r.size,r.dtype);return o.makeTensor(i,r.shape,r.dtype)}return e})),r(e.length>1?e:e[0],i,a)}),this.state.activeTape.push(s)},e.prototype.keep=function(e){return e.kept=!0,e},e.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},e.prototype.endTape=function(){this.state.gradientDepth--},e.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},e.prototype.endScope=function(e){for(var t=this,n=d.getTensorsInContainer(e),r=new Set(n.map((function(e){return e.id}))),i=0;i<this.state.activeScope.track.length;i++){var a=this.state.activeScope.track[i];a.kept||r.has(a.id)||a.dispose()}var o=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(e){e.kept||e.scopeId!==o.id||t.track(e)}))},e.prototype.gradients=function(e,n,r,i){var a=this;if(void 0===i&&(i=!1),h.assert(n.length>0,(function(){return"gradients() received an empty list of xs."})),null!=r&&"float32"!==r.dtype)throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var o=this.scopedRun((function(){return a.startTape()}),(function(){return a.endTape()}),(function(){return a.tidy("forward",e)}));h.assert(o instanceof f.Tensor,(function(){return"The result y returned by f() must be a tensor."}));var s=l.getFilteredNodesXToY(this.state.activeTape,n,o);if(!i&&0===s.length&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var e={};e[o.id]=null==r?function(e){var n=p.makeOnesTypedArray(p.sizeFromShape(e),"float32");return t.ENGINE.makeTensor(n,e,"float32")}(o.shape):r,l.backpropagateGradients(e,s,(function(e){return a.tidy(e)}));var i=n.map((function(t){return e[t.id]}));return 0===a.state.gradientDepth&&(a.state.activeTape.forEach((function(e){for(var t=0,n=e.saved;t<n.length;t++)n[t].dispose()})),a.state.activeTape=null),{value:o,grads:i}}))},e.prototype.customGrad=function(e){var t=this;return h.assert(h.isFunction(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];h.assert(r.every((function(e){return e instanceof f.Tensor})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var a={};return r.forEach((function(e,t){a[t]=e})),t.runKernelFunc((function(t,i){return n=e.apply(void 0,r.concat([i])),h.assert(n.value instanceof f.Tensor,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),h.assert(h.isFunction(n.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),n.value}),a,(function(e,t){var i=n.gradFunc(e,t),a=Array.isArray(i)?i:[i];h.assert(a.length===r.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),h.assert(a.every((function(e){return e instanceof f.Tensor})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var o={};return a.forEach((function(e,t){o[t]=function(){return e}})),o}))}},e.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},e.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},e.prototype.time=function(e){return i(this,void 0,void 0,(function(){var t,n;return a(this,(function(r){switch(r.label){case 0:return t=p.now(),[4,this.backend.time(e)];case 1:return(n=r.sent()).wallMs=p.now()-t,[2,n]}}))}))},e.prototype.track=function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(e.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),e.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new m,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},e.nextTensorId=0,e.nextVariableId=0,e}();t.Engine=v,t.ENGINE=function(){var t=function(){if(null==o){var t=void 0;if("undefined"!=typeof window)t=window;else if(void 0!==e)t=e;else if(void 0!==r)t=r;else{if("undefined"==typeof self)throw new Error("Could not find a global object");t=self}o=t}return o}();if(null==t._tfengine){var n=new s.Environment(t);t._tfengine=new v(n)}return s.setEnvironmentGlobal(t._tfengine.ENV),f.setTensorTracker((function(){return t._tfengine})),t._tfengine}()}).call(this,n(59),n(75))},function(e,t,n){var r=n(14),i=n(240),a=n(66),o=Object.defineProperty;t.f=n(27)?Object.defineProperty:function(e,t,n){if(r(e),t=a(t,!0),r(n),i)try{return o(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(e,t,n){e.exports=!n(15)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(25);t.op=function(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var n=t[0],i=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var a=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];r.ENGINE.startScope(n);try{var a=i.apply(void 0,e);return a instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r.ENGINE.endScope(a),a}catch(e){throw r.ENGINE.endScope(null),e}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(25),i=n(103),a=n(33),o=n(21);function s(e,t){var n=e;if(o.isTypedArray(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||o.isTypedArray(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&i.env().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function e(t,n,r){if(r=r||[],Array.isArray(t)||o.isTypedArray(t)){o.assert(n.length>0,(function(){return"Element arr["+r.join("][")+"] should be a primitive, but is an array of "+t.length+" elements"})),o.assert(t.length===n[0],(function(){return"Element arr["+r.join("][")+"] should have "+n[0]+" elements, but has "+t.length+" elements"}));for(var i=n.slice(1),a=0;a<t.length;++a)e(t[a],i,r.concat(a))}else o.assert(0===n.length,(function(){return"Element arr["+r.join("][")+"] is a primitive, but should be an array/TypedArray of "+n[0]+" elements"}))}(e,r,[]),r}function u(e,t,n,r){if(null!=e&&("numeric"!==e&&e!==t||"numeric"===e&&"string"===t))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+e+" tensor, but got "+t+" tensor")}function c(e,t,n,c){if(void 0===c&&(c="numeric"),e instanceof a.Tensor)return u(c,e.dtype,t,n),e;var l=o.inferDtype(e);if("string"!==l&&["bool","int32","float32"].indexOf(c)>=0&&(l=c),u(c,l,t,n),null==e||!o.isTypedArray(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e){var f=null==e?"null":e.constructor.name;throw new Error("Argument '"+t+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+f+"'")}var d=s(e,l);o.isTypedArray(e)||Array.isArray(e)||(e=[e]);var h="string"!==l?o.toTypedArray(e,l,i.env().getBool("DEBUG")):o.flatten(e,[],!0);return r.ENGINE.makeTensor(h,d,l)}t.inferShape=s,t.convertToTensor=c,t.convertToTensorArray=function(e,t,n,r){if(void 0===r&&(r="numeric"),!Array.isArray(e))throw new Error("Argument "+t+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return e.map((function(e,r){return c(e,t+"["+r+"]",n)}),r)}},function(e,t,n){var r=n(254),i=n(253),a=n(187),o=n(252);e.exports=function(e){return r(e)||i(e)||a(e)||o()},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=new Date,i=new Date;function a(e,t,n,o){function s(t){return e(t=0===arguments.length?new Date:new Date(+t)),t}return s.floor=function(t){return e(t=new Date(+t)),t},s.ceil=function(n){return e(n=new Date(n-1)),t(n,1),e(n),n},s.round=function(e){var t=s(e),n=s.ceil(e);return e-t<n-e?t:n},s.offset=function(e,n){return t(e=new Date(+e),null==n?1:Math.floor(n)),e},s.range=function(n,r,i){var a,o=[];if(n=s.ceil(n),i=null==i?1:Math.floor(i),!(n<r&&i>0))return o;do{o.push(a=new Date(+n)),t(n,i),e(n)}while(a<n&&n<r);return o},s.filter=function(n){return a((function(t){if(t>=t)for(;e(t),!n(t);)t.setTime(t-1)}),(function(e,r){if(e>=e)if(r<0)for(;++r<=0;)for(;t(e,-1),!n(e););else for(;--r>=0;)for(;t(e,1),!n(e););}))},n&&(s.count=function(t,a){return r.setTime(+t),i.setTime(+a),e(r),e(i),Math.floor(n(r,i))},s.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?s.filter(o?function(t){return o(t)%e==0}:function(t){return s.count(0,t)%e==0}):s:null}),s}},function(e,t,n){var r=n(116),i=n(117),a=i.MAX_LENGTH,o=i.MAX_SAFE_INTEGER,s=n(90),u=s.re,c=s.t,l=n(115),f=n(146).compareIdentifiers,d=function(){"use strict";function e(t,n){if(v(this,e),n=l(n),t instanceof e){if(t.loose===!!n.loose&&t.includePrerelease===!!n.includePrerelease)return t;t=t.version}else if("string"!=typeof t)throw new TypeError("Invalid Version: ".concat(t));if(t.length>a)throw new TypeError("version is longer than ".concat(a," characters"));r("SemVer",t,n),this.options=n,this.loose=!!n.loose,this.includePrerelease=!!n.includePrerelease;var i=t.trim().match(n.loose?u[c.LOOSE]:u[c.FULL]);if(!i)throw new TypeError("Invalid Version: ".concat(t));if(this.raw=t,this.major=+i[1],this.minor=+i[2],this.patch=+i[3],this.major>o||this.major<0)throw new TypeError("Invalid major version");if(this.minor>o||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>o||this.patch<0)throw new TypeError("Invalid patch version");i[4]?this.prerelease=i[4].split(".").map((function(e){if(/^[0-9]+$/.test(e)){var t=+e;if(t>=0&&t<o)return t}return e})):this.prerelease=[],this.build=i[5]?i[5].split("."):[],this.format()}return g(e,[{key:"format",value:function(){return this.version="".concat(this.major,".").concat(this.minor,".").concat(this.patch),this.prerelease.length&&(this.version+="-".concat(this.prerelease.join("."))),this.version}},{key:"toString",value:function(){return this.version}},{key:"compare",value:function(t){if(r("SemVer.compare",this.version,this.options,t),!(t instanceof e)){if("string"==typeof t&&t===this.version)return 0;t=new e(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}},{key:"compareMain",value:function(t){return t instanceof e||(t=new e(t,this.options)),f(this.major,t.major)||f(this.minor,t.minor)||f(this.patch,t.patch)}},{key:"comparePre",value:function(t){if(t instanceof e||(t=new e(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;var n=0;do{var i=this.prerelease[n],a=t.prerelease[n];if(r("prerelease compare",n,i,a),void 0===i&&void 0===a)return 0;if(void 0===a)return 1;if(void 0===i)return-1;if(i!==a)return f(i,a)}while(++n)}},{key:"compareBuild",value:function(t){t instanceof e||(t=new e(t,this.options));var n=0;do{var i=this.build[n],a=t.build[n];if(r("prerelease compare",n,i,a),void 0===i&&void 0===a)return 0;if(void 0===a)return 1;if(void 0===i)return-1;if(i!==a)return f(i,a)}while(++n)}},{key:"inc",value:function(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{for(var n=this.prerelease.length;--n>=0;)"number"==typeof this.prerelease[n]&&(this.prerelease[n]++,n=-2);-1===n&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error("invalid increment argument: ".concat(e))}return this.format(),this.raw=this.version,this}}]),e}();e.exports=d},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(379),s=n(21),u=n(21),c=function(){function e(e,t,n){var r=this;if(this.dtype=t,this.shape=e.slice(),this.size=s.sizeFromShape(e),null!=n){var i=n.length;s.assert(i===this.size,(function(){return"Length of values '"+i+"' does not match the size inferred by the shape '"+r.size+"'."}))}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||s.getArrayFromDType(t,this.size),this.strides=u.computeStrides(e)}return e.prototype.set=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];0===n.length&&(n=[0]),s.assert(n.length===this.rank,(function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+t.rank+")"}));var i=this.locToIndex(n);this.values[i]=e},e.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];0===e.length&&(e=[0]);for(var n=0,r=0,i=e;r<i.length;r++){var a=i[r];if(a<0||a>=this.shape[n]){var o="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(o)}n++}for(var s=e[e.length-1],u=0;u<e.length-1;++u)s+=this.strides[u]*e[u];return this.values[s]},e.prototype.locToIndex=function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},e.prototype.indexToLoc=function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.toTensor=function(){return l().makeTensor(this.values,this.shape,this.dtype)},e}();t.TensorBuffer=c;var l=null,f=null,d=null;t.setTensorTracker=function(e){l=e},t.setOpHandler=function(e){f=e},t.setDeprecationWarningFn=function(e){d=e};var h=function(){function e(e,t,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=s.sizeFromShape(e),this.strides=u.computeStrides(e),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}return e.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},e.prototype.asScalar=function(){return this.throwIfDisposed(),s.assert(1===this.size,(function(){return"The array must have only 1 element."})),this.reshape([])},e.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},e.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},e.prototype.as3D=function(e,t,n){return this.throwIfDisposed(),this.reshape([e,t,n])},e.prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),this.reshape([e,t,n,r])},e.prototype.as5D=function(e,t,n,r,i){return this.throwIfDisposed(),this.reshape([e,t,n,r,i])},e.prototype.asType=function(e){return this.throwIfDisposed(),f.cast(this,e)},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.buffer=function(){return i(this,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,f.buffer(this.shape,this.dtype,e)]}}))}))},e.prototype.bufferSync=function(){return f.buffer(this.shape,this.dtype,this.dataSync())},e.prototype.array=function(){return i(this,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,u.toNestedArray(this.shape,e)]}}))}))},e.prototype.arraySync=function(){return u.toNestedArray(this.shape,this.dataSync())},e.prototype.data=function(){return i(this,void 0,void 0,(function(){var e,t;return a(this,(function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=l().read(this.dataId),"string"!==this.dtype?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map((function(e){return s.decodeString(e)}))]}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,e]}}))}))},e.prototype.dataSync=function(){this.throwIfDisposed();var e=l().readSync(this.dataId);if("string"===this.dtype)try{return e.map((function(e){return s.decodeString(e)}))}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},e.prototype.bytes=function(){return i(this,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,l().read(this.dataId)];case 1:return e=t.sent(),"string"===this.dtype?[2,e]:[2,new Uint8Array(e.buffer)]}}))}))},e.prototype.dispose=function(){this.isDisposed||(l().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),e.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},e.prototype.toFloat=function(){return this.asType("float32")},e.prototype.toInt=function(){return this.asType("int32")},e.prototype.toBool=function(){return this.asType("bool")},e.prototype.print=function(e){return void 0===e&&(e=!1),f.print(this,e)},e.prototype.reshape=function(e){return this.throwIfDisposed(),f.reshape(this,e)},e.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},e.prototype.expandDims=function(e){return void 0===e&&(e=0),f.expandDims(this,e)},e.prototype.cumsum=function(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=!1),void 0===n&&(n=!1),f.cumsum(this,e,t,n)},e.prototype.squeeze=function(e){return this.throwIfDisposed(),f.squeeze(this,e)},e.prototype.clone=function(){return this.throwIfDisposed(),f.clone(this)},e.prototype.toString=function(e){void 0===e&&(e=!1);var t=this.dataSync();return o.tensorToString(t,this.shape,this.dtype,e)},e.prototype.gather=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),f.gather(this,e,t)},e.prototype.matMul=function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n=!1),this.throwIfDisposed(),f.matMul(this,e,t,n)},e.prototype.dot=function(e){return this.throwIfDisposed(),f.dot(this,e)},e.prototype.norm=function(e,t,n){return void 0===e&&(e="euclidean"),void 0===t&&(t=null),void 0===n&&(n=!1),this.throwIfDisposed(),f.norm(this,e,t,n)},e.prototype.slice=function(e,t){return this.throwIfDisposed(),f.slice(this,e,t)},e.prototype.reverse=function(e){return this.throwIfDisposed(),f.reverse(this,e)},e.prototype.concat=function(t,n){return void 0===n&&(n=0),this.throwIfDisposed(),t instanceof e&&(t=[t]),f.concat([this].concat(t),n)},e.prototype.split=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),f.split(this,e,t)},e.prototype.stack=function(e,t){return void 0===t&&(t=0),f.stack([this,e],t)},e.prototype.unstack=function(e){return void 0===e&&(e=0),f.unstack(this,e)},e.prototype.batchNormalization=function(e,t,n,r,i){return void 0===n&&(n=.001),d("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,i,r,n)},e.prototype.all=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),f.all(this,e,t)},e.prototype.any=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),f.any(this,e,t)},e.prototype.logSumExp=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),f.logSumExp(this,e,t)},e.prototype.sum=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),f.sum(this,e,t)},e.prototype.prod=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),f.prod(this,e,t)},e.prototype.mean=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),f.mean(this,e,t)},e.prototype.min=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),f.min(this,e,t)},e.prototype.max=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),f.max(this,e,t)},e.prototype.argMin=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),f.argMin(this,e)},e.prototype.argMax=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),f.argMax(this,e)},e.prototype.cast=function(e){return this.throwIfDisposed(),f.cast(this,e)},e.prototype.addStrict=function(e){return this.throwIfDisposed(),f.addStrict(this,e)},e.prototype.atan2=function(e){return this.throwIfDisposed(),f.atan2(this,e)},e.prototype.sub=function(e){return this.throwIfDisposed(),f.sub(this,e)},e.prototype.subStrict=function(e){return this.throwIfDisposed(),f.subStrict(this,e)},e.prototype.pow=function(e){return this.throwIfDisposed(),f.pow(this,e)},e.prototype.powStrict=function(e){return this.throwIfDisposed(),f.powStrict(this,e)},e.prototype.mul=function(e){return this.throwIfDisposed(),f.mul(this,e)},e.prototype.mulStrict=function(e){return this.throwIfDisposed(),f.mulStrict(this,e)},e.prototype.floorDiv=function(e){return this.throwIfDisposed(),f.floorDiv(this,e)},e.prototype.divStrict=function(e){return this.throwIfDisposed(),f.divStrict(this,e)},e.prototype.minimum=function(e){return this.throwIfDisposed(),f.minimum(this,e)},e.prototype.minimumStrict=function(e){return this.throwIfDisposed(),f.minimumStrict(this,e)},e.prototype.maximum=function(e){return this.throwIfDisposed(),f.maximum(this,e)},e.prototype.maximumStrict=function(e){return this.throwIfDisposed(),f.maximumStrict(this,e)},e.prototype.mod=function(e){return this.throwIfDisposed(),f.mod(this,e)},e.prototype.modStrict=function(e){return this.throwIfDisposed(),f.modStrict(this,e)},e.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),f.squaredDifferenceStrict(this,e)},e.prototype.notEqual=function(e){return this.throwIfDisposed(),f.notEqual(this,e)},e.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),f.notEqualStrict(this,e)},e.prototype.less=function(e){return this.throwIfDisposed(),f.less(this,e)},e.prototype.lessStrict=function(e){return this.throwIfDisposed(),f.lessStrict(this,e)},e.prototype.equal=function(e){return this.throwIfDisposed(),f.equal(this,e)},e.prototype.equalStrict=function(e){return this.throwIfDisposed(),f.equalStrict(this,e)},e.prototype.lessEqual=function(e){return this.throwIfDisposed(),f.lessEqual(this,e)},e.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),f.lessEqualStrict(this,e)},e.prototype.greater=function(e){return this.throwIfDisposed(),f.greater(this,e)},e.prototype.greaterStrict=function(e){return this.throwIfDisposed(),f.greaterStrict(this,e)},e.prototype.greaterEqual=function(e){return this.throwIfDisposed(),f.greaterEqual(this,e)},e.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),f.greaterEqualStrict(this,e)},e.prototype.logicalAnd=function(e){return this.throwIfDisposed(),f.logicalAnd(this,e)},e.prototype.logicalOr=function(e){return this.throwIfDisposed(),f.logicalOr(this,e)},e.prototype.logicalNot=function(){return this.throwIfDisposed(),f.logicalNot(this)},e.prototype.logicalXor=function(e){return this.throwIfDisposed(),f.logicalXor(this,e)},e.prototype.where=function(e,t){return this.throwIfDisposed(),f.where(e,this,t)},e.prototype.neg=function(){return this.throwIfDisposed(),f.neg(this)},e.prototype.ceil=function(){return this.throwIfDisposed(),f.ceil(this)},e.prototype.floor=function(){return this.throwIfDisposed(),f.floor(this)},e.prototype.sign=function(){return this.throwIfDisposed(),f.sign(this)},e.prototype.isNaN=function(){return this.throwIfDisposed(),f.isNaN(this)},e.prototype.isInf=function(){return this.throwIfDisposed(),f.isInf(this)},e.prototype.isFinite=function(){return this.throwIfDisposed(),f.isFinite(this)},e.prototype.exp=function(){return this.throwIfDisposed(),f.exp(this)},e.prototype.expm1=function(){return this.throwIfDisposed(),f.expm1(this)},e.prototype.log=function(){return this.throwIfDisposed(),f.log(this)},e.prototype.log1p=function(){return this.throwIfDisposed(),f.log1p(this)},e.prototype.sqrt=function(){return this.throwIfDisposed(),f.sqrt(this)},e.prototype.rsqrt=function(){return this.throwIfDisposed(),f.rsqrt(this)},e.prototype.square=function(){return this.throwIfDisposed(),f.square(this)},e.prototype.reciprocal=function(){return this.throwIfDisposed(),f.reciprocal(this)},e.prototype.abs=function(){return this.throwIfDisposed(),f.abs(this)},e.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),f.clipByValue(this,e,t)},e.prototype.relu=function(){return this.throwIfDisposed(),f.relu(this)},e.prototype.relu6=function(){return this.throwIfDisposed(),f.relu6(this)},e.prototype.elu=function(){return this.throwIfDisposed(),f.elu(this)},e.prototype.selu=function(){return this.throwIfDisposed(),f.selu(this)},e.prototype.leakyRelu=function(e){return void 0===e&&(e=.2),this.throwIfDisposed(),f.leakyRelu(this,e)},e.prototype.prelu=function(e){return this.throwIfDisposed(),f.prelu(this,e)},e.prototype.sigmoid=function(){return this.throwIfDisposed(),f.sigmoid(this)},e.prototype.logSigmoid=function(){return this.throwIfDisposed(),f.logSigmoid(this)},e.prototype.softplus=function(){return this.throwIfDisposed(),f.softplus(this)},e.prototype.zerosLike=function(){return this.throwIfDisposed(),f.zerosLike(this)},e.prototype.onesLike=function(){return this.throwIfDisposed(),f.onesLike(this)},e.prototype.sin=function(){return this.throwIfDisposed(),f.sin(this)},e.prototype.cos=function(){return this.throwIfDisposed(),f.cos(this)},e.prototype.tan=function(){return this.throwIfDisposed(),f.tan(this)},e.prototype.asin=function(){return this.throwIfDisposed(),f.asin(this)},e.prototype.acos=function(){return this.throwIfDisposed(),f.acos(this)},e.prototype.atan=function(){return this.throwIfDisposed(),f.atan(this)},e.prototype.sinh=function(){return this.throwIfDisposed(),f.sinh(this)},e.prototype.cosh=function(){return this.throwIfDisposed(),f.cosh(this)},e.prototype.tanh=function(){return this.throwIfDisposed(),f.tanh(this)},e.prototype.asinh=function(){return this.throwIfDisposed(),f.asinh(this)},e.prototype.acosh=function(){return this.throwIfDisposed(),f.acosh(this)},e.prototype.atanh=function(){return this.throwIfDisposed(),f.atanh(this)},e.prototype.erf=function(){return this.throwIfDisposed(),f.erf(this)},e.prototype.round=function(){return this.throwIfDisposed(),f.round(this)},e.prototype.step=function(e){return void 0===e&&(e=0),this.throwIfDisposed(),f.step(this,e)},e.prototype.softmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),f.softmax(this,e)},e.prototype.logSoftmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),f.logSoftmax(this,e)},e.prototype.resizeBilinear=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),f.image.resizeBilinear(this,e,t)},e.prototype.resizeNearestNeighbor=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),f.image.resizeNearestNeighbor(this,e,t)},e.prototype.conv1d=function(e,t,n,r,i,a){return void 0===r&&(r="NWC"),void 0===i&&(i=1),this.throwIfDisposed(),f.conv1d(this,e,t,n,r,i,a)},e.prototype.conv2d=function(e,t,n,r,i,a){return void 0===r&&(r="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),f.conv2d(this,e,t,n,r,i,a)},e.prototype.conv2dTranspose=function(e,t,n,r,i){return this.throwIfDisposed(),f.conv2dTranspose(this,e,t,n,r,i)},e.prototype.depthwiseConv2D=function(e,t,n,r,i,a){return void 0===r&&(r="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),f.depthwiseConv2d(this,e,t,n,r,i,a)},e.prototype.separableConv2d=function(e,t,n,r,i,a){return void 0===i&&(i=[1,1]),void 0===a&&(a="NHWC"),this.throwIfDisposed(),f.separableConv2d(this,e,t,n,r,i,a)},e.prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),f.avgPool(this,e,t,n,r)},e.prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),f.maxPool(this,e,t,n,r)},e.prototype.localResponseNormalization=function(e,t,n,r){return void 0===e&&(e=5),void 0===t&&(t=1),void 0===n&&(n=1),void 0===r&&(r=.5),f.localResponseNormalization(this,e,t,n,r)},e.prototype.pool=function(e,t,n,r,i){return this.throwIfDisposed(),f.pool(this,e,t,n,r,i)},e.prototype.variable=function(e,t,n){return void 0===e&&(e=!0),this.throwIfDisposed(),l().makeVariable(this,e,t,n)},e.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),f.unsortedSegmentSum(this,e,t)},e.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),f.batchToSpaceND(this,e,t)},e.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),f.spaceToBatchND(this,e,t)},e.prototype.topk=function(e,t){return void 0===e&&(e=1),void 0===t&&(t=!0),this.throwIfDisposed(),f.topk(this,e,t)},e.prototype.stridedSlice=function(e,t,n,r,i,a,o,s){return void 0===r&&(r=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=0),this.throwIfDisposed(),f.stridedSlice(this,e,t,n,r,i,a,o,s)},e.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),f.depthToSpace(this,e,t)},e.prototype.fft=function(){return this.throwIfDisposed(),f.spectral.fft(this)},e.prototype.ifft=function(){return this.throwIfDisposed(),f.spectral.ifft(this)},e.prototype.rfft=function(){return this.throwIfDisposed(),f.spectral.rfft(this)},e.prototype.irfft=function(){return this.throwIfDisposed(),f.spectral.irfft(this)},e}();t.Tensor=h,Object.defineProperty(h,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.dataId&&null!=e.shape&&null!=e.dtype}});var p=function(e){function t(t,n,r,i){var a=e.call(this,t.shape,t.dtype,t.dataId,i)||this;return a.trainable=n,a.name=r,a}return r(t,e),t.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!s.arraysEqual(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");l().disposeTensor(this),this.dataId=e.dataId,l().incRef(this,null)},t.prototype.dispose=function(){l().disposeVariable(this),this.isDisposedInternal=!0},t}(h);t.Variable=p,Object.defineProperty(p,Symbol.hasInstance,{value:function(e){return e instanceof h&&null!=e.assign&&e.assign instanceof Function}})},function(e,t,n){var r=n(61);e.exports=function(e){return Object(r(e))}},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},e.exports.__esModule=!0,e.exports.default=e.exports,n(t)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){"use strict";var r=n(195),i=Object.prototype.toString;function a(e){return"[object Array]"===i.call(e)}function o(e){return void 0===e}function s(e){return null!==e&&"object"==typeof e}function u(e){if("[object Object]"!==i.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function c(e){return"[object Function]"===i.call(e)}function l(e,t){if(null!==e&&void 0!==e)if("object"!=typeof e&&(e=[e]),a(e))for(var n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}e.exports={isArray:a,isArrayBuffer:function(e){return"[object ArrayBuffer]"===i.call(e)},isBuffer:function(e){return null!==e&&!o(e)&&null!==e.constructor&&!o(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:s,isPlainObject:u,isUndefined:o,isDate:function(e){return"[object Date]"===i.call(e)},isFile:function(e){return"[object File]"===i.call(e)},isBlob:function(e){return"[object Blob]"===i.call(e)},isFunction:c,isStream:function(e){return s(e)&&c(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:l,merge:function e(){var t={};function n(n,r){u(t[r])&&u(n)?t[r]=e(t[r],n):u(n)?t[r]=e({},n):a(n)?t[r]=n.slice():t[r]=n}for(var r=0,i=arguments.length;r<i;r++)l(arguments[r],n);return t},extend:function(e,t,n){return l(t,(function(t,i){e[i]=n&&"function"==typeof t?r(t,n):t})),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}}},function(e,t,n){var r=n(8),i=n(15),a=n(61),o=/"/g,s=function(e,t,n,r){var i=String(a(e)),s="<"+t;return""!==n&&(s+=" "+n+'="'+String(r).replace(o,"&quot;")+'"'),s+">"+i+"</"+t+">"};e.exports=function(e,t){var n={};n[e]=t(s),r(r.P+r.F*i((function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3})),"String",n)}},function(e,t,n){var r=n(16),i=n(42),a=n(43),o=n(84)("src"),s=n(576),u=(""+s).split("toString");n(24).inspectSource=function(e){return s.call(e)},(e.exports=function(e,t,n,s){var c="function"==typeof n;c&&(a(n,"name")||i(n,"name",t)),e[t]!==n&&(c&&(a(n,o)||i(n,o,e[t]?""+e[t]:u.join(String(t)))),e===r?e[t]=n:s?e[t]?e[t]=n:i(e,t,n):(delete e[t],i(e,t,n)))})(Function.prototype,"toString",(function(){return"function"==typeof this&&this[o]||s.call(this)}))},function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return s})),n.d(t,"c",(function(){return l}));var r=n(31),i=n(12);function a(e){return Object(r.a)((function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+7*t)}),(function(e,t){return(t-e)/i.f}))}var o=a(0),s=a(1),u=a(2),c=a(3),l=a(4),f=a(5),d=a(6);o.range,s.range,u.range,c.range,l.range,f.range,d.range},function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return s})),n.d(t,"c",(function(){return l}));var r=n(31),i=n(12);function a(e){return Object(r.a)((function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+7*t)}),(function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*i.c)/i.f}))}var o=a(0),s=a(1),u=a(2),c=a(3),l=a(4),f=a(5),d=a(6);o.range,s.range,u.range,c.range,l.range,f.range,d.range},function(e,t,n){var r=n(107),i=n(61);e.exports=function(e){return r(i(e))}},function(e,t,n){var r=n(26),i=n(85);e.exports=n(27)?function(e,t,n){return r.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t,n){"use strict";var r=n(45),i=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function a(e){if(!(t=i.exec(e)))throw new Error("invalid format: "+e);var t;return new o({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function o(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function s(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}a.prototype=o.prototype,o.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var u,c,l,f,d=function(e){return(e=s(Math.abs(e)))?e[1]:NaN},h=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(d(t)/3)))-d(Math.abs(e)))},p=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,d(t)-d(e))+1},m=function(e){return Math.max(0,-d(Math.abs(e)))},v=function(e){e:for(var t,n=e.length,r=1,i=-1;r<n;++r)switch(e[r]){case".":i=t=r;break;case"0":0===i&&(i=r),t=r;break;default:if(!+e[r])break e;i>0&&(i=0)}return i>0?e.slice(0,i)+e.slice(t+1):e},g=function(e,t){var n=s(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")},y={"%":function(e,t){return(100*e).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return g(100*e,t)},r:g,s:function(e,t){var n=s(e,t);if(!n)return e+"";var r=n[0],i=n[1],a=i-(u=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,o=r.length;return a===o?r:a>o?r+new Array(a-o+1).join("0"):a>0?r.slice(0,a)+"."+r.slice(a):"0."+new Array(1-a).join("0")+s(e,Math.max(0,t+a-1))[0]},X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}},b=function(e){return e},x=Array.prototype.map,w=["y","z","a","f","p","n","\xb5","m","","k","M","G","T","P","E","Z","Y"],_=function(e){var t=void 0===e.grouping||void 0===e.thousands?b:function(e,t){return function(n,r){for(var i=n.length,a=[],o=0,s=e[0],u=0;i>0&&s>0&&(u+s+1>r&&(s=Math.max(1,r-u)),a.push(n.substring(i-=s,i+s)),!((u+=s+1)>r));)s=e[o=(o+1)%e.length];return a.reverse().join(t)}}(x.call(e.grouping,Number),e.thousands+""),n=void 0===e.currency?"":e.currency[0]+"",r=void 0===e.currency?"":e.currency[1]+"",i=void 0===e.decimal?".":e.decimal+"",o=void 0===e.numerals?b:function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}(x.call(e.numerals,String)),s=void 0===e.percent?"%":e.percent+"",c=void 0===e.minus?"\u2212":e.minus+"",l=void 0===e.nan?"NaN":e.nan+"";function f(e){var f=(e=a(e)).fill,d=e.align,h=e.sign,p=e.symbol,m=e.zero,g=e.width,b=e.comma,x=e.precision,_=e.trim,k=e.type;"n"===k?(b=!0,k="g"):y[k]||(void 0===x&&(x=12),_=!0,k="g"),(m||"0"===f&&"="===d)&&(m=!0,f="0",d="=");var E="$"===p?n:"#"===p&&/[boxX]/.test(k)?"0"+k.toLowerCase():"",S="$"===p?r:/[%p]/.test(k)?s:"",C=y[k],A=/[defgprs%]/.test(k);function O(e){var n,r,a,s=E,p=S;if("c"===k)p=C(e)+p,e="";else{var y=(e=+e)<0||1/e<0;if(e=isNaN(e)?l:C(Math.abs(e),x),_&&(e=v(e)),y&&0==+e&&"+"!==h&&(y=!1),s=(y?"("===h?h:c:"-"===h||"("===h?"":h)+s,p=("s"===k?w[8+u/3]:"")+p+(y&&"("===h?")":""),A)for(n=-1,r=e.length;++n<r;)if(48>(a=e.charCodeAt(n))||a>57){p=(46===a?i+e.slice(n+1):e.slice(n))+p,e=e.slice(0,n);break}}b&&!m&&(e=t(e,1/0));var O=s.length+e.length+p.length,D=O<g?new Array(g-O+1).join(f):"";switch(b&&m&&(e=t(D+e,D.length?g-p.length:1/0),D=""),d){case"<":e=s+e+p+D;break;case"=":e=s+D+e+p;break;case"^":e=D.slice(0,O=D.length>>1)+s+e+p+D.slice(O);break;default:e=D+s+e+p}return o(e)}return x=void 0===x?6:/[gprs]/.test(k)?Math.max(1,Math.min(21,x)):Math.max(0,Math.min(20,x)),O.toString=function(){return e+""},O}return{format:f,formatPrefix:function(e,t){var n=f(((e=a(e)).type="f",e)),r=3*Math.max(-8,Math.min(8,Math.floor(d(t)/3))),i=Math.pow(10,-r),o=w[8+r/3];return function(e){return n(i*e)+o}}}};c=_({thousands:",",grouping:[3],currency:["$",""]}),l=c.format,f=c.formatPrefix;var k,E,S=n(11),C=n(1),A=n(100),O=n(246);function D(e){var t={};return function(n){return t[n]||(t[n]=e(n))}}function T(e){var t=D(e.format),n=e.formatPrefix;return{format:t,formatPrefix:n,formatFloat:function(e){var n=a(e||",");if(null==n.precision){switch(n.precision=12,n.type){case"%":n.precision-=2;break;case"e":n.precision-=1}return function(e,t){return function(n){var r=e(n),i=r.indexOf(t);if(i<0)return r;for(var a=function(e,t){var n,r=e.lastIndexOf("e");if(r>0)return r;for(r=e.length;--r>t;)if((n=e.charCodeAt(r))>=48&&n<=57)return r+1}(r,i),o=a<r.length?r.slice(a):"";--a>i;)if("0"!==r[a]){++a;break}return r.slice(0,a)+o}}(t(n),t(".1f")(1)[1])}return t(n)},formatSpan:function(e,i,o,s){s=a(null==s?",f":s);var u,c=Object(r.c)(e,i,o),l=Math.max(Math.abs(e),Math.abs(i));if(null==s.precision)switch(s.type){case"s":return isNaN(u=h(c,l))||(s.precision=u),n(s,l);case"":case"e":case"g":case"p":case"r":isNaN(u=p(c,l))||(s.precision=u-("e"===s.type));break;case"f":case"%":isNaN(u=m(c))||(s.precision=u-2*("%"===s.type))}return t(s)}}}function j(){return k=T({format:l,formatPrefix:f})}function M(e){return T(_(e))}function F(e){return arguments.length?k=M(e):k}function I(e,t,n){n=n||{},Object(C.H)(n)||Object(C.o)("Invalid time multi-format specifier: ".concat(n));var r=t(S.i),i=t(S.f),a=t(S.d),o=t(S.a),s=t(S.k),u=t(S.g),c=t(S.h),l=t(S.l),f=e(n[S.e]||".%L"),d=e(n[S.i]||":%S"),h=e(n[S.f]||"%I:%M"),p=e(n[S.d]||"%I %p"),m=e(n[S.a]||n[S.b]||"%a %d"),v=e(n[S.k]||"%b %d"),g=e(n[S.g]||"%B"),y=e(n[S.h]||"%B"),b=e(n[S.l]||"%Y");return function(e){return(r(e)<e?f:i(e)<e?d:a(e)<e?h:o(e)<e?p:u(e)<e?s(e)<e?m:v:l(e)<e?c(e)<e?g:y:b)(e)}}function N(e){var t=D(e.format),n=D(e.utcFormat);return{timeFormat:function(e){return Object(C.J)(e)?t(e):I(t,S.p,e)},utcFormat:function(e){return Object(C.J)(e)?n(e):I(n,S.v,e)},timeParse:D(e.parse),utcParse:D(e.utcParse)}}function R(){return E=N({format:A.a,parse:A.b,utcFormat:A.c,utcParse:A.d})}function P(e){return N(Object(O.a)(e))}function B(e){return arguments.length?E=P(e):E}n.d(t,"a",(function(){return U})),n.d(t,"b",(function(){return z})),n.d(t,"c",(function(){return F})),n.d(t,"d",(function(){return W})),n.d(t,"e",(function(){return B})),j(),R();var L=function(e,t){return Object(C.p)({},e,t)};function z(e,t){var n=e?M(e):F(),r=t?P(t):B();return L(n,r)}function U(e,t){var n=arguments.length;return n&&2!==n&&Object(C.o)("defaultLocale expects either zero or two arguments."),n?L(F(e),B(t)):L(F(),B())}function W(){return j(),R(),U()}},function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return s}));var r=Math.sqrt(50),i=Math.sqrt(10),a=Math.sqrt(2);function o(e,t,n){var o=(t-e)/Math.max(0,n),s=Math.floor(Math.log(o)/Math.LN10),u=o/Math.pow(10,s);return s>=0?(u>=r?10:u>=i?5:u>=a?2:1)*Math.pow(10,s):-Math.pow(10,-s)/(u>=r?10:u>=i?5:u>=a?2:1)}function s(e,t,n){var o=Math.abs(t-e)/Math.max(0,n),s=Math.pow(10,Math.floor(Math.log(o)/Math.LN10)),u=o/s;return u>=r?s*=10:u>=i?s*=5:u>=a&&(s*=2),t<e?-s:s}t.a=function(e,t,n){var r,i,a,s,u=-1;if(n=+n,(e=+e)===(t=+t)&&n>0)return[e];if((r=t<e)&&(i=e,e=t,t=i),0===(s=o(e,t,n))||!isFinite(s))return[];if(s>0){var c=Math.round(e/s),l=Math.round(t/s);for(c*s<e&&++c,l*s>t&&--l,a=new Array(i=l-c+1);++u<i;)a[u]=(c+u)*s}else{s=-s;var f=Math.round(e*s),d=Math.round(t*s);for(f/s<e&&++f,d/s>t&&--d,a=new Array(i=d-f+1);++u<i;)a[u]=(f+u)/s}return r&&a.reverse(),a}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(198),a=n(197);t.getDrawArea=function(e){if(e instanceof HTMLElement)return e;if(i.isSurface(e))return e.drawArea;if(i.isSurfaceInfo(e))return a.visor().surface({name:e.name,tab:e.tab,styles:e.styles}).drawArea;throw new Error("Not a drawable")},t.shallowEquals=function(e,t){var n=Object.getOwnPropertyNames(e),r=Object.getOwnPropertyNames(t);if(n.length!==r.length)return!1;for(var i=0;i<n.length;i++){var a=n[i];if(e[a]!==t[a])return!1}return!0},t.nextFrame=function(){return r(this,void 0,void 0,m().mark((function e(){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){return requestAnimationFrame(e)}));case 2:case"end":return e.stop()}}),e)})))}},function(e,t,n){var r=function(){"use strict";function e(t,n){var r=this;if(v(this,e),n=a(n),t instanceof e)return t.loose===!!n.loose&&t.includePrerelease===!!n.includePrerelease?t:new e(t.raw,n);if(t instanceof o)return this.raw=t.value,this.set=[[t]],this.format(),this;if(this.options=n,this.loose=!!n.loose,this.includePrerelease=!!n.includePrerelease,this.raw=t,this.set=t.split(/\s*\|\|\s*/).map((function(e){return r.parseRange(e.trim())})).filter((function(e){return e.length})),!this.set.length)throw new TypeError("Invalid SemVer Range: ".concat(t));if(this.set.length>1){var i=this.set[0];if(this.set=this.set.filter((function(e){return!b(e[0])})),0===this.set.length)this.set=[i];else if(this.set.length>1){var s,u=p(this.set);try{for(u.s();!(s=u.n()).done;){var c=s.value;if(1===c.length&&x(c[0])){this.set=[c];break}}}catch(l){u.e(l)}finally{u.f()}}}this.format()}return g(e,[{key:"format",value:function(){return this.range=this.set.map((function(e){return e.join(" ").trim()})).join("||").trim(),this.range}},{key:"toString",value:function(){return this.range}},{key:"parseRange",value:function(e){var t=this;e=e.trim();var n="parseRange:".concat(Object.keys(this.options).join(","),":").concat(e),r=i.get(n);if(r)return r;var a=this.options.loose,u=a?l[f.HYPHENRANGELOOSE]:l[f.HYPHENRANGE];e=e.replace(u,M(this.options.includePrerelease)),s("hyphen replace",e),e=e.replace(l[f.COMPARATORTRIM],d),s("comparator trim",e,l[f.COMPARATORTRIM]),e=(e=(e=e.replace(l[f.TILDETRIM],m)).replace(l[f.CARETTRIM],y)).split(/\s+/).join(" ");var c,v=a?l[f.COMPARATORLOOSE]:l[f.COMPARATOR],g=e.split(" ").map((function(e){return _(e,t.options)})).join(" ").split(/\s+/).map((function(e){return j(e,t.options)})).filter(this.options.loose?function(e){return!!e.match(v)}:function(){return!0}).map((function(e){return new o(e,t.options)})),x=(g.length,new Map),w=p(g);try{for(w.s();!(c=w.n()).done;){var k=c.value;if(b(k))return[k];x.set(k.value,k)}}catch(S){w.e(S)}finally{w.f()}x.size>1&&x.has("")&&x.delete("");var E=h(x.values());return i.set(n,E),E}},{key:"intersects",value:function(t,n){if(!(t instanceof e))throw new TypeError("a Range is required");return this.set.some((function(e){return w(e,n)&&t.set.some((function(t){return w(t,n)&&e.every((function(e){return t.every((function(t){return e.intersects(t,n)}))}))}))}))}},{key:"test",value:function(e){if(!e)return!1;if("string"==typeof e)try{e=new u(e,this.options)}catch(e){return!1}for(var t=0;t<this.set.length;t++)if(F(this.set[t],e,this.options))return!0;return!1}}]),e}();e.exports=r;var i=new(n(335))({max:1e3}),a=n(115),o=n(113),s=n(116),u=n(32),c=n(90),l=c.re,f=c.t,d=c.comparatorTrimReplace,m=c.tildeTrimReplace,y=c.caretTrimReplace,b=function(e){return"<0.0.0-0"===e.value},x=function(e){return""===e.value},w=function(e,t){for(var n=!0,r=e.slice(),i=r.pop();n&&r.length;)n=r.every((function(e){return i.intersects(e,t)})),i=r.pop();return n},_=function(e,t){return s("comp",e,t),e=C(e,t),s("caret",e),e=E(e,t),s("tildes",e),e=O(e,t),s("xrange",e),e=T(e,t),s("stars",e),e},k=function(e){return!e||"x"===e.toLowerCase()||"*"===e},E=function(e,t){return e.trim().split(/\s+/).map((function(e){return S(e,t)})).join(" ")},S=function(e,t){var n=t.loose?l[f.TILDELOOSE]:l[f.TILDE];return e.replace(n,(function(t,n,r,i,a){var o;return s("tilde",e,t,n,r,i,a),k(n)?o="":k(r)?o=">=".concat(n,".0.0 <").concat(+n+1,".0.0-0"):k(i)?o=">=".concat(n,".").concat(r,".0 <").concat(n,".").concat(+r+1,".0-0"):a?(s("replaceTilde pr",a),o=">=".concat(n,".").concat(r,".").concat(i,"-").concat(a," <").concat(n,".").concat(+r+1,".0-0")):o=">=".concat(n,".").concat(r,".").concat(i," <").concat(n,".").concat(+r+1,".0-0"),s("tilde return",o),o}))},C=function(e,t){return e.trim().split(/\s+/).map((function(e){return A(e,t)})).join(" ")},A=function(e,t){s("caret",e,t);var n=t.loose?l[f.CARETLOOSE]:l[f.CARET],r=t.includePrerelease?"-0":"";return e.replace(n,(function(t,n,i,a,o){var u;return s("caret",e,t,n,i,a,o),k(n)?u="":k(i)?u=">=".concat(n,".0.0").concat(r," <").concat(+n+1,".0.0-0"):k(a)?u="0"===n?">=".concat(n,".").concat(i,".0").concat(r," <").concat(n,".").concat(+i+1,".0-0"):">=".concat(n,".").concat(i,".0").concat(r," <").concat(+n+1,".0.0-0"):o?(s("replaceCaret pr",o),u="0"===n?"0"===i?">=".concat(n,".").concat(i,".").concat(a,"-").concat(o," <").concat(n,".").concat(i,".").concat(+a+1,"-0"):">=".concat(n,".").concat(i,".").concat(a,"-").concat(o," <").concat(n,".").concat(+i+1,".0-0"):">=".concat(n,".").concat(i,".").concat(a,"-").concat(o," <").concat(+n+1,".0.0-0")):(s("no pr"),u="0"===n?"0"===i?">=".concat(n,".").concat(i,".").concat(a).concat(r," <").concat(n,".").concat(i,".").concat(+a+1,"-0"):">=".concat(n,".").concat(i,".").concat(a).concat(r," <").concat(n,".").concat(+i+1,".0-0"):">=".concat(n,".").concat(i,".").concat(a," <").concat(+n+1,".0.0-0")),s("caret return",u),u}))},O=function(e,t){return s("replaceXRanges",e,t),e.split(/\s+/).map((function(e){return D(e,t)})).join(" ")},D=function(e,t){e=e.trim();var n=t.loose?l[f.XRANGELOOSE]:l[f.XRANGE];return e.replace(n,(function(n,r,i,a,o,u){s("xRange",e,n,r,i,a,o,u);var c=k(i),l=c||k(a),f=l||k(o),d=f;return"="===r&&d&&(r=""),u=t.includePrerelease?"-0":"",c?n=">"===r||"<"===r?"<0.0.0-0":"*":r&&d?(l&&(a=0),o=0,">"===r?(r=">=",l?(i=+i+1,a=0,o=0):(a=+a+1,o=0)):"<="===r&&(r="<",l?i=+i+1:a=+a+1),"<"===r&&(u="-0"),n="".concat(r+i,".").concat(a,".").concat(o).concat(u)):l?n=">=".concat(i,".0.0").concat(u," <").concat(+i+1,".0.0-0"):f&&(n=">=".concat(i,".").concat(a,".0").concat(u," <").concat(i,".").concat(+a+1,".0-0")),s("xRange return",n),n}))},T=function(e,t){return s("replaceStars",e,t),e.trim().replace(l[f.STAR],"")},j=function(e,t){return s("replaceGTE0",e,t),e.trim().replace(l[t.includePrerelease?f.GTE0PRE:f.GTE0],"")},M=function(e){return function(t,n,r,i,a,o,s,u,c,l,f,d,h){return"".concat(n=k(r)?"":k(i)?">=".concat(r,".0.0").concat(e?"-0":""):k(a)?">=".concat(r,".").concat(i,".0").concat(e?"-0":""):o?">=".concat(n):">=".concat(n).concat(e?"-0":"")," ").concat(u=k(c)?"":k(l)?"<".concat(+c+1,".0.0-0"):k(f)?"<".concat(c,".").concat(+l+1,".0-0"):d?"<=".concat(c,".").concat(l,".").concat(f,"-").concat(d):e?"<".concat(c,".").concat(l,".").concat(+f+1,"-0"):"<=".concat(u)).trim()}},F=function(e,t,n){for(var r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length&&!n.includePrerelease){for(var i=0;i<e.length;i++)if(s(e[i].semver),e[i].semver!==o.ANY&&e[i].semver.prerelease.length>0){var a=e[i].semver;if(a.major===t.major&&a.minor===t.minor&&a.patch===t.patch)return!0}return!1}return!0}},function(e,t,n){var r=n(32);e.exports=function(e,t,n){return new r(e,n).compare(new r(t,n))}},function(e,t,n){"use strict";var r=n(15);e.exports=function(e,t){return!!e&&r((function(){t?e.call(null,(function(){}),1):e.call(null)}))}},function(e,t,n){"use strict";n.r(t);var r=function(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]},i=function(e){return(e=r(Math.abs(e)))?e[1]:NaN},a=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function o(e){return new s(e)}function s(e){if(!(t=a.exec(e)))throw new Error("invalid format: "+e);var t;this.fill=t[1]||" ",this.align=t[2]||">",this.sign=t[3]||"-",this.symbol=t[4]||"",this.zero=!!t[5],this.width=t[6]&&+t[6],this.comma=!!t[7],this.precision=t[8]&&+t[8].slice(1),this.trim=!!t[9],this.type=t[10]||""}o.prototype=s.prototype,s.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(null==this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(null==this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var u,c,l,f,d=function(e){e:for(var t,n=e.length,r=1,i=-1;r<n;++r)switch(e[r]){case".":i=t=r;break;case"0":0===i&&(i=r),t=r;break;default:if(i>0){if(!+e[r])break e;i=0}}return i>0?e.slice(0,i)+e.slice(t+1):e},h=function(e,t){var n=r(e,t);if(!n)return e+"";var i=n[0],a=n[1];return a<0?"0."+new Array(-a).join("0")+i:i.length>a+1?i.slice(0,a+1)+"."+i.slice(a+1):i+new Array(a-i.length+2).join("0")},p={"%":function(e,t){return(100*e).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:function(e){return Math.round(e).toString(10)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return h(100*e,t)},r:h,s:function(e,t){var n=r(e,t);if(!n)return e+"";var i=n[0],a=n[1],o=a-(u=3*Math.max(-8,Math.min(8,Math.floor(a/3))))+1,s=i.length;return o===s?i:o>s?i+new Array(o-s+1).join("0"):o>0?i.slice(0,o)+"."+i.slice(o):"0."+new Array(1-o).join("0")+r(e,Math.max(0,t+o-1))[0]},X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}},m=function(e){return e},v=["y","z","a","f","p","n","\xb5","m","","k","M","G","T","P","E","Z","Y"],g=function(e){var t=e.grouping&&e.thousands?function(e,t){return function(n,r){for(var i=n.length,a=[],o=0,s=e[0],u=0;i>0&&s>0&&(u+s+1>r&&(s=Math.max(1,r-u)),a.push(n.substring(i-=s,i+s)),!((u+=s+1)>r));)s=e[o=(o+1)%e.length];return a.reverse().join(t)}}(e.grouping,e.thousands):m,n=e.currency,r=e.decimal,a=e.numerals?function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}(e.numerals):m,s=e.percent||"%";function c(e){var i=(e=o(e)).fill,c=e.align,l=e.sign,f=e.symbol,h=e.zero,m=e.width,g=e.comma,y=e.precision,b=e.trim,x=e.type;"n"===x?(g=!0,x="g"):p[x]||(null==y&&(y=12),b=!0,x="g"),(h||"0"===i&&"="===c)&&(h=!0,i="0",c="=");var w="$"===f?n[0]:"#"===f&&/[boxX]/.test(x)?"0"+x.toLowerCase():"",_="$"===f?n[1]:/[%p]/.test(x)?s:"",k=p[x],E=/[defgprs%]/.test(x);function S(e){var n,o,s,f=w,p=_;if("c"===x)p=k(e)+p,e="";else{var S=(e=+e)<0;if(e=k(Math.abs(e),y),b&&(e=d(e)),S&&0==+e&&(S=!1),f=(S?"("===l?l:"-":"-"===l||"("===l?"":l)+f,p=("s"===x?v[8+u/3]:"")+p+(S&&"("===l?")":""),E)for(n=-1,o=e.length;++n<o;)if(48>(s=e.charCodeAt(n))||s>57){p=(46===s?r+e.slice(n+1):e.slice(n))+p,e=e.slice(0,n);break}}g&&!h&&(e=t(e,1/0));var C=f.length+e.length+p.length,A=C<m?new Array(m-C+1).join(i):"";switch(g&&h&&(e=t(A+e,A.length?m-p.length:1/0),A=""),c){case"<":e=f+e+p+A;break;case"=":e=f+A+e+p;break;case"^":e=A.slice(0,C=A.length>>1)+f+e+p+A.slice(C);break;default:e=A+f+e+p}return a(e)}return y=null==y?6:/[gprs]/.test(x)?Math.max(1,Math.min(21,y)):Math.max(0,Math.min(20,y)),S.toString=function(){return e+""},S}return{format:c,formatPrefix:function(e,t){var n=c(((e=o(e)).type="f",e)),r=3*Math.max(-8,Math.min(8,Math.floor(i(t)/3))),a=Math.pow(10,-r),s=v[8+r/3];return function(e){return n(a*e)+s}}}};function y(e){return c=g(e),l=c.format,f=c.formatPrefix,c}y({decimal:".",thousands:",",grouping:[3],currency:["$",""]});var b=function(e){return Math.max(0,-i(Math.abs(e)))},x=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(i(t)/3)))-i(Math.abs(e)))},w=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,i(t)-i(e))+1};n.d(t,"formatDefaultLocale",(function(){return y})),n.d(t,"format",(function(){return l})),n.d(t,"formatPrefix",(function(){return f})),n.d(t,"formatLocale",(function(){return g})),n.d(t,"formatSpecifier",(function(){return o})),n.d(t,"precisionFixed",(function(){return b})),n.d(t,"precisionPrefix",(function(){return x})),n.d(t,"precisionRound",(function(){return w}))},function(e,t,n){var r=n(56),i=n(107),a=n(34),o=n(22),s=n(224);e.exports=function(e,t){var n=1==e,u=2==e,c=3==e,l=4==e,f=6==e,d=5==e||f,h=t||s;return function(t,s,p){for(var m,v,g=a(t),y=i(g),b=r(s,p,3),x=o(y.length),w=0,_=n?h(t,x):u?h(t,0):void 0;x>w;w++)if((d||w in y)&&(v=b(m=y[w],w,g),e))if(n)_[w]=v;else if(v)switch(e){case 3:return!0;case 5:return m;case 6:return w;case 2:_.push(m)}else if(l)return!1;return f?-1:c||l?l:_}}},function(e,t,n){var r=n(8),i=n(24),a=n(15);e.exports=function(e,t){var n=(i.Object||{})[e]||Object[e],o={};o[e]=t(n),r(r.S+r.F*a((function(){n(1)})),"Object",o)}},function(e,t,n){var r=n(106),i=n(85),a=n(41),o=n(66),s=n(43),u=n(240),c=Object.getOwnPropertyDescriptor;t.f=n(27)?c:function(e,t){if(e=a(e),t=o(t,!0),u)try{return c(e,t)}catch(e){}if(s(e,t))return i(!r.f.call(e,t),e[t])}},function(e,t){var n=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:n)(e)}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,n){var r=n(55);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},function(e,t,n){var r=n(7).default,i=n(258);e.exports=function(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return i(e)},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){var r=n(259);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&r(e,t)},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";if(n(27)){var r=n(83),i=n(16),a=n(15),o=n(8),s=n(118),u=n(151),c=n(56),l=n(94),f=n(85),d=n(42),h=n(93),p=n(54),m=n(22),v=n(213),g=n(81),y=n(66),b=n(43),x=n(105),w=n(13),_=n(34),k=n(159),E=n(80),S=n(78),C=n(79).f,A=n(157),O=n(84),D=n(19),T=n(51),j=n(128),M=n(104),F=n(155),I=n(96),N=n(125),R=n(95),P=n(156),B=n(222),L=n(26),z=n(53),U=L.f,W=z.f,V=i.RangeError,G=i.TypeError,q=i.Uint8Array,H=Array.prototype,X=u.ArrayBuffer,K=u.DataView,Y=T(0),$=T(2),J=T(3),Z=T(4),Q=T(5),ee=T(6),te=j(!0),ne=j(!1),re=F.values,ie=F.keys,ae=F.entries,oe=H.lastIndexOf,se=H.reduce,ue=H.reduceRight,ce=H.join,le=H.sort,fe=H.slice,de=H.toString,he=H.toLocaleString,pe=D("iterator"),me=D("toStringTag"),ve=O("typed_constructor"),ge=O("def_constructor"),ye=s.CONSTR,be=s.TYPED,xe=s.VIEW,we=T(1,(function(e,t){return Ce(M(e,e[ge]),t)})),_e=a((function(){return 1===new q(new Uint16Array([1]).buffer)[0]})),ke=!!q&&!!q.prototype.set&&a((function(){new q(1).set({})})),Ee=function(e,t){var n=p(e);if(n<0||n%t)throw V("Wrong offset!");return n},Se=function(e){if(w(e)&&be in e)return e;throw G(e+" is not a typed array!")},Ce=function(e,t){if(!w(e)||!(ve in e))throw G("It is not a typed array constructor!");return new e(t)},Ae=function(e,t){return Oe(M(e,e[ge]),t)},Oe=function(e,t){for(var n=0,r=t.length,i=Ce(e,r);r>n;)i[n]=t[n++];return i},De=function(e,t,n){U(e,t,{get:function(){return this._d[n]}})},Te=function(e){var t,n,r,i,a,o,s=_(e),u=arguments.length,l=u>1?arguments[1]:void 0,f=void 0!==l,d=A(s);if(void 0!=d&&!k(d)){for(o=d.call(s),r=[],t=0;!(a=o.next()).done;t++)r.push(a.value);s=r}for(f&&u>2&&(l=c(l,arguments[2],2)),t=0,n=m(s.length),i=Ce(this,n);n>t;t++)i[t]=f?l(s[t],t):s[t];return i},je=function(){for(var e=0,t=arguments.length,n=Ce(this,t);t>e;)n[e]=arguments[e++];return n},Me=!!q&&a((function(){he.call(new q(1))})),Fe=function(){return he.apply(Me?fe.call(Se(this)):Se(this),arguments)},Ie={copyWithin:function(e,t){return B.call(Se(this),e,t,arguments.length>2?arguments[2]:void 0)},every:function(e){return Z(Se(this),e,arguments.length>1?arguments[1]:void 0)},fill:function(e){return P.apply(Se(this),arguments)},filter:function(e){return Ae(this,$(Se(this),e,arguments.length>1?arguments[1]:void 0))},find:function(e){return Q(Se(this),e,arguments.length>1?arguments[1]:void 0)},findIndex:function(e){return ee(Se(this),e,arguments.length>1?arguments[1]:void 0)},forEach:function(e){Y(Se(this),e,arguments.length>1?arguments[1]:void 0)},indexOf:function(e){return ne(Se(this),e,arguments.length>1?arguments[1]:void 0)},includes:function(e){return te(Se(this),e,arguments.length>1?arguments[1]:void 0)},join:function(e){return ce.apply(Se(this),arguments)},lastIndexOf:function(e){return oe.apply(Se(this),arguments)},map:function(e){return we(Se(this),e,arguments.length>1?arguments[1]:void 0)},reduce:function(e){return se.apply(Se(this),arguments)},reduceRight:function(e){return ue.apply(Se(this),arguments)},reverse:function(){for(var e,t=Se(this).length,n=Math.floor(t/2),r=0;r<n;)e=this[r],this[r++]=this[--t],this[t]=e;return this},some:function(e){return J(Se(this),e,arguments.length>1?arguments[1]:void 0)},sort:function(e){return le.call(Se(this),e)},subarray:function(e,t){var n=Se(this),r=n.length,i=g(e,r);return new(M(n,n[ge]))(n.buffer,n.byteOffset+i*n.BYTES_PER_ELEMENT,m((void 0===t?r:g(t,r))-i))}},Ne=function(e,t){return Ae(this,fe.call(Se(this),e,t))},Re=function(e){Se(this);var t=Ee(arguments[1],1),n=this.length,r=_(e),i=m(r.length),a=0;if(i+t>n)throw V("Wrong length!");for(;a<i;)this[t+a]=r[a++]},Pe={entries:function(){return ae.call(Se(this))},keys:function(){return ie.call(Se(this))},values:function(){return re.call(Se(this))}},Be=function(e,t){return w(e)&&e[be]&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},Le=function(e,t){return Be(e,t=y(t,!0))?f(2,e[t]):W(e,t)},ze=function(e,t,n){return!(Be(e,t=y(t,!0))&&w(n)&&b(n,"value"))||b(n,"get")||b(n,"set")||n.configurable||b(n,"writable")&&!n.writable||b(n,"enumerable")&&!n.enumerable?U(e,t,n):(e[t]=n.value,e)};ye||(z.f=Le,L.f=ze),o(o.S+o.F*!ye,"Object",{getOwnPropertyDescriptor:Le,defineProperty:ze}),a((function(){de.call({})}))&&(de=he=function(){return ce.call(this)});var Ue=h({},Ie);h(Ue,Pe),d(Ue,pe,Pe.values),h(Ue,{slice:Ne,set:Re,constructor:function(){},toString:de,toLocaleString:Fe}),De(Ue,"buffer","b"),De(Ue,"byteOffset","o"),De(Ue,"byteLength","l"),De(Ue,"length","e"),U(Ue,me,{get:function(){return this[be]}}),e.exports=function(e,t,n,u){var c=e+((u=!!u)?"Clamped":"")+"Array",f="get"+e,h="set"+e,p=i[c],g=p||{},y=p&&S(p),b=!p||!s.ABV,_={},k=p&&p.prototype,A=function(e,n){U(e,n,{get:function(){return function(e,n){var r=e._d;return r.v[f](n*t+r.o,_e)}(this,n)},set:function(e){return function(e,n,r){var i=e._d;u&&(r=(r=Math.round(r))<0?0:r>255?255:255&r),i.v[h](n*t+i.o,r,_e)}(this,n,e)},enumerable:!0})};b?(p=n((function(e,n,r,i){l(e,p,c,"_d");var a,o,s,u,f=0,h=0;if(w(n)){if(!(n instanceof X||"ArrayBuffer"==(u=x(n))||"SharedArrayBuffer"==u))return be in n?Oe(p,n):Te.call(p,n);a=n,h=Ee(r,t);var g=n.byteLength;if(void 0===i){if(g%t)throw V("Wrong length!");if((o=g-h)<0)throw V("Wrong length!")}else if((o=m(i)*t)+h>g)throw V("Wrong length!");s=o/t}else s=v(n),a=new X(o=s*t);for(d(e,"_d",{b:a,o:h,l:o,e:s,v:new K(a)});f<s;)A(e,f++)})),k=p.prototype=E(Ue),d(k,"constructor",p)):a((function(){p(1)}))&&a((function(){new p(-1)}))&&N((function(e){new p,new p(null),new p(1.5),new p(e)}),!0)||(p=n((function(e,n,r,i){var a;return l(e,p,c),w(n)?n instanceof X||"ArrayBuffer"==(a=x(n))||"SharedArrayBuffer"==a?void 0!==i?new g(n,Ee(r,t),i):void 0!==r?new g(n,Ee(r,t)):new g(n):be in n?Oe(p,n):Te.call(p,n):new g(v(n))})),Y(y!==Function.prototype?C(g).concat(C(y)):C(g),(function(e){e in p||d(p,e,g[e])})),p.prototype=k,r||(k.constructor=p));var O=k[pe],D=!!O&&("values"==O.name||void 0==O.name),T=Pe.values;d(p,ve,!0),d(k,be,c),d(k,xe,!0),d(k,ge,p),(u?new p(1)[me]==c:me in k)||U(k,me,{get:function(){return c}}),_[c]=p,o(o.G+o.W+o.F*(p!=g),_),o(o.S,c,{BYTES_PER_ELEMENT:t}),o(o.S+o.F*a((function(){g.of.call(p,1)})),c,{from:Te,of:je}),"BYTES_PER_ELEMENT"in k||d(k,"BYTES_PER_ELEMENT",t),o(o.P,c,Ie),R(c),o(o.P+o.F*ke,c,{set:Re}),o(o.P+o.F*!D,c,Pe),r||k.toString==de||(k.toString=de),o(o.P+o.F*a((function(){new p(1).slice()})),c,{slice:Ne}),o(o.P+o.F*(a((function(){return[1,2].toLocaleString()!=new p([1,2]).toLocaleString()}))||!a((function(){k.toLocaleString.call([1,2])}))),c,{toLocaleString:Fe}),I[c]=D?O:T,r||D||d(k,pe,T)}}else e.exports=function(){}},function(e,t){e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return T})),n.d(t,"b",(function(){return j})),n.d(t,"c",(function(){return k})),n.d(t,"d",(function(){return E})),n.d(t,"e",(function(){return I})),n.d(t,"f",(function(){return F})),n.d(t,"g",(function(){return M})),n.d(t,"h",(function(){return x}));var r=n(1),i=n(582),a=n(176),o=n(44),s=/^(data:|([A-Za-z]+:)?\/\/)/,u=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,c=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,l="file://";function f(){return p.apply(this,arguments)}function p(){return(p=d(m().mark((function e(){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Object(r.o)("No file system access.");case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(){return g.apply(this,arguments)}function g(){return(g=d(m().mark((function e(){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Object(r.o)("No HTTP fetch method available.");case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var y=function(e){return null!=e&&e==e},b=function(e){return!(Number.isNaN(+e)||e instanceof Date)},x={boolean:r.Ca,integer:r.Ea,number:r.Ea,date:r.Da,string:r.Ga,unknown:r.y},w=[function(e){return"true"===e||"false"===e||!0===e||!1===e},function(e){return b(e)&&Number.isInteger(+e)},b,function(e){return!Number.isNaN(Date.parse(e))}],_=["boolean","integer","number","date"];function k(e,t){if(!e||!e.length)return"unknown";for(var n,r,i=e.length,a=w.length,o=w.map((function(e,t){return t+1})),s=0,u=0;s<i;++s)for(r=t?e[s][t]:e[s],n=0;n<a;++n)if(o[n]&&y(r)&&!w[n](r)&&(o[n]=0,++u===w.length))return"string";return _[o.reduce((function(e,t){return 0===e?t:e}),0)-1]}function E(e,t){return t.reduce((function(t,n){return t[n]=k(e,n),t}),{})}function S(e){var t=function(t,n){var i={delimiter:e};return C(t,n?Object(r.p)(n,i):i)};return t.responseType="text",t}function C(e,t){return t.header&&(e=t.header.map(r.Ba).join(t.delimiter)+"\n"+e),Object(i.a)(t.delimiter).parse(e+"")}function A(t,n){var i=n&&n.property?Object(r.u)(n.property):r.y;return Object(r.H)(t)&&!function(t){return!("function"!=typeof e||!Object(r.E)(e.isBuffer))&&e.isBuffer(t)}(t)?function(e,t){return!Object(r.B)(e)&&Object(r.F)(e)&&(e=h(e)),t&&t.copy?JSON.parse(JSON.stringify(e)):e}(i(t),n):i(JSON.parse(t))}C.responseType="text",A.responseType="json";var O={interior:function(e,t){return e!==t},exterior:function(e,t){return e===t}};function D(e,t){var n,i,o,s;return e=A(e,t),t&&t.feature?(n=a.a,o=t.feature):t&&t.mesh?(n=a.b,o=t.mesh,s=O[t.filter]):Object(r.o)("Missing TopoJSON feature or mesh parameter."),(i=(i=e.objects[o])?n(e,i,s):Object(r.o)("Invalid TopoJSON object: "+o))&&i.features||[i]}D.responseType="json";var T={dsv:C,csv:S(","),tsv:S("\t"),json:A,topojson:D};function j(e,t){return arguments.length>1?(T[e]=t,this):Object(r.w)(T,e)?T[e]:null}function M(e){var t=j(e);return t&&t.responseType||"text"}function F(e,t,n,i){var a=j((t=t||{}).type||"json");return a||Object(r.o)("Unknown data format type: "+t.type),e=a(e,t),t.parse&&function(e,t,n,r){if(e.length){var i=Object(o.e)();n=n||i.timeParse,r=r||i.utcParse;var a,s,u,c,l,f,d=e.columns||Object.keys(e[0]);"auto"===t&&(t=E(e,d));var h=(d=Object.keys(t)).map((function(e){var i,a,o=t[e];if(o&&(o.startsWith("date:")||o.startsWith("utc:")))return("'"===(a=(i=o.split(/:(.+)?/,2))[1])[0]&&"'"===a[a.length-1]||'"'===a[0]&&'"'===a[a.length-1])&&(a=a.slice(1,-1)),("utc"===i[0]?r:n)(a);if(!x[o])throw Error("Illegal format pattern: "+e+":"+o);return x[o]}));for(u=0,l=e.length,f=d.length;u<l;++u)for(a=e[u],c=0;c<f;++c)a[s=d[c]]=h[c](a[s])}}(e,t.parse,n,i),Object(r.w)(e,"columns")&&delete e.columns,e}var I=function(e,t){return function(n){return{options:n||{},sanitize:function(){var e=d(m().mark((function e(t,n){var i,a,o,f,d,h,p;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(r.p)({},this.options,n),i=this.fileAccess,a={href:null},h=u.test(t.replace(c,"")),null!=t&&"string"==typeof t&&h||Object(r.o)("Sanitize failure, invalid URI: "+Object(r.Ba)(t)),p=s.test(t),e.abrupt("return",((d=n.baseURL)&&!p&&(t.startsWith("/")||d.endsWith("/")||(t="/"+t),t=d+t),f=(o=t.startsWith(l))||"file"===n.mode||"http"!==n.mode&&!p&&i,o?t=t.slice(l.length):t.startsWith("//")&&("file"===n.defaultProtocol?(t=t.slice(2),f=!0):t=(n.defaultProtocol||"http")+":"+t),Object.defineProperty(a,"localFile",{value:!!f}),a.href=t,n.target&&(a.target=n.target+""),n.rel&&(a.rel=n.rel+""),"image"===n.context&&n.crossOrigin&&(a.crossOrigin=n.crossOrigin+""),a));case 6:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}(),load:function(){var e=d(m().mark((function e(t,n){var r,i;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sanitize(t,n);case 2:return r=e.sent,i=r.href,e.abrupt("return",r.localFile?this.file(i):this.http(i,n));case 5:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}(),fileAccess:!!t,file:function(e){return e?function(t){return new Promise((function(n,r){e.readFile(t,(function(e,t){e?r(e):n(t)}))}))}:f}(t),http:function(e){return e?function(){var t=d(m().mark((function t(n,i){var a,o,s;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Object(r.p)({},this.options.http,i),o=i&&i.response,t.next=4,e(n,a);case 4:return s=t.sent,t.abrupt("return",s.ok?Object(r.E)(s[o])?s[o]():s.text():Object(r.o)(s.status+""+s.statusText));case 6:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}():v}(e)}}}("undefined"!=typeof fetch&&fetch,null)}).call(this,n(92).Buffer)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(102),i=n(46),a={prepend:!1};t.subSurface=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=i.getDrawArea(e),s=r.css({"& canvas":{display:"block"},marginTop:".5rem",marginBottom:".5rem"}),u=r.css({backgroundColor:"white",display:"inline-block",boxSizing:"border-box",borderBottom:"1px solid #357EDD",lineHeight:"2em",padding:"0 10px 0 10px",marginBottom:"20px",fontWeight:"600",textAlign:"left"}),c=Object.assign({},a,n),l=o.querySelector("div[data-name=".concat(t,"]"));if(!l){if((l=document.createElement("div")).setAttribute("class","".concat(s)),l.dataset.name=t,c.title){var f=document.createElement("div");f.setAttribute("class","subsurface-title ".concat(u)),f.innerText=c.title,l.appendChild(f)}c.prepend?o.insertBefore(l,o.firstChild):o.appendChild(l)}return l},t.getDefaultWidth=function(e){for(var t=0,n=e;n&&0===n.clientWidth;)n=n.parentElement,t=50;return n.clientWidth-t},t.getDefaultHeight=function(e){return 0===e.clientHeight?200:e.clientHeight}},function(e,t,n){var r=n(84)("meta"),i=n(13),a=n(43),o=n(26).f,s=0,u=Object.isExtensible||function(){return!0},c=!n(15)((function(){return u(Object.preventExtensions({}))})),l=function(e){o(e,r,{value:{i:"O"+ ++s,w:{}}})},f=e.exports={KEY:r,NEED:!1,fastKey:function(e,t){if(!i(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!a(e,r)){if(!u(e))return"F";if(!t)return"E";l(e)}return e[r].i},getWeak:function(e,t){if(!a(e,r)){if(!u(e))return!0;if(!t)return!1;l(e)}return e[r].w},onFreeze:function(e){return c&&f.NEED&&u(e)&&!a(e,r)&&l(e),e}}},function(e,t,n){var r=n(13);e.exports=function(e,t){if(!r(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!r(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(0),n(384);var r=n(349),i=n(289),a=n(288),o=n(137),s=n(196),u=n(287),c=n(109),l=n(286),f=n(285),d=n(284),h=n(283),p=n(110),m=n(282);t.version_vis=m.version;var v={barchart:r.barchart,table:c.table,histogram:o.histogram,linechart:s.linechart,scatterplot:u.scatterplot,confusionMatrix:i.confusionMatrix,heatmap:a.heatmap};t.render=v;var g={accuracy:p.accuracy,perClassAccuracy:p.perClassAccuracy,confusionMatrix:p.confusionMatrix};t.metrics=g;var y={history:l.history,fitCallbacks:l.fitCallbacks,perClassAccuracy:d.perClassAccuracy,valuesDistribution:h.valuesDistribution,layer:f.layer,modelSummary:f.modelSummary};t.show=y;var b=n(197);t.visor=b.visor,function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(198))},function(e,t,n){"use strict";var r=n(31),i=Object(r.a)((function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)}),(function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()}),(function(e){return e.getUTCFullYear()}));i.every=function(e){return isFinite(e=Math.floor(e))&&e>0?Object(r.a)((function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)})):null},t.a=i,i.range},function(e,t,n){"use strict";var r=n(31),i=n(12),a=Object(r.a)((function(e){e.setTime(e-e.getMilliseconds())}),(function(e,t){e.setTime(+e+t*i.e)}),(function(e,t){return(t-e)/i.e}),(function(e){return e.getUTCSeconds()}));t.a=a,a.range},function(e,t,n){"use strict";var r=n(31),i=Object(r.a)((function(e){e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,t){e.setFullYear(e.getFullYear()+t)}),(function(e,t){return t.getFullYear()-e.getFullYear()}),(function(e){return e.getFullYear()}));i.every=function(e){return isFinite(e=Math.floor(e))&&e>0?Object(r.a)((function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,n){t.setFullYear(t.getFullYear()+n*e)})):null},t.a=i,i.range},function(e,t,n){"use strict";var r=n(31),i=n(12),a=Object(r.a)((function(e){e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+t)}),(function(e,t){return(t-e)/i.a}),(function(e){return e.getUTCDate()-1}));t.a=a,a.range},function(e,t,n){"use strict";var r=n(31),i=n(12),a=Object(r.a)((function(e){return e.setHours(0,0,0,0)}),(function(e,t){return e.setDate(e.getDate()+t)}),(function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*i.c)/i.a}),(function(e){return e.getDate()-1}));t.a=a,a.range},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Add="Add",t.AddN="AddN",t.Div="Div",t.FusedBatchNorm="FusedBatchNorm",t.SquaredDifference="SquaredDifference",t.Square="Square",t.Transpose="Transpose",t.NonMaxSuppressionV5="NonMaxSuppressionV5",t.BroadcastTo="BroadcastTo",t.OneHot="OneHot",t.Identity="Identity",t.Tile="Tile",t.PadV2="PadV2",t.FromPixels="FromPixels",t.MaxPoolWithArgmax="MaxPoolWithArgmax"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(33),i=n(378),a=n(21);t.makeTypesMatch=function(e,t){if(e.dtype===t.dtype)return[e,t];var n=i.upcastType(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]},t.assertTypesMatch=function(e,t){a.assert(e.dtype===t.dtype,(function(){return"The dtypes of the first("+e.dtype+") and second("+t.dtype+") input must match"}))},t.isTensorInList=function(e,t){return t.some((function(t){return t.id===e.id}))},t.getTensorsInContainer=function(e){var t=[];return function e(t,n,i){if(null!=t)if(t instanceof r.Tensor)n.push(t);else if(function(e){return Array.isArray(e)||"object"==typeof e}(t)){var a=t;for(var o in a){var s=a[o];i.has(s)||(i.add(s),e(s,n,i))}}}(e,t,new Set),t}},function(e,t){var n,r,i=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(e){n=a}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var u,c=[],l=!1,f=-1;function d(){l&&u&&(l=!1,u.length?c=u.concat(c):f=-1,c.length&&h())}function h(){if(!l){var e=s(d);l=!0;for(var t=c.length;t;){for(u=c,c=[];++f<t;)u&&u[f].run();f=-1,t=c.length}u=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new p(e,t)),1!==c.length||l||s(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){var r=n(13);e.exports=function(e,t){if(!r(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},function(e,t,n){var r=n(19)("unscopables"),i=Array.prototype;void 0==i[r]&&n(42)(i,r,{}),e.exports=function(e){i[r][e]=!0}},function(e,t,n){var r=n(43),i=n(34),a=n(173)("IE_PROTO"),o=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=i(e),r(e,a)?e[a]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?o:null}},function(e,t,n){var r=n(238),i=n(172).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,i)}},function(e,t,n){var r=n(14),i=n(237),a=n(172),o=n(173)("IE_PROTO"),s=function(){},u=function(){var e,t=n(175)("iframe"),r=a.length;for(t.style.display="none",n(171).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),u=e.F;r--;)delete u.prototype[a[r]];return u()};e.exports=Object.create||function(e,t){var n;return null!==e?(s.prototype=r(e),n=new s,s.prototype=null,n[o]=e):n=u(),void 0===t?n:i(n,t)}},function(e,t,n){var r=n(54),i=Math.max,a=Math.min;e.exports=function(e,t){return(e=r(e))<0?i(e+t,0):a(e,t)}},function(e,t,n){var r=n(238),i=n(172);e.exports=Object.keys||function(e){return r(e,i)}},function(e,t){e.exports=!1},function(e,t){var n=0,r=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+r).toString(36))}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,n){"use strict";e.exports=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var n="boolean"==typeof t.cycles&&t.cycles,r=t.cmp&&function(e){return function(t){return function(n,r){var i={key:n,value:t[n]},a={key:r,value:t[r]};return e(i,a)}}}(t.cmp),i=[];return function e(t){if(t&&t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0!==t){if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);var a,o;if(Array.isArray(t)){for(o="[",a=0;a<t.length;a++)a&&(o+=","),o+=e(t[a])||"null";return o+"]"}if(null===t)return"null";if(-1!==i.indexOf(t)){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var s=i.push(t)-1,u=Object.keys(t).sort(r&&r(t));for(o="",a=0;a<u.length;a++){var c=u[a],l=e(t[c]);l&&(o&&(o+=","),o+=JSON.stringify(c)+":"+l)}return i.splice(s,1),"{"+o+"}"}}(e)}},function(e,t,n){"use strict";t.a=function(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}},function(e,t,n){"use strict";var b,x,w=m().mark(yt);n.r(t);var _={};n.d(_,"JsonPatchError",(function(){return $})),n.d(_,"deepClone",(function(){return J})),n.d(_,"getValueByPointer",(function(){return ee})),n.d(_,"applyOperation",(function(){return te})),n.d(_,"applyPatch",(function(){return ne})),n.d(_,"applyReducer",(function(){return re})),n.d(_,"validator",(function(){return ie})),n.d(_,"validate",(function(){return ae})),n.d(_,"_areEquals",(function(){return oe}));var k={};n.d(k,"unobserve",(function(){return le})),n.d(k,"observe",(function(){return fe})),n.d(k,"generate",(function(){return de})),n.d(k,"compare",(function(){return pe}));var E={};n.d(E,"aggregate",(function(){return Mn})),n.d(E,"bin",(function(){return Fn})),n.d(E,"collect",(function(){return Nn})),n.d(E,"compare",(function(){return Rn})),n.d(E,"countpattern",(function(){return Bn})),n.d(E,"cross",(function(){return Ln})),n.d(E,"density",(function(){return Gn})),n.d(E,"dotbin",(function(){return Yn})),n.d(E,"expression",(function(){return $n})),n.d(E,"extent",(function(){return Zn})),n.d(E,"facet",(function(){return er})),n.d(E,"field",(function(){return tr})),n.d(E,"filter",(function(){return rr})),n.d(E,"flatten",(function(){return ir})),n.d(E,"fold",(function(){return ar})),n.d(E,"formula",(function(){return or})),n.d(E,"generate",(function(){return sr})),n.d(E,"impute",(function(){return lr})),n.d(E,"joinaggregate",(function(){return fr})),n.d(E,"kde",(function(){return dr})),n.d(E,"key",(function(){return hr})),n.d(E,"load",(function(){return mr})),n.d(E,"lookup",(function(){return gr})),n.d(E,"multiextent",(function(){return yr})),n.d(E,"multivalues",(function(){return xr})),n.d(E,"params",(function(){return _r})),n.d(E,"pivot",(function(){return kr})),n.d(E,"prefacet",(function(){return Er})),n.d(E,"project",(function(){return Sr})),n.d(E,"proxy",(function(){return Cr})),n.d(E,"quantile",(function(){return Ar})),n.d(E,"relay",(function(){return Or})),n.d(E,"sample",(function(){return Dr})),n.d(E,"sequence",(function(){return Tr})),n.d(E,"sieve",(function(){return jr})),n.d(E,"subflow",(function(){return Qn})),n.d(E,"timeunit",(function(){return Mr})),n.d(E,"tupleindex",(function(){return Ir})),n.d(E,"values",(function(){return Nr})),n.d(E,"window",(function(){return zr}));var S={};n.d(S,"interpolate",(function(){return ho})),n.d(S,"interpolateArray",(function(){return io})),n.d(S,"interpolateBasis",(function(){return qa})),n.d(S,"interpolateBasisClosed",(function(){return Ha})),n.d(S,"interpolateDate",(function(){return oo})),n.d(S,"interpolateDiscrete",(function(){return ks})),n.d(S,"interpolateHue",(function(){return Es})),n.d(S,"interpolateNumber",(function(){return so})),n.d(S,"interpolateNumberArray",(function(){return no})),n.d(S,"interpolateObject",(function(){return uo})),n.d(S,"interpolateRound",(function(){return po})),n.d(S,"interpolateString",(function(){return fo})),n.d(S,"interpolateTransformCss",(function(){return Ds})),n.d(S,"interpolateTransformSvg",(function(){return Ts})),n.d(S,"interpolateZoom",(function(){return Fs})),n.d(S,"interpolateRgb",(function(){return Za})),n.d(S,"interpolateRgbBasis",(function(){return eo})),n.d(S,"interpolateRgbBasisClosed",(function(){return to})),n.d(S,"interpolateHsl",(function(){return Ns})),n.d(S,"interpolateHslLong",(function(){return Rs})),n.d(S,"interpolateLab",(function(){return ru})),n.d(S,"interpolateHcl",(function(){return au})),n.d(S,"interpolateHclLong",(function(){return ou})),n.d(S,"interpolateCubehelix",(function(){return vu})),n.d(S,"interpolateCubehelixLong",(function(){return gu})),n.d(S,"piecewise",(function(){return bs})),n.d(S,"quantize",(function(){return yu}));var C={};n.d(C,"bound",(function(){return zp})),n.d(C,"identifier",(function(){return Vp})),n.d(C,"mark",(function(){return Gp})),n.d(C,"overlap",(function(){return qp})),n.d(C,"render",(function(){return Zp})),n.d(C,"viewlayout",(function(){return xm}));var A={};n.d(A,"axisticks",(function(){return _m})),n.d(A,"datajoin",(function(){return km})),n.d(A,"encode",(function(){return Sm})),n.d(A,"legendentries",(function(){return Cm})),n.d(A,"linkpath",(function(){return jm})),n.d(A,"pie",(function(){return Rm})),n.d(A,"scale",(function(){return zm})),n.d(A,"sortitems",(function(){return Gm})),n.d(A,"stack",(function(){return Hm}));var O={};n.d(O,"contour",(function(){return Ab})),n.d(O,"geojson",(function(){return Tb})),n.d(O,"geopath",(function(){return jb})),n.d(O,"geopoint",(function(){return Mb})),n.d(O,"geoshape",(function(){return Fb})),n.d(O,"graticule",(function(){return Ib})),n.d(O,"heatmap",(function(){return Nb})),n.d(O,"isocontour",(function(){return gb})),n.d(O,"kde2d",(function(){return Eb})),n.d(O,"projection",(function(){return Pb}));var D={};n.d(D,"force",(function(){return Fx}));var T={};n.d(T,"nest",(function(){return Iw})),n.d(T,"pack",(function(){return Lw})),n.d(T,"partition",(function(){return Uw})),n.d(T,"stratify",(function(){return Ww})),n.d(T,"tree",(function(){return qw})),n.d(T,"treelinks",(function(){return Hw})),n.d(T,"treemap",(function(){return Yw}));var j={};n.d(j,"label",(function(){return x_}));var M={};n.d(M,"loess",(function(){return __})),n.d(M,"regression",(function(){return E_}));var F={};n.d(F,"voronoi",(function(){return V_}));var I={};n.d(I,"wordcloud",(function(){return ak}));var N={};n.d(N,"crossfilter",(function(){return hk})),n.d(N,"resolvefilter",(function(){return pk}));var R={};n.d(R,"Dataflow",(function(){return it})),n.d(R,"EventStream",(function(){return Ve})),n.d(R,"MultiPulse",(function(){return Qe})),n.d(R,"Operator",(function(){return ze})),n.d(R,"Parameters",(function(){return Pe})),n.d(R,"Pulse",(function(){return Ye})),n.d(R,"Transform",(function(){return ot})),n.d(R,"changeset",(function(){return Ne})),n.d(R,"definition",(function(){return ut})),n.d(R,"ingest",(function(){return De})),n.d(R,"isTuple",(function(){return Ce})),n.d(R,"transform",(function(){return ct})),n.d(R,"transforms",(function(){return st})),n.d(R,"tupleid",(function(){return Ae})),n.d(R,"interpolate",(function(){return ac})),n.d(R,"interpolateColors",(function(){return nc})),n.d(R,"interpolateRange",(function(){return tc})),n.d(R,"quantizeInterpolator",(function(){return rc})),n.d(R,"scale",(function(){return qu})),n.d(R,"scheme",(function(){return cc})),n.d(R,"projection",(function(){return rb})),n.d(R,"View",(function(){return qO})),n.d(R,"defaultLocale",(function(){return xe.a})),n.d(R,"formatLocale",(function(){return xe.c})),n.d(R,"locale",(function(){return xe.b})),n.d(R,"resetDefaultLocale",(function(){return xe.d})),n.d(R,"timeFormatLocale",(function(){return xe.e})),n.d(R,"expressionFunction",(function(){return RA})),n.d(R,"parse",(function(){return tF})),n.d(R,"runtimeContext",(function(){return HA})),n.d(R,"codegenExpression",(function(){return GI})),n.d(R,"parseExpression",(function(){return UI})),n.d(R,"parseSelector",(function(){return iN})),n.d(R,"version",(function(){return cN})),n.d(R,"Debug",(function(){return ye.a})),n.d(R,"Error",(function(){return ye.b})),n.d(R,"Info",(function(){return ye.c})),n.d(R,"None",(function(){return ye.d})),n.d(R,"Warn",(function(){return ye.e})),n.d(R,"accessor",(function(){return ye.f})),n.d(R,"accessorFields",(function(){return ye.g})),n.d(R,"accessorName",(function(){return ye.h})),n.d(R,"array",(function(){return ye.i})),n.d(R,"ascending",(function(){return ye.j})),n.d(R,"clampRange",(function(){return ye.k})),n.d(R,"compare",(function(){return ye.l})),n.d(R,"constant",(function(){return ye.m})),n.d(R,"debounce",(function(){return ye.n})),n.d(R,"error",(function(){return ye.o})),n.d(R,"extend",(function(){return ye.p})),n.d(R,"extent",(function(){return ye.q})),n.d(R,"extentIndex",(function(){return ye.r})),n.d(R,"falsy",(function(){return ye.s})),n.d(R,"fastmap",(function(){return ye.t})),n.d(R,"field",(function(){return ye.u})),n.d(R,"flush",(function(){return ye.v})),n.d(R,"hasOwnProperty",(function(){return ye.w})),n.d(R,"id",(function(){return ye.x})),n.d(R,"identity",(function(){return ye.y})),n.d(R,"inherits",(function(){return ye.z})),n.d(R,"inrange",(function(){return ye.A})),n.d(R,"isArray",(function(){return ye.B})),n.d(R,"isBoolean",(function(){return ye.C})),n.d(R,"isDate",(function(){return ye.D})),n.d(R,"isFunction",(function(){return ye.E})),n.d(R,"isIterable",(function(){return ye.F})),n.d(R,"isNumber",(function(){return ye.G})),n.d(R,"isObject",(function(){return ye.H})),n.d(R,"isRegExp",(function(){return ye.I})),n.d(R,"isString",(function(){return ye.J})),n.d(R,"key",(function(){return ye.K})),n.d(R,"lerp",(function(){return ye.L})),n.d(R,"logger",(function(){return ye.M})),n.d(R,"lruCache",(function(){return ye.N})),n.d(R,"merge",(function(){return ye.O})),n.d(R,"mergeConfig",(function(){return ye.P})),n.d(R,"one",(function(){return ye.Q})),n.d(R,"pad",(function(){return ye.R})),n.d(R,"panLinear",(function(){return ye.S})),n.d(R,"panLog",(function(){return ye.T})),n.d(R,"panPow",(function(){return ye.U})),n.d(R,"panSymlog",(function(){return ye.V})),n.d(R,"peek",(function(){return ye.W})),n.d(R,"quarter",(function(){return ye.X})),n.d(R,"repeat",(function(){return ye.Y})),n.d(R,"span",(function(){return ye.Z})),n.d(R,"splitAccessPath",(function(){return ye.Aa})),n.d(R,"stringValue",(function(){return ye.Ba})),n.d(R,"toBoolean",(function(){return ye.Ca})),n.d(R,"toDate",(function(){return ye.Da})),n.d(R,"toNumber",(function(){return ye.Ea})),n.d(R,"toSet",(function(){return ye.Fa})),n.d(R,"toString",(function(){return ye.Ga})),n.d(R,"truncate",(function(){return ye.Ha})),n.d(R,"truthy",(function(){return ye.Ia})),n.d(R,"utcquarter",(function(){return ye.Ja})),n.d(R,"visitArray",(function(){return ye.Ka})),n.d(R,"writeConfig",(function(){return ye.La})),n.d(R,"zero",(function(){return ye.Ma})),n.d(R,"zoomLinear",(function(){return ye.Na})),n.d(R,"zoomLog",(function(){return ye.Oa})),n.d(R,"zoomPow",(function(){return ye.Pa})),n.d(R,"zoomSymlog",(function(){return ye.Qa})),n.d(R,"bandwidthNRD",(function(){return wt})),n.d(R,"bin",(function(){return _t})),n.d(R,"bootstrapCI",(function(){return St})),n.d(R,"cumulativeLogNormal",(function(){return zt})),n.d(R,"cumulativeNormal",(function(){return It})),n.d(R,"cumulativeUniform",(function(){return Ht})),n.d(R,"densityLogNormal",(function(){return Lt})),n.d(R,"densityNormal",(function(){return Ft})),n.d(R,"densityUniform",(function(){return qt})),n.d(R,"dotbin",(function(){return Ct})),n.d(R,"quantileLogNormal",(function(){return Ut})),n.d(R,"quantileNormal",(function(){return Nt})),n.d(R,"quantileUniform",(function(){return Xt})),n.d(R,"quantiles",(function(){return bt})),n.d(R,"quartiles",(function(){return xt})),n.d(R,"random",(function(){return kt})),n.d(R,"randomInteger",(function(){return Ot})),n.d(R,"randomKDE",(function(){return Pt})),n.d(R,"randomLCG",(function(){return At})),n.d(R,"randomLogNormal",(function(){return Wt})),n.d(R,"randomMixture",(function(){return Vt})),n.d(R,"randomNormal",(function(){return Rt})),n.d(R,"randomUniform",(function(){return Kt})),n.d(R,"regressionExp",(function(){return tn})),n.d(R,"regressionLinear",(function(){return Qt})),n.d(R,"regressionLoess",(function(){return un})),n.d(R,"regressionLog",(function(){return en})),n.d(R,"regressionPoly",(function(){return an})),n.d(R,"regressionPow",(function(){return nn})),n.d(R,"regressionQuad",(function(){return rn})),n.d(R,"sampleCurve",(function(){return dn})),n.d(R,"sampleLogNormal",(function(){return Bt})),n.d(R,"sampleNormal",(function(){return Mt})),n.d(R,"sampleUniform",(function(){return Gt})),n.d(R,"setRandom",(function(){return Et})),n.d(R,"DATE",(function(){return vn.a})),n.d(R,"DAY",(function(){return vn.b})),n.d(R,"DAYOFYEAR",(function(){return vn.c})),n.d(R,"HOURS",(function(){return vn.d})),n.d(R,"MILLISECONDS",(function(){return vn.e})),n.d(R,"MINUTES",(function(){return vn.f})),n.d(R,"MONTH",(function(){return vn.g})),n.d(R,"QUARTER",(function(){return vn.h})),n.d(R,"SECONDS",(function(){return vn.i})),n.d(R,"TIME_UNITS",(function(){return vn.j})),n.d(R,"WEEK",(function(){return vn.k})),n.d(R,"YEAR",(function(){return vn.l})),n.d(R,"dayofyear",(function(){return vn.m})),n.d(R,"timeBin",(function(){return vn.n})),n.d(R,"timeFloor",(function(){return vn.o})),n.d(R,"timeInterval",(function(){return vn.p})),n.d(R,"timeOffset",(function(){return vn.q})),n.d(R,"timeSequence",(function(){return vn.r})),n.d(R,"timeUnitSpecifier",(function(){return vn.s})),n.d(R,"timeUnits",(function(){return vn.t})),n.d(R,"utcFloor",(function(){return vn.u})),n.d(R,"utcInterval",(function(){return vn.v})),n.d(R,"utcOffset",(function(){return vn.w})),n.d(R,"utcSequence",(function(){return vn.x})),n.d(R,"utcdayofyear",(function(){return vn.y})),n.d(R,"utcweek",(function(){return vn.z})),n.d(R,"week",(function(){return vn.A})),n.d(R,"format",(function(){return be.a})),n.d(R,"formats",(function(){return be.b})),n.d(R,"inferType",(function(){return be.c})),n.d(R,"inferTypes",(function(){return be.d})),n.d(R,"loader",(function(){return be.e})),n.d(R,"read",(function(){return be.f})),n.d(R,"responseType",(function(){return be.g})),n.d(R,"typeParsers",(function(){return be.h})),n.d(R,"Bounds",(function(){return Tl})),n.d(R,"CanvasHandler",(function(){return Zd})),n.d(R,"CanvasRenderer",(function(){return ih})),n.d(R,"Gradient",(function(){return Pc})),n.d(R,"GroupItem",(function(){return Ml})),n.d(R,"Handler",(function(){return zd})),n.d(R,"Item",(function(){return jl})),n.d(R,"Marks",(function(){return Sd})),n.d(R,"RenderType",(function(){return Gh})),n.d(R,"Renderer",(function(){return Wd})),n.d(R,"ResourceLoader",(function(){return Fl})),n.d(R,"SVGHandler",(function(){return oh})),n.d(R,"SVGRenderer",(function(){return Dh})),n.d(R,"SVGStringRenderer",(function(){return Vh})),n.d(R,"Scenegraph",(function(){return Md})),n.d(R,"boundClip",(function(){return Zh})),n.d(R,"boundContext",(function(){return ef})),n.d(R,"boundItem",(function(){return Cd})),n.d(R,"boundMark",(function(){return Od})),n.d(R,"boundStroke",(function(){return Rl})),n.d(R,"domChild",(function(){return Rd})),n.d(R,"domClear",(function(){return Pd})),n.d(R,"domCreate",(function(){return Id})),n.d(R,"domFind",(function(){return Nd})),n.d(R,"font",(function(){return bd})),n.d(R,"fontFamily",(function(){return yd})),n.d(R,"fontSize",(function(){return hd})),n.d(R,"intersect",(function(){return Xh})),n.d(R,"intersectBoxLine",(function(){return df})),n.d(R,"intersectPath",(function(){return uf})),n.d(R,"intersectPoint",(function(){return cf})),n.d(R,"intersectRule",(function(){return ff})),n.d(R,"lineHeight",(function(){return pd})),n.d(R,"markup",(function(){return Eh})),n.d(R,"multiLineOffset",(function(){return vd})),n.d(R,"pathCurves",(function(){return Lc})),n.d(R,"pathEqual",(function(){return tp})),n.d(R,"pathParse",(function(){return Wc})),n.d(R,"pathRectangle",(function(){return dl})),n.d(R,"pathRender",(function(){return el})),n.d(R,"pathSymbols",(function(){return rl})),n.d(R,"pathTrail",(function(){return hl})),n.d(R,"point",(function(){return Ld})),n.d(R,"renderModule",(function(){return Hh})),n.d(R,"resetSVGClipId",(function(){return Ol})),n.d(R,"resetSVGDefIds",(function(){return np})),n.d(R,"sceneEqual",(function(){return ep})),n.d(R,"sceneFromJSON",(function(){return jd})),n.d(R,"scenePickVisit",(function(){return kf})),n.d(R,"sceneToJSON",(function(){return Td})),n.d(R,"sceneVisit",(function(){return _f})),n.d(R,"sceneZOrder",(function(){return wf})),n.d(R,"serializeXML",(function(){return Sh})),n.d(R,"textMetrics",(function(){return sd}));var P={};n.d(P,"invalidSpec",(function(){return BB})),n.d(P,"FIT_NON_SINGLE",(function(){return LB})),n.d(P,"containerSizeNonSingle",(function(){return zB})),n.d(P,"containerSizeNotCompatibleWithAutosize",(function(){return UB})),n.d(P,"droppingFit",(function(){return WB})),n.d(P,"cannotProjectOnChannelWithoutField",(function(){return VB})),n.d(P,"cannotProjectAggregate",(function(){return GB})),n.d(P,"nearestNotSupportForContinuous",(function(){return qB})),n.d(P,"selectionNotSupported",(function(){return HB})),n.d(P,"selectionNotFound",(function(){return XB})),n.d(P,"SCALE_BINDINGS_CONTINUOUS",(function(){return KB})),n.d(P,"LEGEND_BINDINGS_PROJECT_LENGTH",(function(){return YB})),n.d(P,"noSameUnitLookup",(function(){return $B})),n.d(P,"noSuchRepeatedValue",(function(){return JB})),n.d(P,"columnsNotSupportByRowCol",(function(){return ZB})),n.d(P,"CONCAT_CANNOT_SHARE_AXIS",(function(){return QB})),n.d(P,"unrecognizedParse",(function(){return eL})),n.d(P,"differentParse",(function(){return tL})),n.d(P,"invalidTransformIgnored",(function(){return nL})),n.d(P,"NO_FIELDS_NEEDS_AS",(function(){return rL})),n.d(P,"customFormatTypeNotAllowed",(function(){return iL})),n.d(P,"encodingOverridden",(function(){return aL})),n.d(P,"projectionOverridden",(function(){return oL})),n.d(P,"REPLACE_ANGLE_WITH_THETA",(function(){return sL})),n.d(P,"primitiveChannelDef",(function(){return uL})),n.d(P,"invalidFieldType",(function(){return cL})),n.d(P,"invalidFieldTypeForCountAggregate",(function(){return lL})),n.d(P,"invalidAggregate",(function(){return fL})),n.d(P,"missingFieldType",(function(){return dL})),n.d(P,"droppingColor",(function(){return hL})),n.d(P,"emptyFieldDef",(function(){return pL})),n.d(P,"latLongDeprecated",(function(){return mL})),n.d(P,"LINE_WITH_VARYING_SIZE",(function(){return vL})),n.d(P,"incompatibleChannel",(function(){return gL})),n.d(P,"invalidEncodingChannel",(function(){return yL})),n.d(P,"facetChannelShouldBeDiscrete",(function(){return bL})),n.d(P,"facetChannelDropped",(function(){return xL})),n.d(P,"discreteChannelCannotEncode",(function(){return wL})),n.d(P,"lineWithRange",(function(){return _L})),n.d(P,"orientOverridden",(function(){return kL})),n.d(P,"CANNOT_UNION_CUSTOM_DOMAIN_WITH_FIELD_DOMAIN",(function(){return EL})),n.d(P,"RANGE_STEP_DEPRECATED",(function(){return SL})),n.d(P,"cannotUseScalePropertyWithNonColor",(function(){return CL})),n.d(P,"unaggregateDomainHasNoEffectForRawField",(function(){return AL})),n.d(P,"unaggregateDomainWithNonSharedDomainOp",(function(){return OL})),n.d(P,"unaggregatedDomainWithLogScale",(function(){return DL})),n.d(P,"cannotApplySizeToNonOrientedMark",(function(){return TL})),n.d(P,"scaleTypeNotWorkWithChannel",(function(){return jL})),n.d(P,"scaleTypeNotWorkWithFieldDef",(function(){return ML})),n.d(P,"scalePropertyNotWorkWithScaleType",(function(){return FL})),n.d(P,"scaleTypeNotWorkWithMark",(function(){return IL})),n.d(P,"stepDropped",(function(){return NL})),n.d(P,"mergeConflictingProperty",(function(){return RL})),n.d(P,"mergeConflictingDomainProperty",(function(){return PL})),n.d(P,"independentScaleMeansIndependentGuide",(function(){return BL})),n.d(P,"domainSortDropped",(function(){return LL})),n.d(P,"MORE_THAN_ONE_SORT",(function(){return zL})),n.d(P,"FACETED_INDEPENDENT_DIFFERENT_SOURCES",(function(){return UL})),n.d(P,"FACETED_INDEPENDENT_SAME_FIELDS_DIFFERENT_SOURCES",(function(){return WL})),n.d(P,"FACETED_INDEPENDENT_SAME_SOURCE",(function(){return VL})),n.d(P,"INVALID_CHANNEL_FOR_AXIS",(function(){return GL})),n.d(P,"cannotStackRangedMark",(function(){return qL})),n.d(P,"cannotStackNonLinearScale",(function(){return HL})),n.d(P,"stackNonSummativeAggregate",(function(){return XL})),n.d(P,"invalidTimeUnit",(function(){return KL})),n.d(P,"droppedDay",(function(){return YL})),n.d(P,"errorBarCenterAndExtentAreNotNeeded",(function(){return $L})),n.d(P,"errorBarCenterIsUsedWithWrongExtent",(function(){return JL})),n.d(P,"errorBarContinuousAxisHasCustomizedAggregate",(function(){return ZL})),n.d(P,"errorBarCenterIsNotNeeded",(function(){return QL})),n.d(P,"errorBand1DNotSupport",(function(){return ez})),n.d(P,"channelRequiredForBinned",(function(){return tz})),n.d(P,"domainRequiredForThresholdScale",(function(){return nz}));var B={};n.d(B,"compile",(function(){return FJ})),n.d(B,"extractTransforms",(function(){return NJ})),n.d(B,"normalize",(function(){return gG})),n.d(B,"version",(function(){return RJ}));var L={};n.d(L,"dark",(function(){return BJ})),n.d(L,"excel",(function(){return LJ})),n.d(L,"fivethirtyeight",(function(){return zJ})),n.d(L,"ggplot2",(function(){return UJ})),n.d(L,"googlecharts",(function(){return YJ})),n.d(L,"latimes",(function(){return GJ})),n.d(L,"quartz",(function(){return qJ})),n.d(L,"urbaninstitute",(function(){return KJ})),n.d(L,"version",(function(){return $J})),n.d(L,"vox",(function(){return HJ}));var z=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),U=Object.prototype.hasOwnProperty;function W(e,t){return U.call(e,t)}function V(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);for(var r in t=[],e)W(e,r)&&t.push(r);return t}function G(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function q(e){for(var t,n=0,r=e.length;n<r;){if(!((t=e.charCodeAt(n))>=48&&t<=57))return!1;n++}return!0}function H(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function X(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function K(e,t){var n=[e];for(var r in t){var i="object"==typeof t[r]?JSON.stringify(t[r],null,2):t[r];void 0!==i&&n.push(r+": "+i)}return n.join("\n")}var Y=function(e){function t(t,n,r,i,a){var o=this.constructor,s=e.call(this,K(t,{name:n,index:r,operation:i,tree:a}))||this;return s.name=n,s.index=r,s.operation=i,s.tree=a,Object.setPrototypeOf(s,o.prototype),s.message=K(t,{name:n,index:r,operation:i,tree:a}),s}return z(t,e),t}(Error),$=Y,J=G,Z={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=ee(n,this.path);r&&(r=G(r));var i=te(n,{op:"remove",path:this.from}).removed;return te(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=ee(n,this.from);return te(n,{op:"add",path:this.path,value:G(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:oe(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},Q={add:function(e,t,n){return q(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){return{newDocument:n,removed:e.splice(t,1)[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:Z.move,copy:Z.copy,test:Z.test,_get:Z._get};function ee(e,t){if(""==t)return e;var n={op:"_get",path:t};return te(e,n),n.value}function te(e,t,n,r,i,a){if(void 0===n&&(n=!1),void 0===r&&(r=!0),void 0===i&&(i=!0),void 0===a&&(a=0),n&&("function"==typeof n?n(t,0,e,t.path):ie(t,0)),""===t.path){var o={newDocument:e};if("add"===t.op)return o.newDocument=t.value,o;if("replace"===t.op)return o.newDocument=t.value,o.removed=e,o;if("move"===t.op||"copy"===t.op)return o.newDocument=ee(e,t.from),"move"===t.op&&(o.removed=e),o;if("test"===t.op){if(o.test=oe(e,t.value),!1===o.test)throw new $("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o.newDocument=e,o}if("remove"===t.op)return o.removed=e,o.newDocument=null,o;if("_get"===t.op)return t.value=e,o;if(n)throw new $("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,t,e);return o}r||(e=G(e));var s=(t.path||"").split("/"),u=e,c=1,l=s.length,f=void 0,d=void 0,h=void 0;for(h="function"==typeof n?n:ie;;){if((d=s[c])&&-1!=d.indexOf("~")&&(d=X(d)),i&&"__proto__"==d)throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&void 0===f&&(void 0===u[d]?f=s.slice(0,c).join("/"):c==l-1&&(f=t.path),void 0!==f&&h(t,0,e,f)),c++,Array.isArray(u)){if("-"===d)d=u.length;else{if(n&&!q(d))throw new $("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,t,e);q(d)&&(d=~~d)}if(c>=l){if(n&&"add"===t.op&&d>u.length)throw new $("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,t,e);if(!1===(o=Q[t.op].call(t,u,d,e)).test)throw new $("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o}}else if(c>=l){if(!1===(o=Z[t.op].call(t,u,d,e)).test)throw new $("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o}if(u=u[d],n&&c<l&&(!u||"object"!=typeof u))throw new $("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",a,t,e)}}function ne(e,t,n,r,i){if(void 0===r&&(r=!0),void 0===i&&(i=!0),n&&!Array.isArray(t))throw new $("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=G(e));for(var a=new Array(t.length),o=0,s=t.length;o<s;o++)a[o]=te(e,t[o],n,!0,i,o),e=a[o].newDocument;return a.newDocument=e,a}function re(e,t,n){var r=te(e,t);if(!1===r.test)throw new $("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function ie(e,t,n,r){if("object"!=typeof e||null===e||Array.isArray(e))throw new $("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(!Z[e.op])throw new $("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n);if("string"!=typeof e.path)throw new $("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new $('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new $("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new $("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&function e(t){if(void 0===t)return!0;if(t)if(Array.isArray(t)){for(var n=0,r=t.length;n<r;n++)if(e(t[n]))return!0}else if("object"==typeof t){var i=V(t),a=i.length;for(n=0;n<a;n++)if(e(t[i[n]]))return!0}return!1}(e.value))throw new $("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n)if("add"==e.op){var i=e.path.split("/").length,a=r.split("/").length;if(i!==a+1&&i!==a)throw new $("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==r)throw new $("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if("move"===e.op||"copy"===e.op){var o=ae([{op:"_get",path:e.from,value:void 0}],n);if(o&&"OPERATION_PATH_UNRESOLVABLE"===o.name)throw new $("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}function ae(e,t,n){try{if(!Array.isArray(e))throw new $("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)ne(G(t),G(e),n||!0);else{n=n||ie;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(e){if(e instanceof $)return e;throw e}}function oe(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var n,r,i,a=Array.isArray(e),o=Array.isArray(t);if(a&&o){if((r=e.length)!=t.length)return!1;for(n=r;0!=n--;)if(!oe(e[n],t[n]))return!1;return!0}if(a!=o)return!1;var s=Object.keys(e);if((r=s.length)!==Object.keys(t).length)return!1;for(n=r;0!=n--;)if(!t.hasOwnProperty(s[n]))return!1;for(n=r;0!=n--;)if(!oe(e[i=s[n]],t[i]))return!1;return!0}return e!=e&&t!=t}var se=new WeakMap,ue=function(e){this.observers=new Map,this.obj=e},ce=function(e,t){this.callback=e,this.observer=t};function le(e,t){t.unobserve()}function fe(e,t){var n,r=function(e){return se.get(e)}(e);if(r){var i=function(e,t){return e.observers.get(t)}(r,t);n=i&&i.observer}else r=new ue(e),se.set(e,r);if(n)return n;if(n={},r.value=G(e),t){n.callback=t,n.next=null;var a=function(){de(n)},o=function(){clearTimeout(n.next),n.next=setTimeout(a)};"undefined"!=typeof window&&(window.addEventListener("mouseup",o),window.addEventListener("keyup",o),window.addEventListener("mousedown",o),window.addEventListener("keydown",o),window.addEventListener("change",o))}return n.patches=[],n.object=e,n.unobserve=function(){de(n),clearTimeout(n.next),function(e,t){e.observers.delete(t.callback)}(r,n),"undefined"!=typeof window&&(window.removeEventListener("mouseup",o),window.removeEventListener("keyup",o),window.removeEventListener("mousedown",o),window.removeEventListener("keydown",o),window.removeEventListener("change",o))},r.observers.set(t,new ce(t,n)),n}function de(e,t){void 0===t&&(t=!1);var n=se.get(e.object);he(n.value,e.object,e.patches,"",t),e.patches.length&&ne(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function he(e,t,n,r,i){if(t!==e){"function"==typeof t.toJSON&&(t=t.toJSON());for(var a=V(t),o=V(e),s=!1,u=o.length-1;u>=0;u--){var c=e[f=o[u]];if(!W(t,f)||void 0===t[f]&&void 0!==c&&!1===Array.isArray(t))Array.isArray(e)===Array.isArray(t)?(i&&n.push({op:"test",path:r+"/"+H(f),value:G(c)}),n.push({op:"remove",path:r+"/"+H(f)}),s=!0):(i&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}));else{var l=t[f];"object"==typeof c&&null!=c&&"object"==typeof l&&null!=l&&Array.isArray(c)===Array.isArray(l)?he(c,l,n,r+"/"+H(f),i):c!==l&&(i&&n.push({op:"test",path:r+"/"+H(f),value:G(c)}),n.push({op:"replace",path:r+"/"+H(f),value:G(l)}))}}if(s||a.length!=o.length)for(u=0;u<a.length;u++){var f;W(e,f=a[u])||void 0===t[f]||n.push({op:"add",path:r+"/"+H(f),value:G(t[f])})}}}function pe(e,t,n){void 0===n&&(n=!1);var r=[];return he(e,t,r,"",n),r}Object.assign({},_,k,{JsonPatchError:Y,deepClone:G,escapePathComponent:H,unescapePathComponent:X});var me=n(133),ve=n.n(me),ge=n(179),ye=n(1),be=n(63),xe=n(44);function we(e){var t=e||ye.y,n=[],r={};return n.add=function(e){var i=t(e);return r[i]||(r[i]=1,n.push(e)),n},n.remove=function(e){var i=t(e);if(r[i]){r[i]=0;var a=n.indexOf(e);a>=0&&n.splice(a,1)}return n},n}function _e(e,t){return ke.apply(this,arguments)}function ke(){return ke=d(m().mark((function e(t,n){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n(t);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),t.error(e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])}))),ke.apply(this,arguments)}var Ee=Symbol("vega_id"),Se=1;function Ce(e){return!(!e||!Ae(e))}function Ae(e){return e[Ee]}function Oe(e,t){return e[Ee]=t,e}function De(e){var t=e===Object(e)?e:{data:e};return Ae(t)?t:Oe(t,Se++)}function Te(e){return je(e,De({}))}function je(e,t){for(var n in e)t[n]=e[n];return t}function Me(e,t){return Oe(t,Ae(e))}function Fe(e,t){return e?t?function(n,r){return e(n,r)||Ae(t(n))-Ae(t(r))}:function(t,n){return e(t,n)||Ae(t)-Ae(n)}:null}function Ie(e){return e&&e.constructor===Ne}function Ne(){var e=[],t=[],n=[],r=[],i=[],a=null,o=!1;return{constructor:Ne,insert:function(t){for(var n=Object(ye.i)(t),r=n.length,i=0;i<r;++i)e.push(n[i]);return this},remove:function(e){for(var n=Object(ye.E)(e)?r:t,i=Object(ye.i)(e),a=i.length,o=0;o<a;++o)n.push(i[o]);return this},modify:function(e,t,r){var a={field:t,value:Object(ye.m)(r)};return Object(ye.E)(e)?(a.filter=e,i.push(a)):(a.tuple=e,n.push(a)),this},encode:function(e,t){return Object(ye.E)(e)?i.push({filter:e,field:t}):n.push({tuple:e,field:t}),this},clean:function(e){return a=e,this},reflow:function(){return o=!0,this},pulse:function(s,u){var c,l,f,d,h,p,m={},v={};for(c=0,l=u.length;c<l;++c)m[Ae(u[c])]=1;for(c=0,l=t.length;c<l;++c)m[Ae(h=t[c])]=-1;for(c=0,l=r.length;c<l;++c)d=r[c],u.forEach((function(e){d(e)&&(m[Ae(e)]=-1)}));for(c=0,l=e.length;c<l;++c)p=Ae(h=e[c]),m[p]?m[p]=1:s.add.push(De(e[c]));for(c=0,l=u.length;c<l;++c)h=u[c],m[Ae(h)]<0&&s.rem.push(h);function g(e,t,n){n?e[t]=n(e):s.encode=t,o||(v[Ae(e)]=e)}for(c=0,l=n.length;c<l;++c)h=(f=n[c]).tuple,d=f.field,(p=m[Ae(h)])>0&&(g(h,d,f.value),s.modifies(d));for(c=0,l=i.length;c<l;++c)f=i[c],d=f.filter,u.forEach((function(e){d(e)&&m[Ae(e)]>0&&g(e,f.field,f.value)})),s.modifies(f.field);if(o)s.mod=t.length||r.length?u.filter((function(e){return m[Ae(e)]>0})):u.slice();else for(p in v)s.mod.push(v[p]);return(a||null==a&&(t.length||r.length))&&s.clean(!0),s}}}var Re="_:mod:_";function Pe(){Object.defineProperty(this,Re,{writable:!0,value:{}})}Pe.prototype={set:function(e,t,n,r){var i=this,a=i[e],o=i[Re];return null!=t&&t>=0?(a[t]!==n||r)&&(a[t]=n,o[t+":"+e]=-1,o[e]=-1):(a!==n||r)&&(i[e]=n,o[e]=Object(ye.B)(n)?1+n.length:-1),i},modified:function(e,t){var n=this[Re];if(!arguments.length){for(var r in n)if(n[r])return!0;return!1}if(Object(ye.B)(e)){for(var i=0;i<e.length;++i)if(n[e[i]])return!0;return!1}return null!=t&&t>=0?t+1<n[e]||!!n[t+":"+e]:!!n[e]},clear:function(){return this[Re]={},this}};var Be=0,Le=new Pe;function ze(e,t,n,r){this.id=++Be,this.value=e,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,t&&(this._update=t),n&&this.parameters(n,r)}function Ue(e){return function(t){var n=this.flags;return 0===arguments.length?!!(n&e):(this.flags=t?n|e:n&~e,this)}}ze.prototype={targets:function(){return this._targets||(this._targets=we(ye.x))},set:function(e){return this.value!==e?(this.value=e,1):0},skip:Ue(1),modified:Ue(2),parameters:function(e,t,n){var r=this;t=!1!==t;var i,a,o,s,u=this._argval=this._argval||new Pe,c=this._argops=this._argops||[],l=[],f=function(e,n,i){i instanceof ze?(i!==r&&(t&&i.targets().add(r),l.push(i)),c.push({op:i,name:e,index:n})):u.set(e,n,i)};for(i in e)if(a=e[i],"pulse"===i)Object(ye.i)(a).forEach((function(e){e instanceof ze?e!==r&&(e.targets().add(r),l.push(e)):Object(ye.o)("Pulse parameters must be operator instances.")})),this.source=a;else if(Object(ye.B)(a))for(u.set(i,-1,Array(o=a.length)),s=0;s<o;++s)f(i,s,a[s]);else f(i,-1,a);return this.marshall().clear(),n&&(c.initonly=!0),l},marshall:function(e){var t,n,r,i,a=this._argval||Le,o=this._argops;if(o){var s=o.length;for(n=0;n<s;++n)i=(r=(t=o[n]).op).modified()&&r.stamp===e,a.set(t.name,t.index,r.value,i);if(o.initonly){for(n=0;n<s;++n)(t=o[n]).op.targets().remove(this);this._argops=null,this._update=null}}return a},detach:function(){var e,t,n,r=this._argops;if(r)for(e=0,t=r.length;e<t;++e)(n=r[e].op)._targets&&n._targets.remove(this);this.pulse=null,this.source=null},evaluate:function(e){var t=this._update;if(t){var n=this.marshall(e.stamp),r=t.call(this,n,e);if(n.clear(),r!==this.value)this.value=r;else if(!this.modified())return e.StopPropagation}},run:function(e){return e.stamp<this.stamp?e.StopPropagation:(this.skip()?(this.skip(!1),t=0):t=this.evaluate(e),this.pulse=t||e);var t}};var We=0;function Ve(e,t,n){this.id=++We,this.value=null,n&&(this.receive=n),e&&(this._filter=e),t&&(this._apply=t)}function Ge(e,t,n){return new Ve(e,t,n)}Ve.prototype={_filter:ye.Ia,_apply:ye.y,targets:function(){return this._targets||(this._targets=we(ye.x))},consume:function(e){return arguments.length?(this._consume=!!e,this):!!this._consume},receive:function(e){if(this._filter(e)){for(var t=this.value=this._apply(e),n=this._targets,r=n?n.length:0,i=0;i<r;++i)n[i].receive(t);this._consume&&(e.preventDefault(),e.stopPropagation())}},filter:function(e){var t=Ge(e);return this.targets().add(t),t},apply:function(e){var t=Ge(null,e);return this.targets().add(t),t},merge:function(){var e=Ge();this.targets().add(e);for(var t=0,n=arguments.length;t<n;++t)arguments[t].targets().add(e);return e},throttle:function(e){var t=-1;return this.filter((function(){var n=Date.now();return n-t>e?(t=n,1):0}))},debounce:function(e){var t=Ge();return this.targets().add(Ge(null,null,Object(ye.n)(e,(function(e){var n=e.dataflow;t.receive(e),n&&n.run&&n.run()})))),t},between:function(e,t){var n=!1;return e.targets().add(Ge(null,null,(function(){return n=!0}))),t.targets().add(Ge(null,null,(function(){return n=!1}))),this.filter((function(){return n}))},detach:function(){this._filter=ye.Ia,this._targets=null}};var qe={skip:!0};function He(e,t,n,r,i,a){var o,s,u=Object(ye.p)({},a,qe);Object(ye.E)(n)||(n=Object(ye.m)(n)),void 0===r?o=function(t){return e.touch(n(t))}:Object(ye.E)(r)?(s=new ze(null,r,i,!1),o=function(t){s.evaluate(t);var r=n(t),i=s.value;Ie(i)?e.pulse(r,i,a):e.update(r,i,u)}):o=function(t){return e.update(n(t),r,u)},t.apply(o)}function Xe(e,t,n,r,i,a){if(void 0===r)t.targets().add(n);else{var o=a||{},s=new ze(null,function(e,t){return t=Object(ye.E)(t)?t:Object(ye.m)(t),e?function(n,r){var i=t(n,r);return e.skip()||(e.skip(i!==this.value).value=i),i}:t}(n,r),i,!1);s.modified(o.force),s.rank=t.rank,t.targets().add(s),n&&(s.skip(!0),s.value=n.value,s.targets().add(n),e.connect(n,[s]))}}var Ke={};function Ye(e,t,n){this.dataflow=e,this.stamp=null==t?-1:t,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=n||null}function $e(e,t){var n=[];return Object(ye.Ka)(e,t,(function(e){return n.push(e)})),n}function Je(e,t){var n={};return e.visit(t,(function(e){n[Ae(e)]=1})),function(e){return n[Ae(e)]?null:e}}function Ze(e,t){return e?function(n,r){return e(n,r)&&t(n,r)}:t}function Qe(e,t,n,r){var i=this,a=n.length,o=0;this.dataflow=e,this.stamp=t,this.fields=null,this.encode=r||null,this.pulses=n;for(var s=0;s<a;++s){var u=n[s];if(u.stamp===t){if(u.fields){var c=i.fields||(i.fields={});for(var l in u.fields)c[l]=1}u.changed(i.ADD)&&(o|=i.ADD),u.changed(i.REM)&&(o|=i.REM),u.changed(i.MOD)&&(o|=i.MOD)}}this.changes=o}function et(e){return e.error("Dataflow already running. Use runAsync() to chain invocations."),e}Ye.prototype={StopPropagation:Ke,ADD:1,REM:2,MOD:4,ADD_REM:3,ADD_MOD:5,ALL:7,REFLOW:8,SOURCE:16,NO_SOURCE:32,NO_FIELDS:64,fork:function(e){return new Ye(this.dataflow).init(this,e)},clone:function(){var e=this.fork(7);return e.add=e.add.slice(),e.rem=e.rem.slice(),e.mod=e.mod.slice(),e.source&&(e.source=e.source.slice()),e.materialize(23)},addAll:function(){var e=this;return!e.source||e.add===e.rem||!e.rem.length&&e.source.length===e.add.length||((e=new Ye(this.dataflow).init(this)).add=e.source,e.rem=[]),e},init:function(e,t){var n=this;return n.stamp=e.stamp,n.encode=e.encode,!e.fields||64&t||(n.fields=e.fields),1&t?(n.addF=e.addF,n.add=e.add):(n.addF=null,n.add=[]),2&t?(n.remF=e.remF,n.rem=e.rem):(n.remF=null,n.rem=[]),4&t?(n.modF=e.modF,n.mod=e.mod):(n.modF=null,n.mod=[]),32&t?(n.srcF=null,n.source=null):(n.srcF=e.srcF,n.source=e.source,e.cleans&&(n.cleans=e.cleans)),n},runAfter:function(e){this.dataflow.runAfter(e)},changed:function(e){var t=e||7;return 1&t&&this.add.length||2&t&&this.rem.length||4&t&&this.mod.length},reflow:function(e){if(e)return this.fork(7).reflow();var t=this.add.length,n=this.source&&this.source.length;return n&&n!==t&&(this.mod=this.source,t&&this.filter(4,Je(this,1))),this},clean:function(e){return arguments.length?(this.cleans=!!e,this):this.cleans},modifies:function(e){var t=this.fields||(this.fields={});return Object(ye.B)(e)?e.forEach((function(e){return t[e]=!0})):t[e]=!0,this},modified:function(e,t){var n=this.fields;return!(!t&&!this.mod.length||!n)&&(arguments.length?Object(ye.B)(e)?e.some((function(e){return n[e]})):n[e]:!!n)},filter:function(e,t){var n=this;return 1&e&&(n.addF=Ze(n.addF,t)),2&e&&(n.remF=Ze(n.remF,t)),4&e&&(n.modF=Ze(n.modF,t)),16&e&&(n.srcF=Ze(n.srcF,t)),n},materialize:function(e){var t=this;return 1&(e=e||7)&&t.addF&&(t.add=$e(t.add,t.addF),t.addF=null),2&e&&t.remF&&(t.rem=$e(t.rem,t.remF),t.remF=null),4&e&&t.modF&&(t.mod=$e(t.mod,t.modF),t.modF=null),16&e&&t.srcF&&(t.source=t.source.filter(t.srcF),t.srcF=null),t},visit:function(e,t){var n=this,r=t;if(16&e)return Object(ye.Ka)(n.source,n.srcF,r),n;1&e&&Object(ye.Ka)(n.add,n.addF,r),2&e&&Object(ye.Ka)(n.rem,n.remF,r),4&e&&Object(ye.Ka)(n.mod,n.modF,r);var i=n.source;if(8&e&&i){var a=n.add.length+n.mod.length;a===i.length||(a?Object(ye.Ka)(i,Je(n,5),r):Object(ye.Ka)(i,n.srcF,r))}return n}},Object(ye.z)(Qe,Ye,{fork:function(e){var t=new Ye(this.dataflow).init(this,e&this.NO_FIELDS);return void 0!==e&&(e&t.ADD&&this.visit(t.ADD,(function(e){return t.add.push(e)})),e&t.REM&&this.visit(t.REM,(function(e){return t.rem.push(e)})),e&t.MOD&&this.visit(t.MOD,(function(e){return t.mod.push(e)}))),t},changed:function(e){return this.changes&e},modified:function(e){var t=this,n=t.fields;return n&&t.changes&t.MOD?Object(ye.B)(e)?e.some((function(e){return n[e]})):n[e]:0},filter:function(){Object(ye.o)("MultiPulse does not support filtering.")},materialize:function(){Object(ye.o)("MultiPulse does not support materialization.")},visit:function(e,t){var n=this,r=n.pulses,i=r.length,a=0;if(e&n.SOURCE)for(;a<i;++a)r[a].visit(e,t);else for(;a<i;++a)r[a].stamp===n.stamp&&r[a].visit(e,t);return n}});var tt={skip:!1,force:!1};function nt(e){var t=[];return{clear:function(){return t=[]},size:function(){return t.length},peek:function(){return t[0]},push:function(n){return t.push(n),rt(t,0,t.length-1,e)},pop:function(){var n,r=t.pop();return t.length?(n=t[0],t[0]=r,function(e,t,n){for(var r,i=t,a=e.length,o=e[t],s=1+(t<<1);s<a;)(r=s+1)<a&&n(e[s],e[r])>=0&&(s=r),e[t]=e[s],s=1+((t=s)<<1);e[t]=o,rt(e,i,t,n)}(t,0,e)):n=r,n}}}function rt(e,t,n,r){for(var i,a,o=e[n];n>t&&r(o,i=e[a=n-1>>1])<0;)e[n]=i,n=a;return e[n]=o}function it(){this.logger(Object(ye.M)()),this.logLevel(ye.b),this._clock=0,this._rank=0,this._locale=Object(xe.a)();try{this._loader=Object(be.e)()}catch(e){}this._touched=we(ye.x),this._input={},this._pulse=null,this._heap=nt((function(e,t){return e.qrank-t.qrank})),this._postrun=[]}function at(e){return function(){return this._log[e].apply(this,arguments)}}function ot(e,t){ze.call(this,e,null,t)}it.prototype={stamp:function(){return this._clock},loader:function(e){return arguments.length?(this._loader=e,this):this._loader},locale:function(e){return arguments.length?(this._locale=e,this):this._locale},logger:function(e){return arguments.length?(this._log=e,this):this._log},error:at("error"),warn:at("warn"),info:at("info"),debug:at("debug"),logLevel:at("level"),cleanThreshold:1e4,add:function(e,t,n,r){var i,a=1;return e instanceof ze?i=e:e&&e.prototype instanceof ze?i=new e:Object(ye.E)(e)?i=new ze(null,e):(a=0,i=new ze(e,t)),this.rank(i),a&&(r=n,n=t),n&&this.connect(i,i.parameters(n,r)),this.touch(i),i},connect:function(e,t){for(var n=e.rank,r=t.length,i=0;i<r;++i)if(n<t[i].rank)return void this.rerank(e)},rank:function(e){e.rank=++this._rank},rerank:function(e){for(var t,n,r,i=[e];i.length;)if(this.rank(t=i.pop()),n=t._targets)for(r=n.length;--r>=0;)i.push(t=n[r]),t===e&&Object(ye.o)("Cycle detected in dataflow graph.")},pulse:function(e,t,n){this.touch(e,n||tt);var r=new Ye(this,this._clock+(this._pulse?0:1)),i=e.pulse&&e.pulse.source||[];return r.target=e,this._input[e.id]=t.pulse(r,i),this},touch:function(e,t){var n=t||tt;return this._pulse?this._enqueue(e):this._touched.add(e),n.skip&&e.skip(!0),this},update:function(e,t,n){var r=n||tt;return(e.set(t)||r.force)&&this.touch(e,r),this},changeset:Ne,ingest:function(e,t,n){return t=this.parse(t,n),this.pulse(e,this.changeset().insert(t))},parse:function(e,t){var n=this.locale();return Object(be.f)(e,t,n.timeParse,n.utcParse)},preload:function(){var e=d(m().mark((function e(t,n,r){var i,a,o;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(i=this)._pending||function(e){var t,n=new Promise((function(e){return t=e}));return n.requests=0,n.done=function(){0==--n.requests&&(e._pending=null,t(e))},e._pending=n}(i),a.requests+=1,e.next=4,i.request(n,r);case 4:return o=e.sent,e.abrupt("return",(i.pulse(t,i.changeset().remove(ye.Ia).insert(o.data||[])),a.done(),o));case 6:case"end":return e.stop()}}),e,this)})));function t(t,n,r){return e.apply(this,arguments)}return t}(),request:function(){var e=d(m().mark((function e(t,n){var r,i,a;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this,a=0,e.prev=2,e.next=5,r.loader().load(t,{context:"dataflow",response:Object(be.g)(n&&n.type)});case 5:i=e.sent;try{i=r.parse(i,n)}catch(n){a=-2,r.warn("Data ingestion failed",t,n)}e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),a=-1,r.warn("Loading failed",t,e.t0);case 12:return e.abrupt("return",{data:i,status:a});case 13:case"end":return e.stop()}}),e,this,[[2,9]])})));function t(t,n){return e.apply(this,arguments)}return t}(),events:function(e,t,n,r){for(var i,a=this,o=Ge(n,r),s=function(e){e.dataflow=a;try{o.receive(e)}catch(e){a.error(e)}finally{a.run()}},u=(i="string"==typeof e&&"undefined"!=typeof document?document.querySelectorAll(e):Object(ye.i)(e)).length,c=0;c<u;++c)i[c].addEventListener(t,s);return o},on:function(e,t,n,r,i){return(e instanceof ze?Xe:He)(this,e,t,n,r,i),this},evaluate:function(){var e=d(m().mark((function e(t,n,r){var i,a,o,s,u,c,l,f,d;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=[],!(i=this)._pulse){e.next=3;break}return e.abrupt("return",et(i));case 3:if(e.t0=i._pending,!e.t0){e.next=7;break}return e.next=7,i._pending;case 7:if(e.t1=n,!e.t1){e.next=11;break}return e.next=11,_e(i,n);case 11:if(i._touched.length){e.next=13;break}return e.abrupt("return",(i.debug("Dataflow invoked, but nothing to do."),i));case 13:o=++i._clock,i._pulse=new Ye(i,o,t),i._touched.forEach((function(e){return i._enqueue(e,!0)})),i._touched=we(ye.x),l=0,e.prev=16;case 17:if(!(i._heap.size()>0)){e.next=33;break}if((s=i._heap.pop()).rank!==s.qrank){e.next=30;break}if(!(u=s.run(i._getPulse(s,t))).then){e.next=25;break}return e.next=22,u;case 22:u=e.sent,e.next=26;break;case 25:u.async&&(a.push(u.async),u=Ke);case 26:u!==Ke&&s._targets&&s._targets.forEach((function(e){return i._enqueue(e)})),++l,e.next=31;break;case 30:i._enqueue(s,!0);case 31:e.next=17;break;case 33:e.next=38;break;case 35:e.prev=35,e.t2=e.catch(16),i._heap.clear(),c=e.t2;case 38:if(i._input={},i._pulse=null,i.debug("Pulse ".concat(o,": ").concat(l," operators")),c&&(i._postrun=[],i.error(c)),!i._postrun.length){e.next=48;break}f=i._postrun.sort((function(e,t){return t.priority-e.priority})),i._postrun=[],d=0;case 42:if(!(d<f.length)){e.next=48;break}return e.next=45,_e(i,f[d].callback);case 45:++d,e.next=42;break;case 48:if(e.t3=r,!e.t3){e.next=52;break}return e.next=52,_e(i,r);case 52:return a.length&&Promise.all(a).then((function(e){return i.runAsync(null,(function(){e.forEach((function(e){try{e(i)}catch(e){i.error(e)}}))}))})),e.abrupt("return",i);case 54:case"end":return e.stop()}}),e,this,[[16,35]])})));function t(t,n,r){return e.apply(this,arguments)}return t}(),run:function(e,t,n){return this._pulse?et(this):(this.evaluate(e,t,n),this)},runAsync:function(){var e=d(m().mark((function e(t,n,r){var i,a=this;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._running){e.next=5;break}return e.next=3,this._running;case 3:e.next=0;break;case 5:return i=function(){return a._running=null},e.abrupt("return",((this._running=this.evaluate(t,n,r)).then(i,i),this._running));case 7:case"end":return e.stop()}}),e,this)})));function t(t,n,r){return e.apply(this,arguments)}return t}(),runAfter:function(e,t,n){if(this._pulse||t)this._postrun.push({priority:n||0,callback:e});else try{e(this)}catch(e){this.error(e)}},_enqueue:function(e,t){var n=e.stamp<this._clock;n&&(e.stamp=this._clock),(n||t)&&(e.qrank=e.rank,this._heap.push(e))},_getPulse:function(e,t){var n=e.source,r=this._clock;return n&&Object(ye.B)(n)?new Qe(this,r,n.map((function(e){return e.pulse})),t):this._input[e.id]||function(e,t){return t&&t.stamp===e.stamp?t:(e=e.fork(),t&&t!==Ke&&(e.source=t.source),e)}(this._pulse,n&&n.pulse)}},Object(ye.z)(ot,ze,{run:function(e){var t,n=this;return e.stamp<this.stamp?e.StopPropagation:(this.skip()?this.skip(!1):t=this.evaluate(e),(t=t||e).then?t=t.then((function(e){return n.pulse=e})):t!==e.StopPropagation&&(this.pulse=t),t)},evaluate:function(e){var t=this.marshall(e.stamp),n=this.transform(t,e);return t.clear(),n},transform:function(){}});var st={};function ut(e){var t=ct(e);return t&&t.Definition||null}function ct(e){return e=e&&e.toLowerCase(),Object(ye.w)(st,e)?st[e]:null}var lt=n(87);function ft(e,t){var n;if(void 0===t){var r,i=p(e);try{for(i.s();!(r=i.n()).done;){var a=r.value;null!=a&&(n<a||void 0===n&&a>=a)&&(n=a)}}catch(l){i.e(l)}finally{i.f()}}else{var o,s=-1,u=p(e);try{for(u.s();!(o=u.n()).done;){var c=o.value;null!=(c=t(c,++s,e))&&(n<c||void 0===n&&c>=c)&&(n=c)}}catch(l){u.e(l)}finally{u.f()}}return n}function dt(e,t){var n;if(void 0===t){var r,i=p(e);try{for(i.s();!(r=i.n()).done;){var a=r.value;null!=a&&(n>a||void 0===n&&a>=a)&&(n=a)}}catch(l){i.e(l)}finally{i.f()}}else{var o,s=-1,u=p(e);try{for(u.s();!(o=u.n()).done;){var c=o.value;null!=(c=t(c,++s,e))&&(n>c||void 0===n&&c>=c)&&(n=c)}}catch(l){u.e(l)}finally{u.f()}}return n}function ht(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}var pt=function(e){return null===e?NaN:+e};function mt(e,t,n){if(r=(e=Float64Array.from(m().mark((function e(t,n){var r,i,a,o,s,u,c;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==n){e.next=22;break}r=p(t),e.prev=2,r.s();case 4:if((i=r.n()).done){e.next=12;break}if(a=i.value,e.t0=null!=a&&(a=+a)>=a,!e.t0){e.next=10;break}return e.next=10,a;case 10:e.next=4;break;case 12:e.next=17;break;case 14:e.prev=14,e.t1=e.catch(2),r.e(e.t1);case 17:return e.prev=17,r.f(),e.finish(17);case 20:e.next=42;break;case 22:o=-1,s=p(t),e.prev=24,s.s();case 26:if((u=s.n()).done){e.next=34;break}if(c=u.value,e.t2=null!=(c=n(c,++o,t))&&(c=+c)>=c,!e.t2){e.next=32;break}return e.next=32,c;case 32:e.next=26;break;case 34:e.next=39;break;case 36:e.prev=36,e.t3=e.catch(24),s.e(e.t3);case 39:return e.prev=39,s.f(),e.finish(39);case 42:case"end":return e.stop()}}),e,null,[[2,14,17,20],[24,36,39,42]])}))(e,n))).length){if((t=+t)<=0||r<2)return dt(e);if(t>=1)return ft(e);var r,i=(r-1)*t,a=Math.floor(i),o=ft(function e(t,n){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.length-1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:lt.a;i>r;){if(i-r>600){var o=i-r+1,s=n-r+1,u=Math.log(o),c=.5*Math.exp(2*u/3),l=.5*Math.sqrt(u*c*(o-c)/o)*(s-o/2<0?-1:1);e(t,n,Math.max(r,Math.floor(n-s*c/o+l)),Math.min(i,Math.floor(n+(o-s)*c/o+l)),a)}var f=t[n],d=r,h=i;for(ht(t,r,n),a(t[i],f)>0&&ht(t,r,i);d<h;){for(ht(t,d,h),++d,--h;a(t[d],f)<0;)++d;for(;a(t[h],f)>0;)--h}0===a(t[r],f)?ht(t,r,h):ht(t,++h,i),h<=n&&(r=h+1),n<=h&&(i=h-1)}return t}(e,a).subarray(0,a+1));return o+(dt(e.subarray(a+1))-o)*(i-a)}}function vt(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:pt;if(r=e.length){if((t=+t)<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,i=(r-1)*t,a=Math.floor(i),o=+n(e[a],a,e);return o+(+n(e[a+1],a+1,e)-o)*(i-a)}}var gt=function(e,t){return mt(e,.5,t)};function yt(e,t){var n,r,i,a,o,s,u;return m().wrap((function(c){for(;;)switch(c.prev=c.next){case 0:if(null!=t){c.next=22;break}n=p(e),c.prev=2,n.s();case 4:if((r=n.n()).done){c.next=12;break}if(i=r.value,c.t0=null!=i&&""!==i&&(i=+i)>=i,!c.t0){c.next=10;break}return c.next=10,i;case 10:c.next=4;break;case 12:c.next=17;break;case 14:c.prev=14,c.t1=c.catch(2),n.e(c.t1);case 17:return c.prev=17,n.f(),c.finish(17);case 20:c.next=42;break;case 22:a=-1,o=p(e),c.prev=24,o.s();case 26:if((s=o.n()).done){c.next=34;break}if(u=s.value,c.t2=null!=(u=t(u,++a,e))&&""!==u&&(u=+u)>=u,!c.t2){c.next=32;break}return c.next=32,u;case 32:c.next=26;break;case 34:c.next=39;break;case 36:c.prev=36,c.t3=c.catch(24),o.e(c.t3);case 39:return c.prev=39,o.f(),c.finish(39);case 42:case"end":return c.stop()}}),w,null,[[2,14,17,20],[24,36,39,42]])}function bt(e,t,n){var r=Float64Array.from(yt(e,n));return r.sort(lt.a),t.map((function(e){return vt(r,e)}))}function xt(e,t){return bt(e,[.25,.5,.75],t)}function wt(e,t){var n=e.length,r=function(e,t){var n=function(e,t){var n,r=0,i=0,a=0;if(void 0===t){var o,s=p(e);try{for(s.s();!(o=s.n()).done;){var u=o.value;null!=u&&(u=+u)>=u&&(a+=(n=u-i)*(u-(i+=n/++r)))}}catch(h){s.e(h)}finally{s.f()}}else{var c,l=-1,f=p(e);try{for(f.s();!(c=f.n()).done;){var d=c.value;null!=(d=t(d,++l,e))&&(d=+d)>=d&&(a+=(n=d-i)*(d-(i+=n/++r)))}}catch(h){f.e(h)}finally{f.f()}}if(r>1)return a/(r-1)}(e,t);return n?Math.sqrt(n):n}(e,t),i=xt(e,t),a=(i[2]-i[0])/1.34;return 1.06*(Math.min(r,a)||r||Math.abs(i[0])||1)*Math.pow(n,-.2)}function _t(e){var t,n,r,i,a,o,s=e.maxbins||20,u=e.base||10,c=Math.log(u),l=e.divide||[5,2],f=e.extent[0],d=e.extent[1],h=e.span||d-f||Math.abs(f)||1;if(e.step)t=e.step;else if(e.steps){for(i=h/s,a=0,o=e.steps.length;a<o&&e.steps[a]<i;++a);t=e.steps[Math.max(0,a-1)]}else{for(n=Math.ceil(Math.log(s)/c),r=e.minstep||0,t=Math.max(r,Math.pow(u,Math.round(Math.log(h)/c)-n));Math.ceil(h/t)>s;)t*=u;for(a=0,o=l.length;a<o;++a)(i=t/l[a])>=r&&h/i<=s&&(t=i)}var p=(i=Math.log(t))>=0?0:1+~~(-i/c),m=Math.pow(u,-p-1);return(e.nice||void 0===e.nice)&&(f=f<(i=Math.floor(f/t+m)*t)?i-t:i,d=Math.ceil(d/t)*t),{start:f,stop:d===f?f+t:d,step:t}}var kt=Math.random;function Et(e){kt=e}function St(e,t,n,r){if(!e.length)return[void 0,void 0];var i,a,o,s,u=Float64Array.from(yt(e,r)),c=u.length,l=t;for(o=0,s=Array(l);o<l;++o){for(i=0,a=0;a<c;++a)i+=u[~~(kt()*c)];s[o]=i/c}return s.sort(lt.a),[mt(s,n/2),mt(s,1-n/2)]}function Ct(e,t,n,r){r=r||function(e){return e};for(var i,a=e.length,o=new Float64Array(a),s=0,u=1,c=r(e[0]),l=c,f=c+t;u<a;++u){if((i=r(e[u]))>=f){for(l=(c+l)/2;s<u;++s)o[s]=l;f=i+t,c=i}l=i}for(l=(c+l)/2;s<u;++s)o[s]=l;return n?function(e,t){for(var n,r,i=e.length,a=0,o=1;e[a]===e[o];)++o;for(;o<i;){for(n=o+1;e[o]===e[n];)++n;if(e[o]-e[o-1]<t){for(r=o+(a+n-o-o>>1);r<o;)e[r++]=e[o];for(;r>o;)e[r--]=e[a]}a=o,o=n}return e}(o,t+t/4):o}function At(e){return function(){return(e=(1103515245*e+12345)%2147483647)/2147483647}}function Ot(e,t){var n,r,i;null==t&&(t=e,e=0);var a={min:function(e){return arguments.length?(i=r-(n=e||0),a):n},max:function(e){return arguments.length?(i=(r=e||0)-n,a):r},sample:function(){return n+Math.floor(i*kt())},pdf:function(e){return e===Math.floor(e)&&e>=n&&e<r?1/i:0},cdf:function(e){var t=Math.floor(e);return t<n?0:t>=r?1:(t-n+1)/i},icdf:function(e){return e>=0&&e<=1?n-1+Math.floor(e*i):NaN}};return a.min(e).max(t)}var Dt=Math.sqrt(2*Math.PI),Tt=Math.SQRT2,jt=NaN;function Mt(e,t){e=e||0,t=null==t?1:t;var n,r,i=0,a=0;if(jt==jt)i=jt,jt=NaN;else{do{n=(i=2*kt()-1)*i+(a=2*kt()-1)*a}while(0===n||n>1);i*=r=Math.sqrt(-2*Math.log(n)/n),jt=a*r}return e+i*t}function Ft(e,t,n){var r=(e-(t||0))/(n=null==n?1:n);return Math.exp(-.5*r*r)/(n*Dt)}function It(e,t,n){var r,i=(e-(t=t||0))/(n=null==n?1:n),a=Math.abs(i);if(a>37)r=0;else{var o=Math.exp(-a*a/2);a<7.07106781186547?(r=o*((((((.0352624965998911*a+.700383064443688)*a+6.37396220353165)*a+33.912866078383)*a+112.079291497871)*a+221.213596169931)*a+220.206867912376),r/=((((((.0883883476483184*a+1.75566716318264)*a+16.064177579207)*a+86.7807322029461)*a+296.564248779674)*a+637.333633378831)*a+793.826512519948)*a+440.413735824752):r=o/(a+1/(a+2/(a+3/(a+4/(a+.65)))))/2.506628274631}return i>0?1-r:r}function Nt(e,t,n){return e<0||e>1?NaN:(t||0)+(null==n?1:n)*Tt*function(e){var t=-Math.log((1-e)*(1+e));return(t<6.25?1.6536545626831027+(.24015818242558962+(((.00018673420803405714+(((4.2347877827932404e-7+(((1.0512122733215323e-9+(((26335093153082323e-28+(((6637638134358324e-30+(20972767875968562e-33+((11157877678025181e-33+(128584807152564e-32+(-364441206401782e-35*(t-=3.125)-16850591381820166e-35)*t)*t)*t-1333171662854621e-31)*t)*t)*t-4054566272975207e-29)*t-8151934197605472e-29)*t)*t-12975133253453532e-27)*t-5415412054294628e-26)*t)*t-4.112633980346984e-9)*t-2.9070369957882005e-8)*t)*t-13654692000834679e-22)*t-13882523362786469e-21)*t)*t-.000740702534166267)*t-.006033670871430149)*t)*t:t<16?3.0838856104922208+(1.0052589676941592+(.005370914553590064+((.002491442096107851+((.0009532893797373805+((24031110387097894e-21+(6828485145957318e-20+((12475304481671779e-21+(29234449089955446e-22+((15027403968909828e-22+(1.8239629214389228e-8+((9.075656193888539e-8+2.2137376921775787e-9*(t=Math.sqrt(t)-3.25))*t-2.7517406297064545e-7)*t)*t)*t-4013867526981546e-21)*t)*t)*t-47318229009055734e-21)*t)*t)*t-.0003550375203628475)*t)*t-.0016882755560235047)*t)*t-.003751208507569241)*t)*t)*t:Number.isFinite(t)?4.849906401408584+(1.0103004648645344+(((7599527703001776e-20+((4526062597223154e-21+((2.2900482228026655e-7+((2.914795345090108e-8+((7.61570120807834e-9+((1.5076572693500548e-9+(-27109920616438573e-27*(t=Math.sqrt(t)-5)-2.555641816996525e-10)*t)*t-3.789465440126737e-9)*t)*t-1.496002662714924e-8)*t)*t-6.771199775845234e-8)*t)*t-9.9298272942317e-7)*t)*t-1968177810553167e-20)*t)*t-.00021503011930044477)*t-.00013871931833623122)*t)*t:1/0)*e}(2*e-1)}function Rt(e,t){var n,r,i={mean:function(e){return arguments.length?(n=e||0,i):n},stdev:function(e){return arguments.length?(r=null==e?1:e,i):r},sample:function(){return Mt(n,r)},pdf:function(e){return Ft(e,n,r)},cdf:function(e){return It(e,n,r)},icdf:function(e){return Nt(e,n,r)}};return i.mean(e).stdev(t)}function Pt(e,t){var n=Rt(),r=0,i={data:function(n){return arguments.length?(e=n,r=n?n.length:0,i.bandwidth(t)):e},bandwidth:function(n){return arguments.length?(!(t=n)&&e&&(t=wt(e)),i):t},sample:function(){return e[~~(kt()*r)]+t*n.sample()},pdf:function(i){for(var a=0,o=0;o<r;++o)a+=n.pdf((i-e[o])/t);return a/t/r},cdf:function(i){for(var a=0,o=0;o<r;++o)a+=n.cdf((i-e[o])/t);return a/r},icdf:function(){throw Error("KDE icdf not supported.")}};return i.data(e)}function Bt(e,t){return e=e||0,t=null==t?1:t,Math.exp(e+Mt()*t)}function Lt(e,t,n){if(e<=0)return 0;t=t||0,n=null==n?1:n;var r=(Math.log(e)-t)/n;return Math.exp(-.5*r*r)/(n*Dt*e)}function zt(e,t,n){return It(Math.log(e),t,n)}function Ut(e,t,n){return Math.exp(Nt(e,t,n))}function Wt(e,t){var n,r,i={mean:function(e){return arguments.length?(n=e||0,i):n},stdev:function(e){return arguments.length?(r=null==e?1:e,i):r},sample:function(){return Bt(n,r)},pdf:function(e){return Lt(e,n,r)},cdf:function(e){return zt(e,n,r)},icdf:function(e){return Ut(e,n,r)}};return i.mean(e).stdev(t)}function Vt(e,t){var n,r=0,i={weights:function(e){return arguments.length?(n=function(e){var t,n=[],i=0;for(t=0;t<r;++t)i+=n[t]=null==e[t]?1:+e[t];for(t=0;t<r;++t)n[t]/=i;return n}(t=e||[]),i):t},distributions:function(n){return arguments.length?(n?(r=n.length,e=n):(r=0,e=[]),i.weights(t)):e},sample:function(){for(var t=kt(),i=e[r-1],a=n[0],o=0;o<r-1;a+=n[++o])if(t<a){i=e[o];break}return i.sample()},pdf:function(t){for(var i=0,a=0;a<r;++a)i+=n[a]*e[a].pdf(t);return i},cdf:function(t){for(var i=0,a=0;a<r;++a)i+=n[a]*e[a].cdf(t);return i},icdf:function(){throw Error("Mixture icdf not supported.")}};return i.distributions(e).weights(t)}function Gt(e,t){return null==t&&(t=null==e?1:e,e=0),e+(t-e)*kt()}function qt(e,t,n){return null==n&&(n=null==t?1:t,t=0),e>=t&&e<=n?1/(n-t):0}function Ht(e,t,n){return null==n&&(n=null==t?1:t,t=0),e<t?0:e>n?1:(e-t)/(n-t)}function Xt(e,t,n){return null==n&&(n=null==t?1:t,t=0),e>=0&&e<=1?t+e*(n-t):NaN}function Kt(e,t){var n,r,i={min:function(e){return arguments.length?(n=e||0,i):n},max:function(e){return arguments.length?(r=null==e?1:e,i):r},sample:function(){return Gt(n,r)},pdf:function(e){return qt(e,n,r)},cdf:function(e){return Ht(e,n,r)},icdf:function(e){return Xt(e,n,r)}};return null==t&&(t=null==e?1:e,e=0),i.min(e).max(t)}function Yt(e,t,n,r){var i=r-e*e,a=Math.abs(i)<1e-24?0:(n-e*t)/i;return[t-a*e,a]}function $t(e,t,n,r){e=e.filter((function(e){var r=t(e),i=n(e);return null!=r&&(r=+r)>=r&&null!=i&&(i=+i)>=i})),r&&e.sort((function(e,n){return t(e)-t(n)}));var i,a,o,s,u=e.length,c=new Float64Array(u),l=new Float64Array(u),f=0,d=0,h=0,m=p(e);try{for(m.s();!(s=m.n()).done;)o=s.value,c[f]=i=+t(o),l[f]=a=+n(o),d+=(i-d)/++f,h+=(a-h)/f}catch(v){m.e(v)}finally{m.f()}for(f=0;f<u;++f)c[f]-=d,l[f]-=h;return[c,l,d,h]}function Jt(e,t,n,r){var i,a,o,s=-1,u=p(e);try{for(u.s();!(o=u.n()).done;){var c=o.value;i=t(c),a=n(c),null!=i&&(i=+i)>=i&&null!=a&&(a=+a)>=a&&r(i,a,++s)}}catch(l){u.e(l)}finally{u.f()}}function Zt(e,t,n,r,i){var a=0,o=0;return Jt(e,t,n,(function(e,t){var n=t-i(e),s=t-r;a+=n*n,o+=s*s})),1-a/o}function Qt(e,t,n){var r=0,i=0,a=0,o=0,s=0;Jt(e,t,n,(function(e,t){r+=(e-r)/++s,i+=(t-i)/s,a+=(e*t-a)/s,o+=(e*e-o)/s}));var u=Yt(r,i,a,o),c=function(e){return u[0]+u[1]*e};return{coef:u,predict:c,rSquared:Zt(e,t,n,i,c)}}function en(e,t,n){var r=0,i=0,a=0,o=0,s=0;Jt(e,t,n,(function(e,t){++s,e=Math.log(e),r+=(e-r)/s,i+=(t-i)/s,a+=(e*t-a)/s,o+=(e*e-o)/s}));var u=Yt(r,i,a,o),c=function(e){return u[0]+u[1]*Math.log(e)};return{coef:u,predict:c,rSquared:Zt(e,t,n,i,c)}}function tn(e,t,n){var r,i,a,o=$t(e,t,n),s=f(o,4),u=s[0],c=(s[1],s[2]),l=s[3],d=0,h=0,p=0,m=0,v=0;Jt(e,t,n,(function(e,t){r=u[v++],i=Math.log(t),d+=(t*i-d)/v,h+=((a=r*t)-h)/v,p+=(a*i-p)/v,m+=(r*a-m)/v}));var g=Yt(h/l,d/l,p/l,m/l),y=f(g,2),b=y[0],x=y[1],w=function(e){return Math.exp(b+x*(e-c))};return{coef:[Math.exp(b-x*c),x],predict:w,rSquared:Zt(e,t,n,l,w)}}function nn(e,t,n){var r=0,i=0,a=0,o=0,s=0,u=0;Jt(e,t,n,(function(e,t){var n=Math.log(e),c=Math.log(t);r+=(n-r)/++u,i+=(c-i)/u,a+=(n*c-a)/u,o+=(n*n-o)/u,s+=(t-s)/u}));var c=Yt(r,i,a,o),l=function(e){return c[0]*Math.pow(e,c[1])};return c[0]=Math.exp(c[0]),{coef:c,predict:l,rSquared:Zt(e,t,n,s,l)}}function rn(e,t,n){var r,i,a,o,s=$t(e,t,n),u=f(s,4),c=u[0],l=u[1],d=u[2],h=u[3],p=c.length,m=0,v=0,g=0,y=0,b=0;for(r=0;r<p;)i=c[r],a=l[r++],m+=((o=i*i)-m)/r,v+=(o*i-v)/r,g+=(o*o-g)/r,y+=(i*a-y)/r,b+=(o*a-b)/r;var x=g-m*m,w=m*x-v*v,_=(b*m-y*v)/w,k=(y*x-b*v)/w,E=-_*m,S=function(e){return _*(e-=d)*e+k*e+E+h};return{coef:[E-k*d+_*d*d+h,k-2*_*d,_],predict:S,rSquared:Zt(e,t,n,h,S)}}function an(e,t,n,r){if(1===r)return Qt(e,t,n);if(2===r)return rn(e,t,n);var i,a,o,s,u,c=$t(e,t,n),l=f(c,4),d=l[0],h=l[1],p=l[2],m=l[3],v=d.length,g=[],y=[],b=r+1;for(i=0;i<b;++i){for(o=0,s=0;o<v;++o)s+=Math.pow(d[o],i)*h[o];for(g.push(s),u=new Float64Array(b),a=0;a<b;++a){for(o=0,s=0;o<v;++o)s+=Math.pow(d[o],i+a);u[a]=s}y.push(u)}y.push(g);var x=function(e){var t,n,r,i,a,o=e.length-1,s=[];for(t=0;t<o;++t){for(i=t,n=t+1;n<o;++n)Math.abs(e[t][n])>Math.abs(e[t][i])&&(i=n);for(r=t;r<o+1;++r)a=e[r][t],e[r][t]=e[r][i],e[r][i]=a;for(n=t+1;n<o;++n)for(r=o;r>=t;r--)e[r][n]-=e[r][t]*e[t][n]/e[t][t]}for(n=o-1;n>=0;--n){for(a=0,r=n+1;r<o;++r)a+=e[r][n]*s[r];s[n]=(e[o][n]-a)/e[n][n]}return s}(y),w=function(e){e-=p;var t=m+x[0]+x[1]*e+x[2]*e*e;for(i=3;i<b;++i)t+=x[i]*Math.pow(e,i);return t};return{coef:function(e,t,n,r){var i,a,o,s,u=Array(e);for(i=0;i<e;++i)u[i]=0;for(i=e-1;i>=0;--i)for(o=t[i],s=1,u[i]+=o,a=1;a<=i;++a)s*=(i+1-a)/a,u[i-a]+=o*Math.pow(n,a)*s;return u[0]+=r,u}(b,x,-p,m),predict:w,rSquared:Zt(e,t,n,m,w)}}var on=2,sn=1e-12;function un(e,t,n,r){for(var i=$t(e,t,n,!0),a=f(i,4),o=a[0],s=a[1],u=a[2],c=a[3],l=o.length,d=Math.max(2,~~(r*l)),h=new Float64Array(l),p=new Float64Array(l),m=new Float64Array(l).fill(1),v=-1;++v<=on;){for(var g=[0,d-1],y=0;y<l;++y){for(var b=o[y],x=g[0],w=g[1],_=b-o[x]>o[w]-b?x:w,k=0,E=0,S=0,C=0,A=0,O=1/Math.abs(o[_]-b||1),D=x;D<=w;++D){var T=o[D],j=s[D],M=cn(Math.abs(b-T)*O)*m[D],F=T*M;k+=M,E+=F,S+=j*M,C+=j*F,A+=T*F}var I=Yt(E/k,S/k,C/k,A/k),N=f(I,2),R=N[0],P=N[1];h[y]=R+P*b,p[y]=Math.abs(s[y]-h[y]),ln(o,y+1,g)}if(v===on)break;var B=gt(p);if(Math.abs(B)<sn)break;for(var L,z,U=0;U<l;++U)L=p[U]/(6*B),m[U]=L>=1?sn:(z=1-L*L)*z}return function(e,t,n,r){for(var i,a=e.length,o=[],s=0,u=0,c=[];s<a;++s)i=e[s]+n,c[0]===i?c[1]+=(t[s]-c[1])/++u:(u=0,c[1]+=r,c=[i,t[s]],o.push(c));return c[1]+=r,o}(o,h,u,c)}function cn(e){return(e=1-e*e*e)*e*e}function ln(e,t,n){var r=e[t],i=n[0],a=n[1]+1;if(!(a>=e.length))for(;t>i&&e[a]-r<=r-e[i];)n[0]=++i,n[1]=a,++a}var fn=.5*Math.PI/180;function dn(e,t,n,r){n=n||25,r=Math.max(n,r||200);var i=function(t){return[t,e(t)]},a=t[0],o=t[1],s=o-a,u=s/r,c=[i(a)],l=[];if(n===r){for(var f=1;f<r;++f)c.push(i(a+f/n*s));return c.push(i(o)),c}l.push(i(o));for(var d=n;--d>0;)l.push(i(a+d/n*s));for(var h=c[0],p=l[l.length-1],m=1/s,v=function(e,t){for(var n=e,r=e,i=t.length,a=0;a<i;++a){var o=t[a][1];o<n&&(n=o),o>r&&(r=o)}return 1/(r-n)}(h[1],l);p;){var g=i((h[0]+p[0])/2);g[0]-h[0]>=u&&hn(h,g,p,m,v)>fn?l.push(g):(h=p,c.push(p),l.pop()),p=l[l.length-1]}return c}function hn(e,t,n,r,i){var a=Math.atan2(i*(n[1]-e[1]),r*(n[0]-e[0])),o=Math.atan2(i*(t[1]-e[1]),r*(t[0]-e[0]));return Math.abs(a-o)}var pn=function(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var r=-1,i=0|Math.max(0,Math.ceil((t-e)/n)),a=new Array(i);++r<i;)a[r]=e+r*n;return a},mn=n(108),vn=n(11);function gn(e){return e&&e.length?1===e.length?e[0]:function(e){return function(t){for(var n=e.length,r=1,i=String(e[0](t));r<n;++r)i+="|"+e[r](t);return i}}(e):function(){return""}}function yn(e,t,n){return n||e+(t?"_"+t:"")}var bn=function(){},xn={init:bn,add:bn,rem:bn,idx:0},wn={values:{init:function(e){return e.cell.store=!0},value:function(e){return e.cell.data.values()},idx:-1},count:{value:function(e){return e.cell.num}},__count__:{value:function(e){return e.missing+e.valid}},missing:{value:function(e){return e.missing}},valid:{value:function(e){return e.valid}},sum:{init:function(e){return e.sum=0},value:function(e){return e.sum},add:function(e,t){return e.sum+=+t},rem:function(e,t){return e.sum-=t}},product:{init:function(e){return e.product=1},value:function(e){return e.valid?e.product:void 0},add:function(e,t){return e.product*=t},rem:function(e,t){return e.product/=t}},mean:{init:function(e){return e.mean=0},value:function(e){return e.valid?e.mean:void 0},add:function(e,t){return e.mean_d=t-e.mean,e.mean+=e.mean_d/e.valid},rem:function(e,t){return e.mean_d=t-e.mean,e.mean-=e.valid?e.mean_d/e.valid:e.mean}},average:{value:function(e){return e.valid?e.mean:void 0},req:["mean"],idx:1},variance:{init:function(e){return e.dev=0},value:function(e){return e.valid>1?e.dev/(e.valid-1):void 0},add:function(e,t){return e.dev+=e.mean_d*(t-e.mean)},rem:function(e,t){return e.dev-=e.mean_d*(t-e.mean)},req:["mean"],idx:1},variancep:{value:function(e){return e.valid>1?e.dev/e.valid:void 0},req:["variance"],idx:2},stdev:{value:function(e){return e.valid>1?Math.sqrt(e.dev/(e.valid-1)):void 0},req:["variance"],idx:2},stdevp:{value:function(e){return e.valid>1?Math.sqrt(e.dev/e.valid):void 0},req:["variance"],idx:2},stderr:{value:function(e){return e.valid>1?Math.sqrt(e.dev/(e.valid*(e.valid-1))):void 0},req:["variance"],idx:2},distinct:{value:function(e){return e.cell.data.distinct(e.get)},req:["values"],idx:3},ci0:{value:function(e){return e.cell.data.ci0(e.get)},req:["values"],idx:3},ci1:{value:function(e){return e.cell.data.ci1(e.get)},req:["values"],idx:3},median:{value:function(e){return e.cell.data.q2(e.get)},req:["values"],idx:3},q1:{value:function(e){return e.cell.data.q1(e.get)},req:["values"],idx:3},q3:{value:function(e){return e.cell.data.q3(e.get)},req:["values"],idx:3},min:{init:function(e){return e.min=void 0},value:function(e){return e.min=Number.isNaN(e.min)?e.cell.data.min(e.get):e.min},add:function(e,t){(t<e.min||void 0===e.min)&&(e.min=t)},rem:function(e,t){t<=e.min&&(e.min=NaN)},req:["values"],idx:4},max:{init:function(e){return e.max=void 0},value:function(e){return e.max=Number.isNaN(e.max)?e.cell.data.max(e.get):e.max},add:function(e,t){(t>e.max||void 0===e.max)&&(e.max=t)},rem:function(e,t){t>=e.max&&(e.max=NaN)},req:["values"],idx:4},argmin:{init:function(e){return e.argmin=void 0},value:function(e){return e.argmin||e.cell.data.argmin(e.get)},add:function(e,t,n){t<e.min&&(e.argmin=n)},rem:function(e,t){t<=e.min&&(e.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:function(e){return e.argmax=void 0},value:function(e){return e.argmax||e.cell.data.argmax(e.get)},add:function(e,t,n){t>e.max&&(e.argmax=n)},rem:function(e,t){t>=e.max&&(e.argmax=void 0)},req:["max","values"],idx:3}},_n=Object.keys(wn);function kn(e,t){return wn[e](t)}function En(e,t){return e.idx-t.idx}function Sn(){var e=this;this.valid=0,this.missing=0,this._ops.forEach((function(t){return t.init(e)}))}function Cn(e,t){var n=this;null!=e&&""!==e?e==e&&(++this.valid,this._ops.forEach((function(r){return r.add(n,e,t)}))):++this.missing}function An(e,t){var n=this;null!=e&&""!==e?e==e&&(--this.valid,this._ops.forEach((function(r){return r.rem(n,e,t)}))):--this.missing}function On(e){var t=this;return this._out.forEach((function(n){return e[n.out]=n.value(t)})),e}function Dn(e,t){var n=t||ye.y,r=function(e){var t={};e.forEach((function(e){return t[e.name]=e}));var n=function e(n){n.req&&n.req.forEach((function(n){t[n]||e(t[n]=wn[n]())}))};return e.forEach(n),Object.values(t).sort(En)}(e),i=e.slice().sort(En);function a(e){this._ops=r,this._out=i,this.cell=e,this.init()}return a.prototype.init=Sn,a.prototype.add=Cn,a.prototype.rem=An,a.prototype.set=On,a.prototype.get=n,a.fields=e.map((function(e){return e.out})),a}function Tn(e){this._key=e?Object(ye.u)(e):Ae,this.reset()}_n.forEach((function(e){wn[e]=function(e,t){return function(n){return Object(ye.p)({name:e,out:n||e},xn,t)}}(e,wn[e])}));var jn=Tn.prototype;function Mn(e){ot.call(this,null,e),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}function Fn(e){ot.call(this,null,e)}function In(e,t,n){var r=e,i=t||[],a=n||[],o={},s=0;return{add:function(e){return a.push(e)},remove:function(e){return o[r(e)]=++s},size:function(){return i.length},data:function(e,t){return s&&(i=i.filter((function(e){return!o[r(e)]})),o={},s=0),t&&e&&i.sort(e),a.length&&(i=e?Object(ye.O)(e,i,a.sort(e)):i.concat(a),a=[]),i}}}function Nn(e){ot.call(this,[],e)}function Rn(e){ze.call(this,null,Pn,e)}function Pn(e){return this.value&&!e.modified()?this.value:Object(ye.l)(e.fields,e.orders)}function Bn(e){ot.call(this,null,e)}function Ln(e){ot.call(this,null,e)}jn.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null},jn.add=function(e){this._add.push(e)},jn.rem=function(e){this._rem.push(e)},jn.values=function(){if(this._get=null,0===this._rem.length)return this._add;var e,t,n,r=this._add,i=this._rem,a=this._key,o=r.length,s=i.length,u=Array(o-s),c={};for(e=0;e<s;++e)c[a(i[e])]=1;for(e=0,t=0;e<o;++e)c[a(n=r[e])]?c[a(n)]=0:u[t++]=n;return this._rem=[],this._add=u},jn.distinct=function(e){for(var t,n=this.values(),r={},i=n.length,a=0;--i>=0;)t=e(n[i])+"",Object(ye.w)(r,t)||(r[t]=1,++a);return a},jn.extent=function(e){if(this._get!==e||!this._ext){var t=this.values(),n=Object(ye.r)(t,e);this._ext=[t[n[0]],t[n[1]]],this._get=e}return this._ext},jn.argmin=function(e){return this.extent(e)[0]||{}},jn.argmax=function(e){return this.extent(e)[1]||{}},jn.min=function(e){var t=this.extent(e)[0];return null!=t?e(t):void 0},jn.max=function(e){var t=this.extent(e)[1];return null!=t?e(t):void 0},jn.quartile=function(e){return this._get===e&&this._q||(this._q=xt(this.values(),e),this._get=e),this._q},jn.q1=function(e){return this.quartile(e)[0]},jn.q2=function(e){return this.quartile(e)[1]},jn.q3=function(e){return this.quartile(e)[2]},jn.ci=function(e){return this._get===e&&this._ci||(this._ci=St(this.values(),1e3,.05,e),this._get=e),this._ci},jn.ci0=function(e){return this.ci(e)[0]},jn.ci1=function(e){return this.ci(e)[1]},Mn.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:_n},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]},Object(ye.z)(Mn,ot,{transform:function(e,t){var n=this,r=this,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),a=e.modified();return r.stamp=i.stamp,r.value&&(a||t.modified(r._inputs,!0))?(r._prev=r.value,r.value=a?r.init(e):{},t.visit(t.SOURCE,(function(e){return r.add(e)}))):(r.value=r.value||r.init(e),t.visit(t.REM,(function(e){return r.rem(e)})),t.visit(t.ADD,(function(e){return r.add(e)}))),i.modifies(r._outputs),r._drop=!1!==e.drop,e.cross&&r._dims.length>1&&(r._drop=!1,r.cross()),t.clean()&&r._drop&&i.clean(!0).runAfter((function(){return n.clean()})),r.changes(i)},cross:function(){var e=this,t=e.value,n=e._dnames,r=n.map((function(){return{}})),i=n.length;function a(e){var t,a,o,s;for(t in e)for(o=e[t].tuple,a=0;a<i;++a)r[a][s=o[n[a]]]=s}a(e._prev),a(t),function a(o,s,u){var c=n[u],l=r[u++];for(var f in l){var d=o?o+"|"+f:f;s[c]=l[f],u<i?a(d,s,u):t[d]||e.cell(d,s)}}("",{},0)},init:function(e){var t=this._inputs=[],n=this._outputs=[],r={};function i(e){for(var n,i=Object(ye.i)(Object(ye.g)(e)),a=i.length,o=0;o<a;++o)r[n=i[o]]||(r[n]=1,t.push(n))}this._dims=Object(ye.i)(e.groupby),this._dnames=this._dims.map((function(e){var t=Object(ye.h)(e);return i(e),n.push(t),t})),this.cellkey=e.key?e.key:gn(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];var a,o,s,u,c,l,f=e.fields||[null],d=e.ops||["count"],h=e.as||[],p=f.length,m={};for(p!==d.length&&Object(ye.o)("Unmatched number of fields and aggregate ops."),l=0;l<p;++l)a=f[l],o=d[l],null==a&&"count"!==o&&Object(ye.o)("Null aggregate field specified."),c=yn(o,u=Object(ye.h)(a),h[l]),n.push(c),"count"!==o?((s=m[u])||(i(a),(s=m[u]=[]).field=a,this._measures.push(s)),"count"!==o&&(this._countOnly=!1),s.push(kn(o,c))):this._counts.push(c);return this._measures=this._measures.map((function(e){return Dn(e,e.field)})),{}},cellkey:gn(),cell:function(e,t){var n=this.value[e];return n?0===n.num&&this._drop&&n.stamp<this.stamp?(n.stamp=this.stamp,this._adds[this._alen++]=n):n.stamp<this.stamp&&(n.stamp=this.stamp,this._mods[this._mlen++]=n):(n=this.value[e]=this.newcell(e,t),this._adds[this._alen++]=n),n},newcell:function(e,t){var n={key:e,num:0,agg:null,tuple:this.newtuple(t,this._prev&&this._prev[e]),stamp:this.stamp,store:!1};if(!this._countOnly){var r=this._measures,i=r.length;n.agg=Array(i);for(var a=0;a<i;++a)n.agg[a]=new r[a](n)}return n.store&&(n.data=new Tn),n},newtuple:function(e,t){for(var n=this._dnames,r=this._dims,i=r.length,a={},o=0;o<i;++o)a[n[o]]=r[o](e);return t?Me(t.tuple,a):De(a)},clean:function(){var e=this.value;for(var t in e)0===e[t].num&&delete e[t]},add:function(e){var t=this.cellkey(e),n=this.cell(t,e);if(n.num+=1,!this._countOnly){n.store&&n.data.add(e);for(var r=n.agg,i=0,a=r.length;i<a;++i)r[i].add(r[i].get(e),e)}},rem:function(e){var t=this.cellkey(e),n=this.cell(t,e);if(n.num-=1,!this._countOnly){n.store&&n.data.rem(e);for(var r=n.agg,i=0,a=r.length;i<a;++i)r[i].rem(r[i].get(e),e)}},celltuple:function(e){var t=e.tuple,n=this._counts;e.store&&e.data.values();for(var r=0,i=n.length;r<i;++r)t[n[r]]=e.num;if(!this._countOnly)for(var a=e.agg,o=0,s=a.length;o<s;++o)a[o].set(t);return t},changes:function(e){var t,n,r,i,a=this._adds,o=this._mods,s=this._prev,u=this._drop,c=e.add,l=e.rem,f=e.mod;if(s)for(n in s)t=s[n],u&&!t.num||l.push(t.tuple);for(r=0,i=this._alen;r<i;++r)c.push(this.celltuple(a[r])),a[r]=null;for(r=0,i=this._mlen;r<i;++r)(0===(t=o[r]).num&&u?l:f).push(this.celltuple(t)),o[r]=null;return this._alen=this._mlen=0,this._prev=null,e}}),Fn.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]},Object(ye.z)(Fn,ot,{transform:function(e,t){var n,r=!1!==e.interval,i=this._bins(e),a=i.start,o=i.step,s=e.as||["bin0","bin1"],u=s[0],c=s[1];return n=e.modified()?(t=t.reflow(!0)).SOURCE:t.modified(Object(ye.g)(e.field))?t.ADD_MOD:t.ADD,t.visit(n,r?function(e){var t=i(e);e[u]=t,e[c]=null==t?null:a+o*(1+(t-a)/o)}:function(e){return e[u]=i(e)}),t.modifies(r?s:u)},_bins:function(e){if(this.value&&!e.modified())return this.value;var t,n,r=e.field,i=_t(e),a=i.step,o=i.start,s=o+Math.ceil((i.stop-o)/a)*a;null!=(t=e.anchor)&&(n=t-(o+a*Math.floor((t-o)/a)),o+=n,s+=n);var u=function(e){var t=Object(ye.Ea)(r(e));return null==t?null:t<o?-1/0:t>s?1/0:(t=Math.max(o,Math.min(t,s-a)),o+a*Math.floor(1e-14+(t-o)/a))};return u.start=o,u.stop=i.stop,u.step=a,this.value=Object(ye.f)(u,Object(ye.g)(r),e.name||"bin_"+Object(ye.h)(r))}}),Nn.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]},Object(ye.z)(Nn,ot,{transform:function(e,t){var n=t.fork(t.ALL),r=In(Ae,this.value,n.materialize(n.ADD).add),i=e.sort,a=t.changed()||i&&(e.modified("sort")||t.modified(i.fields));return n.visit(n.REM,r.remove),this.modified(a),this.value=n.source=r.data(Fe(i),a),t.source&&t.source.root&&(this.value.root=t.source.root),n}}),Object(ye.z)(Rn,ze),Bn.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]},Object(ye.z)(Bn,ot,{transform:function(e,t){var n=function(t){return function(n){for(var r,i=function(e,t,n){switch(t){case"upper":e=e.toUpperCase();break;case"lower":e=e.toLowerCase()}return e.match(n)}(s(n),e.case,a)||[],u=0,c=i.length;u<c;++u)o.test(r=i[u])||t(r)}},r=this._parameterCheck(e,t),i=this._counts,a=this._match,o=this._stop,s=e.field,u=e.as||["text","count"],c=n((function(e){return i[e]=1+(i[e]||0)})),l=n((function(e){return i[e]-=1}));return r?t.visit(t.SOURCE,c):(t.visit(t.ADD,c),t.visit(t.REM,l)),this._finish(t,u)},_parameterCheck:function(e,t){var n=!1;return!e.modified("stopwords")&&this._stop||(this._stop=new RegExp("^"+(e.stopwords||"")+"$","i"),n=!0),!e.modified("pattern")&&this._match||(this._match=new RegExp(e.pattern||"[\\w']+","g"),n=!0),(e.modified("field")||t.modified(e.field.fields))&&(n=!0),n&&(this._counts={}),n},_finish:function(e,t){var n,r,i,a=this._counts,o=this._tuples||(this._tuples={}),s=t[0],u=t[1],c=e.fork(e.NO_SOURCE|e.NO_FIELDS);for(n in a)r=o[n],i=a[n]||0,!r&&i?(o[n]=r=De({}),r[s]=n,r[u]=i,c.add.push(r)):0===i?(r&&c.rem.push(r),a[n]=null,o[n]=null):r[u]!==i&&(r[u]=i,c.mod.push(r));return c.modifies(t)}}),Ln.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]},Object(ye.z)(Ln,ot,{transform:function(e,t){var n=t.fork(t.NO_SOURCE),r=e.as||["a","b"],i=r[0],a=r[1],o=!this.value||t.changed(t.ADD_REM)||e.modified("as")||e.modified("filter"),s=this.value;return o?(s&&(n.rem=s),s=t.materialize(t.SOURCE).source,n.add=this.value=function(e,t,n,r){for(var i,a,o=[],s={},u=e.length,c=0;c<u;++c)for(s[t]=a=e[c],i=0;i<u;++i)s[n]=e[i],r(s)&&(o.push(De(s)),(s={})[t]=a);return o}(s,i,a,e.filter||ye.Ia)):n.mod=s,n.source=this.value,n.modifies(r)}});var zn={kde:Pt,mixture:Vt,normal:Rt,lognormal:Wt,uniform:Kt},Un="distributions",Wn="function",Vn="field";function Gn(e){ot.call(this,null,e)}var qn=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}],Hn={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:qn},{name:"weights",type:"number",array:!0}]};function Xn(e,t){return e?e.map((function(e,n){return t[n]||Object(ye.h)(e)})):null}function Kn(e,t,n){var r,i,a,o,s,u,c=[],l=function(e){return e(o)};if(null==t)c.push(e.map(n));else for(r={},i=0,a=e.length;i<a;++i)o=e[i],(u=r[s=t.map(l)])||(r[s]=u=[],u.dims=s,c.push(u)),u.push(n(o));return c}function Yn(e){ot.call(this,null,e)}function $n(e){ze.call(this,null,Jn,e),this.modified(!0)}function Jn(e){var t=e.expr;return this.value&&!e.modified("expr")?this.value:Object(ye.f)((function(n){return t(n,e)}),Object(ye.g)(t),Object(ye.h)(t))}function Zn(e){ot.call(this,[void 0,void 0],e)}function Qn(e,t){ze.call(this,e),this.parent=t,this.count=0}function er(e){ot.call(this,{},e),this._keys=Object(ye.t)();var t=this._targets=[];t.active=0,t.forEach=function(e){for(var n=0,r=t.active;n<r;++n)e(t[n],n,t)}}function tr(e){ze.call(this,null,nr,e)}function nr(e){return this.value&&!e.modified()?this.value:Object(ye.B)(e.name)?Object(ye.i)(e.name).map((function(e){return Object(ye.u)(e)})):Object(ye.u)(e.name,e.as)}function rr(e){ot.call(this,Object(ye.t)(),e)}function ir(e){ot.call(this,[],e)}function ar(e){ot.call(this,[],e)}function or(e){ot.call(this,null,e)}function sr(e){ot.call(this,[],e)}Gn.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:qn.concat(Hn)},{name:"as",type:"string",array:!0,default:["value","density"]}]},Object(ye.z)(Gn,ot,{transform:function(e,t){var n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){var r=function e(t,n){var r=t[Wn];Object(ye.w)(zn,r)||Object(ye.o)("Unknown distribution function: "+r);var i=zn[r]();for(var a in t)a===Vn?i.data((t.from||n()).map(t[a])):a===Un?i[a](t[a].map((function(t){return e(t,n)}))):typeof i[a]===Wn&&i[a](t[a]);return i}(e.distribution,function(e){return function(){return e.materialize(e.SOURCE).source}}(t)),i=e.steps||e.minsteps||25,a=e.steps||e.maxsteps||200,o=e.method||"pdf";"pdf"!==o&&"cdf"!==o&&Object(ye.o)("Invalid density method: "+o),e.extent||r.data||Object(ye.o)("Missing density extent parameter."),o=r[o];var s=e.as||["value","density"],u=dn(o,e.extent||Object(ye.q)(r.data()),i,a).map((function(e){var t={};return t[s[0]]=e[0],t[s[1]]=e[1],De(t)}));this.value&&(n.rem=this.value),this.value=n.add=n.source=u}return n}}),Yn.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:"bin"}]},Object(ye.z)(Yn,ot,{transform:function(e,t){if(this.value&&!e.modified()&&!t.changed())return t;for(var n,r=t.materialize(t.SOURCE).source,i=Kn(t.source,e.groupby,ye.y),a=e.smooth||!1,o=e.field,s=e.step||function(e,t){return Object(ye.Z)(Object(ye.q)(e,t))/30}(r,o),u=Fe((function(e,t){return o(e)-o(t)})),c=e.as||"bin",l=i.length,f=1/0,d=-1/0,h=0;h<l;++h){var m=i[h].sort(u);n=-1;var v,g=p(Ct(m,s,a,o));try{for(g.s();!(v=g.n()).done;){var y=v.value;y<f&&(f=y),y>d&&(d=y),m[++n][c]=y}}catch(b){g.e(b)}finally{g.f()}}return this.value={start:f,stop:d,step:s},t.reflow(!0).modifies(c)}}),Object(ye.z)($n,ze),Zn.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]},Object(ye.z)(Zn,ot,{transform:function(e,t){var n=this.value,r=e.field,i=t.changed()||t.modified(r.fields)||e.modified("field"),a=n[0],o=n[1];if((i||null==a)&&(a=1/0,o=-1/0),t.visit(i?t.SOURCE:t.ADD,(function(e){var t=Object(ye.Ea)(r(e));null!=t&&(t<a&&(a=t),t>o&&(o=t))})),!Number.isFinite(a)||!Number.isFinite(o)){var s=Object(ye.h)(r);s&&(s=' for field "'.concat(s,'"')),t.dataflow.warn("Infinite extent".concat(s,": [").concat(a,", ").concat(o,"]")),a=o=void 0}this.value=[a,o]}}),Object(ye.z)(Qn,ze,{connect:function(e){return this.detachSubflow=e.detachSubflow,this.targets().add(e),e.source=this},add:function(e){this.count+=1,this.value.add.push(e)},rem:function(e){this.count-=1,this.value.rem.push(e)},mod:function(e){this.value.mod.push(e)},init:function(e){this.value.init(e,e.NO_SOURCE)},evaluate:function(){return this.value}}),Object(ye.z)(er,ot,{activate:function(e){this._targets[this._targets.active++]=e},subflow:function(e,t,n,r){var i,a,o=this.value,s=Object(ye.w)(o,e)&&o[e];return s?s.value.stamp<n.stamp&&(s.init(n),this.activate(s)):(a=r||(a=this._group[e])&&a.tuple,i=n.dataflow,s=new Qn(n.fork(n.NO_SOURCE),this),i.add(s).connect(t(i,e,a)),o[e]=s,this.activate(s)),s},clean:function(){var e=this.value,t=0;for(var n in e)if(0===e[n].count){var r=e[n].detachSubflow;r&&r(),delete e[n],++t}if(t){var i=this._targets.filter((function(e){return e&&e.count>0}));this.initTargets(i)}},initTargets:function(e){for(var t=this._targets,n=t.length,r=e?e.length:0,i=0;i<r;++i)t[i]=e[i];for(;i<n&&null!=t[i];++i)t[i]=null;t.active=r},transform:function(e,t){var n=this,r=t.dataflow,i=e.key,a=e.subflow,o=this._keys,s=e.modified("key"),u=function(e){return n.subflow(e,a,t)};return this._group=e.group||{},this.initTargets(),t.visit(t.REM,(function(e){var t=Ae(e),n=o.get(t);void 0!==n&&(o.delete(t),u(n).rem(e))})),t.visit(t.ADD,(function(e){var t=i(e);o.set(Ae(e),t),u(t).add(e)})),s||t.modified(i.fields)?t.visit(t.MOD,(function(e){var t=Ae(e),n=o.get(t),r=i(e);n===r?u(r).mod(e):(o.set(t,r),u(n).rem(e),u(r).add(e))})):t.changed(t.MOD)&&t.visit(t.MOD,(function(e){u(o.get(Ae(e))).mod(e)})),s&&t.visit(t.REFLOW,(function(e){var t=Ae(e),n=o.get(t),r=i(e);n!==r&&(o.set(t,r),u(n).rem(e),u(r).add(e))})),t.clean()?r.runAfter((function(){n.clean(),o.clean()})):o.empty>r.cleanThreshold&&r.runAfter(o.clean),t}}),Object(ye.z)(tr,ze),rr.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]},Object(ye.z)(rr,ot,{transform:function(e,t){var n=t.dataflow,r=this.value,i=t.fork(),a=i.add,o=i.rem,s=i.mod,u=e.expr,c=!0;function l(t){var n=Ae(t),i=u(t,e),l=r.get(n);i&&l?(r.delete(n),a.push(t)):i||l?c&&i&&!l&&s.push(t):(r.set(n,1),o.push(t))}return t.visit(t.REM,(function(e){var t=Ae(e);r.has(t)?r.delete(t):o.push(e)})),t.visit(t.ADD,(function(t){u(t,e)?a.push(t):r.set(Ae(t),1)})),t.visit(t.MOD,l),e.modified()&&(c=!1,t.visit(t.REFLOW,l)),r.empty>n.cleanThreshold&&n.runAfter(r.clean),i}}),ir.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]},Object(ye.z)(ir,ot,{transform:function(e,t){var n=t.fork(t.NO_SOURCE),r=e.fields,i=Xn(r,e.as||[]),a=e.index||null,o=i.length;return n.rem=this.value,t.visit(t.SOURCE,(function(e){for(var t,s,u,c=r.map((function(t){return t(e)})),l=c.reduce((function(e,t){return Math.max(e,t.length)}),0),f=0;f<l;++f){for(s=Te(e),t=0;t<o;++t)s[i[t]]=null==(u=c[t][f])?null:u;a&&(s[a]=f),n.add.push(s)}})),this.value=n.source=n.add,a&&n.modifies(a),n.modifies(i)}}),ar.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]},Object(ye.z)(ar,ot,{transform:function(e,t){var n=t.fork(t.NO_SOURCE),r=e.fields,i=r.map(ye.h),a=e.as||["key","value"],o=a[0],s=a[1],u=r.length;return n.rem=this.value,t.visit(t.SOURCE,(function(e){for(var t,a=0;a<u;++a)(t=Te(e))[o]=i[a],t[s]=r[a](e),n.add.push(t)})),this.value=n.source=n.add,n.modifies(a)}}),or.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]},Object(ye.z)(or,ot,{transform:function(e,t){var n=e.expr,r=e.as,i=e.modified(),a=e.initonly?t.ADD:i?t.SOURCE:t.modified(n.fields)||t.modified(r)?t.ADD_MOD:t.ADD;return i&&(t=t.materialize().reflow(!0)),e.initonly||t.modifies(r),t.visit(a,(function(t){return t[r]=n(t,e)}))}}),Object(ye.z)(sr,ot,{transform:function(e,t){var n,r,i,a=t.fork(t.ALL),o=e.generator,s=this.value,u=e.size-s.length;if(u>0){for(n=[];--u>=0;)n.push(i=De(o(e))),s.push(i);a.add=a.add.length?a.materialize(a.ADD).add.concat(n):n}else r=s.slice(0,-u),a.rem=a.rem.length?a.materialize(a.REM).rem.concat(r):r,s=s.slice(-u);return a.source=this.value=s,a}});var ur={value:"value",median:gt,mean:function(e,t){var n=0,r=0;if(void 0===t){var i,a=p(e);try{for(a.s();!(i=a.n()).done;){var o=i.value;null!=o&&(o=+o)>=o&&(++n,r+=o)}}catch(f){a.e(f)}finally{a.f()}}else{var s,u=-1,c=p(e);try{for(c.s();!(s=c.n()).done;){var l=s.value;null!=(l=t(l,++u,e))&&(l=+l)>=l&&(++n,r+=l)}}catch(f){c.e(f)}finally{c.f()}}if(n)return r/n},min:dt,max:ft},cr=[];function lr(e){ot.call(this,[],e)}function fr(e){Mn.call(this,e)}function dr(e){ot.call(this,null,e)}function hr(e){ze.call(this,null,pr,e)}function pr(e){return this.value&&!e.modified()?this.value:Object(ye.K)(e.fields,e.flat)}function mr(e){ot.call(this,[],e),this._pending=null}function vr(e,t,n){n.forEach(De);var r=t.fork(t.NO_FIELDS&t.NO_SOURCE);return r.rem=e.value,e.value=r.source=r.add=n,e._pending=null,r.rem.length&&r.clean(!0),r}function gr(e){ot.call(this,{},e)}function yr(e){ze.call(this,null,br,e)}function br(e){if(this.value&&!e.modified())return this.value;var t,n,r=e.extents,i=r.length,a=1/0,o=-1/0;for(t=0;t<i;++t)(n=r[t])[0]<a&&(a=n[0]),n[1]>o&&(o=n[1]);return[a,o]}function xr(e){ze.call(this,null,wr,e)}function wr(e){return this.value&&!e.modified()?this.value:e.values.reduce((function(e,t){return e.concat(t)}),[])}function _r(e){ot.call(this,null,e)}function kr(e){Mn.call(this,e)}function Er(e){er.call(this,e)}function Sr(e){ot.call(this,null,e)}function Cr(e){ot.call(this,null,e)}function Ar(e){ot.call(this,null,e)}function Or(e){ot.call(this,null,e)}function Dr(e){ot.call(this,[],e),this.count=0}function Tr(e){ot.call(this,null,e)}function jr(e){ot.call(this,null,e),this.modified(!0)}function Mr(e){ot.call(this,null,e)}lr.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]},Object(ye.z)(lr,ot,{transform:function(e,t){var n,r,i,a,o,s,u,c,l,f,d=t.fork(t.ALL),h=function(e){var t,n=e.method||ur.value;if(null!=ur[n])return n===ur.value?(t=void 0!==e.value?e.value:0,function(){return t}):ur[n];Object(ye.o)("Unrecognized imputation method: "+n)}(e),p=function(e){var t=e.field;return function(e){return e?t(e):NaN}}(e),m=Object(ye.h)(e.field),v=Object(ye.h)(e.key),g=(e.groupby||[]).map(ye.h),y=function(e,t,n,r){var i,a,o,s,u,c,l,f,d=function(e){return e(f)},h=[],p=r?r.slice():[],m={},v={};for(p.forEach((function(e,t){return m[e]=t+1})),s=0,l=e.length;s<l;++s)c=n(f=e[s]),u=m[c]||(m[c]=p.push(c)),(o=v[a=(i=t?t.map(d):cr)+""])||(o=v[a]=[],h.push(o),o.values=i),o[u-1]=f;return h.domain=p,h}(t.source,e.groupby,e.key,e.keyvals),b=[],x=this.value,w=y.domain.length;for(o=0,c=y.length;o<c;++o)for(i=(n=y[o]).values,r=NaN,u=0;u<w;++u)if(null==n[u]){for(a=y.domain[u],f={_impute:!0},s=0,l=i.length;s<l;++s)f[g[s]]=i[s];f[v]=a,f[m]=Number.isNaN(r)?r=h(n,p):r,b.push(De(f))}return b.length&&(d.add=d.materialize(d.ADD).add.concat(b)),x.length&&(d.rem=d.materialize(d.REM).rem.concat(x)),this.value=b,d}}),fr.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:_n},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]},Object(ye.z)(fr,Mn,{transform:function(e,t){var n,r=this,i=e.modified();return r.value&&(i||t.modified(r._inputs,!0))?(n=r.value=i?r.init(e):{},t.visit(t.SOURCE,(function(e){return r.add(e)}))):(n=r.value=r.value||this.init(e),t.visit(t.REM,(function(e){return r.rem(e)})),t.visit(t.ADD,(function(e){return r.add(e)}))),r.changes(),t.visit(t.SOURCE,(function(e){Object(ye.p)(e,n[r.cellkey(e)].tuple)})),t.reflow(i).modifies(this._outputs)},changes:function(){var e,t,n=this._adds,r=this._mods;for(e=0,t=this._alen;e<t;++e)this.celltuple(n[e]),n[e]=null;for(e=0,t=this._mlen;e<t;++e)this.celltuple(r[e]),r[e]=null;this._alen=this._mlen=0}}),dr.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]},Object(ye.z)(dr,ot,{transform:function(e,t){var n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){var r=t.materialize(t.SOURCE).source,i=Kn(r,e.groupby,e.field),a=(e.groupby||[]).map(ye.h),o=e.bandwidth,s=e.cumulative?"cdf":"pdf",u=e.as||["value","density"],c=[],l=e.extent,f=e.steps||e.minsteps||25,d=e.steps||e.maxsteps||200;"pdf"!==s&&"cdf"!==s&&Object(ye.o)("Invalid density method: "+s),"shared"===e.resolve&&(l||(l=Object(ye.q)(r,e.field)),f=d=e.steps||d),i.forEach((function(t){var n=Pt(t,o)[s],r=e.counts?t.length:1;dn(n,l||Object(ye.q)(t),f,d).forEach((function(e){for(var n={},i=0;i<a.length;++i)n[a[i]]=t.dims[i];n[u[0]]=e[0],n[u[1]]=e[1]*r,c.push(De(n))}))})),this.value&&(n.rem=this.value),this.value=n.add=n.source=c}return n}}),Object(ye.z)(hr,ze),Object(ye.z)(mr,ot,{transform:function(e,t){var n=this,r=t.dataflow;return this._pending?vr(this,t,this._pending):function(e){return e.modified("async")&&!(e.modified("values")||e.modified("url")||e.modified("format"))}(e)?t.StopPropagation:e.values?vr(this,t,r.parse(e.values,e.format)):e.async?{async:r.request(e.url,e.format).then((function(e){return n._pending=Object(ye.i)(e.data),function(e){return e.touch(n)}}))}:r.request(e.url,e.format).then((function(e){return vr(n,t,Object(ye.i)(e.data))}))}}),gr.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]},Object(ye.z)(gr,ot,{transform:function(e,t){var n,r,i=e.fields,a=e.index,o=e.values,s=null==e.default?null:e.default,u=e.modified(),c=i.length,l=u?t.SOURCE:t.ADD,f=t,d=e.as;return o?(r=o.length,c>1&&!d&&Object(ye.o)('Multi-field lookup requires explicit "as" parameter.'),d&&d.length!==c*r&&Object(ye.o)('The "as" parameter has too few output field names.'),d=d||o.map(ye.h),n=function(e){for(var t,n,u=0,l=0;u<c;++u)if(null==(n=a.get(i[u](e))))for(t=0;t<r;++t,++l)e[d[l]]=s;else for(t=0;t<r;++t,++l)e[d[l]]=o[t](n)}):(d||Object(ye.o)("Missing output field names."),n=function(e){for(var t,n=0;n<c;++n)t=a.get(i[n](e)),e[d[n]]=null==t?s:t}),u?f=t.reflow(!0):l|=i.some((function(e){return t.modified(e.fields)}))?t.MOD:0,t.visit(l,n),f.modifies(d)}}),Object(ye.z)(yr,ze),Object(ye.z)(xr,ze),Object(ye.z)(_r,ot,{transform:function(e,t){return this.modified(e.modified()),this.value=e,t.fork(t.NO_SOURCE|t.NO_FIELDS)}}),kr.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:_n,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]},Object(ye.z)(kr,Mn,{_transform:Mn.prototype.transform,transform:function(e,t){return this._transform(function(e,t){var n=e.field,r=e.value,i=("count"===e.op?"__count__":e.op)||"sum",a=Object(ye.g)(n).concat(Object(ye.g)(r)),o=function(e,t,n){var r={},i=[];return n.visit(n.SOURCE,(function(t){var n=e(t);r[n]||(r[n]=1,i.push(n))})),i.sort(ye.j),t?i.slice(0,t):i}(n,e.limit||0,t);return t.changed()&&e.set("__pivot__",null,null,!0),{key:e.key,groupby:e.groupby,ops:o.map((function(){return i})),fields:o.map((function(e){return function(e,t,n,r){return Object(ye.f)((function(r){return t(r)===e?n(r):NaN}),r,e+"")}(e,n,r,a)})),as:o.map((function(e){return e+""})),modified:e.modified.bind(e)}}(e,t),t)}}),Object(ye.z)(Er,er,{transform:function(e,t){var n=this,r=e.subflow,i=e.field,a=function(e){return n.subflow(Ae(e),r,t,e)};return(e.modified("field")||i&&t.modified(Object(ye.g)(i)))&&Object(ye.o)("PreFacet does not support field modification."),this.initTargets(),i?(t.visit(t.MOD,(function(e){var t=a(e);i(e).forEach((function(e){return t.mod(e)}))})),t.visit(t.ADD,(function(e){var t=a(e);i(e).forEach((function(e){return t.add(De(e))}))})),t.visit(t.REM,(function(e){var t=a(e);i(e).forEach((function(e){return t.rem(e)}))}))):(t.visit(t.MOD,(function(e){return a(e).mod(e)})),t.visit(t.ADD,(function(e){return a(e).add(e)})),t.visit(t.REM,(function(e){return a(e).rem(e)}))),t.clean()&&t.runAfter((function(){return n.clean()})),t}}),Sr.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]},Object(ye.z)(Sr,ot,{transform:function(e,t){var n,r=t.fork(t.NO_SOURCE),i=e.fields,a=Xn(e.fields,e.as||[]),o=i?function(e,t){return function(e,t,n,r){for(var i=0,a=n.length;i<a;++i)t[r[i]]=n[i](e);return t}(e,t,i,a)}:je;return this.value?n=this.value:(t=t.addAll(),n=this.value={}),t.visit(t.REM,(function(e){var t=Ae(e);r.rem.push(n[t]),n[t]=null})),t.visit(t.ADD,(function(e){var t=o(e,De({}));n[Ae(e)]=t,r.add.push(t)})),t.visit(t.MOD,(function(e){r.mod.push(o(e,n[Ae(e)]))})),r}}),Object(ye.z)(Cr,ot,{transform:function(e,t){return this.value=e.value,e.modified("value")?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}}),Ar.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]},Object(ye.z)(Ar,ot,{transform:function(e,t){var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.as||["prob","value"];if(this.value&&!e.modified()&&!t.changed())return n.source=this.value,n;var i=Kn(t.materialize(t.SOURCE).source,e.groupby,e.field),a=(e.groupby||[]).map(ye.h),o=[],s=e.step||.01,u=e.probs||pn(s/2,1-1e-14,s),c=u.length;return i.forEach((function(e){for(var t=bt(e,u),n=0;n<c;++n){for(var i={},s=0;s<a.length;++s)i[a[s]]=e.dims[s];i[r[0]]=u[n],i[r[1]]=t[n],o.push(De(i))}})),this.value&&(n.rem=this.value),this.value=n.add=n.source=o,n}}),Object(ye.z)(Or,ot,{transform:function(e,t){var n,r;return this.value?r=this.value:(n=t=t.addAll(),r=this.value={}),e.derive&&(n=t.fork(t.NO_SOURCE),t.visit(t.REM,(function(e){var t=Ae(e);n.rem.push(r[t]),r[t]=null})),t.visit(t.ADD,(function(e){var t=Te(e);r[Ae(e)]=t,n.add.push(t)})),t.visit(t.MOD,(function(e){var t=r[Ae(e)];for(var i in e)t[i]=e[i],n.modifies(i);n.mod.push(t)}))),n}}),Dr.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]},Object(ye.z)(Dr,ot,{transform:function(e,t){var n=t.fork(t.NO_SOURCE),r=e.modified("size"),i=e.size,a=this.value.reduce((function(e,t){return e[Ae(t)]=1,e}),{}),o=this.value,s=this.count,u=0;function c(e){var t,r;o.length<i?o.push(e):(r=~~((s+1)*kt()))<o.length&&r>=u&&(t=o[r],a[Ae(t)]&&n.rem.push(t),o[r]=e),++s}if(t.rem.length&&(t.visit(t.REM,(function(e){var t=Ae(e);a[t]&&(a[t]=-1,n.rem.push(e)),--s})),o=o.filter((function(e){return-1!==a[Ae(e)]}))),(t.rem.length||r)&&o.length<i&&t.source&&(u=s=o.length,t.visit(t.SOURCE,(function(e){a[Ae(e)]||c(e)})),u=-1),r&&o.length>i){for(var l=o.length-i,f=0;f<l;++f)a[Ae(o[f])]=-1,n.rem.push(o[f]);o=o.slice(l)}return t.mod.length&&t.visit(t.MOD,(function(e){a[Ae(e)]&&n.mod.push(e)})),t.add.length&&t.visit(t.ADD,c),(t.add.length||u<0)&&(n.add=o.filter((function(e){return!a[Ae(e)]}))),this.count=s,this.value=n.source=o,n}}),Tr.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]},Object(ye.z)(Tr,ot,{transform:function(e,t){if(!this.value||e.modified()){var n=t.materialize().fork(t.MOD),r=e.as||"data";return n.rem=this.value?t.rem.concat(this.value):t.rem,this.value=pn(e.start,e.stop,e.step||1).map((function(e){var t={};return t[r]=e,De(t)})),n.add=t.add.concat(this.value),n}}}),Object(ye.z)(jr,ot,{transform:function(e,t){return this.value=t.source,t.changed()?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}});var Fr=["unit0","unit1"];function Ir(e){ot.call(this,Object(ye.t)(),e)}function Nr(e){ot.call(this,null,e)}Mr.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:vn.j,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:Fr}]},Object(ye.z)(Mr,ot,{transform:function(e,t){var n=e.field,r=!1!==e.interval,i="utc"===e.timezone,a=this._floor(e,t),o=(i?vn.v:vn.p)(a.unit).offset,s=e.as||Fr,u=s[0],c=s[1],l=a.step,f=a.start||1/0,d=a.stop||-1/0,h=t.ADD;return(e.modified()||t.modified(Object(ye.g)(n)))&&(h=(t=t.reflow(!0)).SOURCE,f=1/0,d=-1/0),t.visit(h,(function(e){var t,i,s=n(e);null==s?(e[u]=null,r&&(e[c]=null)):(e[u]=t=i=a(s),r&&(e[c]=i=o(t,l)),t<f&&(f=t),i>d&&(d=i))})),a.start=f,a.stop=d,t.modifies(r?s:u)},_floor:function(e,t){var n="utc"===e.timezone,r=e.units?{units:e.units,step:e.step||1}:Object(vn.n)({extent:e.extent||Object(ye.q)(t.materialize(t.SOURCE).source,e.field),maxbins:e.maxbins}),i=r.units,a=r.step,o=Object(vn.t)(i),s=this.value||{},u=(n?vn.u:vn.o)(o,a);return u.unit=Object(ye.W)(o),u.units=o,u.step=a,u.start=s.start,u.stop=s.stop,this.value=u}}),Object(ye.z)(Ir,ot,{transform:function(e,t){var n=t.dataflow,r=e.field,i=this.value,a=function(e){return i.set(r(e),e)},o=!0;return e.modified("field")||t.modified(r.fields)?(i.clear(),t.visit(t.SOURCE,a)):t.changed()?(t.visit(t.REM,(function(e){return i.delete(r(e))})),t.visit(t.ADD,a)):o=!1,this.modified(o),i.empty>n.cleanThreshold&&n.runAfter(i.clean),t.fork()}}),Object(ye.z)(Nr,ot,{transform:function(e,t){(!this.value||e.modified("field")||e.modified("sort")||t.changed()||e.sort&&t.modified(e.sort.fields))&&(this.value=(e.sort?t.source.slice().sort(Fe(e.sort)):t.source).map(e.field))}});var Rr={row_number:function(){return{next:function(e){return e.index+1}}},rank:function(){var e;return{init:function(){return e=1},next:function(t){var n=t.index,r=t.data;return n&&t.compare(r[n-1],r[n])?e=n+1:e}}},dense_rank:function(){var e;return{init:function(){return e=1},next:function(t){var n=t.index,r=t.data;return n&&t.compare(r[n-1],r[n])?++e:e}}},percent_rank:function(){var e=Rr.rank(),t=e.next;return{init:e.init,next:function(e){return(t(e)-1)/(e.data.length-1)}}},cume_dist:function(){var e;return{init:function(){return e=0},next:function(t){var n=t.data,r=t.compare,i=t.index;if(e<i){for(;i+1<n.length&&!r(n[i],n[i+1]);)++i;e=i}return(1+e)/n.length}}},ntile:function(e,t){(t=+t)>0||Object(ye.o)("ntile num must be greater than zero.");var n=Rr.cume_dist(),r=n.next;return{init:n.init,next:function(e){return Math.ceil(t*r(e))}}},lag:function(e,t){return t=+t||1,{next:function(n){var r=n.index-t;return r>=0?e(n.data[r]):null}}},lead:function(e,t){return t=+t||1,{next:function(n){var r=n.index+t,i=n.data;return r<i.length?e(i[r]):null}}},first_value:function(e){return{next:function(t){return e(t.data[t.i0])}}},last_value:function(e){return{next:function(t){return e(t.data[t.i1-1])}}},nth_value:function(e,t){return(t=+t)>0||Object(ye.o)("nth_value nth must be greater than zero."),{next:function(n){var r=n.i0+(t-1);return r<n.i1?e(n.data[r]):null}}},prev_value:function(e){var t;return{init:function(){return t=null},next:function(n){var r=e(n.data[n.index]);return null!=r?t=r:t}}},next_value:function(e){var t,n;return{init:function(){return t=null,n=-1},next:function(r){var i=r.data;return r.index<=n?t:(n=function(e,t,n){for(var r=t.length;n<r;++n)if(null!=e(t[n]))return n;return-1}(e,i,r.index))<0?(n=i.length,t=null):t=e(i[n])}}}},Pr=Object.keys(Rr);function Br(e){var t=Object(ye.i)(e.ops),n=Object(ye.i)(e.fields),r=Object(ye.i)(e.params),i=Object(ye.i)(e.as),a=this.outputs=[],o=this.windows=[],s={},u={},c=[],l=[],f=!0;function d(e){Object(ye.i)(Object(ye.g)(e)).forEach((function(e){return s[e]=1}))}d(e.sort),t.forEach((function(e,t){var s=n[t],h=Object(ye.h)(s),p=yn(e,h,i[t]);if(d(s),a.push(p),Object(ye.w)(Rr,e))o.push(function(e,t,n,r){var i=Rr[e](t,n);return{init:i.init||ye.Ma,update:function(e,t){t[r]=i.next(e)}}}(e,n[t],r[t],p));else{if(null==s&&"count"!==e&&Object(ye.o)("Null aggregate field specified."),"count"===e)return void c.push(p);f=!1;var m=u[h];m||((m=u[h]=[]).field=s,l.push(m)),m.push(kn(e,p))}})),(c.length||l.length)&&(this.cell=function(e,t,n){e=e.map((function(e){return Dn(e,e.field)}));var r={num:0,agg:null,store:!1,count:t};if(!n)for(var i=e.length,a=r.agg=Array(i),o=0;o<i;++o)a[o]=new e[o](r);if(r.store)var s=r.data=new Tn;return r.add=function(e){if(r.num+=1,!n){s&&s.add(e);for(var t=0;t<i;++t)a[t].add(a[t].get(e),e)}},r.rem=function(e){if(r.num-=1,!n){s&&s.rem(e);for(var t=0;t<i;++t)a[t].rem(a[t].get(e),e)}},r.set=function(e){var i,o;for(s&&s.values(),i=0,o=t.length;i<o;++i)e[t[i]]=r.num;if(!n)for(i=0,o=a.length;i<o;++i)a[i].set(e)},r.init=function(){r.num=0,s&&s.reset();for(var e=0;e<i;++e)a[e].init()},r}(l,c,f)),this.inputs=Object.keys(s)}var Lr=Br.prototype;function zr(e){ot.call(this,{},e),this._mlen=0,this._mods=[]}function Ur(e,t,n,r){var i=r.sort,a=i&&!r.ignorePeers,o=r.frame||[null,0],s=e.data(n),u=s.length,c=a?Object(mn.a)(i):null,l={i0:0,i1:0,p0:0,p1:0,index:0,data:s,compare:i||Object(ye.m)(-1)};t.init();for(var f=0;f<u;++f)Wr(l,o,f,u),a&&Vr(l,c),t.update(l,s[f])}function Wr(e,t,n,r){e.p0=e.i0,e.p1=e.i1,e.i0=null==t[0]?0:Math.max(0,n-Math.abs(t[0])),e.i1=null==t[1]?r:Math.min(r,n+Math.abs(t[1])+1),e.index=n}function Vr(e,t){var n=e.i0,r=e.i1-1,i=e.compare,a=e.data,o=a.length-1;n>0&&!i(a[n],a[n-1])&&(e.i0=t.left(a,a[n])),r<o&&!i(a[r],a[r+1])&&(e.i1=t.right(a,a[r]))}function Gr(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function qr(e){this._context=e}Lr.init=function(){this.windows.forEach((function(e){return e.init()})),this.cell&&this.cell.init()},Lr.update=function(e,t){var n,r=this.cell,i=this.windows,a=e.data,o=i&&i.length;if(r){for(n=e.p0;n<e.i0;++n)r.rem(a[n]);for(n=e.p1;n<e.i1;++n)r.add(a[n]);r.set(t)}for(n=0;n<o;++n)i[n].update(e,t)},zr.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:Pr.concat(_n)},{name:"params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]},Object(ye.z)(zr,ot,{transform:function(e,t){var n=this;this.stamp=t.stamp;var r=e.modified(),i=Fe(e.sort),a=gn(e.groupby),o=function(e){return n.group(a(e))},s=this.state;s&&!r||(s=this.state=new Br(e)),r||t.modified(s.inputs)?(this.value={},t.visit(t.SOURCE,(function(e){return o(e).add(e)}))):(t.visit(t.REM,(function(e){return o(e).remove(e)})),t.visit(t.ADD,(function(e){return o(e).add(e)})));for(var u=0,c=this._mlen;u<c;++u)Ur(this._mods[u],s,i,e);return this._mlen=0,this._mods=[],t.reflow(r).modifies(s.outputs)},group:function(e){var t=this.value[e];return t||((t=this.value[e]=In(Ae)).stamp=-1),t.stamp<this.stamp&&(t.stamp=this.stamp,this._mods[this._mlen++]=t),t}}),qr.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:Gr(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:Gr(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};var Hr=function(){};function Xr(e){this._context=e}function Kr(e){this._context=e}function Yr(e,t){this._basis=new qr(e),this._beta=t}Xr.prototype={areaStart:Hr,areaEnd:Hr,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:Gr(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},Kr.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,r=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,r):this._context.moveTo(n,r);break;case 3:this._point=4;default:Gr(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},Yr.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var e=this._x,t=this._y,n=e.length-1;if(n>0)for(var r,i=e[0],a=t[0],o=e[n]-i,s=t[n]-a,u=-1;++u<=n;)r=u/n,this._basis.point(this._beta*e[u]+(1-this._beta)*(i+r*o),this._beta*t[u]+(1-this._beta)*(a+r*s));this._x=this._y=null,this._basis.lineEnd()},point:function(e,t){this._x.push(+e),this._y.push(+t)}};var $r=function e(t){function n(e){return 1===t?new qr(e):new Yr(e,t)}return n.beta=function(t){return e(+t)},n}(.85);function Jr(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function Zr(e,t){this._context=e,this._k=(1-t)/6}Zr.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:Jr(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:Jr(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var Qr=function e(t){function n(e){return new Zr(e,t)}return n.tension=function(t){return e(+t)},n}(0);function ei(e,t){this._context=e,this._k=(1-t)/6}ei.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Jr(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var ti=function e(t){function n(e){return new ei(e,t)}return n.tension=function(t){return e(+t)},n}(0);function ni(e,t){this._context=e,this._k=(1-t)/6}ni.prototype={areaStart:Hr,areaEnd:Hr,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:Jr(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var ri=function e(t){function n(e){return new ni(e,t)}return n.tension=function(t){return e(+t)},n}(0),ii=Math.abs,ai=Math.atan2,oi=Math.cos,si=Math.max,ui=Math.min,ci=Math.sin,li=Math.sqrt,fi=1e-12,di=Math.PI,hi=di/2,pi=2*di;function mi(e){return e>=1?hi:e<=-1?-hi:Math.asin(e)}function vi(e,t,n){var r=e._x1,i=e._y1,a=e._x2,o=e._y2;if(e._l01_a>fi){var s=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,u=3*e._l01_a*(e._l01_a+e._l12_a);r=(r*s-e._x0*e._l12_2a+e._x2*e._l01_2a)/u,i=(i*s-e._y0*e._l12_2a+e._y2*e._l01_2a)/u}if(e._l23_a>fi){var c=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,l=3*e._l23_a*(e._l23_a+e._l12_a);a=(a*c+e._x1*e._l23_2a-t*e._l12_2a)/l,o=(o*c+e._y1*e._l23_2a-n*e._l12_2a)/l}e._context.bezierCurveTo(r,i,a,o,e._x2,e._y2)}function gi(e,t){this._context=e,this._alpha=t}gi.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:vi(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var yi=function e(t){function n(e){return t?new gi(e,t):new Zr(e,0)}return n.alpha=function(t){return e(+t)},n}(.5);function bi(e,t){this._context=e,this._alpha=t}bi.prototype={areaStart:Hr,areaEnd:Hr,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:vi(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var xi=function e(t){function n(e){return t?new bi(e,t):new ni(e,0)}return n.alpha=function(t){return e(+t)},n}(.5);function wi(e,t){this._context=e,this._alpha=t}wi.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:vi(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var _i=function e(t){function n(e){return t?new wi(e,t):new ei(e,0)}return n.alpha=function(t){return e(+t)},n}(.5);function ki(e){this._context=e}ki.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t)}}};var Ei=function(e){return new ki(e)};function Si(e){this._context=e}function Ci(e){return e<0?-1:1}function Ai(e,t,n){var r=e._x1-e._x0,i=t-e._x1,a=(e._y1-e._y0)/(r||i<0&&-0),o=(n-e._y1)/(i||r<0&&-0),s=(a*i+o*r)/(r+i);return(Ci(a)+Ci(o))*Math.min(Math.abs(a),Math.abs(o),.5*Math.abs(s))||0}function Oi(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function Di(e,t,n){var r=e._x0,i=e._y0,a=e._x1,o=e._y1,s=(a-r)/3;e._context.bezierCurveTo(r+s,i+s*t,a-s,o-s*n,a,o)}function Ti(e){this._context=e}function ji(e){this._context=new Mi(e)}function Mi(e){this._context=e}function Fi(e){this._context=e}function Ii(e){var t,n,r=e.length-1,i=new Array(r),a=new Array(r),o=new Array(r);for(i[0]=0,a[0]=2,o[0]=e[0]+2*e[1],t=1;t<r-1;++t)i[t]=1,a[t]=4,o[t]=4*e[t]+2*e[t+1];for(i[r-1]=2,a[r-1]=7,o[r-1]=8*e[r-1]+e[r],t=1;t<r;++t)n=i[t]/a[t-1],a[t]-=n,o[t]-=n*o[t-1];for(i[r-1]=o[r-1]/a[r-1],t=r-2;t>=0;--t)i[t]=(o[t]-i[t+1])/a[t];for(a[r-1]=(e[r]+i[r-1])/2,t=0;t<r-1;++t)a[t]=2*e[t+1]-i[t+1];return[i,a]}function Ni(e,t){this._context=e,this._t=t}Si.prototype={areaStart:Hr,areaEnd:Hr,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}},Ti.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Di(this,this._t0,Oi(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(t=+t,(e=+e)!==this._x1||t!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,Di(this,Oi(this,n=Ai(this,e,t)),n);break;default:Di(this,this._t0,n=Ai(this,e,t))}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}},(ji.prototype=Object.create(Ti.prototype)).point=function(e,t){Ti.prototype.point.call(this,t,e)},Mi.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,r,i,a){this._context.bezierCurveTo(t,e,r,n,a,i)}},Fi.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),2===n)this._context.lineTo(e[1],t[1]);else for(var r=Ii(e),i=Ii(t),a=0,o=1;o<n;++a,++o)this._context.bezierCurveTo(r[0][a],i[0][a],r[1][a],i[1][a],e[o],t[o]);(this._line||0!==this._line&&1===n)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}},Ni.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}}this._x=e,this._y=t}};var Ri=Math.PI,Pi=2*Ri,Bi=Pi-1e-6;function Li(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function zi(){return new Li}Li.prototype=zi.prototype={constructor:Li,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,n,r){this._+="Q"+ +e+","+ +t+","+(this._x1=+n)+","+(this._y1=+r)},bezierCurveTo:function(e,t,n,r,i,a){this._+="C"+ +e+","+ +t+","+ +n+","+ +r+","+(this._x1=+i)+","+(this._y1=+a)},arcTo:function(e,t,n,r,i){e=+e,t=+t,n=+n,r=+r,i=+i;var a=this._x1,o=this._y1,s=n-e,u=r-t,c=a-e,l=o-t,f=c*c+l*l;if(i<0)throw new Error("negative radius: "+i);if(null===this._x1)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(f>1e-6)if(Math.abs(l*s-u*c)>1e-6&&i){var d=n-a,h=r-o,p=s*s+u*u,m=d*d+h*h,v=Math.sqrt(p),g=Math.sqrt(f),y=i*Math.tan((Ri-Math.acos((p+f-m)/(2*v*g)))/2),b=y/g,x=y/v;Math.abs(b-1)>1e-6&&(this._+="L"+(e+b*c)+","+(t+b*l)),this._+="A"+i+","+i+",0,0,"+ +(l*d>c*h)+","+(this._x1=e+x*s)+","+(this._y1=t+x*u)}else this._+="L"+(this._x1=e)+","+(this._y1=t)},arc:function(e,t,n,r,i,a){e=+e,t=+t,a=!!a;var o=(n=+n)*Math.cos(r),s=n*Math.sin(r),u=e+o,c=t+s,l=1^a,f=a?r-i:i-r;if(n<0)throw new Error("negative radius: "+n);null===this._x1?this._+="M"+u+","+c:(Math.abs(this._x1-u)>1e-6||Math.abs(this._y1-c)>1e-6)&&(this._+="L"+u+","+c),n&&(f<0&&(f=f%Pi+Pi),f>Bi?this._+="A"+n+","+n+",0,1,"+l+","+(e-o)+","+(t-s)+"A"+n+","+n+",0,1,"+l+","+(this._x1=u)+","+(this._y1=c):f>1e-6&&(this._+="A"+n+","+n+",0,"+ +(f>=Ri)+","+l+","+(this._x1=e+n*Math.cos(i))+","+(this._y1=t+n*Math.sin(i))))},rect:function(e,t,n,r){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +r+"h"+-n+"Z"},toString:function(){return this._}};var Ui=zi,Wi=function(e){return function(){return e}};function Vi(e){return e.innerRadius}function Gi(e){return e.outerRadius}function qi(e){return e.startAngle}function Hi(e){return e.endAngle}function Xi(e){return e&&e.padAngle}function Ki(e,t,n,r,i,a,o){var s=e-n,u=t-r,c=(o?a:-a)/li(s*s+u*u),l=c*u,f=-c*s,d=e+l,h=t+f,p=n+l,m=r+f,v=(d+p)/2,g=(h+m)/2,y=p-d,b=m-h,x=y*y+b*b,w=i-a,_=d*m-p*h,k=(b<0?-1:1)*li(si(0,w*w*x-_*_)),E=(_*b-y*k)/x,S=(-_*y-b*k)/x,C=(_*b+y*k)/x,A=(-_*y+b*k)/x,O=E-v,D=S-g,T=C-v,j=A-g;return O*O+D*D>T*T+j*j&&(E=C,S=A),{cx:E,cy:S,x01:-l,y01:-f,x11:E*(i/w-1),y11:S*(i/w-1)}}Array.prototype.slice;var Yi=function(e){return"object"==typeof e&&"length"in e?e:Array.from(e)};function $i(e){return e[0]}function Ji(e){return e[1]}var Zi=function(e,t){var n=Wi(!0),r=null,i=Ei,a=null;function o(o){var s,u,c,l=(o=Yi(o)).length,f=!1;for(null==r&&(a=i(c=Ui())),s=0;s<=l;++s)!(s<l&&n(u=o[s],s,o))===f&&((f=!f)?a.lineStart():a.lineEnd()),f&&a.point(+e(u,s,o),+t(u,s,o));if(c)return a=null,c+""||null}return e="function"==typeof e?e:void 0===e?$i:Wi(e),t="function"==typeof t?t:void 0===t?Ji:Wi(t),o.x=function(t){return arguments.length?(e="function"==typeof t?t:Wi(+t),o):e},o.y=function(e){return arguments.length?(t="function"==typeof e?e:Wi(+e),o):t},o.defined=function(e){return arguments.length?(n="function"==typeof e?e:Wi(!!e),o):n},o.curve=function(e){return arguments.length?(i=e,null!=r&&(a=i(r)),o):i},o.context=function(e){return arguments.length?(null==e?r=a=null:a=i(r=e),o):r},o},Qi=function(e,t,n){var r=null,i=Wi(!0),a=null,o=Ei,s=null;function u(u){var c,l,f,d,h,p=(u=Yi(u)).length,m=!1,v=new Array(p),g=new Array(p);for(null==a&&(s=o(h=Ui())),c=0;c<=p;++c){if(!(c<p&&i(d=u[c],c,u))===m)if(m=!m)l=c,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),f=c-1;f>=l;--f)s.point(v[f],g[f]);s.lineEnd(),s.areaEnd()}m&&(v[c]=+e(d,c,u),g[c]=+t(d,c,u),s.point(r?+r(d,c,u):v[c],n?+n(d,c,u):g[c]))}if(h)return s=null,h+""||null}function c(){return Zi().defined(i).curve(o).context(a)}return e="function"==typeof e?e:void 0===e?$i:Wi(+e),t="function"==typeof t?t:Wi(void 0===t?0:+t),n="function"==typeof n?n:void 0===n?Ji:Wi(+n),u.x=function(t){return arguments.length?(e="function"==typeof t?t:Wi(+t),r=null,u):e},u.x0=function(t){return arguments.length?(e="function"==typeof t?t:Wi(+t),u):e},u.x1=function(e){return arguments.length?(r=null==e?null:"function"==typeof e?e:Wi(+e),u):r},u.y=function(e){return arguments.length?(t="function"==typeof e?e:Wi(+e),n=null,u):t},u.y0=function(e){return arguments.length?(t="function"==typeof e?e:Wi(+e),u):t},u.y1=function(e){return arguments.length?(n=null==e?null:"function"==typeof e?e:Wi(+e),u):n},u.lineX0=u.lineY0=function(){return c().x(e).y(t)},u.lineY1=function(){return c().x(e).y(n)},u.lineX1=function(){return c().x(r).y(t)},u.defined=function(e){return arguments.length?(i="function"==typeof e?e:Wi(!!e),u):i},u.curve=function(e){return arguments.length?(o=e,null!=a&&(s=o(a)),u):o},u.context=function(e){return arguments.length?(null==e?a=s=null:s=o(a=e),u):a},u},ea={draw:function(e,t){var n=Math.sqrt(t/di);e.moveTo(n,0),e.arc(0,0,n,0,pi)}};function ta(e,t){if("undefined"!=typeof document&&document.createElement){var n=document.createElement("canvas");if(n&&n.getContext)return n.width=e,n.height=t,n}return null}Math.sqrt(1/3),Math.sin(di/10),Math.sin(7*di/10),Math.sin(pi/10),Math.cos(pi/10),Math.sqrt(3),Math.sqrt(3),Math.sqrt(12);var na=function(){return"undefined"!=typeof Image?Image:null},ra=Object(mn.a)(lt.a),ia=ra.right,aa=ra.left;Object(mn.a)(pt).center;var oa=ia;function sa(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function ua(e,t){switch(arguments.length){case 0:break;case 1:"function"==typeof e?this.interpolator(e):this.range(e);break;default:this.domain(e),"function"==typeof t?this.interpolator(t):this.range(t)}return this}var ca=Symbol("implicit");function la(){var e=new Map,t=[],n=[],r=ca;function i(i){var a=i+"",o=e.get(a);if(!o){if(r!==ca)return r;e.set(a,o=t.push(i))}return n[(o-1)%n.length]}return i.domain=function(n){if(!arguments.length)return t.slice();t=[],e=new Map;var r,a=p(n);try{for(a.s();!(r=a.n()).done;){var o=r.value,s=o+"";e.has(s)||e.set(s,t.push(o))}}catch(u){a.e(u)}finally{a.f()}return i},i.range=function(e){return arguments.length?(n=Array.from(e),i):n.slice()},i.unknown=function(e){return arguments.length?(r=e,i):r},i.copy=function(){return la(t,n).unknown(r)},sa.apply(i,arguments),i}var fa=n(45),da=n(50);function ha(e,t,n,r){var i,a=Object(fa.c)(e,t,n);switch((r=Object(da.formatSpecifier)(null==r?",f":r)).type){case"s":var o=Math.max(Math.abs(e),Math.abs(t));return null!=r.precision||isNaN(i=Object(da.precisionPrefix)(a,o))||(r.precision=i),Object(da.formatPrefix)(r,o);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=Object(da.precisionRound)(a,Math.max(Math.abs(e),Math.abs(t))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=Object(da.precisionFixed)(a))||(r.precision=i-2*("%"===r.type))}return Object(da.format)(r)}var pa=function(e,t,n){e.prototype=t.prototype=n,n.constructor=e};function ma(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function va(){}var ga="\\s*([+-]?\\d+)\\s*",ya="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",ba="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",xa=/^#([0-9a-f]{3,8})$/,wa=new RegExp("^rgb\\("+[ga,ga,ga]+"\\)$"),_a=new RegExp("^rgb\\("+[ba,ba,ba]+"\\)$"),ka=new RegExp("^rgba\\("+[ga,ga,ga,ya]+"\\)$"),Ea=new RegExp("^rgba\\("+[ba,ba,ba,ya]+"\\)$"),Sa=new RegExp("^hsl\\("+[ya,ba,ba]+"\\)$"),Ca=new RegExp("^hsla\\("+[ya,ba,ba,ya]+"\\)$"),Aa={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Oa(){return this.rgb().formatHex()}function Da(){return this.rgb().formatRgb()}function Ta(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=xa.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?ja(t):3===n?new Na(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?Ma(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?Ma(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=wa.exec(e))?new Na(t[1],t[2],t[3],1):(t=_a.exec(e))?new Na(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=ka.exec(e))?Ma(t[1],t[2],t[3],t[4]):(t=Ea.exec(e))?Ma(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=Sa.exec(e))?La(t[1],t[2]/100,t[3]/100,1):(t=Ca.exec(e))?La(t[1],t[2]/100,t[3]/100,t[4]):Aa.hasOwnProperty(e)?ja(Aa[e]):"transparent"===e?new Na(NaN,NaN,NaN,0):null}function ja(e){return new Na(e>>16&255,e>>8&255,255&e,1)}function Ma(e,t,n,r){return r<=0&&(e=t=n=NaN),new Na(e,t,n,r)}function Fa(e){return e instanceof va||(e=Ta(e)),e?new Na((e=e.rgb()).r,e.g,e.b,e.opacity):new Na}function Ia(e,t,n,r){return 1===arguments.length?Fa(e):new Na(e,t,n,null==r?1:r)}function Na(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function Ra(){return"#"+Ba(this.r)+Ba(this.g)+Ba(this.b)}function Pa(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function Ba(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function La(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Wa(e,t,n,r)}function za(e){if(e instanceof Wa)return new Wa(e.h,e.s,e.l,e.opacity);if(e instanceof va||(e=Ta(e)),!e)return new Wa;if(e instanceof Wa)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),o=NaN,s=a-i,u=(a+i)/2;return s?(o=t===a?(n-r)/s+6*(n<r):n===a?(r-t)/s+2:(t-n)/s+4,s/=u<.5?a+i:2-a-i,o*=60):s=u>0&&u<1?0:o,new Wa(o,s,u,e.opacity)}function Ua(e,t,n,r){return 1===arguments.length?za(e):new Wa(e,t,n,null==r?1:r)}function Wa(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function Va(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function Ga(e,t,n,r,i){var a=e*e,o=a*e;return((1-3*e+3*a-o)*t+(4-6*a+3*o)*n+(1+3*e+3*a-3*o)*r+o*i)/6}pa(va,Ta,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:Oa,formatHex:Oa,formatHsl:function(){return za(this).formatHsl()},formatRgb:Da,toString:Da}),pa(Na,Ia,ma(va,{brighter:function(e){return e=null==e?1/.7:Math.pow(1/.7,e),new Na(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?.7:Math.pow(.7,e),new Na(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Ra,formatHex:Ra,formatRgb:Pa,toString:Pa})),pa(Wa,Ua,ma(va,{brighter:function(e){return e=null==e?1/.7:Math.pow(1/.7,e),new Wa(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?.7:Math.pow(.7,e),new Wa(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new Na(Va(e>=240?e-240:e+120,i,r),Va(e,i,r),Va(e<120?e+240:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}}));var qa=function(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],a=e[r+1],o=r>0?e[r-1]:2*i-a,s=r<t-1?e[r+2]:2*a-i;return Ga((n-r/t)*t,o,i,a,s)}},Ha=function(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),i=e[(r+t-1)%t],a=e[r%t],o=e[(r+1)%t],s=e[(r+2)%t];return Ga((n-r/t)*t,i,a,o,s)}},Xa=function(e){return function(){return e}};function Ka(e,t){return function(n){return e+n*t}}function Ya(e,t){var n=t-e;return n?Ka(e,n>180||n<-180?n-360*Math.round(n/360):n):Xa(isNaN(e)?t:e)}function $a(e){return 1==(e=+e)?Ja:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):Xa(isNaN(t)?n:t)}}function Ja(e,t){var n=t-e;return n?Ka(e,n):Xa(isNaN(e)?t:e)}var Za=function e(t){var n=$a(t);function r(e,t){var r=n((e=Ia(e)).r,(t=Ia(t)).r),i=n(e.g,t.g),a=n(e.b,t.b),o=Ja(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=a(t),e.opacity=o(t),e+""}}return r.gamma=e,r}(1);function Qa(e){return function(t){var n,r,i=t.length,a=new Array(i),o=new Array(i),s=new Array(i);for(n=0;n<i;++n)r=Ia(t[n]),a[n]=r.r||0,o[n]=r.g||0,s[n]=r.b||0;return a=e(a),o=e(o),s=e(s),r.opacity=1,function(e){return r.r=a(e),r.g=o(e),r.b=s(e),r+""}}}var eo=Qa(qa),to=Qa(Ha),no=function(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,i=t.slice();return function(a){for(n=0;n<r;++n)i[n]=e[n]*(1-a)+t[n]*a;return i}};function ro(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}var io=function(e,t){return(ro(t)?no:ao)(e,t)};function ao(e,t){var n,r=t?t.length:0,i=e?Math.min(r,e.length):0,a=new Array(i),o=new Array(r);for(n=0;n<i;++n)a[n]=ho(e[n],t[n]);for(;n<r;++n)o[n]=t[n];return function(e){for(n=0;n<i;++n)o[n]=a[n](e);return o}}var oo=function(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}},so=function(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}},uo=function(e,t){var n,r={},i={};for(n in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)n in e?r[n]=ho(e[n],t[n]):i[n]=t[n];return function(e){for(n in r)i[n]=r[n](e);return i}},co=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,lo=new RegExp(co.source,"g"),fo=function(e,t){var n,r,i,a=co.lastIndex=lo.lastIndex=0,o=-1,s=[],u=[];for(e+="",t+="";(n=co.exec(e))&&(r=lo.exec(t));)(i=r.index)>a&&(i=t.slice(a,i),s[o]?s[o]+=i:s[++o]=i),(n=n[0])===(r=r[0])?s[o]?s[o]+=r:s[++o]=r:(s[++o]=null,u.push({i:o,x:so(n,r)})),a=lo.lastIndex;return a<t.length&&(i=t.slice(a),s[o]?s[o]+=i:s[++o]=i),s.length<2?u[0]?function(e){return function(t){return e(t)+""}}(u[0].x):function(e){return function(){return e}}(t):(t=u.length,function(e){for(var n,r=0;r<t;++r)s[(n=u[r]).i]=n.x(e);return s.join("")})},ho=function(e,t){var n,r=typeof t;return null==t||"boolean"===r?Xa(t):("number"===r?so:"string"===r?(n=Ta(t))?(t=n,Za):fo:t instanceof Ta?Za:t instanceof Date?oo:ro(t)?no:Array.isArray(t)?ao:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?uo:so)(e,t)},po=function(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}};function mo(e){return+e}var vo=[0,1];function go(e){return e}function yo(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:function(e){return function(){return e}}(isNaN(t)?NaN:.5)}function bo(e,t,n){var r=e[0],i=e[1],a=t[0],o=t[1];return i<r?(r=yo(i,r),a=n(o,a)):(r=yo(r,i),a=n(a,o)),function(e){return a(r(e))}}function xo(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),a=new Array(r),o=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<r;)i[o]=yo(e[o],e[o+1]),a[o]=n(t[o],t[o+1]);return function(t){var n=oa(e,t,1,r)-1;return a[n](i[n](t))}}function wo(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function _o(){var e,t,n,r,i,a,o=vo,s=vo,u=ho,c=go;function l(){var e=Math.min(o.length,s.length);return c!==go&&(c=function(e,t){var n;return e>t&&(n=e,e=t,t=n),function(n){return Math.max(e,Math.min(t,n))}}(o[0],o[e-1])),r=e>2?xo:bo,i=a=null,f}function f(t){return null==t||isNaN(t=+t)?n:(i||(i=r(o.map(e),s,u)))(e(c(t)))}return f.invert=function(n){return c(t((a||(a=r(s,o.map(e),so)))(n)))},f.domain=function(e){return arguments.length?(o=Array.from(e,mo),l()):o.slice()},f.range=function(e){return arguments.length?(s=Array.from(e),l()):s.slice()},f.rangeRound=function(e){return s=Array.from(e),u=po,l()},f.clamp=function(e){return arguments.length?(c=!!e||go,l()):c!==go},f.interpolate=function(e){return arguments.length?(u=e,l()):u},f.unknown=function(e){return arguments.length?(n=e,f):n},function(n,r){return e=n,t=r,l()}}function ko(){return _o()(go,go)}function Eo(e){var t=e.domain;return e.ticks=function(e){var n=t();return Object(fa.a)(n[0],n[n.length-1],null==e?10:e)},e.tickFormat=function(e,n){var r=t();return ha(r[0],r[r.length-1],null==e?10:e,n)},e.nice=function(n){null==n&&(n=10);var r,i,a=t(),o=0,s=a.length-1,u=a[o],c=a[s],l=10;for(c<u&&(i=u,u=c,c=i,i=o,o=s,s=i);l-- >0;){if((i=Object(fa.b)(u,c,n))===r)return a[o]=u,a[s]=c,t(a);if(i>0)u=Math.floor(u/i)*i,c=Math.ceil(c/i)*i;else{if(!(i<0))break;u=Math.ceil(u*i)/i,c=Math.floor(c*i)/i}r=i}return e},e}function So(e,t){var n,r=0,i=(e=e.slice()).length-1,a=e[r],o=e[i];return o<a&&(n=r,r=i,i=n,n=a,a=o,o=n),e[r]=t.floor(a),e[i]=t.ceil(o),e}function Co(e){return Math.log(e)}function Ao(e){return Math.exp(e)}function Oo(e){return-Math.log(-e)}function Do(e){return-Math.exp(-e)}function To(e){return isFinite(e)?+("1e"+e):e<0?0:e}function jo(e){return function(t){return-e(-t)}}function Mo(e){var t,n,r=e(Co,Ao),i=r.domain,a=10;function o(){return t=function(e){return e===Math.E?Math.log:10===e&&Math.log10||2===e&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}(a),n=function(e){return 10===e?To:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}(a),i()[0]<0?(t=jo(t),n=jo(n),e(Oo,Do)):e(Co,Ao),r}return r.base=function(e){return arguments.length?(a=+e,o()):a},r.domain=function(e){return arguments.length?(i(e),o()):i()},r.ticks=function(e){var r,o=i(),s=o[0],u=o[o.length-1];(r=u<s)&&(d=s,s=u,u=d);var c,l,f,d=t(s),h=t(u),p=null==e?10:+e,m=[];if(!(a%1)&&h-d<p){if(d=Math.floor(d),h=Math.ceil(h),s>0){for(;d<=h;++d)for(l=1,c=n(d);l<a;++l)if(!((f=c*l)<s)){if(f>u)break;m.push(f)}}else for(;d<=h;++d)for(l=a-1,c=n(d);l>=1;--l)if(!((f=c*l)<s)){if(f>u)break;m.push(f)}2*m.length<p&&(m=Object(fa.a)(s,u,p))}else m=Object(fa.a)(d,h,Math.min(h-d,p)).map(n);return r?m.reverse():m},r.tickFormat=function(e,i){if(null==i&&(i=10===a?".0e":","),"function"!=typeof i&&(i=Object(da.format)(i)),e===1/0)return i;null==e&&(e=10);var o=Math.max(1,a*e/r.ticks().length);return function(e){var r=e/n(Math.round(t(e)));return r*a<a-.5&&(r*=a),r<=o?i(e):""}},r.nice=function(){return i(So(i(),{floor:function(e){return n(Math.floor(t(e)))},ceil:function(e){return n(Math.ceil(t(e)))}}))},r}function Fo(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function Io(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function No(e){return e<0?-e*e:e*e}function Ro(e){var t=e(go,go),n=1;return t.exponent=function(t){return arguments.length?1===(n=+t)?e(go,go):.5===n?e(Io,No):e(Fo(n),Fo(1/n)):n},Eo(t)}function Po(){var e=Ro(_o());return e.copy=function(){return wo(e,Po()).exponent(e.exponent())},sa.apply(e,arguments),e}function Bo(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function Lo(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function zo(e){var t=1,n=e(Bo(t),Lo(t));return n.constant=function(n){return arguments.length?e(Bo(t=+n),Lo(t)):t},Eo(n)}var Uo=n(12),Wo=n(182),Vo=n(69),Go=n(183),qo=n(184),Ho=n(72),Xo=n(40),Ko=n(135),Yo=n(70),$o=n(180),Jo=n(181),Zo=n(71),Qo=n(39),es=n(134),ts=n(68);function ns(e,t,n,r,i,a){var o=[[Vo.a,1,Uo.e],[Vo.a,5,5*Uo.e],[Vo.a,15,15*Uo.e],[Vo.a,30,30*Uo.e],[a,1,Uo.c],[a,5,5*Uo.c],[a,15,15*Uo.c],[a,30,30*Uo.c],[i,1,Uo.b],[i,3,3*Uo.b],[i,6,6*Uo.b],[i,12,12*Uo.b],[r,1,Uo.a],[r,2,2*Uo.a],[n,1,Uo.f],[t,1,Uo.d],[t,3,3*Uo.d],[e,1,Uo.g]];function s(t,n,r){var i=Math.abs(n-t)/r,a=Object(mn.a)((function(e){return f(e,3)[2]})).right(o,i);if(a===o.length)return e.every(Object(fa.c)(t/Uo.g,n/Uo.g,r));if(0===a)return Wo.a.every(Math.max(Object(fa.c)(t,n,r),1));var s=f(o[i/o[a-1][2]<o[a][2]/i?a-1:a],2),u=s[0],c=s[1];return u.every(c)}return[function(e,t,n){var r,i=t<e;i&&(e=(r=[t,e])[0],t=r[1]);var a=n&&"function"==typeof n.range?n:s(e,t,n),o=a?a.range(e,+t+1):[];return i?o.reverse():o},s]}var rs=ns(ts.a,es.a,Qo.b,Zo.a,Jo.a,$o.a),is=f(rs,2),as=is[0],os=is[1],ss=ns(Yo.a,Ko.a,Xo.b,Ho.a,qo.a,Go.a),us=f(ss,2),cs=us[0],ls=us[1],fs=n(100);function ds(e){return new Date(e)}function hs(e){return e instanceof Date?+e:+new Date(+e)}function ps(e,t,n,r,i,a,o,s,u,c){var l=ko(),f=l.invert,d=l.domain,h=c(".%L"),p=c(":%S"),m=c("%I:%M"),v=c("%I %p"),g=c("%a %d"),y=c("%b %d"),b=c("%B"),x=c("%Y");function w(e){return(u(e)<e?h:s(e)<e?p:o(e)<e?m:a(e)<e?v:r(e)<e?i(e)<e?g:y:n(e)<e?b:x)(e)}return l.invert=function(e){return new Date(f(e))},l.domain=function(e){return arguments.length?d(Array.from(e,hs)):d().map(ds)},l.ticks=function(t){var n=d();return e(n[0],n[n.length-1],null==t?10:t)},l.tickFormat=function(e,t){return null==t?w:c(t)},l.nice=function(e){var n=d();return e&&"function"==typeof e.range||(e=t(n[0],n[n.length-1],null==e?10:e)),e?d(So(n,e)):l},l.copy=function(){return wo(l,ps(e,t,n,r,i,a,o,s,u,c))},l}function ms(){var e,t,n,r,i,a=0,o=1,s=go,u=!1;function c(t){return null==t||isNaN(t=+t)?i:s(0===n?.5:(t=(r(t)-e)*n,u?Math.max(0,Math.min(1,t)):t))}function l(e){return function(t){var n,r,i;return arguments.length?(r=(n=f(t,2))[0],i=n[1],s=e(r,i),c):[s(0),s(1)]}}return c.domain=function(i){var s;return arguments.length?(s=f(i,2),a=s[0],o=s[1],e=r(a=+a),t=r(o=+o),n=e===t?0:1/(t-e),c):[a,o]},c.clamp=function(e){return arguments.length?(u=!!e,c):u},c.interpolator=function(e){return arguments.length?(s=e,c):s},c.range=l(ho),c.rangeRound=l(po),c.unknown=function(e){return arguments.length?(i=e,c):i},function(i){return r=i,e=i(a),t=i(o),n=e===t?0:1/(t-e),c}}function vs(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function gs(){var e=Eo(ms()(go));return e.copy=function(){return vs(e,gs())},ua.apply(e,arguments)}function ys(){var e=Ro(ms());return e.copy=function(){return vs(e,ys()).exponent(e.exponent())},ua.apply(e,arguments)}function bs(e,t){void 0===t&&(t=e,e=ho);for(var n=0,r=t.length-1,i=t[0],a=new Array(r<0?0:r);n<r;)a[n]=e(i,i=t[++n]);return function(e){var t=Math.max(0,Math.min(r-1,Math.floor(e*=r)));return a[t](e-t)}}function xs(){var e,t,n,r,i,a,o,s=0,u=.5,c=1,l=1,d=go,h=!1;function p(e){return isNaN(e=+e)?o:(e=.5+((e=+a(e))-t)*(l*e<l*t?r:i),d(h?Math.max(0,Math.min(1,e)):e))}function m(e){return function(t){var n,r,i,a;return arguments.length?(r=(n=f(t,3))[0],i=n[1],a=n[2],d=bs(e,[r,i,a]),p):[d(0),d(.5),d(1)]}}return p.domain=function(o){var d;return arguments.length?(d=f(o,3),s=d[0],u=d[1],c=d[2],e=a(s=+s),t=a(u=+u),n=a(c=+c),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),l=t<e?-1:1,p):[s,u,c]},p.clamp=function(e){return arguments.length?(h=!!e,p):h},p.interpolator=function(e){return arguments.length?(d=e,p):d},p.range=m(ho),p.rangeRound=m(po),p.unknown=function(e){return arguments.length?(o=e,p):o},function(o){return a=o,e=o(s),t=o(u),n=o(c),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),l=t<e?-1:1,p}}function ws(){var e=Ro(xs());return e.copy=function(){return vs(e,ws()).exponent(e.exponent())},ua.apply(e,arguments)}var _s,ks=function(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}},Es=function(e,t){var n=Ya(+e,+t);return function(e){var t=n(e);return t-360*Math.floor(t/360)}},Ss=180/Math.PI,Cs={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1},As=function(e,t,n,r,i,a){var o,s,u;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(u=e*n+t*r)&&(n-=e*u,r-=t*u),(s=Math.sqrt(n*n+r*r))&&(n/=s,r/=s,u/=s),e*r<t*n&&(e=-e,t=-t,u=-u,o=-o),{translateX:i,translateY:a,rotate:Math.atan2(t,e)*Ss,skewX:Math.atan(u)*Ss,scaleX:o,scaleY:s}};function Os(e,t,n,r){function i(e){return e.length?e.pop()+" ":""}return function(a,o){var s=[],u=[];return a=e(a),o=e(o),function(e,r,i,a,o,s){if(e!==i||r!==a){var u=o.push("translate(",null,t,null,n);s.push({i:u-4,x:so(e,i)},{i:u-2,x:so(r,a)})}else(i||a)&&o.push("translate("+i+t+a+n)}(a.translateX,a.translateY,o.translateX,o.translateY,s,u),function(e,t,n,a){e!==t?(e-t>180?t+=360:t-e>180&&(e+=360),a.push({i:n.push(i(n)+"rotate(",null,r)-2,x:so(e,t)})):t&&n.push(i(n)+"rotate("+t+r)}(a.rotate,o.rotate,s,u),function(e,t,n,a){e!==t?a.push({i:n.push(i(n)+"skewX(",null,r)-2,x:so(e,t)}):t&&n.push(i(n)+"skewX("+t+r)}(a.skewX,o.skewX,s,u),function(e,t,n,r,a,o){if(e!==n||t!==r){var s=a.push(i(a)+"scale(",null,",",null,")");o.push({i:s-4,x:so(e,n)},{i:s-2,x:so(t,r)})}else 1===n&&1===r||a.push(i(a)+"scale("+n+","+r+")")}(a.scaleX,a.scaleY,o.scaleX,o.scaleY,s,u),a=o=null,function(e){for(var t,n=-1,r=u.length;++n<r;)s[(t=u[n]).i]=t.x(e);return s.join("")}}}var Ds=Os((function(e){var t=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?Cs:As(t.a,t.b,t.c,t.d,t.e,t.f)}),"px, ","px)","deg)"),Ts=Os((function(e){return null==e?Cs:(_s||(_s=document.createElementNS("http://www.w3.org/2000/svg","g")),_s.setAttribute("transform",e),(e=_s.transform.baseVal.consolidate())?(e=e.matrix,As(e.a,e.b,e.c,e.d,e.e,e.f)):Cs)}),", ",")",")"),js=1e-12;function Ms(e){return((e=Math.exp(e))+1/e)/2}var Fs=function e(t,n,r){function i(e,i){var a,o,s=e[0],u=e[1],c=e[2],l=i[0],f=i[1],d=i[2],h=l-s,p=f-u,m=h*h+p*p;if(m<js)o=Math.log(d/c)/t,a=function(e){return[s+e*h,u+e*p,c*Math.exp(t*e*o)]};else{var v=Math.sqrt(m),g=(d*d-c*c+r*m)/(2*c*n*v),y=(d*d-c*c-r*m)/(2*d*n*v),b=Math.log(Math.sqrt(g*g+1)-g),x=Math.log(Math.sqrt(y*y+1)-y);o=(x-b)/t,a=function(e){var r=e*o,i=Ms(b),a=c/(n*v)*(i*function(e){return((e=Math.exp(2*e))-1)/(e+1)}(t*r+b)-function(e){return((e=Math.exp(e))-1/e)/2}(b));return[s+a*h,u+a*p,c*i/Ms(t*r+b)]}}return a.duration=1e3*o*t/Math.SQRT2,a}return i.rho=function(t){var n=Math.max(.001,+t),r=n*n;return e(n,r,r*r)},i}(Math.SQRT2,2,4);function Is(e){return function(t,n){var r=e((t=Ua(t)).h,(n=Ua(n)).h),i=Ja(t.s,n.s),a=Ja(t.l,n.l),o=Ja(t.opacity,n.opacity);return function(e){return t.h=r(e),t.s=i(e),t.l=a(e),t.opacity=o(e),t+""}}}var Ns=Is(Ya),Rs=Is(Ja),Ps=Math.PI/180,Bs=180/Math.PI,Ls=.96422,zs=1,Us=.82521,Ws=4/29,Vs=6/29,Gs=3*Vs*Vs,qs=Vs*Vs*Vs;function Hs(e){if(e instanceof Ks)return new Ks(e.l,e.a,e.b,e.opacity);if(e instanceof tu)return nu(e);e instanceof Na||(e=Fa(e));var t,n,r=Zs(e.r),i=Zs(e.g),a=Zs(e.b),o=Ys((.2225045*r+.7168786*i+.0606169*a)/zs);return r===i&&i===a?t=n=o:(t=Ys((.4360747*r+.3850649*i+.1430804*a)/Ls),n=Ys((.0139322*r+.0971045*i+.7141733*a)/Us)),new Ks(116*o-16,500*(t-o),200*(o-n),e.opacity)}function Xs(e,t,n,r){return 1===arguments.length?Hs(e):new Ks(e,t,n,null==r?1:r)}function Ks(e,t,n,r){this.l=+e,this.a=+t,this.b=+n,this.opacity=+r}function Ys(e){return e>qs?Math.pow(e,1/3):e/Gs+Ws}function $s(e){return e>Vs?e*e*e:Gs*(e-Ws)}function Js(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Zs(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Qs(e){if(e instanceof tu)return new tu(e.h,e.c,e.l,e.opacity);if(e instanceof Ks||(e=Hs(e)),0===e.a&&0===e.b)return new tu(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*Bs;return new tu(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function eu(e,t,n,r){return 1===arguments.length?Qs(e):new tu(e,t,n,null==r?1:r)}function tu(e,t,n,r){this.h=+e,this.c=+t,this.l=+n,this.opacity=+r}function nu(e){if(isNaN(e.h))return new Ks(e.l,0,0,e.opacity);var t=e.h*Ps;return new Ks(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}function ru(e,t){var n=Ja((e=Xs(e)).l,(t=Xs(t)).l),r=Ja(e.a,t.a),i=Ja(e.b,t.b),a=Ja(e.opacity,t.opacity);return function(t){return e.l=n(t),e.a=r(t),e.b=i(t),e.opacity=a(t),e+""}}function iu(e){return function(t,n){var r=e((t=eu(t)).h,(n=eu(n)).h),i=Ja(t.c,n.c),a=Ja(t.l,n.l),o=Ja(t.opacity,n.opacity);return function(e){return t.h=r(e),t.c=i(e),t.l=a(e),t.opacity=o(e),t+""}}}pa(Ks,Xs,ma(va,{brighter:function(e){return new Ks(this.l+18*(null==e?1:e),this.a,this.b,this.opacity)},darker:function(e){return new Ks(this.l-18*(null==e?1:e),this.a,this.b,this.opacity)},rgb:function(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return new Na(Js(3.1338561*(t=Ls*$s(t))-1.6168667*(e=zs*$s(e))-.4906146*(n=Us*$s(n))),Js(-.9787684*t+1.9161415*e+.033454*n),Js(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}})),pa(tu,eu,ma(va,{brighter:function(e){return new tu(this.h,this.c,this.l+18*(null==e?1:e),this.opacity)},darker:function(e){return new tu(this.h,this.c,this.l-18*(null==e?1:e),this.opacity)},rgb:function(){return nu(this).rgb()}}));var au=iu(Ya),ou=iu(Ja),su=-.29227,uu=-.90649,cu=1.97294,lu=cu*uu,fu=1.78277*cu,du=1.78277*su- -.14861*uu;function hu(e,t,n,r){return 1===arguments.length?function(e){if(e instanceof pu)return new pu(e.h,e.s,e.l,e.opacity);e instanceof Na||(e=Fa(e));var t=e.r/255,n=e.g/255,r=e.b/255,i=(du*r+lu*t-fu*n)/(du+lu-fu),a=r-i,o=(cu*(n-i)-su*a)/uu,s=Math.sqrt(o*o+a*a)/(cu*i*(1-i)),u=s?Math.atan2(o,a)*Bs-120:NaN;return new pu(u<0?u+360:u,s,i,e.opacity)}(e):new pu(e,t,n,null==r?1:r)}function pu(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function mu(e){return function t(n){function r(t,r){var i=e((t=hu(t)).h,(r=hu(r)).h),a=Ja(t.s,r.s),o=Ja(t.l,r.l),s=Ja(t.opacity,r.opacity);return function(e){return t.h=i(e),t.s=a(e),t.l=o(Math.pow(e,n)),t.opacity=s(e),t+""}}return n=+n,r.gamma=t,r}(1)}pa(pu,hu,ma(va,{brighter:function(e){return e=null==e?1/.7:Math.pow(1/.7,e),new pu(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?.7:Math.pow(.7,e),new pu(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=isNaN(this.h)?0:(this.h+120)*Ps,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),r=Math.cos(e),i=Math.sin(e);return new Na(255*(t+n*(-.14861*r+1.78277*i)),255*(t+n*(su*r+uu*i)),255*(t+n*(cu*r)),this.opacity)}}));var vu=mu(Ya),gu=mu(Ja),yu=function(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e(r/(t-1));return n};function bu(e,t,n){var r=e-t+2*n;return e?r>0?r:1:0}var xu="linear",wu="log",_u="pow",ku="sqrt",Eu="symlog",Su="time",Cu="utc",Au="sequential",Ou="diverging",Du="quantile",Tu="quantize",ju="threshold",Mu="ordinal",Fu="point",Iu="band",Nu="bin-ordinal",Ru="continuous",Pu="discrete",Bu="discretizing",Lu="interpolating",zu="temporal";function Uu(){var e,t,n=la().unknown(void 0),r=n.domain,i=n.range,a=[0,1],o=!1,s=0,u=0,c=.5;function l(){var n=r().length,l=a[1]<a[0],f=a[1-l],d=bu(n,s,u),h=a[l-0];e=(f-h)/(d||1),o&&(e=Math.floor(e)),h+=(f-h-e*(n-s))*c,t=e*(1-s),o&&(h=Math.round(h),t=Math.round(t));var p=pn(n).map((function(t){return h+e*t}));return i(l?p.reverse():p)}return delete n.unknown,n.domain=function(e){return arguments.length?(r(e),l()):r()},n.range=function(e){return arguments.length?(a=[+e[0],+e[1]],l()):a.slice()},n.rangeRound=function(e){return a=[+e[0],+e[1]],o=!0,l()},n.bandwidth=function(){return t},n.step=function(){return e},n.round=function(e){return arguments.length?(o=!!e,l()):o},n.padding=function(e){return arguments.length?(u=Math.max(0,Math.min(1,e)),s=u,l()):s},n.paddingInner=function(e){return arguments.length?(s=Math.max(0,Math.min(1,e)),l()):s},n.paddingOuter=function(e){return arguments.length?(u=Math.max(0,Math.min(1,e)),l()):u},n.align=function(e){return arguments.length?(c=Math.max(0,Math.min(1,e)),l()):c},n.invertRange=function(e){if(null!=e[0]&&null!=e[1]){var n,o,s,u=a[1]<a[0],c=u?i().reverse():i(),l=c.length-1,f=+e[0],d=+e[1];return f!=f||d!=d||(d<f&&(s=f,f=d,d=s),d<c[0]||f>a[1-u])?void 0:(n=Math.max(0,ia(c,f)-1),o=f===d?n:ia(c,d)-1,f-c[n]>t+1e-10&&++n,u&&(s=n,n=l-o,o=l-s),n>o?void 0:r().slice(n,o+1))}},n.invert=function(e){var t=n.invertRange([e,e]);return t?t[0]:t},n.copy=function(){return Uu().domain(r()).range(a).round(o).paddingInner(s).paddingOuter(u).align(c)},l()}var Wu=Array.prototype.map,Vu=Array.prototype.slice,Gu={};function qu(e,t,n){return arguments.length>1?(Gu[e]=function(e,t,n){var r=function(){var n=t();return n.invertRange||(n.invertRange=n.invert?function(e){return function(t){var n,r=t[0],i=t[1];return i<r&&(n=r,r=i,i=n),[e.invert(r),e.invert(i)]}}(n):n.invertExtent?function(e){return function(t){var n,r,i,a,o=e.range(),s=t[0],u=t[1],c=-1;for(u<s&&(r=s,s=u,u=r),i=0,a=o.length;i<a;++i)o[i]>=s&&o[i]<=u&&(c<0&&(c=i),n=i);if(!(c<0))return s=e.invertExtent(o[c]),u=e.invertExtent(o[n]),[void 0===s[0]?s[1]:s[0],void 0===u[1]?u[0]:u[1]]}}(n):void 0),n.type=e,n};return r.metadata=Object(ye.Fa)(Object(ye.i)(n)),r}(e,t,n),this):Hu(e)?Gu[e]:void 0}function Hu(e){return Object(ye.w)(Gu,e)}function Xu(e,t){var n=Gu[e];return n&&n.metadata[t]}function Ku(e){return Xu(e,Ru)}function Yu(e){return Xu(e,Pu)}function $u(e){return Xu(e,Bu)}function Ju(e){return Xu(e,wu)}function Zu(e){return Xu(e,Lu)}function Qu(e){return Xu(e,Du)}qu("identity",(function e(t){var n;function r(e){return null==e||isNaN(e=+e)?n:e}return r.invert=r,r.domain=r.range=function(e){return arguments.length?(t=Array.from(e,mo),r):t.slice()},r.unknown=function(e){return arguments.length?(n=e,r):n},r.copy=function(){return e(t).unknown(n)},t=arguments.length?Array.from(t,mo):[0,1],Eo(r)})),qu(xu,(function e(){var t=ko();return t.copy=function(){return wo(t,e())},sa.apply(t,arguments),Eo(t)}),Ru),qu(wu,(function e(){var t=Mo(_o()).domain([1,10]);return t.copy=function(){return wo(t,e()).base(t.base())},sa.apply(t,arguments),t}),[Ru,wu]),qu(_u,Po,Ru),qu(ku,(function(){return Po.apply(null,arguments).exponent(.5)}),Ru),qu(Eu,(function e(){var t=zo(_o());return t.copy=function(){return wo(t,e()).constant(t.constant())},sa.apply(t,arguments)}),Ru),qu(Su,(function(){return sa.apply(ps(cs,ls,Yo.a,Ko.a,Xo.b,Ho.a,qo.a,Go.a,Vo.a,fs.a).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}),[Ru,zu]),qu(Cu,(function(){return sa.apply(ps(as,os,ts.a,es.a,Qo.b,Zo.a,Jo.a,$o.a,Vo.a,fs.c).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}),[Ru,zu]),qu(Au,gs,[Ru,Lu]),qu("".concat(Au,"-").concat(xu),gs,[Ru,Lu]),qu("".concat(Au,"-").concat(wu),(function e(){var t=Mo(ms()).domain([1,10]);return t.copy=function(){return vs(t,e()).base(t.base())},ua.apply(t,arguments)}),[Ru,Lu,wu]),qu("".concat(Au,"-").concat(_u),ys,[Ru,Lu]),qu("".concat(Au,"-").concat(ku),(function(){return ys.apply(null,arguments).exponent(.5)}),[Ru,Lu]),qu("".concat(Au,"-").concat(Eu),(function e(){var t=zo(ms());return t.copy=function(){return vs(t,e()).constant(t.constant())},ua.apply(t,arguments)}),[Ru,Lu]),qu("".concat(Ou,"-").concat(xu),(function e(){var t=Eo(xs()(go));return t.copy=function(){return vs(t,e())},ua.apply(t,arguments)}),[Ru,Lu]),qu("".concat(Ou,"-").concat(wu),(function e(){var t=Mo(xs()).domain([.1,1,10]);return t.copy=function(){return vs(t,e()).base(t.base())},ua.apply(t,arguments)}),[Ru,Lu,wu]),qu("".concat(Ou,"-").concat(_u),ws,[Ru,Lu]),qu("".concat(Ou,"-").concat(ku),(function(){return ws.apply(null,arguments).exponent(.5)}),[Ru,Lu]),qu("".concat(Ou,"-").concat(Eu),(function e(){var t=zo(xs());return t.copy=function(){return vs(t,e()).constant(t.constant())},ua.apply(t,arguments)}),[Ru,Lu]),qu(Du,(function e(){var t,n=[],r=[],i=[];function a(){var e=0,t=Math.max(1,r.length);for(i=new Array(t-1);++e<t;)i[e-1]=vt(n,e/t);return o}function o(e){return null==e||isNaN(e=+e)?t:r[oa(i,e)]}return o.invertExtent=function(e){var t=r.indexOf(e);return t<0?[NaN,NaN]:[t>0?i[t-1]:n[0],t<i.length?i[t]:n[n.length-1]]},o.domain=function(e){if(!arguments.length)return n.slice();n=[];var t,r=p(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;null==i||isNaN(i=+i)||n.push(i)}}catch(o){r.e(o)}finally{r.f()}return n.sort(lt.a),a()},o.range=function(e){return arguments.length?(r=Array.from(e),a()):r.slice()},o.unknown=function(e){return arguments.length?(t=e,o):t},o.quantiles=function(){return i.slice()},o.copy=function(){return e().domain(n).range(r).unknown(t)},sa.apply(o,arguments)}),[Bu,Du]),qu(Tu,(function e(){var t,n=0,r=1,i=1,a=[.5],o=[0,1];function s(e){return null!=e&&e<=e?o[oa(a,e,0,i)]:t}function u(){var e=-1;for(a=new Array(i);++e<i;)a[e]=((e+1)*r-(e-i)*n)/(i+1);return s}return s.domain=function(e){var t;return arguments.length?(t=f(e,2),n=t[0],r=t[1],n=+n,r=+r,u()):[n,r]},s.range=function(e){return arguments.length?(i=(o=Array.from(e)).length-1,u()):o.slice()},s.invertExtent=function(e){var t=o.indexOf(e);return t<0?[NaN,NaN]:t<1?[n,a[0]]:t>=i?[a[i-1],r]:[a[t-1],a[t]]},s.unknown=function(e){return arguments.length?(t=e,s):s},s.thresholds=function(){return a.slice()},s.copy=function(){return e().domain([n,r]).range(o).unknown(t)},sa.apply(Eo(s),arguments)}),Bu),qu(ju,(function e(){var t,n=[.5],r=[0,1],i=1;function a(e){return null!=e&&e<=e?r[oa(n,e,0,i)]:t}return a.domain=function(e){return arguments.length?(n=Array.from(e),i=Math.min(n.length,r.length-1),a):n.slice()},a.range=function(e){return arguments.length?(r=Array.from(e),i=Math.min(n.length,r.length-1),a):r.slice()},a.invertExtent=function(e){var t=r.indexOf(e);return[n[t-1],n[t]]},a.unknown=function(e){return arguments.length?(t=e,a):t},a.copy=function(){return e().domain(n).range(r).unknown(t)},sa.apply(a,arguments)}),Bu),qu(Nu,(function e(){var t=[],n=[];function r(e){return null==e||e!=e?void 0:n[(oa(t,e)-1)%n.length]}return r.domain=function(e){return arguments.length?(t=function(e){return Wu.call(e,ye.Ea)}(e),r):t.slice()},r.range=function(e){return arguments.length?(n=Vu.call(e),r):n.slice()},r.tickFormat=function(e,n){return ha(t[0],Object(ye.W)(t),null==e?10:e,n)},r.copy=function(){return e().domain(r.domain()).range(r.range())},r}),[Pu,Bu]),qu(Mu,la,Pu),qu(Iu,Uu,Pu),qu(Fu,(function(){return function e(t){var n=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,t.copy=function(){return e(n())},t}(Uu().paddingInner(1))}),Pu);var ec=["clamp","base","constant","exponent"];function tc(e,t){var n=t[0],r=Object(ye.W)(t)-n;return function(t){return e(n+t*r)}}function nc(e,t,n){return bs(ac(t||"rgb",n),e)}function rc(e,t){for(var n=new Array(t),r=t+1,i=0;i<t;)n[i]=e(++i/r);return n}function ic(e,t,n){var r,i,a,o=n-t;return o&&Number.isFinite(o)?(r=(i=e.type).indexOf("-"),i=r<0?i:i.slice(r+1),a=qu(i)().domain([t,n]).range([0,1]),ec.forEach((function(t){return e[t]?a[t](e[t]()):0})),a):Object(ye.m)(.5)}function ac(e,t){var n=S[function(e){return"interpolate"+e.toLowerCase().split("-").map((function(e){return e[0].toUpperCase()+e.slice(1)})).join("")}(e)];return null!=t&&n&&n.gamma?n.gamma(t):n}function oc(e){for(var t=e.length/6|0,n=new Array(t),r=0;r<t;)n[r]="#"+e.slice(6*r,6*++r);return n}function sc(e,t){for(var n in e)cc(n,t(e[n]))}var uc={};function cc(e,t){return e=e&&e.toLowerCase(),arguments.length>1?(uc[e]=t,this):uc[e]}sc({category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"},oc),sc({blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},(function(e){return nc(oc(e))}));var lc="symbol",fc="discrete",dc=function(e){return Object(ye.B)(e)?e.map((function(e){return String(e)})):String(e)},hc=function(e,t){return e[1]-t[1]},pc=function(e,t){return t[1]-e[1]};function mc(e,t,n){var r;return Object(ye.G)(t)&&(e.bins&&(t=Math.max(t,e.bins.length)),null!=n&&(t=Math.min(t,Math.floor(Object(ye.Z)(e.domain())/n||1)))),Object(ye.H)(t)&&(r=t.step,t=t.interval),Object(ye.J)(t)&&(t=e.type===Su?Object(vn.p)(t):e.type==Cu?Object(vn.v)(t):Object(ye.o)("Only time and utc scales accept interval strings."),r&&(t=t.every(r))),t}function vc(e,t,n){var r=e.range(),i=r[0],a=Object(ye.W)(r),o=hc;if(i>a&&(r=a,a=i,i=r,o=pc),i=Math.floor(i),a=Math.ceil(a),t=t.map((function(t){return[t,e(t)]})).filter((function(e){return i<=e[1]&&e[1]<=a})).sort(o).map((function(e){return e[0]})),n>0&&t.length>1){for(var s=[t[0],Object(ye.W)(t)];t.length>n&&t.length>=3;)t=t.filter((function(e,t){return!(t%2)}));t.length<3&&(t=s)}return t}function gc(e,t){return e.bins?vc(e,e.bins):e.ticks?e.ticks(t):e.domain()}function yc(e,t,n,r,i,a){var o=t.type,s=dc;if(o===Su||i===Su)s=e.timeFormat(r);else if(o===Cu||i===Cu)s=e.utcFormat(r);else if(Ju(o)){var u=e.formatFloat(r);if(a||t.bins)s=u;else{var c=bc(t,n,!1);s=function(e){return c(e)?u(e):""}}}else if(t.tickFormat){var l=t.domain();s=e.formatSpan(l[0],l[l.length-1],n,r)}else r&&(s=e.format(r));return s}function bc(e,t,n){var r=gc(e,t),i=e.base(),a=Math.log(i),o=Math.max(1,i*t/r.length),s=function(e){var t=e/Math.pow(i,Math.round(Math.log(e)/a));return t*i<i-.5&&(t*=i),t<=o};return n?r.filter(s):s}var xc=(y(b={},Du,"quantiles"),y(b,Tu,"thresholds"),y(b,ju,"domain"),b),wc=(y(x={},Du,"quantiles"),y(x,Tu,"domain"),x);function _c(e,t){return e.bins?function(e){var t=e.slice(0,-1);return t.max=Object(ye.W)(e),t}(e.bins):e.type===wu?bc(e,t,!0):xc[e.type]?function(e){var t=[-1/0].concat(e);return t.max=1/0,t}(e[xc[e.type]]()):gc(e,t)}var kc=function(e){return xc[e.type]||e.bins};function Ec(e,t,n,r,i,a,o){var s=wc[t.type]&&a!==Su&&a!==Cu?function(e,t,n){var r,i=t[wc[t.type]](),a=i.length,o=a>1?i[1]-i[0]:i[0];for(r=1;r<a;++r)o=Math.min(o,i[r]-i[r-1]);return e.formatSpan(0,o,30,n)}(e,t,i):yc(e,t,n,i,a,o);return r===lc&&kc(t)?Sc(s):r===fc?Ac(s):Oc(s)}var Sc=function(e){return function(t,n,r){var i=Cc(r[n+1],Cc(r.max,1/0)),a=Dc(t,e),o=Dc(i,e);return a&&o?a+" \u2013 "+o:o?"< "+o:"\u2265 "+a}},Cc=function(e,t){return null!=e?e:t},Ac=function(e){return function(t,n){return n?e(t):null}},Oc=function(e){return function(t){return e(t)}},Dc=function(e,t){return Number.isFinite(e)?t(e):null};function Tc(e,t,n,r){var i=r||t.type;return Object(ye.J)(n)&&function(e){return Xu(e,zu)}(i)&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),n||i!==Su?n||i!==Cu?Ec(e,t,5,null,n,r,!0):e.utcFormat("%A, %d %B %Y, %X UTC"):e.timeFormat("%A, %d %B %Y, %X")}function jc(e,t,n){n=n||{};var r=Math.max(3,n.maxlen||7),i=Tc(e,t,n.format,n.formatType);if($u(t.type)){var a=_c(t).slice(1).map(i),o=a.length;return"".concat(o," boundar").concat(1===o?"y":"ies",": ").concat(a.join(", "))}if(Yu(t.type)){var s=t.domain(),u=s.length,c=u>r?s.slice(0,r-2).map(i).join(", ")+", ending with "+s.slice(-1).map(i):s.map(i).join(", ");return"".concat(u," value").concat(1===u?"":"s",": ").concat(c)}var l=t.domain();return"values from ".concat(i(l[0])," to ").concat(i(Object(ye.W)(l)))}var Mc=0,Fc="p_";function Ic(e){return e&&e.gradient}function Nc(e,t,n){var r=e.gradient,i=e.id,a="radial"===r?Fc:"";return i||(i=e.id="gradient_"+Mc++,"radial"===r?(e.x1=Rc(e.x1,.5),e.y1=Rc(e.y1,.5),e.r1=Rc(e.r1,0),e.x2=Rc(e.x2,.5),e.y2=Rc(e.y2,.5),e.r2=Rc(e.r2,.5),a=Fc):(e.x1=Rc(e.x1,0),e.y1=Rc(e.y1,0),e.x2=Rc(e.x2,1),e.y2=Rc(e.y2,0))),t[i]=e,"url("+(n||"")+"#"+a+i+")"}function Rc(e,t){return null!=e?e:t}function Pc(e,t){var n,r=[];return n={gradient:"linear",x1:e?e[0]:0,y1:e?e[1]:0,x2:t?t[0]:1,y2:t?t[1]:0,stops:r,stop:function(e,t){return r.push({offset:e,color:t}),n}}}var Bc={basis:{curve:function(e){return new qr(e)}},"basis-closed":{curve:function(e){return new Xr(e)}},"basis-open":{curve:function(e){return new Kr(e)}},bundle:{curve:$r,tension:"beta",value:.85},cardinal:{curve:Qr,tension:"tension",value:0},"cardinal-open":{curve:ti,tension:"tension",value:0},"cardinal-closed":{curve:ri,tension:"tension",value:0},"catmull-rom":{curve:yi,tension:"alpha",value:.5},"catmull-rom-closed":{curve:xi,tension:"alpha",value:.5},"catmull-rom-open":{curve:_i,tension:"alpha",value:.5},linear:{curve:Ei},"linear-closed":{curve:function(e){return new Si(e)}},monotone:{horizontal:function(e){return new ji(e)},vertical:function(e){return new Ti(e)}},natural:{curve:function(e){return new Fi(e)}},step:{curve:function(e){return new Ni(e,.5)}},"step-after":{curve:function(e){return new Ni(e,1)}},"step-before":{curve:function(e){return new Ni(e,0)}}};function Lc(e,t,n){var r=Object(ye.w)(Bc,e)&&Bc[e],i=null;return r&&(i=r.curve||r[t||"vertical"],r.tension&&null!=n&&(i=i[r.tension](n))),i}var zc={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},Uc=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\.\d+)(\.\d)/g,/(\d)([-+])/g,/\s|,|###/];function Wc(e){var t,n,r,i,a,o,s,u,c,l,f=[],d=e.slice().replace(Uc[0],"###$1").split(Uc[1]).slice(1);for(s=0,c=d.length;s<c;++s){for(n=(t=d[s]).slice(1).trim().replace(Uc[2],"$1###$2").replace(Uc[3],"$1###$2").split(Uc[4]),r=[a=t.charAt(0)],u=0,l=n.length;u<l;++u)(i=+n[u])===i&&r.push(i);if(o=zc[a.toLowerCase()],r.length-1>o){var h=r.length;for(u=1,f.push([a].concat(r.slice(u,u+=o))),a="M"===a?"L":"m"===a?"l":a;u<h;u+=o)f.push([a].concat(r.slice(u,u+o)))}else f.push(r)}return f}var Vc=Math.PI/180,Gc=1e-14,qc=Math.PI/2,Hc=2*Math.PI,Xc=Math.sqrt(3)/2,Kc={},Yc={},$c=[].join;function Jc(e){var t=$c.call(e);if(Yc[t])return Yc[t];var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],c=e[7],l=c*o,f=-u*s,d=u*o,h=c*s,p=Math.cos(i),m=Math.sin(i),v=Math.cos(a),g=Math.sin(a),y=.5*(a-i),b=Math.sin(.5*y),x=8/3*b*b/Math.sin(y),w=n+p-x*m,_=r+m+x*p,k=n+v,E=r+g,S=k+x*g,C=E-x*v;return Yc[t]=[l*w+f*_,d*w+h*_,l*S+f*C,d*S+h*C,l*k+f*E,d*k+h*E]}var Zc=["l",0,0,0,0,0,0,0];function Qc(e,t,n){var r=Zc[0]=e[0];if("a"===r||"A"===r)Zc[1]=t*e[1],Zc[2]=n*e[2],Zc[3]=e[3],Zc[4]=e[4],Zc[5]=e[5],Zc[6]=t*e[6],Zc[7]=n*e[7];else if("h"===r||"H"===r)Zc[1]=t*e[1];else if("v"===r||"V"===r)Zc[1]=n*e[1];else for(var i=1,a=e.length;i<a;++i)Zc[i]=(i%2==1?t:n)*e[i];return Zc}function el(e,t,n,r,i,a){var o,s,u,c,l,f=null,d=0,h=0,p=0,m=0;null==n&&(n=0),null==r&&(r=0),null==i&&(i=1),null==a&&(a=i),e.beginPath&&e.beginPath();for(var v=0,g=t.length;v<g;++v){switch(o=t[v],1===i&&1===a||(o=Qc(o,i,a)),o[0]){case"l":d+=o[1],h+=o[2],e.lineTo(d+n,h+r);break;case"L":d=o[1],h=o[2],e.lineTo(d+n,h+r);break;case"h":d+=o[1],e.lineTo(d+n,h+r);break;case"H":d=o[1],e.lineTo(d+n,h+r);break;case"v":h+=o[1],e.lineTo(d+n,h+r);break;case"V":h=o[1],e.lineTo(d+n,h+r);break;case"m":d+=o[1],h+=o[2],e.moveTo(d+n,h+r);break;case"M":d=o[1],h=o[2],e.moveTo(d+n,h+r);break;case"c":s=d+o[5],u=h+o[6],p=d+o[3],m=h+o[4],e.bezierCurveTo(d+o[1]+n,h+o[2]+r,p+n,m+r,s+n,u+r),d=s,h=u;break;case"C":d=o[5],h=o[6],p=o[3],m=o[4],e.bezierCurveTo(o[1]+n,o[2]+r,p+n,m+r,d+n,h+r);break;case"s":s=d+o[3],u=h+o[4],p=2*d-p,m=2*h-m,e.bezierCurveTo(p+n,m+r,d+o[1]+n,h+o[2]+r,s+n,u+r),p=d+o[1],m=h+o[2],d=s,h=u;break;case"S":s=o[3],u=o[4],p=2*d-p,m=2*h-m,e.bezierCurveTo(p+n,m+r,o[1]+n,o[2]+r,s+n,u+r),d=s,h=u,p=o[1],m=o[2];break;case"q":s=d+o[3],u=h+o[4],p=d+o[1],m=h+o[2],e.quadraticCurveTo(p+n,m+r,s+n,u+r),d=s,h=u;break;case"Q":s=o[3],u=o[4],e.quadraticCurveTo(o[1]+n,o[2]+r,s+n,u+r),d=s,h=u,p=o[1],m=o[2];break;case"t":s=d+o[1],u=h+o[2],null===f[0].match(/[QqTt]/)?(p=d,m=h):"t"===f[0]?(p=2*d-c,m=2*h-l):"q"===f[0]&&(p=2*d-p,m=2*h-m),c=p,l=m,e.quadraticCurveTo(p+n,m+r,s+n,u+r),h=u,p=(d=s)+o[1],m=h+o[2];break;case"T":s=o[1],u=o[2],p=2*d-p,m=2*h-m,e.quadraticCurveTo(p+n,m+r,s+n,u+r),d=s,h=u;break;case"a":tl(e,d+n,h+r,[o[1],o[2],o[3],o[4],o[5],o[6]+d+n,o[7]+h+r]),d+=o[6],h+=o[7];break;case"A":tl(e,d+n,h+r,[o[1],o[2],o[3],o[4],o[5],o[6]+n,o[7]+r]),d=o[6],h=o[7];break;case"z":case"Z":e.closePath()}f=o}}function tl(e,t,n,r){for(var i=function(e,t,n,r,i,a,o,s,u){var c=$c.call(arguments);if(Kc[c])return Kc[c];var l=o*Vc,f=Math.sin(l),d=Math.cos(l),h=d*(s-e)*.5+f*(u-t)*.5,p=d*(u-t)*.5-f*(s-e)*.5,m=h*h/((n=Math.abs(n))*n)+p*p/((r=Math.abs(r))*r);m>1&&(n*=m=Math.sqrt(m),r*=m);var v=d/n,g=f/n,y=-f/r,b=d/r,x=v*s+g*u,w=y*s+b*u,_=v*e+g*t,k=y*e+b*t,E=1/((_-x)*(_-x)+(k-w)*(k-w))-.25;E<0&&(E=0);var S=Math.sqrt(E);a==i&&(S=-S);var C=.5*(x+_)-S*(k-w),A=.5*(w+k)+S*(_-x),O=Math.atan2(w-A,x-C),D=Math.atan2(k-A,_-C)-O;D<0&&1===a?D+=Hc:D>0&&0===a&&(D-=Hc);for(var T=Math.ceil(Math.abs(D/(qc+.001))),j=[],M=0;M<T;++M){var F=O+M*D/T,I=O+(M+1)*D/T;j[M]=[C,A,F,I,n,r,f,d]}return Kc[c]=j}(r[5],r[6],r[0],r[1],r[3],r[4],r[2],t,n),a=0;a<i.length;++a){var o=Jc(i[a]);e.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5])}}var nl={circle:{draw:function(e,t){var n=Math.sqrt(t)/2;e.moveTo(n,0),e.arc(0,0,n,0,Hc)}},cross:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/2.5;e.moveTo(-n,-r),e.lineTo(-n,r),e.lineTo(-r,r),e.lineTo(-r,n),e.lineTo(r,n),e.lineTo(r,r),e.lineTo(n,r),e.lineTo(n,-r),e.lineTo(r,-r),e.lineTo(r,-n),e.lineTo(-r,-n),e.lineTo(-r,-r),e.closePath()}},diamond:{draw:function(e,t){var n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(0,-n),e.lineTo(n,0),e.lineTo(0,n),e.closePath()}},square:{draw:function(e,t){var n=Math.sqrt(t),r=-n/2;e.rect(r,r,n,n)}},arrow:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/7,i=n/2.5,a=n/8;e.moveTo(-r,n),e.lineTo(r,n),e.lineTo(r,-a),e.lineTo(i,-a),e.lineTo(0,-n),e.lineTo(-i,-a),e.lineTo(-r,-a),e.closePath()}},wedge:{draw:function(e,t){var n=Math.sqrt(t)/2,r=Xc*n,i=r-.5773502691896257*n,a=n/4;e.moveTo(0,-r-i),e.lineTo(-a,r-i),e.lineTo(a,r-i),e.closePath()}},triangle:{draw:function(e,t){var n=Math.sqrt(t)/2,r=Xc*n,i=r-.5773502691896257*n;e.moveTo(0,-r-i),e.lineTo(-n,r-i),e.lineTo(n,r-i),e.closePath()}},"triangle-up":{draw:function(e,t){var n=Math.sqrt(t)/2,r=Xc*n;e.moveTo(0,-r),e.lineTo(-n,r),e.lineTo(n,r),e.closePath()}},"triangle-down":{draw:function(e,t){var n=Math.sqrt(t)/2,r=Xc*n;e.moveTo(0,r),e.lineTo(-n,-r),e.lineTo(n,-r),e.closePath()}},"triangle-right":{draw:function(e,t){var n=Math.sqrt(t)/2,r=Xc*n;e.moveTo(r,0),e.lineTo(-r,-n),e.lineTo(-r,n),e.closePath()}},"triangle-left":{draw:function(e,t){var n=Math.sqrt(t)/2,r=Xc*n;e.moveTo(-r,0),e.lineTo(r,-n),e.lineTo(r,n),e.closePath()}},stroke:{draw:function(e,t){var n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(n,0)}}};function rl(e){return Object(ye.w)(nl,e)?nl[e]:function(e){if(!Object(ye.w)(il,e)){var t=Wc(e);il[e]={draw:function(e,n){el(e,t,0,0,Math.sqrt(n)/2)}}}return il[e]}(e)}var il={},al=.448084975506;function ol(e){return e.x}function sl(e){return e.y}function ul(e){return e.width}function cl(e){return e.height}function ll(e){return"function"==typeof e?e:function(){return+e}}function fl(e,t,n){return Math.max(t,Math.min(e,n))}function dl(){var e=ol,t=sl,n=ul,r=cl,i=ll(0),a=i,o=i,s=i,u=null;function c(c,l,f){var d,h=null!=l?l:+e.call(this,c),p=null!=f?f:+t.call(this,c),m=+n.call(this,c),v=+r.call(this,c),g=Math.min(m,v)/2,y=fl(+i.call(this,c),0,g),b=fl(+a.call(this,c),0,g),x=fl(+o.call(this,c),0,g),w=fl(+s.call(this,c),0,g);if(u||(u=d=Ui()),y<=0&&b<=0&&x<=0&&w<=0)u.rect(h,p,m,v);else{var _=h+m,k=p+v;u.moveTo(h+y,p),u.lineTo(_-b,p),u.bezierCurveTo(_-al*b,p,_,p+al*b,_,p+b),u.lineTo(_,k-w),u.bezierCurveTo(_,k-al*w,_-al*w,k,_-w,k),u.lineTo(h+x,k),u.bezierCurveTo(h+al*x,k,h,k-al*x,h,k-x),u.lineTo(h,p+y),u.bezierCurveTo(h,p+al*y,h+al*y,p,h+y,p),u.closePath()}if(d)return u=null,d+""||null}return c.x=function(t){return arguments.length?(e=ll(t),c):e},c.y=function(e){return arguments.length?(t=ll(e),c):t},c.width=function(e){return arguments.length?(n=ll(e),c):n},c.height=function(e){return arguments.length?(r=ll(e),c):r},c.cornerRadius=function(e,t,n,r){return arguments.length?(i=ll(e),a=null!=t?ll(t):i,s=null!=n?ll(n):i,o=null!=r?ll(r):a,c):i},c.context=function(e){return arguments.length?(u=null==e?null:e,c):u},c}function hl(){var e,t,n,r,i,a,o,s,u=null;function c(e,t,n){var r=n/2;if(i){var c=o-t,l=e-a;if(c||l){var f=Math.sqrt(c*c+l*l),d=(c/=f)*s,h=(l/=f)*s,p=Math.atan2(l,c);u.moveTo(a-d,o-h),u.lineTo(e-c*r,t-l*r),u.arc(e,t,r,p-Math.PI,p),u.lineTo(a+d,o+h),u.arc(a,o,s,p,p+Math.PI)}else u.arc(e,t,r,0,Hc);u.closePath()}else i=1;a=e,o=t,s=r}function l(a){var o,s,l,f=a.length,d=!1;for(null==u&&(u=l=Ui()),o=0;o<=f;++o)!(o<f&&r(s=a[o],o,a))===d&&(d=!d)&&(i=0),d&&c(+e(s,o,a),+t(s,o,a),+n(s,o,a));if(l)return u=null,l+""||null}return l.x=function(t){return arguments.length?(e=t,l):e},l.y=function(e){return arguments.length?(t=e,l):t},l.size=function(e){return arguments.length?(n=e,l):n},l.defined=function(e){return arguments.length?(r=e,l):r},l.context=function(e){return arguments.length?(u=null==e?null:e,l):u},l}function pl(e,t){return null!=e?e:t}var ml=function(e){return e.x||0},vl=function(e){return e.y||0},gl=function(e){return!(!1===e.defined)},yl=function(){var e=Vi,t=Gi,n=Wi(0),r=null,i=qi,a=Hi,o=Xi,s=null;function u(){var u,c,l=+e.apply(this,arguments),f=+t.apply(this,arguments),d=i.apply(this,arguments)-hi,h=a.apply(this,arguments)-hi,p=ii(h-d),m=h>d;if(s||(s=u=Ui()),f<l&&(c=f,f=l,l=c),f>fi)if(p>pi-fi)s.moveTo(f*oi(d),f*ci(d)),s.arc(0,0,f,d,h,!m),l>fi&&(s.moveTo(l*oi(h),l*ci(h)),s.arc(0,0,l,h,d,m));else{var v,g,y=d,b=h,x=d,w=h,_=p,k=p,E=o.apply(this,arguments)/2,S=E>fi&&(r?+r.apply(this,arguments):li(l*l+f*f)),C=ui(ii(f-l)/2,+n.apply(this,arguments)),A=C,O=C;if(S>fi){var D=mi(S/l*ci(E)),T=mi(S/f*ci(E));(_-=2*D)>fi?(x+=D*=m?1:-1,w-=D):(_=0,x=w=(d+h)/2),(k-=2*T)>fi?(y+=T*=m?1:-1,b-=T):(k=0,y=b=(d+h)/2)}var j=f*oi(y),M=f*ci(y),F=l*oi(w),I=l*ci(w);if(C>fi){var N,R=f*oi(b),P=f*ci(b),B=l*oi(x),L=l*ci(x);if(p<di&&(N=function(e,t,n,r,i,a,o,s){var u=n-e,c=r-t,l=o-i,f=s-a,d=f*u-l*c;if(!(d*d<fi))return[e+(d=(l*(t-a)-f*(e-i))/d)*u,t+d*c]}(j,M,B,L,R,P,F,I))){var z=j-N[0],U=M-N[1],W=R-N[0],V=P-N[1],G=1/ci(function(e){return e>1?0:e<-1?di:Math.acos(e)}((z*W+U*V)/(li(z*z+U*U)*li(W*W+V*V)))/2),q=li(N[0]*N[0]+N[1]*N[1]);A=ui(C,(l-q)/(G-1)),O=ui(C,(f-q)/(G+1))}}k>fi?O>fi?(v=Ki(B,L,j,M,f,O,m),g=Ki(R,P,F,I,f,O,m),s.moveTo(v.cx+v.x01,v.cy+v.y01),O<C?s.arc(v.cx,v.cy,O,ai(v.y01,v.x01),ai(g.y01,g.x01),!m):(s.arc(v.cx,v.cy,O,ai(v.y01,v.x01),ai(v.y11,v.x11),!m),s.arc(0,0,f,ai(v.cy+v.y11,v.cx+v.x11),ai(g.cy+g.y11,g.cx+g.x11),!m),s.arc(g.cx,g.cy,O,ai(g.y11,g.x11),ai(g.y01,g.x01),!m))):(s.moveTo(j,M),s.arc(0,0,f,y,b,!m)):s.moveTo(j,M),l>fi&&_>fi?A>fi?(v=Ki(F,I,R,P,l,-A,m),g=Ki(j,M,B,L,l,-A,m),s.lineTo(v.cx+v.x01,v.cy+v.y01),A<C?s.arc(v.cx,v.cy,A,ai(v.y01,v.x01),ai(g.y01,g.x01),!m):(s.arc(v.cx,v.cy,A,ai(v.y01,v.x01),ai(v.y11,v.x11),!m),s.arc(0,0,l,ai(v.cy+v.y11,v.cx+v.x11),ai(g.cy+g.y11,g.cx+g.x11),m),s.arc(g.cx,g.cy,A,ai(g.y11,g.x11),ai(g.y01,g.x01),!m))):s.arc(0,0,l,w,x,m):s.lineTo(F,I)}else s.moveTo(0,0);if(s.closePath(),u)return s=null,u+""||null}return u.centroid=function(){var n=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,r=(+i.apply(this,arguments)+ +a.apply(this,arguments))/2-di/2;return[oi(r)*n,ci(r)*n]},u.innerRadius=function(t){return arguments.length?(e="function"==typeof t?t:Wi(+t),u):e},u.outerRadius=function(e){return arguments.length?(t="function"==typeof e?e:Wi(+e),u):t},u.cornerRadius=function(e){return arguments.length?(n="function"==typeof e?e:Wi(+e),u):n},u.padRadius=function(e){return arguments.length?(r=null==e?null:"function"==typeof e?e:Wi(+e),u):r},u.startAngle=function(e){return arguments.length?(i="function"==typeof e?e:Wi(+e),u):i},u.endAngle=function(e){return arguments.length?(a="function"==typeof e?e:Wi(+e),u):a},u.padAngle=function(e){return arguments.length?(o="function"==typeof e?e:Wi(+e),u):o},u.context=function(e){return arguments.length?(s=null==e?null:e,u):s},u}().startAngle((function(e){return e.startAngle||0})).endAngle((function(e){return e.endAngle||0})).padAngle((function(e){return e.padAngle||0})).innerRadius((function(e){return e.innerRadius||0})).outerRadius((function(e){return e.outerRadius||0})).cornerRadius((function(e){return e.cornerRadius||0})),bl=Qi().x(ml).y1(vl).y0((function(e){return(e.y||0)+(e.height||0)})).defined(gl),xl=Qi().y(vl).x1(ml).x0((function(e){return(e.x||0)+(e.width||0)})).defined(gl),wl=Zi().x(ml).y(vl).defined(gl),_l=dl().x(ml).y(vl).width((function(e){return e.width||0})).height((function(e){return e.height||0})).cornerRadius((function(e){return pl(e.cornerRadiusTopLeft,e.cornerRadius)||0}),(function(e){return pl(e.cornerRadiusTopRight,e.cornerRadius)||0}),(function(e){return pl(e.cornerRadiusBottomRight,e.cornerRadius)||0}),(function(e){return pl(e.cornerRadiusBottomLeft,e.cornerRadius)||0})),kl=function(e,t){var n=null;function r(){var r;if(n||(n=r=Ui()),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),r)return n=null,r+""||null}return e="function"==typeof e?e:Wi(e||ea),t="function"==typeof t?t:Wi(void 0===t?64:+t),r.type=function(t){return arguments.length?(e="function"==typeof t?t:Wi(t),r):e},r.size=function(e){return arguments.length?(t="function"==typeof e?e:Wi(+e),r):t},r.context=function(e){return arguments.length?(n=null==e?null:e,r):n},r}().type((function(e){return rl(e.shape||"circle")})).size((function(e){return pl(e.size,64)})),El=hl().x(ml).y(vl).defined(gl).size((function(e){return e.size||1}));function Sl(e){return e.cornerRadius||e.cornerRadiusTopLeft||e.cornerRadiusTopRight||e.cornerRadiusBottomRight||e.cornerRadiusBottomLeft}function Cl(e,t,n,r){return _l.context(e)(t,n,r)}var Al=1;function Ol(){Al=1}function Dl(e,t,n){var r=t.clip,i=e._defs,a=t.clip_id||(t.clip_id="clip"+Al++),o=i.clipping[a]||(i.clipping[a]={id:a});return Object(ye.E)(r)?o.path=r(null):Sl(n)?o.path=Cl(null,n,0,0):(o.width=n.width||0,o.height=n.height||0),"url(#"+a+")"}function Tl(e){this.clear(),e&&this.union(e)}function jl(e){this.mark=e,this.bounds=this.bounds||new Tl}function Ml(e){jl.call(this,e),this.items=this.items||[]}function Fl(e){this._pending=0,this._loader=e||Object(be.e)()}function Il(e){e._pending+=1}function Nl(e){e._pending-=1}function Rl(e,t,n){if(t.stroke&&0!==t.opacity&&0!==t.strokeOpacity){var r=null!=t.strokeWidth?+t.strokeWidth:1;e.expand(r+(n?function(e,t){return e.strokeJoin&&"miter"!==e.strokeJoin?0:t}(t,r):0))}return e}Tl.prototype={clone:function(){return new Tl(this)},clear:function(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},empty:function(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals:function(e){return this.x1===e.x1&&this.y1===e.y1&&this.x2===e.x2&&this.y2===e.y2},set:function(e,t,n,r){return n<e?(this.x2=e,this.x1=n):(this.x1=e,this.x2=n),r<t?(this.y2=t,this.y1=r):(this.y1=t,this.y2=r),this},add:function(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},expand:function(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},round:function(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},scale:function(e){return this.x1*=e,this.y1*=e,this.x2*=e,this.y2*=e,this},translate:function(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},rotate:function(e,t,n){var r=this.rotatedPoints(e,t,n);return this.clear().add(r[0],r[1]).add(r[2],r[3]).add(r[4],r[5]).add(r[6],r[7])},rotatedPoints:function(e,t,n){var r=this.x1,i=this.y1,a=this.x2,o=this.y2,s=Math.cos(e),u=Math.sin(e),c=t-t*s+n*u,l=n-t*u-n*s;return[s*r-u*i+c,u*r+s*i+l,s*r-u*o+c,u*r+s*o+l,s*a-u*i+c,u*a+s*i+l,s*a-u*o+c,u*a+s*o+l]},union:function(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},intersect:function(e){return e.x1>this.x1&&(this.x1=e.x1),e.y1>this.y1&&(this.y1=e.y1),e.x2<this.x2&&(this.x2=e.x2),e.y2<this.y2&&(this.y2=e.y2),this},encloses:function(e){return e&&this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2},alignsWith:function(e){return e&&(this.x1==e.x1||this.x2==e.x2||this.y1==e.y1||this.y2==e.y2)},intersects:function(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},contains:function(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},width:function(){return this.x2-this.x1},height:function(){return this.y2-this.y1}},Object(ye.z)(Ml,jl),Fl.prototype={pending:function(){return this._pending},sanitizeURL:function(e){var t=this;return Il(t),t._loader.sanitize(e,{context:"href"}).then((function(e){return Nl(t),e})).catch((function(){return Nl(t),null}))},loadImage:function(e){var t=this,n=na();return Il(t),t._loader.sanitize(e,{context:"image"}).then((function(e){var r=e.href;if(!r||!n)throw{url:r};var i=new n,a=Object(ye.w)(e,"crossOrigin")?e.crossOrigin:"anonymous";return null!=a&&(i.crossOrigin=a),i.onload=function(){return Nl(t)},i.onerror=function(){return Nl(t)},i.src=r,i})).catch((function(e){return Nl(t),{complete:!1,width:0,height:0,src:e&&e.url||""}}))},ready:function(){var e=this;return new Promise((function(t){!function n(r){e.pending()?setTimeout((function(){n(!0)}),10):t(r)}(!1)}))}};var Pl,Bl,Ll,zl,Ul,Wl,Vl,Gl,ql=Hc-1e-8,Hl=function(e,t){return Pl.add(e,t)},Xl=function(e,t){return Hl(Bl=e,Ll=t)},Kl=function(e){return Hl(e,Pl.y1)},Yl=function(e){return Hl(Pl.x1,e)},$l=function(e,t){return Ul*e+Vl*t},Jl=function(e,t){return Wl*e+Gl*t},Zl=function(e,t){return Hl($l(e,t),Jl(e,t))},Ql=function(e,t){return Xl($l(e,t),Jl(e,t))};function ef(e,t){return Pl=e,t?(zl=t*Vc,Ul=Gl=Math.cos(zl),Wl=Math.sin(zl),Vl=-Wl):(Ul=Gl=1,zl=Wl=Vl=0),tf}var tf={beginPath:function(){},closePath:function(){},moveTo:Ql,lineTo:Ql,rect:function(e,t,n,r){zl?(Zl(e+n,t),Zl(e+n,t+r),Zl(e,t+r),Ql(e,t)):(Hl(e+n,t+r),Xl(e,t))},quadraticCurveTo:function(e,t,n,r){var i=$l(e,t),a=Jl(e,t),o=$l(n,r),s=Jl(n,r);nf(Bl,i,o,Kl),nf(Ll,a,s,Yl),Xl(o,s)},bezierCurveTo:function(e,t,n,r,i,a){var o=$l(e,t),s=Jl(e,t),u=$l(n,r),c=Jl(n,r),l=$l(i,a),f=Jl(i,a);rf(Bl,o,u,l,Kl),rf(Ll,s,c,f,Yl),Xl(l,f)},arc:function(e,t,n,r,i,a){if(r+=zl,i+=zl,Bl=n*Math.cos(i)+e,Ll=n*Math.sin(i)+t,Math.abs(i-r)>ql)Hl(e-n,t-n),Hl(e+n,t+n);else{var o,s,u=function(r){return Hl(n*Math.cos(r)+e,n*Math.sin(r)+t)};if(u(r),u(i),i!==r)if((r%=Hc)<0&&(r+=Hc),(i%=Hc)<0&&(i+=Hc),i<r&&(a=!a,o=r,r=i,i=o),a)for(i-=Hc,o=r-r%qc,s=0;s<4&&o>i;++s,o-=qc)u(o);else for(o=r-r%qc+qc,s=0;s<4&&o<i;++s,o+=qc)u(o)}}};function nf(e,t,n,r){var i=(e-t)/(e+n-2*t);0<i&&i<1&&r(e+(t-e)*i)}function rf(e,t,n,r,i){var a,o=r-e+3*t-3*n,s=e+n-2*t,u=e-t,c=0,l=0;Math.abs(o)>Gc?(a=s*s+u*o)>=0&&(c=(-s+(a=Math.sqrt(a)))/o,l=(-s-a)/o):c=.5*u/s,0<c&&c<1&&i(af(c,e,t,n,r)),0<l&&l<1&&i(af(l,e,t,n,r))}function af(e,t,n,r,i){var a=1-e,o=a*a,s=e*e;return o*a*t+3*o*e*n+3*a*s*r+s*e*i}var of=(of=ta(1,1))?of.getContext("2d"):null,sf=new Tl;function uf(e){return function(t,n){if(!of)return!0;e(of,t),sf.clear().union(t.bounds).intersect(n).round();for(var r=sf.x1,i=sf.y1,a=sf.x2,o=sf.y2,s=i;s<=o;++s)for(var u=r;u<=a;++u)if(of.isPointInPath(u,s))return!0;return!1}}function cf(e,t){return t.contains(e.x||0,e.y||0)}function lf(e,t){var n=e.x||0,r=e.y||0,i=e.width||0,a=e.height||0;return t.intersects(sf.set(n,r,n+i,r+a))}function ff(e,t){var n=e.x||0,r=e.y||0;return df(t,n,r,null!=e.x2?e.x2:n,null!=e.y2?e.y2:r)}function df(e,t,n,r,i){var a,o,s,u,c=e.x1,l=e.y1,f=e.x2,d=e.y2,h=r-t,p=i-n,m=0,v=1;for(u=0;u<4;++u){if(0===u&&(a=-h,o=-(c-t)),1===u&&(a=h,o=f-t),2===u&&(a=-p,o=-(l-n)),3===u&&(a=p,o=d-n),Math.abs(a)<1e-10&&o<0)return!1;if(s=o/a,a<0){if(s>v)return!1;s>m&&(m=s)}else if(a>0){if(s<m)return!1;s<v&&(v=s)}}return!0}function hf(e,t){e.globalCompositeOperation=t.blend||"source-over"}function pf(e,t){return null==e?t:e}function mf(e,t){for(var n=t.length,r=0;r<n;++r)e.addColorStop(t[r].offset,t[r].color);return e}function vf(e,t,n){return Ic(n)?function(e,t,n){var r,i=n.width(),a=n.height();if("radial"===t.gradient)r=e.createRadialGradient(n.x1+pf(t.x1,.5)*i,n.y1+pf(t.y1,.5)*a,Math.max(i,a)*pf(t.r1,0),n.x1+pf(t.x2,.5)*i,n.y1+pf(t.y2,.5)*a,Math.max(i,a)*pf(t.r2,.5));else{var o=pf(t.x1,0),s=pf(t.y1,0),u=pf(t.x2,1),c=pf(t.y2,0);if(o!==u&&s!==c&&i!==a){var l=ta(Math.ceil(i),Math.ceil(a)),f=l.getContext("2d");return f.scale(i,a),f.fillStyle=mf(f.createLinearGradient(o,s,u,c),t.stops),f.fillRect(0,0,i,a),e.createPattern(l,"no-repeat")}r=e.createLinearGradient(n.x1+o*i,n.y1+s*a,n.x1+u*i,n.y1+c*a)}return mf(r,t.stops)}(e,n,t.bounds):n}function gf(e,t,n){return(n*=null==t.fillOpacity?1:t.fillOpacity)>0&&(e.globalAlpha=n,e.fillStyle=vf(e,t,t.fill),!0)}var yf=[];function bf(e,t,n){var r=null!=(r=t.strokeWidth)?r:1;return!(r<=0)&&(n*=null==t.strokeOpacity?1:t.strokeOpacity)>0&&(e.globalAlpha=n,e.strokeStyle=vf(e,t,t.stroke),e.lineWidth=r,e.lineCap=t.strokeCap||"butt",e.lineJoin=t.strokeJoin||"miter",e.miterLimit=t.strokeMiterLimit||10,e.setLineDash&&(e.setLineDash(t.strokeDash||yf),e.lineDashOffset=t.strokeDashOffset||0),!0)}function xf(e,t){return e.zindex-t.zindex||e.index-t.index}function wf(e){if(!e.zdirty)return e.zitems;var t,n,r,i=e.items,a=[];for(n=0,r=i.length;n<r;++n)(t=i[n]).index=n,t.zindex&&a.push(t);return e.zdirty=!1,e.zitems=a.sort(xf)}function _f(e,t){var n,r,i=e.items;if(i&&i.length){var a=wf(e);if(a&&a.length){for(n=0,r=i.length;n<r;++n)i[n].zindex||t(i[n]);i=a}for(n=0,r=i.length;n<r;++n)t(i[n])}}function kf(e,t){var n,r,i=e.items;if(!i||!i.length)return null;var a=wf(e);for(a&&a.length&&(i=a),r=i.length;--r>=0;)if(n=t(i[r]))return n;if(i===a)for(r=(i=e.items).length;--r>=0;)if(!i[r].zindex&&(n=t(i[r])))return n;return null}function Ef(e){return function(t,n,r){_f(n,(function(n){r&&!r.intersects(n.bounds)||Sf(e,t,n,n)}))}}function Sf(e,t,n,r){var i=null==n.opacity?1:n.opacity;0!==i&&(e(t,r)||(hf(t,n),n.fill&&gf(t,n,i)&&t.fill(),n.stroke&&bf(t,n,i)&&t.stroke()))}function Cf(e){return e=e||ye.Ia,function(t,n,r,i,a,o){return r*=t.pixelRatio,i*=t.pixelRatio,kf(n,(function(n){var s=n.bounds;if((!s||s.contains(a,o))&&s)return e(t,n,r,i,a,o)?n:void 0}))}}function Af(e,t){return function(n,r,i,a){var o,s,u=Array.isArray(r)?r[0]:r,c=null==t?u.fill:t,l=u.stroke&&n.isPointInStroke;return l&&(o=u.strokeWidth,s=u.strokeCap,n.lineWidth=null!=o?o:1,n.lineCap=null!=s?s:"butt"),!e(n,r)&&(c&&n.isPointInPath(i,a)||l&&n.isPointInStroke(i,a))}}function Of(e){return Cf(Af(e))}function Df(e,t){return"translate("+e+","+t+")"}function Tf(e){return"rotate("+e+")"}function jf(e){return Df(e.x||0,e.y||0)}function Mf(e,t,n){function r(e,n){var r=n.x||0,i=n.y||0,a=n.angle||0;e.translate(r,i),a&&e.rotate(a*=Vc),e.beginPath(),t(e,n),a&&e.rotate(-a),e.translate(-r,-i)}return{type:e,tag:"path",nested:!1,attr:function(e,n){e("transform",function(e){return Df(e.x||0,e.y||0)+(e.angle?" "+Tf(e.angle):"")}(n)),e("d",t(null,n))},bound:function(e,n){return t(ef(e,n.angle),n),Rl(e,n).translate(n.x||0,n.y||0)},draw:Ef(r),pick:Of(r),isect:n||uf(r)}}var Ff=Mf("arc",(function(e,t){return yl.context(e)(t)}));function If(e,t,n){function r(e,n){e.beginPath(),t(e,n)}var i=Af(r);return{type:e,tag:"path",nested:!0,attr:function(e,n){var r=n.mark.items;r.length&&e("d",t(null,r))},bound:function(e,n){var r=n.items;return 0===r.length?e:(t(ef(e),r),Rl(e,r[0]))},draw:function(e){return function(t,n,r){!n.items.length||r&&!r.intersects(n.bounds)||Sf(e,t,n.items[0],n.items)}}(r),pick:function(e,t,n,r,a,o){var s=t.items,u=t.bounds;return!s||!s.length||u&&!u.contains(a,o)?null:(n*=e.pixelRatio,r*=e.pixelRatio,i(e,s,n,r)?s[0]:null)},isect:cf,tip:n}}var Nf=If("area",(function(e,t){var n=t[0],r=n.interpolate||"linear";return("horizontal"===n.orient?xl:bl).curve(Lc(r,n.orient,n.tension)).context(e)(t)}),(function(e,t){for(var n,r,i="horizontal"===e[0].orient?t[1]:t[0],a="horizontal"===e[0].orient?"y":"x",o=e.length,s=1/0;--o>=0;)!1!==e[o].defined&&(r=Math.abs(e[o][a]-i))<s&&(s=r,n=e[o]);return n}));function Rf(e,t){e.beginPath(),Sl(t)?Cl(e,t,0,0):e.rect(0,0,t.width||0,t.height||0),e.clip()}function Pf(e){var t=pf(e.strokeWidth,1);return null!=e.strokeOffset?e.strokeOffset:e.stroke&&t>.5&&t<1.5?.5-Math.abs(t-1):0}function Bf(e,t){var n=Pf(t);e("d",Cl(null,t,n,n))}function Lf(e,t,n,r){var i=Pf(t);e.beginPath(),Cl(e,t,(n||0)+i,(r||0)+i)}var zf=Af(Lf),Uf=Af(Lf,!1),Wf=Af(Lf,!0),Vf={type:"group",tag:"g",nested:!1,attr:function(e,t){e("transform",jf(t))},bound:function(e,t){if(!t.clip&&t.items)for(var n=t.items,r=n.length,i=0;i<r;++i)e.union(n[i].bounds);return(t.clip||t.width||t.height)&&!t.noBound&&e.add(0,0).add(t.width||0,t.height||0),Rl(e,t),e.translate(t.x||0,t.y||0)},draw:function(e,t,n){var r=this;_f(t,(function(t){var i=t.x||0,a=t.y||0,o=t.strokeForeground,s=null==t.opacity?1:t.opacity;(t.stroke||t.fill)&&s&&(Lf(e,t,i,a),hf(e,t),t.fill&&gf(e,t,s)&&e.fill(),t.stroke&&!o&&bf(e,t,s)&&e.stroke()),e.save(),e.translate(i,a),t.clip&&Rf(e,t),n&&n.translate(-i,-a),_f(t,(function(t){r.draw(e,t,n)})),n&&n.translate(i,a),e.restore(),o&&t.stroke&&s&&(Lf(e,t,i,a),hf(e,t),bf(e,t,s)&&e.stroke())}))},pick:function(e,t,n,r,i,a){var o=this;if(t.bounds&&!t.bounds.contains(i,a)||!t.items)return null;var s=n*e.pixelRatio,u=r*e.pixelRatio;return kf(t,(function(c){var l,f,d,h=c.bounds;if(!h||h.contains(i,a)){f=c.x||0,d=c.y||0;var p=f+(c.width||0),m=d+(c.height||0),v=c.clip;if(!v||!(i<f||i>p||a<d||a>m)){if(e.save(),e.translate(f,d),f=i-f,d=a-d,v&&Sl(c)&&!Wf(e,c,s,u))return e.restore(),null;var g=c.strokeForeground,y=!1!==t.interactive;return y&&g&&c.stroke&&Uf(e,c,s,u)?(e.restore(),c):(!(l=kf(c,(function(e){return function(e,t,n){return(!1!==e.interactive||"group"===e.marktype)&&e.bounds&&e.bounds.contains(t,n)}(e,f,d)?o.pick(e,n,r,f,d):null})))&&y&&(c.fill||!g&&c.stroke)&&zf(e,c,s,u)&&(l=c),e.restore(),l||null)}}}))},isect:lf,content:function(e,t,n){e("clip-path",t.clip?Dl(n,t,t):null)},background:function(e,t){e("class","background"),e("aria-hidden",!0),Bf(e,t)},foreground:function(e,t){e("class","foreground"),e("aria-hidden",!0),t.strokeForeground?Bf(e,t):e("d","")}},Gf={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function qf(e,t){var n=e.image;return(!n||e.url&&e.url!==n.url)&&(n={complete:!1,width:0,height:0},t.loadImage(e.url).then((function(t){e.image=t,e.image.url=e.url}))),n}function Hf(e,t){return null!=e.width?e.width:t&&t.width?!1!==e.aspect&&e.height?e.height*t.width/t.height:t.width:0}function Xf(e,t){return null!=e.height?e.height:t&&t.height?!1!==e.aspect&&e.width?e.width*t.height/t.width:t.height:0}function Kf(e,t){return"center"===e?t/2:"right"===e?t:0}function Yf(e,t){return"middle"===e?t/2:"bottom"===e?t:0}var $f={type:"image",tag:"image",nested:!1,attr:function(e,t,n){var r=qf(t,n),i=Hf(t,r),a=Xf(t,r),o=(t.x||0)-Kf(t.align,i),s=(t.y||0)-Yf(t.baseline,a);e("href",!r.src&&r.toDataURL?r.toDataURL():r.src||"",Gf["xmlns:xlink"],"xlink:href"),e("transform",Df(o,s)),e("width",i),e("height",a),e("preserveAspectRatio",!1===t.aspect?"none":"xMidYMid")},bound:function(e,t){var n=t.image,r=Hf(t,n),i=Xf(t,n),a=(t.x||0)-Kf(t.align,r),o=(t.y||0)-Yf(t.baseline,i);return e.set(a,o,a+r,o+i)},draw:function(e,t,n){var r=this;_f(t,(function(t){if(!n||n.intersects(t.bounds)){var i=qf(t,r),a=Hf(t,i),o=Xf(t,i);if(0!==a&&0!==o){var s,u,c,l,f=(t.x||0)-Kf(t.align,a),d=(t.y||0)-Yf(t.baseline,o);!1!==t.aspect&&(u=i.width/i.height,c=t.width/t.height,u==u&&c==c&&u!==c&&(c<u?(d+=(o-(l=a/u))/2,o=l):(f+=(a-(l=o*u))/2,a=l))),(i.complete||i.toDataURL)&&(hf(e,t),e.globalAlpha=null!=(s=t.opacity)?s:1,e.imageSmoothingEnabled=!1!==t.smooth,e.drawImage(i,f,d,a,o))}}}))},pick:Cf(),isect:ye.Ia,get:qf,xOffset:Kf,yOffset:Yf},Jf=If("line",(function(e,t){var n=t[0],r=n.interpolate||"linear";return wl.curve(Lc(r,n.orient,n.tension)).context(e)(t)}),(function(e,t){for(var n,r,i=Math.pow(e[0].strokeWidth||1,2),a=e.length;--a>=0;)if(!1!==e[a].defined&&(n=e[a].x-t[0])*n+(r=e[a].y-t[1])*r<i)return e[a];return null}));function Zf(e,t){var n=t.path;if(null==n)return!0;var r=t.x||0,i=t.y||0,a=t.scaleX||1,o=t.scaleY||1,s=(t.angle||0)*Vc,u=t.pathCache;u&&u.path===n||((t.pathCache=u=Wc(n)).path=n),s&&e.rotate&&e.translate?(e.translate(r,i),e.rotate(s),el(e,u,0,0,a,o),e.rotate(-s),e.translate(-r,-i)):el(e,u,r,i,a,o)}var Qf={type:"path",tag:"path",nested:!1,attr:function(e,t){var n=t.scaleX||1,r=t.scaleY||1;1===n&&1===r||e("vector-effect","non-scaling-stroke"),e("transform",function(e){return Df(e.x||0,e.y||0)+(e.angle?" "+Tf(e.angle):"")+(e.scaleX||e.scaleY?" "+function(e,t){return"scale("+e+","+t+")"}(e.scaleX||1,e.scaleY||1):"")}(t)),e("d",t.path)},bound:function(e,t){return Zf(ef(e,t.angle),t)?e.set(0,0,0,0):Rl(e,t,!0)},draw:Ef(Zf),pick:Of(Zf),isect:uf(Zf)};function ed(e,t){e.beginPath(),Cl(e,t)}var td={type:"rect",tag:"path",nested:!1,attr:function(e,t){e("d",Cl(null,t))},bound:function(e,t){var n,r;return Rl(e.set(n=t.x||0,r=t.y||0,n+t.width||0,r+t.height||0),t)},draw:Ef(ed),pick:Of(ed),isect:lf};function nd(e,t,n){var r,i,a,o;return!(!t.stroke||!bf(e,t,n))&&(r=t.x||0,i=t.y||0,a=null!=t.x2?t.x2:r,o=null!=t.y2?t.y2:i,e.beginPath(),e.moveTo(r,i),e.lineTo(a,o),!0)}var rd={type:"rule",tag:"line",nested:!1,attr:function(e,t){e("transform",jf(t)),e("x2",null!=t.x2?t.x2-(t.x||0):0),e("y2",null!=t.y2?t.y2-(t.y||0):0)},bound:function(e,t){var n,r;return Rl(e.set(n=t.x||0,r=t.y||0,null!=t.x2?t.x2:n,null!=t.y2?t.y2:r),t)},draw:function(e,t,n){_f(t,(function(t){if(!n||n.intersects(t.bounds)){var r=null==t.opacity?1:t.opacity;r&&nd(e,t,r)&&(hf(e,t),e.stroke())}}))},pick:Cf((function(e,t,n,r){return!!e.isPointInStroke&&nd(e,t,1)&&e.isPointInStroke(n,r)})),isect:ff},id=Mf("shape",(function(e,t){return(t.mark.shape||t.shape).context(e)(t)})),ad=Mf("symbol",(function(e,t){return kl.context(e)(t)}),cf),od=Object(ye.N)(),sd={height:hd,measureWidth:fd,estimateWidth:cd,width:cd,canvas:ud};function ud(e){sd.width=e&&of?fd:cd}function cd(e,t){return ld(gd(e,t),hd(e))}function ld(e,t){return~~(.8*e.length*t)}function fd(e,t){return hd(e)<=0||!(t=gd(e,t))?0:dd(t,bd(e))}function dd(e,t){var n="(".concat(t,") ").concat(e),r=od.get(n);return void 0===r&&(of.font=t,r=of.measureText(e).width,od.set(n,r)),r}function hd(e){return null!=e.fontSize?+e.fontSize||0:11}function pd(e){return null!=e.lineHeight?e.lineHeight:hd(e)+2}function md(e){return function(e){return Object(ye.B)(e)?e.length>1?e:e[0]:e}(e.lineBreak&&e.text&&!Object(ye.B)(e.text)?e.text.split(e.lineBreak):e.text)}function vd(e){var t=md(e);return(Object(ye.B)(t)?t.length-1:0)*pd(e)}function gd(e,t){var n=null==t?"":(t+"").trim();return e.limit>0&&n.length?function(e,t){var n=+e.limit,r=function(e){if(sd.width===fd){var t=bd(e);return function(e){return dd(e,t)}}var n=hd(e);return function(e){return ld(e,n)}}(e);if(r(t)<n)return t;var i,a=e.ellipsis||"\u2026",o="rtl"===e.dir,s=0,u=t.length;if(n-=r(a),o){for(;s<u;)i=s+u>>>1,r(t.slice(i))>n?s=i+1:u=i;return a+t.slice(s)}for(;s<u;)i=1+(s+u>>>1),r(t.slice(0,i))<n?s=i:u=i-1;return t.slice(0,s)+a}(e,n):n}function yd(e,t){var n=e.font;return(t&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function bd(e,t){return(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+hd(e)+"px "+yd(e,t)}function xd(e){var t=e.baseline,n=hd(e);return Math.round("top"===t?.79*n:"middle"===t?.3*n:"bottom"===t?-.21*n:"line-top"===t?.29*n+.5*pd(e):"line-bottom"===t?.29*n-.5*pd(e):0)}ud(!0);var wd={left:"start",center:"middle",right:"end"},_d=new Tl;function kd(e){var t,n=e.x||0,r=e.y||0,i=e.radius||0;return i&&(t=(e.theta||0)-qc,n+=i*Math.cos(t),r+=i*Math.sin(t)),_d.x1=n,_d.y1=r,_d}function Ed(e,t,n){var r,i=sd.height(t),a=t.align,o=kd(t),s=o.x1,u=o.y1,c=t.dx||0,l=(t.dy||0)+xd(t)-Math.round(.8*i),f=md(t);if(Object(ye.B)(f)?(i+=pd(t)*(f.length-1),r=f.reduce((function(e,n){return Math.max(e,sd.width(t,n))}),0)):r=sd.width(t,f),"center"===a?c-=r/2:"right"===a&&(c-=r),e.set(c+=s,l+=u,c+r,l+i),t.angle&&!n)e.rotate(t.angle*Vc,s,u);else if(2===n)return e.rotatedPoints(t.angle*Vc,s,u);return e}var Sd={arc:Ff,area:Nf,group:Vf,image:$f,line:Jf,path:Qf,rect:td,rule:rd,shape:id,symbol:ad,text:{type:"text",tag:"text",nested:!1,attr:function(e,t){var n,r=t.dx||0,i=(t.dy||0)+xd(t),a=kd(t),o=a.x1,s=a.y1,u=t.angle||0;e("text-anchor",wd[t.align]||"start"),u?(n=Df(o,s)+" "+Tf(u),(r||i)&&(n+=" "+Df(r,i))):n=Df(o+r,s+i),e("transform",n)},bound:Ed,draw:function(e,t,n){_f(t,(function(t){var r,i,a,o,s,u,c,l=null==t.opacity?1:t.opacity;if(!(n&&!n.intersects(t.bounds)||0===l||t.fontSize<=0||null==t.text||0===t.text.length)){if(e.font=bd(t),e.textAlign=t.align||"left",i=(r=kd(t)).x1,a=r.y1,t.angle&&(e.save(),e.translate(i,a),e.rotate(t.angle*Vc),i=a=0),i+=t.dx||0,a+=(t.dy||0)+xd(t),u=md(t),hf(e,t),Object(ye.B)(u))for(s=pd(t),o=0;o<u.length;++o)c=gd(t,u[o]),t.fill&&gf(e,t,l)&&e.fillText(c,i,a),t.stroke&&bf(e,t,l)&&e.strokeText(c,i,a),a+=s;else c=gd(t,u),t.fill&&gf(e,t,l)&&e.fillText(c,i,a),t.stroke&&bf(e,t,l)&&e.strokeText(c,i,a);t.angle&&e.restore()}}))},pick:Cf((function(e,t,n,r,i,a){if(t.fontSize<=0)return!1;if(!t.angle)return!0;var o=kd(t),s=o.x1,u=o.y1,c=Ed(_d,t,1),l=-t.angle*Vc,f=Math.cos(l),d=Math.sin(l),h=f*i-d*a+(s-f*s+d*u),p=d*i+f*a+(u-d*s-f*u);return c.contains(h,p)})),isect:function(e,t){var n=Ed(_d,e,2);return df(t,n[0],n[1],n[2],n[3])||df(t,n[0],n[1],n[4],n[5])||df(t,n[4],n[5],n[6],n[7])||df(t,n[2],n[3],n[6],n[7])}},trail:If("trail",(function(e,t){return El.context(e)(t)}),(function(e,t){for(var n,r,i=e.length;--i>=0;)if(!1!==e[i].defined&&(n=e[i].x-t[0])*n+(r=e[i].y-t[1])*r<(n=e[i].size||1)*n)return e[i];return null}))};function Cd(e,t,n){var r=Sd[e.mark.marktype],i=t||r.bound;return r.nested&&(e=e.mark),i(e.bounds||(e.bounds=new Tl),e,n)}var Ad={mark:null};function Od(e,t,n){var r,i,a,o,s=Sd[e.marktype],u=s.bound,c=e.items,l=c&&c.length;if(s.nested)return l?a=c[0]:(Ad.mark=e,a=Ad),o=Cd(a,u,n),t&&t.union(o)||o;if(t=t||e.bounds&&e.bounds.clear()||new Tl,l)for(r=0,i=c.length;r<i;++r)t.union(Cd(c[r],u,n));return e.bounds=t}var Dd=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function Td(e,t){return JSON.stringify(e,Dd,t)}function jd(e){return function e(t){var n,r,i,a=t.marktype,o=t.items;if(o)for(r=0,i=o.length;r<i;++r)n=a?"mark":"group",o[r][n]=t,o[r].zindex&&(o[r][n].zdirty=!0),"group"===(a||n)&&e(o[r]);return a&&Od(t),t}("string"==typeof e?JSON.parse(e):e)}function Md(e){arguments.length?this.root=jd(e):(this.root=Fd({marktype:"group",name:"root",role:"frame"}),this.root.items=[new Ml(this.root)])}function Fd(e,t){var n={bounds:new Tl,clip:!!e.clip,group:t,interactive:!1!==e.interactive,items:[],marktype:e.marktype,name:e.name||void 0,role:e.role||void 0,zindex:e.zindex||0};return null!=e.aria&&(n.aria=e.aria),e.description&&(n.description=e.description),n}function Id(e,t,n){return!e&&"undefined"!=typeof document&&document.createElement&&(e=document),e?n?e.createElementNS(n,t):e.createElement(t):null}function Nd(e,t){t=t.toLowerCase();for(var n=e.childNodes,r=0,i=n.length;r<i;++r)if(n[r].tagName.toLowerCase()===t)return n[r]}function Rd(e,t,n,r){var i,a=e.childNodes[t];return a&&a.tagName.toLowerCase()===n.toLowerCase()||(i=a||null,a=Id(e.ownerDocument,n,r),e.insertBefore(a,i)),a}function Pd(e,t){for(var n=e.childNodes,r=n.length;r>t;)e.removeChild(n[--r]);return e}function Bd(e){return"mark-"+e.marktype+(e.role?" role-"+e.role:"")+(e.name?" "+e.name:"")}function Ld(e,t){var n=t.getBoundingClientRect();return[e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0)]}function zd(e,t){this._active=null,this._handlers={},this._loader=e||Object(be.e)(),this._tooltip=t||Ud}function Ud(e,t,n,r){e.element().setAttribute("title",r||"")}function Wd(e){this._el=null,this._bgcolor=null,this._loader=new Fl(e)}Md.prototype={toJSON:function(e){return Td(this.root,e||0)},mark:function(e,t,n){var r=Fd(e,t=t||this.root.items[0]);return t.items[n]=r,r.zindex&&(r.group.zdirty=!0),r}},zd.prototype={initialize:function(e,t,n){return this._el=e,this._obj=n||null,this.origin(t)},element:function(){return this._el},canvas:function(){return this._el&&this._el.firstChild},origin:function(e){return arguments.length?(this._origin=e||[0,0],this):this._origin.slice()},scene:function(e){return arguments.length?(this._scene=e,this):this._scene},on:function(){},off:function(){},_handlerIndex:function(e,t,n){for(var r=e?e.length:0;--r>=0;)if(e[r].type===t&&(!n||e[r].handler===n))return r;return-1},handlers:function(e){var t=this._handlers,n=[];if(e)n.push.apply(n,h(t[this.eventName(e)]));else for(var r in t)n.push.apply(n,h(t[r]));return n},eventName:function(e){var t=e.indexOf(".");return t<0?e:e.slice(0,t)},handleHref:function(e,t,n){this._loader.sanitize(n,{context:"href"}).then((function(t){var n=new MouseEvent(e.type,e),r=Id(null,"a");for(var i in t)r.setAttribute(i,t[i]);r.dispatchEvent(n)})).catch((function(){}))},handleTooltip:function(e,t,n){if(t&&null!=t.tooltip){t=function(e,t,n,r){var i,a,o=e&&e.mark;if(o&&(i=Sd[o.marktype]).tip){for((a=Ld(t,n))[0]-=r[0],a[1]-=r[1];e=e.mark.group;)a[0]-=e.x||0,a[1]-=e.y||0;e=i.tip(o.items,a)}return e}(t,e,this.canvas(),this._origin);var r=n&&t&&t.tooltip||null;this._tooltip.call(this._obj,this,e,t,r)}},getItemBoundingClientRect:function(e){var t=this.canvas();if(t){for(var n=t.getBoundingClientRect(),r=this._origin,i=e.bounds,a=i.width(),o=i.height(),s=i.x1+r[0]+n.left,u=i.y1+r[1]+n.top;e.mark&&(e=e.mark.group);)s+=e.x||0,u+=e.y||0;return{x:s,y:u,width:a,height:o,left:s,top:u,right:s+a,bottom:u+o}}}},Wd.prototype={initialize:function(e,t,n,r,i){return this._el=e,this.resize(t,n,r,i)},element:function(){return this._el},canvas:function(){return this._el&&this._el.firstChild},background:function(e){return 0===arguments.length?this._bgcolor:(this._bgcolor=e,this)},resize:function(e,t,n,r){return this._width=e,this._height=t,this._origin=n||[0,0],this._scale=r||1,this},dirty:function(){},render:function(e){var t=this;return t._call=function(){t._render(e)},t._call(),t._call=null,t},_render:function(){},renderAsync:function(e){var t=this.render(e);return this._ready?this._ready.then((function(){return t})):Promise.resolve(t)},_load:function(e,t){var n=this,r=n._loader[e](t);if(!n._ready){var i=n._call;n._ready=n._loader.ready().then((function(e){e&&i(),n._ready=null}))}return r},sanitizeURL:function(e){return this._load("sanitizeURL",e)},loadImage:function(e){return this._load("loadImage",e)}};var Vd="dragleave",Gd="mousedown",qd="mousemove",Hd="mouseout",Xd="click",Kd=["keydown","keypress","keyup","dragenter",Vd,"dragover",Gd,"mouseup",qd,Hd,"mouseover",Xd,"dblclick","wheel","mousewheel","touchstart","touchmove","touchend"],Yd=qd,$d=Hd,Jd=Xd;function Zd(e,t){zd.call(this,e,t),this._down=null,this._touch=null,this._first=!0,this._events={}}var Qd=function(e){return"touchstart"===e||"touchmove"===e||"touchend"===e?["touchstart","touchmove","touchend"]:[e]};function eh(e,t){Qd(t).forEach((function(t){return function(e,t){var n=e.canvas();n&&!e._events[t]&&(e._events[t]=1,n.addEventListener(t,e[t]?function(n){return e[t](n)}:function(n){return e.fire(t,n)}))}(e,t)}))}function th(e,t,n){return function(r){var i=this._active,a=this.pickEvent(r);a===i||(i&&i.exit||this.fire(n,r),this._active=a,this.fire(t,r)),this.fire(e,r)}}function nh(e){return function(t){this.fire(e,t),this._active=null}}Object(ye.z)(Zd,zd,{initialize:function(e,t,n){var r=this;return this._canvas=e&&Nd(e,"canvas"),[Xd,Gd,qd,Hd,Vd].forEach((function(e){return eh(r,e)})),zd.prototype.initialize.call(this,e,t,n)},canvas:function(){return this._canvas},context:function(){return this._canvas.getContext("2d")},events:Kd,DOMMouseScroll:function(e){this.fire("mousewheel",e)},mousemove:th(qd,"mouseover",Hd),dragover:th("dragover","dragenter",Vd),mouseout:nh(Hd),dragleave:nh(Vd),mousedown:function(e){this._down=this._active,this.fire(Gd,e)},click:function(e){this._down===this._active&&(this.fire(Xd,e),this._down=null)},touchstart:function(e){this._touch=this.pickEvent(e.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire("touchstart",e,!0)},touchmove:function(e){this.fire("touchmove",e,!0)},touchend:function(e){this.fire("touchend",e,!0),this._touch=null},fire:function(e,t,n){var r=n?this._touch:this._active,i=this._handlers[e];if(t.vegaType=e,e===Jd&&r&&r.href?this.handleHref(t,r,r.href):e!==Yd&&e!==$d||this.handleTooltip(t,r,e!==$d),i)for(var a=0,o=i.length;a<o;++a)i[a].handler.call(this._obj,t,r)},on:function(e,t){var n=this.eventName(e),r=this._handlers;return this._handlerIndex(r[n],e,t)<0&&(eh(this,e),(r[n]||(r[n]=[])).push({type:e,handler:t})),this},off:function(e,t){var n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);return i>=0&&r.splice(i,1),this},pickEvent:function(e){var t=Ld(e,this._canvas),n=this._origin;return this.pick(this._scene,t[0],t[1],t[0]-n[0],t[1]-n[1])},pick:function(e,t,n,r,i){var a=this.context();return Sd[e.marktype].pick.call(this,a,e,t,n,r,i)}});var rh="undefined"!=typeof window&&window.devicePixelRatio||1;function ih(e){Wd.call(this,e),this._options={},this._redraw=!1,this._dirty=new Tl,this._tempb=new Tl}var ah=Wd.prototype;function oh(e,t){zd.call(this,e,t);var n=this;n._hrefHandler=sh(n,(function(e,t){t&&t.href&&n.handleHref(e,t,t.href)})),n._tooltipHandler=sh(n,(function(e,t){n.handleTooltip(e,t,e.type!==$d)}))}Object(ye.z)(ih,Wd,{initialize:function(e,t,n,r,i,a){return this._options=a||{},this._canvas=this._options.externalContext?null:ta(1,1,this._options.type),e&&this._canvas&&(Pd(e,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),ah.initialize.call(this,e,t,n,r,i)},resize:function(e,t,n,r){if(ah.resize.call(this,e,t,n,r),this._canvas)!function(e,t,n,r,i,a){var o="undefined"!=typeof HTMLElement&&e instanceof HTMLElement&&null!=e.parentNode,s=e.getContext("2d"),u=o?rh:i;for(var c in e.width=t*u,e.height=n*u,a)s[c]=a[c];o&&1!==u&&(e.style.width=t+"px",e.style.height=n+"px"),s.pixelRatio=u,s.setTransform(u,0,0,u,u*r[0],u*r[1])}(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{var i=this._options.externalContext;i||Object(ye.o)("CanvasRenderer is missing a valid canvas or context"),i.scale(this._scale,this._scale),i.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this},canvas:function(){return this._canvas},context:function(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},dirty:function(e){for(var t=this._tempb.clear().union(e.bounds),n=e.mark.group;n;)t.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(t)},_render:function(e){var t=this.context(),n=this._origin,r=this._width,i=this._height,a=this._dirty,o=function(e,t,n){return(new Tl).set(0,0,t,n).translate(-e[0],-e[1])}(n,r,i);t.save();var s=this._redraw||a.empty()?(this._redraw=!1,o.expand(1)):function(e,t,n){return t.expand(1).round(),e.pixelRatio%1&&t.scale(e.pixelRatio).round().scale(1/e.pixelRatio),t.translate(-n[0]%1,-n[1]%1),e.beginPath(),e.rect(t.x1,t.y1,t.width(),t.height()),e.clip(),t}(t,o.intersect(a),n);return this.clear(-n[0],-n[1],r,i),this.draw(t,e,s),t.restore(),a.clear(),this},draw:function(e,t,n){var r=Sd[t.marktype];t.clip&&function(e,t){var n=t.clip;e.save(),Object(ye.E)(n)?(e.beginPath(),n(e),e.clip()):Rf(e,t.group)}(e,t),r.draw.call(this,e,t,n),t.clip&&e.restore()},clear:function(e,t,n,r){var i=this._options,a=this.context();"pdf"===i.type||i.externalContext||a.clearRect(e,t,n,r),null!=this._bgcolor&&(a.fillStyle=this._bgcolor,a.fillRect(e,t,n,r))}});var sh=function(e,t){return function(n){var r=n.target.__data__;r=Array.isArray(r)?r[0]:r,n.vegaType=n.type,t.call(e._obj,n,r)}};Object(ye.z)(oh,zd,{initialize:function(e,t,n){var r=this._svg;return r&&(r.removeEventListener(Jd,this._hrefHandler),r.removeEventListener(Yd,this._tooltipHandler),r.removeEventListener($d,this._tooltipHandler)),this._svg=r=e&&Nd(e,"svg"),r&&(r.addEventListener(Jd,this._hrefHandler),r.addEventListener(Yd,this._tooltipHandler),r.addEventListener($d,this._tooltipHandler)),zd.prototype.initialize.call(this,e,t,n)},canvas:function(){return this._svg},on:function(e,t){var n=this.eventName(e),r=this._handlers;if(this._handlerIndex(r[n],e,t)<0){var i={type:e,handler:t,listener:sh(this,t)};(r[n]||(r[n]=[])).push(i),this._svg&&this._svg.addEventListener(n,i.listener)}return this},off:function(e,t){var n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);return i>=0&&(this._svg&&this._svg.removeEventListener(n,r[i].listener),r.splice(i,1)),this}});var uh="aria-hidden",ch="aria-label",lh="role",fh="aria-roledescription",dh="graphics-object",hh="graphics-symbol",ph=function(e,t,n){var r;return y(r={},lh,e),y(r,fh,t),y(r,ch,n||void 0),r},mh=Object(ye.Fa)(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),vh={axis:{desc:"axis",caption:function(e){var t=e.datum,n=e.orient,r=t.title?wh(e):null,i=e.context,a=i.scales[t.scale].value,o=i.dataflow.locale(),s=a.type;return"".concat("left"===n||"right"===n?"Y":"X","-axis")+(r?" titled '".concat(r,"'"):"")+" for a ".concat(Yu(s)?"discrete":s," scale")+" with ".concat(jc(o,a,e))}},legend:{desc:"legend",caption:function(e){var t=e.datum,n=t.title?wh(e):null,r="".concat(t.type||""," legend").trim(),i=t.scales,a=Object.keys(i),o=e.context,s=o.scales[i[a[0]]].value,u=o.dataflow.locale();return function(e){return e.length?e[0].toUpperCase()+e.slice(1):e}(r)+(n?" titled '".concat(n,"'"):"")+" for ".concat(function(e){return(e=e.map((function(e){return e+("fill"===e||"stroke"===e?" color":"")}))).length<2?e[0]:e.slice(0,-1).join(", ")+" and "+Object(ye.W)(e)}(a))+" with ".concat(jc(u,s,e))}},"title-text":{desc:"title",caption:function(e){return"Title text '".concat(xh(e),"'")}},"title-subtitle":{desc:"subtitle",caption:function(e){return"Subtitle text '".concat(xh(e),"'")}}},gh={ariaRole:lh,ariaRoleDescription:fh,description:ch};function yh(e,t){var n=!1===t.aria;if(e(uh,n||void 0),n||null==t.description)for(var r in gh)e(gh[r],void 0);else{var i=t.mark.marktype;e(ch,t.description),e(lh,t.ariaRole||("group"===i?dh:hh)),e(fh,t.ariaRoleDescription||"".concat(i," mark"))}}function bh(e){return!1===e.aria?y({},uh,!0):mh[e.role]?null:vh[e.role]?function(e,t){try{var n=e.items[0],r=t.caption||function(){return""};return ph(t.role||hh,t.desc,n.description||r(n))}catch(e){return null}}(e,vh[e.role]):function(e){var t=e.marktype,n="group"===t||"text"===t||e.items.some((function(e){return null!=e.description&&!1!==e.aria}));return ph(n?dh:hh,"".concat(t," mark container"),e.description)}(e)}function xh(e){return Object(ye.i)(e.text).join(" ")}function wh(e){try{return Object(ye.i)(Object(ye.W)(e.items).items[0].text).join(" ")}catch(e){return null}}var _h=function(e){return(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},kh=function(e){return _h(e).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;")};function Eh(){var e="",t="",n="",r=[],i=function(){return t=n=""},a=function(e,n){return null!=n&&(t+=" ".concat(e,'="').concat(kh(n),'"')),o},o={open:function(s){(function(a){t&&(e+="".concat(t,">").concat(n),i()),r.push(a)})(s),t="<"+s;for(var u=arguments.length,c=new Array(u>1?u-1:0),l=1;l<u;l++)c[l-1]=arguments[l];for(var f=0,d=c;f<d.length;f++){var h=d[f];for(var p in h)a(p,h[p])}return o},close:function(){var a=r.pop();return e+=t?t+(n?">".concat(n,"</").concat(a,">"):"/>"):"</".concat(a,">"),i(),o},attr:a,text:function(e){return n+=_h(e),o},toString:function(){return e}};return o}var Sh=function(e){return function e(t,n){if(t.open(n.tagName),n.hasAttributes())for(var r=n.attributes,i=r.length,a=0;a<i;++a)t.attr(r[a].name,r[a].value);if(n.hasChildNodes())for(var o=n.childNodes,s=o.length,u=0;u<s;u++){var c=o[u];3===c.nodeType?t.text(c.nodeValue):e(t,c)}return t.close()}(Eh(),e)+""},Ch={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity",blend:"mix-blend-mode"},Ah={fill:"none","stroke-miterlimit":10},Oh=Gf.xmlns;function Dh(e){Wd.call(this,e),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}var Th=Wd.prototype;function jh(e,t){for(;e&&e.dirty!==t;e=e.mark.group){if(e.dirty=t,!e.mark||e.mark.dirty===t)return;e.mark.dirty=t}}function Mh(e,t,n){var r,i,a;if("radial"===t.gradient){var o=Rd(e,n++,"pattern",Oh);zh(o,{id:Fc+t.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),zh(o=Rd(o,0,"rect",Oh),{width:1,height:1,fill:"url(".concat(Wh(),"#").concat(t.id,")")}),zh(e=Rd(e,n++,"radialGradient",Oh),{id:t.id,fx:t.x1,fy:t.y1,fr:t.r1,cx:t.x2,cy:t.y2,r:t.r2})}else zh(e=Rd(e,n++,"linearGradient",Oh),{id:t.id,x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2});for(r=0,i=t.stops.length;r<i;++r)(a=Rd(e,r,"stop",Oh)).setAttribute("offset",t.stops[r].offset),a.setAttribute("stop-color",t.stops[r].color);return Pd(e,r),n}function Fh(e,t,n){return(e=Rd(e,n,"clipPath",Oh)).setAttribute("id",t.id),t.path?Rd(e,0,"path",Oh).setAttribute("d",t.path):zh(Rd(e,0,"rect",Oh),{x:0,y:0,width:t.width,height:t.height}),Pd(e,1),n+1}function Ih(e,t,n,r,i){var a,o=e._svg;if(!o&&(o=Id(a=t.ownerDocument,r,Oh),e._svg=o,e.mark&&(o.__data__=e,o.__values__={fill:"default"},"g"===r))){var s=Id(a,"path",Oh);o.appendChild(s),s.__data__=e;var u=Id(a,"g",Oh);o.appendChild(u),u.__data__=e;var c=Id(a,"path",Oh);o.appendChild(c),c.__data__=e,c.__values__={fill:"default"}}return(o.ownerSVGElement!==i||function(e,t){return e.parentNode&&e.parentNode.childNodes.length>1&&e.previousSibling!=t}(o,n))&&t.insertBefore(o,n?n.nextSibling:t.firstChild),o}Object(ye.z)(Dh,Wd,{initialize:function(e,t,n,r,i){return this._defs={},this._clearDefs(),e&&(this._svg=Rd(e,0,"svg",Oh),this._svg.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns",Oh),this._svg.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink",Gf["xmlns:xlink"]),this._svg.setAttribute("version",Gf.version),this._svg.setAttribute("class","marks"),Pd(e,1),this._root=Rd(this._svg,0,"g",Oh),zh(this._root,Ah),Pd(this._svg,1)),this.background(this._bgcolor),Th.initialize.call(this,e,t,n,r,i)},background:function(e){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",e),Th.background.apply(this,arguments)},resize:function(e,t,n,r){return Th.resize.call(this,e,t,n,r),this._svg&&(zh(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 ".concat(this._width," ").concat(this._height)}),this._root.setAttribute("transform","translate(".concat(this._origin,")"))),this._dirty=[],this},canvas:function(){return this._svg},svg:function(){var e,t=this._svg,n=this._bgcolor;if(!t)return null;n&&(t.removeAttribute("style"),zh(e=Rd(t,0,"rect",Oh),{width:this._width,height:this._height,fill:n}));var r=Sh(t);return n&&(t.removeChild(e),this._svg.style.setProperty("background-color",n)),r},_render:function(e){return this._dirtyCheck()&&(this._dirtyAll&&this._clearDefs(),this.mark(this._root,e),Pd(this._root,1)),this.defs(),this._dirty=[],++this._dirtyID,this},dirty:function(e){e.dirty!==this._dirtyID&&(e.dirty=this._dirtyID,this._dirty.push(e))},isDirty:function(e){return this._dirtyAll||!e._svg||e.dirty===this._dirtyID},_dirtyCheck:function(){this._dirtyAll=!0;var e=this._dirty;if(!e.length||!this._dirtyID)return!0;var t,n,r,i,a,o,s,u=++this._dirtyID;for(a=0,o=e.length;a<o;++a)(n=(t=e[a]).mark).marktype!==r&&(r=n.marktype,i=Sd[r]),n.zdirty&&n.dirty!==u&&(this._dirtyAll=!1,jh(t,u),n.items.forEach((function(e){e.dirty=u}))),n.zdirty||(t.exit?(i.nested&&n.items.length?(s=n.items[0])._svg&&this._update(i,s._svg,s):t._svg&&(s=t._svg.parentNode)&&s.removeChild(t._svg),t._svg=null):(t=i.nested?n.items[0]:t)._update!==u&&(t._svg&&t._svg.ownerSVGElement?this._update(i,t._svg,t):(this._dirtyAll=!1,jh(t,u)),t._update=u));return!this._dirtyAll},mark:function(e,t,n){var r=this;if(!this.isDirty(t))return t._svg;var i=this._svg,a=Sd[t.marktype],o=!1===t.interactive?"none":null,s="g"===a.tag,u=null,c=0,l=Ih(t,e,n,"g",i);l.setAttribute("class",Bd(t));var f=bh(t);for(var d in f)Uh(l,d,f[d]);s||Uh(l,"pointer-events",o),Uh(l,"clip-path",t.clip?Dl(this,t,t.group):null);var h=function(e){var t=r.isDirty(e),n=Ih(e,l,u,a.tag,i);t&&(r._update(a,n,e),s&&function(e,t,n){t=t.lastChild.previousSibling;var r,i=0;_f(n,(function(n){r=e.mark(t,n,r),++i})),Pd(t,1+i)}(r,n,e)),u=n,++c};return a.nested?t.items.length&&h(t.items[0]):_f(t,h),Pd(l,c),l},_update:function(e,t,n){Nh=t,Rh=t.__values__,yh(Bh,n),e.attr(Bh,n,this);var r=Ph[e.type];r&&r.call(this,e,t,n),Nh&&this.style(Nh,n)},style:function(e,t){if(null!=t)for(var n in Ch){var r="font"===n?yd(t):t[n];if(r!==Rh[n]){var i=Ch[n];null==r?e.removeAttribute(i):(Ic(r)&&(r=Nc(r,this._defs.gradient,Wh())),e.setAttribute(i,r+"")),Rh[n]=r}}},defs:function(){var e=this._svg,t=this._defs,n=t.el,r=0;for(var i in t.gradient)n||(t.el=n=Rd(e,1,"defs",Oh)),r=Mh(n,t.gradient[i],r);for(var a in t.clipping)n||(t.el=n=Rd(e,1,"defs",Oh)),r=Fh(n,t.clipping[a],r);n&&(0===r?(e.removeChild(n),t.el=null):Pd(n,r))},_clearDefs:function(){var e=this._defs;e.gradient={},e.clipping={}}});var Nh=null,Rh=null,Ph={group:function(e,t,n){var r=Nh=t.childNodes[2];Rh=r.__values__,e.foreground(Bh,n,this),Rh=t.__values__,Nh=t.childNodes[1],e.content(Bh,n,this);var i=Nh=t.childNodes[0];e.background(Bh,n,this);var a=!1===n.mark.interactive?"none":null;if(a!==Rh.events&&(Uh(r,"pointer-events",a),Uh(i,"pointer-events",a),Rh.events=a),n.strokeForeground&&n.stroke){var o=n.fill;Uh(r,"display",null),this.style(i,n),Uh(i,"stroke",null),o&&(n.fill=null),Rh=r.__values__,this.style(r,n),o&&(n.fill=o),Nh=null}else Uh(r,"display","none")},image:function(e,t,n){!1===n.smooth?(Lh(t,"image-rendering","optimizeSpeed"),Lh(t,"image-rendering","pixelated")):Lh(t,"image-rendering",null)},text:function(e,t,n){var r,i,a,o,s=md(n);Object(ye.B)(s)?(r=(i=s.map((function(e){return gd(n,e)}))).join("\n"))!==Rh.text&&(Pd(t,0),a=t.ownerDocument,o=pd(n),i.forEach((function(e,r){var i=Id(a,"tspan",Oh);i.__data__=n,i.textContent=e,r&&(i.setAttribute("x",0),i.setAttribute("dy",o)),t.appendChild(i)})),Rh.text=r):(i=gd(n,s))!==Rh.text&&(t.textContent=i,Rh.text=i),Uh(t,"font-family",yd(n)),Uh(t,"font-size",hd(n)+"px"),Uh(t,"font-style",n.fontStyle),Uh(t,"font-variant",n.fontVariant),Uh(t,"font-weight",n.fontWeight)}};function Bh(e,t,n){t!==Rh[e]&&(n?function(e,t,n,r){null!=n?e.setAttributeNS(r,t,n):e.removeAttributeNS(r,t)}(Nh,e,t,n):Uh(Nh,e,t),Rh[e]=t)}function Lh(e,t,n){n!==Rh[t]&&(null==n?e.style.removeProperty(t):e.style.setProperty(t,n+""),Rh[t]=n)}function zh(e,t){for(var n in t)Uh(e,n,t[n])}function Uh(e,t,n){null!=n?e.setAttribute(t,n):e.removeAttribute(t)}function Wh(){var e;return"undefined"==typeof window?"":(e=window.location).hash?e.href.slice(0,-e.hash.length):e.href}function Vh(e){Wd.call(this,e),this._text=null,this._defs={gradient:{},clipping:{}}}Object(ye.z)(Vh,Wd,{svg:function(){return this._text},_render:function(e){var t=Eh();t.open("svg",Object(ye.p)({},Gf,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 ".concat(this._width," ").concat(this._height)}));var n=this._bgcolor;return n&&"transparent"!==n&&"none"!==n&&t.open("rect",{width:this._width,height:this._height,fill:n}).close(),t.open("g",Ah,{transform:"translate("+this._origin+")"}),this.mark(t,e),t.close(),this.defs(t),this._text=t.close()+"",this},mark:function(e,t){var n=this,r=Sd[t.marktype],i=r.tag,a=[yh,r.attr];e.open("g",{class:Bd(t),"clip-path":t.clip?Dl(this,t,t.group):null},bh(t),{"pointer-events":"g"!==i&&!1===t.interactive?"none":null});var o=function(o){var s=n.href(o);if(s&&e.open("a",s),e.open(i,n.attr(t,o,a,"g"!==i?i:null)),"text"===i){var u=md(o);if(Object(ye.B)(u))for(var c={x:0,dy:pd(o)},l=0;l<u.length;++l)e.open("tspan",l?c:null).text(gd(o,u[l])).close();else e.text(gd(o,u))}else if("g"===i){var f=o.strokeForeground,d=o.fill,h=o.stroke;f&&h&&(o.stroke=null),e.open("path",n.attr(t,o,r.background,"bgrect")).close(),e.open("g",n.attr(t,o,r.content)),_f(o,(function(t){return n.mark(e,t)})),e.close(),f&&h?(d&&(o.fill=null),o.stroke=h,e.open("path",n.attr(t,o,r.foreground,"bgrect")).close(),d&&(o.fill=d)):e.open("path",n.attr(t,o,r.foreground,"bgfore")).close()}e.close(),s&&e.close()};return r.nested?t.items&&t.items.length&&o(t.items[0]):_f(t,o),e.close()},href:function(e){var t,n=this,r=e.href;if(r){if(t=this._hrefs&&this._hrefs[r])return t;this.sanitizeURL(r).then((function(e){e["xlink:href"]=e.href,e.href=null,(n._hrefs||(n._hrefs={}))[r]=e}))}return null},attr:function(e,t,n,r){var i=this,a={},o=function(e,t,n,r){a[r||e]=t};return Array.isArray(n)?n.forEach((function(e){return e(o,t,i)})):n(o,t,this),r&&function(e,t,n,r,i){if(null==t)return e;if("bgrect"===r&&!1===n.interactive&&(e["pointer-events"]="none"),"bgfore"===r&&(!1===n.interactive&&(e["pointer-events"]="none"),e.display="none",null!==t.fill))return e;for(var a in"image"===r&&!1===t.smooth&&(e.style="image-rendering: optimizeSpeed; image-rendering: pixelated;"),"text"===r&&(e["font-family"]=yd(t),e["font-size"]=hd(t)+"px",e["font-style"]=t.fontStyle,e["font-variant"]=t.fontVariant,e["font-weight"]=t.fontWeight),Ch){var o=t[a],s=Ch[a];("transparent"!==o||"fill"!==s&&"stroke"!==s)&&null!=o&&(Ic(o)&&(o=Nc(o,i.gradient,"")),e[s]=o)}}(a,t,e,r,this._defs),a},defs:function(e){var t=this._defs.gradient,n=this._defs.clipping;if(0!==Object.keys(t).length+Object.keys(n).length){for(var r in e.open("defs"),t){var i=t[r],a=i.stops;"radial"===i.gradient?(e.open("pattern",{id:Fc+r,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),e.open("rect",{width:"1",height:"1",fill:"url(#"+r+")"}).close(),e.close(),e.open("radialGradient",{id:r,fx:i.x1,fy:i.y1,fr:i.r1,cx:i.x2,cy:i.y2,r:i.r2})):e.open("linearGradient",{id:r,x1:i.x1,x2:i.x2,y1:i.y1,y2:i.y2});for(var o=0;o<a.length;++o)e.open("stop",{offset:a[o].offset,"stop-color":a[o].color}).close();e.close()}for(var s in n){var u=n[s];e.open("clipPath",{id:s}),u.path?e.open("path",{d:u.path}).close():e.open("rect",{x:0,y:0,width:u.width,height:u.height}).close(),e.close()}e.close()}}});var Gh={Canvas:"canvas",PNG:"png",SVG:"svg",None:"none"},qh={};function Hh(e,t){return e=String(e||"").toLowerCase(),arguments.length>1?(qh[e]=t,this):qh[e]}function Xh(e,t,n){var r=[],i=(new Tl).union(t),a=e.marktype;return a?Kh(e,i,n,r):"group"===a?Yh(e,i,n,r):Object(ye.o)("Intersect scene must be mark node or group item.")}function Kh(e,t,n,r){if(function(e,t,n){return e.bounds&&t.intersects(e.bounds)&&("group"===e.marktype||!1!==e.interactive&&(!n||n(e)))}(e,t,n)){var i=e.items,a=e.marktype,o=i.length,s=0;if("group"===a)for(;s<o;++s)Yh(i[s],t,n,r);else for(var u=Sd[a].isect;s<o;++s){var c=i[s];$h(c,t,u)&&r.push(c)}}return r}function Yh(e,t,n,r){n&&n(e.mark)&&$h(e,t,Sd.group.isect)&&r.push(e);var i=e.items,a=i&&i.length;if(a){var o=e.x||0,s=e.y||0;t.translate(-o,-s);for(var u=0;u<a;++u)Kh(i[u],t,n,r);t.translate(o,s)}return r}function $h(e,t,n){var r=e.bounds;return t.encloses(r)||t.intersects(r)&&n(e,t)}qh.canvas=qh.png={renderer:ih,headless:ih,handler:Zd},qh.svg={renderer:Dh,headless:Vh,handler:oh},qh.none={};var Jh=new Tl;function Zh(e){var t=e.clip;if(Object(ye.E)(t))t(ef(Jh.clear()));else{if(!t)return;Jh.set(0,0,e.group.width,e.group.height)}e.bounds.intersect(Jh)}var Qh=1e-9;function ep(e,t,n){return e===t||("path"===n?tp(e,t):e instanceof Date&&t instanceof Date?+e==+t:Object(ye.G)(e)&&Object(ye.G)(t)?Math.abs(e-t)<=Qh:e&&t&&(Object(ye.H)(e)||Object(ye.H)(t))?function(e,t){var n,r,i=Object.keys(e),a=Object.keys(t);if(i.length!==a.length)return!1;for(i.sort(),a.sort(),r=i.length-1;r>=0;r--)if(i[r]!=a[r])return!1;for(r=i.length-1;r>=0;r--)if(!ep(e[n=i[r]],t[n],n))return!1;return typeof e==typeof t}(e,t):e==t)}function tp(e,t){return ep(Wc(e),Wc(t))}function np(){Ol(),Mc=0}var rp="top",ip="left",ap="right",op="bottom",sp="top-left",up="top-right",cp="bottom-left",lp="bottom-right",fp="start",dp="middle",hp="end",pp="x",mp="y",vp="group",gp="axis",yp="title",bp="frame",xp="scope",wp="legend",_p="row-header",kp="row-footer",Ep="row-title",Sp="column-header",Cp="column-footer",Ap="column-title",Op="padding",Dp="symbol",Tp="fit",jp="fit-x",Mp="fit-y",Fp="pad",Ip="none",Np="all",Rp="each",Pp="flush",Bp="column",Lp="row";function zp(e){ot.call(this,null,e)}function Up(e,t,n){return t(e.bounds.clear(),e,n)}Object(ye.z)(zp,ot,{transform:function(e,t){var n,r=t.dataflow,i=e.mark,a=i.marktype,o=Sd[a],s=o.bound,u=i.bounds;if(o.nested)i.items.length&&r.dirty(i.items[0]),u=Up(i,s),i.items.forEach((function(e){e.bounds.clear().union(u)}));else if(a===vp||e.modified())switch(t.visit(t.MOD,(function(e){return r.dirty(e)})),u.clear(),i.items.forEach((function(e){return u.union(Up(e,s))})),i.role){case gp:case wp:case yp:t.reflow()}else n=t.changed(t.REM),t.visit(t.ADD,(function(e){u.union(Up(e,s))})),t.visit(t.MOD,(function(e){n=n||u.alignsWith(e.bounds),r.dirty(e),u.union(Up(e,s))})),n&&(u.clear(),i.items.forEach((function(e){return u.union(e.bounds)})));return Zh(i),t.modifies("bounds")}});var Wp=":vega_identifier:";function Vp(e){ot.call(this,0,e)}function Gp(e){ot.call(this,null,e)}function qp(e){ot.call(this,null,e)}Vp.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]},Object(ye.z)(Vp,ot,{transform:function(e,t){var n=function(e){return e._signals[Wp]||(e._signals[Wp]=e.add(0))}(t.dataflow),r=e.as,i=n.value;return t.visit(t.ADD,(function(e){return e[r]=e[r]||++i})),n.set(this.value=i),t}}),Object(ye.z)(Gp,ot,{transform:function(e,t){var n=this.value;n||((n=t.dataflow.scenegraph().mark(e.markdef,function(e){var t=e.groups,n=e.parent;return t&&1===t.size?t.get(Object.keys(t.object)[0]):t&&n?t.lookup(n):null}(e),e.index)).group.context=e.context,e.context.group||(e.context.group=n.group),n.source=this.source,n.clip=e.clip,n.interactive=e.interactive,this.value=n);var r=n.marktype===vp?Ml:jl;return t.visit(t.ADD,(function(e){return r.call(e,n)})),(e.modified("clip")||e.modified("interactive"))&&(n.clip=e.clip,n.interactive=!!e.interactive,n.zdirty=!0,t.reflow()),n.items=t.source,t}});var Hp={parity:function(e){return e.filter((function(e,t){return t%2?e.opacity=0:1}))},greedy:function(e,t){var n;return e.filter((function(e,r){return r&&Xp(n.bounds,e.bounds,t)?e.opacity=0:(n=e,1)}))}},Xp=function(e,t,n){return n>Math.max(t.x1-e.x2,e.x1-t.x2,t.y1-e.y2,e.y1-t.y2)},Kp=function(e,t){for(var n,r=1,i=e.length,a=e[0].bounds;r<i;a=n,++r)if(Xp(a,n=e[r].bounds,t))return!0},Yp=function(e){var t=e.bounds;return t.width()>1&&t.height()>1},$p=function(e){return e.forEach((function(e){return e.opacity=1})),e},Jp=function(e,t){return e.reflow(t.modified()).modifies("opacity")};function Zp(e){ot.call(this,null,e)}Object(ye.z)(qp,ot,{transform:function(e,t){var n,r,i=Hp[e.method]||Hp.parity,a=e.separation||0,o=t.materialize(t.SOURCE).source;if(o&&o.length){if(!e.method)return e.modified("method")&&($p(o),t=Jp(t,e)),t;if((o=o.filter(Yp)).length){if(e.sort&&(o=o.slice().sort(e.sort)),n=$p(o),t=Jp(t,e),n.length>=3&&Kp(n,a)){do{n=i(n,a)}while(n.length>=3&&Kp(n,a));n.length<3&&!Object(ye.W)(o).opacity&&(n.length>1&&(Object(ye.W)(n).opacity=0),Object(ye.W)(o).opacity=1)}e.boundScale&&e.boundTolerance>=0&&(r=function(e,t,n){var r=e.range(),i=new Tl;return t===rp||t===op?i.set(r[0],-1/0,r[1],1/0):i.set(-1/0,r[0],1/0,r[1]),i.expand(n||1),function(e){return i.encloses(e.bounds)}}(e.boundScale,e.boundOrient,+e.boundTolerance),o.forEach((function(e){r(e)||(e.opacity=0)})));var s=n[0].mark.bounds.clear();return o.forEach((function(e){e.opacity&&s.union(e.bounds)})),t}}}}),Object(ye.z)(Zp,ot,{transform:function(e,t){var n=t.dataflow;if(t.visit(t.ALL,(function(e){return n.dirty(e)})),t.fields&&t.fields.zindex){var r=t.source&&t.source[0];r&&(r.mark.zdirty=!0)}}});var Qp=new Tl;function em(e,t,n){return e[t]===n?0:(e[t]=n,1)}function tm(e){var t=e.items[0].orient;return t===ip||t===ap}function nm(e,t,n,r){var i,a,o=t.items[0],s=o.datum,u=null!=o.translate?o.translate:.5,c=o.orient,l=function(e){var t=+e.grid;return[e.ticks?t++:-1,e.labels?t++:-1,t+ +e.domain]}(s),f=o.range,d=o.offset,h=o.position,p=o.minExtent,m=o.maxExtent,v=s.title&&o.items[l[2]].items[0],g=o.titlePadding,y=o.bounds,b=v&&vd(v),x=0,w=0;switch(Qp.clear().union(y),y.clear(),(i=l[0])>-1&&y.union(o.items[i].bounds),(i=l[1])>-1&&y.union(o.items[i].bounds),c){case rp:x=h||0,w=-d,a=Math.max(p,Math.min(m,-y.y1)),y.add(0,-a).add(f,0),v&&rm(e,v,a,g,b,0,-1,y);break;case ip:x=-d,w=h||0,a=Math.max(p,Math.min(m,-y.x1)),y.add(-a,0).add(0,f),v&&rm(e,v,a,g,b,1,-1,y);break;case ap:x=n+d,w=h||0,a=Math.max(p,Math.min(m,y.x2)),y.add(0,0).add(a,f),v&&rm(e,v,a,g,b,1,1,y);break;case op:x=h||0,w=r+d,a=Math.max(p,Math.min(m,y.y2)),y.add(0,0).add(f,a),v&&rm(e,v,a,g,0,0,1,y);break;default:x=o.x,w=o.y}return Rl(y.translate(x,w),o),em(o,"x",x+u)|em(o,"y",w+u)&&(o.bounds=Qp,e.dirty(o),o.bounds=y,e.dirty(o)),o.mark.bounds.clear().union(y)}function rm(e,t,n,r,i,a,o,s){var u=t.bounds;if(t.auto){var c=o*(n+i+r),l=0,f=0;e.dirty(t),a?l=(t.x||0)-(t.x=c):f=(t.y||0)-(t.y=c),t.mark.bounds.clear().union(u.translate(-l,-f)),e.dirty(t)}s.union(u)}var im=function(e,t){return Math.floor(Math.min(e,t))},am=function(e,t){return Math.ceil(Math.max(e,t))};function om(e){return(new Tl).set(0,0,e.width||0,e.height||0)}function sm(e){var t=e.bounds.clone();return t.empty()?t.set(0,0,0,0):t.translate(-(e.x||0),-(e.y||0))}function um(e,t,n){var r=Object(ye.H)(e)?e[t]:e;return null!=r?r:void 0!==n?n:0}function cm(e){return e<0?Math.ceil(-e):0}function lm(e,t,n){var r,i,a,o,s,u,c,l,f,d,h,p=!n.nodirty,m=n.bounds===Pp?om:sm,v=Qp.set(0,0,0,0),g=um(n.align,Bp),y=um(n.align,Lp),b=um(n.padding,Bp),x=um(n.padding,Lp),w=n.columns||t.length,_=w<=0?1:Math.ceil(t.length/w),k=t.length,E=Array(k),S=Array(w),C=0,A=Array(k),O=Array(_),D=0,T=Array(k),j=Array(k),M=Array(k);for(i=0;i<w;++i)S[i]=0;for(i=0;i<_;++i)O[i]=0;for(i=0;i<k;++i)u=t[i],s=M[i]=m(u),u.x=u.x||0,T[i]=0,u.y=u.y||0,j[i]=0,a=i%w,o=~~(i/w),C=Math.max(C,c=Math.ceil(s.x2)),D=Math.max(D,l=Math.ceil(s.y2)),S[a]=Math.max(S[a],c),O[o]=Math.max(O[o],l),E[i]=b+cm(s.x1),A[i]=x+cm(s.y1),p&&e.dirty(t[i]);for(i=0;i<k;++i)i%w==0&&(E[i]=0),i<w&&(A[i]=0);if(g===Rp)for(a=1;a<w;++a){for(h=0,i=a;i<k;i+=w)h<E[i]&&(h=E[i]);for(i=a;i<k;i+=w)E[i]=h+S[a-1]}else if(g===Np){for(h=0,i=0;i<k;++i)i%w&&h<E[i]&&(h=E[i]);for(i=0;i<k;++i)i%w&&(E[i]=h+C)}else for(g=!1,a=1;a<w;++a)for(i=a;i<k;i+=w)E[i]+=S[a-1];if(y===Rp)for(o=1;o<_;++o){for(h=0,r=(i=o*w)+w;i<r;++i)h<A[i]&&(h=A[i]);for(i=o*w;i<r;++i)A[i]=h+O[o-1]}else if(y===Np){for(h=0,i=w;i<k;++i)h<A[i]&&(h=A[i]);for(i=w;i<k;++i)A[i]=h+D}else for(y=!1,o=1;o<_;++o)for(r=(i=o*w)+w;i<r;++i)A[i]+=O[o-1];for(f=0,i=0;i<k;++i)f=E[i]+(i%w?f:0),T[i]+=f-t[i].x;for(a=0;a<w;++a)for(d=0,i=a;i<k;i+=w)d+=A[i],j[i]+=d-t[i].y;if(g&&um(n.center,Bp)&&_>1)for(i=0;i<k;++i)(f=(s=g===Np?C:S[i%w])-M[i].x2-t[i].x-T[i])>0&&(T[i]+=f/2);if(y&&um(n.center,Lp)&&1!==w)for(i=0;i<k;++i)(d=(s=y===Np?D:O[~~(i/w)])-M[i].y2-t[i].y-j[i])>0&&(j[i]+=d/2);for(i=0;i<k;++i)v.union(M[i].translate(T[i],j[i]));switch(f=um(n.anchor,pp),d=um(n.anchor,mp),um(n.anchor,Bp)){case hp:f-=v.width();break;case dp:f-=v.width()/2}switch(um(n.anchor,Lp)){case hp:d-=v.height();break;case dp:d-=v.height()/2}for(f=Math.round(f),d=Math.round(d),v.clear(),i=0;i<k;++i)t[i].mark.bounds.clear();for(i=0;i<k;++i)(u=t[i]).x+=T[i]+=f,u.y+=j[i]+=d,v.union(u.mark.bounds.union(u.bounds.translate(T[i],j[i]))),p&&e.dirty(u);return v}function fm(e,t,n){var r,i,a,o,s,u,c,l=function(e){for(var t,n,r,i,a,o,s,u=e.items,c=u.length,l=0,f={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};l<c;++l)if(s=(o=u[l]).items,o.marktype===vp)switch(o.role){case gp:case wp:case yp:break;case _p:(t=f.rowheaders).push.apply(t,h(s));break;case kp:(n=f.rowfooters).push.apply(n,h(s));break;case Sp:(r=f.colheaders).push.apply(r,h(s));break;case Cp:(i=f.colfooters).push.apply(i,h(s));break;case Ep:f.rowtitle=s[0];break;case Ap:f.coltitle=s[0];break;default:(a=f.marks).push.apply(a,h(s))}return f}(t),f=l.marks,d=n.bounds===Pp?dm:hm,p=n.offset,m=n.columns||f.length,v=m<=0?1:Math.ceil(f.length/m),g=v*m,y=lm(e,f,n);y.empty()&&y.set(0,0,0,0),l.rowheaders&&(u=um(n.headerBand,Lp,null),r=pm(e,l.rowheaders,f,m,v,-um(p,"rowHeader"),im,0,d,"x1",0,m,1,u)),l.colheaders&&(u=um(n.headerBand,Bp,null),i=pm(e,l.colheaders,f,m,m,-um(p,"columnHeader"),im,1,d,"y1",0,1,m,u)),l.rowfooters&&(u=um(n.footerBand,Lp,null),a=pm(e,l.rowfooters,f,m,v,um(p,"rowFooter"),am,0,d,"x2",m-1,m,1,u)),l.colfooters&&(u=um(n.footerBand,Bp,null),o=pm(e,l.colfooters,f,m,m,um(p,"columnFooter"),am,1,d,"y2",g-m,1,m,u)),l.rowtitle&&(s=um(n.titleAnchor,Lp),c=um(p,"rowTitle"),c=s===hp?a+c:r-c,u=um(n.titleBand,Lp,.5),mm(e,l.rowtitle,c,0,y,u)),l.coltitle&&(s=um(n.titleAnchor,Bp),c=um(p,"columnTitle"),c=s===hp?o+c:i-c,u=um(n.titleBand,Bp,.5),mm(e,l.coltitle,c,1,y,u))}function dm(e,t){return"x1"===t?e.x||0:"y1"===t?e.y||0:"x2"===t?(e.x||0)+(e.width||0):"y2"===t?(e.y||0)+(e.height||0):void 0}function hm(e,t){return e.bounds[t]}function pm(e,t,n,r,i,a,o,s,u,c,l,f,d,h){var p,m,v,g,y,b,x,w,_,k=n.length,E=0,S=0;if(!k)return E;for(p=l;p<k;p+=f)n[p]&&(E=o(E,u(n[p],c)));if(!t.length)return E;for(t.length>i&&(e.warn("Grid headers exceed limit: "+i),t=t.slice(0,i)),E+=a,m=0,g=t.length;m<g;++m)e.dirty(t[m]),t[m].mark.bounds.clear();for(p=l,m=0,g=t.length;m<g;++m,p+=f){for(y=(b=t[m]).mark.bounds,v=p;v>=0&&null==(x=n[v]);v-=d);s?(w=null==h?x.x:Math.round(x.bounds.x1+h*x.bounds.width()),_=E):(w=E,_=null==h?x.y:Math.round(x.bounds.y1+h*x.bounds.height())),y.union(b.bounds.translate(w-(b.x||0),_-(b.y||0))),b.x=w,b.y=_,e.dirty(b),S=o(S,y[c])}return S}function mm(e,t,n,r,i,a){if(t){e.dirty(t);var o=n,s=n;r?o=Math.round(i.x1+a*i.width()):s=Math.round(i.y1+a*i.height()),t.bounds.translate(o-(t.x||0),s-(t.y||0)),t.mark.bounds.clear().union(t.bounds),t.x=o,t.y=s,e.dirty(t)}}function vm(e,t,n,r,i,a,o){var s=function(e,t){var n=e[t]||{};return function(t,r){return null!=n[t]?n[t]:null!=e[t]?e[t]:r}}(n,t),u=function(e,t){var n=-1/0;return e.forEach((function(e){null!=e.offset&&(n=Math.max(n,e.offset))})),n>-1/0?n:t}(e,s("offset",0)),c=s("anchor",fp),l=c===hp?1:c===dp?.5:0,f={align:Rp,bounds:s("bounds",Pp),columns:"vertical"===s("direction")?1:e.length,padding:s("margin",8),center:s("center"),nodirty:!0};switch(t){case ip:f.anchor={x:Math.floor(r.x1)-u,column:hp,y:l*(o||r.height()+2*r.y1),row:c};break;case ap:f.anchor={x:Math.ceil(r.x2)+u,y:l*(o||r.height()+2*r.y1),row:c};break;case rp:f.anchor={y:Math.floor(i.y1)-u,row:hp,x:l*(a||i.width()+2*i.x1),column:c};break;case op:f.anchor={y:Math.ceil(i.y2)+u,x:l*(a||i.width()+2*i.x1),column:c};break;case sp:f.anchor={x:u,y:u};break;case up:f.anchor={x:a-u,y:u,column:hp};break;case cp:f.anchor={x:u,y:o-u,row:hp};break;case lp:f.anchor={x:a-u,y:o-u,column:hp,row:hp}}return f}function gm(e,t){var n,r,i=t.items[0],a=i.datum,o=i.orient,s=i.bounds,u=i.x,c=i.y;return i._bounds?i._bounds.clear().union(s):i._bounds=s.clone(),s.clear(),function(e,t,n){var r=t.padding,i=r-n.x,a=r-n.y;if(t.datum.title){var o=t.items[1].items[0],s=o.anchor,u=t.titlePadding||0,c=r-o.x,l=r-o.y;switch(o.orient){case ip:i+=Math.ceil(o.bounds.width())+u;break;case ap:case op:break;default:a+=o.bounds.height()+u}switch((i||a)&&bm(e,n,i,a),o.orient){case ip:l+=ym(t,n,o,s,1,1);break;case ap:c+=ym(t,n,o,hp,0,0)+u,l+=ym(t,n,o,s,1,1);break;case op:c+=ym(t,n,o,s,0,0),l+=ym(t,n,o,hp,-1,0,1)+u;break;default:c+=ym(t,n,o,s,0,0)}(c||l)&&bm(e,o,c,l),(c=Math.round(o.bounds.x1-r))<0&&(bm(e,n,-c,0),bm(e,o,-c,0))}else(i||a)&&bm(e,n,i,a)}(e,i,i.items[0].items[0]),s=function(e,t){return e.items.forEach((function(e){return t.union(e.bounds)})),t.x1=e.padding,t.y1=e.padding,t}(i,s),n=2*i.padding,r=2*i.padding,s.empty()||(n=Math.ceil(s.width()+n),r=Math.ceil(s.height()+r)),a.type===Dp&&function(e){var t=e.reduce((function(e,t){return e[t.column]=Math.max(t.bounds.x2-t.x,e[t.column]||0),e}),{});e.forEach((function(e){e.width=t[e.column],e.height=e.bounds.y2-e.y}))}(i.items[0].items[0].items[0].items),o!==Ip&&(i.x=u=0,i.y=c=0),i.width=n,i.height=r,Rl(s.set(u,c,u+n,c+r),i),i.mark.bounds.clear().union(s),i}function ym(e,t,n,r,i,a,o){var s="symbol"!==e.datum.type,u=n.datum.vgrad,c=(!s||!a&&u||o?t:t.items[0]).bounds[i?"y2":"x2"]-e.padding,l=u&&a?c:0,f=u&&a?0:c,d=i<=0?0:vd(n);return Math.round(r===fp?l:r===hp?f-d:.5*(c-d))}function bm(e,t,n,r){t.x+=n,t.y+=r,t.bounds.translate(n,r),t.mark.bounds.translate(n,r),e.dirty(t)}function xm(e){ot.call(this,null,e)}function wm(e,t){var n=0;if(void 0===t){var r,i=p(e);try{for(i.s();!(r=i.n()).done;){var a=r.value;(a=+a)&&(n+=a)}}catch(l){i.e(l)}finally{i.f()}}else{var o,s=-1,u=p(e);try{for(u.s();!(o=u.n()).done;){var c=o.value;(c=+t(c,++s,e))&&(n+=c)}}catch(l){u.e(l)}finally{u.f()}}return n}function _m(e){ot.call(this,null,e)}function km(e){ot.call(this,null,e)}function Em(){return De({})}function Sm(e){ot.call(this,null,e)}function Cm(e){ot.call(this,[],e)}Object(ye.z)(xm,ot,{transform:function(e,t){var n=t.dataflow;return e.mark.items.forEach((function(t){e.layout&&fm(n,t,e.layout),function(e,t,n){var r,i,a,o,s,u=t.items,c=Math.max(0,t.width||0),l=Math.max(0,t.height||0),f=(new Tl).set(0,0,c,l),d=f.clone(),h=f.clone(),p=[];for(o=0,s=u.length;o<s;++o)switch((i=u[o]).role){case gp:(tm(i)?d:h).union(nm(e,i,c,l));break;case yp:r=i;break;case wp:p.push(gm(e,i));break;case bp:case xp:case _p:case kp:case Ep:case Sp:case Cp:case Ap:d.union(i.bounds),h.union(i.bounds);break;default:f.union(i.bounds)}if(p.length){var m={};for(var v in p.forEach((function(e){(a=e.orient||ap)!==Ip&&(m[a]||(m[a]=[])).push(e)})),m){var g=m[v];lm(e,g,vm(g,v,n.legends,d,h,c,l))}p.forEach((function(t){var r=t.bounds;if(r.equals(t._bounds)||(t.bounds=t._bounds,e.dirty(t),t.bounds=r,e.dirty(t)),n.autosize&&n.autosize.type===Tp)switch(t.orient){case ip:case ap:f.add(r.x1,0).add(r.x2,0);break;case rp:case op:f.add(0,r.y1).add(0,r.y2)}else f.union(r)}))}f.union(d).union(h),r&&f.union(function(e,t,n,r,i){var a,o=t.items[0],s=o.frame,u=o.orient,c=o.anchor,l=o.offset,f=o.padding,d=o.items[0].items[0],h=o.items[1]&&o.items[1].items[0],p=u===ip||u===ap?r:n,m=0,v=0,g=0,y=0,b=0;if(s!==vp?u===ip?(m=i.y2,p=i.y1):u===ap?(m=i.y1,p=i.y2):(m=i.x1,p=i.x2):u===ip&&(m=r,p=0),a=c===fp?m:c===hp?p:(m+p)/2,h&&h.text){switch(u){case rp:case op:b=d.bounds.height()+f;break;case ip:y=d.bounds.width()+f;break;case ap:y=-d.bounds.width()-f}Qp.clear().union(h.bounds),Qp.translate(y-(h.x||0),b-(h.y||0)),em(h,"x",y)|em(h,"y",b)&&(e.dirty(h),h.bounds.clear().union(Qp),h.mark.bounds.clear().union(Qp),e.dirty(h)),Qp.clear().union(h.bounds)}else Qp.clear();switch(Qp.union(d.bounds),u){case rp:v=a,g=i.y1-Qp.height()-l;break;case ip:v=i.x1-Qp.width()-l,g=a;break;case ap:v=i.x2+Qp.width()+l,g=a;break;case op:v=a,g=i.y2+l;break;default:v=o.x,g=o.y}return em(o,"x",v)|em(o,"y",g)&&(Qp.translate(v,g),e.dirty(o),o.bounds.clear().union(Qp),t.bounds.clear().union(Qp),e.dirty(o)),o.bounds}(e,r,c,l,f)),t.clip&&f.set(0,0,t.width||0,t.height||0),function(e,t,n,r){var i=r.autosize||{},a=i.type;if(!(e._autosize<1)&&a){var o=e._width,s=e._height,u=Math.max(0,t.width||0),c=Math.max(0,Math.ceil(-n.x1)),l=Math.max(0,t.height||0),f=Math.max(0,Math.ceil(-n.y1)),d=Math.max(0,Math.ceil(n.x2-u)),h=Math.max(0,Math.ceil(n.y2-l));if(i.contains===Op){var p=e.padding();o-=p.left+p.right,s-=p.top+p.bottom}a===Ip?(c=0,f=0,u=o,l=s):a===Tp?(u=Math.max(0,o-c-d),l=Math.max(0,s-f-h)):a===jp?(u=Math.max(0,o-c-d),s=l+f+h):a===Mp?(o=u+c+d,l=Math.max(0,s-f-h)):a===Fp&&(o=u+c+d,s=l+f+h),e._resizeView(o,s,u,l,[c,f],i.resize)}}(e,t,f,n)}(n,t,e)})),function(e){return e&&"legend-entry"!==e.mark.role}(e.mark.group)?t.reflow():t}}),Object(ye.z)(_m,ot,{transform:function(e,t){if(this.value&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=this.value,a=e.scale,o=mc(a,null==e.count?e.values?e.values.length:10:e.count,e.minstep),s=e.format||yc(n,a,o,e.formatSpecifier,e.formatType,!!e.values),u=e.values?vc(a,e.values,o):gc(a,o);return i&&(r.rem=i),i=u.map((function(e,t){return De({index:t/(u.length-1||1),value:e,label:s(e)})})),e.extra&&i.length&&i.push(De({index:-1,extra:{value:i[0].value},label:""})),r.source=i,r.add=i,this.value=i,r}}),Object(ye.z)(km,ot,{transform:function(e,t){var n=t.dataflow,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.item||Em,a=e.key||Ae,o=this.value;return Object(ye.B)(r.encode)&&(r.encode=null),o&&(e.modified("key")||t.modified(a))&&Object(ye.o)("DataJoin does not support modified key function or fields."),o||(t=t.addAll(),this.value=o=function(e){var t=Object(ye.t)().test((function(e){return e.exit}));return t.lookup=function(n){return t.get(e(n))},t}(a)),t.visit(t.ADD,(function(e){var t=a(e),n=o.get(t);n?n.exit?(o.empty--,r.add.push(n)):r.mod.push(n):(n=i(e),o.set(t,n),r.add.push(n)),n.datum=e,n.exit=!1})),t.visit(t.MOD,(function(e){var t=a(e),n=o.get(t);n&&(n.datum=e,r.mod.push(n))})),t.visit(t.REM,(function(e){var t=a(e),n=o.get(t);e!==n.datum||n.exit||(r.rem.push(n),n.exit=!0,++o.empty)})),t.changed(t.ADD_MOD)&&r.modifies("datum"),(t.clean()||e.clean&&o.empty>n.cleanThreshold)&&n.runAfter(o.clean),r}}),Object(ye.z)(Sm,ot,{transform:function(e,t){var n=t.fork(t.ADD_REM),r=e.mod||!1,i=e.encoders,a=t.encode;if(Object(ye.B)(a)){if(!n.changed()&&!a.every((function(e){return i[e]})))return t.StopPropagation;a=a[0],n.encode=null}var o="enter"===a,s=i.update||ye.s,u=i.enter||ye.s,c=i.exit||ye.s,l=(a&&!o?i[a]:s)||ye.s;if(t.changed(t.ADD)&&(t.visit(t.ADD,(function(t){u(t,e),s(t,e)})),n.modifies(u.output),n.modifies(s.output),l!==ye.s&&l!==s&&(t.visit(t.ADD,(function(t){l(t,e)})),n.modifies(l.output))),t.changed(t.REM)&&c!==ye.s&&(t.visit(t.REM,(function(t){c(t,e)})),n.modifies(c.output)),o||l!==ye.s){var f=t.MOD|(e.modified()?t.REFLOW:0);o?(t.visit(f,(function(t){var i=u(t,e)||r;(l(t,e)||i)&&n.mod.push(t)})),n.mod.length&&n.modifies(u.output)):t.visit(f,(function(t){(l(t,e)||r)&&n.mod.push(t)})),n.mod.length&&n.modifies(l.output)}return n.changed()?n:t.StopPropagation}}),Object(ye.z)(Cm,ot,{transform:function(e,t){if(null!=this.value&&!e.modified())return t.StopPropagation;var n,r,i,a,o,s=t.dataflow.locale(),u=t.fork(t.NO_SOURCE|t.NO_FIELDS),c=this.value,l=e.type||lc,f=e.scale,d=+e.limit,h=mc(f,null==e.count?5:e.count,e.minstep),p=!!e.values||l===lc,m=e.format||Ec(s,f,h,l,e.formatSpecifier,e.formatType,p),v=e.values||_c(f,h);return c&&(u.rem=c),l===lc?(d&&v.length>d?(t.dataflow.warn("Symbol legend count exceeds limit, filtering items."),c=v.slice(0,d-1),o=!0):c=v,Object(ye.E)(i=e.size)?(e.values||0!==f(c[0])||(c=c.slice(1)),a=c.reduce((function(t,n){return Math.max(t,i(n,e))}),0)):i=Object(ye.m)(a=i||8),c=c.map((function(t,n){return De({index:n,label:m(t,n,c),value:t,offset:a,size:i(t,e)})})),o&&(o=v[c.length],c.push(De({index:c.length,label:"\u2026".concat(v.length-c.length," entries"),value:o,offset:a,size:i(o,e)})))):"gradient"===l?(n=f.domain(),r=ic(f,n[0],Object(ye.W)(n)),v.length<3&&!e.values&&n[0]!==Object(ye.W)(n)&&(v=[n[0],Object(ye.W)(n)]),c=v.map((function(e,t){return De({index:t,label:m(e,t,v),value:e,perc:r(e)})}))):(i=v.length-1,r=function(e){var t=e.domain(),n=t.length-1,r=+t[0],i=+Object(ye.W)(t),a=i-r;if(e.type===ju){var o=n?a/n:.1;a=(i+=o)-(r-=o)}return function(e){return(e-r)/a}}(f),c=v.map((function(e,t){return De({index:t,label:m(e,t,v),value:e,perc:t?r(e):0,perc2:t===i?1:r(v[t+1])})}))),u.source=c,u.add=c,this.value=c,u}});var Am=function(e){return e.source.x},Om=function(e){return e.source.y},Dm=function(e){return e.target.x},Tm=function(e){return e.target.y};function jm(e){ot.call(this,{},e)}jm.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]},Object(ye.z)(jm,ot,{transform:function(e,t){var n=e.sourceX||Am,r=e.sourceY||Om,i=e.targetX||Dm,a=e.targetY||Tm,o=e.as||"path",s=e.orient||"vertical",u=e.shape||"line",c=Nm.get(u+"-"+s)||Nm.get(u);return c||Object(ye.o)("LinkPath unsupported type: "+e.shape+(e.orient?"-"+e.orient:"")),t.visit(t.SOURCE,(function(e){e[o]=c(n(e),r(e),i(e),a(e))})),t.reflow(e.modified()).modifies(o)}});var Mm=function(e,t,n,r){return"M"+e+","+t+"L"+n+","+r},Fm=function(e,t,n,r){var i=n-e,a=r-t,o=Math.sqrt(i*i+a*a)/2;return"M"+e+","+t+"A"+o+","+o+" "+180*Math.atan2(a,i)/Math.PI+" 0 1 "+n+","+r},Im=function(e,t,n,r){var i=n-e,a=r-t,o=.2*(i+a),s=.2*(a-i);return"M"+e+","+t+"C"+(e+o)+","+(t+s)+" "+(n+s)+","+(r-o)+" "+n+","+r},Nm=Object(ye.t)({line:Mm,"line-radial":function(e,t,n,r){return Mm(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n))},arc:Fm,"arc-radial":function(e,t,n,r){return Fm(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n))},curve:Im,"curve-radial":function(e,t,n,r){return Im(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n))},"orthogonal-horizontal":function(e,t,n,r){return"M"+e+","+t+"V"+r+"H"+n},"orthogonal-vertical":function(e,t,n,r){return"M"+e+","+t+"H"+n+"V"+r},"orthogonal-radial":function(e,t,n,r){var i=Math.cos(e),a=Math.sin(e),o=Math.cos(n),s=Math.sin(n);return"M"+t*i+","+t*a+"A"+t+","+t+" 0 0,"+((Math.abs(n-e)>Math.PI?n<=e:n>e)?1:0)+" "+t*o+","+t*s+"L"+r*o+","+r*s},"diagonal-horizontal":function(e,t,n,r){var i=(e+n)/2;return"M"+e+","+t+"C"+i+","+t+" "+i+","+r+" "+n+","+r},"diagonal-vertical":function(e,t,n,r){var i=(t+r)/2;return"M"+e+","+t+"C"+e+","+i+" "+n+","+i+" "+n+","+r},"diagonal-radial":function(e,t,n,r){var i=Math.cos(e),a=Math.sin(e),o=Math.cos(n),s=Math.sin(n),u=(t+r)/2;return"M"+t*i+","+t*a+"C"+u*i+","+u*a+" "+u*o+","+u*s+" "+r*o+","+r*s}});function Rm(e){ot.call(this,null,e)}Rm.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]},Object(ye.z)(Rm,ot,{transform:function(e,t){var n,r,i,a=e.as||["startAngle","endAngle"],o=a[0],s=a[1],u=e.field||ye.Q,c=e.startAngle||0,l=null!=e.endAngle?e.endAngle:2*Math.PI,f=t.source,d=f.map(u),h=d.length,p=c,m=(l-c)/wm(d),v=pn(h);for(e.sort&&v.sort((function(e,t){return d[e]-d[t]})),n=0;n<h;++n)i=d[v[n]],(r=f[v[n]])[o]=p,r[s]=p+=i*m;return this.value=d,t.reflow(e.modified()).modifies(a)}});var Pm=5;function Bm(e){return Ku(e)&&e!==Au}var Lm=Object(ye.Fa)(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function zm(e){ot.call(this,null,e),this.modified(!0)}function Um(e,t,n){return Ju(e)&&Math.abs(t.reduce((function(e,t){return e+(t<0?-1:t>0?1:0)}),0))!==t.length&&n.warn("Log scale domain includes zero: "+Object(ye.Ba)(t)),t}function Wm(e,t,n){return Object(ye.E)(e)&&(t||n)?tc(e,Vm(t||[0,1],n)):e}function Vm(e,t){return t?e.slice().reverse():e}function Gm(e){ot.call(this,null,e)}Object(ye.z)(zm,ot,{transform:function(e,t){var n=t.dataflow,r=this.value,i=function(e){var t,n=e.type,r="";return n===Au?Au+"-"+xu:(function(e){var t=e.type;return Ku(t)&&t!==Su&&t!==Cu&&(e.scheme||e.range&&e.range.length&&e.range.every(ye.J))}(e)&&(r=2===(t=e.rawDomain?e.rawDomain.length:e.domain?e.domain.length+ +(null!=e.domainMid):0)?Au+"-":3===t?Ou+"-":""),(r+n||xu).toLowerCase())}(e);for(i in r&&i===r.type||(this.value=r=qu(i)()),e)if(!Lm[i]){if("padding"===i&&Bm(r.type))continue;Object(ye.E)(r[i])?r[i](e[i]):n.warn("Unsupported scale property: "+i)}return function(e,t,n){var r=e.type,i=t.round||!1,a=t.range;if(null!=t.rangeStep)a=function(e,t,n){e!==Iu&&e!==Fu&&Object(ye.o)("Only band and point scales support rangeStep.");var r=(null!=t.paddingOuter?t.paddingOuter:t.padding)||0,i=e===Fu?1:(null!=t.paddingInner?t.paddingInner:t.padding)||0;return[0,t.rangeStep*bu(n,i,r)]}(r,t,n);else if(t.scheme&&(a=function(e,t,n){var r,i=t.schemeExtent;return Object(ye.B)(t.scheme)?r=nc(t.scheme,t.interpolate,t.interpolateGamma):(r=cc(t.scheme.toLowerCase()))||Object(ye.o)("Unrecognized scheme name: ".concat(t.scheme)),n=e===ju?n+1:e===Nu?n-1:e===Du||e===Tu?+t.schemeCount||Pm:n,Zu(e)?Wm(r,i,t.reverse):Object(ye.E)(r)?rc(Wm(r,i),n):e===Mu?r:r.slice(0,n)}(r,t,n),Object(ye.E)(a))){if(e.interpolator)return e.interpolator(a);Object(ye.o)("Scale type ".concat(r," does not support interpolating color schemes."))}if(a&&Zu(r))return e.interpolator(nc(Vm(a,t.reverse),t.interpolate,t.interpolateGamma));a&&t.interpolate&&e.interpolate?e.interpolate(ac(t.interpolate,t.interpolateGamma)):Object(ye.E)(e.round)?e.round(i):Object(ye.E)(e.rangeRound)&&e.interpolate(i?po:ho),a&&e.range(Vm(a,t.reverse))}(r,e,function(e,t,n){var r=t.bins;if(r&&!Object(ye.B)(r)){var i=e.domain(),a=i[0],o=Object(ye.W)(i),s=r.step,u=null==r.start?a:r.start,c=null==r.stop?o:r.stop;s||Object(ye.o)("Scale bins parameter missing step property."),u<a&&(u=s*Math.ceil(a/s)),c>o&&(c=s*Math.floor(o/s)),r=pn(u,c+s/2,s)}return r?e.bins=r:e.bins&&delete e.bins,e.type===Nu&&(r?t.domain||t.domainRaw||(e.domain(r),n=r.length):e.bins=e.domain()),n}(r,e,function(e,t,n){var r=function(e,t,n){return t?(e.domain(Um(e.type,t,n)),t.length):-1}(e,t.domainRaw,n);if(r>-1)return r;var i,a,o=t.domain,s=e.type,u=t.zero||void 0===t.zero&&function(e){var t=e.type;return!e.bins&&(t===xu||t===_u||t===ku)}(e);if(!o)return 0;if(Bm(s)&&t.padding&&o[0]!==Object(ye.W)(o)&&(o=function(e,t,n,r,i,a){var o=Math.abs(Object(ye.W)(n)-n[0]),s=o/(o-2*r),u=e===wu?Object(ye.Oa)(t,null,s):e===ku?Object(ye.Pa)(t,null,s,.5):e===_u?Object(ye.Pa)(t,null,s,i||1):e===Eu?Object(ye.Qa)(t,null,s,a||1):Object(ye.Na)(t,null,s);return(t=t.slice())[0]=u[0],t[t.length-1]=u[1],t}(s,o,t.range,t.padding,t.exponent,t.constant)),(u||null!=t.domainMin||null!=t.domainMax||null!=t.domainMid)&&(i=(o=o.slice()).length-1||1,u&&(o[0]>0&&(o[0]=0),o[i]<0&&(o[i]=0)),null!=t.domainMin&&(o[0]=t.domainMin),null!=t.domainMax&&(o[i]=t.domainMax),null!=t.domainMid)){var c=(a=t.domainMid)>o[i]?i+1:a<o[0]?0:i;c!==i&&n.warn("Scale domainMid exceeds domain min or max.",a),o.splice(c,0,a)}return e.domain(Um(s,o,n)),s===Mu&&e.unknown(t.domainImplicit?ca:void 0),t.nice&&e.nice&&e.nice(!0!==t.nice&&mc(e,t.nice)||null),o.length}(r,e,n))),t.fork(t.NO_SOURCE|t.NO_FIELDS)}}),Object(ye.z)(Gm,ot,{transform:function(e,t){var n=e.modified("sort")||t.changed(t.ADD)||t.modified(e.sort.fields)||t.modified("datum");return n&&t.source.sort(Fe(e.sort)),this.modified(n),t}});var qm=["y0","y1"];function Hm(e){ot.call(this,null,e)}function Xm(e,t,n,r,i){for(var a,o=(t-e.sum)/2,s=e.length,u=0;u<s;++u)(a=e[u])[r]=o,a[i]=o+=Math.abs(n(a))}function Km(e,t,n,r,i){for(var a,o=1/e.sum,s=0,u=e.length,c=0,l=0;c<u;++c)(a=e[c])[r]=s,a[i]=s=o*(l+=Math.abs(n(a)))}function Ym(e,t,n,r,i){for(var a,o,s=0,u=0,c=e.length,l=0;l<c;++l)(a=+n(o=e[l]))<0?(o[r]=u,o[i]=u+=a):(o[r]=s,o[i]=s+=a)}Hm.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:"zero",values:["zero","center","normalize"]},{name:"as",type:"string",array:!0,length:2,default:qm}]},Object(ye.z)(Hm,ot,{transform:function(e,t){var n,r,i,a,o=e.as||qm,s=o[0],u=o[1],c=Fe(e.sort),l=e.field||ye.Q,f="center"===e.offset?Xm:"normalize"===e.offset?Km:Ym;for(n=function(e,t,n,r){var i,a,o,s,u,c,l,f,d,h=[],p=function(e){return e(u)};if(null==t)h.push(e.slice());else for(i={},a=0,o=e.length;a<o;++a)u=e[a],(l=i[c=t.map(p)])||(i[c]=l=[],h.push(l)),l.push(u);for(c=0,d=0,s=h.length;c<s;++c){for(a=0,f=0,o=(l=h[c]).length;a<o;++a)f+=Math.abs(r(l[a]));l.sum=f,f>d&&(d=f),n&&l.sort(n)}return h.max=d,h}(t.source,e.groupby,c,l),r=0,i=n.length,a=n.max;r<i;++r)f(n[r],a,l,s,u);return t.reflow(e.modified()).modifies(o)}});var $m=function(e){return e};function Jm(e,t){e&&Qm.hasOwnProperty(e.type)&&Qm[e.type](e,t)}var Zm={Feature:function(e,t){Jm(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,r=-1,i=n.length;++r<i;)Jm(n[r].geometry,t)}},Qm={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)e=n[r],t.point(e[0],e[1],e[2])},LineString:function(e,t){ev(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)ev(n[r],t,0)},Polygon:function(e,t){tv(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)tv(n[r],t)},GeometryCollection:function(e,t){for(var n=e.geometries,r=-1,i=n.length;++r<i;)Jm(n[r],t)}};function ev(e,t,n){var r,i=-1,a=e.length-n;for(t.lineStart();++i<a;)r=e[i],t.point(r[0],r[1],r[2]);t.lineEnd()}function tv(e,t){var n=-1,r=e.length;for(t.polygonStart();++n<r;)ev(e[n],t,1);t.polygonEnd()}var nv=function(e,t){e&&Zm.hasOwnProperty(e.type)?Zm[e.type](e,t):Jm(e,t)},rv=function(){function e(){v(this,e),this._partials=new Float64Array(32),this._n=0}return g(e,[{key:"add",value:function(e){for(var t=this._partials,n=0,r=0;r<this._n&&r<32;r++){var i=t[r],a=e+i,o=Math.abs(e)<Math.abs(i)?e-(a-i):i-(a-e);o&&(t[n++]=o),e=a}return t[n]=e,this._n=n+1,this}},{key:"valueOf",value:function(){var e,t,n,r=this._partials,i=this._n,a=0;if(i>0){for(a=r[--i];i>0&&(e=a,!(n=(t=r[--i])-((a=e+t)-e))););i>0&&(n<0&&r[i-1]<0||n>0&&r[i-1]>0)&&(t=2*n)==(e=a+t)-a&&(a=e)}return a}}]),e}(),iv=1e-6,av=Math.PI,ov=av/2,sv=av/4,uv=2*av,cv=180/av,lv=av/180,fv=Math.abs,dv=Math.atan,hv=Math.atan2,pv=Math.cos,mv=Math.ceil,vv=Math.exp,gv=(Math.floor,Math.hypot),yv=Math.log,bv=Math.pow,xv=Math.sin,wv=Math.sign||function(e){return e>0?1:e<0?-1:0},_v=Math.sqrt,kv=Math.tan;function Ev(e){return e>1?0:e<-1?av:Math.acos(e)}function Sv(e){return e>1?ov:e<-1?-ov:Math.asin(e)}function Cv(){}var Av,Ov,Dv,Tv,jv=new rv,Mv=new rv,Fv={point:Cv,lineStart:Cv,lineEnd:Cv,polygonStart:function(){Fv.lineStart=Iv,Fv.lineEnd=Pv},polygonEnd:function(){Fv.lineStart=Fv.lineEnd=Fv.point=Cv,jv.add(fv(Mv)),Mv=new rv},result:function(){var e=jv/2;return jv=new rv,e}};function Iv(){Fv.point=Nv}function Nv(e,t){Fv.point=Rv,Av=Dv=e,Ov=Tv=t}function Rv(e,t){Mv.add(Tv*e-Dv*t),Dv=e,Tv=t}function Pv(){Rv(Av,Ov)}var Bv,Lv,zv,Uv,Wv=Fv,Vv=1/0,Gv=Vv,qv=-Vv,Hv=qv,Xv={point:function(e,t){e<Vv&&(Vv=e),e>qv&&(qv=e),t<Gv&&(Gv=t),t>Hv&&(Hv=t)},lineStart:Cv,lineEnd:Cv,polygonStart:Cv,polygonEnd:Cv,result:function(){var e=[[Vv,Gv],[qv,Hv]];return qv=Hv=-(Gv=Vv=1/0),e}},Kv=0,Yv=0,$v=0,Jv=0,Zv=0,Qv=0,eg=0,tg=0,ng=0,rg={point:ig,lineStart:ag,lineEnd:ug,polygonStart:function(){rg.lineStart=cg,rg.lineEnd=lg},polygonEnd:function(){rg.point=ig,rg.lineStart=ag,rg.lineEnd=ug},result:function(){var e=ng?[eg/ng,tg/ng]:Qv?[Jv/Qv,Zv/Qv]:$v?[Kv/$v,Yv/$v]:[NaN,NaN];return Kv=Yv=$v=Jv=Zv=Qv=eg=tg=ng=0,e}};function ig(e,t){Kv+=e,Yv+=t,++$v}function ag(){rg.point=og}function og(e,t){rg.point=sg,ig(zv=e,Uv=t)}function sg(e,t){var n=e-zv,r=t-Uv,i=_v(n*n+r*r);Jv+=i*(zv+e)/2,Zv+=i*(Uv+t)/2,Qv+=i,ig(zv=e,Uv=t)}function ug(){rg.point=ig}function cg(){rg.point=fg}function lg(){dg(Bv,Lv)}function fg(e,t){rg.point=dg,ig(Bv=zv=e,Lv=Uv=t)}function dg(e,t){var n=e-zv,r=t-Uv,i=_v(n*n+r*r);Jv+=i*(zv+e)/2,Zv+=i*(Uv+t)/2,Qv+=i,eg+=(i=Uv*e-zv*t)*(zv+e),tg+=i*(Uv+t),ng+=3*i,ig(zv=e,Uv=t)}var hg=rg;function pg(e){this._context=e}pg.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._context.moveTo(e,t),this._point=1;break;case 1:this._context.lineTo(e,t);break;default:this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,uv)}},result:Cv};var mg,vg,gg,yg,bg,xg=new rv,wg={point:Cv,lineStart:function(){wg.point=_g},lineEnd:function(){mg&&kg(vg,gg),wg.point=Cv},polygonStart:function(){mg=!0},polygonEnd:function(){mg=null},result:function(){var e=+xg;return xg=new rv,e}};function _g(e,t){wg.point=kg,vg=yg=e,gg=bg=t}function kg(e,t){yg-=e,bg-=t,xg.add(_v(yg*yg+bg*bg)),yg=e,bg=t}var Eg=wg;function Sg(){this._string=[]}function Cg(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}Sg.prototype={_radius:4.5,_circle:Cg(4.5),pointRadius:function(e){return(e=+e)!==this._radius&&(this._radius=e,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._string.push("M",e,",",t),this._point=1;break;case 1:this._string.push("L",e,",",t);break;default:null==this._circle&&(this._circle=Cg(this._radius)),this._string.push("M",e,",",t,this._circle)}},result:function(){if(this._string.length){var e=this._string.join("");return this._string=[],e}return null}};var Ag=function(e,t){var n,r,i=4.5;function a(e){return e&&("function"==typeof i&&r.pointRadius(+i.apply(this,arguments)),nv(e,n(r))),r.result()}return a.area=function(e){return nv(e,n(Wv)),Wv.result()},a.measure=function(e){return nv(e,n(Eg)),Eg.result()},a.bounds=function(e){return nv(e,n(Xv)),Xv.result()},a.centroid=function(e){return nv(e,n(hg)),hg.result()},a.projection=function(t){return arguments.length?(n=null==t?(e=null,$m):(e=t).stream,a):e},a.context=function(e){return arguments.length?(r=null==e?(t=null,new Sg):new pg(t=e),"function"!=typeof i&&r.pointRadius(i),a):t},a.pointRadius=function(e){return arguments.length?(i="function"==typeof e?e:(r.pointRadius(+e),+e),a):i},a.projection(e).context(t)},Og=function(){var e,t=[];return{point:function(t,n,r){e.push([t,n,r])},lineStart:function(){t.push(e=[])},lineEnd:Cv,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var n=t;return t=[],e=null,n}}},Dg=function(e,t){return fv(e[0]-t[0])<iv&&fv(e[1]-t[1])<iv};function Tg(e,t,n,r){this.x=e,this.z=t,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}var jg=function(e,t,n,r,i){var a,o,s=[],u=[];if(e.forEach((function(e){if(!((t=e.length-1)<=0)){var t,n,r=e[0],o=e[t];if(Dg(r,o)){if(!r[2]&&!o[2]){for(i.lineStart(),a=0;a<t;++a)i.point((r=e[a])[0],r[1]);return void i.lineEnd()}o[0]+=2*iv}s.push(n=new Tg(r,e,null,!0)),u.push(n.o=new Tg(r,null,n,!1)),s.push(n=new Tg(o,e,null,!1)),u.push(n.o=new Tg(o,null,n,!0))}})),s.length){for(u.sort(t),Mg(s),Mg(u),a=0,o=u.length;a<o;++a)u[a].e=n=!n;for(var c,l,f=s[0];;){for(var d=f,h=!0;d.v;)if((d=d.n)===f)return;c=d.z,i.lineStart();do{if(d.v=d.o.v=!0,d.e){if(h)for(a=0,o=c.length;a<o;++a)i.point((l=c[a])[0],l[1]);else r(d.x,d.n.x,1,i);d=d.n}else{if(h)for(c=d.p.z,a=c.length-1;a>=0;--a)i.point((l=c[a])[0],l[1]);else r(d.x,d.p.x,-1,i);d=d.p}c=(d=d.o).z,h=!h}while(!d.v);i.lineEnd()}}};function Mg(e){if(t=e.length){for(var t,n,r=0,i=e[0];++r<t;)i.n=n=e[r],n.p=i,i=n;i.n=n=e[0],n.p=i}}function Fg(e){return[hv(e[1],e[0]),Sv(e[2])]}function Ig(e){var t=e[0],n=e[1],r=pv(n);return[r*pv(t),r*xv(t),xv(n)]}function Ng(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Rg(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function Pg(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function Bg(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function Lg(e){var t=_v(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}function zg(e){return fv(e[0])<=av?e[0]:wv(e[0])*((fv(e[0])+av)%uv-av)}function Ug(e){return Array.from(m().mark((function e(t){var n,r,i;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=p(t),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=8;break}return i=r.value,e.delegateYield(i,"t0",6);case 6:e.next=3;break;case 8:e.next=13;break;case 10:e.prev=10,e.t1=e.catch(1),n.e(e.t1);case 13:return e.prev=13,n.f(),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[1,10,13,16]])}))(e))}var Wg=function(e,t,n,r){return function(i){var a,o,s,u=t(i),c=Og(),l=t(c),f=!1,d={point:h,lineStart:m,lineEnd:v,polygonStart:function(){d.point=g,d.lineStart=y,d.lineEnd=b,o=[],a=[]},polygonEnd:function(){d.point=h,d.lineStart=m,d.lineEnd=v,o=Ug(o);var e=function(e,t){var n=zg(t),r=t[1],i=xv(r),a=[xv(n),-pv(n),0],o=0,s=0,u=new rv;1===i?r=ov+iv:-1===i&&(r=-ov-iv);for(var c=0,l=e.length;c<l;++c)if(d=(f=e[c]).length)for(var f,d,h=f[d-1],p=zg(h),m=h[1]/2+sv,v=xv(m),g=pv(m),y=0;y<d;++y,p=x,v=_,g=k,h=b){var b=f[y],x=zg(b),w=b[1]/2+sv,_=xv(w),k=pv(w),E=x-p,S=E>=0?1:-1,C=S*E,A=C>av,O=v*_;if(u.add(hv(O*S*xv(C),g*k+O*pv(C))),o+=A?E+S*uv:E,A^p>=n^x>=n){var D=Rg(Ig(h),Ig(b));Lg(D);var T=Rg(a,D);Lg(T);var j=(A^E>=0?-1:1)*Sv(T[2]);(r>j||r===j&&(D[0]||D[1]))&&(s+=A^E>=0?1:-1)}}return(o<-iv||o<iv&&u<-1e-12)^1&s}(a,r);o.length?(f||(i.polygonStart(),f=!0),jg(o,Gg,e,n,i)):e&&(f||(i.polygonStart(),f=!0),i.lineStart(),n(null,null,1,i),i.lineEnd()),f&&(i.polygonEnd(),f=!1),o=a=null},sphere:function(){i.polygonStart(),i.lineStart(),n(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function h(t,n){e(t,n)&&i.point(t,n)}function p(e,t){u.point(e,t)}function m(){d.point=p,u.lineStart()}function v(){d.point=h,u.lineEnd()}function g(e,t){s.push([e,t]),l.point(e,t)}function y(){l.lineStart(),s=[]}function b(){g(s[0][0],s[0][1]),l.lineEnd();var e,t,n,r,u=l.clean(),d=c.result(),h=d.length;if(s.pop(),a.push(s),s=null,h)if(1&u){if((t=(n=d[0]).length-1)>0){for(f||(i.polygonStart(),f=!0),i.lineStart(),e=0;e<t;++e)i.point((r=n[e])[0],r[1]);i.lineEnd()}}else h>1&&2&u&&d.push(d.pop().concat(d.shift())),o.push(d.filter(Vg))}return d}};function Vg(e){return e.length>1}function Gg(e,t){return((e=e.x)[0]<0?e[1]-ov-iv:ov-e[1])-((t=t.x)[0]<0?t[1]-ov-iv:ov-t[1])}var qg=Wg((function(){return!0}),(function(e){var t,n=NaN,r=NaN,i=NaN;return{lineStart:function(){e.lineStart(),t=1},point:function(a,o){var s=a>0?av:-av,u=fv(a-n);fv(u-av)<iv?(e.point(n,r=(r+o)/2>0?ov:-ov),e.point(i,r),e.lineEnd(),e.lineStart(),e.point(s,r),e.point(a,r),t=0):i!==s&&u>=av&&(fv(n-i)<iv&&(n-=i*iv),fv(a-s)<iv&&(a-=s*iv),r=function(e,t,n,r){var i,a,o=xv(e-n);return fv(o)>iv?dv((xv(t)*(a=pv(r))*xv(n)-xv(r)*(i=pv(t))*xv(e))/(i*a*o)):(t+r)/2}(n,r,a,o),e.point(i,r),e.lineEnd(),e.lineStart(),e.point(s,r),t=0),e.point(n=a,r=o),i=s},lineEnd:function(){e.lineEnd(),n=r=NaN},clean:function(){return 2-t}}}),(function(e,t,n,r){var i;if(null==e)i=n*ov,r.point(-av,i),r.point(0,i),r.point(av,i),r.point(av,0),r.point(av,-i),r.point(0,-i),r.point(-av,-i),r.point(-av,0),r.point(-av,i);else if(fv(e[0]-t[0])>iv){var a=e[0]<t[0]?av:-av;i=n*a/2,r.point(-a,i),r.point(0,i),r.point(a,i)}else r.point(t[0],t[1])}),[-av,-ov]),Hg=function(e,t){function n(n,r){return n=e(n,r),t(n[0],n[1])}return e.invert&&t.invert&&(n.invert=function(n,r){return(n=t.invert(n,r))&&e.invert(n[0],n[1])}),n};function Xg(e,t){return[fv(e)>av?e+Math.round(-e/uv)*uv:e,t]}function Kg(e,t,n){return(e%=uv)?t||n?Hg($g(e),Jg(t,n)):$g(e):t||n?Jg(t,n):Xg}function Yg(e){return function(t,n){return[(t+=e)>av?t-uv:t<-av?t+uv:t,n]}}function $g(e){var t=Yg(e);return t.invert=Yg(-e),t}function Jg(e,t){var n=pv(e),r=xv(e),i=pv(t),a=xv(t);function o(e,t){var o=pv(t),s=pv(e)*o,u=xv(e)*o,c=xv(t),l=c*n+s*r;return[hv(u*i-l*a,s*n-c*r),Sv(l*i+u*a)]}return o.invert=function(e,t){var o=pv(t),s=pv(e)*o,u=xv(e)*o,c=xv(t),l=c*i-u*a;return[hv(u*i+c*a,s*n+l*r),Sv(l*n-s*r)]},o}Xg.invert=Xg;var Zg=function(e){function t(t){return(t=e(t[0]*lv,t[1]*lv))[0]*=cv,t[1]*=cv,t}return e=Kg(e[0]*lv,e[1]*lv,e.length>2?e[2]*lv:0),t.invert=function(t){return(t=e.invert(t[0]*lv,t[1]*lv))[0]*=cv,t[1]*=cv,t},t};function Qg(e,t,n,r,i,a){if(n){var o=pv(t),s=xv(t),u=r*n;null==i?(i=t+r*uv,a=t-u/2):(i=ey(o,i),a=ey(o,a),(r>0?i<a:i>a)&&(i+=r*uv));for(var c,l=i;r>0?l>a:l<a;l-=u)c=Fg([o,-s*pv(l),-s*xv(l)]),e.point(c[0],c[1])}}function ey(e,t){(t=Ig(t))[0]-=e,Lg(t);var n=Ev(-t[1]);return((-t[2]<0?-n:n)+uv-iv)%uv}var ty=function(e){var t=pv(e),n=6*lv,r=t>0,i=fv(t)>iv;function a(e,n){return pv(e)*pv(n)>t}function o(e,n,r){var i=[1,0,0],a=Rg(Ig(e),Ig(n)),o=Ng(a,a),s=a[0],u=o-s*s;if(!u)return!r&&e;var c=t*o/u,l=-t*s/u,f=Rg(i,a),d=Bg(i,c);Pg(d,Bg(a,l));var h=f,p=Ng(d,h),m=Ng(h,h),v=p*p-m*(Ng(d,d)-1);if(!(v<0)){var g=_v(v),y=Bg(h,(-p-g)/m);if(Pg(y,d),y=Fg(y),!r)return y;var b,x=e[0],w=n[0],_=e[1],k=n[1];w<x&&(b=x,x=w,w=b);var E=w-x,S=fv(E-av)<iv;if(!S&&k<_&&(b=_,_=k,k=b),S||E<iv?S?_+k>0^y[1]<(fv(y[0]-x)<iv?_:k):_<=y[1]&&y[1]<=k:E>av^(x<=y[0]&&y[0]<=w)){var C=Bg(h,(-p+g)/m);return Pg(C,d),[y,Fg(C)]}}}function s(t,n){var i=r?e:av-e,a=0;return t<-i?a|=1:t>i&&(a|=2),n<-i?a|=4:n>i&&(a|=8),a}return Wg(a,(function(e){var t,n,u,c,l;return{lineStart:function(){c=u=!1,l=1},point:function(f,d){var h,p=[f,d],m=a(f,d),v=r?m?0:s(f,d):m?s(f+(f<0?av:-av),d):0;if(!t&&(c=u=m)&&e.lineStart(),m!==u&&(!(h=o(t,p))||Dg(t,h)||Dg(p,h))&&(p[2]=1),m!==u)l=0,m?(e.lineStart(),h=o(p,t),e.point(h[0],h[1])):(h=o(t,p),e.point(h[0],h[1],2),e.lineEnd()),t=h;else if(i&&t&&r^m){var g;v&n||!(g=o(p,t,!0))||(l=0,r?(e.lineStart(),e.point(g[0][0],g[0][1]),e.point(g[1][0],g[1][1]),e.lineEnd()):(e.point(g[1][0],g[1][1]),e.lineEnd(),e.lineStart(),e.point(g[0][0],g[0][1],3)))}!m||t&&Dg(t,p)||e.point(p[0],p[1]),t=p,u=m,n=v},lineEnd:function(){u&&e.lineEnd(),t=null},clean:function(){return l|(c&&u)<<1}}}),(function(t,r,i,a){Qg(a,e,n,i,t,r)}),r?[0,-e]:[-av,e-av])},ny=function(e,t,n,r,i,a){var o,s=e[0],u=e[1],c=0,l=1,f=t[0]-s,d=t[1]-u;if(o=n-s,f||!(o>0)){if(o/=f,f<0){if(o<c)return;o<l&&(l=o)}else if(f>0){if(o>l)return;o>c&&(c=o)}if(o=i-s,f||!(o<0)){if(o/=f,f<0){if(o>l)return;o>c&&(c=o)}else if(f>0){if(o<c)return;o<l&&(l=o)}if(o=r-u,d||!(o>0)){if(o/=d,d<0){if(o<c)return;o<l&&(l=o)}else if(d>0){if(o>l)return;o>c&&(c=o)}if(o=a-u,d||!(o<0)){if(o/=d,d<0){if(o>l)return;o>c&&(c=o)}else if(d>0){if(o<c)return;o<l&&(l=o)}return c>0&&(e[0]=s+c*f,e[1]=u+c*d),l<1&&(t[0]=s+l*f,t[1]=u+l*d),!0}}}}},ry=1e9,iy=-ry;function ay(e,t,n,r){function i(i,a){return e<=i&&i<=n&&t<=a&&a<=r}function a(i,a,s,c){var l=0,f=0;if(null==i||(l=o(i,s))!==(f=o(a,s))||u(i,a)<0^s>0)do{c.point(0===l||3===l?e:n,l>1?r:t)}while((l=(l+s+4)%4)!==f);else c.point(a[0],a[1])}function o(r,i){return fv(r[0]-e)<iv?i>0?0:3:fv(r[0]-n)<iv?i>0?2:1:fv(r[1]-t)<iv?i>0?1:0:i>0?3:2}function s(e,t){return u(e.x,t.x)}function u(e,t){var n=o(e,1),r=o(t,1);return n!==r?n-r:0===n?t[1]-e[1]:1===n?e[0]-t[0]:2===n?e[1]-t[1]:t[0]-e[0]}return function(o){var u,c,l,f,d,h,p,m,v,g,y,b=o,x=Og(),w={point:_,lineStart:function(){w.point=k,c&&c.push(l=[]),g=!0,v=!1,p=m=NaN},lineEnd:function(){u&&(k(f,d),h&&v&&x.rejoin(),u.push(x.result())),w.point=_,v&&b.lineEnd()},polygonStart:function(){b=x,u=[],c=[],y=!0},polygonEnd:function(){var t=function(){for(var t=0,n=0,i=c.length;n<i;++n)for(var a,o,s=c[n],u=1,l=s.length,f=s[0],d=f[0],h=f[1];u<l;++u)a=d,o=h,d=(f=s[u])[0],h=f[1],o<=r?h>r&&(d-a)*(r-o)>(h-o)*(e-a)&&++t:h<=r&&(d-a)*(r-o)<(h-o)*(e-a)&&--t;return t}(),n=y&&t,i=(u=Ug(u)).length;(n||i)&&(o.polygonStart(),n&&(o.lineStart(),a(null,null,1,o),o.lineEnd()),i&&jg(u,s,t,a,o),o.polygonEnd()),b=o,u=c=l=null}};function _(e,t){i(e,t)&&b.point(e,t)}function k(a,o){var s=i(a,o);if(c&&l.push([a,o]),g)f=a,d=o,h=s,g=!1,s&&(b.lineStart(),b.point(a,o));else if(s&&v)b.point(a,o);else{var u=[p=Math.max(iy,Math.min(ry,p)),m=Math.max(iy,Math.min(ry,m))],x=[a=Math.max(iy,Math.min(ry,a)),o=Math.max(iy,Math.min(ry,o))];ny(u,x,e,t,n,r)?(v||(b.lineStart(),b.point(u[0],u[1])),b.point(x[0],x[1]),s||b.lineEnd(),y=!1):s&&(b.lineStart(),b.point(a,o),y=!1)}p=a,m=o,v=s}return w}}function oy(e){return function(t){var n=new sy;for(var r in e)n[r]=e[r];return n.stream=t,n}}function sy(){}function uy(e,t,n){var r=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),null!=r&&e.clipExtent(null),nv(n,e.stream(Xv)),t(Xv.result()),null!=r&&e.clipExtent(r),e}function cy(e,t,n){return uy(e,(function(n){var r=t[1][0]-t[0][0],i=t[1][1]-t[0][1],a=Math.min(r/(n[1][0]-n[0][0]),i/(n[1][1]-n[0][1])),o=+t[0][0]+(r-a*(n[1][0]+n[0][0]))/2,s=+t[0][1]+(i-a*(n[1][1]+n[0][1]))/2;e.scale(150*a).translate([o,s])}),n)}function ly(e,t,n){return cy(e,[[0,0],t],n)}function fy(e,t,n){return uy(e,(function(n){var r=+t,i=r/(n[1][0]-n[0][0]),a=(r-i*(n[1][0]+n[0][0]))/2,o=-i*n[0][1];e.scale(150*i).translate([a,o])}),n)}function dy(e,t,n){return uy(e,(function(n){var r=+t,i=r/(n[1][1]-n[0][1]),a=-i*n[0][0],o=(r-i*(n[1][1]+n[0][1]))/2;e.scale(150*i).translate([a,o])}),n)}sy.prototype={constructor:sy,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var hy=16,py=pv(30*lv),my=function(e,t){return+t?function(e,t){function n(r,i,a,o,s,u,c,l,f,d,h,p,m,v){var g=c-r,y=l-i,b=g*g+y*y;if(b>4*t&&m--){var x=o+d,w=s+h,_=u+p,k=_v(x*x+w*w+_*_),E=Sv(_/=k),S=fv(fv(_)-1)<iv||fv(a-f)<iv?(a+f)/2:hv(w,x),C=e(S,E),A=C[0],O=C[1],D=A-r,T=O-i,j=y*D-g*T;(j*j/b>t||fv((g*D+y*T)/b-.5)>.3||o*d+s*h+u*p<py)&&(n(r,i,a,o,s,u,A,O,S,x/=k,w/=k,_,m,v),v.point(A,O),n(A,O,S,x,w,_,c,l,f,d,h,p,m,v))}}return function(t){var r,i,a,o,s,u,c,l,f,d,h,p,m={point:v,lineStart:g,lineEnd:b,polygonStart:function(){t.polygonStart(),m.lineStart=x},polygonEnd:function(){t.polygonEnd(),m.lineStart=g}};function v(n,r){n=e(n,r),t.point(n[0],n[1])}function g(){l=NaN,m.point=y,t.lineStart()}function y(r,i){var a=Ig([r,i]),o=e(r,i);n(l,f,c,d,h,p,l=o[0],f=o[1],c=r,d=a[0],h=a[1],p=a[2],hy,t),t.point(l,f)}function b(){m.point=v,t.lineEnd()}function x(){g(),m.point=w,m.lineEnd=_}function w(e,t){y(r=e,t),i=l,a=f,o=d,s=h,u=p,m.point=y}function _(){n(l,f,c,d,h,p,i,a,r,o,s,u,hy,t),m.lineEnd=b,b()}return m}}(e,t):function(e){return oy({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}(e)},vy=oy({point:function(e,t){this.stream.point(e*lv,t*lv)}});function gy(e,t,n,r,i,a){if(!a)return function(e,t,n,r,i){function a(a,o){return[t+e*(a*=r),n-e*(o*=i)]}return a.invert=function(a,o){return[(a-t)/e*r,(n-o)/e*i]},a}(e,t,n,r,i);var o=pv(a),s=xv(a),u=o*e,c=s*e,l=o/e,f=s/e,d=(s*n-o*t)/e,h=(s*t+o*n)/e;function p(e,a){return[u*(e*=r)-c*(a*=i)+t,n-c*e-u*a]}return p.invert=function(e,t){return[r*(l*e-f*t+d),i*(h-f*e-l*t)]},p}function yy(e){return by((function(){return e}))()}function by(e){var t,n,r,i,a,o,s,u,c,l,f=150,d=480,h=250,p=0,m=0,v=0,g=0,y=0,b=0,x=1,w=1,_=null,k=qg,E=null,S=$m,C=.5;function A(e){return u(e[0]*lv,e[1]*lv)}function O(e){return(e=u.invert(e[0],e[1]))&&[e[0]*cv,e[1]*cv]}function D(){var e=gy(f,0,0,x,w,b).apply(null,t(p,m)),r=gy(f,d-e[0],h-e[1],x,w,b);return n=Kg(v,g,y),s=Hg(t,r),u=Hg(n,s),o=my(s,C),T()}function T(){return c=l=null,A}return A.stream=function(e){return c&&l===e?c:c=vy(function(e){return oy({point:function(t,n){var r=e(t,n);return this.stream.point(r[0],r[1])}})}(n)(k(o(S(l=e)))))},A.preclip=function(e){return arguments.length?(k=e,_=void 0,T()):k},A.postclip=function(e){return arguments.length?(S=e,E=r=i=a=null,T()):S},A.clipAngle=function(e){return arguments.length?(k=+e?ty(_=e*lv):(_=null,qg),T()):_*cv},A.clipExtent=function(e){return arguments.length?(S=null==e?(E=r=i=a=null,$m):ay(E=+e[0][0],r=+e[0][1],i=+e[1][0],a=+e[1][1]),T()):null==E?null:[[E,r],[i,a]]},A.scale=function(e){return arguments.length?(f=+e,D()):f},A.translate=function(e){return arguments.length?(d=+e[0],h=+e[1],D()):[d,h]},A.center=function(e){return arguments.length?(p=e[0]%360*lv,m=e[1]%360*lv,D()):[p*cv,m*cv]},A.rotate=function(e){return arguments.length?(v=e[0]%360*lv,g=e[1]%360*lv,y=e.length>2?e[2]%360*lv:0,D()):[v*cv,g*cv,y*cv]},A.angle=function(e){return arguments.length?(b=e%360*lv,D()):b*cv},A.reflectX=function(e){return arguments.length?(x=e?-1:1,D()):x<0},A.reflectY=function(e){return arguments.length?(w=e?-1:1,D()):w<0},A.precision=function(e){return arguments.length?(o=my(s,C=e*e),T()):_v(C)},A.fitExtent=function(e,t){return cy(A,e,t)},A.fitSize=function(e,t){return ly(A,e,t)},A.fitWidth=function(e,t){return fy(A,e,t)},A.fitHeight=function(e,t){return dy(A,e,t)},function(){return t=e.apply(this,arguments),A.invert=t.invert&&O,D()}}function xy(e){var t=0,n=av/3,r=by(e),i=r(t,n);return i.parallels=function(e){return arguments.length?r(t=e[0]*lv,n=e[1]*lv):[t*cv,n*cv]},i}function wy(e,t){var n=xv(e),r=(n+xv(t))/2;if(fv(r)<iv)return function(e){var t=pv(e);function n(e,n){return[e*t,xv(n)/t]}return n.invert=function(e,n){return[e/t,Sv(n*t)]},n}(e);var i=1+n*(2*r-n),a=_v(i)/r;function o(e,t){var n=_v(i-2*r*xv(t))/r;return[n*xv(e*=r),a-n*pv(e)]}return o.invert=function(e,t){var n=a-t,o=hv(e,fv(n))*wv(n);return n*r<0&&(o-=av*wv(e)*wv(n)),[o/r,Sv((i-(e*e+n*n)*r*r)/(2*r))]},o}var _y=function(){return xy(wy).scale(155.424).center([0,33.6442])},ky=function(){return _y().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])};function Ey(e){return function(t,n){var r=pv(t),i=pv(n),a=e(r*i);return a===1/0?[2,0]:[a*i*xv(t),a*xv(n)]}}function Sy(e){return function(t,n){var r=_v(t*t+n*n),i=e(r),a=xv(i),o=pv(i);return[hv(t*a,r*o),Sv(r&&n*a/r)]}}var Cy=Ey((function(e){return _v(2/(1+e))}));Cy.invert=Sy((function(e){return 2*Sv(e/2)}));var Ay=Ey((function(e){return(e=Ev(e))&&e/xv(e)}));function Oy(e,t){return[e,yv(kv((ov+t)/2))]}function Dy(e){var t,n,r,i=yy(e),a=i.center,o=i.scale,s=i.translate,u=i.clipExtent,c=null;function l(){var a=av*o(),s=i(Zg(i.rotate()).invert([0,0]));return u(null==c?[[s[0]-a,s[1]-a],[s[0]+a,s[1]+a]]:e===Oy?[[Math.max(s[0]-a,c),t],[Math.min(s[0]+a,n),r]]:[[c,Math.max(s[1]-a,t)],[n,Math.min(s[1]+a,r)]])}return i.scale=function(e){return arguments.length?(o(e),l()):o()},i.translate=function(e){return arguments.length?(s(e),l()):s()},i.center=function(e){return arguments.length?(a(e),l()):a()},i.clipExtent=function(e){return arguments.length?(null==e?c=t=n=r=null:(c=+e[0][0],t=+e[0][1],n=+e[1][0],r=+e[1][1]),l()):null==c?null:[[c,t],[n,r]]},l()}function Ty(e){return kv((ov+e)/2)}function jy(e,t){var n=pv(e),r=e===t?xv(e):yv(n/pv(t))/yv(Ty(t)/Ty(e)),i=n*bv(Ty(e),r)/r;if(!r)return Oy;function a(e,t){i>0?t<-ov+iv&&(t=-ov+iv):t>ov-iv&&(t=ov-iv);var n=i/bv(Ty(t),r);return[n*xv(r*e),i-n*pv(r*e)]}return a.invert=function(e,t){var n=i-t,a=wv(r)*_v(e*e+n*n),o=hv(e,fv(n))*wv(n);return n*r<0&&(o-=av*wv(e)*wv(n)),[o/r,2*dv(bv(i/a,1/r))-ov]},a}function My(e,t){return[e,t]}function Fy(e,t){var n=pv(e),r=e===t?xv(e):(n-pv(t))/(t-e),i=n/r+e;if(fv(r)<iv)return My;function a(e,t){var n=i-t,a=r*e;return[n*xv(a),i-n*pv(a)]}return a.invert=function(e,t){var n=i-t,a=hv(e,fv(n))*wv(n);return n*r<0&&(a-=av*wv(e)*wv(n)),[a/r,i-wv(r)*_v(e*e+n*n)]},a}Ay.invert=Sy((function(e){return e})),Oy.invert=function(e,t){return[e,2*dv(vv(t))-ov]},My.invert=My;var Iy=1.340264,Ny=-.081106,Ry=893e-6,Py=.003796,By=_v(3)/2;function Ly(e,t){var n=Sv(By*xv(t)),r=n*n,i=r*r*r;return[e*pv(n)/(By*(Iy+3*Ny*r+i*(7*Ry+9*Py*r))),n*(Iy+Ny*r+i*(Ry+Py*r))]}function zy(e,t){var n=pv(t),r=pv(e)*n;return[n*xv(e)/r,xv(t)/r]}function Uy(e,t){var n=t*t,r=n*n;return[e*(.8707-.131979*n+r*(r*(.003971*n-.001529*r)-.013791)),t*(1.007226+n*(.015085+r*(.028874*n-.044475-.005916*r)))]}function Wy(e,t){return[pv(t)*xv(e),xv(t)]}function Vy(e,t){var n=pv(t),r=1+pv(e)*n;return[n*xv(e)/r,xv(t)/r]}function Gy(e,t){return[yv(kv((ov+t)/2)),-e]}Ly.invert=function(e,t){for(var n,r=t,i=r*r,a=i*i*i,o=0;o<12&&(a=(i=(r-=n=(r*(Iy+Ny*i+a*(Ry+Py*i))-t)/(Iy+3*Ny*i+a*(7*Ry+9*Py*i)))*r)*i*i,!(fv(n)<1e-12));++o);return[By*e*(Iy+3*Ny*i+a*(7*Ry+9*Py*i))/pv(r),Sv(xv(r)/By)]},zy.invert=Sy(dv),Uy.invert=function(e,t){var n,r=t,i=25;do{var a=r*r,o=a*a;r-=n=(r*(1.007226+a*(.015085+o*(.028874*a-.044475-.005916*o)))-t)/(1.007226+a*(.045255+o*(.259866*a-.311325-.005916*11*o)))}while(fv(n)>iv&&--i>0);return[e/(.8707+(a=r*r)*(a*(a*a*a*(.003971-.001529*a)-.013791)-.131979)),r]},Wy.invert=Sy(Sv),Vy.invert=Sy((function(e){return 2*dv(e)})),Gy.invert=function(e,t){return[-t,2*dv(vv(e))-ov]};var qy=Math.abs,Hy=(Math.atan,Math.atan2,Math.ceil,Math.cos),Xy=(Math.exp,Math.floor,Math.log,Math.max,Math.min,Math.pow,Math.round,Math.sign,Math.sin),Ky=(Math.tan,1e-6),Yy=Math.PI,$y=Yy/2,Jy=(Math.SQRT1_2,Qy(2));function Zy(e){return e>1?$y:e<-1?-$y:Math.asin(e)}function Qy(e){return e>0?Math.sqrt(e):0}Qy(Yy);var eb=function(e,t,n){function r(r,i){return[e*r*Hy(i=function(e,t){var n,r=e*Xy(t),i=30;do{t-=n=(t+Xy(t)-r)/(1+Hy(t))}while(qy(n)>Ky&&--i>0);return t/2}(n,i)),t*Xy(i)]}return r.invert=function(r,i){return i=Zy(i/t),[r/(e*Hy(i)),Zy((2*i+Xy(2*i))/n)]},r}(Jy/$y,Jy,Yy),tb=Ag(),nb=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function rb(e,t){if(!e||"string"!=typeof e)throw new Error("Projection type must be a name string.");return e=e.toLowerCase(),arguments.length>1?(ab[e]=function(e,t){return function n(){var r=t();return r.type=e,r.path=Ag().projection(r),r.copy=r.copy||function(){var e=n();return nb.forEach((function(t){r[t]&&e[t](r[t]())})),e.path.pointRadius(r.path.pointRadius()),e},r}}(e,t),this):ab[e]||null}function ib(e){return e&&e.path||tb}var ab={albers:ky,albersusa:function(){var e,t,n,r,i,a,o=ky(),s=_y().rotate([154,0]).center([-2,58.5]).parallels([55,65]),u=_y().rotate([157,0]).center([-3,19.9]).parallels([8,18]),c={point:function(e,t){a=[e,t]}};function l(e){var t=e[0],o=e[1];return a=null,n.point(t,o),a||(r.point(t,o),a)||(i.point(t,o),a)}function f(){return e=t=null,l}return l.invert=function(e){var t=o.scale(),n=o.translate(),r=(e[0]-n[0])/t,i=(e[1]-n[1])/t;return(i>=.12&&i<.234&&r>=-.425&&r<-.214?s:i>=.166&&i<.234&&r>=-.214&&r<-.115?u:o).invert(e)},l.stream=function(n){return e&&t===n?e:e=function(e){var t=e.length;return{point:function(n,r){for(var i=-1;++i<t;)e[i].point(n,r)},sphere:function(){for(var n=-1;++n<t;)e[n].sphere()},lineStart:function(){for(var n=-1;++n<t;)e[n].lineStart()},lineEnd:function(){for(var n=-1;++n<t;)e[n].lineEnd()},polygonStart:function(){for(var n=-1;++n<t;)e[n].polygonStart()},polygonEnd:function(){for(var n=-1;++n<t;)e[n].polygonEnd()}}}([o.stream(t=n),s.stream(n),u.stream(n)])},l.precision=function(e){return arguments.length?(o.precision(e),s.precision(e),u.precision(e),f()):o.precision()},l.scale=function(e){return arguments.length?(o.scale(e),s.scale(.35*e),u.scale(e),l.translate(o.translate())):o.scale()},l.translate=function(e){if(!arguments.length)return o.translate();var t=o.scale(),a=+e[0],l=+e[1];return n=o.translate(e).clipExtent([[a-.455*t,l-.238*t],[a+.455*t,l+.238*t]]).stream(c),r=s.translate([a-.307*t,l+.201*t]).clipExtent([[a-.425*t+iv,l+.12*t+iv],[a-.214*t-iv,l+.234*t-iv]]).stream(c),i=u.translate([a-.205*t,l+.212*t]).clipExtent([[a-.214*t+iv,l+.166*t+iv],[a-.115*t-iv,l+.234*t-iv]]).stream(c),f()},l.fitExtent=function(e,t){return cy(l,e,t)},l.fitSize=function(e,t){return ly(l,e,t)},l.fitWidth=function(e,t){return fy(l,e,t)},l.fitHeight=function(e,t){return dy(l,e,t)},l.scale(1070)},azimuthalequalarea:function(){return yy(Cy).scale(124.75).clipAngle(179.999)},azimuthalequidistant:function(){return yy(Ay).scale(79.4188).clipAngle(179.999)},conicconformal:function(){return xy(jy).scale(109.5).parallels([30,30])},conicequalarea:_y,conicequidistant:function(){return xy(Fy).scale(131.154).center([0,13.9389])},equalEarth:function(){return yy(Ly).scale(177.158)},equirectangular:function(){return yy(My).scale(152.63)},gnomonic:function(){return yy(zy).scale(144.049).clipAngle(60)},identity:function(){var e,t,n,r,i,a,o,s=1,u=0,c=0,l=1,f=1,d=0,h=null,p=1,m=1,v=oy({point:function(e,t){var n=b([e,t]);this.stream.point(n[0],n[1])}}),g=$m;function y(){return p=s*l,m=s*f,a=o=null,b}function b(n){var r=n[0]*p,i=n[1]*m;if(d){var a=i*e-r*t;r=r*e+i*t,i=a}return[r+u,i+c]}return b.invert=function(n){var r=n[0]-u,i=n[1]-c;if(d){var a=i*e+r*t;r=r*e-i*t,i=a}return[r/p,i/m]},b.stream=function(e){return a&&o===e?a:a=v(g(o=e))},b.postclip=function(e){return arguments.length?(g=e,h=n=r=i=null,y()):g},b.clipExtent=function(e){return arguments.length?(g=null==e?(h=n=r=i=null,$m):ay(h=+e[0][0],n=+e[0][1],r=+e[1][0],i=+e[1][1]),y()):null==h?null:[[h,n],[r,i]]},b.scale=function(e){return arguments.length?(s=+e,y()):s},b.translate=function(e){return arguments.length?(u=+e[0],c=+e[1],y()):[u,c]},b.angle=function(n){return arguments.length?(t=xv(d=n%360*lv),e=pv(d),y()):d*cv},b.reflectX=function(e){return arguments.length?(l=e?-1:1,y()):l<0},b.reflectY=function(e){return arguments.length?(f=e?-1:1,y()):f<0},b.fitExtent=function(e,t){return cy(b,e,t)},b.fitSize=function(e,t){return ly(b,e,t)},b.fitWidth=function(e,t){return fy(b,e,t)},b.fitHeight=function(e,t){return dy(b,e,t)},b},mercator:function(){return Dy(Oy).scale(961/uv)},mollweide:function(){return yy(eb).scale(169.529)},naturalEarth1:function(){return yy(Uy).scale(175.295)},orthographic:function(){return yy(Wy).scale(249.5).clipAngle(90+iv)},stereographic:function(){return yy(Vy).scale(250).clipAngle(142)},transversemercator:function(){var e=Dy(Gy),t=e.center,n=e.rotate;return e.center=function(e){return arguments.length?t([-e[1],e[0]]):[(e=t())[1],-e[0]]},e.rotate=function(e){return arguments.length?n([e[0],e[1],e.length>2?e[2]+90:90]):[(e=n())[0],e[1],e[2]-90]},n([0,0,90]).scale(159.155)}};for(var ob in ab)rb(ob,ab[ob]);function sb(e,t,n){var r=pn(e,t-iv,n).concat(t);return function(e){return r.map((function(t){return[e,t]}))}}function ub(e,t,n){var r=pn(e,t-iv,n).concat(t);return function(e){return r.map((function(t){return[t,e]}))}}function cb(){var e,t,n,r,i,a,o,s,u,c,l,f,d=10,h=d,p=90,m=360,v=2.5;function g(){return{type:"MultiLineString",coordinates:y()}}function y(){return pn(mv(r/p)*p,n,p).map(l).concat(pn(mv(s/m)*m,o,m).map(f)).concat(pn(mv(t/d)*d,e,d).filter((function(e){return fv(e%p)>iv})).map(u)).concat(pn(mv(a/h)*h,i,h).filter((function(e){return fv(e%m)>iv})).map(c))}return g.lines=function(){return y().map((function(e){return{type:"LineString",coordinates:e}}))},g.outline=function(){return{type:"Polygon",coordinates:[l(r).concat(f(o).slice(1),l(n).reverse().slice(1),f(s).reverse().slice(1))]}},g.extent=function(e){return arguments.length?g.extentMajor(e).extentMinor(e):g.extentMinor()},g.extentMajor=function(e){return arguments.length?(r=+e[0][0],n=+e[1][0],s=+e[0][1],o=+e[1][1],r>n&&(e=r,r=n,n=e),s>o&&(e=s,s=o,o=e),g.precision(v)):[[r,s],[n,o]]},g.extentMinor=function(n){return arguments.length?(t=+n[0][0],e=+n[1][0],a=+n[0][1],i=+n[1][1],t>e&&(n=t,t=e,e=n),a>i&&(n=a,a=i,i=n),g.precision(v)):[[t,a],[e,i]]},g.step=function(e){return arguments.length?g.stepMajor(e).stepMinor(e):g.stepMinor()},g.stepMajor=function(e){return arguments.length?(p=+e[0],m=+e[1],g):[p,m]},g.stepMinor=function(e){return arguments.length?(d=+e[0],h=+e[1],g):[d,h]},g.precision=function(d){return arguments.length?(v=+d,u=sb(a,i,90),c=ub(t,e,v),l=sb(s,o,90),f=ub(r,n,v),g):v},g.extentMajor([[-180,-90+iv],[180,90-iv]]).extentMinor([[-180,-80-iv],[180,80+iv]])}function lb(){}var fb=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function db(){var e=1,t=1,n=o;function r(e,t){return t.map((function(t){return i(e,t)}))}function i(r,i){var o=[],s=[];return function(n,r,i){var o,s,u,c,l,f,d=new Array,h=new Array;for(o=s=-1,c=n[0]>=r,fb[c<<1].forEach(p);++o<e-1;)u=c,c=n[o+1]>=r,fb[u|c<<1].forEach(p);for(fb[c<<0].forEach(p);++s<t-1;){for(o=-1,c=n[s*e+e]>=r,l=n[s*e]>=r,fb[c<<1|l<<2].forEach(p);++o<e-1;)u=c,c=n[s*e+e+o+1]>=r,f=l,l=n[s*e+o+1]>=r,fb[u|c<<1|l<<2|f<<3].forEach(p);fb[c|l<<3].forEach(p)}for(o=-1,l=n[s*e]>=r,fb[l<<2].forEach(p);++o<e-1;)f=l,l=n[s*e+o+1]>=r,fb[l<<2|f<<3].forEach(p);function p(e){var t,n,r=[e[0][0]+o,e[0][1]+s],u=[e[1][0]+o,e[1][1]+s],c=a(r),l=a(u);(t=h[c])?(n=d[l])?(delete h[t.end],delete d[n.start],t===n?(t.ring.push(u),i(t.ring)):d[t.start]=h[n.end]={start:t.start,end:n.end,ring:t.ring.concat(n.ring)}):(delete h[t.end],t.ring.push(u),h[t.end=l]=t):(t=d[l])?(n=h[c])?(delete d[t.start],delete h[n.end],t===n?(t.ring.push(u),i(t.ring)):d[n.start]=h[t.end]={start:n.start,end:t.end,ring:n.ring.concat(t.ring)}):(delete d[t.start],t.ring.unshift(r),d[t.start=c]=t):d[c]=h[l]={start:c,end:l,ring:[r,u]}}fb[l<<3].forEach(p)}(r,i,(function(e){n(e,r,i),function(e){for(var t=0,n=e.length,r=e[n-1][1]*e[0][0]-e[n-1][0]*e[0][1];++t<n;)r+=e[t-1][1]*e[t][0]-e[t-1][0]*e[t][1];return r}(e)>0?o.push([e]):s.push(e)})),s.forEach((function(e){for(var t,n=0,r=o.length;n<r;++n)if(-1!==hb((t=o[n])[0],e))return void t.push(e)})),{type:"MultiPolygon",value:i,coordinates:o}}function a(t){return 2*t[0]+t[1]*(e+1)*4}function o(n,r,i){n.forEach((function(n){var a,o=n[0],s=n[1],u=0|o,c=0|s,l=r[c*e+u];o>0&&o<e&&u===o&&(a=r[c*e+u-1],n[0]=o+(i-a)/(l-a)-.5),s>0&&s<t&&c===s&&(a=r[(c-1)*e+u],n[1]=s+(i-a)/(l-a)-.5)}))}return r.contour=i,r.size=function(n){if(!arguments.length)return[e,t];var i=Math.floor(n[0]),a=Math.floor(n[1]);return i>=0&&a>=0||Object(ye.o)("invalid size"),e=i,t=a,r},r.smooth=function(e){return arguments.length?(n=e?o:lb,r):n===o},r}function hb(e,t){for(var n,r=-1,i=t.length;++r<i;)if(n=pb(e,t[r]))return n;return 0}function pb(e,t){for(var n=t[0],r=t[1],i=-1,a=0,o=e.length,s=o-1;a<o;s=a++){var u=e[a],c=u[0],l=u[1],f=e[s],d=f[0],h=f[1];if(mb(u,f,t))return 0;l>r!=h>r&&n<(d-c)*(r-l)/(h-l)+c&&(i=-i)}return i}function mb(e,t,n){var r;return function(e,t,n){return(t[0]-e[0])*(n[1]-e[1])==(n[0]-e[0])*(t[1]-e[1])}(e,t,n)&&function(e,t,n){return e<=t&&t<=n||n<=t&&t<=e}(e[r=+(e[0]===t[0])],n[r],t[r])}function vb(e,t,n){return function(r){var i=Object(ye.q)(r),a=n?Math.min(i[0],0):i[0],o=i[1],s=o-a,u=t?Object(fa.c)(a,o,e):s/(e+1);return pn(a+u,o,u)}}function gb(e){ot.call(this,null,e)}function yb(e,t,n,r,i){var a=e.x1||0,o=e.y1||0,s=t*n<0;function u(e){e.forEach(c)}function c(e){s&&e.reverse(),e.forEach(l)}function l(e){e[0]=(e[0]-a)*t+r,e[1]=(e[1]-o)*n+i}return function(e){return e.coordinates.forEach(u),e}}function bb(e,t,n){var r=e>=0?e:wt(t,n);return Math.round((Math.sqrt(4*r*r+1)-1)/2)}function xb(e){return Object(ye.E)(e)?e:Object(ye.m)(+e)}function wb(){var e=function(e){return e[0]},t=function(e){return e[1]},n=ye.Q,r=[-1,-1],i=960,a=500,o=2;function s(s,u){var c=bb(r[0],s,e)>>o,l=bb(r[1],s,t)>>o,f=c?c+2:0,d=l?l+2:0,h=2*f+(i>>o),p=2*d+(a>>o),m=new Float32Array(h*p),v=new Float32Array(h*p),g=m;s.forEach((function(r){var i=f+(+e(r)>>o),a=d+(+t(r)>>o);i>=0&&i<h&&a>=0&&a<p&&(m[i+a*h]+=+n(r))})),c>0&&l>0?(_b(h,p,m,v,c),kb(h,p,v,m,l),_b(h,p,m,v,c),kb(h,p,v,m,l),_b(h,p,m,v,c),kb(h,p,v,m,l)):c>0?(_b(h,p,m,v,c),_b(h,p,v,m,c),_b(h,p,m,v,c),g=v):l>0&&(kb(h,p,m,v,l),kb(h,p,v,m,l),kb(h,p,m,v,l),g=v);for(var y=u?Math.pow(2,-2*o):1/wm(g),b=0,x=h*p;b<x;++b)g[b]*=y;return{values:g,scale:1<<o,width:h,height:p,x1:f,y1:d,x2:f+(i>>o),y2:d+(a>>o)}}return s.x=function(t){return arguments.length?(e=xb(t),s):e},s.y=function(e){return arguments.length?(t=xb(e),s):t},s.weight=function(e){return arguments.length?(n=xb(e),s):n},s.size=function(e){if(!arguments.length)return[i,a];var t=+e[0],n=+e[1];return t>=0&&n>=0||Object(ye.o)("invalid size"),i=t,a=n,s},s.cellSize=function(e){return arguments.length?((e=+e)>=1||Object(ye.o)("invalid cell size"),o=Math.floor(Math.log(e)/Math.LN2),s):1<<o},s.bandwidth=function(e){return arguments.length?(1===(e=Object(ye.i)(e)).length&&(e=[+e[0],+e[0]]),2!==e.length&&Object(ye.o)("invalid bandwidth"),r=e,s):r},s}function _b(e,t,n,r,i){for(var a=1+(i<<1),o=0;o<t;++o)for(var s=0,u=0;s<e+i;++s)s<e&&(u+=n[s+o*e]),s>=i&&(s>=a&&(u-=n[s-a+o*e]),r[s-i+o*e]=u/Math.min(s+1,e-1+a-s,a))}function kb(e,t,n,r,i){for(var a=1+(i<<1),o=0;o<e;++o)for(var s=0,u=0;s<t+i;++s)s<t&&(u+=n[o+s*e]),s>=i&&(s>=a&&(u-=n[o+(s-a)*e]),r[o+(s-i)*e]=u/Math.min(s+1,t-1+a-s,a))}function Eb(e){ot.call(this,null,e)}gb.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]},Object(ye.z)(gb,ot,{transform:function(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=t.materialize(t.SOURCE).source,i=e.field||ye.y,a=db().smooth(!1!==e.smooth),o=e.thresholds||function(e,t,n){var r=vb(n.levels||10,n.nice,!1!==n.zero);return"shared"!==n.resolve?r:r(e.map((function(e){return ft(t(e).values)})))}(r,i,e),s=null===e.as?null:e.as||"contour",u=[];return r.forEach((function(t){var n=i(t),r=a.size([n.width,n.height])(n.values,Object(ye.B)(o)?o:o(n.values));!function(e,t,n,r){var i=r.scale||t.scale,a=r.translate||t.translate;if(Object(ye.E)(i)&&(i=i(n,r)),Object(ye.E)(a)&&(a=a(n,r)),1!==i&&null!=i||a){var o=(Object(ye.G)(i)?i:i[0])||1,s=(Object(ye.G)(i)?i:i[1])||1,u=a&&a[0]||0,c=a&&a[1]||0;e.forEach(yb(t,o,s,u,c))}}(r,n,t,e),r.forEach((function(e){u.push(je(t,De(null!=s?y({},s,e):e)))}))})),this.value&&(n.rem=this.value),this.value=n.source=n.add=u,n}}),Eb.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};var Sb=["x","y","weight","size","cellSize","bandwidth"];function Cb(e,t){return Sb.forEach((function(n){return null!=t[n]?e[n](t[n]):0})),e}function Ab(e){ot.call(this,null,e)}Object(ye.z)(Eb,ot,{transform:function(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=function(e,t){var n,r,i,a,o,s,u=[],c=function(e){return e(a)};if(null==t)u.push(e);else for(n={},r=0,i=e.length;r<i;++r)a=e[r],(s=n[o=t.map(c)])||(n[o]=s=[],s.dims=o,u.push(s)),s.push(a);return u}(t.materialize(t.SOURCE).source,e.groupby),a=(e.groupby||[]).map(ye.h),o=Cb(wb(),e),s=e.as||"grid";return n=i.map((function(t){return De(function(e,t){for(var n=0;n<a.length;++n)e[a[n]]=t[n];return e}(y({},s,o(t,e.counts)),t.dims))})),this.value&&(r.rem=this.value),this.value=r.source=r.add=n,r}}),Ab.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]},Object(ye.z)(Ab,ot,{transform:function(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n,r,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),a=db().smooth(!1!==e.smooth),o=e.values,s=e.thresholds||vb(e.count||10,e.nice,!!o),u=e.size;return o||(o=t.materialize(t.SOURCE).source,r=yb(n=Cb(wb(),e)(o,!0),n.scale||1,n.scale||1,0,0),u=[n.width,n.height],o=n.values),s=Object(ye.B)(s)?s:s(o),o=a.size(u)(o,s),r&&o.forEach(r),this.value&&(i.rem=this.value),this.value=i.source=i.add=(o||[]).map(De),i}});var Ob="Feature",Db="FeatureCollection";function Tb(e){ot.call(this,null,e)}function jb(e){ot.call(this,null,e)}function Mb(e){ot.call(this,null,e)}function Fb(e){ot.call(this,null,e)}function Ib(e){ot.call(this,[],e),this.generator=cb()}function Nb(e){ot.call(this,null,e)}function Rb(e){if(!Object(ye.E)(e))return!1;var t=Object(ye.Fa)(Object(ye.g)(e));return t.$x||t.$y||t.$value||t.$max}function Pb(e){ot.call(this,null,e),this.modified(!0)}function Bb(e,t,n){Object(ye.E)(e[t])&&e[t](n)}function Lb(e,t,n,r){if(isNaN(t)||isNaN(n))return e;var i,a,o,s,u,c,l,f,d,h=e._root,p={data:r},m=e._x0,v=e._y0,g=e._x1,y=e._y1;if(!h)return e._root=p,e;for(;h.length;)if((c=t>=(a=(m+g)/2))?m=a:g=a,(l=n>=(o=(v+y)/2))?v=o:y=o,i=h,!(h=h[f=l<<1|c]))return i[f]=p,e;if(s=+e._x.call(null,h.data),u=+e._y.call(null,h.data),t===s&&n===u)return p.next=h,i?i[f]=p:e._root=p,e;do{i=i?i[f]=new Array(4):e._root=new Array(4),(c=t>=(a=(m+g)/2))?m=a:g=a,(l=n>=(o=(v+y)/2))?v=o:y=o}while((f=l<<1|c)==(d=(u>=o)<<1|s>=a));return i[d]=h,i[f]=p,e}Tb.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]},Object(ye.z)(Tb,ot,{transform:function(e,t){var n,r=this._features,i=this._points,a=e.fields,o=a&&a[0],s=a&&a[1],u=e.geojson||!a&&ye.y,c=t.ADD;n=e.modified()||t.changed(t.REM)||t.modified(Object(ye.g)(u))||o&&t.modified(Object(ye.g)(o))||s&&t.modified(Object(ye.g)(s)),this.value&&!n||(c=t.SOURCE,this._features=r=[],this._points=i=[]),u&&t.visit(c,(function(e){return r.push(u(e))})),o&&s&&(t.visit(c,(function(e){var t=o(e),n=s(e);null!=t&&null!=n&&(t=+t)===t&&(n=+n)===n&&i.push([t,n])})),r=r.concat({type:Ob,geometry:{type:"MultiPoint",coordinates:i}})),this.value={type:Db,features:r}}}),jb.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]},Object(ye.z)(jb,ot,{transform:function(e,t){var n=t.fork(t.ALL),r=this.value,i=e.field||ye.y,a=e.as||"path",o=n.SOURCE;!r||e.modified()?(this.value=r=ib(e.projection),n.materialize().reflow()):o=i===ye.y||t.modified(i.fields)?n.ADD_MOD:n.ADD;var s=function(e,t){var n=e.pointRadius();return e.context(null),null!=t&&e.pointRadius(t),n}(r,e.pointRadius);return n.visit(o,(function(e){return e[a]=r(i(e))})),r.pointRadius(s),n.modifies(a)}}),Mb.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]},Object(ye.z)(Mb,ot,{transform:function(e,t){var n,r=e.projection,i=e.fields[0],a=e.fields[1],o=e.as||["x","y"],s=o[0],u=o[1];function c(e){var t=r([i(e),a(e)]);t?(e[s]=t[0],e[u]=t[1]):(e[s]=void 0,e[u]=void 0)}return e.modified()?t=t.materialize().reflow(!0).visit(t.SOURCE,c):(n=t.modified(i.fields)||t.modified(a.fields),t.visit(n?t.ADD_MOD:t.ADD,c)),t.modifies(o)}}),Fb.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]},Object(ye.z)(Fb,ot,{transform:function(e,t){var n=t.fork(t.ALL),r=this.value,i=e.as||"shape",a=n.ADD;return r&&!e.modified()||(this.value=r=function(e,t,n){var r=null==n?function(n){return e(t(n))}:function(r){var i=e.pointRadius(),a=e.pointRadius(n)(t(r));return e.pointRadius(i),a};return r.context=function(t){return e.context(t),r},r}(ib(e.projection),e.field||Object(ye.u)("datum"),e.pointRadius),n.materialize().reflow(),a=n.SOURCE),n.visit(a,(function(e){return e[i]=r})),n.modifies(i)}}),Ib.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]},Object(ye.z)(Ib,ot,{transform:function(e,t){var n,r=this.value,i=this.generator;if(!r.length||e.modified())for(var a in e)Object(ye.E)(i[a])&&i[a](e[a]);return n=i(),r.length?t.mod.push(Me(r[0],n)):t.add.push(De(n)),r[0]=n,t}}),Nb.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]},Object(ye.z)(Nb,ot,{transform:function(e,t){if(!t.changed()&&!e.modified())return t.StopPropagation;var n=t.materialize(t.SOURCE).source,r="shared"===e.resolve,i=e.field||ye.y,a=function(e,t){var n;return Object(ye.E)(e)?(n=function(n){return e(n,t)}).dep=Rb(e):e?n=Object(ye.m)(e):(n=function(e){return e.$value/e.$max||0}).dep=!0,n}(e.opacity,e),o=function(e,t){var n;return Object(ye.E)(e)?(n=function(n){return Ia(e(n,t))}).dep=Rb(e):n=Object(ye.m)(Ia(e||"#888")),n}(e.color,e),s=e.as||"image",u={$x:0,$y:0,$value:0,$max:r?ft(n.map((function(e){return ft(i(e).values)}))):0};return n.forEach((function(e){var t=i(e),n=Object(ye.p)({},e,u);r||(n.$max=ft(t.values||[])),e[s]=function(e,t,n,r){for(var i=e.width,a=e.height,o=e.x1||0,s=e.y1||0,u=e.x2||i,c=e.y2||a,l=e.values,f=l?function(e){return l[e]}:ye.Ma,d=ta(u-o,c-s),h=d.getContext("2d"),p=h.getImageData(0,0,u-o,c-s),m=p.data,v=s,g=0;v<c;++v){t.$y=v-s;for(var y=o,b=v*i;y<u;++y,g+=4){t.$x=y-o,t.$value=f(y+b);var x=n(t);m[g+0]=x.r,m[g+1]=x.g,m[g+2]=x.b,m[g+3]=~~(255*r(t))}}return h.putImageData(p,0,0),d}(t,n,o.dep?o:Object(ye.m)(o(n)),a.dep?a:Object(ye.m)(a(n)))})),t.reflow(!0).modifies(s)}}),Object(ye.z)(Pb,ot,{transform:function(e,t){var n=this.value;return!n||e.modified("type")?(this.value=n=function(e){var t=rb((e||"mercator").toLowerCase());return t||Object(ye.o)("Unrecognized projection type: "+e),t()}(e.type),nb.forEach((function(t){null!=e[t]&&Bb(n,t,e[t])}))):nb.forEach((function(t){e.modified(t)&&Bb(n,t,e[t])})),null!=e.pointRadius&&n.path.pointRadius(e.pointRadius),e.fit&&function(e,t){var n=function(e){return 1===(e=Object(ye.i)(e)).length?e[0]:{type:Db,features:e.reduce((function(e,t){return e.concat(function(e){return e.type===Db?e.features:Object(ye.i)(e).filter((function(e){return null!=e})).map((function(e){return e.type===Ob?e:{type:Ob,geometry:e}}))}(t))}),[])}}(t.fit);t.extent?e.fitExtent(t.extent,n):t.size&&e.fitSize(t.size,n)}(n,e),t.fork(t.NO_SOURCE|t.NO_FIELDS)}});var zb=function(e,t,n,r,i){this.node=e,this.x0=t,this.y0=n,this.x1=r,this.y1=i};function Ub(e){return e[0]}function Wb(e){return e[1]}function Vb(e,t,n){var r=new Gb(null==t?Ub:t,null==n?Wb:n,NaN,NaN,NaN,NaN);return null==e?r:r.addAll(e)}function Gb(e,t,n,r,i,a){this._x=e,this._y=t,this._x0=n,this._y0=r,this._x1=i,this._y1=a,this._root=void 0}function qb(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}var Hb=Vb.prototype=Gb.prototype;Hb.copy=function(){var e,t,n=new Gb(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return n;if(!r.length)return n._root=qb(r),n;for(e=[{source:r,target:n._root=new Array(4)}];r=e.pop();)for(var i=0;i<4;++i)(t=r.source[i])&&(t.length?e.push({source:t,target:r.target[i]=new Array(4)}):r.target[i]=qb(t));return n},Hb.add=function(e){var t=+this._x.call(null,e),n=+this._y.call(null,e);return Lb(this.cover(t,n),t,n,e)},Hb.addAll=function(e){var t,n,r,i,a=e.length,o=new Array(a),s=new Array(a),u=1/0,c=1/0,l=-1/0,f=-1/0;for(n=0;n<a;++n)isNaN(r=+this._x.call(null,t=e[n]))||isNaN(i=+this._y.call(null,t))||(o[n]=r,s[n]=i,r<u&&(u=r),r>l&&(l=r),i<c&&(c=i),i>f&&(f=i));if(u>l||c>f)return this;for(this.cover(u,c).cover(l,f),n=0;n<a;++n)Lb(this,o[n],s[n],e[n]);return this},Hb.cover=function(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,r=this._y0,i=this._x1,a=this._y1;if(isNaN(n))i=(n=Math.floor(e))+1,a=(r=Math.floor(t))+1;else{for(var o,s,u=i-n||1,c=this._root;n>e||e>=i||r>t||t>=a;)switch(s=(t<r)<<1|e<n,(o=new Array(4))[s]=c,c=o,u*=2,s){case 0:i=n+u,a=r+u;break;case 1:n=i-u,a=r+u;break;case 2:i=n+u,r=a-u;break;case 3:n=i-u,r=a-u}this._root&&this._root.length&&(this._root=c)}return this._x0=n,this._y0=r,this._x1=i,this._y1=a,this},Hb.data=function(){var e=[];return this.visit((function(t){if(!t.length)do{e.push(t.data)}while(t=t.next)})),e},Hb.extent=function(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},Hb.find=function(e,t,n){var r,i,a,o,s,u,c,l=this._x0,f=this._y0,d=this._x1,h=this._y1,p=[],m=this._root;for(m&&p.push(new zb(m,l,f,d,h)),null==n?n=1/0:(l=e-n,f=t-n,d=e+n,h=t+n,n*=n);u=p.pop();)if(!(!(m=u.node)||(i=u.x0)>d||(a=u.y0)>h||(o=u.x1)<l||(s=u.y1)<f))if(m.length){var v=(i+o)/2,g=(a+s)/2;p.push(new zb(m[3],v,g,o,s),new zb(m[2],i,g,v,s),new zb(m[1],v,a,o,g),new zb(m[0],i,a,v,g)),(c=(t>=g)<<1|e>=v)&&(u=p[p.length-1],p[p.length-1]=p[p.length-1-c],p[p.length-1-c]=u)}else{var y=e-+this._x.call(null,m.data),b=t-+this._y.call(null,m.data),x=y*y+b*b;if(x<n){var w=Math.sqrt(n=x);l=e-w,f=t-w,d=e+w,h=t+w,r=m.data}}return r},Hb.remove=function(e){if(isNaN(a=+this._x.call(null,e))||isNaN(o=+this._y.call(null,e)))return this;var t,n,r,i,a,o,s,u,c,l,f,d,h=this._root,p=this._x0,m=this._y0,v=this._x1,g=this._y1;if(!h)return this;if(h.length)for(;;){if((c=a>=(s=(p+v)/2))?p=s:v=s,(l=o>=(u=(m+g)/2))?m=u:g=u,t=h,!(h=h[f=l<<1|c]))return this;if(!h.length)break;(t[f+1&3]||t[f+2&3]||t[f+3&3])&&(n=t,d=f)}for(;h.data!==e;)if(r=h,!(h=h.next))return this;return(i=h.next)&&delete h.next,r?(i?r.next=i:delete r.next,this):t?(i?t[f]=i:delete t[f],(h=t[0]||t[1]||t[2]||t[3])&&h===(t[3]||t[2]||t[1]||t[0])&&!h.length&&(n?n[d]=h:this._root=h),this):(this._root=i,this)},Hb.removeAll=function(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this},Hb.root=function(){return this._root},Hb.size=function(){var e=0;return this.visit((function(t){if(!t.length)do{++e}while(t=t.next)})),e},Hb.visit=function(e){var t,n,r,i,a,o,s=[],u=this._root;for(u&&s.push(new zb(u,this._x0,this._y0,this._x1,this._y1));t=s.pop();)if(!e(u=t.node,r=t.x0,i=t.y0,a=t.x1,o=t.y1)&&u.length){var c=(r+a)/2,l=(i+o)/2;(n=u[3])&&s.push(new zb(n,c,l,a,o)),(n=u[2])&&s.push(new zb(n,r,l,c,o)),(n=u[1])&&s.push(new zb(n,c,i,a,l)),(n=u[0])&&s.push(new zb(n,r,i,c,l))}return this},Hb.visitAfter=function(e){var t,n=[],r=[];for(this._root&&n.push(new zb(this._root,this._x0,this._y0,this._x1,this._y1));t=n.pop();){var i=t.node;if(i.length){var a,o=t.x0,s=t.y0,u=t.x1,c=t.y1,l=(o+u)/2,f=(s+c)/2;(a=i[0])&&n.push(new zb(a,o,s,l,f)),(a=i[1])&&n.push(new zb(a,l,s,u,f)),(a=i[2])&&n.push(new zb(a,o,f,l,c)),(a=i[3])&&n.push(new zb(a,l,f,u,c))}r.push(t)}for(;t=r.pop();)e(t.node,t.x0,t.y0,t.x1,t.y1);return this},Hb.x=function(e){return arguments.length?(this._x=e,this):this._x},Hb.y=function(e){return arguments.length?(this._y=e,this):this._y};var Xb=function(e){return function(){return e}},Kb=function(e){return 1e-6*(e()-.5)};function Yb(e){return e.x+e.vx}function $b(e){return e.y+e.vy}var Jb={value:function(){}};function Zb(){for(var e,t=0,n=arguments.length,r={};t<n;++t){if(!(e=arguments[t]+"")||e in r||/[\s.]/.test(e))throw new Error("illegal type: "+e);r[e]=[]}return new Qb(r)}function Qb(e){this._=e}function ex(e,t){for(var n,r=0,i=e.length;r<i;++r)if((n=e[r]).name===t)return n.value}function tx(e,t,n){for(var r=0,i=e.length;r<i;++r)if(e[r].name===t){e[r]=Jb,e=e.slice(0,r).concat(e.slice(r+1));break}return null!=n&&e.push({name:t,value:n}),e}Qb.prototype=Zb.prototype={constructor:Qb,on:function(e,t){var n,r=this._,i=function(e,t){return e.trim().split(/^|\s+/).map((function(e){var n="",r=e.indexOf(".");if(r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:n}}))}(e+"",r),a=-1,o=i.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++a<o;)if(n=(e=i[a]).type)r[n]=tx(r[n],e.name,t);else if(null==t)for(n in r)r[n]=tx(r[n],e.name,null);return this}for(;++a<o;)if((n=(e=i[a]).type)&&(n=ex(r[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new Qb(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),a=0;a<n;++a)i[a]=arguments[a+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(a=0,n=(r=this._[e]).length;a<n;++a)r[a].value.apply(t,i)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],i=0,a=r.length;i<a;++i)r[i].value.apply(t,n)}};var nx,rx,ix=Zb,ax=0,ox=0,sx=0,ux=1e3,cx=0,lx=0,fx=0,dx="object"==typeof performance&&performance.now?performance:Date,hx="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function px(){return lx||(hx(mx),lx=dx.now()+fx)}function mx(){lx=0}function vx(){this._call=this._time=this._next=null}function gx(e,t,n){var r=new vx;return r.restart(e,t,n),r}function yx(){lx=(cx=dx.now())+fx,ax=ox=0;try{!function(){px(),++ax;for(var e,t=nx;t;)(e=lx-t._time)>=0&&t._call.call(null,e),t=t._next;--ax}()}finally{ax=0,function(){for(var e,t,n=nx,r=1/0;n;)n._call?(r>n._time&&(r=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:nx=t);rx=e,xx(r)}(),lx=0}}function bx(){var e=dx.now(),t=e-cx;t>ux&&(fx-=t,cx=e)}function xx(e){ax||(ox&&(ox=clearTimeout(ox)),e-lx>24?(e<1/0&&(ox=setTimeout(yx,e-dx.now()-fx)),sx&&(sx=clearInterval(sx))):(sx||(cx=dx.now(),sx=setInterval(bx,ux)),ax=1,hx(yx)))}function wx(e){return e.x}function _x(e){return e.y}vx.prototype=gx.prototype={constructor:vx,restart:function(e,t,n){if("function"!=typeof e)throw new TypeError("callback is not a function");n=(null==n?px():+n)+(null==t?0:+t),this._next||rx===this||(rx?rx._next=this:nx=this,rx=this),this._call=e,this._time=n,xx()},stop:function(){this._call&&(this._call=null,this._time=1/0,xx())}};var kx=10,Ex=Math.PI*(3-Math.sqrt(5)),Sx=function(e){var t,n=1,r=.001,i=1-Math.pow(r,1/300),a=0,o=.6,s=new Map,u=gx(f),c=ix("tick","end"),l=function(){var e=1;return function(){return(e=(1664525*e+1013904223)%4294967296)/4294967296}}();function f(){d(),c.call("tick",t),n<r&&(u.stop(),c.call("end",t))}function d(r){var u,c,l=e.length;void 0===r&&(r=1);for(var f=0;f<r;++f)for(n+=(a-n)*i,s.forEach((function(e){e(n)})),u=0;u<l;++u)null==(c=e[u]).fx?c.x+=c.vx*=o:(c.x=c.fx,c.vx=0),null==c.fy?c.y+=c.vy*=o:(c.y=c.fy,c.vy=0);return t}function h(){for(var t,n=0,r=e.length;n<r;++n){if((t=e[n]).index=n,null!=t.fx&&(t.x=t.fx),null!=t.fy&&(t.y=t.fy),isNaN(t.x)||isNaN(t.y)){var i=kx*Math.sqrt(.5+n),a=n*Ex;t.x=i*Math.cos(a),t.y=i*Math.sin(a)}(isNaN(t.vx)||isNaN(t.vy))&&(t.vx=t.vy=0)}}function p(t){return t.initialize&&t.initialize(e,l),t}return null==e&&(e=[]),h(),t={tick:d,restart:function(){return u.restart(f),t},stop:function(){return u.stop(),t},nodes:function(n){return arguments.length?(e=n,h(),s.forEach(p),t):e},alpha:function(e){return arguments.length?(n=+e,t):n},alphaMin:function(e){return arguments.length?(r=+e,t):r},alphaDecay:function(e){return arguments.length?(i=+e,t):+i},alphaTarget:function(e){return arguments.length?(a=+e,t):a},velocityDecay:function(e){return arguments.length?(o=1-e,t):1-o},randomSource:function(e){return arguments.length?(l=e,s.forEach(p),t):l},force:function(e,n){return arguments.length>1?(null==n?s.delete(e):s.set(e,p(n)),t):s.get(e)},find:function(t,n,r){var i,a,o,s,u,c=0,l=e.length;for(null==r?r=1/0:r*=r,c=0;c<l;++c)(o=(i=t-(s=e[c]).x)*i+(a=n-s.y)*a)<r&&(u=s,r=o);return u},on:function(e,n){return arguments.length>1?(c.on(e,n),t):c.on(e)}}};function Cx(e){return e.index}function Ax(e,t){var n=e.get(t);if(!n)throw new Error("node not found: "+t);return n}var Ox={center:function(e,t){var n,r=1;function i(){var i,a,o=n.length,s=0,u=0;for(i=0;i<o;++i)s+=(a=n[i]).x,u+=a.y;for(s=(s/o-e)*r,u=(u/o-t)*r,i=0;i<o;++i)(a=n[i]).x-=s,a.y-=u}return null==e&&(e=0),null==t&&(t=0),i.initialize=function(e){n=e},i.x=function(t){return arguments.length?(e=+t,i):e},i.y=function(e){return arguments.length?(t=+e,i):t},i.strength=function(e){return arguments.length?(r=+e,i):r},i},collide:function(e){var t,n,r,i=1,a=1;function o(){for(var e,o,u,c,l,f,d,h=t.length,p=0;p<a;++p)for(o=Vb(t,Yb,$b).visitAfter(s),e=0;e<h;++e)u=t[e],f=n[u.index],d=f*f,c=u.x+u.vx,l=u.y+u.vy,o.visit(m);function m(e,t,n,a,o){var s=e.data,h=e.r,p=f+h;if(!s)return t>c+p||a<c-p||n>l+p||o<l-p;if(s.index>u.index){var m=c-s.x-s.vx,v=l-s.y-s.vy,g=m*m+v*v;g<p*p&&(0===m&&(g+=(m=Kb(r))*m),0===v&&(g+=(v=Kb(r))*v),g=(p-(g=Math.sqrt(g)))/g*i,u.vx+=(m*=g)*(p=(h*=h)/(d+h)),u.vy+=(v*=g)*p,s.vx-=m*(p=1-p),s.vy-=v*p)}}}function s(e){if(e.data)return e.r=n[e.data.index];for(var t=e.r=0;t<4;++t)e[t]&&e[t].r>e.r&&(e.r=e[t].r)}function u(){if(t){var r,i,a=t.length;for(n=new Array(a),r=0;r<a;++r)i=t[r],n[i.index]=+e(i,r,t)}}return"function"!=typeof e&&(e=Xb(null==e?1:+e)),o.initialize=function(e,n){t=e,r=n,u()},o.iterations=function(e){return arguments.length?(a=+e,o):a},o.strength=function(e){return arguments.length?(i=+e,o):i},o.radius=function(t){return arguments.length?(e="function"==typeof t?t:Xb(+t),u(),o):e},o},nbody:function(){var e,t,n,r,i,a=Xb(-30),o=1,s=1/0,u=.81;function c(n){var i,a=e.length,o=Vb(e,wx,_x).visitAfter(f);for(r=n,i=0;i<a;++i)t=e[i],o.visit(d)}function l(){if(e){var t,n,r=e.length;for(i=new Array(r),t=0;t<r;++t)n=e[t],i[n.index]=+a(n,t,e)}}function f(e){var t,n,r,a,o,s=0,u=0;if(e.length){for(r=a=o=0;o<4;++o)(t=e[o])&&(n=Math.abs(t.value))&&(s+=t.value,u+=n,r+=n*t.x,a+=n*t.y);e.x=r/u,e.y=a/u}else{(t=e).x=t.data.x,t.y=t.data.y;do{s+=i[t.data.index]}while(t=t.next)}e.value=s}function d(e,a,c,l){if(!e.value)return!0;var f=e.x-t.x,d=e.y-t.y,h=l-a,p=f*f+d*d;if(h*h/u<p)return p<s&&(0===f&&(p+=(f=Kb(n))*f),0===d&&(p+=(d=Kb(n))*d),p<o&&(p=Math.sqrt(o*p)),t.vx+=f*e.value*r/p,t.vy+=d*e.value*r/p),!0;if(!(e.length||p>=s)){(e.data!==t||e.next)&&(0===f&&(p+=(f=Kb(n))*f),0===d&&(p+=(d=Kb(n))*d),p<o&&(p=Math.sqrt(o*p)));do{e.data!==t&&(h=i[e.data.index]*r/p,t.vx+=f*h,t.vy+=d*h)}while(e=e.next)}}return c.initialize=function(t,r){e=t,n=r,l()},c.strength=function(e){return arguments.length?(a="function"==typeof e?e:Xb(+e),l(),c):a},c.distanceMin=function(e){return arguments.length?(o=e*e,c):Math.sqrt(o)},c.distanceMax=function(e){return arguments.length?(s=e*e,c):Math.sqrt(s)},c.theta=function(e){return arguments.length?(u=e*e,c):Math.sqrt(u)},c},link:function(e){var t,n,r,i,a,o,s=Cx,u=function(e){return 1/Math.min(i[e.source.index],i[e.target.index])},c=Xb(30),l=1;function f(r){for(var i=0,s=e.length;i<l;++i)for(var u,c,f,d,h,p,m,v=0;v<s;++v)c=(u=e[v]).source,d=(f=u.target).x+f.vx-c.x-c.vx||Kb(o),h=f.y+f.vy-c.y-c.vy||Kb(o),d*=p=((p=Math.sqrt(d*d+h*h))-n[v])/p*r*t[v],h*=p,f.vx-=d*(m=a[v]),f.vy-=h*m,c.vx+=d*(m=1-m),c.vy+=h*m}function d(){if(r){var o,u,c=r.length,l=e.length,f=new Map(r.map((function(e,t){return[s(e,t,r),e]})));for(o=0,i=new Array(c);o<l;++o)(u=e[o]).index=o,"object"!=typeof u.source&&(u.source=Ax(f,u.source)),"object"!=typeof u.target&&(u.target=Ax(f,u.target)),i[u.source.index]=(i[u.source.index]||0)+1,i[u.target.index]=(i[u.target.index]||0)+1;for(o=0,a=new Array(l);o<l;++o)u=e[o],a[o]=i[u.source.index]/(i[u.source.index]+i[u.target.index]);t=new Array(l),h(),n=new Array(l),p()}}function h(){if(r)for(var n=0,i=e.length;n<i;++n)t[n]=+u(e[n],n,e)}function p(){if(r)for(var t=0,i=e.length;t<i;++t)n[t]=+c(e[t],t,e)}return null==e&&(e=[]),f.initialize=function(e,t){r=e,o=t,d()},f.links=function(t){return arguments.length?(e=t,d(),f):e},f.id=function(e){return arguments.length?(s=e,f):s},f.iterations=function(e){return arguments.length?(l=+e,f):l},f.strength=function(e){return arguments.length?(u="function"==typeof e?e:Xb(+e),h(),f):u},f.distance=function(e){return arguments.length?(c="function"==typeof e?e:Xb(+e),p(),f):c},f},x:function(e){var t,n,r,i=Xb(.1);function a(e){for(var i,a=0,o=t.length;a<o;++a)(i=t[a]).vx+=(r[a]-i.x)*n[a]*e}function o(){if(t){var a,o=t.length;for(n=new Array(o),r=new Array(o),a=0;a<o;++a)n[a]=isNaN(r[a]=+e(t[a],a,t))?0:+i(t[a],a,t)}}return"function"!=typeof e&&(e=Xb(null==e?0:+e)),a.initialize=function(e){t=e,o()},a.strength=function(e){return arguments.length?(i="function"==typeof e?e:Xb(+e),o(),a):i},a.x=function(t){return arguments.length?(e="function"==typeof t?t:Xb(+t),o(),a):e},a},y:function(e){var t,n,r,i=Xb(.1);function a(e){for(var i,a=0,o=t.length;a<o;++a)(i=t[a]).vy+=(r[a]-i.y)*n[a]*e}function o(){if(t){var a,o=t.length;for(n=new Array(o),r=new Array(o),a=0;a<o;++a)n[a]=isNaN(r[a]=+e(t[a],a,t))?0:+i(t[a],a,t)}}return"function"!=typeof e&&(e=Xb(null==e?0:+e)),a.initialize=function(e){t=e,o()},a.strength=function(e){return arguments.length?(i="function"==typeof e?e:Xb(+e),o(),a):i},a.y=function(t){return arguments.length?(e="function"==typeof t?t:Xb(+t),o(),a):e},a}},Dx="forces",Tx=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],jx=["static","iterations"],Mx=["x","y","vx","vy"];function Fx(e){ot.call(this,null,e)}function Ix(e,t,n,r){var i,a,o,s,u=Object(ye.i)(t.forces);for(i=0,a=Tx.length;i<a;++i)(o=Tx[i])!==Dx&&t.modified(o)&&e[o](t[o]);for(i=0,a=u.length;i<a;++i)s=Dx+i,(o=n||t.modified(Dx,i)?Rx(u[i]):r&&Nx(u[i],r)?e.force(s):null)&&e.force(s,o);for(a=e.numForces||0;i<a;++i)e.force(Dx+i,null);return e.numForces=u.length,e}function Nx(e,t){var n,r;for(n in e)if(Object(ye.E)(r=e[n])&&t.modified(Object(ye.g)(r)))return 1;return 0}function Rx(e){var t,n;for(n in Object(ye.w)(Ox,e.force)||Object(ye.o)("Unrecognized force: "+e.force),t=Ox[e.force](),e)Object(ye.E)(t[n])&&Px(t[n],e[n],e);return t}function Px(e,t,n){e(Object(ye.E)(t)?function(e){return t(e,n)}:t)}function Bx(e){var t=0,n=e.children,r=n&&n.length;if(r)for(;--r>=0;)t+=n[r].value;else t=1;e.value=t}function Lx(e,t){e instanceof Map?(e=[void 0,e],void 0===t&&(t=Ux)):void 0===t&&(t=zx);for(var n,r,i,a,o,s=new Gx(e),u=[s];n=u.pop();)if((i=t(n.data))&&(o=(i=Array.from(i)).length))for(n.children=i,a=o-1;a>=0;--a)u.push(r=i[a]=new Gx(i[a])),r.parent=n,r.depth=n.depth+1;return s.eachBefore(Vx)}function zx(e){return e.children}function Ux(e){return Array.isArray(e)?e[1]:null}function Wx(e){void 0!==e.data.value&&(e.value=e.data.value),e.data=e.data.data}function Vx(e){var t=0;do{e.height=t}while((e=e.parent)&&e.height<++t)}function Gx(e){this.data=e,this.depth=this.height=0,this.parent=null}Fx.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:Mx}]},Object(ye.z)(Fx,ot,{transform:function(e,t){var n=this.value,r=t.changed(t.ADD_REM),i=e.modified(Tx),a=e.iterations||300;if(n?(r&&(t.modifies("index"),n.nodes(t.source)),(i||t.changed(t.MOD))&&Ix(n,e,0,t)):(this.value=n=function(e,t){var n=Sx(e),r=n.stop,i=n.restart,a=!1;return n.stopped=function(){return a},n.restart=function(){return a=!1,i()},n.stop=function(){return a=!0,r()},Ix(n,t,!0).on("end",(function(){return a=!0}))}(t.source,e),n.on("tick",function(e,t){return function(){return e.touch(t).run()}}(t.dataflow,this)),e.static||(r=!0,n.tick()),t.modifies("index")),i||r||e.modified(jx)||t.changed()&&e.restart)if(n.alpha(Math.max(n.alpha(),e.alpha||1)).alphaDecay(1-Math.pow(n.alphaMin(),1/a)),e.static)for(n.stop();--a>=0;)n.tick();else if(n.stopped()&&n.restart(),!r)return t.StopPropagation;return this.finish(e,t)},finish:function(e,t){for(var n,r=t.dataflow,i=this._argops,a=0,o=i.length;a<o;++a)if((n=i[a]).name===Dx&&"link"===n.op._argval.force)for(var s,u=n.op._argops,c=0,l=u.length;c<l;++c)if("links"===u[c].name&&(s=u[c].op.source)){r.pulse(s,r.changeset().reflow());break}return t.reflow(e.modified()).modifies(Mx)}}),Gx.prototype=Lx.prototype=y({constructor:Gx,count:function(){return this.eachAfter(Bx)},each:function(e,t){var n,r=-1,i=p(this);try{for(i.s();!(n=i.n()).done;){var a=n.value;e.call(t,a,++r,this)}}catch(o){i.e(o)}finally{i.f()}return this},eachAfter:function(e,t){for(var n,r,i,a=this,o=[a],s=[],u=-1;a=o.pop();)if(s.push(a),n=a.children)for(r=0,i=n.length;r<i;++r)o.push(n[r]);for(;a=s.pop();)e.call(t,a,++u,this);return this},eachBefore:function(e,t){for(var n,r,i=this,a=[i],o=-1;i=a.pop();)if(e.call(t,i,++o,this),n=i.children)for(r=n.length-1;r>=0;--r)a.push(n[r]);return this},find:function(e,t){var n,r=-1,i=p(this);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(e.call(t,a,++r,this))return a}}catch(o){i.e(o)}finally{i.f()}},sum:function(e){return this.eachAfter((function(t){for(var n=+e(t.data)||0,r=t.children,i=r&&r.length;--i>=0;)n+=r[i].value;t.value=n}))},sort:function(e){return this.eachBefore((function(t){t.children&&t.children.sort(e)}))},path:function(e){for(var t=this,n=function(e,t){if(e===t)return e;var n=e.ancestors(),r=t.ancestors(),i=null;for(e=n.pop(),t=r.pop();e===t;)i=e,e=n.pop(),t=r.pop();return i}(t,e),r=[t];t!==n;)t=t.parent,r.push(t);for(var i=r.length;e!==n;)r.splice(i,0,e),e=e.parent;return r},ancestors:function(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t},descendants:function(){return Array.from(this)},leaves:function(){var e=[];return this.eachBefore((function(t){t.children||e.push(t)})),e},links:function(){var e=this,t=[];return e.each((function(n){n!==e&&t.push({source:n.parent,target:n})})),t},copy:function(){return Lx(this).eachBefore(Wx)}},Symbol.iterator,m().mark((function e(){var t,n,r,i,a,o;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=[a=this];case 1:t=o.reverse(),o=[];case 2:if(!(a=t.pop())){e.next=9;break}return e.next=5,a;case 5:if(!(n=a.children)){e.next=7;break}for(r=0,i=n.length;r<i;++r)o.push(n[r]);case 7:e.next=2;break;case 9:if(o.length){e.next=1;break}case 10:case"end":return e.stop()}}),e,this)})));var qx=function(e){return"object"==typeof e&&"length"in e?e:Array.from(e)},Hx=function(e){for(var t,n,r=0,i=(e=function(e){for(var t,n,r=e.length;r;)n=Math.random()*r--|0,t=e[r],e[r]=e[n],e[n]=t;return e}(Array.from(e))).length,a=[];r<i;)t=e[r],n&&Yx(n,t)?++r:(n=Jx(a=Xx(a,t)),r=0);return n};function Xx(e,t){var n,r;if($x(t,e))return[t];for(n=0;n<e.length;++n)if(Kx(t,e[n])&&$x(Zx(e[n],t),e))return[e[n],t];for(n=0;n<e.length-1;++n)for(r=n+1;r<e.length;++r)if(Kx(Zx(e[n],e[r]),t)&&Kx(Zx(e[n],t),e[r])&&Kx(Zx(e[r],t),e[n])&&$x(Qx(e[n],e[r],t),e))return[e[n],e[r],t];throw new Error}function Kx(e,t){var n=e.r-t.r,r=t.x-e.x,i=t.y-e.y;return n<0||n*n<r*r+i*i}function Yx(e,t){var n=e.r-t.r+1e-9*Math.max(e.r,t.r,1),r=t.x-e.x,i=t.y-e.y;return n>0&&n*n>r*r+i*i}function $x(e,t){for(var n=0;n<t.length;++n)if(!Yx(e,t[n]))return!1;return!0}function Jx(e){switch(e.length){case 1:return function(e){return{x:e.x,y:e.y,r:e.r}}(e[0]);case 2:return Zx(e[0],e[1]);case 3:return Qx(e[0],e[1],e[2])}}function Zx(e,t){var n=e.x,r=e.y,i=e.r,a=t.x,o=t.y,s=t.r,u=a-n,c=o-r,l=s-i,f=Math.sqrt(u*u+c*c);return{x:(n+a+u/f*l)/2,y:(r+o+c/f*l)/2,r:(f+i+s)/2}}function Qx(e,t,n){var r=e.x,i=e.y,a=e.r,o=t.x,s=t.y,u=t.r,c=n.x,l=n.y,f=n.r,d=r-o,h=r-c,p=i-s,m=i-l,v=u-a,g=f-a,y=r*r+i*i-a*a,b=y-o*o-s*s+u*u,x=y-c*c-l*l+f*f,w=h*p-d*m,_=(p*x-m*b)/(2*w)-r,k=(m*v-p*g)/w,E=(h*b-d*x)/(2*w)-i,S=(d*g-h*v)/w,C=k*k+S*S-1,A=2*(a+_*k+E*S),O=_*_+E*E-a*a,D=-(C?(A+Math.sqrt(A*A-4*C*O))/(2*C):O/A);return{x:r+_+k*D,y:i+E+S*D,r:D}}function ew(e,t,n){var r,i,a,o,s=e.x-t.x,u=e.y-t.y,c=s*s+u*u;c?(i=t.r+n.r,i*=i,o=e.r+n.r,i>(o*=o)?(r=(c+o-i)/(2*c),a=Math.sqrt(Math.max(0,o/c-r*r)),n.x=e.x-r*s-a*u,n.y=e.y-r*u+a*s):(r=(c+i-o)/(2*c),a=Math.sqrt(Math.max(0,i/c-r*r)),n.x=t.x+r*s-a*u,n.y=t.y+r*u+a*s)):(n.x=t.x+n.r,n.y=t.y)}function tw(e,t){var n=e.r+t.r-1e-6,r=t.x-e.x,i=t.y-e.y;return n>0&&n*n>r*r+i*i}function nw(e){var t=e._,n=e.next._,r=t.r+n.r,i=(t.x*n.r+n.x*t.r)/r,a=(t.y*n.r+n.y*t.r)/r;return i*i+a*a}function rw(e){this._=e,this.next=null,this.previous=null}function iw(e){if(!(i=(e=qx(e)).length))return 0;var t,n,r,i,a,o,s,u,c,l,f;if((t=e[0]).x=0,t.y=0,!(i>1))return t.r;if(n=e[1],t.x=-n.r,n.x=t.r,n.y=0,!(i>2))return t.r+n.r;ew(n,t,r=e[2]),t=new rw(t),n=new rw(n),r=new rw(r),t.next=r.previous=n,n.next=t.previous=r,r.next=n.previous=t;e:for(s=3;s<i;++s){ew(t._,n._,r=e[s]),r=new rw(r),u=n.next,c=t.previous,l=n._.r,f=t._.r;do{if(l<=f){if(tw(u._,r._)){n=u,t.next=n,n.previous=t,--s;continue e}l+=u._.r,u=u.next}else{if(tw(c._,r._)){(t=c).next=n,n.previous=t,--s;continue e}f+=c._.r,c=c.previous}}while(u!==c.next);for(r.previous=t,r.next=n,t.next=n.previous=n=r,a=nw(t);(r=r.next)!==n;)(o=nw(r))<a&&(t=r,a=o);n=t.next}for(t=[n._],r=n;(r=r.next)!==n;)t.push(r._);for(r=Hx(t),s=0;s<i;++s)(t=e[s]).x-=r.x,t.y-=r.y;return r.r}function aw(e){if("function"!=typeof e)throw new Error;return e}function ow(){return 0}var sw=function(e){return function(){return e}};function uw(e){return Math.sqrt(e.value)}function cw(e){return function(t){t.children||(t.r=Math.max(0,+e(t)||0))}}function lw(e,t){return function(n){if(r=n.children){var r,i,a,o=r.length,s=e(n)*t||0;if(s)for(i=0;i<o;++i)r[i].r+=s;if(a=iw(r),s)for(i=0;i<o;++i)r[i].r-=s;n.r=a+s}}}function fw(e){return function(t){var n=t.parent;t.r*=e,n&&(t.x=n.x+e*t.x,t.y=n.y+e*t.y)}}var dw=function(e){e.x0=Math.round(e.x0),e.y0=Math.round(e.y0),e.x1=Math.round(e.x1),e.y1=Math.round(e.y1)},hw=function(e,t,n,r,i){for(var a,o=e.children,s=-1,u=o.length,c=e.value&&(r-t)/e.value;++s<u;)(a=o[s]).y0=n,a.y1=i,a.x0=t,a.x1=t+=a.value*c},pw={depth:-1},mw={};function vw(e){return e.id}function gw(e){return e.parentId}var yw=function(){var e=vw,t=gw;function n(n){var r,i,a,o,s,u,c,l=Array.from(n),f=l.length,d=new Map;for(i=0;i<f;++i)r=l[i],s=l[i]=new Gx(r),null!=(u=e(r,i,n))&&(u+="")&&(c=s.id=u,d.set(c,d.has(c)?mw:s)),null!=(u=t(r,i,n))&&(u+="")&&(s.parent=u);for(i=0;i<f;++i)if(u=(s=l[i]).parent){if(!(o=d.get(u)))throw new Error("missing: "+u);if(o===mw)throw new Error("ambiguous: "+u);o.children?o.children.push(s):o.children=[s],s.parent=o}else{if(a)throw new Error("multiple roots");a=s}if(!a)throw new Error("no root");if(a.parent=pw,a.eachBefore((function(e){e.depth=e.parent.depth+1,--f})).eachBefore(Vx),a.parent=null,f>0)throw new Error("cycle");return a}return n.id=function(t){return arguments.length?(e=aw(t),n):e},n.parentId=function(e){return arguments.length?(t=aw(e),n):t},n};function bw(e,t){return e.parent===t.parent?1:2}function xw(e){var t=e.children;return t?t[0]:e.t}function ww(e){var t=e.children;return t?t[t.length-1]:e.t}function _w(e,t,n){var r=n/(t.i-e.i);t.c-=r,t.s+=n,e.c+=r,t.z+=n,t.m+=n}function kw(e,t,n){return e.a.parent===t.parent?e.a:n}function Ew(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}function Sw(e,t){return e.parent===t.parent?1:2}function Cw(e,t){return e+t.x}function Aw(e,t){return Math.max(e,t.y)}Ew.prototype=Object.create(Gx.prototype);var Ow=function(e,t,n,r,i){for(var a,o=e.children,s=-1,u=o.length,c=e.value&&(i-n)/e.value;++s<u;)(a=o[s]).x0=t,a.x1=r,a.y0=n,a.y1=n+=a.value*c},Dw=(1+Math.sqrt(5))/2;function Tw(e,t,n,r,i,a){for(var o,s,u,c,l,f,d,h,p,m,v,g=[],y=t.children,b=0,x=0,w=y.length,_=t.value;b<w;){u=i-n,c=a-r;do{l=y[x++].value}while(!l&&x<w);for(f=d=l,v=l*l*(m=Math.max(c/u,u/c)/(_*e)),p=Math.max(d/v,v/f);x<w;++x){if(l+=s=y[x].value,s<f&&(f=s),s>d&&(d=s),v=l*l*m,(h=Math.max(d/v,v/f))>p){l-=s;break}p=h}g.push(o={value:l,dice:u<c,children:y.slice(b,x)}),o.dice?hw(o,n,r,i,_?r+=c*l/_:a):Ow(o,n,r,_?n+=u*l/_:i,a),_-=l,b=x}return g}var jw=function e(t){function n(e,n,r,i,a){Tw(t,e,n,r,i,a)}return n.ratio=function(t){return e((t=+t)>1?t:1)},n}(Dw),Mw=function e(t){function n(e,n,r,i,a){if((o=e._squarify)&&o.ratio===t)for(var o,s,u,c,l,f=-1,d=o.length,h=e.value;++f<d;){for(u=(s=o[f]).children,c=s.value=0,l=u.length;c<l;++c)s.value+=u[c].value;s.dice?hw(s,n,r,i,h?r+=(a-r)*s.value/h:a):Ow(s,n,r,h?n+=(i-n)*s.value/h:i,a),h-=s.value}else e._squarify=o=Tw(t,e,n,r,i,a),o.ratio=t}return n.ratio=function(t){return e((t=+t)>1?t:1)},n}(Dw);function Fw(e,t,n){var r={};return e.each((function(e){var i=e.data;n(i)&&(r[t(i)]=e)})),e.lookup=r,e}function Iw(e){ot.call(this,null,e)}Iw.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};var Nw=function(e){return e.values};function Rw(e){ot.call(this,null,e)}Object(ye.z)(Iw,ot,{transform:function(e,t){t.source||Object(ye.o)("Nest transform requires an upstream data source.");var n=e.generate,r=e.modified(),i=t.clone(),a=this.value;return(!a||r||t.changed())&&(a&&a.each((function(e){e.children&&Ce(e.data)&&i.rem.push(e.data)})),this.value=a=Lx({values:Object(ye.i)(e.keys).reduce((function(e,t){return e.key(t),e}),function(){var e=[],t={entries:function(t){return function t(n,r){if(++r>e.length)return n;var i=[];for(var a in n)i.push({key:a,values:t(n[a],r)});return i}(function t(n,r){if(r>=e.length)return n;for(var i,a,o,s=n.length,u=e[r++],c={},l={},f=-1;++f<s;)(o=c[i=u(a=n[f])+""])?o.push(a):c[i]=[a];for(i in c)l[i]=t(c[i],r);return l}(t,0),0)},key:function(n){return e.push(n),t}};return t}()).entries(i.source)},Nw),n&&a.each((function(e){e.children&&(e=De(e.data),i.add.push(e),i.source.push(e))})),Fw(a,Ae,Ae)),i.source.root=a,i}});var Pw=function(e,t){return e.parent===t.parent?1:2};Object(ye.z)(Rw,ot,{transform:function(e,t){t.source&&t.source.root||Object(ye.o)(this.constructor.name+" transform requires a backing tree data source.");var n=this.layout(e.method),r=this.fields,i=t.source.root,a=e.as||r;e.field?i.sum(e.field):i.count(),e.sort&&i.sort(Fe(e.sort,(function(e){return e.data}))),function(e,t,n){for(var r,i=0,a=t.length;i<a;++i)(r=t[i])in n&&e[r](n[r])}(n,this.params,e),n.separation&&n.separation(!1!==e.separation?Pw:ye.Q);try{this.value=n(i)}catch(e){Object(ye.o)(e)}return i.each((function(e){return function(e,t,n){for(var r=e.data,i=t.length-1,a=0;a<i;++a)r[n[a]]=e[t[a]];r[n[i]]=e.children?e.children.length:0}(e,r,a)})),t.reflow(e.modified()).modifies(a).modifies("leaf")}});var Bw=["x","y","r","depth","children"];function Lw(e){Rw.call(this,e)}Lw.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:Bw.length,default:Bw}]},Object(ye.z)(Lw,Rw,{layout:function(){var e=null,t=1,n=1,r=ow;function i(i){return i.x=t/2,i.y=n/2,e?i.eachBefore(cw(e)).eachAfter(lw(r,.5)).eachBefore(fw(1)):i.eachBefore(cw(uw)).eachAfter(lw(ow,1)).eachAfter(lw(r,i.r/Math.min(t,n))).eachBefore(fw(Math.min(t,n)/(2*i.r))),i}return i.radius=function(t){return arguments.length?(e=function(e){return null==e?null:aw(e)}(t),i):e},i.size=function(e){return arguments.length?(t=+e[0],n=+e[1],i):[t,n]},i.padding=function(e){return arguments.length?(r="function"==typeof e?e:sw(+e),i):r},i},params:["radius","size","padding"],fields:Bw});var zw=["x0","y0","x1","y1","depth","children"];function Uw(e){Rw.call(this,e)}function Ww(e){ot.call(this,null,e)}Uw.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:zw.length,default:zw}]},Object(ye.z)(Uw,Rw,{layout:function(){var e=1,t=1,n=0,r=!1;function i(i){var a=i.height+1;return i.x0=i.y0=n,i.x1=e,i.y1=t/a,i.eachBefore(function(e,t){return function(r){r.children&&hw(r,r.x0,e*(r.depth+1)/t,r.x1,e*(r.depth+2)/t);var i=r.x0,a=r.y0,o=r.x1-n,s=r.y1-n;o<i&&(i=o=(i+o)/2),s<a&&(a=s=(a+s)/2),r.x0=i,r.y0=a,r.x1=o,r.y1=s}}(t,a)),r&&i.eachBefore(dw),i}return i.round=function(e){return arguments.length?(r=!!e,i):r},i.size=function(n){return arguments.length?(e=+n[0],t=+n[1],i):[e,t]},i.padding=function(e){return arguments.length?(n=+e,i):n},i},params:["size","round","padding"],fields:zw}),Ww.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]},Object(ye.z)(Ww,ot,{transform:function(e,t){t.source||Object(ye.o)("Stratify transform requires an upstream data source.");var n=this.value,r=e.modified(),i=t.fork(t.ALL).materialize(t.SOURCE),a=!n||r||t.changed(t.ADD_REM)||t.modified(e.key.fields)||t.modified(e.parentKey.fields);return i.source=i.source.slice(),a&&(n=i.source.length?Fw(yw().id(e.key).parentId(e.parentKey)(i.source),e.key,ye.Ia):Fw(yw()([{}]),e.key,e.key)),i.source.root=this.value=n,i}});var Vw={tidy:function(){var e=bw,t=1,n=1,r=null;function i(i){var u=function(e){for(var t,n,r,i,a,o=new Ew(e,0),s=[o];t=s.pop();)if(r=t._.children)for(t.children=new Array(a=r.length),i=a-1;i>=0;--i)s.push(n=t.children[i]=new Ew(r[i],i)),n.parent=t;return(o.parent=new Ew(null,0)).children=[o],o}(i);if(u.eachAfter(a),u.parent.m=-u.z,u.eachBefore(o),r)i.eachBefore(s);else{var c=i,l=i,f=i;i.eachBefore((function(e){e.x<c.x&&(c=e),e.x>l.x&&(l=e),e.depth>f.depth&&(f=e)}));var d=c===l?1:e(c,l)/2,h=d-c.x,p=t/(l.x+d+h),m=n/(f.depth||1);i.eachBefore((function(e){e.x=(e.x+h)*p,e.y=e.depth*m}))}return i}function a(t){var n=t.children,r=t.parent.children,i=t.i?r[t.i-1]:null;if(n){!function(e){for(var t,n=0,r=0,i=e.children,a=i.length;--a>=0;)(t=i[a]).z+=n,t.m+=n,n+=t.s+(r+=t.c)}(t);var a=(n[0].z+n[n.length-1].z)/2;i?(t.z=i.z+e(t._,i._),t.m=t.z-a):t.z=a}else i&&(t.z=i.z+e(t._,i._));t.parent.A=function(t,n,r){if(n){for(var i,a=t,o=t,s=n,u=a.parent.children[0],c=a.m,l=o.m,f=s.m,d=u.m;s=ww(s),a=xw(a),s&&a;)u=xw(u),(o=ww(o)).a=t,(i=s.z+f-a.z-c+e(s._,a._))>0&&(_w(kw(s,t,r),t,i),c+=i,l+=i),f+=s.m,c+=a.m,d+=u.m,l+=o.m;s&&!ww(o)&&(o.t=s,o.m+=f-l),a&&!xw(u)&&(u.t=a,u.m+=c-d,r=t)}return r}(t,i,t.parent.A||r[0])}function o(e){e._.x=e.z+e.parent.m,e.m+=e.parent.m}function s(e){e.x*=t,e.y=e.depth*n}return i.separation=function(t){return arguments.length?(e=t,i):e},i.size=function(e){return arguments.length?(r=!1,t=+e[0],n=+e[1],i):r?null:[t,n]},i.nodeSize=function(e){return arguments.length?(r=!0,t=+e[0],n=+e[1],i):r?[t,n]:null},i},cluster:function(){var e=Sw,t=1,n=1,r=!1;function i(i){var a,o=0;i.eachAfter((function(t){var n=t.children;n?(t.x=function(e){return e.reduce(Cw,0)/e.length}(n),t.y=function(e){return 1+e.reduce(Aw,0)}(n)):(t.x=a?o+=e(t,a):0,t.y=0,a=t)}));var s=function(e){for(var t;t=e.children;)e=t[0];return e}(i),u=function(e){for(var t;t=e.children;)e=t[t.length-1];return e}(i),c=s.x-e(s,u)/2,l=u.x+e(u,s)/2;return i.eachAfter(r?function(e){e.x=(e.x-i.x)*t,e.y=(i.y-e.y)*n}:function(e){e.x=(e.x-c)/(l-c)*t,e.y=(1-(i.y?e.y/i.y:1))*n})}return i.separation=function(t){return arguments.length?(e=t,i):e},i.size=function(e){return arguments.length?(r=!1,t=+e[0],n=+e[1],i):r?null:[t,n]},i.nodeSize=function(e){return arguments.length?(r=!0,t=+e[0],n=+e[1],i):r?[t,n]:null},i}},Gw=["x","y","depth","children"];function qw(e){Rw.call(this,e)}function Hw(e){ot.call(this,[],e)}qw.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:Gw.length,default:Gw}]},Object(ye.z)(qw,Rw,{layout:function(e){var t=e||"tidy";if(Object(ye.w)(Vw,t))return Vw[t]();Object(ye.o)("Unrecognized Tree layout method: "+t)},params:["size","nodeSize"],fields:Gw}),Hw.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]},Object(ye.z)(Hw,ot,{transform:function(e,t){var n=this.value,r=t.source&&t.source.root,i=t.fork(t.NO_SOURCE),a={};return r||Object(ye.o)("TreeLinks transform requires a tree data source."),t.changed(t.ADD_REM)?(i.rem=n,t.visit(t.SOURCE,(function(e){return a[Ae(e)]=1})),r.each((function(e){var t=e.data,n=e.parent&&e.parent.data;n&&a[Ae(t)]&&a[Ae(n)]&&i.add.push(De({source:n,target:t}))})),this.value=i.add):t.changed(t.MOD)&&(t.visit(t.MOD,(function(e){return a[Ae(e)]=1})),n.forEach((function(e){(a[Ae(e.source)]||a[Ae(e.target)])&&i.mod.push(e)}))),i}});var Xw={binary:function(e,t,n,r,i){var a,o,s=e.children,u=s.length,c=new Array(u+1);for(c[0]=o=a=0;a<u;++a)c[a+1]=o+=s[a].value;!function e(t,n,r,i,a,o,u){if(t>=n-1){var l=s[t];return l.x0=i,l.y0=a,l.x1=o,void(l.y1=u)}for(var f=c[t],d=r/2+f,h=t+1,p=n-1;h<p;){var m=h+p>>>1;c[m]<d?h=m+1:p=m}d-c[h-1]<c[h]-d&&t+1<h&&--h;var v=c[h]-f,g=r-v;if(o-i>u-a){var y=r?(i*g+o*v)/r:o;e(t,h,v,i,a,y,u),e(h,n,g,y,a,o,u)}else{var b=r?(a*g+u*v)/r:u;e(t,h,v,i,a,o,b),e(h,n,g,i,b,o,u)}}(0,u,e.value,t,n,r,i)},dice:hw,slice:Ow,slicedice:function(e,t,n,r,i){(1&e.depth?Ow:hw)(e,t,n,r,i)},squarify:jw,resquarify:Mw},Kw=["x0","y0","x1","y1","depth","children"];function Yw(e){Rw.call(this,e)}Yw.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:Kw.length,default:Kw}]},Object(ye.z)(Yw,Rw,{layout:function(){var e=function(){var e=jw,t=!1,n=1,r=1,i=[0],a=ow,o=ow,s=ow,u=ow,c=ow;function l(e){return e.x0=e.y0=0,e.x1=n,e.y1=r,e.eachBefore(f),i=[0],t&&e.eachBefore(dw),e}function f(t){var n=i[t.depth],r=t.x0+n,l=t.y0+n,f=t.x1-n,d=t.y1-n;f<r&&(r=f=(r+f)/2),d<l&&(l=d=(l+d)/2),t.x0=r,t.y0=l,t.x1=f,t.y1=d,t.children&&(n=i[t.depth+1]=a(t)/2,r+=c(t)-n,l+=o(t)-n,(f-=s(t)-n)<r&&(r=f=(r+f)/2),(d-=u(t)-n)<l&&(l=d=(l+d)/2),e(t,r,l,f,d))}return l.round=function(e){return arguments.length?(t=!!e,l):t},l.size=function(e){return arguments.length?(n=+e[0],r=+e[1],l):[n,r]},l.tile=function(t){return arguments.length?(e=aw(t),l):e},l.padding=function(e){return arguments.length?l.paddingInner(e).paddingOuter(e):l.paddingInner()},l.paddingInner=function(e){return arguments.length?(a="function"==typeof e?e:sw(+e),l):a},l.paddingOuter=function(e){return arguments.length?l.paddingTop(e).paddingRight(e).paddingBottom(e).paddingLeft(e):l.paddingTop()},l.paddingTop=function(e){return arguments.length?(o="function"==typeof e?e:sw(+e),l):o},l.paddingRight=function(e){return arguments.length?(s="function"==typeof e?e:sw(+e),l):s},l.paddingBottom=function(e){return arguments.length?(u="function"==typeof e?e:sw(+e),l):u},l.paddingLeft=function(e){return arguments.length?(c="function"==typeof e?e:sw(+e),l):c},l}();return e.ratio=function(t){var n=e.tile();n.ratio&&e.tile(n.ratio(t))},e.method=function(t){Object(ye.w)(Xw,t)?e.tile(Xw[t]):Object(ye.o)("Unrecognized Treemap layout method: "+t)},e},params:["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],fields:Kw});var $w=4278190080,Jw=268435456,Zw=.0625;function Qw(e,t,n,r){var i=e.width,a=e.height,o=n||r,s=ta(i,a).getContext("2d");t.forEach((function(e){return function e(t,n,r){if(n.length){var i=n[0].mark.marktype;"group"===i?n.forEach((function(n){n.items.forEach((function(n){return e(t,n.items,r)}))})):Sd[i].draw(t,{items:r?n.map(e_):n})}}(s,e,o)}));var u,c,l,f,d,h=new Uint32Array(s.getImageData(0,0,i,a).data.buffer),p=e.bitmap(),m=o&&e.bitmap();for(c=0;c<a;++c)for(u=0;u<i;++u)(d=h[c*i+u]&$w)&&(l=e(u),f=e(c),r||p.set(l,f),o&&d^Jw&&m.set(l,f));return[p,m]}function e_(e){var t=je(e,{});return t.stroke&&(t.strokeOpacity=1),t.fill&&(t.fillOpacity=Zw,t.stroke="#000",t.strokeOpacity=1,t.strokeWidth=2),t}var t_=5,n_=31,r_=32,i_=new Uint32Array(r_+1),a_=new Uint32Array(r_+1);a_[0]=0,i_[0]=~a_[0];for(var o_=1;o_<=r_;++o_)a_[o_]=a_[o_-1]<<1|1,i_[o_]=~a_[o_];function s_(e,t,n){var r=Math.max(1,Math.sqrt(e*t/1e6)),i=~~((e+2*n+r)/r),a=~~((t+2*n+r)/r),o=function(e){return~~((e+n)/r)};return o.invert=function(e){return e*r-n},o.bitmap=function(){return function(e,t){var n=new Uint32Array(~~((e*t+r_)/r_));function r(e,t){n[e]|=t}function i(e,t){n[e]&=t}return{array:n,get:function(t,r){var i=r*e+t;return n[i>>>t_]&1<<(i&n_)},set:function(t,n){var i=n*e+t;r(i>>>t_,1<<(i&n_))},clear:function(t,n){var r=n*e+t;i(r>>>t_,~(1<<(r&n_)))},getRange:function(t,r,i,a){for(var o,s,u,c,l=a;l>=r;--l)if((u=(o=l*e+t)>>>t_)==(c=(s=l*e+i)>>>t_)){if(n[u]&i_[o&n_]&a_[1+(s&n_)])return!0}else{if(n[u]&i_[o&n_])return!0;if(n[c]&a_[1+(s&n_)])return!0;for(var f=u+1;f<c;++f)if(n[f])return!0}return!1},setRange:function(t,n,i,a){for(var o,s,u,c,l;n<=a;++n)if((u=(o=n*e+t)>>>t_)==(c=(s=n*e+i)>>>t_))r(u,i_[o&n_]&a_[1+(s&n_)]);else for(r(u,i_[o&n_]),r(c,a_[1+(s&n_)]),l=u+1;l<c;++l)r(l,4294967295)},clearRange:function(t,n,r,a){for(var o,s,u,c,l;n<=a;++n)if((u=(o=n*e+t)>>>t_)==(c=(s=n*e+r)>>>t_))i(u,a_[o&n_]|i_[1+(s&n_)]);else for(i(u,a_[o&n_]),i(c,i_[1+(s&n_)]),l=u+1;l<c;++l)i(l,0)},outOfBounds:function(n,r,i,a){return n<0||r<0||a>=t||i>=e}}}(i,a)},o.ratio=r,o.padding=n,o.width=e,o.height=t,o}function u_(e,t,n,r,i,a){var o=n/2;return e-o<0||e+o>i||t-(o=r/2)<0||t+o>a}function c_(e,t,n,r,i,a,o,s){var u=i*a/(2*r),c=e(t-u),l=e(t+u),f=e(n-(a/=2)),d=e(n+a);return o.outOfBounds(c,f,l,d)||o.getRange(c,f,l,d)||s&&s.getRange(c,f,l,d)}var l_=[-1,-1,1,1],f_=[-1,1,-1,1],d_=["right","center","left"],h_=["bottom","middle","top"];function p_(e,t,n,r,i,a,o,s,u,c,l,f){return!(i.outOfBounds(e,n,t,r)||(f&&a?a.getRange(e,n,t,r)||!function(e,t,n,r,i){return i[0]<=e&&n<=i[2]&&i[3]<=t&&r<=i[5]}(o,u,s,c,l):i.getRange(e,n,t,r)))}var m_={"top-left":0,top:1,"top-right":2,left:4,middle:5,right:6,"bottom-left":8,bottom:9,"bottom-right":10},v_={naive:function(e,t,n,r){var i=e.width,a=e.height;return function(e){for(var t,n,o,s,u,c,l,f=e.datum.datum.items[r].items,d=f.length,h=e.datum.fontSize,p=sd.width(e.datum,e.datum.text),m=0,v=0;v<d;++v)t=f[v].x,o=f[v].y,u=(t+(n=void 0===f[v].x2?t:f[v].x2))/2,c=(o+(s=void 0===f[v].y2?o:f[v].y2))/2,(l=Math.abs(n-t+s-o))>=m&&(m=l,e.x=u,e.y=c);return u=p/2,c=h/2,t=e.x-u,n=e.x+u,o=e.y-c,s=e.y+c,e.align="center",t<0&&n<=i?e.align="left":0<=t&&i<n&&(e.align="right"),e.baseline="middle",o<0&&s<=a?e.baseline="top":0<=o&&a<s&&(e.baseline="bottom"),!0}},"reduced-search":function(e,t,n,r){var i=e.width,a=e.height,o=t[0],s=t[1];function u(t,n,r,u,c){var l,f=e.invert(t),d=e.invert(n),h=r,p=a;if(!u_(f,d,u,c,i,a)&&!c_(e,f,d,c,u,h,o,s)&&!c_(e,f,d,c,u,c,o,null)){for(;p-h>=1;)c_(e,f,d,c,u,l=(h+p)/2,o,s)?p=l:h=l;if(h>r)return[f,d,h,!0]}}return function(t){for(var s,c,l,d,h,p,m,v,g,y,b,x,w,_,k,E,S,C=t.datum.datum.items[r].items,A=C.length,O=t.datum.fontSize,D=sd.width(t.datum,t.datum.text),T=n?O:0,j=!1,M=!1,F=0,I=0;I<A;++I){for(s=C[I].x,l=C[I].y,s>(c=void 0===C[I].x2?s:C[I].x2)&&(S=s,s=c,c=S),l>(d=void 0===C[I].y2?l:C[I].y2)&&(S=l,l=d,d=S),y=~~(((g=e(s))+(b=e(c)))/2),w=~~(((x=e(l))+(_=e(d)))/2),m=y;m>=g;--m)for(v=w;v>=x;--v){var N;(E=u(m,v,T,D,O))&&(N=f(E,4),t.x=N[0],t.y=N[1],T=N[2],j=N[3])}for(m=y;m<=b;++m)for(v=w;v<=_;++v){var R;(E=u(m,v,T,D,O))&&(R=f(E,4),t.x=R[0],t.y=R[1],T=R[2],j=R[3])}j||n||(h=(s+c)/2,p=(l+d)/2,(k=Math.abs(c-s+d-l))>=F&&!u_(h,p,D,O,i,a)&&!c_(e,h,p,O,D,O,o,null)&&(F=k,t.x=h,t.y=p,M=!0))}return!(!j&&!M||(h=D/2,p=O/2,o.setRange(e(t.x-h),e(t.y-p),e(t.x+h),e(t.y+p)),t.align="center",t.baseline="middle",0))}},floodfill:function(e,t,n,r){var i=e.width,a=e.height,o=t[0],s=t[1],u=e.bitmap();return function(t){for(var c,l,d,h,p,m,v,g,y,b,x,w,_=t.datum.datum.items[r].items,k=_.length,E=t.datum.fontSize,S=sd.width(t.datum,t.datum.text),C=[],A=n?E:0,O=!1,D=!1,T=0,j=0;j<k;++j){for(c=_[j].x,d=_[j].y,l=void 0===_[j].x2?c:_[j].x2,h=void 0===_[j].y2?d:_[j].y2,C.push([e((c+l)/2),e((d+h)/2)]);C.length;){var M,F;if(M=C.pop(),v=(F=f(M,2))[0],g=F[1],!(o.get(v,g)||s.get(v,g)||u.get(v,g))){u.set(v,g);for(var I=0;I<4;++I)p=v+l_[I],m=g+f_[I],u.outOfBounds(p,m,p,m)||C.push([p,m]);if(p=e.invert(v),m=e.invert(g),y=A,b=a,!u_(p,m,S,E,i,a)&&!c_(e,p,m,E,S,y,o,s)&&!c_(e,p,m,E,S,E,o,null)){for(;b-y>=1;)c_(e,p,m,E,S,x=(y+b)/2,o,s)?b=x:y=x;y>A&&(t.x=p,t.y=m,A=y,O=!0)}}}O||n||(p=(c+l)/2,m=(d+h)/2,(w=Math.abs(l-c+h-d))>=T&&!u_(p,m,S,E,i,a)&&!c_(e,p,m,E,S,E,o,null)&&(T=w,t.x=p,t.y=m,D=!0))}return!(!O&&!D||(p=S/2,m=E/2,o.setRange(e(t.x-p),e(t.y-m),e(t.x+p),e(t.y+m)),t.align="center",t.baseline="middle",0))}}};function g_(e,t,n,r,i,a,o,s,u,c,l){if(!e.length)return e;var f,d=Math.max(r.length,i.length),h=function(e,t){for(var n=new Float64Array(t),r=e.length,i=0;i<r;++i)n[i]=e[i]||0;for(var a=r;a<t;++a)n[a]=n[r-1];return n}(r,d),p=function(e,t){for(var n=new Int8Array(t),r=e.length,i=0;i<r;++i)n[i]|=m_[e[i]];for(var a=r;a<t;++a)n[a]=n[r-1];return n}(i,d),m=function(e){return e&&e.mark&&e.mark.marktype}(e[0].datum),v="group"===m&&e[0].datum.items[u].marktype,g="area"===v,y=function(e,t,n,r){var i=function(e){return[e.x,e.x,e.x,e.y,e.y,e.y]};return e?"line"===e||"area"===e?function(e){return i(e.datum)}:"line"===t?function(e){var t=e.datum.items[r].items;return i(t.length?t["start"===n?0:t.length-1]:{x:NaN,y:NaN})}:function(e){var t=e.datum.bounds;return[t.x1,(t.x1+t.x2)/2,t.x2,t.y1,(t.y1+t.y2)/2,t.y2]}:i}(m,v,s,u),b=s_(t[0],t[1],c),x=g&&"naive"===l,w=e.map((function(e){return{datum:e,opacity:0,x:void 0,y:void 0,align:void 0,baseline:void 0,boundary:y(e)}}));if(!x){n&&w.sort((function(e,t){return n(e.datum,t.datum)}));for(var _=!1,k=0;k<p.length&&!_;++k)_=5===p[k]||h[k]<0;m&&(o||g)&&(a=[e.map((function(e){return e.datum}))].concat(a)),f=a.length?Qw(b,a,_,g):function(e,t){var n=e.bitmap();return(t||[]).forEach((function(t){return n.set(e(t.boundary[0]),e(t.boundary[3]))})),[n,void 0]}(b,o&&w)}var E=g?v_[l](b,f,o,u):function(e,t,n,r){var i=e.width,a=e.height,o=t[0],s=t[1],u=r.length;return function(t){var c=t.boundary,l=t.datum.fontSize;if(c[2]<0||c[5]<0||c[0]>i||c[3]>a)return!1;for(var f,d,h,p,m,v,g,y,b,x,w,_,k,E,S,C=0,A=0;A<u;++A){if(f=(3&n[A])-1,d=(n[A]>>>2&3)-1,h=0===f&&0===d||r[A]<0,p=f&&d?Math.SQRT1_2:1,m=r[A]<0?-1:1,v=c[1+f]+r[A]*f*p,y=(w=c[4+d]+m*l*d/2+r[A]*d*p)-l/2,b=w+l/2,_=e(v),E=e(y),S=e(b),!C){if(!p_(_,_,E,S,o,s,v,v,y,b,c,h))continue;C=sd.width(t.datum,t.datum.text)}if(g=(x=v+m*C*f/2)+C/2,p_(_=e(v=x-C/2),k=e(g),E,S,o,s,v,g,y,b,c,h))return t.x=f?f*m<0?g:v:x,t.y=d?d*m<0?b:y:w,t.align=d_[f*m+1],t.baseline=h_[d*m+1],o.setRange(_,E,k,S),!0}return!1}}(b,f,p,h);return w.forEach((function(e){return e.opacity=+E(e)})),w}var y_=["x","y","opacity","align","baseline"],b_=["top-left","left","bottom-left","top","bottom","top-right","right","bottom-right"];function x_(e){ot.call(this,null,e)}function w_(e,t){var n,r,i,a,o,s,u=[],c=function(e){return e(a)};if(null==t)u.push(e);else for(n={},r=0,i=e.length;r<i;++r)a=e[r],(s=n[o=t.map(c)])||(n[o]=s=[],s.dims=o,u.push(s)),s.push(a);return u}function __(e){ot.call(this,null,e)}x_.Definition={type:"Label",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"sort",type:"compare"},{name:"anchor",type:"string",array:!0,default:b_},{name:"offset",type:"number",array:!0,default:[1]},{name:"padding",type:"number",default:0},{name:"lineAnchor",type:"string",values:["start","end"],default:"end"},{name:"markIndex",type:"number",default:0},{name:"avoidBaseMark",type:"boolean",default:!0},{name:"avoidMarks",type:"data",array:!0},{name:"method",type:"string",default:"naive"},{name:"as",type:"string",array:!0,length:y_.length,default:y_}]},Object(ye.z)(x_,ot,{transform:function(e,t){var n=e.modified();if(n||t.changed(t.ADD_REM)||function(n){var r=e.sort;return Object(ye.E)(r)&&t.modified(r.fields)}()){e.size&&2===e.size.length||Object(ye.o)("Size parameter should be specified as a [width, height] array.");var r=e.as||y_;return g_(t.materialize(t.SOURCE).source,e.size,e.sort,Object(ye.i)(e.offset||1),Object(ye.i)(e.anchor||b_),e.avoidMarks||[],!1!==e.avoidBaseMark,e.lineAnchor||"end",e.markIndex||0,e.padding||0,e.method||"naive").forEach((function(e){var t=e.datum;t[r[0]]=e.x,t[r[1]]=e.y,t[r[2]]=e.opacity,t[r[3]]=e.align,t[r[4]]=e.baseline})),t.reflow(n).modifies(r)}}}),__.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]},Object(ye.z)(__,ot,{transform:function(e,t){var n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){var r=w_(t.materialize(t.SOURCE).source,e.groupby),i=(e.groupby||[]).map(ye.h),a=i.length,o=e.as||[Object(ye.h)(e.x),Object(ye.h)(e.y)],s=[];r.forEach((function(t){un(t,e.x,e.y,e.bandwidth||.3).forEach((function(e){for(var n={},r=0;r<a;++r)n[i[r]]=t.dims[r];n[o[0]]=e[0],n[o[1]]=e[1],s.push(De(n))}))})),this.value&&(n.rem=this.value),this.value=n.add=n.source=s}return n}});var k_={linear:Qt,log:en,exp:tn,pow:nn,quad:rn,poly:an};function E_(e){ot.call(this,null,e)}E_.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(k_)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]},Object(ye.z)(E_,ot,{transform:function(e,t){var n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){var r=w_(t.materialize(t.SOURCE).source,e.groupby),i=(e.groupby||[]).map(ye.h),a=e.method||"linear",o=e.order||3,s=function(e,t){return"poly"===e?t:"quad"===e?2:1}(a,o),u=e.as||[Object(ye.h)(e.x),Object(ye.h)(e.y)],c=k_[a],l=[],f=e.extent;Object(ye.w)(k_,a)||Object(ye.o)("Invalid regression method: "+a),null!=f&&"log"===a&&f[0]<=0&&(t.dataflow.warn("Ignoring extent with values <= 0 for log regression."),f=null),r.forEach((function(n){if(n.length<=s)t.dataflow.warn("Skipping regression with more parameters than data points.");else{var r=c(n,e.x,e.y,o);if(e.params)l.push(De({keys:n.dims,coef:r.coef,rSquared:r.rSquared}));else{var d=f||Object(ye.q)(n,e.x),h=function(e){for(var t={},r=0;r<i.length;++r)t[i[r]]=n.dims[r];t[u[0]]=e[0],t[u[1]]=e[1],l.push(De(t))};"linear"===a?d.forEach((function(e){return h([e,r.predict(e)])})):dn(r.predict,d,25,200).forEach(h)}}})),this.value&&(n.rem=this.value),this.value=n.add=n.source=l}return n}});var S_=Math.pow(2,-52),C_=new Uint32Array(512),A_=function(){function e(t){v(this,e);var n=t.length>>1;if(n>0&&"number"!=typeof t[0])throw new Error("Expected coords to contain numbers.");this.coords=t;var r=Math.max(2*n-5,0);this._triangles=new Uint32Array(3*r),this._halfedges=new Int32Array(3*r),this._hashSize=Math.ceil(Math.sqrt(n)),this._hullPrev=new Uint32Array(n),this._hullNext=new Uint32Array(n),this._hullTri=new Uint32Array(n),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(n),this._dists=new Float64Array(n),this.update()}return g(e,[{key:"update",value:function(){for(var e=this.coords,t=this._hullPrev,n=this._hullNext,r=this._hullTri,i=this._hullHash,a=e.length>>1,o=1/0,s=1/0,u=-1/0,c=-1/0,l=0;l<a;l++){var f=e[2*l],d=e[2*l+1];f<o&&(o=f),d<s&&(s=d),f>u&&(u=f),d>c&&(c=d),this._ids[l]=l}for(var h,p,m,v=(o+u)/2,g=(s+c)/2,y=1/0,b=0;b<a;b++){var x=O_(v,g,e[2*b],e[2*b+1]);x<y&&(h=b,y=x)}var w=e[2*h],_=e[2*h+1];y=1/0;for(var k=0;k<a;k++)if(k!==h){var E=O_(w,_,e[2*k],e[2*k+1]);E<y&&E>0&&(p=k,y=E)}for(var S=e[2*p],C=e[2*p+1],A=1/0,O=0;O<a;O++)if(O!==h&&O!==p){var D=M_(w,_,S,C,e[2*O],e[2*O+1]);D<A&&(m=O,A=D)}var T=e[2*m],j=e[2*m+1];if(A===1/0){for(var M=0;M<a;M++)this._dists[M]=e[2*M]-e[0]||e[2*M+1]-e[1];F_(this._ids,this._dists,0,a-1);for(var F=new Uint32Array(a),I=0,N=0,R=-1/0;N<a;N++){var P=this._ids[N];this._dists[P]>R&&(F[I++]=P,R=this._dists[P])}return this.hull=F.subarray(0,I),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(T_(w,_,S,C,T,j)){var B=p,L=S,z=C;p=m,S=T,C=j,m=B,T=L,j=z}var U=function(e,t,n,r,i,a){var o=n-e,s=r-t,u=i-e,c=a-t,l=o*o+s*s,f=u*u+c*c,d=.5/(o*c-s*u);return{x:e+(c*l-s*f)*d,y:t+(o*f-u*l)*d}}(w,_,S,C,T,j);this._cx=U.x,this._cy=U.y;for(var W=0;W<a;W++)this._dists[W]=O_(e[2*W],e[2*W+1],U.x,U.y);F_(this._ids,this._dists,0,a-1),this._hullStart=h;var V=3;n[h]=t[m]=p,n[p]=t[h]=m,n[m]=t[p]=h,r[h]=0,r[p]=1,r[m]=2,i.fill(-1),i[this._hashKey(w,_)]=h,i[this._hashKey(S,C)]=p,i[this._hashKey(T,j)]=m,this.trianglesLen=0,this._addTriangle(h,p,m,-1,-1,-1);for(var G,q,H=0;H<this._ids.length;H++){var X=this._ids[H],K=e[2*X],Y=e[2*X+1];if(!(H>0&&Math.abs(K-G)<=S_&&Math.abs(Y-q)<=S_)&&(G=K,q=Y,X!==h&&X!==p&&X!==m)){for(var $=0,J=0,Z=this._hashKey(K,Y);J<this._hashSize&&(-1===($=i[(Z+J)%this._hashSize])||$===n[$]);J++);for(var Q=void 0,ee=$=t[$];Q=n[ee],!T_(K,Y,e[2*ee],e[2*ee+1],e[2*Q],e[2*Q+1]);)if((ee=Q)===$){ee=-1;break}if(-1!==ee){var te=this._addTriangle(ee,X,n[ee],-1,-1,r[ee]);r[X]=this._legalize(te+2),r[ee]=te,V++;for(var ne=n[ee];Q=n[ne],T_(K,Y,e[2*ne],e[2*ne+1],e[2*Q],e[2*Q+1]);)te=this._addTriangle(ne,X,Q,r[X],-1,r[ne]),r[X]=this._legalize(te+2),n[ne]=ne,V--,ne=Q;if(ee===$)for(;T_(K,Y,e[2*(Q=t[ee])],e[2*Q+1],e[2*ee],e[2*ee+1]);)te=this._addTriangle(Q,X,ee,-1,r[ee],r[Q]),this._legalize(te+2),r[Q]=te,n[ee]=ee,V--,ee=Q;this._hullStart=t[X]=ee,n[ee]=t[ne]=X,n[X]=ne,i[this._hashKey(K,Y)]=X,i[this._hashKey(e[2*ee],e[2*ee+1])]=ee}}}this.hull=new Uint32Array(V);for(var re=0,ie=this._hullStart;re<V;re++)this.hull[re]=ie,ie=n[ie];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}},{key:"_hashKey",value:function(e,t){return Math.floor(function(e,t){var n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize}},{key:"_legalize",value:function(e){for(var t=this._triangles,n=this._halfedges,r=this.coords,i=0,a=0;;){var o=n[e],s=e-e%3;if(a=s+(e+2)%3,-1!==o){var u=o-o%3,c=s+(e+1)%3,l=u+(o+2)%3,f=t[a],d=t[e],h=t[c],p=t[l];if(j_(r[2*f],r[2*f+1],r[2*d],r[2*d+1],r[2*h],r[2*h+1],r[2*p],r[2*p+1])){t[e]=p,t[o]=f;var m=n[l];if(-1===m){var v=this._hullStart;do{if(this._hullTri[v]===l){this._hullTri[v]=e;break}v=this._hullPrev[v]}while(v!==this._hullStart)}this._link(e,m),this._link(o,n[a]),this._link(a,l);var g=u+(o+1)%3;i<C_.length&&(C_[i++]=g)}else{if(0===i)break;e=C_[--i]}}else{if(0===i)break;e=C_[--i]}}return a}},{key:"_link",value:function(e,t){this._halfedges[e]=t,-1!==t&&(this._halfedges[t]=e)}},{key:"_addTriangle",value:function(e,t,n,r,i,a){var o=this.trianglesLen;return this._triangles[o]=e,this._triangles[o+1]=t,this._triangles[o+2]=n,this._link(o,r),this._link(o+1,i),this._link(o+2,a),this.trianglesLen+=3,o}}],[{key:"from",value:function(t){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return e[0]},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return e[1]},i=t.length,a=new Float64Array(2*i),o=0;o<i;o++){var s=t[o];a[2*o]=n(s),a[2*o+1]=r(s)}return new e(a)}}]),e}();function O_(e,t,n,r){var i=e-n,a=t-r;return i*i+a*a}function D_(e,t,n,r,i,a){var o=(r-t)*(i-e),s=(n-e)*(a-t);return Math.abs(o-s)>=33306690738754716e-32*Math.abs(o+s)?o-s:0}function T_(e,t,n,r,i,a){return(D_(i,a,e,t,n,r)||D_(e,t,n,r,i,a)||D_(n,r,i,a,e,t))<0}function j_(e,t,n,r,i,a,o,s){var u=e-o,c=t-s,l=n-o,f=r-s,d=i-o,h=a-s,p=l*l+f*f,m=d*d+h*h;return u*(f*m-p*h)-c*(l*m-p*d)+(u*u+c*c)*(l*h-f*d)<0}function M_(e,t,n,r,i,a){var o=n-e,s=r-t,u=i-e,c=a-t,l=o*o+s*s,f=u*u+c*c,d=.5/(o*c-s*u),h=(c*l-s*f)*d,p=(o*f-u*l)*d;return h*h+p*p}function F_(e,t,n,r){if(r-n<=20)for(var i=n+1;i<=r;i++){for(var a=e[i],o=t[a],s=i-1;s>=n&&t[e[s]]>o;)e[s+1]=e[s--];e[s+1]=a}else{var u=n+1,c=r;I_(e,n+r>>1,u),t[e[n]]>t[e[r]]&&I_(e,n,r),t[e[u]]>t[e[r]]&&I_(e,u,r),t[e[n]]>t[e[u]]&&I_(e,n,u);for(var l=e[u],f=t[l];;){do{u++}while(t[e[u]]<f);do{c--}while(t[e[c]]>f);if(c<u)break;I_(e,u,c)}e[n+1]=e[c],e[c]=l,r-u+1>=c-n?(F_(e,t,u,r),F_(e,t,n,c-1)):(F_(e,t,n,c-1),F_(e,t,u,r))}}function I_(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}var N_=1e-6,R_=function(){function e(){v(this,e),this._x0=this._y0=this._x1=this._y1=null,this._=""}return g(e,[{key:"moveTo",value:function(e,t){this._+="M".concat(this._x0=this._x1=+e,",").concat(this._y0=this._y1=+t)}},{key:"closePath",value:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}},{key:"lineTo",value:function(e,t){this._+="L".concat(this._x1=+e,",").concat(this._y1=+t)}},{key:"arc",value:function(e,t,n){var r=(e=+e)+(n=+n),i=t=+t;if(n<0)throw new Error("negative radius");null===this._x1?this._+="M".concat(r,",").concat(i):(Math.abs(this._x1-r)>N_||Math.abs(this._y1-i)>N_)&&(this._+="L"+r+","+i),n&&(this._+="A".concat(n,",").concat(n,",0,1,1,").concat(e-n,",").concat(t,"A").concat(n,",").concat(n,",0,1,1,").concat(this._x1=r,",").concat(this._y1=i))}},{key:"rect",value:function(e,t,n,r){this._+="M".concat(this._x0=this._x1=+e,",").concat(this._y0=this._y1=+t,"h").concat(+n,"v").concat(+r,"h").concat(-n,"Z")}},{key:"value",value:function(){return this._||null}}]),e}(),P_=function(){function e(){v(this,e),this._=[]}return g(e,[{key:"moveTo",value:function(e,t){this._.push([e,t])}},{key:"closePath",value:function(){this._.push(this._[0].slice())}},{key:"lineTo",value:function(e,t){this._.push([e,t])}},{key:"value",value:function(){return this._.length?this._:null}}]),e}(),B_=function(){function e(t){var n=f(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,960,500],4),r=n[0],i=n[1],a=n[2],o=n[3];if(v(this,e),!((a=+a)>=(r=+r)&&(o=+o)>=(i=+i)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(2*t.points.length),this.vectors=new Float64Array(2*t.points.length),this.xmax=a,this.xmin=r,this.ymax=o,this.ymin=i,this._init()}return g(e,[{key:"update",value:function(){return this.delaunay.update(),this._init(),this}},{key:"_init",value:function(){for(var e,t,n=this.delaunay,r=n.points,i=n.hull,a=n.triangles,o=this.vectors,s=this.circumcenters=this._circumcenters.subarray(0,a.length/3*2),u=0,c=0,l=a.length;u<l;u+=3,c+=2){var f=2*a[u],d=2*a[u+1],h=2*a[u+2],p=r[f],m=r[f+1],v=r[d],g=r[d+1],y=r[h],b=r[h+1],x=v-p,w=g-m,_=y-p,k=b-m,E=x*x+w*w,S=_*_+k*k,C=2*(x*k-w*_);if(C)if(Math.abs(C)<1e-8)e=(p+y)/2,t=(m+b)/2;else{var A=1/C;e=p+(k*E-w*S)*A,t=m+(x*S-_*E)*A}else e=(p+y)/2-1e8*k,t=(m+b)/2+1e8*_;s[c]=e,s[c+1]=t}var O,D,T,j=i[i.length-1],M=4*j,F=r[2*j],I=r[2*j+1];o.fill(0);for(var N=0;N<i.length;++N)O=M,D=F,T=I,M=4*(j=i[N]),F=r[2*j],I=r[2*j+1],o[O+2]=o[M]=T-I,o[O+3]=o[M+1]=F-D}},{key:"render",value:function(e){var t=null==e?e=new R_:void 0,n=this.delaunay,r=n.halfedges,i=n.inedges,a=n.hull,o=this.circumcenters,s=this.vectors;if(a.length<=1)return null;for(var u=0,c=r.length;u<c;++u){var l=r[u];if(!(l<u)){var f=2*Math.floor(u/3),d=2*Math.floor(l/3),h=o[f],p=o[f+1],m=o[d],v=o[d+1];this._renderSegment(h,p,m,v,e)}}for(var g,y=a[a.length-1],b=0;b<a.length;++b){g=y,y=a[b];var x=2*Math.floor(i[y]/3),w=o[x],_=o[x+1],k=4*g,E=this._project(w,_,s[k+2],s[k+3]);E&&this._renderSegment(w,_,E[0],E[1],e)}return t&&t.value()}},{key:"renderBounds",value:function(e){var t=null==e?e=new R_:void 0;return e.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),t&&t.value()}},{key:"renderCell",value:function(e,t){var n=null==t?t=new R_:void 0,r=this._clip(e);if(null!==r&&r.length){t.moveTo(r[0],r[1]);for(var i=r.length;r[0]===r[i-2]&&r[1]===r[i-1]&&i>1;)i-=2;for(var a=2;a<i;a+=2)r[a]===r[a-2]&&r[a+1]===r[a-1]||t.lineTo(r[a],r[a+1]);return t.closePath(),n&&n.value()}}},{key:"cellPolygons",value:m().mark((function e(){var t,n,r,i;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.delaunay.points,n=0,r=t.length/2;case 2:if(!(n<r)){e.next=12;break}if(i=this.cellPolygon(n),e.t0=i,!e.t0){e.next=9;break}return i.index=n,e.next=9,i;case 9:++n,e.next=2;break;case 12:case"end":return e.stop()}}),e,this)}))},{key:"cellPolygon",value:function(e){var t=new P_;return this.renderCell(e,t),t.value()}},{key:"_renderSegment",value:function(e,t,n,r,i){var a,o=this._regioncode(e,t),s=this._regioncode(n,r);0===o&&0===s?(i.moveTo(e,t),i.lineTo(n,r)):(a=this._clipSegment(e,t,n,r,o,s))&&(i.moveTo(a[0],a[1]),i.lineTo(a[2],a[3]))}},{key:"contains",value:function(e,t,n){return(t=+t)==t&&(n=+n)==n&&this.delaunay._step(e,t,n)===e}},{key:"neighbors",value:m().mark((function e(t){var n,r,i,a,o,s,u,c,l;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=this._clip(t))){e.next=33;break}r=p(this.delaunay.neighbors(t)),e.prev=3,r.s();case 5:if((i=r.n()).done){e.next=25;break}if(a=i.value,!(o=this._clip(a))){e.next=23;break}s=0,u=n.length;case 10:if(!(s<u)){e.next=23;break}c=0,l=o.length;case 12:if(!(c<l)){e.next=20;break}if(n[s]!=o[c]||n[s+1]!=o[c+1]||n[(s+2)%u]!=o[(c+l-2)%l]||n[(s+3)%u]!=o[(c+l-1)%l]){e.next=17;break}return e.next=16,a;case 16:return e.abrupt("break",23);case 17:c+=2,e.next=12;break;case 20:s+=2,e.next=10;break;case 23:e.next=5;break;case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(3),r.e(e.t0);case 30:return e.prev=30,r.f(),e.finish(30);case 33:case"end":return e.stop()}}),e,this,[[3,27,30,33]])}))},{key:"_cell",value:function(e){var t=this.circumcenters,n=this.delaunay,r=n.inedges,i=n.halfedges,a=n.triangles,o=r[e];if(-1===o)return null;var s=[],u=o;do{var c=Math.floor(u/3);if(s.push(t[2*c],t[2*c+1]),a[u=u%3==2?u-2:u+1]!==e)break;u=i[u]}while(u!==o&&-1!==u);return s}},{key:"_clip",value:function(e){if(0===e&&1===this.delaunay.hull.length)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];var t=this._cell(e);if(null===t)return null;var n=this.vectors,r=4*e;return n[r]||n[r+1]?this._clipInfinite(e,t,n[r],n[r+1],n[r+2],n[r+3]):this._clipFinite(e,t)}},{key:"_clipFinite",value:function(e,t){for(var n,r,i,a,o,s=t.length,u=null,c=t[s-2],l=t[s-1],d=this._regioncode(c,l),h=0;h<s;h+=2)if(n=c,r=l,c=t[h],l=t[h+1],i=d,d=this._regioncode(c,l),0===i&&0===d)a=o,o=0,u?u.push(c,l):u=[c,l];else{var p=void 0,m=void 0,v=void 0,g=void 0,y=void 0;if(0===i){if(null===(p=this._clipSegment(n,r,c,l,i,d)))continue;var b=f(p,4);m=b[0],v=b[1],g=b[2],y=b[3]}else{var x;if(null===(p=this._clipSegment(c,l,n,r,d,i)))continue;g=(x=f(p,4))[0],y=x[1],m=x[2],v=x[3],a=o,o=this._edgecode(m,v),a&&o&&this._edge(e,a,o,u,u.length),u?u.push(m,v):u=[m,v]}a=o,o=this._edgecode(g,y),a&&o&&this._edge(e,a,o,u,u.length),u?u.push(g,y):u=[g,y]}if(u)a=o,o=this._edgecode(u[0],u[1]),a&&o&&this._edge(e,a,o,u,u.length);else if(this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return u}},{key:"_clipSegment",value:function(e,t,n,r,i,a){for(;;){if(0===i&&0===a)return[e,t,n,r];if(i&a)return null;var o=void 0,s=void 0,u=i||a;8&u?(o=e+(n-e)*(this.ymax-t)/(r-t),s=this.ymax):4&u?(o=e+(n-e)*(this.ymin-t)/(r-t),s=this.ymin):2&u?(s=t+(r-t)*(this.xmax-e)/(n-e),o=this.xmax):(s=t+(r-t)*(this.xmin-e)/(n-e),o=this.xmin),i?(e=o,t=s,i=this._regioncode(e,t)):(n=o,r=s,a=this._regioncode(n,r))}}},{key:"_clipInfinite",value:function(e,t,n,r,i,a){var o,s=Array.from(t);if((o=this._project(s[0],s[1],n,r))&&s.unshift(o[0],o[1]),(o=this._project(s[s.length-2],s[s.length-1],i,a))&&s.push(o[0],o[1]),s=this._clipFinite(e,s))for(var u,c=0,l=s.length,f=this._edgecode(s[l-2],s[l-1]);c<l;c+=2)u=f,f=this._edgecode(s[c],s[c+1]),u&&f&&(c=this._edge(e,u,f,s,c),l=s.length);else this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(s=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return s}},{key:"_edge",value:function(e,t,n,r,i){for(;t!==n;){var a=void 0,o=void 0;switch(t){case 5:t=4;continue;case 4:t=6,a=this.xmax,o=this.ymin;break;case 6:t=2;continue;case 2:t=10,a=this.xmax,o=this.ymax;break;case 10:t=8;continue;case 8:t=9,a=this.xmin,o=this.ymax;break;case 9:t=1;continue;case 1:t=5,a=this.xmin,o=this.ymin}r[i]===a&&r[i+1]===o||!this.contains(e,a,o)||(r.splice(i,0,a,o),i+=2)}if(r.length>4)for(var s=0;s<r.length;s+=2){var u=(s+2)%r.length,c=(s+4)%r.length;(r[s]===r[u]&&r[u]===r[c]||r[s+1]===r[u+1]&&r[u+1]===r[c+1])&&(r.splice(u,2),s-=2)}return i}},{key:"_project",value:function(e,t,n,r){var i,a,o,s=1/0;if(r<0){if(t<=this.ymin)return null;(i=(this.ymin-t)/r)<s&&(o=this.ymin,a=e+(s=i)*n)}else if(r>0){if(t>=this.ymax)return null;(i=(this.ymax-t)/r)<s&&(o=this.ymax,a=e+(s=i)*n)}if(n>0){if(e>=this.xmax)return null;(i=(this.xmax-e)/n)<s&&(a=this.xmax,o=t+(s=i)*r)}else if(n<0){if(e<=this.xmin)return null;(i=(this.xmin-e)/n)<s&&(a=this.xmin,o=t+(s=i)*r)}return[a,o]}},{key:"_edgecode",value:function(e,t){return(e===this.xmin?1:e===this.xmax?2:0)|(t===this.ymin?4:t===this.ymax?8:0)}},{key:"_regioncode",value:function(e,t){return(e<this.xmin?1:e>this.xmax?2:0)|(t<this.ymin?4:t>this.ymax?8:0)}}]),e}(),L_=2*Math.PI,z_=Math.pow;function U_(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}var W_=function(){function e(t){v(this,e),this._delaunator=new A_(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}return g(e,[{key:"update",value:function(){return this._delaunator.update(),this._init(),this}},{key:"_init",value:function(){var e=this._delaunator,t=this.points;if(e.hull&&e.hull.length>2&&function(e){for(var t=e.triangles,n=e.coords,r=0;r<t.length;r+=3){var i=2*t[r],a=2*t[r+1],o=2*t[r+2];if((n[o]-n[i])*(n[a+1]-n[i+1])-(n[a]-n[i])*(n[o+1]-n[i+1])>1e-10)return!1}return!0}(e)){this.collinear=Int32Array.from({length:t.length/2},(function(e,t){return t})).sort((function(e,n){return t[2*e]-t[2*n]||t[2*e+1]-t[2*n+1]}));for(var n=this.collinear[0],r=this.collinear[this.collinear.length-1],i=[t[2*n],t[2*n+1],t[2*r],t[2*r+1]],a=1e-8*Math.hypot(i[3]-i[1],i[2]-i[0]),o=0,s=t.length/2;o<s;++o){var u=U_(t[2*o],t[2*o+1],a);t[2*o]=u[0],t[2*o+1]=u[1]}this._delaunator=new A_(t)}else delete this.collinear;for(var c=this.halfedges=this._delaunator.halfedges,l=this.hull=this._delaunator.hull,f=this.triangles=this._delaunator.triangles,d=this.inedges.fill(-1),h=this._hullIndex.fill(-1),p=0,m=c.length;p<m;++p){var v=f[p%3==2?p-2:p+1];-1!==c[p]&&-1!==d[v]||(d[v]=p)}for(var g=0,y=l.length;g<y;++g)h[l[g]]=g;l.length<=2&&l.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=l[0],this.triangles[1]=l[1],this.triangles[2]=l[1],d[l[0]]=1,2===l.length&&(d[l[1]]=0))}},{key:"voronoi",value:function(e){return new B_(this,e)}},{key:"neighbors",value:m().mark((function e(t){var n,r,i,a,o,s,u,c,l,f,d;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.inedges,r=this.hull,i=this._hullIndex,a=this.halfedges,o=this.triangles,!(s=this.collinear)){e.next=13;break}if(u=s.indexOf(t),e.t0=u>0,!e.t0){e.next=7;break}return e.next=7,s[u-1];case 7:if(e.t1=u<s.length-1,!e.t1){e.next=12;break}return e.next=11,s[u+1];case 11:e.t1=e.sent;case 12:return e.abrupt("return",void e.t1);case 13:if(-1!==(c=n[t])){e.next=16;break}return e.abrupt("return");case 16:l=c,f=-1;case 17:return e.next=19,f=o[l];case 19:if(o[l=l%3==2?l-2:l+1]===t){e.next=21;break}return e.abrupt("return");case 21:if(-1!==(l=a[l])){e.next=29;break}if(d=r[(i[t]+1)%r.length],e.t2=d!==f,!e.t2){e.next=28;break}return e.next=27,d;case 27:e.t2=e.sent;case 28:return e.abrupt("return",void e.t2);case 29:if(l!==c){e.next=17;break}case 30:case"end":return e.stop()}}),e,this)}))},{key:"find",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if((e=+e)!=e||(t=+t)!=t)return-1;for(var r,i=n;(r=this._step(n,e,t))>=0&&r!==n&&r!==i;)n=r;return r}},{key:"_step",value:function(e,t,n){var r=this.inedges,i=this.hull,a=this._hullIndex,o=this.halfedges,s=this.triangles,u=this.points;if(-1===r[e]||!u.length)return(e+1)%(u.length>>1);var c=e,l=z_(t-u[2*e],2)+z_(n-u[2*e+1],2),f=r[e],d=f;do{var h=s[d],p=z_(t-u[2*h],2)+z_(n-u[2*h+1],2);if(p<l&&(l=p,c=h),s[d=d%3==2?d-2:d+1]!==e)break;if(-1===(d=o[d])){if((d=i[(a[e]+1)%i.length])!==h&&z_(t-u[2*d],2)+z_(n-u[2*d+1],2)<l)return d;break}}while(d!==f);return c}},{key:"render",value:function(e){for(var t=null==e?e=new R_:void 0,n=this.points,r=this.halfedges,i=this.triangles,a=0,o=r.length;a<o;++a){var s=r[a];if(!(s<a)){var u=2*i[a],c=2*i[s];e.moveTo(n[u],n[u+1]),e.lineTo(n[c],n[c+1])}}return this.renderHull(e),t&&t.value()}},{key:"renderPoints",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=null==e?e=new R_:void 0,r=this.points,i=0,a=r.length;i<a;i+=2){var o=r[i],s=r[i+1];e.moveTo(o+t,s),e.arc(o,s,t,0,L_)}return n&&n.value()}},{key:"renderHull",value:function(e){var t=null==e?e=new R_:void 0,n=this.hull,r=this.points,i=2*n[0],a=n.length;e.moveTo(r[i],r[i+1]);for(var o=1;o<a;++o){var s=2*n[o];e.lineTo(r[s],r[s+1])}return e.closePath(),t&&t.value()}},{key:"hullPolygon",value:function(){var e=new P_;return this.renderHull(e),e.value()}},{key:"renderTriangle",value:function(e,t){var n=null==t?t=new R_:void 0,r=this.points,i=this.triangles,a=2*i[e*=3],o=2*i[e+1],s=2*i[e+2];return t.moveTo(r[a],r[a+1]),t.lineTo(r[o],r[o+1]),t.lineTo(r[s],r[s+1]),t.closePath(),n&&n.value()}},{key:"trianglePolygons",value:m().mark((function e(){var t,n,r;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.triangles,n=0,r=t.length/3;case 2:if(!(n<r)){e.next=8;break}return e.next=5,this.trianglePolygon(n);case 5:++n,e.next=2;break;case 8:case"end":return e.stop()}}),e,this)}))},{key:"trianglePolygon",value:function(e){var t=new P_;return this.renderTriangle(e,t),t.value()}}],[{key:"from",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return e[0]},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return e[1]},i=arguments.length>3?arguments[3]:void 0;return new e("length"in t?function(e,t,n,r){for(var i=e.length,a=new Float64Array(2*i),o=0;o<i;++o){var s=e[o];a[2*o]=t.call(r,s,o,e),a[2*o+1]=n.call(r,s,o,e)}return a}(t,n,r,i):Float64Array.from(m().mark((function e(t,n,r,i){var a,o,s,u;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=0,o=p(t),e.prev=2,o.s();case 4:if((s=o.n()).done){e.next=13;break}return u=s.value,e.next=8,n.call(i,u,a,t);case 8:return e.next=10,r.call(i,u,a,t);case 10:++a;case 11:e.next=4;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(2),o.e(e.t0);case 18:return e.prev=18,o.f(),e.finish(18);case 21:case"end":return e.stop()}}),e,null,[[2,15,18,21]])}))(t,n,r,i)))}}]),e}();function V_(e){ot.call(this,null,e)}V_.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};var G_=[-1e5,-1e5,1e5,1e5];function q_(e){for(var t=e[0][0],n=e[0][1],r=e.length-1;e[r][0]===t&&e[r][1]===n;--r);return"M"+e.slice(0,r+1).join("L")+"Z"}Object(ye.z)(V_,ot,{transform:function(e,t){var n=e.as||"path",r=t.source;if(!r||!r.length)return t;var i=e.size;i=i?[0,0,i[0],i[1]]:(i=e.extent)?[i[0][0],i[0][1],i[1][0],i[1][1]]:G_;for(var a=this.value=W_.from(r,e.x,e.y).voronoi(i),o=0,s=r.length;o<s;++o){var u=a.cellPolygon(o);r[o][n]=u?q_(u):null}return t.reflow(e.modified()).modifies(n)}});var H_=Math.PI/180,X_=64,K_=2048;function Y_(){var e,t,n,r,i,a,o,s=[256,256],u=ek,c=[],l=Math.random,f={};function d(e,t,n){for(var r,i,a,o=t.x,c=t.y,f=Math.sqrt(s[0]*s[0]+s[1]*s[1]),d=u(s),h=l()<.5?1:-1,p=-h;(r=d(p+=h))&&(i=~~r[0],a=~~r[1],!(Math.min(Math.abs(i),Math.abs(a))>=f));)if(t.x=o+i,t.y=c+a,!(t.x+t.x0<0||t.y+t.y0<0||t.x+t.x1>s[0]||t.y+t.y1>s[1])&&(!n||!J_(t,e,s[0]))&&(!n||Q_(t,n))){for(var m,v=t.sprite,g=t.width>>5,y=s[0]>>5,b=t.x-(g<<4),x=127&b,w=32-x,_=t.y1-t.y0,k=(t.y+t.y0)*y+(b>>5),E=0;E<_;E++){m=0;for(var S=0;S<=g;S++)e[k+S]|=m<<w|(S<g?(m=v[E*g+S])>>>x:0);k+=y}return t.sprite=null,!0}return!1}return f.layout=function(){for(var u=function(e){e.width=e.height=1;var t=Math.sqrt(e.getContext("2d").getImageData(0,0,1,1).data.length>>2);e.width=(X_<<5)/t,e.height=K_/t;var n=e.getContext("2d");return n.fillStyle=n.strokeStyle="red",n.textAlign="center",{context:n,ratio:t}}(ta()),f=function(e){for(var t=[],n=-1;++n<e;)t[n]=0;return t}((s[0]>>5)*s[1]),h=null,p=c.length,m=-1,v=[],g=c.map((function(s){return{text:e(s),font:t(s),style:r(s),weight:i(s),rotate:a(s),size:~~(n(s)+1e-14),padding:o(s),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:s}})).sort((function(e,t){return t.size-e.size}));++m<p;){var y=g[m];y.x=s[0]*(l()+.5)>>1,y.y=s[1]*(l()+.5)>>1,$_(u,y,g,m),y.hasText&&d(f,y,h)&&(v.push(y),h?Z_(h,y):h=[{x:y.x+y.x0,y:y.y+y.y0},{x:y.x+y.x1,y:y.y+y.y1}],y.x-=s[0]>>1,y.y-=s[1]>>1)}return v},f.words=function(e){return arguments.length?(c=e,f):c},f.size=function(e){return arguments.length?(s=[+e[0],+e[1]],f):s},f.font=function(e){return arguments.length?(t=tk(e),f):t},f.fontStyle=function(e){return arguments.length?(r=tk(e),f):r},f.fontWeight=function(e){return arguments.length?(i=tk(e),f):i},f.rotate=function(e){return arguments.length?(a=tk(e),f):a},f.text=function(t){return arguments.length?(e=tk(t),f):e},f.spiral=function(e){return arguments.length?(u=nk[e]||e,f):u},f.fontSize=function(e){return arguments.length?(n=tk(e),f):n},f.padding=function(e){return arguments.length?(o=tk(e),f):o},f.random=function(e){return arguments.length?(l=e,f):l},f}function $_(e,t,n,r){if(!t.sprite){var i=e.context,a=e.ratio;i.clearRect(0,0,(X_<<5)/a,K_/a);var o,s,u,c,l,f=0,d=0,h=0,p=n.length;for(--r;++r<p;){if(t=n[r],i.save(),i.font=t.style+" "+t.weight+" "+~~((t.size+1)/a)+"px "+t.font,o=i.measureText(t.text+"m").width*a,u=t.size<<1,t.rotate){var m=Math.sin(t.rotate*H_),v=Math.cos(t.rotate*H_),g=o*v,y=o*m,b=u*v,x=u*m;o=Math.max(Math.abs(g+x),Math.abs(g-x))+31>>5<<5,u=~~Math.max(Math.abs(y+b),Math.abs(y-b))}else o=o+31>>5<<5;if(u>h&&(h=u),f+o>=X_<<5&&(f=0,d+=h,h=0),d+u>=K_)break;i.translate((f+(o>>1))/a,(d+(u>>1))/a),t.rotate&&i.rotate(t.rotate*H_),i.fillText(t.text,0,0),t.padding&&(i.lineWidth=2*t.padding,i.strokeText(t.text,0,0)),i.restore(),t.width=o,t.height=u,t.xoff=f,t.yoff=d,t.x1=o>>1,t.y1=u>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,f+=o}for(var w=i.getImageData(0,0,(X_<<5)/a,K_/a).data,_=[];--r>=0;)if((t=n[r]).hasText){for(s=(o=t.width)>>5,u=t.y1-t.y0,c=0;c<u*s;c++)_[c]=0;if(null==(f=t.xoff))return;d=t.yoff;var k=0,E=-1;for(l=0;l<u;l++){for(c=0;c<o;c++){var S=s*l+(c>>5),C=w[(d+l)*(X_<<5)+(f+c)<<2]?1<<31-c%32:0;_[S]|=C,k|=C}k?E=l:(t.y0++,u--,l--,d++)}t.y1=t.y0+E,t.sprite=_.slice(0,(t.y1-t.y0)*s)}}}function J_(e,t,n){n>>=5;for(var r,i=e.sprite,a=e.width>>5,o=e.x-(a<<4),s=127&o,u=32-s,c=e.y1-e.y0,l=(e.y+e.y0)*n+(o>>5),f=0;f<c;f++){r=0;for(var d=0;d<=a;d++)if((r<<u|(d<a?(r=i[f*a+d])>>>s:0))&t[l+d])return!0;l+=n}return!1}function Z_(e,t){var n=e[0],r=e[1];t.x+t.x0<n.x&&(n.x=t.x+t.x0),t.y+t.y0<n.y&&(n.y=t.y+t.y0),t.x+t.x1>r.x&&(r.x=t.x+t.x1),t.y+t.y1>r.y&&(r.y=t.y+t.y1)}function Q_(e,t){return e.x+e.x1>t[0].x&&e.x+e.x0<t[1].x&&e.y+e.y1>t[0].y&&e.y+e.y0<t[1].y}function ek(e){var t=e[0]/e[1];return function(e){return[t*(e*=.1)*Math.cos(e),e*Math.sin(e)]}}function tk(e){return"function"==typeof e?e:function(){return e}}var nk={archimedean:ek,rectangular:function(e){var t=4*e[0]/e[1],n=0,r=0;return function(e){var i=e<0?-1:1;switch(Math.sqrt(1+4*i*e)-i&3){case 0:n+=t;break;case 1:r+=4;break;case 2:n-=t;break;default:r-=4}return[n,r]}}},rk=["x","y","font","fontSize","fontStyle","fontWeight","angle"],ik=["text","font","rotate","fontSize","fontStyle","fontWeight"];function ak(e){ot.call(this,Y_(),e)}ak.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:rk}]},Object(ye.z)(ak,ot,{transform:function(e,t){!e.size||e.size[0]&&e.size[1]||Object(ye.o)("Wordcloud size dimensions must be non-zero.");var n=e.modified();if(n||t.changed(t.ADD_REM)||ik.some((function(n){var r=e[n];return Object(ye.E)(r)&&t.modified(r.fields)}))){var r,i=t.materialize(t.SOURCE).source,a=this.value,o=e.as||rk,s=e.fontSize||14;if(Object(ye.E)(s)?r=e.fontSizeRange:s=Object(ye.m)(s),r){var u=s,c=qu("sqrt")().domain(Object(ye.q)(i,u)).range(r);s=function(e){return c(u(e))}}i.forEach((function(e){e[o[0]]=NaN,e[o[1]]=NaN,e[o[3]]=0}));for(var l,f,d=a.words(i).text(e.text).size(e.size||[500,500]).padding(e.padding||1).spiral(e.spiral||"archimedean").rotate(e.rotate||0).font(e.font||"sans-serif").fontStyle(e.fontStyle||"normal").fontWeight(e.fontWeight||"normal").fontSize(s).random(kt).layout(),h=a.size(),p=h[0]>>1,m=h[1]>>1,v=d.length,g=0;g<v;++g)(f=(l=d[g]).datum)[o[0]]=l.x+p,f[o[1]]=l.y+m,f[o[2]]=l.font,f[o[3]]=l.size,f[o[4]]=l.style,f[o[5]]=l.weight,f[o[6]]=l.rotate;return t.reflow(n).modifies(o)}}});var ok=function(e,t){return Array.from(t,(function(t){return e[t]}))},sk=function(e){return new Uint8Array(e)},uk=function(e){return new Uint16Array(e)},ck=function(e){return new Uint32Array(e)};function lk(e,t,n){var r=(t<257?sk:t<65537?uk:ck)(e);return n&&r.set(n),r}function fk(e,t,n){var r=1<<t;return{one:r,zero:~r,range:n.slice(),bisect:e.bisect,index:e.index,size:e.size,onAdd:function(e,t){var n,i=this.bisect(this.range,e.value),a=e.index,o=i[0],s=i[1],u=a.length;for(n=0;n<o;++n)t[a[n]]|=r;for(n=s;n<u;++n)t[a[n]]|=r;return this}}}function dk(){var e=ck(0),t=[],n=0;return{insert:function(r,i,a){if(!i.length)return[];var o,s,u,c=n,l=i.length,f=ck(l),d=Array(l);for(u=0;u<l;++u)d[u]=r(i[u]),f[u]=u;if(d=function(e,t){return e.sort.call(t,(function(t,n){var r=e[t],i=e[n];return r<i?-1:r>i?1:0})),ok(e,t)}(d,f),c)o=t,s=e,t=Array(c+l),e=ck(c+l),function(e,t,n,r,i,a,o,s,u){var c,l=0,f=0;for(c=0;l<r&&f<o;++c)t[l]<i[f]?(s[c]=t[l],u[c]=n[l++]):(s[c]=i[f],u[c]=a[f++]+e);for(;l<r;++l,++c)s[c]=t[l],u[c]=n[l];for(;f<o;++f,++c)s[c]=i[f],u[c]=a[f]+e}(a,o,s,c,d,f,l,t,e);else{if(a>0)for(u=0;u<l;++u)f[u]+=a;t=d,e=f}return n=c+l,{index:f,value:d}},remove:function(r,i){var a,o,s,u=n;for(o=0;!i[e[o]]&&o<u;++o);for(s=o;o<u;++o)i[a=e[o]]||(e[s]=a,t[s]=t[o],++s);n=u-r},bisect:function(e,r){var i;return r?i=r.length:(r=t,i=n),[aa(r,e[0],0,i),ia(r,e[1],0,i)]},reindex:function(t){for(var r=0,i=n;r<i;++r)e[r]=t[e[r]]},index:function(){return e},size:function(){return n}}}function hk(e){ot.call(this,function(){var e=8,t=[],n=ck(0),r=lk(0,e),i=lk(0,e);return{data:function(){return t},seen:function(){return n=function(e,t,n){return e.length>=t?e:((n=n||new e.constructor(t)).set(e),n)}(n,t.length)},add:function(e){for(var n,r=0,i=t.length,a=e.length;r<a;++r)(n=e[r])._index=i++,t.push(n)},remove:function(e,n){var a,o,s,u=t.length,c=Array(u-e),l=t;for(o=0;!n[o]&&o<u;++o)c[o]=t[o],l[o]=o;for(s=o;o<u;++o)a=t[o],n[o]?l[o]=-1:(l[o]=s,r[s]=r[o],i[s]=i[o],c[s]=a,a._index=s++),r[o]=0;return t=c,l},size:function(){return t.length},curr:function(){return r},prev:function(){return i},reset:function(e){return i[e]=r[e]},all:function(){return e<257?255:e<65537?65535:4294967295},set:function(e,t){r[e]|=t},clear:function(e,t){r[e]&=~t},resize:function(t,n){(t>r.length||n>e)&&(e=Math.max(n,e),r=lk(t,e,r),i=lk(t,e))}}}(),e),this._indices=null,this._dims=null}function pk(e){ot.call(this,null,e)}hk.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]},Object(ye.z)(hk,ot,{transform:function(e,t){return this._dims?e.modified("fields")||e.fields.some((function(e){return t.modified(e.fields)}))?this.reinit(e,t):this.eval(e,t):this.init(e,t)},init:function(e,t){for(var n,r,i=e.fields,a=e.query,o=this._indices={},s=this._dims=[],u=a.length,c=0;c<u;++c)r=o[n=i[c].fname]||(o[n]=dk()),s.push(fk(r,c,a[c]));return this.eval(e,t)},reinit:function(e,t){var n,r,i,a,o,s,u,c,l,f=t.materialize().fork(),d=e.fields,h=e.query,p=this._indices,m=this._dims,v=this.value,g=v.curr(),y=v.prev(),b=v.all(),x=f.rem=f.add,w=f.mod,_=h.length,k={};if(y.set(g),t.rem.length&&(o=this.remove(e,t,f)),t.add.length&&v.add(t.add),t.mod.length)for(s={},u=0,c=(a=t.mod).length;u<c;++u)s[a[u]._index]=1;for(u=0;u<_;++u)l=d[u],(!m[u]||e.modified("fields",u)||t.modified(l.fields))&&((n=k[i=l.fname])||(p[i]=r=dk(),k[i]=n=r.insert(l,t.source,0)),m[u]=fk(r,u,h[u]).onAdd(n,g));for(u=0,c=v.data().length;u<c;++u)o[u]||(y[u]!==g[u]?x.push(u):s[u]&&g[u]!==b&&w.push(u));return v.mask=(1<<_)-1,f},eval:function(e,t){var n=t.materialize().fork(),r=this._dims.length,i=0;return t.rem.length&&(this.remove(e,t,n),i|=(1<<r)-1),e.modified("query")&&!e.modified("fields")&&(i|=this.update(e,t,n)),t.add.length&&(this.insert(e,t,n),i|=(1<<r)-1),t.mod.length&&(this.modify(t,n),i|=(1<<r)-1),this.value.mask=i,n},insert:function(e,t,n){var r,i,a,o=t.add,s=this.value,u=this._dims,c=this._indices,l=e.fields,f={},d=n.add,h=s.size()+o.length,p=u.length,m=s.size();s.resize(h,p),s.add(o);var v=s.curr(),g=s.prev(),y=s.all();for(r=0;r<p;++r)a=f[i=l[r].fname]||(f[i]=c[i].insert(l[r],o,m)),u[r].onAdd(a,v);for(;m<h;++m)g[m]=y,v[m]!==y&&d.push(m)},modify:function(e,t){var n,r,i,a=t.mod,o=this.value,s=o.curr(),u=o.all(),c=e.mod;for(n=0,r=c.length;n<r;++n)s[i=c[n]._index]!==u&&a.push(i)},remove:function(e,t,n){var r,i,a,o,s=this._indices,u=this.value,c=u.curr(),l=u.prev(),f=u.all(),d={},h=n.rem,p=t.rem;for(r=0,i=p.length;r<i;++r)d[a=p[r]._index]=1,l[a]=o=c[a],c[a]=f,o!==f&&h.push(a);for(a in s)s[a].remove(i,d);return this.reindex(t,i,d),d},reindex:function(e,t,n){var r=this._indices,i=this.value;e.runAfter((function(){var e=i.remove(t,n);for(var a in r)r[a].reindex(e)}))},update:function(e,t,n){var r,i,a=this._dims,o=e.query,s=t.stamp,u=a.length,c=0;for(n.filters=0,i=0;i<u;++i)e.modified("query",i)&&(r=i,++c);if(1===c)c=a[r].one,this.incrementOne(a[r],o[r],n.add,n.rem);else for(i=0,c=0;i<u;++i)e.modified("query",i)&&(c|=a[i].one,this.incrementAll(a[i],o[i],s,n.add),n.rem=n.add);return c},incrementAll:function(e,t,n,r){var i,a,o,s=this.value,u=s.seen(),c=s.curr(),l=s.prev(),f=e.index(),d=e.bisect(e.range),h=e.bisect(t),p=h[0],m=h[1],v=d[0],g=d[1],y=e.one;if(p<v)for(i=p,a=Math.min(v,m);i<a;++i)u[o=f[i]]!==n&&(l[o]=c[o],u[o]=n,r.push(o)),c[o]^=y;else if(p>v)for(i=v,a=Math.min(p,g);i<a;++i)u[o=f[i]]!==n&&(l[o]=c[o],u[o]=n,r.push(o)),c[o]^=y;if(m>g)for(i=Math.max(p,g),a=m;i<a;++i)u[o=f[i]]!==n&&(l[o]=c[o],u[o]=n,r.push(o)),c[o]^=y;else if(m<g)for(i=Math.max(v,m),a=g;i<a;++i)u[o=f[i]]!==n&&(l[o]=c[o],u[o]=n,r.push(o)),c[o]^=y;e.range=t.slice()},incrementOne:function(e,t,n,r){var i,a,o,s=this.value.curr(),u=e.index(),c=e.bisect(e.range),l=e.bisect(t),f=l[0],d=l[1],h=c[0],p=c[1],m=e.one;if(f<h)for(i=f,a=Math.min(h,d);i<a;++i)s[o=u[i]]^=m,n.push(o);else if(f>h)for(i=h,a=Math.min(f,p);i<a;++i)s[o=u[i]]^=m,r.push(o);if(d>p)for(i=Math.max(f,p),a=d;i<a;++i)s[o=u[i]]^=m,n.push(o);else if(d<p)for(i=Math.max(h,d),a=p;i<a;++i)s[o=u[i]]^=m,r.push(o);e.range=t.slice()}}),pk.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]},Object(ye.z)(pk,ot,{transform:function(e,t){var n=~(e.ignore||0),r=e.filter,i=r.mask;if(0==(i&n))return t.StopPropagation;var a=t.fork(t.ALL),o=r.data(),s=r.curr(),u=r.prev(),c=function(e){return s[e]&n?null:o[e]};return a.filter(a.MOD,c),i&i-1?(a.filter(a.ADD,(function(e){var t=s[e]&n;return!t&&t^u[e]&n?o[e]:null})),a.filter(a.REM,(function(e){var t=s[e]&n;return!t||t^t^u[e]&n?null:o[e]}))):(a.filter(a.ADD,c),a.filter(a.REM,(function(e){return(s[e]&n)===i?o[e]:null}))),a.filter(a.SOURCE,(function(e){return c(e._index)}))}});var mk,vk,gk,yk,bk,xk="Literal",wk="Property",_k="ArrayExpression",kk="BinaryExpression",Ek="CallExpression",Sk="ConditionalExpression",Ck="LogicalExpression",Ak="MemberExpression",Ok="ObjectExpression",Dk="UnaryExpression";function Tk(e){this.type=e}Tk.prototype.visit=function(e){var t,n,r;if(e(this))return 1;for(n=0,r=(t=function(e){switch(e.type){case _k:return e.elements;case kk:case Ck:return[e.left,e.right];case Ek:return[e.callee].concat(e.arguments);case Sk:return[e.test,e.consequent,e.alternate];case Ak:return[e.object,e.property];case Ok:return e.properties;case wk:return[e.key,e.value];case Dk:return[e.argument];default:return[]}}(this)).length;n<r;++n)if(t[n].visit(e))return 1};var jk=1,Mk=2,Fk=3,Ik=4,Nk=5,Rk=6,Pk=7,Bk=8;(mk={})[jk]="Boolean",mk[Mk]="<end>",mk[Fk]="Identifier",mk[Ik]="Keyword",mk[Nk]="Null",mk[Rk]="Numeric",mk[Pk]="Punctuator",mk[Bk]="String",mk[9]="RegularExpression";var Lk="ArrayExpression",zk="BinaryExpression",Uk="CallExpression",Wk="ConditionalExpression",Vk="Identifier",Gk="Literal",qk="LogicalExpression",Hk="MemberExpression",Xk="ObjectExpression",Kk="Property",Yk="UnaryExpression",$k="Unexpected token %0",Jk="Unexpected number",Zk="Unexpected string",Qk="Unexpected identifier",eE="Unexpected reserved word",tE="Unexpected end of input",nE="Invalid regular expression",rE="Invalid regular expression: missing /",iE="Octal literals are not allowed in strict mode.",aE="Duplicate data property in object literal not allowed in strict mode",oE="ILLEGAL",sE="Disabled.",uE=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),cE=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function lE(e,t){if(!e)throw new Error("ASSERT: "+t)}function fE(e){return e>=48&&e<=57}function dE(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function hE(e){return"01234567".indexOf(e)>=0}function pE(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function mE(e){return 10===e||13===e||8232===e||8233===e}function vE(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||e>=128&&uE.test(String.fromCharCode(e))}function gE(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||e>=128&&cE.test(String.fromCharCode(e))}var yE={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function bE(){for(;gk<yk;){var e=vk.charCodeAt(gk);if(!pE(e)&&!mE(e))break;++gk}}function xE(e){var t,n,r,i=0;for(n="u"===e?4:2,t=0;t<n;++t)gk<yk&&dE(vk[gk])?(r=vk[gk++],i=16*i+"0123456789abcdef".indexOf(r.toLowerCase())):RE({},$k,oE);return String.fromCharCode(i)}function wE(){var e,t,n,r;for(t=0,"}"===(e=vk[gk])&&RE({},$k,oE);gk<yk&&dE(e=vk[gk++]);)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||"}"!==e)&&RE({},$k,oE),t<=65535?String.fromCharCode(t):(n=55296+(t-65536>>10),r=56320+(t-65536&1023),String.fromCharCode(n,r))}function _E(){var e,t;for(e=vk.charCodeAt(gk++),t=String.fromCharCode(e),92===e&&(117!==vk.charCodeAt(gk)&&RE({},$k,oE),++gk,(e=xE("u"))&&"\\"!==e&&vE(e.charCodeAt(0))||RE({},$k,oE),t=e);gk<yk&&gE(e=vk.charCodeAt(gk));)++gk,t+=String.fromCharCode(e),92===e&&(t=t.substr(0,t.length-1),117!==vk.charCodeAt(gk)&&RE({},$k,oE),++gk,(e=xE("u"))&&"\\"!==e&&gE(e.charCodeAt(0))||RE({},$k,oE),t+=e);return t}function kE(){var e,t;return e=gk,{type:1===(t=92===vk.charCodeAt(gk)?_E():function(){var e,t;for(e=gk++;gk<yk;){if(92===(t=vk.charCodeAt(gk)))return gk=e,_E();if(!gE(t))break;++gk}return vk.slice(e,gk)}()).length?Fk:yE.hasOwnProperty(t)?Ik:"null"===t?Nk:"true"===t||"false"===t?jk:Fk,value:t,start:e,end:gk}}function EE(){var e,t,n,r,i=gk,a=vk.charCodeAt(gk),o=vk[gk];switch(a){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++gk,{type:Pk,value:String.fromCharCode(a),start:i,end:gk};default:if(61===(e=vk.charCodeAt(gk+1)))switch(a){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return gk+=2,{type:Pk,value:String.fromCharCode(a)+String.fromCharCode(e),start:i,end:gk};case 33:case 61:return gk+=2,61===vk.charCodeAt(gk)&&++gk,{type:Pk,value:vk.slice(i,gk),start:i,end:gk}}}return">>>="===(r=vk.substr(gk,4))?{type:Pk,value:r,start:i,end:gk+=4}:">>>"===(n=r.substr(0,3))||"<<="===n||">>="===n?{type:Pk,value:n,start:i,end:gk+=3}:o===(t=n.substr(0,2))[1]&&"+-<>&|".indexOf(o)>=0||"=>"===t?{type:Pk,value:t,start:i,end:gk+=2}:("//"===t&&RE({},$k,oE),"<>=!+-*%&|^/".indexOf(o)>=0?{type:Pk,value:o,start:i,end:++gk}:void RE({},$k,oE))}function SE(){var e,t,n;if(lE(fE((n=vk[gk]).charCodeAt(0))||"."===n,"Numeric literal must start with a decimal digit or a decimal point"),t=gk,e="","."!==n){if(e=vk[gk++],n=vk[gk],"0"===e){if("x"===n||"X"===n)return++gk,function(e){for(var t="";gk<yk&&dE(vk[gk]);)t+=vk[gk++];return 0===t.length&&RE({},$k,oE),vE(vk.charCodeAt(gk))&&RE({},$k,oE),{type:Rk,value:parseInt("0x"+t,16),start:e,end:gk}}(t);if(hE(n))return function(e){for(var t="0"+vk[gk++];gk<yk&&hE(vk[gk]);)t+=vk[gk++];return(vE(vk.charCodeAt(gk))||fE(vk.charCodeAt(gk)))&&RE({},$k,oE),{type:Rk,value:parseInt(t,8),octal:!0,start:e,end:gk}}(t);n&&fE(n.charCodeAt(0))&&RE({},$k,oE)}for(;fE(vk.charCodeAt(gk));)e+=vk[gk++];n=vk[gk]}if("."===n){for(e+=vk[gk++];fE(vk.charCodeAt(gk));)e+=vk[gk++];n=vk[gk]}if("e"===n||"E"===n)if(e+=vk[gk++],"+"!==(n=vk[gk])&&"-"!==n||(e+=vk[gk++]),fE(vk.charCodeAt(gk)))for(;fE(vk.charCodeAt(gk));)e+=vk[gk++];else RE({},$k,oE);return vE(vk.charCodeAt(gk))&&RE({},$k,oE),{type:Rk,value:parseFloat(e),start:t,end:gk}}function CE(){var e,t,n,r;return bk=null,bE(),e=gk,t=function(){var e,t,n,r;for(lE("/"===(e=vk[gk]),"Regular expression literal must start with a slash"),t=vk[gk++],n=!1,r=!1;gk<yk;)if(t+=e=vk[gk++],"\\"===e)mE((e=vk[gk++]).charCodeAt(0))&&RE({},rE),t+=e;else if(mE(e.charCodeAt(0)))RE({},rE);else if(n)"]"===e&&(n=!1);else{if("/"===e){r=!0;break}"["===e&&(n=!0)}return r||RE({},rE),{value:t.substr(1,t.length-2),literal:t}}(),n=function(){var e,t,n;for(t="",n="";gk<yk&&gE((e=vk[gk]).charCodeAt(0));)++gk,"\\"===e&&gk<yk?RE({},$k,oE):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&RE({},nE,n),{value:n,literal:t}}(),r=function(e,t){var n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,(function(e,t){if(parseInt(t,16)<=1114111)return"x";RE({},nE)})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch(e){RE({},nE)}try{return new RegExp(e,t)}catch(e){return null}}(t.value,n.value),{literal:t.literal+n.literal,value:r,regex:{pattern:t.value,flags:n.value},start:e,end:gk}}function AE(){if(bE(),gk>=yk)return{type:Mk,start:gk,end:gk};var e=vk.charCodeAt(gk);return vE(e)?kE():40===e||41===e||59===e?EE():39===e||34===e?function(){var e,t,n,r,i="",a=!1;for(lE("'"===(e=vk[gk])||'"'===e,"String literal must starts with a quote"),t=gk,++gk;gk<yk;){if((n=vk[gk++])===e){e="";break}if("\\"===n)if((n=vk[gk++])&&mE(n.charCodeAt(0)))"\r"===n&&"\n"===vk[gk]&&++gk;else switch(n){case"u":case"x":"{"===vk[gk]?(++gk,i+=wE()):i+=xE(n);break;case"n":i+="\n";break;case"r":i+="\r";break;case"t":i+="\t";break;case"b":i+="\b";break;case"f":i+="\f";break;case"v":i+="\v";break;default:hE(n)?(0!==(r="01234567".indexOf(n))&&(a=!0),gk<yk&&hE(vk[gk])&&(a=!0,r=8*r+"01234567".indexOf(vk[gk++]),"0123".indexOf(n)>=0&&gk<yk&&hE(vk[gk])&&(r=8*r+"01234567".indexOf(vk[gk++]))),i+=String.fromCharCode(r)):i+=n}else{if(mE(n.charCodeAt(0)))break;i+=n}}return""!==e&&RE({},$k,oE),{type:Bk,value:i,octal:a,start:t,end:gk}}():46===e?fE(vk.charCodeAt(gk+1))?SE():EE():fE(e)?SE():EE()}function OE(){var e=bk;return gk=e.end,bk=AE(),gk=e.end,e}function DE(){var e=gk;bk=AE(),gk=e}function TE(e,t,n){var r=new Tk("||"===e||"&&"===e?qk:zk);return r.operator=e,r.left=t,r.right=n,r}function jE(e,t){var n=new Tk(Uk);return n.callee=e,n.arguments=t,n}function ME(e){var t=new Tk(Vk);return t.name=e,t}function FE(e){var t=new Tk(Gk);return t.value=e.value,t.raw=vk.slice(e.start,e.end),e.regex&&("//"===t.raw&&(t.raw="/(?:)/"),t.regex=e.regex),t}function IE(e,t,n){var r=new Tk(Hk);return r.computed="["===e,r.object=t,r.property=n,r.computed||(n.member=!0),r}function NE(e,t,n){var r=new Tk(Kk);return r.key=t,r.value=n,r.kind=e,r}function RE(e,t){var n,r=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,(function(e,t){return lE(t<r.length,"Message reference must be in range"),r[t]}));throw(n=new Error(i)).index=gk,n.description=i,n}function PE(e){e.type===Mk&&RE(e,tE),e.type===Rk&&RE(e,Jk),e.type===Bk&&RE(e,Zk),e.type===Fk&&RE(e,Qk),e.type===Ik&&RE(e,eE),RE(e,$k,e.value)}function BE(e){var t=OE();t.type===Pk&&t.value===e||PE(t)}function LE(e){return bk.type===Pk&&bk.value===e}function zE(e){return bk.type===Ik&&bk.value===e}function UE(){var e=[];for(gk=bk.start,BE("[");!LE("]");)LE(",")?(OE(),e.push(null)):(e.push(QE()),LE("]")||BE(","));return OE(),function(e){var t=new Tk(Lk);return t.elements=e,t}(e)}function WE(){gk=bk.start;var e=OE();return e.type===Bk||e.type===Rk?(e.octal&&RE(e,iE),FE(e)):ME(e.value)}function VE(){var e,t,n;return gk=bk.start,(e=bk).type===Fk?(n=WE(),BE(":"),NE("init",n,QE())):e.type!==Mk&&e.type!==Pk?(t=WE(),BE(":"),NE("init",t,QE())):void PE(e)}function GE(){var e,t,n=[],r={},i=String;for(gk=bk.start,BE("{");!LE("}");)t="$"+((e=VE()).key.type===Vk?e.key.name:i(e.key.value)),Object.prototype.hasOwnProperty.call(r,t)?RE({},aE):r[t]=!0,n.push(e),LE("}")||BE(",");return BE("}"),function(e){var t=new Tk(Xk);return t.properties=e,t}(n)}var qE={if:1};function HE(){var e,t,n;if(LE("("))return function(){BE("(");var e=eS();return BE(")"),e}();if(LE("["))return UE();if(LE("{"))return GE();if(e=bk.type,gk=bk.start,e===Fk||qE[bk.value])n=ME(OE().value);else if(e===Bk||e===Rk)bk.octal&&RE(bk,iE),n=FE(OE());else{if(e===Ik)throw new Error(sE);e===jk?((t=OE()).value="true"===t.value,n=FE(t)):e===Nk?((t=OE()).value=null,n=FE(t)):LE("/")||LE("/=")?(n=FE(CE()),DE()):PE(OE())}return n}function XE(){var e=[];if(BE("("),!LE(")"))for(;gk<yk&&(e.push(QE()),!LE(")"));)BE(",");return BE(")"),e}function KE(){gk=bk.start;var e=OE();return function(e){return e.type===Fk||e.type===Ik||e.type===jk||e.type===Nk}(e)||PE(e),ME(e.value)}function YE(){BE("[");var e=eS();return BE("]"),e}function $E(){var e=function(){var e;for(e=HE();;)if(LE("."))BE("."),e=IE(".",e,KE());else if(LE("("))e=jE(e,XE());else{if(!LE("["))break;e=IE("[",e,YE())}return e}();if(bk.type===Pk&&(LE("++")||LE("--")))throw new Error(sE);return e}function JE(){var e,t;if(bk.type!==Pk&&bk.type!==Ik)t=$E();else{if(LE("++")||LE("--"))throw new Error(sE);if(LE("+")||LE("-")||LE("~")||LE("!"))e=OE(),t=JE(),t=function(e,t){var n=new Tk(Yk);return n.operator=e,n.argument=t,n.prefix=!0,n}(e.value,t);else{if(zE("delete")||zE("void")||zE("typeof"))throw new Error(sE);t=$E()}}return t}function ZE(e){var t=0;if(e.type!==Pk&&e.type!==Ik)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11}return t}function QE(){var e,t;return e=function(){var e,t,n,r,i,a,o,s,u,c;if(e=bk,u=JE(),0===(i=ZE(r=bk)))return u;for(r.prec=i,OE(),t=[e,bk],a=[u,r,o=JE()];(i=ZE(bk))>0;){for(;a.length>2&&i<=a[a.length-2].prec;)o=a.pop(),s=a.pop().value,u=a.pop(),t.pop(),n=TE(s,u,o),a.push(n);(r=OE()).prec=i,a.push(r),t.push(bk),n=JE(),a.push(n)}for(n=a[c=a.length-1],t.pop();c>1;)t.pop(),n=TE(a[c-1].value,a[c-2],n),c-=2;return n}(),LE("?")&&(OE(),t=QE(),BE(":"),e=function(e,t,n){var r=new Tk(Wk);return r.test=e,r.consequent=t,r.alternate=n,r}(e,t,QE())),e}function eS(){var e=QE();if(LE(","))throw new Error(sE);return e}var tS={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function nS(e){function t(t,n,r){return function(i){return function(t,n,r,i){var a=e(n[0]);return r&&(a=r+"("+a+")",0===r.lastIndexOf("new ",0)&&(a="("+a+")")),a+"."+t+(i<0?"":0===i?"()":"("+n.slice(1).map(e).join(",")+")")}(t,i,n,r)}}var n="new Date";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(t){t.length<3&&Object(ye.o)("Missing arguments to clamp function."),t.length>3&&Object(ye.o)("Too many arguments to clamp function.");var n=t.map(e);return"Math.max("+n[1]+", Math.min("+n[2]+","+n[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:n,date:t("getDate",n,0),day:t("getDay",n,0),year:t("getFullYear",n,0),month:t("getMonth",n,0),hours:t("getHours",n,0),minutes:t("getMinutes",n,0),seconds:t("getSeconds",n,0),milliseconds:t("getMilliseconds",n,0),time:t("getTime",n,0),timezoneoffset:t("getTimezoneOffset",n,0),utcdate:t("getUTCDate",n,0),utcday:t("getUTCDay",n,0),utcyear:t("getUTCFullYear",n,0),utcmonth:t("getUTCMonth",n,0),utchours:t("getUTCHours",n,0),utcminutes:t("getUTCMinutes",n,0),utcseconds:t("getUTCSeconds",n,0),utcmilliseconds:t("getUTCMilliseconds",n,0),length:t("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:t("toUpperCase","String",0),lower:t("toLowerCase","String",0),substring:t("substring","String"),split:t("split","String"),trim:t("trim","String",0),regexp:"RegExp",test:t("test","RegExp"),if:function(t){t.length<3&&Object(ye.o)("Missing arguments to if function."),t.length>3&&Object(ye.o)("Too many arguments to if function.");var n=t.map(e);return"("+n[0]+"?"+n[1]+":"+n[2]+")"}}}var rS,iS,aS,oS,sS,uS=new rv,cS=new rv,lS={point:Cv,lineStart:Cv,lineEnd:Cv,polygonStart:function(){uS=new rv,lS.lineStart=fS,lS.lineEnd=dS},polygonEnd:function(){var e=+uS;cS.add(e<0?uv+e:e),this.lineStart=this.lineEnd=this.point=Cv},sphere:function(){cS.add(uv)}};function fS(){lS.point=hS}function dS(){pS(rS,iS)}function hS(e,t){lS.point=pS,rS=e,iS=t,aS=e*=lv,oS=pv(t=(t*=lv)/2+sv),sS=xv(t)}function pS(e,t){t=(t*=lv)/2+sv;var n=(e*=lv)-aS,r=n>=0?1:-1,i=r*n,a=pv(t),o=xv(t),s=sS*o,u=oS*a+s*pv(i),c=s*r*xv(i);uS.add(hv(c,u)),aS=e,oS=a,sS=o}var mS,vS,gS,yS,bS,xS,wS,_S,kS,ES,SS,CS={point:AS,lineStart:DS,lineEnd:TS,polygonStart:function(){CS.point=jS,CS.lineStart=MS,CS.lineEnd=FS,kS=new rv,lS.polygonStart()},polygonEnd:function(){lS.polygonEnd(),CS.point=AS,CS.lineStart=DS,CS.lineEnd=TS,uS<0?(mS=-(gS=180),vS=-(yS=90)):kS>iv?yS=90:kS<-iv&&(vS=-90),SS[0]=mS,SS[1]=gS},sphere:function(){mS=-(gS=180),vS=-(yS=90)}};function AS(e,t){ES.push(SS=[mS=e,gS=e]),t<vS&&(vS=t),t>yS&&(yS=t)}function OS(e,t){var n=Ig([e*lv,t*lv]);if(_S){var r=Rg(_S,n),i=Rg([r[1],-r[0],0],r);Lg(i),i=Fg(i);var a,o=e-bS,s=o>0?1:-1,u=i[0]*cv*s,c=fv(o)>180;c^(s*bS<u&&u<s*e)?(a=i[1]*cv)>yS&&(yS=a):c^(s*bS<(u=(u+360)%360-180)&&u<s*e)?(a=-i[1]*cv)<vS&&(vS=a):(t<vS&&(vS=t),t>yS&&(yS=t)),c?e<bS?IS(mS,e)>IS(mS,gS)&&(gS=e):IS(e,gS)>IS(mS,gS)&&(mS=e):gS>=mS?(e<mS&&(mS=e),e>gS&&(gS=e)):e>bS?IS(mS,e)>IS(mS,gS)&&(gS=e):IS(e,gS)>IS(mS,gS)&&(mS=e)}else ES.push(SS=[mS=e,gS=e]);t<vS&&(vS=t),t>yS&&(yS=t),_S=n,bS=e}function DS(){CS.point=OS}function TS(){SS[0]=mS,SS[1]=gS,CS.point=AS,_S=null}function jS(e,t){if(_S){var n=e-bS;kS.add(fv(n)>180?n+(n>0?360:-360):n)}else xS=e,wS=t;lS.point(e,t),OS(e,t)}function MS(){lS.lineStart()}function FS(){jS(xS,wS),lS.lineEnd(),fv(kS)>iv&&(mS=-(gS=180)),SS[0]=mS,SS[1]=gS,_S=null}function IS(e,t){return(t-=e)<0?t+360:t}function NS(e,t){return e[0]-t[0]}function RS(e,t){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}var PS,BS,LS,zS,US,WS,VS,GS,qS,HS,XS,KS,YS,$S,JS,ZS,QS={sphere:Cv,point:eC,lineStart:nC,lineEnd:aC,polygonStart:function(){QS.lineStart=oC,QS.lineEnd=sC},polygonEnd:function(){QS.lineStart=nC,QS.lineEnd=aC}};function eC(e,t){e*=lv;var n=pv(t*=lv);tC(n*pv(e),n*xv(e),xv(t))}function tC(e,t,n){LS+=(e-LS)/++PS,zS+=(t-zS)/PS,US+=(n-US)/PS}function nC(){QS.point=rC}function rC(e,t){e*=lv;var n=pv(t*=lv);$S=n*pv(e),JS=n*xv(e),ZS=xv(t),QS.point=iC,tC($S,JS,ZS)}function iC(e,t){e*=lv;var n=pv(t*=lv),r=n*pv(e),i=n*xv(e),a=xv(t),o=hv(_v((o=JS*a-ZS*i)*o+(o=ZS*r-$S*a)*o+(o=$S*i-JS*r)*o),$S*r+JS*i+ZS*a);BS+=o,WS+=o*($S+($S=r)),VS+=o*(JS+(JS=i)),GS+=o*(ZS+(ZS=a)),tC($S,JS,ZS)}function aC(){QS.point=eC}function oC(){QS.point=uC}function sC(){cC(KS,YS),QS.point=eC}function uC(e,t){KS=e,YS=t,e*=lv,t*=lv,QS.point=cC;var n=pv(t);$S=n*pv(e),JS=n*xv(e),ZS=xv(t),tC($S,JS,ZS)}function cC(e,t){e*=lv;var n=pv(t*=lv),r=n*pv(e),i=n*xv(e),a=xv(t),o=JS*a-ZS*i,s=ZS*r-$S*a,u=$S*i-JS*r,c=gv(o,s,u),l=Sv(c),f=c&&-l/c;qS.add(f*o),HS.add(f*s),XS.add(f*u),BS+=l,WS+=l*($S+($S=r)),VS+=l*(JS+(JS=i)),GS+=l*(ZS+(ZS=a)),tC($S,JS,ZS)}var lC,fC="Literal",dC="Property",hC="ArrayExpression",pC="BinaryExpression",mC="CallExpression",vC="ConditionalExpression",gC="LogicalExpression",yC="MemberExpression",bC="ObjectExpression",xC="UnaryExpression";function wC(e){this.type=e}wC.prototype.visit=function(e){var t,n,r;if(e(this))return 1;for(n=0,r=(t=function(e){switch(e.type){case hC:return e.elements;case pC:case gC:return[e.left,e.right];case mC:return[e.callee].concat(e.arguments);case vC:return[e.test,e.consequent,e.alternate];case yC:return[e.object,e.property];case bC:return e.properties;case dC:return[e.key,e.value];case xC:return[e.argument];default:return[]}}(this)).length;n<r;++n)if(t[n].visit(e))return 1};var _C=2,kC=3,EC=4,SC=5,CC=6,AC=7,OC=8;(lC={})[1]="Boolean",lC[_C]="<end>",lC[kC]="Identifier",lC[EC]="Keyword",lC[SC]="Null",lC[CC]="Numeric",lC[AC]="Punctuator",lC[OC]="String",lC[9]="RegularExpression",new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");var DC="intersect",TC="union",jC="vlMulti",MC="vlPoint",FC="or",IC="and",NC="E",RC="R",PC="R-E",BC="R-LE",LC="R-RE",zC="index:unit";function UC(e,t){for(var n,r,i=t.fields,a=t.values,o=i.length,s=0;s<o;++s)if((r=i[s]).getter=ye.u.getter||Object(ye.u)(r.field),n=r.getter(e),Object(ye.D)(n)&&(n=Object(ye.Ea)(n)),Object(ye.D)(a[s])&&(a[s]=Object(ye.Ea)(a[s])),Object(ye.D)(a[s][0])&&(a[s]=a[s].map(ye.Ea)),r.type===NC){if(Object(ye.B)(a[s])?a[s].indexOf(n)<0:n!==a[s])return!1}else if(r.type===RC){if(!Object(ye.A)(n,a[s]))return!1}else if(r.type===LC){if(!Object(ye.A)(n,a[s],!0,!1))return!1}else if(r.type===PC){if(!Object(ye.A)(n,a[s],!1,!1))return!1}else if(r.type===BC&&!Object(ye.A)(n,a[s],!1,!0))return!1;return!0}var WC=Object(ye.u)("_vgsid_"),VC=function(e){var t=e,n=e;function r(e,t,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){var a=r+i>>>1;n(e[a],t)<0?r=a+1:i=a}return r}return 1===e.length&&(t=function(t,n){return e(t)-n},n=function(e){return function(t,n){return function(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}(e(t),n)}}(e)),{left:r,center:function(e,n,i,a){null==i&&(i=0),null==a&&(a=e.length);var o=r(e,n,i,a-1);return o>i&&t(e[o-1],n)>-t(e[o],n)?o-1:o},right:function(e,t,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){var a=r+i>>>1;n(e[a],t)>0?i=a:r=a+1}return r}}}(WC),GC=VC.left,qC=VC.right,HC={E_union:function(e,t){if(!e.length)return t;for(var n=0,r=t.length;n<r;++n)e.indexOf(t[n])<0&&e.push(t[n]);return e},E_intersect:function(e,t){return e.length?e.filter((function(e){return t.indexOf(e)>=0})):t},R_union:function(e,t){var n=Object(ye.Ea)(t[0]),r=Object(ye.Ea)(t[1]);return n>r&&(n=t[1],r=t[0]),e.length?(e[0]>n&&(e[0]=n),e[1]<r&&(e[1]=r),e):[n,r]},R_intersect:function(e,t){var n=Object(ye.Ea)(t[0]),r=Object(ye.Ea)(t[1]);return n>r&&(n=t[1],r=t[0]),e.length?r<e[0]||e[1]<n?[]:(e[0]<n&&(e[0]=n),e[1]>r&&(e[1]=r),e):[n,r]}},XC=":",KC="@";function YC(e,t,n,r){t[0].type!==fC&&Object(ye.o)("First argument to selection functions must be a string literal.");var i=t[0].value,a=t.length>=2&&Object(ye.W)(t).value,o=KC+"unit",s=XC+i;a!==DC||Object(ye.w)(r,o)||(r[o]=n.getData(i).indataRef(n,"unit")),Object(ye.w)(r,s)||(r[s]=n.getData(i).tuplesRef())}function $C(e){var t=this.context.data[e];return t?t.values.value:[]}var JC=function(e){return function(t,n){return this.context.dataflow.locale()[e](n)(t)}},ZC=JC("format"),QC=JC("timeFormat"),eA=JC("utcFormat"),tA=JC("timeParse"),nA=JC("utcParse"),rA=new Date(2e3,0,1);function iA(e,t,n){return Number.isInteger(e)&&Number.isInteger(t)?(rA.setYear(2e3),rA.setMonth(e),rA.setDate(t),QC.call(this,rA,n)):""}var aA=":",oA="@",sA="%",uA="$";function cA(e,t,n,r){t[0].type!==xk&&Object(ye.o)("First argument to data functions must be a string literal.");var i=t[0].value,a=aA+i;if(!Object(ye.w)(a,r))try{r[a]=n.getData(i).tuplesRef()}catch(e){}}function lA(e,t,n,r){if(t[0].type===xk)fA(n,r,t[0].value);else for(e in n.scales)fA(n,r,e)}function fA(e,t,n){var r=sA+n;if(!Object(ye.w)(t,r))try{t[r]=e.scaleRef(n)}catch(e){}}function dA(e,t){var n;return Object(ye.E)(e)?e:Object(ye.J)(e)?(n=t.scales[e])&&n.value:void 0}function hA(e,t){return function(n,r,i){if(n){var a=dA(n,(i||this).context);return a&&a.path[e](r)}return t(r)}}var pA=hA("area",(function(e){return cS=new rv,nv(e,lS),2*cS})),mA=hA("bounds",(function(e){var t,n,r,i,a,o,s;if(yS=gS=-(mS=vS=1/0),ES=[],nv(e,CS),n=ES.length){for(ES.sort(NS),t=1,a=[r=ES[0]];t<n;++t)RS(r,(i=ES[t])[0])||RS(r,i[1])?(IS(r[0],i[1])>IS(r[0],r[1])&&(r[1]=i[1]),IS(i[0],r[1])>IS(r[0],r[1])&&(r[0]=i[0])):a.push(r=i);for(o=-1/0,t=0,r=a[n=a.length-1];t<=n;r=i,++t)i=a[t],(s=IS(r[1],i[0]))>o&&(o=s,mS=i[0],gS=r[1])}return ES=SS=null,mS===1/0||vS===1/0?[[NaN,NaN],[NaN,NaN]]:[[mS,vS],[gS,yS]]})),vA=hA("centroid",(function(e){PS=BS=LS=zS=US=WS=VS=GS=0,qS=new rv,HS=new rv,XS=new rv,nv(e,QS);var t=+qS,n=+HS,r=+XS,i=gv(t,n,r);return i<1e-12&&(t=WS,n=VS,r=GS,BS<iv&&(t=LS,n=zS,r=US),(i=gv(t,n,r))<1e-12)?[NaN,NaN]:[hv(n,t)*cv,Sv(r/i)*cv]}));function gA(e,t,n){try{e[t].apply(e,["EXPRESSION"].concat([].slice.call(n)))}catch(t){e.warn(t)}return n[n.length-1]}function yA(e){var t=e/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}function bA(e){var t=Ia(e);return.2126*yA(t.r)+.7152*yA(t.g)+.0722*yA(t.b)}function xA(e,t){return e===t||e!=e&&t!=t||(Object(ye.B)(e)?!(!Object(ye.B)(t)||e.length!==t.length)&&function(e,t){for(var n=0,r=e.length;n<r;++n)if(!xA(e[n],t[n]))return!1;return!0}(e,t):!(!Object(ye.H)(e)||!Object(ye.H)(t))&&wA(e,t))}function wA(e,t){for(var n in e)if(!xA(e[n],t[n]))return!1;return!0}function _A(e){return function(t){return wA(e,t)}}var kA={};function EA(e){return Object(ye.B)(e)||ArrayBuffer.isView(e)?e:null}function SA(e){return EA(e)||(Object(ye.J)(e)?e:null)}var CA=function(e){return e.data};function AA(e,t){var n=$C.call(t,e);return n.root&&n.root.lookup||{}}var OA=function(){return"undefined"!=typeof window&&window||null},DA={random:function(){return kt()},cumulativeNormal:It,cumulativeLogNormal:zt,cumulativeUniform:Ht,densityNormal:Ft,densityLogNormal:Lt,densityUniform:qt,quantileNormal:Nt,quantileLogNormal:Ut,quantileUniform:Xt,sampleNormal:Mt,sampleLogNormal:Bt,sampleUniform:Gt,isArray:ye.B,isBoolean:ye.C,isDate:ye.D,isDefined:function(e){return void 0!==e},isNumber:ye.G,isObject:ye.H,isRegExp:ye.I,isString:ye.J,isTuple:Ce,isValid:function(e){return null!=e&&e==e},toBoolean:ye.Ca,toDate:ye.Da,toNumber:ye.Ea,toString:ye.Ga,indexof:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return(t=SA(e)).indexOf.apply(t,r)},join:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return(t=EA(e)).join.apply(t,r)},lastindexof:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return(t=SA(e)).lastIndexOf.apply(t,r)},replace:function(e,t,n){return Object(ye.E)(n)&&Object(ye.o)("Function argument passed to replace."),String(e).replace(t,n)},reverse:function(e){return EA(e).slice().reverse()},slice:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return(t=SA(e)).slice.apply(t,r)},flush:ye.v,lerp:ye.L,merge:function(){var e=[].slice.call(arguments);return e.unshift({}),Object(ye.p).apply(void 0,h(e))},pad:ye.R,peek:ye.W,pluck:function(e,t){var n=kA[t]||(kA[t]=Object(ye.u)(t));return Object(ye.B)(e)?e.map(n):n(e)},span:ye.Z,inrange:ye.A,truncate:ye.Ha,rgb:Ia,lab:Xs,hcl:eu,hsl:Ua,luminance:bA,contrast:function(e,t){var n=bA(e),r=bA(t);return(Math.max(n,r)+.05)/(Math.min(n,r)+.05)},sequence:pn,format:ZC,utcFormat:eA,utcParse:nA,utcOffset:vn.w,utcSequence:vn.x,timeFormat:QC,timeParse:tA,timeOffset:vn.q,timeSequence:vn.r,timeUnitSpecifier:vn.s,monthFormat:function(e){return iA.call(this,e,1,"%B")},monthAbbrevFormat:function(e){return iA.call(this,e,1,"%b")},dayFormat:function(e){return iA.call(this,0,2+e,"%A")},dayAbbrevFormat:function(e){return iA.call(this,0,2+e,"%a")},quarter:ye.X,utcquarter:ye.Ja,week:vn.A,utcweek:vn.z,dayofyear:vn.m,utcdayofyear:vn.y,warn:function(){return gA(this.context.dataflow,"warn",arguments)},info:function(){return gA(this.context.dataflow,"info",arguments)},debug:function(){return gA(this.context.dataflow,"debug",arguments)},extent:ye.q,inScope:function(e){var t=this.context.group,n=!1;if(t)for(;e;){if(e===t){n=!0;break}e=e.mark.group}return n},intersect:function(e,t,n){if(!e)return[];var r=f(e,2),i=r[0],a=r[1],o=(new Tl).set(i[0],i[1],a[0],a[1]);return Xh(n||this.context.dataflow.scenegraph().root,o,function(e){var t=null;if(e){var n=Object(ye.i)(e.marktype),r=Object(ye.i)(e.markname);t=function(e){return(!n.length||n.some((function(t){return e.marktype===t})))&&(!r.length||r.some((function(t){return e.name===t})))}}return t}(t))},clampRange:ye.k,pinchDistance:function(e){var t=e.touches,n=t[0].clientX-t[1].clientX,r=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+r*r)},pinchAngle:function(e){var t=e.touches;return Math.atan2(t[0].clientY-t[1].clientY,t[0].clientX-t[1].clientX)},screen:function(){var e=OA();return e?e.screen:{}},containerSize:function(){var e=this.context.dataflow,t=e.container&&e.container();return t?[t.clientWidth,t.clientHeight]:[void 0,void 0]},windowSize:function(){var e=OA();return e?[e.innerWidth,e.innerHeight]:[void 0,void 0]},bandspace:function(e,t,n){return bu(e||0,t||0,n||0)},setdata:function(e,t){var n=this.context.dataflow,r=this.context.data[e].input;return n.pulse(r,n.changeset().remove(ye.Ia).insert(t)),1},pathShape:function(e){var t=null;return function(n){return n?el(n,t=t||Wc(e)):e}},panLinear:ye.S,panLog:ye.T,panPow:ye.U,panSymlog:ye.V,zoomLinear:ye.Na,zoomLog:ye.Oa,zoomPow:ye.Pa,zoomSymlog:ye.Qa,encode:function(e,t,n){if(e){var r=this.context.dataflow,i=e.mark.source;r.pulse(i,r.changeset().encode(e,t))}return void 0!==n?n:e},modify:function(e,t,n,r,i,a){var o,s,u=this.context.dataflow,c=this.context.data[e],l=c.input,f=u.stamp(),d=c.changes;if(!1===u._trigger||!(l.value.length||t||r))return 0;if((!d||d.stamp<f)&&(c.changes=d=u.changeset(),d.stamp=f,u.runAfter((function(){c.modified=!0,u.pulse(l,d).run()}),!0,1)),n&&(o=!0===n?ye.Ia:Object(ye.B)(n)||Ce(n)?n:_A(n),d.remove(o)),t&&d.insert(t),r&&(o=_A(r),l.value.some(o)?d.remove(o):d.insert(r)),i)for(s in a)d.modify(i,s,a[s]);return 1}},TA=["view","item","group","xy","x","y"],jA="event.vega.",MA="this.",FA={},IA={forbidden:["_"],allowed:["datum","event","item"],fieldvar:"datum",globalvar:function(e){return"_[".concat(Object(ye.Ba)(uA+e),"]")},functions:function(e){var t=nS(e);for(var n in TA.forEach((function(e){return t[e]=jA+e})),DA)t[n]=MA+n;return Object(ye.p)(t,function(e,t,n){t.__bandwidth=function(e){return e&&e.bandwidth?e.bandwidth():0},n._bandwidth=lA,n._range=lA,n._scale=lA;var r=function(t){return"_["+(t.type===xk?Object(ye.Ba)(sA+t.value):Object(ye.Ba)(sA)+"+"+e(t))+"]"};return{_bandwidth:function(e){return"this.__bandwidth(".concat(r(e[0]),")")},_range:function(e){return"".concat(r(e[0]),".range()")},_scale:function(t){return"".concat(r(t[0]),"(").concat(e(t[1]),")")}}}(e,DA,FA)),t},constants:tS,visitors:FA},NA=function(e){var t=(e=e||{}).allowed?Object(ye.Fa)(e.allowed):{},n=e.forbidden?Object(ye.Fa)(e.forbidden):{},r=e.constants||tS,i=(e.functions||nS)(f),a=e.globalvar,o=e.fieldvar,s=Object(ye.E)(a)?a:function(e){return"".concat(a,'["').concat(e,'"]')},u={},c={},l=0;function f(e){if(Object(ye.J)(e))return e;var t=d[e.type];return null==t&&Object(ye.o)("Unsupported type: "+e.type),t(e)}var d={Literal:function(e){return e.raw},Identifier:function(e){var i=e.name;return l>0?i:Object(ye.w)(n,i)?Object(ye.o)("Illegal identifier: "+i):Object(ye.w)(r,i)?r[i]:Object(ye.w)(t,i)?i:(u[i]=1,s(i))},MemberExpression:function(e){var t=!e.computed,n=f(e.object);t&&(l+=1);var r=f(e.property);return n===o&&(c[function(e){var t=e&&e.length-1;return t&&('"'===e[0]&&'"'===e[t]||"'"===e[0]&&"'"===e[t])?e.slice(1,-1):e}(r)]=1),t&&(l-=1),n+(t?"."+r:"["+r+"]")},CallExpression:function(e){"Identifier"!==e.callee.type&&Object(ye.o)("Illegal callee type: "+e.callee.type);var t=e.callee.name,n=e.arguments,r=Object(ye.w)(i,t)&&i[t];return r||Object(ye.o)("Unrecognized function: "+t),Object(ye.E)(r)?r(n):r+"("+n.map(f).join(",")+")"},ArrayExpression:function(e){return"["+e.elements.map(f).join(",")+"]"},BinaryExpression:function(e){return"("+f(e.left)+" "+e.operator+" "+f(e.right)+")"},UnaryExpression:function(e){return"("+e.operator+f(e.argument)+")"},ConditionalExpression:function(e){return"("+f(e.test)+"?"+f(e.consequent)+":"+f(e.alternate)+")"},LogicalExpression:function(e){return"("+f(e.left)+e.operator+f(e.right)+")"},ObjectExpression:function(e){return"{"+e.properties.map(f).join(",")+"}"},Property:function(e){l+=1;var t=f(e.key);return l-=1,t+":"+f(e.value)}};function h(e){var t={code:f(e),globals:Object.keys(u),fields:Object.keys(c)};return u={},c={},t}return h.functions=i,h.constants=r,h}(IA);function RA(e,t,n){return 1===arguments.length?DA[e]:(DA[e]=t,n&&(FA[e]=n),NA&&(NA.functions[e]=MA+e),this)}function PA(e,t){var n,r={};try{n=function(e){gk=0,yk=(vk=e).length,bk=null,DE();var t=eS();if(bk.type!==Mk)throw new Error("Unexpect token after expression.");return t}(e=Object(ye.J)(e)?e:Object(ye.Ba)(e)+"")}catch(t){Object(ye.o)("Expression parse error: "+e)}n.visit((function(e){if(e.type===Ek){var n=e.callee.name,i=IA.visitors[n];i&&i(n,e.arguments,t,r)}}));var i=NA(n);return i.globals.forEach((function(e){var n=uA+e;!Object(ye.w)(r,n)&&t.getSignal(e)&&(r[n]=t.signalRef(e))})),{$expr:Object(ye.p)({code:i.code},t.options.ast?{ast:n}:null),$fields:i.fields,$params:r}}RA("bandwidth",(function(e,t){var n=dA(e,(t||this).context);return n&&n.bandwidth?n.bandwidth():0}),lA),RA("copy",(function(e,t){var n=dA(e,(t||this).context);return n?n.copy():void 0}),lA),RA("domain",(function(e,t){var n=dA(e,(t||this).context);return n?n.domain():[]}),lA),RA("range",(function(e,t){var n=dA(e,(t||this).context);return n&&n.range?n.range():[]}),lA),RA("invert",(function(e,t,n){var r=dA(e,(n||this).context);return r?Object(ye.B)(t)?(r.invertRange||r.invert)(t):(r.invert||r.invertExtent)(t):void 0}),lA),RA("scale",(function(e,t,n){var r=dA(e,(n||this).context);return r?r(t):void 0}),lA),RA("gradient",(function(e,t,n,r,i){e=dA(e,(i||this).context);var a=Pc(t,n),o=e.domain(),s=o[0],u=Object(ye.W)(o),c=ye.y;return u-s?c=ic(e,s,u):e=(e.interpolator?qu("sequential")().interpolator(e.interpolator()):qu("linear")().interpolate(e.interpolate()).range(e.range())).domain([s=0,u=1]),e.ticks&&(s!==(o=e.ticks(+r||15))[0]&&o.unshift(s),u!==Object(ye.W)(o)&&o.push(u)),o.forEach((function(t){return a.stop(c(t),e(t))})),a}),lA),RA("geoArea",pA,lA),RA("geoBounds",mA,lA),RA("geoCentroid",vA,lA),RA("geoShape",(function(e,t,n){var r=dA(e,(n||this).context);return function(e){return r?r.path.context(e)(t):""}}),lA),RA("indata",(function(e,t,n){var r=this.context.data[e]["index:"+t],i=r?r.value.get(n):void 0;return i?i.count:i}),(function(e,t,n,r){t[0].type!==xk&&Object(ye.o)("First argument to indata must be a string literal."),t[1].type!==xk&&Object(ye.o)("Second argument to indata must be a string literal.");var i=t[0].value,a=t[1].value,o=oA+a;Object(ye.w)(o,r)||(r[o]=n.getData(i).indataRef(n,a))})),RA("data",$C,cA),RA("treePath",(function(e,t,n){var r=AA(e,this),i=r[t],a=r[n];return i&&a?i.path(a).map(CA):void 0}),cA),RA("treeAncestors",(function(e,t){var n=AA(e,this)[t];return n?n.ancestors().map(CA):void 0}),cA),RA("vlSelectionTest",(function(e,t,n){for(var r,i,a,o,s,u=this.context.data[e],c=u?u.values.value:[],l=u?u[zC]&&u[zC].value:void 0,f=n===DC,d=c.length,h=0;h<d;++h)if(r=c[h],l&&f){if(-1===(a=(i=i||{})[o=r.unit]||0))continue;if(s=UC(t,r),i[o]=s?-1:++a,s&&1===l.size)return!0;if(!s&&a===l.get(o).count)return!1}else if(f^(s=UC(t,r)))return s;return d&&f}),YC),RA("vlSelectionIdTest",(function(e,t,n){var r=this.context.data[e],i=r?r.values.value:[],a=r?r[zC]&&r[zC].value:void 0,o=n===DC,s=WC(t),u=GC(i,s);if(u===i.length)return!1;if(WC(i[u])!==s)return!1;if(a&&o){if(1===a.size)return!0;if(qC(i,s)-u<a.size)return!1}return!0}),YC),RA("vlSelectionResolve",(function(e,t,n,r){for(var i,a,o,s,u,c,l,f,d,p,m,v=this.context.data[e],g=v?v.values.value:[],b={},x={},w={},_=g.length,k=0;k<_;++k){for(s=(i=g[k]).unit,a=i.fields,o=i.values,p=0,m=a.length;p<m;++p)u=a[p],l=(c=b[u.field]||(b[u.field]={}))[s]||(c[s]=[]),w[u.field]=f=u.type.charAt(0),d=HC[f+"_union"],c[s]=d(l,Object(ye.i)(o[p]));n&&(l=x[s]||(x[s]=[])).push(Object(ye.i)(o).reduce((function(e,t,n){return e[a[n].field]=t,e}),{}))}return t=t||TC,Object.keys(b).forEach((function(e){b[e]=Object.keys(b[e]).map((function(t){return b[e][t]})).reduce((function(n,r){return void 0===n?r:HC[w[e]+"_"+t](n,r)}))})),g=Object.keys(x),n&&g.length&&(b[r?MC:jC]=t===TC?y({},FC,g.reduce((function(e,t){return e.push.apply(e,h(x[t])),e}),[])):y({},IC,g.map((function(e){return y({},FC,x[e])})))),b}),YC),RA("vlSelectionTuples",(function(e,t){return e.map((function(e){return Object(ye.p)({values:t.fields.map((function(t){return(t.getter||(t.getter=Object(ye.u)(t.field)))(e.datum)}))},t)}))}));var BA=Object(ye.Fa)(["rule"]),LA=Object(ye.Fa)(["group","image","rect"]);function zA(e){return(e+"").toLowerCase()}function UA(e,t,n){";"!==n[n.length-1]&&(n="return("+n+");");var r=Function.apply(void 0,h(t.concat(n)));return e&&e.functions?r.bind(e.functions):r}var WA={operator:function(e,t){return UA(e,["_"],t.code)},parameter:function(e,t){return UA(e,["datum","_"],t.code)},event:function(e,t){return UA(e,["event"],t.code)},handler:function(e,t){return UA(e,["_","event"],"var datum=event.item&&event.item.datum;return ".concat(t.code,";"))},encode:function(e,t){var n=t.marktype,r=t.channels,i="var o=item,datum=o.datum,m=0,$;";for(var a in r){var o="o["+Object(ye.Ba)(a)+"]";i+="$=".concat(r[a].code,";if(").concat(o,"!==$)").concat(o,"=$,m=1;")}return i+=function(e,t){var n="";return BA[t]||(e.x2&&(e.x?(LA[t]&&(n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),n+="o.width=o.x2-o.x;"):n+="o.x=o.x2-(o.width||0);"),e.xc&&(n+="o.x=o.xc-(o.width||0)/2;"),e.y2&&(e.y?(LA[t]&&(n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),n+="o.height=o.y2-o.y;"):n+="o.y=o.y2-(o.height||0);"),e.yc&&(n+="o.y=o.yc-(o.height||0)/2;")),n}(r,n),UA(e,["item","_"],i+="return m;")},codegen:{get:function(e){var t="[".concat(e.map(ye.Ba).join("]["),"]"),n=Function("_","return _".concat(t,";"));return n.path=t,n},comparator:function(e,t){var n,r=Function("a","b","var u, v; return "+e.map((function(e,r){var i,a,o=t[r];return e.path?(i="a".concat(e.path),a="b".concat(e.path)):((n=n||{})["f"+r]=e,i="this.f".concat(r,"(a)"),a="this.f".concat(r,"(b)")),function(e,t,n,r){return"((u = ".concat(e,") < (v = ").concat(t,") || u == null) && v != null ? ").concat(n,"\n  : (u > v || v == null) && u != null ? ").concat(r,"\n  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ").concat(n,"\n  : v !== v && u === u ? ").concat(r," : ")}(i,a,-o,o)})).join("")+"0;");return n?r.bind(n):r}}};function VA(e,t,n){if(!e||!Object(ye.H)(e))return e;for(var r,i=0,a=GA.length;i<a;++i)if(r=GA[i],Object(ye.w)(e,r.key))return r.parse(e,t,n);return e}var GA=[{key:"$ref",parse:function(e,t){return t.get(e.$ref)||Object(ye.o)("Operator not defined: "+e.$ref)}},{key:"$key",parse:function(e,t){var n="k:"+e.$key+"_"+!!e.$flat;return t.fn[n]||(t.fn[n]=Object(ye.K)(e.$key,e.$flat,t.expr.codegen))}},{key:"$expr",parse:function(e,t,n){e.$params&&t.parseParameters(e.$params,n);var r="e:"+e.$expr.code+"_"+e.$name;return t.fn[r]||(t.fn[r]=Object(ye.f)(t.parameterExpression(e.$expr),e.$fields,e.$name))}},{key:"$field",parse:function(e,t){if(!e.$field)return null;var n="f:"+e.$field+"_"+e.$name;return t.fn[n]||(t.fn[n]=Object(ye.u)(e.$field,e.$name,t.expr.codegen))}},{key:"$encode",parse:function(e,t){var n=e.$encode,r={};for(var i in n){var a=n[i];r[i]=Object(ye.f)(t.encodeExpression(a.$expr),a.$fields),r[i].output=a.$output}return r}},{key:"$compare",parse:function(e,t){var n="c:"+e.$compare+"_"+e.$order,r=Object(ye.i)(e.$compare).map((function(e){return e&&e.$tupleid?Ae:e}));return t.fn[n]||(t.fn[n]=Object(ye.l)(r,e.$order,t.expr.codegen))}},{key:"$context",parse:function(e,t){return t}},{key:"$subflow",parse:function(e,t){var n=e.$subflow;return function(e,r,i){var a=t.fork().parse(n),o=a.get(n.operators[0].id),s=a.signals.parent;return s&&s.set(i),o.detachSubflow=function(){return t.detach(a)},o}}},{key:"$tupleid",parse:function(){return Ae}}],qA={skip:!0};function HA(e,t,n,r){return new XA(e,t,n,r)}function XA(e,t,n,r){this.dataflow=e,this.transforms=t,this.events=e.events.bind(e),this.expr=r||WA,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},n&&(this.functions=Object.create(n),this.functions.context=this)}function KA(e){this.dataflow=e.dataflow,this.transforms=e.transforms,this.events=e.events,this.expr=e.expr,this.signals=Object.create(e.signals),this.scales=Object.create(e.scales),this.nodes=Object.create(e.nodes),this.data=Object.create(e.data),this.fn=Object.create(e.fn),e.functions&&(this.functions=Object.create(e.functions),this.functions.context=this)}XA.prototype=KA.prototype={fork:function(){var e=new KA(this);return(this.subcontext||(this.subcontext=[])).push(e),e},detach:function(e){this.subcontext=this.subcontext.filter((function(t){return t!==e}));for(var t=Object.keys(e.nodes),n=0,r=t;n<r.length;n++){var i=r[n];e.nodes[i]._targets=null}for(var a=0,o=t;a<o.length;a++){var s=o[a];e.nodes[s].detach()}e.nodes=null},get:function(e){return this.nodes[e]},set:function(e,t){return this.nodes[e]=t},add:function(e,t){var n=this,r=n.dataflow,i=e.value;if(n.set(e.id,t),function(e){return"collect"===zA(e)}(e.type)&&i&&(i.$ingest?r.ingest(t,i.$ingest,i.$format):i.$request?r.preload(t,i.$request,i.$format):r.pulse(t,r.changeset().insert(i))),e.root&&(n.root=t),e.parent){var a=n.get(e.parent.$ref);a?(r.connect(a,[t]),t.targets().add(a)):(n.unresolved=n.unresolved||[]).push((function(){a=n.get(e.parent.$ref),r.connect(a,[t]),t.targets().add(a)}))}if(e.signal&&(n.signals[e.signal]=t),e.scale&&(n.scales[e.scale]=t),e.data){var o=function(){var r=n.data[s]||(n.data[s]={});e.data[s].forEach((function(e){return r[e]=t}))};for(var s in e.data)o()}},resolve:function(){return(this.unresolved||[]).forEach((function(e){return e()})),delete this.unresolved,this},operator:function(e,t){this.add(e,this.dataflow.add(e.value,t))},transform:function(e,t){this.add(e,this.dataflow.add(this.transforms[zA(t)]))},stream:function(e,t){this.set(e.id,t)},update:function(e,t,n,r,i){this.dataflow.on(t,n,r,i,e.options)},operatorExpression:function(e){return this.expr.operator(this,e)},parameterExpression:function(e){return this.expr.parameter(this,e)},eventExpression:function(e){return this.expr.event(this,e)},handlerExpression:function(e){return this.expr.handler(this,e)},encodeExpression:function(e){return this.expr.encode(this,e)},parse:function(e){var t=this,n=e.operators||[];return e.background&&(t.background=e.background),e.eventConfig&&(t.eventConfig=e.eventConfig),e.locale&&(t.locale=e.locale),n.forEach((function(e){return t.parseOperator(e)})),n.forEach((function(e){return t.parseOperatorParameters(e)})),(e.streams||[]).forEach((function(e){return t.parseStream(e)})),(e.updates||[]).forEach((function(e){return t.parseUpdate(e)})),t.resolve()},parseOperator:function(e){var t=this;!function(e){return"operator"===zA(e)}(e.type)&&e.type?t.transform(e,e.type):t.operator(e,e.update?t.operatorExpression(e.update):null)},parseOperatorParameters:function(e){var t=this;if(e.params){var n=t.get(e.id);n||Object(ye.o)("Invalid operator id: "+e.id),t.dataflow.connect(n,n.parameters(t.parseParameters(e.params),e.react,e.initonly))}},parseParameters:function(e,t){t=t||{};var n=this;for(var r in e){var i=e[r];t[r]=Object(ye.B)(i)?i.map((function(e){return VA(e,n,t)})):VA(i,n,t)}return t},parseStream:function(e){var t,n=this,r=null!=e.filter?n.eventExpression(e.filter):void 0,i=null!=e.stream?n.get(e.stream):void 0;e.source?i=n.events(e.source,e.type,r):e.merge&&(i=(t=e.merge.map((function(e){return n.get(e)})))[0].merge.apply(t[0],t.slice(1))),e.between&&(t=e.between.map((function(e){return n.get(e)})),i=i.between(t[0],t[1])),e.filter&&(i=i.filter(r)),null!=e.throttle&&(i=i.throttle(+e.throttle)),null!=e.debounce&&(i=i.debounce(+e.debounce)),null==i&&Object(ye.o)("Invalid stream definition: "+JSON.stringify(e)),e.consume&&i.consume(!0),n.stream(e,i)},parseUpdate:function(e){var t,n=Object(ye.H)(n=e.source)?n.$ref:n,r=this.get(n),i=e.update,a=void 0;r||Object(ye.o)("Source not defined: "+e.source),t=e.target&&e.target.$expr?this.eventExpression(e.target.$expr):this.get(e.target),i&&i.$expr&&(i.$params&&(a=this.parseParameters(i.$params)),i=this.handlerExpression(i.$expr)),this.update(e,r,t,i,a)},getState:function(e){var t=this,n={};if(e.signals){var r=n.signals={};Object.keys(t.signals).forEach((function(n){var i=t.signals[n];e.signals(n,i)&&(r[n]=i.value)}))}if(e.data){var i=n.data={};Object.keys(t.data).forEach((function(n){var r=t.data[n];e.data(n,r)&&(i[n]=r.input.value)}))}return t.subcontext&&!1!==e.recurse&&(n.subcontext=t.subcontext.map((function(t){return t.getState(e)}))),n},setState:function(e){var t=this,n=t.dataflow,r=e.data,i=e.signals;Object.keys(i||{}).forEach((function(e){n.update(t.signals[e],i[e],qA)})),Object.keys(r||{}).forEach((function(e){n.pulse(t.data[e].input,n.changeset().remove(ye.Ia).insert(r[e]))})),(e.subcontext||[]).forEach((function(e,n){var r=t.subcontext[n];r&&r.setState(e)}))}};var YA=function(e,t,n){var r=new vx,i=t;return null==t?(r.restart(e,t,n),r):(r._restart=r.restart,r.restart=function(e,t,n){t=+t,n=null==n?px():+n,r._restart((function a(o){o+=i,r._restart(a,i+=t,n),e(o)}),t,n)},r.restart(e,t,n),r)};function $A(e,t){e&&(null==t?e.removeAttribute("aria-label"):e.setAttribute("aria-label",t))}var JA="default";function ZA(e,t){var n=e.globalCursor()?"undefined"!=typeof document&&document.body:e.container();if(n)return null==t?n.style.removeProperty("cursor"):n.style.cursor=t}function QA(e,t){var n=e._runtime.data;return Object(ye.w)(n,t)||Object(ye.o)("Unrecognized data set: "+t),n[t]}function eO(e,t){Ie(t)||Object(ye.o)("Second argument to changes must be a changeset.");var n=QA(this,e);return n.modified=!0,this.pulse(n.input,t)}function tO(e){var t=e.padding();return Math.max(0,e._viewWidth+t.left+t.right)}function nO(e){var t=e.padding();return Math.max(0,e._viewHeight+t.top+t.bottom)}function rO(e){var t=e.padding(),n=e._origin;return[t.left+n[0],t.top+n[1]]}function iO(e,t,n){var r,i,a=e._renderer,o=a&&a.canvas();return o&&(i=rO(e),(r=Ld(t.changedTouches?t.changedTouches[0]:t,o))[0]-=i[0],r[1]-=i[1]),t.dataflow=e,t.item=n,t.vega=function(e,t,n){var r=t?"group"===t.mark.marktype?t:t.mark.group:null;function i(e){var n,i=r;if(e)for(n=t;n;n=n.mark.group)if(n.mark.name===e){i=n;break}return i&&i.mark&&i.mark.interactive?i:{}}function a(e){if(!e)return n;Object(ye.J)(e)&&(e=i(e));for(var t=n.slice();e;)t[0]-=e.x||0,t[1]-=e.y||0,e=e.mark&&e.mark.group;return t}return{view:Object(ye.m)(e),item:Object(ye.m)(t||{}),group:i,xy:a,x:function(e){return a(e)[0]},y:function(e){return a(e)[1]}}}(e,n,r),t}var aO="view",oO="timer",sO="window",uO={trap:!1};function cO(e,t,n,r){e._eventListeners.push({type:n,sources:Object(ye.i)(t),handler:r})}function lO(e,t,n){var r=e._eventConfig&&e._eventConfig[t];return!(!1===r||Object(ye.H)(r)&&!r[n])||(e.warn("Blocked ".concat(t," ").concat(n," event listener.")),!1)}function fO(e){return e.item}function dO(e){return e.item.mark.source}function hO(e){return function(t,n){return n.vega.view().changeset().encode(n.item,e)}}function pO(e,t,n){var r=document.createElement(e);for(var i in t)r.setAttribute(i,t[i]);return null!=n&&(r.textContent=n),r}var mO="vega-bind",vO="vega-bind-name",gO="vega-bind-radio";function yO(e,t,n,r){var i=n.event||"input",a=function(){return e.update(t.value)};r.signal(n.signal,t.value),t.addEventListener(i,a),cO(r,t,i,a),e.set=function(e){t.value=e,t.dispatchEvent(function(e){return"undefined"!=typeof Event?new Event(e):{type:e}}(i))}}function bO(e,t,n,r){var i=r.signal(n.signal),a=pO("div",{class:mO}),o="radio"===n.input?a:a.appendChild(pO("label"));o.appendChild(pO("span",{class:vO},n.name||n.signal)),t.appendChild(a);var s=xO;switch(n.input){case"checkbox":s=wO;break;case"select":s=_O;break;case"radio":s=kO;break;case"range":s=EO}s(e,o,n,i)}function xO(e,t,n,r){var i=pO("input");for(var a in n)"signal"!==a&&"element"!==a&&i.setAttribute("input"===a?"type":a,n[a]);i.setAttribute("name",n.signal),i.value=r,t.appendChild(i),i.addEventListener("input",(function(){return e.update(i.value)})),e.elements=[i],e.set=function(e){return i.value=e}}function wO(e,t,n,r){var i={type:"checkbox",name:n.signal};r&&(i.checked=!0);var a=pO("input",i);t.appendChild(a),a.addEventListener("change",(function(){return e.update(a.checked)})),e.elements=[a],e.set=function(e){return a.checked=!!e||null}}function _O(e,t,n,r){var i=pO("select",{name:n.signal}),a=n.labels||[];n.options.forEach((function(e,t){var n={value:e};SO(e,r)&&(n.selected=!0),i.appendChild(pO("option",n,(a[t]||e)+""))})),t.appendChild(i),i.addEventListener("change",(function(){e.update(n.options[i.selectedIndex])})),e.elements=[i],e.set=function(e){for(var t=0,r=n.options.length;t<r;++t)if(SO(n.options[t],e))return void(i.selectedIndex=t)}}function kO(e,t,n,r){var i=pO("span",{class:gO}),a=n.labels||[];t.appendChild(i),e.elements=n.options.map((function(t,o){var s={type:"radio",name:n.signal,value:t};SO(t,r)&&(s.checked=!0);var u=pO("input",s);u.addEventListener("change",(function(){return e.update(t)}));var c=pO("label",{},(a[o]||t)+"");return c.prepend(u),i.appendChild(c),u})),e.set=function(t){for(var n=e.elements,r=n.length,i=0;i<r;++i)SO(n[i].value,t)&&(n[i].checked=!0)}}function EO(e,t,n,r){r=void 0!==r?r:(+n.max+ +n.min)/2;var i=null!=n.max?n.max:Math.max(100,+r)||100,a=n.min||Math.min(0,i,+r)||0,o=n.step||Object(fa.c)(a,i,100),s=pO("input",{type:"range",name:n.signal,min:a,max:i,step:o});s.value=r;var u=pO("span",{},+r);t.appendChild(s),t.appendChild(u);var c=function(){u.textContent=s.value,e.update(+s.value)};s.addEventListener("input",c),s.addEventListener("change",c),e.elements=[s],e.set=function(e){s.value=e,u.textContent=e}}function SO(e,t){return e===t||e+""==t+""}function CO(e,t,n,r,i,a){return(t=t||new r(e.loader())).initialize(n,tO(e),nO(e),rO(e),i,a).background(e.background())}function AO(e,t){return t?function(){try{t.apply(this,arguments)}catch(t){e.error(t)}}:null}function OO(e,t,n){if("string"==typeof t){if("undefined"==typeof document)return e.error("DOM document instance not found."),null;if(!(t=document.querySelector(t)))return e.error("Signal bind element not found: "+t),null}if(t&&n)try{t.innerHTML=""}catch(n){t=null,e.error(n)}return t}var DO=function(e){return+e||0},TO=function(e){return{top:e,bottom:e,left:e,right:e}};function jO(e){return Object(ye.H)(e)?{top:DO(e.top),bottom:DO(e.bottom),left:DO(e.left),right:DO(e.right)}:TO(DO(e))}function MO(e,t,n,r){return FO.apply(this,arguments)}function FO(){return FO=d(m().mark((function e(t,n,r,i){var a,o;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Hh(n),(o=a&&a.headless)||Object(ye.o)("Unrecognized renderer type: "+n),e.next=4,t.runAsync();case 4:return e.abrupt("return",CO(t,null,null,o,r,i).renderAsync(t._scenegraph.root));case 5:case"end":return e.stop()}}),e)}))),FO.apply(this,arguments)}var IO="width",NO="height",RO="padding",PO={skip:!0};function BO(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===RO?r.left+r.right:0)}function LO(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===RO?r.top+r.bottom:0)}function zO(e,t){return t.modified&&Object(ye.B)(t.input.value)&&e.indexOf("_:vega:_")}function UO(e,t){return!("parent"===e||t instanceof st.proxy)}function WO(e,t,n,r){var i=e.element();i&&i.setAttribute("title",function(e){return null==e?"":Object(ye.B)(e)?VO(e):Object(ye.H)(e)&&!Object(ye.D)(e)?function(e){return Object.keys(e).map((function(t){var n=e[t];return t+": "+(Object(ye.B)(n)?VO(n):GO(n))})).join("\n")}(e):e+""}(r))}function VO(e){return"["+e.map(GO).join(", ")+"]"}function GO(e){return Object(ye.B)(e)?"[\u2026]":Object(ye.H)(e)&&!Object(ye.D)(e)?"{\u2026}":e}function qO(e,t){var n=this;if(t=t||{},it.call(n),t.loader&&n.loader(t.loader),t.logger&&n.logger(t.logger),null!=t.logLevel&&n.logLevel(t.logLevel),t.locale||e.locale){var r=Object(ye.p)({},e.locale,t.locale);n.locale(Object(xe.b)(r.number,r.time))}n._el=null,n._elBind=null,n._renderType=t.renderer||Gh.Canvas,n._scenegraph=new Md;var i=n._scenegraph.root;n._renderer=null,n._tooltip=t.tooltip||WO,n._redraw=!0,n._handler=(new Zd).scene(i),n._globalCursor=!1,n._preventDefault=!1,n._timers=[],n._eventListeners=[],n._resizeListeners=[],n._eventConfig=function(e){var t=Object(ye.p)({defaults:{}},e),n=function(e,t){t.forEach((function(t){Object(ye.B)(e[t])&&(e[t]=Object(ye.Fa)(e[t]))}))};return n(t.defaults,["prevent","allow"]),n(t,["view","window","selector"]),t}(e.eventConfig),n.globalCursor(n._eventConfig.globalCursor);var a=function(e,t,n){return HA(e,st,DA,n).parse(t)}(n,e,t.expr);n._runtime=a,n._signals=a.signals,n._bind=(e.bindings||[]).map((function(e){return{state:null,param:Object(ye.p)({},e)}})),a.root&&a.root.set(i),i.source=a.data.root.input,n.pulse(a.data.root.input,n.changeset().insert(i.items)),n._width=n.width(),n._height=n.height(),n._viewWidth=BO(n,n._width),n._viewHeight=LO(n,n._height),n._origin=[0,0],n._resize=0,n._autosize=1,function(e){var t=e._signals,n=t[IO],r=t[NO],i=t[RO];function a(){e._autosize=e._resize=1}e._resizeWidth=e.add(null,(function(t){e._width=t.size,e._viewWidth=BO(e,t.size),a()}),{size:n}),e._resizeHeight=e.add(null,(function(t){e._height=t.size,e._viewHeight=LO(e,t.size),a()}),{size:r});var o=e.add(null,a,{pad:i});e._resizeWidth.rank=n.rank+1,e._resizeHeight.rank=r.rank+1,o.rank=i.rank+1}(n),function(e){e.add(null,(function(t){return e._background=t.bg,e._resize=1,t.bg}),{bg:e._signals.background})}(n),function(e){var t=e._signals.cursor||(e._signals.cursor=e.add({user:JA,item:null}));e.on(e.events("view","mousemove"),t,(function(e,n){var r=t.value,i=r?Object(ye.J)(r)?r:r.user:JA,a=n.item&&n.item.cursor||null;return r&&i===r.user&&a==r.item?r:{user:i,item:a}})),e.add(null,(function(t){var n=t.cursor,r=this.value;return Object(ye.J)(n)||(r=n.item,n=n.user),ZA(e,n&&n!==JA?n:r||n),r}),{cursor:t})}(n),n.description(e.description),t.hover&&n.hover(),t.container&&n.initialize(t.container,t.bind)}function HO(e,t){return Object(ye.w)(e._signals,t)?e._signals[t]:Object(ye.o)("Unrecognized signal name: "+Object(ye.Ba)(t))}function XO(e,t){var n=(e._targets||[]).filter((function(e){return e._update&&e._update.handler===t}));return n.length?n[0]:null}function KO(e,t,n,r){var i=XO(n,r);return i||((i=AO(e,(function(){return r(t,n.value)}))).handler=r,e.on(n,null,i)),e}function YO(e,t,n){var r=XO(t,n);return r&&t._targets.remove(r),e}Object(ye.z)(qO,it,{evaluate:function(e,t,n){var r=this;return d(m().mark((function i(){return m().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,it.prototype.evaluate.call(r,e,t);case 2:if(!r._redraw&&!r._resize){i.next=15;break}if(i.prev=3,i.t0=r._renderer,!i.t0){i.next=9;break}return r._resize&&(r._resize=0,function(e){var t=rO(e),n=tO(e),r=nO(e);e._renderer.background(e.background()),e._renderer.resize(n,r,t),e._handler.origin(t),e._resizeListeners.forEach((function(t){try{t(n,r)}catch(t){e.error(t)}}))}(r)),i.next=9,r._renderer.renderAsync(r._scenegraph.root);case 9:r._redraw=!1,i.next=15;break;case 12:i.prev=12,i.t1=i.catch(3),r.error(i.t1);case 15:return i.abrupt("return",(n&&_e(r,n),r));case 16:case"end":return i.stop()}}),i,null,[[3,12]])})))()},dirty:function(e){this._redraw=!0,this._renderer&&this._renderer.dirty(e)},description:function(e){if(arguments.length){var t=null!=e?e+"":null;return t!==this._desc&&$A(this._el,this._desc=t),this}return this._desc},container:function(){return this._el},scenegraph:function(){return this._scenegraph},origin:function(){return this._origin.slice()},signal:function(e,t,n){var r=HO(this,e);return 1===arguments.length?r.value:this.update(r,t,n)},width:function(e){return arguments.length?this.signal("width",e):this.signal("width")},height:function(e){return arguments.length?this.signal("height",e):this.signal("height")},padding:function(e){return arguments.length?this.signal("padding",jO(e)):jO(this.signal("padding"))},autosize:function(e){return arguments.length?this.signal("autosize",e):this.signal("autosize")},background:function(e){return arguments.length?this.signal("background",e):this.signal("background")},renderer:function(e){return arguments.length?(Hh(e)||Object(ye.o)("Unrecognized renderer type: "+e),e!==this._renderType&&(this._renderType=e,this._resetRenderer()),this):this._renderType},tooltip:function(e){return arguments.length?(e!==this._tooltip&&(this._tooltip=e,this._resetRenderer()),this):this._tooltip},loader:function(e){return arguments.length?(e!==this._loader&&(it.prototype.loader.call(this,e),this._resetRenderer()),this):this._loader},resize:function(){return this._autosize=1,this.touch(HO(this,"autosize"))},_resetRenderer:function(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},_resizeView:function(e,t,n,r,i,a){this.runAfter((function(o){var s=0;o._autosize=0,o.width()!==n&&(s=1,o.signal(IO,n,PO),o._resizeWidth.skip(!0)),o.height()!==r&&(s=1,o.signal(NO,r,PO),o._resizeHeight.skip(!0)),o._viewWidth!==e&&(o._resize=1,o._viewWidth=e),o._viewHeight!==t&&(o._resize=1,o._viewHeight=t),o._origin[0]===i[0]&&o._origin[1]===i[1]||(o._resize=1,o._origin=i),s&&o.run("enter"),a&&o.runAfter((function(e){return e.resize()}))}),!1,1)},addEventListener:function(e,t,n){var r=t;return n&&!1===n.trap||((r=AO(this,t)).raw=t),this._handler.on(e,r),this},removeEventListener:function(e,t){for(var n,r,i=this._handler.handlers(e),a=i.length;--a>=0;)if(r=i[a].type,n=i[a].handler,e===r&&(t===n||t===n.raw)){this._handler.off(r,n);break}return this},addResizeListener:function(e){var t=this._resizeListeners;return t.indexOf(e)<0&&t.push(e),this},removeResizeListener:function(e){var t=this._resizeListeners,n=t.indexOf(e);return n>=0&&t.splice(n,1),this},addSignalListener:function(e,t){return KO(this,e,HO(this,e),t)},removeSignalListener:function(e,t){return YO(this,HO(this,e),t)},addDataListener:function(e,t){return KO(this,e,QA(this,e).values,t)},removeDataListener:function(e,t){return YO(this,QA(this,e).values,t)},globalCursor:function(e){if(arguments.length){if(this._globalCursor!==!!e){var t=ZA(this,null);this._globalCursor=!!e,t&&ZA(this,t)}return this}return this._globalCursor},preventDefault:function(e){return arguments.length?(this._preventDefault=e,this):this._preventDefault},timer:function(e,t){this._timers.push(YA((function(t){e({timestamp:Date.now(),elapsed:t})}),t))},events:function(e,t,n){var r,i=this,a=new Ve(n),o=function(n,r){i.runAsync(null,(function(){e===aO&&function(e,t){var n=e._eventConfig.defaults,r=n.prevent,i=n.allow;return!1!==r&&!0!==i&&(!0===r||!1===i||(r?r[t]:i?!i[t]:e.preventDefault()))}(i,t)&&n.preventDefault(),a.receive(iO(i,n,r))}))};if(e===oO)lO(i,"timer",t)&&i.timer(o,t);else if(e===aO)lO(i,"view",t)&&i.addEventListener(t,o,uO);else if(e===sO?lO(i,"window",t)&&"undefined"!=typeof window&&(r=[window]):"undefined"!=typeof document&&lO(i,"selector",t)&&(r=document.querySelectorAll(e)),r){for(var s=0,u=r.length;s<u;++s)r[s].addEventListener(t,o);cO(i,r,t,o)}else i.warn("Can not resolve event source: "+e);return a},finalize:function(){var e,t,n,r=this._tooltip,i=this._timers,a=this._eventListeners;for(e=i.length;--e>=0;)i[e].stop();for(e=a.length;--e>=0;)for(t=(n=a[e]).sources.length;--t>=0;)n.sources[t].removeEventListener(n.type,n.handler);return r&&r.call(this,this._handler,null,null,null),this},hover:function(e,t){return t=[t||"update",(e=[e||"hover"])[0]],this.on(this.events("view","mouseover",fO),dO,hO(e)),this.on(this.events("view","mouseout",fO),dO,hO(t)),this},data:function(e,t){return arguments.length<2?QA(this,e).values.value:eO.call(this,e,Ne().remove(ye.Ia).insert(t))},change:eO,insert:function(e,t){return eO.call(this,e,Ne().insert(t))},remove:function(e,t){return eO.call(this,e,Ne().remove(t))},scale:function(e){var t=this._runtime.scales;return Object(ye.w)(t,e)||Object(ye.o)("Unrecognized scale or projection: "+e),t[e].value},initialize:function(e,t){var n=this,r=n._renderType,i=n._eventConfig.bind,a=Hh(r);e=n._el=e?OO(n,e,!0):null,function(e){var t=e.container();t&&(t.setAttribute("role","graphics-document"),t.setAttribute("aria-roleDescription","visualization"),$A(t,e.description()))}(n),a||n.error("Unrecognized renderer type: "+r);var o=a.handler||Zd,s=e?a.renderer:a.headless;return n._renderer=s?CO(n,n._renderer,e,s):null,n._handler=function(e,t,n,r){var i=new r(e.loader(),AO(e,e.tooltip())).scene(e.scenegraph().root).initialize(n,rO(e),e);return t&&t.handlers().forEach((function(e){i.on(e.type,e.handler)})),i}(n,n._handler,e,o),n._redraw=!0,e&&"none"!==i&&(t=t?n._elBind=OO(n,t,!0):e.appendChild(pO("form",{class:"vega-bindings"})),n._bind.forEach((function(e){e.param.element&&"container"!==i&&(e.element=OO(n,e.param.element,!!e.param.input))})),n._bind.forEach((function(e){!function(e,t,n){if(t){var r=n.param,i=n.state;i||(i=n.state={elements:null,active:!1,set:null,update:function(t){t!=e.signal(r.signal)&&e.runAsync(null,(function(){i.source=!0,e.signal(r.signal,t)}))}},r.debounce&&(i.update=Object(ye.n)(r.debounce,i.update))),(null==r.input&&r.element?yO:bO)(i,t,r,e),i.active||(e.on(e._signals[r.signal],null,(function(){i.source?i.source=!1:i.set(e.signal(r.signal))})),i.active=!0)}}(n,e.element||t,e)}))),n},toImageURL:function(){var e=d(m().mark((function e(t,n){var r;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t!==Gh.Canvas&&t!==Gh.SVG&&t!==Gh.PNG&&Object(ye.o)("Unrecognized image type: "+t),e.next=3,MO(this,t,n);case 3:return r=e.sent,e.abrupt("return",t===Gh.SVG?function(e,t){var n=new Blob([e],{type:"image/svg+xml"});return window.URL.createObjectURL(n)}(r.svg()):r.canvas().toDataURL("image/png"));case 5:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}(),toCanvas:function(){var e=d(m().mark((function e(t,n){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,MO(this,Gh.Canvas,t,n);case 2:return e.abrupt("return",e.sent.canvas());case 3:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}(),toSVG:function(){var e=d(m().mark((function e(t){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,MO(this,Gh.SVG,t);case 2:return e.abrupt("return",e.sent.svg());case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),getState:function(e){return this._runtime.getState(e||{data:zO,signals:UO,recurse:!0})},setState:function(e){return this.runAsync(null,(function(t){t._trigger=!1,t._runtime.setState(e)}),(function(e){e._trigger=!0})),this}});var $O,JO,ZO="view",QO="[",eD="]",tD="{",nD="}",rD=":",iD=",",aD="@",oD=">",sD=/[[\]{}]/,uD={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};function cD(e,t,n,r,i){for(var a,o=e.length,s=0;t<o;++t){if(a=e[t],!s&&a===n)return t;i&&i.indexOf(a)>=0?--s:r&&r.indexOf(a)>=0&&++s}return t}function lD(e){for(var t=[],n=e.length,r=0,i=0;i<n;)i=cD(e,i,iD,QO+tD,eD+nD),t.push(e.substring(r,i).trim()),r=++i;if(0===t.length)throw"Empty event selector: "+e;return t}function fD(e){return"["===e[0]?function(e){var t,n=e.length,r=1;if((r=cD(e,r,eD,QO,eD))===n)throw"Empty between selector: "+e;if(2!==(t=lD(e.substring(1,r))).length)throw"Between selector must have two elements: "+e;if((e=e.slice(r+1).trim())[0]!==oD)throw"Expected '>' after between selector: "+e;t=t.map(fD);var i=fD(e.slice(1).trim());return i.between?{between:t,stream:i}:(i.between=t,i)}(e):function(e){var t,n,r={source:$O},i=[],a=[0,0],o=0,s=0,u=e.length,c=0;if(e[u-1]===nD){if(!((c=e.lastIndexOf(tD))>=0))throw"Unmatched right brace: "+e;try{a=function(e){var t=e.split(iD);if(!e.length||t.length>2)throw e;return t.map((function(t){var n=+t;if(n!=n)throw e;return n}))}(e.substring(c+1,u-1))}catch(r){throw"Invalid throttle specification: "+e}u=(e=e.slice(0,c).trim()).length,c=0}if(!u)throw e;if(e[0]===aD&&(o=++c),(t=cD(e,c,rD))<u&&(i.push(e.substring(s,t).trim()),s=c=++t),(c=cD(e,c,QO))===u)i.push(e.substring(s,u).trim());else if(i.push(e.substring(s,c).trim()),n=[],(s=++c)===u)throw"Unmatched left bracket: "+e;for(;c<u;){if((c=cD(e,c,eD))===u)throw"Unmatched left bracket: "+e;if(n.push(e.substring(s,c).trim()),c<u-1&&e[++c]!==QO)throw"Expected left bracket: "+e;s=++c}if(!(u=i.length)||sD.test(i[u-1]))throw"Invalid event selector: "+e;return u>1?(r.type=i[1],o?r.markname=i[0].slice(1):function(e){return JO[e]}(i[0])?r.marktype=i[0]:r.source=i[0]):r.type=i[0],"!"===r.type.slice(-1)&&(r.consume=!0,r.type=r.type.slice(0,-1)),null!=n&&(r.filter=n),a[0]&&(r.throttle=a[0]),a[1]&&(r.debounce=a[1]),r}(e)}var dD=function(e){return+e||0},hD=function(e){return{top:e,bottom:e,left:e,right:e}},pD=function(e){return Object(ye.H)(e)&&!Object(ye.B)(e)?Object(ye.p)({},e):{value:e}};function mD(e,t,n,r){return null!=n?(Object(ye.H)(n)&&!Object(ye.B)(n)||Object(ye.B)(n)&&n.length&&Object(ye.H)(n[0])?e.update[t]=n:e[r||"enter"][t]={value:n},1):0}function vD(e,t,n){for(var r in t)mD(e,r,t[r]);for(var i in n)mD(e,i,n[i],"update")}function gD(e,t,n){for(var r in t)n&&Object(ye.w)(n,r)||(e[r]=Object(ye.p)(e[r]||{},t[r]));return e}function yD(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}var bD="mark",xD="frame",wD="scope",_D="axis",kD="axis-domain",ED="axis-grid",SD="axis-label",CD="axis-tick",AD="axis-title",OD="legend",DD="legend-band",TD="legend-entry",jD="legend-gradient",MD="legend-label",FD="legend-symbol",ID="legend-title",ND="title",RD="title-text",PD="title-subtitle";function BD(e,t,n){e[t]=n&&n.signal?{signal:n.signal}:{value:n}}var LD=function(e){return Object(ye.J)(e)?Object(ye.Ba)(e):e.signal?"(".concat(e.signal,")"):VD(e)};function zD(e){if(null!=e.gradient)return function(e){for(var t=[e.start,e.stop,e.count].map((function(e){return null==e?null:Object(ye.Ba)(e)}));t.length&&null==Object(ye.W)(t);)t.pop();return t.unshift(LD(e.gradient)),"gradient(".concat(t.join(","),")")}(e);var t=e.signal?"(".concat(e.signal,")"):e.color?function(e){return e.c?UD("hcl",e.h,e.c,e.l):e.h||e.s?UD("hsl",e.h,e.s,e.l):e.l||e.a?UD("lab",e.l,e.a,e.b):e.r||e.g||e.b?UD("rgb",e.r,e.g,e.b):null}(e.color):null!=e.field?VD(e.field):void 0!==e.value?Object(ye.Ba)(e.value):void 0;return null!=e.scale&&(t=function(e,t){var n=LD(e.scale);return null!=e.range?t="lerp(_range(".concat(n,"), ").concat(+e.range,")"):(void 0!==t&&(t="_scale(".concat(n,", ").concat(t,")")),e.band&&(t=(t?t+"+":"")+"_bandwidth(".concat(n,")")+(1==+e.band?"":"*"+WD(e.band)),e.extra&&(t="(datum.extra ? _scale(".concat(n,", datum.extra.value) : ").concat(t,")"))),null==t&&(t="0")),t}(e,t)),void 0===t&&(t=null),null!=e.exponent&&(t="pow(".concat(t,",").concat(WD(e.exponent),")")),null!=e.mult&&(t+="*".concat(WD(e.mult))),null!=e.offset&&(t+="+".concat(WD(e.offset))),e.round&&(t="round(".concat(t,")")),t}var UD=function(e,t,n,r){return"(".concat(e,"(").concat([t,n,r].map(zD).join(","),")+'')")};function WD(e){return Object(ye.H)(e)?"("+zD(e)+")":e}function VD(e){return function e(t){var n,r,i;if(t.signal)n="datum",i=t.signal;else if(t.group||t.parent){for(r=Math.max(1,t.level||1),n="item";r-- >0;)n+=".mark.group";t.parent?(i=t.parent,n+=".datum"):i=t.group}else t.datum?(n="datum",i=t.datum):Object(ye.o)("Invalid field reference: "+Object(ye.Ba)(t));return t.signal||(i=Object(ye.J)(i)?Object(ye.Aa)(i).map(ye.Ba).join("]["):e(i)),n+"["+i+"]"}(Object(ye.H)(e)?e:{datum:e})}function GD(e,t,n,r,i,a){var o={};for(var s in(a=a||{}).encoders={$encode:o},e=function(e,t,n,r,i){var a,o,s,u={},c={};for(o in o="lineBreak","text"!==t||null==i[o]||yD(o,e)||BD(u,o,i[o]),("legend"==n||String(n).startsWith("axis"))&&(n=null),s=n===xD?i.group:n===bD?Object(ye.p)({},i.mark,i[t]):null)yD(o,e)||("fill"===o||"stroke"===o)&&(yD("fill",e)||yD("stroke",e))||BD(u,o,s[o]);for(o in Object(ye.i)(r).forEach((function(t){var n=i.style&&i.style[t];for(var r in n)yD(r,e)||BD(u,r,n[r])})),e=Object(ye.p)({},e),u)(s=u[o]).signal?(a=a||{})[o]=s:c[o]=s;return e.enter=Object(ye.p)(c,e.enter),a&&(e.update=Object(ye.p)(a,e.update)),e}(e,t,n,r,i.config),e)o[s]=qD(e[s],t,a,i);return a}function qD(e,t,n,r){var i={},a={};for(var o in e)null!=e[o]&&(i[o]=XD(HD(e[o]),r,n,a));return{$expr:{marktype:t,channels:i},$fields:Object.keys(a),$output:Object.keys(e)}}function HD(e){return Object(ye.B)(e)?function(e){var t="";return e.forEach((function(e){var n=zD(e);t+=e.test?"(".concat(e.test,")?").concat(n,":"):n})),":"===Object(ye.W)(t)&&(t+="null"),t}(e):zD(e)}function XD(e,t,n,r){var i=PA(e,t);return i.$fields.forEach((function(e){return r[e]=1})),Object(ye.p)(n,i.$params),i.$expr}var KD="outer",YD=["value","update","init","react","bind"];function $D(e,t){Object(ye.o)(e+' for "outer" push: '+Object(ye.Ba)(t))}function JD(e,t){var n=e.name;if(e.push===KD)t.signals[n]||$D("No prior signal definition",n),YD.forEach((function(t){void 0!==e[t]&&$D("Invalid property ",t)}));else{var r=t.addSignal(n,e.value);!1===e.react&&(r.react=!1),e.bind&&t.addBinding(n,e.bind)}}function ZD(e,t,n,r){this.id=-1,this.type=e,this.value=t,this.params=n,r&&(this.parent=r)}function QD(e,t,n,r){return new ZD(e,t,n,r)}function eT(e,t){return QD("operator",e,t)}function tT(e){var t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}function nT(e,t){return t?{$field:e,$name:t}:{$field:e}}var rT=nT("key");function iT(e,t){return{$compare:e,$order:t}}var aT="descending";function oT(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}var sT="scope",uT="view";function cT(e){return e&&e.signal}function lT(e){if(cT(e))return!0;if(Object(ye.H)(e))for(var t in e)if(lT(e[t]))return!0;return!1}function fT(e,t){return null!=e?e:t}function dT(e){return e&&e.signal||e}var hT="timer";function pT(e,t){return(e.merge?mT:e.stream?vT:e.type?gT:Object(ye.o)("Invalid stream specification: "+Object(ye.Ba)(e)))(e,t)}function mT(e,t){var n=yT({merge:e.merge.map((function(e){return pT(e,t)}))},e,t);return t.addStream(n).id}function vT(e,t){var n=yT({stream:pT(e.stream,t)},e,t);return t.addStream(n).id}function gT(e,t){var n;e.type===hT?(n=t.event(hT,e.throttle),e={between:e.between,filter:e.filter}):n=t.event(function(e){return e===sT?uT:e||uT}(e.source),e.type);var r=yT({stream:n},e,t);return 1===Object.keys(r).length?n:t.addStream(r).id}function yT(e,t,n){var r=t.between;return r&&(2!==r.length&&Object(ye.o)('Stream "between" parameter must have 2 entries: '+Object(ye.Ba)(t)),e.between=[pT(r[0],n),pT(r[1],n)]),r=t.filter?[].concat(t.filter):[],(t.marktype||t.markname||t.markrole)&&r.push(function(e,t,n){var r="event.item";return r+(e&&"*"!==e?"&&"+r+".mark.marktype==='"+e+"'":"")+(n?"&&"+r+".mark.role==='"+n+"'":"")+(t?"&&"+r+".mark.name==='"+t+"'":"")}(t.marktype,t.markname,t.markrole)),t.source===sT&&r.push("inScope(event.item)"),r.length&&(e.filter=PA("("+r.join(")&&(")+")",n).$expr),null!=(r=t.throttle)&&(e.throttle=+r),null!=(r=t.debounce)&&(e.debounce=+r),t.consume&&(e.consume=!0),e}var bT={code:"_.$value",ast:{type:"Identifier",value:"value"}};function xT(e,t,n){var r=e.encode,i={target:n},a=e.events,o=e.update,s=[];a||Object(ye.o)("Signal update missing events specification."),Object(ye.J)(a)&&(a=function(e,t,n){return $O=t||ZO,JO=uD,lD(e.trim()).map(fD)}(a,t.isSubscope()?sT:uT)),a=Object(ye.i)(a).filter((function(e){return e.signal||e.scale?(s.push(e),0):1})),s.length>1&&(s=[function(e){return{signal:"["+e.map((function(e){return e.scale?'scale("'+e.scale+'")':e.signal}))+"]"}}(s)]),a.length&&s.push(a.length>1?{merge:a}:a[0]),null!=r&&(o&&Object(ye.o)("Signal encode and update are mutually exclusive."),o="encode(item(),"+Object(ye.Ba)(r)+")"),i.update=Object(ye.J)(o)?PA(o,t):null!=o.expr?PA(o.expr,t):null!=o.value?o.value:null!=o.signal?{$expr:bT,$params:{$value:t.signalRef(o.signal)}}:Object(ye.o)("Invalid signal update specification."),e.force&&(i.options={force:!0}),s.forEach((function(e){return t.addUpdate(Object(ye.p)(function(e,t){return{source:e.signal?t.signalRef(e.signal):e.scale?t.scaleRef(e.scale):pT(e,t)}}(e,t),i))}))}var wT=function(e){return function(t,n,r){return QD(e,n,t||void 0,r)}},_T=wT("aggregate"),kT=wT("axisticks"),ET=wT("bound"),ST=wT("collect"),CT=wT("compare"),AT=wT("datajoin"),OT=wT("encode"),DT=wT("expression"),TT=wT("facet"),jT=wT("field"),MT=wT("key"),FT=wT("legendentries"),IT=wT("load"),NT=wT("mark"),RT=wT("multiextent"),PT=wT("multivalues"),BT=wT("overlap"),LT=wT("params"),zT=wT("prefacet"),UT=wT("projection"),WT=wT("proxy"),VT=wT("relay"),GT=wT("render"),qT=wT("scale"),HT=wT("sieve"),XT=wT("sortitems"),KT=wT("viewlayout"),YT=wT("values"),$T=0,JT={min:"min",max:"max",count:"sum"};function ZT(e,t){var n,r=t.getScale(e.name).params;for(n in r.domain=nj(e.domain,e,t),null!=e.range&&(r.range=function e(t,n,r){var i=n.config.range,a=t.range;if(a.signal)return n.signalRef(a.signal);if(Object(ye.J)(a)){if(i&&Object(ye.w)(i,a))return e(t=Object(ye.p)({},t,{range:i[a]}),n,r);"width"===a?a=[0,{signal:"width"}]:"height"===a?a=Yu(t.type)?[0,{signal:"height"}]:[{signal:"height"},0]:Object(ye.o)("Unrecognized scale range value: "+Object(ye.Ba)(a))}else{if(a.scheme)return r.scheme=Object(ye.B)(a.scheme)?ej(a.scheme,n):QT(a.scheme,n),a.extent&&(r.schemeExtent=ej(a.extent,n)),void(a.count&&(r.schemeCount=QT(a.count,n)));if(a.step)return void(r.rangeStep=QT(a.step,n));if(Yu(t.type)&&!Object(ye.B)(a))return nj(a,t,n);Object(ye.B)(a)||Object(ye.o)("Unsupported range type: "+Object(ye.Ba)(a))}return a.map((function(e){return(Object(ye.B)(e)?ej:QT)(e,n)}))}(e,t,r)),null!=e.interpolate&&function(e,t){t.interpolate=QT(e.type||e),null!=e.gamma&&(t.interpolateGamma=QT(e.gamma))}(e.interpolate,r),null!=e.nice&&(r.nice=function(e){return Object(ye.H)(e)?{interval:QT(e.interval),step:QT(e.step)}:QT(e)}(e.nice)),null!=e.bins&&(r.bins=function(e,t){return e.signal||Object(ye.B)(e)?ej(e,t):t.objectProperty(e)}(e.bins,t)),e)Object(ye.w)(r,n)||"name"===n||(r[n]=QT(e[n],t))}function QT(e,t){return Object(ye.H)(e)?e.signal?t.signalRef(e.signal):Object(ye.o)("Unsupported object: "+Object(ye.Ba)(e)):e}function ej(e,t){return e.signal?t.signalRef(e.signal):e.map((function(e){return QT(e,t)}))}function tj(e){Object(ye.o)("Can not find data set: "+Object(ye.Ba)(e))}function nj(e,t,n){if(e)return e.signal?n.signalRef(e.signal):(Object(ye.B)(e)?function(e,t,n){return e.map((function(e){return QT(e,n)}))}:e.fields?function(e,t,n){var r=e.data,i=e.fields.reduce((function(e,t){return t=Object(ye.J)(t)?{data:r,field:t}:Object(ye.B)(t)||t.signal?function(e,t){var n="_:vega:_"+$T++,r=ST({});if(Object(ye.B)(e))r.value={$ingest:e};else if(e.signal){var i="setdata("+Object(ye.Ba)(n)+","+e.signal+")";r.params.input=t.signalRef(i)}return t.addDataPipeline(n,[r,HT({})]),{data:n,field:"data"}}(t,n):t,e.push(t),e}),[]);return(Yu(t.type)?function(e,t,n){var r,i,a=rj(e.sort,!0),o=n.map((function(e){var n=t.getData(e.data);return n||tj(e.data),n.countsRef(t,e.field,a)})),s={groupby:rT,pulse:o};a&&(r=a.op||"count",i=a.field?oT(r,a.field):"count",s.ops=[JT[r]],s.fields=[t.fieldRef(i)],s.as=[i]),r=t.add(_T(s));var u=t.add(ST({pulse:tT(r)}));return tT(i=t.add(YT({field:rT,sort:t.sortRef(a),pulse:tT(u)})))}:Qu(t.type)?function(e,t,n){var r=n.map((function(e){var n=t.getData(e.data);return n||tj(e.data),n.domainRef(t,e.field)}));return tT(t.add(PT({values:r})))}:function(e,t,n){var r=n.map((function(e){var n=t.getData(e.data);return n||tj(e.data),n.extentRef(t,e.field)}));return tT(t.add(RT({extents:r})))})(e,n,i)}:function(e,t,n){var r=n.getData(e.data);return r||tj(e.data),Yu(t.type)?r.valuesRef(n,e.field,rj(e.sort,!1)):Qu(t.type)?r.domainRef(n,e.field):r.extentRef(n,e.field)})(e,t,n);null==t.domainMin&&null==t.domainMax||Object(ye.o)("No scale domain defined for domainMin/domainMax to override.")}function rj(e,t){return e&&(e.field||e.op?e.field||"count"===e.op?t&&e.field&&e.op&&!JT[e.op]&&Object(ye.o)("Multiple domain scales can not be sorted using "+e.op):Object(ye.o)("No field provided for sort aggregate op: "+e.op):Object(ye.H)(e)?e.field="key":e={field:"key"}),e}function ij(e,t,n){return Object(ye.B)(e)?e.map((function(e){return ij(e,t,n)})):Object(ye.H)(e)?e.signal?n.signalRef(e.signal):"fit"===t?e:Object(ye.o)("Unsupported parameter object: "+Object(ye.Ba)(e)):e}var aj="top",oj="bottom",sj="vertical",uj="start",cj="end",lj="index",fj="label",dj="offset",hj="perc",pj="perc2",mj="value",vj="guide-label",gj="guide-title",yj="group-title",bj="group-subtitle",xj="symbol",wj="gradient",_j="discrete",kj="size",Ej=[kj,"shape","fill","stroke","strokeWidth","strokeDash","opacity"],Sj={name:1,style:1,interactive:1},Cj={value:0},Aj={value:1},Oj="group",Dj="rect",Tj="rule",jj="symbol",Mj="text";function Fj(e){return e.type=Oj,e.interactive=e.interactive||!1,e}function Ij(e,t){var n=function(n,r){return fT(e[n],fT(t[n],r))};return n.isVertical=function(n){return sj===fT(e.direction,t.direction||(n?t.symbolDirection:t.gradientDirection))},n.gradientLength=function(){return fT(e.gradientLength,t.gradientLength||t.gradientWidth)},n.gradientThickness=function(){return fT(e.gradientThickness,t.gradientThickness||t.gradientHeight)},n.entryColumns=function(){return fT(e.columns,fT(t.columns,+n.isVertical(!0)))},n}function Nj(e,t){var n=t&&(t.update&&t.update[e]||t.enter&&t.enter[e]);return n&&n.signal?n:n?n.value:null}function Rj(e,t,n){return"item.anchor === '".concat(uj,"' ? ").concat(e," : item.anchor === '").concat(cj,"' ? ").concat(t," : ").concat(n)}var Pj=Rj(Object(ye.Ba)("left"),Object(ye.Ba)("right"),Object(ye.Ba)("center"));function Bj(e,t){return t?(e.name=t.name,e.style=t.style||e.style,e.interactive=!!t.interactive,e.encode=gD(e.encode,t,Sj)):e.interactive=!1,e}var Lj="datum.".concat(hj,'<=0?"left":datum.').concat(hj,'>=1?"right":"center"'),zj="datum.".concat(hj,'<=0?"').concat(oj,'":datum.').concat(hj,'>=1?"').concat(aj,'":"middle"');function Uj(e,t,n,r){var i,a,o,s,u=Ij(e,t),c=u.isVertical(),l=pD(u.gradientThickness()),f=u.gradientLength(),d=u("labelOverlap"),h="",p={enter:i={opacity:Cj},update:a={opacity:Aj,text:{field:fj}},exit:{opacity:Cj}};return vD(p,{fill:u("labelColor"),fillOpacity:u("labelOpacity"),font:u("labelFont"),fontSize:u("labelFontSize"),fontStyle:u("labelFontStyle"),fontWeight:u("labelFontWeight"),limit:fT(e.labelLimit,t.gradientLabelLimit)}),c?(i.align={value:"left"},i.baseline=a.baseline={signal:zj},o="y",s="x",h="1-"):(i.align=a.align={signal:Lj},i.baseline={value:"top"},o="x",s="y"),i[o]=a[o]={signal:h+"datum."+hj,mult:f},i[s]=a[s]=l,l.offset=fT(e.labelOffset,t.gradientLabelOffset)||0,d=d?{separation:u("labelSeparation"),method:d,order:"datum."+lj}:void 0,Bj({type:Mj,role:MD,style:vj,key:mj,from:r,encode:p,overlap:d},n)}var Wj='(item.orient === "left" || item.orient === "right")',Vj="datum.vgrad && ".concat(Wj),Gj=Rj('"top"','"bottom"','"middle"'),qj='datum.vgrad && item.orient === "right" ? ('.concat(Rj('"right"','"left"','"center"'),") : (").concat(Wj,' && !(datum.vgrad && item.orient === "left")) ? "left" : ').concat(Pj),Hj="item._anchor || (".concat(Wj,' ? "middle" : "start")'),Xj="".concat(Vj,' ? (item.orient === "left" ? -90 : 90) : 0'),Kj="".concat(Wj,' ? (datum.vgrad ? (item.orient === "right" ? "bottom" : "top") : ').concat(Gj,') : "top"');function Yj(e){return Object(ye.H)(e)&&e.signal?e.signal:Object(ye.Ba)(e)}function $j(e){var t=e.role||"";return t.indexOf("axis")&&t.indexOf("legend")&&t.indexOf("title")?e.type===Oj?wD:t||bD:t}function Jj(e,t){var n=ut(e.type);n||Object(ye.o)("Unrecognized transform type: "+Object(ye.Ba)(e.type));var r=QD(n.type.toLowerCase(),null,Zj(n,e,t));return e.signal&&t.addSignal(e.signal,t.proxy(r)),r.metadata=n.metadata||{},r}function Zj(e,t,n){for(var r={},i=e.params.length,a=0;a<i;++a){var o=e.params[a];r[o.name]=Qj(o,t,n)}return r}function Qj(e,t,n){var r=e.type,i=t[e.name];return"index"===r?function(e,t,n){return Object(ye.J)(t.from)||Object(ye.o)('Lookup "from" parameter must be a string literal.'),n.getData(t.from).lookupRef(n,t.key)}(0,t,n):void 0!==i?"param"===r?function(e,t,n){var r=t[e.name];return e.array?(Object(ye.B)(r)||Object(ye.o)("Expected an array of sub-parameters. Instead: "+Object(ye.Ba)(r)),r.map((function(t){return tM(e,t,n)}))):tM(e,r,n)}(e,t,n):"projection"===r?n.projectionRef(t[e.name]):e.array&&!cT(i)?i.map((function(t){return eM(e,t,n)})):eM(e,i,n):void(e.required&&Object(ye.o)("Missing required "+Object(ye.Ba)(t.type)+" parameter: "+Object(ye.Ba)(e.name)))}function eM(e,t,n){var r=e.type;if(cT(t))return aM(r)?Object(ye.o)("Expression references can not be signals."):oM(r)?n.fieldRef(t):sM(r)?n.compareRef(t):n.signalRef(t.signal);var i=e.expr||oM(r);return i&&nM(t)?n.exprRef(t.expr,t.as):i&&rM(t)?nT(t.field,t.as):aM(r)?PA(t,n):iM(r)?tT(n.getData(t).values):oM(r)?nT(t):sM(r)?n.compareRef(t):t}function tM(e,t,n){for(var r,i=e.params.length,a=0;a<i;++a){for(var o in(r=e.params[a]).key)if(r.key[o]!==t[o]){r=null;break}if(r)break}r||Object(ye.o)("Unsupported parameter: "+Object(ye.Ba)(t));var s=Object(ye.p)(Zj(r,t,n),r.key);return tT(n.add(LT(s)))}var nM=function(e){return e&&e.expr},rM=function(e){return e&&e.field},iM=function(e){return"data"===e},aM=function(e){return"expr"===e},oM=function(e){return"field"===e},sM=function(e){return"compare"===e};function uM(e,t){return e.$ref?e:e.data&&e.data.$ref?e.data:tT(t.getData(e.data).output)}function cM(e,t,n,r,i){this.scope=e,this.input=t,this.output=n,this.values=r,this.aggregate=i,this.index={}}function lM(e){return Object(ye.J)(e)?e:null}function fM(e,t,n){var r,i=oT(n.op,n.field);if(t.ops){for(var a=0,o=t.as.length;a<o;++a)if(t.as[a]===i)return}else t.ops=["count"],t.fields=[null],t.as=["count"];n.op&&(t.ops.push((r=n.op.signal)?e.signalRef(r):n.op),t.fields.push(e.fieldRef(n.field)),t.as.push(i))}function dM(e,t,n,r,i,a,o){var s,u,c=t[n]||(t[n]={}),l=function(e){return Object(ye.H)(e)?(e.order===aT?"-":"+")+oT(e.op,e.field):""}(a),f=lM(i);if(null!=f&&(e=t.scope,s=c[f+=l?"|"+l:""]),!s){var d=a?{field:rT,pulse:t.countsRef(e,i,a)}:{field:e.fieldRef(i),pulse:tT(t.output)};l&&(d.sort=e.sortRef(a)),u=e.add(QD(r,void 0,d)),o&&(t.index[i]=u),s=tT(u),null!=f&&(c[f]=s)}return s}function hM(e,t,n){var r=e.remove,i=e.insert,a=e.toggle,o=e.modify,s=e.values,u=t.add(eT()),c=PA("if("+e.trigger+',modify("'+n+'",'+[i,r,a,o,s].map((function(e){return null==e?"null":e})).join(",")+"),0)",t);u.update=c.$expr,u.params=c.$params}function pM(e,t){var n,r,i,a,o,s,u,c=$j(e),l=e.type===Oj,f=e.from&&e.from.facet,d=e.overlap,h=e.layout||c===wD||c===xD,p=c===bD||h||f,m=function(e,t,n){var r,i,a,o,s;return e?(r=e.facet)&&(t||Object(ye.o)("Only group marks can be faceted."),null!=r.field?o=s=uM(r,n):(e.data?s=tT(n.getData(e.data).aggregate):((a=Jj(Object(ye.p)({type:"aggregate",groupby:Object(ye.i)(r.groupby)},r.aggregate),n)).params.key=n.keyRef(r.groupby),a.params.pulse=uM(r,n),o=s=tT(n.add(a))),i=n.keyRef(r.groupby,!0))):o=tT(n.add(ST(null,[{}]))),o||(o=uM(e,n)),{key:i,pulse:o,parent:s}}(e.from,l,t),v=tT(r=t.add(AT({key:m.key||(e.key?nT(e.key):void 0),pulse:m.pulse,clean:!l})));r=i=t.add(ST({pulse:v}));var g=tT(r=t.add(NT({markdef:function(e){return{marktype:e.type,name:e.name||void 0,role:e.role||$j(e),zindex:+e.zindex||void 0,aria:e.aria,description:e.description}}(e),interactive:function(e,t){return e&&e.signal?t.signalRef(e.signal):!1!==e}(e.interactive,t),clip:function(e,t){var n;return Object(ye.H)(e)&&(e.signal?n=e.signal:e.path?n="pathShape("+Yj(e.path)+")":e.sphere&&(n="geoShape("+Yj(e.sphere)+', {type: "Sphere"})')),n?t.signalRef(n):!!e}(e.clip,t),context:{$context:!0},groups:t.lookup(),parent:t.signals.parent?t.signalRef("parent"):null,index:t.markpath(),pulse:tT(r)})));(r=a=t.add(OT(GD(e.encode,e.type,c,e.style,t,{mod:!1,pulse:g})))).params.parent=t.encode(),e.transform&&e.transform.forEach((function(e){var n=Jj(e,t),i=n.metadata;(i.generates||i.changes)&&Object(ye.o)("Mark transforms should not generate new data."),i.nomod||(a.params.mod=!0),n.params.pulse=tT(r),t.add(r=n)})),e.sort&&(r=t.add(XT({sort:t.compareRef(e.sort),pulse:tT(r)})));var y=tT(r);(f||h)&&(s=tT(h=t.add(KT({layout:t.objectProperty(e.layout),legends:t.legends,mark:g,pulse:y}))));var b=t.add(ET({mark:g,pulse:s||y}));u=tT(b),l&&(p&&((n=t.operators).pop(),h&&n.pop()),t.pushState(y,s||u,v),f?function(e,t,n){var r,i=e.from.facet,a=i.name,o=uM(i,t);i.name||Object(ye.o)("Facet must have a name: "+Object(ye.Ba)(i)),i.data||Object(ye.o)("Facet must reference a data set: "+Object(ye.Ba)(i)),i.field?r=t.add(zT({field:t.fieldRef(i.field),pulse:o})):i.groupby?r=t.add(TT({key:t.keyRef(i.groupby),group:tT(t.proxy(n.parent)),pulse:o})):Object(ye.o)("Facet must specify groupby or field: "+Object(ye.Ba)(i));var s=t.fork(),u=s.add(ST()),c=s.add(HT({pulse:tT(u)}));s.addData(a,new cM(s,u,u,c)),s.addSignal("parent",null),r.params.subflow={$subflow:s.parse(e).toRuntime()}}(e,t,m):p?function(e,t,n){var r=t.add(zT({pulse:n.pulse})),i=t.fork();i.add(HT()),i.addSignal("parent",null),r.params.subflow={$subflow:i.parse(e).toRuntime()}}(e,t,m):t.parse(e),t.popState(),p&&(h&&n.push(h),n.push(b))),d&&(u=function(e,t,n){var r=e.method,i=e.bound,a=e.separation,o={separation:cT(a)?n.signalRef(a.signal):a,method:cT(r)?n.signalRef(r.signal):r,pulse:t};if(e.order&&(o.sort=n.compareRef({field:e.order})),i){var s=i.tolerance;o.boundTolerance=cT(s)?n.signalRef(s.signal):+s,o.boundScale=n.scaleRef(i.scale),o.boundOrient=i.orient}return tT(n.add(BT(o)))}(d,u,t));var x=t.add(GT({pulse:u})),w=t.add(HT({pulse:tT(x)},void 0,t.parent()));null!=e.name&&(o=e.name,t.addData(o,new cM(t,i,x,w)),e.on&&e.on.forEach((function(e){(e.insert||e.remove||e.toggle)&&Object(ye.o)("Marks only support modify triggers."),hM(e,t,o)})))}function mM(e,t){var n,r,i,a=t.config.legend,o=e.encode||{},s=Ij(e,a),u=o.legend||{},c=u.name||void 0,l=u.interactive,f=u.style,d={},h=0;Ej.forEach((function(t){return e[t]?(d[t]=e[t],h=h||e[t]):0})),h||Object(ye.o)("Missing valid scale for legend.");var p=function(e,t){var n=e.type||xj;return e.type||1!==function(e){return Ej.reduce((function(t,n){return t+(e[n]?1:0)}),0)}(e)||!e.fill&&!e.stroke||(n=Ku(t)?wj:$u(t)?_j:xj),n!==wj?n:$u(t)?_j:wj}(e,t.scaleType(h)),m={title:null!=e.title,scales:d,type:p,vgrad:"symbol"!==p&&s.isVertical()},v=tT(t.add(ST(null,[m]))),g=tT(t.add(FT(r={type:p,scale:t.scaleRef(h),count:t.objectProperty(s("tickCount")),limit:t.property(s("symbolLimit")),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)})));return p===wj?(i=[function(e,t,n,r){var i,a,o,s,u,c=Ij(e,n),l=c.isVertical(),f=c.gradientThickness(),d=c.gradientLength();l?(a=[0,1],o=[0,0],s=f,u=d):(a=[0,0],o=[1,0],s=d,u=f);var h={enter:i={opacity:Cj,x:Cj,y:Cj,width:pD(s),height:pD(u)},update:Object(ye.p)({},i,{opacity:Aj,fill:{gradient:t,start:a,stop:o}}),exit:{opacity:Cj}};return vD(h,{stroke:c("gradientStrokeColor"),strokeWidth:c("gradientStrokeWidth")},{opacity:c("gradientOpacity")}),Bj({type:Dj,role:jD,encode:h},r)}(e,h,a,o.gradient),Uj(e,a,o.labels,g)],r.count=r.count||t.signalRef("max(2,2*floor((".concat(dT(s.gradientLength()),")/100))"))):p===_j?i=[function(e,t,n,r,i){var a,o,s,u,c=Ij(e,n),l=c.isVertical(),f=c.gradientThickness(),d=c.gradientLength(),h="";l?(a="y",s="y2",o="x",u="width",h="1-"):(a="x",s="x2",o="y",u="height");var p={opacity:Cj,fill:{scale:t,field:mj}};p[a]={signal:h+"datum."+hj,mult:d},p[o]=Cj,p[s]={signal:h+"datum."+pj,mult:d},p[u]=pD(f);var m={enter:p,update:Object(ye.p)({},p,{opacity:Aj}),exit:{opacity:Cj}};return vD(m,{stroke:c("gradientStrokeColor"),strokeWidth:c("gradientStrokeWidth")},{opacity:c("gradientOpacity")}),Bj({type:Dj,role:DD,key:mj,from:i,encode:m},r)}(e,h,a,o.gradient,g),Uj(e,a,o.labels,g)]:(n=function(e,t){var n=Ij(e,t);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:!0,column:!1},padding:{row:n("rowPadding"),column:n("columnPadding")}}}(e,a),i=[function(e,t,n,r,i){var a,o,s,u,c,l=Ij(e,t),f=n.entries,d=!(!f||!f.interactive),h=f?f.name:void 0,p=l("clipHeight"),m=l("symbolOffset"),v={data:"value"},g="(".concat(i,") ? datum.").concat(dj," : datum.").concat(kj),y=p?pD(p):{field:kj},b="datum.".concat(lj),x="max(1, ".concat(i,")");y.mult=.5,a={enter:o={opacity:Cj,x:{signal:g,mult:.5,offset:m},y:y},update:s={opacity:Aj,x:o.x,y:o.y},exit:{opacity:Cj}};var w=null,_=null;e.fill||(w=t.symbolBaseFillColor,_=t.symbolBaseStrokeColor),vD(a,{fill:l("symbolFillColor",w),shape:l("symbolType"),size:l("symbolSize"),stroke:l("symbolStrokeColor",_),strokeDash:l("symbolDash"),strokeDashOffset:l("symbolDashOffset"),strokeWidth:l("symbolStrokeWidth")},{opacity:l("symbolOpacity")}),Ej.forEach((function(t){e[t]&&(s[t]=o[t]={scale:e[t],field:mj})}));var k=Bj({type:jj,role:FD,key:mj,from:v,clip:!!p||void 0,encode:a},n.symbols),E=pD(m);E.offset=l("labelOffset"),vD(a={enter:o={opacity:Cj,x:{signal:g,offset:E},y:y},update:s={opacity:Aj,text:{field:fj},x:o.x,y:o.y},exit:{opacity:Cj}},{align:l("labelAlign"),baseline:l("labelBaseline"),fill:l("labelColor"),fillOpacity:l("labelOpacity"),font:l("labelFont"),fontSize:l("labelFontSize"),fontStyle:l("labelFontStyle"),fontWeight:l("labelFontWeight"),limit:l("labelLimit")});var S=Bj({type:Mj,role:MD,style:vj,key:mj,from:v,encode:a},n.labels);return a={enter:{noBound:{value:!p},width:Cj,height:p?pD(p):Cj,opacity:Cj},exit:{opacity:Cj},update:s={opacity:Aj,row:{signal:null},column:{signal:null}}},l.isVertical(!0)?(u="ceil(item.mark.items.length / ".concat(x,")"),s.row.signal="".concat(b,"%").concat(u),s.column.signal="floor(".concat(b," / ").concat(u,")"),c={field:["row",b]}):(s.row.signal="floor(".concat(b," / ").concat(x,")"),s.column.signal="".concat(b," % ").concat(x),c={field:b}),s.column.signal="(".concat(i,")?").concat(s.column.signal,":").concat(b),Fj({role:wD,from:r={facet:{data:r,name:"value",groupby:lj}},encode:gD(a,f,Sj),marks:[k,S],name:h,interactive:d,sort:c})}(e,a,o,g,dT(n.columns))],r.size=function(e,t,n){var r=dT(vM("size",e,n)),i=dT(vM("strokeWidth",e,n)),a=dT(function(e,t,n){return Nj("fontSize",e)||function(e,t,n){var r=t.config.style[n];return r&&r[e]}("fontSize",t,n)}(n[1].encode,t,vj));return PA("max(ceil(sqrt(".concat(r,")+").concat(i,"),").concat(a,")"),t)}(e,t,i[0].marks)),i=[Fj({role:TD,from:v,encode:{enter:{x:{value:0},y:{value:0}}},marks:i,layout:n,interactive:l})],m.title&&i.push(function(e,t,n,r){var i=Ij(e,t),a={enter:{opacity:Cj},update:{opacity:Aj,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:Cj}};return vD(a,{orient:i("titleOrient"),_anchor:i("titleAnchor"),anchor:{signal:Hj},angle:{signal:Xj},align:{signal:qj},baseline:{signal:Kj},text:e.title,fill:i("titleColor"),fillOpacity:i("titleOpacity"),font:i("titleFont"),fontSize:i("titleFontSize"),fontStyle:i("titleFontStyle"),fontWeight:i("titleFontWeight"),limit:i("titleLimit"),lineHeight:i("titleLineHeight")},{align:i("titleAlign"),baseline:i("titleBaseline")}),Bj({type:Mj,role:ID,style:gj,from:r,encode:a},n)}(e,a,o.title,v)),pM(Fj({role:OD,from:v,encode:gD(function(e,t,n){var r={enter:{},update:{}};return vD(r,{orient:e("orient"),offset:e("offset"),padding:e("padding"),titlePadding:e("titlePadding"),cornerRadius:e("cornerRadius"),fill:e("fillColor"),stroke:e("strokeColor"),strokeWidth:n.strokeWidth,strokeDash:n.strokeDash,x:e("legendX"),y:e("legendY"),format:t.format,formatType:t.formatType}),r}(s,e,a),u,Sj),marks:i,aria:s("aria"),description:s("description"),zindex:s("zindex"),name:c,interactive:l,style:f}),t)}function vM(e,t,n){return t[e]?'scale("'.concat(t[e],'",datum)'):Nj(e,n[0].encode)}cM.fromEntries=function(e,t){var n=t.length,r=t[n-1],i=t[n-2],a=t[0],o=null,s=1;for(a&&"load"===a.type&&(a=t[1]),e.add(t[0]);s<n;++s)t[s].params.pulse=tT(t[s-1]),e.add(t[s]),"aggregate"===t[s].type&&(o=t[s]);return new cM(e,a,i,r,o)},cM.prototype={countsRef:function(e,t,n){var r,i,a,o=this,s=o.counts||(o.counts={}),u=lM(t);return null!=u&&(e=o.scope,r=s[u]),r?n&&n.field&&fM(e,r.agg.params,n):(a={groupby:e.fieldRef(t,"key"),pulse:tT(o.output)},n&&n.field&&fM(e,a,n),r={agg:i=e.add(_T(a)),ref:tT(r=e.add(ST({pulse:tT(i)})))},null!=u&&(s[u]=r)),r.ref},tuplesRef:function(){return tT(this.values)},extentRef:function(e,t){return dM(e,this,"extent","extent",t,!1)},domainRef:function(e,t){return dM(e,this,"domain","values",t,!1)},valuesRef:function(e,t,n){return dM(e,this,"vals","values",t,n||!0)},lookupRef:function(e,t){return dM(e,this,"lookup","tupleindex",t,!1)},indataRef:function(e,t){return dM(e,this,"indata","tupleindex",t,!0,!0)}};var gM='item.orient==="left"?-90:item.orient==="right"?90:0';function yM(e,t){var n=Ij(e=Object(ye.J)(e)?{text:e}:e,t.config.title),r=e.encode||{},i=r.group||{},a=i.name||void 0,o=i.interactive,s=i.style,u=[],c=tT(t.add(ST(null,[{}])));return u.push(function(e,t,n,r){var i={value:0},a={enter:{opacity:i},update:{opacity:{value:1}},exit:{opacity:i}};return vD(a,{text:e.text,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("color"),font:t("font"),fontSize:t("fontSize"),fontStyle:t("fontStyle"),fontWeight:t("fontWeight"),lineHeight:t("lineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),Bj({type:Mj,role:RD,style:yj,from:r,encode:a},n)}(e,n,function(e){var t=e.encode;return t&&t.title||Object(ye.p)({name:e.name,interactive:e.interactive,style:e.style},t)}(e),c)),e.subtitle&&u.push(function(e,t,n,r){var i={value:0},a={enter:{opacity:i},update:{opacity:{value:1}},exit:{opacity:i}};return vD(a,{text:e.subtitle,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("subtitleColor"),font:t("subtitleFont"),fontSize:t("subtitleFontSize"),fontStyle:t("subtitleFontStyle"),fontWeight:t("subtitleFontWeight"),lineHeight:t("subtitleLineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),Bj({type:Mj,role:PD,style:bj,from:r,encode:a},n)}(e,n,r.subtitle,c)),pM(Fj({role:ND,from:c,encode:function(e,t){var n={enter:{},update:{}};return vD(n,{orient:e("orient"),anchor:e("anchor"),align:{signal:Pj},angle:{signal:gM},limit:e("limit"),frame:e("frame"),offset:e("offset")||0,padding:e("subtitlePadding")}),gD(n,t,Sj)}(n,i),marks:u,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:a,interactive:o,style:s}),t)}function bM(e,t){var n=[];e.transform&&e.transform.forEach((function(e){n.push(Jj(e,t))})),e.on&&e.on.forEach((function(n){hM(n,t,e.name)})),t.addDataPipeline(e.name,function(e,t,n){var r,i,a,o,s,u=[],c=null,l=!1,f=!1;for(e.values?cT(e.values)||lT(e.format)?(u.push(wM(t,e)),u.push(c=xM())):u.push(c=xM({$ingest:e.values,$format:e.format})):e.url?lT(e.url)||lT(e.format)?(u.push(wM(t,e)),u.push(c=xM())):u.push(c=xM({$request:e.url,$format:e.format})):e.source&&(c=r=Object(ye.i)(e.source).map((function(e){return tT(t.getData(e).output)})),u.push(null)),i=0,a=n.length;i<a;++i)s=(o=n[i]).metadata,c||s.source||u.push(c=xM()),u.push(o),s.generates&&(f=!0),s.modifies&&!f&&(l=!0),s.source?c=o:s.changes&&(c=null);return r&&(a=r.length-1,u[0]=VT({derive:l,pulse:a?r:r[0]}),(l||a)&&u.splice(1,0,xM())),c||u.push(xM()),u.push(HT({})),u}(e,t,n))}function xM(e){var t=ST({},e);return t.metadata={source:!0},t}function wM(e,t){return IT({url:t.url?e.property(t.url):void 0,async:t.async?e.property(t.async):void 0,values:t.values?e.property(t.values):void 0,format:e.objectProperty(t.format)})}var _M=function(e){return e===oj||e===aj},kM=function(e,t,n){return cT(e)?TM(e.signal,t,n):"left"===e||e===aj?t:n},EM=function(e,t,n){return cT(e)?OM(e.signal,t,n):_M(e)?t:n},SM=function(e,t,n){return cT(e)?DM(e.signal,t,n):_M(e)?n:t},CM=function(e,t,n){return cT(e)?jM(e.signal,t,n):e===aj?{value:t}:{value:n}},AM=function(e,t,n){return cT(e)?MM(e.signal,t,n):"right"===e?{value:t}:{value:n}},OM=function(e,t,n){return FM("".concat(e," === '").concat(aj,"' || ").concat(e," === '").concat(oj,"'"),t,n)},DM=function(e,t,n){return FM("".concat(e," !== '").concat(aj,"' && ").concat(e," !== '").concat(oj,"'"),t,n)},TM=function(e,t,n){return NM("".concat(e," === 'left' || ").concat(e," === '").concat(aj,"'"),t,n)},jM=function(e,t,n){return NM("".concat(e," === '").concat(aj,"'"),t,n)},MM=function(e,t,n){return NM("".concat(e," === 'right'"),t,n)},FM=function(e,t,n){return t=null!=t?pD(t):t,n=null!=n?pD(n):n,IM(t)&&IM(n)?{signal:"".concat(e," ? (").concat(t=t?t.signal||Object(ye.Ba)(t.value):null,") : (").concat(n=n?n.signal||Object(ye.Ba)(n.value):null,")")}:[Object(ye.p)({test:e},t)].concat(n||[])},IM=function(e){return null==e||1===Object.keys(e).length},NM=function(e,t,n){return{signal:"".concat(e," ? (").concat(PM(t),") : (").concat(PM(n),")")}},RM=function(e,t,n,r,i){return{signal:(null!=r?"".concat(e," === 'left' ? (").concat(PM(r),") : "):"")+(null!=n?"".concat(e," === '").concat(oj,"' ? (").concat(PM(n),") : "):"")+(null!=i?"".concat(e," === 'right' ? (").concat(PM(i),") : "):"")+(null!=t?"".concat(e," === '").concat(aj,"' ? (").concat(PM(t),") : "):"")+"(null)"}},PM=function(e){return cT(e)?e.signal:null==e?null:Object(ye.Ba)(e)},BM=function(e,t){return 0===t?0:cT(e)?{signal:"(".concat(e.signal,") * ").concat(t)}:{value:e*t}},LM=function(e,t){var n=e.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+t.signal}:e};function zM(e,t,n,r){var i;if(t&&Object(ye.w)(t,e))return t[e];if(Object(ye.w)(n,e))return n[e];if(e.startsWith("title")){switch(e){case"titleColor":i="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":i=e[5].toLowerCase()+e.slice(6)}return r[gj][i]}if(e.startsWith("label")){switch(e){case"labelColor":i="fill";break;case"labelFont":case"labelFontSize":i=e[5].toLowerCase()+e.slice(6)}return r[vj][i]}return null}function UM(e){var t,n={},r=p(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(i)for(var a in i)n[a]=1}}catch(o){r.e(o)}finally{r.f()}return Object.keys(n)}function WM(e,t){return{scale:e.scale,range:t}}function VM(e,t,n,r,i){var a,o,s,u=Ij(e,t),c=e.orient,l=e.gridScale,f=kM(c,1,-1),d=function(e,t){if(1===t);else if(Object(ye.H)(e)){for(var n=e=Object(ye.p)({},e);null!=n.mult;){if(!Object(ye.H)(n.mult))return n.mult=cT(t)?{signal:"(".concat(n.mult,") * (").concat(t.signal,")")}:n.mult*t,e;n=n.mult=Object(ye.p)({},n.mult)}n.mult=t}else e=cT(t)?{signal:"(".concat(t.signal,") * (").concat(e||0,")")}:t*(e||0);return e}(e.offset,f),h={enter:a={opacity:Cj},update:s={opacity:Aj},exit:o={opacity:Cj}};vD(h,{stroke:u("gridColor"),strokeCap:u("gridCap"),strokeDash:u("gridDash"),strokeDashOffset:u("gridDashOffset"),strokeOpacity:u("gridOpacity"),strokeWidth:u("gridWidth")});var p={scale:e.scale,field:mj,band:i.band,extra:i.extra,offset:i.offset,round:u("tickRound")},m=EM(c,{signal:"height"},{signal:"width"}),v=l?{scale:l,range:0,mult:f,offset:d}:{value:0,offset:d},g=l?{scale:l,range:1,mult:f,offset:d}:Object(ye.p)(m,{mult:f,offset:d});return a.x=s.x=EM(c,p,v),a.y=s.y=SM(c,p,v),a.x2=s.x2=SM(c,g),a.y2=s.y2=EM(c,g),o.x=EM(c,p),o.y=SM(c,p),Bj({type:Tj,role:ED,key:mj,from:r,encode:h},n)}function GM(e,t,n,r,i){return{signal:'flush(range("'+e+'"), scale("'+e+'", datum.value), '+t+","+n+","+r+","+i+")"}}function qM(e,t,n,r,i,a){var o,s=Ij(e,t),u=e.orient,c=e.scale,l=kM(u,-1,1),f=dT(s("labelFlush")),d=dT(s("labelFlushOffset")),h=s("labelAlign"),p=s("labelBaseline"),m=0===f||!!f,v=pD(i);v.mult=l,v.offset=pD(s("labelPadding")||0),v.offset.mult=l;var g={scale:c,field:mj,band:.5,offset:function e(t,n){return n?t?Object(ye.H)(t)?Object.assign({},t,{offset:e(t.offset,n)}):{value:t,offset:n}:n:t}(a.offset,s("labelOffset"))},y=EM(u,m?GM(c,f,'"left"','"right"','"center"'):{value:"center"},AM(u,"left","right")),b=EM(u,CM(u,"bottom","top"),m?GM(c,f,'"top"','"bottom"','"middle"'):{value:"middle"}),x=GM(c,f,"-(".concat(d,")"),d,0);m=m&&d;var w={opacity:Cj,x:EM(u,g,v),y:SM(u,g,v)},_={enter:w,update:o={opacity:Aj,text:{field:fj},x:w.x,y:w.y,align:y,baseline:b},exit:{opacity:Cj,x:w.x,y:w.y}};vD(_,{dx:!h&&m?EM(u,x):null,dy:!p&&m?SM(u,x):null}),vD(_,{angle:s("labelAngle"),fill:s("labelColor"),fillOpacity:s("labelOpacity"),font:s("labelFont"),fontSize:s("labelFontSize"),fontWeight:s("labelFontWeight"),fontStyle:s("labelFontStyle"),limit:s("labelLimit"),lineHeight:s("labelLineHeight")},{align:h,baseline:p});var k=s("labelBound"),E=s("labelOverlap");return E=E||k?{separation:s("labelSeparation"),method:E,order:"datum.index",bound:k?{scale:c,orient:u,tolerance:k}:null}:void 0,o.align!==y&&(o.align=LM(o.align,y)),o.baseline!==b&&(o.baseline=LM(o.baseline,b)),Bj({type:Mj,role:SD,style:vj,key:mj,from:r,encode:_,overlap:E},n)}function HM(e,t,n,r){var i,a,o=Ij(e,t),s=e.orient,u=kM(s,-1,1),c={enter:i={opacity:Cj,anchor:pD(o("titleAnchor",null)),align:{signal:Pj}},update:a=Object(ye.p)({},i,{opacity:Aj,text:pD(e.title)}),exit:{opacity:Cj}},l={signal:'lerp(range("'.concat(e.scale,'"), ').concat(Rj(0,1,.5),")")};return a.x=EM(s,l),a.y=SM(s,l),i.angle=EM(s,Cj,BM(u,90)),i.baseline=EM(s,CM(s,oj,aj),{value:oj}),a.angle=i.angle,a.baseline=i.baseline,vD(c,{fill:o("titleColor"),fillOpacity:o("titleOpacity"),font:o("titleFont"),fontSize:o("titleFontSize"),fontStyle:o("titleFontStyle"),fontWeight:o("titleFontWeight"),limit:o("titleLimit"),lineHeight:o("titleLineHeight")},{align:o("titleAlign"),angle:o("titleAngle"),baseline:o("titleBaseline")}),function(e,t,n,r){var i=function(e,t){return null!=e?(n.update[t]=LM(pD(e),n.update[t]),!1):!yD(t,r)},a=i(e("titleX"),"x"),o=i(e("titleY"),"y");n.enter.auto=o===a?pD(o):EM(t,pD(o),pD(a))}(o,s,c,n),c.update.align=LM(c.update.align,i.align),c.update.angle=LM(c.update.angle,i.angle),c.update.baseline=LM(c.update.baseline,i.baseline),Bj({type:Mj,role:AD,style:gj,from:r,encode:c},n)}function XM(e,t){var n,r=function(e,t){var n,r,i,a=t.config,o=a.style,s=a.axis,u="band"===t.scaleType(e.scale)&&a.axisBand,c=e.orient;if(cT(c)){var l,f=UM([a.axisX,a.axisY]),d=UM([a.axisTop,a.axisBottom,a.axisLeft,a.axisRight]),h=p((n={},f));try{for(h.s();!(l=h.n()).done;)n[i=l.value]=EM(c,zM(i,a.axisX,s,o),zM(i,a.axisY,s,o))}catch(g){h.e(g)}finally{h.f()}var m,v=p((r={},d));try{for(v.s();!(m=v.n()).done;)r[i=m.value]=RM(c.signal,zM(i,a.axisTop,s,o),zM(i,a.axisBottom,s,o),zM(i,a.axisLeft,s,o),zM(i,a.axisRight,s,o))}catch(g){v.e(g)}finally{v.f()}}else n=c===aj||c===oj?a.axisX:a.axisY,r=a["axis"+c[0].toUpperCase()+c.slice(1)];return n||r||u?Object(ye.p)({},s,n,r,u):s}(e,t),i=e.encode||{},a=i.axis||{},o=a.name||void 0,s=a.interactive,u=a.style,c=Ij(e,r),l=function(e){var t,n,r=e("tickBand"),i=e("tickOffset");return r?r.signal?(t={signal:"(".concat(r.signal,") === 'extent' ? 1 : 0.5")},n={signal:"(".concat(r.signal,") === 'extent'")},Object(ye.H)(i)||(i={signal:"(".concat(r.signal,") === 'extent' ? 0 : ").concat(i)})):"extent"===r?(t=1,n=!0,i=0):(t=.5,n=!1):(t=e("bandPosition"),n=e("tickExtra")),{extra:n,band:t,offset:i}}(c),f={scale:e.scale,ticks:!!c("ticks"),labels:!!c("labels"),grid:!!c("grid"),domain:!!c("domain"),title:null!=e.title},d=tT(t.add(ST({},[f]))),h=tT(t.add(kT({scale:t.scaleRef(e.scale),extra:t.property(l.extra),count:t.objectProperty(e.tickCount),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)}))),m=[];return f.grid&&m.push(VM(e,r,i.grid,h,l)),f.ticks&&(n=c("tickSize"),m.push(function(e,t,n,r,i,a){var o,s,u,c=Ij(e,t),l=e.orient,f=kM(l,-1,1),d={enter:o={opacity:Cj},update:u={opacity:Aj},exit:s={opacity:Cj}};vD(d,{stroke:c("tickColor"),strokeCap:c("tickCap"),strokeDash:c("tickDash"),strokeDashOffset:c("tickDashOffset"),strokeOpacity:c("tickOpacity"),strokeWidth:c("tickWidth")});var h=pD(i);h.mult=f;var p={scale:e.scale,field:mj,band:a.band,extra:a.extra,offset:a.offset,round:c("tickRound")};return u.y=o.y=EM(l,Cj,p),u.y2=o.y2=EM(l,h),s.x=EM(l,p),u.x=o.x=SM(l,Cj,p),u.x2=o.x2=SM(l,h),s.y=SM(l,p),Bj({type:Tj,role:CD,key:mj,from:r,encode:d},n)}(e,r,i.ticks,h,n,l))),f.labels&&(n=f.ticks?n:0,m.push(qM(e,r,i.labels,h,n,l))),f.domain&&m.push(function(e,t,n,r){var i,a,o=Ij(e,t),s=e.orient,u={enter:i={opacity:Cj},update:a={opacity:Aj},exit:{opacity:Cj}};vD(u,{stroke:o("domainColor"),strokeCap:o("domainCap"),strokeDash:o("domainDash"),strokeDashOffset:o("domainDashOffset"),strokeWidth:o("domainWidth"),strokeOpacity:o("domainOpacity")});var c=WM(e,0),l=WM(e,1);return i.x=a.x=EM(s,c,Cj),i.x2=a.x2=EM(s,l),i.y=a.y=SM(s,c,Cj),i.y2=a.y2=SM(s,l),Bj({type:Tj,role:kD,from:r,encode:u},n)}(e,r,i.domain,d)),f.title&&m.push(HM(e,r,i.title,d)),pM(Fj({role:_D,from:d,encode:gD(function(e,t){var n={enter:{},update:{}};return vD(n,{orient:e("orient"),offset:e("offset")||0,position:fT(t.position,0),titlePadding:e("titlePadding"),minExtent:e("minExtent"),maxExtent:e("maxExtent"),range:{signal:'abs(span(range("'.concat(t.scale,'")))')},translate:e("translate"),format:t.format,formatType:t.formatType}),n}(c,e),a,Sj),marks:m,aria:c("aria"),description:c("description"),zindex:c("zindex"),name:o,interactive:s,style:u}),t)}function KM(e,t,n){var r=Object(ye.i)(e.signals),i=Object(ye.i)(e.scales);return n||r.forEach((function(e){return JD(e,t)})),Object(ye.i)(e.projections).forEach((function(e){return function(e,t){var n=t.config.projection||{},r={};for(var i in e)"name"!==i&&(r[i]=ij(e[i],i,t));for(var a in n)null==r[a]&&(r[a]=ij(n[a],a,t));t.addProjection(e.name,r)}(e,t)})),i.forEach((function(e){return function(e,t){var n=e.type||"linear";Hu(n)||Object(ye.o)("Unrecognized scale type: "+Object(ye.Ba)(n)),t.addScale(e.name,{type:n,domain:void 0})}(e,t)})),Object(ye.i)(e.data).forEach((function(e){return bM(e,t)})),i.forEach((function(e){return ZT(e,t)})),(n||r).forEach((function(e){return function(e,t){var n=t.getSignal(e.name),r=e.update;e.init&&(r?Object(ye.o)("Signals can not include both init and update expressions."):(r=e.init,n.initonly=!0)),r&&(r=PA(r,t),n.update=r.$expr,n.params=r.$params),e.on&&e.on.forEach((function(e){return xT(e,t,n.id)}))}(e,t)})),Object(ye.i)(e.axes).forEach((function(e){return XM(e,t)})),Object(ye.i)(e.marks).forEach((function(e){return pM(e,t)})),Object(ye.i)(e.legends).forEach((function(e){return mM(e,t)})),e.title&&yM(e.title,t),t.parseLambdas(),t}var YM=function(e){return gD({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e)};function $M(e,t){var n=t.config,r=tT(t.root=t.add(eT())),i=function(e,t){var n=function(n){return fT(e[n],t[n])},r=[JM("background",n("background")),JM("autosize",function(e){return Object(ye.H)(e)?e:{type:e||"pad"}}(n("autosize"))),JM("padding",function(e){return Object(ye.H)(e)?e.signal?e:{top:dD(e.top),bottom:dD(e.bottom),left:dD(e.left),right:dD(e.right)}:hD(dD(e))}(n("padding"))),JM("width",n("width")||0),JM("height",n("height")||0)],i=r.reduce((function(e,t){return e[t.name]=t,e}),{}),a={};return Object(ye.i)(e.signals).forEach((function(e){Object(ye.w)(i,e.name)?e=Object(ye.p)(i[e.name],e):r.push(e),a[e.name]=e})),Object(ye.i)(t.signals).forEach((function(e){Object(ye.w)(a,e.name)||Object(ye.w)(i,e.name)||r.push(e)})),r}(e,n);i.forEach((function(e){return JD(e,t)})),t.description=e.description||n.description,t.eventConfig=n.events,t.legends=t.objectProperty(n.legend&&n.legend.layout),t.locale=n.locale;var a=t.add(ST()),o=t.add(OT(GD(YM(e.encode),Oj,xD,e.style,t,{pulse:tT(a)}))),s=t.add(KT({layout:t.objectProperty(e.layout),legends:t.legends,autosize:t.signalRef("autosize"),mark:r,pulse:tT(o)}));t.operators.pop(),t.pushState(tT(o),tT(s),null),KM(e,t,i),t.operators.push(s);var u=t.add(ET({mark:r,pulse:tT(s)}));return u=t.add(GT({pulse:tT(u)})),u=t.add(HT({pulse:tT(u)})),t.addData("root",new cM(t,a,a,u)),t}function JM(e,t){return t&&t.signal?{name:e,update:t.signal}:{name:e,value:t}}function ZM(e,t){this.config=e||{},this.options=t||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function QM(e){this.config=e.config,this.options=e.options,this.legends=e.legends,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}function eF(e){return(Object(ye.B)(e)?function(e){for(var t=e.length,n="[",r=0;r<t;++r){var i=e[r];n+=(r>0?",":"")+(Object(ye.H)(i)?i.signal||eF(i):Object(ye.Ba)(i))}return n+"]"}:function(e){var t,n,r="{",i=0;for(t in e)n=e[t],r+=(++i>1?",":"")+Object(ye.Ba)(t)+":"+(Object(ye.H)(n)?n.signal||eF(n):Object(ye.Ba)(n));return r+"}"})(e)}function tF(e,t,n){return Object(ye.H)(e)||Object(ye.o)("Input Vega specification must be an object."),$M(e,new ZM(t=Object(ye.P)({description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:"#4c78a8"},area:{fill:"#4c78a8"},image:null,line:{stroke:"#4c78a8",strokeWidth:2},path:{stroke:"#4c78a8"},rect:{fill:"#4c78a8"},rule:{stroke:"#000"},shape:{stroke:"#4c78a8"},symbol:{fill:"#4c78a8",size:64},text:{fill:"#000",font:"sans-serif",fontSize:11},trail:{fill:"#4c78a8",size:2},style:{"guide-label":{fill:"#000",font:"sans-serif",fontSize:10},"guide-title":{fill:"#000",font:"sans-serif",fontSize:11,fontWeight:"bold"},"group-title":{fill:"#000",font:"sans-serif",fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:"#000",font:"sans-serif",fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:"#ddd"}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:"#888",grid:!1,gridWidth:1,gridColor:"#ddd",labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:"#888",tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:"#ddd",gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:"#888",titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}},t,e.config),n)).toRuntime()}ZM.prototype=QM.prototype={parse:function(e){return KM(e,this)},fork:function(){return new QM(this)},isSubscope:function(){return this._subid>0},toRuntime:function(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id:function(){return(this._subid?this._subid+":":0)+this._id++},add:function(e){return this.operators.push(e),e.id=this.id(),e.refs&&(e.refs.forEach((function(t){t.$ref=e.id})),e.refs=null),e},proxy:function(e){var t=e instanceof ZD?tT(e):e;return this.add(WT({value:t}))},addStream:function(e){return this.streams.push(e),e.id=this.id(),e},addUpdate:function(e){return this.updates.push(e),e},finish:function(){var e,t;for(e in this.root&&(this.root.root=!0),this.signals)this.signals[e].signal=e;for(e in this.scales)this.scales[e].scale=e;function n(e,t,n){var r;e&&((r=e.data||(e.data={}))[t]||(r[t]=[])).push(n)}for(e in this.data)for(var r in n((t=this.data[e]).input,e,"input"),n(t.output,e,"output"),n(t.values,e,"values"),t.index)n(t.index[r],e,"index:"+r);return this},pushState:function(e,t,n){this._encode.push(tT(this.add(HT({pulse:e})))),this._parent.push(t),this._lookup.push(n?tT(this.proxy(n)):null),this._markpath.push(-1)},popState:function(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},parent:function(){return Object(ye.W)(this._parent)},encode:function(){return Object(ye.W)(this._encode)},lookup:function(){return Object(ye.W)(this._lookup)},markpath:function(){var e=this._markpath;return++e[e.length-1]},fieldRef:function(e,t){if(Object(ye.J)(e))return nT(e,t);e.signal||Object(ye.o)("Unsupported field reference: "+Object(ye.Ba)(e));var n=e.signal,r=this.field[n];if(!r){var i={name:this.signalRef(n)};t&&(i.as=t),this.field[n]=r=tT(this.add(jT(i)))}return r},compareRef:function(e){var t=this,n=!1,r=function(e){return cT(e)?(n=!0,t.signalRef(e.signal)):function(e){return e&&e.expr}(e)?(n=!0,t.exprRef(e.expr)):e},i=Object(ye.i)(e.field).map(r),a=Object(ye.i)(e.order).map(r);return n?tT(this.add(CT({fields:i,orders:a}))):iT(i,a)},keyRef:function(e,t){var n=!1,r=this.signals;return e=Object(ye.i)(e).map((function(e){return cT(e)?(n=!0,tT(r[e.signal])):e})),n?tT(this.add(MT({fields:e,flat:t}))):function(e,t){var n={$key:e};return t&&(n.$flat=!0),n}(e,t)},sortRef:function(e){if(!e)return e;var t=oT(e.op,e.field),n=e.order||"ascending";return n.signal?tT(this.add(CT({fields:t,orders:this.signalRef(n.signal)}))):iT(t,n)},event:function(e,t){var n=e+":"+t;if(!this.events[n]){var r=this.id();this.streams.push({id:r,source:e,type:t}),this.events[n]=r}return this.events[n]},hasOwnSignal:function(e){return Object(ye.w)(this.signals,e)},addSignal:function(e,t){this.hasOwnSignal(e)&&Object(ye.o)("Duplicate signal name: "+Object(ye.Ba)(e));var n=t instanceof ZD?t:this.add(eT(t));return this.signals[e]=n},getSignal:function(e){return this.signals[e]||Object(ye.o)("Unrecognized signal name: "+Object(ye.Ba)(e)),this.signals[e]},signalRef:function(e){return this.signals[e]?tT(this.signals[e]):(Object(ye.w)(this.lambdas,e)||(this.lambdas[e]=this.add(eT(null))),tT(this.lambdas[e]))},parseLambdas:function(){for(var e=Object.keys(this.lambdas),t=0,n=e.length;t<n;++t){var r=e[t],i=PA(r,this),a=this.lambdas[r];a.params=i.$params,a.update=i.$expr}},property:function(e){return e&&e.signal?this.signalRef(e.signal):e},objectProperty:function(e){return e&&Object(ye.H)(e)?this.signalRef(e.signal||eF(e)):e},exprRef:function(e,t){var n={expr:PA(e,this)};return t&&(n.expr.$name=t),tT(this.add(DT(n)))},addBinding:function(e,t){this.bindings||Object(ye.o)("Nested signals do not support binding: "+Object(ye.Ba)(e)),this.bindings.push(Object(ye.p)({signal:e},t))},addScaleProj:function(e,t){Object(ye.w)(this.scales,e)&&Object(ye.o)("Duplicate scale or projection name: "+Object(ye.Ba)(e)),this.scales[e]=this.add(t)},addScale:function(e,t){this.addScaleProj(e,qT(t))},addProjection:function(e,t){this.addScaleProj(e,UT(t))},getScale:function(e){return this.scales[e]||Object(ye.o)("Unrecognized scale name: "+Object(ye.Ba)(e)),this.scales[e]},scaleRef:function(e){return tT(this.getScale(e))},scaleType:function(e){return this.getScale(e).params.type},projectionRef:function(e){return this.scaleRef(e)},projectionType:function(e){return this.scaleType(e)},addData:function(e,t){return Object(ye.w)(this.data,e)&&Object(ye.o)("Duplicate data set name: "+Object(ye.Ba)(e)),this.data[e]=t},getData:function(e){return this.data[e]||Object(ye.o)("Undefined data set name: "+Object(ye.Ba)(e)),this.data[e]},addDataPipeline:function(e,t){return Object(ye.w)(this.data,e)&&Object(ye.o)("Duplicate data set name: "+Object(ye.Ba)(e)),this.addData(e,cM.fromEntries(this,t))}};var nF,rF,iF,aF,oF,sF="Property",uF="ArrayExpression",cF="BinaryExpression",lF="CallExpression",fF="ConditionalExpression",dF="LogicalExpression",hF="MemberExpression",pF="ObjectExpression",mF="UnaryExpression";function vF(e){this.type=e}vF.prototype.visit=function(e){var t,n,r;if(e(this))return 1;for(n=0,r=(t=function(e){switch(e.type){case uF:return e.elements;case cF:case dF:return[e.left,e.right];case lF:return[e.callee].concat(e.arguments);case fF:return[e.test,e.consequent,e.alternate];case hF:return[e.object,e.property];case pF:return e.properties;case sF:return[e.key,e.value];case mF:return[e.argument];default:return[]}}(this)).length;n<r;++n)if(t[n].visit(e))return 1};var gF=1,yF=2,bF=3,xF=4,wF=5,_F=6,kF=7,EF=8;(nF={})[gF]="Boolean",nF[yF]="<end>",nF[bF]="Identifier",nF[xF]="Keyword",nF[wF]="Null",nF[_F]="Numeric",nF[kF]="Punctuator",nF[EF]="String",nF[9]="RegularExpression";var SF="ArrayExpression",CF="BinaryExpression",AF="CallExpression",OF="ConditionalExpression",DF="Identifier",TF="Literal",jF="LogicalExpression",MF="MemberExpression",FF="ObjectExpression",IF="Property",NF="UnaryExpression",RF="Unexpected token %0",PF="Unexpected number",BF="Unexpected string",LF="Unexpected identifier",zF="Unexpected reserved word",UF="Unexpected end of input",WF="Invalid regular expression",VF="Invalid regular expression: missing /",GF="Octal literals are not allowed in strict mode.",qF="Duplicate data property in object literal not allowed in strict mode",HF="ILLEGAL",XF="Disabled.",KF=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),YF=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function $F(e,t){if(!e)throw new Error("ASSERT: "+t)}function JF(e){return e>=48&&e<=57}function ZF(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function QF(e){return"01234567".indexOf(e)>=0}function eI(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function tI(e){return 10===e||13===e||8232===e||8233===e}function nI(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||e>=128&&KF.test(String.fromCharCode(e))}function rI(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||e>=128&&YF.test(String.fromCharCode(e))}var iI={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function aI(){for(;iF<aF;){var e=rF.charCodeAt(iF);if(!eI(e)&&!tI(e))break;++iF}}function oI(e){var t,n,r,i=0;for(n="u"===e?4:2,t=0;t<n;++t)iF<aF&&ZF(rF[iF])?(r=rF[iF++],i=16*i+"0123456789abcdef".indexOf(r.toLowerCase())):_I({},RF,HF);return String.fromCharCode(i)}function sI(){var e,t,n,r;for(t=0,"}"===(e=rF[iF])&&_I({},RF,HF);iF<aF&&ZF(e=rF[iF++]);)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||"}"!==e)&&_I({},RF,HF),t<=65535?String.fromCharCode(t):(n=55296+(t-65536>>10),r=56320+(t-65536&1023),String.fromCharCode(n,r))}function uI(){var e,t;for(e=rF.charCodeAt(iF++),t=String.fromCharCode(e),92===e&&(117!==rF.charCodeAt(iF)&&_I({},RF,HF),++iF,(e=oI("u"))&&"\\"!==e&&nI(e.charCodeAt(0))||_I({},RF,HF),t=e);iF<aF&&rI(e=rF.charCodeAt(iF));)++iF,t+=String.fromCharCode(e),92===e&&(t=t.substr(0,t.length-1),117!==rF.charCodeAt(iF)&&_I({},RF,HF),++iF,(e=oI("u"))&&"\\"!==e&&rI(e.charCodeAt(0))||_I({},RF,HF),t+=e);return t}function cI(){var e,t;return e=iF,{type:1===(t=92===rF.charCodeAt(iF)?uI():function(){var e,t;for(e=iF++;iF<aF;){if(92===(t=rF.charCodeAt(iF)))return iF=e,uI();if(!rI(t))break;++iF}return rF.slice(e,iF)}()).length?bF:iI.hasOwnProperty(t)?xF:"null"===t?wF:"true"===t||"false"===t?gF:bF,value:t,start:e,end:iF}}function lI(){var e,t,n,r,i=iF,a=rF.charCodeAt(iF),o=rF[iF];switch(a){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++iF,{type:kF,value:String.fromCharCode(a),start:i,end:iF};default:if(61===(e=rF.charCodeAt(iF+1)))switch(a){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return iF+=2,{type:kF,value:String.fromCharCode(a)+String.fromCharCode(e),start:i,end:iF};case 33:case 61:return iF+=2,61===rF.charCodeAt(iF)&&++iF,{type:kF,value:rF.slice(i,iF),start:i,end:iF}}}return">>>="===(r=rF.substr(iF,4))?{type:kF,value:r,start:i,end:iF+=4}:">>>"===(n=r.substr(0,3))||"<<="===n||">>="===n?{type:kF,value:n,start:i,end:iF+=3}:o===(t=n.substr(0,2))[1]&&"+-<>&|".indexOf(o)>=0||"=>"===t?{type:kF,value:t,start:i,end:iF+=2}:("//"===t&&_I({},RF,HF),"<>=!+-*%&|^/".indexOf(o)>=0?{type:kF,value:o,start:i,end:++iF}:void _I({},RF,HF))}function fI(){var e,t,n;if($F(JF((n=rF[iF]).charCodeAt(0))||"."===n,"Numeric literal must start with a decimal digit or a decimal point"),t=iF,e="","."!==n){if(e=rF[iF++],n=rF[iF],"0"===e){if("x"===n||"X"===n)return++iF,function(e){for(var t="";iF<aF&&ZF(rF[iF]);)t+=rF[iF++];return 0===t.length&&_I({},RF,HF),nI(rF.charCodeAt(iF))&&_I({},RF,HF),{type:_F,value:parseInt("0x"+t,16),start:e,end:iF}}(t);if(QF(n))return function(e){for(var t="0"+rF[iF++];iF<aF&&QF(rF[iF]);)t+=rF[iF++];return(nI(rF.charCodeAt(iF))||JF(rF.charCodeAt(iF)))&&_I({},RF,HF),{type:_F,value:parseInt(t,8),octal:!0,start:e,end:iF}}(t);n&&JF(n.charCodeAt(0))&&_I({},RF,HF)}for(;JF(rF.charCodeAt(iF));)e+=rF[iF++];n=rF[iF]}if("."===n){for(e+=rF[iF++];JF(rF.charCodeAt(iF));)e+=rF[iF++];n=rF[iF]}if("e"===n||"E"===n)if(e+=rF[iF++],"+"!==(n=rF[iF])&&"-"!==n||(e+=rF[iF++]),JF(rF.charCodeAt(iF)))for(;JF(rF.charCodeAt(iF));)e+=rF[iF++];else _I({},RF,HF);return nI(rF.charCodeAt(iF))&&_I({},RF,HF),{type:_F,value:parseFloat(e),start:t,end:iF}}function dI(){var e,t,n,r;return oF=null,aI(),e=iF,t=function(){var e,t,n,r;for($F("/"===(e=rF[iF]),"Regular expression literal must start with a slash"),t=rF[iF++],n=!1,r=!1;iF<aF;)if(t+=e=rF[iF++],"\\"===e)tI((e=rF[iF++]).charCodeAt(0))&&_I({},VF),t+=e;else if(tI(e.charCodeAt(0)))_I({},VF);else if(n)"]"===e&&(n=!1);else{if("/"===e){r=!0;break}"["===e&&(n=!0)}return r||_I({},VF),{value:t.substr(1,t.length-2),literal:t}}(),n=function(){var e,t,n;for(t="",n="";iF<aF&&rI((e=rF[iF]).charCodeAt(0));)++iF,"\\"===e&&iF<aF?_I({},RF,HF):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&_I({},WF,n),{value:n,literal:t}}(),r=function(e,t){var n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,(function(e,t){if(parseInt(t,16)<=1114111)return"x";_I({},WF)})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch(e){_I({},WF)}try{return new RegExp(e,t)}catch(e){return null}}(t.value,n.value),{literal:t.literal+n.literal,value:r,regex:{pattern:t.value,flags:n.value},start:e,end:iF}}function hI(){if(aI(),iF>=aF)return{type:yF,start:iF,end:iF};var e=rF.charCodeAt(iF);return nI(e)?cI():40===e||41===e||59===e?lI():39===e||34===e?function(){var e,t,n,r,i="",a=!1;for($F("'"===(e=rF[iF])||'"'===e,"String literal must starts with a quote"),t=iF,++iF;iF<aF;){if((n=rF[iF++])===e){e="";break}if("\\"===n)if((n=rF[iF++])&&tI(n.charCodeAt(0)))"\r"===n&&"\n"===rF[iF]&&++iF;else switch(n){case"u":case"x":"{"===rF[iF]?(++iF,i+=sI()):i+=oI(n);break;case"n":i+="\n";break;case"r":i+="\r";break;case"t":i+="\t";break;case"b":i+="\b";break;case"f":i+="\f";break;case"v":i+="\v";break;default:QF(n)?(0!==(r="01234567".indexOf(n))&&(a=!0),iF<aF&&QF(rF[iF])&&(a=!0,r=8*r+"01234567".indexOf(rF[iF++]),"0123".indexOf(n)>=0&&iF<aF&&QF(rF[iF])&&(r=8*r+"01234567".indexOf(rF[iF++]))),i+=String.fromCharCode(r)):i+=n}else{if(tI(n.charCodeAt(0)))break;i+=n}}return""!==e&&_I({},RF,HF),{type:EF,value:i,octal:a,start:t,end:iF}}():46===e?JF(rF.charCodeAt(iF+1))?fI():lI():JF(e)?fI():lI()}function pI(){var e=oF;return iF=e.end,oF=hI(),iF=e.end,e}function mI(){var e=iF;oF=hI(),iF=e}function vI(e,t,n){var r=new vF("||"===e||"&&"===e?jF:CF);return r.operator=e,r.left=t,r.right=n,r}function gI(e,t){var n=new vF(AF);return n.callee=e,n.arguments=t,n}function yI(e){var t=new vF(DF);return t.name=e,t}function bI(e){var t=new vF(TF);return t.value=e.value,t.raw=rF.slice(e.start,e.end),e.regex&&("//"===t.raw&&(t.raw="/(?:)/"),t.regex=e.regex),t}function xI(e,t,n){var r=new vF(MF);return r.computed="["===e,r.object=t,r.property=n,r.computed||(n.member=!0),r}function wI(e,t,n){var r=new vF(IF);return r.key=t,r.value=n,r.kind=e,r}function _I(e,t){var n,r=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,(function(e,t){return $F(t<r.length,"Message reference must be in range"),r[t]}));throw(n=new Error(i)).index=iF,n.description=i,n}function kI(e){e.type===yF&&_I(e,UF),e.type===_F&&_I(e,PF),e.type===EF&&_I(e,BF),e.type===bF&&_I(e,LF),e.type===xF&&_I(e,zF),_I(e,RF,e.value)}function EI(e){var t=pI();t.type===kF&&t.value===e||kI(t)}function SI(e){return oF.type===kF&&oF.value===e}function CI(e){return oF.type===xF&&oF.value===e}function AI(){var e=[];for(iF=oF.start,EI("[");!SI("]");)SI(",")?(pI(),e.push(null)):(e.push(LI()),SI("]")||EI(","));return pI(),function(e){var t=new vF(SF);return t.elements=e,t}(e)}function OI(){iF=oF.start;var e=pI();return e.type===EF||e.type===_F?(e.octal&&_I(e,GF),bI(e)):yI(e.value)}function DI(){var e,t,n;return iF=oF.start,(e=oF).type===bF?(n=OI(),EI(":"),wI("init",n,LI())):e.type!==yF&&e.type!==kF?(t=OI(),EI(":"),wI("init",t,LI())):void kI(e)}function TI(){var e,t,n=[],r={},i=String;for(iF=oF.start,EI("{");!SI("}");)t="$"+((e=DI()).key.type===DF?e.key.name:i(e.key.value)),Object.prototype.hasOwnProperty.call(r,t)?_I({},qF):r[t]=!0,n.push(e),SI("}")||EI(",");return EI("}"),function(e){var t=new vF(FF);return t.properties=e,t}(n)}var jI={if:1};function MI(){var e,t,n;if(SI("("))return function(){EI("(");var e=zI();return EI(")"),e}();if(SI("["))return AI();if(SI("{"))return TI();if(e=oF.type,iF=oF.start,e===bF||jI[oF.value])n=yI(pI().value);else if(e===EF||e===_F)oF.octal&&_I(oF,GF),n=bI(pI());else{if(e===xF)throw new Error(XF);e===gF?((t=pI()).value="true"===t.value,n=bI(t)):e===wF?((t=pI()).value=null,n=bI(t)):SI("/")||SI("/=")?(n=bI(dI()),mI()):kI(pI())}return n}function FI(){var e=[];if(EI("("),!SI(")"))for(;iF<aF&&(e.push(LI()),!SI(")"));)EI(",");return EI(")"),e}function II(){iF=oF.start;var e=pI();return function(e){return e.type===bF||e.type===xF||e.type===gF||e.type===wF}(e)||kI(e),yI(e.value)}function NI(){EI("[");var e=zI();return EI("]"),e}function RI(){var e=function(){var e;for(e=MI();;)if(SI("."))EI("."),e=xI(".",e,II());else if(SI("("))e=gI(e,FI());else{if(!SI("["))break;e=xI("[",e,NI())}return e}();if(oF.type===kF&&(SI("++")||SI("--")))throw new Error(XF);return e}function PI(){var e,t;if(oF.type!==kF&&oF.type!==xF)t=RI();else{if(SI("++")||SI("--"))throw new Error(XF);if(SI("+")||SI("-")||SI("~")||SI("!"))e=pI(),t=PI(),t=function(e,t){var n=new vF(NF);return n.operator=e,n.argument=t,n.prefix=!0,n}(e.value,t);else{if(CI("delete")||CI("void")||CI("typeof"))throw new Error(XF);t=RI()}}return t}function BI(e){var t=0;if(e.type!==kF&&e.type!==xF)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11}return t}function LI(){var e,t;return e=function(){var e,t,n,r,i,a,o,s,u,c;if(e=oF,u=PI(),0===(i=BI(r=oF)))return u;for(r.prec=i,pI(),t=[e,oF],a=[u,r,o=PI()];(i=BI(oF))>0;){for(;a.length>2&&i<=a[a.length-2].prec;)o=a.pop(),s=a.pop().value,u=a.pop(),t.pop(),n=vI(s,u,o),a.push(n);(r=pI()).prec=i,a.push(r),t.push(oF),n=PI(),a.push(n)}for(n=a[c=a.length-1],t.pop();c>1;)t.pop(),n=vI(a[c-1].value,a[c-2],n),c-=2;return n}(),SI("?")&&(pI(),t=LI(),EI(":"),e=function(e,t,n){var r=new vF(OF);return r.test=e,r.consequent=t,r.alternate=n,r}(e,t,LI())),e}function zI(){var e=LI();if(SI(","))throw new Error(XF);return e}function UI(e){iF=0,aF=(rF=e).length,oF=null,mI();var t=zI();if(oF.type!==yF)throw new Error("Unexpect token after expression.");return t}var WI={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function VI(e){function t(t,n,r){return function(i){return function(t,n,r,i){var a=e(n[0]);return r&&(a=r+"("+a+")",0===r.lastIndexOf("new ",0)&&(a="("+a+")")),a+"."+t+(i<0?"":0===i?"()":"("+n.slice(1).map(e).join(",")+")")}(t,i,n,r)}}var n="new Date";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(t){t.length<3&&Object(ye.o)("Missing arguments to clamp function."),t.length>3&&Object(ye.o)("Too many arguments to clamp function.");var n=t.map(e);return"Math.max("+n[1]+", Math.min("+n[2]+","+n[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:n,date:t("getDate",n,0),day:t("getDay",n,0),year:t("getFullYear",n,0),month:t("getMonth",n,0),hours:t("getHours",n,0),minutes:t("getMinutes",n,0),seconds:t("getSeconds",n,0),milliseconds:t("getMilliseconds",n,0),time:t("getTime",n,0),timezoneoffset:t("getTimezoneOffset",n,0),utcdate:t("getUTCDate",n,0),utcday:t("getUTCDay",n,0),utcyear:t("getUTCFullYear",n,0),utcmonth:t("getUTCMonth",n,0),utchours:t("getUTCHours",n,0),utcminutes:t("getUTCMinutes",n,0),utcseconds:t("getUTCSeconds",n,0),utcmilliseconds:t("getUTCMilliseconds",n,0),length:t("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:t("toUpperCase","String",0),lower:t("toLowerCase","String",0),substring:t("substring","String"),split:t("split","String"),trim:t("trim","String",0),regexp:"RegExp",test:t("test","RegExp"),if:function(t){t.length<3&&Object(ye.o)("Missing arguments to if function."),t.length>3&&Object(ye.o)("Too many arguments to if function.");var n=t.map(e);return"("+n[0]+"?"+n[1]+":"+n[2]+")"}}}function GI(e){var t=(e=e||{}).allowed?Object(ye.Fa)(e.allowed):{},n=e.forbidden?Object(ye.Fa)(e.forbidden):{},r=e.constants||WI,i=(e.functions||VI)(f),a=e.globalvar,o=e.fieldvar,s=Object(ye.E)(a)?a:function(e){return"".concat(a,'["').concat(e,'"]')},u={},c={},l=0;function f(e){if(Object(ye.J)(e))return e;var t=d[e.type];return null==t&&Object(ye.o)("Unsupported type: "+e.type),t(e)}var d={Literal:function(e){return e.raw},Identifier:function(e){var i=e.name;return l>0?i:Object(ye.w)(n,i)?Object(ye.o)("Illegal identifier: "+i):Object(ye.w)(r,i)?r[i]:Object(ye.w)(t,i)?i:(u[i]=1,s(i))},MemberExpression:function(e){var t=!e.computed,n=f(e.object);t&&(l+=1);var r=f(e.property);return n===o&&(c[function(e){var t=e&&e.length-1;return t&&('"'===e[0]&&'"'===e[t]||"'"===e[0]&&"'"===e[t])?e.slice(1,-1):e}(r)]=1),t&&(l-=1),n+(t?"."+r:"["+r+"]")},CallExpression:function(e){"Identifier"!==e.callee.type&&Object(ye.o)("Illegal callee type: "+e.callee.type);var t=e.callee.name,n=e.arguments,r=Object(ye.w)(i,t)&&i[t];return r||Object(ye.o)("Unrecognized function: "+t),Object(ye.E)(r)?r(n):r+"("+n.map(f).join(",")+")"},ArrayExpression:function(e){return"["+e.elements.map(f).join(",")+"]"},BinaryExpression:function(e){return"("+f(e.left)+" "+e.operator+" "+f(e.right)+")"},UnaryExpression:function(e){return"("+e.operator+f(e.argument)+")"},ConditionalExpression:function(e){return"("+f(e.test)+"?"+f(e.consequent)+":"+f(e.alternate)+")"},LogicalExpression:function(e){return"("+f(e.left)+e.operator+f(e.right)+")"},ObjectExpression:function(e){return"{"+e.properties.map(f).join(",")+"}"},Property:function(e){l+=1;var t=f(e.key);return l-=1,t+":"+f(e.value)}};function h(e){var t={code:f(e),globals:Object.keys(u),fields:Object.keys(c)};return u={},c={},t}return h.functions=i,h.constants=r,h}var qI,HI,XI="view",KI="[",YI="]",$I="{",JI="}",ZI=":",QI=",",eN="@",tN=">",nN=/[[\]{}]/,rN={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};function iN(e,t,n){return qI=t||XI,HI=n||rN,oN(e.trim()).map(sN)}function aN(e,t,n,r,i){for(var a,o=e.length,s=0;t<o;++t){if(a=e[t],!s&&a===n)return t;i&&i.indexOf(a)>=0?--s:r&&r.indexOf(a)>=0&&++s}return t}function oN(e){for(var t=[],n=e.length,r=0,i=0;i<n;)i=aN(e,i,QI,KI+$I,YI+JI),t.push(e.substring(r,i).trim()),r=++i;if(0===t.length)throw"Empty event selector: "+e;return t}function sN(e){return"["===e[0]?function(e){var t,n=e.length,r=1;if((r=aN(e,r,YI,KI,YI))===n)throw"Empty between selector: "+e;if(2!==(t=oN(e.substring(1,r))).length)throw"Between selector must have two elements: "+e;if((e=e.slice(r+1).trim())[0]!==tN)throw"Expected '>' after between selector: "+e;t=t.map(sN);var i=sN(e.slice(1).trim());return i.between?{between:t,stream:i}:(i.between=t,i)}(e):function(e){var t,n,r={source:qI},i=[],a=[0,0],o=0,s=0,u=e.length,c=0;if(e[u-1]===JI){if(!((c=e.lastIndexOf($I))>=0))throw"Unmatched right brace: "+e;try{a=function(e){var t=e.split(QI);if(!e.length||t.length>2)throw e;return t.map((function(t){var n=+t;if(n!=n)throw e;return n}))}(e.substring(c+1,u-1))}catch(r){throw"Invalid throttle specification: "+e}u=(e=e.slice(0,c).trim()).length,c=0}if(!u)throw e;if(e[0]===eN&&(o=++c),(t=aN(e,c,ZI))<u&&(i.push(e.substring(s,t).trim()),s=c=++t),(c=aN(e,c,KI))===u)i.push(e.substring(s,u).trim());else if(i.push(e.substring(s,c).trim()),n=[],(s=++c)===u)throw"Unmatched left bracket: "+e;for(;c<u;){if((c=aN(e,c,YI))===u)throw"Unmatched left bracket: "+e;if(n.push(e.substring(s,c).trim()),c<u-1&&e[++c]!==KI)throw"Expected left bracket: "+e;s=++c}if(!(u=i.length)||nN.test(i[u-1]))throw"Invalid event selector: "+e;return u>1?(r.type=i[1],o?r.markname=i[0].slice(1):function(e){return HI[e]}(i[0])?r.marktype=i[0]:r.source=i[0]):r.type=i[0],"!"===r.type.slice(-1)&&(r.consume=!0,r.type=r.type.slice(0,-1)),null!=n&&(r.filter=n),a[0]&&(r.throttle=a[0]),a[1]&&(r.debounce=a[1]),r}(e)}var uN="5.20.0";Object(ye.p)(st,E,C,A,O,D,j,T,M,F,I,N);var cN=uN,lN=n(245),fN=function(e,t,n){return e.fields=t||[],e.fname=n,e},dN=function(e){return 1===e.length?hN(e[0]):pN(e)},hN=function(e){return function(t){return t[e]}},pN=function(e){var t=e.length;return function(n){for(var r=0;r<t;++r)n=n[e[r]];return n}},mN=function(e){throw Error(e)},vN=function(e){var t,n,r,i=[],a=null,o=0,s=e.length,u="";function c(){i.push(u+e.substring(t,n)),u="",t=n+1}for(e+="",t=n=0;n<s;++n)if("\\"===(r=e[n]))u+=e.substring(t,n),u+=e.substring(++n,++n),t=n;else if(r===a)c(),a=null,o=-1;else{if(a)continue;t===o&&'"'===r||t===o&&"'"===r?(t=n+1,a=r):"."!==r||o?"["===r?(n>t&&c(),o=t=n+1):"]"===r&&(o||mN("Access path missing open bracket: "+e),o>0&&c(),o=0,t=n+1):n>t?c():t=n+1}return o&&mN("Access path missing closing bracket: "+e),a&&mN("Access path missing closing quote: "+e),n>t&&(n++,c()),i},gN=function(e,t,n){var r=vN(e);return e=1===r.length?r[0]:e,fN((n&&n.get||dN)(r),[e],t||e)},yN=[],bN=(gN("id"),fN((function(e){return e}),yN,"identity"));function xN(e,t,n){var r=[t].concat([].slice.call(n));console[e].apply(console,r)}fN((function(){return 0}),yN,"zero"),fN((function(){return 1}),yN,"one"),fN((function(){return!0}),yN,"true"),fN((function(){return!1}),yN,"false");var wN=Array.isArray,_N=function(e){return e===Object(e)},kN=function(e){return"__proto__"!==e};function EN(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((function(e,t){for(var n in t)if("signals"===n)e.signals=CN(e.signals,t.signals);else{var r="legend"===n?{layout:1}:"style"===n||null;SN(e,n,t[n],r)}return e}),{})}function SN(e,t,n,r){var i,a;if(kN(t))if(_N(n)&&!wN(n))for(i in a=_N(e[t])?e[t]:e[t]={},n)r&&(!0===r||r[i])?SN(a,i,n[i]):kN(i)&&(a[i]=n[i]);else e[t]=n}function CN(e,t){if(null==e)return t;var n={},r=[];function i(e){n[e.name]||(n[e.name]=1,r.push(e))}return t.forEach(i),e.forEach(i),r}var AN=function(e){return null!=e?wN(e)?e:[e]:[]},ON=function(e){return"function"==typeof e},DN=Object.prototype.hasOwnProperty,TN=function(e,t){return DN.call(e,t)},jN=function(e){return"boolean"==typeof e},MN=function(e){return"number"==typeof e},FN=function(e){return"string"==typeof e};function IN(e){return wN(e)?"["+e.map(IN)+"]":_N(e)||FN(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}var NN=function(e){for(var t={},n=0,r=e.length;n<r;++n)t[e[n]]=!0;return t};function RN(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}Object.create,Object.create,Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function e(){var t=isNaN(arguments[0])?1:Number(arguments[0]);return t?Array.prototype.reduce.call(this,(function(n,r){return Array.isArray(r)?n.push.apply(n,e.call(r,t-1)):n.push(r),n}),[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(e){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var PN=n(244),BN=n.n(PN),LN=n(243),zN=n.n(LN),UN=n(86),WN=n.n(UN);function VN(e){return!!e.or}function GN(e){return!!e.and}function qN(e){return!!e.not}var HN=zN.a,XN=BN.a;function KN(e,t){var n,r={},i=p(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;TN(e,a)&&(r[a]=e[a])}}catch(o){i.e(o)}finally{i.f()}return r}function YN(e,t){var n,r=Object.assign({},e),i=p(t);try{for(i.s();!(n=i.n()).done;)delete r[n.value]}catch(a){i.e(a)}finally{i.f()}return r}Set.prototype.toJSON=function(){return"Set(".concat(h(this).map((function(e){return WN()(e)})).join(","),")")};var $N=WN.a;function JN(e){if(MN(e))return e;var t=FN(e)?e:WN()(e);if(t.length<250)return t;for(var n=0,r=0;r<t.length;r++)n=(n<<5)-n+t.charCodeAt(r),n&=n;return n}function ZN(e){return!1===e||null===e}function QN(e,t){return e.indexOf(t)>-1}function eR(e,t){var n,r=0,i=p(e.entries());try{for(i.s();!(n=i.n()).done;){var a=f(n.value,2),o=a[0];if(t(a[1],o,r++))return!0}}catch(s){i.e(s)}finally{i.f()}return!1}function tR(e,t){var n,r=0,i=p(e.entries());try{for(i.s();!(n=i.n()).done;){var a=f(n.value,2),o=a[0];if(!t(a[1],o,r++))return!1}}catch(s){i.e(s)}finally{i.f()}return!0}function nR(e,t){var n,r=p(uR(t));try{for(r.s();!(n=r.n()).done;){var i=n.value;SN(e,i,t[i],!0)}}catch(a){r.e(a)}finally{r.f()}}function rR(e,t){var n,r,i=[],a={},o=p(e);try{for(o.s();!(r=o.n()).done;){var s=r.value;(n=t(s))in a||(a[n]=1,i.push(s))}}catch(u){o.e(u)}finally{o.f()}return i}function iR(e,t){var n,r=p(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(t.has(i))return!0}}catch(a){r.e(a)}finally{r.f()}return!1}function aR(e){var t,n=new Set,r=p(e);try{var i=function(){var e,r=t.value,i=vN(r).map((function(e,t){return 0===t?e:"[".concat(e,"]")})),a=i.map((function(e,t){return i.slice(0,t+1).join("")})),o=p(a);try{for(o.s();!(e=o.n()).done;){var s=e.value;n.add(s)}}catch(u){o.e(u)}finally{o.f()}};for(r.s();!(t=r.n()).done;)i()}catch(a){r.e(a)}finally{r.f()}return n}function oR(e,t){return void 0===e||void 0===t||iR(aR(e),aR(t))}function sR(e){return 0===uR(e).length}var uR=Object.keys,cR=Object.values;function lR(e){var t=[];for(var n in e)TN(e,n)&&t.push({key:n,value:e[n]});return t}function fR(e){return!0===e||!1===e}function dR(e){var t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function hR(e,t){return qN(e)?"!("+hR(e.not,t)+")":GN(e)?"("+e.and.map((function(e){return hR(e,t)})).join(") && (")+")":VN(e)?"("+e.or.map((function(e){return hR(e,t)})).join(") || (")+")":t(e)}function pR(e,t){if(0===t.length)return!0;var n=t.shift();return n in e&&pR(e[n],t)&&delete e[n],sR(e)}function mR(e){return e.charAt(0).toUpperCase()+e.substr(1)}function vR(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"datum",n=vN(e),r=[],i=1;i<=n.length;i++){var a="[".concat(n.slice(0,i).map(IN).join("]["),"]");r.push("".concat(t).concat(a))}return r.join(" && ")}function gR(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function yR(e){return"".concat(vN(e).map(gR).join("\\."))}function bR(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function xR(e){return"".concat(vN(e).join("."))}function wR(e){return e?vN(e).length:0}function _R(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0,i=t;r<i.length;r++){var a=i[r];if(void 0!==a)return a}}var kR=42;function ER(e){var t=++kR;return e?String(e)+t:t}function SR(e){if(void 0!==e)return(e%360+360)%360}function CR(e){return!!MN(e)||!isNaN(e)&&!isNaN(parseFloat(e))}var AR={domainColor:{part:"domain",vgProp:"stroke"},labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDash"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDash"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"},titleColor:{part:"title",vgProp:"fill"},title:null};function OR(e){return e&&e.condition}var DR=["domain","grid","labels","ticks","title"],TR={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"main",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},jR={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},MR=Object.assign(Object.assign({},jR),{style:1,labelExpr:1,encoding:1});function FR(e){return!!MR[e]}uR(MR);var IR={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},NR=IR.arc,RR=IR.area,PR=IR.bar,BR=IR.image,LR=IR.line,zR=IR.point,UR=IR.rect,WR=IR.rule,VR=IR.text,GR=IR.tick,qR=IR.trail,HR=IR.circle,XR=IR.square,KR=IR.geoshape;function YR(e){return QN(["line","area","trail"],e)}function $R(e){return QN(["rect","bar","image","arc"],e)}var JR=uR(IR);function ZR(e){return e.type}NN(JR);var QR=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit"].concat(["fill","fillOpacity"]),eP=uR({color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBand:1,timeUnitBandPosition:1}),tP={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},nP={binSpacing:1,continuousBandSize:5,timeUnitBandPosition:.5},rP={binSpacing:0,continuousBandSize:5,timeUnitBandPosition:.5};function iP(e){return"mark"in e}var aP=function(){function e(t,n){v(this,e),this.name=t,this.run=n}return g(e,[{key:"hasMatchingType",value:function(e){return!!iP(e)&&function(e){return ZR(e)?e.type:e}(e.mark)===this.name}}]),e}(),oP={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},sP={count:1,min:1,max:1};function uP(e){return!!e&&!!e.argmin}function cP(e){return!!e&&!!e.argmax}function lP(e){return FN(e)&&!!oP[e]}uR(oP);var fP=["count","valid","missing","distinct"];function dP(e){return FN(e)&&QN(fP,e)}var hP=["count","sum","distinct","valid","missing"],pP=NN(["mean","average","median","q1","q3","min","max"]),mP="row",vP="column",gP="facet",yP="x",bP="y",xP="x2",wP="y2",_P="radius",kP="radius2",EP="theta",SP="theta2",CP="latitude",AP="longitude",OP="latitude2",DP="longitude2",TP="color",jP="fill",MP="stroke",FP="shape",IP="size",NP="angle",RP="opacity",PP="fillOpacity",BP="strokeOpacity",LP="strokeWidth",zP="strokeDash",UP="text",WP="order",VP="detail",GP="key",qP="tooltip",HP="href",XP="url",KP="description",YP={theta:1,theta2:1,radius:1,radius2:1};function $P(e){return e in YP}var JP={longitude:1,longitude2:1,latitude:1,latitude2:1},ZP=uR(JP),QP=Object.assign(Object.assign(Object.assign(Object.assign({},{x:1,y:1,x2:1,y2:1}),YP),JP),{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function eB(e){return e===TP||e===jP||e===MP}var tB={row:1,column:1,facet:1},nB=uR(tB),rB=Object.assign(Object.assign({},QP),tB),iB=uR(rB),aB=(rB.order,rB.detail,rB.tooltip,RN(rB,["order","detail","tooltip"])),oB=(aB.row,aB.column,aB.facet,RN(aB,["row","column","facet"]));function sB(e){return!!oB[e]}function uB(e){return!!rB[e]}uR(aB),uR(oB);var cB=[xP,wP,OP,DP,SP,kP];function lB(e){return fB(e)!==e}function fB(e){switch(e){case xP:return yP;case wP:return bP;case OP:return CP;case DP:return AP;case SP:return EP;case kP:return _P}return e}function dB(e){if($P(e))switch(e){case EP:return"startAngle";case SP:return"endAngle";case _P:return"outerRadius";case kP:return"innerRadius"}return e}function hB(e){switch(e){case yP:return xP;case bP:return wP;case CP:return OP;case AP:return DP;case EP:return SP;case _P:return kP}}function pB(e){switch(e){case yP:case xP:return"width";case bP:case wP:return"height"}}QP.x,QP.y,QP.x2,QP.y2,QP.latitude,QP.longitude,QP.latitude2,QP.longitude2,QP.theta,QP.theta2,QP.radius,QP.radius2;var mB=(uR(QP),RN(QP,["x","y","x2","y2","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"])),vB=uR(mB),gB={x:1,y:1},yB=uR(gB);function bB(e){return e in gB}var xB={theta:1,radius:1},wB=uR(xB);function _B(e){return"width"===e?yP:bP}mB.text,mB.tooltip,mB.href,mB.url,mB.description,mB.detail,mB.key,mB.order;var kB=RN(mB,["text","tooltip","href","url","description","detail","key","order"]),EB=uR(kB),SB=Object.assign(Object.assign(Object.assign({},gB),xB),kB),CB=uR(SB);function AB(e){return!!SB[e]}function OB(e,t){return function(e){switch(e){case TP:case jP:case MP:case KP:case VP:case GP:case qP:case HP:case WP:case RP:case PP:case BP:case LP:case gP:case mP:case vP:return DB;case yP:case bP:case CP:case AP:return TB;case xP:case wP:case OP:case DP:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case IP:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case zP:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case FP:return{point:"always",geoshape:"always"};case UP:return{text:"always"};case NP:return{point:"always",square:"always",text:"always"};case XP:return{image:"always"};case EP:case _P:return{text:"always",arc:"always"};case SP:case kP:return{arc:"always"}}}(e)[t]}var DB={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},TB=(DB.geoshape,RN(DB,["geoshape"]));function jB(e){switch(e){case yP:case bP:case EP:case _P:case IP:case NP:case LP:case RP:case PP:case BP:case xP:case wP:case SP:case kP:return;case gP:case mP:case vP:case FP:case zP:case UP:case qP:case HP:case XP:case KP:return"discrete";case TP:case jP:case MP:return"flexible";case CP:case AP:case OP:case DP:case VP:case GP:case WP:return}}function MB(e){return jN(e)&&(e=AW(e,void 0)),"bin"+uR(e).map((function(t){return RB(e[t])?dR("_".concat(t,"_").concat(Object.entries(e[t]))):dR("_".concat(t,"_").concat(e[t]))})).join("")}function FB(e){return!0===e||NB(e)&&!e.binned}function IB(e){return"binned"===e||NB(e)&&!0===e.binned}function NB(e){return _N(e)}function RB(e){return null===e||void 0===e?void 0:e.selection}function PB(e){switch(e){case mP:case vP:case IP:case TP:case jP:case MP:case LP:case RP:case PP:case BP:case FP:return 6;case zP:return 4;default:return 10}}function BB(e){return"Invalid specification ".concat(JSON.stringify(e),'. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".')}var LB='Autosize "fit" only works for single views and layered views.';function zB(e){return"".concat("width"==e?"Width":"Height",' "container" only works for single views and layered views.')}function UB(e){return"".concat("width"==e?"Width":"Height",' "container" only works well with autosize "fit" or "fit-').concat("width"==e?"x":"y",'".')}function WB(e){return e?'Dropping "fit-'.concat(e,'" because spec has discrete ').concat(pB(e),"."):'Dropping "fit" because spec has discrete size.'}function VB(e){return'Cannot project a selection on encoding channel "'.concat(e,'", which has no field.')}function GB(e,t){return'Cannot project a selection on encoding channel "'.concat(e,'" as it uses an aggregate function ("').concat(t,'").')}function qB(e){return'The "nearest" transform is not supported for '.concat(e," marks.")}function HB(e){return"Selection not supported for ".concat(e," yet.")}function XB(e){return'Cannot find a selection named "'.concat(e,'".')}var KB="Scale bindings are currently only supported for scales with unbinned, continuous domains.",YB="Legend bindings are only supported for selections over an individual field or encoding channel.";function $B(e){return'Cannot define and lookup the "'.concat(e,'" selection in the same view. ')+"Try moving the lookup into a second, layered view?"}function JB(e){return'Unknown repeated value "'.concat(e,'".')}function ZB(e){return'The "columns" property cannot be used when "'.concat(e,'" has nested row/column.')}var QB="Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function eL(e){return'Unrecognized parse "'.concat(e,'".')}function tL(e,t,n){return'An ancestor parsed field "'.concat(e,'" as ').concat(n," but a child wants to parse the field as ").concat(t,".")}function nL(e){return"Ignoring an invalid transform: ".concat($N(e),".")}var rL='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function iL(e){return"Config.customFormatTypes is not true, thus custom format type and format for channel ".concat(e," are dropped.")}function aL(e){return"Layer's shared ".concat(e.join(",")," channel ").concat(1===e.length?"is":"are"," overriden.")}function oL(e){var t=e.parentProjection,n=e.projection;return"Layer's shared projection ".concat($N(t)," is overridden by a child projection ").concat($N(n),".")}var sL="Arc marks uses theta channel rather than angle, replacing angle with theta.";function uL(e,t,n){return"Channel ".concat(e," is a ").concat(t,". Converted to {value: ").concat($N(n),"}.")}function cL(e){return'Invalid field type "'.concat(e,'".')}function lL(e,t){return'Invalid field type "'.concat(e,'" for aggregate: "').concat(t,'", using "quantitative" instead.')}function fL(e){return'Invalid aggregation operator "'.concat(e,'".')}function dL(e,t){return'Missing type for channel "'.concat(e,'", using "').concat(t,'" instead.')}function hL(e,t){var n=t.fill,r=t.stroke;return"Dropping color ".concat(e," as the plot also has ").concat(n&&r?"fill and stroke":n?"fill":"stroke",".")}function pL(e,t){return"Dropping ".concat($N(e),' from channel "').concat(t,'" since it does not contain any data field, datum, value, or signal.')}function mL(e,t,n){return"".concat(e,"-encoding with type ").concat(t," is deprecated. Replacing with ").concat(n,"-encoding.")}var vL="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function gL(e,t,n){return"".concat(e,' dropped as it is incompatible with "').concat(t,'"').concat(n?" when ".concat(n):"",".")}function yL(e){return"".concat(e,"-encoding is dropped as ").concat(e," is not a valid encoding channel.")}function bL(e){return"".concat(e," encoding should be discrete (ordinal / nominal / binned).")}function xL(e){return"Facet encoding dropped as ".concat(e.join(" and ")," ").concat(e.length>1?"are":"is"," also specified.")}function wL(e,t){return'Using discrete channel "'.concat(e,'" to encode "').concat(t,'" field can be misleading as it does not encode ').concat("ordinal"===t?"order":"magnitude",".")}function _L(e,t){return"Line mark is for continuous lines and thus cannot be used with ".concat(e&&t?"x2 and y2":e?"x2":"y2",". We will use the rule mark (line segments) instead.")}function kL(e,t){return'Specified orient "'.concat(e,'" overridden with "').concat(t,'".')}var EL="Custom domain scale cannot be unioned with default field-based domain.",SL='Scale\'s "rangeStep" is deprecated and will be removed in Vega-Lite 5.0. Please use "width"/"height": {"step": ...} instead. See https://vega.github.io/vega-lite/docs/size.html.';function CL(e){return'Cannot use the scale property "'.concat(e,'" with non-color channel.')}function AL(e){return"Using unaggregated domain with raw field has no effect (".concat($N(e),").")}function OL(e){return'Unaggregated domain not applicable for "'.concat(e,'" since it produces values outside the origin domain of the source data.')}function DL(e){return"Unaggregated domain is currently unsupported for log scale (".concat($N(e),").")}function TL(e){return'Cannot apply size to non-oriented mark "'.concat(e,'".')}function jL(e,t,n){return'Channel "'.concat(e,'" does not work with "').concat(t,'" scale. We are using "').concat(n,'" scale instead.')}function ML(e,t){return'FieldDef does not work with "'.concat(e,'" scale. We are using "').concat(t,'" scale instead.')}function FL(e,t,n){return"".concat(n,"-scale's \"").concat(t,'" is dropped as it does not work with ').concat(e," scale.")}function IL(e,t){return'Scale type "'.concat(t,'" does not work with mark "').concat(e,'".')}function NL(e){return'The step for "'.concat(e,'" is dropped because the ').concat("width"===e?"x":"y"," is continuous.")}function RL(e,t,n,r){return"Conflicting ".concat(t.toString(),' property "').concat(e.toString(),'" (').concat($N(n)," and ").concat($N(r),"). Using ").concat($N(n),".")}function PL(e,t,n,r){return"Conflicting ".concat(t.toString(),' property "').concat(e.toString(),'" (').concat($N(n)," and ").concat($N(r),"). Using the union of the two domains.")}function BL(e){return'Setting the scale to be independent for "'.concat(e,'" means we also have to set the guide (axis or legend) to be independent.')}function LL(e){return"Dropping sort property ".concat($N(e),' as unioned domains only support boolean or op "count", "min", and "max".')}var zL="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",UL="Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect.",WL="Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect.",VL="Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.",GL="Invalid channel for axis.";function qL(e){return'Cannot stack "'.concat(e,'" if there is already "').concat(e,'2".')}function HL(e){return"Cannot stack non-linear scale (".concat(e,").")}function XL(e){return'Stacking is applied even though the aggregate function is non-summative ("'.concat(e,'").')}function KL(e,t){return"Invalid ".concat(e,": ").concat($N(t),".")}function YL(e){return"Dropping day from datetime ".concat($N(e)," as day cannot be combined with other units.")}function $L(e,t){return"".concat(t?"extent ":"").concat(t&&e?"and ":"").concat(e?"center ":"").concat(t&&e?"are ":"is ","not needed when data are aggregated.")}function JL(e,t,n){return"".concat(e," is not usually used with ").concat(t," for ").concat(n,".")}function ZL(e,t){return"Continuous axis should not have customized aggregation function ".concat(e,"; ").concat(t," already agregates the axis.")}function QL(e,t){return"Center is not needed to be specified in ".concat(t," when extent is ").concat(e,".")}function ez(e){return"1D error band does not support ".concat(e,".")}function tz(e){return"Channel ".concat(e,' is required for "binned" bin.')}function nz(e){return"Domain for ".concat(e," is required for threshold scale.")}var rz=function(e,t){var n=2;return{level:function(e){return arguments.length?(n=+e,this):n},error:function(){return n>=1&&xN(t||"error","ERROR",arguments),this},warn:function(){return n>=2&&xN(t||"warn","WARN",arguments),this},info:function(){return n>=3&&xN(t||"log","INFO",arguments),this},debug:function(){return n>=4&&xN(t||"log","DEBUG",arguments),this}}}(),iz=rz;function az(){return iz=rz}function oz(){var e;(e=iz).warn.apply(e,arguments)}function sz(e){if(e&&_N(e)){var t,n=p(mz);try{for(n.s();!(t=n.n()).done;)if(t.value in e)return!0}catch(r){n.e(r)}finally{n.f()}}return!1}var uz=["january","february","march","april","may","june","july","august","september","october","november","december"],cz=uz.map((function(e){return e.substr(0,3)})),lz=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],fz=lz.map((function(e){return e.substr(0,3)}));function dz(e,t){var n=[];if(t&&void 0!==e.day&&uR(e).length>1&&(oz(P.droppedDay(e)),delete(e=XN(e)).day),void 0!==e.year?n.push(e.year):n.push(2012),void 0!==e.month){var r=t?function(e){if(CR(e)&&(e=+e),MN(e))return e-1;var t=e.toLowerCase(),n=uz.indexOf(t);if(-1!==n)return n;var r=t.substr(0,3),i=cz.indexOf(r);if(-1!==i)return i;throw new Error(P.invalidTimeUnit("month",e))}(e.month):e.month;n.push(r)}else if(void 0!==e.quarter){var i=t?function(e){if(CR(e)&&(e=+e),MN(e))return e>4&&oz(P.invalidTimeUnit("quarter",e)),e-1;throw new Error(P.invalidTimeUnit("quarter",e))}(e.quarter):e.quarter;n.push(MN(i)?3*i:i+"*3")}else n.push(0);if(void 0!==e.date)n.push(e.date);else if(void 0!==e.day){var a=t?function(e){if(CR(e)&&(e=+e),MN(e))return e%7;var t=e.toLowerCase(),n=lz.indexOf(t);if(-1!==n)return n;var r=t.substr(0,3),i=fz.indexOf(r);if(-1!==i)return i;throw new Error(P.invalidTimeUnit("day",e))}(e.day):e.day;n.push(MN(a)?a+1:a+"+1")}else n.push(1);for(var o=0,s=["hours","minutes","seconds","milliseconds"];o<s.length;o++){var u=e[s[o]];n.push(void 0===u?0:u)}return n}function hz(e){var t=dz(e,!0).join(", ");return e.utc?"utc(".concat(t,")"):"datetime(".concat(t,")")}var pz={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},mz=uR(pz);function vz(e){return e.startsWith("utc")}var gz={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function yz(e){var t,n=[],r=p(mz);try{for(r.s();!(t=r.n()).done;){var i=t.value;bz(e,i)&&n.push(i)}}catch(a){r.e(a)}finally{r.f()}return n}function bz(e,t){var n=e.indexOf(t);return!(n<0)&&!(n>0&&"seconds"===t&&"i"===e.charAt(n-1))&&!(e.length>n+3&&"day"===t&&"o"===e.charAt(n+3))&&!(n>0&&"year"===t&&"f"===e.charAt(n-1))}function xz(e,t){var n,r=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{end:!1}).end,i=vR(t),a=vz(e)?"utc":"";function o(e){return"quarter"===e?"(".concat(a,"quarter(").concat(i,")-1)"):"".concat(a).concat(e,"(").concat(i,")")}var s,u={},c=p(mz);try{for(c.s();!(s=c.n()).done;){var l=s.value;bz(e,l)&&(u[l]=o(l),n=l)}}catch(f){c.e(f)}finally{c.f()}return r&&(u[n]+="+1"),function(e){var t=dz(e,!1).join(", ");return e.utc?"utc(".concat(t,")"):"datetime(".concat(t,")")}(u)}function wz(e){if(e){var t=yz(e);return"timeUnitSpecifier(".concat(WN()(t),", ").concat(WN()(gz),")")}}function _z(e){var t;if(e)return FN(e)?t={unit:e}:_N(e)&&(t=Object.assign(Object.assign({},e),e.unit?{unit:e.unit}:{})),vz(t.unit)&&(t.utc=!0,t.unit=function(e){return e.substr(3)}(t.unit)),t}function kz(e){return e&&!!e.signal}function Ez(e){return!!e.step}function Sz(e){return!wN(e)&&"field"in e&&"data"in e}var Cz=uR({aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1}),Az={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},Oz=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function Dz(e){return e&&!!e.field&&void 0!==e.equal}function Tz(e){return e&&!!e.field&&void 0!==e.lt}function jz(e){return e&&!!e.field&&void 0!==e.lte}function Mz(e){return e&&!!e.field&&void 0!==e.gt}function Fz(e){return e&&!!e.field&&void 0!==e.gte}function Iz(e){if(e&&e.field){if(wN(e.range)&&2===e.range.length)return!0;if(kz(e.range))return!0}return!1}function Nz(e){return e&&!!e.field&&(wN(e.oneOf)||wN(e.in))}function Rz(e){return Nz(e)||Dz(e)||Iz(e)||Tz(e)||Mz(e)||jz(e)||Fz(e)}function Pz(e,t){return TW(e,{timeUnit:t,wrapTime:!0})}function Bz(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=e.field,i=null===(t=_z(e.timeUnit))||void 0===t?void 0:t.unit,a=i?"time("+xz(i,r)+")":dW(e,{expr:"datum"});if(Dz(e))return a+"==="+Pz(e.equal,i);if(Tz(e))return"".concat(a,"<").concat(Pz(e.lt,i));if(Mz(e))return"".concat(a,">").concat(Pz(e.gt,i));if(jz(e))return"".concat(a,"<=").concat(Pz(e.lte,i));if(Fz(e))return"".concat(a,">=").concat(Pz(e.gte,i));if(Nz(e))return"indexof([".concat(function(e,t){return e.map((function(e){return Pz(e,t)}))}(e.oneOf,i).join(","),"], ").concat(a,") !== -1");if(function(e){return e&&!!e.field&&void 0!==e.valid}(e))return Lz(a,e.valid);if(Iz(e)){var o=e.range,s=kz(o)?{signal:"".concat(o.signal,"[0]")}:o[0],u=kz(o)?{signal:"".concat(o.signal,"[1]")}:o[1];if(null!==s&&null!==u&&n)return"inrange("+a+", ["+Pz(s,i)+", "+Pz(u,i)+"])";var c=[];return null!==s&&c.push("".concat(a," >= ").concat(Pz(s,i))),null!==u&&c.push("".concat(a," <= ").concat(Pz(u,i))),c.length>0?c.join(" && "):"true"}throw new Error("Invalid field predicate: ".concat(JSON.stringify(e)))}function Lz(e){return arguments.length>1&&void 0!==arguments[1]&&!arguments[1]?"!isValid(".concat(e,") || !isFinite(+").concat(e,")"):"isValid(".concat(e,") && isFinite(+").concat(e,")")}function zz(e){var t;return Rz(e)&&e.timeUnit?Object.assign(Object.assign({},e),{timeUnit:null===(t=_z(e.timeUnit))||void 0===t?void 0:t.unit}):e}var Uz={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"},Wz=Uz.quantitative,Vz=Uz.ordinal,Gz=Uz.temporal,qz=Uz.nominal,Hz=Uz.geojson,Xz=uR(Uz),Kz={LINEAR:"linear",LOG:"log",POW:"pow",SQRT:"sqrt",SYMLOG:"symlog",IDENTITY:"identity",SEQUENTIAL:"sequential",TIME:"time",UTC:"utc",QUANTILE:"quantile",QUANTIZE:"quantize",THRESHOLD:"threshold",BIN_ORDINAL:"bin-ordinal",ORDINAL:"ordinal",POINT:"point",BAND:"band"},Yz={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"},$z=uR(Yz);function Jz(e,t){var n=Yz[e],r=Yz[t];return n===r||"ordinal-position"===n&&"time"===r||"ordinal-position"===r&&"time"===n}var Zz={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function Qz(e){return Zz[e]}var eU=["linear","log","pow","sqrt","symlog","time","utc"],tU=NN(eU),nU=NN(["linear","log","pow","sqrt","symlog"]),rU=NN(["quantile","quantize","threshold"]),iU=NN(eU.concat(["quantile","quantize","threshold","sequential","identity"])),aU=NN(["ordinal","bin-ordinal","point","band"]);function oU(e){return e in aU}function sU(e){return e in iU}function uU(e){return e in tU}function cU(e){return e in rU}function lU(e){return null===e||void 0===e?void 0:e.selection}var fU={type:1,domain:1,domainMid:1,align:1,range:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},dU=(fU.type,fU.domain,fU.range,fU.scheme,uR(fU),RN(fU,["type","domain","range","scheme"])),hU=uR(dU);function pU(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!QN(["point","band","identity"],e);case"bins":return!QN(["point","band","identity","ordinal"],e);case"round":return uU(e)||"band"===e||"point"===e;case"padding":return uU(e)||QN(["point","band"],e);case"paddingOuter":case"align":return QN(["point","band"],e);case"paddingInner":return"band"===e;case"domainMid":case"clamp":return uU(e);case"nice":return uU(e)||"quantize"===e||"threshold"===e;case"exponent":return"pow"===e;case"base":return"log"===e;case"constant":return"symlog"===e;case"zero":return sU(e)&&!QN(["log","time","utc","threshold","quantile"],e)}}function mU(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return eB(e)?void 0:P.cannotUseScalePropertyWithNonColor(e);case"align":case"type":case"bins":case"domain":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"reverse":case"round":case"clamp":case"zero":return}}function vU(e,t){return QN([Vz,qz],t)?void 0===e||oU(e):t===Gz?QN([Kz.TIME,Kz.UTC,void 0],e):t!==Wz||QN([Kz.LOG,Kz.POW,Kz.SQRT,Kz.SYMLOG,Kz.QUANTILE,Kz.QUANTIZE,Kz.THRESHOLD,Kz.LINEAR,void 0],e)}function gU(e,t){if(!AB(e))return!1;switch(e){case yP:case bP:case EP:case _P:return uU(t)||QN(["band","point"],t);case IP:case LP:case RP:case PP:case BP:case NP:return uU(t)||cU(t)||QN(["band","point","ordinal"],t);case TP:case jP:case MP:return"band"!==t;case zP:return"ordinal"===t||cU(t);case FP:return"ordinal"===t}}function yU(e,t){return e+"_"+t}function bU(e){var t=e.channel,n=e.channelDef,r=e.markDef,i=e.scale,a=e.config,o=EU(e);return eW(n)&&!dP(n.aggregate)&&i&&uU(i.get("type"))&&!1===i.get("zero")?xU({fieldDef:n,channel:t,markDef:r,ref:o,config:a}):o}function xU(e){var t=e.fieldDef,n=e.channel,r=e.markDef,i=e.ref,a=e.config;return YR(r.type)||null===LW("invalid",r,a)?i:[function(e,t){var n=wU(e,!0),r="y"===fB(t)?{field:{group:"height"}}:{value:0};return Object.assign({test:n},r)}(t,n),i]}function wU(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Lz(FN(e)?e:dW(e,{expr:"datum"}),!t)}function _U(e,t,n,r){var i={};if(t&&(i.scale=t),nW(e)){var a=e.datum;sz(a)?i.signal=hz(a):kz(a)?i.signal=a.signal:i.value=a}else i.field=dW(e,n);if(r){var o=r.offset,s=r.band;o&&(i.offset=o),s&&(i.band=s)}return i}function kU(e){var t=e.scaleName,n=e.fieldOrDatumDef,r=e.fieldOrDatumDef2,i=e.offset,a=e.startSuffix,o=e.band,s=void 0===o?.5:o,u=0<s&&s<1?"datum":void 0,c=dW(n,{expr:u,suffix:a}),l=void 0!==r?dW(r,{expr:u}):dW(n,{suffix:"end",expr:u}),f={};if(0===s||1===s){f.scale=t;var d=0===s?c:l;f.field=d}else{var h="".concat(s," * ").concat(c," + ").concat(1-s," * ").concat(l);f.signal='scale("'.concat(t,'", ').concat(h,")")}return i&&(f.offset=i),f}function EU(e){var t,n=e.channel,r=e.channelDef,i=e.channel2Def,a=e.markDef,o=e.config,s=e.scaleName,u=e.scale,c=e.stack,l=e.offset,f=e.defaultRef,d=e.band;if(r){if(aW(r)){if(oW(r)){d=null!==d&&void 0!==d?d:YU({channel:n,fieldDef:r,fieldDef2:i,markDef:a,stack:c,config:o,isMidPoint:!0});var h=r.bin,p=r.timeUnit,m=r.type;if(FB(h)||d&&p&&m===Gz)return c&&c.impute?_U(r,s,{binSuffix:"mid"},{offset:l}):d?kU({scaleName:s,fieldOrDatumDef:r,band:d,offset:l}):_U(r,s,MW(r,n)?{binSuffix:"range"}:{},{offset:l});if(IB(h)){if(eW(i))return kU({scaleName:s,fieldOrDatumDef:r,fieldOrDatumDef2:i,band:d,offset:l});var v=n===yP?xP:wP;oz(P.channelRequiredForBinned(v))}}var g=null===u||void 0===u?void 0:u.get("type");return _U(r,s,oU(g)?{binSuffix:"range"}:{},{offset:l,band:"band"===g?null!==(t=null!==d&&void 0!==d?d:r.band)&&void 0!==t?t:.5:void 0})}if(sW(r)){var y=r.value,b=l?{offset:l}:{};return Object.assign(Object.assign({},SU(n,y)),b)}}return ON(f)&&(f=f()),f?Object.assign(Object.assign({},f),l?{offset:l}:{}):f}function SU(e,t){return QN(["x","x2"],e)&&"width"===t?{field:{group:"width"}}:QN(["y","y2"],e)&&"height"===t?{field:{group:"height"}}:NW(t)}function CU(e){return e&&"number"!==e&&"time"!==e}function AU(e,t,n){return"".concat(e,"(").concat(t).concat(n?", ".concat(JSON.stringify(n)):"",")")}!function(){var e,t,n={},r=p(iB);try{for(r.s();!(t=r.n()).done;){var i,a=t.value,o=p(Xz);try{for(o.s();!(i=o.n()).done;){var s,u=i.value,c=p($z);try{for(c.s();!(s=c.n()).done;){var l=s.value,f=yU(a,u);gU(a,l)&&vU(l,u)&&(n[f]=null!==(e=n[f])&&void 0!==e?e:[],n[f].push(l))}}catch(d){c.e(d)}finally{c.f()}}}catch(d){o.e(d)}finally{o.f()}}}catch(d){r.e(d)}finally{r.f()}}();var OU=" \u2013 ";function DU(e){var t,n,r=e.fieldOrDatumDef,i=e.format,a=e.formatType,o=e.expr,s=e.normalizeStack,u=e.config;if(CU(a))return jU({fieldOrDatumDef:r,format:i,formatType:a,expr:o,config:u});var c=TU(r,o,s);if(DW(r)){var l=function(e,t,n,r,i){return!t||n?(n=FN(n)?n:r,"".concat(i?"utc":"time","Format(").concat(e,", '").concat(n,"')")):function(e,t,n){if(e){var r=wz(e);return"".concat(n||vz(e)?"utc":"time","Format(").concat(t,", ").concat(r,")")}}(t,e,i)}(c,eW(r)?null===(t=_z(r.timeUnit))||void 0===t?void 0:t.unit:void 0,i,u.timeFormat,uW(r)&&(null===(n=r.scale)||void 0===n?void 0:n.type)===Kz.UTC);return l?{signal:l}:void 0}return i=IU(tW(r),i,u),eW(r)&&FB(r.bin)?{signal:PU(c,dW(r,{expr:o,binSuffix:"end"}),i,a,u)}:i||"quantitative"===tW(r)?{signal:"".concat(NU(c,i))}:{signal:"isValid(".concat(c,") ? ").concat(c,' : ""+').concat(c)}}function TU(e,t,n){return eW(e)?n?"".concat(dW(e,{expr:t,suffix:"end"}),"-").concat(dW(e,{expr:t,suffix:"start"})):dW(e,{expr:t}):function(e){var t=e.datum;return sz(t)?hz(t):"".concat(JSON.stringify(t))}(e)}function jU(e){var t=e.fieldOrDatumDef,n=e.format,r=e.formatType,i=e.expr,a=e.normalizeStack,o=e.config,s=e.field;return s=null!==s&&void 0!==s?s:TU(t,i,a),eW(t)&&FB(t.bin)?{signal:PU(s,dW(t,{expr:i,binSuffix:"end"}),n,r,o)}:{signal:AU(r,s,n)}}function MU(e,t,n,r,i,a){var o;if(!CU(r))return DW(e)?function(e,t,n,r){return e||(t?{signal:wz(t)}:r?void 0:n.timeFormat)}(n,eW(e)?null===(o=_z(e.timeUnit))||void 0===o?void 0:o.unit:void 0,i,a):IU(t,n,i)}function FU(e,t,n){return e&&(kz(e)||"number"===e||"time"===e)?e:DW(t)&&"time"!==n&&"utc"!==n?"time":void 0}function IU(e,t,n){return FN(t)?t:e===Wz?n.numberFormat:void 0}function NU(e,t){return"format(".concat(e,', "').concat(t||"",'")')}function RU(e,t,n,r){var i;return CU(n)?AU(n,e,t):NU(e,null!==(i=FN(t)?t:void 0)&&void 0!==i?i:r.numberFormat)}function PU(e,t,n,r,i){var a=RU(e,n,r,i),o=RU(t,n,r,i);return"".concat(Lz(e,!1),' ? "null" : ').concat(a,' + "').concat(OU,'" + ').concat(o)}var BU="min",LU={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function zU(e){return e in LU}function UU(e){return!!e&&!!e.encoding}function WU(e){return!(!e||"count"!==e.op&&!e.field)}function VU(e){return!!e&&wN(e)}function GU(e){return"row"in e||"column"in e}function qU(e){return!!e&&"header"in e}function HU(e){return"facet"in e}function XU(e){var t=e.field,n=e.timeUnit,r=e.bin,i=e.aggregate;return Object.assign(Object.assign(Object.assign(Object.assign({},n?{timeUnit:n}:{}),r?{bin:r}:{}),i?{aggregate:i}:{}),{field:t})}function KU(e){return oW(e)&&"sort"in e}function YU(e){var t=e.channel,n=e.fieldDef,r=e.fieldDef2,i=e.markDef,a=e.stack,o=e.config,s=e.isMidPoint;if(aW(n)&&void 0!==n.band)return n.band;if(eW(n)){var u=n.timeUnit,c=n.bin;if(u&&!r)return s?zW("timeUnitBandPosition",i,o):$R(i.type)?zW("timeUnitBand",i,o):0;if(FB(c))return $R(i.type)&&!s?1:.5}return(null===a||void 0===a?void 0:a.fieldChannel)===t&&s?.5:void 0}function $U(e,t,n,r,i,a){return!!(FB(t.bin)||t.timeUnit&&oW(t)&&"temporal"===t.type)&&!!YU({channel:e,fieldDef:t,fieldDef2:n,stack:r,markDef:i,config:a})}function JU(e){return!!e&&"condition"in e}function ZU(e){var t=e&&e.condition;return!!t&&!wN(t)&&eW(t)}function QU(e){var t=e&&e.condition;return!!t&&!wN(t)&&aW(t)}function eW(e){return!(!e||!e.field&&"count"!==e.aggregate)}function tW(e){return e&&e.type}function nW(e){return!!e&&"datum"in e}function rW(e){return oW(e)&&pW(e)||iW(e)}function iW(e){return nW(e)&&MN(e.datum)}function aW(e){return eW(e)||nW(e)}function oW(e){return!!e&&("field"in e&&"type"in e||"count"===e.aggregate)}function sW(e){return e&&"value"in e&&"value"in e}function uW(e){return!!e&&("scale"in e||"sort"in e)}function cW(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function lW(e){return!!e&&"legend"in e}function fW(e){return!!e&&("format"in e||"formatType"in e)}function dW(e){var t,n,r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.field,o=i.prefix,s=i.suffix,u="";if(function(e){return"count"===e.aggregate}(e))a=function(e){return function(e){return 0===e.indexOf("__")}(e)?e:"__".concat(e)}("count");else{var c;if(!i.nofn)if(function(e){return"op"in e}(e))c=e.op;else{var l=e.bin,f=e.aggregate,d=e.timeUnit;FB(l)?(c=MB(l),s=(null!==(t=i.binSuffix)&&void 0!==t?t:"")+(null!==(n=i.suffix)&&void 0!==n?n:"")):f?cP(f)?(u='["'.concat(a,'"]'),a="argmax_".concat(f.argmax)):uP(f)?(u='["'.concat(a,'"]'),a="argmin_".concat(f.argmin)):c=String(f):d&&(c=function(e){var t=_z(e),n=t.utc,r=RN(t,["utc"]);return r.unit?(n?"utc":"")+uR(r).map((function(e){return dR("".concat("unit"===e?"":"_".concat(e,"_")).concat(r[e]))})).join(""):(n?"utc":"")+"timeunit"+uR(r).map((function(e){return dR("_".concat(e,"_").concat(r[e]))})).join("")}(d),s=(!QN(["range","mid"],i.binSuffix)&&i.binSuffix||"")+(null!==(r=i.suffix)&&void 0!==r?r:""))}c&&(a=a?"".concat(c,"_").concat(a):c)}return s&&(a="".concat(a,"_").concat(s)),o&&(a="".concat(o,"_").concat(a)),i.forAs?xR(a):i.expr?function(e){return"".concat(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"datum","[").concat(IN(vN(e).join(".")),"]")}(a,i.expr)+u:yR(a)+u}function hW(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return eW(e)&&!!e.bin;case"temporal":return!1}throw new Error(P.invalidFieldType(e.type))}function pW(e){return!hW(e)}var mW=function(e,t){switch(t.fieldTitle){case"plain":return e.field;case"functional":return function(e){var t=e.aggregate,n=e.bin,r=e.timeUnit,i=e.field;if(cP(t))return"".concat(i," for argmax(").concat(t.argmax,")");if(uP(t))return"".concat(i," for argmin(").concat(t.argmin,")");var a=_z(r),o=t||(null===a||void 0===a?void 0:a.unit)||(null===a||void 0===a?void 0:a.maxbins)&&"timeunit"||FB(n)&&"bin";return o?o.toUpperCase()+"("+i+")":i}(e);default:return function(e,t){var n,r=e.field,i=e.bin,a=e.timeUnit,o=e.aggregate;if("count"===o)return t.countTitle;if(FB(i))return"".concat(r," (binned)");if(a){var s=null===(n=_z(a))||void 0===n?void 0:n.unit;if(s)return"".concat(r," (").concat(yz(s).join("-"),")")}else if(o)return cP(o)?"".concat(r," for max ").concat(o.argmax):uP(o)?"".concat(r," for min ").concat(o.argmin):"".concat(mR(o)," of ").concat(r);return r}(e,t)}},vW=mW;function gW(e){vW=e}function yW(e,t,n){var r,i,a=n.allowDisabling,o=n.includeDefault,s=void 0===o||o,u=(null!==(r=bW(e))&&void 0!==r?r:{}).title;if(!eW(e))return u;var c=e,l=s?xW(c,t):void 0;return a?_R(u,c.title,l):null!==(i=null!==u&&void 0!==u?u:c.title)&&void 0!==i?i:l}function bW(e){return cW(e)&&e.axis?e.axis:lW(e)&&e.legend?e.legend:qU(e)&&e.header?e.header:void 0}function xW(e,t){return vW(e,t)}function wW(e){var t;if(fW(e))return{format:e.format,formatType:e.formatType};var n=null!==(t=bW(e))&&void 0!==t?t:{};return{format:n.format,formatType:n.formatType}}function _W(e){return eW(e)?e:ZU(e)?e.condition:void 0}function kW(e){return aW(e)?e:QU(e)?e.condition:void 0}function EW(e,t,n){if(FN(e)||MN(e)||jN(e)){var r=FN(e)?"string":MN(e)?"number":"boolean";return oz(P.primitiveChannelDef(t,r,e)),{value:e}}return aW(e)?SW(e,t,n):QU(e)?Object.assign(Object.assign({},e),{condition:SW(e.condition,t,n)}):e}function SW(e,t,n){if(fW(e)){e.format;var r=e.formatType,i=RN(e,["format","formatType"]);if(CU(r)&&!n.customFormatTypes)return oz(P.customFormatTypeNotAllowed(t)),SW(i,t,n)}else{var a=cW(e)?"axis":lW(e)?"legend":qU(e)?"header":null;if(a&&e[a]){var o=e[a],s=(o.format,o.formatType),u=RN(o,["format","formatType"]);if(CU(s)&&!n.customFormatTypes)return oz(P.customFormatTypeNotAllowed(t)),SW(Object.assign(Object.assign({},e),y({},a,u)),t,n)}}return eW(e)?CW(e,t):function(e){var t=e.type;if(t)return e;var n=e.datum;return t=MN(n)?"quantitative":FN(n)?"nominal":sz(n)?"temporal":void 0,Object.assign(Object.assign({},e),{type:t})}(e)}function CW(e,t){var n=e.aggregate,r=e.timeUnit,i=e.bin,a=e.field,o=Object.assign({},e);if(!n||lP(n)||cP(n)||uP(n)||(oz(P.invalidAggregate(n)),delete o.aggregate),r&&(o.timeUnit=_z(r)),a&&(o.field="".concat(a)),FB(i)&&(o.bin=AW(i,t)),IB(i)&&!bB(t)&&oz("Channel ".concat(t,' should not be used with "binned" bin.')),oW(o)){var s=o.type,u=function(e){if(e)switch(e=e.toLowerCase()){case"q":case Wz:return"quantitative";case"t":case Gz:return"temporal";case"o":case Vz:return"ordinal";case"n":case qz:return"nominal";case Hz:return"geojson"}}(s);s!==u&&(o.type=u),"quantitative"!==s&&dP(n)&&(oz(P.invalidFieldTypeForCountAggregate(s,n)),o.type="quantitative")}else if(!lB(t)){var c=function(e,t){if(e.timeUnit)return"temporal";if(FB(e.bin))return"quantitative";switch(jB(t)){case"continuous":default:return"quantitative";case"discrete":case"flexible":return"nominal"}}(o,t);oz(P.missingFieldType(t,c)),o.type=c}if(oW(o)){var l=function(e,t){var n=e.type;if("geojson"===n&&"shape"!==t)return{compatible:!1,warning:"Channel ".concat(t," should not be used with a geojson data.")};switch(t){case mP:case vP:case gP:return pW(e)?{compatible:!1,warning:P.facetChannelShouldBeDiscrete(t)}:OW;case yP:case bP:case TP:case jP:case MP:case UP:case VP:case GP:case qP:case HP:case XP:case NP:case EP:case _P:case KP:return OW;case AP:case DP:case CP:case OP:return n!==Wz?{compatible:!1,warning:"Channel ".concat(t," should be used with a quantitative field only, not ").concat(e.type," field.")}:OW;case RP:case PP:case BP:case LP:case IP:case SP:case kP:case xP:case wP:return"nominal"!==n||e.sort?OW:{compatible:!1,warning:"Channel ".concat(t," should not be used with an unsorted discrete field.")};case zP:return QN(["ordinal","nominal"],e.type)?OW:{compatible:!1,warning:"StrokeDash channel should be used with only discrete data."};case FP:return QN(["ordinal","nominal","geojson"],e.type)?OW:{compatible:!1,warning:"Shape channel should be used with only either discrete or geojson data."};case WP:return"nominal"!==e.type||"sort"in e?OW:{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}}}(o,t),f=l.compatible,d=l.warning;f||oz(d)}if(KU(o)&&FN(o.sort)){var h=o.sort;if(zU(h))return Object.assign(Object.assign({},o),{sort:{encoding:h}});var p=h.substr(1);if("-"===h.charAt(0)&&zU(p))return Object.assign(Object.assign({},o),{sort:{encoding:p,order:"descending"}})}if(qU(o)){var m=o.header,v=m.orient,g=RN(m,["orient"]);if(v)return Object.assign(Object.assign({},o),{header:Object.assign(Object.assign({},g),{labelOrient:m.labelOrient||v,titleOrient:m.titleOrient||v})})}return o}function AW(e,t){return jN(e)?{maxbins:PB(t)}:"binned"===e?{binned:!0}:e.maxbins||e.step?e:Object.assign(Object.assign({},e),{maxbins:PB(t)})}var OW={compatible:!0};function DW(e){var t=wW(e).formatType;return"time"===t||!t&&function(e){return e&&("temporal"===e.type||eW(e)&&!!e.timeUnit)}(e)}function TW(e,t){var n,r,i=t.timeUnit,a=t.type,o=t.wrapTime,s=t.undefinedIfExprNotRequired,u=i&&(null===(n=_z(i))||void 0===n?void 0:n.unit),c=u||"temporal"===a;return kz(e)?r=e.signal:sz(e)?(c=!0,r=hz(e)):(FN(e)||MN(e))&&c&&(r="datetime(".concat(JSON.stringify(e),")"),function(e){return!!pz[e]}(u)&&(MN(e)&&e<1e4||FN(e)&&isNaN(Date.parse(e)))&&(r=hz(y({},u,e)))),r?o&&c?"time(".concat(r,")"):r:s?void 0:JSON.stringify(e)}function jW(e,t){var n=e.type;return t.map((function(t){var r=TW(t,{timeUnit:eW(e)?e.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return void 0!==r?{signal:r}:t}))}function MW(e,t){return FB(e.bin)?AB(t)&&QN(["ordinal","nominal"],e.type):(console.warn("Only call this method for binned field defs."),!1)}function FW(e){var t=e.anchor,n=e.frame,r=e.offset,i=e.orient,a=e.color,o=e.subtitleColor,s=e.subtitleFont,u=e.subtitleFontSize,c=e.subtitleFontStyle,l=e.subtitleFontWeight,f=e.subtitleLineHeight,d=e.subtitlePadding,h=RN(e,["anchor","frame","offset","orient","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]),p=Object.assign(Object.assign({},h),a?{fill:a}:{}),m=Object.assign(Object.assign(Object.assign(Object.assign({},t?{anchor:t}:{}),n?{frame:n}:{}),r?{offset:r}:{}),i?{orient:i}:{}),v=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},o?{subtitleColor:o}:{}),s?{subtitleFont:s}:{}),u?{subtitleFontSize:u}:{}),c?{subtitleFontStyle:c}:{}),l?{subtitleFontWeight:l}:{}),f?{subtitleLineHeight:f}:{}),d?{subtitlePadding:d}:{});return{titleMarkConfig:p,subtitleMarkConfig:KN(p,["align","baseline","dx","dy","limit"]),nonMark:m,subtitle:v}}function IW(e){return FN(e)||wN(e)&&FN(e[0])}function NW(e){return kz(e)?e:void 0!==e?{value:e}:void 0}function RW(e){return kz(e)?e.signal:IN(e.value)}function PW(e){return kz(e)?e.signal:null==e?null:IN(e)}function BW(e){var t;return[].concat(e.type,null!==(t=e.style)&&void 0!==t?t:[])}function LW(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=r.vgChannel,a=r.ignoreVgConfig;return i&&void 0!==t[i]?t[i]:void 0!==t[e]?t[e]:!a||i&&i!==e?zW(e,t,n,r):void 0}function zW(e,t,n){var r=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}).vgChannel;return _R(r?UW(e,t,n.style):void 0,UW(e,t,n.style),r?n[t.type][r]:void 0,n[t.type][e],r?n.mark[r]:n.mark[e])}function UW(e,t,n){return WW(e,BW(t),n)}function WW(e,t,n){var r;t=AN(t);var i,a=p(t);try{for(a.s();!(i=a.n()).done;){var o=n[i.value];o&&void 0!==o[e]&&(r=o[e])}}catch(s){a.e(s)}finally{a.f()}return r}function VW(e,t){return AN(e).reduce((function(e,n){var r;return e.field.push(dW(n,t)),e.order.push(null!==(r=n.sort)&&void 0!==r?r:"ascending"),e}),{field:[],order:[]})}function GW(e,t){var n=h(e);return t.forEach((function(e){var t,r=p(n);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(HN(i,e))return}}catch(a){r.e(a)}finally{r.f()}n.push(e)})),n}function qW(e,t){return HN(e,t)||!t?e:e?[].concat(h(AN(e)),h(AN(t))).join(", "):t}function HW(e,t){var n=e.value,r=t.value;if(null==n||null===r)return{explicit:e.explicit,value:null};if((IW(n)||kz(n))&&(IW(r)||kz(r)))return{explicit:e.explicit,value:qW(n,r)};if(IW(n)||kz(n))return{explicit:e.explicit,value:n};if(IW(r)||kz(r))return{explicit:e.explicit,value:r};if(!(IW(n)||kz(n)||IW(r)||kz(r)))return{explicit:e.explicit,value:GW(n,r)};throw new Error("It should never reach here")}function XW(e,t){var n=e&&e[t];return!!n&&(wN(n)?eR(n,(function(e){return!!e.field})):eW(n)||ZU(n))}function KW(e){return eR(iB,(function(t){if(XW(e,t)){var n=e[t];if(wN(n))return eR(n,(function(e){return!!e.aggregate}));var r=_W(n);return r&&!!r.aggregate}return!1}))}function YW(e,t){var n=[],r=[],i=[],a=[],o={};return JW(e,(function(s,u){if(eW(s)){var c=s.field,l=s.aggregate,f=s.bin,d=s.timeUnit,h=RN(s,["field","aggregate","bin","timeUnit"]);if(l||d||f){var p,m=bW(s),v=m&&m.title,g=dW(s,{forAs:!0}),y=Object.assign(Object.assign(Object.assign({},v?[]:{title:yW(s,t,{allowDisabling:!0})}),h),{field:g});if(l){if(cP(l)?(p="argmax",g=dW({op:"argmax",field:l.argmax},{forAs:!0}),y.field="".concat(g,".").concat(c)):uP(l)?(p="argmin",g=dW({op:"argmin",field:l.argmin},{forAs:!0}),y.field="".concat(g,".").concat(c)):"boxplot"!==l&&"errorbar"!==l&&"errorband"!==l&&(p=l),p){var b={op:p,as:g};c&&(b.field=c),a.push(b)}}else if(n.push(g),oW(s)&&FB(f)){if(r.push({bin:f,field:c,as:g}),n.push(dW(s,{binSuffix:"end"})),MW(s,u)&&n.push(dW(s,{binSuffix:"range"})),bB(u)){var x={field:g+"_end"};o[u+"2"]=x}y.bin="binned",lB(u)||(y.type=Wz)}else if(d){i.push({timeUnit:d,field:c,as:g});var w=oW(s)&&s.type!==Gz&&"time";w&&(u===UP||u===qP?y.formatType=w:function(e){return!!mB[e]}(u)?y.legend=Object.assign({formatType:w},y.legend):bB(u)&&(y.axis=Object.assign({formatType:w},y.axis)))}o[u]=y}else n.push(c),o[u]=e[u]}else o[u]=e[u]})),{bins:r,timeUnits:i,aggregate:a,groupby:n,encoding:o}}function $W(e,t,n){var r=t.type;return uR(e).reduce((function(i,a){if(!uB(a))return oz(P.invalidEncodingChannel(a)),i;var o=e[a];if("angle"!==a||"arc"!==r||e.theta||(oz(P.REPLACE_ANGLE_WITH_THETA),a=EP),!function(e,t,n){var r=OB(t,n);if(!r)return!1;if("binned"===r){var i=e[t===xP?yP:bP];return!!(eW(i)&&eW(e[t])&&IB(i.bin))}return!0}(e,a,r))return oz(P.incompatibleChannel(a,r)),i;if(a===IP&&"line"===r){var s=_W(e[a]);if(null===s||void 0===s?void 0:s.aggregate)return oz(P.LINE_WITH_VARYING_SIZE),i}if(a===TP&&(t.filled?"fill"in e:"stroke"in e))return oz(P.droppingColor("encoding",{fill:"fill"in e,stroke:"stroke"in e})),i;if(a===VP||a===WP&&!wN(o)&&!sW(o)||a===qP&&wN(o))o&&(i[a]=AN(o).reduce((function(e,t){return eW(t)?e.push(CW(t,a)):oz(P.emptyFieldDef(t,a)),e}),[]));else{if(a===qP&&null===o)i[a]=null;else if(!(eW(o)||nW(o)||sW(o)||JU(o)||kz(o)))return oz(P.emptyFieldDef(o,a)),i;i[a]=EW(o,a,n)}return i}),{})}function JW(e,t,n){if(e){var r,i=p(uR(e));try{for(i.s();!(r=i.n()).done;){var a=r.value,o=e[a];if(wN(o)){var s,u=p(o);try{for(u.s();!(s=u.n()).done;){var c=s.value;t.call(n,c,a)}}catch(l){u.e(l)}finally{u.f()}}else t.call(n,o,a)}}catch(l){i.e(l)}finally{i.f()}}}function ZW(e,t,n,r){return e?uR(e).reduce((function(n,i){var a=e[i];return wN(a)?a.reduce((function(e,n){return t.call(r,e,n,i)}),n):t.call(r,n,a,i)}),n):n}function QW(e,t){return uR(t).reduce((function(n,r){switch(r){case yP:case bP:case HP:case KP:case XP:case xP:case wP:case EP:case SP:case _P:case kP:case CP:case AP:case OP:case DP:case UP:case FP:case NP:case qP:return n;case WP:if("line"===e||"trail"===e)return n;case VP:case GP:var i=t[r];if(wN(i)||eW(i)){var a,o=p(AN(i));try{for(o.s();!(a=o.n()).done;){var s=a.value;s.aggregate||n.push(dW(s,{}))}}catch(c){o.e(c)}finally{o.f()}}return n;case IP:if("trail"===e)return n;case TP:case jP:case MP:case RP:case PP:case BP:case zP:case LP:var u=_W(t[r]);return u&&!u.aggregate&&n.push(dW(u,{})),n}}),[])}function eV(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return"tooltip"in n?{tooltip:n.tooltip}:{tooltip:[].concat(h(e.map((function(e){var n=e.fieldPrefix,i=e.titlePrefix,a=r?" of ".concat(t.field):"";return{field:n+t.field,type:t.type,title:kz(i)?{signal:i+'"'.concat(escape(a),'"')}:i+a}}))),h(function(e){var t,n=[],r=p(uR(e));try{for(r.s();!(t=r.n()).done;){var i=t.value;if(XW(e,i)){var a,o=e[i],s=AN(o),u=p(s);try{for(u.s();!(a=u.n()).done;){var c=a.value;eW(c)?n.push(c):ZU(c)&&n.push(c.condition)}}catch(l){u.e(l)}finally{u.f()}}}}catch(l){r.e(l)}finally{r.f()}return n}(n)))}}function tV(e){var t=e.axis,n=e.title,r=e.field;return t&&void 0!==t.title?void 0:_R(n,r)}function nV(e,t,n,r,i){var a=n.scale,o=n.axis;return function(s){var u=s.partName,c=s.mark,l=s.positionPrefix,f=s.endPositionPrefix,d=s.aria,h=s.extraEncoding,p=void 0===h?{}:h,m=tV(n);return rV(e,u,i,d,{mark:c,encoding:Object.assign(Object.assign(Object.assign(y({},t,Object.assign(Object.assign(Object.assign({field:l+"_"+n.field,type:n.type},void 0!==m?{title:m}:{}),void 0!==a?{scale:a}:{}),void 0!==o?{axis:o}:{})),FN(f)?y({},t+"2",{field:f+"_"+n.field}):{}),r),p)})}}function rV(e,t,n,r,i){var a=e.clip,o=e.color,s=e.opacity,u=e.type;return e[t]||void 0===e[t]&&n[t]?[Object.assign(Object.assign({},i),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n[t]),a?{clip:a}:{}),o?{color:o}:{}),s?{opacity:s}:{}),ZR(i.mark)?i.mark:{type:i.mark}),{style:"".concat(u,"-").concat(t)}),jN(e[t])?{}:e[t]),!1===r?{aria:r}:{})})]:[]}function iV(e,t,n){var r=e.encoding,i="vertical"===t?"y":"x",a=r[i],o=r[i+"2"],s=r[i+"Error"],u=r[i+"Error2"];return{continuousAxisChannelDef:aV(a,n),continuousAxisChannelDef2:aV(o,n),continuousAxisChannelDefError:aV(s,n),continuousAxisChannelDefError2:aV(u,n),continuousAxis:i}}function aV(e,t){if(e&&e.aggregate){var n=e.aggregate,r=RN(e,["aggregate"]);return n!==t&&oz(P.errorBarContinuousAxisHasCustomizedAggregate(n,t)),r}return e}function oV(e,t){var n=e.mark,r=e.encoding,i=r.x,a=r.y;if(rW(i)){if(rW(a)){var o=eW(i)&&i.aggregate,s=eW(a)&&a.aggregate;if(o||s!==t){if(s||o!==t){if(o===t&&s===t)throw new Error("Both x and y cannot have aggregate");return ZR(n)&&n.orient?n.orient:"vertical"}return"horizontal"}return"vertical"}return"horizontal"}if(rW(a))return"vertical";throw new Error("Need a valid continuous axis for "+t+"s")}var sV="boxplot",uV=new aP(sV,lV);function cV(e){return MN(e)?"tukey":e}function lV(e,t){var n,r,i=t.config,a=e.mark,o=(e.encoding,e.selection),s=(e.projection,RN(e,["mark","encoding","selection","projection"])),u=ZR(a)?a:{type:a};o&&oz(P.selectionNotSupported("boxplot"));var c,l=null!==(n=u.extent)&&void 0!==n?n:i.boxplot.extent,f=LW("size",u,i),d=cV(l),m=function(e,t,n){var r=oV(e,sV),i=iV(e,r,sV),a=i.continuousAxisChannelDef,o=i.continuousAxis,s=a.field,u=cV(t),c=[].concat(h(fV(s)),[{op:"median",field:s,as:"mid_box_"+s},{op:"min",field:s,as:("min-max"===u?"lower_whisker_":"min_")+s},{op:"max",field:s,as:("min-max"===u?"upper_whisker_":"max_")+s}]),l="min-max"===u||"tukey"===u?[]:[{calculate:'datum["upper_box_'.concat(s,'"] - datum["lower_box_').concat(s,'"]'),as:"iqr_"+s},{calculate:'min(datum["upper_box_'.concat(s,'"] + datum["iqr_').concat(s,'"] * ').concat(t,', datum["max_').concat(s,'"])'),as:"upper_whisker_"+s},{calculate:'max(datum["lower_box_'.concat(s,'"] - datum["iqr_').concat(s,'"] * ').concat(t,', datum["min_').concat(s,'"])'),as:"lower_whisker_"+s}],f=e.encoding,d=o,m=function(e){var t,n,r=e.tooltip,i=RN(e,["tooltip"]);if(!r)return{filteredEncoding:e};if(wN(r)){var a,o=p(r);try{for(o.s();!(a=o.n()).done;){var s=a.value;s.aggregate?(t||(t=[]),t.push(s)):(n||(n=[]),n.push(s))}}catch(u){o.e(u)}finally{o.f()}t&&(i.tooltip=t)}else r.aggregate?i.tooltip=r:n=r;return wN(n)&&1===n.length&&(n=n[0]),{customTooltipWithoutAggregatedField:n,filteredEncoding:i}}((f[d],RN(f,["symbol"==typeof d?d:d+""]))),v=m.customTooltipWithoutAggregatedField,g=YW(m.filteredEncoding,n),y=g.bins,b=g.timeUnits,x=g.aggregate,w=g.groupby,_=g.encoding;return{transform:[].concat(h(y),h(b),[{aggregate:[].concat(h(x),h(c)),groupby:w}],l),groupby:w,aggregate:x,continuousAxisChannelDef:a,continuousAxis:o,encodingWithoutContinuousAxis:_,ticksOrient:"vertical"===r?"horizontal":"vertical",boxOrient:r,customTooltipWithoutAggregatedField:v}}(e,l,i),v=m.transform,g=m.continuousAxisChannelDef,b=m.continuousAxis,x=m.groupby,w=m.aggregate,_=m.encodingWithoutContinuousAxis,k=m.ticksOrient,E=m.boxOrient,S=m.customTooltipWithoutAggregatedField,C=(_.color,_.size),A=RN(_,["color","size"]),O=function(e){return nV(u,b,g,e,i.boxplot)},D=O(A),T=O(_),j=O(Object.assign(Object.assign({},A),C?{size:C}:{})),M=eV([{fieldPrefix:"min-max"===d?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:"min-max"===d?"lower_whisker_":"min_",titlePrefix:"Min"}],g,_),F={type:"tick",color:"black",opacity:1,orient:k,invalid:null},I="min-max"===d?M:eV([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],g,_),N=[].concat(h(D({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",aria:!1,extraEncoding:I})),h(D({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",aria:!1,extraEncoding:I})),h(D({partName:"ticks",mark:F,positionPrefix:"lower_whisker",aria:!1,extraEncoding:I})),h(D({partName:"ticks",mark:F,positionPrefix:"upper_whisker",aria:!1,extraEncoding:I}))),R=[].concat(h("tukey"!==d?N:[]),h(T({partName:"box",mark:Object.assign(Object.assign({type:"bar"},f?{size:f}:{}),{orient:E,invalid:null}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",aria:!1,extraEncoding:M})),h(j({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:null},_N(i.boxplot.median)&&i.boxplot.median.color?{color:i.boxplot.median.color}:{}),f?{size:f}:{}),{orient:k,ariaRoleDescription:"box"}),positionPrefix:"mid_box",extraEncoding:M})));if("min-max"!==d){var B='datum["lower_box_'.concat(g.field,'"]'),L='datum["upper_box_'.concat(g.field,'"]'),z="(".concat(L," - ").concat(B,")"),U="".concat(B," - ").concat(l," * ").concat(z),W="".concat(L," + ").concat(l," * ").concat(z),V='datum["'.concat(g.field,'"]'),G={joinaggregate:fV(g.field),groupby:x},q=void 0;"tukey"===d&&(q={transform:[{filter:"(".concat(U," <= ").concat(V,") && (").concat(V," <= ").concat(W,")")},{aggregate:[{op:"min",field:g.field,as:"lower_whisker_"+g.field},{op:"max",field:g.field,as:"upper_whisker_"+g.field},{op:"min",field:"lower_box_"+g.field,as:"lower_box_"+g.field},{op:"max",field:"upper_box_"+g.field,as:"upper_box_"+g.field}].concat(h(w)),groupby:x}],layer:N}),A.tooltip;var H=RN(A,["tooltip"]),X=g.scale,K=g.axis,Y=tV(g),$=rV(u,"outliers",i.boxplot,!0,{transform:[{filter:"(".concat(V," < ").concat(U,") || (").concat(V," > ").concat(W,")")}],mark:"point",encoding:Object.assign(Object.assign(y({},b,Object.assign(Object.assign(Object.assign({field:g.field,type:g.type},void 0!==Y?{title:Y}:{}),void 0!==X?{scale:X}:{}),void 0!==K?{axis:K}:{})),H),S?{tooltip:S}:{})})[0];$&&q?c={transform:[G],layer:[$,q]}:$?(c=$).transform.unshift(G):q&&(c=q).transform.unshift(G)}return c?Object.assign(Object.assign({},s),{layer:[c,{transform:v,layer:R}]}):Object.assign(Object.assign({},s),{transform:(null!==(r=s.transform)&&void 0!==r?r:[]).concat(v),layer:R})}function fV(e){return[{op:"q1",field:e,as:"lower_box_"+e},{op:"q3",field:e,as:"upper_box_"+e}]}var dV="errorbar",hV=new aP(dV,pV);function pV(e,t){var n=t.config,r=vV(e,dV,n),i=r.transform,a=r.continuousAxisChannelDef,o=r.continuousAxis,s=r.encodingWithoutContinuousAxis,u=r.ticksOrient,c=r.markDef,l=r.outerSpec,f=r.tooltipEncoding,d=nV(c,o,a,s,n.errorbar),p={type:"tick",orient:u},m=[].concat(h(d({partName:"ticks",mark:p,positionPrefix:"lower",aria:!1,extraEncoding:f})),h(d({partName:"ticks",mark:p,positionPrefix:"upper",aria:!1,extraEncoding:f})),h(d({partName:"rule",mark:{type:"rule",ariaRoleDescription:"errorbar"},positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:f})));return Object.assign(Object.assign(Object.assign({},l),{transform:i}),m.length>1?{layer:m}:Object.assign({},m[0]))}function mV(e,t){var n=e.encoding;if(function(e){return(aW(e.x)||aW(e.y))&&!aW(e.x2)&&!aW(e.y2)&&!aW(e.xError)&&!aW(e.xError2)&&!aW(e.yError)&&!aW(e.yError2)}(n))return{orient:oV(e,t),inputType:"raw"};var r=function(e){return aW(e.x2)||aW(e.y2)}(n),i=function(e){return aW(e.xError)||aW(e.xError2)||aW(e.yError)||aW(e.yError2)}(n),a=n.x,o=n.y;if(r){if(i)throw new Error("".concat(t," cannot be both type aggregated-upper-lower and aggregated-error"));var s=n.x2,u=n.y2;if(aW(s)&&aW(u))throw new Error("".concat(t," cannot have both x2 and y2"));if(aW(s)){if(rW(a))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error("Both x and x2 have to be quantitative in ".concat(t))}if(aW(u)){if(rW(o))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error("Both y and y2 have to be quantitative in ".concat(t))}throw new Error("No ranged axis")}var c=n.xError,l=n.xError2,f=n.yError,d=n.yError2;if(aW(l)&&!aW(c))throw new Error("".concat(t," cannot have xError2 without xError"));if(aW(d)&&!aW(f))throw new Error("".concat(t," cannot have yError2 without yError"));if(aW(c)&&aW(f))throw new Error("".concat(t," cannot have both xError and yError with both are quantiative"));if(aW(c)){if(rW(a))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}if(aW(f)){if(rW(o))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}function vV(e,t,n){var r,i=e.mark,a=e.encoding,o=e.selection,s=(e.projection,RN(e,["mark","encoding","selection","projection"])),u=ZR(i)?i:{type:i};o&&oz(P.selectionNotSupported(t));var c=mV(e,t),l=c.orient,f=c.inputType,d=iV(e,l,t),m=d.continuousAxisChannelDef,v=d.continuousAxisChannelDef2,g=d.continuousAxisChannelDefError,y=d.continuousAxisChannelDefError2,b=d.continuousAxis,x=function(e,t,n,r,i,a,o,s){var u,c=[],l=[],f=t.field,d=!1;if("raw"===a){var h,m,v,g=e.center?e.center:e.extent?"iqr"===e.extent?"median":"mean":s.errorbar.center,y=e.extent?e.extent:"mean"===g?"stderr":"iqr";"median"===g!=("iqr"===y)&&oz(P.errorBarCenterIsUsedWithWrongExtent(g,y,o)),"stderr"===y||"stdev"===y?(c=[{op:y,field:f,as:"extent_"+f},{op:g,field:f,as:"center_"+f}],l=[{calculate:'datum["center_'.concat(f,'"] + datum["extent_').concat(f,'"]'),as:"upper_"+f},{calculate:'datum["center_'.concat(f,'"] - datum["extent_').concat(f,'"]'),as:"lower_"+f}],u=[{fieldPrefix:"center_",titlePrefix:mR(g)},{fieldPrefix:"upper_",titlePrefix:gV(g,y,"+")},{fieldPrefix:"lower_",titlePrefix:gV(g,y,"-")}],d=!0):(e.center&&e.extent&&oz(P.errorBarCenterIsNotNeeded(e.extent,o)),"ci"===y?(h="mean",m="ci0",v="ci1"):(h="median",m="q1",v="q3"),c=[{op:m,field:f,as:"lower_"+f},{op:v,field:f,as:"upper_"+f},{op:h,field:f,as:"center_"+f}],u=[{fieldPrefix:"upper_",titlePrefix:yW({field:f,aggregate:v,type:"quantitative"},s,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:yW({field:f,aggregate:m,type:"quantitative"},s,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:yW({field:f,aggregate:h,type:"quantitative"},s,{allowDisabling:!1})}])}else{(e.center||e.extent)&&oz(P.errorBarCenterAndExtentAreNotNeeded(e.center,e.extent)),"aggregated-upper-lower"===a?(u=[],l=[{calculate:'datum["'.concat(n.field,'"]'),as:"upper_"+f},{calculate:'datum["'.concat(f,'"]'),as:"lower_"+f}]):"aggregated-error"===a&&(u=[{fieldPrefix:"",titlePrefix:f}],l=[{calculate:'datum["'.concat(f,'"] + datum["').concat(r.field,'"]'),as:"upper_"+f}],i?l.push({calculate:'datum["'.concat(f,'"] + datum["').concat(i.field,'"]'),as:"lower_"+f}):l.push({calculate:'datum["'.concat(f,'"] - datum["').concat(r.field,'"]'),as:"lower_"+f}));var b,x=p(l);try{for(x.s();!(b=x.n()).done;){var w=b.value;u.push({fieldPrefix:w.as.substring(0,6),titlePrefix:bR(bR(w.calculate,'datum["',""),'"]',"")})}}catch(_){x.e(_)}finally{x.f()}}return{postAggregateCalculates:l,errorBarSpecificAggregate:c,tooltipSummary:u,tooltipTitleWithFieldName:d}}(u,m,v,g,y,f,t,n),w=x.errorBarSpecificAggregate,_=x.postAggregateCalculates,k=x.tooltipSummary,E=x.tooltipTitleWithFieldName,S=a,C=b,A=(S[C],"x"===b?"x2":"y2"),O=(S[A],"x"===b?"xError":"yError"),D=(S[O],"x"===b?"xError2":"yError2"),T=YW((S[D],RN(S,["symbol"==typeof C?C:C+"","symbol"==typeof A?A:A+"","symbol"==typeof O?O:O+"","symbol"==typeof D?D:D+""])),n),j=T.bins,M=T.timeUnits,F=T.aggregate,I=T.groupby,N=T.encoding,R=[].concat(h(F),h(w)),B="raw"!==f?[]:I,L=eV(k,m,N,E);return{transform:[].concat(h(null!==(r=s.transform)&&void 0!==r?r:[]),h(j),h(M),h(0===R.length?[]:[{aggregate:R,groupby:B}]),h(_)),groupby:B,continuousAxisChannelDef:m,continuousAxis:b,encodingWithoutContinuousAxis:N,ticksOrient:"vertical"===l?"horizontal":"vertical",markDef:u,outerSpec:s,tooltipEncoding:L}}function gV(e,t,n){return mR(e)+" "+n+" "+t}var yV="errorband",bV=new aP(yV,xV);function xV(e,t){var n=t.config,r=vV(e,yV,n),i=r.transform,a=r.continuousAxisChannelDef,o=r.continuousAxis,s=r.encodingWithoutContinuousAxis,u=r.markDef,c=r.outerSpec,l=r.tooltipEncoding,f=u,d=nV(f,o,a,s,n.errorband),p=void 0!==e.encoding.x&&void 0!==e.encoding.y,m={type:p?"area":"rect"},v={type:p?"line":"rule"},g=Object.assign(Object.assign({},f.interpolate?{interpolate:f.interpolate}:{}),f.tension&&f.interpolate?{tension:f.tension}:{});return p?(m=Object.assign(Object.assign(Object.assign({},m),g),{ariaRoleDescription:"errorband"}),v=Object.assign(Object.assign({},v),g)):f.interpolate?oz(P.errorBand1DNotSupport("interpolate")):f.tension&&oz(P.errorBand1DNotSupport("tension")),Object.assign(Object.assign({},c),{transform:i,layer:[].concat(h(d({partName:"band",mark:m,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:l})),h(d({partName:"borders",mark:v,positionPrefix:"lower",aria:!1,extraEncoding:l})),h(d({partName:"borders",mark:v,positionPrefix:"upper",aria:!1,extraEncoding:l})))})}var wV={};function _V(e,t,n){var r=new aP(e,t);wV[e]={normalizer:r,parts:n}}_V(sV,lV,["box","median","outliers","rule","ticks"]),_V(dV,pV,["ticks","rule"]),_V(yV,xV,["band","borders"]);var kV=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],EV=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],SV={fillColor:{part:"legend",vgProp:"fill"},gradientStrokeColor:{part:"gradient",vgProp:"stroke"},labelColor:{part:"labels",vgProp:"fill"},strokeColor:{part:"legend",vgProp:"stroke"},symbolFillColor:{part:"symbols",vgProp:"fill"},symbolStrokeColor:{part:"symbols",vgProp:"stroke"},titleColor:{part:"title",vgProp:"fill"}},CV={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1},AV=(uR(CV),"_vgsid_"),OV={single:{on:"click",fields:[AV],resolve:"global",empty:"all",clear:"dblclick"},multi:{on:"click",fields:[AV],toggle:"event.shiftKey",resolve:"global",empty:"all",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function DV(e){return!(!e||"legend"!==e&&!e.legend)}function TV(e){return DV(e)&&_N(e)}function jV(e){return"concat"in e}function MV(e){return"vconcat"in e}function FV(e){return"hconcat"in e}function IV(e){return _N(e)&&void 0!==e.step}function NV(e){return e.view||e.width||e.height}var RV=uR({align:1,bounds:1,center:1,columns:1,spacing:1});function PV(e,t){var n;return null!==(n=e[t])&&void 0!==n?n:e["width"===t?"continuousWidth":"continuousHeight"]}function BV(e,t){var n=LV(e,t);return IV(n)?n.step:zV}function LV(e,t){var n;return _R(null!==(n=e[t])&&void 0!==n?n:e["width"===t?"discreteWidth":"discreteHeight"],{step:e.step})}var zV=20,UV={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:{continuousWidth:200,continuousHeight:200,step:zV},mark:{color:"#4c78a8",invalid:"filter",timeUnitBand:1},arc:{},area:{},bar:nP,circle:{},geoshape:{},image:{},line:{},point:{},rect:rP,rule:{color:"black"},square:{},text:{color:"black"},tick:{thickness:1},trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:{pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4},projection:{},legend:{gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:OV,style:{},title:{},facet:{spacing:20},concat:{spacing:20}},WV=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],VV={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},GV={blue:WV[0],orange:WV[1],red:WV[2],teal:WV[3],green:WV[4],yellow:WV[5],purple:WV[6],pink:WV[7],brown:WV[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function qV(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.color,n=e.font,r=e.fontSize,i=RN(e,["color","font","fontSize"]);return EN({},UV,n?function(e){return{text:{font:e},style:{"guide-label":{font:e},"guide-title":{font:e},"group-title":{font:e},"group-subtitle":{font:e}}}}(n):{},t?function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{signals:[{name:"color",value:_N(e)?Object.assign(Object.assign({},GV),e):GV}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}(t):{},r?function(e){return{signals:[{name:"fontSize",value:_N(e)?Object.assign(Object.assign({},VV),e):VV}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}(r):{},i||{})}var HV=["view"].concat(h(JR)),XV=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],KV=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},{area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]});function YV(e){e=XN(e);var t,n=p(XV);try{for(n.s();!(t=n.n()).done;)delete e[t.value]}catch(E){n.e(E)}finally{n.f()}if(e.axis)for(var r in e.axis)OR(e.axis[r])&&delete e.axis[r];if(e.legend){var i,a=p(kV);try{for(a.s();!(i=a.n()).done;){var o=i.value;delete e.legend[o]}}catch(E){a.e(E)}finally{a.f()}}if(e.mark){var s,u=p(eP);try{for(u.s();!(s=u.n()).done;){var c=s.value;delete e.mark[c]}}catch(E){u.e(E)}finally{u.f()}e.mark.tooltip&&_N(e.mark.tooltip)&&delete e.mark.tooltip}var l,f=p(HV);try{for(f.s();!(l=f.n()).done;){var d,h=l.value,m=p(eP);try{for(m.s();!(d=m.n()).done;){var v=d.value;delete e[h][v]}}catch(E){m.e(E)}finally{m.f()}var g=KV[h];if(g){var y,b=p(g);try{for(b.s();!(y=b.n()).done;){var x=y.value;delete e[h][x]}}catch(E){b.e(E)}finally{b.f()}}$V(e,h)}}catch(E){f.e(E)}finally{f.f()}var w,_=p(uR(wV));try{for(_.s();!(w=_.n()).done;)delete e[w.value]}catch(E){_.e(E)}finally{_.f()}for(var k in function(e){var t=FW(e.title),n=t.titleMarkConfig,r=t.subtitleMarkConfig,i=t.subtitle;sR(n)||(e.style["group-title"]=Object.assign(Object.assign({},e.style["group-title"]),n)),sR(r)||(e.style["group-subtitle"]=Object.assign(Object.assign({},e.style["group-subtitle"]),r)),sR(i)?delete e.title:e.title=i}(e),e)_N(e[k])&&sR(e[k])&&delete e[k];return sR(e)?void 0:e}function $V(e,t,n,r){var i=r?e[t][r]:e[t];"view"===t&&(n="cell");var a=Object.assign(Object.assign({},i),e.style[null!==n&&void 0!==n?n:t]);sR(a)||(e.style[null!==n&&void 0!==n?n:t]=a),r||delete e[t]}function JV(e){return"layer"in e}var ZV=function(){function e(){v(this,e)}return g(e,[{key:"map",value:function(e,t){return HU(e)?this.mapFacet(e,t):function(e){return"repeat"in e}(e)?this.mapRepeat(e,t):FV(e)?this.mapHConcat(e,t):MV(e)?this.mapVConcat(e,t):jV(e)?this.mapConcat(e,t):this.mapLayerOrUnit(e,t)}},{key:"mapLayerOrUnit",value:function(e,t){if(JV(e))return this.mapLayer(e,t);if(iP(e))return this.mapUnit(e,t);throw new Error(P.invalidSpec(e))}},{key:"mapLayer",value:function(e,t){var n=this;return Object.assign(Object.assign({},e),{layer:e.layer.map((function(e){return n.mapLayerOrUnit(e,t)}))})}},{key:"mapHConcat",value:function(e,t){var n=this;return Object.assign(Object.assign({},e),{hconcat:e.hconcat.map((function(e){return n.map(e,t)}))})}},{key:"mapVConcat",value:function(e,t){var n=this;return Object.assign(Object.assign({},e),{vconcat:e.vconcat.map((function(e){return n.map(e,t)}))})}},{key:"mapConcat",value:function(e,t){var n=this,r=e.concat,i=RN(e,["concat"]);return Object.assign(Object.assign({},i),{concat:r.map((function(e){return n.map(e,t)}))})}},{key:"mapFacet",value:function(e,t){return Object.assign(Object.assign({},e),{spec:this.map(e.spec,t)})}},{key:"mapRepeat",value:function(e,t){return Object.assign(Object.assign({},e),{spec:this.map(e.spec,t)})}}]),e}(),QV={zero:1,center:1,normalize:1},eG=new Set([NR,PR,RR,WR,zR,HR,XR,LR,VR,GR]),tG=new Set([PR,RR,NR]);function nG(e,t){var n,r,i="x"===t?"y":"radius",a=e[t],o=e[i];if(eW(a)&&eW(o))if("quantitative"===tW(a)&&"quantitative"===tW(o)){if(a.stack)return t;if(o.stack)return i;var s=eW(a)&&!!a.aggregate;if(s!==(eW(o)&&!!o.aggregate))return s?t:i;var u=null===(n=a.scale)||void 0===n?void 0:n.type,c=null===(r=o.scale)||void 0===r?void 0:r.type;if(u&&"linear"!==u)return i;if(c&&"linear"!==c)return t}else{if("quantitative"===tW(a))return t;if("quantitative"===tW(o))return i}else{if("quantitative"===tW(a))return t;if("quantitative"===tW(o))return i}}function rG(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=ZR(e)?e.type:e;if(!eG.has(r))return null;var i=nG(t,"x")||nG(t,"theta");if(!i)return null;var a=t[i],o=eW(a)?dW(a,{}):void 0,s=function(e){switch(e){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}(i),u=t[s],c=eW(u)?dW(u,{}):void 0;c===o&&(c=void 0,u=void 0,s=void 0);var l,f=vB.reduce((function(e,n){if("tooltip"!==n&&XW(t,n)){var r,i=t[n],a=p(AN(i));try{for(a.s();!(r=a.n()).done;){var o=_W(r.value);if(!o.aggregate){var s=dW(o,{});s&&s===c||e.push({channel:n,fieldDef:o})}}}catch(u){a.e(u)}finally{a.f()}}return e}),[]);if(void 0!==a.stack?l=jN(a.stack)?a.stack?"zero":null:a.stack:f.length>0&&tG.has(r)&&(l="zero"),!l||!function(e){return e in QV}(l))return null;if(KW(t)&&0===f.length)return null;if(a.scale&&a.scale.type&&a.scale.type!==Kz.LINEAR){if(n.disallowNonLinearStack)return null;oz(P.cannotStackNonLinearScale(a.scale.type))}return aW(t[hB(i)])?(void 0!==a.stack&&oz(P.cannotStackRangedMark(i)),null):(eW(a)&&a.aggregate&&!QN(hP,a.aggregate)&&oz(P.stackNonSummativeAggregate(a.aggregate)),{groupbyChannel:u?s:void 0,groupbyField:c,fieldChannel:i,impute:null!==a.impute&&YR(r),stackBy:f,offset:l})}function iG(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return"transparent"===e.point?{opacity:0}:e.point?_N(e.point)?e.point:{}:void 0!==e.point?null:t.point||n.shape?_N(t.point)?t.point:{}:void 0}function aG(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.line?!0===e.line?{}:e.line:void 0!==e.line?null:t.line?!0===t.line?{}:t.line:void 0}var oG=function(){function e(){v(this,e),this.name="path-overlay"}return g(e,[{key:"hasMatchingType",value:function(e,t){if(iP(e)){var n=e.mark,r=e.encoding,i=ZR(n)?n:{type:n};switch(i.type){case"line":case"rule":case"trail":return!!iG(i,t[i.type],r);case"area":return!!iG(i,t[i.type],r)||!!aG(i,t[i.type])}}return!1}},{key:"run",value:function(e,t,n){var r=t.config,i=e.selection,a=e.projection,o=e.encoding,s=e.mark,u=RN(e,["selection","projection","encoding","mark"]),c=ZR(s)?s:{type:s},l=iG(c,r[c.type],o),f="area"===c.type&&aG(c,r[c.type]),d=[Object.assign(Object.assign({},i?{selection:i}:{}),{mark:function(e){e.point,e.line;var t=RN(e,["point","line"]);return uR(t).length>1?t:t.type}(Object.assign(Object.assign({},"area"===c.type&&void 0===c.opacity&&void 0===c.fillOpacity?{opacity:.7}:{}),c)),encoding:YN(o,["shape"])})],h=rG(c,o),p=o;if(h){var m=h.fieldChannel,v=h.offset;p=Object.assign(Object.assign({},o),y({},m,Object.assign(Object.assign({},o[m]),v?{stack:v}:{})))}return f&&d.push(Object.assign(Object.assign({},a?{projection:a}:{}),{mark:Object.assign(Object.assign({type:"line"},KN(c,["clip","interpolate","tension","tooltip"])),f),encoding:p})),l&&d.push(Object.assign(Object.assign({},a?{projection:a}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:!0},KN(c,["clip","tooltip"])),l),encoding:p})),n(Object.assign(Object.assign({},u),{layer:d}),Object.assign(Object.assign({},t),{config:function(e){for(var t=0,n=["line","area","rule","trail"];t<n.length;t++){var r=n[t];e[r]&&(e=Object.assign(Object.assign({},e),y({},r,YN(e[r],["point","line"]))))}return e}(r)}))}}]),e}(),sG=function(){function e(){v(this,e),this.name="RangeStep"}return g(e,[{key:"hasMatchingType",value:function(e){var t;if(iP(e)&&e.encoding){var n,r=p(yB);try{for(r.s();!(n=r.n()).done;){var i=n.value,a=e.encoding[i];if(a&&aW(a)&&(null===(t=null===a||void 0===a?void 0:a.scale)||void 0===t?void 0:t.rangeStep))return!0}}catch(o){r.e(o)}finally{r.f()}}return!1}},{key:"run",value:function(e){var t,n,r={},i=Object.assign({},e.encoding),a=p(yB);try{for(a.s();!(n=a.n()).done;){var o=n.value,s=pB(o),u=i[o];if(u&&aW(u)&&(null===(t=null===u||void 0===u?void 0:u.scale)||void 0===t?void 0:t.rangeStep)){var c=u.scale,l=RN(u,["scale"]),f=c,d=(f.rangeStep,RN(f,["rangeStep"]));r[s]={step:c.rangeStep},oz(P.RANGE_STEP_DEPRECATED),i=Object.assign(Object.assign({},i),y({},o,Object.assign(Object.assign({},l),sR(d)?{}:{scale:d})))}}}catch(h){a.e(h)}finally{a.f()}return Object.assign(Object.assign(Object.assign({},r),e),{encoding:i})}}]),e}();function uG(e,t){return t?hG(e,t):e}function cG(e,t,n){var r=t[e];return function(e){return e&&!FN(e)&&"repeat"in e}(r)?r.repeat in n?Object.assign(Object.assign({},t),y({},e,n[r.repeat])):void oz(P.noSuchRepeatedValue(r.repeat)):t}function lG(e,t){if(void 0!==(e=cG("field",e,t))){if(null===e)return null;if(KU(e)&&WU(e.sort)){var n=cG("field",e.sort,t);e=Object.assign(Object.assign({},e),n?{sort:n}:{})}return e}}function fG(e,t){if(eW(e))return lG(e,t);var n=cG("datum",e,t);return n===e||n.type||(n.type="nominal"),n}function dG(e,t){if(!aW(e)){if(QU(e)){var n=fG(e.condition,t);return n?Object.assign(Object.assign({},e),{condition:n}):(e.condition,RN(e,["condition"]))}return e}var r=fG(e,t);return r||(JU(e)?{condition:e.condition}:void 0)}function hG(e,t){var n={};for(var r in e)if(TN(e,r)){var i=e[r];if(wN(i))n[r]=i.map((function(e){return dG(e,t)})).filter((function(e){return e}));else{var a=dG(i,t);void 0!==a&&(n[r]=a)}}return n}var pG=function(){function e(){v(this,e),this.name="RuleForRangedLine"}return g(e,[{key:"hasMatchingType",value:function(e){if(iP(e)){var t=e.encoding;if("line"===e.mark)for(var n=0,r=cB;n<r.length;n++){var i=r[n],a=t[fB(i)];if(t[i]&&(eW(a)&&!IB(a.bin)||nW(a)))return!0}}return!1}},{key:"run",value:function(e,t,n){var r=e.encoding;return oz(P.lineWithRange(!!r.x2,!!r.y2)),n(Object.assign(Object.assign({},e),{mark:"rule"}),t)}}]),e}();function mG(e){var t=e.parentEncoding,n=e.encoding;if(t&&n){var r=uR(t).reduce((function(e,t){return n[t]&&e.push(t),e}),[]);r.length>0&&oz(P.encodingOverridden(r))}var i=Object.assign(Object.assign({},null!==t&&void 0!==t?t:{}),null!==n&&void 0!==n?n:{});return sR(i)?void 0:i}function vG(e){var t=e.parentProjection,n=e.projection;return t&&n&&oz(P.projectionOverridden({parentProjection:t,projection:n})),null!==n&&void 0!==n?n:t}function gG(e,t){void 0===t&&(t=qV(e.config));var n=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return yG.map(e,{config:t})}(e,t),r=function(e,t,n){var r=t.width,i=t.height,a=iP(e)||JV(e),o={};a?"container"==r&&"container"==i?(o.type="fit",o.contains="padding"):"container"==r?(o.type="fit-x",o.contains="padding"):"container"==i&&(o.type="fit-y",o.contains="padding"):("container"==r&&(oz(P.containerSizeNonSingle("width")),r=void 0),"container"==i&&(oz(P.containerSizeNonSingle("height")),i=void 0));var s=Object.assign(Object.assign(Object.assign({type:"pad"},o),n?bG(n.autosize):{}),bG(e.autosize));if("fit"!==s.type||a||(oz(P.FIT_NON_SINGLE),s.type="pad"),"container"==r&&"fit"!=s.type&&"fit-x"!=s.type&&oz(P.containerSizeNotCompatibleWithAutosize("width")),"container"==i&&"fit"!=s.type&&"fit-y"!=s.type&&oz(P.containerSizeNotCompatibleWithAutosize("height")),!HN(s,{type:"pad"}))return s}(n,{width:e.width,height:e.height,autosize:e.autosize},t);return Object.assign(Object.assign({},n),r?{autosize:r}:{})}var yG=new(function(e){c(n,e);var t=l(n);function n(){var e;return v(this,n),(e=t.apply(this,arguments)).nonFacetUnitNormalizers=[uV,hV,bV,new oG,new pG,new sG],e}return g(n,[{key:"map",value:function(e,t){if(iP(e)){var r=XW(e.encoding,mP),i=XW(e.encoding,vP),a=XW(e.encoding,gP);if(r||i||a)return this.mapFacetedUnit(e,t)}return s(u(n.prototype),"map",this).call(this,e,t)}},{key:"mapUnit",value:function(e,t){var n=t.parentEncoding,r=t.parentProjection,i=Object.assign(Object.assign({},e),{encoding:uG(e.encoding,t.repeater)});if(n||r)return this.mapUnitWithParentEncodingOrProjection(i,t);var a,o=this.mapLayerOrUnit.bind(this),s=p(this.nonFacetUnitNormalizers);try{for(s.s();!(a=s.n()).done;){var u=a.value;if(u.hasMatchingType(i,t.config))return u.run(i,t,o)}}catch(c){s.e(c)}finally{s.f()}return i}},{key:"mapRepeat",value:function(e,t){return function(e){return!wN(e.repeat)&&e.repeat.layer}(e)?this.mapLayerRepeat(e,t):this.mapNonLayerRepeat(e,t)}},{key:"mapLayerRepeat",value:function(e,t){var n=this,r=e.repeat,i=e.spec,a=RN(e,["repeat","spec"]),o=r.row,s=r.column,u=r.layer,c=t.repeater,l=void 0===c?{}:c,f=t.repeaterPrefix,d=void 0===f?"":f;return o||s?this.mapRepeat(Object.assign(Object.assign({},e),{repeat:Object.assign(Object.assign({},o?{row:o}:{}),s?{column:s}:{}),spec:{repeat:{layer:u},spec:i}}),t):Object.assign(Object.assign({},a),{layer:u.map((function(e){var r=Object.assign(Object.assign({},l),{layer:e}),a=(i.name||"")+d+"child__layer_".concat(dR(e)),o=n.mapLayerOrUnit(i,Object.assign(Object.assign({},t),{repeater:r,repeaterPrefix:a}));return o.name=a,o}))})}},{key:"mapNonLayerRepeat",value:function(e,t){var n,r=e,i=r.repeat,a=r.spec,o=r.data,s=RN(e,["repeat","spec","data"]);!wN(i)&&e.columns&&(e=YN(e,["columns"]),oz(P.columnsNotSupportByRowCol("repeat")));var u,c=[],l=t.repeater,f=void 0===l?{}:l,d=t.repeaterPrefix,h=void 0===d?"":d,m=!wN(i)&&i.row||[f?f.row:null],v=!wN(i)&&i.column||[f?f.column:null],g=wN(i)&&i||[f?f.repeat:null],y=p(g);try{for(y.s();!(u=y.n()).done;){var b,x=u.value,w=p(m);try{for(w.s();!(b=w.n()).done;){var _,k=b.value,E=p(v);try{for(E.s();!(_=E.n()).done;){var S=_.value,C={repeat:x,row:k,column:S,layer:f.layer},A=(a.name||"")+h+"child__"+(wN(i)?"".concat(dR(x)):(i.row?"row_".concat(dR(k)):"")+(i.column?"column_".concat(dR(S)):"")),O=this.map(a,Object.assign(Object.assign({},t),{repeater:C,repeaterPrefix:A}));O.name=A,c.push(YN(O,["data"]))}}catch(T){E.e(T)}finally{E.f()}}}catch(T){w.e(T)}finally{w.f()}}}catch(T){y.e(T)}finally{y.f()}var D=wN(i)?e.columns:i.column?i.column.length:1;return Object.assign(Object.assign({data:null!==(n=a.data)&&void 0!==n?n:o,align:"all"},s),{columns:D,concat:c})}},{key:"mapFacet",value:function(e,t){return GU(e.facet)&&e.columns&&(e=YN(e,["columns"]),oz(P.columnsNotSupportByRowCol("facet"))),s(u(n.prototype),"mapFacet",this).call(this,e,t)}},{key:"mapUnitWithParentEncodingOrProjection",value:function(e,t){var n=e.encoding,r=e.projection,i=t.parentEncoding,a=t.parentProjection,o=t.config,s=vG({parentProjection:a,projection:r}),u=mG({parentEncoding:i,encoding:uG(n,t.repeater)});return this.mapUnit(Object.assign(Object.assign(Object.assign({},e),s?{projection:s}:{}),u?{encoding:u}:{}),{config:o})}},{key:"mapFacetedUnit",value:function(e,t){var n=e.encoding,r=n.row,i=n.column,a=n.facet,o=RN(n,["row","column","facet"]),s=e.mark,u=e.width,c=e.projection,l=e.height,f=e.view,d=e.selection,h=(e.encoding,RN(e,["mark","width","projection","height","view","selection","encoding"])),p=this.getFacetMappingAndLayout({row:r,column:i,facet:a},t),m=p.facetMapping,v=p.layout,g=uG(o,t.repeater);return this.mapFacet(Object.assign(Object.assign(Object.assign({},h),v),{facet:m,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},u?{width:u}:{}),l?{height:l}:{}),f?{view:f}:{}),c?{projection:c}:{}),{mark:s,encoding:g}),d?{selection:d}:{})}),t)}},{key:"getFacetMappingAndLayout",value:function(e,t){var n,r=e.row,i=e.column,a=e.facet;if(r||i){a&&oz(P.facetChannelDropped([].concat(h(r?[mP]:[]),h(i?[vP]:[]))));for(var o={},s={},u=0,c=[mP,vP];u<c.length;u++){var l=c[u],f=e[l];if(f){f.align,f.center,f.spacing,f.columns;var d=RN(f,["align","center","spacing","columns"]);o[l]=d;for(var p=0,m=["align","center","spacing"];p<m.length;p++){var v=m[p];void 0!==f[v]&&(s[v]=null!==(n=s[v])&&void 0!==n?n:{},s[v][l]=f[v])}}}return{facetMapping:o,layout:s}}var g=a.align,y=a.center,b=a.spacing,x=a.columns;return{facetMapping:function(e,t){return t?GU(e)?hG(e,t):lG(e,t):e}(RN(a,["align","center","spacing","columns"]),t.repeater),layout:Object.assign(Object.assign(Object.assign(Object.assign({},g?{align:g}:{}),y?{center:y}:{}),b?{spacing:b}:{}),x?{columns:x}:{})}}},{key:"mapLayer",value:function(e,t){var r=t.parentEncoding,i=t.parentProjection,a=RN(t,["parentEncoding","parentProjection"]),o=e.encoding,c=e.projection,l=RN(e,["encoding","projection"]),f=Object.assign(Object.assign({},a),{parentEncoding:mG({parentEncoding:r,encoding:o}),parentProjection:vG({parentProjection:i,projection:c})});return s(u(n.prototype),"mapLayer",this).call(this,l,f)}}]),n}(ZV));function bG(e){return FN(e)?{type:e}:null!==e&&void 0!==e?e:{}}var xG=["background","padding"];function wG(e){return xG.reduce((function(t,n){return e&&void 0!==e[n]&&(t[n]=e[n]),t}),{})}var _G=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};v(this,e),this.explicit=t,this.implicit=n}return g(e,[{key:"clone",value:function(){return new e(XN(this.explicit),XN(this.implicit))}},{key:"combine",value:function(){return Object.assign(Object.assign({},this.explicit),this.implicit)}},{key:"get",value:function(e){return _R(this.explicit[e],this.implicit[e])}},{key:"getWithExplicit",value:function(e){return void 0!==this.explicit[e]?{explicit:!0,value:this.explicit[e]}:void 0!==this.implicit[e]?{explicit:!1,value:this.implicit[e]}:{explicit:!1,value:void 0}}},{key:"setWithExplicit",value:function(e,t){void 0!==t.value&&this.set(e,t.value,t.explicit)}},{key:"set",value:function(e,t,n){return delete this[n?"implicit":"explicit"][e],this[n?"explicit":"implicit"][e]=t,this}},{key:"copyKeyFromSplit",value:function(e,t){void 0!==t.explicit[e]?this.set(e,t.explicit[e],!0):void 0!==t.implicit[e]&&this.set(e,t.implicit[e],!1)}},{key:"copyKeyFromObject",value:function(e,t){void 0!==t[e]&&this.set(e,t[e],!0)}},{key:"copyAll",value:function(e){var t,n=p(uR(e.combine()));try{for(n.s();!(t=n.n()).done;){var r=t.value,i=e.getWithExplicit(r);this.setWithExplicit(r,i)}}catch(a){n.e(a)}finally{n.f()}}}]),e}();function kG(e){return{explicit:!0,value:e}}function EG(e){return{explicit:!1,value:e}}function SG(e){return function(t,n,r,i){var a=e(t.value,n.value);return a>0?t:a<0?n:CG(t,n,r,i)}}function CG(e,t,n,r){return e.explicit&&t.explicit&&oz(P.mergeConflictingProperty(n,r,e.value,t.value)),e}function AG(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:CG;return void 0===e||void 0===e.value?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:HN(e.value,t.value)?e:i(e,t,n,r)}var OG=function(e){c(n,e);var t=l(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return v(this,n),(e=t.call(this,r,i)).explicit=r,e.implicit=i,e.parseNothing=a,e}return g(n,[{key:"clone",value:function(){var e=s(u(n.prototype),"clone",this).call(this);return e.parseNothing=this.parseNothing,e}}]),n}(_G);function DG(e){return"url"in e}function TG(e){return"values"in e}function jG(e){return"name"in e&&!DG(e)&&!TG(e)&&!MG(e)}function MG(e){return e&&(FG(e)||IG(e)||NG(e))}function FG(e){return"sequence"in e}function IG(e){return"sphere"in e}function NG(e){return"graticule"in e}var RG="main",PG="raw";function BG(e){return"filter"in e}function LG(e){return"lookup"in e}function zG(e){return"pivot"in e}function UG(e){return"density"in e}function WG(e){return"quantile"in e}function VG(e){return"regression"in e}function GG(e){return"loess"in e}function qG(e){return"sample"in e}function HG(e){return"window"in e}function XG(e){return"joinaggregate"in e}function KG(e){return"flatten"in e}function YG(e){return"calculate"in e}function $G(e){return"bin"in e}function JG(e){return"impute"in e}function ZG(e){return"timeUnit"in e}function QG(e){return"aggregate"in e}function eq(e){return"stack"in e}function tq(e){return"fold"in e}function nq(e){return e.map((function(e){return BG(e)?{filter:function e(t,n){return qN(t)?{not:e(t.not,n)}:GN(t)?{and:t.and.map((function(t){return e(t,n)}))}:VN(t)?{or:t.or.map((function(t){return e(t,n)}))}:n(t)}(e.filter,zz)}:e}))}function rq(e,t,n,r){var i=JU(t)&&t.condition,a=r(t);return i?y({},n,[].concat(h(AN(i).map((function(t){var n=r(t),i=function(e){return e.selection}(t)?sK(e,t.selection):cK(e,t.test);return Object.assign({test:i},n)}))),h(void 0!==a?[a]:[]))):void 0!==a?y({},n,a):{}}function iq(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"text",n=e.encoding[t];return rq(e,n,t,(function(t){return aq(t,e.config)}))}function aq(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"datum";if(e){if(sW(e))return NW(e.value);if(aW(e)){var r=wW(e);return DU({fieldOrDatumDef:e,format:r.format,formatType:r.formatType,expr:n,config:t})}}}function oq(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.encoding,r=e.markDef,i=e.config,a=e.stack,o=n.tooltip;if(wN(o))return{tooltip:uq({tooltip:o},a,i,t)};var s=t.reactiveGeom?"datum.datum":"datum";return rq(e,o,"tooltip",(function(e){var o=aq(e,i,s);if(o)return o;if(null!==e){var u=LW("tooltip",r,i);return!0===u&&(u={content:"encoding"}),FN(u)?{value:u}:_N(u)?"encoding"===u.content?uq(n,a,i,t):{signal:s}:void 0}}))}function sq(e,t,n){var r=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}).reactiveGeom,i={},a=r?"datum.datum":"datum",o=[];function s(r,s){var u,c=fB(s),l=oW(r)?r:Object.assign(Object.assign({},r),{type:e[c].type}),f=AN(yW(l,n,{allowDisabling:!1})).join(", ");if(bB(s)){var d="x"===s?"x2":"y2",h=_W(e[d]);if(IB(l.bin)&&h){var p=dW(l,{expr:a}),m=dW(h,{expr:a}),v=wW(l);u=PU(p,m,v.format,v.formatType,n),i[d]=!0}else if(t&&t.fieldChannel===s&&"normalize"===t.offset){var g=wW(l);u=DU({fieldOrDatumDef:l,format:g.format,formatType:g.formatType,expr:a,config:n,normalizeStack:!0}).signal}}u=null!==u&&void 0!==u?u:aq(l,n,a).signal,o.push({channel:s,key:f,value:u})}JW(e,(function(e,t){eW(e)?s(e,t):ZU(e)&&s(e.condition,t)}));for(var u={},c=0,l=o;c<l.length;c++){var f=l[c],d=f.channel,h=f.key,p=f.value;i[d]||u[h]||(u[IN(h)]=p)}return u}function uq(e,t,n){var r=lR(sq(e,t,n,{reactiveGeom:(arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}).reactiveGeom})).map((function(e){var t=e.key,n=e.value;return"".concat(t,": ").concat(n)}));return r.length>0?{signal:"{".concat(r.join(", "),"}")}:void 0}function cq(e){var t=LW("aria",e.markDef,e.config);return!1===t?{}:Object.assign(Object.assign(Object.assign({},t?{aria:t}:{}),function(e){var t=e.mark,n=e.markDef,r=e.config;if(!1===r.aria)return{};var i=LW("ariaRoleDescription",n,r);return null!=i?{ariaRoleDescription:{value:i}}:t in Az?{}:{ariaRoleDescription:{value:t}}}(e)),function(e){var t=e.encoding,n=e.markDef,r=e.config,i=e.stack,a=t.description;if(a)return rq(e,a,"description",(function(t){return aq(t,e.config)}));var o=LW("description",n,r);if(null!=o)return{description:NW(o)};if(!1===r.aria)return{};var s=sq(t,i,r);return sR(s)?void 0:{description:{signal:lR(s).map((function(e){var t=e.key,n=e.value;return"".concat(t,' + ": " + (').concat(n,")")})).join(' + "; " + ')}}}(e))}function lq(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=t.markDef,i=t.encoding,a=t.config,o=n.vgChannel,s=n.defaultRef,u=n.defaultValue;void 0===s&&void 0!==(u=null!==u&&void 0!==u?u:LW(e,r,a,{vgChannel:o,ignoreVgConfig:!0}))&&(s=NW(u));var c=i[e];return rq(t,c,null!==o&&void 0!==o?o:e,(function(n){return EU({channel:e,channelDef:n,markDef:r,config:a,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:s})}))}function fq(e){var t,n,r,i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{filled:void 0},o=e.markDef,s=e.encoding,u=e.config,c=o.type,l=null!==(t=a.filled)&&void 0!==t?t:LW("filled",o,u),f=QN(["bar","point","circle","square","geoshape"],c)?"transparent":void 0,d=null!==(r=null!==(n=LW(!0===l?"color":void 0,o,u,{vgChannel:"fill"}))&&void 0!==n?n:u.mark[!0===l&&"color"])&&void 0!==r?r:f,h=null!==(i=LW(!1===l?"color":void 0,o,u,{vgChannel:"stroke"}))&&void 0!==i?i:u.mark[!1===l&&"color"],p=l?"fill":"stroke",m=Object.assign(Object.assign({},d?{fill:NW(d)}:{}),h?{stroke:NW(h)}:{});return o.color&&(l?o.fill:o.stroke)&&oz(P.droppingColor("property",{fill:"fill"in o,stroke:"stroke"in o})),Object.assign(Object.assign(Object.assign(Object.assign({},m),lq("color",e,{vgChannel:p,defaultValue:l?d:h})),lq("fill",e,{defaultValue:s.fill?d:void 0})),lq("stroke",e,{defaultValue:s.stroke?h:void 0}))}function dq(e,t){var n=t[function(e){switch(e){case yP:return"xOffset";case bP:return"yOffset";case xP:return"x2Offset";case wP:return"y2Offset";case EP:return"thetaOffset";case _P:return"radiusOffset";case SP:return"theta2Offset";case kP:return"radius2Offset"}}(e)];if(n)return n}function hq(e,t,n){var r=n.defaultPos,i=n.vgChannel,a=n.isMidPoint,o=t.encoding,s=t.markDef,u=t.config,c=t.stack,l=o[e],f=o[hB(e)],d=t.scaleName(e),h=t.getScaleComponent(e),p=dq(e,s),m=pq({model:t,defaultPos:r,channel:e,scaleName:d,scale:h}),v=!l&&bB(e)&&(o.latitude||o.longitude)?{field:t.getName(e)}:function(e){var t=e.channel,n=e.channelDef,r=e.isMidPoint,i=e.scaleName,a=e.stack,o=e.offset,s=e.markDef,u=e.config;if(aW(n)&&a&&t===a.fieldChannel){if(eW(n)){var c=YU({channel:t,fieldDef:n,isMidPoint:r,markDef:s,stack:a,config:u});if(void 0!==c)return kU({scaleName:i,fieldOrDatumDef:n,startSuffix:"start",band:c,offset:o})}return _U(n,i,{suffix:"end"},{offset:o})}return bU(e)}({channel:e,channelDef:l,channel2Def:f,markDef:s,config:u,isMidPoint:a,scaleName:d,scale:h,stack:c,offset:p,defaultRef:m});return v?y({},i||e,v):void 0}function pq(e){var t=e.model,n=e.defaultPos,r=e.channel,i=e.scaleName,a=e.scale,o=t.markDef,s=t.config;return function(){var e=fB(r),u=dB(r),c=LW(r,o,s,{vgChannel:u});if(void 0!==c)return SU(r,c);switch(n){case"zeroOrMin":case"zeroOrMax":if(i){var l=a.get("type");if(QN([Kz.LOG,Kz.TIME,Kz.UTC],l));else if(a.domainDefinitelyIncludesZero())return{scale:i,value:0}}if("zeroOrMin"===n)return"y"===e?{field:{group:"height"}}:{value:0};switch(e){case"radius":return{signal:"min(".concat(t.width.signal,",").concat(t.height.signal,")/2")};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":var f=t[pB(r)];return Object.assign(Object.assign({},f),{mult:.5})}}}var mq={left:"x",center:"xc",right:"x2"},vq={top:"y",middle:"yc",bottom:"y2"};function gq(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"middle";if("radius"===e||"theta"===e)return dB(e);var i=LW("x"===e?"align":"baseline",t,n);return"x"===e?mq[i||("top"===r?"left":"center")]:vq[i||r]}function yq(e,t,n){var r=n.defaultPos,i=n.defaultPos2;return n.range?bq(e,t,{defaultPos:r,defaultPos2:i}):hq(e,t,{defaultPos:r})}function bq(e,t,n){var r=n.defaultPos,i=n.defaultPos2,a=t.markDef,o=t.config,s=hB(e),u=pB(e),c=function(e,t,n){var r,i=e.encoding,a=e.mark,o=e.markDef,s=e.stack,u=e.config,c=fB(n),l=pB(n),f=dB(n),d=i[c],h=e.scaleName(c),p=e.getScaleComponent(c),m=dq(n in i||n in o?n:c,e.markDef);if(!d&&("x2"===n||"y2"===n)&&(i.latitude||i.longitude))return y({},f,{field:e.getName(n)});var v=function(e){var t=e.channel,n=e.channelDef,r=e.channel2Def,i=e.markDef,a=e.config,o=e.scaleName,s=e.scale,u=e.stack,c=e.offset,l=e.defaultRef;return aW(n)&&u&&t.charAt(0)===u.fieldChannel.charAt(0)?_U(n,o,{suffix:"start"},{offset:c}):bU({channel:t,channelDef:r,scaleName:o,scale:s,stack:u,markDef:i,config:a,offset:c,defaultRef:l})}({channel:n,channelDef:d,channel2Def:i[n],markDef:o,config:u,scaleName:h,scale:p,stack:s,offset:m,defaultRef:void 0});return void 0!==v?y({},f,v):xq(n,o)||xq(n,(y(r={},n,UW(n,o,u.style)),y(r,l,UW(l,o,u.style)),r))||xq(n,u[a])||xq(n,u.mark)||y({},f,pq({model:e,defaultPos:t,channel:n,scaleName:h,scale:p})())}(t,i,s),l=c[u]?gq(e,a,o):dB(e);return Object.assign(Object.assign({},hq(e,t,{defaultPos:r,vgChannel:l})),c)}function xq(e,t){var n=pB(e),r=dB(e);return void 0!==t[r]?y({},r,SU(e,t[r])):void 0!==t[e]?y({},r,SU(e,t[e])):t[n]?y({},n,SU(e,t[n])):void 0}function wq(e,t,n){var r,i,a,o,s=e.config,u=e.encoding,c=e.markDef,l=e.stack,f=hB(t),d=pB(t),h=u[t],p=u[f],m=e.getScaleComponent(t),v=m?m.get("type"):void 0,g=e.scaleName(t),b=c.orient,x=null!==(i=null!==(r=u[d])&&void 0!==r?r:u.size)&&void 0!==i?i:LW("size",c,s,{vgChannel:d}),w="bar"===n&&("x"===t?"vertical"===b:"horizontal"===b);if(eW(h)&&(FB(h.bin)||IB(h.bin)||h.timeUnit&&!p)&&!x&&!oU(v)){var _=YU({channel:t,fieldDef:h,stack:l,markDef:c,config:s}),k=null===(a=e.component.axes[t])||void 0===a?void 0:a[0];return function(e){var t,n=e.fieldDef,r=e.fieldDef2,i=e.channel,a=e.band,o=e.scaleName,s=e.markDef,u=e.spacing,c=void 0===u?0:u,l=e.axisTranslate,f=e.reverse,d=e.config,h=hB(i),p=dB(i),m=dB(h),v=dq(i,s);if(FB(n.bin)||n.timeUnit)return y(t={},m,kq({channel:i,fieldDef:n,scaleName:o,markDef:s,band:(1-a)/2,offset:_q(h,c,f,l,v),config:d})),y(t,p,kq({channel:i,fieldDef:n,scaleName:o,markDef:s,band:1-(1-a)/2,offset:_q(i,c,f,l,v),config:d})),t;if(IB(n.bin)){var g,b,x=_U(n,o,{},{offset:_q(h,c,f,l,v)});if(eW(r))return y(g={},m,x),y(g,p,_U(r,o,{},{offset:_q(i,c,f,l,v)})),g;if(NB(n.bin)&&n.bin.step)return y(b={},m,x),y(b,p,{signal:'scale("'.concat(o,'", ').concat(dW(n,{expr:"datum"})," + ").concat(n.bin.step,")"),offset:_q(i,c,f,l,v)}),b}oz(P.channelRequiredForBinned(h))}({fieldDef:h,fieldDef2:p,channel:t,markDef:c,scaleName:g,band:_,axisTranslate:null!==(o=null===k||void 0===k?void 0:k.get("translate"))&&void 0!==o?o:.5,spacing:bB(t)?LW("binSpacing",c,s):void 0,reverse:m.get("reverse"),config:s})}return(aW(h)&&oU(v)||w)&&!p?function(e,t,n,r){var i,a,o=r.markDef,s=r.encoding,u=r.config,c=r.stack,l=o.orient,f=r.scaleName(n),d=r.getScaleComponent(n),h=pB(n),p=hB(n),m="horizontal"===l&&"y"===n||"vertical"===l&&"x"===n,v=LW(m?"size":h,o,u,{vgChannel:h});(s.size||void 0!==v)&&(m?a=lq("size",r,{vgChannel:h,defaultValue:v}):oz(P.cannotApplySizeToNonOrientedMark(o.type)));var g=null!==(i=aW(t)?YU({channel:n,fieldDef:t,markDef:o,stack:c,config:u}):void 0)&&void 0!==i?i:1;a=a||y({},h,function(e,t,n,r,i,a){if(r){var o=r.get("type");if("point"===o||"band"===o){if(void 0!==i[e].discreteBandSize)return{value:i[e].discreteBandSize};if(o===Kz.POINT){var s=r.get("range");return Ez(s)&&MN(s.step)?{value:s.step-2}:{value:zV-2}}return{scale:n,band:a}}return{value:i[e].continuousBandSize}}var u=BV(i.view,t),c=_R(i[e].discreteBandSize,u-2);return void 0!==c?{value:c}:void 0}(e,h,f,d,u,g));var b="band"!==(null===d||void 0===d?void 0:d.get("type"))||!("band"in a[h]),x=gq(n,o,u,b?"middle":"top"),w=dq(n,o),_=bU({channel:n,channelDef:t,markDef:o,config:u,scaleName:f,scale:d,stack:c,offset:w,defaultRef:pq({model:r,defaultPos:"mid",channel:n,scaleName:f,scale:d}),band:b?.5:(1-g)/2});if(h)return Object.assign(y({},x,_),a);var k,E=dB(p),S=a[h],C=w?Object.assign(Object.assign({},S),{offset:w}):S;return y(k={},x,_),y(k,E,wN(_)?[_[0],Object.assign(Object.assign({},_[1]),{offset:C})]:Object.assign(Object.assign({},_),{offset:C})),k}(n,h,t,e):bq(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function _q(e,t,n,r,i){if($P(e))return 0;var a="x"===e||"y2"===e?-t/2:t/2;if(kz(n)){var o=PW(i);return{signal:"".concat(n.signal," ? ").concat(r-a).concat(o?"-"+o:""," : ").concat(r+a).concat(o?"+"+o:"")}}if(kz(i)){var s=r+(n?-a:a);return{signal:"".concat(s||"").concat(n?" - ":s?" + ":"").concat(i.signal)}}return i=i||0,r+(n?-i-a:+i+a)}function kq(e){var t=e.channel,n=e.fieldDef,r=e.scaleName,i=e.markDef,a=e.band,o=e.offset,s=e.config;return xU({fieldDef:n,channel:t,markDef:i,ref:kU({scaleName:r,fieldOrDatumDef:n,band:a,offset:o}),config:s})}var Eq=new Set(["aria"]);function Sq(e,t){var n="include"===t.color?fq(e):{},r=n.fill,i=n.stroke;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},function(e,t){return Cz.reduce((function(n,r){return Eq.has(r)||void 0===e[r]||"ignore"===t[r]||(n[r]=NW(e[r])),n}),{})}(e.markDef,t)),Cq(e,"fill",r)),Cq(e,"stroke",i)),lq("opacity",e)),lq("fillOpacity",e)),lq("strokeOpacity",e)),lq("strokeWidth",e)),lq("strokeDash",e)),oq(e)),iq(e,"href")),cq(e))}function Cq(e,t,n){var r=e.config,i=e.mark;if("hide"===LW("invalid",e.markDef,r)&&n&&!YR(i)){var a=function(e,t){var n=t.invalid,r=void 0!==n&&n,i=t.channels.reduce((function(t,n){var r=e.getScaleComponent(n);if(r){var i=r.get("type"),a=e.vgField(n,{expr:"datum"});a&&sU(i)&&(t[a]=!0)}return t}),{}),a=uR(i);if(a.length>0){var o=r?"||":"&&";return a.map((function(e){return wU(e,r)})).join(" ".concat(o," "))}}(e,{invalid:!0,channels:CB});if(a)return y({},t,[{test:a,value:null}].concat(h(AN(n))))}return n?y({},t,n):{}}function Aq(e){var t=e.config;if(LW("invalid",e.markDef,t)){var n=function(e,t){var n=t.invalid,r=void 0!==n&&n,i=t.channels.reduce((function(t,n){var r=e.getScaleComponent(n);if(r){var i=r.get("type"),a=e.vgField(n,{expr:"datum"});a&&sU(i)&&(t[a]=!0)}return t}),{}),a=uR(i);if(a.length>0){var o=r?"||":"&&";return a.map((function(e){return wU(e,r)})).join(" ".concat(o," "))}}(e,{channels:yB});if(n)return{defined:{signal:n}}}return{}}function Oq(e,t){if(void 0!==t)return y({},e,NW(t))}var Dq={has:function(e){return"interval"!==e.type&&e.nearest},parse:function(e,t){if(t.events){var n,r=p(t.events);try{for(r.s();!(n=r.n()).done;)n.value.markname=e.getName("voronoi")}catch(i){r.e(i)}finally{r.f()}}},marks:function(e,t,n){var r=t.project.hasChannel,i=r.x,a=r.y,o=e.mark;if(YR(o))return oz(P.nearestNotSupportForContinuous(o)),n;var s={name:e.getName("voronoi"),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},oq(e,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:i||!a?"datum.datum.x || 0":"0"},y:{expr:a||!i?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]},u=0,c=!1;return n.forEach((function(t,n){var r,i=null!==(r=t.name)&&void 0!==r?r:"";i===e.component.mark[0].name?u=n:i.indexOf("voronoi")>=0&&(c=!0)})),c||n.splice(u+1,0,s),n}},Tq=function(){function e(t,n){v(this,e),this.debugName=n,this._children=[],this._parent=null,t&&(this.parent=t)}return g(e,[{key:"clone",value:function(){throw new Error("Cannot clone node")}},{key:"parent",get:function(){return this._parent},set:function(e){this._parent=e,e&&e.addChild(this)}},{key:"children",get:function(){return this._children}},{key:"numChildren",value:function(){return this._children.length}},{key:"addChild",value:function(e,t){this._children.indexOf(e)>-1?console.warn("Attempt to add the same child twice."):void 0!==t?this._children.splice(t,0,e):this._children.push(e)}},{key:"removeChild",value:function(e){var t=this._children.indexOf(e);return this._children.splice(t,1),t}},{key:"remove",value:function(){var e,t=this._parent.removeChild(this),n=p(this._children);try{for(n.s();!(e=n.n()).done;){var r=e.value;r._parent=this._parent,this._parent.addChild(r,t++)}}catch(i){n.e(i)}finally{n.f()}}},{key:"insertAsParentOf",value:function(e){var t=e.parent;t.removeChild(this),this.parent=t,e.parent=this}},{key:"swapWithParent",value:function(){var e,t=this._parent,n=t.parent,r=p(this._children);try{for(r.s();!(e=r.n()).done;)e.value.parent=t}catch(i){r.e(i)}finally{r.f()}this._children=[],t.removeChild(this),t.parent.removeChild(t),this.parent=n,t.parent=this}}]),e}(),jq=function(e){c(n,e);var t=l(n);function n(e,r,i,a){var o;return v(this,n),(o=t.call(this,e,r)).type=i,o.refCounts=a,o._source=o._name=r,!o.refCounts||o._name in o.refCounts||(o.refCounts[o._name]=0),o}return g(n,[{key:"clone",value:function(){var e=new this.constructor;return e.debugName="clone_"+this.debugName,e._source=this._source,e._name="clone_"+this._name,e.type=this.type,e.refCounts=this.refCounts,e.refCounts[e._name]=0,e}},{key:"dependentFields",value:function(){return new Set}},{key:"producedFields",value:function(){return new Set}},{key:"hash",value:function(){return void 0===this._hash&&(this._hash="Output ".concat(ER())),this._hash}},{key:"getSource",value:function(){return this.refCounts[this._name]++,this._source}},{key:"isRequired",value:function(){return!!this.refCounts[this._name]}},{key:"setSource",value:function(e){this._source=e}}]),n}(Tq),Mq=function(e){c(n,e);var t=l(n);function n(e,r){var i;return v(this,n),(i=t.call(this,e)).formula=r,i}return g(n,[{key:"clone",value:function(){return new n(null,XN(this.formula))}},{key:"merge",value:function(e){for(var t in this.formula=Object.assign({},this.formula),e.formula)this.formula[t]&&!e.formula[t].band||(this.formula[t]=e.formula[t]);var n,r=p(e.children);try{for(r.s();!(n=r.n()).done;){var i=n.value;e.removeChild(i),i.parent=this}}catch(a){r.e(a)}finally{r.f()}e.remove()}},{key:"producedFields",value:function(){return new Set(cR(this.formula).map((function(e){return e.as})))}},{key:"dependentFields",value:function(){return new Set(cR(this.formula).map((function(e){return e.field})))}},{key:"hash",value:function(){return"TimeUnit ".concat(JN(this.formula))}},{key:"assemble",value:function(){var e,t=[],n=p(cR(this.formula));try{for(n.s();!(e=n.n()).done;){var r=e.value,i=r.field,a=r.as,o=_z(r.timeUnit),s=o.unit,u=o.utc,c=RN(o,["unit","utc"]);t.push(Object.assign(Object.assign(Object.assign(Object.assign({field:yR(i),type:"timeunit"},s?{units:yz(s)}:{}),u?{timezone:"utc"}:{}),c),{as:[a,"".concat(a,"_end")]}))}}catch(l){n.e(l)}finally{n.f()}return t}}],[{key:"makeFromEncoding",value:function(e,t){var r=t.reduceFieldDef((function(e,n,r){var i=n.field,a=n.timeUnit,o=I$(t)?t.encoding[hB(r)]:void 0,s=I$(t)&&$U(r,n,o,t.stack,t.markDef,t.config);if(a){var u=dW(n,{forAs:!0});e[JN({as:u,field:i,timeUnit:a})]=Object.assign({as:u,field:i,timeUnit:a},s?{band:!0}:{})}return e}),{});return sR(r)?null:new n(e,r)}},{key:"makeFromTransform",value:function(e,t){var r=Object.assign({},t),i=r.timeUnit,a=RN(r,["timeUnit"]),o=_z(i),s=Object.assign(Object.assign({},a),{timeUnit:o});return new n(e,y({},JN(s),s))}}]),n}(Tq),Fq="_tuple_fields",Iq={has:function(e){return"single"===e.type&&"global"===e.resolve&&e.bind&&"scales"!==e.bind&&!DV(e.bind)},parse:function(e,t,n,r){r.on||delete t.events,r.clear||delete t.clear},topLevelSignals:function(e,t,n){var r=t.name,i=t.project,a=t.bind,o=t.init&&t.init[0],s=Dq.has(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return i.items.forEach((function(e,i){var u,c,l=dR("".concat(r,"_").concat(e.field));n.filter((function(e){return e.name===l})).length||n.unshift(Object.assign(Object.assign({name:l},o?{init:Kq(o[i])}:{value:null}),{on:t.events?[{events:t.events,update:"datum && item().mark.marktype !== 'group' ? ".concat(s,"[").concat(IN(e.field),"] : null")}]:[],bind:null!==(c=null!==(u=a[e.field])&&void 0!==u?u:a[e.channel])&&void 0!==c?c:a}))})),n},signals:function(e,t,n){var r=t.name,i=t.project,a=n.filter((function(e){return e.name===r+aH}))[0],o=r+Fq,s=i.items.map((function(e){return dR("".concat(r,"_").concat(e.field))})),u=s.map((function(e){return"".concat(e," !== null")})).join(" && ");return s.length&&(a.update="".concat(u," ? {fields: ").concat(o,", values: [").concat(s.join(", "),"]} : null")),delete a.value,delete a.on,n}},Nq={has:function(e){return"multi"===e.type&&!!e.toggle},signals:function(e,t,n){return n.concat({name:t.name+"_toggle",value:!1,on:[{events:t.events,update:t.toggle}]})},modifyExpr:function(e,t){var n=t.name+aH,r=t.name+"_toggle";return"".concat(r," ? null : ").concat(n,", ")+("global"===t.resolve?"".concat(r," ? null : true, "):"".concat(r," ? null : {unit: ").concat(lH(e),"}, "))+"".concat(r," ? ").concat(n," : null")}},Rq={has:function(e){return"interval"===e.type&&"global"===e.resolve&&e.bind&&"scales"===e.bind},parse:function(e,t){var n,r=t.scales=[],i=p(t.project.items);try{for(i.s();!(n=i.n()).done;){var a=n.value,o=a.channel;if(AB(o)){var s=e.getScaleComponent(o),u=s?s.get("type"):void 0;if(s&&sU(u)){var c={selection:t.name,field:a.field};s.set("selectionExtent",c,!0),r.push(a)}else oz(P.SCALE_BINDINGS_CONTINUOUS)}}}catch(l){i.e(l)}finally{i.f()}},topLevelSignals:function(e,t,n){var r=t.scales.filter((function(e){return 0===n.filter((function(t){return t.name===e.signals.data})).length}));if(!e.parent||Bq(e)||0===r.length)return n;var i=n.filter((function(e){return e.name===t.name}))[0],a=i.update;if(a.indexOf(sH)>=0)i.update="{".concat(r.map((function(e){return"".concat(IN(e.field),": ").concat(e.signals.data)})).join(", "),"}");else{var o,s=p(r);try{for(s.s();!(o=s.n()).done;){var u=o.value,c="".concat(IN(u.field),": ").concat(u.signals.data);a.indexOf(c)<0&&(a="".concat(a.substring(0,a.length-1),", ").concat(c,"}"))}}catch(l){s.e(l)}finally{s.f()}i.update=a}return n.concat(r.map((function(e){return{name:e.signals.data}})))},signals:function(e,t,n){if(e.parent&&!Bq(e)){var r,i=p(t.scales);try{var a=function(){var e=r.value,t=n.filter((function(t){return t.name===e.signals.data}))[0];t.push="outer",delete t.value,delete t.update};for(i.s();!(r=i.n()).done;)a()}catch(o){i.e(o)}finally{i.f()}}return n}};function Pq(e,t){return"domain(".concat(IN(e.scaleName(t)),")")}function Bq(e){var t;return e.parent&&P$(e.parent)&&(null!==(t=!e.parent.parent)&&void 0!==t?t:Bq(e.parent.parent))}var Lq={has:function(e){var t="global"===e.resolve&&e.bind&&DV(e.bind),n=1===e.project.items.length&&e.project.items[0].field!==AV;return t&&!n&&oz(P.LEGEND_BINDINGS_PROJECT_LENGTH),t&&n},parse:function(e,t,n,r){var i;if(r.on||delete t.events,r.clear||delete t.clear,r.on||r.clear){var a,o='event.item && indexof(event.item.mark.role, "legend") < 0',s=p(t.events);try{for(s.s();!(a=s.n()).done;){var u=a.value;u.filter=AN(null!==(i=u.filter)&&void 0!==i?i:[]),u.filter.indexOf(o)<0&&u.filter.push(o)}}catch(f){s.e(f)}finally{s.f()}}var c=TV(t.bind)?t.bind.legend:"click",l=FN(c)?iN(c,"view"):AN(c);t.bind={legend:{merge:l}}},topLevelSignals:function(e,t,n){var r,i=t.name,a=TV(t.bind)&&t.bind.legend,o=function(e){return function(t){var n=XN(t);return n.markname=e,n}},s=p(t.project.items);try{var u=function(){var e=r.value;if(!e.hasLegend)return"continue";var s="".concat(dR(e.field),"_legend"),u="".concat(i,"_").concat(s);if(0===n.filter((function(e){return e.name===u})).length){var c=a.merge.map(o("".concat(s,"_symbols"))).concat(a.merge.map(o("".concat(s,"_labels")))).concat(a.merge.map(o("".concat(s,"_entries"))));n.unshift(Object.assign(Object.assign({name:u},t.init?{}:{value:null}),{on:[{events:c,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:a.merge,update:"!event.item || !datum ? null : ".concat(u),force:!0}]}))}};for(s.s();!(r=s.n()).done;)u()}catch(c){s.e(c)}finally{s.f()}return n},signals:function(e,t,n){var r=t.name,i=t.project,a=n.find((function(e){return e.name===r+aH})),o=r+Fq,s=i.items.filter((function(e){return e.hasLegend})).map((function(e){return dR("".concat(r,"_").concat(dR(e.field),"_legend"))})),u="".concat(s.map((function(e){return"".concat(e," !== null")})).join(" && ")," ? {fields: ").concat(o,", values: [").concat(s.join(", "),"]} : null");t.events&&s.length>0?a.on.push({events:s.map((function(e){return{signal:e}})),update:u}):s.length>0&&(a.update=u,delete a.value,delete a.on);var c=n.find((function(e){return e.name===r+"_toggle"})),l=TV(t.bind)&&t.bind.legend;return c&&(t.events?c.on.push(Object.assign(Object.assign({},c.on[0]),{events:l})):c.on[0].events=l),n}},zq="_translate_anchor",Uq="_translate_delta";function Wq(e,t,n,r,i){var a,o=t.name,s=o+zq,u=o+Uq,c=n.channel,l=Rq.has(t),f=i.filter((function(e){return e.name===n.signals[l?"data":"visual"]}))[0],d=e.getSizeSignalRef(r).signal,h=e.getScaleComponent(c),p=h.get("type"),m="".concat(s,".extent_").concat(c),v="".concat(l?"log"===p?"panLog":"pow"===p?"panPow":"panLinear":"panLinear","(").concat(m,", ").concat("".concat(l&&c===yP?"-":"").concat(u,".").concat(c," / ")+(l?"".concat(d):"span(".concat(m,")")))+(l&&"pow"===p?", ".concat(null!==(a=h.get("exponent"))&&void 0!==a?a:1):"")+")";f.on.push({events:{signal:u},update:l?v:"clampRange(".concat(v,", 0, ").concat(d,")")})}var Vq="_zoom_anchor",Gq="_zoom_delta";function qq(e,t,n,r,i){var a,o=t.name,s=n.channel,u=Rq.has(t),c=i.filter((function(e){return e.name===n.signals[u?"data":"visual"]}))[0],l=e.getSizeSignalRef(r).signal,f=e.getScaleComponent(s),d=f.get("type"),h=u?Pq(e,s):c.name,p=o+Gq,m="".concat(u?"log"===d?"zoomLog":"pow"===d?"zoomPow":"zoomLinear":"zoomLinear","(").concat(h,", ","".concat(o).concat(Vq,".").concat(s),", ").concat(p)+(u&&"pow"===d?", ".concat(null!==(a=f.get("exponent"))&&void 0!==a?a:1):"")+")";c.on.push({events:{signal:p},update:u?m:"clampRange(".concat(m,", 0, ").concat(l,")")})}var Hq=[{has:function(){return!0},parse:function(e,t,n){var r,i,a,o=t.name,s=null!==(r=t.project)&&void 0!==r?r:t.project=new(function(){function e(){v(this,e);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.items=n,this.hasChannel={},this.hasField={}}return g(e)}()),u={},c={},l=new Set,f=function(e,t){for(var n="visual"===t?e.channel:e.field,r=dR("".concat(o,"_").concat(n)),i=1;l.has(r);i++)r=dR("".concat(o,"_").concat(n,"_").concat(i));return l.add(r),y({},t,r)};if(!n.fields&&!n.encodings){var d=e.config.selection[n.type];if(n.init){var h,m=p(AN(n.init));try{for(m.s();!(h=m.n()).done;){var b,x=h.value,w=p(uR(x));try{for(w.s();!(b=w.n()).done;){var _=b.value;sB(_)?(n.encodings||(n.encodings=[])).push(_):"interval"===n.type?(oz('Interval selections should be initialized using "x" and/or "y" keys.'),n.encodings=d.encodings):(n.fields||(n.fields=[])).push(_)}}catch(B){w.e(B)}finally{w.f()}}}catch(B){m.e(B)}finally{m.f()}}else n.encodings=d.encodings,n.fields=d.fields}var k,E=p(null!==(i=n.fields)&&void 0!==i?i:[]);try{for(E.s();!(k=E.n()).done;){var S=k.value,C={type:"E",field:S};C.signals=Object.assign({},f(C,"data")),s.items.push(C),s.hasField[S]=C}}catch(B){E.e(B)}finally{E.f()}var A,O=p(null!==(a=n.encodings)&&void 0!==a?a:[]);try{for(O.s();!(A=O.n()).done;){var D=A.value,T=e.fieldDef(D);if(T){var j=T.field;if(T.aggregate){oz(P.cannotProjectAggregate(D,T.aggregate));continue}if(!j){oz(P.cannotProjectOnChannelWithoutField(D));continue}if(T.timeUnit){j=e.vgField(D);var M={timeUnit:T.timeUnit,as:j,field:T.field};c[JN(M)]=M}if(!u[j]){var F="E";"interval"===t.type?sU(e.getScaleComponent(D).get("type"))&&(F="R"):T.bin&&(F="R-RE");var I={field:j,channel:D,type:F};I.signals=Object.assign(Object.assign({},f(I,"data")),f(I,"visual")),s.items.push(u[j]=I),s.hasField[j]=s.hasChannel[D]=u[j]}}else oz(P.cannotProjectOnChannelWithoutField(D))}}catch(B){O.e(B)}finally{O.f()}if(n.init){var N=function(e){return s.items.map((function(t){return void 0!==e[t.channel]?e[t.channel]:e[t.field]}))};if("interval"===n.type)t.init=N(n.init);else{var R=AN(n.init);t.init=R.map(N)}}sR(c)||(s.timeUnit=new Mq(null,c))},signals:function(e,t,n){var r=t.name+Fq;return n.filter((function(e){return e.name===r})).length>0?n:n.concat({name:r,value:t.project.items.map((function(e){e.signals,e.hasLegend;var t=RN(e,["signals","hasLegend"]);return t.field=yR(t.field),t}))})}},Nq,Rq,Lq,{has:function(e){return"interval"===e.type&&e.translate},signals:function(e,t,n){var r=t.name,i=Rq.has(t),a=r+zq,o=t.project.hasChannel,s=o.x,u=o.y,c=iN(t.translate,"scope");return i||(c=c.map((function(e){return e.between[0].markname=r+Jq,e}))),n.push({name:a,value:{},on:[{events:c.map((function(e){return e.between[0]})),update:"{x: x(unit), y: y(unit)"+(void 0!==s?", extent_x: "+(i?Pq(e,yP):"slice(".concat(s.signals.visual,")")):"")+(void 0!==u?", extent_y: "+(i?Pq(e,bP):"slice(".concat(u.signals.visual,")")):"")+"}"}]},{name:r+Uq,value:{},on:[{events:c,update:"{x: ".concat(a,".x - x(unit), y: ").concat(a,".y - y(unit)}")}]}),void 0!==s&&Wq(e,t,s,"width",n),void 0!==u&&Wq(e,t,u,"height",n),n}},{has:function(e){return"interval"===e.type&&e.zoom},signals:function(e,t,n){var r=t.name,i=Rq.has(t),a=r+Gq,o=t.project.hasChannel,s=o.x,u=o.y,c=IN(e.scaleName(yP)),l=IN(e.scaleName(bP)),f=iN(t.zoom,"scope");return i||(f=f.map((function(e){return e.markname=r+Jq,e}))),n.push({name:r+Vq,on:[{events:f,update:i?"{"+[c?"x: invert(".concat(c,", x(unit))"):"",l?"y: invert(".concat(l,", y(unit))"):""].filter((function(e){return!!e})).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:a,on:[{events:f,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),void 0!==s&&qq(e,t,s,"width",n),void 0!==u&&qq(e,t,u,"height",n),n}},Iq,Dq,{has:function(e){return void 0!==e.clear&&!1!==e.clear},parse:function(e,t,n){n.clear&&(t.clear=FN(n.clear)?iN(n.clear,"scope"):n.clear)},topLevelSignals:function(e,t,n){if(Iq.has(t)){var r,i=p(t.project.items);try{var a=function(){var e=r.value,i=n.findIndex((function(n){return n.name===dR("".concat(t.name,"_").concat(e.field))}));-1!==i&&n[i].on.push({events:t.clear,update:"null"})};for(i.s();!(r=i.n()).done;)a()}catch(o){i.e(o)}finally{i.f()}}return n},signals:function(e,t,n){function r(e,r){-1!==e&&n[e].on&&n[e].on.push({events:t.clear,update:r})}if("interval"===t.type){var i,a=p(t.project.items);try{var o=function(){var e=i.value,t=n.findIndex((function(t){return t.name===e.signals.visual}));r(t,"[0, 0]"),-1===t&&r(n.findIndex((function(t){return t.name===e.signals.data})),"null")};for(a.s();!(i=a.n()).done;)o()}catch(u){a.e(u)}finally{a.f()}}else{var s=n.findIndex((function(e){return e.name===t.name+aH}));r(s,"null"),Nq.has(t)&&r(s=n.findIndex((function(e){return e.name===t.name+"_toggle"})),"false")}return n}}];function Xq(e,t){for(var n=0,r=Hq;n<r.length;n++){var i=r[n];i.has(e)&&t(i)}}function Kq(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:bN;if(wN(e)){var r=e.map((function(e){return Kq(e,t,n)}));return t?"[".concat(r.join(", "),"]"):r}return sz(e)?n(t?hz(e):function(e){var t=dz(e,!0);return e.utc?+new Date(Date.UTC.apply(Date,h(t))):+o(Date,h(t))}(e)):t?n(JSON.stringify(e)):e}function Yq(e,t){return cH(e,(function(n,r){t=r.marks?r.marks(e,n,t):t,Xq(n,(function(r){r.marks&&(t=r.marks(e,n,t))}))})),t}function $q(e){return e.map((function(e){return e.on&&!e.on.length&&delete e.on,e}))}var Jq="_brush",Zq="_scale_trigger",Qq={signals:function(e,t){var n=t.name,r=n+Fq,i=Rq.has(t),a=[],o=[],s=[];if(t.translate&&!i){var u="!event.item || event.item.mark.name !== ".concat(IN(n+Jq));eH(t,(function(e,t){var n,r=AN(null!==(n=t.between[0].filter)&&void 0!==n?n:t.between[0].filter=[]);return r.indexOf(u)<0&&r.push(u),e}))}t.project.items.forEach((function(n,r){var i=n.channel;if(i===yP||i===bP){var u=t.init?t.init[r]:null,c=function(e,t,n,r){var i=n.channel,a=n.signals.visual,o=n.signals.data,s=Rq.has(t),u=IN(e.scaleName(i)),c=e.getScaleComponent(i),l=c?c.get("type"):void 0,f=function(e){return"scale(".concat(u,", ").concat(e,")")},d=e.getSizeSignalRef(i===yP?"width":"height").signal,p="".concat(i,"(unit)"),m=eH(t,(function(e,t){return[].concat(h(e),[{events:t.between[0],update:"[".concat(p,", ").concat(p,"]")},{events:t,update:"[".concat(a,"[0], clamp(").concat(p,", 0, ").concat(d,")]")}])}));return m.push({events:{signal:t.name+Zq},update:sU(l)?"[".concat(f("".concat(o,"[0]")),", ").concat(f("".concat(o,"[1]")),"]"):"[0, 0]"}),s?[{name:o,on:[]}]:[Object.assign(Object.assign({name:a},r?{init:Kq(r,!0,f)}:{value:[]}),{on:m}),Object.assign(Object.assign({name:o},r?{init:Kq(r)}:{}),{on:[{events:{signal:a},update:"".concat(a,"[0] === ").concat(a,"[1] ? null : invert(").concat(u,", ").concat(a,")")}]})]}(e,t,n,u),l=n.signals.data,f=n.signals.visual,d=IN(e.scaleName(i)),p=sU(e.getScaleComponent(i).get("type"))?"+":"";a.push.apply(a,h(c)),o.push(l),s.push({scaleName:e.scaleName(i),expr:"(!isArray(".concat(l,") || ")+"(".concat(p,"invert(").concat(d,", ").concat(f,")[0] === ").concat(p).concat(l,"[0] && ")+"".concat(p,"invert(").concat(d,", ").concat(f,")[1] === ").concat(p).concat(l,"[1]))")})}else oz("Interval selections only support x and y encoding channels.")})),i||a.push({name:n+Zq,value:{},on:[{events:s.map((function(e){return{scale:e.scaleName}})),update:s.map((function(e){return e.expr})).join(" && ")+" ? ".concat(n+Zq," : {}")}]});var c=t.init,l="unit: ".concat(lH(e),", fields: ").concat(r,", values");return a.concat(Object.assign(Object.assign({name:n+aH},c?{init:"{".concat(l,": ").concat(Kq(c),"}")}:{}),{on:[{events:[{signal:o.join(" || ")}],update:o.join(" && ")+" ? {".concat(l,": [").concat(o,"]} : null")}]}))},modifyExpr:function(e,t){return t.name+aH+", "+("global"===t.resolve?"true":"{unit: ".concat(lH(e),"}"))},marks:function(e,t,n){var r=t.name,i=t.project.hasChannel,a=i.x,o=i.y,s=a&&a.signals.visual,u=o&&o.signals.visual,c="data(".concat(IN(t.name+iH),")");if(Rq.has(t))return n;var l={x:void 0!==a?{signal:"".concat(s,"[0]")}:{value:0},y:void 0!==o?{signal:"".concat(u,"[0]")}:{value:0},x2:void 0!==a?{signal:"".concat(s,"[1]")}:{field:{group:"width"}},y2:void 0!==o?{signal:"".concat(u,"[1]")}:{field:{group:"height"}}};if("global"===t.resolve){var f,d=p(uR(l));try{for(d.s();!(f=d.n()).done;){var m=f.value;l[m]=[Object.assign({test:"".concat(c,".length && ").concat(c,"[0].unit === ").concat(lH(e))},l[m]),{value:0}]}}catch(_){d.e(_)}finally{d.f()}}var v=t.mark,g=v.fill,y=v.fillOpacity,b=v.cursor,x=RN(v,["fill","fillOpacity","cursor"]),w=uR(x).reduce((function(e,t){return e[t]=[{test:[void 0!==a&&"".concat(s,"[0] !== ").concat(s,"[1]"),void 0!==o&&"".concat(u,"[0] !== ").concat(u,"[1]")].filter((function(e){return e})).join(" && "),value:x[t]},{value:null}],e}),{});return[{name:r+Jq+"_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:g},fillOpacity:{value:y}},update:l}}].concat(h(n),[{name:r+Jq,type:"rect",clip:!0,encode:{enter:Object.assign(Object.assign({},b?{cursor:{value:b}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},l),w)}}])}};function eH(e,t){return e.events.reduce((function(e,n){return n.between?t(e,n):(oz("".concat(n," is not an ordered event stream for interval selections.")),e)}),[])}function tH(e,t){var n=t.name,r=n+Fq,i="(item().isVoronoi ? datum.datum : datum)",a=t.project.items.map((function(t){var n=e.fieldDef(t.channel);return n&&n.bin?"[".concat(i,"[").concat(IN(e.vgField(t.channel,{})),"], ")+"".concat(i,"[").concat(IN(e.vgField(t.channel,{binSuffix:"end"})),"]]"):"".concat(i,"[").concat(IN(t.field),"]")})).join(", "),o="unit: ".concat(lH(e),", fields: ").concat(r,", values"),s=t.events;return[{name:n+aH,on:s?[{events:s,update:"datum && item().mark.marktype !== 'group' ? {".concat(o,": [").concat(a,"]} : null"),force:!0}]:[]}]}var nH={signals:tH,modifyExpr:function(e,t){return t.name+aH+", "+("global"===t.resolve?"null":"{unit: ".concat(lH(e),"}"))}},rH={signals:tH,modifyExpr:function(e,t){return t.name+aH+", "+("global"===t.resolve?"true":"{unit: ".concat(lH(e),"}"))}},iH="_store",aH="_tuple",oH="_modify",sH="vlSelectionResolve",uH={single:rH,multi:nH,interval:Qq};function cH(e,t){var n=e.component.selection;if(n){var r,i=p(cR(n));try{for(i.s();!(r=i.n()).done;){var a=r.value;if(!0===t(a,uH[a.type]))break}}catch(o){i.e(o)}finally{i.f()}}}function lH(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{escape:!0}).escape?IN(e.name):e.name,n=function(e){for(var t=e.parent;t&&!N$(t);)t=t.parent;return t}(e);if(n){var r,i=n.facet,a=p(nB);try{for(a.s();!(r=a.n()).done;){var o=r.value;i[o]&&(t+=" + '__facet_".concat(o,"_' + (facet[").concat(IN(n.vgField(o)),"])"))}}catch(s){a.e(s)}finally{a.f()}}return t}function fH(e){var t=!1;return cH(e,(function(e){t=t||e.project.items.some((function(e){return e.field===AV}))})),t}var dH,hH,pH,mH,vH,gH="Property",yH="ArrayExpression",bH="BinaryExpression",xH="CallExpression",wH="ConditionalExpression",_H="LogicalExpression",kH="MemberExpression",EH="ObjectExpression",SH="UnaryExpression";function CH(e){this.type=e}CH.prototype.visit=function(e){var t,n,r;if(e(this))return 1;for(n=0,r=(t=function(e){switch(e.type){case yH:return e.elements;case bH:case _H:return[e.left,e.right];case xH:return[e.callee].concat(e.arguments);case wH:return[e.test,e.consequent,e.alternate];case kH:return[e.object,e.property];case EH:return e.properties;case gH:return[e.key,e.value];case SH:return[e.argument];default:return[]}}(this)).length;n<r;++n)if(t[n].visit(e))return 1};var AH=1,OH=2,DH=3,TH=4,jH=5,MH=6,FH=7,IH=8;(dH={})[AH]="Boolean",dH[OH]="<end>",dH[DH]="Identifier",dH[TH]="Keyword",dH[jH]="Null",dH[MH]="Numeric",dH[FH]="Punctuator",dH[IH]="String",dH[9]="RegularExpression";var NH="ArrayExpression",RH="BinaryExpression",PH="CallExpression",BH="ConditionalExpression",LH="Identifier",zH="Literal",UH="LogicalExpression",WH="MemberExpression",VH="ObjectExpression",GH="Property",qH="UnaryExpression",HH="Unexpected token %0",XH="Unexpected number",KH="Unexpected string",YH="Unexpected identifier",$H="Unexpected reserved word",JH="Unexpected end of input",ZH="Invalid regular expression",QH="Invalid regular expression: missing /",eX="Octal literals are not allowed in strict mode.",tX="Duplicate data property in object literal not allowed in strict mode",nX="ILLEGAL",rX="Disabled.",iX=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),aX=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function oX(e,t){if(!e)throw new Error("ASSERT: "+t)}function sX(e){return e>=48&&e<=57}function uX(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function cX(e){return"01234567".indexOf(e)>=0}function lX(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function fX(e){return 10===e||13===e||8232===e||8233===e}function dX(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||e>=128&&iX.test(String.fromCharCode(e))}function hX(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||e>=128&&aX.test(String.fromCharCode(e))}var pX={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function mX(){for(var e;pH<mH&&(lX(e=hH.charCodeAt(pH))||fX(e));)++pH}function vX(e){var t,n,r,i=0;for(n="u"===e?4:2,t=0;t<n;++t)pH<mH&&uX(hH[pH])?(r=hH[pH++],i=16*i+"0123456789abcdef".indexOf(r.toLowerCase())):MX({},HH,nX);return String.fromCharCode(i)}function gX(){var e,t,n,r;for(t=0,"}"===(e=hH[pH])&&MX({},HH,nX);pH<mH&&uX(e=hH[pH++]);)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||"}"!==e)&&MX({},HH,nX),t<=65535?String.fromCharCode(t):(n=55296+(t-65536>>10),r=56320+(t-65536&1023),String.fromCharCode(n,r))}function yX(){var e,t;for(e=hH.charCodeAt(pH++),t=String.fromCharCode(e),92===e&&(117!==hH.charCodeAt(pH)&&MX({},HH,nX),++pH,(e=vX("u"))&&"\\"!==e&&dX(e.charCodeAt(0))||MX({},HH,nX),t=e);pH<mH&&hX(e=hH.charCodeAt(pH));)++pH,t+=String.fromCharCode(e),92===e&&(t=t.substr(0,t.length-1),117!==hH.charCodeAt(pH)&&MX({},HH,nX),++pH,(e=vX("u"))&&"\\"!==e&&hX(e.charCodeAt(0))||MX({},HH,nX),t+=e);return t}function bX(){var e,t;return e=pH,{type:1===(t=92===hH.charCodeAt(pH)?yX():function(){var e,t;for(e=pH++;pH<mH;){if(92===(t=hH.charCodeAt(pH)))return pH=e,yX();if(!hX(t))break;++pH}return hH.slice(e,pH)}()).length?DH:pX.hasOwnProperty(t)?TH:"null"===t?jH:"true"===t||"false"===t?AH:DH,value:t,start:e,end:pH}}function xX(){var e,t,n,r,i=pH,a=hH.charCodeAt(pH),o=hH[pH];switch(a){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++pH,{type:FH,value:String.fromCharCode(a),start:i,end:pH};default:if(61===(e=hH.charCodeAt(pH+1)))switch(a){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return pH+=2,{type:FH,value:String.fromCharCode(a)+String.fromCharCode(e),start:i,end:pH};case 33:case 61:return pH+=2,61===hH.charCodeAt(pH)&&++pH,{type:FH,value:hH.slice(i,pH),start:i,end:pH}}}return">>>="===(r=hH.substr(pH,4))?{type:FH,value:r,start:i,end:pH+=4}:">>>"===(n=r.substr(0,3))||"<<="===n||">>="===n?{type:FH,value:n,start:i,end:pH+=3}:o===(t=n.substr(0,2))[1]&&"+-<>&|".indexOf(o)>=0||"=>"===t?{type:FH,value:t,start:i,end:pH+=2}:"<>=!+-*%&|^/".indexOf(o)>=0?{type:FH,value:o,start:i,end:++pH}:void MX({},HH,nX)}function wX(){var e,t,n;if(oX(sX((n=hH[pH]).charCodeAt(0))||"."===n,"Numeric literal must start with a decimal digit or a decimal point"),t=pH,e="","."!==n){if(e=hH[pH++],n=hH[pH],"0"===e){if("x"===n||"X"===n)return++pH,function(e){for(var t="";pH<mH&&uX(hH[pH]);)t+=hH[pH++];return 0===t.length&&MX({},HH,nX),dX(hH.charCodeAt(pH))&&MX({},HH,nX),{type:MH,value:parseInt("0x"+t,16),start:e,end:pH}}(t);if(cX(n))return function(e){for(var t="0"+hH[pH++];pH<mH&&cX(hH[pH]);)t+=hH[pH++];return(dX(hH.charCodeAt(pH))||sX(hH.charCodeAt(pH)))&&MX({},HH,nX),{type:MH,value:parseInt(t,8),octal:!0,start:e,end:pH}}(t);n&&sX(n.charCodeAt(0))&&MX({},HH,nX)}for(;sX(hH.charCodeAt(pH));)e+=hH[pH++];n=hH[pH]}if("."===n){for(e+=hH[pH++];sX(hH.charCodeAt(pH));)e+=hH[pH++];n=hH[pH]}if("e"===n||"E"===n)if(e+=hH[pH++],"+"!==(n=hH[pH])&&"-"!==n||(e+=hH[pH++]),sX(hH.charCodeAt(pH)))for(;sX(hH.charCodeAt(pH));)e+=hH[pH++];else MX({},HH,nX);return dX(hH.charCodeAt(pH))&&MX({},HH,nX),{type:MH,value:parseFloat(e),start:t,end:pH}}function _X(){var e,t,n,r;return vH=null,mX(),e=pH,t=function(){var e,t,n,r;for(oX("/"===(e=hH[pH]),"Regular expression literal must start with a slash"),t=hH[pH++],n=!1,r=!1;pH<mH;)if(t+=e=hH[pH++],"\\"===e)fX((e=hH[pH++]).charCodeAt(0))&&MX({},QH),t+=e;else if(fX(e.charCodeAt(0)))MX({},QH);else if(n)"]"===e&&(n=!1);else{if("/"===e){r=!0;break}"["===e&&(n=!0)}return r||MX({},QH),{value:t.substr(1,t.length-2),literal:t}}(),n=function(){var e,t,n;for(t="",n="";pH<mH&&hX((e=hH[pH]).charCodeAt(0));)++pH,"\\"===e&&pH<mH?MX({},HH,nX):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&MX({},ZH,n),{value:n,literal:t}}(),r=function(e,t){var n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,(function(e,t){if(parseInt(t,16)<=1114111)return"x";MX({},ZH)})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch(e){MX({},ZH)}try{return new RegExp(e,t)}catch(e){return null}}(t.value,n.value),{literal:t.literal+n.literal,value:r,regex:{pattern:t.value,flags:n.value},start:e,end:pH}}function kX(){var e;return mX(),pH>=mH?{type:OH,start:pH,end:pH}:dX(e=hH.charCodeAt(pH))?bX():40===e||41===e||59===e?xX():39===e||34===e?function(){var e,t,n,r,i="",a=!1;for(oX("'"===(e=hH[pH])||'"'===e,"String literal must starts with a quote"),t=pH,++pH;pH<mH;){if((n=hH[pH++])===e){e="";break}if("\\"===n)if((n=hH[pH++])&&fX(n.charCodeAt(0)))"\r"===n&&"\n"===hH[pH]&&++pH;else switch(n){case"u":case"x":"{"===hH[pH]?(++pH,i+=gX()):i+=vX(n);break;case"n":i+="\n";break;case"r":i+="\r";break;case"t":i+="\t";break;case"b":i+="\b";break;case"f":i+="\f";break;case"v":i+="\v";break;default:cX(n)?(0!==(r="01234567".indexOf(n))&&(a=!0),pH<mH&&cX(hH[pH])&&(a=!0,r=8*r+"01234567".indexOf(hH[pH++]),"0123".indexOf(n)>=0&&pH<mH&&cX(hH[pH])&&(r=8*r+"01234567".indexOf(hH[pH++]))),i+=String.fromCharCode(r)):i+=n}else{if(fX(n.charCodeAt(0)))break;i+=n}}return""!==e&&MX({},HH,nX),{type:IH,value:i,octal:a,start:t,end:pH}}():46===e?sX(hH.charCodeAt(pH+1))?wX():xX():sX(e)?wX():xX()}function EX(){var e;return pH=(e=vH).end,vH=kX(),pH=e.end,e}function SX(){var e;e=pH,vH=kX(),pH=e}function CX(e,t,n){var r=new CH("||"===e||"&&"===e?UH:RH);return r.operator=e,r.left=t,r.right=n,r}function AX(e,t){var n=new CH(PH);return n.callee=e,n.arguments=t,n}function OX(e){var t=new CH(LH);return t.name=e,t}function DX(e){var t=new CH(zH);return t.value=e.value,t.raw=hH.slice(e.start,e.end),e.regex&&("//"===t.raw&&(t.raw="/(?:)/"),t.regex=e.regex),t}function TX(e,t,n){var r=new CH(WH);return r.computed="["===e,r.object=t,r.property=n,r.computed||(n.member=!0),r}function jX(e,t,n){var r=new CH(GH);return r.key=t,r.value=n,r.kind=e,r}function MX(e,t){var n,r=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,(function(e,t){return oX(t<r.length,"Message reference must be in range"),r[t]}));throw(n=new Error(i)).index=pH,n.description=i,n}function FX(e){e.type===OH&&MX(e,JH),e.type===MH&&MX(e,XH),e.type===IH&&MX(e,KH),e.type===DH&&MX(e,YH),e.type===TH&&MX(e,$H),MX(e,HH,e.value)}function IX(e){var t=EX();t.type===FH&&t.value===e||FX(t)}function NX(e){return vH.type===FH&&vH.value===e}function RX(e){return vH.type===TH&&vH.value===e}function PX(){var e=[];for(pH=vH.start,IX("[");!NX("]");)NX(",")?(EX(),e.push(null)):(e.push(YX()),NX("]")||IX(","));return EX(),function(e){var t=new CH(NH);return t.elements=e,t}(e)}function BX(){var e;return pH=vH.start,(e=EX()).type===IH||e.type===MH?(e.octal&&MX(e,eX),DX(e)):OX(e.value)}function LX(){var e,t,n;return pH=vH.start,(e=vH).type===DH?(n=BX(),IX(":"),jX("init",n,YX())):e.type!==OH&&e.type!==FH?(t=BX(),IX(":"),jX("init",t,YX())):void FX(e)}function zX(){var e,t,n=[],r={},i=String;for(pH=vH.start,IX("{");!NX("}");)t="$"+((e=LX()).key.type===LH?e.key.name:i(e.key.value)),Object.prototype.hasOwnProperty.call(r,t)?MX({},tX):r[t]=!0,n.push(e),NX("}")||IX(",");return IX("}"),function(e){var t=new CH(VH);return t.properties=e,t}(n)}var UX={if:1};function WX(){var e,t,n;if(NX("("))return function(){var e;return IX("("),e=$X(),IX(")"),e}();if(NX("["))return PX();if(NX("{"))return zX();if(e=vH.type,pH=vH.start,e===DH||UX[vH.value])n=OX(EX().value);else if(e===IH||e===MH)vH.octal&&MX(vH,eX),n=DX(EX());else{if(e===TH)throw new Error(rX);e===AH?((t=EX()).value="true"===t.value,n=DX(t)):e===jH?((t=EX()).value=null,n=DX(t)):NX("/")||NX("/=")?(n=DX(_X()),SX()):FX(EX())}return n}function VX(){var e=[];if(IX("("),!NX(")"))for(;pH<mH&&(e.push(YX()),!NX(")"));)IX(",");return IX(")"),e}function GX(){var e;return pH=vH.start,function(e){return e.type===DH||e.type===TH||e.type===AH||e.type===jH}(e=EX())||FX(e),OX(e.value)}function qX(){var e;return IX("["),e=$X(),IX("]"),e}function HX(){var e=function(){var e;for(e=WX();;)if(NX("."))IX("."),e=TX(".",e,GX());else if(NX("("))e=AX(e,VX());else{if(!NX("["))break;e=TX("[",e,qX())}return e}();if(vH.type===FH&&(NX("++")||NX("--")))throw new Error(rX);return e}function XX(){var e,t;if(vH.type!==FH&&vH.type!==TH)t=HX();else{if(NX("++")||NX("--"))throw new Error(rX);if(NX("+")||NX("-")||NX("~")||NX("!"))e=EX(),t=XX(),t=function(e,t){var n=new CH(qH);return n.operator=e,n.argument=t,n.prefix=!0,n}(e.value,t);else{if(RX("delete")||RX("void")||RX("typeof"))throw new Error(rX);t=HX()}}return t}function KX(e){var t=0;if(e.type!==FH&&e.type!==TH)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11}return t}function YX(){var e,t;return e=function(){var e,t,n,r,i,a,o,s,u,c;if(e=vH,u=XX(),0===(i=KX(r=vH)))return u;for(r.prec=i,EX(),t=[e,vH],a=[u,r,o=XX()];(i=KX(vH))>0;){for(;a.length>2&&i<=a[a.length-2].prec;)o=a.pop(),s=a.pop().value,u=a.pop(),t.pop(),n=CX(s,u,o),a.push(n);(r=EX()).prec=i,a.push(r),t.push(vH),n=XX(),a.push(n)}for(n=a[c=a.length-1],t.pop();c>1;)t.pop(),n=CX(a[c-1].value,a[c-2],n),c-=2;return n}(),NX("?")&&(EX(),t=YX(),IX(":"),e=function(e,t,n){var r=new CH(BH);return r.test=e,r.consequent=t,r.alternate=n,r}(e,t,YX())),e}function $X(){var e=YX();if(NX(","))throw new Error(rX);return e}var JX=function(e){pH=0,mH=(hH=e).length,vH=null,SX();var t=$X();if(vH.type!==OH)throw new Error("Unexpect token after expression.");return t};function ZX(e,t,n){return e.fields=t||[],e.fname=n,e}function QX(e){return 1===e.length?eK(e[0]):tK(e)}var eK=function(e){return function(t){return t[e]}},tK=function(e){var t=e.length;return function(n){for(var r=0;r<t;++r)n=n[e[r]];return n}};function nK(e){throw Error(e)}function rK(e){var t,n,r,i=[],a=e.length,o=null,s=0,u="";function c(){i.push(u+e.substring(t,n)),u="",t=n+1}for(e+="",t=n=0;n<a;++n)if("\\"===(r=e[n]))u+=e.substring(t,n),u+=e.substring(++n,++n),t=n;else if(r===o)c(),o=null,s=-1;else{if(o)continue;t===s&&'"'===r||t===s&&"'"===r?(t=n+1,o=r):"."!==r||s?"["===r?(n>t&&c(),s=t=n+1):"]"===r&&(s||nK("Access path missing open bracket: "+e),s>0&&c(),s=0,t=n+1):n>t?c():t=n+1}return s&&nK("Access path missing closing bracket: "+e),o&&nK("Access path missing closing quote: "+e),n>t&&(n++,c()),i}function iK(e,t,n){var r=rK(e);return e=1===r.length?r[0]:e,ZX((n&&n.get||QX)(r),[e],t||e)}function aK(e){var t=JX(e),n=new Set;return t.visit((function(e){"MemberExpression"===e.type&&function e(t){return"MemberExpression"===t.object.type?e(t.object):"datum"===t.object.name}(e)&&n.add(function e(t){var n=[];return"Identifier"===t.type?[t.name]:"Literal"===t.type?[t.value]:("MemberExpression"===t.type&&(n.push.apply(n,h(e(t.object))),n.push.apply(n,h(e(t.property)))),n)}(e).slice(1).join("."))})),n}iK("id"),ZX((function(e){return e}),[],"identity"),ZX((function(){return 0}),[],"zero"),ZX((function(){return 1}),[],"one"),ZX((function(){return!0}),[],"true"),ZX((function(){return!1}),[],"false"),Array.isArray,Object.prototype.hasOwnProperty;var oK=function(e){c(n,e);var t=l(n);function n(e,r,i){var o;return v(this,n),(o=t.call(this,e)).model=r,o.filter=i,o.expr=cK(o.model,o.filter,a(o)),o._dependentFields=aK(o.expr),o}return g(n,[{key:"clone",value:function(){return new n(null,this.model,XN(this.filter))}},{key:"dependentFields",value:function(){return this._dependentFields}},{key:"producedFields",value:function(){return new Set}},{key:"assemble",value:function(){return{type:"filter",expr:this.expr}}},{key:"hash",value:function(){return"Filter ".concat(this.expr)}}]),n}(Tq);function sK(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"datum",i=[],a=hR(t,(function(t){var a=dR(t),o=e.getSelectionComponent(a,t),s=IN(a+iH);if(o.project.timeUnit){var u=null!==n&&void 0!==n?n:e.component.data.raw,c=o.project.timeUnit.clone();u.parent?c.insertAsParentOf(u):u.parent=c}return"none"!==o.empty&&i.push(s),"vlSelectionTest(".concat(s,", ").concat(r)+("global"===o.resolve?")":", ".concat(IN(o.resolve),")"))}));return(i.length?"!("+i.map((function(e){return"length(data(".concat(e,"))")})).join(" || ")+") || ":"")+"(".concat(a,")")}function uK(e,t){var n=t.encoding,r=t.field;if(n||r){if(n&&!r){var i=e.project.items.filter((function(e){return e.channel===n}));!i.length||i.length>1?(r=e.project.items[0].field,oz((i.length?"Multiple ":"No ")+"matching ".concat(IN(n)," encoding found for selection ").concat(IN(t.selection),". ")+'Using "field": '.concat(IN(r),"."))):r=i[0].field}}else r=e.project.items[0].field,e.project.items.length>1&&oz('A "field" or "encoding" must be specified when using a selection as a scale domain. '+'Using "field": '.concat(IN(r),"."));return"".concat(e.name,"[").concat(IN(r),"]")}function cK(e,t,n){return hR(t,(function(t){return FN(t)?t:function(e){return null===e||void 0===e?void 0:e.selection}(t)?sK(e,t.selection,n):Bz(t)}))}function lK(e,t,n,r){var i,a,o;e.encode=null!==(i=e.encode)&&void 0!==i?i:{},e.encode[t]=null!==(a=e.encode[t])&&void 0!==a?a:{},e.encode[t].update=null!==(o=e.encode[t].update)&&void 0!==o?o:{},e.encode[t].update[n]=r}function fK(e,t,n){var r,i,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{header:!1},o=e.combine(),s=o.disable,u=o.orient,c=o.scale,l=o.labelExpr,f=o.title,d=o.zindex,p=RN(o,["disable","orient","scale","labelExpr","title","zindex"]);if(!s){for(var m in p){var v=TR[m],g=p[m];if(v&&v!==t&&"both"!==v)delete p[m];else if(OR(g)){var y=g.condition,b=RN(g,["condition"]),x=AN(y),w=AR[m];if(w){var _=w.vgProp;lK(p,w.part,_,[].concat(h(x.map((function(e){var t=e.test,n=RN(e,["test"]);return Object.assign({test:cK(null,t)},n)}))),[b])),delete p[m]}else if(null===w){var k={signal:x.map((function(e){var t=e.test,n=RN(e,["test"]);return"".concat(cK(null,t)," ? ").concat(RW(n)," : ")})).join("")+RW(b)};p[m]=k}}else if(kz(g)){var E=AR[m];if(E){var S=E.vgProp;lK(p,E.part,S,g),delete p[m]}}}if("grid"===t){if(!p.grid)return;if(p.encode){var C=p.encode.grid;p.encode=Object.assign({},C?{grid:C}:{}),sR(p.encode)&&delete p.encode}return Object.assign(Object.assign({scale:c,orient:u},p),{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:_R(d,0)})}if(!a.header&&e.mainExtracted)return;if(void 0!==l){var A=l;(null===(i=null===(r=p.encode)||void 0===r?void 0:r.labels)||void 0===i?void 0:i.update)&&kz(p.encode.labels.update.text)&&(A=bR(l,"datum.label",p.encode.labels.update.text.signal)),lK(p,"labels","text",{signal:A})}if(null===p.labelAlign&&delete p.labelAlign,p.encode){for(var O=0,D=DR;O<D.length;O++){var T=D[O];e.hasAxisPart(T)||delete p.encode[T]}sR(p.encode)&&delete p.encode}var j=function(e,t){if(e)return wN(e)&&!IW(e)?e.map((function(e){return xW(e,t)})).join(", "):e}(f,n);return Object.assign(Object.assign(Object.assign(Object.assign({scale:c,orient:u,grid:!1},j?{title:j}:{}),p),!1===n.aria?{aria:!1}:{}),{zindex:_R(d,0)})}}function dK(e){var t,n=e.component.axes,r=[],i=p(yB);try{for(i.s();!(t=i.n()).done;){var a=t.value;if(n[a]){var o,s=p(n[a]);try{for(s.s();!(o=s.n()).done;){var u=o.value;if(!u.get("disable")&&!u.get("gridScale")){var c="x"===a?"height":"width",l=e.getSizeSignalRef(c).signal;c!==l&&r.push({name:c,update:l})}}}catch(f){s.e(f)}finally{s.f()}}}}catch(f){i.e(f)}finally{i.f()}return r}var hK={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},pK={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},mK=uR(hK),vK=uR(pK);function gK(e,t,n,r){return Object.assign.apply(null,[{}].concat(h(e.map((function(e){if("axisOrient"===e){var i,a="x"===n?"bottom":"left",o=t["x"===n?"axisBottom":"axisLeft"]||{},s=t["x"===n?"axisTop":"axisRight"]||{},u=new Set([].concat(h(uR(o)),h(uR(s)))),c={},l=p(u.values());try{for(l.s();!(i=l.n()).done;){var f=i.value;c[f]={signal:"".concat(r.signal,' === "').concat(a,'" ? ').concat(PW(o[f])," : ").concat(PW(s[f]))}}}catch(d){l.e(d)}finally{l.f()}return c}return t[e]})))))}function yK(e,t,n,r){var i="band"===t?["axisDiscrete","axisBand"]:"point"===t?["axisDiscrete","axisPoint"]:function(e){return e in nU}(t)?["axisQuantitative"]:"time"===t||"utc"===t?["axisTemporal"]:[],a="x"===e?"axisX":"axisY",o=kz(n)?"axisOrient":"axis"+mR(n),s=[].concat(i,h(i.map((function(e){return a+e.substr(4)})))),u=["axis",o,a];return{vlOnlyAxisConfig:gK(s,r,e,n),vgAxisConfig:gK(u,r,e,n),axisConfigStyle:function(e,t){var n,r,i=[{}],a=p(e);try{for(a.s();!(r=a.n()).done;){var o=null===(n=t[r.value])||void 0===n?void 0:n.style;if(o){o=AN(o);var s,u=p(o);try{for(u.s();!(s=u.n()).done;){var c=s.value;i.push(t.style[c])}}catch(l){u.e(l)}finally{u.f()}}}}catch(l){a.e(l)}finally{a.f()}return Object.assign.apply(null,i)}([].concat(u,h(s)),r)}}function bK(e,t,n){var r,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=WW(e,n,t.style);if(void 0!==a)return{configFrom:"style",configValue:a};for(var o=0,s=["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"];o<s.length;o++){var u=s[o];if(void 0!==(null===(r=i[u])||void 0===r?void 0:r[e]))return{configFrom:u,configValue:i[u][e]}}return{}}var xK={scale:function(e){var t=e.model,n=e.channel;return t.scaleName(n)},format:function(e){var t=e.fieldOrDatumDef,n=e.config,r=e.axis,i=r.format,a=r.formatType;return MU(t,t.type,i,a,n,!0)},formatType:function(e){var t=e.axis,n=e.fieldOrDatumDef,r=e.scaleType;return FU(t.formatType,n,r)},grid:function(e){var t,n=e.fieldOrDatumDef,r=e.axis,i=e.scaleType;return(!eW(n)||!IB(n.bin))&&(null!==(t=r.grid)&&void 0!==t?t:function(e,t){return!oU(e)&&eW(t)&&!FB(null===t||void 0===t?void 0:t.bin)}(i,n))},gridScale:function(e){return function(e,t){var n="x"===t?"y":"x";if(e.getScaleComponent(n))return e.scaleName(n)}(e.model,e.channel)},labelAlign:function(e){var t=e.axis,n=e.labelAngle,r=e.orient,i=e.channel;return t.labelAlign||kK(n,r,i)},labelAngle:function(e){return e.labelAngle},labelBaseline:function(e){var t=e.axis,n=e.labelAngle,r=e.orient,i=e.channel;return t.labelBaseline||_K(n,r,i)},labelFlush:function(e){var t,n=e.axis,r=e.fieldOrDatumDef,i=e.channel;return null!==(t=n.labelFlush)&&void 0!==t?t:function(e,t){if("x"===t&&QN(["quantitative","temporal"],e))return!0}(r.type,i)},labelOverlap:function(e){var t,n=e.axis,r=e.fieldOrDatumDef,i=e.scaleType;return null!==(t=n.labelOverlap)&&void 0!==t?t:function(e,t){if("nominal"!==e)return"log"!==t||"greedy"}(r.type,i)},orient:function(e){return e.orient},tickCount:function(e){var t,n=e.channel,r=e.model,i=e.axis,a=e.fieldOrDatumDef,o=e.scaleType,s="x"===n?"width":"y"===n?"height":void 0,u=s?r.getSizeSignalRef(s):void 0;return null!==(t=i.tickCount)&&void 0!==t?t:function(e){var t,n=e.fieldOrDatumDef,r=e.scaleType,i=e.size;if(!e.values&&!oU(r)&&"log"!==r){if(eW(n)){if(FB(n.bin))return{signal:"ceil(".concat(i.signal,"/10)")};if(n.timeUnit&&QN(["month","hours","day","quarter"],null===(t=_z(n.timeUnit))||void 0===t?void 0:t.unit))return}return{signal:"ceil(".concat(i.signal,"/40)")}}}({fieldOrDatumDef:a,scaleType:o,size:u,values:i.values})},title:function(e){var t=e.axis,n=e.model,r=e.channel;if(void 0!==t.title)return t.title;var i=EK(n,r);if(void 0!==i)return i;var a=n.typedFieldDef(r),o="x"===r?"x2":"y2",s=n.fieldDef(o);return GW(a?[XU(a)]:[],eW(s)?[XU(s)]:[])},values:function(e){return function(e,t){var n=e.values;return wN(n)?jW(t,n):kz(n)?n:void 0}(e.axis,e.fieldOrDatumDef)},zindex:function(e){var t,n=e.axis,r=e.fieldOrDatumDef,i=e.mark;return null!==(t=n.zindex)&&void 0!==t?t:function(e,t){return"rect"===e&&hW(t)?1:0}(i,r)}};function wK(e){return"(((".concat(e.signal," % 360) + 360) % 360)")}function _K(e,t,n,r){if(void 0!==e){if("x"===n){if(kz(e)){var i=wK(e);return{signal:"(45 < ".concat(i," && ").concat(i," < 135) || (225 < ").concat(i," && ").concat(i,' < 315) ? "middle" :')+"(".concat(i," <= 45 || 315 <= ").concat(i,") === ").concat(kz(t)?"(".concat(t.signal,' === "top")'):"top"===t,' ? "bottom" : "top"')}}if(45<e&&e<135||225<e&&e<315)return"middle";if(kz(t)){var a=e<=45||315<=e?"===":"!==";return{signal:"".concat(t.signal," ").concat(a,' "top" ? "bottom" : "top"')}}return(e<=45||315<=e)==("top"===t)?"bottom":"top"}if(kz(e)){var o=wK(e),s=kz(t)?"(".concat(t.signal,' === "left")'):"left"===t;return{signal:"".concat(o," <= 45 || 315 <= ").concat(o," || (135 <= ").concat(o," && ").concat(o," <= 225) ? ").concat(r?'"middle"':"null"," : (45 <= ").concat(o," && ").concat(o," <= 135) === ").concat(s,' ? "top" : "bottom"')}}if(e<=45||315<=e||135<=e&&e<=225)return r?"middle":null;if(kz(t)){var u=45<=e&&e<=135?"===":"!==";return{signal:"".concat(t.signal," ").concat(u,' "left" ? "top" : "bottom"')}}return(45<=e&&e<=135)==("left"===t)?"top":"bottom"}}function kK(e,t,n){if(void 0!==e){var r="x"===n,i=r?0:90,a=r?"bottom":"left";if(kz(e)){var o=wK(e),s=kz(t)?"(".concat(t.signal,' === "').concat(a,'")'):t===a;return{signal:"(".concat(i?"("+o+" + 90)":o," % 180 === 0) ? ").concat(r?null:'"center"'," :")+"(".concat(i," < ").concat(o," && ").concat(o," < ").concat(180+i,") === ").concat(s,' ? "left" : "right"')}}if((e+i)%180==0)return r?null:"center";if(kz(t)){var u=i<e&&e<180+i?"===":"!==";return{signal:"".concat("".concat(t.signal," ").concat(u,' "').concat(a,'"'),' ? "left" : "right"')}}return(i<e&&e<180+i)==(t===a)?"left":"right"}}function EK(e,t){var n="x"===t?"x2":"y2",r=e.fieldDef(t),i=e.fieldDef(n),a=r?r.title:void 0,o=i?i.title:void 0;return a&&o?qW(a,o):a||o||(void 0!==a?a:void 0!==o?o:void 0)}var SK=function(e){c(n,e);var t=l(n);function n(e,r){var i;return v(this,n),(i=t.call(this,e)).transform=r,i._dependentFields=aK(i.transform.calculate),i}return g(n,[{key:"clone",value:function(){return new n(null,XN(this.transform))}},{key:"producedFields",value:function(){return new Set([this.transform.as])}},{key:"dependentFields",value:function(){return this._dependentFields}},{key:"assemble",value:function(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}},{key:"hash",value:function(){return"Calculate ".concat(JN(this.transform))}}],[{key:"parseAllForSortIndex",value:function(e,t){return t.forEachFieldDef((function(t,r){if(uW(t)&&VU(t.sort)){var i=t.field,a=t.timeUnit,o=t.sort,s=o.map((function(e,t){return"".concat(Bz({field:i,timeUnit:a,equal:e})," ? ").concat(t," : ")})).join("")+o.length;e=new n(e,{calculate:s,as:CK(t,r,{forAs:!0})})}})),e}}]),n}(Tq);function CK(e,t,n){return dW(e,Object.assign({prefix:t,suffix:"sort_index"},null!==n&&void 0!==n?n:{}))}function AK(e,t){return QN(["top","bottom"],t)?"column":QN(["left","right"],t)||"row"===e?"row":"column"}function OK(e,t,n,r){var i="row"===r?n.headerRow:"column"===r?n.headerColumn:n.headerFacet;return _R(((null===t||void 0===t?void 0:t.header)||{})[e],i[e],n.header[e])}function DK(e,t,n,r){var i,a={},o=p(e);try{for(o.s();!(i=o.n()).done;){var s=i.value,u=OK(s,t,n,r);void 0!==u&&(a[s]=u)}}catch(c){o.e(c)}finally{o.f()}return a}var TK=["row","column"],jK=["header","footer"];function MK(e,t){var n=e.component.layoutHeaders[t].title,r=e.config?e.config:void 0,i=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,a=DK(["titleAnchor","titleAngle","titleOrient"],i,r,t),o=a.titleAnchor,s=a.titleAngle,u=AK(t,a.titleOrient),c=SR(s);return{name:"".concat(t,"-title"),type:"group",role:"".concat(u,"-title"),title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:n},"row"===t?{orient:"left"}:{}),{style:"guide-title"}),IK(c,u)),FK(u,c,o)),zK(r,i,t,mK,hK))}}function FK(e,t){switch(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"middle"){case"start":return{align:"left"};case"end":return{align:"right"}}var n=kK(t,"row"===e?"left":"top","row"===e?"y":"x");return n?{align:n}:{}}function IK(e,t){var n=_K(e,"row"===t?"left":"top","row"===t?"y":"x",!0);return n?{baseline:n}:{}}function NK(e,t){for(var n=e.component.layoutHeaders[t],r=[],i=0,a=jK;i<a.length;i++){var o=a[i];if(n[o]){var s,u=p(n[o]);try{for(u.s();!(s=u.n()).done;){var c=PK(e,t,o,n,s.value);null!=c&&r.push(c)}}catch(l){u.e(l)}finally{u.f()}}}return r}function RK(e,t,n){var r=DK(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e,n,t),i=r.format,a=r.formatType,o=r.labelAngle,s=r.labelAnchor,u=r.labelOrient,c=r.labelExpr,l=DU({fieldOrDatumDef:e,format:i,formatType:a,expr:"parent",config:n}).signal,f=AK(t,u);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:c?bR(bR(c,"datum.label",l),"datum.value",dW(e,{expr:"parent"})):l}},"row"===t?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),IK(o,f)),FK(f,o,s)),zK(n,e,t,vK,pK))}function PK(e,t,n,r,i){if(i){var a=null,o=r.facetFieldDef,s=e.config?e.config:void 0;if(o&&i.labels){var u=DK(["labelOrient"],o,s,t).labelOrient;("row"===t&&!QN(["top","bottom"],u)||"column"===t&&!QN(["left","right"],u))&&(a=RK(o,t,s))}var c=N$(e)&&!GU(e.facet),l=i.axes,f=(null===l||void 0===l?void 0:l.length)>0;if(a||f){var d="row"===t?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName("".concat(t,"_").concat(n)),type:"group",role:"".concat(t,"-").concat(n)},r.facetFieldDef?{from:{data:e.getName(t+"_domain")},sort:function(e,t){var n,r=e.sort;return WU(r)?{field:dW(r,{expr:"datum"}),order:null!==(n=r.order)&&void 0!==n?n:"ascending"}:wN(r)?{field:CK(e,t,{expr:"datum"}),order:"ascending"}:{field:dW(e,{expr:"datum"}),order:null!==r&&void 0!==r?r:"ascending"}}(o,t)}:{}),f&&c?{from:{data:e.getName("facet_domain_".concat(t))}}:{}),a?{title:a}:{}),i.sizeSignal?{encode:{update:y({},d,i.sizeSignal)}}:{}),f?{axes:l}:{})}}return null}var BK={column:{start:0,end:1},row:{start:1,end:0}};function LK(e,t){return BK[t][e]}function zK(e,t,n,r,i){var a,o={},s=p(r);try{for(s.s();!(a=s.n()).done;){var u=a.value;if(i[u]){var c=OK(u,t,e,n);void 0!==c&&(o[i[u]]=c)}}}catch(l){s.e(l)}finally{s.f()}return o}function UK(e){return[].concat(h(WK(e,"width")),h(WK(e,"height")),h(WK(e,"childWidth")),h(WK(e,"childHeight")))}function WK(e,t){var n="width"===t?"x":"y",r=e.component.layoutSize.get(t);if(!r||"merged"===r)return[];var i=e.getSizeSignalRef(t).signal;if("step"===r){var a=e.getScaleComponent(n);if(a){var o=a.get("type"),s=a.get("range");if(oU(o)&&Ez(s)){var u=e.scaleName(n);return N$(e.parent)&&"independent"===e.parent.component.resolve.scale[n]?[VK(u,s)]:[VK(u,s),{name:i,update:GK(u,a,"domain('".concat(u,"').length"))}]}}throw new Error("layout size is step although width/height is not step.")}if("container"==r){var c=i.endsWith("width"),l=c?"containerSize()[0]":"containerSize()[1]",f="isFinite(".concat(l,") ? ").concat(l," : ").concat(PV(e.config.view,c?"width":"height"));return[{name:i,init:f,on:[{update:f,events:"window:resize"}]}]}return[{name:i,value:r}]}function VK(e,t){return{name:e+"_step",value:t.step}}function GK(e,t,n){var r=t.get("type"),i=t.get("padding"),a=_R(t.get("paddingOuter"),i),o=t.get("paddingInner");return"bandspace(".concat(n,", ").concat(o="band"===r?void 0!==o?o:i:1,", ").concat(a,") * ").concat(e,"_step")}function qK(e){return"childWidth"===e?"width":"childHeight"===e?"height":e}function HK(e,t){return uR(e).reduce((function(n,r){var i=e[r];return Object.assign(Object.assign({},n),rq(t,i,r,(function(e){return kz(e)?e:{value:e.value}})))}),{})}function XK(e,t){if(P$(t)||N$(t))return"shared";if(R$(t))return bB(e)?"independent":"shared";throw new Error("invalid model type for resolve")}function KK(e,t){var n=e.scale[t],r=bB(t)?"axis":"legend";return"independent"===n?("shared"===e[r][t]&&oz(P.independentScaleMeansIndependentGuide(t)),"independent"):e[r][t]||"shared"}var YK=Object.assign(Object.assign({},CV),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),$K=uR(YK),JK=function(e){c(n,e);var t=l(n);function n(){return v(this,n),t.apply(this,arguments)}return g(n)}(_G),ZK={symbols:function(e,t){var n,r,i,a,o,s=t.fieldOrDatumDef,u=t.model,c=t.channel,l=t.legendCmpt;if("symbol"===t.legendType){var f=u.markDef,d=u.encoding,h=u.config,m=u.mark,v=f.filled&&"trail"!==m,g=Object.assign(Object.assign({},function(e,t,n){var r,i=p(n);try{for(i.s();!(r=i.n()).done;){var a=r.value,o=zW(a,t.markDef,t.config);void 0!==o&&(e[a]=NW(o))}}catch(s){i.e(s)}finally{i.f()}return e}({},u,QR)),fq(u,{filled:v})),y=null!==(n=QK(d.opacity))&&void 0!==n?n:f.opacity;if(g.fill)if("fill"===c||v&&c===TP)delete g.fill;else if(g.fill.field)l.get("symbolFillColor")?delete g.fill:(g.fill=NW(null!==(r=h.legend.symbolBaseFillColor)&&void 0!==r?r:"black"),g.fillOpacity=NW(null!==y&&void 0!==y?y:1));else if(wN(g.fill)){var b=null!==(o=null!==(a=eY(null!==(i=d.fill)&&void 0!==i?i:d.color))&&void 0!==a?a:f.fill)&&void 0!==o?o:v&&f.color;b&&(g.fill=NW(b))}if(g.stroke)if("stroke"===c||!v&&c===TP)delete g.stroke;else if(g.stroke.field)delete g.stroke;else if(wN(g.stroke)){var x=_R(eY(d.stroke||d.color),f.stroke,v?f.color:void 0);x&&(g.stroke={value:x})}if(c!==RP){var w=eW(s)&&nY(u,l,s);w?g.opacity=[Object.assign({test:w},NW(null!==y&&void 0!==y?y:1)),NW(h.legend.unselectedOpacity)]:y&&(g.opacity=NW(y))}return sR(g=Object.assign(Object.assign({},g),e))?void 0:g}},gradient:function(e,t){var n=t.model;if("gradient"===t.legendType){var r={},i=QK(n.encoding.opacity)||n.markDef.opacity;return i&&(r.opacity=NW(i)),sR(r=Object.assign(Object.assign({},r),e))?void 0:r}},labels:function(e,t){var n=t.fieldOrDatumDef,r=t.model,i=t.channel,a=t.legendCmpt,o=r.legend(i)||{},s=r.config,u=eW(n)?nY(r,a,n):void 0,c=u?[{test:u,value:1},{value:s.legend.unselectedOpacity}]:void 0,l=o.format,f=o.formatType,d=CU(f)?jU({fieldOrDatumDef:n,field:"datum.value",format:l,formatType:f,config:s}):void 0,h=Object.assign(Object.assign(Object.assign({},c?{opacity:c}:{}),d?{text:d}:{}),e);return sR(h)?void 0:h},entries:function(e,t){var n=t.legendCmpt.get("selections");return(null===n||void 0===n?void 0:n.length)?Object.assign(Object.assign({},e),{fill:{value:"transparent"}}):e}};function QK(e){return tY(e,(function(e,t){return Math.max(e,t.value)}))}function eY(e){return tY(e,(function(e,t){return _R(e,t.value)}))}function tY(e,t){return function(e){var t=e&&e.condition;return!!t&&(wN(t)||sW(t))}(e)?AN(e.condition).reduce(t,e.value):sW(e)?e.value:void 0}function nY(e,t,n){var r=t.get("selections");if(null===r||void 0===r?void 0:r.length){var i=IN(n.field);return r.map((function(e){return"(!length(data(".concat(IN(dR(e)+iH),")) || (").concat(e,"[").concat(i,"] && indexof(").concat(e,"[").concat(i,"], datum.value) >= 0))")})).join(" || ")}}var rY={direction:function(e){return e.direction},format:function(e){var t=e.fieldOrDatumDef,n=e.legend,r=e.config,i=n.format,a=n.formatType;return MU(t,t.type,i,a,r,!1)},formatType:function(e){var t=e.legend,n=e.fieldOrDatumDef,r=e.scaleType;return FU(t.formatType,n,r)},gradientLength:function(e){var t,n,r=e.legend,i=e.legendConfig;return null!==(n=null!==(t=r.gradientLength)&&void 0!==t?t:i.gradientLength)&&void 0!==n?n:function(e){var t=e.legendConfig,n=e.model,r=e.direction,i=e.orient,a=e.scaleType,o=t.gradientHorizontalMaxLength,s=t.gradientHorizontalMinLength,u=t.gradientVerticalMaxLength,c=t.gradientVerticalMinLength;if(uU(a))return"horizontal"===r?"top"===i||"bottom"===i?oY(n,"width",s,o):s:oY(n,"height",c,u)}(e)},labelOverlap:function(e){var t,n,r=e.legend,i=e.legendConfig,a=e.scaleType;return null!==(n=null!==(t=r.labelOverlap)&&void 0!==t?t:i.labelOverlap)&&void 0!==n?n:function(e){if(QN(["quantile","threshold","log"],e))return"greedy"}(a)},symbolType:function(e){var t,n=e.legend,r=e.markDef,i=e.channel,a=e.encoding;return null!==(t=n.symbolType)&&void 0!==t?t:function(e,t,n,r){var i;if("shape"!==t){var a=null!==(i=eY(n))&&void 0!==i?i:r;if(a)return a}switch(e){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}(r.type,i,a.shape,r.shape)},title:function(e){return yW(e.fieldOrDatumDef,e.config,{allowDisabling:!0})},type:function(e){var t=e.legendType,n=e.scaleType;if(eB(e.channel)&&uU(n)){if("gradient"===t)return}else if("symbol"===t)return;return t},values:function(e){var t=e.fieldOrDatumDef;return function(e,t){var n=e.values;return wN(n)?jW(t,n):kz(n)?n:void 0}(e.legend,t)}};function iY(e){return _R(e.legend.type,function(e){var t=e.channel,n=e.timeUnit,r=e.scaleType;if(eB(t)){if(QN(["quarter","month","day"],n))return"symbol";if(uU(r))return"gradient"}return"symbol"}(e))}function aY(e){var t,n,r=e.legendConfig,i=e.legendType,a=e.orient;return null!==(n=null!==(t=e.legend.direction)&&void 0!==t?t:r[i?"gradientDirection":"symbolDirection"])&&void 0!==n?n:function(e,t){switch(e){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return"gradient"===t?"horizontal":void 0}}(a,i)}function oY(e,t,n,r){return{signal:"clamp(".concat(e.getSizeSignalRef(t).signal,", ").concat(n,", ").concat(r,")")}}function sY(e){var t=I$(e)?function(e){for(var t=e.encoding,n={},r=0,i=[TP].concat(EV);r<i.length;r++){var a=i[r],o=kW(t[a]);o&&e.getScaleComponent(a)&&(a===FP&&eW(o)&&o.type===Hz||(n[a]=cY(e,a)))}return n}(e):function(e){var t,n=e.component,r=n.legends,i=n.resolve,a=p(e.children);try{for(a.s();!(t=a.n()).done;){var o=t.value;sY(o);var s,u=p(uR(o.component.legends));try{for(u.s();!(s=u.n()).done;){var c=s.value;i.legend[c]=KK(e.component.resolve,c),"shared"===i.legend[c]&&(r[c]=lY(r[c],o.component.legends[c]),r[c]||(i.legend[c]="independent",delete r[c]))}}catch(g){u.e(g)}finally{u.f()}}}catch(g){a.e(g)}finally{a.f()}var l,f=p(uR(r));try{for(f.s();!(l=f.n()).done;){var d,h=l.value,m=p(e.children);try{for(m.s();!(d=m.n()).done;){var v=d.value;v.component.legends[h]&&"shared"===i.legend[h]&&delete v.component.legends[h]}}catch(g){m.e(g)}finally{m.f()}}}catch(g){f.e(g)}finally{f.f()}return r}(e);return e.component.legends=t,t}function uY(e,t,n,r){switch(t){case"disable":return void 0!==n;case"values":return!!(null===n||void 0===n?void 0:n.values);case"title":if("title"===t&&e===(null===r||void 0===r?void 0:r.title))return!0}return e===(n||{})[t]}function cY(e,t){var n,r,i,a=e.legend(t),o=e.markDef,s=e.encoding,u=e.config,c=u.legend,l=new JK({},function(e,t){var n=e.scaleName(t);if("trail"===e.mark){if("color"===t)return{stroke:n};if("size"===t)return{strokeWidth:n}}return"color"===t?e.markDef.filled?{fill:n}:{stroke:n}:y({},t,n)}(e,t));!function(e,t,n){var r,i=null===(r=e.fieldDef(t))||void 0===r?void 0:r.field;cH(e,(function(e){var r,a,o=null!==(r=e.project.hasField[i])&&void 0!==r?r:e.project.hasChannel[t];if(o&&Lq.has(e)){var s=null!==(a=n.get("selections"))&&void 0!==a?a:[];s.push(e.name),n.set("selections",s,!1),o.hasLegend=!0}}))}(e,t,l);var f=void 0!==a?!a:c.disable;if(l.set("disable",f,void 0!==a),f)return l;a=a||{};var d,h=e.getScaleComponent(t).get("type"),m=kW(s[t]),v=eW(m)?null===(n=_z(m.timeUnit))||void 0===n?void 0:n.unit:void 0,g=a.orient||u.legend.orient||"right",b=iY({legend:a,channel:t,timeUnit:v,scaleType:h}),x={legend:a,channel:t,model:e,markDef:o,encoding:s,fieldOrDatumDef:m,legendConfig:c,config:u,scaleType:h,orient:g,legendType:b,direction:aY({legend:a,legendType:b,orient:g,legendConfig:c})},w=p($K);try{for(w.s();!(d=w.n()).done;){var _=d.value,k=_ in rY?rY[_](x):a[_];if(void 0!==k){var E=uY(k,_,a,e.fieldDef(t));(E||void 0===u.legend[_])&&l.set(_,k,E)}}}catch(I){w.e(I)}finally{w.f()}for(var S=null!==(r=null===a||void 0===a?void 0:a.encoding)&&void 0!==r?r:{},C=l.get("selections"),A={},O={fieldOrDatumDef:m,model:e,channel:t,legendCmpt:l,legendType:b},D=0,T=["labels","legend","title","symbols","gradient","entries"];D<T.length;D++){var j=T[D],M=HK(null!==(i=S[j])&&void 0!==i?i:{},e),F=j in ZK?ZK[j](M,O):M;void 0===F||sR(F)||(A[j]=Object.assign(Object.assign(Object.assign({},(null===C||void 0===C?void 0:C.length)&&eW(m)?{name:"".concat(dR(m.field),"_legend_").concat(j)}:{}),(null===C||void 0===C?void 0:C.length)?{interactive:!!C}:{}),{update:F}))}return sR(A)||l.set("encode",A,!!(null===a||void 0===a?void 0:a.encoding)),l}function lY(e,t){var n,r,i,a;if(!e)return t.clone();var o=e.getWithExplicit("orient"),s=t.getWithExplicit("orient");if(!o.explicit||!s.explicit||o.value===s.value){var u,c=!1,l=p($K);try{var f=function(){var n=u.value,r=AG(e.getWithExplicit(n),t.getWithExplicit(n),n,"legend",(function(e,t){switch(n){case"symbolType":return fY(e,t);case"title":return HW(e,t);case"type":return c=!0,EG("symbol")}return CG(e,t,n,"legend")}));e.setWithExplicit(n,r)};for(l.s();!(u=l.n()).done;)f()}catch(d){l.e(d)}finally{l.f()}return c&&((null===(r=null===(n=e.implicit)||void 0===n?void 0:n.encode)||void 0===r?void 0:r.gradient)&&pR(e.implicit,["encode","gradient"]),(null===(a=null===(i=e.explicit)||void 0===i?void 0:i.encode)||void 0===a?void 0:a.gradient)&&pR(e.explicit,["encode","gradient"])),e}}function fY(e,t){return"circle"===t.value?t:e}function dY(e,t,n,r){var i,a,o;e.encode=null!==(i=e.encode)&&void 0!==i?i:{},e.encode[t]=null!==(a=e.encode[t])&&void 0!==a?a:{},e.encode[t].update=null!==(o=e.encode[t].update)&&void 0!==o?o:{},e.encode[t].update[n]=r}function hY(e){var t,n=e.component.legends,r={},i=p(uR(n));try{for(i.s();!(t=i.n()).done;){var a=t.value,o=e.getScaleComponent(a),s=$N(o.get("domains"));if(r[s]){var u,c=p(r[s]);try{for(c.s();!(u=c.n()).done;)lY(u.value,n[a])||r[s].push(n[a])}catch(l){c.e(l)}finally{c.f()}}else r[s]=[n[a].clone()]}}catch(l){i.e(l)}finally{i.f()}return cR(r).flat().map((function(t){return function(e,t){var n,r,i,a=e.combine(),o=a.disable,s=a.labelExpr,u=(a.selections,RN(a,["disable","labelExpr","selections"]));if(!o){if(!1===t.aria&&void 0==u.aria&&(u.aria=!1),null===(n=u.encode)||void 0===n?void 0:n.symbols){var c=u.encode.symbols.update;!c.fill||"transparent"===c.fill.value||c.stroke||u.stroke||(c.stroke={value:"transparent"});for(var l=0,f=EV;l<f.length;l++){var d=f[l];u[d]&&delete c[d]}}if(u.title||delete u.title,void 0!==s){var h=s;(null===(i=null===(r=u.encode)||void 0===r?void 0:r.labels)||void 0===i?void 0:i.update)&&kz(u.encode.labels.update.text)&&(h=bR(s,"datum.label",u.encode.labels.update.text.signal)),dY(u,"labels","text",{signal:h})}for(var p in u){var m=u[p];if(kz(m)){var v=SV[p];if(v){var g=v.vgProp;dY(u,v.part,g,m),delete u[p]}}}return u}}(t,e.config)})).filter((function(e){return void 0!==e}))}function pY(e){return P$(e)||R$(e)?function(e){return e.children.reduce((function(e,t){return e.concat(t.assembleProjections())}),mY(e))}(e):mY(e)}function mY(e){var t=e.component.projection;if(!t||t.merged)return[];var n=t.combine(),r=n.name;if(t.data){var i={signal:"[".concat(t.size.map((function(e){return e.signal})).join(", "),"]")},a=t.data.reduce((function(t,n){var r=kz(n)?n.signal:"data('".concat(e.lookupDataSource(n),"')");return QN(t,r)||t.push(r),t}),[]);if(a.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Object.assign({name:r,size:i,fit:{signal:a.length>1?"[".concat(a.join(", "),"]"):a[0]}},n)]}return[Object.assign(Object.assign({name:r},{translate:{signal:"[width / 2, height / 2]"}}),n)]}var vY=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"],gY=function(e){c(n,e);var t=l(n);function n(e,r,i,a){var o;return v(this,n),(o=t.call(this,Object.assign({},r),{name:e})).specifiedProjection=r,o.size=i,o.data=a,o.merged=!1,o}return g(n,[{key:"isFit",get:function(){return!!this.data}}]),n}(_G);function yY(e){e.component.projection=I$(e)?function(e){var t;if(e.hasProjection){var n=e.specifiedProjection,r=!(n&&(null!=n.scale||null!=n.translate)),i=r?[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]:void 0,a=r?function(e){for(var t=[],n=e.encoding,r=0,i=[[AP,CP],[DP,OP]];r<i.length;r++){var a=i[r];(kW(n[a[0]])||kW(n[a[1]]))&&t.push({signal:e.getName("geojson_".concat(t.length))})}return e.channelHasField(FP)&&e.typedFieldDef(FP).type===Hz&&t.push({signal:e.getName("geojson_".concat(t.length))}),0===t.length&&t.push(e.requestDataName(RG)),t}(e):void 0;return new gY(e.projectionName(!0),Object.assign(Object.assign({},null!==(t=e.config.projection)&&void 0!==t?t:{}),null!==n&&void 0!==n?n:{}),i,a)}}(e):function(e){if(0!==e.children.length){var t,n,r=p(e.children);try{for(r.s();!(n=r.n()).done;)yY(n.value)}catch(d){r.e(d)}finally{r.f()}var i=tR(e.children,(function(e){var n=e.component.projection;if(n){if(t){var r=function(e,t){var n=tR(vY,(function(n){return!TN(e.explicit,n)&&!TN(t.explicit,n)||!(!TN(e.explicit,n)||!TN(t.explicit,n)||$N(e.get(n))!==$N(t.get(n)))}));if($N(e.size)===$N(t.size)){if(n)return e;if($N(e.explicit)===$N({}))return t;if($N(t.explicit)===$N({}))return e}return null}(t,n);return r&&(t=r),!!r}return t=n,!0}return!0}));if(t&&i){var a,o=e.projectionName(!0),s=new gY(o,t.specifiedProjection,t.size,XN(t.data)),u=p(e.children);try{for(u.s();!(a=u.n()).done;){var c,l=a.value,f=l.component.projection;f&&(f.isFit&&(c=s.data).push.apply(c,h(l.component.projection.data)),l.renameProjection(f.get("name"),o),f.merged=!0)}}catch(d){u.e(d)}finally{u.f()}return s}}}(e)}function bY(e,t){return"".concat(MB(e),"_").concat(t)}function xY(e,t,n){var r,i=bY(null!==(r=AW(n,void 0))&&void 0!==r?r:{},t);return e.getName("".concat(i,"_bins"))}function wY(e,t,n){var r,i;r=function(e){return"as"in e}(e)?FN(e.as)?[e.as,"".concat(e.as,"_end")]:[e.as[0],e.as[1]]:[dW(e,{forAs:!0}),dW(e,{binSuffix:"end",forAs:!0})];var a=Object.assign({},AW(t,void 0)),o=bY(a,e.field),s=function(e,t){return{signal:e.getName("".concat(t,"_bins")),extentSignal:e.getName("".concat(t,"_extent"))}}(n,o),u=s.signal,c=s.extentSignal;if(RB(a.extent)){var l=a.extent,f=l.selection;i=uK(n.getSelectionComponent(dR(f),f),l),delete a.extent}return{key:o,binComponent:Object.assign(Object.assign(Object.assign({bin:a,field:e.field,as:[r]},u?{signal:u}:{}),c?{extentSignal:c}:{}),i?{span:i}:{})}}var _Y=function(e){c(n,e);var t=l(n);function n(e,r){var i;return v(this,n),(i=t.call(this,e)).bins=r,i}return g(n,[{key:"clone",value:function(){return new n(null,XN(this.bins))}},{key:"merge",value:function(e,t){var n,r=p(uR(e.bins));try{for(r.s();!(n=r.n()).done;){var i=n.value;i in this.bins?(t(e.bins[i].signal,this.bins[i].signal),this.bins[i].as=rR([].concat(h(this.bins[i].as),h(e.bins[i].as)),JN)):this.bins[i]=e.bins[i]}}catch(u){r.e(u)}finally{r.f()}var a,o=p(e.children);try{for(o.s();!(a=o.n()).done;){var s=a.value;e.removeChild(s),s.parent=this}}catch(u){o.e(u)}finally{o.f()}e.remove()}},{key:"producedFields",value:function(){return new Set(cR(this.bins).map((function(e){return e.as})).flat(2))}},{key:"dependentFields",value:function(){return new Set(cR(this.bins).map((function(e){return e.field})))}},{key:"hash",value:function(){return"Bin ".concat(JN(this.bins))}},{key:"assemble",value:function(){return cR(this.bins).flatMap((function(e){var t=[],n=i(e.as),r=n[0],a=n.slice(1),o=e.bin,s=o.extent,u=RN(o,["extent"]),c=Object.assign(Object.assign(Object.assign({type:"bin",field:yR(e.field),as:r,signal:e.signal},RB(s)?{extent:null}:{extent:s}),e.span?{span:{signal:"span(".concat(e.span,")")}}:{}),u);!s&&e.extentSignal&&(t.push({type:"extent",field:yR(e.field),signal:e.extentSignal}),c.extent={signal:e.extentSignal}),t.push(c);var l,f=p(a);try{for(f.s();!(l=f.n()).done;)for(var d=l.value,h=0;h<2;h++)t.push({type:"formula",expr:dW({field:r[h]},{expr:"datum"}),as:d[h]})}catch(m){f.e(m)}finally{f.f()}return e.formula&&t.push({type:"formula",expr:e.formula,as:e.formulaAs}),t}))}}],[{key:"makeFromEncoding",value:function(e,t){var r=t.reduceFieldDef((function(e,n,r){if(oW(n)&&FB(n.bin)){var i=wY(n,n.bin,t),a=i.key,o=i.binComponent;e[a]=Object.assign(Object.assign(Object.assign({},o),e[a]),function(e,t,n,r){var i,a;if(MW(t,n)){var o=I$(e)&&null!==(a=null!==(i=e.axis(n))&&void 0!==i?i:e.legend(n))&&void 0!==a?a:{},s=dW(t,{expr:"datum"}),u=dW(t,{expr:"datum",binSuffix:"end"});return{formulaAs:dW(t,{binSuffix:"range",forAs:!0}),formula:PU(s,u,o.format,o.formatType,r)}}return{}}(t,n,r,t.config))}return e}),{});return sR(r)?null:new n(e,r)}},{key:"makeFromTransform",value:function(e,t,r){var i=wY(t,t.bin,r),a=i.key,o=i.binComponent;return new n(e,y({},a,o))}}]),n}(Tq),kY=function(e){c(n,e);var t=l(n);function n(e){var i,a;if(v(this,n),i=t.call(this,null),MG(e=null!==e&&void 0!==e?e:{name:"source"})||(a=e.format?Object.assign({},YN(e.format,["parse"])):{}),TG(e))i._data={values:e.values};else if(DG(e)){if(i._data={url:e.url},!a.type){var o=/(?:\.([^.]+))?$/.exec(e.url)[1];QN(["json","csv","tsv","dsv","topojson"],o)||(o="json"),a.type=o}}else IG(e)?i._data={values:[{type:"Sphere"}]}:(jG(e)||MG(e))&&(i._data={});return i._generator=MG(e),e.name&&(i._name=e.name),a&&!sR(a)&&(i._data.format=a),r(i)}return g(n,[{key:"dependentFields",value:function(){return new Set}},{key:"producedFields",value:function(){}},{key:"data",get:function(){return this._data}},{key:"hasName",value:function(){return!!this._name}},{key:"isGenerator",get:function(){return this._generator}},{key:"dataName",get:function(){return this._name},set:function(e){this._name=e}},{key:"parent",set:function(e){throw new Error("Source nodes have to be roots.")}},{key:"remove",value:function(){throw new Error("Source nodes are roots and cannot be removed.")}},{key:"hash",value:function(){throw new Error("Cannot hash sources")}},{key:"assemble",value:function(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}]),n}(Tq);function EY(e){var t,n=p(e);try{for(n.s();!(t=n.n()).done;){var r,i=t.value,a=p(i.children);try{for(a.s();!(r=a.n()).done;){var o=r.value;if(o.parent!==i)return console.error("Dataflow graph is inconsistent.",i,o),!1}}catch(s){a.e(s)}finally{a.f()}if(!EY(i.children))return!1}}catch(s){n.e(s)}finally{n.f()}return!0}var SY=function(e){c(n,e);var t=l(n);function n(e,r){var i;return v(this,n),(i=t.call(this,e)).params=r,i}return g(n,[{key:"clone",value:function(){return new n(null,this.params)}},{key:"dependentFields",value:function(){return new Set}},{key:"producedFields",value:function(){}},{key:"hash",value:function(){return"Graticule ".concat(JN(this.params))}},{key:"assemble",value:function(){return Object.assign({type:"graticule"},!0===this.params?{}:this.params)}}]),n}(Tq),CY=function(e){c(n,e);var t=l(n);function n(e,r){var i;return v(this,n),(i=t.call(this,e)).params=r,i}return g(n,[{key:"clone",value:function(){return new n(null,this.params)}},{key:"dependentFields",value:function(){return new Set}},{key:"producedFields",value:function(){var e;return new Set([null!==(e=this.params.as)&&void 0!==e?e:"data"])}},{key:"hash",value:function(){return"Hash ".concat(JN(this.params))}},{key:"assemble",value:function(){return Object.assign({type:"sequence"},this.params)}}]),n}(Tq);function AY(e){return e instanceof kY||e instanceof SY||e instanceof CY}var OY=function(){function e(){v(this,e),this._mutated=!1}return g(e,[{key:"setMutated",value:function(){this._mutated=!0}},{key:"mutatedFlag",get:function(){return this._mutated}}]),e}(),DY=function(e){c(n,e);var t=l(n);function n(){var e;return v(this,n),(e=t.call(this))._continue=!1,e}return g(n,[{key:"setContinue",value:function(){this._continue=!0}},{key:"continueFlag",get:function(){return this._continue}},{key:"flags",get:function(){return{continueFlag:this.continueFlag,mutatedFlag:this.mutatedFlag}},set:function(e){var t=e.continueFlag,n=e.mutatedFlag;t&&this.setContinue(),n&&this.setMutated()}},{key:"reset",value:function(){}},{key:"optimizeNextFromLeaves",value:function(e){if(AY(e))return!1;var t=e.parent;return this.run(e).continueFlag&&this.optimizeNextFromLeaves(t),this.mutatedFlag}}]),n}(OY),TY=function(e){c(n,e);var t=l(n);function n(){return v(this,n),t.apply(this,arguments)}return g(n)}(OY);function jY(e,t,n,r){var i=I$(r)?r.encoding[hB(t)]:void 0;if(oW(n)&&I$(r)&&$U(t,n,i,r.stack,r.markDef,r.config))e.add(dW(n,{})),e.add(dW(n,{suffix:"end"})),n.bin&&MW(n,t)&&e.add(dW(n,{binSuffix:"range"}));else if(function(e){return e in JP}(t)){var a=function(e){switch(e){case CP:return"y";case OP:return"y2";case AP:return"x";case DP:return"x2"}}(t);e.add(r.getName(a))}else e.add(dW(n));return e}var MY=function(e){c(n,e);var t=l(n);function n(e,r,i){var a;return v(this,n),(a=t.call(this,e)).dimensions=r,a.measures=i,a}return g(n,[{key:"clone",value:function(){return new n(null,new Set(this.dimensions),XN(this.measures))}},{key:"groupBy",get:function(){return this.dimensions}},{key:"merge",value:function(e){return function(e,t){if(e.size!==t.size)return!1;var n,r=p(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!t.has(i))return!1}}catch(a){r.e(a)}finally{r.f()}return!0}(this.dimensions,e.dimensions)?(function(e,t){var n,r,i=p(uR(t));try{for(i.s();!(r=i.n()).done;){var a,o=r.value,s=t[o],u=p(uR(s));try{for(u.s();!(a=u.n()).done;){var c=a.value;o in e?e[o][c]=new Set([].concat(h(null!==(n=e[o][c])&&void 0!==n?n:[]),h(s[c]))):e[o]=y({},c,s[c])}}catch(l){u.e(l)}finally{u.f()}}}catch(l){i.e(l)}finally{i.f()}}(this.measures,e.measures),!0):(function(){var e;(e=iz).debug.apply(e,arguments)}("different dimensions, cannot merge"),!1)}},{key:"addDimensions",value:function(e){e.forEach(this.dimensions.add,this.dimensions)}},{key:"dependentFields",value:function(){return new Set([].concat(h(this.dimensions),h(uR(this.measures))))}},{key:"producedFields",value:function(){var e,t=new Set,n=p(uR(this.measures));try{for(n.s();!(e=n.n()).done;){var r,i=e.value,a=p(uR(this.measures[i]));try{for(a.s();!(r=a.n()).done;){var o=r.value,s=this.measures[i][o];0===s.size?t.add("".concat(o,"_").concat(i)):s.forEach(t.add,t)}}catch(u){a.e(u)}finally{a.f()}}}catch(u){n.e(u)}finally{n.f()}return t}},{key:"hash",value:function(){return"Aggregate ".concat(JN({dimensions:this.dimensions,measures:this.measures}))}},{key:"assemble",value:function(){var e,t=[],n=[],r=[],i=p(uR(this.measures));try{for(i.s();!(e=i.n()).done;){var a,o=e.value,s=p(uR(this.measures[o]));try{for(s.s();!(a=s.n()).done;){var u,c=a.value,l=p(this.measures[o][c]);try{for(l.s();!(u=l.n()).done;){var f=u.value;r.push(f),t.push(c),n.push("*"===o?null:yR(o))}}catch(d){l.e(d)}finally{l.f()}}}catch(d){s.e(d)}finally{s.f()}}}catch(d){i.e(d)}finally{i.f()}return{type:"aggregate",groupby:h(this.dimensions).map(yR),ops:t,fields:n,as:r}}}],[{key:"makeFromEncoding",value:function(e,t){var r=!1;t.forEachFieldDef((function(e){e.aggregate&&(r=!0)}));var i={},a=new Set;return r?(t.forEachFieldDef((function(e,n){var r,o,s,u,c=e.aggregate,l=e.field;if(c)if("count"===c)i["*"]=null!==(r=i["*"])&&void 0!==r?r:{},i["*"].count=new Set([dW(e,{forAs:!0})]);else{if(uP(c)||cP(c)){var f=uP(c)?"argmin":"argmax",d=c[f];i[d]=null!==(o=i[d])&&void 0!==o?o:{},i[d][f]=new Set([dW({op:f,field:d},{forAs:!0})])}else i[l]=null!==(s=i[l])&&void 0!==s?s:{},i[l][c]=new Set([dW(e,{forAs:!0})]);AB(n)&&"unaggregated"===t.scaleDomain(n)&&(i[l]=null!==(u=i[l])&&void 0!==u?u:{},i[l].min=new Set([dW({field:l,aggregate:"min"},{forAs:!0})]),i[l].max=new Set([dW({field:l,aggregate:"max"},{forAs:!0})]))}else jY(a,n,e,t)})),a.size+uR(i).length===0?null:new n(e,a,i)):null}},{key:"makeFromTransform",value:function(e,t){var r,i,a,o,s=new Set,u={},c=p(t.aggregate);try{for(c.s();!(o=c.n()).done;){var l=o.value,f=l.op,d=l.field,h=l.as;f&&("count"===f?(u["*"]=null!==(r=u["*"])&&void 0!==r?r:{},u["*"].count=new Set([h||dW(l,{forAs:!0})])):(u[d]=null!==(i=u[d])&&void 0!==i?i:{},u[d][f]=new Set([h||dW(l,{forAs:!0})])))}}catch(y){c.e(y)}finally{c.f()}var m,v=p(null!==(a=t.groupby)&&void 0!==a?a:[]);try{for(v.s();!(m=v.n()).done;){var g=m.value;s.add(g)}}catch(y){v.e(y)}finally{v.f()}return s.size+uR(u).length===0?null:new n(e,s,u)}}]),n}(Tq),FY=function(e){c(n,e);var t=l(n);function n(e,r,i,a){var o;v(this,n),(o=t.call(this,e)).model=r,o.name=i,o.data=a;var s,u=p(nB);try{for(u.s();!(s=u.n()).done;){var c=s.value,l=r.facet[c];if(l){var f=l.bin,d=l.sort;o[c]=Object.assign({name:r.getName("".concat(c,"_domain")),fields:[dW(l)].concat(h(FB(f)?[dW(l,{binSuffix:"end"})]:[]))},WU(d)?{sortField:d}:wN(d)?{sortIndexField:CK(l,c)}:{})}}}catch(m){u.e(m)}finally{u.f()}return o.childModel=r.child,o}return g(n,[{key:"hash",value:function(){var e,t="Facet",n=p(nB);try{for(n.s();!(e=n.n()).done;){var r=e.value;this[r]&&(t+=" ".concat(r.charAt(0),":").concat(JN(this[r])))}}catch(i){n.e(i)}finally{n.f()}return t}},{key:"fields",get:function(){var e,t,n=[],r=p(nB);try{for(r.s();!(t=r.n()).done;){var i=t.value;(null===(e=this[i])||void 0===e?void 0:e.fields)&&n.push.apply(n,h(this[i].fields))}}catch(a){r.e(a)}finally{r.f()}return n}},{key:"dependentFields",value:function(){var e,t=new Set(this.fields),n=p(nB);try{for(n.s();!(e=n.n()).done;){var r=e.value;this[r]&&(this[r].sortField&&t.add(this[r].sortField.field),this[r].sortIndexField&&t.add(this[r].sortIndexField))}}catch(i){n.e(i)}finally{n.f()}return t}},{key:"producedFields",value:function(){return new Set}},{key:"getSource",value:function(){return this.name}},{key:"getChildIndependentFieldsWithStep",value:function(){var e,t={},n=p(yB);try{for(n.s();!(e=n.n()).done;){var r=e.value,i=this.childModel.component.scales[r];if(i&&!i.merged){var a=i.get("type"),o=i.get("range");if(oU(a)&&Ez(o)){var s=m$(v$(this.childModel,r));s?t[r]=s:oz("Unknown field for ".concat(r,". Cannot calculate view size."))}}}}catch(u){n.e(u)}finally{n.f()}return t}},{key:"assembleRowColumnHeaderData",value:function(e,t,n){var r={row:"y",column:"x"}[e],i=[],a=[],o=[];n&&n[r]&&(t?(i.push("distinct_".concat(n[r])),a.push("max")):(i.push(n[r]),a.push("distinct")),o.push("distinct_".concat(n[r])));var s=this[e],u=s.sortField,c=s.sortIndexField;if(u){var l=u.op,f=void 0===l?BU:l,d=u.field;i.push(d),a.push(f),o.push(dW(u,{forAs:!0}))}else c&&(i.push(c),a.push("max"),o.push(c));return{name:this[e].name,source:null!==t&&void 0!==t?t:this.data,transform:[Object.assign({type:"aggregate",groupby:this[e].fields},i.length?{fields:i,ops:a,as:o}:{})]}}},{key:"assembleFacetHeaderData",value:function(e){for(var t,n,r=this.model.layout.columns,i=this.model.component.layoutHeaders,a=[],o={},s=0,u=TK;s<u.length;s++){for(var c=u[s],l=0,f=jK;l<f.length;l++){var d,h=f[l],m=null!==(t=i[c]&&i[c][h])&&void 0!==t?t:[],v=p(m);try{for(v.s();!(d=v.n()).done;)if((null===(n=d.value.axes)||void 0===n?void 0:n.length)>0){o[c]=!0;break}}catch(w){v.e(w)}finally{v.f()}}if(o[c]){var g='length(data("'.concat(this.facet.name,'"))'),y="row"===c?r?{signal:"ceil(".concat(g," / ").concat(r,")")}:1:r?{signal:"min(".concat(g,", ").concat(r,")")}:{signal:g};a.push({name:"".concat(this.facet.name,"_").concat(c),transform:[{type:"sequence",start:0,stop:y}]})}}var b=o.row,x=o.column;return(b||x)&&a.unshift(this.assembleRowColumnHeaderData("facet",null,e)),a}},{key:"assemble",value:function(){var e,t,n=[],r=null,i=this.getChildIndependentFieldsWithStep(),a=this.column,o=this.row,s=this.facet;if(a&&o&&(i.x||i.y)){r="cross_".concat(this.column.name,"_").concat(this.row.name);var u=[].concat(null!==(e=i.x)&&void 0!==e?e:[],null!==(t=i.y)&&void 0!==t?t:[]),c=u.map((function(){return"distinct"}));n.push({name:r,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:u,ops:c}]})}for(var l=0,f=[vP,mP];l<f.length;l++){var d=f[l];this[d]&&n.push(this.assembleRowColumnHeaderData(d,r,i))}if(s){var p=this.assembleFacetHeaderData(i);p&&n.push.apply(n,h(p))}return n}}]),n}(Tq);function IY(e){return"'"===e[0]&&"'"===e[e.length-1]||'"'===e[0]&&'"'===e[e.length-1]?e.slice(1,-1):e}function NY(e){var t={};return function e(t,n){if(qN(t))e(t.not,n);else if(GN(t)){var r,i=p(t.and);try{for(i.s();!(r=i.n()).done;)e(r.value,n)}catch(s){i.e(s)}finally{i.f()}}else if(VN(t)){var a,o=p(t.or);try{for(o.s();!(a=o.n()).done;)e(a.value,n)}catch(s){o.e(s)}finally{o.f()}}else n(t)}(e.filter,(function(e){var n;if(Rz(e)){var r=null;Dz(e)?r=e.equal:Iz(e)?r=e.range[0]:Nz(e)&&(r=(null!==(n=e.oneOf)&&void 0!==n?n:e.in)[0]),r&&(sz(r)?t[e.field]="date":MN(r)?t[e.field]="number":FN(r)&&(t[e.field]="string")),e.timeUnit&&(t[e.field]="date")}})),t}function RY(e){var t={};function n(e){DW(e)?t[e.field]="date":"quantitative"===e.type&&function(e){return FN(e)&&QN(["min","max"],e)}(e.aggregate)?t[e.field]="number":wR(e.field)>1?e.field in t||(t[e.field]="flatten"):uW(e)&&WU(e.sort)&&wR(e.sort.field)>1&&(e.sort.field in t||(t[e.sort.field]="flatten"))}if((I$(e)||N$(e))&&e.forEachFieldDef((function(t,r){if(oW(t))n(t);else{var i=fB(r),a=e.fieldDef(i);n(Object.assign(Object.assign({},t),{type:a.type}))}})),I$(e)){var r=e.mark,i=e.markDef,a=e.encoding;if(YR(r)&&!e.encoding.order){var o=a["horizontal"===i.orient?"y":"x"];!eW(o)||"quantitative"!==o.type||o.field in t||(t[o.field]="number")}}return t}var PY=function(e){c(n,e);var t=l(n);function n(e,r){var i;return v(this,n),(i=t.call(this,e))._parse=r,i}return g(n,[{key:"clone",value:function(){return new n(null,XN(this._parse))}},{key:"hash",value:function(){return"Parse ".concat(JN(this._parse))}},{key:"parse",get:function(){return this._parse}},{key:"merge",value:function(e){this._parse=Object.assign(Object.assign({},this._parse),e.parse),e.remove()}},{key:"assembleFormatParse",value:function(){var e,t={},n=p(uR(this._parse));try{for(n.s();!(e=n.n()).done;){var r=e.value,i=this._parse[r];1===wR(r)&&(t[r]=i)}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"producedFields",value:function(){return new Set(uR(this._parse))}},{key:"dependentFields",value:function(){return new Set(uR(this._parse))}},{key:"assembleTransforms",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return uR(this._parse).filter((function(e){return!t||wR(e)>1})).map((function(t){var n=function(e,t){var n=vR(e);return"number"===t?"toNumber(".concat(n,")"):"boolean"===t?"toBoolean(".concat(n,")"):"string"===t?"toString(".concat(n,")"):"date"===t?"toDate(".concat(n,")"):"flatten"===t?n:0===t.indexOf("date:")?"timeParse(".concat(n,",'").concat(IY(t.slice(5,t.length)),"')"):0===t.indexOf("utc:")?"utcParse(".concat(n,",'").concat(IY(t.slice(4,t.length)),"')"):(oz(P.unrecognizedParse(t)),null)}(t,e._parse[t]);return n?{type:"formula",expr:n,as:xR(t)}:null})).filter((function(e){return null!==e}))}}],[{key:"makeExplicit",value:function(e,t,n){var r={},i=t.data;return!MG(i)&&i&&i.format&&i.format.parse&&(r=i.format.parse),this.makeWithAncestors(e,r,{},n)}},{key:"makeWithAncestors",value:function(e,t,r,i){var a,o=p(uR(r));try{for(o.s();!(a=o.n()).done;){var s=a.value,u=i.getWithExplicit(s);void 0!==u.value&&(u.explicit||u.value===r[s]||"derived"===u.value||"flatten"===r[s]?delete r[s]:oz(P.differentParse(s,r[s],u.value)))}}catch(x){o.e(x)}finally{o.f()}var c,l=p(uR(t));try{for(l.s();!(c=l.n()).done;){var f=c.value,d=i.get(f);void 0!==d&&(d===t[f]?delete t[f]:oz(P.differentParse(f,t[f],d)))}}catch(x){l.e(x)}finally{l.f()}var h=new _G(t,r);i.copyAll(h);var m,v={},g=p(uR(h.combine()));try{for(g.s();!(m=g.n()).done;){var y=m.value,b=h.get(y);null!==b&&(v[y]=b)}}catch(x){g.e(x)}finally{g.f()}return 0===uR(v).length||i.parseNothing?null:new n(e,v)}}]),n}(Tq),BY=function(e){c(n,e);var t=l(n);function n(e){return v(this,n),t.call(this,e)}return g(n,[{key:"clone",value:function(){return new n(null)}},{key:"dependentFields",value:function(){return new Set}},{key:"producedFields",value:function(){return new Set([AV])}},{key:"hash",value:function(){return"Identifier"}},{key:"assemble",value:function(){return{type:"identifier",as:AV}}}]),n}(Tq),LY=function(e){c(n,e);var t=l(n);function n(e,r){var i;return v(this,n),(i=t.call(this,e)).transform=r,i}return g(n,[{key:"clone",value:function(){return new n(null,XN(this.transform))}},{key:"addDimensions",value:function(e){this.transform.groupby=rR(this.transform.groupby.concat(e),(function(e){return e}))}},{key:"dependentFields",value:function(){var e=new Set;return this.transform.groupby&&this.transform.groupby.forEach(e.add,e),this.transform.joinaggregate.map((function(e){return e.field})).filter((function(e){return void 0!==e})).forEach(e.add,e),e}},{key:"producedFields",value:function(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}},{key:"getDefaultName",value:function(e){var t;return null!==(t=e.as)&&void 0!==t?t:dW(e)}},{key:"hash",value:function(){return"JoinAggregateTransform ".concat(JN(this.transform))}},{key:"assemble",value:function(){var e,t=[],n=[],r=[],i=p(this.transform.joinaggregate);try{for(i.s();!(e=i.n()).done;){var a=e.value;n.push(a.op),r.push(this.getDefaultName(a)),t.push(void 0===a.field?null:a.field)}}catch(s){i.e(s)}finally{i.f()}var o=this.transform.groupby;return Object.assign({type:"joinaggregate",as:r,ops:n,fields:t},void 0!==o?{groupby:o}:{})}}]),n}(Tq),zY=function(e){c(n,e);var t=l(n);function n(e,r){var i;return v(this,n),(i=t.call(this,e))._stack=r,i}return g(n,[{key:"clone",value:function(){return new n(null,XN(this._stack))}},{key:"stack",get:function(){return this._stack}},{key:"addDimensions",value:function(e){var t;(t=this._stack.facetby).push.apply(t,h(e))}},{key:"dependentFields",value:function(){var e=new Set;return e.add(this._stack.stackField),this.getGroupbyFields().forEach(e.add,e),this._stack.facetby.forEach(e.add,e),this._stack.sort.field.forEach(e.add,e),e}},{key:"producedFields",value:function(){return new Set(this._stack.as)}},{key:"hash",value:function(){return"Stack ".concat(JN(this._stack))}},{key:"getGroupbyFields",value:function(){var e=this._stack,t=e.dimensionFieldDef,n=e.impute,r=e.groupby;return t?t.bin?n?[dW(t,{binSuffix:"mid"})]:[dW(t,{}),dW(t,{binSuffix:"end"})]:[dW(t)]:null!==r&&void 0!==r?r:[]}},{key:"assemble",value:function(){var e=[],t=this._stack,n=t.facetby,r=t.dimensionFieldDef,i=t.stackField,a=t.stackby,o=t.sort,s=t.offset,u=t.impute,c=t.as;if(u&&r){var l=r.band,f=void 0===l?.5:l;r.bin&&e.push({type:"formula",expr:"".concat(f,"*")+dW(r,{expr:"datum"})+"+".concat(1-f,"*")+dW(r,{expr:"datum",binSuffix:"end"}),as:dW(r,{binSuffix:"mid",forAs:!0})}),e.push({type:"impute",field:i,groupby:[].concat(h(a),h(n)),key:dW(r,{binSuffix:"mid"}),method:"value",value:0})}return e.push({type:"stack",groupby:[].concat(h(this.getGroupbyFields()),h(n)),field:i,sort:o,as:c,offset:s}),e}}],[{key:"makeFromTransform",value:function(e,t){var r=t.stack,i=t.groupby,a=t.as,o=t.offset,s=void 0===o?"zero":o,u=[],c=[];if(void 0!==t.sort){var l,f=p(t.sort);try{for(f.s();!(l=f.n()).done;){var d=l.value;u.push(d.field),c.push(_R(d.order,"ascending"))}}catch(v){f.e(v)}finally{f.f()}}var h,m={field:u,order:c};return h=function(e){return wN(e)&&e.every((function(e){return FN(e)}))&&e.length>1}(a)?a:FN(a)?[a,a+"_end"]:[t.stack+"_start",t.stack+"_end"],new n(e,{stackField:r,groupby:i,offset:s,sort:m,facetby:[],as:h})}},{key:"makeFromEncoding",value:function(e,t){var r=t.stack,i=t.encoding;if(!r)return null;var a,o=r.groupbyChannel,s=r.fieldChannel,u=r.offset,c=r.impute;o&&(a=_W(i[o]));var l,f=function(e){return e.stack.stackBy.reduce((function(e,t){var n=dW(t.fieldDef);return n&&e.push(n),e}),[])}(t),d=t.encoding.order;return l=wN(d)||eW(d)?VW(d):f.reduce((function(e,t){return e.field.push(t),e.order.push("y"===s?"descending":"ascending"),e}),{field:[],order:[]}),new n(e,{dimensionFieldDef:a,stackField:t.vgField(s),facetby:[],stackby:f,sort:l,offset:u,impute:c,as:[t.vgField(s,{suffix:"start",forAs:!0}),t.vgField(s,{suffix:"end",forAs:!0})]})}}]),n}(Tq),UY=function(e){c(n,e);var t=l(n);function n(e,r){var i;return v(this,n),(i=t.call(this,e)).transform=r,i}return g(n,[{key:"clone",value:function(){return new n(null,XN(this.transform))}},{key:"addDimensions",value:function(e){this.transform.groupby=rR(this.transform.groupby.concat(e),(function(e){return e}))}},{key:"dependentFields",value:function(){var e,t,n=new Set;return(null!==(e=this.transform.groupby)&&void 0!==e?e:[]).forEach(n.add,n),(null!==(t=this.transform.sort)&&void 0!==t?t:[]).forEach((function(e){return n.add(e.field)})),this.transform.window.map((function(e){return e.field})).filter((function(e){return void 0!==e})).forEach(n.add,n),n}},{key:"producedFields",value:function(){return new Set(this.transform.window.map(this.getDefaultName))}},{key:"getDefaultName",value:function(e){var t;return null!==(t=e.as)&&void 0!==t?t:dW(e)}},{key:"hash",value:function(){return"WindowTransform ".concat(JN(this.transform))}},{key:"assemble",value:function(){var e,t,n=[],r=[],i=[],a=[],o=p(this.transform.window);try{for(o.s();!(t=o.n()).done;){var s=t.value;r.push(s.op),i.push(this.getDefaultName(s)),a.push(void 0===s.param?null:s.param),n.push(void 0===s.field?null:s.field)}}catch(y){o.e(y)}finally{o.f()}var u=this.transform.frame,c=this.transform.groupby;if(u&&null===u[0]&&null===u[1]&&r.every((function(e){return lP(e)})))return Object.assign({type:"joinaggregate",as:i,ops:r,fields:n},void 0!==c?{groupby:c}:{});var l=[],f=[];if(void 0!==this.transform.sort){var d,h=p(this.transform.sort);try{for(h.s();!(d=h.n()).done;){var m=d.value;l.push(m.field),f.push(null!==(e=m.order)&&void 0!==e?e:"ascending")}}catch(y){h.e(y)}finally{h.f()}}var v={field:l,order:f},g=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:a,as:i,ops:r,fields:n,sort:v},void 0!==g?{ignorePeers:g}:{}),void 0!==c?{groupby:c}:{}),void 0!==u?{frame:u}:{})}}]),n}(Tq),WY=function(e){c(n,e);var t=l(n);function n(){return v(this,n),t.apply(this,arguments)}return g(n,[{key:"run",value:function(e){var t=e.parent;if(e instanceof PY){if(AY(t))return this.flags;if(t.numChildren()>1)return this.setContinue(),this.flags;if(t instanceof PY)this.setMutated(),t.merge(e);else{if(oR(t.producedFields(),e.dependentFields()))return this.setContinue(),this.flags;this.setMutated(),e.swapWithParent()}}return this.setContinue(),this.flags}}]),n}(DY),VY=function(e){c(n,e);var t=l(n);function n(){return v(this,n),t.apply(this,arguments)}return g(n,[{key:"mergeNodes",value:function(e,t){var n,r=t.shift(),i=p(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;e.removeChild(a),a.parent=r,a.remove()}}catch(o){i.e(o)}finally{i.f()}}},{key:"run",value:function(e){for(var t=e.children.map((function(e){return e.hash()})),n={},r=0;r<t.length;r++)void 0===n[t[r]]?n[t[r]]=[e.children[r]]:n[t[r]].push(e.children[r]);var i,a=p(uR(n));try{for(a.s();!(i=a.n()).done;){var o=i.value;n[o].length>1&&(this.setMutated(),this.mergeNodes(e,n[o]))}}catch(l){a.e(l)}finally{a.f()}var s,u=p(e.children);try{for(u.s();!(s=u.n()).done;){var c=s.value;this.run(c)}}catch(l){u.e(l)}finally{u.f()}return this.mutatedFlag}}]),n}(TY),GY=function(e){c(n,e);var t=l(n);function n(){return v(this,n),t.apply(this,arguments)}return g(n,[{key:"run",value:function(e){return e instanceof jq||e.numChildren()>0||e instanceof FY||(this.setMutated(),e.remove()),this.flags}}]),n}(DY),qY=function(e){c(n,e);var t=l(n);function n(){var e;return v(this,n),(e=t.apply(this,arguments)).fields=new Set,e.prev=null,e}return g(n,[{key:"run",value:function(e){if(this.setContinue(),e instanceof Mq){var t=e.producedFields();iR(t,this.fields)?(this.setMutated(),this.prev.remove()):this.fields=new Set([].concat(h(this.fields),h(t))),this.prev=e}return this.flags}},{key:"reset",value:function(){this.fields.clear()}}]),n}(DY),HY=function(e){c(n,e);var t=l(n);function n(){return v(this,n),t.apply(this,arguments)}return g(n,[{key:"run",value:function(e){this.setContinue();var t,n=e.parent.children.filter((function(e){return e instanceof Mq})),r=n.pop(),i=p(n);try{for(i.s();!(t=i.n()).done;){var a=t.value;this.setMutated(),r.merge(a)}}catch(o){i.e(o)}finally{i.f()}return this.flags}}]),n}(DY);function XY(e){if(e instanceof FY)if(1!==e.numChildren()||e.children[0]instanceof jq){var t=e.model.component.data.main;!function e(t){if(t instanceof jq&&t.type===RG&&1===t.numChildren()){var n=t.children[0];n instanceof FY||(n.swapWithParent(),e(t))}}(t);var n,r=function(e){return function t(n){if(!(n instanceof FY)){var r=n.clone();if(r instanceof jq){var i=e$+r.getSource();r.setSource(i),e.model.component.data.outputNodes[i]=r}else(r instanceof MY||r instanceof zY||r instanceof UY||r instanceof LY)&&r.addDimensions(e.fields);var a,o=p(n.children.flatMap(t));try{for(o.s();!(a=o.n()).done;)a.value.parent=r}catch(s){o.e(s)}finally{o.f()}return[r]}return n.children.flatMap(t)}}(e),i=e.children.map(r).flat(),a=p(i);try{for(a.s();!(n=a.n()).done;)n.value.parent=t}catch(s){a.e(s)}finally{a.f()}}else{var o=e.children[0];(o instanceof MY||o instanceof zY||o instanceof UY||o instanceof LY)&&o.addDimensions(e.fields),o.swapWithParent(),XY(e)}else e.children.map(XY)}var KY=function(e){c(n,e);var t=l(n);function n(){return v(this,n),t.call(this)}return g(n,[{key:"run",value:function(e){e instanceof jq&&!e.isRequired()&&(this.setMutated(),e.remove());var t,n=p(e.children);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.run(r)}}catch(i){n.e(i)}finally{n.f()}return this.mutatedFlag}}]),n}(TY),YY=function(e){c(n,e);var t=l(n);function n(e){var r;return v(this,n),(r=t.call(this)).requiresSelectionId=e&&fH(e),r}return g(n,[{key:"run",value:function(e){e instanceof BY&&(this.requiresSelectionId&&(AY(e.parent)||e.parent instanceof MY||e.parent instanceof PY)||(this.setMutated(),e.remove()));var t,n=p(e.children);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.run(r)}}catch(i){n.e(i)}finally{n.f()}return this.mutatedFlag}}]),n}(TY),$Y=function(e){c(n,e);var t=l(n);function n(){return v(this,n),t.apply(this,arguments)}return g(n,[{key:"run",value:function(e){var t=e.parent,n=h(t.children),r=t.children.filter((function(e){return e instanceof PY}));if(t.numChildren()>1&&r.length>=1){var i,a={},o=new Set,s=p(r);try{for(s.s();!(i=s.n()).done;){var u,c=i.value.parse,l=p(uR(c));try{for(l.s();!(u=l.n()).done;){var f=u.value;f in a?a[f]!==c[f]&&o.add(f):a[f]=c[f]}}catch(k){l.e(k)}finally{l.f()}}}catch(k){s.e(k)}finally{s.f()}var d,m=p(o);try{for(m.s();!(d=m.n()).done;)delete a[d.value]}catch(k){m.e(k)}finally{m.f()}if(!sR(a)){this.setMutated();var v,g=new PY(t,a),y=p(n);try{for(y.s();!(v=y.n()).done;){var b=v.value;if(b instanceof PY){var x,w=p(uR(a));try{for(w.s();!(x=w.n()).done;){var _=x.value;delete b.parse[_]}}catch(k){w.e(k)}finally{w.f()}}t.removeChild(b),b.parent=g,b instanceof PY&&0===uR(b.parse).length&&b.remove()}}catch(k){y.e(k)}finally{y.f()}}}return this.setContinue(),this.flags}}]),n}(DY),JY=function(e){c(n,e);var t=l(n);function n(){return v(this,n),t.apply(this,arguments)}return g(n,[{key:"run",value:function(e){var t,n=e.parent,r=n.children.filter((function(e){return e instanceof MY})),i={},a=p(r);try{for(a.s();!(t=a.n()).done;){var o=t.value,s=JN(o.groupBy);s in i||(i[s]=[]),i[s].push(o)}}catch(v){a.e(v)}finally{a.f()}var u,c=p(uR(i));try{for(c.s();!(u=c.n()).done;){var l=i[u.value];if(l.length>1){var f,d=l.pop(),h=p(l);try{for(h.s();!(f=h.n()).done;){var m=f.value;d.merge(m)&&(n.removeChild(m),m.parent=d,m.remove(),this.setMutated())}}catch(v){h.e(v)}finally{h.f()}}}}catch(v){c.e(v)}finally{c.f()}return this.setContinue(),this.flags}}]),n}(DY),ZY=function(e){c(n,e);var t=l(n);function n(e){var r;return v(this,n),(r=t.call(this)).model=e,r}return g(n,[{key:"run",value:function(e){var t,n=e.parent,r=!(AY(n)||n instanceof oK||n instanceof PY||n instanceof BY),i=[],a=[],o=p(n.children);try{for(o.s();!(t=o.n()).done;){var s=t.value;s instanceof _Y&&(r&&!oR(n.producedFields(),s.dependentFields())?i.push(s):a.push(s))}}catch(g){o.e(g)}finally{o.f()}if(i.length>0){var u,c=i.pop(),l=p(i);try{for(l.s();!(u=l.n()).done;){var f=u.value;c.merge(f,this.model.renameSignal.bind(this.model))}}catch(g){l.e(g)}finally{l.f()}this.setMutated(),n instanceof _Y?n.merge(c,this.model.renameSignal.bind(this.model)):c.swapWithParent()}if(a.length>1){var d,h=a.pop(),m=p(a);try{for(m.s();!(d=m.n()).done;){var v=d.value;h.merge(v,this.model.renameSignal.bind(this.model))}}catch(g){m.e(g)}finally{m.f()}this.setMutated()}return this.setContinue(),this.flags}}]),n}(DY),QY=function(e){c(n,e);var t=l(n);function n(){return v(this,n),t.apply(this,arguments)}return g(n,[{key:"run",value:function(e){var t=e.parent,n=h(t.children);if(!eR(n,(function(e){return e instanceof jq}))||t.numChildren()<=1)return this.setContinue(),this.flags;var r,i,a=[],o=p(n);try{for(o.s();!(i=o.n()).done;){var s=i.value;if(s instanceof jq){for(var u=s;1===u.numChildren();){var c=u.children[0];if(!(c instanceof jq))break;u=c}a.push.apply(a,h(u.children)),r?(t.removeChild(s),s.parent=r.parent,r.parent.removeChild(r),r.parent=u,this.setMutated()):r=u}else a.push(s)}}catch(m){o.e(m)}finally{o.f()}if(a.length){this.setMutated();var l,f=p(a);try{for(f.s();!(l=f.n()).done;){var d=l.value;d.parent.removeChild(d),d.parent=r}}catch(m){f.e(m)}finally{f.f()}}return this.setContinue(),this.flags}}]),n}(DY),e$="scale_",t$=5;function n$(e){var t=[];function n(e){if(0===e.numChildren())t.push(e);else{var r,i=p(e.children);try{for(i.s();!(r=i.n()).done;)n(r.value)}catch(a){i.e(a)}finally{i.f()}}}var r,i=p(e);try{for(i.s();!(r=i.n()).done;)n(r.value)}catch(a){i.e(a)}finally{i.f()}return t}function r$(e){return e}function i$(e,t){return t.map((function(t){if(e instanceof DY){var n=e.optimizeNextFromLeaves(t);return e.reset(),n}return e.run(t)})).some(r$)}function a$(e,t){var n=e.sources,r=new Set;return r.add(i$(new KY,n)),r.add(i$(new YY(t),n)),n=n.filter((function(e){return e.numChildren()>0})),r.add(i$(new GY,n$(n))),n=n.filter((function(e){return e.numChildren()>0})),r.add(i$(new WY,n$(n))),r.add(i$(new ZY(t),n$(n))),r.add(i$(new qY,n$(n))),r.add(i$(new $Y,n$(n))),r.add(i$(new JY,n$(n))),r.add(i$(new HY,n$(n))),r.add(i$(new VY,n)),r.add(i$(new QY,n$(n))),e.sources=n,r.has(!0)}var o$=function(){function e(t){v(this,e),Object.defineProperty(this,"signal",{enumerable:!0,get:t})}return g(e,null,[{key:"fromName",value:function(t,n){return new e((function(){return t(n)}))}}]),e}();function s$(e){I$(e)?function(e){var t,n=e.component.scales,r=p(uR(n));try{for(r.s();!(t=r.n()).done;){var i=t.value,a=u$(e,i);if(n[i].setWithExplicit("domains",a),d$(e,i),e.component.data.isFaceted){for(var o=e;!N$(o)&&o.parent;)o=o.parent;if("shared"===o.component.resolve.scale[i]){var s,u=p(a.value);try{for(u.s();!(s=u.n()).done;){var c=s.value;Sz(c)&&(c.data=e$+c.data.replace(e$,""))}}catch(l){u.e(l)}finally{u.f()}}}}}catch(l){r.e(l)}finally{r.f()}}(e):function(e){var t,n=p(e.children);try{for(n.s();!(t=n.n()).done;)s$(t.value)}catch(h){n.e(h)}finally{n.f()}var r,i=e.component.scales,a=p(uR(i));try{for(a.s();!(r=a.n()).done;){var o,s=r.value,u=void 0,c=null,l=p(e.children);try{for(l.s();!(o=l.n()).done;){var f=o.value.component.scales[s];if(f){u=void 0===u?f.getWithExplicit("domains"):AG(u,f.getWithExplicit("domains"),"domains","scale",p$);var d=f.get("selectionExtent");c&&d&&c.selection!==d.selection&&oz("The same selection must be used to override scale domains in a layered view."),c=d}}}catch(h){l.e(h)}finally{l.f()}i[s].setWithExplicit("domains",u),c&&i[s].set("selectionExtent",c,!0)}}catch(h){a.e(h)}finally{a.f()}}(e)}function u$(e,t){var n=e.getScaleComponent(t).get("type"),r=e.encoding,i=function(e,t,n,r){if("unaggregated"===e){var i=h$(t,n),a=i.valid,o=i.reason;if(!a)return void oz(o)}else if(void 0===e&&r.useUnaggregatedDomain&&h$(t,n).valid)return"unaggregated";return e}(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);return i!==e.scaleDomain(t)&&(e.specifiedScales[t]=Object.assign(Object.assign({},e.specifiedScales[t]),{domain:i})),"x"===t&&kW(r.x2)?kW(r.x)?AG(l$(n,i,e,"x"),l$(n,i,e,"x2"),"domain","scale",p$):l$(n,i,e,"x2"):"y"===t&&kW(r.y2)?kW(r.y)?AG(l$(n,i,e,"y"),l$(n,i,e,"y2"),"domain","scale",p$):l$(n,i,e,"y2"):l$(n,i,e,t)}function c$(e,t,n){var r,i=null===(r=_z(n))||void 0===r?void 0:r.unit;return"temporal"===t||i?function(e,t,n){return e.map((function(e){return{signal:"{data: ".concat(TW(e,{timeUnit:n,type:t}),"}")}}))}(e,t,i):[e]}function l$(e,t,n,r){var i=kW(n.encoding[r]),a=i.type,o=i.timeUnit;if(function(e){return e&&e.unionWith}(t)){var s=l$(e,void 0,n,r),u=c$(t.unionWith,a,o);return kG([].concat(h(s.value),h(u)))}if(kz(t))return kG([t]);if(t&&"unaggregated"!==t&&!lU(t))return kG(c$(t,a,o));var c=n.stack;if(c&&r===c.fieldChannel){if("normalize"===c.offset)return EG([[0,1]]);var l=n.requestDataName(RG);return EG([{data:l,field:n.vgField(r,{suffix:"start"})},{data:l,field:n.vgField(r,{suffix:"end"})}])}var f=AB(r)&&eW(i)?function(e,t,n){if(oU(n)){var r=e.fieldDef(t),i=r.sort;if(VU(i))return{op:"min",field:CK(r,t),order:"ascending"};var a=e.stack,o=a?[].concat(h(a.groupbyField?[a.groupbyField]:[]),h(a.stackBy.map((function(e){return e.fieldDef.field})))):void 0;if(WU(i))return f$(i,a&&!QN(o,i.field));if(UU(i)){var s=i.encoding,u=i.order,c=e.fieldDef(s),l=c.aggregate,f=c.field,d=a&&!QN(o,f);if(uP(l)||cP(l))return f$({field:dW(c),order:u},d);if(lP(l)||!l)return f$({op:l,field:f,order:u},d)}else{if("descending"===i)return{op:"min",field:e.vgField(t),order:"descending"};if(QN(["ascending",void 0],i))return!0}}}(n,r,e):void 0;if(nW(i))return EG(c$([i.datum],a,o));var d=i;if("unaggregated"===t){var p=n.requestDataName(RG),m=i.field;return EG([{data:p,field:dW({field:m,aggregate:"min"})},{data:p,field:dW({field:m,aggregate:"max"})}])}if(FB(d.bin)){if(oU(e))return EG("bin-ordinal"===e?[]:[{data:fR(f)?n.requestDataName(RG):n.requestDataName(PG),field:n.vgField(r,MW(d,r)?{binSuffix:"range"}:{}),sort:!0!==f&&_N(f)?f:{field:n.vgField(r,{}),op:"min"}}]);var v=d.bin;if(FB(v)){var g=xY(n,d.field,v);return EG([new o$((function(){var e=n.getSignalName(g);return"[".concat(e,".start, ").concat(e,".stop]")}))])}return EG([{data:n.requestDataName(RG),field:n.vgField(r,{})}])}if(d.timeUnit&&QN(["time","utc"],e)&&$U(r,d,I$(n)?n.encoding[hB(r)]:void 0,n.stack,n.markDef,n.config)){var y=n.requestDataName(RG);return EG([{data:y,field:n.vgField(r)},{data:y,field:n.vgField(r,{suffix:"end"})}])}return EG(f?[{data:fR(f)?n.requestDataName(RG):n.requestDataName(PG),field:n.vgField(r),sort:f}]:[{data:n.requestDataName(RG),field:n.vgField(r)}])}function f$(e,t){var n=e.op,r=e.field,i=e.order;return Object.assign(Object.assign({op:null!==n&&void 0!==n?n:t?"sum":BU},r?{field:yR(r)}:{}),i?{order:i}:{})}function d$(e,t){var n,r=e.component.scales[t],i=e.specifiedScales[t].domain,a=null===(n=e.fieldDef(t))||void 0===n?void 0:n.bin,o=lU(i)&&i,s=NB(a)&&RB(a.extent)&&a.extent;(o||s)&&r.set("selectionExtent",null!==o&&void 0!==o?o:s,!0)}function h$(e,t){var n=e.aggregate,r=e.type;return n?FN(n)&&!pP[n]?{valid:!1,reason:P.unaggregateDomainWithNonSharedDomainOp(n)}:"quantitative"===r&&"log"===t?{valid:!1,reason:P.unaggregatedDomainWithLogScale(e)}:{valid:!0}:{valid:!1,reason:P.unaggregateDomainHasNoEffectForRawField(e)}}function p$(e,t,n,r){return e.explicit&&t.explicit&&oz(P.mergeConflictingDomainProperty(n,r,e.value,t.value)),{explicit:e.explicit,value:[].concat(h(e.value),h(t.value))}}function m$(e){if(Sz(e)&&FN(e.field))return e.field;if(function(e){return!wN(e)&&"fields"in e&&!("data"in e)}(e)){var t,n,r=p(e.fields);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(Sz(i)&&FN(i.field))if(t){if(t!==i.field)return oz(P.FACETED_INDEPENDENT_DIFFERENT_SOURCES),t}else t=i.field}}catch(o){r.e(o)}finally{r.f()}return oz(P.FACETED_INDEPENDENT_SAME_FIELDS_DIFFERENT_SOURCES),t}if(function(e){return!wN(e)&&"fields"in e&&"data"in e}(e)){oz(P.FACETED_INDEPENDENT_SAME_SOURCE);var a=e.fields[0];return FN(a)?a:void 0}}function v$(e,t){return function(e){var t=rR(e.map((function(e){return Sz(e)?(e.sort,RN(e,["sort"])):e})),JN),n=rR(e.map((function(e){if(Sz(e)){var t=e.sort;return void 0===t||fR(t)||("op"in t&&"count"===t.op&&delete t.field,"ascending"===t.order&&delete t.order),t}})).filter((function(e){return void 0!==e})),JN);if(0!==t.length){if(1===t.length){var r=e[0];if(Sz(r)&&n.length>0){var i=n[0];if(n.length>1)oz(P.MORE_THAN_ONE_SORT),i=!0;else if(_N(i)&&"field"in i){var a=i.field;r.field===a&&(i=!i.order||{order:i.order})}return Object.assign(Object.assign({},r),{sort:i})}return r}var o,s=rR(n.map((function(e){return fR(e)||!("op"in e)||e.op in sP?e:(oz(P.domainSortDropped(e)),!0)})),JN);1===s.length?o=s[0]:s.length>1&&(oz(P.MORE_THAN_ONE_SORT),o=!0);var u=rR(e.map((function(e){return Sz(e)?e.data:null})),(function(e){return e}));return 1===u.length&&null!==u[0]?Object.assign({data:u[0],fields:t.map((function(e){return e.field}))},o?{sort:o}:{}):Object.assign({fields:t},o?{sort:o}:{})}}(e.component.scales[t].get("domains").map((function(t){return Sz(t)&&(t.data=e.lookupDataSource(t.data)),t})))}function g$(e){return uR(e.component.scales).reduce((function(t,n){var r=e.component.scales[n];if(r.merged)return t;var i,a=r.combine(),o=a.name,s=a.type,u=a.selectionExtent,c=(a.domains,a.range,a.reverse),l=RN(a,["name","type","selectionExtent","domains","range","reverse"]),f=function(e,t,n){return bB(n)&&Ez(e)?{step:{signal:t+"_step"}}:e}(a.range,o,n);u&&(i=function(e,t){var n=t.selection;return{signal:uK(e.getSelectionComponent(n,dR(n)),t)}}(e,u));var d=v$(e,n);return t.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:o,type:s},d?{domain:d}:{}),i?{domainRaw:i}:{}),{range:f}),void 0!==c?{reverse:c}:{}),l)),t}),[])}var y$=function(e){c(n,e);var t=l(n);function n(e,r){var i;return v(this,n),(i=t.call(this,{},{name:e})).merged=!1,i.setWithExplicit("type",r),i}return g(n,[{key:"domainDefinitelyIncludesZero",value:function(){return!1!==this.get("zero")||eR(this.get("domains"),(function(e){return wN(e)&&2===e.length&&e[0]<=0&&e[1]>=0}))}}]),n}(_G),b$=["range","scheme"];function x$(e){return"x"===e?"width":"y"===e?"height":void 0}function w$(e,t){var n=e.fieldDef(t);if(n&&n.bin&&FB(n.bin)){var r=xY(e,n.field,n.bin),i=x$(t),a=e.getName(i);return new o$((function(){var t=e.getSignalName(r),n="(".concat(t,".stop - ").concat(t,".start) / ").concat(t,".step");return"".concat(e.getSignalName(a)," / (").concat(n,")")}))}}function _$(e,t){var n,r=t.specifiedScales[e],i=t.size,a=t.getScaleComponent(e).get("type"),o=p(b$);try{for(o.s();!(n=o.n()).done;){var s=n.value;if(void 0!==r[s]){var u=pU(a,s),c=mU(e,s);if(u)if(c)oz(c);else switch(s){case"range":return wN(r.range)&&bB(e)?kG(r.range.map((function(e){if("width"===e||"height"===e){var n=t.getName(e),r=t.getSignalName.bind(t);return o$.fromName(r,n)}return e}))):kG(r.range);case"scheme":return kG(k$(r[s]))}else oz(P.scalePropertyNotWorkWithScaleType(a,s,e))}}}catch(d){o.e(d)}finally{o.f()}if(e===yP||e===bP){var l=e===yP?"width":"height",f=i[l];if(IV(f)){if(oU(a))return kG({step:f.step});oz(P.stepDropped(l))}}return EG(function(e,t){var n=t.size,r=t.config,i=t.mark,a=t.encoding,o=t.getSignalName.bind(t),s=kW(a[e]).type,u=t.getScaleComponent(e).get("type"),c=t.specifiedScales[e],l=c.domain,f=c.domainMid;switch(e){case yP:case bP:if(QN(["point","band"],u))if(e!==yP||n.width){if(e===bP&&!n.height){var d=LV(r.view,"height");if(IV(d))return d}}else{var h=LV(r.view,"width");if(IV(h))return h}var p=x$(e),m=t.getName(p);return e===bP&&sU(u)?[o$.fromName(o,m),0]:[0,o$.fromName(o,m)];case IP:var v=function e(t,n,r){if(n)return kz(n)?{signal:"".concat(n.signal," ? 0 : ").concat(e(t,!1,r))}:0;switch(t){case"bar":case"tick":return r.scale.minBandSize;case"line":case"trail":case"rule":return r.scale.minStrokeWidth;case"text":return r.scale.minFontSize;case"point":case"square":case"circle":return r.scale.minSize}throw new Error(P.incompatibleChannel("size",t))}(i,t.component.scales[e].get("zero"),r),g=function(e,t,n,r){var i={x:w$(n,"x"),y:w$(n,"y")};switch(e){case"bar":case"tick":if(void 0!==r.scale.maxBandSize)return r.scale.maxBandSize;var a=S$(t,i,r.view);return MN(a)?a-1:new o$((function(){return"".concat(a.signal," - 1")}));case"line":case"trail":case"rule":return r.scale.maxStrokeWidth;case"text":return r.scale.maxFontSize;case"point":case"square":case"circle":if(r.scale.maxSize)return r.scale.maxSize;var o=S$(t,i,r.view);return MN(o)?Math.pow(E$*o,2):new o$((function(){return"pow(".concat(E$," * ").concat(o.signal,", 2)")}))}throw new Error(P.incompatibleChannel("size",e))}(i,n,t,r);return cU(u)?function(e,t,n){var r=function(){var r=PW(t),i=PW(e),a="(".concat(r," - ").concat(i,") / (").concat(n," - 1)");return"sequence(".concat(i,", ").concat(r," + ").concat(a,", ").concat(a,")")};return kz(t)?new o$(r):{signal:r()}}(v,g,function(e,t,n,r){switch(e){case"quantile":return t.scale.quantileCount;case"quantize":return t.scale.quantizeCount;case"threshold":return void 0!==n&&wN(n)?n.length+1:(oz(P.domainRequiredForThresholdScale(r)),3)}}(u,r,l,e)):[v,g];case EP:return[0,2*Math.PI];case NP:return[0,360];case _P:return[0,new o$((function(){var e=t.getSignalName("width"),n=t.getSignalName("height");return"min(".concat(e,",").concat(n,")/2")}))];case LP:return[r.scale.minStrokeWidth,r.scale.maxStrokeWidth];case zP:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case FP:return"symbol";case TP:case jP:case MP:return"ordinal"===u?"nominal"===s?"category":"ordinal":void 0!==f?"diverging":"rect"===i||"geoshape"===i?"heatmap":"ramp";case RP:case PP:case BP:return[r.scale.minOpacity,r.scale.maxOpacity]}throw new Error("Scale range undefined for channel ".concat(e))}(e,t))}function k$(e){return function(e){return!FN(e)&&!!e.name}(e)?Object.assign({scheme:e.name},YN(e,["name"])):{scheme:e}}var E$=.95;function S$(e,t,n){var r=IV(e.width)?e.width.step:BV(n,"width"),i=IV(e.height)?e.height.step:BV(n,"height");return t.x||t.y?new o$((function(){return"min(".concat([t.x?t.x.signal:r,t.y?t.y.signal:i].join(", "),")")})):Math.min(r,i)}function C$(e,t){I$(e)?function(e,t){var n,r=e.component.scales,i=e.config,a=e.encoding,o=e.markDef,s=e.specifiedScales,u=p(uR(r));try{for(u.s();!(n=u.n()).done;){var c=n.value,l=s[c],f=r[c],d=e.getScaleComponent(c),h=kW(a[c]),m=l[t],v=d.get("type"),g=d.get("padding"),y=d.get("paddingInner"),b=pU(v,t),x=mU(c,t);if(void 0!==m&&(b?x&&oz(x):oz(P.scalePropertyNotWorkWithScaleType(v,t,c))),b&&void 0===x)if(void 0!==m)f.copyKeyFromObject(t,l);else{var w=t in A$?A$[t]({model:e,channel:c,fieldOrDatumDef:h,scaleType:v,scalePadding:g,scalePaddingInner:y,domain:l.domain,markDef:o,config:i}):i.scale[t];void 0!==w&&f.set(t,w,!1)}}}catch(_){u.e(_)}finally{u.f()}}(e,t):D$(e,t)}var A$={bins:function(e){var t=e.model,n=e.fieldOrDatumDef;return eW(n)?function(e,t){var n=t.bin;if(FB(n)){var r=xY(e,t.field,n);return new o$((function(){return e.getSignalName(r)}))}if(IB(n)&&NB(n)&&void 0!==n.step)return{step:n.step}}(t,n):void 0},interpolate:function(e){return function(e,t){if(QN([TP,jP,MP],e)&&"nominal"!==t)return"hcl"}(e.channel,e.fieldOrDatumDef.type)},nice:function(e){return function(e,t,n){var r;if(!(null===(r=_W(n))||void 0===r?void 0:r.bin)&&!QN([Kz.TIME,Kz.UTC],e))return t in gB||void 0}(e.scaleType,e.channel,e.fieldOrDatumDef)},padding:function(e){var t=e.channel,n=e.scaleType,r=e.fieldOrDatumDef,i=e.markDef,a=e.config;return function(e,t,n,r,i,a){if(e in gB){if(uU(t)){if(void 0!==n.continuousPadding)return n.continuousPadding;var o=i.type,s=i.orient;if("bar"===o&&(!eW(r)||!r.bin&&!r.timeUnit)&&("vertical"===s&&"x"===e||"horizontal"===s&&"y"===e))return a.continuousBandSize}if(t===Kz.POINT)return n.pointPadding}}(t,n,a.scale,r,i,a.bar)},paddingInner:function(e){var t=e.scalePadding,n=e.channel,r=e.markDef,i=e.config;return function(e,t,n,r){if(void 0===e&&t in gB){var i=r.bandPaddingInner,a=r.barBandPaddingInner,o=r.rectBandPaddingInner;return _R(i,"bar"===n?a:o)}}(t,n,r.type,i.scale)},paddingOuter:function(e){var t=e.scalePadding,n=e.channel,r=e.scaleType,i=e.markDef,a=e.scalePaddingInner,o=e.config;return function(e,t,n,r,i,a){if(void 0===e&&t in gB&&n===Kz.BAND)return _R(a.bandPaddingOuter,kz(i)?{signal:"".concat(i.signal,"/2")}:i/2)}(t,n,r,i.type,a,o.scale)},reverse:function(e){var t=e.fieldOrDatumDef,n=e.scaleType,r=e.channel,i=e.config;return function(e,t,n,r){return"x"===n&&void 0!==r.xReverse?sU(e)&&"descending"===t?kz(r.xReverse)?{signal:"!".concat(r.xReverse.signal)}:!r.xReverse:r.xReverse:!(!sU(e)||"descending"!==t)||void 0}(n,eW(t)?t.sort:void 0,r,i.scale)},zero:function(e){return function(e,t,n,r,i){if(n&&"unaggregated"!==n&&sU(i)){if(wN(n)){var a=n[0],o=n[n.length-1];if(a<=0&&o>=0)return!0}return!1}if("size"===e&&"quantitative"===t.type&&!cU(i))return!0;if((!eW(t)||!t.bin)&&QN([].concat(h(yB),h(wB)),e)){var s=r.orient;return!QN(["bar","area","line","trail"],r.type)||!("horizontal"===s&&"y"===e||"vertical"===s&&"x"===e)}return!1}(e.channel,e.fieldOrDatumDef,e.domain,e.markDef,e.scaleType)}};function O$(e){I$(e)?function(e){var t,n=e.component.scales,r=p(CB);try{for(r.s();!(t=r.n()).done;){var i=t.value,a=n[i];if(a){var o=_$(i,e);a.setWithExplicit("range",o)}}}catch(s){r.e(s)}finally{r.f()}}(e):D$(e,"range")}function D$(e,t){var n,r=e.component.scales,i=p(e.children);try{for(i.s();!(n=i.n()).done;){var a=n.value;"range"===t?O$(a):C$(a,t)}}catch(h){i.e(h)}finally{i.f()}var o,s=p(uR(r));try{for(s.s();!(o=s.n()).done;){var u,c=o.value,l=void 0,f=p(e.children);try{for(f.s();!(u=f.n()).done;){var d=u.value.component.scales[c];d&&(l=AG(l,d.getWithExplicit(t),t,"scale",SG((function(e,n){return"range"===t&&e.step&&n.step?e.step-n.step:0}))))}}catch(h){f.e(h)}finally{f.f()}r[c].setWithExplicit(t,l)}}catch(h){s.e(h)}finally{s.f()}}function T$(e,t,n,r){var i=function(e,t,n){var r;switch(t.type){case"nominal":case"ordinal":if(eB(e)||"discrete"===jB(e))return"shape"===e&&"ordinal"===t.type&&oz(P.discreteChannelCannotEncode(e,"ordinal")),"ordinal";if(e in gB){if(QN(["rect","bar","image","rule"],n))return"band"}else if("arc"===n&&e in xB)return"band";return void 0!==t.band||cW(t)&&(null===(r=t.axis)||void 0===r?void 0:r.tickBand)?"band":"point";case"temporal":return eB(e)?"time":"discrete"===jB(e)?(oz(P.discreteChannelCannotEncode(e,"temporal")),"ordinal"):eW(t)&&t.timeUnit&&_z(t.timeUnit).utc?"utc":"time";case"quantitative":return eB(e)?eW(t)&&FB(t.bin)?"bin-ordinal":"linear":"discrete"===jB(e)?(oz(P.discreteChannelCannotEncode(e,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(P.invalidFieldType(t.type))}(t,n,r),a=e.type;return AB(t)?void 0!==a?gU(t,a)?eW(n)&&!vU(a,n.type)?(oz(P.scaleTypeNotWorkWithFieldDef(a,i)),i):a:(oz(P.scaleTypeNotWorkWithChannel(t,a,i)),i):i:null}function j$(e){I$(e)?e.component.scales=function(e){var t=e.encoding,n=e.mark;return CB.reduce((function(r,i){var a=kW(t[i]);if(a&&n===KR&&i===FP&&a.type===Hz)return r;var o=a&&a.scale;if(a&&null!==o&&!1!==o){var s=T$(o=null!==o&&void 0!==o?o:{},i,a,n);r[i]=new y$(e.scaleName(i+"",!0),{value:s,explicit:o.type===s})}return r}),{})}(e):e.component.scales=function(e){var t,n,r=e.component.scales={},i={},a=e.component.resolve,o=p(e.children);try{for(o.s();!(n=o.n()).done;){var s=n.value;j$(s);var u,c=p(uR(s.component.scales));try{for(c.s();!(u=c.n()).done;){var l=u.value;if(a.scale[l]=null!==(t=a.scale[l])&&void 0!==t?t:XK(l,e),"shared"===a.scale[l]){var f=i[l],d=s.component.scales[l].getWithExplicit("type");f?Jz(f.value,d.value)?i[l]=AG(f,d,"type","scale",M$):(a.scale[l]="independent",delete i[l]):i[l]=d}}}catch(k){c.e(k)}finally{c.f()}}}catch(k){o.e(k)}finally{o.f()}var h,m=p(uR(i));try{for(m.s();!(h=m.n()).done;){var v=h.value,g=e.scaleName(v,!0),y=i[v];r[v]=new y$(g,y);var b,x=p(e.children);try{for(x.s();!(b=x.n()).done;){var w=b.value,_=w.component.scales[v];_&&(w.renameScale(_.get("name"),g),_.merged=!0)}}catch(k){x.e(k)}finally{x.f()}}}catch(k){m.e(k)}finally{m.f()}return r}(e)}var M$=SG((function(e,t){return Qz(e)-Qz(t)})),F$=function(){function e(){v(this,e),this.nameMap={}}return g(e,[{key:"rename",value:function(e,t){this.nameMap[e]=t}},{key:"has",value:function(e){return void 0!==this.nameMap[e]}},{key:"get",value:function(e){for(;this.nameMap[e]&&e!==this.nameMap[e];)e=this.nameMap[e];return e}}]),e}();function I$(e){return"unit"===(null===e||void 0===e?void 0:e.type)}function N$(e){return"facet"===(null===e||void 0===e?void 0:e.type)}function R$(e){return"concat"===(null===e||void 0===e?void 0:e.type)}function P$(e){return"layer"===(null===e||void 0===e?void 0:e.type)}var B$=function(){function e(t,n,r,i,a,o,s){var u,c,l=this;v(this,e),this.type=n,this.parent=r,this.config=a,this.view=s,this.children=[],this.correctDataNames=function(e){return e.from&&e.from.data&&(e.from.data=l.lookupDataSource(e.from.data)),e.from&&e.from.facet&&e.from.facet.data&&(e.from.facet.data=l.lookupDataSource(e.from.facet.data)),e},this.parent=r,this.config=a,this.name=null!==(u=t.name)&&void 0!==u?u:i,this.title=IW(t.title)?{text:t.title}:t.title,this.scaleNameMap=r?r.scaleNameMap:new F$,this.projectionNameMap=r?r.projectionNameMap:new F$,this.signalNameMap=r?r.signalNameMap:new F$,this.data=t.data,this.description=t.description,this.transforms=nq(null!==(c=t.transform)&&void 0!==c?c:[]),this.layout="layer"===n||"unit"===n?{}:function(e,t,n){var r,i,a=n[t],o={},s=a.spacing,u=a.columns;void 0!==s&&(o.spacing=s),void 0!==u&&(HU(e)&&!GU(e.facet)||jV(e))&&(o.columns=u),MV(e)&&(o.columns=1);var c,l=p(RV);try{for(l.s();!(c=l.n()).done;){var f=c.value;if(void 0!==e[f])if("spacing"===f){var d=e[f];o[f]=MN(d)?d:{row:null!==(r=d.row)&&void 0!==r?r:s,column:null!==(i=d.column)&&void 0!==i?i:s}}else o[f]=e[f]}}catch(h){l.e(h)}finally{l.f()}return o}(t,n,a),this.component={data:{sources:r?r.component.data.sources:[],outputNodes:r?r.component.data.outputNodes:{},outputNodeRefCounts:r?r.component.data.outputNodeRefCounts:{},isFaceted:HU(t)||r&&r.component.data.isFaceted&&void 0===t.data},layoutSize:new _G,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},o?XN(o):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}return g(e,[{key:"width",get:function(){return this.getSizeSignalRef("width")}},{key:"height",get:function(){return this.getSizeSignalRef("height")}},{key:"parse",value:function(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}},{key:"parseScale",value:function(){!function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).ignoreRange;j$(e),s$(e);var n,r=p(hU);try{for(r.s();!(n=r.n()).done;)C$(e,n.value)}catch(i){r.e(i)}finally{r.f()}t||O$(e)}(this)}},{key:"parseProjection",value:function(){yY(this)}},{key:"renameTopLevelLayoutSizeSignal",value:function(){"width"!==this.getName("width")&&this.renameSignal(this.getName("width"),"width"),"height"!==this.getName("height")&&this.renameSignal(this.getName("height"),"height")}},{key:"parseLegends",value:function(){sY(this)}},{key:"assembleGroupStyle",value:function(){var e,t;if("unit"===this.type||"layer"===this.type)return null!==(t=null===(e=this.view)||void 0===e?void 0:e.style)&&void 0!==t?t:"cell"}},{key:"assembleEncodeFromView",value:function(e){e.style;var t,n=RN(e,["style"]),r={},i=p(uR(n));try{for(i.s();!(t=i.n()).done;){var a=t.value,o=n[a];void 0!==o&&(r[a]=NW(o))}}catch(s){i.e(s)}finally{i.f()}return r}},{key:"assembleGroupEncodeEntry",value:function(e){var t={};return this.view&&(t=this.assembleEncodeFromView(this.view)),e||(this.description&&(t.description=NW(this.description)),"unit"!==this.type&&"layer"!==this.type)?sR(t)?void 0:t:Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},null!==t&&void 0!==t?t:{})}},{key:"assembleLayout",value:function(){if(this.layout){var e=this.layout,t=e.spacing,n=RN(e,["spacing"]),r=this.component,i=this.config,a=function(e,t){var n,r={},i=p(nB);try{for(i.s();!(n=i.n()).done;){var a=n.value,o=e[a];if(null===o||void 0===o?void 0:o.facetFieldDef){var s=DK(["titleAnchor","titleOrient"],o.facetFieldDef,t,a),u=s.titleAnchor,c=AK(a,s.titleOrient),l=LK(u,c);void 0!==l&&(r[c]=l)}}}catch(f){i.e(f)}finally{i.f()}return sR(r)?void 0:r}(r.layoutHeaders,i);return Object.assign(Object.assign(Object.assign({padding:t},this.assembleDefaultLayout()),n),a?{titleBand:a}:{})}}},{key:"assembleDefaultLayout",value:function(){return{}}},{key:"assembleHeaderMarks",value:function(){var e,t=this.component.layoutHeaders,n=[],r=p(nB);try{for(r.s();!(e=r.n()).done;){var i=e.value;t[i].title&&n.push(MK(this,i))}}catch(u){r.e(u)}finally{r.f()}for(var a=0,o=TK;a<o.length;a++){var s=o[a];n=n.concat(NK(this,s))}return n}},{key:"assembleAxes",value:function(){return function(e,t){var n=e.x,r=void 0===n?[]:n,i=e.y,a=void 0===i?[]:i;return[].concat(h(r.map((function(e){return fK(e,"grid",t)}))),h(a.map((function(e){return fK(e,"grid",t)}))),h(r.map((function(e){return fK(e,"main",t)}))),h(a.map((function(e){return fK(e,"main",t)})))).filter((function(e){return e}))}(this.component.axes,this.config)}},{key:"assembleLegends",value:function(){return hY(this)}},{key:"assembleProjections",value:function(){return pY(this)}},{key:"assembleTitle",value:function(){var e,t,n,r=null!==(e=this.title)&&void 0!==e?e:{},i=r.encoding,a=RN(r,["encoding"]),o=Object.assign(Object.assign(Object.assign({},FW(this.config.title).nonMark),a),i?{encode:{update:i}}:{});if(o.text)return QN(["unit","layer"],this.type)?QN(["middle",void 0],o.anchor)&&(o.frame=null!==(t=o.frame)&&void 0!==t?t:"group"):o.anchor=null!==(n=o.anchor)&&void 0!==n?n:"start",sR(o)?void 0:o}},{key:"assembleGroup",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t={};(e=e.concat(this.assembleSignals())).length>0&&(t.signals=e);var n=this.assembleLayout();n&&(t.layout=n),t.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());var r=!this.parent||N$(this.parent)?function e(t){return P$(t)||R$(t)?t.children.reduce((function(t,n){return t.concat(e(n))}),g$(t)):g$(t)}(this):[];r.length>0&&(t.scales=r);var i=this.assembleAxes();i.length>0&&(t.axes=i);var a=this.assembleLegends();return a.length>0&&(t.legends=a),t}},{key:"getName",value:function(e){return dR((this.name?this.name+"_":"")+e)}},{key:"requestDataName",value:function(e){var t,n=this.getName(e),r=this.component.data.outputNodeRefCounts;return r[n]=(null!==(t=r[n])&&void 0!==t?t:0)+1,n}},{key:"getSizeSignalRef",value:function(e){if(N$(this.parent)){var t=_B(qK(e)),n=this.component.scales[t];if(n&&!n.merged){var r=n.get("type"),i=n.get("range");if(oU(r)&&Ez(i)){var a=n.get("name"),o=m$(v$(this,t));return o?{signal:GK(a,n,dW({aggregate:"distinct",field:o},{expr:"datum"}))}:(oz("Unknown field for ".concat(t,". Cannot calculate view size.")),null)}}}return{signal:this.signalNameMap.get(this.getName(e))}}},{key:"lookupDataSource",value:function(e){var t=this.component.data.outputNodes[e];return t?t.getSource():e}},{key:"getSignalName",value:function(e){return this.signalNameMap.get(e)}},{key:"renameSignal",value:function(e,t){this.signalNameMap.rename(e,t)}},{key:"renameScale",value:function(e,t){this.scaleNameMap.rename(e,t)}},{key:"renameProjection",value:function(e,t){this.projectionNameMap.rename(e,t)}},{key:"scaleName",value:function(e,t){return t?this.getName(e):uB(e)&&AB(e)&&this.component.scales[e]||this.scaleNameMap.has(this.getName(e))?this.scaleNameMap.get(this.getName(e)):void 0}},{key:"projectionName",value:function(e){return e?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0}},{key:"getScaleComponent",value:function(e){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");var t=this.component.scales[e];return t&&!t.merged?t:this.parent?this.parent.getScaleComponent(e):void 0}},{key:"getSelectionComponent",value:function(e,t){var n=this.component.selection[e];if(!n&&this.parent&&(n=this.parent.getSelectionComponent(e,t)),!n)throw new Error(P.selectionNotFound(t));return n}},{key:"hasAxisOrientSignalRef",value:function(){var e,t;return(null===(e=this.component.axes.x)||void 0===e?void 0:e.some((function(e){return e.hasOrientSignalRef()})))||(null===(t=this.component.axes.y)||void 0===t?void 0:t.some((function(e){return e.hasOrientSignalRef()})))}}]),e}(),L$=function(e){c(n,e);var t=l(n);function n(){return v(this,n),t.apply(this,arguments)}return g(n,[{key:"vgField",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.fieldDef(e);if(n)return dW(n,t)}},{key:"reduceFieldDef",value:function(e,t){return ZW(this.getMapping(),(function(t,n,r){var i=_W(n);return i?e(t,i,r):t}),t)}},{key:"forEachFieldDef",value:function(e,t){JW(this.getMapping(),(function(t,n){var r=_W(t);r&&e(r,n)}),t)}}]),n}(B$),z$=function(e){c(n,e);var t=l(n);function n(e,r){var i,a,o,s;v(this,n),(i=t.call(this,e)).transform=r,i.transform=XN(r);var u=null!==(a=i.transform.as)&&void 0!==a?a:[void 0,void 0];return i.transform.as=[null!==(o=u[0])&&void 0!==o?o:"value",null!==(s=u[1])&&void 0!==s?s:"density"],i}return g(n,[{key:"clone",value:function(){return new n(null,XN(this.transform))}},{key:"dependentFields",value:function(){var e;return new Set([this.transform.density].concat(h(null!==(e=this.transform.groupby)&&void 0!==e?e:[])))}},{key:"producedFields",value:function(){return new Set(this.transform.as)}},{key:"hash",value:function(){return"DensityTransform ".concat(JN(this.transform))}},{key:"assemble",value:function(){var e=this.transform,t=e.density,n=RN(e,["density"]);return Object.assign({type:"kde",field:t},n)}}]),n}(Tq),U$=function(e){c(n,e);var t=l(n);function n(e,r){var i;return v(this,n),(i=t.call(this,e)).filter=r,i}return g(n,[{key:"clone",value:function(){return new n(null,Object.assign({},this.filter))}},{key:"dependentFields",value:function(){return new Set(uR(this.filter))}},{key:"producedFields",value:function(){return new Set}},{key:"hash",value:function(){return"FilterInvalid ".concat(JN(this.filter))}},{key:"assemble",value:function(){var e=this,t=uR(this.filter).reduce((function(t,n){var r=e.filter[n],i=dW(r,{expr:"datum"});return null!==r&&("temporal"===r.type?t.push("(isDate(".concat(i,") || (isValid(").concat(i,") && isFinite(+").concat(i,")))")):"quantitative"===r.type&&(t.push("isValid(".concat(i,")")),t.push("isFinite(+".concat(i,")")))),t}),[]);return t.length>0?{type:"filter",expr:t.join(" && ")}:null}}],[{key:"make",value:function(e,t){var r=t.config,i=t.mark;if("filter"!==LW("invalid",t.markDef,r))return null;var a=t.reduceFieldDef((function(e,n,r){var a=AB(r)&&t.getScaleComponent(r);return a&&sU(a.get("type"))&&"count"!==n.aggregate&&!YR(i)&&(e[n.field]=n),e}),{});return uR(a).length?new n(e,a):null}}]),n}(Tq),W$=function(e){c(n,e);var t=l(n);function n(e,r){var i;v(this,n),(i=t.call(this,e)).transform=r,i.transform=XN(r);var a=i.transform,o=a.flatten,s=a.as,u=void 0===s?[]:s;return i.transform.as=o.map((function(e,t){var n;return null!==(n=u[t])&&void 0!==n?n:e})),i}return g(n,[{key:"clone",value:function(){return new n(this.parent,XN(this.transform))}},{key:"dependentFields",value:function(){return new Set(this.transform.flatten)}},{key:"producedFields",value:function(){return new Set(this.transform.as)}},{key:"hash",value:function(){return"FlattenTransform ".concat(JN(this.transform))}},{key:"assemble",value:function(){var e=this.transform;return{type:"flatten",fields:e.flatten,as:e.as}}}]),n}(Tq),V$=function(e){c(n,e);var t=l(n);function n(e,r){var i,a,o,s;v(this,n),(i=t.call(this,e)).transform=r,i.transform=XN(r);var u=null!==(a=i.transform.as)&&void 0!==a?a:[void 0,void 0];return i.transform.as=[null!==(o=u[0])&&void 0!==o?o:"key",null!==(s=u[1])&&void 0!==s?s:"value"],i}return g(n,[{key:"clone",value:function(){return new n(null,XN(this.transform))}},{key:"dependentFields",value:function(){return new Set(this.transform.fold)}},{key:"producedFields",value:function(){return new Set(this.transform.as)}},{key:"hash",value:function(){return"FoldTransform ".concat(JN(this.transform))}},{key:"assemble",value:function(){var e=this.transform;return{type:"fold",fields:e.fold,as:e.as}}}]),n}(Tq),G$=function(e){c(n,e);var t=l(n);function n(e,r,i,a){var o;return v(this,n),(o=t.call(this,e)).fields=r,o.geojson=i,o.signal=a,o}return g(n,[{key:"clone",value:function(){return new n(null,XN(this.fields),this.geojson,this.signal)}},{key:"dependentFields",value:function(){var e,t=(null!==(e=this.fields)&&void 0!==e?e:[]).filter(FN);return new Set([].concat(h(this.geojson?[this.geojson]:[]),h(t)))}},{key:"producedFields",value:function(){return new Set}},{key:"hash",value:function(){return"GeoJSON ".concat(this.geojson," ").concat(this.signal," ").concat(JN(this.fields))}},{key:"assemble",value:function(){return Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})}}],[{key:"parseAll",value:function(e,t){if(t.component.projection&&!t.component.projection.isFit)return e;for(var r=0,i=0,a=[[AP,CP],[DP,OP]];i<a.length;i++){var o=a[i].map((function(e){var n=kW(t.encoding[e]);return eW(n)?n.field:nW(n)?{expr:"".concat(n.datum)}:sW(n)?{expr:"".concat(n.value)}:void 0}));(o[0]||o[1])&&(e=new n(e,o,null,t.getName("geojson_".concat(r++))))}if(t.channelHasField(FP)){var s=t.typedFieldDef(FP);s.type===Hz&&(e=new n(e,null,s.field,t.getName("geojson_".concat(r++))))}return e}}]),n}(Tq),q$=function(e){c(n,e);var t=l(n);function n(e,r,i,a){var o;return v(this,n),(o=t.call(this,e)).projection=r,o.fields=i,o.as=a,o}return g(n,[{key:"clone",value:function(){return new n(null,this.projection,XN(this.fields),XN(this.as))}},{key:"dependentFields",value:function(){return new Set(this.fields.filter(FN))}},{key:"producedFields",value:function(){return new Set(this.as)}},{key:"hash",value:function(){return"Geopoint ".concat(this.projection," ").concat(JN(this.fields)," ").concat(JN(this.as))}},{key:"assemble",value:function(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}],[{key:"parseAll",value:function(e,t){if(!t.projectionName())return e;for(var r=0,i=[[AP,CP],[DP,OP]];r<i.length;r++){var a=i[r],o=a.map((function(e){var n=kW(t.encoding[e]);return eW(n)?n.field:nW(n)?{expr:"".concat(n.datum)}:sW(n)?{expr:"".concat(n.value)}:void 0})),s=a[0]===DP?"2":"";(o[0]||o[1])&&(e=new n(e,t.projectionName(),o,[t.getName("x"+s),t.getName("y"+s)]))}return e}}]),n}(Tq),H$=function(e){c(n,e);var t=l(n);function n(e,r){var i;return v(this,n),(i=t.call(this,e)).transform=r,i}return g(n,[{key:"clone",value:function(){return new n(null,XN(this.transform))}},{key:"dependentFields",value:function(){var e;return new Set([this.transform.impute,this.transform.key].concat(h(null!==(e=this.transform.groupby)&&void 0!==e?e:[])))}},{key:"producedFields",value:function(){return new Set([this.transform.impute])}},{key:"processSequence",value:function(e){var t=e.start,n=void 0===t?0:t,r=e.stop,i=e.step;return{signal:"sequence(".concat([n,r].concat(h(i?[i]:[])).join(","),")")}}},{key:"hash",value:function(){return"Impute ".concat(JN(this.transform))}},{key:"assemble",value:function(){var e=this.transform,t=e.impute,n=e.key,r=e.keyvals,i=e.method,a=e.groupby,o=e.value,s=e.frame,u=void 0===s?[null,null]:s,c=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:t,key:n},r?{keyvals:function(e){return void 0!==(null===e||void 0===e?void 0:e.stop)}(r)?this.processSequence(r):r}:{}),{method:"value"}),a?{groupby:a}:{}),{value:i&&"value"!==i?null:o});return i&&"value"!==i?[c,Object.assign({type:"window",as:["imputed_".concat(t,"_value")],ops:[i],fields:[t],frame:u,ignorePeers:!1},a?{groupby:a}:{}),{type:"formula",expr:"datum.".concat(t," === null ? datum.imputed_").concat(t,"_value : datum.").concat(t),as:t}]:[c]}}],[{key:"makeFromTransform",value:function(e,t){return new n(e,t)}},{key:"makeFromEncoding",value:function(e,t){var r=t.encoding,i=r.x,a=r.y;if(eW(i)&&eW(a)){var o=i.impute?i:a.impute?a:void 0;if(void 0===o)return;var s=i.impute?a:a.impute?i:void 0,u=o.impute,c=u.method,l=u.value,f=u.frame,d=u.keyvals,h=QW(t.mark,r);return new n(e,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:o.field,key:s.field},c?{method:c}:{}),void 0!==l?{value:l}:{}),f?{frame:f}:{}),void 0!==d?{keyvals:d}:{}),h.length?{groupby:h}:{}))}return null}}]),n}(Tq),X$=function(e){c(n,e);var t=l(n);function n(e,r){var i,a,o,s;v(this,n),(i=t.call(this,e)).transform=r,i.transform=XN(r);var u=null!==(a=i.transform.as)&&void 0!==a?a:[void 0,void 0];return i.transform.as=[null!==(o=u[0])&&void 0!==o?o:r.on,null!==(s=u[1])&&void 0!==s?s:r.loess],i}return g(n,[{key:"clone",value:function(){return new n(null,XN(this.transform))}},{key:"dependentFields",value:function(){var e;return new Set([this.transform.loess,this.transform.on].concat(h(null!==(e=this.transform.groupby)&&void 0!==e?e:[])))}},{key:"producedFields",value:function(){return new Set(this.transform.as)}},{key:"hash",value:function(){return"LoessTransform ".concat(JN(this.transform))}},{key:"assemble",value:function(){var e=this.transform,t=e.loess,n=e.on,r=RN(e,["loess","on"]);return Object.assign({type:"loess",x:n,y:t},r)}}]),n}(Tq),K$=function(e){c(n,e);var t=l(n);function n(e,r,i){var a;return v(this,n),(a=t.call(this,e)).transform=r,a.secondary=i,a}return g(n,[{key:"clone",value:function(){return new n(null,XN(this.transform),this.secondary)}},{key:"dependentFields",value:function(){return new Set([this.transform.lookup])}},{key:"producedFields",value:function(){return new Set(this.transform.as?AN(this.transform.as):this.transform.from.fields)}},{key:"hash",value:function(){return"Lookup ".concat(JN({transform:this.transform,secondary:this.secondary}))}},{key:"assemble",value:function(){var e;if(this.transform.from.fields)e=Object.assign({values:this.transform.from.fields},this.transform.as?{as:AN(this.transform.as)}:{});else{var t=this.transform.as;FN(t)||(oz(P.NO_FIELDS_NEEDS_AS),t="_lookup"),e={as:[t]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},e),this.transform.default?{default:this.transform.default}:{})}}],[{key:"make",value:function(e,t,r,i){var a=t.component.data.sources,o=r.from,s=null;if(function(e){return"data"in e}(o)){var u=lJ(o.data,a);u||(u=new kY(o.data),a.push(u));var c=t.getName("lookup_".concat(i));s=new jq(u,c,"lookup",t.component.data.outputNodeRefCounts),t.component.data.outputNodes[c]=s}else if(function(e){return"selection"in e}(o)){var l=o.selection;if(r=Object.assign({as:l},r),!(s=t.getSelectionComponent(dR(l),l).materialized))throw new Error(P.noSameUnitLookup(l))}return new n(e,r,s.getSource())}}]),n}(Tq),Y$=function(e){c(n,e);var t=l(n);function n(e,r){var i,a,o,s;v(this,n),(i=t.call(this,e)).transform=r,i.transform=XN(r);var u=null!==(a=i.transform.as)&&void 0!==a?a:[void 0,void 0];return i.transform.as=[null!==(o=u[0])&&void 0!==o?o:"prob",null!==(s=u[1])&&void 0!==s?s:"value"],i}return g(n,[{key:"clone",value:function(){return new n(null,XN(this.transform))}},{key:"dependentFields",value:function(){var e;return new Set([this.transform.quantile].concat(h(null!==(e=this.transform.groupby)&&void 0!==e?e:[])))}},{key:"producedFields",value:function(){return new Set(this.transform.as)}},{key:"hash",value:function(){return"QuantileTransform ".concat(JN(this.transform))}},{key:"assemble",value:function(){var e=this.transform,t=e.quantile,n=RN(e,["quantile"]);return Object.assign({type:"quantile",field:t},n)}}]),n}(Tq),$$=function(e){c(n,e);var t=l(n);function n(e,r){var i,a,o,s;v(this,n),(i=t.call(this,e)).transform=r,i.transform=XN(r);var u=null!==(a=i.transform.as)&&void 0!==a?a:[void 0,void 0];return i.transform.as=[null!==(o=u[0])&&void 0!==o?o:r.on,null!==(s=u[1])&&void 0!==s?s:r.regression],i}return g(n,[{key:"clone",value:function(){return new n(null,XN(this.transform))}},{key:"dependentFields",value:function(){var e;return new Set([this.transform.regression,this.transform.on].concat(h(null!==(e=this.transform.groupby)&&void 0!==e?e:[])))}},{key:"producedFields",value:function(){return new Set(this.transform.as)}},{key:"hash",value:function(){return"RegressionTransform ".concat(JN(this.transform))}},{key:"assemble",value:function(){var e=this.transform,t=e.regression,n=e.on,r=RN(e,["regression","on"]);return Object.assign({type:"regression",x:n,y:t},r)}}]),n}(Tq),J$=function(e){c(n,e);var t=l(n);function n(e,r){var i;return v(this,n),(i=t.call(this,e)).transform=r,i}return g(n,[{key:"clone",value:function(){return new n(null,XN(this.transform))}},{key:"addDimensions",value:function(e){var t;this.transform.groupby=rR((null!==(t=this.transform.groupby)&&void 0!==t?t:[]).concat(e),(function(e){return e}))}},{key:"producedFields",value:function(){}},{key:"dependentFields",value:function(){var e;return new Set([this.transform.pivot,this.transform.value].concat(h(null!==(e=this.transform.groupby)&&void 0!==e?e:[])))}},{key:"hash",value:function(){return"PivotTransform ".concat(JN(this.transform))}},{key:"assemble",value:function(){var e=this.transform,t=e.pivot,n=e.value,r=e.groupby,i=e.limit,a=e.op;return Object.assign(Object.assign(Object.assign({type:"pivot",field:t,value:n},void 0!==i?{limit:i}:{}),void 0!==a?{op:a}:{}),void 0!==r?{groupby:r}:{})}}]),n}(Tq),Z$=function(e){c(n,e);var t=l(n);function n(e,r){var i;return v(this,n),(i=t.call(this,e)).transform=r,i}return g(n,[{key:"clone",value:function(){return new n(null,XN(this.transform))}},{key:"dependentFields",value:function(){return new Set}},{key:"producedFields",value:function(){return new Set}},{key:"hash",value:function(){return"SampleTransform ".concat(JN(this.transform))}},{key:"assemble",value:function(){return{type:"sample",size:this.transform.sample}}}]),n}(Tq);function Q$(e){var t=0;return function n(r,i){var a,o,s,u;if(r instanceof kY&&!r.isGenerator&&!DG(r.data)&&(e.push(i),i={name:null,source:i.name,transform:[]}),r instanceof PY&&(r.parent instanceof kY&&!i.source?(i.format=Object.assign(Object.assign({},null!==(u=i.format)&&void 0!==u?u:{}),{parse:r.assembleFormatParse()}),(a=i.transform).push.apply(a,h(r.assembleTransforms(!0)))):(o=i.transform).push.apply(o,h(r.assembleTransforms()))),r instanceof FY){i.name||(i.name="data_".concat(t++)),!i.source||i.transform.length>0?(e.push(i),r.data=i.name):r.data=i.source;var c,l=p(r.assemble());try{for(l.s();!(c=l.n()).done;){var f=c.value;e.push(f)}}catch(g){l.e(g)}finally{l.f()}}else switch((r instanceof SY||r instanceof CY||r instanceof U$||r instanceof oK||r instanceof SK||r instanceof q$||r instanceof G$||r instanceof MY||r instanceof K$||r instanceof UY||r instanceof LY||r instanceof V$||r instanceof W$||r instanceof z$||r instanceof X$||r instanceof Y$||r instanceof $$||r instanceof BY||r instanceof Z$||r instanceof J$)&&i.transform.push(r.assemble()),(r instanceof _Y||r instanceof Mq||r instanceof H$||r instanceof zY)&&(s=i.transform).push.apply(s,h(r.assemble())),r instanceof jq&&(i.source&&0===i.transform.length?r.setSource(i.source):r.parent instanceof jq?r.setSource(i.name):(i.name||(i.name="data_".concat(t++)),r.setSource(i.name),1===r.numChildren()&&(e.push(i),i={name:null,source:i.name,transform:[]}))),r.numChildren()){case 0:r instanceof jq&&(!i.source||i.transform.length>0)&&e.push(i);break;case 1:n(r.children[0],i);break;default:i.name||(i.name="data_".concat(t++));var d=i.name;!i.source||i.transform.length>0?e.push(i):d=i.source;var m,v=p(r.children);try{for(v.s();!(m=v.n()).done;)n(m.value,{name:null,source:d,transform:[]})}catch(g){v.e(g)}finally{v.f()}}}}function eJ(e){return"top"===e||"left"===e||kz(e)?"header":"footer"}function tJ(e,t){var n,r=e.facet,i=e.config,a=e.child,o=e.component;if(e.channelHasField(t)){var s=r[t],u=OK("title",null,i,t),c=yW(s,i,{allowDisabling:!0,includeDefault:void 0===u||!!u});a.component.layoutHeaders[t].title&&(c=wN(c)?c.join(", "):c,c+=" / "+a.component.layoutHeaders[t].title,a.component.layoutHeaders[t].title=null);var l=OK("labelOrient",s,i,t),f=_R((null!==(n=s.header)&&void 0!==n?n:{}).labels,i.header.labels,!0),d=QN(["bottom","right"],l)?"footer":"header";o.layoutHeaders[t]=y({title:c,facetFieldDef:s},d,"facet"===t?[]:[nJ(e,t,f)])}}function nJ(e,t,n){var r="row"===t?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(r)?e.child.getSizeSignalRef(r):void 0,axes:[]}}function rJ(e,t){var n,r=e.child;if(r.component.axes[t]){var i=e.component,a=i.layoutHeaders,o=i.resolve;if(o.axis[t]=KK(o,t),"shared"===o.axis[t]){var s,u="x"===t?"column":"row",c=a[u],l=p(r.component.axes[t]);try{for(l.s();!(s=l.n()).done;){var f=s.value,d=eJ(f.get("orient"));c[d]=null!==(n=c[d])&&void 0!==n?n:[nJ(e,u,!1)];var h=fK(f,"main",e.config,{header:!0});h&&c[d][0].axes.push(h),f.mainExtracted=!0}}catch(m){l.e(m)}finally{l.f()}}}}function iJ(e){aJ(e);var t=1===e.layout.columns?"width":"childWidth",n=void 0===e.layout.columns?"height":"childHeight";oJ(e,t),oJ(e,n)}function aJ(e){var t,n=p(e.children);try{for(n.s();!(t=n.n()).done;)t.value.parseLayoutSize()}catch(r){n.e(r)}finally{n.f()}}function oJ(e,t){var n,r,i=qK(t),a=_B(i),o=e.component.resolve,s=e.component.layoutSize,u=p(e.children);try{for(u.s();!(r=u.n()).done;){var c=r.value.component.layoutSize.getWithExplicit(i),l=o.scale[a];if("independent"===l&&"step"===c.value){n=void 0;break}if(n){if("independent"===l&&n.value!==c.value){n=void 0;break}n=AG(n,c,i,"")}else n=c}}catch(m){u.e(m)}finally{u.f()}if(n){var f,d=p(e.children);try{for(d.s();!(f=d.n()).done;){var h=f.value;e.renameSignal(h.getName(i),e.getName(t)),h.component.layoutSize.set(i,"merged",!1)}}catch(m){d.e(m)}finally{d.f()}s.setWithExplicit(t,n)}else s.setWithExplicit(t,{explicit:!1,value:void 0})}function sJ(e,t){var n="width"===t?"x":"y",r=e.config,i=e.getScaleComponent(n);if(i){var a=i.get("type"),o=i.get("range");if(oU(a)){var s=LV(r.view,t);return Ez(o)||IV(s)?"step":s}return PV(r.view,t)}if(e.hasProjection||"arc"===e.mark)return PV(r.view,t);var u=LV(r.view,t);return IV(u)?u.step:u}function uJ(e,t,n){return dW(t,Object.assign({suffix:"by_".concat(dW(e))},null!==n&&void 0!==n?n:{}))}var cJ=function(e){c(n,e);var t=l(n);function n(e,r,i,o){var s;return v(this,n),(s=t.call(this,e,"facet",r,i,o,e.resolve)).child=MJ(e.spec,a(s),s.getName("child"),void 0,o),s.children=[s.child],s.facet=s.initFacet(e.facet,o),s}return g(n,[{key:"initFacet",value:function(e,t){return GU(e)?ZW(e,(function(e,n,r){return QN([mP,vP],r)?void 0===n.field?(oz(P.emptyFieldDef(n,r)),e):(e[r]=EW(n,r,t),e):(oz(P.incompatibleChannel(r,"facet")),e)}),{}):{facet:EW(e,"facet",t)}}},{key:"channelHasField",value:function(e){return!!this.facet[e]}},{key:"fieldDef",value:function(e){return this.facet[e]}},{key:"parseData",value:function(){this.component.data=dJ(this),this.child.parseData()}},{key:"parseLayoutSize",value:function(){aJ(this)}},{key:"parseSelections",value:function(){this.child.parseSelections(),this.component.selection=this.child.component.selection}},{key:"parseMarkGroup",value:function(){this.child.parseMarkGroup()}},{key:"parseAxesAndHeaders",value:function(){this.child.parseAxesAndHeaders(),function(e){var t,n=p(nB);try{for(n.s();!(t=n.n()).done;)tJ(e,t.value)}catch(r){n.e(r)}finally{n.f()}rJ(e,"x"),rJ(e,"y")}(this)}},{key:"assembleSelectionTopLevelSignals",value:function(e){return this.child.assembleSelectionTopLevelSignals(e)}},{key:"assembleSignals",value:function(){return this.child.assembleSignals(),[]}},{key:"assembleSelectionData",value:function(e){return this.child.assembleSelectionData(e)}},{key:"getHeaderLayoutMixins",value:function(){var e,t,n,r,i={},a=p(nB);try{for(a.s();!(r=a.n()).done;)for(var o=r.value,s=0,u=jK;s<u.length;s++){var c=u[s],l=this.component.layoutHeaders[o],f=l[c],d=l.facetFieldDef;if(d){var h=OK("titleOrient",d,this.config,o);if(QN(["right","bottom"],h)){var m=AK(o,h);i.titleAnchor=null!==(e=i.titleAnchor)&&void 0!==e?e:{},i.titleAnchor[m]="end"}}if(null===f||void 0===f?void 0:f[0]){var v="row"===o?"height":"width",g="header"===c?"headerBand":"footerBand";"facet"===o||this.child.component.layoutSize.get(v)||(i[g]=null!==(t=i[g])&&void 0!==t?t:{},i[g][o]=.5),l.title&&(i.offset=null!==(n=i.offset)&&void 0!==n?n:{},i.offset["row"===o?"rowTitle":"columnTitle"]=10)}}}catch(y){a.e(y)}finally{a.f()}return i}},{key:"assembleDefaultLayout",value:function(){var e=this.facet,t=e.column,n=e.row,r=t?this.columnDistinctSignal():n?1:void 0,i="all";return(n||"independent"!==this.component.resolve.scale.x)&&(t||"independent"!==this.component.resolve.scale.y)||(i="none"),Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),r?{columns:r}:{}),{bounds:"full",align:i})}},{key:"assembleLayoutSignals",value:function(){return this.child.assembleLayoutSignals()}},{key:"columnDistinctSignal",value:function(){if(!(this.parent&&this.parent instanceof n))return{signal:"length(data('".concat(this.getName("column_domain"),"'))")}}},{key:"assembleGroup",value:function(e){return this.parent&&this.parent instanceof n?Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:dW(this.facet.column,{prefix:"distinct"})}}}}:{}),s(u(n.prototype),"assembleGroup",this).call(this,e)):s(u(n.prototype),"assembleGroup",this).call(this,e)}},{key:"getCardinalityAggregateForChild",value:function(){var e=[],t=[],r=[];if(this.child instanceof n){if(this.child.channelHasField("column")){var i=dW(this.child.facet.column);e.push(i),t.push("distinct"),r.push("distinct_".concat(i))}}else{var a,o=p(yB);try{for(o.s();!(a=o.n()).done;){var s=a.value,u=this.child.component.scales[s];if(u&&!u.merged){var c=u.get("type"),l=u.get("range");if(oU(c)&&Ez(l)){var f=m$(v$(this.child,s));f?(e.push(f),t.push("distinct"),r.push("distinct_".concat(f))):oz("Unknown field for ".concat(s,". Cannot calculate view size."))}}}}catch(d){o.e(d)}finally{o.f()}}return{fields:e,ops:t,as:r}}},{key:"assembleFacet",value:function(){var e,t=this.component.data.facetRoot,n=t.name,r=t.data,i=this.facet,a=i.row,o=i.column,s=this.getCardinalityAggregateForChild(),u=s.fields,c=s.ops,l=s.as,f=[],d=p(nB);try{for(d.s();!(e=d.n()).done;){var h=e.value,m=this.facet[h];if(m){f.push(dW(m));var v=m.bin,g=m.sort;if(FB(v)&&f.push(dW(m,{binSuffix:"end"})),WU(g)){var y=g.field,b=g.op,x=void 0===b?BU:b,w=uJ(m,g);a&&o?(u.push(w),c.push("max"),l.push(w)):(u.push(y),c.push(x),l.push(w))}else if(wN(g)){var _=CK(m,h);u.push(_),c.push("max"),l.push(_)}}}}catch(E){d.e(E)}finally{d.f()}var k=!!a&&!!o;return Object.assign({name:n,data:r,groupby:f},k||u.length>0?{aggregate:Object.assign(Object.assign({},k?{cross:k}:{}),u.length?{fields:u,ops:c,as:l}:{})}:{})}},{key:"facetSortFields",value:function(e){var t=this.facet[e];return t?WU(t.sort)?[uJ(t,t.sort,{expr:"datum"})]:wN(t.sort)?[CK(t,e,{expr:"datum"})]:[dW(t,{expr:"datum"})]:[]}},{key:"facetSortOrder",value:function(e){var t=this.facet[e];if(t){var n=t.sort;return[(WU(n)?n.order:!wN(n)&&n)||"ascending"]}return[]}},{key:"assembleLabelTitle",value:function(){var e=this.facet,t=this.config;if(e.facet)return RK(e.facet,"facet",t);for(var n={row:["top","bottom"],column:["left","right"]},r=0,i=TK;r<i.length;r++){var a=i[r];if(e[a]){var o=OK("labelOrient",e[a],t,a);if(QN(n[a],o))return RK(e[a],a,t)}}}},{key:"assembleMarks",value:function(){var e=this,t=this.child,n=function(e){var t,n=[],r=Q$(n),i=p(e.children);try{for(i.s();!(t=i.n()).done;)r(t.value,{source:e.name,name:null,transform:[]})}catch(a){i.e(a)}finally{i.f()}return n}(this.component.data.facetRoot),r=t.assembleGroupEncodeEntry(!1),i=this.assembleLabelTitle()||t.assembleTitle(),a=t.assembleGroupStyle();return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},i?{title:i}:{}),a?{style:a}:{}),{from:{facet:this.assembleFacet()},sort:{field:nB.map((function(t){return e.facetSortFields(t)})).flat(),order:nB.map((function(t){return e.facetSortOrder(t)})).flat()}}),n.length>0?{data:n}:{}),r?{encode:{update:r}}:{}),t.assembleGroup(function(e,t){if(e.component.selection&&uR(e.component.selection).length){var n=IN(e.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:iN("mousemove","scope"),update:"isTuple(facet) ? facet : group(".concat(n,").datum")}]})}return $q(t)}(this,[])))]}},{key:"getMapping",value:function(){return this.facet}}]),n}(L$);function lJ(e,t){var n,r,i,a,o,s,u,c,l,f,d,h=p(t);try{for(h.s();!(d=h.n()).done;){var m=d.value,v=m.data;if((!e.name||!m.hasName()||e.name===m.dataName)&&!((null===(n=e.format)||void 0===n?void 0:n.mesh)&&(null===(r=v.format)||void 0===r?void 0:r.feature)||((null===(i=e.format)||void 0===i?void 0:i.feature)||(null===(a=v.format)||void 0===a?void 0:a.feature))&&(null===(o=e.format)||void 0===o?void 0:o.feature)!==(null===(s=v.format)||void 0===s?void 0:s.feature)||((null===(u=e.format)||void 0===u?void 0:u.mesh)||(null===(c=v.format)||void 0===c?void 0:c.mesh))&&(null===(l=e.format)||void 0===l?void 0:l.mesh)!==(null===(f=v.format)||void 0===f?void 0:f.mesh)))if(TG(e)&&TG(v)){if(HN(e.values,v.values))return m}else if(DG(e)&&DG(v)){if(e.url===v.url)return m}else if(jG(e)&&e.name===m.dataName)return m}}catch(g){h.e(g)}finally{h.f()}return null}function fJ(e,t){if(e.data||!e.parent){if(null===e.data){var n=new kY({values:[]});return t.push(n),n}var r=lJ(e.data,t);if(r)return MG(e.data)||(r.data.format=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var i=0,a=n;i<a.length;i++){var o=a[i];nR(e,null!==o&&void 0!==o?o:{})}return e}({},e.data.format,r.data.format)),!r.hasName()&&e.data.name&&(r.dataName=e.data.name),r;var i=new kY(e.data);return t.push(i),i}return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}function dJ(e){var t,n,r,i,a,o,s,u,c,l,f=fJ(e,e.component.data.sources),d=e.component.data,h=d.outputNodes,m=d.outputNodeRefCounts,v=e.parent?e.parent.component.data.ancestorParse.clone():new OG,g=e.data;MG(g)?(FG(g)?f=new CY(f,g.sequence):NG(g)&&(f=new SY(f,g.graticule)),v.parseNothing=!0):null===(null===(t=null===g||void 0===g?void 0:g.format)||void 0===t?void 0:t.parse)&&(v.parseNothing=!0),f=null!==(n=PY.makeExplicit(f,e,v))&&void 0!==n?n:f,f=new BY(f);var b=e.parent&&P$(e.parent);(I$(e)||N$(e))&&b&&(f=null!==(r=_Y.makeFromEncoding(f,e))&&void 0!==r?r:f),e.transforms.length>0&&(f=function(e,t,n){var r,i,a,o=0,s=p(t.transforms);try{for(s.s();!(a=s.n()).done;){var u=a.value,c=void 0,l=void 0;if(YG(u))c=e=new SK(e,u),l="derived";else if(BG(u)){var f=NY(u);c=e=null!==(r=PY.makeWithAncestors(e,{},f,n))&&void 0!==r?r:e,e=new oK(e,t,u.filter)}else if($G(u))c=e=_Y.makeFromTransform(e,u,t),l="number";else if(ZG(u))l="date",void 0===n.getWithExplicit(u.field).value&&(e=new PY(e,y({},u.field,l)),n.set(u.field,l,!1)),c=e=Mq.makeFromTransform(e,u);else if(QG(u))c=e=MY.makeFromTransform(e,u),l="number",fH(t)&&(e=new BY(e));else if(LG(u))c=e=K$.make(e,t,u,o++),l="derived";else if(HG(u))c=e=new UY(e,u),l="number";else if(XG(u))c=e=new LY(e,u),l="number";else if(eq(u))c=e=zY.makeFromTransform(e,u),l="derived";else if(tq(u))c=e=new V$(e,u),l="derived";else if(KG(u))c=e=new W$(e,u),l="derived";else if(zG(u))c=e=new J$(e,u),l="derived";else if(qG(u))e=new Z$(e,u);else if(JG(u))c=e=H$.makeFromTransform(e,u),l="derived";else if(UG(u))c=e=new z$(e,u),l="derived";else if(WG(u))c=e=new Y$(e,u),l="derived";else if(VG(u))c=e=new $$(e,u),l="derived";else{if(!GG(u)){oz(P.invalidTransformIgnored(u));continue}c=e=new X$(e,u),l="derived"}if(c&&void 0!==l){var d,h=p(null!==(i=c.producedFields())&&void 0!==i?i:[]);try{for(h.s();!(d=h.n()).done;){var m=d.value;n.set(m,l,!1)}}catch(v){h.e(v)}finally{h.f()}}}}catch(v){s.e(v)}finally{s.f()}return e}(f,e,v));var x=function(e){var t={};if(I$(e)&&e.component.selection){var n,r=p(uR(e.component.selection));try{for(r.s();!(n=r.n()).done;){var i,a=n.value,o=e.component.selection[a],s=p(o.project.items);try{for(s.s();!(i=s.n()).done;){var u=i.value;!u.channel&&wR(u.field)>1&&(t[u.field]="flatten")}}catch(c){s.e(c)}finally{s.f()}}}catch(c){r.e(c)}finally{r.f()}}return t}(e),w=RY(e);f=null!==(i=PY.makeWithAncestors(f,{},Object.assign(Object.assign({},x),w),v))&&void 0!==i?i:f,I$(e)&&(f=G$.parseAll(f,e),f=q$.parseAll(f,e)),(I$(e)||N$(e))&&(b||(f=null!==(a=_Y.makeFromEncoding(f,e))&&void 0!==a?a:f),f=null!==(o=Mq.makeFromEncoding(f,e))&&void 0!==o?o:f,f=SK.parseAllForSortIndex(f,e));var _=e.getName(PG),k=new jq(f,_,PG,m);if(h[_]=k,f=k,I$(e)){var E=MY.makeFromEncoding(f,e);E&&(f=E,fH(e)&&(f=new BY(f))),f=null!==(s=H$.makeFromEncoding(f,e))&&void 0!==s?s:f,f=null!==(u=zY.makeFromEncoding(f,e))&&void 0!==u?u:f}I$(e)&&(f=null!==(c=U$.make(f,e))&&void 0!==c?c:f);var S=e.getName(RG),C=new jq(f,S,RG,m);h[S]=C,f=C,I$(e)&&function(e,t){cH(e,(function(n){var r=n.name,i=e.getName("lookup_".concat(r));e.component.data.outputNodes[i]=n.materialized=new jq(new oK(t,e,{selection:r}),i,"lookup",e.component.data.outputNodeRefCounts)}))}(e,C);var A=null;if(N$(e)){var O=e.getName("facet");f=null!==(l=function(e,t){var n=t.row,r=t.column;if(n&&r){for(var i=null,a=0,o=[n,r];a<o.length;a++){var s=o[a];if(WU(s.sort)){var u=s.sort,c=u.field,l=u.op;e=i=new LY(e,{joinaggregate:[{op:void 0===l?BU:l,field:c,as:uJ(s,s.sort,{forAs:!0})}],groupby:[dW(s)]})}}return i}return null}(f,e.facet))&&void 0!==l?l:f,A=new FY(f,e,O,C.getSource()),h[O]=A}return Object.assign(Object.assign({},e.component.data),{outputNodes:h,outputNodeRefCounts:m,raw:k,main:C,facetRoot:A,ancestorParse:v})}var hJ=function(e){c(n,e);var t=l(n);function n(e,r,i,o){var s,u,c,l,f;return v(this,n),s=t.call(this,e,"concat",r,i,o,e.resolve),"shared"!==(null===(c=null===(u=e.resolve)||void 0===u?void 0:u.axis)||void 0===c?void 0:c.x)&&"shared"!==(null===(f=null===(l=e.resolve)||void 0===l?void 0:l.axis)||void 0===f?void 0:f.y)||oz(P.CONCAT_CANNOT_SHARE_AXIS),s.children=s.getChildren(e).map((function(e,t){return MJ(e,a(s),s.getName("concat_"+t),void 0,o)})),s}return g(n,[{key:"parseData",value:function(){this.component.data=dJ(this);var e,t=p(this.children);try{for(t.s();!(e=t.n()).done;)e.value.parseData()}catch(n){t.e(n)}finally{t.f()}}},{key:"parseSelections",value:function(){this.component.selection={};var e,t=p(this.children);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.parseSelections();var r,i=p(uR(n.component.selection));try{for(i.s();!(r=i.n()).done;){var a=r.value;this.component.selection[a]=n.component.selection[a]}}catch(o){i.e(o)}finally{i.f()}}}catch(o){t.e(o)}finally{t.f()}}},{key:"parseMarkGroup",value:function(){var e,t=p(this.children);try{for(t.s();!(e=t.n()).done;)e.value.parseMarkGroup()}catch(n){t.e(n)}finally{t.f()}}},{key:"parseAxesAndHeaders",value:function(){var e,t=p(this.children);try{for(t.s();!(e=t.n()).done;)e.value.parseAxesAndHeaders()}catch(n){t.e(n)}finally{t.f()}}},{key:"getChildren",value:function(e){return MV(e)?e.vconcat:FV(e)?e.hconcat:e.concat}},{key:"parseLayoutSize",value:function(){iJ(this)}},{key:"parseAxisGroup",value:function(){return null}},{key:"assembleSelectionTopLevelSignals",value:function(e){return this.children.reduce((function(e,t){return t.assembleSelectionTopLevelSignals(e)}),e)}},{key:"assembleSignals",value:function(){return this.children.forEach((function(e){return e.assembleSignals()})),[]}},{key:"assembleLayoutSignals",value:function(){var e,t=UK(this),n=p(this.children);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,h(r.assembleLayoutSignals()))}}catch(i){n.e(i)}finally{n.f()}return t}},{key:"assembleSelectionData",value:function(e){return this.children.reduce((function(e,t){return t.assembleSelectionData(e)}),e)}},{key:"assembleMarks",value:function(){return this.children.map((function(e){var t=e.assembleTitle(),n=e.assembleGroupStyle(),r=e.assembleGroupEncodeEntry(!1);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:e.getName("group")},t?{title:t}:{}),n?{style:n}:{}),r?{encode:{update:r}}:{}),e.assembleGroup())}))}},{key:"assembleDefaultLayout",value:function(){var e=this.layout.columns;return Object.assign(Object.assign({},null!=e?{columns:e}:{}),{bounds:"full",align:"each"})}}]),n}(B$),pJ=Object.assign(Object.assign({disable:1,gridScale:1,scale:1},jR),{labelExpr:1,encode:1}),mJ=uR(pJ),vJ=function(e){c(n,e);var t=l(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return v(this,n),(e=t.call(this)).explicit=r,e.implicit=i,e.mainExtracted=a,e}return g(n,[{key:"clone",value:function(){return new n(XN(this.explicit),XN(this.implicit),this.mainExtracted)}},{key:"hasAxisPart",value:function(e){return"axis"===e||("grid"===e||"title"===e?!!this.get(e):!function(e){return!1===e||null===e}(this.get(e)))}},{key:"hasOrientSignalRef",value:function(){return kz(this.explicit.orient)}}]),n}(_G);function gJ(e){return yB.reduce((function(t,n){return e.component.scales[n]&&(t[n]=[function(e,t){var n,r,i,a=t.axis(e),o=new vJ,s=kW(t.encoding[e]),u=t.mark,c=t.config,l=(null===a||void 0===a?void 0:a.orient)||(null===(n=c["x"===e?"axisX":"axisY"])||void 0===n?void 0:n.orient)||(null===(r=c.axis)||void 0===r?void 0:r.orient)||function(e){return"x"===e?"bottom":"left"}(e),f=t.getScaleComponent(e).get("type"),d=yK(e,f,l,t.config),h=void 0!==a?!a:bK("disable",c,null===a||void 0===a?void 0:a.style,d).configValue;if(o.set("disable",h,void 0!==a),h)return o;var m,v=function(e,t,n,r,i){var a=null===t||void 0===t?void 0:t.labelAngle;if(void 0!==a)return kz(a)?a:SR(a);var o=bK("labelAngle",e.config,null===t||void 0===t?void 0:t.style,i).configValue;return void 0!==o?SR(o):n===yP&&QN([qz,Vz],r.type)?270:void 0}(t,a=a||{},e,s,d),g={fieldOrDatumDef:s,axis:a,channel:e,model:t,scaleType:f,orient:l,labelAngle:v,mark:u,config:c},y=p(mJ);try{for(y.s();!(m=y.n()).done;){var b=m.value,x=b in xK?xK[b](g):FR(b)?a[b]:void 0,w=void 0!==x,_=wJ(x,b,a,t,e);if(w&&_)o.set(b,x,_);else{var k=FR(b)&&"values"!==b?bK(b,t.config,a.style,d):{},E=k.configValue,S=k.configFrom,C=void 0!==E;w&&!C?o.set(b,x,_):("vgAxisConfig"!==S||_J.has(b)&&C||OR(E)||kz(E))&&o.set(b,E,!1)}}}catch(D){y.e(D)}finally{y.f()}var A=null!==(i=a.encoding)&&void 0!==i?i:{},O=DR.reduce((function(n,r){var i;if(!o.hasAxisPart(r))return n;var a=HK(null!==(i=A[r])&&void 0!==i?i:{},t),s="labels"===r?function(e,t,n){var r,i=e.encoding,a=e.config,o=null!==(r=kW(i[t]))&&void 0!==r?r:kW(i[hB(t)]),s=e.axis(t)||{},u=s.format,c=s.formatType;return CU(c)?Object.assign({text:jU({fieldOrDatumDef:o,field:"datum.value",format:u,formatType:c,config:a})},n):n}(t,e,a):a;return void 0===s||sR(s)||(n[r]={update:s}),n}),{});return sR(O)||o.set("encode",O,!!a.encoding||void 0!==a.labelAngle),o}(n,e)]),t}),{})}var yJ={bottom:"top",top:"bottom",left:"right",right:"left"};function bJ(e,t){if(!e)return t.map((function(e){return e.clone()}));if(e.length===t.length){for(var n=e.length,r=0;r<n;r++){var i=e[r],a=t[r];if(!!i!=!!a)return;if(i&&a){var o=i.getWithExplicit("orient"),s=a.getWithExplicit("orient");if(o.explicit&&s.explicit&&o.value!==s.value)return;e[r]=xJ(i,a)}}return e}}function xJ(e,t){var n,r=p(mJ);try{var i=function(){var r=n.value,i=AG(e.getWithExplicit(r),t.getWithExplicit(r),r,"axis",(function(e,t){switch(r){case"title":return HW(e,t);case"gridScale":return{explicit:e.explicit,value:_R(e.value,t.value)}}return CG(e,t,r,"axis")}));e.setWithExplicit(r,i)};for(r.s();!(n=r.n()).done;)i()}catch(a){r.e(a)}finally{r.f()}return e}function wJ(e,t,n,r,i){if("disable"===t)return void 0!==n;switch(n=n||{},t){case"titleAngle":case"labelAngle":return e===(kz(n.labelAngle)?n.labelAngle:SR(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===EK(r,i))return!0}return e===n[t]}var _J=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function kJ(e,t,n,r){var i=r.graticule,a=ZR(e)?Object.assign({},e):{type:e},o=LW("orient",a,n);if(a.orient=function(e,t,n){switch(e){case zR:case HR:case XR:case VR:case UR:case BR:return}var r=t.x,i=t.y,a=t.x2,o=t.y2;switch(e){case PR:if(eW(r)&&(IB(r.bin)||eW(i)&&i.aggregate&&!r.aggregate))return"vertical";if(eW(i)&&(IB(i.bin)||eW(r)&&r.aggregate&&!i.aggregate))return"horizontal";if(o||a){if(n)return n;if(!a&&(eW(r)&&r.type===Wz&&!FB(r.bin)||iW(r)))return"horizontal";if(!o&&(eW(i)&&i.type===Wz&&!FB(i.bin)||iW(i)))return"vertical"}case WR:if(a&&(!eW(r)||!IB(r.bin))&&o&&(!eW(i)||!IB(i.bin)))return;case RR:if(o)return eW(i)&&IB(i.bin)?"horizontal":"vertical";if(a)return eW(r)&&IB(r.bin)?"vertical":"horizontal";if(e===WR){if(r&&!i)return"vertical";if(i&&!r)return"horizontal"}case LR:case GR:var s=rW(r),u=rW(i);if(s&&!u)return"tick"!==e?"horizontal":"vertical";if(!s&&u)return"tick"!==e?"vertical":"horizontal";if(s&&u){var c=r,l=i,f=c.type===Gz,d=l.type===Gz;return f&&!d?"tick"!==e?"vertical":"horizontal":!f&&d?"tick"!==e?"horizontal":"vertical":!c.aggregate&&l.aggregate?"tick"!==e?"vertical":"horizontal":c.aggregate&&!l.aggregate?"tick"!==e?"horizontal":"vertical":n||"vertical"}return n||void 0}return"vertical"}(a.type,t,o),void 0!==o&&o!==a.orient&&oz(P.orientOverridden(a.orient,o)),"bar"===a.type&&a.orient){var s=LW("cornerRadiusEnd",a,n);if(void 0!==s){var u,c="horizontal"===a.orient&&t.x2||"vertical"===a.orient&&t.y2?["cornerRadius"]:tP[a.orient],l=p(c);try{for(l.s();!(u=l.n()).done;)a[u.value]=s}catch(f){l.e(f)}finally{l.f()}void 0!==a.cornerRadiusEnd&&delete a.cornerRadiusEnd}}return void 0===LW("opacity",a,n)&&(a.opacity=function(e,t){if(QN([zR,GR,HR,XR],e)&&!KW(t))return.7}(a.type,t)),void 0===a.filled&&(a.filled=!i&&function(e,t){var n=zW("filled",e,t),r=e.type;return _R(n,r!==zR&&r!==LR&&r!==WR)}(a,n)),void 0===LW("cursor",a,n)&&(a.cursor=function(e,t,n){return t.href||e.href||LW("href",e,n)?"pointer":e.cursor}(a,t,n)),a}function EJ(e,t){return e.config,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Sq(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),hq("x",e,{defaultPos:"mid"})),hq("y",e,{defaultPos:"mid"})),lq("size",e)),lq("angle",e)),function(e,t,n){return n?{shape:{value:n}}:lq("shape",e)}(e,0,t))}var SJ={arc:{vgMark:"arc",encodeEntry:function(e){return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Sq(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),hq("x",e,{defaultPos:"mid"})),hq("y",e,{defaultPos:"mid"})),wq(e,"radius","arc")),wq(e,"theta","arc"))}},area:{vgMark:"area",encodeEntry:function(e){return Object.assign(Object.assign(Object.assign(Object.assign({},Sq(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),yq("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"horizontal"===e.markDef.orient})),yq("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"vertical"===e.markDef.orient})),Aq(e))}},bar:{vgMark:"rect",encodeEntry:function(e){return Object.assign(Object.assign(Object.assign({},Sq(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),wq(e,"x","bar")),wq(e,"y","bar"))}},circle:{vgMark:"symbol",encodeEntry:function(e){return EJ(e,"circle")}},geoshape:{vgMark:"shape",encodeEntry:function(e){return Object.assign({},Sq(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"}))},postEncodingTransform:function(e){var t=e.encoding.shape;return[Object.assign({type:"geoshape",projection:e.projectionName()},t&&eW(t)&&t.type===Hz?{field:dW(t,{expr:"datum"})}:{})]}},image:{vgMark:"image",encodeEntry:function(e){return Object.assign(Object.assign(Object.assign(Object.assign({},Sq(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),wq(e,"x","image")),wq(e,"y","image")),iq(e,"url"))}},line:{vgMark:"line",encodeEntry:function(e){return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Sq(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),hq("x",e,{defaultPos:"mid"})),hq("y",e,{defaultPos:"mid"})),lq("size",e,{vgChannel:"strokeWidth"})),Aq(e))}},point:{vgMark:"symbol",encodeEntry:function(e){return EJ(e)}},rect:{vgMark:"rect",encodeEntry:function(e){return Object.assign(Object.assign(Object.assign({},Sq(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),wq(e,"x","rect")),wq(e,"y","rect"))}},rule:{vgMark:"rule",encodeEntry:function(e){var t=e.markDef.orient;return e.encoding.x||e.encoding.y||e.encoding.latitude||e.encoding.longitude?Object.assign(Object.assign(Object.assign(Object.assign({},Sq(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),yq("x",e,{defaultPos:"horizontal"===t?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"vertical"!==t})),yq("y",e,{defaultPos:"vertical"===t?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"horizontal"!==t})),lq("size",e,{vgChannel:"strokeWidth"})):{}}},square:{vgMark:"symbol",encodeEntry:function(e){return EJ(e,"square")}},text:{vgMark:"text",encodeEntry:function(e){var t=e.config;return e.encoding,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Sq(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),hq("x",e,{defaultPos:"mid"})),hq("y",e,{defaultPos:"mid"})),iq(e)),lq("size",e,{vgChannel:"fontSize"})),lq("angle",e)),Oq("align",function(e,t,n){if(void 0===LW("align",e,n))return"center"}(e.markDef,0,t))),Oq("baseline",function(e,t,n){if(void 0===LW("baseline",e,n))return"middle"}(e.markDef,0,t))),hq("radius",e,{defaultPos:null,isMidPoint:!0})),hq("theta",e,{defaultPos:null,isMidPoint:!0}))}},tick:{vgMark:"rect",encodeEntry:function(e){var t=e.config,n=e.markDef,r=n.orient,i="horizontal"===r?"width":"height",a="horizontal"===r?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Sq(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),hq("x",e,{defaultPos:"mid",vgChannel:"xc"})),hq("y",e,{defaultPos:"mid",vgChannel:"yc"})),lq("size",e,{defaultValue:function(e){var t,n=e.config,r=e.markDef,i=r.orient,a="horizontal"===i?"width":"height",o=e.getScaleComponent("horizontal"===i?"x":"y"),s=null!==(t=LW("size",r,n,{vgChannel:a}))&&void 0!==t?t:n.tick.bandSize;if(void 0!==s)return s;var u=o?o.get("range"):void 0;return u&&Ez(u)&&MN(u.step)?3*u.step/4:3*BV(n.view,a)/4}(e),vgChannel:i})),y({},a,NW(LW("thickness",n,t))))}},trail:{vgMark:"trail",encodeEntry:function(e){return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Sq(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),hq("x",e,{defaultPos:"mid"})),hq("y",e,{defaultPos:"mid"})),lq("size",e)),Aq(e))}}};function CJ(e){return QN([LR,RR,qR],e.mark)?function(e){var t=QW(e.mark,e.encoding),n=DJ(e,{fromPrefix:t.length>0?AJ:""});return t.length>0?[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:AJ+e.requestDataName(RG),data:e.requestDataName(RG),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:n}]:n}(e):QN([PR],e.mark)?function(e){var t=Oz.some((function(t){return LW(t,e.markDef,e.config)}));if(e.stack&&!e.fieldDef("size")&&t){var n,r,i=DJ(e,{fromPrefix:OJ}),a=f(i,1)[0],o=e.scaleName(e.stack.fieldChannel),s=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.vgField(e.stack.fieldChannel,t)},u=function(e,t){var n=[s({prefix:"min",suffix:"start",expr:t}),s({prefix:"max",suffix:"start",expr:t}),s({prefix:"min",suffix:"end",expr:t}),s({prefix:"max",suffix:"end",expr:t})];return"".concat(e,"(").concat(n.map((function(e){return"scale('".concat(o,"',").concat(e,")")})).join(","),")")};"x"===e.stack.fieldChannel?(n=Object.assign(Object.assign({},KN(a.encode.update,["y","yc","y2","height"].concat(Oz))),{x:{signal:u("min","datum")},x2:{signal:u("max","datum")},clip:{value:!0}}),r={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},a.encode.update=Object.assign(Object.assign({},YN(a.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})):(n=Object.assign(Object.assign({},KN(a.encode.update,["x","xc","x2","width"])),{y:{signal:u("min","datum")},y2:{signal:u("max","datum")},clip:{value:!0}}),r={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},a.encode.update=Object.assign(Object.assign({},YN(a.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}}));for(var c=0,l=Oz;c<l.length;c++){var d=l[c],h=zW(d,e.markDef,e.config);a.encode.update[d]?(n[d]=a.encode.update[d],delete a.encode.update[d]):h&&(n[d]=NW(h)),h&&(a.encode.update[d]={value:0})}var p=e.fieldDef(e.stack.groupbyChannel),m=dW(p)?[dW(p)]:[];return((null===p||void 0===p?void 0:p.bin)||(null===p||void 0===p?void 0:p.timeUnit))&&m.push(dW(p,{binSuffix:"end"})),(n=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"].reduce((function(t,n){if(a.encode.update[n])return Object.assign(Object.assign({},t),y({},n,a.encode.update[n]));var r=zW(n,e.markDef,e.config);return void 0!==r?Object.assign(Object.assign({},t),y({},n,NW(r))):t}),n)).stroke&&(n.strokeForeground={value:!0},n.strokeOffset={value:0}),[{type:"group",from:{facet:{data:e.requestDataName(RG),name:OJ+e.requestDataName(RG),groupby:m,aggregate:{fields:[s({suffix:"start"}),s({suffix:"start"}),s({suffix:"end"}),s({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:n},marks:[{type:"group",encode:{update:r},marks:[a]}]}]}return DJ(e)}(e):DJ(e)}var AJ="faceted_path_",OJ="stack_group_";function DJ(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{fromPrefix:""},n=e.mark,r=e.markDef,i=e.config,a=_R(r.clip,function(e){var t=e.getScaleComponent("x"),n=e.getScaleComponent("y");return!!(t&&t.get("selectionExtent")||n&&n.get("selectionExtent"))||void 0}(e),function(e){var t=e.component.projection;return!(!t||t.isFit)||void 0}(e)),o=BW(r),s=e.encoding.key,u=function(e){var t=e.encoding,n=e.stack,r=e.mark,i=e.markDef,a=e.config,o=t.order;if(!(!wN(o)&&sW(o)&&ZN(o.value)||!o&&ZN(LW("order",i,a)))){if((wN(o)||eW(o))&&!n)return VW(o,{expr:"datum"});if(YR(r)){var s="horizontal"===i.orient?"y":"x",u=t[s];if(eW(u)){var c=u.sort;return wN(c)?{field:dW(u,{prefix:s,suffix:"sort_index",expr:"datum"})}:WU(c)?{field:dW({aggregate:KW(e.encoding)?c.op:void 0,field:c.field},{expr:"datum"})}:UU(c)?{field:dW(e.fieldDef(c.encoding),{expr:"datum"}),order:c.order}:null===c?void 0:{field:dW(u,{binSuffix:e.stack&&e.stack.impute?"mid":void 0,expr:"datum"})}}}}}(e),c=function(e){if(!e.component.selection)return null;for(var t=uR(e.component.selection).length,n=t,r=e.parent;r&&0===n;)n=uR(r.component.selection).length,r=r.parent;return n?{interactive:t>0}:null}(e),l=LW("aria",r,i),f=SJ[n].postEncodingTransform?SJ[n].postEncodingTransform(e):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName("marks"),type:SJ[n].vgMark},a?{clip:!0}:{}),o?{style:o}:{}),s?{key:s.field}:{}),u?{sort:u}:{}),c||{}),!1===l?{aria:l}:{}),{from:{data:t.fromPrefix+e.requestDataName(RG)},encode:{update:SJ[n].encodeEntry(e)}}),f?{transform:f}:{})]}var TJ=function(e){c(n,e);var t=l(n);function n(e,r,i){var a,o,s,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},c=arguments.length>4?arguments[4]:void 0;v(this,n),(a=t.call(this,e,"unit",r,i,c,void 0,NV(e)?e.view:void 0)).specifiedScales={},a.specifiedAxes={},a.specifiedLegends={},a.specifiedProjection={},a.selection={},a.children=[];var l=ZR(e.mark)?e.mark.type:e.mark;a.markDef=kJ(e.mark,null!==(o=e.encoding)&&void 0!==o?o:{},c,{graticule:e.data&&NG(e.data)});var f=a.encoding=$W(null!==(s=e.encoding)&&void 0!==s?s:{},a.markDef,c);return a.size=function(e){var t,n=e.encoding,r=e.size,i=p(yB);try{for(i.s();!(t=i.n()).done;){var a=t.value,o=pB(a);IV(r[o])&&rW(n[a])&&(delete r[o],oz(P.stepDropped(o)))}}catch(s){i.e(s)}finally{i.f()}return r}({encoding:f,size:NV(e)?Object.assign(Object.assign(Object.assign({},u),e.width?{width:e.width}:{}),e.height?{height:e.height}:{}):u}),a.stack=rG(l,f),a.specifiedScales=a.initScales(l,f),a.specifiedAxes=a.initAxes(f),a.specifiedLegends=a.initLegend(f),a.specifiedProjection=e.projection,a.selection=e.selection,a}return g(n,[{key:"hasProjection",get:function(){var e=this.encoding,t=this.mark===KR,n=e&&ZP.some((function(t){return aW(e[t])}));return t||n}},{key:"scaleDomain",value:function(e){var t=this.specifiedScales[e];return t?t.domain:void 0}},{key:"axis",value:function(e){return this.specifiedAxes[e]}},{key:"legend",value:function(e){return this.specifiedLegends[e]}},{key:"initScales",value:function(e,t){return CB.reduce((function(e,n){var r,i=kW(t[n]);return i&&(e[n]=null!==(r=i.scale)&&void 0!==r?r:{}),e}),{})}},{key:"initAxes",value:function(e){return yB.reduce((function(t,n){var r=e[n];if(aW(r)||n===yP&&aW(e.x2)||n===bP&&aW(e.y2)){var i=aW(r)?r.axis:void 0;t[n]=i?Object.assign({},i):i}return t}),{})}},{key:"initLegend",value:function(e){return EB.reduce((function(t,n){var r=kW(e[n]);if(r&&function(e){switch(e){case TP:case jP:case MP:case IP:case FP:case RP:case LP:case zP:return!0;case PP:case BP:case NP:return!1}}(n)){var i=r.legend;t[n]=i?Object.assign({},i):i}return t}),{})}},{key:"parseData",value:function(){this.component.data=dJ(this)}},{key:"parseLayoutSize",value:function(){!function(e){var t,n=e.size,r=e.component,i=p(yB);try{for(i.s();!(t=i.n()).done;){var a=pB(t.value);if(n[a]){var o=n[a];r.layoutSize.set(a,IV(o)?"step":o,!0)}else{var s=sJ(e,a);r.layoutSize.set(a,s,!1)}}}catch(u){i.e(u)}finally{i.f()}}(this)}},{key:"parseSelections",value:function(){this.component.selection=function(e,t){var n,r,i={},a=e.config.selection,o=p(uR(null!==t&&void 0!==t?t:{}));try{var s=function(){var o=r.value,s=XN(t[o]),u=a[s.type],c=(u.fields,u.encodings,RN(u,["fields","encodings"]));for(var l in c)"encodings"===l&&s.fields||"fields"===l&&s.encodings||("mark"===l&&(s[l]=Object.assign(Object.assign({},c[l]),s[l])),void 0!==s[l]&&!0!==s[l]||(s[l]=null!==(n=c[l])&&void 0!==n?n:s[l]));var f=dR(o),d=i[f]=Object.assign(Object.assign({},s),{name:f,events:FN(s.on)?iN(s.on,"scope"):XN(s.on)});Xq(d,(function(n){n.has(d)&&n.parse&&n.parse(e,d,s,t[o])}))};for(o.s();!(r=o.n()).done;)s()}catch(u){o.e(u)}finally{o.f()}return i}(this,this.selection)}},{key:"parseMarkGroup",value:function(){this.component.mark=CJ(this)}},{key:"parseAxesAndHeaders",value:function(){this.component.axes=gJ(this)}},{key:"assembleSelectionTopLevelSignals",value:function(e){return function(e,t){var n=!1;return cH(e,(function(r,i){var a=r.name,o=IN(a+iH);if(0===t.filter((function(e){return e.name===a})).length){var s="global"===r.resolve?"union":r.resolve,u="multi"===r.type?", true)":")";t.push({name:r.name,update:"".concat(sH,"(").concat(o,", ").concat(IN(s)).concat(u)})}n=!0,i.topLevelSignals&&(t=i.topLevelSignals(e,r,t)),Xq(r,(function(n){n.topLevelSignals&&(t=n.topLevelSignals(e,r,t))}))})),n&&0===t.filter((function(e){return"unit"===e.name})).length&&t.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]}),$q(t)}(this,e)}},{key:"assembleSignals",value:function(){return[].concat(h(dK(this)),h(function(e,t){return cH(e,(function(n,r){var i,a=n.name,o=r.modifyExpr(e,n);(i=t).push.apply(i,h(r.signals(e,n))),Xq(n,(function(r){r.signals&&(t=r.signals(e,n,t)),r.modifyExpr&&(o=r.modifyExpr(e,n,o))})),t.push({name:a+oH,on:[{events:{signal:n.name+aH},update:"modify(".concat(IN(n.name+iH),", ").concat(o,")")}]})})),$q(t)}(this,[])))}},{key:"assembleSelectionData",value:function(e){return function(e,t){var n=h(t);return cH(e,(function(t){var r={name:t.name+iH};if(t.init){var i=t.project.items.map((function(e){return e.signals,RN(e,["signals"])})),a=t.init.map((function(e){return Kq(e,!1)}));r.values="interval"===t.type?[{unit:lH(e,{escape:!1}),fields:i,values:a}]:a.map((function(t){return{unit:lH(e,{escape:!1}),fields:i,values:t}}))}n.filter((function(e){return e.name===t.name+iH})).length||n.push(r)})),n}(this,e)}},{key:"assembleLayout",value:function(){return null}},{key:"assembleLayoutSignals",value:function(){return UK(this)}},{key:"assembleMarks",value:function(){var e,t=null!==(e=this.component.mark)&&void 0!==e?e:[];return this.parent&&P$(this.parent)||(t=Yq(this,t)),t.map(this.correctDataNames)}},{key:"getMapping",value:function(){return this.encoding}},{key:"mark",get:function(){return this.markDef.type}},{key:"channelHasField",value:function(e){return XW(this.encoding,e)}},{key:"fieldDef",value:function(e){return _W(this.encoding[e])}},{key:"typedFieldDef",value:function(e){var t=this.fieldDef(e);return oW(t)?t:null}}]),n}(L$),jJ=function(e){c(n,e);var t=l(n);function n(e,r,i,o,s){var u;v(this,n),u=t.call(this,e,"layer",r,i,s,e.resolve,e.view);var c=Object.assign(Object.assign(Object.assign({},o),e.width?{width:e.width}:{}),e.height?{height:e.height}:{});return u.children=e.layer.map((function(e,t){if(JV(e))return new n(e,a(u),u.getName("layer_"+t),c,s);if(iP(e))return new TJ(e,a(u),u.getName("layer_"+t),c,s);throw new Error(P.invalidSpec(e))})),u}return g(n,[{key:"parseData",value:function(){this.component.data=dJ(this);var e,t=p(this.children);try{for(t.s();!(e=t.n()).done;)e.value.parseData()}catch(n){t.e(n)}finally{t.f()}}},{key:"parseLayoutSize",value:function(){!function(e){aJ(e),oJ(e,"width"),oJ(e,"height")}(this)}},{key:"parseSelections",value:function(){this.component.selection={};var e,t=p(this.children);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.parseSelections();var r,i=p(uR(n.component.selection));try{for(i.s();!(r=i.n()).done;){var a=r.value;this.component.selection[a]=n.component.selection[a]}}catch(o){i.e(o)}finally{i.f()}}}catch(o){t.e(o)}finally{t.f()}}},{key:"parseMarkGroup",value:function(){var e,t=p(this.children);try{for(t.s();!(e=t.n()).done;)e.value.parseMarkGroup()}catch(n){t.e(n)}finally{t.f()}}},{key:"parseAxesAndHeaders",value:function(){!function(e){var t,n,r=e.component,i=r.axes,a=r.resolve,o={top:0,bottom:0,right:0,left:0},s=p(e.children);try{for(s.s();!(n=s.n()).done;){var u=n.value;u.parseAxesAndHeaders();var c,l=p(uR(u.component.axes));try{for(l.s();!(c=l.n()).done;){var f=c.value;a.axis[f]=KK(e.component.resolve,f),"shared"===a.axis[f]&&(i[f]=bJ(i[f],u.component.axes[f]),i[f]||(a.axis[f]="independent",delete i[f]))}}catch(D){l.e(D)}finally{l.f()}}}catch(D){s.e(D)}finally{s.f()}var d,h=p(yB);try{for(h.s();!(d=h.n()).done;){var m,v=d.value,g=p(e.children);try{for(g.s();!(m=g.n()).done;){var y=m.value;if(y.component.axes[v]){if("independent"===a.axis[v]){i[v]=(null!==(t=i[v])&&void 0!==t?t:[]).concat(y.component.axes[v]);var b,x=p(y.component.axes[v]);try{for(x.s();!(b=x.n()).done;){var w=b.value,_=w.getWithExplicit("orient"),k=_.value,E=_.explicit;if(!kz(k)){if(o[k]>0&&!E){var S=yJ[k];o[k]>o[S]&&w.set("orient",S,!1)}o[k]++}}}catch(D){x.e(D)}finally{x.f()}}delete y.component.axes[v]}}}catch(D){g.e(D)}finally{g.f()}if("independent"===a.axis[v]&&i[v]&&i[v].length>1){var C,A=p(i[v]);try{for(A.s();!(C=A.n()).done;){var O=C.value;O.get("grid")&&!O.explicit.grid&&(O.implicit.grid=!1)}}catch(D){A.e(D)}finally{A.f()}}}}catch(D){h.e(D)}finally{h.f()}}(this)}},{key:"assembleSelectionTopLevelSignals",value:function(e){return this.children.reduce((function(e,t){return t.assembleSelectionTopLevelSignals(e)}),e)}},{key:"assembleSignals",value:function(){return this.children.reduce((function(e,t){return e.concat(t.assembleSignals())}),dK(this))}},{key:"assembleLayoutSignals",value:function(){return this.children.reduce((function(e,t){return e.concat(t.assembleLayoutSignals())}),UK(this))}},{key:"assembleSelectionData",value:function(e){return this.children.reduce((function(e,t){return t.assembleSelectionData(e)}),e)}},{key:"assembleTitle",value:function(){var e=s(u(n.prototype),"assembleTitle",this).call(this);if(e)return e;var t,r=p(this.children);try{for(r.s();!(t=r.n()).done;)if(e=t.value.assembleTitle())return e}catch(i){r.e(i)}finally{r.f()}}},{key:"assembleLayout",value:function(){return null}},{key:"assembleMarks",value:function(){return function(e,t){var n,r=p(e.children);try{for(r.s();!(n=r.n()).done;){var i=n.value;I$(i)&&(t=Yq(i,t))}}catch(a){r.e(a)}finally{r.f()}return t}(this,this.children.flatMap((function(e){return e.assembleMarks()})))}},{key:"assembleLegends",value:function(){return this.children.reduce((function(e,t){return e.concat(t.assembleLegends())}),hY(this))}}]),n}(B$);function MJ(e,t,n,r,i){if(HU(e))return new cJ(e,t,n,i);if(JV(e))return new jJ(e,t,n,r,i);if(iP(e))return new TJ(e,t,n,r,i);if(function(e){return MV(e)||FV(e)||jV(e)}(e))return new hJ(e,t,n,i);throw new Error(P.invalidSpec(e))}function FJ(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.logger&&function(e){iz=e}(t.logger),t.fieldTitle&&gW(t.fieldTitle);try{var n=qV(EN(t.config,e.config)),r=gG(e,n),i=MJ(r,null,"",void 0,n);return i.parse(),function(e,t){EY(e.sources);for(var n=0,r=0,i=0;i<t$&&a$(e,t);i++)n++;e.sources.map(XY);for(var a=0;a<t$&&a$(e,t);a++)r++;EY(e.sources),Math.max(n,r)===t$&&oz("Maximum optimization runs(".concat(t$,") reached."))}(i.component.data,i),{spec:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0,i=e.config?YV(e.config):void 0,a=[].concat(e.assembleSelectionData([]),function(e,t){var n,r,i,a=[],o=Q$(a),s=0,u=p(e.sources);try{for(u.s();!(i=u.n()).done;){var c=i.value;c.hasName()||(c.dataName="source_".concat(s++)),o(c,c.assemble())}}catch(T){u.e(T)}finally{u.f()}for(var l=0,d=a;l<d.length;l++){var h=d[l];0===h.transform.length&&delete h.transform}var m,v=0,g=p(a.entries());try{for(g.s();!(m=g.n()).done;){var y=f(m.value,2),b=y[0],x=y[1];0!==(null!==(n=x.transform)&&void 0!==n?n:[]).length||x.source||a.splice(v++,0,a.splice(b,1)[0])}}catch(T){g.e(T)}finally{g.f()}for(var w=0,_=a;w<_.length;w++){var k,E=_[w],S=p(null!==(r=E.transform)&&void 0!==r?r:[]);try{for(S.s();!(k=S.n()).done;){var C=k.value;"lookup"===C.type&&(C.from=e.outputNodes[C.from].getSource())}}catch(T){S.e(T)}finally{S.f()}}for(var A=0,O=a;A<O.length;A++){var D=O[A];D.name in t&&(D.values=t[D.name])}return a}(e.component.data,n)),o=e.assembleProjections(),s=e.assembleTitle(),u=e.assembleGroupStyle(),c=e.assembleGroupEncodeEntry(!0),l=e.assembleLayoutSignals();return l=l.filter((function(e){return"width"!==e.name&&"height"!==e.name||void 0===e.value||(t[e.name]=+e.value,!1)})),Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},e.description?{description:e.description}:{}),t),s?{title:s}:{}),u?{style:u}:{}),c?{encode:{update:c}}:{}),{data:a}),o.length>0?{projections:o}:{}),e.assembleGroup([].concat(h(l),h(e.assembleSelectionTopLevelSignals([]))))),i?{config:i}:{}),r?{usermeta:r}:{})}(i,function(e,t,n,r){var i=r.component.layoutSize.get("width"),a=r.component.layoutSize.get("height");if(void 0===t?(t={type:"pad"},r.hasAxisOrientSignalRef()&&(t.resize=!0)):FN(t)&&(t={type:t}),i&&a&&function(e){return"fit"===e||"fit-x"===e||"fit-y"===e}(t.type))if("step"===i&&"step"===a)oz(P.droppingFit()),t.type="pad";else if("step"===i||"step"===a){var o="step"===i?"width":"height";oz(P.droppingFit(_B(o)));var s="width"===o?"height":"width";t.type=function(e){return e?"fit-".concat(_B(e)):"fit"}(s)}return Object.assign(Object.assign(Object.assign({},1===uR(t).length&&t.type?"pad"===t.type?{}:{autosize:t.type}:{autosize:t}),wG(n)),wG(e))}(e,r.autosize,n,i),e.datasets,e.usermeta),normalized:r}}finally{t.logger&&az(),t.fieldTitle&&gW(mW)}}var IJ=new(function(e){c(n,e);var t=l(n);function n(){return v(this,n),t.apply(this,arguments)}return g(n,[{key:"mapUnit",value:function(e,t){var n=t.config;if(e.encoding){var r=e.encoding,i=e.transform,a=YW(r,n),o=a.bins,s=a.timeUnits,u=a.aggregate,c=a.groupby,l=a.encoding,f=[].concat(h(i||[]),h(o),h(s),h(0===u.length?[]:[{aggregate:u,groupby:c}]));return Object.assign(Object.assign(Object.assign({},e),f.length>0?{transform:f}:{}),{encoding:l})}return e}}]),n}(ZV));function NJ(e,t){return IJ.map(e,{config:t})}var RJ=lN.version,PJ=function(e){var t=/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(e).slice(1,3),n=f(t,2);return{library:n[0],version:n[1]}},BJ={background:"#333",title:{color:"#fff",subtitleColor:"#fff"},style:{"guide-label":{fill:"#fff"},"guide-title":{fill:"#fff"}},axis:{domainColor:"#fff",gridColor:"#888",tickColor:"#fff"}},LJ={background:"#fff",arc:{fill:"#4572a7"},area:{fill:"#4572a7"},line:{stroke:"#4572a7",strokeWidth:2},path:{stroke:"#4572a7"},rect:{fill:"#4572a7"},shape:{stroke:"#4572a7"},symbol:{fill:"#4572a7",strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},zJ={arc:{fill:"#30a2da"},area:{fill:"#30a2da"},axis:{domainColor:"#cbcbcb",grid:!0,gridColor:"#cbcbcb",gridWidth:1,labelColor:"#999",labelFontSize:10,titleColor:"#333",tickColor:"#cbcbcb",tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:"#f0f0f0",group:{fill:"#f0f0f0"},legend:{labelColor:"#333",labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:"#333",titleFontSize:14,titlePadding:10},line:{stroke:"#30a2da",strokeWidth:2},path:{stroke:"#30a2da",strokeWidth:.5},rect:{fill:"#30a2da"},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:"#30a2da"},bar:{binSpacing:2,fill:"#30a2da",stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},UJ={group:{fill:"#e5e5e5"},arc:{fill:"#000"},area:{fill:"#000"},line:{stroke:"#000"},path:{stroke:"#000"},rect:{fill:"#000"},shape:{stroke:"#000"},symbol:{fill:"#000",size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}},WJ="Benton Gothic Bold, sans-serif",VJ={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]},GJ={background:"#ffffff",title:{anchor:"start",color:"#000000",font:WJ,fontSize:22,fontWeight:"normal"},arc:{fill:"#82c6df"},area:{fill:"#82c6df"},line:{stroke:"#82c6df",strokeWidth:2},path:{stroke:"#82c6df"},rect:{fill:"#82c6df"},shape:{stroke:"#82c6df"},symbol:{fill:"#82c6df",size:30},axis:{labelFont:"Benton Gothic, sans-serif",labelFontSize:11.5,labelFontWeight:"normal",titleFont:WJ,titleFontSize:13,titleFontWeight:"normal"},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:"Benton Gothic, sans-serif",labelFontSize:11.5,symbolType:"square",titleFont:WJ,titleFontSize:13,titleFontWeight:"normal"},range:{category:VJ["category-6"],diverging:VJ["fireandice-6"],heatmap:VJ["fire-7"],ordinal:VJ["fire-7"],ramp:VJ["fire-7"]}},qJ={background:"#f9f9f9",arc:{fill:"#ab5787"},area:{fill:"#ab5787"},line:{stroke:"#ab5787"},path:{stroke:"#ab5787"},rect:{fill:"#ab5787"},shape:{stroke:"#ab5787"},symbol:{fill:"#ab5787",size:30},axis:{domainColor:"#979797",domainWidth:.5,gridWidth:.2,labelColor:"#979797",tickColor:"#979797",tickWidth:.2,titleColor:"#979797"},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},HJ={background:"#fff",arc:{fill:"#3e5c69"},area:{fill:"#3e5c69"},line:{stroke:"#3e5c69"},path:{stroke:"#3e5c69"},rect:{fill:"#3e5c69"},shape:{stroke:"#3e5c69"},symbol:{fill:"#3e5c69"},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}},XJ={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},KJ={background:"#FFFFFF",title:{anchor:"start",fontSize:18,font:"Lato"},axisX:{domain:!0,domainColor:"#000000",domainWidth:1,grid:!1,labelFontSize:12,labelFont:"Lato",labelAngle:0,tickColor:"#000000",tickSize:5,titleFontSize:12,titlePadding:10,titleFont:"Lato"},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:"#DEDDDD",gridWidth:1,labelFontSize:12,labelFont:"Lato",labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:"Lato",titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:"Lato",symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:"Lato",orient:"right",offset:10},view:{stroke:"transparent"},range:{category:XJ["six-groups-cat-1"],diverging:XJ["diverging-colors"],heatmap:XJ["diverging-colors"],ordinal:XJ["six-groups-seq"],ramp:XJ["shades-blue"]},area:{fill:"#1696d2"},rect:{fill:"#1696d2"},line:{color:"#1696d2",stroke:"#1696d2",strokeWidth:5},trail:{color:"#1696d2",stroke:"#1696d2",strokeWidth:0,size:1},path:{stroke:"#1696d2",strokeWidth:.5},point:{filled:!0},text:{font:"Lato",color:"#1696d2",fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:"#1696d2",stroke:null}},arc:{fill:"#1696d2"},shape:{stroke:"#1696d2"},symbol:{fill:"#1696d2",size:30}},YJ={arc:{fill:"#3366CC"},area:{fill:"#3366CC"},path:{stroke:"#3366CC"},rect:{fill:"#3366CC"},shape:{stroke:"#3366CC"},symbol:{stroke:"#3366CC"},circle:{fill:"#3366CC"},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:"Arial, sans-serif",fontSize:12},"guide-title":{font:"Arial, sans-serif",fontSize:12},"group-title":{font:"Arial, sans-serif",fontSize:12}},title:{font:"Arial, sans-serif",fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:"#ccc",tickColor:"#ccc",domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}},$J="2.10.0",JJ="#vg-tooltip-element {\n  visibility: hidden;\n  padding: 8px;\n  position: fixed;\n  z-index: 1000;\n  font-family: sans-serif;\n  font-size: 11px;\n  border-radius: 3px;\n  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);\n  /* The default theme is the light theme. */\n  background-color: rgba(255, 255, 255, 0.95);\n  border: 1px solid #d9d9d9;\n  color: black; }\n  #vg-tooltip-element.visible {\n    visibility: visible; }\n  #vg-tooltip-element h2 {\n    margin-top: 0;\n    margin-bottom: 10px;\n    font-size: 13px; }\n  #vg-tooltip-element img {\n    max-width: 200px;\n    max-height: 200px; }\n  #vg-tooltip-element table {\n    border-spacing: 0; }\n    #vg-tooltip-element table tr {\n      border: none; }\n      #vg-tooltip-element table tr td {\n        overflow: hidden;\n        text-overflow: ellipsis;\n        padding-top: 2px;\n        padding-bottom: 2px; }\n        #vg-tooltip-element table tr td.key {\n          color: #808080;\n          max-width: 150px;\n          text-align: right;\n          padding-right: 4px; }\n        #vg-tooltip-element table tr td.value {\n          display: block;\n          max-width: 300px;\n          max-height: 7em;\n          text-align: left; }\n  #vg-tooltip-element.dark-theme {\n    background-color: rgba(32, 32, 32, 0.9);\n    border: 1px solid #f5f5f5;\n    color: white; }\n    #vg-tooltip-element.dark-theme td.key {\n      color: #bfbfbf; }\n",ZJ="vg-tooltip-element",QJ={offsetX:10,offsetY:10,id:ZJ,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;")},maxDepth:2};function eZ(e,t,n){if(Object(ye.B)(e))return"[".concat(e.map((function(e){return t(Object(ye.J)(e)?e:tZ(e,n))})).join(", "),"]");if(Object(ye.H)(e)){var r="",i=e,a=i.title,o=i.image,s=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(i,["title","image"]);a&&(r+="<h2>".concat(t(a),"</h2>")),o&&(r+='<img src="'.concat(t(o),'">'));var u=Object.keys(s);if(u.length>0){r+="<table>";var c,l=p(u);try{for(l.s();!(c=l.n()).done;){var f=c.value,d=s[f];void 0!==d&&(Object(ye.H)(d)&&(d=tZ(d,n)),r+='<tr><td class="key">'.concat(t(f),':</td><td class="value">').concat(t(d),"</td></tr>"))}}catch(h){l.e(h)}finally{l.f()}r+="</table>"}return r||"{}"}return t(e)}function tZ(e,t){return JSON.stringify(e,function(e){var t=[];return function(n,r){if("object"!=typeof r||null===r)return r;var i=t.indexOf(this)+1;return t.length=i,t.length>e?"[Object]":t.indexOf(r)>=0?"[Circular]":(t.push(r),r)}}(t))}var nZ=function(){function e(t){v(this,e),this.options=Object.assign(Object.assign({},QJ),t);var n=this.options.id;if(this.el=null,this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){var r=document.createElement("style");r.setAttribute("id",this.options.styleId),r.innerHTML=function(e){if(!/^[A-Za-z]+[-:.\w]*$/.test(e))throw new Error("Invalid HTML ID");return JJ.toString().replace(ZJ,e)}(n);var i=document.head;i.childNodes.length>0?i.insertBefore(r,i.childNodes[0]):i.appendChild(r)}}return g(e,[{key:"tooltipHandler",value:function(e,t,n,r){if(this.el=document.getElementById(this.options.id),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",this.options.id),this.el.classList.add("vg-tooltip"),document.body.appendChild(this.el)),(null!=document.fullscreenElement?document.fullscreenElement:document.body).appendChild(this.el),null!=r&&""!==r){this.el.innerHTML=eZ(r,this.options.sanitize,this.options.maxDepth),this.el.classList.add("visible","".concat(this.options.theme,"-theme"));var i=function(e,t,n,r){var i=e.clientX+n;i+t.width>window.innerWidth&&(i=+e.clientX-n-t.width);var a=e.clientY+r;return a+t.height>window.innerHeight&&(a=+e.clientY-r-t.height),{x:i,y:a}}(t,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY),a=i.x,o=i.y;this.el.setAttribute("style","top: ".concat(o,"px; left: ").concat(a,"px"))}else this.el.classList.remove("visible","".concat(this.options.theme,"-theme"))}}]),e}();function rZ(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}u((r=r.apply(e,t||[])).next())}))}n.d(t,"DEFAULT_ACTIONS",(function(){return fZ})),n.d(t,"guessMode",(function(){return bZ})),n.d(t,"vega",(function(){return uZ})),n.d(t,"vegaLite",(function(){return cZ}));var iZ,aZ='.vega-embed {\n  position: relative;\n  display: inline-block;\n  box-sizing: border-box; }\n  .vega-embed.has-actions {\n    padding-right: 38px; }\n  .vega-embed details:not([open]) > :not(summary) {\n    display: none !important; }\n  .vega-embed summary {\n    list-style: none;\n    position: absolute;\n    top: 0;\n    right: 0;\n    padding: 6px;\n    z-index: 1000;\n    background: white;\n    box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);\n    color: #1b1e23;\n    border: 1px solid #aaa;\n    border-radius: 999px;\n    opacity: 0.2;\n    transition: opacity 0.4s ease-in;\n    outline: none;\n    cursor: pointer;\n    line-height: 0px; }\n    .vega-embed summary::-webkit-details-marker {\n      display: none; }\n    .vega-embed summary:active {\n      box-shadow: #aaa 0px 0px 0px 1px inset; }\n    .vega-embed summary svg {\n      width: 14px;\n      height: 14px; }\n  .vega-embed details[open] summary {\n    opacity: 0.7; }\n  .vega-embed:hover summary,\n  .vega-embed:focus summary {\n    opacity: 1 !important;\n    transition: opacity 0.2s ease; }\n  .vega-embed .vega-actions {\n    position: absolute;\n    z-index: 1001;\n    top: 35px;\n    right: -9px;\n    display: flex;\n    flex-direction: column;\n    padding-bottom: 8px;\n    padding-top: 8px;\n    border-radius: 4px;\n    box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);\n    border: 1px solid #d9d9d9;\n    background: white;\n    animation-duration: 0.15s;\n    animation-name: scale-in;\n    animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);\n    text-align: left; }\n    .vega-embed .vega-actions a {\n      padding: 8px 16px;\n      font-family: sans-serif;\n      font-size: 14px;\n      font-weight: 600;\n      white-space: nowrap;\n      color: #434a56;\n      text-decoration: none; }\n      .vega-embed .vega-actions a:hover {\n        background-color: #f7f7f9;\n        color: black; }\n    .vega-embed .vega-actions::before, .vega-embed .vega-actions::after {\n      content: "";\n      display: inline-block;\n      position: absolute; }\n    .vega-embed .vega-actions::before {\n      left: auto;\n      right: 14px;\n      top: -16px;\n      border: 8px solid #0000;\n      border-bottom-color: #d9d9d9; }\n    .vega-embed .vega-actions::after {\n      left: auto;\n      right: 15px;\n      top: -14px;\n      border: 7px solid #0000;\n      border-bottom-color: #fff; }\n  .vega-embed .chart-wrapper {\n    width: 100%;\n    height: 100%; }\n\n.vega-embed-wrapper {\n  max-width: 100%;\n  overflow: auto;\n  padding-right: 14px; }\n\n@keyframes scale-in {\n  from {\n    opacity: 0;\n    transform: scale(0.6); }\n  to {\n    opacity: 1;\n    transform: scale(1); } }\n';function oZ(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var i=0,a=n;i<a.length;i++)sZ(e,a[i]);return e}function sZ(e,t){for(var n=0,r=Object.keys(t);n<r.length;n++){var i=r[n];Object(ye.La)(e,i,t[i],!0)}}String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e});var uZ=R,cZ=B,lZ="undefined"!=typeof window?window:void 0;void 0===cZ&&(null===(iZ=null===lZ||void 0===lZ?void 0:lZ.vl)||void 0===iZ?void 0:iZ.compile)&&(cZ=lZ.vl);var fZ={export:{svg:!0,png:!0},source:!0,compiled:!0,editor:!0},dZ={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"},hZ={vega:"Vega","vega-lite":"Vega-Lite"},pZ={vega:uZ.version,"vega-lite":cZ?cZ.version:"not available"},mZ={vega:function(e){return e},"vega-lite":function(e,t){return cZ.compile(e,{config:t}).spec}},vZ='\n<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">\n  <circle r="2" cy="8" cx="2"></circle>\n  <circle r="2" cy="8" cx="8"></circle>\n  <circle r="2" cy="8" cx="14"></circle>\n</svg>',gZ="chart-wrapper";function yZ(e,t,n,r){var i="<html><head>".concat(t,'</head><body><pre><code class="json">'),a="</code></pre>".concat(n,"</body></html>"),o=window.open("");o.document.write(i+e+a),o.document.title="".concat(hZ[r]," JSON Source")}function bZ(e,t){var n;if(e.$schema){var r=PJ(e.$schema);t&&t!==r.library&&console.warn("The given visualization spec is written in ".concat(hZ[r.library],", but mode argument sets ").concat(null!==(n=hZ[t])&&void 0!==n?n:t,"."));var i=r.library;return Object(ge.satisfies)(pZ[i],"^".concat(r.version.slice(1)))||console.warn("The input spec uses ".concat(hZ[i]," ").concat(r.version,", but the current version of ").concat(hZ[i]," is v").concat(pZ[i],".")),i}return"mark"in e||"encoding"in e||"layer"in e||"hconcat"in e||"vconcat"in e||"facet"in e||"repeat"in e?"vega-lite":"marks"in e||"signals"in e||"scales"in e||"axes"in e?"vega":null!==t&&void 0!==t?t:"vega"}function xZ(e){return function(e){return!(!e||!("load"in e))}(e)?e:uZ.loader(e)}function wZ(e){var t;return null!==(t=e.usermeta&&e.usermeta.embedOptions)&&void 0!==t?t:{}}function _Z(e,t){var n;return rZ(this,void 0,void 0,m().mark((function r(){var i,a;return m().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!Object(ye.J)(e.config)){r.next=8;break}return r.t1=JSON,r.next=4,t.load(e.config);case 4:r.t2=r.sent,r.t0=r.t1.parse.call(r.t1,r.t2),r.next=9;break;case 8:r.t0=null!==(n=e.config)&&void 0!==n?n:{};case 9:if(i=r.t0,!Object(ye.J)(e.patch)){r.next=18;break}return r.t4=JSON,r.next=14,t.load(e.patch);case 14:r.t5=r.sent,r.t3=r.t4.parse.call(r.t4,r.t5),r.next=19;break;case 18:r.t3=e.patch;case 19:return a=r.t3,r.abrupt("return",Object.assign(Object.assign(Object.assign({},e),a?{patch:a}:{}),i?{config:i}:{}));case 21:case"end":return r.stop()}}),r)})))}t.default=function(e,t){var n,r,i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return rZ(this,void 0,void 0,m().mark((function o(){var s,u,c,l,f,d;return m().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(!Object(ye.J)(t)){o.next=9;break}return u=xZ(a.loader),o.t0=JSON,o.next=5,u.load(t);case 5:o.t1=o.sent,s=o.t0.parse.call(o.t0,o.t1),o.next=10;break;case 9:s=t;case 10:return c=wZ(s).loader,u&&!c||(u=xZ(null!==(n=a.loader)&&void 0!==n?n:c)),o.next=14,_Z(wZ(s),u);case 14:return l=o.sent,o.next=17,_Z(a,u);case 17:return f=o.sent,d=Object.assign(Object.assign({},oZ(f,l)),{config:Object(ye.P)(null!==(r=f.config)&&void 0!==r?r:{},null!==(i=l.config)&&void 0!==i?i:{})}),o.next=21,function(e,t){var n,r,i,a,o,s,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},c=arguments.length>3?arguments[3]:void 0;return rZ(this,void 0,void 0,m().mark((function l(){var f,d,h,p,v,g,y,b,x,w,_,k,E,S,C,A,O,D,T,j,M,F,I,N,R,P,B,z,U,W,V,G,q,H,X,K,Y,$;return m().wrap((function(l){for(;;)switch(l.prev=l.next){case 0:if(f=u.theme?Object(ye.P)(L[u.theme],null!==(n=u.config)&&void 0!==n?n:{}):u.config,d=Object(ye.C)(u.actions)?u.actions:oZ({},fZ,null!==(r=u.actions)&&void 0!==r?r:{}),h=Object.assign(Object.assign({},dZ),u.i18n),p=null!==(i=u.renderer)&&void 0!==i?i:"canvas",v=null!==(a=u.logLevel)&&void 0!==a?a:uZ.Warn,g=null!==(o=u.downloadFileName)&&void 0!==o?o:"visualization",y="string"==typeof e?document.querySelector(e):e){l.next=3;break}throw new Error("".concat(e," does not exist"));case 3:return!1!==u.defaultStyle&&(b="vega-embed-style",x=function(e){var t,n=e.getRootNode?e.getRootNode():document;return n instanceof ShadowRoot?{root:n,rootContainer:n}:{root:document,rootContainer:null!==(t=document.head)&&void 0!==t?t:document.body}}(y),w=x.root,_=x.rootContainer,w.getElementById(b)||((k=document.createElement("style")).id=b,k.innerText=void 0===u.defaultStyle||!0===u.defaultStyle?aZ.toString():u.defaultStyle,_.appendChild(k))),E=bZ(t,u.mode),S=mZ[E](t,f),"vega-lite"===E&&S.$schema&&(C=PJ(S.$schema),Object(ge.satisfies)(pZ.vega,"^".concat(C.version.slice(1)))||console.warn("The compiled spec uses Vega ".concat(C.version,", but current version is v").concat(pZ.vega,"."))),y.classList.add("vega-embed"),d&&y.classList.add("has-actions"),y.innerHTML="",A=y,d&&((O=document.createElement("div")).classList.add(gZ),y.appendChild(O),A=O),(D=u.patch)&&(S=D instanceof Function?D(S):ne(S,D,!0,!1).newDocument),u.formatLocale&&uZ.formatLocale(u.formatLocale),u.timeFormatLocale&&uZ.timeFormatLocale(u.timeFormatLocale),T=u.ast,j=uZ.parse(S,"vega-lite"===E?{}:f,{ast:T}),M=new(u.viewClass||uZ.View)(j,Object.assign({loader:c,logLevel:v,renderer:p},T?{expr:uZ.expressionInterpreter}:{})),!1!==u.tooltip&&(F=function(e){return"function"==typeof e}(u.tooltip)?u.tooltip:new nZ(!0===u.tooltip?{}:u.tooltip).call,M.tooltip(F)),void 0===(N=u.hover)&&(N="vega"===E),N&&(P=(R="boolean"==typeof N?{}:N).hoverSet,B=R.updateSet,M.hover(P,B)),u&&(null!=u.width&&M.width(u.width),null!=u.height&&M.height(u.height),null!=u.padding&&M.padding(u.padding)),l.next=19,M.initialize(A,u.bind).runAsync();case 19:if(!1===d){l.next=34;break}if(z=y,!1!==u.defaultStyle&&((U=document.createElement("details")).title=h.CLICK_TO_VIEW_ACTIONS,y.append(U),z=U,(W=document.createElement("summary")).innerHTML=vZ,U.append(W),I=function(e){U.contains(e.target)||U.removeAttribute("open")},document.addEventListener("click",I)),V=document.createElement("div"),z.append(V),V.classList.add("vega-actions"),!0!==d&&!1===d.export){l.next=31;break}G=m().mark((function e(){var t,n,r;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=H[q],(!0===d||!0===d.export||d.export[t])&&(n=h["".concat(t.toUpperCase(),"_ACTION")],(r=document.createElement("a")).text=n,r.href="#",r.target="_blank",r.download="".concat(g,".").concat(t),r.addEventListener("mousedown",(function(e){return rZ(this,void 0,void 0,m().mark((function n(){var r;return m().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e.preventDefault(),n.next=3,M.toImageURL(t,u.scaleFactor);case 3:r=n.sent,this.href=r;case 5:case"end":return n.stop()}}),n,this)})))})),V.append(r));case 2:case"end":return e.stop()}}),e)})),q=0,H=["svg","png"];case 26:if(!(q<H.length)){l.next=31;break}return l.delegateYield(G(),"t0",28);case 28:q++,l.next=26;break;case 31:!0!==d&&!1===d.source||((X=document.createElement("a")).text=h.SOURCE_ACTION,X.href="#",X.addEventListener("click",(function(e){var n,r;yZ(ve()(t),null!==(n=u.sourceHeader)&&void 0!==n?n:"",null!==(r=u.sourceFooter)&&void 0!==r?r:"",E),e.preventDefault()})),V.append(X)),"vega-lite"!==E||!0!==d&&!1===d.compiled||((K=document.createElement("a")).text=h.COMPILED_ACTION,K.href="#",K.addEventListener("click",(function(e){var t,n;yZ(ve()(S),null!==(t=u.sourceHeader)&&void 0!==t?t:"",null!==(n=u.sourceFooter)&&void 0!==n?n:"","vega"),e.preventDefault()})),V.append(K)),!0!==d&&!1===d.editor||(Y=null!==(s=u.editorUrl)&&void 0!==s?s:"https://vega.github.io/editor/",($=document.createElement("a")).text=h.EDITOR_ACTION,$.href="#",$.addEventListener("click",(function(e){!function(e,t,n){var r=e.open(t),i=250,a=new URL(t).origin,o=~~(1e4/i);e.addEventListener("message",(function t(n){n.source===r&&(o=0,e.removeEventListener("message",t,!1))}),!1),setTimeout((function e(){o<=0||(r.postMessage(n,a),setTimeout(e,i),o-=1)}),i)}(window,Y,{config:f,mode:E,renderer:p,spec:ve()(t)}),e.preventDefault()})),V.append($));case 34:return l.abrupt("return",{view:M,spec:t,vgSpec:S,finalize:function(){I&&document.removeEventListener("click",I),M.finalize()}});case 35:case"end":return l.stop()}}),l)})))}(e,s,d,u);case 21:return o.abrupt("return",o.sent);case 22:case"end":return o.stop()}}),o)})))}},function(e,t,n){var r=n(117).MAX_LENGTH,i=n(90),a=i.re,o=i.t,s=n(32),u=n(115);e.exports=function(e,t){if(t=u(t),e instanceof s)return e;if("string"!=typeof e)return null;if(e.length>r)return null;if(!(t.loose?a[o.LOOSE]:a[o.FULL]).test(e))return null;try{return new s(e,t)}catch(e){return null}}},function(e,t,n){var r=n(117).MAX_SAFE_COMPONENT_LENGTH,i=n(116),a=(t=e.exports={}).re=[],o=t.src=[],s=t.t={},u=0,c=function(e,t,n){var r=u++;i(r,t),s[e]=r,o[r]=t,a[r]=new RegExp(t,n?"g":void 0)};c("NUMERICIDENTIFIER","0|[1-9]\\d*"),c("NUMERICIDENTIFIERLOOSE","[0-9]+"),c("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),c("MAINVERSION","(".concat(o[s.NUMERICIDENTIFIER],")\\.")+"(".concat(o[s.NUMERICIDENTIFIER],")\\.")+"(".concat(o[s.NUMERICIDENTIFIER],")")),c("MAINVERSIONLOOSE","(".concat(o[s.NUMERICIDENTIFIERLOOSE],")\\.")+"(".concat(o[s.NUMERICIDENTIFIERLOOSE],")\\.")+"(".concat(o[s.NUMERICIDENTIFIERLOOSE],")")),c("PRERELEASEIDENTIFIER","(?:".concat(o[s.NUMERICIDENTIFIER],"|").concat(o[s.NONNUMERICIDENTIFIER],")")),c("PRERELEASEIDENTIFIERLOOSE","(?:".concat(o[s.NUMERICIDENTIFIERLOOSE],"|").concat(o[s.NONNUMERICIDENTIFIER],")")),c("PRERELEASE","(?:-(".concat(o[s.PRERELEASEIDENTIFIER],"(?:\\.").concat(o[s.PRERELEASEIDENTIFIER],")*))")),c("PRERELEASELOOSE","(?:-?(".concat(o[s.PRERELEASEIDENTIFIERLOOSE],"(?:\\.").concat(o[s.PRERELEASEIDENTIFIERLOOSE],")*))")),c("BUILDIDENTIFIER","[0-9A-Za-z-]+"),c("BUILD","(?:\\+(".concat(o[s.BUILDIDENTIFIER],"(?:\\.").concat(o[s.BUILDIDENTIFIER],")*))")),c("FULLPLAIN","v?".concat(o[s.MAINVERSION]).concat(o[s.PRERELEASE],"?").concat(o[s.BUILD],"?")),c("FULL","^".concat(o[s.FULLPLAIN],"$")),c("LOOSEPLAIN","[v=\\s]*".concat(o[s.MAINVERSIONLOOSE]).concat(o[s.PRERELEASELOOSE],"?").concat(o[s.BUILD],"?")),c("LOOSE","^".concat(o[s.LOOSEPLAIN],"$")),c("GTLT","((?:<|>)?=?)"),c("XRANGEIDENTIFIERLOOSE","".concat(o[s.NUMERICIDENTIFIERLOOSE],"|x|X|\\*")),c("XRANGEIDENTIFIER","".concat(o[s.NUMERICIDENTIFIER],"|x|X|\\*")),c("XRANGEPLAIN","[v=\\s]*(".concat(o[s.XRANGEIDENTIFIER],")")+"(?:\\.(".concat(o[s.XRANGEIDENTIFIER],")")+"(?:\\.(".concat(o[s.XRANGEIDENTIFIER],")")+"(?:".concat(o[s.PRERELEASE],")?").concat(o[s.BUILD],"?")+")?)?"),c("XRANGEPLAINLOOSE","[v=\\s]*(".concat(o[s.XRANGEIDENTIFIERLOOSE],")")+"(?:\\.(".concat(o[s.XRANGEIDENTIFIERLOOSE],")")+"(?:\\.(".concat(o[s.XRANGEIDENTIFIERLOOSE],")")+"(?:".concat(o[s.PRERELEASELOOSE],")?").concat(o[s.BUILD],"?")+")?)?"),c("XRANGE","^".concat(o[s.GTLT],"\\s*").concat(o[s.XRANGEPLAIN],"$")),c("XRANGELOOSE","^".concat(o[s.GTLT],"\\s*").concat(o[s.XRANGEPLAINLOOSE],"$")),c("COERCE","(^|[^\\d])(\\d{1,".concat(r,"})")+"(?:\\.(\\d{1,".concat(r,"}))?")+"(?:\\.(\\d{1,".concat(r,"}))?")+"(?:$|[^\\d])"),c("COERCERTL",o[s.COERCE],!0),c("LONETILDE","(?:~>?)"),c("TILDETRIM","(\\s*)".concat(o[s.LONETILDE],"\\s+"),!0),t.tildeTrimReplace="$1~",c("TILDE","^".concat(o[s.LONETILDE]).concat(o[s.XRANGEPLAIN],"$")),c("TILDELOOSE","^".concat(o[s.LONETILDE]).concat(o[s.XRANGEPLAINLOOSE],"$")),c("LONECARET","(?:\\^)"),c("CARETTRIM","(\\s*)".concat(o[s.LONECARET],"\\s+"),!0),t.caretTrimReplace="$1^",c("CARET","^".concat(o[s.LONECARET]).concat(o[s.XRANGEPLAIN],"$")),c("CARETLOOSE","^".concat(o[s.LONECARET]).concat(o[s.XRANGEPLAINLOOSE],"$")),c("COMPARATORLOOSE","^".concat(o[s.GTLT],"\\s*(").concat(o[s.LOOSEPLAIN],")$|^$")),c("COMPARATOR","^".concat(o[s.GTLT],"\\s*(").concat(o[s.FULLPLAIN],")$|^$")),c("COMPARATORTRIM","(\\s*)".concat(o[s.GTLT],"\\s*(").concat(o[s.LOOSEPLAIN],"|").concat(o[s.XRANGEPLAIN],")"),!0),t.comparatorTrimReplace="$1$2$3",c("HYPHENRANGE","^\\s*(".concat(o[s.XRANGEPLAIN],")")+"\\s+-\\s+"+"(".concat(o[s.XRANGEPLAIN],")")+"\\s*$"),c("HYPHENRANGELOOSE","^\\s*(".concat(o[s.XRANGEPLAINLOOSE],")")+"\\s+-\\s+"+"(".concat(o[s.XRANGEPLAINLOOSE],")")+"\\s*$"),c("STAR","(<|>)?=?\\s*\\*"),c("GTE0","^\\s*>=\\s*0.0.0\\s*$"),c("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(25),i=n(103),a=n(29),o=n(21),s=n(373),u=n(28);function c(e,t,n,a){if(null==a&&(a=o.inferDtype(e)),"complex64"===a)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!o.isTypedArray(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){o.assertNonNegativeIntegerDimensions(t);var s=o.sizeFromShape(t),u=o.sizeFromShape(n);o.assert(s===u,(function(){return"Based on the provided shape, ["+t+"], the tensor should have "+s+" values but has "+u}));for(var c=0;c<n.length;++c){var l=n[c],f=c!==n.length-1||l!==o.sizeFromShape(t.slice(c));o.assert(n[c]===t[c]||!f,(function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+t+"). "}))}}return o.isTypedArray(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==a?o.toTypedArray(e,a,i.env().getBool("DEBUG")):o.flatten(e,[],!0),r.ENGINE.makeTensor(e,t,a)}function l(e,t){o.assertNonNull(e);var n=a.inferShape(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return c(e,null,n,t)}function f(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=f(e,"float32"),i=f(e,"float32");return s.complex(n,i)}var a=o.makeZerosTypedArray(o.sizeFromShape(e),t);return r.ENGINE.makeTensor(a,e,t)}t.tensor=function(e,t,n){return c(e,t,a.inferShape(e,n),n)},t.scalar=function(e,t){if((o.isTypedArray(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&o.isTypedArray(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return c(e,[],[],t)},t.tensor1d=l,t.tensor2d=function(e,t,n){if(o.assertNonNull(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=a.inferShape(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return c(e,t,r,n)},t.tensor3d=function(e,t,n){if(o.assertNonNull(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=a.inferShape(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return c(e,t,r,n)},t.tensor4d=function(e,t,n){if(o.assertNonNull(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var r=a.inferShape(e,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return c(e,t,r,n)},t.tensor5d=function(e,t,n){if(o.assertNonNull(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var r=a.inferShape(e,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return c(e,t,r,n)},t.tensor6d=function(e,t,n){if(o.assertNonNull(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var r=a.inferShape(e,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return c(e,t=t||r,r,n)},t.variable=function(e,t,n,i){return void 0===t&&(t=!0),r.ENGINE.makeVariable(e,t,n,i)},t.ones=function e(t,n){if(void 0===n&&(n="float32"),"complex64"===n){var i=e(t,"float32"),a=f(t,"float32");return s.complex(i,a)}var u=o.makeOnesTypedArray(o.sizeFromShape(t),n);return r.ENGINE.makeTensor(u,t,n)},t.zeros=f,t.fill=function(e,t,n){return r.ENGINE.runKernelFunc((function(r){return r.fill(e,t,n)}),{})},t.linspace=function(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");return r.ENGINE.runKernelFunc((function(r){return r.linspace(e,t,n)}),{})},t.range=function(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r="float32"),0===n)throw new Error("Cannot have a step of zero");if(e===t||e<t&&n<0||t<e&&n>1)return f([0],r);var i=Math.abs(Math.ceil((t-e)/n)),a=o.makeZerosTypedArray(i,r);t<e&&1===n&&(n=-1),a[0]=e;for(var s=1;s<a.length;s++)a[s]=a[s-1]+n;return l(a,r)},t.onesLike=u.op({onesLike_:function(e){var n=a.convertToTensor(e,"x","onesLike");if("complex64"===n.dtype){var i=t.onesLike(s.real(n)),o=t.zerosLike(s.imag(n));return s.complex(i,o)}return r.ENGINE.runKernelFunc((function(e){return e.onesLike(n)}),{x:n},(function(e,n){return{x:function(){return t.zerosLike(e)}}}),"OnesLike")}}),t.zerosLike=u.op({zerosLike_:function(e){var n=a.convertToTensor(e,"x","zerosLike");return r.ENGINE.runKernelFunc((function(e){return e.zerosLike(n)}),{x:n},(function(e,n){return{x:function(){return t.zerosLike(e)}}}),"ZerosLike")}})},function(e,t,n){"use strict";(function(e){var r=n(394),i=n(393),a=n(392);function o(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(o()<t)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=u.prototype:(null===e&&(e=new u(t)),e.length=t),e}function u(e,t,n){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return f(this,e)}return c(this,e,t,n)}function c(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r),u.TYPED_ARRAY_SUPPORT?(e=t).__proto__=u.prototype:e=d(e,t),e}(e,t,n,r):"string"==typeof t?function(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!u.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|p(t,n),i=(e=s(e,r)).write(t,n);return i!==r&&(e=e.slice(0,i)),e}(e,t,n):function(e,t){if(u.isBuffer(t)){var n=0|h(t.length);return 0===(e=s(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||function(e){return e!=e}(t.length)?s(e,0):d(e,t);if("Buffer"===t.type&&a(t.data))return d(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function f(e,t){if(l(t),e=s(e,t<0?0:0|h(t)),!u.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function d(e,t){var n=t.length<0?0:0|h(t.length);e=s(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function h(e){if(e>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|e}function p(e,t){if(u.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return z(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return U(e).length;default:if(r)return z(e).length;t=(""+t).toLowerCase(),r=!0}}function m(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function v(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=u.from(t,r)),u.isBuffer(t))return 0===t.length?-1:g(e,t,n,r,i);if("number"==typeof t)return t&=255,u.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):g(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function g(e,t,n,r,i){var a,o=1,s=e.length,u=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;o=2,s/=2,u/=2,n/=2}function c(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){var l=-1;for(a=n;a<s;a++)if(c(e,a)===c(t,-1===l?0:a-l)){if(-1===l&&(l=a),a-l+1===u)return l*o}else-1!==l&&(a-=a-l),l=-1}else for(n+u>s&&(n=s-u),a=n;a>=0;a--){for(var f=!0,d=0;d<u;d++)if(c(e,a+d)!==c(t,d)){f=!1;break}if(f)return a}return-1}function y(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var a=t.length;if(a%2!=0)throw new TypeError("Invalid hex string");r>a/2&&(r=a/2);for(var o=0;o<r;++o){var s=parseInt(t.substr(2*o,2),16);if(isNaN(s))return o;e[n+o]=s}return o}function b(e,t,n,r){return W(z(t,e.length-n),e,n,r)}function x(e,t,n,r){return W(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function w(e,t,n,r){return x(e,t,n,r)}function _(e,t,n,r){return W(U(t),e,n,r)}function k(e,t,n,r){return W(function(e,t){for(var n,r,i,a=[],o=0;o<e.length&&!((t-=2)<0);++o)r=(n=e.charCodeAt(o))>>8,i=n%256,a.push(i),a.push(r);return a}(t,e.length-n),e,n,r)}function E(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function S(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var a,o,s,u,c=e[i],l=null,f=c>239?4:c>223?3:c>191?2:1;if(i+f<=n)switch(f){case 1:c<128&&(l=c);break;case 2:128==(192&(a=e[i+1]))&&(u=(31&c)<<6|63&a)>127&&(l=u);break;case 3:a=e[i+1],o=e[i+2],128==(192&a)&&128==(192&o)&&(u=(15&c)<<12|(63&a)<<6|63&o)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:a=e[i+1],o=e[i+2],s=e[i+3],128==(192&a)&&128==(192&o)&&128==(192&s)&&(u=(15&c)<<18|(63&a)<<12|(63&o)<<6|63&s)>65535&&u<1114112&&(l=u)}null===l?(l=65533,f=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),i+=f}return function(e){var t=e.length;if(t<=C)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=C));return n}(r)}t.Buffer=u,t.SlowBuffer=function(e){return+e!=e&&(e=0),u.alloc(+e)},t.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=o(),u.poolSize=8192,u._augment=function(e){return e.__proto__=u.prototype,e},u.from=function(e,t,n){return c(null,e,t,n)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(e,t,n){return function(e,t,n,r){return l(t),t<=0?s(e,t):void 0!==n?"string"==typeof r?s(e,t).fill(n,r):s(e,t).fill(n):s(e,t)}(null,e,t,n)},u.allocUnsafe=function(e){return f(null,e)},u.allocUnsafeSlow=function(e){return f(null,e)},u.isBuffer=function(e){return!(null==e||!e._isBuffer)},u.compare=function(e,t){if(!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,a=Math.min(n,r);i<a;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!a(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=u.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var o=e[n];if(!u.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},u.byteLength=p,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},u.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?S(this,0,e):function(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return D(this,t,n);case"utf8":case"utf-8":return S(this,t,n);case"ascii":return A(this,t,n);case"latin1":case"binary":return O(this,t,n);case"base64":return E(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return T(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}.apply(this,arguments)},u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},u.prototype.compare=function(e,t,n,r,i){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var a=(i>>>=0)-(r>>>=0),o=(n>>>=0)-(t>>>=0),s=Math.min(a,o),c=this.slice(r,i),l=e.slice(t,n),f=0;f<s;++f)if(c[f]!==l[f]){a=c[f],o=l[f];break}return a<o?-1:o<a?1:0},u.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},u.prototype.indexOf=function(e,t,n){return v(this,e,t,n,!0)},u.prototype.lastIndexOf=function(e,t,n){return v(this,e,t,n,!1)},u.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var a=!1;;)switch(r){case"hex":return y(this,e,t,n);case"utf8":case"utf-8":return b(this,e,t,n);case"ascii":return x(this,e,t,n);case"latin1":case"binary":return w(this,e,t,n);case"base64":return _(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,e,t,n);default:if(a)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),a=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var C=4096;function A(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function O(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function D(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",a=t;a<n;++a)i+=L(e[a]);return i}function T(e,t,n){for(var r=e.slice(t,n),i="",a=0;a<r.length;a+=2)i+=String.fromCharCode(r[a]+256*r[a+1]);return i}function j(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function M(e,t,n,r,i,a){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function F(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,a=Math.min(e.length-n,2);i<a;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function I(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,a=Math.min(e.length-n,4);i<a;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function N(e,t,n,r,i,a){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function R(e,t,n,r,a){return a||N(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function P(e,t,n,r,a){return a||N(e,0,n,8),i.write(e,t,n,r,52,8),n+8}u.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),u.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=u.prototype;else{var i=t-e;n=new u(i,void 0);for(var a=0;a<i;++a)n[a]=this[a+e]}return n},u.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||j(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r},u.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||j(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},u.prototype.readUInt8=function(e,t){return t||j(e,1,this.length),this[e]},u.prototype.readUInt16LE=function(e,t){return t||j(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUInt16BE=function(e,t){return t||j(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUInt32LE=function(e,t){return t||j(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUInt32BE=function(e,t){return t||j(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||j(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},u.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||j(e,t,this.length);for(var r=t,i=1,a=this[e+--r];r>0&&(i*=256);)a+=this[e+--r]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*t)),a},u.prototype.readInt8=function(e,t){return t||j(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){t||j(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt16BE=function(e,t){t||j(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt32LE=function(e,t){return t||j(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return t||j(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return t||j(e,4,this.length),i.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return t||j(e,4,this.length),i.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return t||j(e,8,this.length),i.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return t||j(e,8,this.length),i.read(this,e,!1,52,8)},u.prototype.writeUIntLE=function(e,t,n,r){e=+e,t|=0,n|=0,r||M(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,a=0;for(this[t]=255&e;++a<n&&(i*=256);)this[t+a]=e/i&255;return t+n},u.prototype.writeUIntBE=function(e,t,n,r){e=+e,t|=0,n|=0,r||M(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+n},u.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,1,255,0),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},u.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):F(this,e,t,!0),t+2},u.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):F(this,e,t,!1),t+2},u.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):I(this,e,t,!0),t+4},u.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):I(this,e,t,!1),t+4},u.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);M(this,e,t,n,i-1,-i)}var a=0,o=1,s=0;for(this[t]=255&e;++a<n&&(o*=256);)e<0&&0===s&&0!==this[t+a-1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+n},u.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);M(this,e,t,n,i-1,-i)}var a=n-1,o=1,s=0;for(this[t+a]=255&e;--a>=0&&(o*=256);)e<0&&0===s&&0!==this[t+a+1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+n},u.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,1,127,-128),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):F(this,e,t,!0),t+2},u.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):F(this,e,t,!1),t+2},u.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):I(this,e,t,!0),t+4},u.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):I(this,e,t,!1),t+4},u.prototype.writeFloatLE=function(e,t,n){return R(this,e,t,!0,n)},u.prototype.writeFloatBE=function(e,t,n){return R(this,e,t,!1,n)},u.prototype.writeDoubleLE=function(e,t,n){return P(this,e,t,!0,n)},u.prototype.writeDoubleBE=function(e,t,n){return P(this,e,t,!1,n)},u.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,a=r-n;if(this===e&&n<t&&t<r)for(i=a-1;i>=0;--i)e[i+t]=this[i+n];else if(a<1e3||!u.TYPED_ARRAY_SUPPORT)for(i=0;i<a;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+a),t);return a},u.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!u.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var a;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(a=t;a<n;++a)this[a]=e;else{var o=u.isBuffer(e)?e:z(new u(e,r).toString()),s=o.length;for(a=0;a<n-t;++a)this[a+t]=o[a%s]}return this};var B=/[^+\/0-9A-Za-z-_]/g;function L(e){return e<16?"0"+e.toString(16):e.toString(16)}function z(e,t){var n;t=t||1/0;for(var r=e.length,i=null,a=[],o=0;o<r;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&a.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&a.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;a.push(n)}else if(n<2048){if((t-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return a}function U(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(B,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function W(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}}).call(this,n(59))},function(e,t,n){var r=n(38);e.exports=function(e,t,n){for(var i in t)r(e,i,t[i],n);return e}},function(e,t){e.exports=function(e,t,n,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(n+": incorrect invocation!");return e}},function(e,t,n){"use strict";var r=n(16),i=n(26),a=n(27),o=n(19)("species");e.exports=function(e){var t=r[e];a&&t&&!t[o]&&i.f(t,o,{configurable:!0,get:function(){return this}})}},function(e,t){e.exports={}},function(e,t,n){var r=n(8),i=n(61),a=n(15),o=n(169),s="["+o+"]",u=RegExp("^"+s+s+"*"),c=RegExp(s+s+"*$"),l=function(e,t,n){var i={},s=a((function(){return!!o[e]()||"\u200b\x85"!="\u200b\x85"[e]()})),u=i[e]=s?t(f):o[e];n&&(i[n]=u),r(r.P+r.F*s,"String",i)},f=l.trim=function(e,t){return e=String(i(e)),1&t&&(e=e.replace(u,"")),2&t&&(e=e.replace(c,"")),e};e.exports=l},function(e,t,n){var r=n(26).f,i=n(43),a=n(19)("toStringTag");e.exports=function(e,t,n){e&&!i(e=n?e:e.prototype,a)&&r(e,a,{configurable:!0,value:t})}},function(e,t,n){"use strict";var r,i="object"==typeof Reflect?Reflect:null,a=i&&"function"==typeof i.apply?i.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};r=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(e,t){return new Promise((function(n,r){function i(n){e.removeListener(t,a),r(n)}function a(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}v(e,t,a,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&v(e,"error",t,n)}(e,i,{once:!0})}))},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var u=10;function c(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function f(e,t,n,r){var i,a,o;if(c(n),void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),a=e._events),o=a[t]),void 0===o)o=a[t]=n,++e._eventsCount;else if("function"==typeof o?o=a[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),(i=l(e))>0&&o.length>i&&!o.warned){o.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=e,s.type=t,s.count=o.length,function(e){console&&console.warn&&console.warn(e)}(s)}return e}function d(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=function(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}.bind(r);return i.listener=n,r.wrapFn=i,i}function h(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):m(i,i.length)}function p(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function m(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function v(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(a){r.once&&e.removeEventListener(t,i),n(a)}))}}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");u=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return l(this)},s.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var s=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw s.context=o,s}var u=i[e];if(void 0===u)return!1;if("function"==typeof u)a(u,this,t);else{var c=u.length,l=m(u,c);for(n=0;n<c;++n)a(l[n],this,t)}return!0},s.prototype.addListener=function(e,t){return f(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return f(this,e,t,!0)},s.prototype.once=function(e,t){return c(t),this.on(e,d(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return c(t),this.prependListener(e,d(this,e,t)),this},s.prototype.removeListener=function(e,t){var n,r,i,a,o;if(c(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,a=n.length-1;a>=0;a--)if(n[a]===t||n[a].listener===t){o=n[a].listener,i=a;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,o||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,a=Object.keys(n);for(r=0;r<a.length;++r)"removeListener"!==(i=a[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},s.prototype.listeners=function(e){return h(this,e,!0)},s.prototype.rawListeners=function(e){return h(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},s.prototype.listenerCount=p,s.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return o})),n.d(t,"d",(function(){return s}));var r,i,a,o,s,u=n(246);!function(e){r=Object(u.a)(e),i=r.format,a=r.parse,o=r.utcFormat,s=r.utcParse}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return"string"==typeof e&&r.test(e)};var r=/-webkit-|-moz-|-ms-/;e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.compose=t.merge=t.$=t.style=t.presets=t.keyframes=t.fontFace=t.insertGlobal=t.insertRule=t.plugins=t.styleSheet=void 0,t.speedy=function(e){return f.speedy(e)},t.simulations=function(){v=!(arguments.length>0&&void 0!==arguments[0]&&!arguments[0])},t.simulate=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(t=(0,o.default)(t))?v?t.reduce((function(e,t){return e["data-simulate-"+x(t)]="",e}),{}):(g||(console.warn("can't simulate without once calling simulations(true)"),g=!0),h||p||y||(console.warn("don't use simulation outside dev"),y=!0),{}):{}},t.cssLabels=function(e){b=!!e},t.isLikeRule=_,t.idFor=k,t.css=V,t.rehydrate=function(e){(0,r.default)(T,e.reduce((function(e,t){return e[t]=!0,e}),{}))},t.flush=function(){T=f.inserted={},j=f.registered={},F={},f.flush(),f.inject()},t.select=q,t.parent=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return V(l({},e+" &",n))},t.media=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return V(l({},"@media "+e,n))},t.pseudo=H,t.active=function(e){return H(":active",e)},t.any=function(e){return H(":any",e)},t.checked=function(e){return H(":checked",e)},t.disabled=function(e){return H(":disabled",e)},t.empty=function(e){return H(":empty",e)},t.enabled=function(e){return H(":enabled",e)},t._default=function(e){return H(":default",e)},t.first=function(e){return H(":first",e)},t.firstChild=function(e){return H(":first-child",e)},t.firstOfType=function(e){return H(":first-of-type",e)},t.fullscreen=function(e){return H(":fullscreen",e)},t.focus=function(e){return H(":focus",e)},t.hover=function(e){return H(":hover",e)},t.indeterminate=function(e){return H(":indeterminate",e)},t.inRange=function(e){return H(":in-range",e)},t.invalid=function(e){return H(":invalid",e)},t.lastChild=function(e){return H(":last-child",e)},t.lastOfType=function(e){return H(":last-of-type",e)},t.left=function(e){return H(":left",e)},t.link=function(e){return H(":link",e)},t.onlyChild=function(e){return H(":only-child",e)},t.onlyOfType=function(e){return H(":only-of-type",e)},t.optional=function(e){return H(":optional",e)},t.outOfRange=function(e){return H(":out-of-range",e)},t.readOnly=function(e){return H(":read-only",e)},t.readWrite=function(e){return H(":read-write",e)},t.required=function(e){return H(":required",e)},t.right=function(e){return H(":right",e)},t.root=function(e){return H(":root",e)},t.scope=function(e){return H(":scope",e)},t.target=function(e){return H(":target",e)},t.valid=function(e){return H(":valid",e)},t.visited=function(e){return H(":visited",e)},t.dir=function(e,t){return H(":dir("+e+")",t)},t.lang=function(e,t){return H(":lang("+e+")",t)},t.not=function(e,t){var n=e.split(",").map((function(e){return e.trim()})).map((function(e){return":not("+e+")"}));return 1===n.length?H(":not("+e+")",t):q(n.join(""),t)},t.nthChild=function(e,t){return H(":nth-child("+e+")",t)},t.nthLastChild=function(e,t){return H(":nth-last-child("+e+")",t)},t.nthLastOfType=function(e,t){return H(":nth-last-of-type("+e+")",t)},t.nthOfType=function(e,t){return H(":nth-of-type("+e+")",t)},t.after=function(e){return H("::after",e)},t.before=function(e){return H("::before",e)},t.firstLetter=function(e){return H("::first-letter",e)},t.firstLine=function(e){return H("::first-line",e)},t.selection=function(e){return H("::selection",e)},t.backdrop=function(e){return H("::backdrop",e)},t.placeholder=function(e){return V({"::placeholder":e})},t.cssFor=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(t=(0,o.default)(t))?t.map((function(e){var t={label:[]};return P(t,{src:e}),D(w(t),O(t)).join("")})).join(""):""},t.attribsFor=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(t=(0,o.default)(t))?t.map((function(e){k(e);var t=Object.keys(e)[0];return t+'="'+(e[t]||"")+'"'})).join(" "):""};var r=c(n(139)),i=n(320),a=n(201),o=c(n(311)),s=n(310),u=c(n(293));function c(e){return e&&e.__esModule?e:{default:e}}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var f=t.styleSheet=new i.StyleSheet;f.inject();var d=t.plugins=f.plugins=new s.PluginSet([s.prefixes,s.contentWrap,s.fallbacks]);d.media=new s.PluginSet,d.fontFace=new s.PluginSet,d.keyframes=new s.PluginSet([s.prefixes,s.fallbacks]);var h=!1,p=!1,m="undefined"!=typeof window,v=h,g=!1,y=!1,b=h;function x(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.toLowerCase().replace(/[^a-z0-9]/g,t)}function w(e){var t=JSON.stringify(e),n=(0,u.default)(t).toString(36);return e.label&&e.label.length>0&&h?x(e.label.join("."),"-")+"-"+n:n}function _(e){var t=Object.keys(e).filter((function(e){return"toString"!==e}));return 1===t.length&&!!/data\-css\-([a-zA-Z0-9\-_]+)/.exec(t[0])}function k(e){var t=Object.keys(e).filter((function(e){return"toString"!==e}));if(1!==t.length)throw new Error("not a rule");var n=/data\-css\-([a-zA-Z0-9\-_]+)/.exec(t[0]);if(!n)throw new Error("not a rule");return n[1]}var E=/[(),]|"(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\//g;function S(e){if(-1===e.indexOf(","))return[e];for(var t,n=[],r=[],i=0;t=E.exec(e);)switch(t[0]){case"(":i++;break;case")":i--;break;case",":if(i)break;n.push(t.index)}for(t=n.length;t--;)r.unshift(e.slice(n[t]+1)),e=e.slice(0,n[t]);return r.unshift(e),r}function C(e,t){if(!e)return t.replace(/\&/g,"");if(!t)return".css-"+e+",[data-css-"+e+"]";var n=S(t).map((function(t){return t.indexOf("&")>=0?[t.replace(/\&/gm,".css-"+e),t.replace(/\&/gm,"[data-css-"+e+"]")].join(","):".css-"+e+t+",[data-css-"+e+"]"+t})).join(",");return v&&/^\&\:/.exec(t)&&!/\s/.exec(t)&&(n+=",.css-"+e+"[data-simulate-"+x(t)+"],[data-css-"+e+"][data-simulate-"+x(t)+"]"),n}function A(e){var t=e.selector,n=e.style,r=d.transform({selector:t,style:n});return r.selector+"{"+(0,a.createMarkupForStyles)(r.style)+"}"}function O(e){var t=void 0,n=void 0,r=void 0,i=void 0;return Object.keys(e).forEach((function(a){a.indexOf("&")>=0?(n=n||{})[a]=e[a]:0===a.indexOf("@media")?(r=r||{})[a]=O(e[a]):0===a.indexOf("@supports")?(i=i||{})[a]=O(e[a]):"label"===a?e.label.length>0&&((t=t||{}).label=b?e.label.join("."):""):(t=t||{})[a]=e[a]})),{plain:t,selects:n,medias:r,supports:i}}function D(e,t){var n=[],r=t.plain,i=t.selects,a=t.medias,o=t.supports;return r&&n.push(A({style:r,selector:C(e)})),i&&Object.keys(i).forEach((function(t){return n.push(A({style:i[t],selector:C(e,t)}))})),a&&Object.keys(a).forEach((function(t){return n.push(t+"{"+D(e,a[t]).join("")+"}")})),o&&Object.keys(o).forEach((function(t){return n.push(t+"{"+D(e,o[t]).join("")+"}")})),n}var T=f.inserted={},j=f.registered={};function M(e){j[e.id]||(j[e.id]=e)}var F={};function I(e){if(M(e),function(e){if(!T[e.id]){T[e.id]=!0;var t=O(e.style),n=D(e.id,t);T[e.id]=!!m||n,n.forEach((function(e){return f.insert(e)}))}}(e),F[e.id])return F[e.id];var t=l({},"data-css-"+e.id,b&&e.label||"");return Object.defineProperty(t,"toString",{enumerable:!1,value:function(){return"css-"+e.id}}),F[e.id]=t,t}function N(e,t){var n=S(e).map((function(e){return e.indexOf("&")>=0?e:"&"+e}));return S(t).map((function(e){return e.indexOf("&")>=0?e:"&"+e})).reduce((function(e,t){return e.concat(n.map((function(e){return t.replace(/\&/g,e)})))}),[]).join(",")}var R={"::placeholder":["::-webkit-input-placeholder","::-moz-placeholder","::-ms-input-placeholder"],":fullscreen":[":-webkit-full-screen",":-moz-full-screen",":-ms-fullscreen"]};function P(e,t){var n=t.selector,r=void 0===n?"":n,i=t.mq,a=void 0===i?"":i,s=t.supp,u=void 0===s?"":s,c=t.src,l=void 0===c?{}:c;Array.isArray(l)||(l=[l]),(l=function e(t){for(var n=[],r=0;r<t.length;r++)n=Array.isArray(t[r])?n.concat(e(t[r])):n.concat(t[r]);return n}(l)).forEach((function(t){if(_(t)){var n=function(e){if(_(e)){var t=j[k(e)];if(null==t)throw new Error("[glamor] an unexpected rule cache miss occurred. This is probably a sign of multiple glamor instances in your app. See https://github.com/threepointone/glamor/issues/79");return t}return e}(t);if("css"!==n.type)throw new Error("cannot merge this rule");t=n.style}(t=(0,o.default)(t))&&t.composes&&P(e,{selector:r,mq:a,supp:u,src:t.composes}),Object.keys(t||{}).forEach((function(n){if(function(e){for(var t=[":",".","[",">"," "],n=!1,r=e.charAt(0),i=0;i<t.length;i++)if(r===t[i]){n=!0;break}return n||e.indexOf("&")>=0}(n))R[n]&&R[n].forEach((function(i){return P(e,{selector:N(r,i),mq:a,supp:u,src:t[n]})})),P(e,{selector:N(r,n),mq:a,supp:u,src:t[n]});else if(function(e){return 0===e.indexOf("@media")}(n))P(e,{selector:r,mq:function(e,t){return e?"@media "+e.substring(6)+" and "+t.substring(6):t}(a,n),supp:u,src:t[n]});else if(function(e){return 0===e.indexOf("@supports")}(n))P(e,{selector:r,mq:a,supp:function(e,t){return e?"@supports "+e.substring(9)+" and "+t.substring(9):t}(u,n),src:t[n]});else if("composes"===n);else{var i=e;u&&(i[u]=i[u]||{},i=i[u]),a&&(i[a]=i[a]||{},i=i[a]),r&&(i[r]=i[r]||{},i=i[r]),"label"===n?b&&(e.label=e.label.concat(t.label)):i[n]=t[n]}}))}))}function B(e){var t={label:[]};return P(t,{src:e}),I({id:w(t),style:t,label:b?t.label.join("."):"",type:"css"})}var L={};Object.defineProperty(L,"toString",{enumerable:!1,value:function(){return"css-nil"}});var z="undefined"!=typeof WeakMap?[L,new WeakMap,new WeakMap,new WeakMap]:[L],U=!1,W="undefined"!=typeof WeakMap?function(e){return function(t){if(z[t.length]){for(var n=z[t.length],r=0;r<t.length-1;)n.has(t[r])||n.set(t[r],new WeakMap),n=n.get(t[r]),r++;if(n.has(t[t.length-1])){var i=n.get(t[r]);if(j[i.toString().substring(4)])return i}}var a=e(t);if(z[t.length]){for(var o=0,s=z[t.length];o<t.length-1;)s=s.get(t[o]),o++;try{s.set(t[o],a)}catch(e){var u;h&&!U&&(U=!0,(u=console).warn.apply(u,["failed setting the WeakMap cache for args:"].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(t))),console.warn("this should NOT happen, please file a bug on the github repo."))}}return a}}(B):B;function V(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];if(t[0]&&t[0].length&&t[0].raw)throw new Error("you forgot to include glamor/babel in your babel plugins.");return(t=(0,o.default)(t))?W(t):L}V.insert=function(e){var t={id:w(e),css:e,type:"raw"};M(t),T[t.id]||(f.insert(t.css),T[t.id]=!!m||[t.css])},t.insertRule=V.insert,V.global=function(e,t){if(t=(0,o.default)(t))return V.insert(A({selector:e,style:t}))},t.insertGlobal=V.global,V.keyframes=function(e,t){t||(t=e,e="animation");var n={id:w({name:e,kfs:t=(0,o.default)(t)||{}}),type:"keyframes",name:e,keyframes:t};return M(n),function(e){if(!T[e.id]){var t=Object.keys(e.keyframes).map((function(t){var n=d.keyframes.transform({id:e.id,name:t,style:e.keyframes[t]});return n.name+"{"+(0,a.createMarkupForStyles)(n.style)+"}"})).join(""),n=["-webkit-","-moz-","-o-",""].map((function(n){return"@"+n+"keyframes "+e.name+"_"+e.id+"{"+t+"}"}));n.forEach((function(e){return f.insert(e)})),T[e.id]=!!m||n}}(n),e+"_"+n.id},V.fontFace=function(e){var t={id:w(e=(0,o.default)(e)),type:"font-face",font:e};return M(t),function(e){if(!T[e.id]){var t="@font-face{"+(0,a.createMarkupForStyles)(e.font)+"}";f.insert(t),T[e.id]=!!m||[t]}}(t),e.fontFamily},t.fontFace=V.fontFace,t.keyframes=V.keyframes,t.presets={mobile:"(min-width: 400px)",Mobile:"@media (min-width: 400px)",phablet:"(min-width: 550px)",Phablet:"@media (min-width: 550px)",tablet:"(min-width: 750px)",Tablet:"@media (min-width: 750px)",desktop:"(min-width: 1000px)",Desktop:"@media (min-width: 1000px)",hd:"(min-width: 1200px)",Hd:"@media (min-width: 1200px)"};var G=t.style=V;function q(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e?V(l({},e,n)):G(n)}function H(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return V(l({},e,n))}t.$=q,t.merge=V,t.compose=V},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return e.prototype.setPlatform=function(e,t){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},e.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+r+"."),this.set(e,r)}},e.prototype.get=function(e){return e in this.flags||(this.flags[e]=this.evaluateFlag(e)),this.flags[e]},e.prototype.getNumber=function(e){return this.get(e)},e.prototype.getBool=function(e){return this.get(e)},e.prototype.getFlags=function(){return this.flags},Object.defineProperty(e.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),e.prototype.set=function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)},e.prototype.evaluateFlag=function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},e.prototype.setFlags=function(e){this.flags=Object.assign({},e)},e.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},e.prototype.populateURLFlags=function(){var e=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var t=i(this.global.location.search);"tfjsflags"in t&&t.tfjsflags.split(",").forEach((function(t){var n=t.split(":"),r=n[0],i=n[1];e.urlFlags[r]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if(""+ +t===t)return+t;throw new Error("Could not parse value flag value "+t+" for flag "+e+".")}(r,i)}))}},e}();function i(e){var t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(t,n[0],n[1]),n.join("=")})),t}t.Environment=r,t.getQueryParams=i,t.env=function(){return t.ENV},t.ENV=null,t.setEnvironmentGlobal=function(e){t.ENV=e}},function(e,t,n){var r=n(14),i=n(55),a=n(19)("species");e.exports=function(e,t){var n,o=r(e).constructor;return void 0===o||void 0==(n=r(o)[a])?t:i(n)}},function(e,t,n){var r=n(62),i=n(19)("toStringTag"),a="Arguments"==r(function(){return arguments}());e.exports=function(e){var t,n,o;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),i))?n:a?r(t):"Object"==(o=r(t))&&"function"==typeof t.callee?"Arguments":o}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,n){var r=n(62);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},function(e,t,n){"use strict";var r=n(87);t.a=function(e){var t=e,n=e;function i(e,t,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){var a=r+i>>>1;n(e[a],t)<0?r=a+1:i=a}return r}return 1===e.length&&(t=function(t,n){return e(t)-n},n=function(e){return function(t,n){return Object(r.a)(e(t),n)}}(e)),{left:i,center:function(e,n,r,a){null==r&&(r=0),null==a&&(a=e.length);var o=i(e,n,r,a-1);return o>r&&t(e[o-1],n)>-t(e[o],n)?o-1:o},right:function(e,t,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){var a=r+i>>>1;n(e[a],t)>0?i=a:r=a+1}return r}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(50),i=n(247),a=n(102),o=n(46);t.table=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(t&&null==t.headers)throw new Error('Data to render must have a "headers" property');if(t&&null==t.values)throw new Error('Data to render must have a "values" property');var u=o.getDrawArea(e),c=Object.assign({},s,n),l=i.select(u).select("table.tf-table"),f=a.css({fontSize:c.fontSize||".875rem",width:"100%",maxWidth:"64rem",marginRight:"auto",marginLeft:"auto"});if(0===l.size()&&((l=i.select(u).append("table")).attr("class"," ".concat(f," tf-table")),l.append("thead").append("tr"),l.append("tbody")),1!==l.size())throw new Error("Error inserting table");var d=a.css({fontWeight:"600",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"rgba( 0, 0, 0, .2 )",textAlign:"left",paddingBottom:"1rem",paddingRight:"1rem",backgroundColor:"#fff"}),h=l.select("thead").select("tr").selectAll("th").data(t.headers),p=h.enter().append("th").attr("class","".concat(d));h.merge(p).html((function(e){return e})),h.exit().remove();var m=r.format(",.4~f"),v=l.select("tbody").selectAll("tr").data(t.values),g=v.enter().append("tr"),y=a.css({padding:"0.25rem",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"rgba( 0, 0, 0, .2 )"}),b=v.merge(g).selectAll("td").data((function(e){return e})),x=b.enter().append("td").attr("class","".concat(y));b.merge(x).html((function(e){return"number"==typeof e?m(e):e})),b.exit().remove(),v.exit().remove()};var s={fontSize:14}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=n(111);t.arrayStats=function(e){if(!Array.isArray(e))throw new Error("input must be an array");if(0===e.length)return{numVals:0,numNans:0,numZeros:0,max:void 0,min:void 0};for(var t=e.length,n=-1/0,r=1/0,i=0,a=0,o=0,s=0;s<t;s++){var u=e[s];u>n&&(n=u),u<r&&(r=u),0===u&&(i+=1),isNaN(u)?a+=1:isFinite(u)||(o+=1)}var c={numVals:t,numZeros:i,numNans:a,max:n,min:r,numInfs:o};return c.max===-1/0&&(c.max=NaN),c.min===1/0&&(c.min=NaN),c},t.tensorStats=function(e){return r(this,void 0,void 0,m().mark((function t(){var n,r,a,o,s;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=i.tidy((function(){var t=i.scalar(0,e.dtype);return[e.min(),e.max(),e.equal(t).sum()]})),r=f(n,3),a=r[0],o=r[1],s=r[2],t.abrupt("return",Promise.all([e.data(),a.data(),o.data(),s.data()]).then((function(e){for(var t=f(e,4),n=t[0],r=t[1],i=t[2],a=t[3],o=n.length,s=0,u=0,c=0;c<o;c++){var l=n[c];isNaN(l)?s+=1:isFinite(l)||(u+=1)}var d=r[0],h=i[0];return s===o&&(d=NaN,h=NaN),{numVals:o,numZeros:a[0],numNans:s,min:d,max:h,numInfs:u}})));case 2:case"end":return t.stop()}}),t)})))},t.confusionMatrix=function(e,t,n,o){return r(this,void 0,void 0,m().mark((function r(){var s,u,c;return m().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a.assert(1===e.rank,"labels must be a 1D tensor"),a.assert(1===t.rank,"predictions must be a 1D tensor"),a.assert(e.size===t.size,"labels and predictions must be the same length"),null!=o&&a.assert(o.size===t.size,"labels and predictions must be the same length"),s=e.cast("int32"),u=t.cast("int32"),null==n&&(n=i.tidy((function(){return i.maximum(s.max(),u.max()).cast("int32").dataSync()[0]+1}))),c=Promise.resolve(null),r.abrupt("return",(null!=o&&(c=o.data()),Promise.all([s.data(),u.data(),c]).then((function(e){for(var t=f(e,3),r=t[0],i=t[1],a=t[2],o=Array(n).fill(0),s=0;s<n;s++)o[s]=Array(n).fill(0);for(var u=0;u<r.length;u++){var c=r[u],l=i[u];o[c][l]+=null!=a?a[u]:1}return o}))));case 5:case"end":return r.stop()}}),r)})))},t.accuracy=function(e,t){return r(this,void 0,void 0,m().mark((function n(){var r,o,s;return m().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a.assertShapesMatch(e.shape,t.shape,"Error computing accuracy."),r=e.equal(t),o=r.mean(),n.next=5,o.data();case 5:return s=n.sent[0],n.abrupt("return",(i.dispose([r,o]),s));case 7:case"end":return n.stop()}}),n)})))},t.perClassAccuracy=function(e,t,n){return r(this,void 0,void 0,m().mark((function r(){return m().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(a.assert(1===e.rank,"labels must be a 1D tensor"),a.assert(1===t.rank,"predictions must be a 1D tensor"),a.assert(e.size===t.size,"labels and predictions must be the same length"),null==n&&(n=i.tidy((function(){return i.maximum(e.max(),t.max()).dataSync()[0]+1}))),Promise.all([e.data(),t.data()]).then((function(e){for(var t=f(e,2),r=t[0],i=t[1],a=Array(n).fill(0),o=Array(n).fill(0),s=0;s<r.length;s++){var u=r[s],c=i[s];a[u]+=1,u===c&&(o[u]+=1)}for(var l=[],d=0;d<a.length;d++)l.push({count:a[d],accuracy:0===a[d]?0:o[d]/a[d]});return l}))));case 1:case"end":return r.stop()}}),r)})))}},function(e,t,n){"use strict";function r(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function i(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}Object.defineProperty(t,"__esModule",{value:!0}),t.assert=r,t.assertShapesMatch=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";r(i(e,t),n+" Shapes ".concat(e," and ").concat(t," must match"))},t.arraysEqual=i,t.DECIMAL_PLACES_TO_CHECK=4},function(e,t,n){var r=n(47);e.exports=function(e,t,n){try{t=new r(t,n)}catch(e){return!1}return t.test(e)}},function(e,t,n){var r=Symbol("SemVer ANY"),i=function(){"use strict";function e(t,n){if(v(this,e),n=a(n),t instanceof e){if(t.loose===!!n.loose)return t;t=t.value}l("comparator",t,n),this.options=n,this.loose=!!n.loose,this.parse(t),this.semver===r?this.value="":this.value=this.operator+this.semver.version,l("comp",this)}return g(e,[{key:"parse",value:function(e){var t=this.options.loose?s[u.COMPARATORLOOSE]:s[u.COMPARATOR],n=e.match(t);if(!n)throw new TypeError("Invalid comparator: ".concat(e));this.operator=void 0!==n[1]?n[1]:"","="===this.operator&&(this.operator=""),n[2]?this.semver=new f(n[2],this.options.loose):this.semver=r}},{key:"toString",value:function(){return this.value}},{key:"test",value:function(e){if(l("Comparator.test",e,this.options.loose),this.semver===r||e===r)return!0;if("string"==typeof e)try{e=new f(e,this.options)}catch(e){return!1}return c(e,this.operator,this.semver,this.options)}},{key:"intersects",value:function(t,n){if(!(t instanceof e))throw new TypeError("a Comparator is required");if(n&&"object"==typeof n||(n={loose:!!n,includePrerelease:!1}),""===this.operator)return""===this.value||new d(t.value,n).test(this.value);if(""===t.operator)return""===t.value||new d(this.value,n).test(t.semver);var r=!(">="!==this.operator&&">"!==this.operator||">="!==t.operator&&">"!==t.operator),i=!("<="!==this.operator&&"<"!==this.operator||"<="!==t.operator&&"<"!==t.operator),a=this.semver.version===t.semver.version,o=!(">="!==this.operator&&"<="!==this.operator||">="!==t.operator&&"<="!==t.operator),s=c(this.semver,"<",t.semver,n)&&(">="===this.operator||">"===this.operator)&&("<="===t.operator||"<"===t.operator),u=c(this.semver,">",t.semver,n)&&("<="===this.operator||"<"===this.operator)&&(">="===t.operator||">"===t.operator);return r||i||a&&o||s||u}}],[{key:"ANY",get:function(){return r}}]),e}();e.exports=i;var a=n(115),o=n(90),s=o.re,u=o.t,c=n(203),l=n(116),f=n(32),d=n(47)},function(e,t,n){var r=n(48);e.exports=function(e,t,n){return r(e,t,n)>0}},function(e,t){var n=["includePrerelease","loose","rtl"];e.exports=function(e){return e?"object"!=typeof e?{loose:!0}:n.filter((function(t){return e[t]})).reduce((function(e,t){return e[t]=!0,e}),{}):{}}},function(e,t,n){(function(t){var n="object"==typeof t&&t.env&&t.env.NODE_DEBUG&&/\bsemver\b/i.test(t.env.NODE_DEBUG)?function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=console).error.apply(e,["SEMVER"].concat(n))}:function(){};e.exports=n}).call(this,n(75))},function(e,t){var n=Number.MAX_SAFE_INTEGER||9007199254740991;e.exports={SEMVER_SPEC_VERSION:"2.0.0",MAX_LENGTH:256,MAX_SAFE_INTEGER:n,MAX_SAFE_COMPONENT_LENGTH:16}},function(e,t,n){for(var r,i=n(16),a=n(42),o=n(84),s=o("typed_array"),u=o("view"),c=!(!i.ArrayBuffer||!i.DataView),l=c,f=0,d="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");f<9;)(r=i[d[f++]])?(a(r.prototype,s,!0),a(r.prototype,u,!0)):l=!1;e.exports={ABV:c,CONSTR:l,TYPED:s,VIEW:u}},function(e,t,n){"use strict";var r=n(16),i=n(8),a=n(38),o=n(93),s=n(65),u=n(121),c=n(94),l=n(13),f=n(15),d=n(125),h=n(98),p=n(168);e.exports=function(e,t,n,m,v,g){var y=r[e],b=y,x=v?"set":"add",w=b&&b.prototype,_={},k=function(e){var t=w[e];a(w,e,"delete"==e||"has"==e?function(e){return!(g&&!l(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return g&&!l(e)?void 0:t.call(this,0===e?0:e)}:"add"==e?function(e){return t.call(this,0===e?0:e),this}:function(e,n){return t.call(this,0===e?0:e,n),this})};if("function"==typeof b&&(g||w.forEach&&!f((function(){(new b).entries().next()})))){var E=new b,S=E[x](g?{}:-0,1)!=E,C=f((function(){E.has(1)})),A=d((function(e){new b(e)})),O=!g&&f((function(){for(var e=new b,t=5;t--;)e[x](t,t);return!e.has(-0)}));A||((b=t((function(t,n){c(t,b,e);var r=p(new y,t,b);return void 0!=n&&u(n,v,r[x],r),r}))).prototype=w,w.constructor=b),(C||O)&&(k("delete"),k("has"),v&&k("get")),(O||S)&&k(x),g&&w.clear&&delete w.clear}else b=m.getConstructor(t,e,v,x),o(b.prototype,n),s.NEED=!0;return h(b,e),_[e]=b,i(i.G+i.W+i.F*(b!=y),_),g||m.setStrong(b,e,v),b}},function(e,t,n){var r=n(16).navigator;e.exports=r&&r.userAgent||""},function(e,t,n){var r=n(56),i=n(225),a=n(159),o=n(14),s=n(22),u=n(157),c={},l={};(t=e.exports=function(e,t,n,f,d){var h,p,m,v,g=d?function(){return e}:u(e),y=r(n,f,t?2:1),b=0;if("function"!=typeof g)throw TypeError(e+" is not iterable!");if(a(g)){for(h=s(e.length);h>b;b++)if((v=t?y(o(p=e[b])[0],p[1]):y(e[b]))===c||v===l)return v}else for(m=g.call(e);!(p=m.next()).done;)if((v=i(m,y,p.value,t))===c||v===l)return v}).BREAK=c,t.RETURN=l},function(e,t,n){"use strict";n(220);var r=n(38),i=n(42),a=n(15),o=n(61),s=n(19),u=n(154),c=s("species"),l=!a((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})),f=function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2===n.length&&"a"===n[0]&&"b"===n[1]}();e.exports=function(e,t,n){var d=s(e),h=!a((function(){var t={};return t[d]=function(){return 7},7!=""[e](t)})),p=h?!a((function(){var t=!1,n=/a/;return n.exec=function(){return t=!0,null},"split"===e&&(n.constructor={},n.constructor[c]=function(){return n}),n[d](""),!t})):void 0;if(!h||!p||"replace"===e&&!l||"split"===e&&!f){var m=/./[d],v=n(o,d,""[e],(function(e,t,n,r,i){return t.exec===u?h&&!i?{done:!0,value:m.call(t,n,r)}:{done:!0,value:e.call(n,t,r)}:{done:!1}})),g=v[0],y=v[1];r(String.prototype,e,g),i(RegExp.prototype,d,2==t?function(e,t){return y.call(e,this,t)}:function(e){return y.call(e,this)})}}},function(e,t,n){"use strict";var r=n(105),i=RegExp.prototype.exec;e.exports=function(e,t){var n=e.exec;if("function"==typeof n){var a=n.call(e,t);if("object"!=typeof a)throw new TypeError("RegExp exec method returned something other than an Object or null");return a}if("RegExp"!==r(e))throw new TypeError("RegExp#exec called on incompatible receiver");return i.call(e,t)}},function(e,t,n){"use strict";var r=n(14);e.exports=function(){var e=r(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},function(e,t,n){var r=n(19)("iterator"),i=!1;try{var a=[7][r]();a.return=function(){i=!0},Array.from(a,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var n=!1;try{var a=[7],o=a[r]();o.next=function(){return{done:n=!0}},a[r]=function(){return o},e(a)}catch(e){}return n}},function(e,t,n){var r=n(62);e.exports=Array.isArray||function(e){return"Array"==r(e)}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,n){var r=n(41),i=n(22),a=n(81);e.exports=function(e){return function(t,n,o){var s,u=r(t),c=i(u.length),l=a(o,c);if(e&&n!=n){for(;c>l;)if((s=u[l++])!=s)return!0}else for(;c>l;l++)if((e||l in u)&&u[l]===n)return e||l||0;return!e&&-1}}},function(e,t,n){var r=n(24),i=n(16),a=i["__core-js_shared__"]||(i["__core-js_shared__"]={});(e.exports=function(e,t){return a[e]||(a[e]=void 0!==t?t:{})})("versions",[]).push({version:r.version,mode:n(83)?"pure":"global",copyright:"\xa9 2020 Denis Pushkarev (zloirock.ru)"})},function(e,t,n){"use strict";n.r(t),function(e,r){n.d(t,"array",(function(){return Y})),n.d(t,"Dataset",(function(){return X})),n.d(t,"zip",(function(){return $})),n.d(t,"CSVDataset",(function(){return ie})),n.d(t,"TextLineDataset",(function(){return Z})),n.d(t,"csv",(function(){return be})),n.d(t,"func",(function(){return xe})),n.d(t,"generator",(function(){return we})),n.d(t,"microphone",(function(){return ke})),n.d(t,"webcam",(function(){return _e})),n.d(t,"FileDataSource",(function(){return ge})),n.d(t,"URLDataSource",(function(){return ye})),n.d(t,"version_data",(function(){return Ee}));var i=n(0),a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function o(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function s(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))}function u(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function c(e,t){return e(t={exports:{}},t.exports),t.exports}"undefined"!=typeof window?window:void 0!==e||"undefined"!=typeof self&&self;var l=c((function(e){!function(e,t,n){function r(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function i(e,t){var n=new function(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}(e),i=t&&t.state,a=n.next;return a.int32=function(){return 4294967296*n.next()|0},a.double=function(){return a()+11102230246251565e-32*(2097152*a()|0)},a.quick=a,i&&("object"==typeof i&&r(i,n),a.state=function(){return r(n,{})}),a}t&&t.exports?t.exports=i:this.alea=i}(0,e)})),f=c((function(e){!function(e,t,n){function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function i(e,t){var n=new function(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}(e),i=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,i&&("object"==typeof i&&r(i,n),a.state=function(){return r(n,{})}),a}t&&t.exports?t.exports=i:this.xor128=i}(0,e)})),d=c((function(e){!function(e,t,n){function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function i(e,t){var n=new function(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}(e),i=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,i&&("object"==typeof i&&r(i,n),a.state=function(){return r(n,{})}),a}t&&t.exports?t.exports=i:this.xorwow=i}(0,e)})),h=c((function(e){!function(e,t,n){function r(e,t){return t.x=e.x.slice(),t.i=e.i,t}function i(e,t){null==e&&(e=+new Date);var n=new function(e){var t=this;t.next=function(){var e,n,r=t.x,i=t.i;return e=r[i],n=(e^=e>>>7)^e<<24,n^=(e=r[i+1&7])^e>>>10,n^=(e=r[i+3&7])^e>>>3,n^=(e=r[i+4&7])^e<<7,e=r[i+7&7],n^=(e^=e<<13)^e<<9,r[i]=n,t.i=i+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}(e),i=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,i&&(i.x&&r(i,n),a.state=function(){return r(n,{})}),a}t&&t.exports?t.exports=i:this.xorshift7=i}(0,e)})),p=c((function(e){!function(e,t,n){function r(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function i(e,t){null==e&&(e=+new Date);var n=new function(e){var t=this;t.next=function(){var e,n,r=t.w,i=t.X,a=t.i;return t.w=r=r+1640531527|0,n=i[a+34&127],e=i[a=a+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=i[a]=n^e,t.i=a,n+(r^r>>>16)|0},function(e,t){var n,r,i,a,o,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),i=0,a=-32;a<u;++a)t&&(r^=t.charCodeAt((a+32)%t.length)),0===a&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,a>=0&&(o=o+1640531527|0,i=0==(n=s[127&a]^=r+o)?i+1:0);for(i>=128&&(s[127&(t&&t.length||0)]=-1),i=127,a=512;a>0;--a)r=s[i+34&127],n=s[i=i+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[i]=r^n;e.w=o,e.X=s,e.i=i}(t,e)}(e),i=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,i&&(i.X&&r(i,n),a.state=function(){return r(n,{})}),a}t&&t.exports?t.exports=i:this.xor4096=i}(0,e)})),m=c((function(e){!function(e,t,n){function r(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function i(e,t){var n=new function(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,i=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^i,i=i-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^i,t.a=i-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}(e),i=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,i&&("object"==typeof i&&r(i,n),a.state=function(){return r(n,{})}),a}t&&t.exports?t.exports=i:this.tychei=i}(0,e)})),v=c((function(e){!function(t,r){var i,a=this,o=256,s=6,u="random",c=r.pow(o,s),l=r.pow(2,52),f=2*l,d=o-1;function h(e,n,h){var g=[],y=m(function e(t,n){var r,i=[],a=typeof t;if(n&&"object"==a)for(r in t)try{i.push(e(t[r],n-1))}catch(e){}return i.length?i:"string"==a?t:t+"\0"}((n=1==n?{entropy:!0}:n||{}).entropy?[e,v(t)]:null==e?function(){try{var e;return i&&(e=i.randomBytes)?e=e(o):(e=new Uint8Array(o),(a.crypto||a.msCrypto).getRandomValues(e)),v(e)}catch(e){var n=a.navigator,r=n&&n.plugins;return[+new Date,a,r,a.screen,v(t)]}}():e,3),g),b=new function(e){var t,n=e.length,r=this,i=0,a=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);i<o;)s[i]=i++;for(i=0;i<o;i++)s[i]=s[a=d&a+e[i%n]+(t=s[i])],s[a]=t;(r.g=function(e){for(var t,n=0,i=r.i,a=r.j,s=r.S;e--;)t=s[i=d&i+1],n=n*o+s[d&(s[i]=s[a=d&a+t])+(s[a]=t)];return r.i=i,r.j=a,n})(o)}(g),x=function(){for(var e=b.g(s),t=c,n=0;e<l;)e=(e+n)*o,t*=o,n=b.g(1);for(;e>=f;)e/=2,t/=2,n>>>=1;return(e+n)/t};return x.int32=function(){return 0|b.g(4)},x.quick=function(){return b.g(4)/4294967296},x.double=x,m(v(b.S),t),(n.pass||h||function(e,t,n,i){return i&&(i.S&&p(i,b),e.state=function(){return p(b,{})}),n?(r[u]=e,t):e})(x,y,"global"in n?n.global:this==r,n.state)}function p(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function m(e,t){for(var n,r=e+"",i=0;i<r.length;)t[d&i]=d&(n^=19*t[d&i])+r.charCodeAt(i++);return v(t)}function v(e){return String.fromCharCode.apply(0,e)}if(r["seed"+u]=h,m(r.random(),t),e.exports){e.exports=h;try{i=n(387)}catch(e){}}}([],Math)}));v.alea=l,v.xor128=f,v.xorwow=d,v.xorshift7=h,v.xor4096=p,v.tychei=m;var g=v.alea;function y(e,t,n,r){if(void 0===n&&(n=new Map),void 0===r&&(r=new Set),null==e)return null;if(r.has(e))throw new Error("Circular references are not supported.");if(n.has(e))return n.get(e);var i=t(e);if(i.recurse&&null!==i.value)throw new Error("A deep map function may not return both a value and recurse=true.");if(i.recurse){if(_(e)){var a=Array.isArray(e)?[]:{};for(var o in r.add(e),e){var s=y(e[o],t,n,r);a[o]=s}return r.delete(e),a}throw new Error("Can't recurse into non-iterable type: "+e)}return n.set(e,i.value),i.value}function b(e,t){return void 0===t&&(t=x),function e(t,n,r){void 0===r&&(r=new Set);var i=t[0];if(r.has(i))throw new Error("Circular references are not supported.");var a=n(t);if(a.recurse&&null!==a.value)throw new Error("A deep zip function may not return both a value and recurse=true.");if(a.recurse){if(_(i)){var o=Array.isArray(i)?[]:{};r.add(i);var s=function(i){var a=e(t.map((function(e){return e[i]})),n,r);o[i]=a};for(var u in i)s(u);return r.delete(i),o}throw new Error("Can't recurse into non-iterable type: "+i)}return a.value}(e,t)}function x(e){return null===e?null:_(e[0])?{value:null,recurse:!0}:{value:e,recurse:!1}}function w(e,t){return s(this,void 0,void 0,(function(){var n,r,i,a,o,s;return u(this,(function(u){switch(u.label){case 0:n=new Map,y(e,t,n),r=0,i=Array.from(n.keys()),u.label=1;case 1:return r<i.length?(a=i[r],(o=n.get(a))instanceof Promise?[4,o]:[3,3]):[3,4];case 2:s=u.sent(),n.set(a,s),u.label=3;case 3:return r++,[3,1];case 4:return[2,y(e,t,n)]}}))}))}function _(e){return null!=e&&!ArrayBuffer.isView(e)&&(Array.isArray(e)||"object"==typeof e&&!(e instanceof i.Tensor))}function k(e){return function(e,t){return y(e,t)}(e,E)}function E(e){return e instanceof i.Tensor?{value:e.clone(),recurse:!1}:_(e)?{value:null,recurse:!0}:{value:e,recurse:!1}}var S=function(){function e(e){if(this.capacity=e,this.begin=0,this.end=0,null==e)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(e<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(e),this.doubledCapacity=2*e}return e.prototype.wrap=function(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity},e.prototype.get=function(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]},e.prototype.set=function(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t},e.prototype.length=function(){var e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e},e.prototype.isFull=function(){return this.length()===this.capacity},e.prototype.isEmpty=function(){return 0===this.length()},e.prototype.push=function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)},e.prototype.pushAll=function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];this.push(r)}},e.prototype.pop=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var e=this.get(this.end);return this.set(this.end,void 0),e},e.prototype.unshift=function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)},e.prototype.shift=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e},e.prototype.shuffleExcise=function(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n},e}(),C=function(e){function t(){return e.call(this,t.INITIAL_CAPACITY)||this}return o(t,e),t.prototype.isFull=function(){return!1},t.prototype.push=function(t){e.prototype.isFull.call(this)&&this.expand(),e.prototype.push.call(this,t)},t.prototype.unshift=function(t){e.prototype.isFull.call(this)&&this.expand(),e.prototype.unshift.call(this,t)},t.prototype.expand=function(){for(var e=2*this.capacity,t=new Array(e),n=this.length(),r=0;r<n;r++)t[r]=this.get(this.wrap(this.begin+r));this.data=t,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n},t.INITIAL_CAPACITY=32,t}(S);function A(e){return new j(e)}function O(e){return new M(e)}var D,T=function(){function e(){}return e.prototype.toArray=function(){return s(this,void 0,void 0,(function(){var e,t;return u(this,(function(n){switch(n.label){case 0:return e=[],[4,this.next()];case 1:t=n.sent(),n.label=2;case 2:return t.done?[3,4]:(e.push(t.value),[4,this.next()]);case 3:return t=n.sent(),[3,2];case 4:return[2,e]}}))}))},e.prototype.toArrayForTest=function(){return s(this,void 0,void 0,(function(){var e,t,n;return u(this,(function(r){switch(r.label){case 0:return e=this.prefetch(100),t=[],[4,e.next()];case 1:n=r.sent(),r.label=2;case 2:return n.done?[3,4]:(t.push(n.value),[4,e.next()]);case 3:return n=r.sent(),[3,2];case 4:return[2,t]}}))}))},e.prototype.resolveFully=function(){return s(this,void 0,void 0,(function(){var e;return u(this,(function(t){switch(t.label){case 0:return[4,this.next()];case 1:e=t.sent(),t.label=2;case 2:return e.done?[3,4]:[4,this.next()];case 3:return e=t.sent(),[3,2];case 4:return[2]}}))}))},e.prototype.resolveWhile=function(e){return s(this,void 0,void 0,(function(){var t,n;return u(this,(function(r){switch(r.label){case 0:return[4,this.next()];case 1:t=r.sent(),n=e(t.value),r.label=2;case 2:return t.done||!n?[3,4]:[4,this.next()];case 3:return t=r.sent(),n=e(t.value),[3,2];case 4:return[2]}}))}))},e.prototype.handleErrors=function(e){return new L(this,e)},e.prototype.filter=function(e){return new P(this,e)},e.prototype.map=function(e){return new B(this,e)},e.prototype.mapAsync=function(e){return new z(this,e)},e.prototype.serialMapAsync=function(e){return new z(this,e).serial()},e.prototype.flatmap=function(e){return new W(this,e)},e.prototype.forEachAsync=function(e){return s(this,void 0,void 0,(function(){return u(this,(function(t){return[2,this.map(e).resolveFully()]}))}))},e.prototype.serialForEach=function(e){return s(this,void 0,void 0,(function(){return u(this,(function(t){return[2,this.serialMapAsync(e).resolveWhile((function(e){return!0===e}))]}))}))},e.prototype.rowMajorBatch=function(e,t){return void 0===t&&(t=!0),new R(this,e,t)},e.prototype.columnMajorBatch=function(e,t,n){return void 0===t&&(t=!0),void 0===n&&(n=x),this.rowMajorBatch(e,t).map((function(e){return b(e,n)}))},e.prototype.concatenate=function(e,t){return new V(A([this,e]),t)},e.prototype.take=function(e){return e<0||null==e?this:new N(this,e)},e.prototype.skip=function(e){return e<0||null==e?this:new I(this,e)},e.prototype.prefetch=function(e){return new q(this,e)},e.prototype.shuffle=function(e,t){return new H(this,e,t)},e.prototype.serial=function(){return new F(this)},e}(),j=function(e){function t(t){var n=e.call(this)||this;return n.items=t,n.trav=0,n}return o(t,e),t.prototype.summary=function(){return"Array of "+this.items.length+" items"},t.prototype.next=function(){return s(this,void 0,void 0,(function(){var e;return u(this,(function(t){return this.trav>=this.items.length?[2,{value:null,done:!0}]:(e=this.items[this.trav],this.trav++,[2,{value:k(e),done:!1}])}))}))},t}(T),M=function(e){function t(t){var n=e.call(this)||this;return n.nextFn=t,n}return o(t,e),t.prototype.summary=function(){return"Function call"},t.prototype.next=function(){return s(this,void 0,void 0,(function(){return u(this,(function(e){try{return[2,this.nextFn()]}catch(e){throw e.message="Error thrown while iterating through a dataset: "+e.message,e}return[2]}))}))},t}(T),F=function(e){function t(t){var n=e.call(this)||this;return n.upstream=t,n.lastRead=Promise.resolve({value:null,done:!1}),n}return o(t,e),t.prototype.summary=function(){return this.upstream.summary()+" -> Serial"},t.prototype.next=function(){return s(this,void 0,void 0,(function(){var e=this;return u(this,(function(t){return this.lastRead=this.lastRead.then((function(){return e.serialNext()})),[2,this.lastRead]}))}))},t.prototype.serialNext=function(){return s(this,void 0,void 0,(function(){return u(this,(function(e){return[2,this.upstream.next()]}))}))},t}(T),I=function(e){function t(t,n){var r=e.call(this)||this;return r.upstream=t,r.maxCount=n,r.count=0,r.lastRead=Promise.resolve({value:null,done:!1}),r}return o(t,e),t.prototype.summary=function(){return this.upstream.summary()+" -> Skip"},t.prototype.next=function(){return s(this,void 0,void 0,(function(){var e=this;return u(this,(function(t){return this.lastRead=this.lastRead.then((function(){return e.serialNext()})),[2,this.lastRead]}))}))},t.prototype.serialNext=function(){return s(this,void 0,void 0,(function(){var e;return u(this,(function(t){switch(t.label){case 0:return this.count++<this.maxCount?[4,this.upstream.next()]:[3,2];case 1:return(e=t.sent()).done?[2,e]:(Object(i.dispose)(e.value),[3,0]);case 2:return[2,this.upstream.next()]}}))}))},t}(T),N=function(e){function t(t,n){var r=e.call(this)||this;return r.upstream=t,r.maxCount=n,r.count=0,r}return o(t,e),t.prototype.summary=function(){return this.upstream.summary()+" -> Take"},t.prototype.next=function(){return s(this,void 0,void 0,(function(){return u(this,(function(e){return this.count++>=this.maxCount?[2,{value:null,done:!0}]:[2,this.upstream.next()]}))}))},t}(T),R=function(e){function t(t,n,r){void 0===r&&(r=!0);var i=e.call(this)||this;return i.upstream=t,i.batchSize=n,i.enableSmallLastBatch=r,i.lastRead=Promise.resolve({value:null,done:!1}),i}return o(t,e),t.prototype.summary=function(){return this.upstream.summary()+" -> RowMajorBatch"},t.prototype.next=function(){return s(this,void 0,void 0,(function(){var e=this;return u(this,(function(t){return this.lastRead=this.lastRead.then((function(){return e.serialNext()})),[2,this.lastRead]}))}))},t.prototype.serialNext=function(){return s(this,void 0,void 0,(function(){var e,t;return u(this,(function(n){switch(n.label){case 0:e=[],n.label=1;case 1:return e.length<this.batchSize?[4,this.upstream.next()]:[3,3];case 2:return(t=n.sent()).done?this.enableSmallLastBatch&&e.length>0?[2,{value:e,done:!1}]:[2,{value:null,done:!0}]:(e.push(t.value),[3,1]);case 3:return[2,{value:e,done:!1}]}}))}))},t}(T),P=function(e){function t(t,n){var r=e.call(this)||this;return r.upstream=t,r.predicate=n,r.lastRead=Promise.resolve({value:null,done:!1}),r}return o(t,e),t.prototype.summary=function(){return this.upstream.summary()+" -> Filter"},t.prototype.next=function(){return s(this,void 0,void 0,(function(){var e=this;return u(this,(function(t){return this.lastRead=this.lastRead.then((function(){return e.serialNext()})),[2,this.lastRead]}))}))},t.prototype.serialNext=function(){return s(this,void 0,void 0,(function(){var e;return u(this,(function(t){switch(t.label){case 0:return[4,this.upstream.next()];case 1:return(e=t.sent()).done||this.predicate(e.value)?[2,e]:(Object(i.dispose)(e.value),[3,0]);case 2:return[2]}}))}))},t}(T),B=function(e){function t(t,n){var r=e.call(this)||this;return r.upstream=t,r.transform=n,r}return o(t,e),t.prototype.summary=function(){return this.upstream.summary()+" -> Map"},t.prototype.next=function(){return s(this,void 0,void 0,(function(){var e,t,n,r,a,o,s;return u(this,(function(u){switch(u.label){case 0:return[4,this.upstream.next()];case 1:if((e=u.sent()).done)return[2,{value:null,done:!0}];for(t=i.tensor_util.getTensorsInContainer(e.value),n=this.transform(e.value),r=i.tensor_util.getTensorsInContainer(n),a=0,o=t;a<o.length;a++)s=o[a],i.tensor_util.isTensorInList(s,r)||s.dispose();return[2,{value:n,done:!1}]}}))}))},t}(T),L=function(e){function t(t,n){var r=e.call(this)||this;return r.upstream=t,r.handler=n,r.count=0,r.lastRead=Promise.resolve({value:null,done:!1}),r}return o(t,e),t.prototype.summary=function(){return this.upstream.summary()+" -> handleErrors"},t.prototype.next=function(){return s(this,void 0,void 0,(function(){var e=this;return u(this,(function(t){return this.lastRead=this.lastRead.then((function(){return e.serialNext()})),[2,this.lastRead]}))}))},t.prototype.serialNext=function(){return s(this,void 0,void 0,(function(){var e;return u(this,(function(t){switch(t.label){case 0:t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.upstream.next()];case 2:return[2,t.sent()];case 3:return e=t.sent(),this.handler(e)?[3,4]:[2,{value:null,done:!0}];case 4:return[3,0];case 5:return[2]}}))}))},t}(T),z=function(e){function t(t,n){var r=e.call(this)||this;return r.upstream=t,r.transform=n,r}return o(t,e),t.prototype.summary=function(){return this.upstream.summary()+" -> AsyncMap"},t.prototype.next=function(){return s(this,void 0,void 0,(function(){var e,t,n,r,a,o,s;return u(this,(function(u){switch(u.label){case 0:return[4,this.upstream.next()];case 1:return(e=u.sent()).done?[2,{value:null,done:!0}]:(t=i.tensor_util.getTensorsInContainer(e.value),[4,this.transform(e.value)]);case 2:for(n=u.sent(),r=i.tensor_util.getTensorsInContainer(n),a=0,o=t;a<o.length;a++)s=o[a],i.tensor_util.isTensorInList(s,r)||s.dispose();return[2,{value:n,done:!1}]}}))}))},t}(T),U=function(e){function t(){var t=e.call(this)||this;return t.outputQueue=new C,t.lastRead=Promise.resolve({value:null,done:!1}),t}return o(t,e),t.prototype.next=function(){return s(this,void 0,void 0,(function(){var e=this;return u(this,(function(t){return this.lastRead=this.lastRead.then((function(){return e.serialNext()})),[2,this.lastRead]}))}))},t.prototype.serialNext=function(){return s(this,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return 0!==this.outputQueue.length()?[3,2]:[4,this.pump()];case 1:return e.sent()?[3,0]:[2,{value:null,done:!0}];case 2:return[2,{value:this.outputQueue.shift(),done:!1}]}}))}))},t}(T),W=function(e){function t(t,n){var r=e.call(this)||this;return r.upstream=t,r.transform=n,r}return o(t,e),t.prototype.summary=function(){return this.upstream.summary()+" -> Flatmap"},t.prototype.pump=function(){return s(this,void 0,void 0,(function(){var e,t,n,r,a,o,s;return u(this,(function(u){switch(u.label){case 0:return[4,this.upstream.next()];case 1:if((e=u.sent()).done)return[2,!1];for(t=i.tensor_util.getTensorsInContainer(e.value),n=this.transform(e.value),r=i.tensor_util.getTensorsInContainer(n),this.outputQueue.pushAll(n),a=0,o=t;a<o.length;a++)s=o[a],i.tensor_util.isTensorInList(s,r)||s.dispose();return[2,!0]}}))}))},t}(U),V=function(e){function t(t,n){var r=e.call(this)||this;return r.baseErrorHandler=n,r.lastRead=null,r.iterator=null,r.moreIterators=t,r}return o(t,e),t.prototype.summary=function(){return"TODO: fill in upstream of chained summaries -> Chained"},t.prototype.next=function(){return s(this,void 0,void 0,(function(){return u(this,(function(e){return this.lastRead=this.readFromChain(this.lastRead),[2,this.lastRead]}))}))},t.prototype.readFromChain=function(e){return s(this,void 0,void 0,(function(){var t,n;return u(this,(function(r){switch(r.label){case 0:return[4,e];case 1:return r.sent(),null!=this.iterator?[3,3]:[4,this.moreIterators.next()];case 2:if((t=r.sent()).done)return[2,{value:null,done:!0}];this.iterator=t.value,null!=this.baseErrorHandler&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler)),r.label=3;case 3:return[4,this.iterator.next()];case 4:return(n=r.sent()).done?(this.iterator=null,[2,this.readFromChain(e)]):[2,n]}}))}))},t}(T);!function(e){e[e.FAIL=0]="FAIL",e[e.SHORTEST=1]="SHORTEST",e[e.LONGEST=2]="LONGEST"}(D||(D={}));var G=function(e){function t(t,n){void 0===n&&(n=D.FAIL);var r=e.call(this)||this;return r.iterators=t,r.mismatchMode=n,r.count=0,r.currentPromise=null,r}return o(t,e),t.prototype.summary=function(){return"{TODO: fill in upstream of zip summaries} -> Zip"},t.prototype.nextState=function(e){return s(this,void 0,void 0,(function(){function t(e){return e instanceof T?{value:e.next().then((function(e){return n++,e.done&&r++,e.value})),recurse:!1}:{value:null,recurse:!0}}var n,r,i;return u(this,(function(a){switch(a.label){case 0:return[4,e];case 1:return a.sent(),n=0,r=0,[4,w(this.iterators,t)];case 2:if(i=a.sent(),n===r)return[2,{value:null,done:!0}];if(r>0)switch(this.mismatchMode){case D.FAIL:throw new Error("Zipped streams should have the same length. Mismatched at element "+this.count+".");case D.SHORTEST:return[2,{value:null,done:!0}];case D.LONGEST:}return this.count++,[2,{value:i,done:!1}]}}))}))},t.prototype.next=function(){return s(this,void 0,void 0,(function(){return u(this,(function(e){return this.currentPromise=this.nextState(this.currentPromise),[2,this.currentPromise]}))}))},t}(T),q=function(e){function t(t,n){var r=e.call(this)||this;return r.upstream=t,r.bufferSize=n,r.buffer=new S(n),r}return o(t,e),t.prototype.summary=function(){return this.upstream.summary()+" -> Prefetch"},t.prototype.refill=function(){for(;!this.buffer.isFull();){var e=this.upstream.next();this.buffer.push(e)}},t.prototype.next=function(){return this.refill(),this.buffer.shift()},t}(T),H=function(e){function t(t,n,r){var a=e.call(this,t,n)||this;return a.upstream=t,a.windowSize=n,a.upstreamExhausted=!1,a.random=g(r||i.util.now().toString()),a.lastRead=Promise.resolve({value:null,done:!1}),a}return o(t,e),t.prototype.next=function(){return s(this,void 0,void 0,(function(){var e=this;return u(this,(function(t){return this.lastRead=this.lastRead.then((function(){return e.serialNext()})),[2,this.lastRead]}))}))},t.prototype.randomInt=function(e){return Math.floor(this.random()*e)},t.prototype.chooseIndex=function(){return this.randomInt(this.buffer.length())},t.prototype.serialNext=function(){return s(this,void 0,void 0,(function(){var e,t;return u(this,(function(n){switch(n.label){case 0:this.upstreamExhausted||this.refill(),n.label=1;case 1:return this.buffer.isEmpty()?[3,3]:(e=this.chooseIndex(),[4,this.buffer.shuffleExcise(e)]);case 2:return(t=n.sent()).done?(this.upstreamExhausted=!0,[3,1]):(this.refill(),[2,t]);case 3:return[2,{value:null,done:!0}]}}))}))},t}(q),X=function(){function e(){this.size=null}return e.prototype.batch=function(e,t){var n=this;void 0===t&&(t=!0);var r=this;return i.util.assert(e>0,(function(){return"batchSize needs to be positive, but it is\n      "+e})),K((function(){return s(n,void 0,void 0,(function(){return u(this,(function(n){switch(n.label){case 0:return[4,r.iterator()];case 1:return[2,n.sent().columnMajorBatch(e,t,J)]}}))}))}),this.size===1/0||null==this.size?this.size:t?Math.ceil(this.size/e):Math.floor(this.size/e))},e.prototype.concatenate=function(e){var t=this,n=this;return K((function(){return s(t,void 0,void 0,(function(){var t,r;return u(this,(function(i){switch(i.label){case 0:return[4,n.iterator()];case 1:return r=(t=i.sent()).concatenate,[4,e.iterator()];case 2:return[2,r.apply(t,[i.sent()])]}}))}))}),this.size===1/0||e.size===1/0?1/0:null!=this.size&&null!=e.size?this.size+e.size:null)},e.prototype.filter=function(e){var t=this,n=this;return K((function(){return s(t,void 0,void 0,(function(){return u(this,(function(t){switch(t.label){case 0:return[4,n.iterator()];case 1:return[2,t.sent().filter((function(t){return Object(i.tidy)((function(){return e(t)}))}))]}}))}))}),this.size===1/0?1/0:null)},e.prototype.forEachAsync=function(e){return s(this,void 0,void 0,(function(){return u(this,(function(t){switch(t.label){case 0:return[4,this.iterator()];case 1:return[2,t.sent().forEachAsync(e)]}}))}))},e.prototype.forEach=function(e){return s(this,void 0,void 0,(function(){return u(this,(function(t){return Object(i.deprecationWarn)("dataset.forEach() is deprecated and will be removed. Please use dataset.forEachAsync() instead"),[2,this.forEachAsync(e)]}))}))},e.prototype.map=function(e){var t=this,n=this;return K((function(){return s(t,void 0,void 0,(function(){return u(this,(function(t){switch(t.label){case 0:return[4,n.iterator()];case 1:return[2,t.sent().map((function(t){return Object(i.tidy)((function(){return e(t)}))}))]}}))}))}),this.size)},e.prototype.mapAsync=function(e){var t=this,n=this;return K((function(){return s(t,void 0,void 0,(function(){return u(this,(function(t){switch(t.label){case 0:return[4,n.iterator()];case 1:return[2,t.sent().mapAsync(e)]}}))}))}),this.size)},e.prototype.prefetch=function(e){var t=this;if(null==e)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");var n=this;return K((function(){return s(t,void 0,void 0,(function(){return u(this,(function(t){switch(t.label){case 0:return[4,n.iterator()];case 1:return[2,t.sent().prefetch(e)]}}))}))}),this.size)},e.prototype.repeat=function(e){var t=this,n=this;return K((function(){return s(t,void 0,void 0,(function(){var t=this;return u(this,(function(r){return[2,function(e,t){return new V(e,void 0)}(O((function(){return s(t,void 0,void 0,(function(){var e;return u(this,(function(t){switch(t.label){case 0:return e={},[4,n.iterator()];case 1:return[2,(e.value=t.sent(),e.done=!1,e)]}}))}))})).take(e))]}))}))}),null!=this.size&&e>0?this.size*e:0===e?0:null!=this.size&&(void 0===e||e<0)?1/0:null)},e.prototype.skip=function(e){var t=this,n=this;return K((function(){return s(t,void 0,void 0,(function(){return u(this,(function(t){switch(t.label){case 0:return[4,n.iterator()];case 1:return[2,t.sent().skip(e)]}}))}))}),null!=this.size&&e>=0&&this.size>=e?this.size-e:null!=this.size&&(this.size<e||void 0===e||e<0)?0:null)},e.prototype.shuffle=function(e,t,n){var r=this;if(void 0===n&&(n=!0),null==e||e<0)throw null==this.size?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting bufferSize to the dataset size ("+this.size+" elements)");var a=this,o=g(t||i.util.now().toString());return K((function(){return s(r,void 0,void 0,(function(){var t;return u(this,(function(r){switch(r.label){case 0:return t=o.int32(),n&&(t+=o.int32()),[4,a.iterator()];case 1:return[2,r.sent().shuffle(e,t.toString())]}}))}))}),this.size)},e.prototype.take=function(e){var t=this,n=this;return K((function(){return s(t,void 0,void 0,(function(){return u(this,(function(t){switch(t.label){case 0:return[4,n.iterator()];case 1:return[2,t.sent().take(e)]}}))}))}),null!=this.size&&this.size>e?e:null!=this.size&&this.size<=e?this.size:null)},e.prototype.toArray=function(){return s(this,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,e.sent().toArray()]}}))}))},e.prototype.toArrayForTest=function(){return s(this,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,e.sent().toArrayForTest()]}}))}))},e.MAX_BUFFER_SIZE=1e4,e}();function K(e,t){return void 0===t&&(t=null),new(function(n){function r(){var e=null!==n&&n.apply(this,arguments)||this;return e.size=t,e}return o(r,n),r.prototype.iterator=function(){return s(this,void 0,void 0,(function(){return u(this,(function(t){return[2,e()]}))}))},r}(X))}function Y(e){var t=this;return K((function(){return s(t,void 0,void 0,(function(){return u(this,(function(t){return[2,A(e)]}))}))}),e.length)}function $(e){var t,n=this;if(!_(e))throw new Error("The argument to zip() must be an object or array.");if(Array.isArray(e))for(var r=0;r<e.length;r++)t=null==t?e[r].size:Math.min(t,e[r].size);else if(e instanceof Object)for(var i in e)t=null==t?e[i].size:Math.min(t,e[i].size);return K((function(){return s(n,void 0,void 0,(function(){return u(this,(function(t){switch(t.label){case 0:return[4,w(e,(function(e){if(e instanceof X)return{value:e.iterator(),recurse:!1};if(_(e))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")}))];case 1:return[2,function(e,t){return void 0===t&&(t=D.FAIL),new G(e,t)}(t.sent(),D.SHORTEST)]}}))}))}),t)}function J(e){return null===e?null:function(e){return null==e||function(e){return null===e||"object"!=typeof e&&"function"!=typeof e}(e)||Array.isArray(e)||"object"==typeof e&&e instanceof i.Tensor||i.util.isTypedArray(e)}(e[0])?{value:function(e){if(0===e.length)throw new Error("Can't make a batch of zero elements.");return e[0]instanceof i.Tensor?Object(i.stack)(e):Object(i.tensor)(e)}(e),recurse:!1}:{value:null,recurse:!0}}var Z=function(e){function t(t){var n=e.call(this)||this;return n.input=t,n}return o(t,e),t.prototype.iterator=function(){return s(this,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return[4,this.input.iterator()];case 1:return[2,e.sent().decodeUTF8().split("\n").map((function(e){return e.endsWith("\r")&&(e=e.slice(0,-1)),e}))]}}))}))},t}(X),Q=Symbol("out"),ee=Symbol("field"),te=Symbol("quote"),ne=Symbol("quoteafterquote"),re=Symbol("quoteinquote"),ie=function(e){function t(t,n){var r=e.call(this)||this;return r.input=t,r.hasHeader=!0,r.fullColumnNames=null,r.columnNamesValidated=!1,r.columnConfigs=null,r.configuredColumnsOnly=!1,r.delimiter=",",r.delimWhitespace=!1,r.base=new Z(t),n||(n={}),r.hasHeader=!1!==n.hasHeader,r.fullColumnNames=n.columnNames,r.columnConfigs=n.columnConfigs,r.configuredColumnsOnly=n.configuredColumnsOnly,n.delimWhitespace?(i.util.assert(null==n.delimiter,(function(){return"Delimiter should not be provided when delimWhitespace is true."})),r.delimWhitespace=!0,r.delimiter=" "):r.delimiter=n.delimiter?n.delimiter:",",r}return o(t,e),t.prototype.columnNames=function(){return s(this,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:e.sent(),e.label=2;case 2:return[2,this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames]}}))}))},t.prototype.setColumnNames=function(){return s(this,void 0,void 0,(function(){var e,t,n,r,a,o,s=this;return u(this,(function(u){switch(u.label){case 0:return[4,this.maybeReadHeaderLine()];case 1:if(e=u.sent(),!this.fullColumnNames&&!e)throw new Error("Column names must be provided if there is no header line.");if(this.fullColumnNames&&e&&i.util.assert(e.length===this.fullColumnNames.length,(function(){return"The length of provided columnNames ("+s.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+e.length.toString()+")."})),this.fullColumnNames||(this.fullColumnNames=e),t=this.fullColumnNames.reduce((function(e,t){return e[t]=e[t]+1||1,e}),{}),n=Object.keys(t).filter((function(e){return t[e]>1})),i.util.assert(0===n.length,(function(){return"Duplicate column names found: "+n.toString()})),this.columnConfigs)for(r=0,a=Object.keys(this.columnConfigs);r<a.length;r++)if(o=a[r],-1===this.fullColumnNames.indexOf(o))throw new Error('The key "'+o+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").");return this.columnNamesValidated=!0,[2]}}))}))},t.prototype.maybeReadHeaderLine=function(){return s(this,void 0,void 0,(function(){var e,t;return u(this,(function(n){switch(n.label){case 0:return this.hasHeader?[4,this.base.iterator()]:[3,3];case 1:return[4,n.sent().next()];case 2:if((e=n.sent()).done)throw new Error("No data was found for CSV parsing.");return t=e.value,[2,this.parseRow(t,!1)];case 3:return[2,null]}}))}))},t.prototype.iterator=function(){return s(this,void 0,void 0,(function(){var e,t=this;return u(this,(function(n){switch(n.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:n.sent(),n.label=2;case 2:return[4,this.base.iterator()];case 3:return e=n.sent(),this.hasHeader&&(e=e.skip(1)),[2,e.map((function(e){return t.makeDataElement(e)}))]}}))}))},t.prototype.makeDataElement=function(e){for(var t=this.parseRow(e),n={},r={},i=0;i<this.fullColumnNames.length;i++){var a=this.fullColumnNames[i],o=this.columnConfigs?this.columnConfigs[a]:null;if(!this.configuredColumnsOnly||o){var s=t[i],u=null;if(""===s)if(o&&void 0!==o.default)u=o.default;else{if(o&&(o.required||o.isLabel))throw new Error("Required column "+a+" is empty in this line: "+e);u=void 0}else{var c=Number(s);if(isNaN(c))u=o&&"bool"===o.dtype?this.getBoolean(s):s;else if(o&&o.dtype)switch(o.dtype){case"float32":default:u=c;break;case"int32":u=Math.floor(c);break;case"bool":u=this.getBoolean(s)}else u=c}o&&o.isLabel?r[a]=u:n[a]=u}}return 0===Object.keys(r).length?n:{xs:n,ys:r}},t.prototype.getBoolean=function(e){return"1"===e||"true"===e.toLowerCase()?1:0},t.prototype.parseRow=function(e,t){void 0===t&&(t=!0);for(var n=[],r=0,i=e.length,a=Q,o=0;o<i;o++)switch(a){case Q:switch(e.charAt(o)){case'"':r=o+1,a=te;break;case this.delimiter:if(r=o+1," "===this.delimiter&&this.delimWhitespace)break;n.push(""),a=Q;break;default:a=ee,r=o}break;case ee:e.charAt(o)===this.delimiter&&(n.push(e.substring(r,o)),a=Q,r=o+1);break;case te:'"'===e.charAt(o)&&(a=ne);break;case ne:switch(e.charAt(o)){case this.delimiter:n.push(e.substring(r,o-1)),a=Q,r=o+1;break;case'"':a=te;break;default:a=re}break;case re:'"'===e.charAt(o)&&(a=te)}if(a===ne?n.push(e.substring(r,i-1)):n.push(e.substring(r)),t&&n.length!==this.fullColumnNames.length)throw new Error("Invalid row in csv file. Should have "+this.fullColumnNames.length+" elements in a row, but got "+n);return n},t}(X),ae=function(e){function t(t){var n=e.call(this)||this;n.microphoneConfig=t,n.isClosed=!1,n.fftSize=t.fftSize||1024;var r=Math.log2(n.fftSize);if(n.fftSize<0||r<4||r>14||!Number.isInteger(r))throw new Error("Invalid fftSize: it must be a power of 2 between 2 to 4 and 2 to 14, but got "+n.fftSize);if(n.numFrames=t.numFramesPerSpectrogram||43,n.sampleRateHz=t.sampleRateHz,n.columnTruncateLength=t.columnTruncateLength||n.fftSize,n.audioTrackConstraints=t.audioTrackConstraints,n.smoothingTimeConstant=t.smoothingTimeConstant||0,n.includeSpectrogram=!1!==t.includeSpectrogram,n.includeWaveform=!0===t.includeWaveform,!n.includeSpectrogram&&!n.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.");return n}return o(t,e),t.prototype.summary=function(){return"microphone"},t.create=function(e){return void 0===e&&(e={}),s(this,void 0,void 0,(function(){var n;return u(this,(function(r){switch(r.label){case 0:if(Object(i.env)().get("IS_NODE"))throw new Error("microphone API is only supported in browser environment.");return[4,(n=new t(e)).start()];case 1:return r.sent(),[2,n]}}))}))},t.prototype.start=function(){return s(this,void 0,void 0,(function(){var e,t,n,r;return u(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),e=this,[4,navigator.mediaDevices.getUserMedia({audio:null==this.audioTrackConstraints||this.audioTrackConstraints,video:!1})];case 1:return e.stream=i.sent(),[3,3];case 2:throw t=i.sent(),new Error("Error thrown while initializing video stream: "+t.message);case 3:if(!this.stream)throw new Error("Could not obtain audio from microphone.");if(n=window.AudioContext||window.webkitAudioContext,this.audioContext=new n,this.sampleRateHz){if(this.audioContext.sampleRate!==this.sampleRateHz)throw new Error("Mismatch in sampling rate: Expected: "+this.sampleRateHz+"; Actual: "+this.audioContext.sampleRate)}else this.sampleRateHz=this.audioContext.sampleRate;return r=this.audioContext.createMediaStreamSource(this.stream),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2*this.fftSize,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,r.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize),[2]}}))}))},t.prototype.next=function(){return s(this,void 0,void 0,(function(){var e,t,n,r,i;return u(this,(function(a){switch(a.label){case 0:return this.isClosed?[2,{value:null,done:!0}]:[4,this.getAudioData()];case 1:return n=a.sent(),this.includeSpectrogram&&(r=this.flattenQueue(n.freqDataQueue),e=this.getTensorFromAudioDataArray(r,[this.numFrames,this.columnTruncateLength,1])),this.includeWaveform&&(i=this.flattenQueue(n.timeDataQueue),t=this.getTensorFromAudioDataArray(i,[this.numFrames*this.fftSize,1])),[2,{value:{spectrogram:e,waveform:t},done:!1}]}}))}))},t.prototype.capture=function(){return s(this,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return[4,this.next()];case 1:return[2,e.sent().value]}}))}))},t.prototype.getAudioData=function(){return s(this,void 0,void 0,(function(){var e,t,n,r=this;return u(this,(function(i){return e=[],t=[],n=0,[2,new Promise((function(i){var a=setInterval((function(){r.includeSpectrogram&&(r.analyser.getFloatFrequencyData(r.freqData),r.freqData[0]===-1/0&&i({freqDataQueue:e,timeDataQueue:t}),e.push(r.freqData.slice(0,r.columnTruncateLength))),r.includeWaveform&&(r.analyser.getFloatTimeDomainData(r.timeData),t.push(r.timeData.slice())),++n===r.numFrames&&(clearInterval(a),i({freqDataQueue:e,timeDataQueue:t}))}),r.fftSize/r.sampleRateHz*1e3)}))]}))}))},t.prototype.stop=function(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),null!=this.stream&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())},t.prototype.toArray=function(){throw new Error("Can not convert infinite audio stream to array.")},t.prototype.getSampleRate=function(){return this.sampleRateHz},t.prototype.flattenQueue=function(e){var t=e[0].length,n=new Float32Array(e.length*t);return e.forEach((function(e,r){return n.set(e,r*t)})),n},t.prototype.getTensorFromAudioDataArray=function(e,t){var n=new Float32Array(i.util.sizeFromShape(t));return n.set(e,n.length-e.length),Object(i.tensor)(n,t)},t}(T),oe=function(e){function t(t,n){var r=e.call(this)||this;if(r.webcamVideoElement=t,r.webcamConfig=n,r.isClosed=!0,r.resize=!1,r.needToResize())if(r.resize=!0,r.cropSize=[r.webcamConfig.resizeHeight,r.webcamConfig.resizeWidth],r.cropBoxInd=Object(i.tensor1d)([0],"int32"),r.webcamConfig.centerCrop){var a=1*r.webcamConfig.resizeWidth/r.webcamVideoElement.width,o=1*r.webcamConfig.resizeHeight/r.webcamVideoElement.height,s=(1-a)/2,u=(1-o)/2,c=s+a,l=o+u;r.cropBox=Object(i.tensor2d)([u,s,l,c],[1,4])}else r.cropBox=Object(i.tensor2d)([0,0,1,1],[1,4]);return r}return o(t,e),t.prototype.summary=function(){return"webcam"},t.create=function(e,n){return void 0===n&&(n={}),s(this,void 0,void 0,(function(){var r;return u(this,(function(a){switch(a.label){case 0:if(Object(i.env)().get("IS_NODE"))throw new Error("tf.data.webcam is only supported in browser environment.");if(!e){if(e=document.createElement("video"),!n.resizeWidth||!n.resizeHeight)throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");e.width=n.resizeWidth,e.height=n.resizeHeight}return[4,(r=new t(e,n)).start()];case 1:return a.sent(),[2,r]}}))}))},t.prototype.start=function(){return s(this,void 0,void 0,(function(){var e,t,n=this;return u(this,(function(r){switch(r.label){case 0:this.webcamConfig.facingMode&&i.util.assert("user"===this.webcamConfig.facingMode||"environment"===this.webcamConfig.facingMode,(function(){return"Invalid webcam facing mode: "+n.webcamConfig.facingMode+". Please provide 'user' or 'environment'"})),r.label=1;case 1:return r.trys.push([1,3,,4]),e=this,[4,navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}})];case 2:return e.stream=r.sent(),[3,4];case 3:throw(t=r.sent()).message="Error thrown while initializing video stream: "+t.message,t;case 4:if(!this.stream)throw new Error("Could not obtain video from webcam.");try{this.webcamVideoElement.srcObject=this.stream}catch(e){console.log(e),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return this.webcamVideoElement.play(),this.isClosed=!1,[2,new Promise((function(e){n.webcamVideoElement.onloadedmetadata=function(){e()}}))]}}))}))},t.prototype.next=function(){return s(this,void 0,void 0,(function(){var e;return u(this,(function(t){if(this.isClosed)return[2,{value:null,done:!0}];try{e=i.browser.fromPixels(this.webcamVideoElement)}catch(e){throw new Error("Error thrown converting video to pixels: "+JSON.stringify(e))}if(!this.resize)return[2,{value:e,done:!1}];try{return[2,{value:this.cropAndResizeFrame(e),done:!1}]}catch(e){throw new Error("Error thrown cropping the video: "+e.message)}finally{e.dispose()}return[2]}))}))},t.prototype.needToResize=function(){return!(!this.webcamConfig.resizeWidth||!this.webcamConfig.resizeHeight||this.webcamVideoElement.width===this.webcamConfig.resizeWidth&&this.webcamVideoElement.height===this.webcamConfig.resizeHeight)},t.prototype.cropAndResizeFrame=function(e){var t=this;return Object(i.tidy)((function(){var n,r=e.toFloat().expandDims(0),a=(n=i.image.cropAndResize(r,t.cropBox,t.cropBoxInd,t.cropSize,"bilinear")).shape;return n.reshape(a.slice(1))}))},t.prototype.capture=function(){return s(this,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return[4,this.next()];case 1:return[2,e.sent().value]}}))}))},t.prototype.stop=function(){this.stream.getTracks().forEach((function(e){return e.stop()}));try{this.webcamVideoElement.srcObject=null}catch(e){console.log(e),this.webcamVideoElement.src=null}this.isClosed=!0},t.prototype.toArray=function(){throw new Error("Can not convert infinite video stream to array.")},t}(T),se=function(){},ue=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.split=function(e){return new ce(this,e)},t}(T),ce=function(e){function t(t,n){var r=e.call(this)||this;return r.upstream=t,r.impl=new le(t,n),r}return o(t,e),t.prototype.summary=function(){return this.impl.summary()},t.prototype.next=function(){return s(this,void 0,void 0,(function(){return u(this,(function(e){return[2,this.impl.next()]}))}))},t}(ue),le=function(e){function t(t,n){var r=e.call(this)||this;return r.upstream=t,r.separator=n,r.carryover="",r}return o(t,e),t.prototype.summary=function(){return this.upstream.summary()+" -> Split('"+this.separator+"')"},t.prototype.pump=function(){return s(this,void 0,void 0,(function(){var e,t,n,r,i;return u(this,(function(a){switch(a.label){case 0:return[4,this.upstream.next()];case 1:if((e=a.sent()).done)return""===this.carryover?[2,!1]:(this.outputQueue.push(this.carryover),this.carryover="",[2,!0]);for((t=e.value.split(this.separator))[0]=this.carryover+t[0],n=0,r=t.slice(0,-1);n<r.length;n++)i=r[n],this.outputQueue.push(i);return this.carryover=t[t.length-1],[2,!0]}}))}))},t}(U),fe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.decodeUTF8=function(){return new de(this)},t}(T),de=function(e){function t(t){var n=e.call(this)||this;return n.upstream=t,n.impl=new he(t),n}return o(t,e),t.prototype.summary=function(){return this.impl.summary()},t.prototype.next=function(){return s(this,void 0,void 0,(function(){return u(this,(function(e){return[2,this.impl.next()]}))}))},t}(ue),he=function(e){function t(t){var r=e.call(this)||this;if(r.upstream=t,Object(i.env)().get("IS_BROWSER"))r.decoder=new TextDecoder("utf-8");else{var a=n(386).StringDecoder;r.decoder=new a("utf8")}return r}return o(t,e),t.prototype.summary=function(){return this.upstream.summary()+" -> Utf8"},t.prototype.pump=function(){return s(this,void 0,void 0,(function(){var e,t,n;return u(this,(function(a){switch(a.label){case 0:return[4,this.upstream.next()];case 1:return(e=a.sent()).done?[2,!1]:(t=e.value,n=Object(i.env)().get("IS_BROWSER")?this.decoder.decode(t,{stream:!0}):this.decoder.write(r.from(t.buffer)),this.outputQueue.push(n),[2,!0])}}))}))},t}(U),pe=function(e){function t(t,n){void 0===n&&(n={});var r=e.call(this)||this;return r.file=t,r.options=n,i.util.assert(t instanceof Uint8Array||!!Object(i.env)().get("IS_BROWSER")&&(t instanceof File||t instanceof Blob),(function(){return"FileChunkIterator only supports File, Blob and Uint8Array right now."})),r.offset=n.offset||0,r.chunkSize=n.chunkSize||1048576,r}return o(t,e),t.prototype.summary=function(){return"FileChunks "+this.file},t.prototype.next=function(){return s(this,void 0,void 0,(function(){var e,t,n=this;return u(this,(function(r){switch(r.label){case 0:return this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size)?[2,{value:null,done:!0}]:(e=new Promise((function(e,t){var r=n.offset+n.chunkSize;if(n.file instanceof Uint8Array)e(new Uint8Array(n.file.slice(n.offset,r)));else{var i=new FileReader;i.onload=function(n){var r=i.result;if(r instanceof ArrayBuffer&&(r=new Uint8Array(r)),!(r instanceof Uint8Array))return t(new TypeError("FileReader returned unknown type."));e(r)},i.onabort=function(e){return t(new Error("Aborted"))},i.onerror=function(e){return t(new Error(e.type))};var a=n.file.slice(n.offset,r);i.readAsArrayBuffer(a)}n.offset=r})),t={},[4,e]);case 1:return[2,(t.value=r.sent(),t.done=!1,t)]}}))}))},t}(fe),me=function(e){return{method:e.method,headers:e.headers,body:e.body,mode:e.mode,credentials:e.credentials,cache:e.cache,redirect:e.redirect,referrer:e.referrer,integrity:e.integrity}};function ve(e){return"string"==typeof e&&"file://"===e.substr(0,7)}var ge=function(e){function t(t,n){void 0===n&&(n={});var r=e.call(this)||this;return r.input=t,r.options=n,r}return o(t,e),t.prototype.iterator=function(){return s(this,void 0,void 0,(function(){var e;return u(this,(function(t){return ve(this.input)&&Object(i.env)().get("IS_NODE")&&(e=n(385),this.input=e.readFileSync(this.input.substr(7))),[2,new pe(this.input,this.options)]}))}))},t}(se),ye=function(e){function t(t,n){void 0===n&&(n={});var r=e.call(this)||this;return r.url=t,r.fileOptions=n,r}return o(t,e),t.prototype.iterator=function(){return s(this,void 0,void 0,(function(){return u(this,(function(e){return ve(this.url)?[2,new ge(this.url,this.fileOptions).iterator()]:[2,function(e,t){return void 0===t&&(t={}),s(this,void 0,void 0,(function(){var n,r,a,o,s;return u(this,(function(u){switch(u.label){case 0:return"string"==typeof e?n=e:(n=e.url,r=me(e)),[4,i.util.fetch(n,r)];case 1:return(a=u.sent()).ok?(s=Uint8Array.bind,[4,a.arrayBuffer()]):[3,3];case 2:return o=new(s.apply(Uint8Array,[void 0,u.sent()])),[2,new pe(o,t)];case 3:throw new Error(a.statusText)}}))}))}(this.url,this.fileOptions)]}))}))},t}(se);function be(e,t){return void 0===t&&(t={}),new ie(new ye(e),t)}function xe(e){var t=this,n=O(e);return K((function(){return s(t,void 0,void 0,(function(){return u(this,(function(e){return[2,n]}))}))}))}function we(e){var t=this;return K((function(){return s(t,void 0,void 0,(function(){var t;return u(this,(function(n){switch(n.label){case 0:return[4,e()];case 1:return t=n.sent(),[2,O((function(){return t.next()}))]}}))}))}))}function _e(e,t){return s(this,void 0,void 0,(function(){return u(this,(function(n){return[2,oe.create(e,t)]}))}))}function ke(e){return s(this,void 0,void 0,(function(){return u(this,(function(t){return[2,ae.create(e)]}))}))}var Ee="1.7.4"}.call(this,n(59),n(92).Buffer)},function(e,t,n){"use strict";function r(e){var t="";if(!e)try{e=n(185)}catch(e){t=e.toString()}return{readFile:e?function(t){return new Promise((function(n,r){e.readFile(t,(function(e,t){return e?r(e):n(t)}))}))}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+t)}}}n.d(t,"a",(function(){return r}))},function(e){e.exports={a:"0.12.2"}},function(e,t,n){"use strict";var r=/("(?:[^\\"]|\\.)*")|[:,]/g;e.exports=function(e,t){var n,i,a;return t=t||{},n=JSON.stringify([1],void 0,void 0===t.indent?2:t.indent).slice(2,-3),i=""===n?1/0:void 0===t.maxLength?80:t.maxLength,a=t.replacer,function e(t,o,s){var u,c,l,f,d,h,p,m,v,g,y,b;if(t&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0===(y=JSON.stringify(t,a)))return y;if(p=i-o.length-s,y.length<=p&&(v=y.replace(r,(function(e,t){return t||e+" "}))).length<=p)return v;if(null!=a&&(t=JSON.parse(y),a=void 0),"object"==typeof t&&null!==t){if(m=o+n,l=[],c=0,Array.isArray(t))for(g="[",u="]",p=t.length;c<p;c++)l.push(e(t[c],m,c===p-1?0:1)||"null");else for(g="{",u="}",p=(h=Object.keys(t)).length;c<p;c++)f=h[c],d=JSON.stringify(f)+": ",void 0!==(b=e(t[f],m,d.length+(c===p-1?0:1)))&&l.push(d+b);if(l.length>0)return[g,n+l.join(",\n"+m),u].join("\n"+o)}return y}(e,"",0)}},function(e,t,n){"use strict";var r=n(31),i=Object(r.a)((function(e){e.setUTCDate(1),e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCMonth(e.getUTCMonth()+t)}),(function(e,t){return t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear())}),(function(e){return e.getUTCMonth()}));t.a=i,i.range},function(e,t,n){"use strict";var r=n(31),i=Object(r.a)((function(e){e.setDate(1),e.setHours(0,0,0,0)}),(function(e,t){e.setMonth(e.getMonth()+t)}),(function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())}),(function(e){return e.getMonth()}));t.a=i,i.range},function(e,t,n){"use strict";(function(t){var r=n(36),i=n(275),a=n(193),o={"Content-Type":"application/x-www-form-urlencoded"};function s(e,t){!r.isUndefined(e)&&r.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var u={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:function(){var e;return("undefined"!=typeof XMLHttpRequest||void 0!==t&&"[object process]"===Object.prototype.toString.call(t))&&(e=n(192)),e}(),transformRequest:[function(e,t){return i(t,"Accept"),i(t,"Content-Type"),r.isFormData(e)||r.isArrayBuffer(e)||r.isBuffer(e)||r.isStream(e)||r.isFile(e)||r.isBlob(e)?e:r.isArrayBufferView(e)?e.buffer:r.isURLSearchParams(e)?(s(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):r.isObject(e)||t&&"application/json"===t["Content-Type"]?(s(t,"application/json"),function(e,t,n){if(r.isString(e))try{return(t||JSON.parse)(e),r.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional,n=t&&t.silentJSONParsing,i=t&&t.forcedJSONParsing,o=!n&&"json"===this.responseType;if(o||i&&r.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(o){if("SyntaxError"===e.name)throw a(e,this,"E_JSON_PARSE");throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};r.forEach(["delete","get","head"],(function(e){u.headers[e]={}})),r.forEach(["post","put","patch"],(function(e){u.headers[e]=r.merge(o)})),e.exports=u}).call(this,n(75))},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(50),o=i(n(88)),s=n(64),u=n(110),c=n(109),l={maxBins:12,fontSize:11};t.histogram=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(this,void 0,void 0,m().mark((function r(){var i,f,d,h,p,v,g,y;return m().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=function(e){if(null==e.length)throw new Error("input data must be an array");if(0===e.length)return[];if("object"==typeof e[0]){if(null==e[0].value)throw new Error("input data must have a value field");return e}for(var t=Array(e.length),n=0;n<e.length;n++)t[n]={value:e[n]};return t}(t),f=Object.assign({},l,n),d=s.subSurface(e,"histogram"),!1!==n.stats&&(h=s.subSurface(e,"stats",{prepend:!0}),function(e,t,n){var r=a.format(",.4~f"),i=a.format(".4~p"),o=[],s=[];if(null!=e.numVals&&(o.push("Num Vals"),s.push(r(e.numVals))),null!=e.min&&(o.push("Min"),s.push(r(e.min))),null!=e.max&&(o.push("Max"),s.push(r(e.max))),null!=e.numZeros){o.push("# Zeros");var u="";e.numVals&&(u=e.numZeros>0?"(".concat(i(e.numZeros/e.numVals),")"):""),s.push("".concat(r(e.numZeros)," ").concat(u))}if(null!=e.numNans){o.push("# NaNs");var l="";e.numVals&&(l=e.numNans>0?"(".concat(i(e.numNans/e.numVals),")"):""),s.push("".concat(r(e.numNans)," ").concat(l))}if(null!=e.numInfs){o.push("# Infinity");var f="";e.numVals&&(f=e.numInfs>0?"(".concat(i(e.numInfs/e.numVals),")"):""),s.push("".concat(r(e.numInfs)," ").concat(f))}c.table(t,{headers:o,values:[s]},n)}(n.stats?n.stats:u.arrayStats(i.map((function(e){return e.value}))),h,{fontSize:f.fontSize})),0!==i.length){r.next=4;break}return r.abrupt("return");case 4:for(p=[],v=0;v<i.length;v++)null!=(g=i[v].value)&&isFinite(g)&&p.push(i[v]);return y={width:f.width||s.getDefaultWidth(d),height:f.height||s.getDefaultHeight(d),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},data:{values:p},mark:{type:"bar",tooltip:!0},config:{axis:{labelFontSize:f.fontSize,titleFontSize:f.fontSize},text:{fontSize:f.fontSize},legend:{labelFontSize:f.fontSize,titleFontSize:f.fontSize}},encoding:{x:{bin:{maxbins:f.maxBins},field:"value",type:"quantitative"},y:{aggregate:"count",type:"quantitative"},color:{value:f.color||"#001B44"}}},r.abrupt("return",o.default(d,y,{actions:!1,mode:"vega-lite",defaultStyle:!1}));case 8:case"end":return r.stop()}}),r)})))}},function(e,t,n){"use strict";n.r(t),n.d(t,"h",(function(){return o})),n.d(t,"createElement",(function(){return o})),n.d(t,"cloneElement",(function(){return c})),n.d(t,"Component",(function(){return N})),n.d(t,"render",(function(){return R})),n.d(t,"rerender",(function(){return h})),n.d(t,"options",(function(){return r}));var r={},i=[],a=[];function o(e,t){var n,o,s,u,c=a;for(u=arguments.length;u-- >2;)i.push(arguments[u]);for(t&&null!=t.children&&(i.length||i.push(t.children),delete t.children);i.length;)if((o=i.pop())&&void 0!==o.pop)for(u=o.length;u--;)i.push(o[u]);else"boolean"==typeof o&&(o=null),(s="function"!=typeof e)&&(null==o?o="":"number"==typeof o?o=String(o):"string"!=typeof o&&(s=!1)),s&&n?c[c.length-1]+=o:c===a?c=[o]:c.push(o),n=s;var l=new function(){};return l.nodeName=e,l.children=c,l.attributes=null==t?void 0:t,l.key=null==t?void 0:t.key,void 0!==r.vnode&&r.vnode(l),l}function s(e,t){for(var n in t)e[n]=t[n];return e}var u="function"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout;function c(e,t){return o(e.nodeName,s(s({},e.attributes),t),arguments.length>2?[].slice.call(arguments,2):e.children)}var l=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,f=[];function d(e){!e._dirty&&(e._dirty=!0)&&1==f.push(e)&&(r.debounceRendering||u)(h)}function h(){var e,t=f;for(f=[];e=t.pop();)e._dirty&&F(e)}function p(e,t,n){return"string"==typeof t||"number"==typeof t?void 0!==e.splitText:"string"==typeof t.nodeName?!e._componentConstructor&&m(e,t.nodeName):n||e._componentConstructor===t.nodeName}function m(e,t){return e.normalizedNodeName===t||e.nodeName.toLowerCase()===t.toLowerCase()}function v(e){var t=s({},e.attributes);t.children=e.children;var n=e.nodeName.defaultProps;if(void 0!==n)for(var r in n)void 0===t[r]&&(t[r]=n[r]);return t}function g(e){var t=e.parentNode;t&&t.removeChild(e)}function y(e,t,n,r,i){if("className"===t&&(t="class"),"key"===t);else if("ref"===t)n&&n(null),r&&r(e);else if("class"!==t||i)if("style"===t){if(r&&"string"!=typeof r&&"string"!=typeof n||(e.style.cssText=r||""),r&&"object"==typeof r){if("string"!=typeof n)for(var a in n)a in r||(e.style[a]="");for(var a in r)e.style[a]="number"==typeof r[a]&&!1===l.test(a)?r[a]+"px":r[a]}}else if("dangerouslySetInnerHTML"===t)r&&(e.innerHTML=r.__html||"");else if("o"==t[0]&&"n"==t[1]){var o=t!==(t=t.replace(/Capture$/,""));t=t.toLowerCase().substring(2),r?n||e.addEventListener(t,b,o):e.removeEventListener(t,b,o),(e._listeners||(e._listeners={}))[t]=r}else if("list"!==t&&"type"!==t&&!i&&t in e)!function(e,t,n){try{e[t]=n}catch(e){}}(e,t,null==r?"":r),null!=r&&!1!==r||e.removeAttribute(t);else{var s=i&&t!==(t=t.replace(/^xlink:?/,""));null==r||!1===r?s?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.removeAttribute(t):"function"!=typeof r&&(s?e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),r):e.setAttribute(t,r))}else e.className=r||""}function b(e){return this._listeners[e.type](r.event&&r.event(e)||e)}var x=[],w=0,_=!1,k=!1;function E(){for(var e;e=x.pop();)r.afterMount&&r.afterMount(e),e.componentDidMount&&e.componentDidMount()}function S(e,t,n,r,i,a){w++||(_=null!=i&&void 0!==i.ownerSVGElement,k=null!=e&&!("__preactattr_"in e));var o=C(e,t,n,r,a);return i&&o.parentNode!==i&&i.appendChild(o),--w||(k=!1,a||E()),o}function C(e,t,n,r,i){var a=e,o=_;if(null!=t&&"boolean"!=typeof t||(t=""),"string"==typeof t||"number"==typeof t)return e&&void 0!==e.splitText&&e.parentNode&&(!e._component||i)?e.nodeValue!=t&&(e.nodeValue=t):(a=document.createTextNode(t),e&&(e.parentNode&&e.parentNode.replaceChild(a,e),A(e,!0))),a.__preactattr_=!0,a;var s=t.nodeName;if("function"==typeof s)return function(e,t,n,r){for(var i=e&&e._component,a=i,o=e,s=i&&e._componentConstructor===t.nodeName,u=s,c=v(t);i&&!u&&(i=i._parentComponent);)u=i.constructor===t.nodeName;return i&&u&&(!r||i._component)?(M(i,c,3,n,r),e=i.base):(a&&!s&&(I(a),e=o=null),i=T(t.nodeName,c,n),e&&!i.nextBase&&(i.nextBase=e,o=null),M(i,c,1,n,r),e=i.base,o&&e!==o&&(o._component=null,A(o,!1))),e}(e,t,n,r);if(_="svg"===s||"foreignObject"!==s&&_,s=String(s),(!e||!m(e,s))&&(a=function(e,t){var n=t?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e);return n.normalizedNodeName=e,n}(s,_),e)){for(;e.firstChild;)a.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(a,e),A(e,!0)}var u=a.firstChild,c=a.__preactattr_,l=t.children;if(null==c){c=a.__preactattr_={};for(var f=a.attributes,d=f.length;d--;)c[f[d].name]=f[d].value}return!k&&l&&1===l.length&&"string"==typeof l[0]&&null!=u&&void 0!==u.splitText&&null==u.nextSibling?u.nodeValue!=l[0]&&(u.nodeValue=l[0]):(l&&l.length||null!=u)&&function(e,t,n,r,i){var a,o,s,u,c,l=e.childNodes,f=[],d={},h=0,m=0,v=l.length,y=0,b=t?t.length:0;if(0!==v)for(var x=0;x<v;x++){var w=l[x],_=w.__preactattr_;null!=(k=b&&_?w._component?w._component.__key:_.key:null)?(h++,d[k]=w):(_||(void 0!==w.splitText?!i||w.nodeValue.trim():i))&&(f[y++]=w)}if(0!==b)for(x=0;x<b;x++){var k;if(c=null,null!=(k=(u=t[x]).key))h&&void 0!==d[k]&&(c=d[k],d[k]=void 0,h--);else if(!c&&m<y)for(a=m;a<y;a++)if(void 0!==f[a]&&p(o=f[a],u,i)){c=o,f[a]=void 0,a===y-1&&y--,a===m&&m++;break}c=C(c,u,n,r),s=l[x],c&&c!==e&&c!==s&&(null==s?e.appendChild(c):c===s.nextSibling?g(s):e.insertBefore(c,s))}if(h)for(var x in d)void 0!==d[x]&&A(d[x],!1);for(;m<=y;)void 0!==(c=f[y--])&&A(c,!1)}(a,l,n,r,k||null!=c.dangerouslySetInnerHTML),function(e,t,n){var r;for(r in n)t&&null!=t[r]||null==n[r]||y(e,r,n[r],n[r]=void 0,_);for(r in t)"children"===r||"innerHTML"===r||r in n&&t[r]===("value"===r||"checked"===r?e[r]:n[r])||y(e,r,n[r],n[r]=t[r],_)}(a,t.attributes,c),_=o,a}function A(e,t){var n=e._component;n?I(n):(null!=e.__preactattr_&&e.__preactattr_.ref&&e.__preactattr_.ref(null),!1!==t&&null!=e.__preactattr_||g(e),O(e))}function O(e){for(e=e.lastChild;e;){var t=e.previousSibling;A(e,!0),e=t}}var D={};function T(e,t,n){var r,i=D[e.name];if(e.prototype&&e.prototype.render?(r=new e(t,n),N.call(r,t,n)):((r=new N(t,n)).constructor=e,r.render=j),i)for(var a=i.length;a--;)if(i[a].constructor===e){r.nextBase=i[a].nextBase,i.splice(a,1);break}return r}function j(e,t,n){return this.constructor(e,n)}function M(e,t,n,i,a){e._disable||(e._disable=!0,(e.__ref=t.ref)&&delete t.ref,(e.__key=t.key)&&delete t.key,!e.base||a?e.componentWillMount&&e.componentWillMount():e.componentWillReceiveProps&&e.componentWillReceiveProps(t,i),i&&i!==e.context&&(e.prevContext||(e.prevContext=e.context),e.context=i),e.prevProps||(e.prevProps=e.props),e.props=t,e._disable=!1,0!==n&&(1!==n&&!1===r.syncComponentUpdates&&e.base?d(e):F(e,1,a)),e.__ref&&e.__ref(e))}function F(e,t,n,i){if(!e._disable){var a,o,u,c=e.props,l=e.state,f=e.context,d=e.prevProps||c,h=e.prevState||l,p=e.prevContext||f,m=e.base,g=e.nextBase,y=m||g,b=e._component,_=!1;if(m&&(e.props=d,e.state=h,e.context=p,2!==t&&e.shouldComponentUpdate&&!1===e.shouldComponentUpdate(c,l,f)?_=!0:e.componentWillUpdate&&e.componentWillUpdate(c,l,f),e.props=c,e.state=l,e.context=f),e.prevProps=e.prevState=e.prevContext=e.nextBase=null,e._dirty=!1,!_){a=e.render(c,l,f),e.getChildContext&&(f=s(s({},f),e.getChildContext()));var k,C,O=a&&a.nodeName;if("function"==typeof O){var D=v(a);(o=b)&&o.constructor===O&&D.key==o.__key?M(o,D,1,f,!1):(k=o,e._component=o=T(O,D,f),o.nextBase=o.nextBase||g,o._parentComponent=e,M(o,D,0,f,!1),F(o,1,n,!0)),C=o.base}else u=y,(k=b)&&(u=e._component=null),(y||1===t)&&(u&&(u._component=null),C=S(u,a,f,n||!m,y&&y.parentNode,!0));if(y&&C!==y&&o!==b){var j=y.parentNode;j&&C!==j&&(j.replaceChild(C,y),k||(y._component=null,A(y,!1)))}if(k&&I(k),e.base=C,C&&!i){for(var N=e,R=e;R=R._parentComponent;)(N=R).base=C;C._component=N,C._componentConstructor=N.constructor}}if(!m||n?x.unshift(e):_||(e.componentDidUpdate&&e.componentDidUpdate(d,h,p),r.afterUpdate&&r.afterUpdate(e)),null!=e._renderCallbacks)for(;e._renderCallbacks.length;)e._renderCallbacks.pop().call(e);w||i||E()}}function I(e){r.beforeUnmount&&r.beforeUnmount(e);var t=e.base;e._disable=!0,e.componentWillUnmount&&e.componentWillUnmount(),e.base=null;var n=e._component;n?I(n):t&&(t.__preactattr_&&t.__preactattr_.ref&&t.__preactattr_.ref(null),e.nextBase=t,g(t),function(e){var t=e.constructor.name;(D[t]||(D[t]=[])).push(e)}(e),O(t)),e.__ref&&e.__ref(null)}function N(e,t){this._dirty=!0,this.context=t,this.props=e,this.state=this.state||{}}function R(e,t,n){return S(n,e,{},!1,t,!1)}s(N.prototype,{setState:function(e,t){var n=this.state;this.prevState||(this.prevState=s({},n)),s(n,"function"==typeof e?e(n,this.props):e),t&&(this._renderCallbacks=this._renderCallbacks||[]).push(t),d(this)},forceUpdate:function(e){e&&(this._renderCallbacks=this._renderCallbacks||[]).push(e),F(this,2)},render:function(){}});var P={h:o,createElement:o,cloneElement:c,Component:N,render:R,rerender:h,options:r};t.default=P},function(e,t,n){"use strict";var r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable;e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var n,o,s=function(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),u=1;u<arguments.length;u++){for(var c in n=Object(arguments[u]))i.call(n,c)&&(s[c]=n[c]);if(r){o=r(n);for(var l=0;l<o.length;l++)a.call(n,o[l])&&(s[o[l]]=n[o[l]])}}return s}},function(e,t,n){var r=n(32),i=n(113),a=i.ANY,o=n(47),s=n(112),u=n(114),c=n(143),l=n(141),f=n(142);e.exports=function(e,t,n,d){var h,p,m,v,g;switch(e=new r(e,d),t=new o(t,d),n){case">":h=u,p=l,m=c,v=">",g=">=";break;case"<":h=c,p=f,m=u,v="<",g="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(s(e,t,d))return!1;for(var y=function(){var n=null,r=null;return t.set[b].forEach((function(e){e.semver===a&&(e=new i(">=0.0.0")),n=n||e,r=r||e,h(e.semver,n.semver,d)?n=e:m(e.semver,r.semver,d)&&(r=e)})),n.operator===v||n.operator===g?{v:!1}:r.operator&&r.operator!==v||!p(e,r.semver)?r.operator===g&&m(e,r.semver)?{v:!1}:void 0:{v:!1}},b=0;b<t.set.length;++b){var x=y();if("object"===typeof x)return x.v}return!0}},function(e,t,n){var r=n(48);e.exports=function(e,t,n){return r(e,t,n)<=0}},function(e,t,n){var r=n(48);e.exports=function(e,t,n){return r(e,t,n)>=0}},function(e,t,n){var r=n(48);e.exports=function(e,t,n){return r(e,t,n)<0}},function(e,t,n){var r=n(32);e.exports=function(e,t,n){var i=new r(e,n),a=new r(t,n);return i.compare(a)||i.compareBuild(a)}},function(e,t,n){var r=n(48);e.exports=function(e,t,n){return 0===r(e,t,n)}},function(e,t){var n=/^[0-9]+$/,r=function(e,t){var r=n.test(e),i=n.test(t);return r&&i&&(e=+e,t=+t),e===t?0:r&&!i?-1:i&&!r?1:e<t?-1:1};e.exports={compareIdentifiers:r,rcompareIdentifiers:function(e,t){return r(t,e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBroadcastDims=function(e,t){for(var n=e.length,r=[],i=0;i<n;i++){var a=n-1-i,o=e[a]||1;(t[t.length-1-i]||1)>1&&1===o&&r.unshift(a)}return r},t.getReductionAxes=function(e,t){for(var n=[],r=0;r<t.length;r++){var i=e[e.length-r-1],a=t.length-r-1,o=t[a];(null==i||1===i&&o>1)&&n.unshift(a)}return n},t.assertAndGetBroadcastShape=function(e,t){for(var n=[],r=Math.max(e.length,t.length),i=0;i<r;i++){var a=e[e.length-i-1];null==a&&(a=1);var o=t[t.length-i-1];if(null==o&&(o=1),1===a)n.unshift(o);else if(1===o)n.unshift(a);else{if(a!==o)throw Error("Operands could not be broadcast together with shapes "+e+" and "+t+".");n.unshift(a)}}return n}},function(e,t,n){e.exports=!n(208)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t,n){"use strict";var r=n(16),i=n(27),a=n(83),o=n(118),s=n(42),u=n(93),c=n(15),l=n(94),f=n(54),d=n(22),h=n(213),p=n(79).f,m=n(26).f,v=n(156),g=n(98),y="prototype",b="Wrong index!",x=r.ArrayBuffer,w=r.DataView,_=r.Math,k=r.RangeError,E=r.Infinity,S=x,C=_.abs,A=_.pow,O=_.floor,D=_.log,T=_.LN2,j=i?"_b":"buffer",M=i?"_l":"byteLength",F=i?"_o":"byteOffset";function I(e,t,n){var r,i,a,o=new Array(n),s=8*n-t-1,u=(1<<s)-1,c=u>>1,l=23===t?A(2,-24)-A(2,-77):0,f=0,d=e<0||0===e&&1/e<0?1:0;for((e=C(e))!=e||e===E?(i=e!=e?1:0,r=u):(r=O(D(e)/T),e*(a=A(2,-r))<1&&(r--,a*=2),(e+=r+c>=1?l/a:l*A(2,1-c))*a>=2&&(r++,a/=2),r+c>=u?(i=0,r=u):r+c>=1?(i=(e*a-1)*A(2,t),r+=c):(i=e*A(2,c-1)*A(2,t),r=0));t>=8;o[f++]=255&i,i/=256,t-=8);for(r=r<<t|i,s+=t;s>0;o[f++]=255&r,r/=256,s-=8);return o[--f]|=128*d,o}function N(e,t,n){var r,i=8*n-t-1,a=(1<<i)-1,o=a>>1,s=i-7,u=n-1,c=e[u--],l=127&c;for(c>>=7;s>0;l=256*l+e[u],u--,s-=8);for(r=l&(1<<-s)-1,l>>=-s,s+=t;s>0;r=256*r+e[u],u--,s-=8);if(0===l)l=1-o;else{if(l===a)return r?NaN:c?-E:E;r+=A(2,t),l-=o}return(c?-1:1)*r*A(2,l-t)}function R(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]}function P(e){return[255&e]}function B(e){return[255&e,e>>8&255]}function L(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]}function z(e){return I(e,52,8)}function U(e){return I(e,23,4)}function W(e,t,n){m(e[y],t,{get:function(){return this[n]}})}function V(e,t,n,r){var i=h(+n);if(i+t>e[M])throw k(b);var a=e[j]._b,o=i+e[F],s=a.slice(o,o+t);return r?s:s.reverse()}function G(e,t,n,r,i,a){var o=h(+n);if(o+t>e[M])throw k(b);for(var s=e[j]._b,u=o+e[F],c=r(+i),l=0;l<t;l++)s[u+l]=c[a?l:t-l-1]}if(o.ABV){if(!c((function(){x(1)}))||!c((function(){new x(-1)}))||c((function(){return new x,new x(1.5),new x(NaN),"ArrayBuffer"!=x.name}))){for(var q,H=(x=function(e){return l(this,x),new S(h(e))})[y]=S[y],X=p(S),K=0;X.length>K;)(q=X[K++])in x||s(x,q,S[q]);a||(H.constructor=x)}var Y=new w(new x(2)),$=w[y].setInt8;Y.setInt8(0,2147483648),Y.setInt8(1,2147483649),!Y.getInt8(0)&&Y.getInt8(1)||u(w[y],{setInt8:function(e,t){$.call(this,e,t<<24>>24)},setUint8:function(e,t){$.call(this,e,t<<24>>24)}},!0)}else x=function(e){l(this,x,"ArrayBuffer");var t=h(e);this._b=v.call(new Array(t),0),this[M]=t},w=function(e,t,n){l(this,w,"DataView"),l(e,x,"DataView");var r=e[M],i=f(t);if(i<0||i>r)throw k("Wrong offset!");if(i+(n=void 0===n?r-i:d(n))>r)throw k("Wrong length!");this[j]=e,this[F]=i,this[M]=n},i&&(W(x,"byteLength","_l"),W(w,"buffer","_b"),W(w,"byteLength","_l"),W(w,"byteOffset","_o")),u(w[y],{getInt8:function(e){return V(this,1,e)[0]<<24>>24},getUint8:function(e){return V(this,1,e)[0]},getInt16:function(e){var t=V(this,2,e,arguments[1]);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=V(this,2,e,arguments[1]);return t[1]<<8|t[0]},getInt32:function(e){return R(V(this,4,e,arguments[1]))},getUint32:function(e){return R(V(this,4,e,arguments[1]))>>>0},getFloat32:function(e){return N(V(this,4,e,arguments[1]),23,4)},getFloat64:function(e){return N(V(this,8,e,arguments[1]),52,8)},setInt8:function(e,t){G(this,1,e,P,t)},setUint8:function(e,t){G(this,1,e,P,t)},setInt16:function(e,t){G(this,2,e,B,t,arguments[2])},setUint16:function(e,t){G(this,2,e,B,t,arguments[2])},setInt32:function(e,t){G(this,4,e,L,t,arguments[2])},setUint32:function(e,t){G(this,4,e,L,t,arguments[2])},setFloat32:function(e,t){G(this,4,e,U,t,arguments[2])},setFloat64:function(e,t){G(this,8,e,z,t,arguments[2])}});g(x,"ArrayBuffer"),g(w,"DataView"),s(w[y],o.VIEW,!0),t.ArrayBuffer=x,t.DataView=w},function(e,t,n){var r,i,a,o=n(56),s=n(232),u=n(171),c=n(175),l=n(16),f=l.process,d=l.setImmediate,h=l.clearImmediate,p=l.MessageChannel,m=l.Dispatch,v=0,g={},y=function(){var e=+this;if(g.hasOwnProperty(e)){var t=g[e];delete g[e],t()}},b=function(e){y.call(e.data)};d&&h||(d=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return g[++v]=function(){s("function"==typeof e?e:Function(e),t)},r(v),v},h=function(e){delete g[e]},"process"==n(62)(f)?r=function(e){f.nextTick(o(y,e,1))}:m&&m.now?r=function(e){m.now(o(y,e,1))}:p?(a=(i=new p).port2,i.port1.onmessage=b,r=o(a.postMessage,a,1)):l.addEventListener&&"function"==typeof postMessage&&!l.importScripts?(r=function(e){l.postMessage(e+"","*")},l.addEventListener("message",b,!1)):r="onreadystatechange"in c("script")?function(e){u.appendChild(c("script")).onreadystatechange=function(){u.removeChild(this),y.call(e)}}:function(e){setTimeout(o(y,e,1),0)}),e.exports={set:d,clear:h}},function(e,t,n){"use strict";var r=n(164)(!0);e.exports=function(e,t,n){return t+(n?r(e,t).length:1)}},function(e,t,n){"use strict";var r=n(124),i=RegExp.prototype.exec,a=String.prototype.replace,o=i,s=function(){var e=/a/,t=/b*/g;return i.call(e,"a"),i.call(t,"a"),0!==e.lastIndex||0!==t.lastIndex}(),u=void 0!==/()??/.exec("")[1];(s||u)&&(o=function(e){var t,n,o,c,l=this;return u&&(n=new RegExp("^"+l.source+"$(?!\\s)",r.call(l))),s&&(t=l.lastIndex),o=i.call(l,e),s&&o&&(l.lastIndex=l.global?o.index+o[0].length:t),u&&o&&o.length>1&&a.call(o[0],n,(function(){for(c=1;c<arguments.length-2;c++)void 0===arguments[c]&&(o[c]=void 0)})),o}),e.exports=o},function(e,t,n){"use strict";var r=n(77),i=n(221),a=n(96),o=n(41);e.exports=n(163)(Array,"Array",(function(e,t){this._t=o(e),this._i=0,this._k=t}),(function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,i(1)):i(0,"keys"==t?n:"values"==t?e[n]:[n,e[n]])}),"values"),a.Arguments=a.Array,r("keys"),r("values"),r("entries")},function(e,t,n){"use strict";var r=n(34),i=n(81),a=n(22);e.exports=function(e){for(var t=r(this),n=a(t.length),o=arguments.length,s=i(o>1?arguments[1]:void 0,n),u=o>2?arguments[2]:void 0,c=void 0===u?n:i(u,n);c>s;)t[s++]=e;return t}},function(e,t,n){var r=n(105),i=n(19)("iterator"),a=n(96);e.exports=n(24).getIteratorMethod=function(e){if(void 0!=e)return e[i]||e["@@iterator"]||a[r(e)]}},function(e,t,n){"use strict";var r=n(26),i=n(85);e.exports=function(e,t,n){t in e?r.f(e,t,i(0,n)):e[t]=n}},function(e,t,n){var r=n(96),i=n(19)("iterator"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||a[i]===e)}},function(e,t,n){var r=n(19)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[r]=!1,!"/./"[e](t)}catch(e){}}return!0}},function(e,t,n){var r=n(13),i=n(62),a=n(19)("match");e.exports=function(e){var t;return r(e)&&(void 0!==(t=e[a])?!!t:"RegExp"==i(e))}},function(e,t,n){var r=n(161),i=n(61);e.exports=function(e,t,n){if(r(t))throw TypeError("String#"+n+" doesn't accept regex!");return String(i(e))}},function(e,t,n){"use strict";var r=n(83),i=n(8),a=n(38),o=n(42),s=n(96),u=n(226),c=n(98),l=n(78),f=n(19)("iterator"),d=!([].keys&&"next"in[].keys()),h=function(){return this};e.exports=function(e,t,n,p,m,v,g){u(n,t,p);var y,b,x,w=function(e){if(!d&&e in S)return S[e];switch(e){case"keys":case"values":return function(){return new n(this,e)}}return function(){return new n(this,e)}},_=t+" Iterator",k="values"==m,E=!1,S=e.prototype,C=S[f]||S["@@iterator"]||m&&S[m],A=C||w(m),O=m?k?w("entries"):A:void 0,D="Array"==t&&S.entries||C;if(D&&(x=l(D.call(new e)))!==Object.prototype&&x.next&&(c(x,_,!0),r||"function"==typeof x[f]||o(x,f,h)),k&&C&&"values"!==C.name&&(E=!0,A=function(){return C.call(this)}),r&&!g||!d&&!E&&S[f]||o(S,f,A),s[t]=A,s[_]=h,m)if(y={values:k?A:w("values"),keys:v?A:w("keys"),entries:O},g)for(b in y)b in S||a(S,b,y[b]);else i(i.P+i.F*(d||E),t,y);return y}},function(e,t,n){var r=n(54),i=n(61);e.exports=function(e){return function(t,n){var a,o,s=String(i(t)),u=r(n),c=s.length;return u<0||u>=c?e?"":void 0:(a=s.charCodeAt(u))<55296||a>56319||u+1===c||(o=s.charCodeAt(u+1))<56320||o>57343?e?s.charAt(u):a:e?s.slice(u,u+2):o-56320+(a-55296<<10)+65536}}},function(e,t){var n=Math.expm1;e.exports=!n||n(10)>22025.465794806718||n(10)<22025.465794806718||-2e-17!=n(-2e-17)?function(e){return 0==(e=+e)?e:e>-1e-6&&e<1e-6?e+e*e/2:Math.exp(e)-1}:n},function(e,t){e.exports=Math.sign||function(e){return 0==(e=+e)||e!=e?e:e<0?-1:1}},function(e,t,n){"use strict";var r=n(54),i=n(61);e.exports=function(e){var t=String(i(this)),n="",a=r(e);if(a<0||a==1/0)throw RangeError("Count can't be negative");for(;a>0;(a>>>=1)&&(t+=t))1&a&&(n+=t);return n}},function(e,t,n){var r=n(13),i=n(170).set;e.exports=function(e,t,n){var a,o=t.constructor;return o!==n&&"function"==typeof o&&(a=o.prototype)!==n.prototype&&r(a)&&i&&i(e,a),e}},function(e,t){e.exports="\t\n\v\f\r \xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff"},function(e,t,n){var r=n(13),i=n(14),a=function(e,t){if(i(e),!r(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,r){try{(r=n(56)(Function.call,n(53).f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,n){return a(e,n),t?e.__proto__=n:r(e,n),e}}({},!1):void 0),check:a}},function(e,t,n){var r=n(16).document;e.exports=r&&r.documentElement},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,n){var r=n(129)("keys"),i=n(84);e.exports=function(e){return r[e]||(r[e]=i(e))}},function(e,t,n){t.f=n(19)},function(e,t,n){var r=n(13),i=n(16).document,a=r(i)&&r(i.createElement);e.exports=function(e){return a?i.createElement(e):{}}},function(e,t,n){"use strict";var r=function(e){return e},i=function(e){if(null==e)return r;var t,n,i=e.scale[0],a=e.scale[1],o=e.translate[0],s=e.translate[1];return function(e,r){r||(t=n=0);var u=2,c=e.length,l=new Array(c);for(l[0]=(t+=e[0])*i+o,l[1]=(n+=e[1])*a+s;u<c;)l[u]=e[u],++u;return l}},a=function(e){var t,n=i(e.transform),r=1/0,a=r,o=-r,s=-r;function u(e){(e=n(e))[0]<r&&(r=e[0]),e[0]>o&&(o=e[0]),e[1]<a&&(a=e[1]),e[1]>s&&(s=e[1])}function c(e){switch(e.type){case"GeometryCollection":e.geometries.forEach(c);break;case"Point":u(e.coordinates);break;case"MultiPoint":e.coordinates.forEach(u)}}for(t in e.arcs.forEach((function(e){for(var t,i=-1,u=e.length;++i<u;)(t=n(e[i],i))[0]<r&&(r=t[0]),t[0]>o&&(o=t[0]),t[1]<a&&(a=t[1]),t[1]>s&&(s=t[1])})),e.objects)c(e.objects[t]);return[r,a,o,s]},o=function(e,t){for(var n,r=e.length,i=r-t;i<--r;)n=e[i],e[i++]=e[r],e[r]=n},s=function(e,t){return"string"==typeof t&&(t=e.objects[t]),"GeometryCollection"===t.type?{type:"FeatureCollection",features:t.geometries.map((function(t){return u(e,t)}))}:u(e,t)};function u(e,t){var n=t.id,r=t.bbox,i=null==t.properties?{}:t.properties,a=c(e,t);return null==n&&null==r?{type:"Feature",properties:i,geometry:a}:null==r?{type:"Feature",id:n,properties:i,geometry:a}:{type:"Feature",id:n,bbox:r,properties:i,geometry:a}}function c(e,t){var n=i(e.transform),r=e.arcs;function a(e,t){t.length&&t.pop();for(var i=r[e<0?~e:e],a=0,s=i.length;a<s;++a)t.push(n(i[a],a));e<0&&o(t,s)}function s(e){return n(e)}function u(e){for(var t=[],n=0,r=e.length;n<r;++n)a(e[n],t);return t.length<2&&t.push(t[0]),t}function c(e){for(var t=u(e);t.length<4;)t.push(t[0]);return t}function l(e){return e.map(c)}return function e(t){var n,r=t.type;switch(r){case"GeometryCollection":return{type:r,geometries:t.geometries.map(e)};case"Point":n=s(t.coordinates);break;case"MultiPoint":n=t.coordinates.map(s);break;case"LineString":n=u(t.arcs);break;case"MultiLineString":n=t.arcs.map(u);break;case"Polygon":n=l(t.arcs);break;case"MultiPolygon":n=t.arcs.map(l);break;default:return null}return{type:r,coordinates:n}}(t)}var l=function(e,t){var n={},r={},i={},a=[],o=-1;function s(e,t){for(var r in e){var i=e[r];delete t[i.start],delete i.start,delete i.end,i.forEach((function(e){n[e<0?~e:e]=1})),a.push(i)}}return t.forEach((function(n,r){var i,a=e.arcs[n<0?~n:n];a.length<3&&!a[1][0]&&!a[1][1]&&(i=t[++o],t[o]=n,t[r]=i)})),t.forEach((function(t){var n,a,o=function(t){var n,r=e.arcs[t<0?~t:t],i=r[0];return e.transform?(n=[0,0],r.forEach((function(e){n[0]+=e[0],n[1]+=e[1]}))):n=r[r.length-1],t<0?[n,i]:[i,n]}(t),s=o[0],u=o[1];if(n=i[s])if(delete i[n.end],n.push(t),n.end=u,a=r[u]){delete r[a.start];var c=a===n?n:n.concat(a);r[c.start=n.start]=i[c.end=a.end]=c}else r[n.start]=i[n.end]=n;else if(n=r[u])if(delete r[n.start],n.unshift(t),n.start=s,a=i[s]){delete i[a.end];var l=a===n?n:a.concat(n);r[l.start=a.start]=i[l.end=n.end]=l}else r[n.start]=i[n.end]=n;else r[(n=[t]).start=s]=i[n.end=u]=n})),s(i,r),s(r,i),t.forEach((function(e){n[e<0?~e:e]||a.push([e])})),a},f=function(e){return c(e,d.apply(this,arguments))};function d(e,t,n){var r,i,a;if(arguments.length>1)r=function(e,t,n){var r,i=[],a=[];function o(e){var t=e<0?~e:e;(a[t]||(a[t]=[])).push({i:e,g:r})}function s(e){e.forEach(o)}function u(e){e.forEach(s)}return function e(t){switch(r=t,t.type){case"GeometryCollection":t.geometries.forEach(e);break;case"LineString":s(t.arcs);break;case"MultiLineString":case"Polygon":u(t.arcs);break;case"MultiPolygon":!function(e){e.forEach(u)}(t.arcs)}}(t),a.forEach(null==n?function(e){i.push(e[0].i)}:function(e){n(e[0].g,e[e.length-1].g)&&i.push(e[0].i)}),i}(0,t,n);else for(i=0,r=new Array(a=e.arcs.length);i<a;++i)r[i]=i;return{type:"MultiLineString",arcs:l(e,r)}}var h=function(e){return c(e,p.apply(this,arguments))};function p(e,t){var n={},r=[],i=[];function a(e){e.forEach((function(t){t.forEach((function(t){(n[t=t<0?~t:t]||(n[t]=[])).push(e)}))})),r.push(e)}function o(t){return function(e){for(var t,n=-1,r=e.length,i=e[r-1],a=0;++n<r;)t=i,i=e[n],a+=t[0]*i[1]-t[1]*i[0];return Math.abs(a)}(c(e,{type:"Polygon",arcs:[t]}).coordinates[0])}return t.forEach((function e(t){switch(t.type){case"GeometryCollection":t.geometries.forEach(e);break;case"Polygon":a(t.arcs);break;case"MultiPolygon":t.arcs.forEach(a)}})),r.forEach((function(e){if(!e._){var t=[],r=[e];for(e._=1,i.push(t);e=r.pop();)t.push(e),e.forEach((function(e){e.forEach((function(e){n[e<0?~e:e].forEach((function(e){e._||(e._=1,r.push(e))}))}))}))}})),r.forEach((function(e){delete e._})),{type:"MultiPolygon",arcs:i.map((function(t){var r,i=[];if(t.forEach((function(e){e.forEach((function(e){e.forEach((function(e){n[e<0?~e:e].length<2&&i.push(e)}))}))})),(r=(i=l(e,i)).length)>1)for(var a,s,u=1,c=o(i[0]);u<r;++u)(a=o(i[u]))>c&&(s=i[0],i[0]=i[u],i[u]=s,c=a);return i})).filter((function(e){return e.length>0}))}}var m=function(e,t){for(var n=0,r=e.length;n<r;){var i=n+r>>>1;e[i]<t?n=i+1:r=i}return n},v=function(e){var t={},n=e.map((function(){return[]}));function r(e,n){e.forEach((function(e){e<0&&(e=~e);var r=t[e];r?r.push(n):t[e]=[n]}))}function i(e,t){e.forEach((function(e){r(e,t)}))}var a={LineString:r,MultiLineString:i,Polygon:i,MultiPolygon:function(e,t){e.forEach((function(e){i(e,t)}))}};for(var o in e.forEach((function e(t,n){"GeometryCollection"===t.type?t.geometries.forEach((function(t){e(t,n)})):t.type in a&&a[t.type](t.arcs,n)})),t)for(var s=t[o],u=s.length,c=0;c<u;++c)for(var l=c+1;l<u;++l){var f,d=s[c],h=s[l];(f=n[d])[o=m(f,h)]!==h&&f.splice(o,0,h),(f=n[h])[o=m(f,d)]!==d&&f.splice(o,0,d)}return n},g=function(e){if(null==e)return r;var t,n,i=e.scale[0],a=e.scale[1],o=e.translate[0],s=e.translate[1];return function(e,r){r||(t=n=0);var u=2,c=e.length,l=new Array(c),f=Math.round((e[0]-o)/i),d=Math.round((e[1]-s)/a);for(l[0]=f-t,t=f,l[1]=d-n,n=d;u<c;)l[u]=e[u],++u;return l}},y=function(e,t){if(e.transform)throw new Error("already quantized");if(t&&t.scale)u=e.bbox;else{if(!((n=Math.floor(t))>=2))throw new Error("n must be \u22652");var n,r=(u=e.bbox||a(e))[0],i=u[1],o=u[2],s=u[3];t={scale:[o-r?(o-r)/(n-1):1,s-i?(s-i)/(n-1):1],translate:[r,i]}}var u,c,l=g(t),f=e.objects,d={};function h(e){return l(e)}function p(e){var t;switch(e.type){case"GeometryCollection":t={type:"GeometryCollection",geometries:e.geometries.map(p)};break;case"Point":t={type:"Point",coordinates:h(e.coordinates)};break;case"MultiPoint":t={type:"MultiPoint",coordinates:e.coordinates.map(h)};break;default:return e}return null!=e.id&&(t.id=e.id),null!=e.bbox&&(t.bbox=e.bbox),null!=e.properties&&(t.properties=e.properties),t}for(c in f)d[c]=p(f[c]);return{type:"Topology",bbox:u,transform:t,objects:d,arcs:e.arcs.map((function(e){var t,n=0,r=1,i=e.length,a=new Array(i);for(a[0]=l(e[0],0);++n<i;)((t=l(e[n],n))[0]||t[1])&&(a[r++]=t);return 1===r&&(a[r++]=[0,0]),a.length=r,a}))}};n.d(t,!1,(function(){return a})),n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return f})),n.d(t,!1,(function(){return d})),n.d(t,!1,(function(){return h})),n.d(t,!1,(function(){return p})),n.d(t,!1,(function(){return v})),n.d(t,!1,(function(){return y})),n.d(t,!1,(function(){return i})),n.d(t,!1,(function(){return g}))},function(e,t,n){"use strict";(function(r,i){function a(){return"object"==typeof r&&void 0!==e&&void 0!==i&&!!i.version}n.d(t,"a",(function(){return a}))}).call(this,n(59),n(75))},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return a}));var r=n(5),i=n(131);function a(){var t=e.Canvas||e.HTMLCanvasElement,n=e.Image||e.HTMLImageElement,a=e.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},o=Object(i.a)();return Object(r.a)({Canvas:t||function(){},CanvasRenderingContext2D:e.CanvasRenderingContext2D||function(){},Image:n||function(){},ImageData:e.ImageData||function(){},Video:e.HTMLVideoElement||function(){},createCanvasElement:function(){if(t)return new t;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(n)return new n;throw new Error("createImageElement - missing Image implementation for nodejs environment")},fetch:a},o)}}).call(this,n(59))},function(e,t,n){var r=n(90);e.exports={re:r.re,src:r.src,tokens:r.t,SEMVER_SPEC_VERSION:n(117).SEMVER_SPEC_VERSION,SemVer:n(32),compareIdentifiers:n(146).compareIdentifiers,rcompareIdentifiers:n(146).rcompareIdentifiers,parse:n(89),valid:n(348),clean:n(347),inc:n(346),diff:n(345),major:n(344),minor:n(343),patch:n(342),prerelease:n(341),compare:n(48),rcompare:n(340),compareLoose:n(339),compareBuild:n(144),sort:n(338),rsort:n(337),gt:n(114),lt:n(143),eq:n(145),neq:n(204),gte:n(142),lte:n(141),cmp:n(203),coerce:n(336),Comparator:n(113),Range:n(47),satisfies:n(112),toComparators:n(332),maxSatisfying:n(331),minSatisfying:n(330),minVersion:n(329),validRange:n(328),outside:n(140),gtr:n(327),ltr:n(326),intersects:n(325),simplifyRange:n(324),subset:n(323)}},function(e,t,n){"use strict";var r=n(31),i=n(12),a=Object(r.a)((function(e){e.setUTCSeconds(0,0)}),(function(e,t){e.setTime(+e+t*i.c)}),(function(e,t){return(t-e)/i.c}),(function(e){return e.getUTCMinutes()}));t.a=a,a.range},function(e,t,n){"use strict";var r=n(31),i=n(12),a=Object(r.a)((function(e){e.setUTCMinutes(0,0,0)}),(function(e,t){e.setTime(+e+t*i.b)}),(function(e,t){return(t-e)/i.b}),(function(e){return e.getUTCHours()}));t.a=a,a.range},function(e,t,n){"use strict";var r=n(31),i=Object(r.a)((function(){}),(function(e,t){e.setTime(+e+t)}),(function(e,t){return t-e}));i.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?Object(r.a)((function(t){t.setTime(Math.floor(t/e)*e)}),(function(t,n){t.setTime(+t+n*e)}),(function(t,n){return(n-t)/e})):i:null},t.a=i,i.range},function(e,t,n){"use strict";var r=n(31),i=n(12),a=Object(r.a)((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*i.e)}),(function(e,t){e.setTime(+e+t*i.c)}),(function(e,t){return(t-e)/i.c}),(function(e){return e.getMinutes()}));t.a=a,a.range},function(e,t,n){"use strict";var r=n(31),i=n(12),a=Object(r.a)((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*i.e-e.getMinutes()*i.c)}),(function(e,t){e.setTime(+e+t*i.b)}),(function(e,t){return(t-e)/i.b}),(function(e){return e.getHours()}));t.a=a,a.range},function(e,t){},function(e,t){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){var r=n(186);e.exports=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){"use strict";function r(e){this.message=e}r.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},r.prototype.__CANCEL__=!0,e.exports=r},function(e,t,n){"use strict";var r=n(36);e.exports=function(e,t){t=t||{};var n={},i=["url","method","data"],a=["headers","auth","proxy","params"],o=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],s=["validateStatus"];function u(e,t){return r.isPlainObject(e)&&r.isPlainObject(t)?r.merge(e,t):r.isPlainObject(t)?r.merge({},t):r.isArray(t)?t.slice():t}function c(i){r.isUndefined(t[i])?r.isUndefined(e[i])||(n[i]=u(void 0,e[i])):n[i]=u(e[i],t[i])}r.forEach(i,(function(e){r.isUndefined(t[e])||(n[e]=u(void 0,t[e]))})),r.forEach(a,c),r.forEach(o,(function(i){r.isUndefined(t[i])?r.isUndefined(e[i])||(n[i]=u(void 0,e[i])):n[i]=u(void 0,t[i])})),r.forEach(s,(function(r){r in t?n[r]=u(e[r],t[r]):r in e&&(n[r]=u(void 0,e[r]))}));var l=i.concat(a).concat(o).concat(s),f=Object.keys(e).concat(Object.keys(t)).filter((function(e){return-1===l.indexOf(e)}));return r.forEach(f,c),n}},function(e,t,n){"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},function(e,t,n){"use strict";var r=n(193);e.exports=function(e,t,n,i,a){var o=new Error(e);return r(o,t,n,i,a)}},function(e,t,n){"use strict";var r=n(36),i=n(274),a=n(273),o=n(194),s=n(272),u=n(269),c=n(268),l=n(191);e.exports=function(e){return new Promise((function(t,n){var f=e.data,d=e.headers,h=e.responseType;r.isFormData(f)&&delete d["Content-Type"];var p=new XMLHttpRequest;if(e.auth){var m=e.auth.username||"",v=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";d.Authorization="Basic "+btoa(m+":"+v)}var g=s(e.baseURL,e.url);function y(){if(p){var r="getAllResponseHeaders"in p?u(p.getAllResponseHeaders()):null,a={data:h&&"text"!==h&&"json"!==h?p.response:p.responseText,status:p.status,statusText:p.statusText,headers:r,config:e,request:p};i(t,n,a),p=null}}if(p.open(e.method.toUpperCase(),o(g,e.params,e.paramsSerializer),!0),p.timeout=e.timeout,"onloadend"in p?p.onloadend=y:p.onreadystatechange=function(){p&&4===p.readyState&&(0!==p.status||p.responseURL&&0===p.responseURL.indexOf("file:"))&&setTimeout(y)},p.onabort=function(){p&&(n(l("Request aborted",e,"ECONNABORTED",p)),p=null)},p.onerror=function(){n(l("Network Error",e,null,p)),p=null},p.ontimeout=function(){var t="timeout of "+e.timeout+"ms exceeded";e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(l(t,e,e.transitional&&e.transitional.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",p)),p=null},r.isStandardBrowserEnv()){var b=(e.withCredentials||c(g))&&e.xsrfCookieName?a.read(e.xsrfCookieName):void 0;b&&(d[e.xsrfHeaderName]=b)}"setRequestHeader"in p&&r.forEach(d,(function(e,t){void 0===f&&"content-type"===t.toLowerCase()?delete d[t]:p.setRequestHeader(t,e)})),r.isUndefined(e.withCredentials)||(p.withCredentials=!!e.withCredentials),h&&"json"!==h&&(p.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&p.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&p.upload&&p.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then((function(e){p&&(p.abort(),n(e),p=null)})),f||(f=null),p.send(f)}))}},function(e,t,n){"use strict";e.exports=function(e,t,n,r,i){return e.config=t,n&&(e.code=n),e.request=r,e.response=i,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e}},function(e,t,n){"use strict";var r=n(36);function i(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,n){if(!t)return e;var a;if(n)a=n(t);else if(r.isURLSearchParams(t))a=t.toString();else{var o=[];r.forEach(t,(function(e,t){null!==e&&void 0!==e&&(r.isArray(e)?t+="[]":e=[e],r.forEach(e,(function(e){r.isDate(e)?e=e.toISOString():r.isObject(e)&&(e=JSON.stringify(e)),o.push(i(t)+"="+i(e))})))})),a=o.join("&")}if(a){var s=e.indexOf("#");-1!==s&&(e=e.slice(0,s)),e+=(-1===e.indexOf("?")?"?":"&")+a}return e}},function(e,t,n){"use strict";e.exports=function(e,t){return function(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return e.apply(t,n)}}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=i(n(88)),o=n(64),s=n(111),u=n(46);t.linechart=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(this,void 0,void 0,m().mark((function r(){var i,l,f,d,p,v,g,y,b,x,w;return m().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:i=Array.isArray(t.values[0])?t.values:[t.values],l=i[0].length,f=t.series?t.series:i.map((function(e,t){return"Series ".concat(t+1)})),s.assert(f.length===i.length,"Must have an equal number of series labels as there are data series"),null!=n.seriesColors&&s.assert(n.seriesColors.length===i.length,"Must have an equal number of series colors as there are data series"),d=[],p=m().mark((function e(t){var n;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n={x:t},f.forEach((function(e,r){var a=i[r][t].y;n[e]=a,n["".concat(e,"-name")]=e})),d.push(n);case 2:case"end":return e.stop()}}),e)})),v=0;case 5:if(!(v<l)){r.next=10;break}return r.delegateYield(p(v),"t0",7);case 7:v++,r.next=5;break;case 10:return g=Object.assign({},c,n),y={x:{field:"x",type:g.xType,title:g.xLabel},tooltip:[{field:"x",type:"quantitative"}].concat(h(f.map((function(e){return{field:e,type:"quantitative"}}))))},b=f.map((function(e){return{data:void 0,mark:{type:"line",clip:!0},encoding:{y:{field:e,type:g.yType,title:g.yLabel,scale:g.zoomToFit?{zero:!1}:null!=g.yAxisDomain?{domain:g.yAxisDomain}:void 0},color:{field:"".concat(e,"-name"),type:"nominal",legend:{values:f,title:null},scale:{range:g.seriesColors}}}}})),x=u.getDrawArea(e),w={width:g.width||o.getDefaultWidth(x),height:g.height||o.getDefaultHeight(x),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:g.fontSize,titleFontSize:g.fontSize},text:{fontSize:g.fontSize},legend:{labelFontSize:g.fontSize,titleFontSize:g.fontSize}},data:{values:d},encoding:y,layer:[].concat(h(b),[{mark:"rule",selection:{hover:{type:"single",on:"mouseover",nearest:!0,clear:"mouseout"}},encoding:{color:{value:"grey",condition:{selection:{not:"hover"},value:"transparent"}}}}])},r.next=13,a.default(x,w,{actions:!1,mode:"vega-lite",defaultStyle:!1});case 13:return r.abrupt("return",Promise.resolve());case 14:case"end":return r.stop()}}),r)})))};var c={xLabel:"x",yLabel:"y",xType:"quantitative",yType:"quantitative",zoomToFit:!1,fontSize:11}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(292),a="Visor",o="tfjs-visor-container";t.visor=function(){if("undefined"==typeof document)throw new Error("No document defined. This library needs a browser/dom to work");if(document.getElementById(o)&&null!=r)return r;var e,t=document.getElementById(o);function n(t,n){var r=null;return e=i.VisorComponent.render(t,e,{ref:function(e){return r=e},surfaceList:Array.from(n.values())}),r}null==t&&((t=document.createElement("div")).id=o,document.body.appendChild(t));var a=new Map,u=n(t,a);return r=new s(u,t,a,n)};var s=function(){function e(t,n,r,i){v(this,e),this.visorComponent=t,this.el=n,this.surfaceList=r,this.renderVisor=i}return g(e,[{key:"surface",value:function(e){var t=e.name,n=null==e.tab?a:e.tab;if(null==t||!("string"==typeof t||t instanceof String))throw new Error("You must pass a config object with a 'name' property to create or retrieve a surface");var r=Object.assign({},e,{tab:n}),i="".concat(t,"-").concat(n);return this.surfaceList.has(i)||this.surfaceList.set(i,r),this.renderVisor(this.el,this.surfaceList),this.visorComponent.getSurface(t,n)}},{key:"isFullscreen",value:function(){return this.visorComponent.isFullscreen()}},{key:"isOpen",value:function(){return this.visorComponent.isOpen()}},{key:"close",value:function(){return this.visorComponent.close()}},{key:"open",value:function(){return this.visorComponent.open()}},{key:"toggle",value:function(){return this.visorComponent.toggle()}},{key:"toggleFullScreen",value:function(){return this.visorComponent.toggleFullScreen()}},{key:"bindKeys",value:function(){return this.visorComponent.bindKeys()}},{key:"unbindKeys",value:function(){return this.visorComponent.unbindKeys()}},{key:"setActiveTab",value:function(e){if(!this.visorComponent.state.tabs.has(e))throw new Error("Tab '".concat(e,"' does not exist"));this.visorComponent.setState({activeTab:e})}}]),e}();t.Visor=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isSurfaceInfo=function(e){return null!=e.name},t.isSurface=function(e){return e.drawArea instanceof HTMLElement}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},e.exports=t.default},function(e,t,n){"use strict";var r=n(315);e.exports=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.processStyleName=void 0,t.createMarkupForStyles=function(e,t){var n="";for(var i in e){var a=0===i.indexOf("--");if(e.hasOwnProperty(i)&&"label"!==i){var o=e[i];null!=o&&(a?n+=i+":"+o+";":(n+=s(i)+":",n+=(0,r.default)(i,o,t)+";"))}}return n||null},o(n(319));var r=o(n(317)),i=o(n(314)),a=o(n(312));function o(e){return e&&e.__esModule?e:{default:e}}o(n(200));var s=t.processStyleName=(0,a.default)(i.default)},function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return o})),n.d(t,"point",(function(){return s}));var r=n(null),i=n(null),a=n(null);function o(){var e,t,n=Object(a.a)().unknown(void 0),s=n.domain,u=n.range,c=0,l=1,d=!1,h=0,p=0,m=.5;function v(){var n=s().length,i=l<c,a=i?l:c,o=i?c:l;e=(o-a)/Math.max(1,n-h+2*p),d&&(e=Math.floor(e)),a+=(o-a-e*(n-h))*m,t=e*(1-h),d&&(a=Math.round(a),t=Math.round(t));var f=Object(r.a)(n).map((function(t){return a+e*t}));return u(i?f.reverse():f)}return delete n.unknown,n.domain=function(e){return arguments.length?(s(e),v()):s()},n.range=function(e){var t;return arguments.length?(t=f(e,2),c=t[0],l=t[1],c=+c,l=+l,v()):[c,l]},n.rangeRound=function(e){var t;return t=f(e,2),c=t[0],l=t[1],c=+c,l=+l,d=!0,v()},n.bandwidth=function(){return t},n.step=function(){return e},n.round=function(e){return arguments.length?(d=!!e,v()):d},n.padding=function(e){return arguments.length?(h=Math.min(1,p=+e),v()):h},n.paddingInner=function(e){return arguments.length?(h=Math.min(1,e),v()):h},n.paddingOuter=function(e){return arguments.length?(p=+e,v()):p},n.align=function(e){return arguments.length?(m=Math.max(0,Math.min(1,e)),v()):m},n.copy=function(){return o(s(),[c,l]).round(d).paddingInner(h).paddingOuter(p).align(m)},i.a.apply(v(),arguments)}function s(){return function e(t){var n=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,delete t.paddingOuter,t.copy=function(){return e(n())},t}(o.apply(null,arguments).paddingInner(1))}},function(e,t,n){var r=n(145),i=n(204),a=n(114),o=n(142),s=n(143),u=n(141);e.exports=function(e,t,n,c){switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e===n;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e!==n;case"":case"=":case"==":return r(e,n,c);case"!=":return i(e,n,c);case">":return a(e,n,c);case">=":return o(e,n,c);case"<":return s(e,n,c);case"<=":return u(e,n,c);default:throw new TypeError("Invalid operator: ".concat(t))}}},function(e,t,n){var r=n(48);e.exports=function(e,t,n){return 0!==r(e,t,n)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(25),i=n(73),a=n(74),o=n(29),s=n(374),u=n(28);t.div=u.op({div_:function(e,t){var n,u=o.convertToTensor(e,"a","div"),c=o.convertToTensor(t,"b","div");if(n=a.makeTypesMatch(u,c),u=n[0],c=n[1],"int32"===u.dtype&&"int32"===c.dtype)return s.floorDiv(u,c);var l={a:u,b:c};return r.ENGINE.runKernelFunc((function(e,t){var n=e.realDivide(u,c);return t([u,c]),n}),l,null,i.Div,{})}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(25),i=n(73),a=n(74),o=n(29),s=n(28);t.add=s.op({add_:function(e,t){var n,s=o.convertToTensor(e,"a","add"),u=o.convertToTensor(t,"b","add");n=a.makeTypesMatch(s,u),s=n[0],u=n[1];var c={a:s,b:u};return r.ENGINE.runKernelFunc((function(e,t){var n=e.add(s,u);return t([s,u]),n}),c,null,i.Add)}})},function(e,t,n){(function(e){var r=void 0!==e&&e||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function a(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new a(i.call(setTimeout,r,arguments),clearTimeout)},t.setInterval=function(){return new a(i.call(setInterval,r,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},a.prototype.unref=a.prototype.ref=function(){},a.prototype.close=function(){this._clearFn.call(r,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},n(391),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n(59))},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){var n=e.exports={version:"2.6.12"};"number"==typeof __e&&(__e=n)},function(e,t,n){var r=n(27),i=n(82),a=n(41),o=n(106).f;e.exports=function(e){return function(t){for(var n,s=a(t),u=i(s),c=u.length,l=0,f=[];c>l;)n=u[l++],r&&!o.call(s,n)||f.push(e?[n,s[n]]:s[n]);return f}}},function(e,t,n){var r=n(22),i=n(167),a=n(61);e.exports=function(e,t,n,o){var s=String(a(e)),u=s.length,c=void 0===n?" ":String(n),l=r(t);if(l<=u||""==c)return s;var f=l-u,d=i.call(c,Math.ceil(f/c.length));return d.length>f&&(d=d.slice(0,f)),o?d+s:s+d}},function(e,t,n){var r=n(79),i=n(127),a=n(14),o=n(16).Reflect;e.exports=o&&o.ownKeys||function(e){var t=r.f(a(e)),n=i.f;return n?t.concat(n(e)):t}},function(e,t,n){var r=n(54),i=n(22);e.exports=function(e){if(void 0===e)return 0;var t=r(e),n=i(t);if(t!==n)throw RangeError("Wrong length!");return n}},function(e,t,n){"use strict";var r=n(93),i=n(65).getWeak,a=n(14),o=n(13),s=n(94),u=n(121),c=n(51),l=n(43),f=n(76),d=c(5),h=c(6),p=0,m=function(e){return e._l||(e._l=new v)},v=function(){this.a=[]},g=function(e,t){return d(e.a,(function(e){return e[0]===t}))};v.prototype={get:function(e){var t=g(this,e);if(t)return t[1]},has:function(e){return!!g(this,e)},set:function(e,t){var n=g(this,e);n?n[1]=t:this.a.push([e,t])},delete:function(e){var t=h(this.a,(function(t){return t[0]===e}));return~t&&this.a.splice(t,1),!!~t}},e.exports={getConstructor:function(e,t,n,a){var c=e((function(e,r){s(e,c,t,"_i"),e._t=t,e._i=p++,e._l=void 0,void 0!=r&&u(r,n,e[a],e)}));return r(c.prototype,{delete:function(e){if(!o(e))return!1;var n=i(e);return!0===n?m(f(this,t)).delete(e):n&&l(n,this._i)&&delete n[this._i]},has:function(e){if(!o(e))return!1;var n=i(e);return!0===n?m(f(this,t)).has(e):n&&l(n,this._i)}}),c},def:function(e,t,n){var r=i(a(t),!0);return!0===r?m(e).set(t,n):r[e._i]=n,e},ufstore:m}},function(e,t,n){"use strict";var r=n(26).f,i=n(80),a=n(93),o=n(56),s=n(94),u=n(121),c=n(163),l=n(221),f=n(95),d=n(27),h=n(65).fastKey,p=n(76),m=d?"_s":"size",v=function(e,t){var n,r=h(t);if("F"!==r)return e._i[r];for(n=e._f;n;n=n.n)if(n.k==t)return n};e.exports={getConstructor:function(e,t,n,c){var l=e((function(e,r){s(e,l,t,"_i"),e._t=t,e._i=i(null),e._f=void 0,e._l=void 0,e[m]=0,void 0!=r&&u(r,n,e[c],e)}));return a(l.prototype,{clear:function(){for(var e=p(this,t),n=e._i,r=e._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete n[r.i];e._f=e._l=void 0,e[m]=0},delete:function(e){var n=p(this,t),r=v(n,e);if(r){var i=r.n,a=r.p;delete n._i[r.i],r.r=!0,a&&(a.n=i),i&&(i.p=a),n._f==r&&(n._f=i),n._l==r&&(n._l=a),n[m]--}return!!r},forEach:function(e){p(this,t);for(var n,r=o(e,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(r(n.v,n.k,this);n&&n.r;)n=n.p},has:function(e){return!!v(p(this,t),e)}}),d&&r(l.prototype,"size",{get:function(){return p(this,t)[m]}}),l},def:function(e,t,n){var r,i,a=v(e,t);return a?a.v=n:(e._l=a={i:i=h(t,!0),k:t,v:n,p:r=e._l,n:void 0,r:!1},e._f||(e._f=a),r&&(r.n=a),e[m]++,"F"!==i&&(e._i[i]=a)),e},getEntry:v,setStrong:function(e,t,n){c(e,t,(function(e,n){this._t=p(e,t),this._k=n,this._l=void 0}),(function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?l(0,"keys"==e?t.k:"values"==e?t.v:[t.k,t.v]):(this._t=void 0,l(1))}),n?"entries":"values",!n,!0),f(t)}}},function(e,t,n){var r=n(14),i=n(13),a=n(217);e.exports=function(e,t){if(r(e),i(t)&&t.constructor===e)return t;var n=a.f(e);return(0,n.resolve)(t),n.promise}},function(e,t,n){"use strict";var r=n(55);e.exports.f=function(e){return new function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=r(t),this.reject=r(n)}(e)}},function(e,t,n){"use strict";var r,i,a,o,s=n(83),u=n(16),c=n(56),l=n(105),f=n(8),d=n(13),h=n(55),p=n(94),m=n(121),v=n(104),g=n(152).set,y=n(466)(),b=n(217),x=n(465),w=n(120),_=n(216),k=u.TypeError,E=u.process,S=E&&E.versions,C=S&&S.v8||"",A=u.Promise,O="process"==l(E),D=function(){},T=i=b.f,j=!!function(){try{var e=A.resolve(1),t=(e.constructor={})[n(19)("species")]=function(e){e(D,D)};return(O||"function"==typeof PromiseRejectionEvent)&&e.then(D)instanceof t&&0!==C.indexOf("6.6")&&-1===w.indexOf("Chrome/66")}catch(e){}}(),M=function(e){var t;return!(!d(e)||"function"!=typeof(t=e.then))&&t},F=function(e,t){if(!e._n){e._n=!0;var n=e._c;y((function(){for(var r=e._v,i=1==e._s,a=0,o=function(t){var n,a,o,s=i?t.ok:t.fail,u=t.resolve,c=t.reject,l=t.domain;try{s?(i||(2==e._h&&R(e),e._h=1),!0===s?n=r:(l&&l.enter(),n=s(r),l&&(l.exit(),o=!0)),n===t.promise?c(k("Promise-chain cycle")):(a=M(n))?a.call(n,u,c):u(n)):c(r)}catch(e){l&&!o&&l.exit(),c(e)}};n.length>a;)o(n[a++]);e._c=[],e._n=!1,t&&!e._h&&I(e)}))}},I=function(e){g.call(u,(function(){var t,n,r,i=e._v,a=N(e);if(a&&(t=x((function(){O?E.emit("unhandledRejection",i,e):(n=u.onunhandledrejection)?n({promise:e,reason:i}):(r=u.console)&&r.error&&r.error("Unhandled promise rejection",i)})),e._h=O||N(e)?2:1),e._a=void 0,a&&t.e)throw t.v}))},N=function(e){return 1!==e._h&&0===(e._a||e._c).length},R=function(e){g.call(u,(function(){var t;O?E.emit("rejectionHandled",e):(t=u.onrejectionhandled)&&t({promise:e,reason:e._v})}))},P=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),F(t,!0))},B=function e(t){var n,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===t)throw k("Promise can't be resolved itself");(n=M(t))?y((function(){var i={_w:r,_d:!1};try{n.call(t,c(e,i,1),c(P,i,1))}catch(t){P.call(i,t)}})):(r._v=t,r._s=1,F(r,!1))}catch(t){P.call({_w:r,_d:!1},t)}}};j||(A=function(e){p(this,A,"Promise","_h"),h(e),r.call(this);try{e(c(B,this,1),c(P,this,1))}catch(e){P.call(this,e)}},(r=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=n(93)(A.prototype,{then:function(e,t){var n=T(v(this,A));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=O?E.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&F(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),a=function(){var e=new r;this.promise=e,this.resolve=c(B,e,1),this.reject=c(P,e,1)},b.f=T=function(e){return e===A||e===o?new a(e):i(e)}),f(f.G+f.W+f.F*!j,{Promise:A}),n(98)(A,"Promise"),n(95)("Promise"),o=n(24).Promise,f(f.S+f.F*!j,"Promise",{reject:function(e){var t=T(this);return(0,t.reject)(e),t.promise}}),f(f.S+f.F*(s||!j),"Promise",{resolve:function(e){return _(s&&this===o?A:this,e)}}),f(f.S+f.F*!(j&&n(125)((function(e){A.all(e).catch(D)}))),"Promise",{all:function(e){var t=this,n=T(t),r=n.resolve,i=n.reject,a=x((function(){var n=[],a=0,o=1;m(e,!1,(function(e){var s=a++,u=!1;n.push(void 0),o++,t.resolve(e).then((function(e){u||(u=!0,n[s]=e,--o||r(n))}),i)})),--o||r(n)}));return a.e&&i(a.v),n.promise},race:function(e){var t=this,n=T(t),r=n.reject,i=x((function(){m(e,!1,(function(e){t.resolve(e).then(n.resolve,r)}))}));return i.e&&r(i.v),n.promise}})},function(e,t,n){n(27)&&"g"!=/./g.flags&&n(26).f(RegExp.prototype,"flags",{configurable:!0,get:n(124)})},function(e,t,n){"use strict";var r=n(154);n(8)({target:"RegExp",proto:!0,forced:r!==/./.exec},{exec:r})},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,n){"use strict";var r=n(34),i=n(81),a=n(22);e.exports=[].copyWithin||function(e,t){var n=r(this),o=a(n.length),s=i(e,o),u=i(t,o),c=arguments.length>2?arguments[2]:void 0,l=Math.min((void 0===c?o:i(c,o))-u,o-s),f=1;for(u<s&&s<u+l&&(f=-1,u+=l-1,s+=l-1);l-- >0;)u in n?n[s]=n[u]:delete n[s],s+=f,u+=f;return n}},function(e,t,n){var r=n(55),i=n(34),a=n(107),o=n(22);e.exports=function(e,t,n,s,u){r(t);var c=i(e),l=a(c),f=o(c.length),d=u?f-1:0,h=u?-1:1;if(n<2)for(;;){if(d in l){s=l[d],d+=h;break}if(d+=h,u?d<0:f<=d)throw TypeError("Reduce of empty array with no initial value")}for(;u?d>=0:f>d;d+=h)d in l&&(s=t(s,l[d],d,c));return s}},function(e,t,n){var r=n(486);e.exports=function(e,t){return new(r(e))(t)}},function(e,t,n){var r=n(14);e.exports=function(e,t,n,i){try{return i?t(r(n)[0],n[1]):t(n)}catch(t){var a=e.return;throw void 0!==a&&r(a.call(e)),t}}},function(e,t,n){"use strict";var r=n(80),i=n(85),a=n(98),o={};n(42)(o,n(19)("iterator"),(function(){return this})),e.exports=function(e,t,n){e.prototype=r(o,{next:i(1,n)}),a(e,t+" Iterator")}},function(e,t){e.exports=Math.log1p||function(e){return(e=+e)>-1e-8&&e<1e-8?e-e*e/2:Math.log(1+e)}},function(e,t,n){var r=n(13),i=Math.floor;e.exports=function(e){return!r(e)&&isFinite(e)&&i(e)===e}},function(e,t,n){var r=n(62);e.exports=function(e,t){if("number"!=typeof e&&"Number"!=r(e))throw TypeError(t);return+e}},function(e,t,n){var r=n(16).parseFloat,i=n(97).trim;e.exports=1/r(n(169)+"-0")!=-1/0?function(e){var t=i(String(e),3),n=r(t);return 0===n&&"-"==t.charAt(0)?-0:n}:r},function(e,t,n){var r=n(16).parseInt,i=n(97).trim,a=n(169),o=/^[-+]?0[xX]/;e.exports=8!==r(a+"08")||22!==r(a+"0x16")?function(e,t){var n=i(String(e),3);return r(n,t>>>0||(o.test(n)?16:10))}:r},function(e,t){e.exports=function(e,t,n){var r=void 0===n;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},function(e,t,n){"use strict";var r=n(55),i=n(13),a=n(232),o=[].slice,s={};e.exports=Function.bind||function(e){var t=r(this),n=o.call(arguments,1),u=function r(){var i=n.concat(o.call(arguments));return this instanceof r?function(e,t,n){if(!(t in s)){for(var r=[],i=0;i<t;i++)r[i]="a["+i+"]";s[t]=Function("F,a","return new F("+r.join(",")+")")}return s[t](e,n)}(t,i.length,i):a(t,i,e)};return i(t.prototype)&&(u.prototype=t.prototype),u}},function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}},function(e,t,n){"use strict";var r=n(27),i=n(82),a=n(127),o=n(106),s=n(34),u=n(107),c=Object.assign;e.exports=!c||n(15)((function(){var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach((function(e){t[e]=e})),7!=c({},e)[n]||Object.keys(c({},t)).join("")!=r}))?function(e,t){for(var n=s(e),c=arguments.length,l=1,f=a.f,d=o.f;c>l;)for(var h,p=u(arguments[l++]),m=f?i(p).concat(f(p)):i(p),v=m.length,g=0;v>g;)h=m[g++],r&&!d.call(p,h)||(n[h]=p[h]);return n}:c},function(e,t,n){var r=n(41),i=n(79).f,a={}.toString,o="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return o&&"[object Window]"==a.call(e)?function(e){try{return i(e)}catch(e){return o.slice()}}(e):i(r(e))}},function(e,t,n){var r=n(26),i=n(14),a=n(82);e.exports=n(27)?Object.defineProperties:function(e,t){i(e);for(var n,o=a(t),s=o.length,u=0;s>u;)r.f(e,n=o[u++],t[n]);return e}},function(e,t,n){var r=n(43),i=n(41),a=n(128)(!1),o=n(173)("IE_PROTO");e.exports=function(e,t){var n,s=i(e),u=0,c=[];for(n in s)n!=o&&r(s,n)&&c.push(n);for(;t.length>u;)r(s,n=t[u++])&&(~a(c,n)||c.push(n));return c}},function(e,t,n){var r=n(16),i=n(24),a=n(83),o=n(174),s=n(26).f;e.exports=function(e){var t=i.Symbol||(i.Symbol=a?{}:r.Symbol||{});"_"==e.charAt(0)||e in t||s(t,e,{value:o.f(e)})}},function(e,t,n){e.exports=!n(27)&&!n(15)((function(){return 7!=Object.defineProperty(n(175)("div"),"a",{get:function(){return 7}}).a}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2);t.tf=r,function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(257))},function(e,t,n){!function(e,t,n){"use strict";var r={1:{name:"/m/01g317",id:1,displayName:"person"},2:{name:"/m/0199g",id:2,displayName:"bicycle"},3:{name:"/m/0k4j",id:3,displayName:"car"},4:{name:"/m/04_sv",id:4,displayName:"motorcycle"},5:{name:"/m/05czz6l",id:5,displayName:"airplane"},6:{name:"/m/01bjv",id:6,displayName:"bus"},7:{name:"/m/07jdr",id:7,displayName:"train"},8:{name:"/m/07r04",id:8,displayName:"truck"},9:{name:"/m/019jd",id:9,displayName:"boat"},10:{name:"/m/015qff",id:10,displayName:"traffic light"},11:{name:"/m/01pns0",id:11,displayName:"fire hydrant"},13:{name:"/m/02pv19",id:13,displayName:"stop sign"},14:{name:"/m/015qbp",id:14,displayName:"parking meter"},15:{name:"/m/0cvnqh",id:15,displayName:"bench"},16:{name:"/m/015p6",id:16,displayName:"bird"},17:{name:"/m/01yrx",id:17,displayName:"cat"},18:{name:"/m/0bt9lr",id:18,displayName:"dog"},19:{name:"/m/03k3r",id:19,displayName:"horse"},20:{name:"/m/07bgp",id:20,displayName:"sheep"},21:{name:"/m/01xq0k1",id:21,displayName:"cow"},22:{name:"/m/0bwd_0j",id:22,displayName:"elephant"},23:{name:"/m/01dws",id:23,displayName:"bear"},24:{name:"/m/0898b",id:24,displayName:"zebra"},25:{name:"/m/03bk1",id:25,displayName:"giraffe"},27:{name:"/m/01940j",id:27,displayName:"backpack"},28:{name:"/m/0hnnb",id:28,displayName:"umbrella"},31:{name:"/m/080hkjn",id:31,displayName:"handbag"},32:{name:"/m/01rkbr",id:32,displayName:"tie"},33:{name:"/m/01s55n",id:33,displayName:"suitcase"},34:{name:"/m/02wmf",id:34,displayName:"frisbee"},35:{name:"/m/071p9",id:35,displayName:"skis"},36:{name:"/m/06__v",id:36,displayName:"snowboard"},37:{name:"/m/018xm",id:37,displayName:"sports ball"},38:{name:"/m/02zt3",id:38,displayName:"kite"},39:{name:"/m/03g8mr",id:39,displayName:"baseball bat"},40:{name:"/m/03grzl",id:40,displayName:"baseball glove"},41:{name:"/m/06_fw",id:41,displayName:"skateboard"},42:{name:"/m/019w40",id:42,displayName:"surfboard"},43:{name:"/m/0dv9c",id:43,displayName:"tennis racket"},44:{name:"/m/04dr76w",id:44,displayName:"bottle"},46:{name:"/m/09tvcd",id:46,displayName:"wine glass"},47:{name:"/m/08gqpm",id:47,displayName:"cup"},48:{name:"/m/0dt3t",id:48,displayName:"fork"},49:{name:"/m/04ctx",id:49,displayName:"knife"},50:{name:"/m/0cmx8",id:50,displayName:"spoon"},51:{name:"/m/04kkgm",id:51,displayName:"bowl"},52:{name:"/m/09qck",id:52,displayName:"banana"},53:{name:"/m/014j1m",id:53,displayName:"apple"},54:{name:"/m/0l515",id:54,displayName:"sandwich"},55:{name:"/m/0cyhj_",id:55,displayName:"orange"},56:{name:"/m/0hkxq",id:56,displayName:"broccoli"},57:{name:"/m/0fj52s",id:57,displayName:"carrot"},58:{name:"/m/01b9xk",id:58,displayName:"hot dog"},59:{name:"/m/0663v",id:59,displayName:"pizza"},60:{name:"/m/0jy4k",id:60,displayName:"donut"},61:{name:"/m/0fszt",id:61,displayName:"cake"},62:{name:"/m/01mzpv",id:62,displayName:"chair"},63:{name:"/m/02crq1",id:63,displayName:"couch"},64:{name:"/m/03fp41",id:64,displayName:"potted plant"},65:{name:"/m/03ssj5",id:65,displayName:"bed"},67:{name:"/m/04bcr3",id:67,displayName:"dining table"},70:{name:"/m/09g1w",id:70,displayName:"toilet"},72:{name:"/m/07c52",id:72,displayName:"tv"},73:{name:"/m/01c648",id:73,displayName:"laptop"},74:{name:"/m/020lf",id:74,displayName:"mouse"},75:{name:"/m/0qjjc",id:75,displayName:"remote"},76:{name:"/m/01m2v",id:76,displayName:"keyboard"},77:{name:"/m/050k8",id:77,displayName:"cell phone"},78:{name:"/m/0fx9l",id:78,displayName:"microwave"},79:{name:"/m/029bxz",id:79,displayName:"oven"},80:{name:"/m/01k6s3",id:80,displayName:"toaster"},81:{name:"/m/0130jx",id:81,displayName:"sink"},82:{name:"/m/040b_t",id:82,displayName:"refrigerator"},84:{name:"/m/0bt_c3",id:84,displayName:"book"},85:{name:"/m/01x3z",id:85,displayName:"clock"},86:{name:"/m/02s195",id:86,displayName:"vase"},87:{name:"/m/01lsmm",id:87,displayName:"scissors"},88:{name:"/m/0kmg4",id:88,displayName:"teddy bear"},89:{name:"/m/03wvsk",id:89,displayName:"hair drier"},90:{name:"/m/012xff",id:90,displayName:"toothbrush"}},i=function(){function e(t,n){v(this,e),this.modelPath=n||"https://storage.googleapis.com/tfjs-models/savedmodel/".concat(this.getPrefix(t),"/model.json")}return g(e,[{key:"getPrefix",value:function(e){return"lite_mobilenet_v2"===e?"ssd".concat(e):"ssd_".concat(e)}},{key:"load",value:function(){var e=d(m().mark((function e(){var r,i;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.loadGraphModel(this.modelPath);case 2:return this.model=e.sent,r=n.zeros([1,300,300,3],"int32"),e.next=6,this.model.executeAsync(r);case 6:return i=e.sent,e.next=9,Promise.all(i.map((function(e){return e.data()})));case 9:i.map((function(e){return e.dispose()})),r.dispose();case 11:case"end":return e.stop()}}),e,this)})));function r(){return e.apply(this,arguments)}return r}()},{key:"infer",value:function(){var e=d(m().mark((function e(t,r,i){var a,o,s,u,c,l,d,h,p,v,g,y,b;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.tidy((function(){return t instanceof n.Tensor||(t=n.browser.fromPixels(t)),n.expandDims(t)})),o=a.shape[1],s=a.shape[2],e.next=5,this.model.executeAsync(a);case 5:return u=e.sent,c=u[0].dataSync(),l=u[1].dataSync(),a.dispose(),n.dispose(u),d=this.calculateMaxScores(c,u[0].shape[1],u[0].shape[2]),h=f(d,2),p=h[0],v=h[1],g=n.getBackend(),"webgl"===n.getBackend()&&n.setBackend("cpu"),y=n.tidy((function(){var e=n.tensor2d(l,[u[1].shape[1],u[1].shape[3]]);return n.image.nonMaxSuppression(e,p,r,i,i)})),b=y.dataSync(),e.abrupt("return",(y.dispose(),g!==n.getBackend()&&n.setBackend(g),this.buildDetectedObjects(s,o,l,p,b,v)));case 13:case"end":return e.stop()}}),e,this)})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"buildDetectedObjects",value:function(e,t,n,i,a,o){for(var s=a.length,u=[],c=0;c<s;c++){for(var l=[],f=0;f<4;f++)l[f]=n[4*a[c]+f];var d=l[0]*t,h=l[1]*e,p=l[2]*t,m=l[3]*e;l[0]=h,l[1]=d,l[2]=m-h,l[3]=p-d,u.push({bbox:l,class:r[o[a[c]]+1].displayName,score:i[a[c]]})}return u}},{key:"calculateMaxScores",value:function(e,t,n){for(var r=[],i=[],a=0;a<t;a++){for(var o=Number.MIN_VALUE,s=-1,u=0;u<n;u++)e[a*n+u]>o&&(o=e[a*n+u],s=u);r[a]=o,i[a]=s}return[r,i]}},{key:"detect",value:function(){var e=d(m().mark((function e(t){var n,r,i=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:20,r=i.length>2&&void 0!==i[2]?i[2]:.5,e.abrupt("return",this.infer(t,n,r));case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"dispose",value:function(){null!=this.model&&this.model.dispose()}}]),e}();e.ObjectDetection=i,e.load=d(m().mark((function e(){var t,r,a,o,s=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.length>0&&void 0!==s[0]?s[0]:{},null!=n){e.next=3;break}throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this model.");case 3:if(r=t.base||"lite_mobilenet_v2",a=t.modelUrl,-1!==["mobilenet_v1","mobilenet_v2","lite_mobilenet_v2"].indexOf(r)){e.next=6;break}throw new Error("ObjectDetection constructed with invalid base model ".concat(r,". Valid names are 'mobilenet_v1', 'mobilenet_v2' and 'lite_mobilenet_v2'."));case 6:return o=new i(r,a),e.next=9,o.load();case 9:return e.abrupt("return",o);case 10:case"end":return e.stop()}}),e)}))),e.version="2.2.2",Object.defineProperty(e,"__esModule",{value:!0})}(t,n(20),n(0))},function(e,t,n){"use strict";e.exports=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var r,i,a;if(Array.isArray(t)){if((r=t.length)!=n.length)return!1;for(i=r;0!=i--;)if(!e(t[i],n[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((r=(a=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(i=r;0!=i--;)if(!Object.prototype.hasOwnProperty.call(n,a[i]))return!1;for(i=r;0!=i--;){var o=a[i];if(!e(t[o],n[o]))return!1}return!0}return t!=t&&n!=n}},function(e,t,n){(function(t){var n=function(){"use strict";function e(e,t){return null!=t&&e instanceof t}var n,r,i;try{n=Map}catch(e){n=function(){}}try{r=Set}catch(e){r=function(){}}try{i=Promise}catch(e){i=function(){}}function a(o,u,c,l,f){"object"==typeof u&&(c=u.depth,l=u.prototype,f=u.includeNonEnumerable,u=u.circular);var d=[],h=[],p=void 0!==t;return void 0===u&&(u=!0),void 0===c&&(c=1/0),function o(c,m){if(null===c)return null;if(0===m)return c;var v,g;if("object"!=typeof c)return c;if(e(c,n))v=new n;else if(e(c,r))v=new r;else if(e(c,i))v=new i((function(e,t){c.then((function(t){e(o(t,m-1))}),(function(e){t(o(e,m-1))}))}));else if(a.__isArray(c))v=[];else if(a.__isRegExp(c))v=new RegExp(c.source,s(c)),c.lastIndex&&(v.lastIndex=c.lastIndex);else if(a.__isDate(c))v=new Date(c.getTime());else{if(p&&t.isBuffer(c))return v=t.allocUnsafe?t.allocUnsafe(c.length):new t(c.length),c.copy(v),v;e(c,Error)?v=Object.create(c):void 0===l?(g=Object.getPrototypeOf(c),v=Object.create(g)):(v=Object.create(l),g=l)}if(u){var y=d.indexOf(c);if(-1!=y)return h[y];d.push(c),h.push(v)}for(var b in e(c,n)&&c.forEach((function(e,t){var n=o(t,m-1),r=o(e,m-1);v.set(n,r)})),e(c,r)&&c.forEach((function(e){var t=o(e,m-1);v.add(t)})),c){var x;g&&(x=Object.getOwnPropertyDescriptor(g,b)),x&&null==x.set||(v[b]=o(c[b],m-1))}if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(c);for(b=0;b<w.length;b++){var _=w[b];(!(E=Object.getOwnPropertyDescriptor(c,_))||E.enumerable||f)&&(v[_]=o(c[_],m-1),E.enumerable||Object.defineProperty(v,_,{enumerable:!1}))}}if(f){var k=Object.getOwnPropertyNames(c);for(b=0;b<k.length;b++){var E,S=k[b];(E=Object.getOwnPropertyDescriptor(c,S))&&E.enumerable||(v[S]=o(c[S],m-1),Object.defineProperty(v,S,{enumerable:!1}))}}return v}(o,c)}function o(e){return Object.prototype.toString.call(e)}function s(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),t}return a.clonePrototype=function(e){if(null===e)return null;var t=function(){};return t.prototype=e,new t},a.__objToStr=o,a.__isDate=function(e){return"object"==typeof e&&"[object Date]"===o(e)},a.__isArray=function(e){return"object"==typeof e&&"[object Array]"===o(e)},a.__isRegExp=function(e){return"object"==typeof e&&"[object RegExp]"===o(e)},a.__getRegExpFlags=s,a}();"object"==typeof e&&e.exports&&(e.exports=n)}).call(this,n(92).Buffer)},function(e){e.exports={name:"vega-lite",author:'Dominik Moritz, Kanit "Ham" Wongsuphasawat, Arvind Satyanarayan, Jeffrey Heer',version:"4.13.1",collaborators:["Kanit Wongsuphasawat (http://kanitw.yellowpigz.com)","Dominik Moritz (https://www.domoritz.de)","Arvind Satyanarayan (https://arvindsatya.com)","Jeffrey Heer (https://jheer.org)"],homepage:"https://vega.github.io/vega-lite/",description:"Vega-Lite is a concise high-level language for interactive visualization.",main:"build/vega-lite.js",unpkg:"build/vega-lite.min.js",jsdelivr:"build/vega-lite.min.js",module:"build/src/index",types:"build/src/index.d.ts",bin:{vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2pdf:"./bin/vl2pdf",vl2vg:"./bin/vl2vg"},directories:{test:"test"},scripts:{changelog:"conventional-changelog -p angular -r 2",build:"yarn build:only","build:only":"yarn tsc:src && rollup -c",postbuild:"terser build/vega-lite.js -cm --source-map content=build/vega-lite.js.map,filename=build/vega-lite.min.js.map -o build/vega-lite.min.js && yarn schema && babel build/vega-lite.js --out-dir build-es5 --config-file ./babel.config.js","prebuild:examples":"yarn build:only","build:examples":"yarn data && TZ=America/Los_Angeles scripts/build-examples.sh","prebuild:examples-full":"yarn build:only","build:examples-full":"TZ=America/Los_Angeles scripts/build-examples.sh 1","build:example":"TZ=America/Los_Angeles scripts/build-example.sh","build:toc":"yarn build:jekyll && scripts/generate-toc","build:site":"yarn tsc:site && rollup -c site/rollup.config.js","build:jekyll":"pushd site && bundle exec jekyll build -q && popd","build:versions":"scripts/update-version.sh",clean:"find build ! -name 'vega-lite-schema.json' -type f -delete && rm -rf site/data/* && rm -f examples/compiled/*.png && find site/examples ! -name 'index.md' ! -name 'data' -type f -delete","predeploy:site":"yarn presite","deploy:site":"gh-pages -d site",data:"rsync -r node_modules/vega-datasets/data/* site/data",schema:"mkdir -p build && ts-json-schema-generator -f tsconfig.json -p src/index.ts -t TopLevelSpec --no-type-check --no-ref-encode > build/vega-lite-schema.json && yarn renameschema && cp build/vega-lite-schema.json site/_data/",renameschema:"scripts/rename-schema.sh",presite:"yarn data && yarn schema && yarn build:site && yarn build:versions && scripts/create-example-pages.sh",site:"pushd site && bundle exec jekyll serve -I -l && popd","tsc:src":"tsc -b src/tsconfig.src.json","tsc:site":"tsc -b site/tsconfig.site.json",prettierbase:"prettier '**/*.{md,css,yml}'",eslintbase:"eslint .",format:"yarn eslintbase --fix && yarn prettierbase --write",lint:"yarn eslintbase && yarn prettierbase --check",test:"jest test/ && yarn lint && yarn schema && jest examples/ && yarn test:runtime","test:inspect":"node --inspect-brk ./node_modules/.bin/jest --runInBand test","test:runtime":"TZ=America/Los_Angeles jest test-runtime/","test:runtime:generate":"yarn build:only && rm -Rf test-runtime/resources && VL_GENERATE_TESTS=true yarn test:runtime","watch:build":"yarn build:only && concurrently --kill-others -n Typescript,Rollup 'yarn tsc:src -w' 'rollup -c -w'","watch:site":"concurrently --kill-others -n Typescript,Rollup 'yarn tsc:site -w' 'rollup -c site/rollup.config.js -w'","watch:test":"jest --watch"},repository:{type:"git",url:"https://github.com/vega/vega-lite.git"},license:"BSD-3-Clause",bugs:{url:"https://github.com/vega/vega-lite/issues"},devDependencies:{"@babel/cli":"^7.10.1","@babel/core":"^7.10.1","@babel/preset-env":"^7.10.1","@rollup/plugin-commonjs":"12.0.0","@rollup/plugin-json":"^4.0.3","@rollup/plugin-node-resolve":"^8.0.0","@types/chai":"^4.2.11","@types/d3":"^5.7.2","@types/jest":"^25.2.3","@types/mkdirp":"^1.0.0","@types/puppeteer":"^3.0.0","@typescript-eslint/eslint-plugin":"^3.0.2","@typescript-eslint/parser":"^3.0.2",ajv:"^6.12.2",chai:"^4.2.0",cheerio:"^1.0.0-rc.3",codecov:"^3.7.0",concurrently:"^5.2.0","conventional-changelog-cli":"^2.0.34",d3:"^5.16.0",eslint:"^7.1.0","eslint-config-prettier":"^6.11.0","eslint-plugin-jest":"^23.13.2","eslint-plugin-prettier":"^3.1.3","gh-pages":"^2.2.0","highlight.js":"^10.0.3","http-server":"^0.12.3",jest:"^26.0.1","jest-puppeteer":"^4.4.0",mkdirp:"^1.0.4",prettier:"^2.0.5",puppeteer:"^3.1.0",rollup:"^2.11.0","rollup-plugin-sourcemaps":"^0.6.2","rollup-plugin-terser":"^6.1.0","svg2png-many":"^0.0.7",terser:"^4.7.0","ts-jest":"^26.0.0","ts-json-schema-generator":"^0.68.1",typescript:"~3.9.3","vega-cli":"^5.12.1","vega-datasets":"^1.30.2","vega-embed":"^6.8.0","vega-tooltip":"^0.23.0","vega-typings":"^0.17.0","yaml-front-matter":"^4.1.0"},dependencies:{"@types/clone":"~0.1.30","@types/fast-json-stable-stringify":"^2.0.0","array-flat-polyfill":"^1.0.1",clone:"~2.1.2","fast-deep-equal":"~3.1.1","fast-json-stable-stringify":"~2.1.0","json-stringify-pretty-compact":"~2.0.0",tslib:"~2.0.0","vega-event-selector":"~2.0.3","vega-expression":"~2.6.5","vega-util":"~1.14.0",yargs:"~15.3.1"},peerDependencies:{vega:"^5.12.1"},jest:{preset:"jest-puppeteer",transform:{"^.+\\.tsx?$":"ts-jest"},testRegex:"(/__tests__/.*|(\\.|/)(test|spec))\\.(jsx?|tsx?)$",moduleFileExtensions:["ts","tsx","js","jsx","json","node"],testPathIgnorePatterns:["<rootDir>/node_modules","<rootDir>/build","<rootDir>/_site","<rootDir>/src"],coverageDirectory:"./coverage/",collectCoverage:!1}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r=n(39),i=n(71),a=n(40),o=n(72),s=n(70),u=n(68);function c(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function l(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function f(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function d(e){var t=e.dateTime,n=e.date,s=e.time,u=e.periods,d=e.days,p=e.shortDays,m=e.months,v=e.shortMonths,g=b(u),y=x(u),Z=b(d),ye=x(d),Te=b(p),je=x(p),Me=b(m),Fe=x(m),Ie=b(v),Ne=x(v),Re={a:function(e){return p[e.getDay()]},A:function(e){return d[e.getDay()]},b:function(e){return v[e.getMonth()]},B:function(e){return m[e.getMonth()]},c:null,d:U,e:U,f:H,g:re,G:ae,H:W,I:V,j:G,L:q,m:X,M:K,p:function(e){return u[+(e.getHours()>=12)]},q:function(e){return 1+~~(e.getMonth()/3)},Q:Oe,s:De,S:Y,u:$,U:J,V:Q,w:ee,W:te,x:null,X:null,y:ne,Y:ie,Z:oe,"%":Ae},Pe={a:function(e){return p[e.getUTCDay()]},A:function(e){return d[e.getUTCDay()]},b:function(e){return v[e.getUTCMonth()]},B:function(e){return m[e.getUTCMonth()]},c:null,d:se,e:se,f:de,g:ke,G:Se,H:ue,I:ce,j:le,L:fe,m:he,M:pe,p:function(e){return u[+(e.getUTCHours()>=12)]},q:function(e){return 1+~~(e.getUTCMonth()/3)},Q:Oe,s:De,S:me,u:ve,U:ge,V:be,w:xe,W:we,x:null,X:null,y:_e,Y:Ee,Z:Ce,"%":Ae},Be={a:function(e,t,n){var r=Te.exec(t.slice(n));return r?(e.w=je.get(r[0].toLowerCase()),n+r[0].length):-1},A:function(e,t,n){var r=Z.exec(t.slice(n));return r?(e.w=ye.get(r[0].toLowerCase()),n+r[0].length):-1},b:function(e,t,n){var r=Ie.exec(t.slice(n));return r?(e.m=Ne.get(r[0].toLowerCase()),n+r[0].length):-1},B:function(e,t,n){var r=Me.exec(t.slice(n));return r?(e.m=Fe.get(r[0].toLowerCase()),n+r[0].length):-1},c:function(e,n,r){return Ue(e,t,n,r)},d:j,e:j,f:P,g:A,G:C,H:F,I:F,j:M,L:R,m:T,M:I,p:function(e,t,n){var r=g.exec(t.slice(n));return r?(e.p=y.get(r[0].toLowerCase()),n+r[0].length):-1},q:D,Q:L,s:z,S:N,u:_,U:k,V:E,w:w,W:S,x:function(e,t,r){return Ue(e,n,t,r)},X:function(e,t,n){return Ue(e,s,t,n)},y:A,Y:C,Z:O,"%":B};function Le(e,t){return function(n){var r,i,a,o=[],s=-1,u=0,c=e.length;for(n instanceof Date||(n=new Date(+n));++s<c;)37===e.charCodeAt(s)&&(o.push(e.slice(u,s)),null!=(i=h[r=e.charAt(++s)])?r=e.charAt(++s):i="e"===r?" ":"0",(a=t[r])&&(r=a(n,i)),o.push(r),u=s+1);return o.push(e.slice(u,s)),o.join("")}}function ze(e,t){return function(n){var s,u,d=f(1900,void 0,1);if(Ue(d,e,n+="",0)!=n.length)return null;if("Q"in d)return new Date(d.Q);if("s"in d)return new Date(1e3*d.s+("L"in d?d.L:0));if(!t||"Z"in d||(d.Z=0),"p"in d&&(d.H=d.H%12+12*d.p),void 0===d.m&&(d.m="q"in d?d.q:0),"V"in d){if(d.V<1||d.V>53)return null;"w"in d||(d.w=1),"Z"in d?(s=(u=(s=l(f(d.y,0,1))).getUTCDay())>4||0===u?r.a.ceil(s):Object(r.a)(s),s=i.a.offset(s,7*(d.V-1)),d.y=s.getUTCFullYear(),d.m=s.getUTCMonth(),d.d=s.getUTCDate()+(d.w+6)%7):(s=(u=(s=c(f(d.y,0,1))).getDay())>4||0===u?a.a.ceil(s):Object(a.a)(s),s=o.a.offset(s,7*(d.V-1)),d.y=s.getFullYear(),d.m=s.getMonth(),d.d=s.getDate()+(d.w+6)%7)}else("W"in d||"U"in d)&&("w"in d||(d.w="u"in d?d.u%7:"W"in d?1:0),u="Z"in d?l(f(d.y,0,1)).getUTCDay():c(f(d.y,0,1)).getDay(),d.m=0,d.d="W"in d?(d.w+6)%7+7*d.W-(u+5)%7:d.w+7*d.U-(u+6)%7);return"Z"in d?(d.H+=d.Z/100|0,d.M+=d.Z%100,l(d)):c(d)}}function Ue(e,t,n,r){for(var i,a,o=0,s=t.length,u=n.length;o<s;){if(r>=u)return-1;if(37===(i=t.charCodeAt(o++))){if(i=t.charAt(o++),!(a=Be[i in h?t.charAt(o++):i])||(r=a(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return Re.x=Le(n,Re),Re.X=Le(s,Re),Re.c=Le(t,Re),Pe.x=Le(n,Pe),Pe.X=Le(s,Pe),Pe.c=Le(t,Pe),{format:function(e){var t=Le(e+="",Re);return t.toString=function(){return e},t},parse:function(e){var t=ze(e+="",!1);return t.toString=function(){return e},t},utcFormat:function(e){var t=Le(e+="",Pe);return t.toString=function(){return e},t},utcParse:function(e){var t=ze(e+="",!0);return t.toString=function(){return e},t}}}var h={"-":"",_:" ",0:"0"},p=/^\s*\d+/,m=/^%/,v=/[\\^$*+?|[\]().{}]/g;function g(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",a=i.length;return r+(a<n?new Array(n-a+1).join(t)+i:i)}function y(e){return e.replace(v,"\\$&")}function b(e){return new RegExp("^(?:"+e.map(y).join("|")+")","i")}function x(e){return new Map(e.map((function(e,t){return[e.toLowerCase(),t]})))}function w(e,t,n){var r=p.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function _(e,t,n){var r=p.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function k(e,t,n){var r=p.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function E(e,t,n){var r=p.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function S(e,t,n){var r=p.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function C(e,t,n){var r=p.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function A(e,t,n){var r=p.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function O(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function D(e,t,n){var r=p.exec(t.slice(n,n+1));return r?(e.q=3*r[0]-3,n+r[0].length):-1}function T(e,t,n){var r=p.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function j(e,t,n){var r=p.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function M(e,t,n){var r=p.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function F(e,t,n){var r=p.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function I(e,t,n){var r=p.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function N(e,t,n){var r=p.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function R(e,t,n){var r=p.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function P(e,t,n){var r=p.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function B(e,t,n){var r=m.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function L(e,t,n){var r=p.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function z(e,t,n){var r=p.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function U(e,t){return g(e.getDate(),t,2)}function W(e,t){return g(e.getHours(),t,2)}function V(e,t){return g(e.getHours()%12||12,t,2)}function G(e,t){return g(1+o.a.count(Object(s.a)(e),e),t,3)}function q(e,t){return g(e.getMilliseconds(),t,3)}function H(e,t){return q(e,t)+"000"}function X(e,t){return g(e.getMonth()+1,t,2)}function K(e,t){return g(e.getMinutes(),t,2)}function Y(e,t){return g(e.getSeconds(),t,2)}function $(e){var t=e.getDay();return 0===t?7:t}function J(e,t){return g(a.b.count(Object(s.a)(e)-1,e),t,2)}function Z(e){var t=e.getDay();return t>=4||0===t?Object(a.c)(e):a.c.ceil(e)}function Q(e,t){return e=Z(e),g(a.c.count(Object(s.a)(e),e)+(4===Object(s.a)(e).getDay()),t,2)}function ee(e){return e.getDay()}function te(e,t){return g(a.a.count(Object(s.a)(e)-1,e),t,2)}function ne(e,t){return g(e.getFullYear()%100,t,2)}function re(e,t){return g((e=Z(e)).getFullYear()%100,t,2)}function ie(e,t){return g(e.getFullYear()%1e4,t,4)}function ae(e,t){var n=e.getDay();return g((e=n>=4||0===n?Object(a.c)(e):a.c.ceil(e)).getFullYear()%1e4,t,4)}function oe(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+g(t/60|0,"0",2)+g(t%60,"0",2)}function se(e,t){return g(e.getUTCDate(),t,2)}function ue(e,t){return g(e.getUTCHours(),t,2)}function ce(e,t){return g(e.getUTCHours()%12||12,t,2)}function le(e,t){return g(1+i.a.count(Object(u.a)(e),e),t,3)}function fe(e,t){return g(e.getUTCMilliseconds(),t,3)}function de(e,t){return fe(e,t)+"000"}function he(e,t){return g(e.getUTCMonth()+1,t,2)}function pe(e,t){return g(e.getUTCMinutes(),t,2)}function me(e,t){return g(e.getUTCSeconds(),t,2)}function ve(e){var t=e.getUTCDay();return 0===t?7:t}function ge(e,t){return g(r.b.count(Object(u.a)(e)-1,e),t,2)}function ye(e){var t=e.getUTCDay();return t>=4||0===t?Object(r.c)(e):r.c.ceil(e)}function be(e,t){return e=ye(e),g(r.c.count(Object(u.a)(e),e)+(4===Object(u.a)(e).getUTCDay()),t,2)}function xe(e){return e.getUTCDay()}function we(e,t){return g(r.a.count(Object(u.a)(e)-1,e),t,2)}function _e(e,t){return g(e.getUTCFullYear()%100,t,2)}function ke(e,t){return g((e=ye(e)).getUTCFullYear()%100,t,2)}function Ee(e,t){return g(e.getUTCFullYear()%1e4,t,4)}function Se(e,t){var n=e.getUTCDay();return g((e=n>=4||0===n?Object(r.c)(e):r.c.ceil(e)).getUTCFullYear()%1e4,t,4)}function Ce(){return"+0000"}function Ae(){return"%"}function Oe(e){return+e}function De(e){return Math.floor(+e/1e3)}},function(e,t,n){"use strict";n.r(t);var r="http://www.w3.org/1999/xhtml",i={svg:"http://www.w3.org/2000/svg",xhtml:r,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},a=function(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),i.hasOwnProperty(t)?{space:i[t],local:e}:e},o=function(e){var t=a(e);return(t.local?function(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}:function(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===r&&t.documentElement.namespaceURI===r?t.createElement(e):t.createElementNS(n,e)}})(t)};function s(){}var u=function(e){return null==e?s:function(){return this.querySelector(e)}};function c(){return[]}var l=function(e){return null==e?c:function(){return this.querySelectorAll(e)}},f=function(e){return function(){return this.matches(e)}};if("undefined"!=typeof document){var d=document.documentElement;if(!d.matches){var h=d.webkitMatchesSelector||d.msMatchesSelector||d.mozMatchesSelector||d.oMatchesSelector;f=function(e){return function(){return h.call(this,e)}}}}var p=f,m=function(e){return new Array(e.length)};function v(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}v.prototype={constructor:v,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};var g="$";function y(e,t,n,r,i,a){for(var o,s=0,u=t.length,c=a.length;s<c;++s)(o=t[s])?(o.__data__=a[s],r[s]=o):n[s]=new v(e,a[s]);for(;s<u;++s)(o=t[s])&&(i[s]=o)}function b(e,t,n,r,i,a,o){var s,u,c,l={},f=t.length,d=a.length,h=new Array(f);for(s=0;s<f;++s)(u=t[s])&&(h[s]=c=g+o.call(u,u.__data__,s,t),c in l?i[s]=u:l[c]=u);for(s=0;s<d;++s)(u=l[c=g+o.call(e,a[s],s,a)])?(r[s]=u,u.__data__=a[s],l[c]=null):n[s]=new v(e,a[s]);for(s=0;s<f;++s)(u=t[s])&&l[h[s]]===u&&(i[s]=u)}function x(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}var w=function(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView};function _(e,t){return e.style.getPropertyValue(t)||w(e).getComputedStyle(e,null).getPropertyValue(t)}function k(e){return e.trim().split(/^|\s+/)}function E(e){return e.classList||new S(e)}function S(e){this._node=e,this._names=k(e.getAttribute("class")||"")}function C(e,t){for(var n=E(e),r=-1,i=t.length;++r<i;)n.add(t[r])}function A(e,t){for(var n=E(e),r=-1,i=t.length;++r<i;)n.remove(t[r])}function O(){this.textContent=""}function D(){this.innerHTML=""}function T(){this.nextSibling&&this.parentNode.appendChild(this)}function j(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function M(){return null}function F(){var e=this.parentNode;e&&e.removeChild(this)}function I(){return this.parentNode.insertBefore(this.cloneNode(!1),this.nextSibling)}function N(){return this.parentNode.insertBefore(this.cloneNode(!0),this.nextSibling)}S.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var R={},P=null;function B(e,t,n){return e=L(e,t,n),function(t){var n=t.relatedTarget;n&&(n===this||8&n.compareDocumentPosition(this))||e.call(this,t)}}function L(e,t,n){return function(r){var i=P;P=r;try{e.call(this,this.__data__,t,n)}finally{P=i}}}function z(e){return function(){var t=this.__on;if(t){for(var n,r=0,i=-1,a=t.length;r<a;++r)n=t[r],e.type&&n.type!==e.type||n.name!==e.name?t[++i]=n:this.removeEventListener(n.type,n.listener,n.capture);++i?t.length=i:delete this.__on}}}function U(e,t,n){var r=R.hasOwnProperty(e.type)?B:L;return function(i,a,o){var s,u=this.__on,c=r(t,a,o);if(u)for(var l=0,f=u.length;l<f;++l)if((s=u[l]).type===e.type&&s.name===e.name)return this.removeEventListener(s.type,s.listener,s.capture),this.addEventListener(s.type,s.listener=c,s.capture=n),void(s.value=t);this.addEventListener(e.type,c,n),s={type:e.type,name:e.name,value:t,listener:c,capture:n},u?u.push(s):this.__on=[s]}}function W(e,t,n,r){var i=P;e.sourceEvent=P,P=e;try{return t.apply(n,r)}finally{P=i}}function V(e,t,n){var r=w(e),i=r.CustomEvent;"function"==typeof i?i=new i(t,n):(i=r.document.createEvent("Event"),n?(i.initEvent(t,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}"undefined"!=typeof document&&("onmouseenter"in document.documentElement||(R={mouseenter:"mouseover",mouseleave:"mouseout"}));var G=[null];function q(e,t){this._groups=e,this._parents=t}function H(){return new q([[document.documentElement]],G)}q.prototype=H.prototype={constructor:q,select:function(e){"function"!=typeof e&&(e=u(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var a,o,s=t[i],c=s.length,l=r[i]=new Array(c),f=0;f<c;++f)(a=s[f])&&(o=e.call(a,a.__data__,f,s))&&("__data__"in a&&(o.__data__=a.__data__),l[f]=o);return new q(r,this._parents)},selectAll:function(e){"function"!=typeof e&&(e=l(e));for(var t=this._groups,n=t.length,r=[],i=[],a=0;a<n;++a)for(var o,s=t[a],u=s.length,c=0;c<u;++c)(o=s[c])&&(r.push(e.call(o,o.__data__,c,s)),i.push(o));return new q(r,i)},filter:function(e){"function"!=typeof e&&(e=p(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var a,o=t[i],s=o.length,u=r[i]=[],c=0;c<s;++c)(a=o[c])&&e.call(a,a.__data__,c,o)&&u.push(a);return new q(r,this._parents)},data:function(e,t){if(!e)return h=new Array(this.size()),c=-1,this.each((function(e){h[++c]=e})),h;var n=t?b:y,r=this._parents,i=this._groups;"function"!=typeof e&&(e=function(e){return function(){return e}}(e));for(var a=i.length,o=new Array(a),s=new Array(a),u=new Array(a),c=0;c<a;++c){var l=r[c],f=i[c],d=f.length,h=e.call(l,l&&l.__data__,c,r),p=h.length,m=s[c]=new Array(p),v=o[c]=new Array(p);n(l,f,m,v,u[c]=new Array(d),h,t);for(var g,x,w=0,_=0;w<p;++w)if(g=m[w]){for(w>=_&&(_=w+1);!(x=v[_])&&++_<p;);g._next=x||null}}return(o=new q(o,r))._enter=s,o._exit=u,o},enter:function(){return new q(this._enter||this._groups.map(m),this._parents)},exit:function(){return new q(this._exit||this._groups.map(m),this._parents)},merge:function(e){for(var t=this._groups,n=e._groups,r=t.length,i=n.length,a=Math.min(r,i),o=new Array(r),s=0;s<a;++s)for(var u,c=t[s],l=n[s],f=c.length,d=o[s]=new Array(f),h=0;h<f;++h)(u=c[h]||l[h])&&(d[h]=u);for(;s<r;++s)o[s]=t[s];return new q(o,this._parents)},order:function(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r,i=e[t],a=i.length-1,o=i[a];--a>=0;)(r=i[a])&&(o&&o!==r.nextSibling&&o.parentNode.insertBefore(r,o),o=r);return this},sort:function(e){function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}e||(e=x);for(var n=this._groups,r=n.length,i=new Array(r),a=0;a<r;++a){for(var o,s=n[a],u=s.length,c=i[a]=new Array(u),l=0;l<u;++l)(o=s[l])&&(c[l]=o);c.sort(t)}return new q(i,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){var e=new Array(this.size()),t=-1;return this.each((function(){e[++t]=this})),e},node:function(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,a=r.length;i<a;++i){var o=r[i];if(o)return o}return null},size:function(){var e=0;return this.each((function(){++e})),e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var i,a=t[n],o=0,s=a.length;o<s;++o)(i=a[o])&&e.call(i,i.__data__,o,a);return this},attr:function(e,t){var n=a(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==t?n.local?function(e){return function(){this.removeAttributeNS(e.space,e.local)}}:function(e){return function(){this.removeAttribute(e)}}:"function"==typeof t?n.local?function(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}:function(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}:n.local?function(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}:function(e,t){return function(){this.setAttribute(e,t)}})(n,t))},style:function(e,t,n){return arguments.length>1?this.each((null==t?function(e){return function(){this.style.removeProperty(e)}}:"function"==typeof t?function(e,t,n){return function(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}:function(e,t,n){return function(){this.style.setProperty(e,t,n)}})(e,t,null==n?"":n)):_(this.node(),e)},property:function(e,t){return arguments.length>1?this.each((null==t?function(e){return function(){delete this[e]}}:"function"==typeof t?function(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}:function(e,t){return function(){this[e]=t}})(e,t)):this.node()[e]},classed:function(e,t){var n=k(e+"");if(arguments.length<2){for(var r=E(this.node()),i=-1,a=n.length;++i<a;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"==typeof t?function(e,t){return function(){(t.apply(this,arguments)?C:A)(this,e)}}:t?function(e){return function(){C(this,e)}}:function(e){return function(){A(this,e)}})(n,t))},text:function(e){return arguments.length?this.each(null==e?O:("function"==typeof e?function(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}:function(e){return function(){this.textContent=e}})(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?D:("function"==typeof e?function(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}:function(e){return function(){this.innerHTML=e}})(e)):this.node().innerHTML},raise:function(){return this.each(T)},lower:function(){return this.each(j)},append:function(e){var t="function"==typeof e?e:o(e);return this.select((function(){return this.appendChild(t.apply(this,arguments))}))},insert:function(e,t){var n="function"==typeof e?e:o(e),r=null==t?M:"function"==typeof t?t:u(t);return this.select((function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)}))},remove:function(){return this.each(F)},clone:function(e){return this.select(e?N:I)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,t,n){var r,i,a=function(e){return e.trim().split(/^|\s+/).map((function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}}))}(e+""),o=a.length;if(!(arguments.length<2)){for(s=t?U:z,null==n&&(n=!1),r=0;r<o;++r)this.each(s(a[r],t,n));return this}var s=this.node().__on;if(s)for(var u,c=0,l=s.length;c<l;++c)for(r=0,u=s[c];r<o;++r)if((i=a[r]).type===u.type&&i.name===u.name)return u.value},dispatch:function(e,t){return this.each(("function"==typeof t?function(e,t){return function(){return V(this,e,t.apply(this,arguments))}}:function(e,t){return function(){return V(this,e,t)}})(e,t))}};var X=H,K=function(e){return"string"==typeof e?new q([[document.querySelector(e)]],[document.documentElement]):new q([[e]],G)},Y=function(e){return K(o(e).call(document.documentElement))},$=0;function J(){return new Z}function Z(){this._="@"+(++$).toString(36)}Z.prototype=J.prototype={constructor:Z,get:function(e){for(var t=this._;!(t in e);)if(!(e=e.parentNode))return;return e[t]},set:function(e,t){return e[this._]=t},remove:function(e){return this._ in e&&delete e[this._]},toString:function(){return this._}};var Q=function(){for(var e,t=P;e=t.sourceEvent;)t=e;return t},ee=function(e,t){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,[(r=r.matrixTransform(e.getScreenCTM().inverse())).x,r.y]}var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]},te=function(e){var t=Q();return t.changedTouches&&(t=t.changedTouches[0]),ee(e,t)},ne=function(e){return"string"==typeof e?new q([document.querySelectorAll(e)],[document.documentElement]):new q([null==e?[]:e],G)},re=function(e,t,n){arguments.length<3&&(n=t,t=Q().changedTouches);for(var r,i=0,a=t?t.length:0;i<a;++i)if((r=t[i]).identifier===n)return ee(e,r);return null},ie=function(e,t){null==t&&(t=Q().touches);for(var n=0,r=t?t.length:0,i=new Array(r);n<r;++n)i[n]=ee(e,t[n]);return i};n.d(t,"create",(function(){return Y})),n.d(t,"creator",(function(){return o})),n.d(t,"local",(function(){return J})),n.d(t,"matcher",(function(){return p})),n.d(t,"mouse",(function(){return te})),n.d(t,"namespace",(function(){return a})),n.d(t,"namespaces",(function(){return i})),n.d(t,"clientPoint",(function(){return ee})),n.d(t,"select",(function(){return K})),n.d(t,"selectAll",(function(){return ne})),n.d(t,"selection",(function(){return X})),n.d(t,"selector",(function(){return u})),n.d(t,"selectorAll",(function(){return l})),n.d(t,"style",(function(){return _})),n.d(t,"touch",(function(){return re})),n.d(t,"touches",(function(){return ie})),n.d(t,"window",(function(){return w})),n.d(t,"event",(function(){return P})),n.d(t,"customEvent",(function(){return W}))},function(e,t,n){"use strict";n.r(t);var r={};n.d(r,"load",(function(){return G}));var i={};n.d(i,"Darknet",(function(){return Z})),n.d(i,"load",(function(){return Q}));var a={};n.d(a,"Doodlenet",(function(){return oe})),n.d(a,"load",(function(){return se}));var o={};n.d(o,"array3DToImage",(function(){return fe})),n.d(o,"processVideo",(function(){return le})),n.d(o,"cropImage",(function(){return de})),n.d(o,"imgToTensor",(function(){return pe})),n.d(o,"isInstanceOfSupportedElement",(function(){return me})),n.d(o,"flipImage",(function(){return he})),n.d(o,"imgToPixelArray",(function(){return ve}));var s={};n.d(s,"SpeechCommands",(function(){return Qe})),n.d(s,"load",(function(){return et}));var u={};n.d(u,"isTensor",(function(){return Oi})),n.d(u,"isTensor1D",(function(){return Di})),n.d(u,"isTensor2D",(function(){return Ti})),n.d(u,"isTensor3D",(function(){return ji})),n.d(u,"isTensor4D",(function(){return Mi})),n.d(u,"isFloat",(function(){return Fi})),n.d(u,"isEven",(function(){return Ii})),n.d(u,"round",(function(){return Ni})),n.d(u,"isDimensions",(function(){return Ri})),n.d(u,"computeReshapedDimensions",(function(){return Pi})),n.d(u,"getCenterPoint",(function(){return Bi})),n.d(u,"range",(function(){return Li})),n.d(u,"isValidNumber",(function(){return zi})),n.d(u,"isValidProbablitiy",(function(){return Ui}));var c={};n.d(c,"drawContour",(function(){return Si})),n.d(c,"drawDetections",(function(){return Aa})),n.d(c,"drawFaceExpressions",(function(){return xo})),n.d(c,"DrawBoxOptions",(function(){return Sa})),n.d(c,"DrawBox",(function(){return Ca})),n.d(c,"DrawFaceLandmarksOptions",(function(){return ko})),n.d(c,"DrawFaceLandmarks",(function(){return Eo})),n.d(c,"drawFaceLandmarks",(function(){return So})),n.d(c,"AnchorPosition",(function(){return ba})),n.d(c,"DrawTextFieldOptions",(function(){return ka})),n.d(c,"DrawTextField",(function(){return Ea}));var l={};n.d(l,"draw",(function(){return c})),n.d(l,"utils",(function(){return u})),n.d(l,"tf",(function(){return Ei})),n.d(l,"env",(function(){return xa})),n.d(l,"FaceLandmarkNet",(function(){return Po})),n.d(l,"createFaceRecognitionNet",(function(){return Ho})),n.d(l,"createMtcnn",(function(){return qu})),n.d(l,"sigmoid",(function(){return Qi})),n.d(l,"inverseSigmoid",(function(){return ea})),n.d(l,"createSsdMobilenetv1",(function(){return cs})),n.d(l,"createFaceDetectionNet",(function(){return ls})),n.d(l,"FaceDetectionNet",(function(){return ds})),n.d(l,"createTinyFaceDetector",(function(){return Hu})),n.d(l,"TinyYolov2",(function(){return Cs})),n.d(l,"createTinyYolov2",(function(){return As})),n.d(l,"euclideanDistance",(function(){return Vu})),n.d(l,"NeuralNetwork",(function(){return Ka})),n.d(l,"resizeResults",(function(){return Xu})),n.d(l,"AgeGenderNet",(function(){return Mo})),n.d(l,"Gender",(function(){return To})),n.d(l,"BoundingBox",(function(){return Gi})),n.d(l,"Box",(function(){return Vi})),n.d(l,"Dimensions",(function(){return Ai})),n.d(l,"FaceDetection",(function(){return Hi})),n.d(l,"FaceLandmarks",(function(){return na})),n.d(l,"FaceLandmarks5",(function(){return ra})),n.d(l,"FaceLandmarks68",(function(){return ia})),n.d(l,"FaceMatch",(function(){return aa})),n.d(l,"LabeledBox",(function(){return oa})),n.d(l,"LabeledFaceDescriptors",(function(){return sa})),n.d(l,"ObjectDetection",(function(){return qi})),n.d(l,"Point",(function(){return Wi})),n.d(l,"PredictedBox",(function(){return ua})),n.d(l,"Rect",(function(){return ta})),n.d(l,"awaitMediaLoaded",(function(){return Da})),n.d(l,"bufferToImage",(function(){return Ta})),n.d(l,"createCanvas",(function(){return Ma})),n.d(l,"createCanvasFromMedia",(function(){return Fa})),n.d(l,"extractFaces",(function(){return La})),n.d(l,"extractFaceTensors",(function(){return za})),n.d(l,"fetchImage",(function(){return Wa})),n.d(l,"fetchJson",(function(){return Va})),n.d(l,"fetchNetWeights",(function(){return Ga})),n.d(l,"fetchOrThrow",(function(){return Ua})),n.d(l,"getContext2dOrThrow",(function(){return _a})),n.d(l,"getMediaDimensions",(function(){return ja})),n.d(l,"imageTensorToCanvas",(function(){return Ia})),n.d(l,"imageToSquare",(function(){return Ra})),n.d(l,"isMediaElement",(function(){return Na})),n.d(l,"isMediaLoaded",(function(){return Oa})),n.d(l,"loadWeightMap",(function(){return Ha})),n.d(l,"matchDimensions",(function(){return Xa})),n.d(l,"NetInput",(function(){return Pa})),n.d(l,"resolveInput",(function(){return wa})),n.d(l,"toNetInput",(function(){return Ba})),n.d(l,"FaceExpressionNet",(function(){return go})),n.d(l,"FACE_EXPRESSION_LABELS",(function(){return mo})),n.d(l,"FaceExpressions",(function(){return vo})),n.d(l,"FaceLandmark68Net",(function(){return Io})),n.d(l,"FaceLandmark68TinyNet",(function(){return Ro})),n.d(l,"FaceRecognitionNet",(function(){return qo})),n.d(l,"extendWithFaceDescriptor",(function(){return Xo})),n.d(l,"isWithFaceDetection",(function(){return ca})),n.d(l,"extendWithFaceDetection",(function(){return la})),n.d(l,"isWithFaceExpressions",(function(){return yo})),n.d(l,"extendWithFaceExpressions",(function(){return bo})),n.d(l,"isWithFaceLandmarks",(function(){return wo})),n.d(l,"extendWithFaceLandmarks",(function(){return _o})),n.d(l,"isWithAge",(function(){return Ko})),n.d(l,"extendWithAge",(function(){return Yo})),n.d(l,"isWithGender",(function(){return $o})),n.d(l,"extendWithGender",(function(){return Jo})),n.d(l,"allFacesSsdMobilenetv1",(function(){return Lu})),n.d(l,"allFacesTinyYolov2",(function(){return zu})),n.d(l,"allFacesMtcnn",(function(){return Uu})),n.d(l,"allFaces",(function(){return Wu})),n.d(l,"ComposableTask",(function(){return Ds})),n.d(l,"ComputeFaceDescriptorsTaskBase",(function(){return Ou})),n.d(l,"ComputeAllFaceDescriptorsTask",(function(){return Du})),n.d(l,"ComputeSingleFaceDescriptorTask",(function(){return Tu})),n.d(l,"detectSingleFace",(function(){return Pu})),n.d(l,"detectAllFaces",(function(){return Bu})),n.d(l,"DetectFacesTaskBase",(function(){return Iu})),n.d(l,"DetectAllFacesTask",(function(){return Nu})),n.d(l,"DetectSingleFaceTask",(function(){return Ru})),n.d(l,"DetectFaceLandmarksTaskBase",(function(){return ju})),n.d(l,"DetectAllFaceLandmarksTask",(function(){return Mu})),n.d(l,"DetectSingleFaceLandmarksTask",(function(){return Fu})),n.d(l,"FaceMatcher",(function(){return Gu})),n.d(l,"nets",(function(){return $s})),n.d(l,"ssdMobilenetv1",(function(){return Js})),n.d(l,"tinyFaceDetector",(function(){return Zs})),n.d(l,"tinyYolov2",(function(){return Qs})),n.d(l,"mtcnn",(function(){return eu})),n.d(l,"detectFaceLandmarks",(function(){return tu})),n.d(l,"detectFaceLandmarksTiny",(function(){return nu})),n.d(l,"computeFaceDescriptor",(function(){return ru})),n.d(l,"recognizeFaceExpressions",(function(){return iu})),n.d(l,"predictAgeAndGender",(function(){return au})),n.d(l,"loadSsdMobilenetv1Model",(function(){return ou})),n.d(l,"loadTinyFaceDetectorModel",(function(){return su})),n.d(l,"loadMtcnnModel",(function(){return uu})),n.d(l,"loadTinyYolov2Model",(function(){return cu})),n.d(l,"loadFaceLandmarkModel",(function(){return lu})),n.d(l,"loadFaceLandmarkTinyModel",(function(){return fu})),n.d(l,"loadFaceRecognitionModel",(function(){return du})),n.d(l,"loadFaceExpressionModel",(function(){return hu})),n.d(l,"loadAgeGenderModel",(function(){return pu})),n.d(l,"loadFaceDetectionModel",(function(){return mu})),n.d(l,"locateFaces",(function(){return vu})),n.d(l,"detectLandmarks",(function(){return gu})),n.d(l,"Mtcnn",(function(){return qs})),n.d(l,"MtcnnOptions",(function(){return Zo})),n.d(l,"iou",(function(){return Xi})),n.d(l,"minBbox",(function(){return Ki})),n.d(l,"nonMaxSuppression",(function(){return Yi})),n.d(l,"normalize",(function(){return $i})),n.d(l,"padToSquare",(function(){return Ji})),n.d(l,"shuffleArray",(function(){return Zi})),n.d(l,"SsdMobilenetv1",(function(){return us})),n.d(l,"SsdMobilenetv1Options",(function(){return ss})),n.d(l,"TinyFaceDetector",(function(){return Ys})),n.d(l,"TinyFaceDetectorOptions",(function(){return Os})),n.d(l,"TinyYolov2SizeType",(function(){return fs})),n.d(l,"TinyYolov2Options",(function(){return Es})),n.d(l,"validateConfig",(function(){return ys}));var p={};n.d(p,"getRobin",(function(){return Rl})),n.d(p,"getImageData",(function(){return Pl}));var y=n(18),b=n.n(y),x=n(2),w=n(67),_=n(6),k=n.n(_),E=n(10),S=n.n(E),C=n(9),A=n.n(C),O=n(4),D=n.n(O);function T(e,t){return t?new Promise((function(n,r){e.then((function(e){t(void 0,e),n(e)})).catch((function(e){t(e),r(e)}))})):e}var j=function(){function e(t,n,r,i){S()(this,e),this.model=t,this.audioContext=n,this.stream=r,this.frequency=null,this.ready=T(this.loadModel(t),i)}return A()(e,[{key:"loadModel",value:function(){var e=k()(D.a.mark((function e(t){return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.loadLayersModel("".concat(t,"/model.json"));case 2:if(this.model=e.sent,!this.audioContext){e.next=8;break}return e.next=6,this.processStream();case 6:e.next=9;break;case 8:throw new Error("Could not access microphone - getUserMedia not available");case 9:return e.abrupt("return",this);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"processStream",value:function(){var e=k()(D.a.mark((function e(){var t,n,r,i,a;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.nextFrame();case 2:for(t=this.audioContext.createMediaStreamSource(this.stream),n=this.audioContext.sampleRate/16e3*1024,r=4;r<n;)r*=2;(i=this.audioContext.createScriptProcessor(r,1,1)).onaudioprocess=this.processMicrophoneBuffer.bind(this),(a=this.audioContext.createGain()).gain.setValueAtTime(0,this.audioContext.currentTime),t.connect(i),i.connect(a),a.connect(this.audioContext.destination),"running"!==this.audioContext.state&&console.warn("User gesture needed to start AudioContext, please click");case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"processMicrophoneBuffer",value:function(){var t=k()(D.a.mark((function t(n){var r=this;return D.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,x.nextFrame();case 2:this.results={},e.resample(n.inputBuffer,(function(e){x.tidy((function(){var t=x.add(x.linspace(0,7180,360),x.tensor(1997.379408437619));r.running=!0;var n=x.tensor(e.slice(0,1024)),i=x.sub(n,x.mean(n)),a=x.tensor(x.norm(i).dataSync()/Math.sqrt(1024)),o=x.div(i,a).reshape([1,1024]),s=r.model.predict([o]).reshape([360]),u=s.max().dataSync()[0],c=s.argMax().dataSync()[0];r.results.confidence=u.toFixed(3);var l=Math.max(0,c-4),f=Math.min(360,c+5),d=s.slice([l],[f-l]),h=t.slice([l],[f-l]),p=x.mul(d,h).dataSync().reduce((function(e,t){return e+t}),0)/d.dataSync().reduce((function(e,t){return e+t}),0),m=10*Math.pow(2,p/1200),v=u>.5?m:null;r.frequency=v}))}));case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getPitch",value:function(){var e=k()(D.a.mark((function e(t){var n;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ready;case 2:return e.next=4,x.nextFrame();case 4:return n=this.frequency,t&&t(void 0,n),e.abrupt("return",n);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}],[{key:"resample",value:function(e,t){for(var n=e.sampleRate%16e3!=0,r=e.sampleRate/16e3,i=e.getChannelData(0),a=new Float32Array(1024),o=0;o<1024;o+=1)if(n){var s=Math.floor(o*r),u=s+1,c=o*r-s;a[o]=(1-c)*i[s]+c*i[u]}else a[o]=i[o*r];t(a)}}]),e}(),M=function(){return new j(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"./",arguments.length>1?arguments[1]:void 0,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)},F=n(7),I=n.n(F),N=n(17),R=n.n(N),P=n(20),B=n(0);function L(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))}function z(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}var U={0:"tench, Tinca tinca",1:"goldfish, Carassius auratus",2:"great white shark, white shark, man-eater, man-eating shark, Carcharodon carcharias",3:"tiger shark, Galeocerdo cuvieri",4:"hammerhead, hammerhead shark",5:"electric ray, crampfish, numbfish, torpedo",6:"stingray",7:"cock",8:"hen",9:"ostrich, Struthio camelus",10:"brambling, Fringilla montifringilla",11:"goldfinch, Carduelis carduelis",12:"house finch, linnet, Carpodacus mexicanus",13:"junco, snowbird",14:"indigo bunting, indigo finch, indigo bird, Passerina cyanea",15:"robin, American robin, Turdus migratorius",16:"bulbul",17:"jay",18:"magpie",19:"chickadee",20:"water ouzel, dipper",21:"kite",22:"bald eagle, American eagle, Haliaeetus leucocephalus",23:"vulture",24:"great grey owl, great gray owl, Strix nebulosa",25:"European fire salamander, Salamandra salamandra",26:"common newt, Triturus vulgaris",27:"eft",28:"spotted salamander, Ambystoma maculatum",29:"axolotl, mud puppy, Ambystoma mexicanum",30:"bullfrog, Rana catesbeiana",31:"tree frog, tree-frog",32:"tailed frog, bell toad, ribbed toad, tailed toad, Ascaphus trui",33:"loggerhead, loggerhead turtle, Caretta caretta",34:"leatherback turtle, leatherback, leathery turtle, Dermochelys coriacea",35:"mud turtle",36:"terrapin",37:"box turtle, box tortoise",38:"banded gecko",39:"common iguana, iguana, Iguana iguana",40:"American chameleon, anole, Anolis carolinensis",41:"whiptail, whiptail lizard",42:"agama",43:"frilled lizard, Chlamydosaurus kingi",44:"alligator lizard",45:"Gila monster, Heloderma suspectum",46:"green lizard, Lacerta viridis",47:"African chameleon, Chamaeleo chamaeleon",48:"Komodo dragon, Komodo lizard, dragon lizard, giant lizard, Varanus komodoensis",49:"African crocodile, Nile crocodile, Crocodylus niloticus",50:"American alligator, Alligator mississipiensis",51:"triceratops",52:"thunder snake, worm snake, Carphophis amoenus",53:"ringneck snake, ring-necked snake, ring snake",54:"hognose snake, puff adder, sand viper",55:"green snake, grass snake",56:"king snake, kingsnake",57:"garter snake, grass snake",58:"water snake",59:"vine snake",60:"night snake, Hypsiglena torquata",61:"boa constrictor, Constrictor constrictor",62:"rock python, rock snake, Python sebae",63:"Indian cobra, Naja naja",64:"green mamba",65:"sea snake",66:"horned viper, cerastes, sand viper, horned asp, Cerastes cornutus",67:"diamondback, diamondback rattlesnake, Crotalus adamanteus",68:"sidewinder, horned rattlesnake, Crotalus cerastes",69:"trilobite",70:"harvestman, daddy longlegs, Phalangium opilio",71:"scorpion",72:"black and gold garden spider, Argiope aurantia",73:"barn spider, Araneus cavaticus",74:"garden spider, Aranea diademata",75:"black widow, Latrodectus mactans",76:"tarantula",77:"wolf spider, hunting spider",78:"tick",79:"centipede",80:"black grouse",81:"ptarmigan",82:"ruffed grouse, partridge, Bonasa umbellus",83:"prairie chicken, prairie grouse, prairie fowl",84:"peacock",85:"quail",86:"partridge",87:"African grey, African gray, Psittacus erithacus",88:"macaw",89:"sulphur-crested cockatoo, Kakatoe galerita, Cacatua galerita",90:"lorikeet",91:"coucal",92:"bee eater",93:"hornbill",94:"hummingbird",95:"jacamar",96:"toucan",97:"drake",98:"red-breasted merganser, Mergus serrator",99:"goose",100:"black swan, Cygnus atratus",101:"tusker",102:"echidna, spiny anteater, anteater",103:"platypus, duckbill, duckbilled platypus, duck-billed platypus, Ornithorhynchus anatinus",104:"wallaby, brush kangaroo",105:"koala, koala bear, kangaroo bear, native bear, Phascolarctos cinereus",106:"wombat",107:"jelly fish",108:"sea anemone, anemone",109:"brain coral",110:"flatworm, platyhelminth",111:"nematode, nematode worm, roundworm",112:"conch",113:"snail",114:"slug",115:"sea slug, nudibranch",116:"chiton, coat-of-mail shell, sea cradle, polyplacophore",117:"chambered nautilus, pearly nautilus, nautilus",118:"Dungeness crab, Cancer magister",119:"rock crab, Cancer irroratus",120:"fiddler crab",121:"king crab, Alaska crab, Alaskan king crab, Alaska king crab, Paralithodes camtschatica",122:"American lobster, Northern lobster, Maine lobster, Homarus americanus",123:"spiny lobster, langouste, rock lobster, crawfish, crayfish, sea crawfish",124:"crayfish, crawfish, crawdad, crawdaddy",125:"hermit crab",126:"isopod",127:"white stork, Ciconia ciconia",128:"black stork, Ciconia nigra",129:"spoonbill",130:"flamingo",131:"little blue heron, Egretta caerulea",132:"American egret, great white heron, Egretta albus",133:"bittern",134:"crane",135:"limpkin, Aramus pictus",136:"European gallinule, Porphyrio porphyrio",137:"American coot, marsh hen, mud hen, water hen, Fulica americana",138:"bustard",139:"ruddy turnstone, Arenaria interpres",140:"red-backed sandpiper, dunlin, Erolia alpina",141:"redshank, Tringa totanus",142:"dowitcher",143:"oystercatcher, oyster catcher",144:"pelican",145:"king penguin, Aptenodytes patagonica",146:"albatross, mollymawk",147:"grey whale, gray whale, devilfish, Eschrichtius gibbosus, Eschrichtius robustus",148:"killer whale, killer, orca, grampus, sea wolf, Orcinus orca",149:"dugong, Dugong dugon",150:"sea lion",151:"Chihuahua",152:"Japanese spaniel",153:"Maltese dog, Maltese terrier, Maltese",154:"Pekinese, Pekingese, Peke",155:"Shih-Tzu",156:"Blenheim spaniel",157:"papillon",158:"toy terrier",159:"Rhodesian ridgeback",160:"Afghan hound, Afghan",161:"basset, basset hound",162:"beagle",163:"bloodhound, sleuthhound",164:"bluetick",165:"black-and-tan coonhound",166:"Walker hound, Walker foxhound",167:"English foxhound",168:"redbone",169:"borzoi, Russian wolfhound",170:"Irish wolfhound",171:"Italian greyhound",172:"whippet",173:"Ibizan hound, Ibizan Podenco",174:"Norwegian elkhound, elkhound",175:"otterhound, otter hound",176:"Saluki, gazelle hound",177:"Scottish deerhound, deerhound",178:"Weimaraner",179:"Staffordshire bullterrier, Staffordshire bull terrier",180:"American Staffordshire terrier, Staffordshire terrier, American pit bull terrier, pit bull terrier",181:"Bedlington terrier",182:"Border terrier",183:"Kerry blue terrier",184:"Irish terrier",185:"Norfolk terrier",186:"Norwich terrier",187:"Yorkshire terrier",188:"wire-haired fox terrier",189:"Lakeland terrier",190:"Sealyham terrier, Sealyham",191:"Airedale, Airedale terrier",192:"cairn, cairn terrier",193:"Australian terrier",194:"Dandie Dinmont, Dandie Dinmont terrier",195:"Boston bull, Boston terrier",196:"miniature schnauzer",197:"giant schnauzer",198:"standard schnauzer",199:"Scotch terrier, Scottish terrier, Scottie",200:"Tibetan terrier, chrysanthemum dog",201:"silky terrier, Sydney silky",202:"soft-coated wheaten terrier",203:"West Highland white terrier",204:"Lhasa, Lhasa apso",205:"flat-coated retriever",206:"curly-coated retriever",207:"golden retriever",208:"Labrador retriever",209:"Chesapeake Bay retriever",210:"German short-haired pointer",211:"vizsla, Hungarian pointer",212:"English setter",213:"Irish setter, red setter",214:"Gordon setter",215:"Brittany spaniel",216:"clumber, clumber spaniel",217:"English springer, English springer spaniel",218:"Welsh springer spaniel",219:"cocker spaniel, English cocker spaniel, cocker",220:"Sussex spaniel",221:"Irish water spaniel",222:"kuvasz",223:"schipperke",224:"groenendael",225:"malinois",226:"briard",227:"kelpie",228:"komondor",229:"Old English sheepdog, bobtail",230:"Shetland sheepdog, Shetland sheep dog, Shetland",231:"collie",232:"Border collie",233:"Bouvier des Flandres, Bouviers des Flandres",234:"Rottweiler",235:"German shepherd, German shepherd dog, German police dog, alsatian",236:"Doberman, Doberman pinscher",237:"miniature pinscher",238:"Greater Swiss Mountain dog",239:"Bernese mountain dog",240:"Appenzeller",241:"EntleBucher",242:"boxer",243:"bull mastiff",244:"Tibetan mastiff",245:"French bulldog",246:"Great Dane",247:"Saint Bernard, St Bernard",248:"Eskimo dog, husky",249:"malamute, malemute, Alaskan malamute",250:"Siberian husky",251:"dalmatian, coach dog, carriage dog",252:"affenpinscher, monkey pinscher, monkey dog",253:"basenji",254:"pug, pug-dog",255:"Leonberg",256:"Newfoundland, Newfoundland dog",257:"Great Pyrenees",258:"Samoyed, Samoyede",259:"Pomeranian",260:"chow, chow chow",261:"keeshond",262:"Brabancon griffon",263:"Pembroke, Pembroke Welsh corgi",264:"Cardigan, Cardigan Welsh corgi",265:"toy poodle",266:"miniature poodle",267:"standard poodle",268:"Mexican hairless",269:"timber wolf, grey wolf, gray wolf, Canis lupus",270:"white wolf, Arctic wolf, Canis lupus tundrarum",271:"red wolf, maned wolf, Canis rufus, Canis niger",272:"coyote, prairie wolf, brush wolf, Canis latrans",273:"dingo, warrigal, warragal, Canis dingo",274:"dhole, Cuon alpinus",275:"African hunting dog, hyena dog, Cape hunting dog, Lycaon pictus",276:"hyena, hyaena",277:"red fox, Vulpes vulpes",278:"kit fox, Vulpes macrotis",279:"Arctic fox, white fox, Alopex lagopus",280:"grey fox, gray fox, Urocyon cinereoargenteus",281:"tabby, tabby cat",282:"tiger cat",283:"Persian cat",284:"Siamese cat, Siamese",285:"Egyptian cat",286:"cougar, puma, catamount, mountain lion, painter, panther, Felis concolor",287:"lynx, catamount",288:"leopard, Panthera pardus",289:"snow leopard, ounce, Panthera uncia",290:"jaguar, panther, Panthera onca, Felis onca",291:"lion, king of beasts, Panthera leo",292:"tiger, Panthera tigris",293:"cheetah, chetah, Acinonyx jubatus",294:"brown bear, bruin, Ursus arctos",295:"American black bear, black bear, Ursus americanus, Euarctos americanus",296:"ice bear, polar bear, Ursus Maritimus, Thalarctos maritimus",297:"sloth bear, Melursus ursinus, Ursus ursinus",298:"mongoose",299:"meerkat, mierkat",300:"tiger beetle",301:"ladybug, ladybeetle, lady beetle, ladybird, ladybird beetle",302:"ground beetle, carabid beetle",303:"long-horned beetle, longicorn, longicorn beetle",304:"leaf beetle, chrysomelid",305:"dung beetle",306:"rhinoceros beetle",307:"weevil",308:"fly",309:"bee",310:"ant, emmet, pismire",311:"grasshopper, hopper",312:"cricket",313:"walking stick, walkingstick, stick insect",314:"cockroach, roach",315:"mantis, mantid",316:"cicada, cicala",317:"leafhopper",318:"lacewing, lacewing fly",319:"dragonfly, darning needle, devil's darning needle, sewing needle, snake feeder, snake doctor, mosquito hawk, skeeter hawk",320:"damselfly",321:"admiral",322:"ringlet, ringlet butterfly",323:"monarch, monarch butterfly, milkweed butterfly, Danaus plexippus",324:"cabbage butterfly",325:"sulphur butterfly, sulfur butterfly",326:"lycaenid, lycaenid butterfly",327:"starfish, sea star",328:"sea urchin",329:"sea cucumber, holothurian",330:"wood rabbit, cottontail, cottontail rabbit",331:"hare",332:"Angora, Angora rabbit",333:"hamster",334:"porcupine, hedgehog",335:"fox squirrel, eastern fox squirrel, Sciurus niger",336:"marmot",337:"beaver",338:"guinea pig, Cavia cobaya",339:"sorrel",340:"zebra",341:"hog, pig, grunter, squealer, Sus scrofa",342:"wild boar, boar, Sus scrofa",343:"warthog",344:"hippopotamus, hippo, river horse, Hippopotamus amphibius",345:"ox",346:"water buffalo, water ox, Asiatic buffalo, Bubalus bubalis",347:"bison",348:"ram, tup",349:"bighorn, bighorn sheep, cimarron, Rocky Mountain bighorn, Rocky Mountain sheep, Ovis canadensis",350:"ibex, Capra ibex",351:"hartebeest",352:"impala, Aepyceros melampus",353:"gazelle",354:"Arabian camel, dromedary, Camelus dromedarius",355:"llama",356:"weasel",357:"mink",358:"polecat, fitch, foulmart, foumart, Mustela putorius",359:"black-footed ferret, ferret, Mustela nigripes",360:"otter",361:"skunk, polecat, wood pussy",362:"badger",363:"armadillo",364:"three-toed sloth, ai, Bradypus tridactylus",365:"orangutan, orang, orangutang, Pongo pygmaeus",366:"gorilla, Gorilla gorilla",367:"chimpanzee, chimp, Pan troglodytes",368:"gibbon, Hylobates lar",369:"siamang, Hylobates syndactylus, Symphalangus syndactylus",370:"guenon, guenon monkey",371:"patas, hussar monkey, Erythrocebus patas",372:"baboon",373:"macaque",374:"langur",375:"colobus, colobus monkey",376:"proboscis monkey, Nasalis larvatus",377:"marmoset",378:"capuchin, ringtail, Cebus capucinus",379:"howler monkey, howler",380:"titi, titi monkey",381:"spider monkey, Ateles geoffroyi",382:"squirrel monkey, Saimiri sciureus",383:"Madagascar cat, ring-tailed lemur, Lemur catta",384:"indri, indris, Indri indri, Indri brevicaudatus",385:"Indian elephant, Elephas maximus",386:"African elephant, Loxodonta africana",387:"lesser panda, red panda, panda, bear cat, cat bear, Ailurus fulgens",388:"giant panda, panda, panda bear, coon bear, Ailuropoda melanoleuca",389:"barracouta, snoek",390:"eel",391:"coho, cohoe, coho salmon, blue jack, silver salmon, Oncorhynchus kisutch",392:"rock beauty, Holocanthus tricolor",393:"anemone fish",394:"sturgeon",395:"gar, garfish, garpike, billfish, Lepisosteus osseus",396:"lionfish",397:"puffer, pufferfish, blowfish, globefish",398:"abacus",399:"abaya",400:"academic gown, academic robe, judge's robe",401:"accordion, piano accordion, squeeze box",402:"acoustic guitar",403:"aircraft carrier, carrier, flattop, attack aircraft carrier",404:"airliner",405:"airship, dirigible",406:"altar",407:"ambulance",408:"amphibian, amphibious vehicle",409:"analog clock",410:"apiary, bee house",411:"apron",412:"ashcan, trash can, garbage can, wastebin, ash bin, ash-bin, ashbin, dustbin, trash barrel, trash bin",413:"assault rifle, assault gun",414:"backpack, back pack, knapsack, packsack, rucksack, haversack",415:"bakery, bakeshop, bakehouse",416:"balance beam, beam",417:"balloon",418:"ballpoint, ballpoint pen, ballpen, Biro",419:"Band Aid",420:"banjo",421:"bannister, banister, balustrade, balusters, handrail",422:"barbell",423:"barber chair",424:"barbershop",425:"barn",426:"barometer",427:"barrel, cask",428:"barrow, garden cart, lawn cart, wheelbarrow",429:"baseball",430:"basketball",431:"bassinet",432:"bassoon",433:"bathing cap, swimming cap",434:"bath towel",435:"bathtub, bathing tub, bath, tub",436:"beach wagon, station wagon, wagon, estate car, beach waggon, station waggon, waggon",437:"beacon, lighthouse, beacon light, pharos",438:"beaker",439:"bearskin, busby, shako",440:"beer bottle",441:"beer glass",442:"bell cote, bell cot",443:"bib",444:"bicycle-built-for-two, tandem bicycle, tandem",445:"bikini, two-piece",446:"binder, ring-binder",447:"binoculars, field glasses, opera glasses",448:"birdhouse",449:"boathouse",450:"bobsled, bobsleigh, bob",451:"bolo tie, bolo, bola tie, bola",452:"bonnet, poke bonnet",453:"bookcase",454:"bookshop, bookstore, bookstall",455:"bottlecap",456:"bow",457:"bow tie, bow-tie, bowtie",458:"brass, memorial tablet, plaque",459:"brassiere, bra, bandeau",460:"breakwater, groin, groyne, mole, bulwark, seawall, jetty",461:"breastplate, aegis, egis",462:"broom",463:"bucket, pail",464:"buckle",465:"bulletproof vest",466:"bullet train, bullet",467:"butcher shop, meat market",468:"cab, hack, taxi, taxicab",469:"caldron, cauldron",470:"candle, taper, wax light",471:"cannon",472:"canoe",473:"can opener, tin opener",474:"cardigan",475:"car mirror",476:"carousel, carrousel, merry-go-round, roundabout, whirligig",477:"carpenter's kit, tool kit",478:"carton",479:"car wheel",480:"cash machine, cash dispenser, automated teller machine, automatic teller machine, automated teller, automatic teller, ATM",481:"cassette",482:"cassette player",483:"castle",484:"catamaran",485:"CD player",486:"cello, violoncello",487:"cellular telephone, cellular phone, cellphone, cell, mobile phone",488:"chain",489:"chainlink fence",490:"chain mail, ring mail, mail, chain armor, chain armour, ring armor, ring armour",491:"chain saw, chainsaw",492:"chest",493:"chiffonier, commode",494:"chime, bell, gong",495:"china cabinet, china closet",496:"Christmas stocking",497:"church, church building",498:"cinema, movie theater, movie theatre, movie house, picture palace",499:"cleaver, meat cleaver, chopper",500:"cliff dwelling",501:"cloak",502:"clog, geta, patten, sabot",503:"cocktail shaker",504:"coffee mug",505:"coffeepot",506:"coil, spiral, volute, whorl, helix",507:"combination lock",508:"computer keyboard, keypad",509:"confectionery, confectionary, candy store",510:"container ship, containership, container vessel",511:"convertible",512:"corkscrew, bottle screw",513:"cornet, horn, trumpet, trump",514:"cowboy boot",515:"cowboy hat, ten-gallon hat",516:"cradle",517:"crane",518:"crash helmet",519:"crate",520:"crib, cot",521:"Crock Pot",522:"croquet ball",523:"crutch",524:"cuirass",525:"dam, dike, dyke",526:"desk",527:"desktop computer",528:"dial telephone, dial phone",529:"diaper, nappy, napkin",530:"digital clock",531:"digital watch",532:"dining table, board",533:"dishrag, dishcloth",534:"dishwasher, dish washer, dishwashing machine",535:"disk brake, disc brake",536:"dock, dockage, docking facility",537:"dogsled, dog sled, dog sleigh",538:"dome",539:"doormat, welcome mat",540:"drilling platform, offshore rig",541:"drum, membranophone, tympan",542:"drumstick",543:"dumbbell",544:"Dutch oven",545:"electric fan, blower",546:"electric guitar",547:"electric locomotive",548:"entertainment center",549:"envelope",550:"espresso maker",551:"face powder",552:"feather boa, boa",553:"file, file cabinet, filing cabinet",554:"fireboat",555:"fire engine, fire truck",556:"fire screen, fireguard",557:"flagpole, flagstaff",558:"flute, transverse flute",559:"folding chair",560:"football helmet",561:"forklift",562:"fountain",563:"fountain pen",564:"four-poster",565:"freight car",566:"French horn, horn",567:"frying pan, frypan, skillet",568:"fur coat",569:"garbage truck, dustcart",570:"gasmask, respirator, gas helmet",571:"gas pump, gasoline pump, petrol pump, island dispenser",572:"goblet",573:"go-kart",574:"golf ball",575:"golfcart, golf cart",576:"gondola",577:"gong, tam-tam",578:"gown",579:"grand piano, grand",580:"greenhouse, nursery, glasshouse",581:"grille, radiator grille",582:"grocery store, grocery, food market, market",583:"guillotine",584:"hair slide",585:"hair spray",586:"half track",587:"hammer",588:"hamper",589:"hand blower, blow dryer, blow drier, hair dryer, hair drier",590:"hand-held computer, hand-held microcomputer",591:"handkerchief, hankie, hanky, hankey",592:"hard disc, hard disk, fixed disk",593:"harmonica, mouth organ, harp, mouth harp",594:"harp",595:"harvester, reaper",596:"hatchet",597:"holster",598:"home theater, home theatre",599:"honeycomb",600:"hook, claw",601:"hoopskirt, crinoline",602:"horizontal bar, high bar",603:"horse cart, horse-cart",604:"hourglass",605:"iPod",606:"iron, smoothing iron",607:"jack-o'-lantern",608:"jean, blue jean, denim",609:"jeep, landrover",610:"jersey, T-shirt, tee shirt",611:"jigsaw puzzle",612:"jinrikisha, ricksha, rickshaw",613:"joystick",614:"kimono",615:"knee pad",616:"knot",617:"lab coat, laboratory coat",618:"ladle",619:"lampshade, lamp shade",620:"laptop, laptop computer",621:"lawn mower, mower",622:"lens cap, lens cover",623:"letter opener, paper knife, paperknife",624:"library",625:"lifeboat",626:"lighter, light, igniter, ignitor",627:"limousine, limo",628:"liner, ocean liner",629:"lipstick, lip rouge",630:"Loafer",631:"lotion",632:"loudspeaker, speaker, speaker unit, loudspeaker system, speaker system",633:"loupe, jeweler's loupe",634:"lumbermill, sawmill",635:"magnetic compass",636:"mailbag, postbag",637:"mailbox, letter box",638:"maillot",639:"maillot, tank suit",640:"manhole cover",641:"maraca",642:"marimba, xylophone",643:"mask",644:"matchstick",645:"maypole",646:"maze, labyrinth",647:"measuring cup",648:"medicine chest, medicine cabinet",649:"megalith, megalithic structure",650:"microphone, mike",651:"microwave, microwave oven",652:"military uniform",653:"milk can",654:"minibus",655:"miniskirt, mini",656:"minivan",657:"missile",658:"mitten",659:"mixing bowl",660:"mobile home, manufactured home",661:"Model T",662:"modem",663:"monastery",664:"monitor",665:"moped",666:"mortar",667:"mortarboard",668:"mosque",669:"mosquito net",670:"motor scooter, scooter",671:"mountain bike, all-terrain bike, off-roader",672:"mountain tent",673:"mouse, computer mouse",674:"mousetrap",675:"moving van",676:"muzzle",677:"nail",678:"neck brace",679:"necklace",680:"nipple",681:"notebook, notebook computer",682:"obelisk",683:"oboe, hautboy, hautbois",684:"ocarina, sweet potato",685:"odometer, hodometer, mileometer, milometer",686:"oil filter",687:"organ, pipe organ",688:"oscilloscope, scope, cathode-ray oscilloscope, CRO",689:"overskirt",690:"oxcart",691:"oxygen mask",692:"packet",693:"paddle, boat paddle",694:"paddlewheel, paddle wheel",695:"padlock",696:"paintbrush",697:"pajama, pyjama, pj's, jammies",698:"palace",699:"panpipe, pandean pipe, syrinx",700:"paper towel",701:"parachute, chute",702:"parallel bars, bars",703:"park bench",704:"parking meter",705:"passenger car, coach, carriage",706:"patio, terrace",707:"pay-phone, pay-station",708:"pedestal, plinth, footstall",709:"pencil box, pencil case",710:"pencil sharpener",711:"perfume, essence",712:"Petri dish",713:"photocopier",714:"pick, plectrum, plectron",715:"pickelhaube",716:"picket fence, paling",717:"pickup, pickup truck",718:"pier",719:"piggy bank, penny bank",720:"pill bottle",721:"pillow",722:"ping-pong ball",723:"pinwheel",724:"pirate, pirate ship",725:"pitcher, ewer",726:"plane, carpenter's plane, woodworking plane",727:"planetarium",728:"plastic bag",729:"plate rack",730:"plow, plough",731:"plunger, plumber's helper",732:"Polaroid camera, Polaroid Land camera",733:"pole",734:"police van, police wagon, paddy wagon, patrol wagon, wagon, black Maria",735:"poncho",736:"pool table, billiard table, snooker table",737:"pop bottle, soda bottle",738:"pot, flowerpot",739:"potter's wheel",740:"power drill",741:"prayer rug, prayer mat",742:"printer",743:"prison, prison house",744:"projectile, missile",745:"projector",746:"puck, hockey puck",747:"punching bag, punch bag, punching ball, punchball",748:"purse",749:"quill, quill pen",750:"quilt, comforter, comfort, puff",751:"racer, race car, racing car",752:"racket, racquet",753:"radiator",754:"radio, wireless",755:"radio telescope, radio reflector",756:"rain barrel",757:"recreational vehicle, RV, R.V.",758:"reel",759:"reflex camera",760:"refrigerator, icebox",761:"remote control, remote",762:"restaurant, eating house, eating place, eatery",763:"revolver, six-gun, six-shooter",764:"rifle",765:"rocking chair, rocker",766:"rotisserie",767:"rubber eraser, rubber, pencil eraser",768:"rugby ball",769:"rule, ruler",770:"running shoe",771:"safe",772:"safety pin",773:"saltshaker, salt shaker",774:"sandal",775:"sarong",776:"sax, saxophone",777:"scabbard",778:"scale, weighing machine",779:"school bus",780:"schooner",781:"scoreboard",782:"screen, CRT screen",783:"screw",784:"screwdriver",785:"seat belt, seatbelt",786:"sewing machine",787:"shield, buckler",788:"shoe shop, shoe-shop, shoe store",789:"shoji",790:"shopping basket",791:"shopping cart",792:"shovel",793:"shower cap",794:"shower curtain",795:"ski",796:"ski mask",797:"sleeping bag",798:"slide rule, slipstick",799:"sliding door",800:"slot, one-armed bandit",801:"snorkel",802:"snowmobile",803:"snowplow, snowplough",804:"soap dispenser",805:"soccer ball",806:"sock",807:"solar dish, solar collector, solar furnace",808:"sombrero",809:"soup bowl",810:"space bar",811:"space heater",812:"space shuttle",813:"spatula",814:"speedboat",815:"spider web, spider's web",816:"spindle",817:"sports car, sport car",818:"spotlight, spot",819:"stage",820:"steam locomotive",821:"steel arch bridge",822:"steel drum",823:"stethoscope",824:"stole",825:"stone wall",826:"stopwatch, stop watch",827:"stove",828:"strainer",829:"streetcar, tram, tramcar, trolley, trolley car",830:"stretcher",831:"studio couch, day bed",832:"stupa, tope",833:"submarine, pigboat, sub, U-boat",834:"suit, suit of clothes",835:"sundial",836:"sunglass",837:"sunglasses, dark glasses, shades",838:"sunscreen, sunblock, sun blocker",839:"suspension bridge",840:"swab, swob, mop",841:"sweatshirt",842:"swimming trunks, bathing trunks",843:"swing",844:"switch, electric switch, electrical switch",845:"syringe",846:"table lamp",847:"tank, army tank, armored combat vehicle, armoured combat vehicle",848:"tape player",849:"teapot",850:"teddy, teddy bear",851:"television, television system",852:"tennis ball",853:"thatch, thatched roof",854:"theater curtain, theatre curtain",855:"thimble",856:"thresher, thrasher, threshing machine",857:"throne",858:"tile roof",859:"toaster",860:"tobacco shop, tobacconist shop, tobacconist",861:"toilet seat",862:"torch",863:"totem pole",864:"tow truck, tow car, wrecker",865:"toyshop",866:"tractor",867:"trailer truck, tractor trailer, trucking rig, rig, articulated lorry, semi",868:"tray",869:"trench coat",870:"tricycle, trike, velocipede",871:"trimaran",872:"tripod",873:"triumphal arch",874:"trolleybus, trolley coach, trackless trolley",875:"trombone",876:"tub, vat",877:"turnstile",878:"typewriter keyboard",879:"umbrella",880:"unicycle, monocycle",881:"upright, upright piano",882:"vacuum, vacuum cleaner",883:"vase",884:"vault",885:"velvet",886:"vending machine",887:"vestment",888:"viaduct",889:"violin, fiddle",890:"volleyball",891:"waffle iron",892:"wall clock",893:"wallet, billfold, notecase, pocketbook",894:"wardrobe, closet, press",895:"warplane, military plane",896:"washbasin, handbasin, washbowl, lavabo, wash-hand basin",897:"washer, automatic washer, washing machine",898:"water bottle",899:"water jug",900:"water tower",901:"whiskey jug",902:"whistle",903:"wig",904:"window screen",905:"window shade",906:"Windsor tie",907:"wine bottle",908:"wing",909:"wok",910:"wooden spoon",911:"wool, woolen, woollen",912:"worm fence, snake fence, snake-rail fence, Virginia fence",913:"wreck",914:"yawl",915:"yurt",916:"web site, website, internet site, site",917:"comic book",918:"crossword puzzle, crossword",919:"street sign",920:"traffic light, traffic signal, stoplight",921:"book jacket, dust cover, dust jacket, dust wrapper",922:"menu",923:"plate",924:"guacamole",925:"consomme",926:"hot pot, hotpot",927:"trifle",928:"ice cream, icecream",929:"ice lolly, lolly, lollipop, popsicle",930:"French loaf",931:"bagel, beigel",932:"pretzel",933:"cheeseburger",934:"hotdog, hot dog, red hot",935:"mashed potato",936:"head cabbage",937:"broccoli",938:"cauliflower",939:"zucchini, courgette",940:"spaghetti squash",941:"acorn squash",942:"butternut squash",943:"cucumber, cuke",944:"artichoke, globe artichoke",945:"bell pepper",946:"cardoon",947:"mushroom",948:"Granny Smith",949:"strawberry",950:"orange",951:"lemon",952:"fig",953:"pineapple, ananas",954:"banana",955:"jackfruit, jak, jack",956:"custard apple",957:"pomegranate",958:"hay",959:"carbonara",960:"chocolate sauce, chocolate syrup",961:"dough",962:"meat loaf, meatloaf",963:"pizza, pizza pie",964:"potpie",965:"burrito",966:"red wine",967:"espresso",968:"cup",969:"eggnog",970:"alp",971:"bubble",972:"cliff, drop, drop-off",973:"coral reef",974:"geyser",975:"lakeside, lakeshore",976:"promontory, headland, head, foreland",977:"sandbar, sand bar",978:"seashore, coast, seacoast, sea-coast",979:"valley, vale",980:"volcano",981:"ballplayer, baseball player",982:"groom, bridegroom",983:"scuba diver",984:"rapeseed",985:"daisy",986:"yellow lady's slipper, yellow lady-slipper, Cypripedium calceolus, Cypripedium parviflorum",987:"corn",988:"acorn",989:"hip, rose hip, rosehip",990:"buckeye, horse chestnut, conker",991:"coral fungus",992:"agaric",993:"gyromitra",994:"stinkhorn, carrion fungus",995:"earthstar",996:"hen-of-the-woods, hen of the woods, Polyporus frondosus, Grifola frondosa",997:"bolete",998:"ear, spike, capitulum",999:"toilet tissue, toilet paper, bathroom tissue"},W={"1.00":"module_apply_default/MobilenetV1/Logits/global_pool","2.00":"module_apply_default/MobilenetV2/Logits/AvgPool"},V={"1.00":{.25:{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_025_224/classification/1",inputRange:[0,1]},"0.50":{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_050_224/classification/1",inputRange:[0,1]},.75:{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_075_224/classification/1",inputRange:[0,1]},"1.00":{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_100_224/classification/1",inputRange:[0,1]}},"2.00":{"0.50":{url:"https://tfhub.dev/google/imagenet/mobilenet_v2_050_224/classification/2",inputRange:[0,1]},.75:{url:"https://tfhub.dev/google/imagenet/mobilenet_v2_075_224/classification/2",inputRange:[0,1]},"1.00":{url:"https://tfhub.dev/google/imagenet/mobilenet_v2_100_224/classification/2",inputRange:[0,1]}}};function G(e){return void 0===e&&(e={version:1,alpha:1}),L(this,void 0,void 0,(function(){var t,n,r,i,a,o;return z(this,(function(s){switch(s.label){case 0:if(null==B)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this model.");if(n=e.version.toFixed(2),r=e.alpha?e.alpha.toFixed(2):"",i=-1,a=1,null==e.modelUrl){if(!(n in V))throw new Error("Invalid version of MobileNet. Valid versions are: "+Object.keys(V));if(!(r in V[n]))throw new Error("MobileNet constructed with invalid alpha "+e.alpha+". Valid multipliers for this version are: "+Object.keys(V[n])+".");t=V[n][r].inputRange,i=t[0],a=t[1]}return[4,(o=new q(n,r,e.modelUrl,i,a)).load()];case 1:return s.sent(),[2,o]}}))}))}var q=function(){function e(e,t,n,r,i){void 0===r&&(r=-1),void 0===i&&(i=1),this.version=e,this.alpha=t,this.modelUrl=n,this.inputMin=r,this.inputMax=i,this.inputRange=i-r}return e.prototype.load=function(){return L(this,void 0,void 0,(function(){var e,t,n,r,i=this;return z(this,(function(a){switch(a.label){case 0:return this.modelUrl?(e=this,[4,Object(P.loadGraphModel)(this.modelUrl)]):[3,2];case 1:return e.model=a.sent(),[3,4];case 2:return t=V[this.version][this.alpha].url,n=this,[4,Object(P.loadGraphModel)(t,{fromTFHub:!0})];case 3:n.model=a.sent(),a.label=4;case 4:return[4,(r=Object(B.tidy)((function(){return i.model.predict(Object(B.zeros)([1,224,224,3]))}))).data()];case 5:return a.sent(),r.dispose(),[2]}}))}))},e.prototype.infer=function(e,t){var n=this;return void 0===t&&(t=!1),Object(B.tidy)((function(){e instanceof B.Tensor||(e=B.browser.fromPixels(e));var r=e.toFloat().mul(n.inputRange).add(n.inputMin),i=r;224===e.shape[0]&&224===e.shape[1]||(i=B.image.resizeBilinear(r,[224,224],!0));var a,o=i.reshape([-1,224,224,3]);if(t){var s=W[n.version];a=n.model.execute(o,s).squeeze([1,2])}else a=n.model.predict(o).slice([0,1],[-1,1e3]);return a}))},e.prototype.classify=function(e,t){return void 0===t&&(t=3),L(this,void 0,void 0,(function(){var n,r;return z(this,(function(i){switch(i.label){case 0:return[4,function(e,t){return L(this,void 0,void 0,(function(){var n,r,i,a,o,s,u;return z(this,(function(c){switch(c.label){case 0:return[4,(n=e.softmax()).data()];case 1:for(r=c.sent(),n.dispose(),i=[],u=0;u<r.length;u++)i.push({value:r[u],index:u});for(i.sort((function(e,t){return t.value-e.value})),a=new Float32Array(t),o=new Int32Array(t),u=0;u<t;u++)a[u]=i[u].value,o[u]=i[u].index;for(s=[],u=0;u<o.length;u++)s.push({className:U[o[u]],probability:a[u]});return[2,s]}}))}))}(n=this.infer(e),t)];case 1:return r=i.sent(),n.dispose(),[2,r]}}))}))},e}();function H(e,t,n){for(var r=[],i=0;i<e.length;i+=1)r.push({value:e[i],index:i});r.sort((function(e,t){return t.value-e.value}));for(var a=new Float32Array(t),o=new Int32Array(t),s=0;s<t;s+=1)a[s]=r[s].value,o[s]=r[s].index;for(var u=[],c=0;c<o.length;c+=1)u.push({className:n[o[c]],probability:a[c]});return u}function X(e,t,n){return K.apply(this,arguments)}function K(){return(K=k()(D.a.mark((function e(t,n,r){var i;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.data();case 2:return i=e.sent,e.abrupt("return",H(i,n,r));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Y=["kit fox","English setter","Siberian husky","Australian terrier","English springer","grey whale","lesser panda","Egyptian cat","ibex","Persian cat","cougar","gazelle","porcupine","sea lion","malamute","badger","Great Dane","Walker hound","Welsh springer spaniel","whippet","Scottish deerhound","killer whale","mink","African elephant","Weimaraner","soft-coated wheaten terrier","Dandie Dinmont","red wolf","Old English sheepdog","jaguar","otterhound","bloodhound","Airedale","hyena","meerkat","giant schnauzer","titi","three-toed sloth","sorrel","black-footed ferret","dalmatian","black-and-tan coonhound","papillon","skunk","Staffordshire bullterrier","Mexican hairless","Bouvier des Flandres","weasel","miniature poodle","Cardigan","malinois","bighorn","fox squirrel","colobus","tiger cat","Lhasa","impala","coyote","Yorkshire terrier","Newfoundland","brown bear","red fox","Norwegian elkhound","Rottweiler","hartebeest","Saluki","grey fox","schipperke","Pekinese","Brabancon griffon","West Highland white terrier","Sealyham terrier","guenon","mongoose","indri","tiger","Irish wolfhound","wild boar","EntleBucher","zebra","ram","French bulldog","orangutan","basenji","leopard","Bernese mountain dog","Maltese dog","Norfolk terrier","toy terrier","vizsla","cairn","squirrel monkey","groenendael","clumber","Siamese cat","chimpanzee","komondor","Afghan hound","Japanese spaniel","proboscis monkey","guinea pig","white wolf","ice bear","gorilla","borzoi","toy poodle","Kerry blue terrier","ox","Scotch terrier","Tibetan mastiff","spider monkey","Doberman","Boston bull","Greater Swiss Mountain dog","Appenzeller","Shih-Tzu","Irish water spaniel","Pomeranian","Bedlington terrier","warthog","Arabian camel","siamang","miniature schnauzer","collie","golden retriever","Irish terrier","affenpinscher","Border collie","hare","boxer","silky terrier","beagle","Leonberg","German short-haired pointer","patas","dhole","baboon","macaque","Chesapeake Bay retriever","bull mastiff","kuvasz","capuchin","pug","curly-coated retriever","Norwich terrier","flat-coated retriever","hog","keeshond","Eskimo dog","Brittany spaniel","standard poodle","Lakeland terrier","snow leopard","Gordon setter","dingo","standard schnauzer","hamster","Tibetan terrier","Arctic fox","wire-haired fox terrier","basset","water buffalo","American black bear","Angora","bison","howler monkey","hippopotamus","chow","giant panda","American Staffordshire terrier","Shetland sheepdog","Great Pyrenees","Chihuahua","tabby","marmoset","Labrador retriever","Saint Bernard","armadillo","Samoyed","bluetick","redbone","polecat","marmot","kelpie","gibbon","llama","miniature pinscher","wood rabbit","Italian greyhound","lion","cocker spaniel","Irish setter","dugong","Indian elephant","beaver","Sussex spaniel","Pembroke","Blenheim spaniel","Madagascar cat","Rhodesian ridgeback","lynx","African hunting dog","langur","Ibizan hound","timber wolf","cheetah","English foxhound","briard","sloth bear","Border terrier","German shepherd","otter","koala","tusker","echidna","wallaby","platypus","wombat","revolver","umbrella","schooner","soccer ball","accordion","ant","starfish","chambered nautilus","grand piano","laptop","strawberry","airliner","warplane","airship","balloon","space shuttle","fireboat","gondola","speedboat","lifeboat","canoe","yawl","catamaran","trimaran","container ship","liner","pirate","aircraft carrier","submarine","wreck","half track","tank","missile","bobsled","dogsled","bicycle-built-for-two","mountain bike","freight car","passenger car","barrow","shopping cart","motor scooter","forklift","electric locomotive","steam locomotive","amphibian","ambulance","beach wagon","cab","convertible","jeep","limousine","minivan","Model T","racer","sports car","go-kart","golfcart","moped","snowplow","fire engine","garbage truck","pickup","tow truck","trailer truck","moving van","police van","recreational vehicle","streetcar","snowmobile","tractor","mobile home","tricycle","unicycle","horse cart","jinrikisha","oxcart","bassinet","cradle","crib","four-poster","bookcase","china cabinet","medicine chest","chiffonier","table lamp","file","park bench","barber chair","throne","folding chair","rocking chair","studio couch","toilet seat","desk","pool table","dining table","entertainment center","wardrobe","Granny Smith","orange","lemon","fig","pineapple","banana","jackfruit","custard apple","pomegranate","acorn","hip","ear","rapeseed","corn","buckeye","organ","upright","chime","drum","gong","maraca","marimba","steel drum","banjo","cello","violin","harp","acoustic guitar","electric guitar","cornet","French horn","trombone","harmonica","ocarina","panpipe","bassoon","oboe","sax","flute","daisy","yellow lady's slipper","cliff","valley","alp","volcano","promontory","sandbar","coral reef","lakeside","seashore","geyser","hatchet","cleaver","letter opener","plane","power drill","lawn mower","hammer","corkscrew","can opener","plunger","screwdriver","shovel","plow","chain saw","cock","hen","ostrich","brambling","goldfinch","house finch","junco","indigo bunting","robin","bulbul","jay","magpie","chickadee","water ouzel","kite","bald eagle","vulture","great grey owl","black grouse","ptarmigan","ruffed grouse","prairie chicken","peacock","quail","partridge","African grey","macaw","sulphur-crested cockatoo","lorikeet","coucal","bee eater","hornbill","hummingbird","jacamar","toucan","drake","red-breasted merganser","goose","black swan","white stork","black stork","spoonbill","flamingo","American egret","little blue heron","bittern","crane","limpkin","American coot","bustard","ruddy turnstone","red-backed sandpiper","redshank","dowitcher","oystercatcher","European gallinule","pelican","king penguin","albatross","great white shark","tiger shark","hammerhead","electric ray","stingray","barracouta","coho","tench","goldfish","eel","rock beauty","anemone fish","lionfish","puffer","sturgeon","gar","loggerhead","leatherback turtle","mud turtle","terrapin","box turtle","banded gecko","common iguana","American chameleon","whiptail","agama","frilled lizard","alligator lizard","Gila monster","green lizard","African chameleon","Komodo dragon","triceratops","African crocodile","American alligator","thunder snake","ringneck snake","hognose snake","green snake","king snake","garter snake","water snake","vine snake","night snake","boa constrictor","rock python","Indian cobra","green mamba","sea snake","horned viper","diamondback","sidewinder","European fire salamander","common newt","eft","spotted salamander","axolotl","bullfrog","tree frog","tailed frog","whistle","wing","paintbrush","hand blower","oxygen mask","snorkel","loudspeaker","microphone","screen","mouse","electric fan","oil filter","strainer","space heater","stove","guillotine","barometer","rule","odometer","scale","analog clock","digital clock","wall clock","hourglass","sundial","parking meter","stopwatch","digital watch","stethoscope","syringe","magnetic compass","binoculars","projector","sunglasses","loupe","radio telescope","bow","cannon","assault rifle","rifle","projectile","computer keyboard","typewriter keyboard","crane","lighter","abacus","cash machine","slide rule","desktop computer","hand-held computer","notebook","web site","harvester","thresher","printer","slot","vending machine","sewing machine","joystick","switch","hook","car wheel","paddlewheel","pinwheel","potter's wheel","gas pump","carousel","swing","reel","radiator","puck","hard disc","sunglass","pick","car mirror","solar dish","remote control","disk brake","buckle","hair slide","knot","combination lock","padlock","nail","safety pin","screw","muzzle","seat belt","ski","candle","jack-o'-lantern","spotlight","torch","neck brace","pier","tripod","maypole","mousetrap","spider web","trilobite","harvestman","scorpion","black and gold garden spider","barn spider","garden spider","black widow","tarantula","wolf spider","tick","centipede","isopod","Dungeness crab","rock crab","fiddler crab","king crab","American lobster","spiny lobster","crayfish","hermit crab","tiger beetle","ladybug","ground beetle","long-horned beetle","leaf beetle","dung beetle","rhinoceros beetle","weevil","fly","bee","grasshopper","cricket","walking stick","cockroach","mantis","cicada","leafhopper","lacewing","dragonfly","damselfly","admiral","ringlet","monarch","cabbage butterfly","sulphur butterfly","lycaenid","jellyfish","sea anemone","brain coral","flatworm","nematode","conch","snail","slug","sea slug","chiton","sea urchin","sea cucumber","iron","espresso maker","microwave","Dutch oven","rotisserie","toaster","waffle iron","vacuum","dishwasher","refrigerator","washer","Crock Pot","frying pan","wok","caldron","coffeepot","teapot","spatula","altar","triumphal arch","patio","steel arch bridge","suspension bridge","viaduct","barn","greenhouse","palace","monastery","library","apiary","boathouse","church","mosque","stupa","planetarium","restaurant","cinema","home theater","lumbermill","coil","obelisk","totem pole","castle","prison","grocery store","bakery","barbershop","bookshop","butcher shop","confectionery","shoe shop","tobacco shop","toyshop","fountain","cliff dwelling","yurt","dock","brass","megalith","bannister","breakwater","dam","chainlink fence","picket fence","worm fence","stone wall","grille","sliding door","turnstile","mountain tent","scoreboard","honeycomb","plate rack","pedestal","beacon","mashed potato","bell pepper","head cabbage","broccoli","cauliflower","zucchini","spaghetti squash","acorn squash","butternut squash","cucumber","artichoke","cardoon","mushroom","shower curtain","jean","carton","handkerchief","sandal","ashcan","safe","plate","necklace","croquet ball","fur coat","thimble","pajama","running shoe","cocktail shaker","chest","manhole cover","modem","tub","tray","balance beam","bagel","prayer rug","kimono","hot pot","whiskey jug","knee pad","book jacket","spindle","ski mask","beer bottle","crash helmet","bottlecap","tile roof","mask","maillot","Petri dish","football helmet","bathing cap","teddy","holster","pop bottle","photocopier","vestment","crossword puzzle","golf ball","trifle","suit","water tower","feather boa","cloak","red wine","drumstick","shield","Christmas stocking","hoopskirt","menu","stage","bonnet","meat loaf","baseball","face powder","scabbard","sunscreen","beer glass","hen-of-the-woods","guacamole","lampshade","wool","hay","bow tie","mailbag","water jug","bucket","dishrag","soup bowl","eggnog","mortar","trench coat","paddle","chain","swab","mixing bowl","potpie","wine bottle","shoji","bulletproof vest","drilling platform","binder","cardigan","sweatshirt","pot","birdhouse","hamper","ping-pong ball","pencil box","pay-phone","consomme","apron","punching bag","backpack","groom","bearskin","pencil sharpener","broom","mosquito net","abaya","mortarboard","poncho","crutch","Polaroid camera","space bar","cup","racket","traffic light","quill","radio","dough","cuirass","military uniform","lipstick","shower cap","monitor","oscilloscope","mitten","brassiere","French loaf","vase","milk can","rugby ball","paper towel","earthstar","envelope","miniskirt","cowboy hat","trolleybus","perfume","bathtub","hotdog","coral fungus","bullet train","pillow","toilet tissue","cassette","carpenter's kit","ladle","stinkhorn","lotion","hair spray","academic gown","dome","crate","wig","burrito","pill bottle","chain mail","theater curtain","window shade","barrel","washbasin","ballpoint","basketball","bath towel","cowboy boot","gown","window screen","agaric","cellular telephone","nipple","barbell","mailbox","lab coat","fire screen","minibus","packet","maze","pole","horizontal bar","sombrero","pickelhaube","rain barrel","wallet","cassette player","comic book","piggy bank","street sign","bell cote","fountain pen","Windsor tie","volleyball","overskirt","sarong","purse","bolo tie","bib","parachute","sleeping bag","television","swimming trunks","measuring cup","espresso","pizza","breastplate","shopping basket","wooden spoon","saltshaker","chocolate sauce","ballplayer","goblet","gyromitra","stretcher","water bottle","dial telephone","soap dispenser","jersey","school bus","jigsaw puzzle","plastic bag","reflex camera","diaper","Band Aid","ice lolly","velvet","tennis ball","gasmask","doormat","Loafer","ice cream","pretzel","quilt","maillot","tape player","clog","iPod","bolete","scuba diver","pitcher","matchstick","bikini","sock","CD player","lens cap","thatch","vault","beaker","bubble","cheeseburger","parallel bars","flagpole","coffee mug","rubber eraser","stole","carbonara","dumbbell"],$={DARKNET_URL:"https://cdn.jsdelivr.net/gh/ml5js/ml5-data-and-models@master/models/darknetclassifier/darknetreference/model.json",DARKNET_TINY_URL:"https://cdn.jsdelivr.net/gh/ml5js/ml5-data-and-models@master/models/darknetclassifier/darknettiny/model.json",IMAGE_SIZE_DARKNET:256,IMAGE_SIZE_DARKNET_TINY:224};function J(e,t){var n;e instanceof x.Tensor?n=e:e instanceof HTMLImageElement||e instanceof HTMLVideoElement||e instanceof HTMLCanvasElement||e instanceof ImageData?n=x.browser.fromPixels(e):"object"===I()(e)&&(e.elt instanceof HTMLImageElement||e.elt instanceof HTMLVideoElement||e.elt instanceof HTMLCanvasElement||e.elt instanceof ImageData)&&(n=x.browser.fromPixels(e.elt));var r=n.toFloat().div(x.scalar(255)),i=r;return r.shape[0]===t&&r.shape[1]===t||(i=x.image.resizeBilinear(r,[t,t],!0)),i.reshape([1,t,t,3])}var Z=function(){function e(t){switch(S()(this,e),this.version=t,this.version){case"reference":this.imgSize=$.IMAGE_SIZE_DARKNET;break;case"tiny":this.imgSize=$.IMAGE_SIZE_DARKNET_TINY}}return A()(e,[{key:"load",value:function(){var e=k()(D.a.mark((function e(){var t,n=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=this.version,e.next="reference"===e.t0?3:"tiny"===e.t0?7:11;break;case 3:return e.next=5,x.loadLayersModel($.DARKNET_URL);case 5:return this.model=e.sent,e.abrupt("break",12);case 7:return e.next=9,x.loadLayersModel($.DARKNET_TINY_URL);case 9:return this.model=e.sent,e.abrupt("break",12);case 11:return e.abrupt("break",12);case 12:return t=x.tidy((function(){return n.model.predict(x.zeros([1,n.imgSize,n.imgSize,3]))})),e.next=15,t.data();case 15:t.dispose();case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"classify",value:function(){var e=k()(D.a.mark((function e(t){var n,r,i,a=this,o=arguments;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:3,r=x.tidy((function(){var e=J(t,a.imgSize),n=a.model.predict(e);return x.softmax(n)})),e.next=4,X(r,n,Y);case 4:return i=e.sent,r.dispose(),e.abrupt("return",i);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function Q(e){return ee.apply(this,arguments)}function ee(){return(ee=k()(D.a.mark((function e(t){var n,r;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("reference"===(n=t.version)||"tiny"===n){e.next=3;break}throw new Error("Please select a version: darknet-reference or darknet-tiny");case 3:return r=new Z(n),e.next=6,r.load();case 6:return e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var te=n(23),ne=n.n(te),re=["flashlight","belt","mushroom","pond","strawberry","pineapple","sun","cow","ear","bush","pliers","watermelon","apple","baseball","feather","shoe","leaf","lollipop","crown","ocean","horse","mountain","mosquito","mug","hospital","saw","castle","angel","underwear","traffic_light","cruise_ship","marker","blueberry","flamingo","face","hockey_stick","bucket","campfire","asparagus","skateboard","door","suitcase","skull","cloud","paint_can","hockey_puck","steak","house_plant","sleeping_bag","bench","snowman","arm","crayon","fan","shovel","leg","washing_machine","harp","toothbrush","tree","bear","rake","megaphone","knee","guitar","calculator","hurricane","grapes","paintbrush","couch","nose","square","wristwatch","penguin","bridge","octagon","submarine","screwdriver","rollerskates","ladder","wine_bottle","cake","bracelet","broom","yoga","finger","fish","line","truck","snake","bus","stitches","snorkel","shorts","bowtie","pickup_truck","tooth","snail","foot","crab","school_bus","train","dresser","sock","tractor","map","hedgehog","coffee_cup","computer","matches","beard","frog","crocodile","bathtub","rain","moon","bee","knife","boomerang","lighthouse","chandelier","jail","pool","stethoscope","frying_pan","cell_phone","binoculars","purse","lantern","birthday_cake","clarinet","palm_tree","aircraft_carrier","vase","eraser","shark","skyscraper","bicycle","sink","teapot","circle","tornado","bird","stereo","mouth","key","hot_dog","spoon","laptop","cup","bottlecap","The_Great_Wall_of_China","The_Mona_Lisa","smiley_face","waterslide","eyeglasses","ceiling_fan","lobster","moustache","carrot","garden","police_car","postcard","necklace","helmet","blackberry","beach","golf_club","car","panda","alarm_clock","t-shirt","dog","bread","wine_glass","lighter","flower","bandage","drill","butterfly","swan","owl","raccoon","squiggle","calendar","giraffe","elephant","trumpet","rabbit","trombone","sheep","onion","church","flip_flops","spreadsheet","pear","clock","roller_coaster","parachute","kangaroo","duck","remote_control","compass","monkey","rainbow","tennis_racquet","lion","pencil","string_bean","oven","star","cat","pizza","soccer_ball","syringe","flying_saucer","eye","cookie","floor_lamp","mouse","toilet","toaster","The_Eiffel_Tower","airplane","stove","cello","stop_sign","tent","diving_board","light_bulb","hammer","scorpion","headphones","basket","spider","paper_clip","sweater","ice_cream","envelope","sea_turtle","donut","hat","hourglass","broccoli","jacket","backpack","book","lightning","drums","snowflake","radio","banana","camel","canoe","toothpaste","chair","picture_frame","parrot","sandwich","lipstick","pants","violin","brain","power_outlet","triangle","hamburger","dragon","bulldozer","cannon","dolphin","zebra","animal_migration","camouflage","scissors","basketball","elbow","umbrella","windmill","table","rifle","hexagon","potato","anvil","sword","peanut","axe","television","rhinoceros","baseball_bat","speedboat","sailboat","zigzag","garden_hose","river","house","pillow","ant","tiger","stairs","cooler","see_saw","piano","fireplace","popsicle","dumbbell","mailbox","barn","hot_tub","teddy-bear","fork","dishwasher","peas","hot_air_balloon","keyboard","microwave","wheel","fire_hydrant","van","camera","whale","candle","octopus","pig","swing_set","helicopter","saxophone","passport","bat","ambulance","diamond","goatee","fence","grass","mermaid","motorbike","microphone","toe","cactus","nail","telephone","hand","squirrel","streetlight","bed","firetruck"],ie={DOODLENET_URL:"https://cdn.jsdelivr.net/gh/ml5js/ml5-data-and-models@master/models/doodlenet/model.json",IMAGE_SIZE_DOODLENET:28};function ae(e,t){var n;e instanceof x.Tensor?n=e:e instanceof HTMLImageElement||e instanceof HTMLVideoElement||e instanceof HTMLCanvasElement||e instanceof ImageData?n=x.browser.fromPixels(e):"object"===I()(e)&&(e.elt instanceof HTMLImageElement||e.elt instanceof HTMLVideoElement||e.elt instanceof HTMLCanvasElement||e.elt instanceof ImageData)&&(n=x.browser.fromPixels(e.elt));var r=x.scalar(1).sub(n.toFloat().div(x.scalar(255))),i=r;r.shape[0]===t&&r.shape[1]===t||(i=x.image.resizeBilinear(r,[t,t]));var a=x.split(i,3,3),o=ne()(a,3),s=o[0],u=o[1],c=o[2];return s.add(u).add(c).div(x.scalar(3)).floor().reshape([1,t,t,1])}var oe=function(){function e(){S()(this,e),this.imgSize=ie.IMAGE_SIZE_DOODLENET}return A()(e,[{key:"load",value:function(){var e=k()(D.a.mark((function e(){var t,n=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.loadLayersModel(ie.DOODLENET_URL);case 2:return this.model=e.sent,t=x.tidy((function(){return n.model.predict(x.zeros([1,n.imgSize,n.imgSize,1]))})),e.next=6,t.data();case 6:t.dispose();case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"classify",value:function(){var e=k()(D.a.mark((function e(t){var n,r,i,a=this,o=arguments;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:10,r=x.tidy((function(){var e=ae(t,a.imgSize);return a.model.predict(e)})),e.next=4,X(r,n,re);case 4:return i=e.sent,r.dispose(),e.abrupt("return",i);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function se(){return ue.apply(this,arguments)}function ue(){return(ue=k()(D.a.mark((function e(){var t;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new oe,e.next=3,t.load();case 3:return e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ce=new(function(){function e(){S()(this,e),"undefined"!=typeof window&&(this.m_p5Instance=window)}return A()(e,[{key:"setP5Instance",value:function(e){this.m_p5Instance=e}},{key:"p5Instance",get:function(){return void 0!==this.m_p5Instance&&"function"==typeof this.m_p5Instance.loadImage?this.m_p5Instance:void 0!==this.m_p5Instance.p5&&void 0!==this.m_p5Instance.p5.Image&&"function"==typeof this.m_p5Instance.p5.Image?this.m_p5Instance.p5:void 0}},{key:"checkP5",value:function(){return!!this.p5Instance}},{key:"getBlob",value:function(e){return new Promise((function(t,n){e.toBlob((function(e){e?t(e):n(new Error("Canvas could not be converted to Blob."))}))}))}},{key:"loadAsync",value:function(e){var t=this;return new Promise((function(n,r){t.p5Instance.loadImage(e,(function(e){n(e)}),(function(){r(new Error("Could not load image from url ".concat(e)))}))}))}},{key:"rawToBlob",value:function(){var e=k()(D.a.mark((function e(t,n,r){var i,a,o,s,u,c;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i=Array.from(t),a=document.createElement("canvas"),o=a.getContext("2d"),a.width=n,a.height=r,s=o.createImageData(n,r),u=s.data,c=0;c<n*r*4;c+=1)u[c]=i[c];return o.putImageData(s,0,0),e.abrupt("return",this.getBlob(a));case 10:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"blobToP5Image",value:function(){var e=k()(D.a.mark((function e(t){return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.checkP5()||"undefined"==typeof URL){e.next=2;break}return e.abrupt("return",this.loadAsync(URL.createObjectURL(t)));case 2:return e.abrupt("return",null);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}()),le=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},r=e,i=document.createElement("video");return r.onplay=function(){var e=r.captureStream();i.srcObject=e,i.width=t,i.height=t,i.autoplay=!0,i.playsinline=!0,i.muted=!0,n()},i},fe=function(e){var t=ne()(e.shape,2),n=t[0],r=t[1],i=e.dataSync(),a=document.createElement("canvas");a.width=r,a.height=n;for(var o=a.getContext("2d"),s=o.getImageData(0,0,a.width,a.height),u=0;u<r*n;u+=1){var c=4*u,l=3*u;s.data[c+0]=Math.floor(256*i[l+0]),s.data[c+1]=Math.floor(256*i[l+1]),s.data[c+2]=Math.floor(256*i[l+2]),s.data[c+3]=255}o.putImageData(s,0,0);var f=a.toDataURL(),d=document.createElement("img");return d.src=f,d.style.width=r,d.style.height=n,e.dispose(),d},de=function(e){var t=Math.min(e.shape[0],e.shape[1]),n=e.shape[0]/2-t/2,r=e.shape[1]/2-t/2;return e.slice([n,r,0],[t,t,3])},he=function(e){var t,n,r;if(r=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData?e:"object"===I()(e)&&(e.elt instanceof HTMLImageElement||e.elt instanceof HTMLCanvasElement||e.elt instanceof HTMLVideoElement||e.elt instanceof ImageData)?e.elt:"object"===I()(e)&&e.canvas instanceof HTMLCanvasElement?e.canvas:e,HTMLVideoElement,t=r.width,n=r.height,ce.checkP5()){var i=ce.p5Instance.createGraphics(t,n);return i.push(),i.translate(t,0),i.scale(-1,1),i.image(e,0,0,t,n),i.pop(),i}var a=document.createElement("canvas");a.width=t,a.height=n;var o=a.getContext("2d");return o.drawImage(r,0,0,t,n),o.translate(t,0),o.scale(-1,1),o.drawImage(a,-1*t,0,t,n),a};function pe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return x.tidy((function(){var n=x.browser.fromPixels(e);return t&&(n=x.image.resizeBilinear(n,t)),de(n).expandDims(0).toFloat().div(x.scalar(127)).sub(x.scalar(1))}))}function me(e){return e instanceof HTMLVideoElement||e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData}function ve(e){var t,n,r;r=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData?e:"object"===I()(e)&&(e.elt instanceof HTMLImageElement||e.elt instanceof HTMLCanvasElement||e.elt instanceof HTMLVideoElement||e.elt instanceof ImageData)?e.elt:"object"===I()(e)&&e.canvas instanceof HTMLCanvasElement?e.canvas:e,HTMLVideoElement,t=r.width,n=r.height;var i=document.createElement("canvas");i.width=t,i.height=n;var a=i.getContext("2d");a.drawImage(r,0,0,t,n);var o=a.getImageData(0,0,t,n);return Array.from(o.data)}var ge={mobilenet:{version:2,alpha:1,topk:3}},ye=["mobilenet","darknet","darknet-tiny","doodlenet"],be=function(){function e(t,n,o,s){if(S()(this,e),this.video=n,this.model=null,this.mapStringToIndex=[],"string"==typeof t)if(ye.includes(t))switch(this.modelName=t,this.modelUrl=null,this.modelName){case"mobilenet":this.modelToUse=r,this.version=o.version||ge.mobilenet.version,this.alpha=o.alpha||ge.mobilenet.alpha,this.topk=o.topk||ge.mobilenet.topk;break;case"darknet":this.version="reference",this.modelToUse=i;break;case"darknet-tiny":this.version="tiny",this.modelToUse=i;break;case"doodlenet":this.modelToUse=a;break;default:this.modelToUse=null}else this.modelUrl=t,this.modelUrl.endsWith("/")&&(this.modelUrl+="model.json");this.ready=T(this.loadModel(this.modelUrl),s)}return A()(e,[{key:"loadModel",value:function(){var e=k()(D.a.mark((function e(t){return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=6;break}return e.next=3,this.loadModelFrom(t);case 3:this.model=e.sent,e.next=9;break;case 6:return e.next=8,this.modelToUse.load({version:this.version,alpha:this.alpha});case 8:this.model=e.sent;case 9:return e.abrupt("return",this);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadModelFrom",value:function(){var e=k()(D.a.mark((function e(){var t,n,r,i,a,o,s,u,c=arguments;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=c.length>0&&void 0!==c[0]?c[0]:null,e.prev=1,null===t){e.next=7;break}return e.next=5,R.a.get(t);case 5:r=e.sent,n=r.data;case 7:if(n.ml5Specs&&(this.mapStringToIndex=n.ml5Specs.mapStringToIndex),0!==this.mapStringToIndex.length){e.next=16;break}return i=t.split("/"),a=i.slice(0,i.length-1).join("/"),o="".concat(a,"/metadata.json"),e.next=14,R.a.get(o).catch((function(e){console.log("Tried to fetch metadata.json, but it seems to be missing.",e)}));case 14:(s=e.sent)&&(u=s.data).labels&&(this.mapStringToIndex=u.labels);case 16:return e.next=18,x.loadLayersModel(t);case 18:return this.model=e.sent,e.abrupt("return",this.model);case 22:return e.prev=22,e.t0=e.catch(1),console.error(e.t0),e.abrupt("return",e.t0);case 26:case"end":return e.stop()}}),e,this,[[1,22]])})));return function(){return e.apply(this,arguments)}}()},{key:"classifyInternal",value:function(){var e=k()(D.a.mark((function e(t,n){var r,i,a,o,s,u,c=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ready;case 2:return e.next=4,x.nextFrame();case 4:if(!(t instanceof HTMLVideoElement&&0===t.readyState)){e.next=8;break}return r=t,e.next=8,new Promise((function(e){r.onloadeddata=function(){return e()}}));case 8:if(!this.video||0!==this.video.readyState){e.next=11;break}return e.next=11,new Promise((function(e){c.video.onloadeddata=function(){return e()}}));case 11:if(i=[224,224],!this.modelUrl){e.next=20;break}return e.next=15,x.nextFrame();case 15:return a=x.tidy((function(){var e=pe(t,i),n=c.model.predict(e);return Array.from(n.as1D().dataSync())})),e.next=18,a.map((function(e,t){return{label:c.mapStringToIndex.length>0&&c.mapStringToIndex[t]?c.mapStringToIndex[t]:t,confidence:e}})).sort((function(e,t){return t.confidence-e.confidence}));case 18:return o=e.sent,e.abrupt("return",o);case 20:return s=pe(t,i),u=this.model.classify(s,n).then((function(e){return e.map((function(e){return{label:e.className,confidence:e.probability}}))})),s.dispose(),e.abrupt("return",u);case 24:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"classify",value:function(){var e=k()(D.a.mark((function e(t){var n,r,i,a,o,s=arguments;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=s.length>1&&void 0!==s[1]?s[1]:null,r=s.length>2?s[2]:void 0,i=this.video,a=this.topk,"function"!=typeof t){e.next=9;break}i=this.video,o=t,e.next=28;break;case 9:if("number"!=typeof t){e.next=14;break}i=this.video,a=t,e.next=28;break;case 14:if(!(t instanceof HTMLVideoElement||t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData)){e.next=18;break}i=t,e.next=28;break;case 18:if("object"!==I()(t)||!(t.elt instanceof HTMLVideoElement||t.elt instanceof HTMLImageElement||t.elt instanceof HTMLCanvasElement||t.elt instanceof ImageData)){e.next=22;break}i=t.elt,e.next=28;break;case 22:if(!("object"===I()(t)&&t.canvas instanceof HTMLCanvasElement)){e.next=26;break}i=t.canvas,e.next=28;break;case 26:if(this.video instanceof HTMLVideoElement){e.next=28;break}throw new Error("No input image provided. If you want to classify a video, pass the video element in the constructor. ");case 28:return"number"==typeof n?a=n:"function"==typeof n&&(o=n),"function"==typeof r&&(o=r),e.abrupt("return",T(this.classifyInternal(i,a),o));case 31:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"predict",value:function(){var e=k()(D.a.mark((function e(t,n,r){return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.classify(t,n||null,r));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),e}(),xe=function(e,t,n,r){var i,a={},o=r,s=e;if("string"!=typeof s)throw new Error('Please specify a model to use. E.g: "MobileNet"');-1===s.indexOf("http")&&(s=e.toLowerCase()),t instanceof HTMLVideoElement?i=t:"object"===I()(t)&&t.elt instanceof HTMLVideoElement?i=t.elt:"object"===I()(t)?a=t:"function"==typeof t&&(o=t),"object"===I()(n)?a=n:"function"==typeof n&&(o=n);var u=new be(s,i,a,o);return o?u:u.ready},we=function(e,t){return(we=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},_e=function(){return(_e=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function ke(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))}function Ee(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function Se(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}function Ce(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,a=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return o}function Ae(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Ce(arguments[t]));return e}var Oe=null;function De(e){return null==Oe&&(Oe=Object(x.backend)().epsilon()),Object(x.tidy)((function(){var t=Object(x.moments)(e),n=t.mean,r=t.variance;return e.sub(n).div(r.sqrt().add(Oe))}))}var Te=function(){function e(e){var t=this;if(null==e)throw new Error("Required configuration object is missing for BrowserFftFeatureExtractor constructor");if(null==e.spectrogramCallback)throw new Error("spectrogramCallback cannot be null or undefined");if(!(e.numFramesPerSpectrogram>0))throw new Error("Invalid value in numFramesPerSpectrogram: "+e.numFramesPerSpectrogram);if(e.suppressionTimeMillis<0)throw new Error("Expected suppressionTimeMillis to be >= 0, but got "+e.suppressionTimeMillis);if(this.suppressionTimeMillis=e.suppressionTimeMillis,this.spectrogramCallback=e.spectrogramCallback,this.numFrames=e.numFramesPerSpectrogram,this.sampleRateHz=e.sampleRateHz||44100,this.fftSize=e.fftSize||1024,this.frameDurationMillis=this.fftSize/this.sampleRateHz*1e3,this.columnTruncateLength=e.columnTruncateLength||this.fftSize,this.overlapFactor=e.overlapFactor,this.includeRawAudio=e.includeRawAudio,x.util.assert(this.overlapFactor>=0&&this.overlapFactor<1,(function(){return"Expected overlapFactor to be >= 0 and < 1, but got "+t.overlapFactor})),this.columnTruncateLength>this.fftSize)throw new Error("columnTruncateLength "+this.columnTruncateLength+" exceeds fftSize ("+this.fftSize+").");this.audioContextConstructor=window.AudioContext||window.webkitAudioContext}return e.prototype.start=function(e){return ke(this,void 0,void 0,(function(){var t,n,r;return Ee(this,(function(i){switch(i.label){case 0:if(null!=this.frameIntervalTask)throw new Error("Cannot start already-started BrowserFftFeatureExtractor");return t=this,[4,function(e){return ke(this,void 0,void 0,(function(){return Ee(this,(function(t){switch(t.label){case 0:return[4,navigator.mediaDevices.getUserMedia({audio:null==e||e,video:!1})];case 1:return[2,t.sent()]}}))}))}(e)];case 1:return t.stream=i.sent(),this.audioContext=new this.audioContextConstructor,this.audioContext.sampleRate!==this.sampleRateHz&&console.warn("Mismatch in sampling rate: Expected: "+this.sampleRateHz+"; Actual: "+this.audioContext.sampleRate),n=this.audioContext.createMediaStreamSource(this.stream),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2*this.fftSize,this.analyser.smoothingTimeConstant=0,n.connect(this.analyser),this.freqDataQueue=[],this.freqData=new Float32Array(this.fftSize),this.includeRawAudio&&(this.timeDataQueue=[],this.timeData=new Float32Array(this.fftSize)),r=Math.max(1,Math.round(this.numFrames*(1-this.overlapFactor))),this.tracker=new Fe(r,Math.round(this.suppressionTimeMillis/this.frameDurationMillis)),this.frameIntervalTask=setInterval(this.onAudioFrame.bind(this),this.fftSize/this.sampleRateHz*1e3),[2]}}))}))},e.prototype.onAudioFrame=function(){return ke(this,void 0,void 0,(function(){var e,t,n,r;return Ee(this,(function(i){switch(i.label){case 0:return this.analyser.getFloatFrequencyData(this.freqData),this.freqData[0]===-1/0?[2]:(this.freqDataQueue.push(this.freqData.slice(0,this.columnTruncateLength)),this.includeRawAudio&&(this.analyser.getFloatTimeDomainData(this.timeData),this.timeDataQueue.push(this.timeData.slice())),this.freqDataQueue.length>this.numFrames&&this.freqDataQueue.shift(),this.tracker.tick()?(e=je(this.freqDataQueue),t=Me(e,[1,this.numFrames,this.columnTruncateLength,1]),n=void 0,this.includeRawAudio&&(r=je(this.timeDataQueue),n=Me(r,[1,this.numFrames*this.fftSize])),[4,this.spectrogramCallback(t,n)]):[3,2]);case 1:i.sent()&&this.tracker.suppress(),Object(x.dispose)([t,n]),i.label=2;case 2:return[2]}}))}))},e.prototype.stop=function(){return ke(this,void 0,void 0,(function(){return Ee(this,(function(e){if(null==this.frameIntervalTask)throw new Error("Cannot stop because there is no ongoing streaming activity.");return clearInterval(this.frameIntervalTask),this.frameIntervalTask=null,this.analyser.disconnect(),this.audioContext.close(),null!=this.stream&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop(),[2]}))}))},e.prototype.setConfig=function(e){throw new Error("setConfig() is not implemented for BrowserFftFeatureExtractor.")},e.prototype.getFeatures=function(){throw new Error("getFeatures() is not implemented for BrowserFftFeatureExtractor. Use the spectrogramCallback field of the constructor config instead.")},e}();function je(e){var t=e[0].length,n=new Float32Array(e.length*t);return e.forEach((function(e,r){return n.set(e,r*t)})),n}function Me(e,t){var n=new Float32Array(x.util.sizeFromShape(t));return n.set(e,n.length-e.length),Object(x.tensor)(n,t)}var Fe=function(){function e(e,t){var n=this;this.period=e,this.suppressionTime=null==t?0:t,this.counter=0,x.util.assert(this.period>0,(function(){return"Expected period to be positive, but got "+n.period}))}return e.prototype.tick=function(){return this.counter++,this.counter%this.period==0&&(null==this.suppressionOnset||this.counter-this.suppressionOnset>this.suppressionTime)},e.prototype.suppress=function(){this.suppressionOnset=this.counter},e}();function Ie(e){var t=0;e.forEach((function(e){t+=e.byteLength}));var n=new Uint8Array(t),r=0;return e.forEach((function(e){n.set(new Uint8Array(e),r),r+=e.byteLength})),n.buffer}function Ne(e){var t=0;e.forEach((function(e){return t+=e.length}));var n=new Float32Array(t),r=0;return e.forEach((function(e){n.set(e,r),r+=e.length})),n}function Re(e){if(null==e)throw new Error("Received null or undefind string");for(var t=unescape(encodeURIComponent(e)),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t.charCodeAt(r);return n.buffer}function Pe(e){if(null==e)throw new Error("Received null or undefind buffer");var t=new Uint8Array(e);return decodeURIComponent(escape(String.fromCharCode.apply(String,Ae(t))))}var Be="TFJSSCDS",Le=1,ze=function(){function e(e){if(this.examples={},this.label2Ids={},null!=e)for(var t=function(e){x.util.assert(null!=e,(function(){return"Received null or undefined buffer"}));var t=0,n=Pe(e.slice(t,Be.length));x.util.assert(n===Be,(function(){return"Deserialization error: Invalid descriptor"})),t+=Be.length,t+=4;var r=new Uint32Array(e,t,1),i=t+=4;t=i+r[0];var a=Pe(e.slice(i,t));return{manifest:JSON.parse(a),data:e.slice(t)}}(e),n=0,r=0;r<t.manifest.length;++r){var i=t.manifest[r],a=i.spectrogramNumFrames*i.spectrogramFrameSize;null!=i.rawAudioNumSamples&&(a+=i.rawAudioNumSamples),a*=4,this.addExample(We({spec:i,data:t.data.slice(n,n+a)})),n+=a}}return e.prototype.addExample=function(e){x.util.assert(null!=e,(function(){return"Got null or undefined example"})),x.util.assert(null!=e.label&&e.label.length>0,(function(){return"Expected label to be a non-empty string, but got "+JSON.stringify(e.label)}));var t=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}();return this.examples[t]=e,e.label in this.label2Ids||(this.label2Ids[e.label]=[]),this.label2Ids[e.label].push(t),t},e.prototype.merge=function(e){var t,n,r,i;x.util.assert(e!==this,(function(){return"Cannot merge a dataset into itself"}));var a=e.getVocabulary();try{for(var o=Se(a),s=o.next();!s.done;s=o.next()){var u=s.value,c=e.getExamples(u);try{for(var l=Se(c),f=l.next();!f.done;f=l.next()){var d=f.value;this.addExample(d.example)}}catch(e){r={error:e}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(r)throw r.error}}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}},e.prototype.getExampleCounts=function(){var e={};for(var t in this.examples){var n=this.examples[t];n.label in e||(e[n.label]=0),e[n.label]++}return e},e.prototype.getExamples=function(e){var t=this;x.util.assert(null!=e,(function(){return"Expected label to be a string, but got "+JSON.stringify(e)})),x.util.assert(e in this.label2Ids,(function(){return'No example of label "'+e+'" exists in dataset'}));var n=[];return this.label2Ids[e].forEach((function(e){n.push({uid:e,example:t.examples[e]})})),n},e.prototype.getData=function(e,t){var n=this;x.util.assert(this.size()>0,(function(){return"Cannot get spectrograms as tensors because the dataset is empty"}));var r=this.getVocabulary();null!=e?x.util.assert(-1!==r.indexOf(e),(function(){return"Label "+e+" is not in the vocabulary ("+JSON.stringify(r)+")"})):x.util.assert(r.length>1,(function(){return"One-hot encoding of labels requires the vocabulary to have at least two words, but it has only "+r.length+" word."})),null==t&&(t={});var i,a,o=this.getSortedUniqueNumFrames();1===o.length?(i=null==t.numFrames?o[0]:t.numFrames,a=null==t.hopFrames?1:t.hopFrames):(i=t.numFrames,x.util.assert(null!=i&&Number.isInteger(i)&&i>0,(function(){return"There are "+o.length+" unique lengths among the "+n.size()+" examples of this Dataset, hence numFrames is required. But it is not provided."})),x.util.assert(i<=o[0],(function(){return"numFrames ("+i+") exceeds the minimum numFrames ("+o[0]+") among the examples of the Dataset."})),a=t.hopFrames,x.util.assert(null!=a&&Number.isInteger(a)&&a>0,(function(){return"There are "+o.length+" unique lengths among the "+n.size()+" examples of this Dataset, hence hopFrames is required. But it is not provided."})));var s=null==t.normalize||t.normalize;return Object(x.tidy)((function(){for(var o,u,c,l=[],f=[],d=[],h=0;h<r.length;++h){var p=r[h];if(null==e||p===e){var m=n.label2Ids[p],v=function(r){var o,u,m=n.examples[r].spectrogram,v=m.frameSize;null==c?c=v:x.util.assert(v===c,(function(){return"Mismatch in frameSize  ("+v+" vs "+c+")"}));var g=m.data.length/v,y=null;"_background_noise_"!==p&&(y=null==m.keyFrameIndex?Ge(m).dataSync()[0]:m.keyFrameIndex);var b=Object(x.tensor3d)(m.data,[g,v,1]),w=Ve(g,y,i,a),_=function(n){var r=Object(x.tidy)((function(){var e=b.slice([n[0],0,0],[n[1]-n[0],-1,-1]);return s?De(e):e}));t.getDataset?f.push(r.dataSync()):l.push(r),null==e&&d.push(h)};try{for(var k=Se(w),E=k.next();!E.done;E=k.next())_(E.value)}catch(e){o={error:e}}finally{try{E&&!E.done&&(u=k.return)&&u.call(k)}finally{if(o)throw o.error}}Object(x.dispose)(b)};try{for(var g=Se(m),y=g.next();!y.done;y=g.next())v(y.value)}catch(e){o={error:e}}finally{try{y&&!y.done&&(u=g.return)&&u.call(g)}finally{if(o)throw o.error}}}}null!=t.augmentByMixingNoiseRatio&&n.augmentByMixingNoise(t.getDataset?f:l,d,t.augmentByMixingNoiseRatio);var b=null==t.shuffle||t.shuffle;if(t.getDataset){var w=null==t.datasetBatchSize?32:t.datasetBatchSize,_=null==t.datasetValidationSplit?.15:t.datasetValidationSplit;x.util.assert(_>0&&_<1,(function(){return"Invalid dataset validation split: "+_}));var k=f.map((function(e,t){return[e,d[t]]}));x.util.shuffle(k),f=k.map((function(e){return e[0]}));var E=k.map((function(e){return e[1]})),S=function(e,t,n){var r,i,a,o,s,u,c,l;x.util.assert(n>0&&n<1,(function(){return"validationSplit is expected to be >0 and <1, but got "+n}));for(var f=!Array.isArray(e[0]),d=t,h=[],p=0;p<d.length;++p){var m=d[p];null==h[m]&&(h[m]=[]),h[m].push(p)}var v=h.length,g=[],y=[];for(h.map((function(e){return x.util.shuffle(e)})),p=0;p<v;++p)for(var b=h[p],w=Math.round(b.length*(1-n)),_=0;_<b.length;++_)_<w?g.push(b[_]):y.push(b[_]);if(f){var k=[],E=[],S=[],C=[];try{for(var A=Se(g),O=A.next();!O.done;O=A.next()){var D=O.value;k.push(e[D]),E.push(t[D])}}catch(e){r={error:e}}finally{try{O&&!O.done&&(i=A.return)&&i.call(A)}finally{if(r)throw r.error}}try{for(var T=Se(y),j=T.next();!j.done;j=T.next())D=j.value,S.push(e[D]),C.push(t[D])}catch(e){a={error:e}}finally{try{j&&!j.done&&(o=T.return)&&o.call(T)}finally{if(a)throw a.error}}return{trainXs:k,trainYs:E,valXs:S,valYs:C}}k=[],E=[],S=[],C=[];try{for(var M=Se(g),F=M.next();!F.done;F=M.next())D=F.value,k.push(e[D]),E.push(t[D])}catch(e){s={error:e}}finally{try{F&&!F.done&&(u=M.return)&&u.call(M)}finally{if(s)throw s.error}}try{for(var I=Se(y),N=I.next();!N.done;N=I.next())D=N.value,S.push(e[D]),C.push(t[D])}catch(e){c={error:e}}finally{try{N&&!N.done&&(l=I.return)&&l.call(I)}finally{if(c)throw c.error}}return{trainXs:k,trainYs:E,valXs:S,valYs:C}}(f,E,_),C=S.trainXs,A=S.trainYs,O=S.valXs,D=S.valYs,T=x.data.array(C).map((function(e){return Object(x.tensor3d)(e,[i,c,1])})),j=x.data.array(A).map((function(e){return Object(x.oneHot)([e],r.length).squeeze([0])})),M=x.data.zip({xs:T,ys:j});b&&(M=M.shuffle(f.length)),M=M.batch(w).prefetch(4);var F=x.data.array(O).map((function(e){return Object(x.tensor3d)(e,[i,c,1])})),I=x.data.array(D).map((function(e){return Object(x.oneHot)([e],r.length).squeeze([0])})),N=x.data.zip({xs:F,ys:I});return[M,N=N.batch(w).prefetch(4)]}if(b){var R=[];l.forEach((function(e,t){R.push({x:e,y:d[t]})})),x.util.shuffle(R),l=R.map((function(e){return e.x})),d=R.map((function(e){return e.y}))}var P=null==e?Object(x.oneHot)(Object(x.tensor1d)(d,"int32"),r.length).asType("float32"):void 0;return{xs:Object(x.stack)(l),ys:P}}))},e.prototype.augmentByMixingNoise=function(e,t,n){var r,i;if(null==e||0===e.length)throw new Error("Cannot perform augmentation because data is null or empty");for(var a=e[0]instanceof Float32Array,o=this.getVocabulary(),s=[],u=[],c=0;c<t.length;++c)"_background_noise_"===o[t[c]]?s.push(c):u.push(c);if(0===s.length)throw new Error("Cannot perform augmentation by mixing with noise when there is no example with label _background_noise_");var l=[],f=[],d=function(r){var i=s[function(e,t){return Math.floor((t-e)*Math.random())+e}(0,s.length)],o=a?Object(x.tensor1d)(e[r]):e[r],u=a?Object(x.tensor1d)(e[i]):e[i],c=Object(x.tidy)((function(){return De(o.add(u.mul(n)))}));a?l.push(c.dataSync()):l.push(c),f.push(t[r])};try{for(var h=Se(u),p=h.next();!p.done;p=h.next())d(p.value)}catch(e){r={error:e}}finally{try{p&&!p.done&&(i=h.return)&&i.call(h)}finally{if(r)throw r.error}}console.log("Data augmentation: mixing noise: added "+l.length+" examples"),l.forEach((function(t){return e.push(t)})),t.push.apply(t,Ae(f))},e.prototype.getSortedUniqueNumFrames=function(){for(var e,t,n=new Set,r=this.getVocabulary(),i=0;i<r.length;++i){var a=r[i],o=this.label2Ids[a];try{for(var s=Se(o),u=s.next();!u.done;u=s.next()){var c=u.value,l=this.examples[c].spectrogram,f=l.data.length/l.frameSize;n.add(f)}}catch(t){e={error:t}}finally{try{u&&!u.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}}var d=Ae(n);return d.sort(),d},e.prototype.removeExample=function(e){if(!(e in this.examples))throw new Error("Nonexistent example UID: "+e);var t=this.examples[e].label;delete this.examples[e];var n=this.label2Ids[t].indexOf(e);this.label2Ids[t].splice(n,1),0===this.label2Ids[t].length&&delete this.label2Ids[t]},e.prototype.setExampleKeyFrameIndex=function(e,t){if(!(e in this.examples))throw new Error("Nonexistent example UID: "+e);var n=this.examples[e].spectrogram,r=n.data.length/n.frameSize;x.util.assert(t>=0&&t<r&&Number.isInteger(t),(function(){return"Invalid keyFrameIndex: "+t+". Must be >= 0, < "+r+", and an integer."})),n.keyFrameIndex=t},e.prototype.size=function(){return Object.keys(this.examples).length},e.prototype.durationMillis=function(){var e=0;for(var t in this.examples){var n=this.examples[t].spectrogram,r=23.22|n.frameDurationMillis;e+=n.data.length/n.frameSize*r}return e},e.prototype.empty=function(){return 0===this.size()},e.prototype.clear=function(){this.examples={}},e.prototype.getVocabulary=function(){var e=new Set;for(var t in this.examples){var n=this.examples[t];e.add(n.label)}var r=Ae(e);return r.sort(),r},e.prototype.serialize=function(e){var t,n,r,i,a=this.getVocabulary();x.util.assert(!this.empty(),(function(){return"Cannot serialize empty Dataset"})),null!=e&&(Array.isArray(e)||(e=[e]),e.forEach((function(e){if(-1===a.indexOf(e))throw new Error('Word label "'+e+'" does not exist in the vocabulary of this dataset. The vocabulary is: '+JSON.stringify(a)+".")})));var o=[],s=[];try{for(var u=Se(a),c=u.next();!c.done;c=u.next()){var l=c.value;if(null==e||-1!==e.indexOf(l)){var f=this.label2Ids[l];try{for(var d=Se(f),h=d.next();!h.done;h=d.next()){var p=h.value,m=Ue(this.examples[p]);o.push(m.spec),s.push(m.data)}}catch(e){r={error:e}}finally{try{h&&!h.done&&(i=d.return)&&i.call(d)}finally{if(r)throw r.error}}}}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}return function(e){var t=Re(JSON.stringify(e.manifest)),n=Re(Be),r=new Uint32Array([Le]),i=new Uint32Array([t.byteLength]);return Ie([Ie([n,r.buffer,i.buffer]),t,e.data])}({manifest:o,data:Ie(s)})},e}();function Ue(e){var t=null!=e.rawAudio,n={label:e.label,spectrogramNumFrames:e.spectrogram.data.length/e.spectrogram.frameSize,spectrogramFrameSize:e.spectrogram.frameSize};null!=e.spectrogram.keyFrameIndex&&(n.spectrogramKeyFrameIndex=e.spectrogram.keyFrameIndex);var r=e.spectrogram.data.buffer.slice(0);return t&&(n.rawAudioNumSamples=e.rawAudio.data.length,n.rawAudioSampleRateHz=e.rawAudio.sampleRateHz,r=Ie([r,e.rawAudio.data.buffer])),{spec:n,data:r}}function We(e){var t={frameSize:e.spec.spectrogramFrameSize,data:new Float32Array(e.data.slice(0,4*e.spec.spectrogramFrameSize*e.spec.spectrogramNumFrames))};null!=e.spec.spectrogramKeyFrameIndex&&(t.keyFrameIndex=e.spec.spectrogramKeyFrameIndex);var n={label:e.spec.label,spectrogram:t};return null!=e.spec.rawAudioNumSamples&&(n.rawAudio={sampleRateHz:e.spec.rawAudioSampleRateHz,data:new Float32Array(e.data.slice(4*e.spec.spectrogramFrameSize*e.spec.spectrogramNumFrames))}),n}function Ve(e,t,n,r){if(x.util.assert(Number.isInteger(e)&&e>0,(function(){return"snippetLength must be a positive integer, but got "+e})),null!=t&&x.util.assert(Number.isInteger(t)&&t>=0,(function(){return"focusIndex must be a non-negative integer, but got "+t})),x.util.assert(Number.isInteger(n)&&n>0,(function(){return"windowLength must be a positive integer, but got "+n})),x.util.assert(Number.isInteger(r)&&r>0,(function(){return"windowHop must be a positive integer, but got "+r})),x.util.assert(n<=e,(function(){return"windowLength ("+n+") exceeds snippetLength ("+e+")"})),x.util.assert(t<e,(function(){return"focusIndex ("+t+") equals or exceeds snippetLength ("+e+")"})),n===e)return[[0,e]];var i=[];if(null==t){for(var a=0;a+n<=e;)i.push([a,a+n]),a+=r;return i}var o=Math.floor(n/2),s=t-o;for(s<0?s=0:s+n>e&&(s=e-n);!(s-r<0||t>=s-r+n);)s-=r;for(;s+n<=e&&!(t<s);)i.push([s,s+n]),s+=r;return i}function Ge(e){return Object(x.tidy)((function(){return function(e){return Object(x.tidy)((function(){var t=e.data.length/e.frameSize;return Object(x.tensor2d)(e.data,[t,e.frameSize]).mean(-1)}))}(e).argMax()}))}var qe="0.3.9",He="tfjs-speech-commands-saved-model-metadata",Xe="indexeddb://tfjs-speech-commands-model/",Ke={localStorage:"undefined"==typeof window?null:window.localStorage},Ye=function(){function e(t,n,r){this.MODEL_URL_PREFIX="https://storage.googleapis.com/tfjs-models/tfjs/speech-commands/v"+function(e){return e.split(".").slice(0,2).join(".")}(qe)+"/browser_fft",this.SAMPLE_RATE_HZ=44100,this.FFT_SIZE=1024,this.DEFAULT_SUPPRESSION_TIME_MILLIS=0,this.streaming=!1,this.transferRecognizers={},x.util.assert(null==n&&null==r||null!=n&&null!=r,(function(){return"modelURL and metadataURL must be both provided or both not provided."})),null==n?(null==t?t=e.DEFAULT_VOCABULARY_NAME:x.util.assert(-1!==e.VALID_VOCABULARY_NAMES.indexOf(t),(function(){return"Invalid vocabulary name: '"+t+"'"})),this.vocabulary=t,this.modelArtifactsOrURL=this.MODEL_URL_PREFIX+"/"+this.vocabulary+"/model.json",this.metadataOrURL=this.MODEL_URL_PREFIX+"/"+this.vocabulary+"/metadata.json"):(x.util.assert(null==t,(function(){return"vocabulary name must be null or undefined when modelURL is provided"})),this.modelArtifactsOrURL=n,this.metadataOrURL=r),this.parameters={sampleRateHz:this.SAMPLE_RATE_HZ,fftSize:this.FFT_SIZE}}return e.prototype.listen=function(e,t){return ke(this,void 0,void 0,(function(){var n,r,i,a,o,s=this;return Ee(this,(function(u){switch(u.label){case 0:if(this.streaming)throw new Error("Cannot start streaming again when streaming is ongoing.");return[4,this.ensureModelLoaded()];case 1:if(u.sent(),null==t&&(t={}),n=null==t.probabilityThreshold?0:t.probabilityThreshold,t.includeEmbedding&&(n=0),x.util.assert(n>=0&&n<=1,(function(){return"Invalid probabilityThreshold value: "+n})),r=null!=t.invokeCallbackOnNoiseAndUnknown&&t.invokeCallbackOnNoiseAndUnknown,t.includeEmbedding&&(r=!0),t.suppressionTimeMillis<0)throw new Error("suppressionTimeMillis is expected to be >= 0, but got "+t.suppressionTimeMillis);return i=null==t.overlapFactor?.5:t.overlapFactor,x.util.assert(i>=0&&i<1,(function(){return"Expected overlapFactor to be >= 0 and < 1, but got "+i})),a=function(i,a){return ke(s,void 0,void 0,(function(){var a,o,s,u,c,l,f,d,h,p,m;return Ee(this,(function(v){switch(v.label){case 0:return o=De(i),t.includeEmbedding?[4,this.ensureModelWithEmbeddingOutputCreated()]:[3,2];case 1:return v.sent(),a=Ce(this.modelWithEmbeddingOutput.predict(o),2),s=a[0],u=a[1],[3,3];case 2:s=this.model.predict(o),v.label=3;case 3:return[4,s.data()];case 4:return c=v.sent(),[4,(l=s.argMax(-1)).data()];case 5:return f=v.sent()[0],d=Math.max.apply(Math,Ae(c)),Object(x.dispose)([s,l,o]),d<n?[2,!1]:[3,6];case 6:return h=void 0,t.includeSpectrogram?(p={},[4,i.data()]):[3,8];case 7:p.data=v.sent(),p.frameSize=this.nonBatchInputShape[1],h=p,v.label=8;case 8:return m=!0,r||"_background_noise_"!==this.words[f]&&"_unknown_"!==this.words[f]||(m=!1),m&&e({scores:c,spectrogram:h,embedding:u}),[2,m]}}))}))},o=null==t.suppressionTimeMillis?this.DEFAULT_SUPPRESSION_TIME_MILLIS:t.suppressionTimeMillis,this.audioDataExtractor=new Te({sampleRateHz:this.parameters.sampleRateHz,numFramesPerSpectrogram:this.nonBatchInputShape[0],columnTruncateLength:this.nonBatchInputShape[1],suppressionTimeMillis:o,spectrogramCallback:a,overlapFactor:i}),[4,this.audioDataExtractor.start(t.audioTrackConstraints)];case 2:return u.sent(),this.streaming=!0,[2]}}))}))},e.prototype.ensureModelLoaded=function(){return ke(this,void 0,void 0,(function(){var e,t,n,r,i=this;return Ee(this,(function(a){switch(a.label){case 0:return null!=this.model?[2]:[4,this.ensureMetadataLoaded()];case 1:return a.sent(),"string"!=typeof this.modelArtifactsOrURL?[3,3]:[4,Object(x.loadLayersModel)(this.modelArtifactsOrURL)];case 2:return e=a.sent(),[3,5];case 3:return[4,Object(x.loadLayersModel)(x.io.fromMemory(this.modelArtifactsOrURL.modelTopology,this.modelArtifactsOrURL.weightSpecs,this.modelArtifactsOrURL.weightData))];case 4:e=a.sent(),a.label=5;case 5:if(1!==e.inputs.length)throw new Error("Expected model to have 1 input, but got a model with "+e.inputs.length+" inputs");if(4!==e.inputs[0].shape.length)throw new Error("Expected model to have an input shape of rank 4, but got an input shape of rank "+e.inputs[0].shape.length);if(1!==e.inputs[0].shape[3])throw new Error("Expected model to have an input shape with 1 as the last dimension, but got input shape"+JSON.stringify(e.inputs[0].shape[3])+"}");if(2!==(t=e.outputShape).length)throw new Error("Expected loaded model to have an output shape of rank 2,but received shape "+JSON.stringify(t));if(t[1]!==this.words.length)throw new Error("Mismatch between the last dimension of model's output shape ("+t[1]+") and number of words ("+this.words.length+").");return this.model=e,this.freezeModel(),this.nonBatchInputShape=e.inputs[0].shape.slice(1),this.elementsPerExample=1,e.inputs[0].shape.slice(1).forEach((function(e){return i.elementsPerExample*=e})),this.warmUpModel(),n=this.parameters.fftSize/this.parameters.sampleRateHz*1e3,r=e.inputs[0].shape[1],this.parameters.spectrogramDurationMillis=r*n,[2]}}))}))},e.prototype.ensureModelWithEmbeddingOutputCreated=function(){return ke(this,void 0,void 0,(function(){var e,t;return Ee(this,(function(n){switch(n.label){case 0:return null!=this.modelWithEmbeddingOutput?[2]:[4,this.ensureModelLoaded()];case 1:for(n.sent(),t=this.model.layers.length-2;t>=0;--t)if("Dense"===this.model.layers[t].getClassName()){e=this.model.layers[t];break}if(null==e)throw new Error("Failed to find second last dense layer in the original model.");return this.modelWithEmbeddingOutput=Object(x.model)({inputs:this.model.inputs,outputs:[this.model.outputs[0],e.output]}),[2]}}))}))},e.prototype.warmUpModel=function(){var e=this;Object(x.tidy)((function(){for(var t=Object(x.zeros)([1].concat(e.nonBatchInputShape)),n=0;n<3;++n)e.model.predict(t)}))},e.prototype.ensureMetadataLoaded=function(){return ke(this,void 0,void 0,(function(){var e,t,r;return Ee(this,(function(i){switch(i.label){case 0:return null!=this.words?[2]:"string"!=typeof this.metadataOrURL?[3,2]:[4,function(e){return ke(this,void 0,void 0,(function(){return Ee(this,(function(t){return[2,new Promise((function(t,r){0===e.indexOf("http://")||0===e.indexOf("https://")?fetch(e).then((function(e){e.json().then((function(e){return t(e)}))})):0===e.indexOf("file://")?n(185).readFile(e.slice("file://".length),{encoding:"utf-8"},(function(e,n){return t(JSON.parse(n))})):r(new Error("Unsupported URL scheme in metadata URL: "+e+". Supported schemes are: http://, https://, and (node.js-only) file://"))}))]}))}))}(this.metadataOrURL)];case 1:return t=i.sent(),[3,3];case 2:t=this.metadataOrURL,i.label=3;case 3:if(null==(e=t).wordLabels){if(null==(r=e.words))throw new Error('Cannot find field "words" or "wordLabels" in metadata JSON file');this.words=r}else this.words=e.wordLabels;return[2]}}))}))},e.prototype.stopListening=function(){return ke(this,void 0,void 0,(function(){return Ee(this,(function(e){switch(e.label){case 0:if(!this.streaming)throw new Error("Cannot stop streaming when streaming is not ongoing.");return[4,this.audioDataExtractor.stop()];case 1:return e.sent(),this.streaming=!1,[2]}}))}))},e.prototype.isListening=function(){return this.streaming},e.prototype.wordLabels=function(){return this.words},e.prototype.params=function(){return this.parameters},e.prototype.modelInputShape=function(){if(null==this.model)throw new Error("Model has not been loaded yet. Load model by calling ensureModelLoaded(), recognize(), or listen().");return this.model.inputs[0].shape},e.prototype.recognize=function(e,t){return ke(this,void 0,void 0,(function(){var n,r,i,a,o,s,u,c,l,f,d,h,p;return Ee(this,(function(m){switch(m.label){case 0:return null==t&&(t={}),[4,this.ensureModelLoaded()];case 1:return m.sent(),null!=e?[3,3]:[4,this.recognizeOnline()];case 2:n=m.sent(),e=n.data,m.label=3;case 3:if(e instanceof x.Tensor)this.checkInputTensorShape(e),i=e,r=e.shape[0];else{if(e.length%this.elementsPerExample)throw new Error("The length of the input Float32Array "+e.length+" is not divisible by the number of tensor elements per per example expected by the model "+this.elementsPerExample+".");r=e.length/this.elementsPerExample,i=Object(x.tensor4d)(e,[r].concat(this.nonBatchInputShape))}return o={scores:null},t.includeEmbedding?[4,this.ensureModelWithEmbeddingOutputCreated()]:[3,5];case 4:return m.sent(),s=this.modelWithEmbeddingOutput.predict(i),a=s[0],o.embedding=s[1],[3,6];case 5:a=this.model.predict(i),m.label=6;case 6:return 1!==r?[3,8]:(u=o,[4,a.data()]);case 7:return u.scores=m.sent(),[3,10];case 8:return c=Object(x.unstack)(a),l=c.map((function(e){return e.data()})),f=o,[4,Promise.all(l)];case 9:f.scores=m.sent(),Object(x.dispose)(c),m.label=10;case 10:return t.includeSpectrogram?(d=o,h={},e instanceof x.Tensor?[4,e.data()]:[3,12]):[3,14];case 11:return p=m.sent(),[3,13];case 12:p=e,m.label=13;case 13:d.spectrogram=(h.data=p,h.frameSize=this.nonBatchInputShape[1],h),m.label=14;case 14:return[2,o]}}))}))},e.prototype.recognizeOnline=function(){return ke(this,void 0,void 0,(function(){var e=this;return Ee(this,(function(t){return[2,new Promise((function(t,n){e.audioDataExtractor=new Te({sampleRateHz:e.parameters.sampleRateHz,numFramesPerSpectrogram:e.nonBatchInputShape[0],columnTruncateLength:e.nonBatchInputShape[1],suppressionTimeMillis:0,spectrogramCallback:function(n){return ke(e,void 0,void 0,(function(){var e,r,i;return Ee(this,(function(a){switch(a.label){case 0:return e=De(n),[4,this.audioDataExtractor.stop()];case 1:return a.sent(),r=t,i={},[4,e.data()];case 2:return r.apply(void 0,[(i.data=a.sent(),i.frameSize=this.nonBatchInputShape[1],i)]),e.dispose(),[2,!1]}}))}))},overlapFactor:0}),e.audioDataExtractor.start()}))]}))}))},e.prototype.createTransfer=function(e){if(null==this.model)throw new Error("Model has not been loaded yet. Load model by calling ensureModelLoaded(), recognizer(), or listen().");x.util.assert(null!=e&&"string"==typeof e&&e.length>1,(function(){return"Expected the name for a transfer-learning recognized to be a non-empty string, but got "+JSON.stringify(e)})),x.util.assert(null==this.transferRecognizers[e],(function(){return"There is already a transfer-learning model named '"+e+"'"}));var t=new $e(e,this.parameters,this.model);return this.transferRecognizers[e]=t,t},e.prototype.freezeModel=function(){var e,t;try{for(var n=Se(this.model.layers),r=n.next();!r.done;r=n.next())r.value.trainable=!1}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},e.prototype.checkInputTensorShape=function(e){var t=this.model.inputs[0].shape.length;if(e.shape.length!==t)throw new Error("Expected input Tensor to have rank "+t+", but got rank "+e.shape.length+" that differs ");var n=e.shape.slice(1),r=this.model.inputs[0].shape.slice(1);if(!x.util.arraysEqual(n,r))throw new Error("Expected input to have shape [null,"+r+"], but got shape [null,"+n+"]")},e.VALID_VOCABULARY_NAMES=["18w","directional4w"],e.DEFAULT_VOCABULARY_NAME="18w",e}(),$e=function(e){function t(t,n,r){var i=e.call(this)||this;return i.name=t,i.parameters=n,i.baseModel=r,x.util.assert(null!=t&&"string"==typeof t&&t.length>0,(function(){return"The name of a transfer model must be a non-empty string, but got "+JSON.stringify(t)})),i.nonBatchInputShape=i.baseModel.inputs[0].shape.slice(1),i.words=null,i.dataset=new ze,i}return function(e,t){function n(){this.constructor=e}we(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),t.prototype.collectExample=function(e,t){return ke(this,void 0,void 0,(function(){var n,r,i,a,o=this;return Ee(this,(function(s){if(x.util.assert(!this.streaming,(function(){return"Cannot start collection of transfer-learning example because a streaming recognition or transfer-learning example collection is ongoing"})),x.util.assert(null!=e&&"string"==typeof e&&e.length>0,(function(){return"Must provide a non-empty string when collecting transfer-learning example"})),null==t&&(t={}),null!=t.durationMultiplier&&null!=t.durationSec)throw new Error("durationMultiplier and durationSec are mutually exclusive, but are both specified.");return null!=t.durationSec?(x.util.assert(t.durationSec>0,(function(){return"Expected durationSec to be > 0, but got "+t.durationSec})),r=this.parameters.fftSize/this.parameters.sampleRateHz,n=Math.ceil(t.durationSec/r)):null!=t.durationMultiplier?(x.util.assert(t.durationMultiplier>=1,(function(){return"Expected duration multiplier to be >= 1, but got "+t.durationMultiplier})),n=Math.round(this.nonBatchInputShape[0]*t.durationMultiplier)):n=this.nonBatchInputShape[0],null!=t.snippetDurationSec&&(x.util.assert(t.snippetDurationSec>0,(function(){return"snippetDurationSec is expected to be > 0, but got "+t.snippetDurationSec})),x.util.assert(null!=t.onSnippet,(function(){return"onSnippet must be provided if snippetDurationSec is provided."}))),null!=t.onSnippet&&x.util.assert(null!=t.snippetDurationSec,(function(){return"snippetDurationSec must be provided if onSnippet is provided."})),i=this.parameters.fftSize/this.parameters.sampleRateHz,a=i*n,this.streaming=!0,[2,new Promise((function(r){var i=null==t.snippetDurationSec?1:t.snippetDurationSec/a,s=1-i,u=Math.round(1/i),c=0,l=-1,f=[];o.audioDataExtractor=new Te({sampleRateHz:o.parameters.sampleRateHz,numFramesPerSpectrogram:n,columnTruncateLength:o.nonBatchInputShape[1],suppressionTimeMillis:0,spectrogramCallback:function(n,i){return ke(o,void 0,void 0,(function(){var a,o,s,d,h,p,m,v,g,y,b,w,_,k,E,S,C,A,O,D;return Ee(this,(function(T){switch(T.label){case 0:return null!=t.onSnippet?[3,7]:(a=De(n),s=(o=this.dataset).addExample,d={label:e},h={},[4,a.data()]);case 1:return d.spectrogram=(h.data=T.sent(),h.frameSize=this.nonBatchInputShape[1],h),t.includeRawAudio?(m={},[4,i.data()]):[3,3];case 2:return m.data=T.sent(),m.sampleRateHz=this.audioDataExtractor.sampleRateHz,p=m,[3,4];case 3:p=void 0,T.label=4;case 4:return s.apply(o,[(d.rawAudio=p,d)]),a.dispose(),[4,this.audioDataExtractor.stop()];case 5:return T.sent(),this.streaming=!1,this.collateTransferWords(),v=r,g={},[4,n.data()];case 6:return v.apply(void 0,[(g.data=T.sent(),g.frameSize=this.nonBatchInputShape[1],g)]),[3,13];case 7:return[4,n.data()];case 8:for(y=T.sent(),-1===l&&(l=y.length),b=l-1;0!==y[b]&&b>=0;)b--;return w=l-b-1,l=b+1,_=y.slice(y.length-w,y.length),f.push(_),null!=t.onSnippet&&t.onSnippet({data:_,frameSize:this.nonBatchInputShape[1]}),c++!==u?[3,13]:[4,this.audioDataExtractor.stop()];case 9:return T.sent(),this.streaming=!1,this.collateTransferWords(),k=function(e){if(e.length<2)throw new Error("Cannot normalize a Float32Array with fewer than 2 elements.");return null==Oe&&(Oe=Object(x.backend)().epsilon()),Object(x.tidy)((function(){var t=Object(x.moments)(Object(x.tensor1d)(e)),n=t.mean,r=t.variance,i=n.arraySync(),a=Math.sqrt(r.arraySync()),o=Array.from(e).map((function(e){return(e-i)/(a+Oe)}));return new Float32Array(o)}))}(Ne(f)),E={data:k,frameSize:this.nonBatchInputShape[1]},C=(S=this.dataset).addExample,A={label:e,spectrogram:E},t.includeRawAudio?(D={},[4,i.data()]):[3,11];case 10:return D.data=T.sent(),D.sampleRateHz=this.audioDataExtractor.sampleRateHz,O=D,[3,12];case 11:O=void 0,T.label=12;case 12:C.apply(S,[(A.rawAudio=O,A)]),r(E),T.label=13;case 13:return[2,!1]}}))}))},overlapFactor:s,includeRawAudio:t.includeRawAudio}),o.audioDataExtractor.start(t.audioTrackConstraints)}))]}))}))},t.prototype.clearExamples=function(){var e=this;x.util.assert(null!=this.words&&this.words.length>0&&!this.dataset.empty(),(function(){return"No transfer learning examples exist for model name "+e.name})),this.dataset.clear(),this.words=null},t.prototype.countExamples=function(){if(this.dataset.empty())throw new Error("No examples have been collected for transfer-learning model named '"+this.name+"' yet.");return this.dataset.getExampleCounts()},t.prototype.getExamples=function(e){return this.dataset.getExamples(e)},t.prototype.setExampleKeyFrameIndex=function(e,t){this.dataset.setExampleKeyFrameIndex(e,t)},t.prototype.removeExample=function(e){this.dataset.removeExample(e),this.collateTransferWords()},t.prototype.isDatasetEmpty=function(){return this.dataset.empty()},t.prototype.loadExamples=function(e,t){var n,r,i,a;void 0===t&&(t=!1);var o=new ze(e);t&&this.clearExamples();var s=o.getVocabulary();try{for(var u=Se(s),c=u.next();!c.done;c=u.next()){var l=c.value,f=o.getExamples(l);try{for(var d=Se(f),h=d.next();!h.done;h=d.next()){var p=h.value;this.dataset.addExample(p.example)}}catch(e){i={error:e}}finally{try{h&&!h.done&&(a=d.return)&&a.call(d)}finally{if(i)throw i.error}}}}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}this.collateTransferWords()},t.prototype.serializeExamples=function(e){return this.dataset.serialize(e)},t.prototype.collateTransferWords=function(){this.words=this.dataset.getVocabulary()},t.prototype.collectTransferDataAsTensors=function(e,t){var n=this.nonBatchInputShape[0];e=e||.25;var r=Math.round(e*n),i=this.dataset.getData(null,_e({numFrames:n,hopFrames:r},t));return{xs:i.xs,ys:i.ys}},t.prototype.collectTransferDataAsTfDataset=function(e,t,n,r){void 0===t&&(t=.15),void 0===n&&(n=32);var i=this.nonBatchInputShape[0];e=e||.25;var a=Math.round(e*i);return this.dataset.getData(null,_e({numFrames:i,hopFrames:a,getDataset:!0,datasetBatchSize:n,datasetValidationSplit:t},r))},t.prototype.train=function(e){return ke(this,void 0,void 0,(function(){var t,n=this;return Ee(this,(function(r){switch(r.label){case 0:return x.util.assert(null!=this.words&&this.words.length>0,(function(){return"Cannot train transfer-learning model '"+n.name+"' because no transfer learning example has been collected."})),x.util.assert(this.words.length>1,(function(){return"Cannot train transfer-learning model '"+n.name+"' because only 1 word label ('"+JSON.stringify(n.words)+"') has been collected for transfer learning. Requires at least 2."})),null!=e.fineTuningEpochs&&x.util.assert(e.fineTuningEpochs>=0&&Number.isInteger(e.fineTuningEpochs),(function(){return"If specified, fineTuningEpochs must be a non-negative integer, but received "+e.fineTuningEpochs})),null==e&&(e={}),null==this.model&&this.createTransferModelFromBaseModel(),this.secondLastBaseDenseLayer.trainable=!1,this.model.compile({loss:"categoricalCrossentropy",optimizer:e.optimizer||"sgd",metrics:["acc"]}),t=null==e.fitDatasetDurationMillisThreshold?6e4:e.fitDatasetDurationMillisThreshold,this.dataset.durationMillis()>t?(console.log("Detected large dataset: total duration = "+this.dataset.durationMillis()+" ms > "+t+" ms. Training transfer model using fitDataset() instead of fit()"),[4,this.trainOnDataset(e)]):[3,2];case 1:case 3:return[2,r.sent()];case 2:return[4,this.trainOnTensors(e)]}}))}))},t.prototype.trainOnDataset=function(e){return ke(this,void 0,void 0,(function(){var t,n,r,i,a,o,s,u,c;return Ee(this,(function(l){switch(l.label){case 0:return x.util.assert(e.epochs>0,(function(){return"Invalid config.epochs"})),t=null==e.batchSize?32:e.batchSize,n=e.windowHopRatio||.25,r=Ce(this.collectTransferDataAsTfDataset(n,e.validationSplit,t,{augmentByMixingNoiseRatio:e.augmentByMixingNoiseRatio}),2),i=r[0],a=r[1],o=x.util.now(),[4,this.model.fitDataset(i,{epochs:e.epochs,validationData:e.validationSplit>0?a:null,callbacks:null==e.callback?null:[e.callback]})];case 1:return s=l.sent(),console.log("fitDataset() took "+(x.util.now()-o).toFixed(2)+" ms"),null!=e.fineTuningEpochs&&e.fineTuningEpochs>0?(u=x.util.now(),[4,this.fineTuningUsingTfDatasets(e,i,a)]):[3,3];case 2:return c=l.sent(),console.log("fitDataset() (fine-tuning) took "+(x.util.now()-u).toFixed(2)+" ms"),[2,[s,c]];case 3:return[2,s]}}))}))},t.prototype.trainOnTensors=function(e){return ke(this,void 0,void 0,(function(){var t,n,r,i,a,o,s,u,c,l;return Ee(this,(function(f){switch(f.label){case 0:t=e.windowHopRatio||.25,n=this.collectTransferDataAsTensors(t,{augmentByMixingNoiseRatio:e.augmentByMixingNoiseRatio}),r=n.xs,i=n.ys,console.log("Training data: xs.shape = "+r.shape+", ys.shape = "+i.shape),f.label=1;case 1:return f.trys.push([1,,6,7]),null!=e.validationSplit?(u=function(e,t,n){return x.util.assert(n>0&&n<1,(function(){return"validationSplit is expected to be >0 and <1, but got "+n})),Object(x.tidy)((function(){for(var r=t.argMax(-1).dataSync(),i=[],a=0;a<r.length;++a){var o=r[a];null==i[o]&&(i[o]=[]),i[o].push(a)}var s=i.length,u=[],c=[];for(i.map((function(e){return x.util.shuffle(e)})),a=0;a<s;++a)for(var l=i[a],f=Math.round(l.length*(1-n)),d=0;d<l.length;++d)d<f?u.push(l[d]):c.push(l[d]);return{trainXs:Object(x.gather)(e,u),trainYs:Object(x.gather)(t,u),valXs:Object(x.gather)(e,c),valYs:Object(x.gather)(t,c)}}))}(r,i,e.validationSplit),a=u.trainXs,o=u.trainYs,s=[u.valXs,u.valYs]):(a=r,o=i),[4,this.model.fit(a,o,{epochs:null==e.epochs?20:e.epochs,validationData:s,batchSize:e.batchSize,callbacks:null==e.callback?null:[e.callback]})];case 2:return c=f.sent(),null!=e.fineTuningEpochs&&e.fineTuningEpochs>0?[4,this.fineTuningUsingTensors(e,a,o,s)]:[3,4];case 3:return l=f.sent(),[2,[c,l]];case 4:return[2,c];case 5:return[3,7];case 6:return Object(x.dispose)([r,i,a,o,s]),[7];case 7:return[2]}}))}))},t.prototype.fineTuningUsingTfDatasets=function(e,t,n){return ke(this,void 0,void 0,(function(){var r,i,a;return Ee(this,(function(o){switch(o.label){case 0:return r=this.secondLastBaseDenseLayer.trainable,this.secondLastBaseDenseLayer.trainable=!0,i=null==e.fineTuningOptimizer?"sgd":e.fineTuningOptimizer,this.model.compile({loss:"categoricalCrossentropy",optimizer:i,metrics:["acc"]}),[4,this.model.fitDataset(t,{epochs:e.fineTuningEpochs,validationData:n,callbacks:null==e.callback?null:[e.callback]})];case 1:return a=o.sent(),this.secondLastBaseDenseLayer.trainable=r,[2,a]}}))}))},t.prototype.fineTuningUsingTensors=function(e,t,n,r){return ke(this,void 0,void 0,(function(){var i,a,o;return Ee(this,(function(s){switch(s.label){case 0:return i=this.secondLastBaseDenseLayer.trainable,this.secondLastBaseDenseLayer.trainable=!0,a=null==e.fineTuningOptimizer?"sgd":e.fineTuningOptimizer,this.model.compile({loss:"categoricalCrossentropy",optimizer:a,metrics:["acc"]}),[4,this.model.fit(t,n,{epochs:e.fineTuningEpochs,validationData:r,batchSize:e.batchSize,callbacks:null==e.fineTuningCallback?null:[e.fineTuningCallback]})];case 1:return o=s.sent(),this.secondLastBaseDenseLayer.trainable=i,[2,o]}}))}))},t.prototype.evaluate=function(e){return ke(this,void 0,void 0,(function(){var t,n=this;return Ee(this,(function(r){return x.util.assert(null!=e.wordProbThresholds&&e.wordProbThresholds.length>0,(function(){return"Received null or empty wordProbThresholds"})),t=0,x.util.assert("_background_noise_"===this.words[t],(function(){return"Cannot perform evaluation when the first tag is not _background_noise_"})),[2,Object(x.tidy)((function(){for(var r=[],i=0,a=n.collectTransferDataAsTensors(e.windowHopRatio),o=a.xs,s=a.ys.argMax(-1).dataSync(),u=n.model.predict(o),c=u.slice([0,1],[u.shape[0],u.shape[1]-1]).max(-1),l=u.shape[0],f=0;f<e.wordProbThresholds.length;++f){for(var d=e.wordProbThresholds[f],h=c.greater(Object(x.scalar)(d)).dataSync(),p=0,m=0,v=0,g=0,y=0;y<l;++y)s[y]===t?(p++,h[y]&&v++):(m++,h[y]&&g++);var b=v/p,w=g/m;r.push({probThreshold:d,fpr:b,tpr:w}),console.log("ROC thresh="+d+": fpr="+b.toFixed(4)+", tpr="+w.toFixed(4)),f>0&&(i+=Math.abs(r[f-1].fpr-r[f].fpr)*(r[f-1].tpr+r[f].tpr)/2)}return{rocCurve:r,auc:i}}))]}))}))},t.prototype.createTransferModelFromBaseModel=function(){var e=this;x.util.assert(null!=this.words,(function(){return"No word example is available for tranfer-learning model of name "+e.name}));for(var t=this.baseModel.layers,n=t.length-2;n>=0&&"dense"!==t[n].getClassName().toLowerCase();)n--;if(n<0)throw new Error("Cannot find a hidden dense layer in the base model.");this.secondLastBaseDenseLayer=t[n];var r=this.secondLastBaseDenseLayer.output;this.transferHead=Object(x.sequential)(),this.transferHead.add(x.layers.dense({units:this.words.length,activation:"softmax",inputShape:r.shape.slice(1),name:"NewHeadDense"}));var i=this.transferHead.apply(r);this.model=Object(x.model)({inputs:this.baseModel.inputs,outputs:i})},t.prototype.modelInputShape=function(){return this.baseModel.inputs[0].shape},t.prototype.getMetadata=function(){return{tfjsSpeechCommandsVersion:qe,modelName:this.name,timeStamp:(new Date).toISOString(),wordLabels:this.wordLabels()}},t.prototype.save=function(e){return ke(this,void 0,void 0,(function(){var t,n,r;return Ee(this,(function(i){return t=null!=e,e=e||Je(this.name),t||(n=Ke.localStorage.getItem(He),(r=null==n?{}:JSON.parse(n))[this.name]=this.getMetadata(),Ke.localStorage.setItem(He,JSON.stringify(r))),console.log("Saving model to "+e),[2,this.model.save(e)]}))}))},t.prototype.load=function(e){return ke(this,void 0,void 0,(function(){var t,n,r;return Ee(this,(function(i){switch(i.label){case 0:if(t=null!=e,e=e||Je(this.name),!t){if(null==(n=JSON.parse(Ke.localStorage.getItem(He)))||null==n[this.name])throw new Error("Cannot find metadata for transfer model named "+this.name+'"');this.words=n[this.name].wordLabels,console.log("Loaded word list for model named "+this.name+": "+this.words)}return r=this,[4,Object(x.loadLayersModel)(e)];case 1:return r.model=i.sent(),console.log("Loaded model from "+e+":"),this.model.summary(),[2]}}))}))},t.prototype.createTransfer=function(e){throw new Error("Creating transfer-learned recognizer from a transfer-learned recognizer is not supported.")},t}(Ye);function Je(e){return""+Xe+e}function Ze(e,t,n,r){if(x.util.assert(null==n&&null==r||null!=n&&null!=r,(function(){return"customModelURL and customMetadataURL must be both provided or both not provided."})),null!=n&&x.util.assert(null==t,(function(){return"vocabulary name must be null or undefined when modelURL is provided."})),"BROWSER_FFT"===e)return new Ye(t,n,r);throw"SOFT_FFT"===e?new Error("SOFT_FFT SpeechCommandRecognizer has not been implemented yet."):new Error("Invalid fftType: '"+e+"'")}var Qe=function(){function e(t){S()(this,e),this.options=t}return A()(e,[{key:"load",value:function(){var e=k()(D.a.mark((function e(t){var n,r,i;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t?(n=t.split("/"),r=n.slice(0,n.length-1).join("/"),i="".concat(r,"/metadata.json"),this.model=Ze("BROWSER_FFT",void 0,t,i)):this.model=Ze("BROWSER_FFT"),e.next=3,this.model.ensureModelLoaded();case 3:this.allLabels=this.model.wordLabels();case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"classify",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.allLabels.length,n=arguments.length>1?arguments[1]:void 0;return this.model.listen((function(r){if(r.scores){var i=H(r.scores,t,e.allLabels).map((function(e){return{label:e.className,confidence:e.probability}}));return n(null,i)}return n("ERROR: Cannot find scores in result: ".concat(r))}),this.options).catch((function(e){return n("ERROR: ".concat(e.message))}))}}]),e}();function et(e,t){return tt.apply(this,arguments)}function tt(){return(tt=k()(D.a.mark((function e(t,n){var r;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Qe(t),e.next=3,r.load(n);case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var nt=["speechcommands18w"],rt=function(){function e(t,n,r){S()(this,e),this.model=null,this.options=n,"string"==typeof t&&(nt.includes(t)?"speechcommands18w"===(this.modelName=t,this.modelUrl=null,this.modelName)?this.modelToUse=s:this.modelToUse=null:(this.modelToUse=s,this.modelUrl=t)),this.ready=T(this.loadModel(n,this.modelUrl),r)}return A()(e,[{key:"loadModel",value:function(){var e=k()(D.a.mark((function e(t){return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.modelToUse.load(t,this.modelUrl);case 2:return this.model=e.sent,e.abrupt("return",this);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"classifyInternal",value:function(){var e=k()(D.a.mark((function e(t,n){return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ready;case 2:return e.next=4,x.nextFrame();case 4:return e.abrupt("return",this.model.classify(t,n));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"classify",value:function(){var e=k()(D.a.mark((function e(){var t,n,r,i,a=arguments;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:null,n=a.length>1?a[1]:void 0,r=this.topk,"number"==typeof t?r=t:"function"==typeof t&&(i=t),"function"==typeof n&&(i=n),e.abrupt("return",this.classifyInternal(r,i));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),it=function(e,t,n){var r={},i=n,a=e;if("string"!=typeof a)throw new Error('Please specify a model to use. E.g: "SpeechCommands18w"');-1===a.indexOf("http")&&(a=e.toLowerCase()),"object"===I()(t)?r=t:"function"==typeof t&&(i=t);var o=new rt(a,r,i);return i?o:o.ready};function at(e,t){return null==e&&null==t?null:null==e?t.clone():null===t?e.clone():e.concat(t,0)}function ot(e,t){for(var n=[],r=0;r<e.length;r++)n.push({value:e[r],index:r});n.sort((function(e,t){return t.value-e.value}));var i=new Float32Array(t),a=new Int32Array(t);for(r=0;r<t;r++)i[r]=n[r].value,a[r]=n[r].index;return{values:i,indices:a}}var st=function(){function e(){this.classDatasetMatrices={},this.classExampleCount={},this.labelToClassId={},this.nextClassId=0}return e.prototype.addExample=function(e,t){var n=this;if(null==this.exampleShape&&(this.exampleShape=e.shape),!B.util.arraysEqual(this.exampleShape,e.shape))throw new Error("Example shape provided, "+e.shape+" does not match previously provided example shapes "+this.exampleShape+".");this.clearTrainDatasetMatrix(),t in this.labelToClassId||(this.labelToClassId[t]=this.nextClassId++),Object(B.tidy)((function(){var r=n.normalizeVectorToUnitLength(e.flatten()),i=r.shape[0];if(null==n.classDatasetMatrices[t])n.classDatasetMatrices[t]=r.as2D(1,i);else{var a=n.classDatasetMatrices[t].as2D(n.classExampleCount[t],i).concat(r.as2D(1,i),0);n.classDatasetMatrices[t].dispose(),n.classDatasetMatrices[t]=a}Object(B.keep)(n.classDatasetMatrices[t]),null==n.classExampleCount[t]&&(n.classExampleCount[t]=0),n.classExampleCount[t]++}))},e.prototype.similarities=function(e){var t=this;return Object(B.tidy)((function(){var n=t.normalizeVectorToUnitLength(e.flatten()),r=n.shape[0];if(null==t.trainDatasetMatrix){var i=null;for(var a in t.classDatasetMatrices)i=at(i,t.classDatasetMatrices[a]);t.trainDatasetMatrix=i}if(null==t.trainDatasetMatrix)return console.warn("Cannot predict without providing training examples."),null;Object(B.keep)(t.trainDatasetMatrix);var o=t.getNumExamples();return t.trainDatasetMatrix.as2D(o,r).matMul(n.as2D(r,1)).as1D()}))},e.prototype.predictClass=function(e,t){return void 0===t&&(t=3),function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))}(this,void 0,void 0,(function(){var n,r,i,a,o=this;return function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}(this,(function(s){switch(s.label){case 0:if(t<1)throw new Error("Please provide a positive integer k value to predictClass.");if(0===this.getNumExamples())throw new Error("You have not added any examples to the KNN classifier. Please add examples before calling predictClass.");return n=Object(B.tidy)((function(){return o.similarities(e).asType("float32")})),r=Math.min(t,this.getNumExamples()),a=ot,[4,n.data()];case 1:return i=a.apply(void 0,[s.sent(),r]).indices,n.dispose(),[2,this.calculateTopClass(i,r)]}}))}))},e.prototype.clearClass=function(e){if(null==this.classDatasetMatrices[e])throw new Error("Cannot clear invalid class "+e);delete this.classDatasetMatrices[e],delete this.classExampleCount[e],this.clearTrainDatasetMatrix()},e.prototype.clearAllClasses=function(){for(var e in this.classDatasetMatrices)this.clearClass(e)},e.prototype.getClassExampleCount=function(){return this.classExampleCount},e.prototype.getClassifierDataset=function(){return this.classDatasetMatrices},e.prototype.getNumClasses=function(){return Object.keys(this.classExampleCount).length},e.prototype.setClassifierDataset=function(e){for(var t in this.clearTrainDatasetMatrix(),this.classDatasetMatrices=e,e)this.classExampleCount[t]=e[t].shape[0]},e.prototype.calculateTopClass=function(e,t){var n,r={};if(null==e)return{classIndex:this.labelToClassId[n],label:n,confidences:r};var i={},a=0;for(var o in this.classDatasetMatrices)a+=this.classExampleCount[o],i[o]=a;var s={};for(var o in this.classDatasetMatrices)s[o]=0;for(var u=0;u<e.length;u++){var c=e[u];for(var o in this.classDatasetMatrices)if(c<i[o]){s[o]++;break}}var l=0;for(var o in this.classDatasetMatrices){var f=s[o]/t;f>l&&(l=f,n=o),r[o]=f}return{classIndex:this.labelToClassId[n],label:n,confidences:r}},e.prototype.clearTrainDatasetMatrix=function(){null!=this.trainDatasetMatrix&&(this.trainDatasetMatrix.dispose(),this.trainDatasetMatrix=null)},e.prototype.normalizeVectorToUnitLength=function(e){return Object(B.tidy)((function(){var t=e.norm();return Object(B.div)(e,t)}))},e.prototype.getNumExamples=function(){var e=0;for(var t in this.classDatasetMatrices)e+=this.classExampleCount[t];return e},e.prototype.dispose=function(){for(var e in this.clearTrainDatasetMatrix(),this.classDatasetMatrices)this.classDatasetMatrices[e].dispose()},e}(),ut=function(){var e=k()(D.a.mark((function e(t,n,r){var i,a;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(i=document.createElement("a")).style.display="none",document.body.appendChild(i),a=new Blob([t],{type:r}),i.href=URL.createObjectURL(a),i.download=n,i.click();case 7:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),ct=function(){var e=k()(D.a.mark((function e(t,n){return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",R.a.get(t).then((function(e){return e.data})).then((function(e){return n&&n(null,e),e})).catch((function(e){throw n&&n(e),console.error("There has been a problem loading the file: ".concat(e.message)),e})));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),lt=function(){function e(){S()(this,e),this.knnClassifier=new st,this.mapStringToIndex=[]}return A()(e,[{key:"addExample",value:function(e,t){var n,r;"string"==typeof t?n=this.mapStringToIndex.includes(t)?this.mapStringToIndex.indexOf(t):this.mapStringToIndex.push(t)-1:"number"==typeof t&&(n=t),r=Array.isArray(e)?x.tensor(e):e,this.knnClassifier.addExample(r,n)}},{key:"classify",value:function(){var e=k()(D.a.mark((function e(t,n,r){var i,a,o;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=3,a=r,"number"==typeof n?i=n:"function"==typeof n&&(a=n),o=Array.isArray(t)?x.tensor(t):t,e.abrupt("return",T(this.classifyInternal(o,i),a));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"classifyInternal",value:function(){var e=k()(D.a.mark((function e(t,n){var r,i,a,o=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.knnClassifier.getNumClasses()<=0)){e.next=5;break}throw new Error("There is no example in any class");case 5:return e.next=7,this.knnClassifier.predictClass(t,n);case 7:return r=e.sent,this.mapStringToIndex.length>0&&((r.classIndex||0===r.classIndex)&&(i=this.mapStringToIndex[r.classIndex])&&(r.label=i),r.confidences&&(r.confidencesByLabel={},a=r.confidences,Object.keys(a).forEach((function(e){var t=o.mapStringToIndex[e];r.confidencesByLabel[t]=a[e]})))),e.abrupt("return",r);case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"clearLabel",value:function(e){var t;"string"==typeof e?this.mapStringToIndex.includes(e)&&(t=this.mapStringToIndex.indexOf(e)):"number"==typeof e&&(t=e),this.knnClassifier.clearClass(t)}},{key:"clearAllLabels",value:function(){this.mapStringToIndex=[],this.knnClassifier.clearAllClasses()}},{key:"getCountByLabel",value:function(){var e=this,t=this.knnClassifier.getClassExampleCount();if(this.mapStringToIndex.length>0){var n={};return Object.keys(t).forEach((function(r){if(e.mapStringToIndex[r]){var i=e.mapStringToIndex[r];n[i]=t[r]}})),n}return t}},{key:"getCount",value:function(){return this.knnClassifier.getClassExampleCount()}},{key:"getClassifierDataset",value:function(){return this.knnClassifier.getClassifierDataset()}},{key:"setClassifierDataset",value:function(e){this.knnClassifier.setClassifierDataset(e)}},{key:"getNumLabels",value:function(){return this.knnClassifier.getNumClasses()}},{key:"dispose",value:function(){this.knnClassifier.dispose()}},{key:"save",value:function(){var e=k()(D.a.mark((function e(t){var n,r,i,a=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.knnClassifier.getClassifierDataset(),this.mapStringToIndex.length>0&&Object.keys(n).forEach((function(e){a.mapStringToIndex[e]&&(n[e].label=a.mapStringToIndex[e])})),r=Object.keys(n).map((function(e){var t=n[e];return t?t.dataSync():null})),i="myKNN.json",t&&(i=t.endsWith(".json")?t:"".concat(t,".json")),e.next=7,ut(JSON.stringify({dataset:n,tensors:r}),i,"application/octet-stream");case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=k()(D.a.mark((function e(t,n){var r,i,a,o,s;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("object"!==I()(t)){e.next=4;break}r=t,e.next=7;break;case 4:return e.next=6,ct(t);case 6:r=e.sent;case 7:r&&(a=(i=r).dataset,o=i.tensors,this.mapStringToIndex=Object.keys(a).map((function(e){return a[e].label})),s=o.map((function(e,t){if(e){var n=Object.keys(e).map((function(t){return e[t]}));return x.tensor(n,a[t].shape,a[t].dtype)}return null})).reduce((function(e,t,n){return e[n]=t,e}),{}),this.knnClassifier.setClassifierDataset(s),n&&n());case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),ft=function(){return new lt},dt=function(){function e(t,n){S()(this,e),this.videoElt=null,this.size=n,this.videoReady=!1,"undefined"!=typeof HTMLVideoElement&&(t instanceof HTMLVideoElement?this.videoElt=t:null!==t&&"object"===I()(t)&&t.elt instanceof HTMLVideoElement&&(this.videoElt=t.elt))}return A()(e,[{key:"loadVideo",value:function(){var e=k()(D.a.mark((function e(){var t,n=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){n.videoElt||r(new Error("No video was passed to the constructor.")),n.video=document.createElement("video");var i=navigator.userAgent;t=i.indexOf("Firefox")>-1?n.videoElt.mozCaptureStream():n.videoElt.captureStream(),n.video.srcObject=t,n.size&&(n.video.width=n.size,n.video.height=n.size),n.video.autoplay=!0,n.video.playsinline=!0,n.video.muted=!0;var a=n.video.play();void 0!==a&&a.then((function(){n.videoReady=!0,e(n.video)}))})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}(),ht=224,pt=[ht,ht],mt="https://storage.googleapis.com/tfjs-models/tfjs/mobilenet_v",vt={version:1,alpha:.25,topk:3,learningRate:1e-4,hiddenUnits:100,epochs:20,numLabels:2,batchSize:.4,layer:"conv_pw_13_relu"},gt={1:{.25:"https://tfhub.dev/google/imagenet/mobilenet_v1_025_224/classification/1",.5:"https://tfhub.dev/google/imagenet/mobilenet_v1_050_224/classification/1",.75:"https://tfhub.dev/google/imagenet/mobilenet_v1_075_224/classification/1",1:"https://tfhub.dev/google/imagenet/mobilenet_v1_100_224/classification/1"},2:{.5:"https://tfhub.dev/google/imagenet/mobilenet_v2_050_224/classification/2",.75:"https://tfhub.dev/google/imagenet/mobilenet_v2_075_224/classification/2",1:"https://tfhub.dev/google/imagenet/mobilenet_v2_100_224/classification/2"}},yt={1:"module_apply_default/MobilenetV1/Logits/global_pool",2:"module_apply_default/MobilenetV2/Logits/AvgPool"},bt=function(){function e(t,n){S()(this,e),this.mobilenet=null,this.topKPredictions=10,this.hasAnyTrainedClass=!1,this.customModel=null,this.jointModel=null,this.config={epochs:t.epochs||vt.epochs,version:t.version||vt.version,hiddenUnits:t.hiddenUnits||vt.hiddenUnits,numLabels:t.numLabels||vt.numLabels,learningRate:t.learningRate||vt.learningRate,batchSize:t.batchSize||vt.batchSize,layer:t.layer||vt.layer,alpha:t.alpha||vt.alpha},this.model=null,this.url=gt[this.config.version][this.config.alpha],this.normalizationOffset=x.scalar(127.5),this.mobilenetURL=t.mobilenetURL||"".concat(mt).concat(this.config.version,"_").concat(this.config.alpha,"_").concat(ht,"/model.json"),this.graphModelURL=t.graphModelURL||this.url,this.isPredicting=!1,this.mapStringToIndex=[],this.usageType=null,this.ready=T(this.loadModel(),n)}return A()(e,[{key:"loadModel",value:function(){var e=k()(D.a.mark((function e(){var t;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.loadLayersModel(this.mobilenetURL);case 2:if(this.mobilenet=e.sent,!this.graphModelURL.includes("https://tfhub.dev/")){e.next=9;break}return e.next=6,x.loadGraphModel(this.graphModelURL,{fromTFHub:!0});case 6:this.model=e.sent,e.next=12;break;case 9:return e.next=11,x.loadGraphModel(this.graphModelURL,{fromTFHub:!1});case 11:this.model=e.sent;case 12:return t=this.mobilenet.getLayer(this.config.layer),e.next=15,x.model({inputs:this.mobilenet.inputs,outputs:t.output});case 15:if(this.mobilenetFeatures=e.sent,!this.video){e.next=19;break}return e.next=19,this.mobilenetFeatures.predict(pe(this.video,pt));case 19:return e.abrupt("return",this);case 20:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"classification",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2?arguments[2]:void 0;return this.usageType="classifier","object"===I()(n)?Object.assign(this.config,n):"function"==typeof n&&(t=n),"function"==typeof r&&(t=r),e&&T(this.loadVideo(e),t),this}},{key:"regression",value:function(e,t){return this.usageType="regressor",e&&T(this.loadVideo(e),t),this}},{key:"loadVideo",value:function(){var e=k()(D.a.mark((function e(t){var n,r;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null,t instanceof HTMLVideoElement?n=t:"object"===I()(t)&&t.elt instanceof HTMLVideoElement&&(n=t.elt),!n){e.next=7;break}return r=new dt(n,ht),e.next=6,r.loadVideo();case 6:this.video=e.sent;case 7:return e.abrupt("return",this);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"addImage",value:function(){var e=k()(D.a.mark((function e(t,n,r){var i,a,o;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=r,t instanceof HTMLImageElement||t instanceof HTMLVideoElement||t instanceof HTMLCanvasElement||t.elt instanceof ImageData?i=t:"object"===I()(t)&&(t.elt instanceof HTMLImageElement||t.elt instanceof HTMLVideoElement||t.elt instanceof HTMLCanvasElement||t.elt instanceof ImageData)?i=t.elt:"string"!=typeof t&&"number"!=typeof t||(i=this.video,a=t),"string"==typeof n||"number"==typeof n?a=n:"function"==typeof n&&(o=n),"string"==typeof a&&(a=this.mapStringToIndex.includes(a)?this.mapStringToIndex.indexOf(a):this.mapStringToIndex.push(a)-1),e.abrupt("return",T(this.addImageInternal(i,a),o));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"addImageInternal",value:function(){var e=k()(D.a.mark((function e(t,n){var r=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ready;case 2:return x.tidy((function(){var e,i=pe(t,pt),a=r.mobilenetFeatures.predict(i);if("classifier"===r.usageType?e=x.tidy((function(){return x.oneHot(x.tensor1d([n],"int32"),r.config.numLabels)})):"regressor"===r.usageType&&(e=x.tensor2d([[n]])),null==r.xs)r.xs=x.keep(a),r.ys=x.keep(e),r.hasAnyTrainedClass=!0;else{var o=r.xs;r.xs=x.keep(o.concat(a,0));var s=r.ys;r.ys=x.keep(s.concat(e,0)),o.dispose(),s.dispose(),e.dispose()}})),e.abrupt("return",this);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"train",value:function(){var e=k()(D.a.mark((function e(t){var n,r;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasAnyTrainedClass){e.next=2;break}throw new Error("Add some examples before training!");case 2:if(this.isPredicting=!1,"classifier"===this.usageType?(this.loss="categoricalCrossentropy",this.customModel=x.sequential({layers:[x.layers.flatten({inputShape:[7,7,256]}),x.layers.dense({units:this.config.hiddenUnits,activation:"relu",kernelInitializer:"varianceScaling",useBias:!0}),x.layers.dense({units:this.config.numLabels,kernelInitializer:"varianceScaling",useBias:!1,activation:"softmax"})]})):"regressor"===this.usageType&&(this.loss="meanSquaredError",this.customModel=x.sequential({layers:[x.layers.flatten({inputShape:[7,7,256]}),x.layers.dense({units:this.config.hiddenUnits,activation:"relu",kernelInitializer:"varianceScaling",useBias:!0}),x.layers.dense({units:1,useBias:!1,kernelInitializer:"Zeros",activation:"linear"})]})),this.jointModel=x.sequential(),this.jointModel.add(this.mobilenetFeatures),this.jointModel.add(this.customModel),n=x.train.adam(this.config.learningRate),this.customModel.compile({optimizer:n,loss:this.loss}),(r=Math.floor(this.xs.shape[0]*this.config.batchSize))>0){e.next=12;break}throw new Error("Batch size is 0 or NaN. Please choose a non-zero fraction.");case 12:return e.abrupt("return",this.customModel.fit(this.xs,this.ys,{batchSize:r,epochs:this.config.epochs,callbacks:{onBatchEnd:function(){var e=k()(D.a.mark((function e(n,r){return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t(r.loss.toFixed(5)),e.next=3,x.nextFrame();case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),onTrainEnd:function(){return t(null)}}}));case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"classify",value:function(){var e=k()(D.a.mark((function e(t,n){var r,i;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t instanceof HTMLImageElement||t instanceof HTMLVideoElement||t instanceof HTMLCanvasElement||t instanceof ImageData?r=t:"object"===I()(t)&&(t.elt instanceof HTMLImageElement||t.elt instanceof HTMLVideoElement||t.elt instanceof HTMLCanvasElement||t.elt instanceof ImageData)?r=t.elt:"function"==typeof t&&(r=this.video,i=t),"function"==typeof n&&(i=n),e.abrupt("return",T(this.classifyInternal(r),i));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"classifyInternal",value:function(){var e=k()(D.a.mark((function e(t){var n,r,i=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("classifier"===this.usageType){e.next=2;break}throw new Error("Mobilenet Feature Extraction has not been set to be a classifier.");case 2:return e.next=4,x.nextFrame();case 4:return this.isPredicting=!0,n=x.tidy((function(){var e=pe(t,pt),n=i.jointModel.predict(e);return Array.from(n.as1D().dataSync())})),e.next=8,n.map((function(e,t){return{label:i.mapStringToIndex.length>0&&i.mapStringToIndex[t]?i.mapStringToIndex[t]:t,confidence:e}})).sort((function(e,t){return t.confidence-e.confidence}));case 8:return r=e.sent,e.abrupt("return",r);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"predict",value:function(){var e=k()(D.a.mark((function e(t,n){var r,i;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t instanceof HTMLImageElement||t instanceof HTMLVideoElement||t instanceof HTMLCanvasElement||t instanceof ImageData?r=t:"object"===I()(t)&&(t.elt instanceof HTMLImageElement||t.elt instanceof HTMLVideoElement||t.elt instanceof HTMLCanvasElement||t.elt instanceof ImageData)?r=t.elt:"function"==typeof t&&(r=this.video,i=t),"function"==typeof n&&(i=n),e.abrupt("return",T(this.predictInternal(r),i));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"predictInternal",value:function(){var e=k()(D.a.mark((function e(t){var n,r,i=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("regressor"===this.usageType){e.next=2;break}throw new Error("Mobilenet Feature Extraction has not been set to be a regressor.");case 2:return e.next=4,x.nextFrame();case 4:return this.isPredicting=!0,n=x.tidy((function(){var e=pe(t,pt);return i.jointModel.predict(e).as1D()})),e.next=8,n.data();case 8:return r=e.sent,n.dispose(),e.abrupt("return",{value:r[0]});case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=k()(D.a.mark((function e(){var t,n,r,i,a,o,s=this,u=arguments;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=u.length>0&&void 0!==u[0]?u[0]:null,n=u.length>1?u[1]:void 0,"string"==typeof t){e.next=11;break}return r=null,i=null,Array.from(t).forEach((function(e){if(e.name.includes(".json")){r=e;var t=new FileReader;t.onload=function(e){JSON.parse(e.target.result).ml5Specs&&(s.mapStringToIndex=JSON.parse(e.target.result).ml5Specs.mapStringToIndex)},t.readAsText(e)}else e.name.includes(".bin")&&(i=e)})),e.next=8,x.loadLayersModel(x.io.browserFiles([r,i]));case 8:this.jointModel=e.sent,e.next=20;break;case 11:return e.next=13,R.a.get(t);case 13:return a=e.sent,(o=a.data).ml5Specs&&(this.mapStringToIndex=o.ml5Specs.mapStringToIndex),e.next=18,x.loadLayersModel(t);case 18:this.jointModel=e.sent,n&&n();case 20:return e.abrupt("return",this.jointModel);case 21:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"save",value:function(){var e=k()(D.a.mark((function e(t,n){var r=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.jointModel){e.next=2;break}throw new Error("No model found.");case 2:this.jointModel.save(x.io.withSaveHandler(function(){var e=k()(D.a.mark((function e(i){var a;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="model",n&&(a=n),r.weightsManifest={modelTopology:i.modelTopology,weightsManifest:[{paths:["./".concat(a,".weights.bin")],weights:i.weightSpecs}],ml5Specs:{mapStringToIndex:r.mapStringToIndex}},e.next=5,ut(i.weightData,"".concat(a,".weights.bin"),"application/octet-stream");case 5:return e.next=7,ut(JSON.stringify(r.weightsManifest),"".concat(a,".json"),"text/plain");case 7:t&&t();case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"mobilenetInfer",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e;return r instanceof x.Tensor||r instanceof ImageData||r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement?x.tidy((function(){r instanceof x.Tensor||(r=x.browser.fromPixels(r));var e=r.toFloat().sub(t.normalizationOffset).div(t.normalizationOffset),i=e;r.shape[0]===ht&&r.shape[1]===ht||(i=x.image.resizeBilinear(e,pt,!0));var a,o=i.reshape([-1,ht,ht,3]);if(n){var s=yt[t.config.version];a=t.model.execute(o,s).squeeze([1,2])}else a=t.model.predict(o).slice([0,1],[-1,1e3]);return a})):null}},{key:"infer",value:function(e,t){var n,r;if(e instanceof HTMLImageElement||e instanceof HTMLVideoElement||e instanceof HTMLCanvasElement||e instanceof ImageData)n=e;else{if("object"!==I()(e)||!(e.elt instanceof HTMLImageElement||e.elt instanceof HTMLVideoElement||e.elt instanceof HTMLCanvasElement||e.elt instanceof ImageData))throw new Error("No input image found.");n=e.elt}return r=t&&"string"==typeof t?t:"conv_preds",this.mobilenetInfer(n,r)}}]),e}(),xt=function(e,t,n){var r;if("string"!=typeof e)throw new Error('Please specify a model to use. E.g: "MobileNet"');r=e.toLowerCase();var i={},a=n;if("object"===I()(t)?i=t:"function"==typeof t&&(a=t),"mobilenet"===r)return new bt(i,a);throw new Error("".concat(r," is not a valid model."))},wt=function(){console.log("%cword2vec has been disabled","color: #A155FF; font-size: 16px"),console.log("We've intentionally disabled the word2vec function after recognizing it has the potential to produce harmful outputs while using the model files included in our examples. We'll consider reenabling the word2vec function along with changes to address these issues in a future release of ml5.js. You can find further updates about this topic on our Twitter account (https://twitter.com/ml5js/status/1445762321444315147) and GitHub (https://github.com/ml5js/ml5-library/issues/1238).")},_t=n(58),kt=n.n(_t),Et=n(57),St=n.n(Et),Ct=n(35),At=n.n(Ct),Ot=["person","bicycle","car","motorbike","aeroplane","bus","train","truck","boat","traffic light","fire hydrant","stop sign","parking meter","bench","bird","cat","dog","horse","sheep","cow","elephant","bear","zebra","giraffe","backpack","umbrella","handbag","tie","suitcase","frisbee","skis","snowboard","sports ball","kite","baseball bat","baseball glove","skateboard","surfboard","tennis racket","bottle","wine glass","cup","fork","knife","spoon","bowl","banana","apple","sandwich","orange","broccoli","carrot","hot dog","pizza","donut","cake","chair","sofa","pottedplant","bed","diningtable","toilet","tvmonitor","laptop","mouse","remote","keyboard","cell phone","microwave","oven","toaster","sink","refrigerator","book","clock","vase","scissors","teddy bear","hair drier","toothbrush"];function Dt(e){return new RegExp("^(?:[a-z]+:)?//","i").test(e)}var Tt={isAbsoluteURL:Dt,getModelPath:function(e){return Dt(e)||"undefined"==typeof window?e:window.location.pathname+e}},jt=function(e,t){var n=Math.min(e[3],t[3])-Math.max(e[1],t[1]),r=Math.min(e[2],t[2])-Math.max(e[0],t[0]);return n<0||r<0?0:n*r},Mt=function(e,t){return jt(e,t)/function(e,t){var n=jt(e,t);return(e[3]-e[1])*(e[2]-e[0])+(t[3]-t[1])*(t[2]-t[0])-n}(e,t)};function Ft(e,t,n,r){return It.apply(this,arguments)}function It(){return(It=k()(D.a.mark((function e(t,n,r,i){return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",x.tidy((function(){for(var e=x.mul(n,r),a=x.argMax(e,-1),o=x.max(e,-1),s=x.greaterEqual(o,x.scalar(i)).dataSync(),u=[],c=0;c<s.length;c+=1)s[c]&&u.push(c);if(0===u.length)return[null,null,null];var l=x.tensor1d(u,"int32");return[x.gather(t.reshape([s.length,4]),l),x.gather(o.flatten(),l),x.gather(a.flatten(),l)]})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Nt=function(e,t){return x.tidy((function(){var n=x.tensor1d([2]),r=x.sub(e,x.div(t,n)),i=x.add(e,x.div(t,n)),a=[r.shape[0],r.shape[1],r.shape[2],1];return x.concat([r.slice([0,0,0,1],a),r.slice([0,0,0,0],a),i.slice([0,0,0,1],a),i.slice([0,0,0,0],a)],3)}))},Rt=function(e,t,n){return x.tidy((function(){for(var r=[],i=0;i<t.length;i+=1)r.push([t[i],[e[4*i],e[4*i+1],e[4*i+2],e[4*i+3]],i]);var a=[];return r.sort((function(e,t){return t[0]-e[0]})).forEach((function(e){for(var t=!0,r=0;r<a.length;r+=1)if(Mt(e[1],a[r][1])>n){t=!1;break}t&&a.push(e)})),[a.map((function(e){return e[2]})),a.map((function(e){return e[1]})),a.map((function(e){return e[0]}))]}))};function Pt(e,t,n){return x.tidy((function(){var r=t.shape[0],i=x.reshape(t,[1,1,r,2]),a=e.shape.slice(1,3),o=a[0],s=a[1],u=x.range(0,a[0]),c=x.range(0,a[1]);u=x.tile(u,[a[1]]),c=x.tile(x.expandDims(c,0),[a[0],1]),c=x.transpose(c).flatten();var l=x.transpose(x.stack([u,c]));l=x.reshape(l,[a[0],a[1],1,2]),l=x.cast(l,e.dtype),e=x.reshape(e,[a[0],a[1],r,n+5]),a=x.cast(x.reshape(x.tensor1d(a),[1,1,1,2]),e.dtype);var f=x.sigmoid(e.slice([0,0,0,0],[o,s,r,2])),d=x.exp(e.slice([0,0,0,2],[o,s,r,2])),h=x.sigmoid(e.slice([0,0,0,4],[o,s,r,1])),p=x.softmax(e.slice([0,0,0,5],[o,s,r,n]));return[f=x.div(x.add(f,l),a),d=x.div(x.mul(d,i),a),h,p]}))}function Bt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=At()(e);if(t){var i=At()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return St()(this,n)}}var Lt={modelUrl:"https://raw.githubusercontent.com/ml5js/ml5-data-and-training/master/models/YOLO/model.json",filterBoxesThreshold:.01,IOUThreshold:.4,classProbThreshold:.4},zt=416,Ut=function(e){kt()(n,e);var t=Bt(n);function n(e,r,i){var a;return S()(this,n),(a=t.call(this,e,zt)).modelUrl=r.modelUrl||Lt.modelUrl,a.filterBoxesThreshold=r.filterBoxesThreshold||Lt.filterBoxesThreshold,a.IOUThreshold=r.IOUThreshold||Lt.IOUThreshold,a.classProbThreshold=r.classProbThreshold||Lt.classProbThreshold,a.modelReady=!1,a.isPredicting=!1,a.callback=i,a.ready=T(a.loadModel(),a.callback),r.disableDeprecationNotice||console.warn("WARNING! Function YOLO has been deprecated, please use the new ObjectDetector function instead"),a}return A()(n,[{key:"loadModel",value:function(){var e=k()(D.a.mark((function e(){var t;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.videoElt||this.video){e.next=4;break}return e.next=3,this.loadVideo();case 3:this.video=e.sent;case 4:if(!0!==Tt.isAbsoluteURL(this.modelUrl)){e.next=10;break}return e.next=7,x.loadLayersModel(this.modelUrl);case 7:this.model=e.sent,e.next=15;break;case 10:return t=Tt.getModelPath(this.modelUrl),this.modelUrl="".concat(t,"/model.json"),e.next=14,x.loadLayersModel(this.modelUrl);case 14:this.model=e.sent;case 15:return this.modelReady=!0,e.abrupt("return",this);case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"detect",value:function(){var e=k()(D.a.mark((function e(t,n){var r,i;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ready;case 2:if(i=n,!me(t)){e.next=7;break}r=t,e.next=21;break;case 7:if("object"!==I()(t)||!me(t.elt)){e.next=11;break}r=t.elt,e.next=21;break;case 11:if("object"!==I()(t)||!me(t.canvas)){e.next=15;break}r=t.canvas,e.next=21;break;case 15:if("function"!=typeof t){e.next=20;break}r=this.video,i=t,e.next=21;break;case 20:throw new Error("Detection subject not supported");case 21:return e.abrupt("return",T(this.detectInternal(r),i));case 22:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"detectInternal",value:function(){var e=k()(D.a.mark((function e(t){var n,r,i,a,o,s,u,c,l,f,d,h=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ready;case 2:return e.next=4,x.nextFrame();case 4:return n=x.tensor2d([[.57273,.677385],[1.87446,2.06253],[3.33843,5.47434],[7.88282,3.52778],[9.77052,9.16828]]),this.isPredicting=!0,r=x.tidy((function(){var e=pe(t,[zt,zt]),r=Pt(h.model.predict(e),n,80),i=ne()(r,4),a=i[0],o=i[1],s=i[2],u=i[3];return[Nt(a,o),s,u]})),i=ne()(r,3),a=i[0],o=i[1],s=i[2],e.next=9,Ft(a,o,s,this.filterBoxesThreshold);case 9:if(u=e.sent,c=ne()(u,3),l=c[0],f=c[1],d=c[2],a.dispose(),o.dispose(),s.dispose(),null!=l){e.next=19;break}return e.abrupt("return",[]);case 19:return e.abrupt("return",x.tidy((function(){var e=x.scalar(zt),t=x.scalar(zt),r=x.stack([t,e,t,e]).reshape([1,4]),i=x.mul(l,r),a=i.dataSync(),o=f.dataSync(),s=Rt(a,o,h.IOUThreshold),u=ne()(s,3),c=u[0],p=u[1],m=u[2],v=[];return d.gather(x.tensor1d(c,"int32")).dataSync().forEach((function(e,t){var n=m[t];if(!(n<h.classProbThreshold)){var r=Ot[e],i=ne()(p[t],4),a=i[0],o=i[1],s=i[2],u=i[3];a=Math.max(0,a),o=Math.max(0,o),s=Math.min(zt,s)-a;var c={label:r,confidence:n,x:o,y:a,width:u=Math.min(zt,u)-o,height:s,normalized:{x:o/zt,y:a/zt,width:u/zt,height:s/zt}};v.push(c)}})),h.isPredicting=!1,e.dispose(),t.dispose(),r.dispose(),i.dispose(),l.dispose(),f.dispose(),d.dispose(),n.dispose(),v})));case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(dt),Wt=function(e,t,n){var r=null,i={},a=n;return e instanceof HTMLVideoElement?r=e:"object"===I()(e)&&e.elt instanceof HTMLVideoElement?r=e.elt:"function"==typeof e?a=e:"object"===I()(e)&&(i=e),"object"===I()(t)?i=t:"function"==typeof t&&(a=t),new Ut(r,i,a)},Vt=n(242),Gt={base:"lite_mobilenet_v2",modelUrl:void 0},qt=function(){function e(t,n,r){S()(this,e),this.video=t||null,this.modelReady=!1,this.isPredicting=!1,this.config={base:n.base||Gt.base,modelUrl:n.modelUrl||Gt.modelUrl},this.callback=r,this.ready=T(this.loadModel(),this.callback)}return A()(e,[{key:"loadModel",value:function(){var e=k()(D.a.mark((function e(){return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Vt.load(this.config);case 2:return this.model=e.sent,this.modelReady=!0,e.abrupt("return",this);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"detectInternal",value:function(){var e=k()(D.a.mark((function e(t){var n,r;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.isPredicting=!0,e.next=3,this.model.detect(t);case 3:return n=e.sent,r=n.map((function(e){return{label:e.class,confidence:e.score,x:e.bbox[0],y:e.bbox[1],width:e.bbox[2],height:e.bbox[3],normalized:{x:e.bbox[0]/t.width,y:e.bbox[1]/t.height,width:e.bbox[2]/t.width,height:e.bbox[3]/t.height}}})),this.isPredicting=!1,e.abrupt("return",r);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"detect",value:function(){var e=k()(D.a.mark((function e(t,n){var r,i;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ready;case 2:return e.next=4,x.nextFrame();case 4:if(i=n,!me(t)){e.next=9;break}r=t,e.next=23;break;case 9:if("object"!==I()(t)||!me(t.elt)){e.next=13;break}r=t.elt,e.next=23;break;case 13:if("object"!==I()(t)||!me(t.canvas)){e.next=17;break}r=t.canvas,e.next=23;break;case 17:if("function"!=typeof t){e.next=22;break}r=this.video,i=t,e.next=23;break;case 22:throw new Error("Detection subject not supported");case 23:return e.abrupt("return",T(this.detectInternal(r),i));case 24:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),Ht=function(e,t,n){var r=null,i={},a=n;return e instanceof HTMLVideoElement?r=e:"object"===I()(e)&&e.elt instanceof HTMLVideoElement?r=e.elt:"function"==typeof e?a=e:"object"===I()(e)&&(i=e),"object"===I()(t)?i=t:"function"==typeof t&&(a=t),new qt(r,i,a)};function Xt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var Kt=A()((function e(t,n,r,i){return"yolo"===(S()(this,e),this.video=n,this.modelNameOrUrl=t,this.options=r||{},this.callback=i,t)?(this.model=new Wt(this.video,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Xt(Object(n),!0).forEach((function(t){b()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Xt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({disableDeprecationNotice:!0},this.options),i),this):(this.model=new Ht(this.video,this.options,i),this)})),Yt=function(e,t,n,r){var i,a={},o=r,s=e;if("string"!=typeof s)throw new Error('Please specify a model to use. E.g: "YOLO"');-1===s.indexOf("http")&&(s=e.toLowerCase()),t instanceof HTMLVideoElement?i=t:"object"===I()(t)&&t.elt instanceof HTMLVideoElement?i=t.elt:"object"===I()(t)?a=t:"function"==typeof t&&(o=t),"object"===I()(n)?a=n:"function"==typeof n&&(o=n);var u=new Kt(s,i,a,o);return u.model.callback?u.model:u.model.ready},$t=n(99),Jt=n.n($t),Zt=function(e,t){return(Zt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function Qt(e,t){function n(){this.constructor=e}Zt(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var en=function(){return(en=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function tn(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))}function nn(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}var rn=function(){function e(e,t){this.model=e,this.outputStride=t;var n=this.model.inputs[0].shape;B.util.assert(-1===n[1]&&-1===n[2],(function(){return"Input shape ["+n[1]+", "+n[2]+"] must both be equal to or -1"}))}return e.prototype.predict=function(e){var t=this;return Object(B.tidy)((function(){var n=t.preprocessInput(Object(B.cast)(e,"float32")),r=Object(B.expandDims)(n,0),i=t.model.predict(r).map((function(e){return Object(B.squeeze)(e,[0])})),a=t.nameOutputResults(i);return{heatmapScores:Object(B.sigmoid)(a.heatmap),offsets:a.offsets,displacementFwd:a.displacementFwd,displacementBwd:a.displacementBwd}}))},e.prototype.dispose=function(){this.model.dispose()},e}(),an=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Qt(t,e),t.prototype.preprocessInput=function(e){return Object(B.tidy)((function(){return Object(B.sub)(Object(B.div)(e,127.5),1)}))},t.prototype.nameOutputResults=function(e){return{offsets:e[0],heatmap:e[1],displacementFwd:e[2],displacementBwd:e[3]}},t}(rn);function on(e){return Math.floor(e/2)}var sn=function(){function e(e,t){this.priorityQueue=new Array(e),this.numberOfElements=-1,this.getElementValue=t}return e.prototype.enqueue=function(e){this.priorityQueue[++this.numberOfElements]=e,this.swim(this.numberOfElements)},e.prototype.dequeue=function(){var e=this.priorityQueue[0];return this.exchange(0,this.numberOfElements--),this.sink(0),this.priorityQueue[this.numberOfElements+1]=null,e},e.prototype.empty=function(){return-1===this.numberOfElements},e.prototype.size=function(){return this.numberOfElements+1},e.prototype.all=function(){return this.priorityQueue.slice(0,this.numberOfElements+1)},e.prototype.max=function(){return this.priorityQueue[0]},e.prototype.swim=function(e){for(;e>0&&this.less(on(e),e);)this.exchange(e,on(e)),e=on(e)},e.prototype.sink=function(e){for(;2*e<=this.numberOfElements;){var t=2*e;if(t<this.numberOfElements&&this.less(t,t+1)&&t++,!this.less(e,t))break;this.exchange(e,t),e=t}},e.prototype.getValueAt=function(e){return this.getElementValue(this.priorityQueue[e])},e.prototype.less=function(e,t){return this.getValueAt(e)<this.getValueAt(t)},e.prototype.exchange=function(e,t){var n=this.priorityQueue[e];this.priorityQueue[e]=this.priorityQueue[t],this.priorityQueue[t]=n},e}();function un(e,t,n,r,i,a){for(var o=a.shape,s=o[0],u=o[1],c=!0,l=Math.max(n-i,0),f=Math.min(n+i+1,s),d=l;d<f;++d){for(var h=Math.max(r-i,0),p=Math.min(r+i+1,u),m=h;m<p;++m)if(a.get(d,m,e)>t){c=!1;break}if(!c)break}return c}var cn=["nose","leftEye","rightEye","leftEar","rightEar","leftShoulder","rightShoulder","leftElbow","rightElbow","leftWrist","rightWrist","leftHip","rightHip","leftKnee","rightKnee","leftAnkle","rightAnkle"],ln=cn.length,fn=cn.reduce((function(e,t,n){return e[t]=n,e}),{}),dn=[["leftHip","leftShoulder"],["leftElbow","leftShoulder"],["leftElbow","leftWrist"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["rightHip","rightShoulder"],["rightElbow","rightShoulder"],["rightElbow","rightWrist"],["rightHip","rightKnee"],["rightKnee","rightAnkle"],["leftShoulder","rightShoulder"],["leftHip","rightHip"]].map((function(e){var t=e[0],n=e[1];return[fn[t],fn[n]]}));function hn(e,t,n,r){return{y:r.get(e,t,n),x:r.get(e,t,n+ln)}}function pn(e,t,n){var r=hn(e.heatmapY,e.heatmapX,e.id,n),i=r.y,a=r.x;return{x:e.heatmapX*t+a,y:e.heatmapY*t+i}}function mn(e,t,n){return e<t?t:e>n?n:e}function vn(e,t){return{x:e.x+t.x,y:e.y+t.y}}var gn=[["nose","leftEye"],["leftEye","leftEar"],["nose","rightEye"],["rightEye","rightEar"],["nose","leftShoulder"],["leftShoulder","leftElbow"],["leftElbow","leftWrist"],["leftShoulder","leftHip"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["nose","rightShoulder"],["rightShoulder","rightElbow"],["rightElbow","rightWrist"],["rightShoulder","rightHip"],["rightHip","rightKnee"],["rightKnee","rightAnkle"]].map((function(e){var t=e[0],n=e[1];return[fn[t],fn[n]]})),yn=gn.map((function(e){return e[1]})),bn=gn.map((function(e){return e[0]}));function xn(e,t,n,r){return{y:mn(Math.round(e.y/t),0,n-1),x:mn(Math.round(e.x/t),0,r-1)}}function wn(e,t,n,r,i,a,o,s){void 0===s&&(s=2);for(var u=r.shape,c=u[0],l=u[1],f=function(e,t,n){var r=n.shape[2]/2;return{y:n.get(t.y,t.x,e),x:n.get(t.y,t.x,r+e)}}(e,xn(t.position,a,c,l),o),d=vn(t.position,f),h=0;h<s;h++){var p=xn(d,a,c,l),m=hn(p.y,p.x,n,i);d=vn({x:p.x*a,y:p.y*a},{x:m.x,y:m.y})}var v=xn(d,a,c,l),g=r.get(v.y,v.x,n);return{position:d,part:cn[n],score:g}}function _n(e,t,n,r,i,a){var o=t.shape[2],s=yn.length,u=new Array(o),c=e.part,l=e.score,f=pn(c,r,n);u[c.id]={score:l,part:cn[c.id],position:f};for(var d=s-1;d>=0;--d){var h=yn[d],p=bn[d];u[h]&&!u[p]&&(u[p]=wn(d,u[h],p,t,n,r,a))}for(d=0;d<s;++d)h=bn[d],p=yn[d],u[h]&&!u[p]&&(u[p]=wn(d,u[h],p,t,n,r,i));return u}function kn(e,t,n,r){var i=n.x,a=n.y;return e.some((function(e){var n=e.keypoints[r].position;return function(e,t,n,r){var i=n-e,a=r-t;return i*i+a*a}(a,i,n.y,n.x)<=t}))}function En(e,t,n){return n.reduce((function(n,r,i){var a=r.position,o=r.score;return kn(e,t,a,i)||(n+=o),n}),0)/n.length}var Sn=1;function Cn(e,t,n,r,i,a,o,s){void 0===o&&(o=.5),void 0===s&&(s=20);for(var u=[],c=function(e,t,n){for(var r=n.shape,i=r[0],a=r[1],o=r[2],s=new sn(i*a*o,(function(e){return e.score})),u=0;u<i;++u)for(var c=0;c<a;++c)for(var l=0;l<o;++l){var f=n.get(u,c,l);f<e||un(l,f,u,c,t,n)&&s.enqueue({score:f,part:{heatmapY:u,heatmapX:c,id:l}})}return s}(o,Sn,e),l=s*s;u.length<a&&!c.empty();){var f=c.dequeue();if(!kn(u,l,pn(f.part,i,t),f.part.id)){var d=_n(f,e,t,i,n,r),h=En(u,l,d);u.push({keypoints:d,score:h})}}return u}function An(e){var t=e.shape,n=t[0],r=t[1],i=t[2];return Object(B.tidy)((function(){var t=Object(B.reshape)(e,[n*r,i]),a=Object(B.argMax)(t,0),o=Object(B.expandDims)(Object(B.div)(a,Object(B.scalar)(r,"int32")),1),s=Object(B.expandDims)(function(e,t){return Object(B.tidy)((function(){var n=Object(B.div)(e,Object(B.scalar)(t,"int32"));return Object(B.sub)(e,Object(B.mul)(n,Object(B.scalar)(t,"int32")))}))}(a,r),1);return Object(B.concat)([o,s],1)}))}function On(e,t,n,r){return{y:r.get(e,t,n),x:r.get(e,t,n+ln)}}function Dn(e,t,n){return Object(B.tidy)((function(){var r=function(e,t){for(var n=[],r=0;r<ln;r++){var i=On(e.get(r,0).valueOf(),e.get(r,1).valueOf(),r,t),a=i.x,o=i.y;n.push(o),n.push(a)}return Object(B.tensor2d)(n,[ln,2])}(e,n);return Object(B.add)(Object(B.cast)(Object(B.mul)(e.toTensor(),Object(B.scalar)(t,"int32")),"float32"),r)}))}function Tn(e,t,n){return tn(this,void 0,void 0,(function(){var r,i,a,o,s,u,c,l,f,d;return nn(this,(function(h){switch(h.label){case 0:return r=0,i=An(e),[4,Promise.all([e.buffer(),t.buffer(),i.buffer()])];case 1:return a=h.sent(),o=a[0],s=a[1],u=a[2],[4,(c=Dn(u,n,s)).buffer()];case 2:return l=h.sent(),f=Array.from(function(e,t){for(var n=t.shape[0],r=new Float32Array(n),i=0;i<n;i++){var a=t.get(i,0),o=t.get(i,1);r[i]=e.get(a,o,i)}return r}(o,u)),d=f.map((function(e,t){return r+=e,{position:{y:l.get(t,0),x:l.get(t,1)},part:cn[t],score:e}})),i.dispose(),c.dispose(),[2,{keypoints:d,score:r/d.length}]}}))}))}var jn="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/mobilenet/",Mn="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/resnet50/",Fn=[-123.15,-115.9,-103.06],In=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Qt(t,e),t.prototype.preprocessInput=function(e){return Object(B.add)(e,Fn)},t.prototype.nameOutputResults=function(e){var t=e[0],n=e[1];return{offsets:e[2],heatmap:e[3],displacementFwd:t,displacementBwd:n}},t}(rn);function Nn(e,t){return Ln(e,t)?e:Math.floor(e/t)*t+1}function Rn(e){B.util.assert("number"==typeof e||"object"==typeof e,(function(){return"Invalid inputResolution "+e+". Should be a number or an object with width and height"})),"object"==typeof e&&(B.util.assert("number"==typeof e.width,(function(){return"inputResolution.width has a value of "+e.width+" which is invalid; it must be a number"})),B.util.assert("number"==typeof e.height,(function(){return"inputResolution.height has a value of "+e.height+" which is invalid; it must be a number"})))}function Pn(e,t){return Rn(e),"object"==typeof e?[Nn(e.height,t),Nn(e.width,t)]:[Nn(e,t),Nn(e,t)]}Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY;var Bn=[8,16,32];function Ln(e,t){return(e-1)%t==0}function zn(e){return e instanceof B.Tensor?[e.shape[0],e.shape[1]]:[e.height,e.width]}function Un(e,t){var n=t[0],r=t[1],i=zn(e),a=i[0],o=i[1],s=r/n,u=[0,0,0,0],c=u[0],l=u[1],f=u[2],d=u[3];return o/a<s?(c=0,l=0,f=Math.round(.5*(s*a-o)),d=Math.round(.5*(s*a-o))):(c=Math.round(.5*(1/s*o-a)),l=Math.round(.5*(1/s*o-a)),f=0,d=0),{resized:Object(B.tidy)((function(){var t=function(e){return e instanceof B.Tensor?e:B.browser.fromPixels(e)}(e);return t=Object(B.pad3d)(t,[[c,l],[f,d],[0,0]]),B.image.resizeBilinear(t,[n,r])})),padding:{top:c,left:f,right:d,bottom:l}}}function Wn(e,t,n,r,i){var a=t[0],o=t[1],s=n[0],u=n[1],c=function(e,t,n,r,i){return void 0===r&&(r=0),void 0===i&&(i=0),1===n&&1===t&&0===r&&0===i?e:e.map((function(e){return function(e,t,n,r,i){return void 0===r&&(r=0),void 0===i&&(i=0),{score:e.score,keypoints:e.keypoints.map((function(e){var a=e.score,o=e.part,s=e.position;return{score:a,part:o,position:{x:s.x*n+i,y:s.y*t+r}}}))}}(e,t,n,r,i)}))}(e,(a+r.top+r.bottom)/s,(o+r.left+r.right)/u,-r.top,-r.left);return i?function(e,t){return t<=0?e:e.map((function(e){return function(e,t){return{score:e.score,keypoints:e.keypoints.map((function(e){var n=e.score,r=e.part,i=e.position;return{score:n,part:r,position:{x:t-1-i.x,y:i.y}}}))}}(e,t)}))}(c,o):c}var Vn={architecture:"MobileNetV1",outputStride:16,multiplier:.75,inputResolution:257},Gn=["MobileNetV1","ResNet50"],qn={MobileNetV1:[8,16,32],ResNet50:[32,16]},Hn={MobileNetV1:[.5,.75,1],ResNet50:[1]},Xn=[1,2,4],Kn={flipHorizontal:!1},Yn={flipHorizontal:!1,maxDetections:5,scoreThreshold:.5,nmsRadius:20},$n=function(){function e(e,t){(function(e){B.util.assert("number"==typeof e,(function(){return"outputStride is not a number"})),B.util.assert(Bn.indexOf(e)>=0,(function(){return"outputStride of "+e+" is invalid. It must be either 8, 16, or 32"}))})(e.outputStride),function(e,t){B.util.assert("number"==typeof e[0]&&"number"==typeof e[1],(function(){return"both resolution values must be a number but had values "+e})),B.util.assert(Ln(e[0],t),(function(){return"height of "+e[0]+" is invalid for output stride "+t+"."})),B.util.assert(Ln(e[1],t),(function(){return"width of "+e[1]+" is invalid for output stride "+t+"."}))}(t,e.outputStride),this.baseModel=e,this.inputResolution=t}return e.prototype.estimateMultiplePoses=function(e,t){return void 0===t&&(t=Yn),tn(this,void 0,void 0,(function(){var n,r,i,a,o,s,u,c,l,f,d,h,p,m,v,g,y,b,x,w,_;return nn(this,(function(k){switch(k.label){case 0:return n=en({},Yn,t),function(e){var t=e.maxDetections,n=e.scoreThreshold,r=e.nmsRadius;if(t<=0)throw new Error("Invalid maxDetections "+t+". Should be > 0");if(n<0||n>1)throw new Error("Invalid scoreThreshold "+n+". Should be in range [0.0, 1.0]");if(r<=0)throw new Error("Invalid nmsRadius "+r+".")}(t),r=this.baseModel.outputStride,i=this.inputResolution,a=zn(e),o=a[0],s=a[1],u=Un(e,i),c=u.resized,l=u.padding,f=this.baseModel.predict(c),d=f.heatmapScores,h=f.offsets,p=f.displacementFwd,m=f.displacementBwd,[4,function(e){return tn(this,void 0,void 0,(function(){return nn(this,(function(t){return[2,Promise.all(e.map((function(e){return e.buffer()})))]}))}))}([d,h,p,m])];case 1:return v=k.sent(),g=v[0],y=v[1],b=v[2],x=v[3],[4,Cn(g,y,b,x,r,n.maxDetections,n.scoreThreshold,n.nmsRadius)];case 2:return w=k.sent(),_=Wn(w,[o,s],i,l,n.flipHorizontal),d.dispose(),h.dispose(),p.dispose(),m.dispose(),c.dispose(),[2,_]}}))}))},e.prototype.estimateSinglePose=function(e,t){return void 0===t&&(t=Kn),tn(this,void 0,void 0,(function(){var n,r,i,a,o,s,u,c,l,f,d,h,p,m,v,g;return nn(this,(function(y){switch(y.label){case 0:return n=en({},Kn,t),r=this.baseModel.outputStride,i=this.inputResolution,a=zn(e),o=a[0],s=a[1],u=Un(e,i),c=u.resized,l=u.padding,f=this.baseModel.predict(c),d=f.heatmapScores,h=f.offsets,p=f.displacementFwd,m=f.displacementBwd,[4,Tn(d,h,r)];case 1:return v=y.sent(),g=Wn([v],[o,s],i,l,n.flipHorizontal),d.dispose(),h.dispose(),p.dispose(),m.dispose(),c.dispose(),[2,g[0]]}}))}))},e.prototype.estimatePoses=function(e,t){return tn(this,void 0,void 0,(function(){return nn(this,(function(n){switch(n.label){case 0:return"single-person"!==t.decodingMethod?[3,2]:[4,this.estimateSinglePose(e,t)];case 1:return[2,[n.sent()]];case 2:return[2,this.estimateMultiplePoses(e,t)]}}))}))},e.prototype.dispose=function(){this.baseModel.dispose()},e}();function Jn(e){return tn(this,void 0,void 0,(function(){var t,n,r,i,a,o,s;return nn(this,(function(u){switch(u.label){case 0:if(t=e.outputStride,n=e.quantBytes,r=e.multiplier,null==B)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this\n        model.");return i=function(e,t,n){var r={1:"100",.75:"075",.5:"050"},i="model-stride"+e+".json";return 4===n?jn+"float/"+r[t]+"/"+i:jn+"quant"+n+"/"+r[t]+"/"+i}(t,r,n),[4,Object(P.loadGraphModel)(e.modelUrl||i)];case 1:return a=u.sent(),o=new an(a,t),s=Pn(e.inputResolution,o.outputStride),[2,new $n(o,s)]}}))}))}function Zn(e){return tn(this,void 0,void 0,(function(){var t,n,r,i,a,o;return nn(this,(function(s){switch(s.label){case 0:if(t=e.outputStride,n=e.quantBytes,null==B)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this\n        model.");return r=function(e,t){var n="model-stride"+e+".json";return 4===t?Mn+"float/"+n:Mn+"quant"+t+"/"+n}(t,n),[4,Object(P.loadGraphModel)(e.modelUrl||r)];case 1:return i=s.sent(),a=new In(i,t),o=Pn(e.inputResolution,a.outputStride),[2,new $n(a,o)]}}))}))}function Qn(e){return void 0===e&&(e=Vn),tn(this,void 0,void 0,(function(){return nn(this,(function(t){return"ResNet50"===(e=function(e){if(null==(e=e||Vn).architecture&&(e.architecture="MobileNetV1"),Gn.indexOf(e.architecture)<0)throw new Error("Invalid architecture "+e.architecture+". Should be one of "+Gn);if(null==e.inputResolution&&(e.inputResolution=257),Rn(e.inputResolution),null==e.outputStride&&(e.outputStride=16),qn[e.architecture].indexOf(e.outputStride)<0)throw new Error("Invalid outputStride "+e.outputStride+". Should be one of "+qn[e.architecture]+" for architecture "+e.architecture+".");if(null==e.multiplier&&(e.multiplier=1),Hn[e.architecture].indexOf(e.multiplier)<0)throw new Error("Invalid multiplier "+e.multiplier+". Should be one of "+Hn[e.architecture]+" for architecture "+e.architecture+".");if(null==e.quantBytes&&(e.quantBytes=4),Xn.indexOf(e.quantBytes)<0)throw new Error("Invalid quantBytes "+e.quantBytes+". Should be one of "+Xn+" for architecture "+e.architecture+".");if("MobileNetV1"===e.architecture&&32===e.outputStride&&1!==e.multiplier)throw new Error("When using an output stride of 32, you must select 1 as the multiplier.");return e}(e)).architecture?[2,Zn(e)]:"MobileNetV1"===e.architecture?[2,Jn(e)]:[2,null]}))}))}function er(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=At()(e);if(t){var i=At()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return St()(this,n)}}var tr={architecture:"MobileNetV1",outputStride:16,flipHorizontal:!1,minConfidence:.5,maxPoseDetections:5,scoreThreshold:.5,nmsRadius:20,detectionType:"multiple",inputResolution:256,multiplier:.75,quantBytes:2,modelUrl:null},nr=function(e){kt()(n,e);var t=er(n);function n(e,r,i,a){var o;return S()(this,n),(o=t.call(this)).video=e,o.modelUrl=r.modelUrl||null,o.architecture=r.architecture||tr.architecture,o.detectionType=i||r.detectionType||tr.detectionType,o.outputStride=r.outputStride||tr.outputStride,o.flipHorizontal=r.flipHorizontal||tr.flipHorizontal,o.scoreThreshold=r.scoreThreshold||tr.scoreThreshold,o.minConfidence=r.minConfidence||tr.minConfidence,o.maxPoseDetections=r.maxPoseDetections||tr.maxPoseDetections,o.multiplier=r.multiplier||tr.multiplier,o.inputResolution=r.inputResolution||tr.inputResolution,o.quantBytes=r.quantBytes||tr.quantBytes,o.nmsRadius=r.nmsRadius||tr.nmsRadius,o.ready=T(o.load(),a),o}return A()(n,[{key:"load",value:function(){var e=k()(D.a.mark((function e(){var t,n=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="mobilenetv1"===this.architecture.toLowerCase()?{architecture:this.architecture,outputStride:this.outputStride,inputResolution:this.inputResolution,multiplier:this.multiplier,quantBytes:this.quantBytes,modelUrl:this.modelUrl}:{architecture:this.architecture,outputStride:this.outputStride,inputResolution:this.inputResolution,quantBytes:this.quantBytes},e.next=3,Qn(t);case 3:if(this.net=e.sent,!this.video){e.next=9;break}if(0!==this.video.readyState){e.next=8;break}return e.next=8,new Promise((function(e){n.video.onloadeddata=function(){return e()}}));case 8:"single"===this.detectionType?this.singlePose():this.multiPose();case 9:return e.abrupt("return",this);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"skeleton",value:function(e){return function(e,t){return dn.reduce((function(n,r){var i=r[0],a=r[1];return function(e,t,n){return e<n||t<n}(e[i].score,e[a].score,t)||n.push([e[i],e[a]]),n}),[])}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.minConfidence)}},{key:"mapParts",value:function(e){var t=JSON.parse(JSON.stringify(e));return t.keypoints.forEach((function(e){t[e.part]={x:e.position.x,y:e.position.y,confidence:e.score}})),t}},{key:"getInput",value:function(e){return e instanceof HTMLImageElement||e instanceof HTMLVideoElement||e instanceof HTMLCanvasElement||e instanceof ImageData?e:"object"===I()(e)&&(e.elt instanceof HTMLImageElement||e.elt instanceof HTMLVideoElement||e.elt instanceof ImageData)?e.elt:"object"===I()(e)&&e.canvas instanceof HTMLCanvasElement?e.canvas:this.video}},{key:"singlePose",value:function(){var e=k()(D.a.mark((function e(t,n){var r,i,a,o,s=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.getInput(t),e.next=3,this.net.estimateSinglePose(r,{flipHorizontal:this.flipHorizontal});case 3:if(i=e.sent,a=this.mapParts(i),o=[{pose:a,skeleton:this.skeleton(i.keypoints)}],this.emit("pose",o),!this.video){e.next=9;break}return e.abrupt("return",x.nextFrame().then((function(){return s.singlePose()})));case 9:return"function"==typeof n&&n(o),e.abrupt("return",o);case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"multiPose",value:function(){var e=k()(D.a.mark((function e(t,n){var r,i,a,o,s=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.getInput(t),e.next=3,this.net.estimateMultiplePoses(r,{flipHorizontal:this.flipHorizontal,maxDetections:this.maxPoseDetections,scoreThreshold:this.scoreThreshold,nmsRadius:this.nmsRadius});case 3:if(i=e.sent,a=i.map((function(e){return s.mapParts(e)})),o=a.map((function(e){return{pose:e,skeleton:s.skeleton(e.keypoints)}})),this.emit("pose",o),!this.video){e.next=9;break}return e.abrupt("return",x.nextFrame().then((function(){return s.multiPose()})));case 9:return"function"==typeof n&&n(o),e.abrupt("return",o);case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(Jt.a),rr=function(e,t,n){var r,i={},a=n,o=null;return e instanceof HTMLVideoElement?r=e:"object"===I()(e)&&e.elt instanceof HTMLVideoElement?r=e.elt:"object"===I()(e)?i=e:"function"==typeof e&&(a=e),"object"===I()(t)?i=t:"string"==typeof t&&(o=t),"function"==typeof t&&(a=t),new nr(r,i,o,a)},ir=function(){function e(t){S()(this,e),this.urlPath=t.endsWith("/")?t:"".concat(t,"/"),this.variables={}}return A()(e,[{key:"loadManifest",value:function(){var e=k()(D.a.mark((function e(){var t;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,R.a.get(this.urlPath+"manifest.json");case 3:return t=e.sent,e.abrupt("return",t.data);case 7:throw e.prev=7,e.t0=e.catch(0),new Error("".concat("manifest.json"," not found at ").concat(this.urlPath,". ").concat(e.t0));case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(){return e.apply(this,arguments)}}()},{key:"loadVariable",value:function(){var e=k()(D.a.mark((function e(t){var n,r,i,a,o,s,u;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getCheckpointManifest();case 2:if(n=e.sent,t in n){e.next=5;break}throw new Error("Cannot load non-existent variable ".concat(t));case 5:return r=n[t],i=r.filename,a=r.shape,o=this.urlPath+i,e.prev=7,e.next=10,R.a.get(o,{responseType:"arraybuffer"});case 10:return s=e.sent,u=new Float32Array(s.data),e.abrupt("return",x.tensor(u,a));case 15:throw e.prev=15,e.t0=e.catch(7),new Error("Error loading variable ".concat(t," from URL ").concat(o,": ").concat(e.t0));case 18:case"end":return e.stop()}}),e,this,[[7,15]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getCheckpointManifest",value:function(){var e=k()(D.a.mark((function e(){return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.checkpointManifest){e.next=4;break}return e.next=3,this.loadManifest();case 3:this.checkpointManifest=e.sent;case 4:return e.abrupt("return",this.checkpointManifest);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getKeys",value:function(){var e=k()(D.a.mark((function e(){var t;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getCheckpointManifest();case 2:return t=e.sent,e.abrupt("return",Object.keys(t));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAllVariables",value:function(){var e=k()(D.a.mark((function e(){var t,n,r=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getKeys();case 2:return t=e.sent,n=t.map((function(e){return r.getVariable(e)})),e.next=6,Promise.all(n);case 6:return e.abrupt("return",this.variables);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getVariable",value:function(){var e=k()(D.a.mark((function e(t){return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.variables[t]){e.next=4;break}return e.next=3,this.loadVariable(t);case 3:this.variables[t]=e.sent;case 4:return e.abrupt("return",this.variables[t]);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function ar(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=At()(e);if(t){var i=At()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return St()(this,n)}}var or=200,sr=function(e){return new Promise((function(t){var n=new Image(or,or);n.onload=function(){return t(n)},n.src=e.toDataURL()}))},ur=function(e){kt()(n,e);var t=ar(n);function n(e,r,i){var a;return S()(this,n),(a=t.call(this,r,or)).ready=!1,a.variableDictionary={},a.timesScalar=x.scalar(150),a.plusScalar=x.scalar(127.5),a.epsilonScalar=x.scalar(.001),a.video=null,a.ready=T(a.load(e),i),a}return A()(n,[{key:"load",value:function(){var e=k()(D.a.mark((function e(t){return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.videoElt){e.next=3;break}return e.next=3,this.loadVideo();case 3:return e.next=5,this.loadCheckpoints(t);case 5:return e.abrupt("return",this);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadCheckpoints",value:function(){var e=k()(D.a.mark((function e(t){var n;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new ir(t),e.next=3,n.getAllVariables();case 3:this.variables=e.sent;case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"instanceNorm",value:function(e,t){var r=this;return x.tidy((function(){var i=ne()(e.shape,3),a=i[0],o=i[1],s=i[2],u=x.moments(e,[0,1]),c=u.mean,l=u.variance,f=r.variables[n.getVariableName(t)],d=r.variables[n.getVariableName(t+1)],h=r.epsilonScalar,p=x.div(x.sub(e.asType("float32"),c),x.sqrt(x.add(l,h)));return x.add(x.mul(d,p),f).as3D(a,o,s)}))}},{key:"convLayer",value:function(e,t,r,i){var a=x.conv2d(e,this.variables[n.getVariableName(i)],[t,t],"same"),o=this.instanceNorm(a,i+1);return r?x.relu(o):o}},{key:"residualBlock",value:function(e,t){var n=this.convLayer(e,1,!0,t),r=this.convLayer(n,1,!1,t+3);return x.add(r,e)}},{key:"convTransposeLayer",value:function(e,t,r,i){var a=ne()(e.shape,2),o=[a[0]*r,a[1]*r,t],s=x.conv2dTranspose(e,this.variables[n.getVariableName(i)],o,[r,r],"same"),u=this.instanceNorm(s,i+1);return x.relu(u)}},{key:"transfer",value:function(){var e=k()(D.a.mark((function e(t,n){var r,i;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=n,!(t instanceof HTMLVideoElement||t instanceof HTMLImageElement||t instanceof ImageData)){e.next=5;break}r=t,e.next=18;break;case 5:if(!(t instanceof HTMLCanvasElement)){e.next=11;break}return e.next=8,sr(t);case 8:r=e.sent,e.next=18;break;case 11:if(!("object"===I()(t)&&t.elt instanceof HTMLCanvasElement)){e.next=17;break}return e.next=14,sr(t.elt);case 14:r=e.sent,e.next=18;break;case 17:"object"===I()(t)&&(t.elt instanceof HTMLVideoElement||t.elt instanceof HTMLImageElement||t.elt instanceof ImageData)?r=t.elt:"function"==typeof t&&(r=this.video,i=t);case 18:return e.abrupt("return",T(this.transferInternal(r),i));case 19:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"transferInternal",value:function(){var e=k()(D.a.mark((function e(t){var n,r,i=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=x.browser.fromPixels(t),r=fe(x.tidy((function(){var e=i.convLayer(n,1,!0,0),t=i.convLayer(e,2,!0,3),r=i.convLayer(t,2,!0,6),a=i.residualBlock(r,9),o=i.residualBlock(a,15),s=i.residualBlock(o,21),u=i.residualBlock(s,27),c=i.residualBlock(u,33),l=i.convTransposeLayer(c,64,2,39),f=i.convTransposeLayer(l,32,2,42),d=i.convLayer(f,1,!1,45),h=x.tanh(d),p=x.mul(i.timesScalar,h),m=x.add(i.plusScalar,p),v=x.clipByValue(m,0,255);return x.div(v,x.scalar(255))}))),n.dispose(),e.next=5,x.nextFrame();case 5:return e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}],[{key:"getVariableName",value:function(e){return 0===e?"Variable":"Variable_".concat(e)}}]),n}(dt),cr=function(e,t,n){var r=n;"function"==typeof t&&(r=t);var i=new ur(e,t,r);return r?i:i.ready},lr=function(e){for(var t,n=Math.random(),r=0,i=0;i<e.length;i+=1)if(n<(r+=e[i])){t=i;break}return t},fr=/cell_[0-9]|lstm_[0-9]/gi,dr=/weights|weight|kernel|kernels|w/gi,hr=/softmax/gi,pr=function(){function e(t,n){S()(this,e),this.ready=!1,this.model={},this.cellsAmount=0,this.cells=[],this.zeroState={c:[],h:[]},this.state={c:[],h:[]},this.vocab={},this.vocabSize=0,this.probabilities=[],this.defaults={seed:"a",length:20,temperature:.5,stateful:!1},this.ready=T(this.loadCheckpoints(t),n)}return A()(e,[{key:"resetState",value:function(){this.state=this.zeroState}},{key:"setState",value:function(e){this.state=e}},{key:"getState",value:function(){return this.state}},{key:"loadCheckpoints",value:function(){var e=k()(D.a.mark((function e(t){var n,r,i=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new ir(t),e.next=3,n.getAllVariables();case 3:return r=e.sent,Object.keys(r).forEach((function(e){e.match(fr)?e.match(dr)?(i.model["Kernel_".concat(e.match(/[0-9]/)[0])]=r[e],i.cellsAmount+=1):i.model["Bias_".concat(e.match(/[0-9]/)[0])]=r[e]:e.match(hr)?e.match(dr)?i.model.fullyConnectedWeights=r[e]:i.model.fullyConnectedBiases=r[e]:i.model[e]=r[e]})),e.next=7,this.loadVocab(t);case 7:return e.next=9,this.initCells();case 9:return e.abrupt("return",this);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadVocab",value:function(){var e=k()(D.a.mark((function e(t){var n,r;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,R.a.get("".concat(t,"/vocab.json"));case 3:return n=e.sent,r=n.data,this.vocab=r,this.vocabSize=Object.keys(r).length,e.abrupt("return",this.vocab);case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",e.t0);case 13:case"end":return e.stop()}}),e,this,[[0,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"initCells",value:function(){var e=k()(D.a.mark((function e(){var t,n,r,i=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(this.cells=[],this.zeroState={c:[],h:[]},t=x.tensor(1),n=function(e){return function(n,r,a){return x.basicLSTMCell(t,i.model["Kernel_".concat(e)],i.model["Bias_".concat(e)],n,r,a)}},r=0;r<this.cellsAmount;r+=1)this.zeroState.c.push(x.zeros([1,this.model["Bias_".concat(r)].shape[0]/4])),this.zeroState.h.push(x.zeros([1,this.model["Bias_".concat(r)].shape[0]/4])),this.cells.push(n(r));this.state=this.zeroState;case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"generateInternal",value:function(){var e=k()(D.a.mark((function e(t){var n,r,i,a,o,s,u,c,l,f,d,h,p,m,v,g,y,b,w,_=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ready;case 2:n=t.seed||this.defaults.seed,r=+t.length||this.defaults.length,i=+t.temperature||this.defaults.temperature,t.stateful||this.defaults.stateful||(this.state=this.zeroState),a=[],o=Array.from(n),s=[],o.forEach((function(e){s.push(_.vocab[e])})),u=s[0],c=[],l=0;case 14:if(!(l<o.length+r+-1)){e.next=36;break}return e.next=17,x.buffer([1,this.vocabSize]);case 17:return(f=e.sent).set(1,0,u),d=f.toTensor(),h=void 0,this.model.embedding?(p=x.matMul(d,this.model.embedding),h=x.multiRNNCell(this.cells,p,this.state.c,this.state.h)):h=x.multiRNNCell(this.cells,d,this.state.c,this.state.h),this.state.c=h[0],this.state.h=h[1],m=this.state.h[1],v=x.matMul(m,this.model.fullyConnectedWeights),g=x.add(v,this.model.fullyConnectedBiases),y=x.div(g,x.tensor(i)),b=x.exp(y),e.next=31,x.div(b,x.sum(b)).data();case 31:c=e.sent,l<o.length-1?u=s[l+1]:(u=lr(c),a.push(u));case 33:l+=1,e.next=14;break;case 36:return w="",a.forEach((function(e){var t=Object.keys(_.vocab).find((function(t){return _.vocab[t]===e}));t&&(w+=t)})),this.probabilities=c,e.abrupt("return",{sample:w,state:this.state});case 40:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"reset",value:function(){this.state=this.zeroState}},{key:"generate",value:function(){var e=k()(D.a.mark((function e(t,n){return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.reset(),e.abrupt("return",T(this.generateInternal(t),n));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"predict",value:function(){var e=k()(D.a.mark((function e(t,n){var r,i,a,o,s,u,c,l,f,d,h=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=[],i=t>0?t:.1,a=this.state.h[1],o=x.matMul(a,this.model.fullyConnectedWeights),s=x.add(o,this.model.fullyConnectedBiases),u=x.div(s,x.tensor(i)),c=x.exp(u),e.next=9,x.div(c,x.sum(c)).data();case 9:return r=e.sent,l=lr(r),f=Object.keys(this.vocab).find((function(e){return h.vocab[e]===l})),this.probabilities=r,n&&n(f),d=Object.keys(this.vocab).map((function(e){return{char:e,probability:h.probabilities[h.vocab[e]]}})),e.abrupt("return",{sample:f,probabilities:d});case 16:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"feed",value:function(){var e=k()(D.a.mark((function e(t,n){var r,i,a,o,s,u,c,l,f=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ready;case 2:r=Array.from(t),i=[],r.forEach((function(e){i.push(f.vocab[e])})),a=i[0],o=0;case 7:if(!(o<r.length)){e.next=21;break}return e.next=10,x.buffer([1,this.vocabSize]);case 10:(s=e.sent).set(1,0,a),u=s.toTensor(),c=void 0,this.model.embedding?(l=x.matMul(u,this.model.embedding),c=x.multiRNNCell(this.cells,l,this.state.c,this.state.h)):c=x.multiRNNCell(this.cells,u,this.state.c,this.state.h),this.state.c=c[0],this.state.h=c[1],a=i[o];case 18:o+=1,e.next=7;break;case 21:n&&n();case 22:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),mr=function(){return new pr(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"./",arguments.length>1?arguments[1]:void 0)},vr=function(){function e(t){S()(this,e),this.urlPath=t}return A()(e,[{key:"getAllVariables",value:function(){var e=k()(D.a.mark((function e(){var t,n,r,i,a,o,s,u,c,l;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R.a.get(this.urlPath,{responseType:"arraybuffer"}).catch((function(e){throw new Error("No model found. Failed with error ".concat(e))}));case 2:for(t=e.sent,n=t.data,r=[],i=0;i<n.byteLength;)a=new Uint8Array(n.slice(i,i+4)),i+=4,o=(a[0]<<24)+(a[1]<<16)+(a[2]<<8)+a[3],r.push(n.slice(i,i+o)),i+=o;return s=JSON.parse(new TextDecoder("utf8").decode(r[0])),u=new Float32Array(r[1]),c=new Uint8Array(r[2]),l={},i=0,s.forEach((function(e){var t=e.shape,n=e.name,r=t.reduce((function(e,t){return e*t})),a=c.slice(i,i+r),o=new Float32Array(a.length);a.forEach((function(e,t){o[t]=u[e]})),l[n]=x.tensor(o,t,"float32"),i+=r})),e.abrupt("return",l);case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),gr=function(){function e(t,n){S()(this,e),this.ready=T(this.loadCheckpoints(t),n)}return A()(e,[{key:"loadCheckpoints",value:function(){var e=k()(D.a.mark((function e(t){var n;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new vr(t),e.next=3,n.getAllVariables();case 3:return this.variables=e.sent,e.abrupt("return",this);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"transfer",value:function(){var e=k()(D.a.mark((function e(t,n){return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",T(this.transferInternal(t),n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"transferInternal",value:function(){var t=k()(D.a.mark((function t(n){var r,i=this;return D.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=fe(x.tidy((function(){var t=x.browser.fromPixels(n),r=t.dataSync(),a=x.tensor3d(r,t.shape),o=x.div(a,x.scalar(255)),s=e.preprocess(o),u=[],c=i.variables["generator/encoder_1/conv2d/kernel"],l=i.variables["generator/encoder_1/conv2d/bias"],f=e.conv2d(s,c,l);u.push(f);for(var d=2;d<=8;d+=1){var h="generator/encoder_".concat(d.toString());c=i.variables["".concat(h,"/conv2d/kernel")];var p=i.variables["".concat(h,"/conv2d/bias")],m=u[u.length-1],v=x.leakyRelu(m,.2);f=e.conv2d(v,c,p);var g=i.variables["".concat(h,"/batch_normalization/gamma")],y=i.variables["".concat(h,"/batch_normalization/beta")],b=e.batchnorm(f,g,y);u.push(b)}for(var w=8;w>=2;w-=1){var _=void 0;if(8===w)_=u[u.length-1];else{var k=w-1;_=x.concat([u[u.length-1],u[k]],2)}var E=x.relu(_),S="generator/decoder_".concat(w.toString());c=i.variables["".concat(S,"/conv2d_transpose/kernel")],l=i.variables["".concat(S,"/conv2d_transpose/bias")],f=e.deconv2d(E,c,l);var C=i.variables["".concat(S,"/batch_normalization/gamma")],A=i.variables["".concat(S,"/batch_normalization/beta")],O=e.batchnorm(f,C,A);u.push(O)}var D=x.concat([u[u.length-1],u[0]],2),T=x.relu(D);c=i.variables["generator/decoder_1/conv2d_transpose/kernel"];var j=i.variables["generator/decoder_1/conv2d_transpose/bias"];f=e.deconv2d(T,c,j),T=x.tanh(f),u.push(T);var M=u[u.length-1];return e.deprocess(M)}))),t.next=3,x.nextFrame();case 3:return t.abrupt("return",r);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}],[{key:"preprocess",value:function(e){var t=x.tidy((function(){return x.sub(x.mul(e,x.scalar(2)),x.scalar(1))}));return e.dispose(),t}},{key:"deprocess",value:function(e){var t=x.tidy((function(){return x.div(x.add(e,x.scalar(1)),x.scalar(2))}));return e.dispose(),t}},{key:"batchnorm",value:function(e,t,n){var r=x.tidy((function(){var r=x.moments(e,[0,1]);return x.batchNorm(e,r.mean,r.variance,n,t,1e-5)}));return e.dispose(),r}},{key:"conv2d",value:function(e,t){var n=t.clone(),r=x.tidy((function(){return x.conv2d(e,n,[2,2],"same")}));return e.dispose(),n.dispose(),r}},{key:"deconv2d",value:function(e,t,n){var r=x.tidy((function(){var r=x.conv2dTranspose(e,t,[2*e.shape[0],2*e.shape[1],t.shape[2]],[2,2],"same");return x.add(r,n)}));return e.dispose(),t.dispose(),n.dispose(),r}}]),e}(),yr=function(e,t){var n=new gr(e,t);return t?n:n.ready},br=n(241),xr=new Set(["alarm_clock","ambulance","angel","ant","antyoga","backpack","barn","basket","bear","bee","beeflower","bicycle","bird","book","brain","bridge","bulldozer","bus","butterfly","cactus","calendar","castle","cat","catbus","catpig","chair","couch","crab","crabchair","crabrabbitfacepig","cruise_ship","diving_board","dog","dogbunny","dolphin","duck","elephant","elephantpig","eye","face","fan","fire_hydrant","firetruck","flamingo","flower","floweryoga","frog","frogsofa","garden","hand","hedgeberry","hedgehog","helicopter","kangaroo","key","lantern","lighthouse","lion","lionsheep","lobster","map","mermaid","monapassport","monkey","mosquito","octopus","owl","paintbrush","palm_tree","parrot","passport","peas","penguin","pig","pigsheep","pineapple","pool","postcard","power_outlet","rabbit","rabbitturtle","radio","radioface","rain","rhinoceros","rifle","roller_coaster","sandwich","scorpion","sea_turtle","sheep","skull","snail","snowflake","speedboat","spider","squirrel","steak","stove","strawberry","swan","swing_set","the_mona_lisa","tiger","toothbrush","toothpaste","tractor","trombone","truck","whale","windmill","yoga","yogabicycle","everything"]),wr={modelPath:"https://storage.googleapis.com/quickdraw-models/sketchRNN/large_models/",modelPath_large:"https://storage.googleapis.com/quickdraw-models/sketchRNN/models/",modelPath_small:"https://storage.googleapis.com/quickdraw-models/sketchRNN/models/",PATH_END:".gen.json",temperature:.65,pixelFactor:3},_r=function(){function e(t,n){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];S()(this,e);var i=t;if(this.config={temperature:.65,pixelFactor:3,modelPath:wr.modelPath,modelPath_small:wr.modelPath_small,modelPath_large:wr.modelPath_large,PATH_END:wr.PATH_END},!0===Tt.isAbsoluteURL(i)){var a=Tt.getModelPath(i);this.config.modelPath=a}else{if(!xr.has(i))return console.log("no model found!"),this;i=(r?this.config.modelPath:this.config.modelPath_small)+i+this.config.PATH_END,this.config.modelPath=i}this.model=new br.SketchRNN(this.config.modelPath),this.penState=this.model.zeroInput(),this.ready=T(this.model.initialize(),n)}return A()(e,[{key:"generateInternal",value:function(){var e=k()(D.a.mark((function e(t,n){var r,i,a,o;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=+t.temperature||this.config.temperature,i=+t.pixelFactor||this.config.pixelFactor,e.next=4,this.ready;case 4:return this.rnnState||(this.rnnState=this.model.zeroState(),this.model.setPixelFactor(i)),Array.isArray(n)&&n.length&&(this.rnnState=this.model.updateStrokes(n,this.rnnState)),this.rnnState=this.model.update(this.penState,this.rnnState),a=this.model.getPDF(this.rnnState,r),this.penState=this.model.sample(a),o={dx:this.penState[0],dy:this.penState[1]},1===this.penState[2]?o.pen="down":1===this.penState[3]?o.pen="up":1===this.penState[4]&&(o.pen="end"),e.abrupt("return",o);case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"generate",value:function(){var e=k()(D.a.mark((function e(t,n,r){var i,a,o,s;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"function"==typeof t?(a={},o=[],i=t):Array.isArray(t)?(a={},o=t,i=n):"function"==typeof n?(a=t||{},o=[],i=n):(a=t||{},o=n||[],i=r),s=o.map((function(e){var t="up"===e.pen?1:0,n="down"===e.pen?1:0,r="end"===e.pen?1:0;return[e.dx,e.dy,n,t,r]})),e.abrupt("return",T(this.generateInternal(a,s),i));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"reset",value:function(){this.penState=this.model.zeroInput(),this.rnnState&&(this.rnnState=this.model.zeroState())}}]),e}(),kr=function(e,t){return new _r(e,t,!(arguments.length>2&&void 0!==arguments[2])||arguments[2])},Er={modelPath:"https://raw.githubusercontent.com/zaidalyafeai/HostedModels/master/unet-128/model.json",imageSize:128,returnTensors:!1},Sr=function(){function e(t,n,r){S()(this,e),this.modelReady=!1,this.isPredicting=!1,this.config={modelPath:void 0!==n.modelPath?n.modelPath:Er.modelPath,imageSize:void 0!==n.imageSize?n.imageSize:Er.imageSize,returnTensors:void 0!==n.returnTensors?n.returnTensors:Er.returnTensors},this.ready=T(this.loadModel(),r)}return A()(e,[{key:"loadModel",value:function(){var e=k()(D.a.mark((function e(){return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.loadLayersModel(this.config.modelPath);case 2:return this.model=e.sent,this.modelReady=!0,e.abrupt("return",this);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"segment",value:function(){var e=k()(D.a.mark((function e(t,n){var r,i;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ready;case 2:return i=n,t instanceof HTMLImageElement||t instanceof HTMLVideoElement||t instanceof HTMLCanvasElement||t instanceof ImageData?r=t:"object"===I()(t)&&(t.elt instanceof HTMLImageElement||t.elt instanceof HTMLVideoElement||t.elt instanceof HTMLCanvasElement||t.elt instanceof ImageData)?r=t.elt:"function"==typeof t&&(r=this.video,i=t),e.abrupt("return",T(this.segmentInternal(r),i));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"convertToP5Image",value:function(){var e=k()(D.a.mark((function e(t){var n,r;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ce.rawToBlob(t,this.config.imageSize,this.config.imageSize);case 2:return n=e.sent,e.next=5,ce.blobToP5Image(n);case 5:return r=e.sent,e.abrupt("return",r);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"segmentInternal",value:function(){var t=k()(D.a.mark((function t(n){var r,i,a,o,s,u,c,l,f,d,h,p,m,v,g=this;return D.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.ready;case 2:if(!(n instanceof HTMLVideoElement)){t.next=5;break}return t.next=5,x.nextFrame();case 5:return this.isPredicting=!0,r=x.tidy((function(){var e=x.browser.fromPixels(n).toFloat(),t=x.image.resizeBilinear(e,[g.config.imageSize,g.config.imageSize]).div(x.scalar(255)),r=t.expandDims(0),i=g.model.predict(r),a=x.ones([128,128,1]).tile([1,1,1]);t=t.concat(a,2);var o=i.squeeze([0]),s=(o=(o=o.tile([1,1,4])).sub(.3).sign().relu().neg().add(1)).mul(t),u=i.squeeze([0]),c=(u=(u=u.tile([1,1,4])).sub(.3).sign().relu()).mul(t),l=x.ones([128,128,1]).tile([1,1,1]).mul(255),f=i.squeeze([0]);return{featureMask:s,backgroundMask:c,segmentation:f=(f=x.cast(f.tile([1,1,3]).sub(.3).sign().relu().mul(255),"int32")).concat(l,2)}})),i=r.featureMask,a=r.backgroundMask,o=r.segmentation,this.isPredicting=!1,t.next=10,x.browser.toPixels(i);case 10:return s=t.sent,t.next=13,x.browser.toPixels(a);case 13:return u=t.sent,t.next=16,x.browser.toPixels(o);case 16:if(c=t.sent,l=fe(i),f=fe(a),d=e.dataURLtoBlob(l.src),h=e.dataURLtoBlob(f.src),!ce.checkP5()){t.next=31;break}return t.next=24,this.convertToP5Image(s);case 24:return p=t.sent,t.next=27,this.convertToP5Image(u);case 27:return m=t.sent,t.next=30,this.convertToP5Image(c);case 30:v=t.sent;case 31:return this.config.returnTensors||(i.dispose(),a.dispose(),o.dispose()),t.abrupt("return",{segmentation:c,blob:{featureMask:d,backgroundMask:h},tensor:{featureMask:i,backgroundMask:a},raw:{featureMask:s,backgroundMask:u},featureMask:p,backgroundMask:m,mask:v});case 33:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}],[{key:"dataURLtoBlob",value:function(e){for(var t=e.split(","),n=t[0].match(/:(.*?);/)[1],r=atob(t[1]),i=r.length,a=new Uint8Array(i);i;)a[i]=r.charCodeAt(i),i-=1;return new Blob([a],{type:n})}}]),e}(),Cr=function(e,t,n){var r=null,i={},a=n;return e instanceof HTMLVideoElement?r=e:"object"===I()(e)&&e.elt instanceof HTMLVideoElement?r=e.elt:"function"==typeof e?a=e:"object"===I()(e)&&(i=e),"object"===I()(t)?i=t:"function"==typeof t&&(a=t),new Sr(r,i,a)},Ar=function(){function e(t,n){var r=this;S()(this,e),this.ready=!1,this.model={},this.latentDim=x.randomUniform([1,16]);var i=t.split("manifest.json"),a=ne()(i,1)[0];R.a.get(t).then((function(e){var t=e.data;r.ready=T(r.loadCVAEModel(a+t.model),n),r.labels=t.labels,r.labelVector=Array(r.labels.length+1).fill(0)}))}return A()(e,[{key:"loadCVAEModel",value:function(){var e=k()(D.a.mark((function e(t){return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.loadLayersModel(t);case 2:return this.model=e.sent,e.abrupt("return",this);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"generate",value:function(){var e=k()(D.a.mark((function e(t,n){return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",T(this.generateInternal(t),n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadAsync",value:function(e){var t=this;return new Promise((function(n,r){t.ready||r(),loadImage(e,(function(e){n(e)}))}))}},{key:"getBlob",value:function(e){var t=this;return new Promise((function(n,r){t.ready||r(),e.toBlob((function(e){n(e)}))}))}},{key:"generateInternal",value:function(){var e=k()(D.a.mark((function e(t){var n,r,i,a,o,s,u,c,l,f,d,h,p=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=x.tidy((function(){p.latentDim=x.randomUniform([1,16]);var e=p.labels.indexOf(t);if(e<0)return console.log("Wrong input of the label!"),[void 0,void 0];p.labelVector=p.labelVector.map((function(){return 0})),p.labelVector[e+1]=1;var n=x.tensor([p.labelVector]),r=p.model.predict([p.latentDim,n]);return r.reshape([r.shape[1],r.shape[2],r.shape[3]])})),e.next=3,x.browser.toPixels(n);case 3:for(r=e.sent,n.dispose(),i=document.createElement("canvas"),a=i.getContext("2d"),o=ne()(n.shape,2),s=o[0],u=o[1],i.width=s,i.height=u,c=a.createImageData(s,u),l=c.data,f=0;f<s*u*4;f+=1)l[f]=r[f];return a.putImageData(c,0,0),e.t0=URL,e.next=17,this.getBlob(i);case 17:if(e.t1=e.sent,d=e.t0.createObjectURL.call(e.t0,e.t1),!ce.checkP5()){e.next=23;break}return e.next=22,this.loadAsync(d);case 22:h=e.sent;case 23:return e.abrupt("return",{src:d,raws:r,image:h});case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),Or=function(e,t){return new Ar(e,t)},Dr=function(){function e(t,n,r){S()(this,e),this.model={},this.modelPath=t,this.modelInfo={},this.modelPathPrefix="",this.modelReady=!1,this.config={returnTensors:n.returnTensors||!1},this.ready=T(this.loadModel(),r)}return A()(e,[{key:"loadModel",value:function(){var e=k()(D.a.mark((function e(){var t,n,r,i,a,o;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R.a.get(this.modelPath);case 2:return t=e.sent,n=t.data,this.modelInfo=n,r=this.modelPath.split("manifest.json"),i=ne()(r,1),a=i[0],o=this.isAbsoluteURL(a)?this.modelInfo.model:this.modelPathPrefix+this.modelInfo.model,e.next=9,x.loadLayersModel(o);case 9:return this.model=e.sent,this.modelReady=!0,e.abrupt("return",this);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"generate",value:function(){var e=k()(D.a.mark((function e(t,n){return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ready;case 2:return e.abrupt("return",T(this.generateInternal(n),t));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"compute",value:function(){var e=k()(D.a.mark((function e(t,n){var r,i=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=x.tidy((function(){var e;if(!1===Array.isArray(n))e=x.randomNormal([1,t]);else{for(var r=x.buffer([1,t]),a=0;a<t;a+=1)r.set(n[a],0,a);e=r.toTensor()}return i.model.predict(e).squeeze().transpose([1,2,0]).div(x.scalar(2)).add(x.scalar(.5))})),e.abrupt("return",r);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"generateInternal",value:function(){var e=k()(D.a.mark((function e(t){var n,r,i,a,o,s,u,c,l;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.modelInfo.modelLatentDim,e.next=3,this.compute(n,t);case 3:return r=e.sent,e.next=6,x.browser.toPixels(r);case 6:return i=e.sent,a=ne()(r.shape,2),o=a[0],s=a[1],e.next=10,ce.rawToBlob(i,s,o);case 10:if(u=e.sent,!ce.checkP5()){e.next=15;break}return e.next=14,ce.blobToP5Image(u);case 14:c=e.sent;case 15:return(l={}).blob=u,l.raw=i,ce.checkP5()&&(l.image=c),this.config.returnTensors?l.tensor=r:(l.tensor=null,r.dispose()),e.abrupt("return",l);case 21:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"isAbsoluteURL",value:function(e){return!!new RegExp("^(?:[a-z]+:)?//","i").test(e)}}]),e}(),Tr=function(e,t,n){var r,i={};if("string"!=typeof e)throw new Error('Please specify a path to a "manifest.json" file: \n\n         "models/face/manifest.json" \n\n\n         This "manifest.json" file should include:\n\n         {\n            "description": "DCGAN, human faces, 64x64",\n            "model": "https://raw.githubusercontent.com/viztopia/ml5dcgan/master/model/model.json", // "https://github.com/viztopia/ml5dcgan/blob/master/model/model.json",\n            "modelSize": 64,\n            "modelLatentDim": 128 \n         }\n         ');"function"==typeof t?r=t:"object"===I()(t)&&(i=t,r=n);var a=new Dr(e,i,r);return r?a:a.ready},jr=n(30),Mr=n.n(jr),Fr=n(132),Ir=0,Nr=function(){function e(t,n){S()(this,e),this.ready=T(this.loadModel(t),n)}return A()(e,[{key:"loadModel",value:function(){var e=k()(D.a.mark((function e(t){var n,r,i,a;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n={model:null,metadata:null},"moviereviews"!==t.toLowerCase()){e.next=6;break}n.model="https://storage.googleapis.com/tfjs-models/tfjs/sentiment_cnn_v1/model.json",n.metadata="https://storage.googleapis.com/tfjs-models/tfjs/sentiment_cnn_v1/metadata.json",e.next=14;break;case 6:if(!0!==Tt.isAbsoluteURL(t)){e.next=12;break}r=Tt.getModelPath(t),n.model="".concat(r,"/model.json"),n.metadata="".concat(r,"/metadata.json"),e.next=14;break;case 12:return console.error("problem loading model"),e.abrupt("return",this);case 14:return e.next=16,x.loadLayersModel(n.model);case 16:return this.model=e.sent,e.next=19,R.a.get(n.metadata);case 19:return i=e.sent,a=i.data,this.indexFrom=a.index_from,this.maxLen=a.max_len,this.wordIndex=a.word_index,this.vocabularySize=a.vocabulary_size,e.abrupt("return",this);case 26:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"predict",value:function(e){var t=this,n=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"pre",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"pre",i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Ir;return e.map((function(e){if(e.length>t&&("pre"===r?e.splice(0,e.length-t):e.splice(t,e.length-t)),e.length<t){for(var a=[],o=0;o<t-e.length;o+=1)a.push(i);e="pre"===n?a.concat(e):e.concat(a)}return e}))}([e.trim().toLowerCase().replace(/[.,?!]/g,"").split(" ").map((function(e){var n=t.wordIndex[e]+t.indexFrom;return n>t.vocabularySize&&(n=2),n}))],this.maxLen),r=x.tensor2d(n,[1,this.maxLen]),i=this.model.predict(r),a=i.dataSync()[0];return i.dispose(),r.dispose(),{score:a}}}]),e}(),Rr=function(e,t){return new Nr(e,t)};function Pr(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))}function Br(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}var Lr=[["conv2d",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1]],zr=[8,16,32];function Ur(e){B.util.assert("number"==typeof e,(function(){return"outputStride is not a number"})),B.util.assert(zr.indexOf(e)>=0,(function(){return"outputStride of "+e+" is invalid. It must be either 8, 16, or 32"}))}var Wr={100:[["conv2d",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",2],["separableConv",1]],75:[["conv2d",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1]],50:Lr,25:Lr},Vr=function(){function e(e,t){this.PREPROCESS_DIVISOR=Object(B.scalar)(127.5),this.ONE=Object(B.scalar)(1),this.modelWeights=e,this.convolutionDefinitions=t}return e.prototype.predict=function(e,t){var n=this,r=Object(B.div)(e.toFloat(),this.PREPROCESS_DIVISOR),i=Object(B.sub)(r,this.ONE);return function(e,t){var n=1,r=1;return e.map((function(e,i){var a,o,s=e[0],u=e[1];return n===t?(a=1,o=r,r*=u):(a=u,o=1,n*=u),{blockId:i,convType:s,stride:a,rate:o,outputStride:n}}))}(this.convolutionDefinitions,t).reduce((function(e,t){var r=t.blockId,i=t.stride,a=t.convType,o=t.rate;if("conv2d"===a)return n.conv(e,i,r);if("separableConv"===a)return n.separableConv(e,i,r,o);throw Error("Unknown conv type of "+a)}),i)},e.prototype.convToOutput=function(e,t){return e.conv2d(this.weights(t),1,"same").add(this.convBias(t,!1))},e.prototype.conv=function(e,t,n){var r=this.weights("Conv2d_"+String(n));return e.conv2d(r,t,"same").add(this.convBias("Conv2d_"+String(n))).clipByValue(0,6)},e.prototype.separableConv=function(e,t,n,r){void 0===r&&(r=1);var i="Conv2d_"+String(n)+"_depthwise",a="Conv2d_"+String(n)+"_pointwise";return e.depthwiseConv2D(this.depthwiseWeights(i),t,"same","NHWC",r).add(this.depthwiseBias(i)).clipByValue(0,6).conv2d(this.weights(a),[1,1],"same").add(this.convBias(a)).clipByValue(0,6)},e.prototype.weights=function(e){return this.modelWeights.weights(e)},e.prototype.convBias=function(e,t){return void 0===t&&(t=!0),this.modelWeights.convBias(e,t)},e.prototype.depthwiseBias=function(e){return this.modelWeights.depthwiseBias(e)},e.prototype.depthwiseWeights=function(e){return this.modelWeights.depthwiseWeights(e)},e.prototype.dispose=function(){this.modelWeights.dispose()},e}(),Gr="https://storage.googleapis.com/tfjs-models/savedmodel/",qr={1:{url:Gr+"posenet_mobilenet_100_partmap/",architecture:Wr[100]},.75:{url:Gr+"posenet_mobilenet_075_partmap/",architecture:Wr[75]},.5:{url:Gr+"posenet_mobilenet_050_partmap/",architecture:Wr[50]},.25:{url:Gr+"posenet_mobilenet_025_partmap/",architecture:Wr[25]}};function Hr(e,t){return Object(B.tidy)((function(){return e.greater(Object(B.scalar)(t)).toInt()}))}function Xr(e,t){var n=t.shape,r=n[0],i=n[1],a=n[2];return Object(B.tidy)((function(){var n=function(e){var t=e.shape[2],n=e.argMax(2).reshape([-1]);return Object(B.oneHot)(n,t)}(t),o=Object(B.range)(0,a,1,"int32").expandDims(1);return function(e,t){return e.mul(t)}(n.matMul(o).toInt().reshape([r,i]).add(Object(B.scalar)(1,"int32")),e).sub(Object(B.scalar)(1,"int32"))}))}var Kr=function(){function e(e){this.graphModel=e}return e.prototype.weights=function(e){return this.getVariable("MobilenetV1/"+e+"/weights")},e.prototype.convBias=function(e,t){return void 0===t&&(t=!0),this.getVariable("MobilenetV1/"+e+"/Conv2D_bias")},e.prototype.depthwiseBias=function(e){return this.getVariable("MobilenetV1/"+e+"/depthwise_bias")},e.prototype.depthwiseWeights=function(e){return this.getVariable("MobilenetV1/"+e+"/depthwise_weights")},e.prototype.getVariable=function(e){return this.graphModel.weights[""+e][0]},e.prototype.dispose=function(){this.graphModel.dispose()},e}();function Yr(e){return e instanceof B.Tensor?e:B.browser.fromPixels(e)}function $r(e,t,n){var r=t[0],i=t[1];void 0===n&&(n=!1);var a,o,s,u,c,l,f=e.shape,d=f[0],h=f[1]/d;if(h>i/r){a=i;var p=r-(o=Math.ceil(a/h));s=0,u=0,c=Math.floor(p/2),l=r-(o+c)}else{o=r;var m=i-(a=Math.ceil(r*h));s=Math.floor(m/2),u=i-(a+s),c=0,l=0}return{resizedAndPadded:Object(B.tidy)((function(){var t;return t=n?e.reverse(1).resizeBilinear([o,a]):e.resizeBilinear([o,a]),Object(B.pad3d)(t,[[c,l],[s,u],[0,0]])})),paddedBy:[[c,l],[s,u]]}}function Jr(e,t,n,r){var i=t[0],a=t[1],o=n[0],s=n[1],u=r[0],c=u[0],l=u[1],f=r[1],d=f[0],h=f[1];return Object(B.tidy)((function(){return function(e,t,n){var r=t[0],i=t[1],a=n[0],o=a[0],s=a[1],u=n[1],c=u[0],l=u[1],f=e.shape,d=f[0],h=f[1],p=d-(o+s),m=h-(c+l);return Object(B.tidy)((function(){return Object(B.slice3d)(e,[o,c,0],[p,m,e.shape[2]]).resizeBilinear([r,i],!0)}))}(e.resizeBilinear([o,s],!0),[i,a],[[c,l],[d,h]])}))}var Zr=[353,257],Qr=function(){function e(e){this.mobileNet=e}return e.prototype.predictForSegmentation=function(e,t){var n=this;return void 0===t&&(t=16),Ur(t),Object(B.tidy)((function(){var r=n.mobileNet.predict(e,t);return n.mobileNet.convToOutput(r,"segment_2").sigmoid()}))},e.prototype.predictForPartMap=function(e,t){var n=this;return void 0===t&&(t=16),Ur(t),Object(B.tidy)((function(){var r=n.mobileNet.predict(e,t),i=n.mobileNet.convToOutput(r,"segment_2"),a=n.mobileNet.convToOutput(r,"part_heatmap_2");return{segmentScores:i.sigmoid(),partHeatmapScores:a.sigmoid()}}))},e.prototype.estimatePersonSegmentationActivation=function(e,t,n){var r=this;return void 0===t&&(t=16),void 0===n&&(n=.5),Ur(t),Object(B.tidy)((function(){var i=Yr(e),a=$r(i,Zr),o=a.resizedAndPadded,s=a.paddedBy,u=r.predictForSegmentation(o,t),c=o.shape,l=c[0],f=c[1],d=i.shape;return Hr(Jr(u,[d[0],d[1]],[l,f],s).squeeze(),n)}))},e.prototype.estimatePersonSegmentation=function(e,t,n){return void 0===t&&(t=16),void 0===n&&(n=.5),Pr(this,void 0,void 0,(function(){var r,i,a,o,s;return Br(this,(function(u){switch(u.label){case 0:return r=this.estimatePersonSegmentationActivation(e,t,n),i=r.shape,a=i[0],o=i[1],[4,r.data()];case 1:return s=u.sent(),r.dispose(),[2,{height:a,width:o,data:s}]}}))}))},e.prototype.estimatePartSegmentationActivation=function(e,t,n){var r=this;return void 0===t&&(t=16),void 0===n&&(n=.5),Ur(t),Object(B.tidy)((function(){var i=Yr(e),a=$r(i,Zr),o=a.resizedAndPadded,s=a.paddedBy,u=r.predictForPartMap(o,t),c=u.segmentScores,l=u.partHeatmapScores,f=o.shape,d=f[0],h=f[1],p=i.shape,m=p[0],v=p[1],g=Jr(c,[m,v],[d,h],s),y=Jr(l,[m,v],[d,h],s);return Xr(Hr(g.squeeze(),n),y)}))},e.prototype.estimatePartSegmentation=function(e,t,n){return void 0===t&&(t=16),void 0===n&&(n=.5),Pr(this,void 0,void 0,(function(){var r,i,a,o,s;return Br(this,(function(u){switch(u.label){case 0:return r=this.estimatePartSegmentationActivation(e,t,n),i=r.shape,a=i[0],o=i[1],[4,r.data()];case 1:return s=u.sent(),r.dispose(),[2,{height:a,width:o,data:s}]}}))}))},e.prototype.dispose=function(){this.mobileNet.dispose()},e}();function ei(e){return void 0===e&&(e=.75),Pr(this,void 0,void 0,(function(){var t,n;return Br(this,(function(r){switch(r.label){case 0:if(null==B)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this model.");return t=Object.keys(qr),B.util.assert("number"==typeof e,(function(){return"got multiplier type of "+typeof e+" when it should be a number."})),B.util.assert(t.indexOf(e.toString())>=0,(function(){return"invalid multiplier value of "+e+".  No checkpoint exists for that multiplier. Must be one of "+t.join(",")+"."})),[4,ti.load(e)];case 1:return n=r.sent(),[2,new Qr(n)]}}))}))}var ti={load:function(e){return Pr(void 0,void 0,void 0,(function(){var t,n,r,i;return Br(this,(function(a){switch(a.label){case 0:return t=qr[e],n=t.url,[4,Object(P.loadGraphModel)(n+"model.json")];case 1:return r=a.sent(),i=new Kr(r),[2,new Vr(i,t.architecture)]}}))}))}};function ni(e,t){void 0===t&&(t=!0);for(var n=e.width,r=e.height,i=e.data,a=new Uint8ClampedArray(n*r*4),o=0;o<r*n;++o){var s=255*(t?1-i[o]:i[o]),u=4*o;a[u+0]=0,a[u+1]=0,a[u+2]=0,a[u+3]=Math.round(s)}return new ImageData(a,n,r)}function ri(e,t){for(var n=e.width,r=e.height,i=e.data,a=new Uint8ClampedArray(n*r*4),o=0;o<r*n;++o){var s=Math.round(i[o]),u=4*o;if(-1===s)a[u+0]=255,a[u+1]=255,a[u+2]=255,a[u+3]=255;else{var c=t[s];if(!c)throw new Error("No color could be found for part id "+s);a[u+0]=c[0],a[u+1]=c[1],a[u+2]=c[2],a[u+3]=255}}return new ImageData(a,n,r)}var ii={multiplier:.75,outputStride:16,segmentationThreshold:.5,palette:{leftFace:{id:0,color:[110,64,170]},rightFace:{id:1,color:[106,72,183]},rightUpperLegFront:{id:2,color:[100,81,196]},rightLowerLegBack:{id:3,color:[92,91,206]},rightUpperLegBack:{id:4,color:[84,101,214]},leftLowerLegFront:{id:5,color:[75,113,221]},leftUpperLegFront:{id:6,color:[66,125,224]},leftUpperLegBack:{id:7,color:[56,138,226]},leftLowerLegBack:{id:8,color:[48,150,224]},rightFeet:{id:9,color:[40,163,220]},rightLowerLegFront:{id:10,color:[33,176,214]},leftFeet:{id:11,color:[29,188,205]},torsoFront:{id:12,color:[26,199,194]},torsoBack:{id:13,color:[26,210,182]},rightUpperArmFront:{id:14,color:[28,219,169]},rightUpperArmBack:{id:15,color:[33,227,155]},rightLowerArmBack:{id:16,color:[41,234,141]},leftLowerArmFront:{id:17,color:[51,240,128]},leftUpperArmFront:{id:18,color:[64,243,116]},leftUpperArmBack:{id:19,color:[79,246,105]},leftLowerArmBack:{id:20,color:[96,247,97]},rightHand:{id:21,color:[115,246,91]},rightLowerArmFront:{id:22,color:[134,245,88]},leftHand:{id:23,color:[155,243,88]}},returnTensors:!1},ai=function(){function e(t,n,r){S()(this,e),this.video=t,this.model=null,this.modelReady=!1,this.modelPath="",this.config={multiplier:n.multiplier||ii.multiplier,outputStride:n.outputStride||ii.outputStride,segmentationThreshold:n.segmentationThreshold||ii.segmentationThreshold,palette:n.palette||ii.palette,returnTensors:n.returnTensors||ii.returnTensors},this.ready=T(this.loadModel(),r)}return A()(e,[{key:"loadModel",value:function(){var e=k()(D.a.mark((function e(){return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ei(this.config.multiplier);case 2:return this.model=e.sent,this.modelReady=!0,e.abrupt("return",this);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"p5Color2RGB",value:function(e){var t=/\(([^)]+)\)/.exec(e.toString("rgb"))[1].split(","),n=ne()(t,3);return[n[0],n[1],n[2]]}},{key:"convertToP5Image",value:function(){var e=k()(D.a.mark((function e(t,n,r){var i,a;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ce.rawToBlob(t,n,r);case 2:return i=e.sent,e.next=5,ce.blobToP5Image(i);case 5:return a=e.sent,e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"bodyPartsSpec",value:function(e){var t=this,n=void 0!==e||Object.keys(e).length>=24?e:this.config.palette,r=ce.p5Instance;return r&&void 0!==n&&Object.keys(n).length>=24&&Object.keys(n).forEach((function(e){n[e].color instanceof r.Color&&(n[e].color=t.p5Color2RGB(n[e].color))})),n}},{key:"segmentWithPartsInternal",value:function(){var e=k()(D.a.mark((function e(t,n){var r,i,a,o,s,u,c,l,f,d,h,p=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ready;case 2:return e.next=4,x.nextFrame();case 4:if(!this.video||0!==this.video.readyState){e.next=7;break}return e.next=7,new Promise((function(e){p.video.onloadeddata=function(){return e()}}));case 7:return this.config.palette=n.palette||this.config.palette,this.config.outputStride=n.outputStride||this.config.outputStride,this.config.segmentationThreshold=n.segmentationThreshold||this.config.segmentationThreshold,e.next=12,this.model.estimatePartSegmentation(t,this.config.outputStride,this.config.segmentationThreshold);case 12:return r=e.sent,i=this.bodyPartsSpec(this.config.palette),a=Object.keys(i).map((function(e){return i[e].color})),(o={segmentation:r,raw:{personMask:null,backgroundMask:null,partMask:null},tensor:{personMask:null,backgroundMask:null,partMask:null},personMask:null,backgroundMask:null,partMask:null,bodyParts:i}).raw.backgroundMask=ni(r,!0),o.raw.personMask=ni(r,!1),o.raw.partMask=ri(r,a),s=x.tidy((function(){var e=x.browser.fromPixels(t),n=x.ones([r.height,r.width,1]).tile([1,1,1]).mul(255);e=e.concat(n,2);var i=x.tensor(r.data,[r.height,r.width,1]),a=x.tensor(r.data,[r.height,r.width,1]),s=x.tensor(Mr()(o.raw.partMask.data),[r.height,r.width,4]);return{personMask:i=x.cast(i.add(.2).sign().relu().mul(e),"int32"),backgroundMask:a=x.cast(a.add(.2).sign().neg().relu().mul(e),"int32"),partMask:s=x.cast(s,"int32")}})),u=s.personMask,c=s.backgroundMask,l=s.partMask,e.next=22,x.browser.toPixels(u);case 22:return f=e.sent,e.next=25,x.browser.toPixels(c);case 25:return d=e.sent,e.next=28,x.browser.toPixels(l);case 28:if(h=e.sent,o.personMask=f,o.backgroundMask=d,o.partMask=h,!ce.checkP5()){e.next=42;break}return e.next=35,this.convertToP5Image(f,r.width,r.height);case 35:return o.personMask=e.sent,e.next=38,this.convertToP5Image(d,r.width,r.height);case 38:return o.backgroundMask=e.sent,e.next=41,this.convertToP5Image(h,r.width,r.height);case 41:o.partMask=e.sent;case 42:return this.config.returnTensors?(o.tensor.personMask=u,o.tensor.backgroundMask=c,o.tensor.partMask=l):(u.dispose(),c.dispose(),l.dispose()),e.abrupt("return",o);case 44:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"segmentWithParts",value:function(){var e=k()(D.a.mark((function e(t,n,r){var i,a,o;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.video,o=this.config,"function"!=typeof t){e.next=7;break}i=this.video,a=t,e.next=25;break;case 7:if(!(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData)){e.next=11;break}i=t,e.next=25;break;case 11:if("object"!==I()(t)||!(t.elt instanceof HTMLImageElement||t.elt instanceof HTMLCanvasElement||t.elt instanceof ImageData)){e.next=15;break}i=t.elt,e.next=25;break;case 15:if(!("object"===I()(t)&&t.canvas instanceof HTMLCanvasElement)){e.next=19;break}i=t.canvas,e.next=25;break;case 19:if(!("object"===I()(t)&&t.elt instanceof HTMLVideoElement)){e.next=23;break}i=t.elt,e.next=25;break;case 23:if(this.video instanceof HTMLVideoElement){e.next=25;break}throw new Error("No input image provided. If you want to classify a video, pass the video element in the constructor. ");case 25:return"object"===I()(n)?o=n:"function"==typeof n&&(a=n),"function"==typeof r&&(a=r),e.abrupt("return",T(this.segmentWithPartsInternal(i,o),a));case 28:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"segmentInternal",value:function(){var e=k()(D.a.mark((function e(t,n){var r,i,a,o,s,u,c,l=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ready;case 2:return e.next=4,x.nextFrame();case 4:if(!this.video||0!==this.video.readyState){e.next=7;break}return e.next=7,new Promise((function(e){l.video.onloadeddata=function(){return e()}}));case 7:return this.config.outputStride=n.outputStride||this.config.outputStride,this.config.segmentationThreshold=n.segmentationThreshold||this.config.segmentationThreshold,e.next=11,this.model.estimatePersonSegmentation(t,this.config.outputStride,this.config.segmentationThreshold);case 11:return r=e.sent,(i={segmentation:r,raw:{personMask:null,backgroundMask:null},tensor:{personMask:null,backgroundMask:null},personMask:null,backgroundMask:null}).raw.backgroundMask=ni(r,!0),i.raw.personMask=ni(r,!1),a=x.tidy((function(){var e=x.browser.fromPixels(t),n=x.ones([r.height,r.width,1]).tile([1,1,1]).mul(255);e=e.concat(n,2);var i=x.tensor(r.data,[r.height,r.width,1]),a=x.tensor(r.data,[r.height,r.width,1]);return{personMask:i=x.cast(i.neg().add(1).mul(e),"int32"),backgroundMask:a=x.cast(a.mul(e),"int32")}})),o=a.personMask,s=a.backgroundMask,e.next=18,x.browser.toPixels(o);case 18:return u=e.sent,e.next=21,x.browser.toPixels(s);case 21:if(c=e.sent,!ce.checkP5()){e.next=31;break}return e.next=25,this.convertToP5Image(u,r.width,r.height);case 25:return i.personMask=e.sent,e.next=28,this.convertToP5Image(c,r.width,r.height);case 28:i.backgroundMask=e.sent,e.next=33;break;case 31:i.personMask=u,i.backgroundMask=c;case 33:return this.config.returnTensors?(i.tensor.personMask=o,i.tensor.backgroundMask=s):(o.dispose(),s.dispose()),e.abrupt("return",i);case 35:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"segment",value:function(){var e=k()(D.a.mark((function e(t,n,r){var i,a,o;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.video,o=this.config,"function"!=typeof t){e.next=7;break}i=this.video,a=t,e.next=25;break;case 7:if(!(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData)){e.next=11;break}i=t,e.next=25;break;case 11:if("object"!==I()(t)||!(t.elt instanceof HTMLImageElement||t.elt instanceof HTMLCanvasElement||t.elt instanceof ImageData)){e.next=15;break}i=t.elt,e.next=25;break;case 15:if(!("object"===I()(t)&&t.canvas instanceof HTMLCanvasElement)){e.next=19;break}i=t.canvas,e.next=25;break;case 19:if(!("object"===I()(t)&&t.elt instanceof HTMLVideoElement)){e.next=23;break}i=t.elt,e.next=25;break;case 23:if(this.video instanceof HTMLVideoElement){e.next=25;break}throw new Error("No input image provided. If you want to classify a video, pass the video element in the constructor. ");case 25:return"object"===I()(n)?o=n:"function"==typeof n&&(a=n),"function"==typeof r&&(a=r),e.abrupt("return",T(this.segmentInternal(i,o),a));case 28:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),e}(),oi=function(e,t,n){var r,i={},a=n;e instanceof HTMLVideoElement?r=e:"object"===I()(e)&&e.elt instanceof HTMLVideoElement?r=e.elt:"object"===I()(e)?i=e:"function"==typeof e&&(a=e),"object"===I()(t)?i=t:"function"==typeof t&&(a=t);var o=new ai(r,i,a);return a?o:o.ready},si=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Math.random()*(t-e)+e},ui=function(){var e,t,n,r,i,a,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(a)e=t,a=!1;else{do{i=(n=si(0,2)-1)*n+(r=si(0,2)-1)*r}while(i>=1);e=n*(i=Math.sqrt(-2*Math.log(i)/i)),t=r*i,a=!0}return e*s+o},ci=function(e,t){var n;if(!0===(arguments.length>2&&void 0!==arguments[2]&&arguments[2]))n=Array.from({length:t},(function(){return e[Math.floor(Math.random()*e.length)]}));else{if(t>e.length)throw new RangeError("Sample size must be less than or equal to array length when sampling without replacement.");n=e.map((function(e){return[e,Math.random()]})).sort((function(e,t){return e[1]<t[1]?-1:1})).slice(0,t).map((function(e){return e[0]}))}return n},li=function(){function e(){S()(this,e),this.isTrained=!1,this.isCompiled=!1,this.isLayered=!1,this.model=null,this.init=this.init.bind(this),this.createModel=this.createModel.bind(this),this.addLayer=this.addLayer.bind(this),this.compile=this.compile.bind(this),this.setOptimizerFunction=this.setOptimizerFunction.bind(this),this.train=this.train.bind(this),this.trainInternal=this.trainInternal.bind(this),this.predict=this.predict.bind(this),this.classify=this.classify.bind(this),this.save=this.save.bind(this),this.load=this.load.bind(this),this.init()}return A()(e,[{key:"init",value:function(){this.createModel()}},{key:"createModel",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"sequential").toLowerCase(),this.model=x.sequential(),this.model}},{key:"addLayer",value:function(e){var t=e||{};this.model.add(t),this.model.layers.length>=2&&(this.isLayered=!0)}},{key:"compile",value:function(e){this.model.compile(e),this.isCompiled=!0}},{key:"setOptimizerFunction",value:function(e,t){return t.call(this,e)}},{key:"train",value:function(e,t){return T(this.trainInternal(e),t)}},{key:"trainInternal",value:function(){var e=k()(D.a.mark((function e(t){var n,r,i,a,o,s,u,c;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n=t).inputs,i=n.outputs,a=n.batchSize,o=n.epochs,s=n.shuffle,u=n.validationSplit,c=n.whileTraining,e.next=6,this.model.fit(r,i,{batchSize:a,epochs:o,shuffle:s,validationSplit:u,callbacks:c});case 6:r.dispose(),i.dispose(),this.isTrained=!0;case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"predictSync",value:function(e){var t=this,n=x.tidy((function(){return t.model.predict(e)})),r=n.arraySync();return n.dispose(),e.dispose(),r}},{key:"predict",value:function(){var e=k()(D.a.mark((function e(t){var n,r,i=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=x.tidy((function(){return i.model.predict(t)})),e.next=3,n.array();case 3:return r=e.sent,n.dispose(),t.dispose(),e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"classify",value:function(){var e=k()(D.a.mark((function e(t){return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.predict(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"classifySync",value:function(e){return this.predictSync(e)}},{key:"save",value:function(){var e=k()(D.a.mark((function e(t,n){var r,i,a=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"function"==typeof t?(r="model",i=t):"string"==typeof t?(r=t,"function"==typeof n&&(i=n)):r="model",this.model.save(x.io.withSaveHandler(function(){var e=k()(D.a.mark((function e(t){return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.weightsManifest={modelTopology:t.modelTopology,weightsManifest:[{paths:["./".concat(r,".weights.bin")],weights:t.weightSpecs}]},e.next=3,ut(t.weightData,"".concat(r,".weights.bin"),"application/octet-stream");case 3:return e.next=5,ut(JSON.stringify(a.weightsManifest),"".concat(r,".json"),"text/plain");case 5:i&&i();case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=k()(D.a.mark((function e(){var t,n,r,i,a,o,s,u,c,l,f,d=arguments;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=d.length>0&&void 0!==d[0]?d[0]:null,n=d.length>1?d[1]:void 0,!(t instanceof FileList)){e.next=13;break}return e.next=5,Promise.all(Array.from(t).map(function(){var e=k()(D.a.mark((function e(t){var n;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.name.includes(".json")||t.name.includes("_meta")){e.next=4;break}return e.abrupt("return",{name:"model",file:t});case 4:if(!t.name.includes(".json")||!t.name.includes("_meta.json")){e.next=11;break}return e.next=7,t.text();case 7:return n=e.sent,e.abrupt("return",{name:"metadata",file:n});case 11:if(!t.name.includes(".bin")){e.next=13;break}return e.abrupt("return",{name:"weights",file:t});case 13:return e.abrupt("return",{name:null,file:null});case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 5:return r=e.sent,i=r.find((function(e){return"model"===e.name})).file,a=r.find((function(e){return"weights"===e.name})).file,e.next=10,x.loadLayersModel(x.io.browserFiles([i,a]));case 10:this.model=e.sent,e.next=32;break;case 13:if(!(t instanceof Object)){e.next=29;break}return e.next=16,R.a.get(t.model,{responseType:"text"});case 16:return o=e.sent,s=JSON.stringify(o.data),u=new File([s],"model.json",{type:"application/json"}),e.next=21,R.a.get(t.weights,{responseType:"blob"});case 21:return c=e.sent,l=c.data,f=new File([l],"model.weights.bin",{type:"application/macbinary"}),e.next=26,x.loadLayersModel(x.io.browserFiles([u,f]));case 26:this.model=e.sent,e.next=32;break;case 29:return e.next=31,x.loadLayersModel(t);case 31:this.model=e.sent;case 32:return this.isCompiled=!0,this.isLayered=!0,this.isTrained=!0,n&&n(),e.abrupt("return",this.model);case 37:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dispose",value:function(){this.model.dispose()}},{key:"mutate",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.1,n=arguments.length>1?arguments[1]:void 0;x.tidy((function(){for(var r=e.model.getWeights(),i=[],a=0;a<r.length;a+=1){for(var o=r[a],s=r[a].shape,u=o.dataSync().slice(),c=0;c<u.length;c+=1)Math.random()<t&&(u[c]=n?n(u[c]):Math.min(Math.max(u[c]+ui(),-1),1));var l=x.tensor(u,s);i[a]=l}e.model.setWeights(i)}))}},{key:"crossover",value:function(e){var t=this;return x.tidy((function(){for(var n=t.model.getWeights(),r=e.model.getWeights(),i=[],a=0;a<n.length;a+=1){for(var o=n[a],s=r[a],u=n[a].shape,c=o.dataSync().slice(),l=s.dataSync().slice(),f=0;f<c.length;f+=1)Math.random()<.5&&(c[f]=l[f]);var d=x.tensor(c,u);i[a]=d}t.model.setWeights(i)}))}}]),e}();function fi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function di(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fi(Object(n),!0).forEach((function(t){b()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var hi=new(function(){function e(t){S()(this,e),this.options=t||{}}return A()(e,[{key:"normalizeValue",value:function(e,t,n){return(e-t)/(n-t)}},{key:"unnormalizeValue",value:function(e,t,n){return e*(n-t)+t}},{key:"getMin",value:function(e){return e.reduce((function(e,t){return Math.min(e,t)}))}},{key:"getMax",value:function(e){return e.reduce((function(e,t){return Math.max(e,t)}))}},{key:"isJsonOrString",value:function(e){try{JSON.parse(e)}catch(e){return!1}return!0}},{key:"zipArrays",value:function(e,t){return e.length!==t.length?(console.error("arrays do not have the same length"),[]):Mr()(new Array(e.length).fill(null)).map((function(n,r){return di(di({},e[r]),t[r])}))}},{key:"createLabelsFromArrayValues",value:function(e,t){var n;return Array.isArray(e)&&(n=e.map((function(e,n){return"".concat(t,"_").concat(n)}))),n}},{key:"formatDataAsObject",value:function(e,t){var n={};if(Array.isArray(e))return e.forEach((function(e,r){var i=t[r];n[i]=e})),n;if("object"===I()(e))return n=e;throw new Error("input provided is not supported or does not match your output label specifications")}},{key:"getDataType",value:function(e){var t=I()(e);return"object"===t&&Array.isArray(e)&&(t="array"),t}}]),e}());function pi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function mi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pi(Object(n),!0).forEach((function(t){b()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var vi=function(){function e(){S()(this,e),this.meta={inputUnits:null,outputUnits:null,inputs:{},outputs:{},isNormalized:!1},this.isMetadataReady=!1,this.isWarmedUp=!1,this.data={raw:[]},this.createMetadata=this.createMetadata.bind(this),this.getDataStats=this.getDataStats.bind(this),this.getInputMetaStats=this.getInputMetaStats.bind(this),this.getDataUnits=this.getDataUnits.bind(this),this.getInputMetaUnits=this.getInputMetaUnits.bind(this),this.getDTypesFromData=this.getDTypesFromData.bind(this),this.addData=this.addData.bind(this),this.convertRawToTensors=this.convertRawToTensors.bind(this),this.normalizeDataRaw=this.normalizeDataRaw.bind(this),this.normalizeInputData=this.normalizeInputData.bind(this),this.normalizeArray=this.normalizeArray.bind(this),this.unnormalizeArray=this.unnormalizeArray.bind(this),this.applyOneHotEncodingsToDataRaw=this.applyOneHotEncodingsToDataRaw.bind(this),this.getDataOneHot=this.getDataOneHot.bind(this),this.getInputMetaOneHot=this.getInputMetaOneHot.bind(this),this.createOneHotEncodings=this.createOneHotEncodings.bind(this),this.loadDataFromUrl=this.loadDataFromUrl.bind(this),this.loadJSON=this.loadJSON.bind(this),this.loadCSV=this.loadCSV.bind(this),this.loadBlob=this.loadBlob.bind(this),this.loadData=this.loadData.bind(this),this.saveData=this.saveData.bind(this),this.saveMeta=this.saveMeta.bind(this),this.loadMeta=this.loadMeta.bind(this),this.findEntries=this.findEntries.bind(this),this.formatRawData=this.formatRawData.bind(this),this.csvToJSON=this.csvToJSON.bind(this)}return A()(e,[{key:"createMetadata",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.getDTypesFromData(e),this.getDataStats(e),this.getDataOneHot(e),this.getDataUnits(e,t),this.isMetadataReady=!0,mi({},this.meta)}},{key:"getDataStats",value:function(e){var t=Object.assign({},this.meta),n=this.getInputMetaStats(e,t.inputs,"xs"),r=this.getInputMetaStats(e,t.outputs,"ys");return t.inputs=n,t.outputs=r,this.meta=mi(mi({},this.meta),t),t}},{key:"getInputMetaStats",value:function(e,t,n){var r=Object.assign({},t);return Object.keys(r).forEach((function(t){if("string"===r[t].dtype)r[t].min=0,r[t].max=1;else if("number"===r[t].dtype){var i=e.map((function(e){return e[n][t]}));r[t].min=hi.getMin(i),r[t].max=hi.getMax(i)}else if("array"===r[t].dtype){var a=e.map((function(e){return e[n][t]})).flat();r[t].min=hi.getMin(a),r[t].max=hi.getMax(a)}})),r}},{key:"getDataUnits",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=null!==n?n:void 0,i=Object.assign({},this.meta);t=r||[this.getInputMetaUnits(e,i.inputs)].flat();var a=this.getInputMetaUnits(e,i.outputs);return i.inputUnits=t,i.outputUnits=a,this.meta=mi(mi({},this.meta),i),i}},{key:"getInputMetaUnits",value:function(e,t){var n=0,r=Object.assign({},t);return Object.entries(r).forEach((function(e){var t=e[1].dtype;if("number"===t)n+=1;else if("string"===t){var r=e[1].uniqueValues.length;n+=r}else"array"===t&&(n=[])})),n}},{key:"getDTypesFromData",value:function(e){var t=mi(mi({},this.meta),{},{inputs:{},outputs:{}}),n=e[0],r=Object.keys(n.xs),i=Object.keys(n.ys);return r.forEach((function(e){t.inputs[e]={dtype:hi.getDataType(n.xs[e])}})),i.forEach((function(e){t.outputs[e]={dtype:hi.getDataType(n.ys[e])}})),this.meta=t,t}},{key:"addData",value:function(e,t){this.data.raw.push({xs:e,ys:t})}},{key:"convertRawToTensors",value:function(e){var t=Object.assign({},this.meta),n=e.length;return x.tidy((function(){var r=[],i=[];return e.forEach((function(e){var n=Object.keys(t.inputs).map((function(t){return e.xs[t]})).flat();r.push(n);var a=Object.keys(t.outputs).map((function(t){return e.ys[t]})).flat();i.push(a)})),{inputs:x.tensor(r.flat(),[n].concat(Mr()(t.inputUnits))),outputs:x.tensor(i.flat(),[n,t.outputUnits])}}))}},{key:"normalizeDataRaw",value:function(e){var t=Object.assign({},this.meta),n=this.normalizeInputData(e,t.inputs,"xs"),r=this.normalizeInputData(e,t.outputs,"ys");return hi.zipArrays(n,r)}},{key:"normalizeInputData",value:function(e,t,n){var r=this,i=e.length,a=Object.assign({},t),o={};return Object.keys(a).forEach((function(t){var i={min:a[t].min,max:a[t].max},s=e.map((function(e){return e[n][t]}));"string"===a[t].dtype?(i.legend=a[t].legend,o[t]=r.normalizeArray(s,i)):"number"===a[t].dtype?o[t]=r.normalizeArray(s,i):"array"===a[t].dtype&&(o[t]=s.map((function(e){return r.normalizeArray(e,i)})))})),Mr()(new Array(i).fill(null)).map((function(e,t){var r=b()({},n,{});return Object.keys(a).forEach((function(e){r[n][e]=o[e][t]})),r}))}},{key:"normalizeArray",value:function(e,t){var n=t.min,r=t.max;if(t.legend)return e.map((function(e){return t.legend[e]?t.legend[e]:e}));if(e.every((function(e){return"number"==typeof e})))return e.map((function(e){return hi.normalizeValue(e,n,r)}));throw new Error("error in inputArray of normalizeArray() function")}},{key:"unnormalizeArray",value:function(e,t){var n=t.min,r=t.max;if(t.legend)return e.map((function(e){var n;return Object.entries(t.legend).forEach((function(t){var r=t[0],i=t[1];e.map((function(e,t){return e===i[t]})).every((function(e){return!0===e}))&&(n=r)})),n}));if(e.every((function(e){return"number"==typeof e})))return e.map((function(e){return hi.unnormalizeValue(e,n,r)}));throw new Error("error in inputArray of normalizeArray() function")}},{key:"applyOneHotEncodingsToDataRaw",value:function(e){var t=Object.assign({},this.meta);return e.map((function(e){var n=mi({},e.xs),r=mi({},e.ys);return Object.keys(t.inputs).forEach((function(r){t.inputs[r].legend&&(n[r]=t.inputs[r].legend[e.xs[r]])})),Object.keys(t.outputs).forEach((function(n){t.outputs[n].legend&&(r[n]=t.outputs[n].legend[e.ys[n]])})),{xs:n,ys:r}}))}},{key:"getDataOneHot",value:function(e){var t=Object.assign({},this.meta),n=this.getInputMetaOneHot(e,t.inputs,"xs"),r=this.getInputMetaOneHot(e,t.outputs,"ys");return t.inputs=n,t.outputs=r,this.meta=mi(mi({},this.meta),t),t}},{key:"getInputMetaOneHot",value:function(e,t,n){var r=this,i=Object.assign({},t);return Object.entries(i).forEach((function(t){var a=t[0];if("string"===t[1].dtype){var o=Mr()(new Set(e.map((function(e){return e[n][a]})))),s=r.createOneHotEncodings(o);i[a]=mi(mi({},i[a]),s)}})),i}},{key:"createOneHotEncodings",value:function(e){return x.tidy((function(){var t={uniqueValues:e,legend:{}},n=e,r=n.map((function(e,t){return t})),i=x.oneHot(x.tensor1d(r,"int32"),n.length).arraySync();return n.forEach((function(e,n){t.legend[e]=i[n]})),t}))}},{key:"loadDataFromUrl",value:function(){var e=k()(D.a.mark((function e(t,n,r){var i;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!t.endsWith(".csv")){e.next=7;break}return e.next=4,this.loadCSV(t,n,r);case 4:case 10:case 16:i=e.sent,e.next=20;break;case 7:if(!t.endsWith(".json")){e.next=13;break}return e.next=10,this.loadJSON(t,n,r);case 13:if(!t.includes("blob")){e.next=19;break}return e.next=16,this.loadBlob(t,n,r);case 19:throw new Error("Not a valid data format. Must be csv or json");case 20:return e.abrupt("return",i);case 23:throw e.prev=23,e.t0=e.catch(0),console.error(e.t0),new Error(e.t0);case 27:case"end":return e.stop()}}),e,this,[[0,23]])})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"loadJSON",value:function(){var e=k()(D.a.mark((function e(t,n,r){var i,a,o,s;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(t instanceof Object)){e.next=5;break}i=Object.assign({},t),e.next=10;break;case 5:return e.next=7,R.a.get(t);case 7:a=e.sent,o=a.data,i=o;case 10:return s=this.formatRawData(i,n,r),e.abrupt("return",s);case 14:throw e.prev=14,e.t0=e.catch(0),console.error("error loading json"),new Error(e.t0);case 18:case"end":return e.stop()}}),e,this,[[0,14]])})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"loadCSV",value:function(){var e=k()(D.a.mark((function e(t,n,r){var i,a,o,s;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,i=x.data.csv(t),e.next=4,i.toArray();case 4:return a=e.sent,o={entries:a},s=this.formatRawData(o,n,r),e.abrupt("return",s);case 10:throw e.prev=10,e.t0=e.catch(0),console.error("error loading csv",e.t0),new Error(e.t0);case 14:case"end":return e.stop()}}),e,this,[[0,10]])})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"loadBlob",value:function(){var e=k()(D.a.mark((function e(t,n,r){var i,a,o,s,u,c;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,R.a.get(t);case 3:if(i=e.sent,a=i.data,o=a,!hi.isJsonOrString(o)){e.next=13;break}return u=JSON.parse(o),e.next=10,this.loadJSON(u,n,r);case 10:s=e.sent,e.next=17;break;case 13:return c=this.csvToJSON(o),e.next=16,this.loadJSON(c,n,r);case 16:s=e.sent;case 17:return e.abrupt("return",s);case 20:throw e.prev=20,e.t0=e.catch(0),console.log("mmm might be passing in a string or something!",e.t0),new Error(e.t0);case 24:case"end":return e.stop()}}),e,this,[[0,20]])})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"loadData",value:function(){var e=k()(D.a.mark((function e(){var t,n,r,i,a,o,s=arguments;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.length>0&&void 0!==s[0]?s[0]:null,n=s.length>1?s[1]:void 0,e.prev=2,"string"==typeof t){e.next=17;break}if(i=t[0],(new FileReader).readAsText(i),!i.name.includes(".json")){e.next=14;break}return e.next=10,i.text();case 10:a=e.sent,r=JSON.parse(a),e.next=15;break;case 14:console.log('data must be a json object containing an array called "data" or "entries');case 15:e.next=22;break;case 17:return e.next=19,R.a.get(t,{responseType:"text"});case 19:r=e.sent,o=JSON.stringify(r.data),hi.isJsonOrString(o)?r=JSON.parse(o):console.log("Whoops! something went wrong. Either this kind of data is not supported yet or there is an issue with .loadData");case 22:this.data.raw=this.findEntries(r),!this.data.raw.length>0&&console.log('data must be a json object containing an array called "data" '),n&&n(),e.next=30;break;case 27:throw e.prev=27,e.t0=e.catch(2),new Error(e.t0);case 30:case"end":return e.stop()}}),e,this,[[2,27]])})));return function(){return e.apply(this,arguments)}}()},{key:"saveData",value:function(){var e=k()(D.a.mark((function e(t){var n,r,i,a,o,s;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Date,r="".concat(String(n.getFullYear()),"-").concat(String(n.getMonth()+1),"-").concat(String(n.getDate())),i="".concat(String(n.getHours()),"-").concat(String(n.getMinutes()),"-").concat(String(n.getSeconds())),a="".concat(r,"_").concat(i),o=a,t&&(o=t),s={data:this.data.raw},e.next=9,ut(JSON.stringify(s),"".concat(o,".json"),"text/plain");case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"saveMeta",value:function(){var e=k()(D.a.mark((function e(t,n){var r,i;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"function"==typeof t?(r="model",i=t):"string"==typeof t?(r=t,"function"==typeof n&&(i=n)):r="model",e.next=3,ut(JSON.stringify(this.meta),"".concat(r,"_meta.json"),"text/plain");case 3:i&&i();case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadMeta",value:function(){var e=k()(D.a.mark((function e(){var t,n,r,i,a,o,s,u=arguments;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=u.length>0&&void 0!==u[0]?u[0]:null,n=u.length>1?u[1]:void 0,!(t instanceof FileList)){e.next=10;break}return e.next=5,Promise.all(Array.from(t).map(function(){var e=k()(D.a.mark((function e(t){var n;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.name.includes(".json")||t.name.includes("_meta")){e.next=4;break}return e.abrupt("return",{name:"model",file:t});case 4:if(!t.name.includes(".json")||!t.name.includes("_meta.json")){e.next=11;break}return e.next=7,t.text();case 7:return n=e.sent,e.abrupt("return",{name:"metadata",file:n});case 11:if(!t.name.includes(".bin")){e.next=13;break}return e.abrupt("return",{name:"weights",file:t});case 13:return e.abrupt("return",{name:null,file:null});case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 5:r=e.sent,i=JSON.parse(r.find((function(e){return"metadata"===e.name})).file),this.meta=i,e.next=25;break;case 10:if(!(t instanceof Object)){e.next=19;break}return e.next=13,R.a.get(t.metadata,{responseType:"text"});case 13:a=e.sent,a=JSON.stringify(a.data),a=JSON.parse(a),this.meta=a,e.next=25;break;case 19:return o="".concat(t.substring(0,t.lastIndexOf("/")),"/model_meta.json"),e.next=22,R.a.get(o);case 22:s=(s=e.sent).data,this.meta=s;case 25:return this.isMetadataReady=!0,this.isWarmedUp=!0,n&&n(),e.abrupt("return",this.meta);case 29:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"formatRawData",value:function(e,t,n){var r=this.findEntries(e);!r.length>0&&console.log("your data must be contained in an array in \n\n        a property called 'entries' or 'data' of your json object");var i=r.map((function(e,r){var i={xs:{},ys:{}};return t.forEach((function(t){void 0!==e[t]?i.xs[t]=e[t]:console.error("the input label ".concat(t," does not exist at row ").concat(r))})),n.forEach((function(t){void 0!==e[t]?i.ys[t]=e[t]:console.error("the output label ".concat(t," does not exist at row ").concat(r))})),i}));return this.data.raw=i,i}},{key:"csvToJSON",value:function(e){for(var t=e.split("\n"),n=[],r=t[0].split(","),i=function(e){var i={},a=t[e].split(",");r.forEach((function(e,t){i[e]=a[t]})),n.push(i)},a=1;a<t.length;a+=1)i(a);return{entries:n}}},{key:"findEntries",value:function(e){var t=this,n=Object.assign({},e);return n.entries&&n.entries instanceof Array?n.entries:n.data&&n.data instanceof Array?n.data:(Object.keys(n).forEach((function(e){if("object"===I()(n[e]))return t.findEntries(n[e])})),n)}},{key:"getData",value:function(){return this.data.raw}}]),e}();function gi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var yi=function(){function e(){S()(this,e),this.config={height:300}}return A()(e,[{key:"modelSummary",value:function(e,t){var n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gi(Object(n),!0).forEach((function(t){b()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e);w.show.modelSummary(n,t)}},{key:"scatterplot",value:function(e,t,n){var r=n.map((function(n){return{x:n.xs[e],y:n.ys[t]}})),i={xLabel:"X",yLabel:"Y",height:this.config.height};w.render.scatterplot({name:"debug mode"},r,i)}},{key:"scatterplotAll",value:function(e,t,n){var r=[];e.forEach((function(e){t.forEach((function(t){var i=n.map((function(n){return{x:n.xs[e],y:n.ys[t]}}));r=[].concat(Mr()(r),Mr()(i))}))}));var i={xLabel:"X",yLabel:"Y",height:this.config.height};w.render.scatterplot({name:"debug mode"},r,i)}},{key:"barchart",value:function(e,t,n){var r=n.map((function(n){return{value:n.xs[e],index:n.ys[t]}})),i={xLabel:"label",yLabel:"value",height:this.config.height};console.log(i),w.render.barchart({name:"Bar chart"},r)}},{key:"trainingVis",value:function(){return w.show.fitCallbacks({name:"Training Performance"},["loss","accuracy"],{height:this.config.height,callbacks:["onEpochEnd"]})}}]),e}();function bi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function xi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bi(Object(n),!0).forEach((function(t){b()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var wi={inputs:[],outputs:[],dataUrl:null,modelUrl:null,layers:[],task:null,debug:!1,learningRate:.2,hiddenUnits:16,noTraining:!1},_i=function(){function e(t,n){S()(this,e),this.callback=n,"imageClassification"===t.task&&(wi.learningRate=.02),this.options=xi(xi({},wi),t)||wi,this.neuralNetwork=new li,this.neuralNetworkData=new vi,this.neuralNetworkVis=new yi,this.data={training:[]},this.ready=!1,this.init=this.init.bind(this),this.addData=this.addData.bind(this),this.loadDataFromUrl=this.loadDataFromUrl.bind(this),this.loadDataInternal=this.loadDataInternal.bind(this),this.createMetaData=this.createMetaData.bind(this),this.prepareForTraining=this.prepareForTraining.bind(this),this.normalizeData=this.normalizeData.bind(this),this.normalizeInput=this.normalizeInput.bind(this),this.searchAndFormat=this.searchAndFormat.bind(this),this.formatInputItem=this.formatInputItem.bind(this),this.convertTrainingDataToTensors=this.convertTrainingDataToTensors.bind(this),this.formatInputsForPrediction=this.formatInputsForPrediction.bind(this),this.formatInputsForPredictionAll=this.formatInputsForPredictionAll.bind(this),this.isOneHotEncodedOrNormalized=this.isOneHotEncodedOrNormalized.bind(this),this.train=this.train.bind(this),this.trainInternal=this.trainInternal.bind(this),this.addLayer=this.addLayer.bind(this),this.createNetworkLayers=this.createNetworkLayers.bind(this),this.addDefaultLayers=this.addDefaultLayers.bind(this),this.compile=this.compile.bind(this),this.predict=this.predict.bind(this),this.predictMultiple=this.predictMultiple.bind(this),this.classify=this.classify.bind(this),this.classifyMultiple=this.classifyMultiple.bind(this),this.predictInternal=this.predictInternal.bind(this),this.classifyInternal=this.classifyInternal.bind(this),this.saveData=this.saveData.bind(this),this.loadData=this.loadData.bind(this),this.save=this.save.bind(this),this.load=this.load.bind(this),this.dispose=this.dispose.bind(this),this.mutate=this.mutate.bind(this),this.crossover=this.crossover.bind(this),this.init(this.callback)}return A()(e,[{key:"init",value:function(e){!0===this.options.noTraining&&this.createLayersNoTraining(),null!==this.options.dataUrl?this.ready=this.loadDataFromUrl(this.options,e):null!==this.options.modelUrl?this.ready=this.load(this.options.modelUrl,e):this.ready=!0}},{key:"createLayersNoTraining",value:function(){var e=this.options,t=e.inputs,n=e.outputs;if("classification"===e.task)for(var r=0;r<n.length;r+=1){var i=new Array(t).fill(0);this.addData(i,[n[r]])}else{var a=new Array(t).fill(0),o=new Array(n).fill(0);this.addData(a,o)}this.neuralNetworkData.createMetadata(this.neuralNetworkData.data.raw),this.addDefaultLayers(this.options.task,this.neuralNetworkData.meta)}},{key:"copy",value:function(){var t=this,n=new e(this.options);return x.tidy((function(){for(var e=t.neuralNetwork.model.getWeights(),r=[],i=0;i<e.length;i+=1)r[i]=e[i].clone();return n.neuralNetwork.model.setWeights(r),n}))}},{key:"addData",value:function(e,t){var n,r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=this.options,o=a.inputs,s=a.outputs;if(null!==i?(n=i.inputLabels,r=i.outputLabels):o.length>0&&s.length>0?(o.every((function(e){return"string"==typeof e}))&&(n=o),s.every((function(e){return"string"==typeof e}))&&(r=s)):"object"===I()(e)&&"object"===I()(t)?(n=Object.keys(e),r=Object.keys(t)):(n=hi.createLabelsFromArrayValues(e,"input"),r=hi.createLabelsFromArrayValues(t,"output")),!(n instanceof Array))throw new Error("inputLabels must be an array");if(!(r instanceof Array))throw new Error("outputLabels must be an array");var u=this.searchAndFormat(e),c=hi.formatDataAsObject(u,n),l=hi.formatDataAsObject(t,r);this.neuralNetworkData.addData(c,l)}},{key:"loadDataFromUrl",value:function(e,t){return T(this.loadDataInternal(e),t)}},{key:"loadDataInternal",value:function(){var e=k()(D.a.mark((function e(t){var n,r,i,a;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.dataUrl,r=t.inputs,i=t.outputs,e.next=3,this.neuralNetworkData.loadDataFromUrl(n,r,i);case 3:a=e.sent,this.createMetadata(a),this.prepareForTraining(a);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createMetaData",value:function(e){var t,n=this.options.inputs;Array.isArray(n)&&n.length>0&&(t=n.every((function(e){return"number"==typeof e}))&&n.length>0?n:null),this.neuralNetworkData.createMetadata(e,t)}},{key:"prepareForTraining",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=null===e?this.neuralNetworkData.data.raw:e,n=this.neuralNetworkData.applyOneHotEncodingsToDataRaw(t);return this.data.training=n,this.neuralNetworkData.isWarmedUp=!0,n}},{key:"normalizeData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=null===e?this.neuralNetworkData.data.raw:e;this.neuralNetworkData.isMetadataReady||this.createMetaData(t),this.neuralNetworkData.isWarmedUp||this.prepareForTraining(t);var n=this.neuralNetworkData.normalizeDataRaw(t);return this.data.training=n,this.neuralNetworkData.meta.isNormalized=!0,n}},{key:"normalizeInput",value:function(e,t,n){var r=n[t],i=r.min,a=r.max;return hi.normalizeValue(e,i,a)}},{key:"searchAndFormat",value:function(e){var t,n=this;if(Array.isArray(e))t=e.map((function(e){return n.formatInputItem(e)}));else if("object"===I()(e)){var r=Object.assign({},e);Object.keys(e).forEach((function(t){var i=e[t];r[t]=n.formatInputItem(i)})),t=r}return t}},{key:"formatInputItem",value:function(e){var t;return me(e)?t=e:"object"===I()(e)&&me(e.elt)?t=e.elt:"object"===I()(e)&&me(e.canvas)&&(t=e.canvas),t?ve(t):e}},{key:"convertTrainingDataToTensors",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=null===e?this.data.training:e,r=null===t?this.neuralNetworkData.meta:t;return this.neuralNetworkData.convertRawToTensors(n,r)}},{key:"formatInputsForPrediction",value:function(e,t,n){var r=this,i=[];return e instanceof Array?i=n.map((function(n,i){return r.isOneHotEncodedOrNormalized(e[i],n,t.inputs)})):e instanceof Object&&(i=n.map((function(n){return r.isOneHotEncodedOrNormalized(e[n],n,t.inputs)}))),i.flat()}},{key:"formatInputsForPredictionAll",value:function(e,t,n){var r,i=this;return e instanceof Array&&e.every((function(e){return Array.isArray(e)}))?(r=e.map((function(e){return i.formatInputsForPrediction(e,t,n)})),x.tensor(r,[e.length,n.length])):(r=this.formatInputsForPrediction(e,t,n),x.tensor([r]))}},{key:"isOneHotEncodedOrNormalized",value:function(e,t,n){var r,i=e,a=t;return"number"!=typeof e?r=n[a].legend[i]:(r=e,this.neuralNetworkData.meta.isNormalized&&(r=this.normalizeInput(e,a,n))),r}},{key:"train",value:function(e,t,n){var r,i,a;"object"===I()(e)&&"function"==typeof t&&"function"==typeof n?(r=e,i=t,a=n):"object"===I()(e)&&"function"==typeof t?(r=e,i=null,a=t):"function"==typeof e&&"function"==typeof t?(r={},i=e,a=t):(r={},i=null,a=e),this.trainInternal(r,i,a)}},{key:"trainInternal",value:function(e,t,n){var r=xi({epochs:10,batchSize:32,validationSplit:.1,whileTraining:null},e);if(!0===this.options.debug||"true"===this.options.debug?r.whileTraining=[this.neuralNetworkVis.trainingVis(),{onEpochEnd:t}]:r.whileTraining=[{onEpochEnd:t}],this.neuralNetworkData.isMetadataReady||this.createMetaData(this.neuralNetworkData.data.raw),this.neuralNetworkData.isWarmedUp||this.prepareForTraining(this.neuralNetworkData.data.raw),!r.inputs&&!r.outputs){var i=this.convertTrainingDataToTensors(),a=i.inputs,o=i.outputs;r.inputs=a,r.outputs=o}this.neuralNetwork.isLayered||(this.options.layers=this.createNetworkLayers(this.options.layers,this.neuralNetworkData.meta)),this.neuralNetwork.isLayered||(this.options.layers=this.addDefaultLayers(this.options.task,this.neuralNetworkData.meta)),this.neuralNetwork.isCompiled||this.compile(),this.neuralNetwork.train(r,n)}},{key:"addLayer",value:function(e){this.neuralNetwork.addLayer(e)}},{key:"createNetworkLayers",value:function(e,t){var n=this,r=Mr()(e),i=Object.assign({},t),a=i.inputUnits,o=i.outputUnits,s=r.length;if(!(r.length>=2))return!1;r[0].inputShape=r[0].inputShape?r[0].inputShape:a;var u=r[s-1];return u.units=u.units?u.units:o,r.forEach((function(e){n.addLayer(x.layers[e.type](e))})),r}},{key:"addDefaultLayers",value:function(e,t){var n;switch(e.toLowerCase()){case"classification":return n=[{type:"dense",units:this.options.hiddenUnits,activation:"relu"},{type:"dense",activation:"softmax"}],this.createNetworkLayers(n,t);case"regression":return n=[{type:"dense",units:this.options.hiddenUnits,activation:"relu"},{type:"dense",activation:"sigmoid"}],this.createNetworkLayers(n,t);case"imageclassification":return n=[{type:"conv2d",filters:8,kernelSize:5,strides:1,activation:"relu",kernelInitializer:"varianceScaling"},{type:"maxPooling2d",poolSize:[2,2],strides:[2,2]},{type:"conv2d",filters:16,kernelSize:5,strides:1,activation:"relu",kernelInitializer:"varianceScaling"},{type:"maxPooling2d",poolSize:[2,2],strides:[2,2]},{type:"flatten"},{type:"dense",kernelInitializer:"varianceScaling",activation:"softmax"}],this.createNetworkLayers(n,t);default:return console.log("no imputUnits or outputUnits defined"),n=[{type:"dense",units:this.options.hiddenUnits,activation:"relu"},{type:"dense",activation:"sigmoid"}],this.createNetworkLayers(n,t)}}},{key:"compile",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=null===t?this.options.learningRate:t,r={};null!==e?r=xi({},e):"classification"===this.options.task||"imageClassification"===this.options.task?r={loss:"categoricalCrossentropy",optimizer:x.train.sgd,metrics:["accuracy"]}:"regression"===this.options.task&&(r={loss:"meanSquaredError",optimizer:x.train.adam,metrics:["accuracy"]}),r.optimizer=r.optimizer?this.neuralNetwork.setOptimizerFunction(n,r.optimizer):this.neuralNetwork.setOptimizerFunction(n,x.train.sgd),this.neuralNetwork.compile(r),this.options.debug&&this.neuralNetworkVis.modelSummary({name:"Model Summary"},this.neuralNetwork.model)}},{key:"predictSync",value:function(e){return this.predictSyncInternal(e)}},{key:"predict",value:function(e,t){return T(this.predictInternal(e),t)}},{key:"predictMultiple",value:function(e,t){return T(this.predictInternal(e),t)}},{key:"classifySync",value:function(e){return this.classifySyncInternal(e)}},{key:"classify",value:function(e,t){return T(this.classifyInternal(e),t)}},{key:"classifyMultiple",value:function(e,t){return T(this.classifyInternal(e),t)}},{key:"predictSyncInternal",value:function(e){var t=this.neuralNetworkData.meta,n=Object.keys(t.inputs),r=this.formatInputsForPredictionAll(e,t,n),i=this.neuralNetwork.predictSync(r);if(r.dispose(),null!==t){var a=Object.keys(t.outputs),o=i.map((function(e){return a.map((function(n,r){var i,o,s;if(t.isNormalized){var u=t.outputs[n],c=u.min,l=u.max;o=hi.unnormalizeValue(e[r],c,l),s=e[r]}else o=e[r];var f=(i={},b()(i,a[r],o),b()(i,"label",n),b()(i,"value",o),i);return s&&(f.unNormalizedValue=s),f}))}));return o.length<2?o[0]:o}return i}},{key:"predictInternal",value:function(){var e=k()(D.a.mark((function e(t){var n,r,i,a,o,s;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.neuralNetworkData.meta,r=Object.keys(n.inputs),i=this.formatInputsForPredictionAll(t,n,r),e.next=5,this.neuralNetwork.predict(i);case 5:if(a=e.sent,i.dispose(),null===n){e.next=13;break}if(o=Object.keys(n.outputs),!((s=a.map((function(e){return o.map((function(t,r){var i,a,s;if(n.isNormalized){var u=n.outputs[t],c=u.min,l=u.max;a=hi.unnormalizeValue(e[r],c,l),s=e[r]}else a=e[r];var f=(i={},b()(i,o[r],a),b()(i,"label",t),b()(i,"value",a),i);return s&&(f.unNormalizedValue=s),f}))}))).length<2)){e.next=12;break}return e.abrupt("return",s[0]);case 12:return e.abrupt("return",s);case 13:return e.abrupt("return",a);case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"classifySyncInternal",value:function(e){var t,n=this.neuralNetworkData.meta,r=Object.keys(n.inputs);if("imageClassification"===this.options.task){if(t=this.searchAndFormat(e),t=Array.isArray(t)?t.flat():t[r[0]],n.isNormalized){var i=n.inputs[r[0]],a=i.min,o=i.max;t=this.neuralNetworkData.normalizeArray(Array.from(t),{min:a,max:o})}else t=Array.from(t);t=x.tensor([t],[1].concat(Mr()(n.inputUnits)))}else t=this.formatInputsForPredictionAll(e,n,r);var s=this.neuralNetwork.classifySync(t);if(t.dispose(),null!==n){var u=Object.keys(n.outputs)[0],c=Object.entries(n.outputs[u].legend),l=s.map((function(e){return c.map((function(t,n){var r;return r={},b()(r,t[0],e[n]),b()(r,"label",t[0]),b()(r,"confidence",e[n]),r})).sort((function(e,t){return t.confidence-e.confidence}))}));return l.length<2?l[0]:l}return s}},{key:"classifyInternal",value:function(){var e=k()(D.a.mark((function e(t){var n,r,i,a,o,s,u,c,l,f;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.neuralNetworkData.meta,r=Object.keys(n.inputs),"imageClassification"===this.options.task?(i=this.searchAndFormat(t),i=Array.isArray(i)?i.flat():i[r[0]],n.isNormalized?(a=n.inputs[r[0]],o=a.min,s=a.max,i=this.neuralNetworkData.normalizeArray(Array.from(i),{min:o,max:s})):i=Array.from(i),i=x.tensor([i],[1].concat(Mr()(n.inputUnits)))):i=this.formatInputsForPredictionAll(t,n,r),e.next=5,this.neuralNetwork.classify(i);case 5:if(u=e.sent,i.dispose(),null===n){e.next=14;break}if(c=Object.keys(n.outputs)[0],l=Object.entries(n.outputs[c].legend),!((f=u.map((function(e){return l.map((function(t,n){var r;return r={},b()(r,t[0],e[n]),b()(r,"label",t[0]),b()(r,"confidence",e[n]),r})).sort((function(e,t){return t.confidence-e.confidence}))}))).length<2)){e.next=13;break}return e.abrupt("return",f[0]);case 13:return e.abrupt("return",f);case 14:return e.abrupt("return",u);case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"saveData",value:function(e){this.neuralNetworkData.saveData(e)}},{key:"loadData",value:function(){var e=k()(D.a.mark((function e(){var t,n,r=arguments;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=r.length>0&&void 0!==r[0]?r[0]:null,n=r.length>1?r[1]:void 0,this.neuralNetworkData.loadData(t,n);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"save",value:function(e,t){var n,r,i=this;"function"==typeof e?(n="model",r=e):"string"==typeof e?(n=e,"function"==typeof t&&(r=t)):n="model",this.neuralNetwork.save(n,(function(){i.neuralNetworkData.saveMeta(n,r)}))}},{key:"load",value:function(){var e=k()(D.a.mark((function e(){var t,n,r,i=this,a=arguments;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=a.length>0&&void 0!==a[0]?a[0]:null,(n=a.length>1?a[1]:void 0)&&(r=n),this.neuralNetwork.load(t,(function(){return i.neuralNetworkData.loadMeta(t,r),i.neuralNetwork.model}));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dispose",value:function(){this.neuralNetwork.dispose()}},{key:"mutate",value:function(e,t){this.neuralNetwork.mutate(e,t)}},{key:"crossover",value:function(e){var t=this.copy();return t.neuralNetwork.crossover(e.neuralNetwork),t}}]),e}(),ki=function(e,t,n){var r,i;return e instanceof Object?(r=e,i=t):(r={inputs:e,outputs:t},i=n),new _i(r,i)},Ei=n(3);function Si(e,t,n){if(void 0===n&&(n=!1),e.beginPath(),t.slice(1).forEach((function(n,r){var i=n.x,a=n.y,o=t[r];e.moveTo(o.x,o.y),e.lineTo(i,a)})),n){var r=t[t.length-1],i=t[0];if(!r||!i)return;e.moveTo(r.x,r.y),e.lineTo(i.x,i.y)}e.stroke()}var Ci=n(5),Ai=function(){function e(e,t){if(!zi(e)||!zi(t))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:e,height:t}));this._width=e,this._height=t}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),e.prototype.reverse=function(){return new e(1/this.width,1/this.height)},e}();function Oi(e,t){return e instanceof Ei.Tensor&&e.shape.length===t}function Di(e){return Oi(e,1)}function Ti(e){return Oi(e,2)}function ji(e){return Oi(e,3)}function Mi(e){return Oi(e,4)}function Fi(e){return e%1!=0}function Ii(e){return e%2==0}function Ni(e,t){void 0===t&&(t=2);var n=Math.pow(10,t);return Math.floor(e*n)/n}function Ri(e){return e&&e.width&&e.height}function Pi(e,t){var n=e.width,r=e.height,i=t/Math.max(r,n);return new Ai(Math.round(n*i),Math.round(r*i))}function Bi(e){return e.reduce((function(e,t){return e.add(t)}),new Wi(0,0)).div(new Wi(e.length,e.length))}function Li(e,t,n){return Array(e).fill(0).map((function(e,r){return t+r*n}))}function zi(e){return!!e&&e!==1/0&&e!==-1/0&&!isNaN(e)||0===e}function Ui(e){return zi(e)&&0<=e&&e<=1}var Wi=function(){function e(e,t){this._x=e,this._y=t}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.sub=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.mul=function(t){return new e(this.x*t.x,this.y*t.y)},e.prototype.div=function(t){return new e(this.x/t.x,this.y/t.y)},e.prototype.abs=function(){return new e(Math.abs(this.x),Math.abs(this.y))},e.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y))},e}(),Vi=function(){function e(t,n){void 0===n&&(n=!0);var r=t||{},i=[r.left,r.top,r.right,r.bottom].every(zi),a=[r.x,r.y,r.width,r.height].every(zi);if(!a&&!i)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var o=a?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],s=o[0],u=o[1],c=o[2],l=o[3];e.assertIsValidBox({x:s,y:u,width:c,height:l},"Box.constructor",n),this._x=s,this._y=u,this._width=c,this._height=l}return e.isRect=function(e){return!!e&&[e.x,e.y,e.width,e.height].every(zi)},e.assertIsValidBox=function(t,n,r){if(void 0===r&&(r=!1),!e.isRect(t))throw new Error(n+" - invalid box: "+JSON.stringify(t)+", expected object with properties x, y, width, height");if(!r&&(t.width<0||t.height<0))throw new Error(n+" - width ("+t.width+") and height ("+t.height+") must be positive numbers")},Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topLeft",{get:function(){return new Wi(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topRight",{get:function(){return new Wi(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomLeft",{get:function(){return new Wi(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomRight",{get:function(){return new Wi(this.right,this.bottom)},enumerable:!0,configurable:!0}),e.prototype.round=function(){var t=[this.x,this.y,this.width,this.height].map((function(e){return Math.round(e)}));return new e({x:t[0],y:t[1],width:t[2],height:t[3]})},e.prototype.floor=function(){var t=[this.x,this.y,this.width,this.height].map((function(e){return Math.floor(e)}));return new e({x:t[0],y:t[1],width:t[2],height:t[3]})},e.prototype.toSquare=function(){var t=this.x,n=this.y,r=this.width,i=this.height,a=Math.abs(r-i);return r<i&&(t-=a/2,r+=a),i<r&&(n-=a/2,i+=a),new e({x:t,y:n,width:r,height:i})},e.prototype.rescale=function(t){var n=Ri(t)?t.width:t,r=Ri(t)?t.height:t;return new e({x:this.x*n,y:this.y*r,width:this.width*n,height:this.height*r})},e.prototype.pad=function(t,n){var r=[this.x-t/2,this.y-n/2,this.width+t,this.height+n];return new e({x:r[0],y:r[1],width:r[2],height:r[3]})},e.prototype.clipAtImageBorders=function(t,n){var r=this.x,i=this.y,a=this.right,o=this.bottom,s=Math.max(r,0),u=Math.max(i,0),c=a-s,l=o-u;return new e({x:s,y:u,width:Math.min(c,t-s),height:Math.min(l,n-u)}).floor()},e.prototype.shift=function(t,n){var r=this.width,i=this.height;return new e({x:this.x+t,y:this.y+n,width:r,height:i})},e.prototype.padAtBorders=function(e,t){var n=this.width+1,r=this.height+1,i=n,a=r,o=this.left,s=this.top,u=this.right,c=this.bottom;return u>t&&(i=-u+t+n,u=t),c>e&&(a=-c+e+r,c=e),o<1&&(a=2-o,o=1),s<1&&(a=2-s,s=1),{dy:1,edy:a,dx:1,edx:i,y:s,ey:c,x:o,ex:u,w:n,h:r}},e.prototype.calibrate=function(t){return new e({left:this.left+t.left*this.width,top:this.top+t.top*this.height,right:this.right+t.right*this.width,bottom:this.bottom+t.bottom*this.height}).toSquare().round()},e}(),Gi=function(e){function t(t,n,r,i,a){return void 0===a&&(a=!1),e.call(this,{left:t,top:n,right:r,bottom:i},a)||this}return Object(Ci.c)(t,e),t}(Vi),qi=function(){function e(e,t,n,r,i){this._imageDims=new Ai(i.width,i.height),this._score=e,this._classScore=t,this._className=n,this._box=new Vi(r).rescale(this._imageDims)}return Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativeBox",{get:function(){return new Vi(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),e.prototype.forSize=function(t,n){return new e(this.score,this.classScore,this.className,this.relativeBox,{width:t,height:n})},e}(),Hi=function(e){function t(t,n,r){return e.call(this,t,t,"",n,r)||this}return Object(Ci.c)(t,e),t.prototype.forSize=function(n,r){var i=e.prototype.forSize.call(this,n,r);return new t(i.score,i.relativeBox,i.imageDims)},t}(qi);function Xi(e,t,n){void 0===n&&(n=!0);var r=Math.max(0,Math.min(e.right,t.right)-Math.max(e.left,t.left))*Math.max(0,Math.min(e.bottom,t.bottom)-Math.max(e.top,t.top));return n?r/(e.area+t.area-r):r/Math.min(e.area,t.area)}function Ki(e){var t=e.map((function(e){return e.x})),n=e.map((function(e){return e.y})),r=t.reduce((function(e,t){return t<e?t:e}),1/0),i=n.reduce((function(e,t){return t<e?t:e}),1/0),a=t.reduce((function(e,t){return e<t?t:e}),0),o=n.reduce((function(e,t){return e<t?t:e}),0);return new Gi(r,i,a,o)}function Yi(e,t,n,r){void 0===r&&(r=!0);for(var i=t.map((function(e,t){return{score:e,boxIndex:t}})).sort((function(e,t){return e.score-t.score})).map((function(e){return e.boxIndex})),a=[],o=function(){var t=i.pop();a.push(t);for(var o=i,s=[],u=0;u<o.length;u++){var c=o[u],l=e[t],f=e[c];s.push(Xi(l,f,r))}i=i.filter((function(e,t){return s[t]<=n}))};i.length>0;)o();return a}function $i(e,t){return Ei.tidy((function(){var n=t[0],r=t[1],i=t[2],a=Ei.fill(Object(Ci.e)(e.shape.slice(0,3),[1]),n),o=Ei.fill(Object(Ci.e)(e.shape.slice(0,3),[1]),r),s=Ei.fill(Object(Ci.e)(e.shape.slice(0,3),[1]),i),u=Ei.concat([a,o,s],3);return Ei.sub(e,u)}))}function Ji(e,t){return void 0===t&&(t=!1),Ei.tidy((function(){var n=e.shape.slice(1),r=n[0],i=n[1];if(r===i)return e;var a=Math.abs(r-i),o=Math.round(a*(t?.5:1)),s=r>i?2:1,u=function(t){var n=e.shape.slice();return n[s]=t,Ei.fill(n,0)},c=u(o),l=a-c.shape[s],f=[t&&l?u(l):null,e,c].filter((function(e){return!!e})).map((function(e){return e.toFloat()}));return Ei.concat(f,s)}))}function Zi(e){for(var t=e.slice(),n=t.length-1;n>0;n--){var r=Math.floor(Math.random()*(n+1)),i=t[n];t[n]=t[r],t[r]=i}return t}function Qi(e){return 1/(1+Math.exp(-e))}function ea(e){return Math.log(e/(1-e))}var ta=function(e){function t(t,n,r,i,a){return void 0===a&&(a=!1),e.call(this,{x:t,y:n,width:r,height:i},a)||this}return Object(Ci.c)(t,e),t}(Vi),na=function(){function e(e,t,n){void 0===n&&(n=new Wi(0,0));var r=t.width,i=t.height;this._imgDims=new Ai(r,i),this._shift=n,this._positions=e.map((function(e){return e.mul(new Wi(r,i)).add(n)}))}return Object.defineProperty(e.prototype,"shift",{get:function(){return new Wi(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativePositions",{get:function(){var e=this;return this._positions.map((function(t){return t.sub(e._shift).div(new Wi(e.imageWidth,e.imageHeight))}))},enumerable:!0,configurable:!0}),e.prototype.forSize=function(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})},e.prototype.shiftBy=function(e,t){return new this.constructor(this.relativePositions,this._imgDims,new Wi(e,t))},e.prototype.shiftByPoint=function(e){return this.shiftBy(e.x,e.y)},e.prototype.align=function(e,t){if(void 0===t&&(t={}),e){var n=e instanceof Hi?e.box.floor():new Vi(e);return this.shiftBy(n.x,n.y).align(null,t)}var r=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},t),i=r.useDlibAlignment,a=r.minBoxPadding;return i?this.alignDlib():this.alignMinBbox(a)},e.prototype.alignDlib=function(){var e=this.getRefPointsForAlignment(),t=e[0],n=e[1],r=e[2],i=function(e){return r.sub(e).magnitude()},a=(i(t)+i(n))/2,o=Math.floor(a/.45),s=Bi(e),u=Math.floor(Math.max(0,s.x-.5*o)),c=Math.floor(Math.max(0,s.y-.43*o));return new ta(u,c,Math.min(o,this.imageWidth+u),Math.min(o,this.imageHeight+c))},e.prototype.alignMinBbox=function(e){var t=Ki(this.positions);return t.pad(t.width*e,t.height*e)},e.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},e}(),ra=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(Ci.c)(t,e),t.prototype.getRefPointsForAlignment=function(){var e=this.positions;return[e[0],e[1],Bi([e[3],e[4]])]},t}(na),ia=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(Ci.c)(t,e),t.prototype.getJawOutline=function(){return this.positions.slice(0,17)},t.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},t.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},t.prototype.getNose=function(){return this.positions.slice(27,36)},t.prototype.getLeftEye=function(){return this.positions.slice(36,42)},t.prototype.getRightEye=function(){return this.positions.slice(42,48)},t.prototype.getMouth=function(){return this.positions.slice(48,68)},t.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(Bi)},t}(na),aa=function(){function e(e,t){this._label=e,this._distance=t}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),e.prototype.toString=function(e){return void 0===e&&(e=!0),this.label+(e?" ("+Ni(this.distance)+")":"")},e}(),oa=function(e){function t(t,n){var r=e.call(this,t)||this;return r._label=n,r}return Object(Ci.c)(t,e),t.assertIsValidLabeledBox=function(e,t){if(Vi.assertIsValidBox(e,t),!zi(e.label))throw new Error(t+" - expected property label ("+e.label+") to be a number")},Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),t}(Vi),sa=function(){function e(e,t){if("string"!=typeof e)throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(t)||t.some((function(e){return!(e instanceof Float32Array)})))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=e,this._descriptors=t}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map((function(e){return Array.from(e)}))}},e.fromJSON=function(t){var n=t.descriptors.map((function(e){return new Float32Array(e)}));return new e(t.label,n)},e}(),ua=function(e){function t(t,n,r,i){var a=e.call(this,t,n)||this;return a._score=r,a._classScore=i,a}return Object(Ci.c)(t,e),t.assertIsValidPredictedBox=function(e,t){if(oa.assertIsValidLabeledBox(e,t),!Ui(e.score)||!Ui(e.classScore))throw new Error(t+" - expected properties score ("+e.score+") and ("+e.classScore+") to be a number between [0, 1]")},Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),t}(oa);function ca(e){return e.detection instanceof Hi}function la(e,t){var n={detection:t};return Object.assign({},e,n)}function fa(){var e=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D:CanvasRenderingContext2D,Image:HTMLImageElement,ImageData:ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:e,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}var da=n(131),ha=n(178);function pa(){return"object"==typeof window&&"undefined"!=typeof document&&"undefined"!=typeof HTMLImageElement&&"undefined"!=typeof HTMLCanvasElement&&"undefined"!=typeof HTMLVideoElement&&"undefined"!=typeof ImageData&&"undefined"!=typeof CanvasRenderingContext2D}var ma,va=n(177);function ga(e){ma=e}function ya(){pa()&&ga(fa()),Object(va.a)()&&ga(Object(ha.a)())}var ba,xa={getEnv:function(){if(!ma)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return ma},setEnv:ga,initialize:ya,createBrowserEnv:fa,createFileSystem:da.a,createNodejsEnv:ha.a,monkeyPatch:function(e){if(ma||ya(),!ma)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var t=e.Canvas,n=void 0===t?ma.Canvas:t,r=e.Image,i=void 0===r?ma.Image:r;ma.Canvas=n,ma.Image=i,ma.createCanvasElement=e.createCanvasElement||function(){return new n},ma.createImageElement=e.createImageElement||function(){return new i},ma.ImageData=e.ImageData||ma.ImageData,ma.Video=e.Video||ma.Video,ma.fetch=e.fetch||ma.fetch,ma.readFile=e.readFile||ma.readFile},isBrowser:pa,isNodejs:va.a};function wa(e){return xa.isNodejs()||"string"!=typeof e?e:document.getElementById(e)}function _a(e){var t=xa.getEnv(),n=t.Canvas;if(e instanceof t.CanvasRenderingContext2D)return e;var r=wa(e);if(!(r instanceof n))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var i=r.getContext("2d");if(!i)throw new Error("resolveContext2d - canvas 2d context is null");return i}ya(),function(e){e.TOP_LEFT="TOP_LEFT",e.TOP_RIGHT="TOP_RIGHT",e.BOTTOM_LEFT="BOTTOM_LEFT",e.BOTTOM_RIGHT="BOTTOM_RIGHT"}(ba||(ba={}));var ka=function(e){void 0===e&&(e={});var t=e.anchorPosition,n=e.backgroundColor,r=e.fontColor,i=e.fontSize,a=e.fontStyle,o=e.padding;this.anchorPosition=t||ba.TOP_LEFT,this.backgroundColor=n||"rgba(0, 0, 0, 0.5)",this.fontColor=r||"rgba(255, 255, 255, 1)",this.fontSize=i||14,this.fontStyle=a||"Georgia",this.padding=o||4},Ea=function(){function e(t,n,r){void 0===r&&(r={}),this.text="string"==typeof t?[t]:t instanceof e?t.text:t,this.anchor=n,this.options=new ka(r)}return e.prototype.measureWidth=function(e){var t=this.options.padding;return this.text.map((function(t){return e.measureText(t).width})).reduce((function(e,t){return e<t?t:e}),0)+2*t},e.prototype.measureHeight=function(){var e=this.options,t=e.fontSize,n=e.padding;return this.text.length*t+2*n},e.prototype.getUpperLeft=function(e,t){var n=this.options.anchorPosition,r=n===ba.BOTTOM_RIGHT||n===ba.TOP_RIGHT,i=n===ba.BOTTOM_LEFT||n===ba.BOTTOM_RIGHT,a=this.measureWidth(e),o=this.measureHeight(),s=r?this.anchor.x-a:this.anchor.x,u=i?this.anchor.y-o:this.anchor.y;if(t){var c=t.width,l=t.height;return{x:Math.max(Math.min(s,c-a),0),y:Math.max(Math.min(u,l-o),0)}}return{x:s,y:u}},e.prototype.draw=function(e){var t=wa(e),n=_a(t),r=this.options,i=r.backgroundColor,a=r.fontColor,o=r.fontSize,s=r.fontStyle,u=r.padding;n.font=o+"px "+s;var c=this.measureWidth(n),l=this.measureHeight();n.fillStyle=i;var f=this.getUpperLeft(n,t);n.fillRect(f.x,f.y,c,l),n.fillStyle=a,this.text.forEach((function(e,t){var r=u+f.x,i=u+f.y+(t+1)*o;n.fillText(e,r,i)}))},e}(),Sa=function(e){void 0===e&&(e={});var t=e.boxColor,n=e.lineWidth,r=e.label,i=e.drawLabelOptions;this.boxColor=t||"rgba(0, 0, 255, 1)",this.lineWidth=n||2,this.label=r;var a={anchorPosition:ba.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new ka(Object.assign({},a,i))},Ca=function(){function e(e,t){void 0===t&&(t={}),this.box=new Vi(e),this.options=new Sa(t)}return e.prototype.draw=function(e){var t=_a(e),n=this.options,r=n.boxColor,i=n.lineWidth,a=this.box,o=a.x,s=a.y,u=a.width,c=a.height;t.strokeStyle=r,t.lineWidth=i,t.strokeRect(o,s,u,c);var l=this.options.label;l&&new Ea([l],{x:o-i/2,y:s},this.options.drawLabelOptions).draw(e)},e}();function Aa(e,t){(Array.isArray(t)?t:[t]).forEach((function(t){var n=t instanceof Hi?t.score:ca(t)?t.detection.score:void 0,r=t instanceof Hi?t.box:ca(t)?t.detection.box:new Vi(t),i=n?""+Ni(n):void 0;new Ca(r,{label:i}).draw(e)}))}function Oa(e){var t=xa.getEnv(),n=t.Image,r=t.Video;return e instanceof n&&e.complete||e instanceof r&&e.readyState>=3}function Da(e){return new Promise((function(t,n){if(e instanceof xa.getEnv().Canvas||Oa(e))return t();function r(e){e.currentTarget&&(e.currentTarget.removeEventListener("load",r),e.currentTarget.removeEventListener("error",i),t(e))}function i(e){e.currentTarget&&(e.currentTarget.removeEventListener("load",r),e.currentTarget.removeEventListener("error",i),n(e))}e.addEventListener("load",r),e.addEventListener("error",i)}))}function Ta(e){return new Promise((function(t,n){if(!(e instanceof Blob))return n("bufferToImage - expected buf to be of type: Blob");var r=new FileReader;r.onload=function(){if("string"!=typeof r.result)return n("bufferToImage - expected reader.result to be a string, in onload");var e=xa.getEnv().createImageElement();e.onload=function(){return t(e)},e.onerror=n,e.src=r.result},r.onerror=n,r.readAsDataURL(e)}))}function ja(e){var t=xa.getEnv(),n=t.Image,r=t.Video;return e instanceof n?new Ai(e.naturalWidth,e.naturalHeight):e instanceof r?new Ai(e.videoWidth,e.videoHeight):new Ai(e.width,e.height)}function Ma(e){var t=e.width,n=e.height,r=(0,xa.getEnv().createCanvasElement)();return r.width=t,r.height=n,r}function Fa(e,t){var n=xa.getEnv().ImageData;if(!(e instanceof n||Oa(e)))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=t||ja(e),i=r.width,a=r.height,o=Ma({width:i,height:a});return e instanceof n?_a(o).putImageData(e,0,0):_a(o).drawImage(e,0,0,i,a),o}function Ia(e,t){return Object(Ci.b)(this,void 0,void 0,(function(){var n,r,i,a,o,s;return Object(Ci.d)(this,(function(u){switch(u.label){case 0:return n=t||xa.getEnv().createCanvasElement(),r=e.shape.slice(Mi(e)?1:0),i=r[0],a=r[1],o=r[2],s=Ei.tidy((function(){return e.as3D(i,a,o).toInt()})),[4,Ei.browser.toPixels(s,n)];case 1:return u.sent(),s.dispose(),[2,n]}}))}))}function Na(e){var t=xa.getEnv(),n=t.Image,r=t.Canvas,i=t.Video;return e instanceof n||e instanceof r||e instanceof i}function Ra(e,t,n){void 0===n&&(n=!1);var r=xa.getEnv(),i=r.Image,a=r.Canvas;if(!(e instanceof i||e instanceof a))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var o=ja(e),s=t/Math.max(o.height,o.width),u=s*o.width,c=s*o.height,l=Ma({width:t,height:t}),f=e instanceof a?e:Fa(e),d=Math.abs(u-c)/2,h=n&&u<c?d:0,p=n&&c<u?d:0;return _a(l).drawImage(f,h,p,u,c),l}var Pa=function(){function e(e,t){var n=this;if(void 0===t&&(t=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(e))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+e);this._treatAsBatchInput=t,this._batchSize=e.length,e.forEach((function(e,t){if(ji(e))return n._imageTensors[t]=e,void(n._inputDimensions[t]=e.shape);if(Mi(e)){var r=e.shape[0];if(1!==r)throw new Error("NetInput - tf.Tensor4D with batchSize "+r+" passed, but not supported in input array");return n._imageTensors[t]=e,void(n._inputDimensions[t]=e.shape.slice(1))}var i=e instanceof xa.getEnv().Canvas?e:Fa(e);n._canvases[t]=i,n._inputDimensions[t]=[i.height,i.width,3]}))}return Object.defineProperty(e.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reshapedInputDimensions",{get:function(){var e=this;return Li(this.batchSize,0,1).map((function(t,n){return e.getReshapedInputDimensions(n)}))},enumerable:!0,configurable:!0}),e.prototype.getInput=function(e){return this.canvases[e]||this.imageTensors[e]},e.prototype.getInputDimensions=function(e){return this._inputDimensions[e]},e.prototype.getInputHeight=function(e){return this._inputDimensions[e][0]},e.prototype.getInputWidth=function(e){return this._inputDimensions[e][1]},e.prototype.getReshapedInputDimensions=function(e){if("number"!=typeof this.inputSize)throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return Pi({width:this.getInputWidth(e),height:this.getInputHeight(e)},this.inputSize)},e.prototype.toBatchTensor=function(e,t){var n=this;return void 0===t&&(t=!0),this._inputSize=e,Ei.tidy((function(){var r=Li(n.batchSize,0,1).map((function(r){var i=n.getInput(r);if(i instanceof Ei.Tensor){var a=Mi(i)?i:i.expandDims();return(a=Ji(a,t)).shape[1]===e&&a.shape[2]===e||(a=Ei.image.resizeBilinear(a,[e,e])),a.as3D(e,e,3)}if(i instanceof xa.getEnv().Canvas)return Ei.browser.fromPixels(Ra(i,e,t));throw new Error("toBatchTensor - at batchIdx "+r+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+i)}));return Ei.stack(r.map((function(e){return e.toFloat()}))).as4D(n.batchSize,e,e,3)}))},e}();function Ba(e){return Object(Ci.b)(this,void 0,void 0,(function(){var t,n,r;return Object(Ci.d)(this,(function(i){switch(i.label){case 0:if(e instanceof Pa)return[2,e];if(!(t=Array.isArray(e)?e:[e]).length)throw new Error("toNetInput - empty array passed as input");return n=function(t){return Array.isArray(e)?" at input index "+t+":":""},(r=t.map(wa)).forEach((function(e,r){if(!Na(e)&&!ji(e)&&!Mi(e)){if("string"==typeof t[r])throw new Error("toNetInput -"+n(r)+" string passed, but could not resolve HTMLElement for element id "+t[r]);throw new Error("toNetInput -"+n(r)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id")}if(Mi(e)){var i=e.shape[0];if(1!==i)throw new Error("toNetInput -"+n(r)+" tf.Tensor4D with batchSize "+i+" passed, but not supported in input array")}})),[4,Promise.all(r.map((function(e){return Na(e)&&Da(e)})))];case 1:return i.sent(),[2,new Pa(r,Array.isArray(e))]}}))}))}function La(e,t){return Object(Ci.b)(this,void 0,void 0,(function(){var n,r,i,a,o,s;return Object(Ci.d)(this,(function(u){switch(u.label){case 0:return n=xa.getEnv().Canvas,r=e,e instanceof n?[3,5]:[4,Ba(e)];case 1:if((i=u.sent()).batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return(a=i.getInput(0))instanceof n?(o=a,[3,4]):[3,2];case 2:return[4,Ia(a)];case 3:o=u.sent(),u.label=4;case 4:r=o,u.label=5;case 5:return s=_a(r),[2,t.map((function(e){return e instanceof Hi?e.forSize(r.width,r.height).box.floor():e})).map((function(e){return e.clipAtImageBorders(r.width,r.height)})).map((function(e){var t=e.x,n=e.y,r=e.width,i=e.height,a=Ma({width:r,height:i});return _a(a).putImageData(s.getImageData(t,n,r,i),0,0),a}))]}}))}))}function za(e,t){return Object(Ci.b)(this,void 0,void 0,(function(){return Object(Ci.d)(this,(function(n){if(!ji(e)&&!Mi(e))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(Mi(e)&&e.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,Ei.tidy((function(){var n=e.shape.slice(Mi(e)?1:0),r=n[0],i=n[1],a=n[2];return t.map((function(e){return e instanceof Hi?e.forSize(i,r).box:e})).map((function(e){return e.clipAtImageBorders(i,r)})).map((function(t){var n=t.x,o=t.y,s=t.width,u=t.height;return Ei.slice3d(e.as3D(r,i,a),[o,n,0],[u,s,a])}))}))]}))}))}function Ua(e,t){return Object(Ci.b)(this,void 0,void 0,(function(){var n;return Object(Ci.d)(this,(function(r){switch(r.label){case 0:return[4,(0,xa.getEnv().fetch)(e,t)];case 1:if(!((n=r.sent()).status<400))throw new Error("failed to fetch: ("+n.status+") "+n.statusText+", from url: "+n.url);return[2,n]}}))}))}function Wa(e){return Object(Ci.b)(this,void 0,void 0,(function(){var t,n;return Object(Ci.d)(this,(function(r){switch(r.label){case 0:return[4,Ua(e)];case 1:return[4,(t=r.sent()).blob()];case 2:if(!(n=r.sent()).type.startsWith("image/"))throw new Error("fetchImage - expected blob type to be of type image/*, instead have: "+n.type+", for url: "+t.url);return[2,Ta(n)]}}))}))}function Va(e){return Object(Ci.b)(this,void 0,void 0,(function(){return Object(Ci.d)(this,(function(t){switch(t.label){case 0:return[4,Ua(e)];case 1:return[2,t.sent().json()]}}))}))}function Ga(e){return Object(Ci.b)(this,void 0,void 0,(function(){var t;return Object(Ci.d)(this,(function(n){switch(n.label){case 0:return t=Float32Array.bind,[4,Ua(e)];case 1:return[4,n.sent().arrayBuffer()];case 2:return[2,new(t.apply(Float32Array,[void 0,n.sent()]))]}}))}))}function qa(e,t){var n=t+"-weights_manifest.json";if(!e)return{modelBaseUri:"",manifestUri:n};if("/"===e)return{modelBaseUri:"/",manifestUri:"/"+n};var r=e.startsWith("http://")?"http://":e.startsWith("https://")?"https://":"",i=(e=e.replace(r,"")).split("/").filter((function(e){return e})),a=e.endsWith(".json")?i[i.length-1]:n,o=r+(e.endsWith(".json")?i.slice(0,i.length-1):i).join("/");return{modelBaseUri:o=e.startsWith("/")?"/"+o:o,manifestUri:"/"===o?"/"+a:o+"/"+a}}function Ha(e,t){return Object(Ci.b)(this,void 0,void 0,(function(){var n,r,i,a;return Object(Ci.d)(this,(function(o){switch(o.label){case 0:return n=qa(e,t),r=n.manifestUri,i=n.modelBaseUri,[4,Va(r)];case 1:return a=o.sent(),[2,Ei.io.loadWeights(a,i)]}}))}))}function Xa(e,t,n){void 0===n&&(n=!1);var r=n?ja(t):t,i=r.width,a=r.height;return e.width=i,e.height=a,{width:i,height:a}}var Ka=function(){function e(e){this._name=e,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(e.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),e.prototype.getParamFromPath=function(e){var t=this.traversePropertyPath(e);return t.obj[t.objProp]},e.prototype.reassignParamFromPath=function(e,t){var n=this.traversePropertyPath(e),r=n.obj,i=n.objProp;r[i].dispose(),r[i]=t},e.prototype.getParamList=function(){var e=this;return this._paramMappings.map((function(t){var n=t.paramPath;return{path:n,tensor:e.getParamFromPath(n)}}))},e.prototype.getTrainableParams=function(){return this.getParamList().filter((function(e){return e.tensor instanceof Ei.Variable}))},e.prototype.getFrozenParams=function(){return this.getParamList().filter((function(e){return!(e.tensor instanceof Ei.Variable)}))},e.prototype.variable=function(){var e=this;this.getFrozenParams().forEach((function(t){var n=t.path,r=t.tensor;e.reassignParamFromPath(n,r.variable())}))},e.prototype.freeze=function(){var e=this;this.getTrainableParams().forEach((function(t){var n=t.path,r=t.tensor,i=Ei.tensor(r.dataSync());r.dispose(),e.reassignParamFromPath(n,i)}))},e.prototype.dispose=function(e){void 0===e&&(e=!0),this.getParamList().forEach((function(t){if(e&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+t.path);t.tensor.dispose()})),this._params=void 0},e.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map((function(e){var t=e.tensor;return Array.from(t.dataSync())})).reduce((function(e,t){return e.concat(t)})))},e.prototype.load=function(e){return Object(Ci.b)(this,void 0,void 0,(function(){return Object(Ci.d)(this,(function(t){switch(t.label){case 0:return e instanceof Float32Array?(this.extractWeights(e),[2]):[4,this.loadFromUri(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.loadFromUri=function(e){return Object(Ci.b)(this,void 0,void 0,(function(){var t;return Object(Ci.d)(this,(function(n){switch(n.label){case 0:if(e&&"string"!=typeof e)throw new Error(this._name+".loadFromUri - expected model uri");return[4,Ha(e,this.getDefaultModelName())];case 1:return t=n.sent(),this.loadFromWeightMap(t),[2]}}))}))},e.prototype.loadFromDisk=function(e){return Object(Ci.b)(this,void 0,void 0,(function(){var t,n,r,i,a,o,s,u,c,l;return Object(Ci.d)(this,(function(f){switch(f.label){case 0:if(e&&"string"!=typeof e)throw new Error(this._name+".loadFromDisk - expected model file path");return t=xa.getEnv().readFile,n=qa(e,this.getDefaultModelName()),r=n.manifestUri,i=n.modelBaseUri,a=function(e){return Promise.all(e.map((function(e){return t(e).then((function(e){return e.buffer}))})))},o=Ei.io.weightsLoaderFactory(a),c=(u=JSON).parse,[4,t(r)];case 1:return s=c.apply(u,[f.sent().toString()]),[4,o(s,i)];case 2:return l=f.sent(),this.loadFromWeightMap(l),[2]}}))}))},e.prototype.loadFromWeightMap=function(e){var t=this.extractParamsFromWeigthMap(e),n=t.paramMappings,r=t.params;this._paramMappings=n,this._params=r},e.prototype.extractWeights=function(e){var t=this.extractParams(e),n=t.paramMappings,r=t.params;this._paramMappings=n,this._params=r},e.prototype.traversePropertyPath=function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=e.split("/").reduce((function(t,n){if(!t.nextObj.hasOwnProperty(n))throw new Error("traversePropertyPath - object does not have property "+n+", for path "+e);return{obj:t.nextObj,objProp:n,nextObj:t.nextObj[n]}}),{nextObj:this.params}),n=t.obj,r=t.objProp;if(!(n&&r&&n[r]instanceof Ei.Tensor))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+e);return{obj:n,objProp:r}},e}();function Ya(e,t,n){return Ei.tidy((function(){var r=Ei.separableConv2d(e,t.depthwise_filter,t.pointwise_filter,n,"same");return Ei.add(r,t.bias)}))}function $a(e,t,n){return void 0===n&&(n=!1),Ei.tidy((function(){var r=Ei.relu(n?Ei.add(Ei.conv2d(e,t.conv0.filters,[2,2],"same"),t.conv0.bias):Ya(e,t.conv0,[2,2])),i=Ya(r,t.conv1,[1,1]),a=Ya(Ei.relu(Ei.add(r,i)),t.conv2,[1,1]);return Ei.relu(Ei.add(r,Ei.add(i,a)))}))}function Ja(e,t,n,r){return void 0===n&&(n=!1),void 0===r&&(r=!0),Ei.tidy((function(){var i=Ei.relu(n?Ei.add(Ei.conv2d(e,t.conv0.filters,r?[2,2]:[1,1],"same"),t.conv0.bias):Ya(e,t.conv0,r?[2,2]:[1,1])),a=Ya(i,t.conv1,[1,1]),o=Ya(Ei.relu(Ei.add(i,a)),t.conv2,[1,1]),s=Ya(Ei.relu(Ei.add(i,Ei.add(a,o))),t.conv3,[1,1]);return Ei.relu(Ei.add(i,Ei.add(a,Ei.add(o,s))))}))}function Za(e,t,n,r){return void 0===n&&(n="same"),void 0===r&&(r=!1),Ei.tidy((function(){var i=Ei.add(Ei.conv2d(e,t.filters,[1,1],n),t.bias);return r?Ei.relu(i):i}))}function Qa(e,t){Object.keys(e).forEach((function(n){t.some((function(e){return e.originalPath===n}))||e[n].dispose()}))}function eo(e,t){return function(n,r,i,a){var o=Ei.tensor4d(e(n*r*i*i),[i,i,n,r]),s=Ei.tensor1d(e(r));return t.push({paramPath:a+"/filters"},{paramPath:a+"/bias"}),{filters:o,bias:s}}}function to(e,t){return function(n,r,i){var a=Ei.tensor2d(e(n*r),[n,r]),o=Ei.tensor1d(e(r));return t.push({paramPath:i+"/weights"},{paramPath:i+"/bias"}),{weights:a,bias:o}}}var no=function(e,t,n){this.depthwise_filter=e,this.pointwise_filter=t,this.bias=n};function ro(e,t){return function(n,r,i){var a=Ei.tensor4d(e(9*n),[3,3,n,1]),o=Ei.tensor4d(e(n*r),[1,1,n,r]),s=Ei.tensor1d(e(r));return t.push({paramPath:i+"/depthwise_filter"},{paramPath:i+"/pointwise_filter"},{paramPath:i+"/bias"}),new no(a,o,s)}}function io(e){return function(t){var n=e(t+"/depthwise_filter",4),r=e(t+"/pointwise_filter",4),i=e(t+"/bias",1);return new no(n,r,i)}}function ao(e,t){return function(n,r,i){var a=e[n];if(!Oi(a,r))throw new Error("expected weightMap["+n+"] to be a Tensor"+r+"D, instead have "+a);return t.push({originalPath:n,paramPath:i||n}),a}}function oo(e){var t=e;return{extractWeights:function(e){var n=t.slice(0,e);return t=t.slice(e),n},getRemainingWeights:function(){return t}}}function so(e,t){var n=eo(e,t),r=ro(e,t);function i(e,t,i,a){return void 0===a&&(a=!1),{conv0:a?n(e,t,3,i+"/conv0"):r(e,t,i+"/conv0"),conv1:r(t,t,i+"/conv1"),conv2:r(t,t,i+"/conv2")}}return{extractDenseBlock3Params:i,extractDenseBlock4Params:function(e,t,n,a){void 0===a&&(a=!1);var o=i(e,t,n,a);return{conv0:o.conv0,conv1:o.conv1,conv2:o.conv2,conv3:r(t,t,n+"/conv3")}}}}function uo(e){return function(t){return{filters:e(t+"/filters",4),bias:e(t+"/bias",1)}}}function co(e,t){var n=ao(e,t),r=uo(n),i=io(n);return{extractDenseBlock3Params:function(e,t){return void 0===t&&(t=!1),{conv0:t?r(e+"/conv0"):i(e+"/conv0"),conv1:i(e+"/conv1"),conv2:i(e+"/conv2")}},extractDenseBlock4Params:function(e,t){return void 0===t&&(t=!1),{conv0:t?r(e+"/conv0"):i(e+"/conv0"),conv1:i(e+"/conv1"),conv2:i(e+"/conv2"),conv3:i(e+"/conv3")}}}}var lo=function(e){function t(){return e.call(this,"FaceFeatureExtractor")||this}return Object(Ci.c)(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("FaceFeatureExtractor - load model before inference");return Ei.tidy((function(){var n=Ja($i(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(Ei.scalar(255)),t.dense0,!0);return n=Ja(n=Ja(n=Ja(n,t.dense1),t.dense2),t.dense3),Ei.avgPool(n,[7,7],[2,2],"valid")}))},t.prototype.forward=function(e){return Object(Ci.b)(this,void 0,void 0,(function(){var t;return Object(Ci.d)(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,Ba(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(e){var t=[],n=co(e,t).extractDenseBlock4Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2"),dense3:n("dense3")};return Qa(e,t),{params:r,paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function(e){var t=[],n=oo(e),r=n.extractWeights,i=n.getRemainingWeights,a=so(r,t).extractDenseBlock4Params,o=a(3,32,"dense0",!0),s=a(32,64,"dense1"),u=a(64,128,"dense2"),c=a(128,256,"dense3");if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:t,params:{dense0:o,dense1:s,dense2:u,dense3:c}}}(e)},t}(Ka);function fo(e,t){return Ei.tidy((function(){return Ei.add(Ei.matMul(e,t.weights),t.bias)}))}function ho(e){var t={},n={};return Object.keys(e).forEach((function(r){(r.startsWith("fc")?n:t)[r]=e[r]})),{featureExtractorMap:t,classifierMap:n}}var po=function(e){function t(t,n){var r=e.call(this,t)||this;return r._faceFeatureExtractor=n,r}return Object(Ci.c)(t,e),Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var t=this,n=this.params;if(!n)throw new Error(this._name+" - load model before inference");return Ei.tidy((function(){var r=e instanceof Pa?t.faceFeatureExtractor.forwardInput(e):e;return fo(r.as2D(r.shape[0],-1),n.fc)}))},t.prototype.dispose=function(t){void 0===t&&(t=!0),this.faceFeatureExtractor.dispose(t),e.prototype.dispose.call(this,t)},t.prototype.loadClassifierParams=function(e){var t=this.extractClassifierParams(e),n=t.params,r=t.paramMappings;this._params=n,this._paramMappings=r},t.prototype.extractClassifierParams=function(e){return function(e,t,n){var r=[],i=oo(e),a=i.extractWeights,o=i.getRemainingWeights,s=to(a,r)(t,n,"fc");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:r,params:{fc:s}}}(e,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},t.prototype.extractParamsFromWeigthMap=function(e){var t=ho(e),n=t.featureExtractorMap,r=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(e){var t=[],n=ao(e,t),r={fc:function(e){return{weights:n(e+"/weights",2),bias:n(e+"/bias",1)}}("fc")};return Qa(e,t),{params:r,paramMappings:t}}(r)},t.prototype.extractParams=function(e){var t=this.getClassifierChannelsIn(),n=this.getClassifierChannelsOut(),r=n*t+n,i=e.slice(0,e.length-r),a=e.slice(e.length-r);return this.faceFeatureExtractor.extractWeights(i),this.extractClassifierParams(a)},t}(Ka),mo=["neutral","happy","sad","angry","fearful","disgusted","surprised"],vo=function(){function e(e){var t=this;if(7!==e.length)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+e.length);mo.forEach((function(n,r){t[n]=e[r]}))}return e.prototype.asSortedArray=function(){var e=this;return mo.map((function(t){return{expression:t,probability:e[t]}})).sort((function(e,t){return t.probability-e.probability}))},e}(),go=function(e){function t(t){return void 0===t&&(t=new lo),e.call(this,"FaceExpressionNet",t)||this}return Object(Ci.c)(t,e),t.prototype.forwardInput=function(e){var t=this;return Ei.tidy((function(){return Ei.softmax(t.runNet(e))}))},t.prototype.forward=function(e){return Object(Ci.b)(this,void 0,void 0,(function(){var t;return Object(Ci.d)(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,Ba(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.predictExpressions=function(e){return Object(Ci.b)(this,void 0,void 0,(function(){var t,n,r,i,a=this;return Object(Ci.d)(this,(function(o){switch(o.label){case 0:return[4,Ba(e)];case 1:return t=o.sent(),[4,this.forwardInput(t)];case 2:return n=o.sent(),[4,Promise.all(Ei.unstack(n).map((function(e){return Object(Ci.b)(a,void 0,void 0,(function(){var t;return Object(Ci.d)(this,(function(n){switch(n.label){case 0:return[4,e.data()];case 1:return t=n.sent(),e.dispose(),[2,t]}}))}))})))];case 3:return r=o.sent(),n.dispose(),i=r.map((function(e){return new vo(e)})),[2,t.isBatchInput?i:i[0]]}}))}))},t.prototype.getDefaultModelName=function(){return"face_expression_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t.prototype.getClassifierChannelsOut=function(){return 7},t}(po);function yo(e){return e.expressions instanceof vo}function bo(e,t){var n={expressions:t};return Object.assign({},e,n)}function xo(e,t,n,r){void 0===n&&(n=.1),(Array.isArray(t)?t:[t]).forEach((function(t){var i=t instanceof vo?t:yo(t)?t.expressions:void 0;if(!i)throw new Error("drawFaceExpressions - expected faceExpressions to be FaceExpressions | WithFaceExpressions<{}> or array thereof");var a=i.asSortedArray().filter((function(e){return e.probability>n})),o=ca(t)?t.detection.box.bottomLeft:r||new Wi(0,0);new Ea(a.map((function(e){return e.expression+" ("+Ni(e.probability)+")"})),o).draw(e)}))}function wo(e){return ca(e)&&e.landmarks instanceof na&&e.unshiftedLandmarks instanceof na&&e.alignedRect instanceof Hi}function _o(e,t){var n=e.detection.box,r=t.shiftBy(n.x,n.y),i=r.align(),a=e.detection.imageDims,o={landmarks:r,unshiftedLandmarks:t,alignedRect:new Hi(e.detection.score,i.rescale(a.reverse()),a)};return Object.assign({},e,o)}var ko=function(e){void 0===e&&(e={});var t=e.drawLines,n=void 0===t||t,r=e.drawPoints,i=void 0===r||r,a=e.lineWidth,o=e.lineColor,s=e.pointSize,u=e.pointColor;this.drawLines=n,this.drawPoints=i,this.lineWidth=a||1,this.pointSize=s||2,this.lineColor=o||"rgba(0, 255, 255, 1)",this.pointColor=u||"rgba(255, 0, 255, 1)"},Eo=function(){function e(e,t){void 0===t&&(t={}),this.faceLandmarks=e,this.options=new ko(t)}return e.prototype.draw=function(e){var t=_a(e),n=this.options,r=n.drawLines,i=n.drawPoints,a=n.lineWidth,o=n.lineColor,s=n.pointSize,u=n.pointColor;r&&this.faceLandmarks instanceof ia&&(t.strokeStyle=o,t.lineWidth=a,Si(t,this.faceLandmarks.getJawOutline()),Si(t,this.faceLandmarks.getLeftEyeBrow()),Si(t,this.faceLandmarks.getRightEyeBrow()),Si(t,this.faceLandmarks.getNose()),Si(t,this.faceLandmarks.getLeftEye(),!0),Si(t,this.faceLandmarks.getRightEye(),!0),Si(t,this.faceLandmarks.getMouth(),!0)),i&&(t.strokeStyle=u,t.fillStyle=u,this.faceLandmarks.positions.forEach((function(e){t.beginPath(),t.arc(e.x,e.y,s,0,2*Math.PI),t.fill()})))},e}();function So(e,t){(Array.isArray(t)?t:[t]).forEach((function(t){var n=t instanceof na?t:wo(t)?t.landmarks:void 0;if(!n)throw new Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new Eo(n).draw(e)}))}function Co(e,t){var n=[],r=oo(e),i=r.extractWeights,a=r.getRemainingWeights,o=function(e,t){var n=eo(e,t),r=ro(e,t);return{extractConvParams:n,extractSeparableConvParams:r,extractReductionBlockParams:function(e,t,i){return{separable_conv0:r(e,t,i+"/separable_conv0"),separable_conv1:r(t,t,i+"/separable_conv1"),expansion_conv:n(e,t,1,i+"/expansion_conv")}},extractMainBlockParams:function(e,t){return{separable_conv0:r(e,e,t+"/separable_conv0"),separable_conv1:r(e,e,t+"/separable_conv1"),separable_conv2:r(e,e,t+"/separable_conv2")}}}}(i,n),s=o.extractConvParams,u=o.extractSeparableConvParams,c=o.extractReductionBlockParams,l=o.extractMainBlockParams,f={conv_in:s(3,32,3,"entry_flow/conv_in"),reduction_block_0:c(32,64,"entry_flow/reduction_block_0"),reduction_block_1:c(64,128,"entry_flow/reduction_block_1")},d={};Li(t,0,1).forEach((function(e){d["main_block_"+e]=l(128,"middle_flow/main_block_"+e)}));var h={reduction_block:c(128,256,"exit_flow/reduction_block"),separable_conv:u(256,512,"exit_flow/separable_conv")};if(0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:n,params:{entry_flow:f,middle_flow:d,exit_flow:h}}}function Ao(e,t){var n=[],r=function(e,t){var n=ao(e,t),r=uo(n),i=io(n);return{extractConvParams:r,extractSeparableConvParams:i,extractReductionBlockParams:function(e){return{separable_conv0:i(e+"/separable_conv0"),separable_conv1:i(e+"/separable_conv1"),expansion_conv:r(e+"/expansion_conv")}},extractMainBlockParams:function(e){return{separable_conv0:i(e+"/separable_conv0"),separable_conv1:i(e+"/separable_conv1"),separable_conv2:i(e+"/separable_conv2")}}}}(e,n),i=r.extractConvParams,a=r.extractSeparableConvParams,o=r.extractReductionBlockParams,s=r.extractMainBlockParams,u={conv_in:i("entry_flow/conv_in"),reduction_block_0:o("entry_flow/reduction_block_0"),reduction_block_1:o("entry_flow/reduction_block_1")},c={};Li(t,0,1).forEach((function(e){c["main_block_"+e]=s("middle_flow/main_block_"+e)}));var l={reduction_block:o("exit_flow/reduction_block"),separable_conv:a("exit_flow/separable_conv")};return Qa(e,n),{params:{entry_flow:u,middle_flow:c,exit_flow:l},paramMappings:n}}function Oo(e,t,n){return Ei.add(Ei.conv2d(e,t.filters,n,"same"),t.bias)}function Do(e,t,n){void 0===n&&(n=!0);var r=n?Ei.relu(e):e;return r=Ya(r,t.separable_conv0,[1,1]),r=Ya(Ei.relu(r),t.separable_conv1,[1,1]),r=Ei.maxPool(r,[3,3],[2,2],"same"),Ei.add(r,Oo(e,t.expansion_conv,[2,2]))}var To,jo=function(e){function t(t){var n=e.call(this,"TinyXception")||this;return n._numMainBlocks=t,n}return Object(Ci.c)(t,e),t.prototype.forwardInput=function(e){var t=this,n=this.params;if(!n)throw new Error("TinyXception - load model before inference");return Ei.tidy((function(){var r=$i(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(Ei.scalar(256)),i=Ei.relu(Oo(r,n.entry_flow.conv_in,[2,2]));return i=Do(i=Do(i,n.entry_flow.reduction_block_0,!1),n.entry_flow.reduction_block_1),Li(t._numMainBlocks,0,1).forEach((function(e){i=function(e,t){var n=Ya(Ei.relu(e),t.separable_conv0,[1,1]);return n=Ya(Ei.relu(n),t.separable_conv1,[1,1]),n=Ya(Ei.relu(n),t.separable_conv2,[1,1]),Ei.add(n,e)}(i,n.middle_flow["main_block_"+e])})),i=Do(i,n.exit_flow.reduction_block),i=Ei.relu(Ya(i,n.exit_flow.separable_conv,[1,1]))}))},t.prototype.forward=function(e){return Object(Ci.b)(this,void 0,void 0,(function(){var t;return Object(Ci.d)(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,Ba(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.getDefaultModelName=function(){return"tiny_xception_model"},t.prototype.extractParamsFromWeigthMap=function(e){return Ao(e,this._numMainBlocks)},t.prototype.extractParams=function(e){return Co(e,this._numMainBlocks)},t}(Ka);!function(e){e.FEMALE="female",e.MALE="male"}(To||(To={}));var Mo=function(e){function t(t){void 0===t&&(t=new jo(2));var n=e.call(this,"AgeGenderNet")||this;return n._faceFeatureExtractor=t,n}return Object(Ci.c)(t,e),Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var t=this,n=this.params;if(!n)throw new Error(this._name+" - load model before inference");return Ei.tidy((function(){var r=e instanceof Pa?t.faceFeatureExtractor.forwardInput(e):e,i=Ei.avgPool(r,[7,7],[2,2],"valid").as2D(r.shape[0],-1);return{age:fo(i,n.fc.age).as1D(),gender:fo(i,n.fc.gender)}}))},t.prototype.forwardInput=function(e){var t=this;return Ei.tidy((function(){var n=t.runNet(e),r=n.age,i=n.gender;return{age:r,gender:Ei.softmax(i)}}))},t.prototype.forward=function(e){return Object(Ci.b)(this,void 0,void 0,(function(){var t;return Object(Ci.d)(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,Ba(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.predictAgeAndGender=function(e){return Object(Ci.b)(this,void 0,void 0,(function(){var t,n,r,i,a,o,s=this;return Object(Ci.d)(this,(function(u){switch(u.label){case 0:return[4,Ba(e)];case 1:return t=u.sent(),[4,this.forwardInput(t)];case 2:return n=u.sent(),r=Ei.unstack(n.age),i=Ei.unstack(n.gender),a=r.map((function(e,t){return{ageTensor:e,genderTensor:i[t]}})),[4,Promise.all(a.map((function(e){var t=e.ageTensor,n=e.genderTensor;return Object(Ci.b)(s,void 0,void 0,(function(){var e,r,i,a,o;return Object(Ci.d)(this,(function(s){switch(s.label){case 0:return[4,t.data()];case 1:return e=s.sent()[0],[4,n.data()];case 2:return r=s.sent()[0],a=(i=r>.5)?To.MALE:To.FEMALE,o=i?r:1-r,t.dispose(),n.dispose(),[2,{age:e,gender:a,genderProbability:o}]}}))}))})))];case 3:return o=u.sent(),n.age.dispose(),n.gender.dispose(),[2,t.isBatchInput?o:o[0]]}}))}))},t.prototype.getDefaultModelName=function(){return"age_gender_model"},t.prototype.dispose=function(t){void 0===t&&(t=!0),this.faceFeatureExtractor.dispose(t),e.prototype.dispose.call(this,t)},t.prototype.loadClassifierParams=function(e){var t=this.extractClassifierParams(e),n=t.params,r=t.paramMappings;this._params=n,this._paramMappings=r},t.prototype.extractClassifierParams=function(e){return function(e){var t=[],n=oo(e),r=n.extractWeights,i=n.getRemainingWeights,a=to(r,t),o=a(512,1,"fc/age"),s=a(512,2,"fc/gender");if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:t,params:{fc:{age:o,gender:s}}}}(e)},t.prototype.extractParamsFromWeigthMap=function(e){var t=ho(e),n=t.featureExtractorMap,r=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(e){var t=[],n=ao(e,t);function r(e){return{weights:n(e+"/weights",2),bias:n(e+"/bias",1)}}var i={fc:{age:r("fc/age"),gender:r("fc/gender")}};return Qa(e,t),{params:i,paramMappings:t}}(r)},t.prototype.extractParams=function(e){var t=e.slice(0,e.length-1539),n=e.slice(e.length-1539);return this.faceFeatureExtractor.extractWeights(t),this.extractClassifierParams(n)},t}(Ka),Fo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(Ci.c)(t,e),t.prototype.postProcess=function(e,t,n){var r=n.map((function(e){var n=e.width,r=e.height,i=t/Math.max(r,n);return{width:n*i,height:r*i}})),i=r.length;return Ei.tidy((function(){var n=function(e,t){return Ei.stack([Ei.fill([68],e),Ei.fill([68],t)],1).as2D(1,136).as1D()},a=function(e,t){var n=r[e],i=n.width,a=n.height;return t(i,a)?Math.abs(i-a)/2:0};return e.mul(Ei.fill([i,136],t)).sub(Ei.stack(Array.from(Array(i),(function(e,t){return n(function(e){return a(e,(function(e,t){return e<t}))}(t),function(e){return a(e,(function(e,t){return t<e}))}(t))})))).div(Ei.stack(Array.from(Array(i),(function(e,t){return n(r[t].width,r[t].height)}))))}))},t.prototype.forwardInput=function(e){var t=this;return Ei.tidy((function(){var n=t.runNet(e);return t.postProcess(n,e.inputSize,e.inputDimensions.map((function(e){return{height:e[0],width:e[1]}})))}))},t.prototype.forward=function(e){return Object(Ci.b)(this,void 0,void 0,(function(){var t;return Object(Ci.d)(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,Ba(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.detectLandmarks=function(e){return Object(Ci.b)(this,void 0,void 0,(function(){var t,n,r,i=this;return Object(Ci.d)(this,(function(a){switch(a.label){case 0:return[4,Ba(e)];case 1:return t=a.sent(),n=Ei.tidy((function(){return Ei.unstack(i.forwardInput(t))})),[4,Promise.all(n.map((function(e,n){return Object(Ci.b)(i,void 0,void 0,(function(){var r,i,a,o,s;return Object(Ci.d)(this,(function(u){switch(u.label){case 0:return a=(i=Array).from,[4,e.data()];case 1:return r=a.apply(i,[u.sent()]),o=r.filter((function(e,t){return Ii(t)})),s=r.filter((function(e,t){return!Ii(t)})),[2,new ia(Array(68).fill(0).map((function(e,t){return new Wi(o[t],s[t])})),{height:t.getInputHeight(n),width:t.getInputWidth(n)})]}}))}))})))];case 2:return r=a.sent(),n.forEach((function(e){return e.dispose()})),[2,t.isBatchInput?r:r[0]]}}))}))},t.prototype.getClassifierChannelsOut=function(){return 136},t}(po),Io=function(e){function t(t){return void 0===t&&(t=new lo),e.call(this,"FaceLandmark68Net",t)||this}return Object(Ci.c)(t,e),t.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t}(Fo),No=function(e){function t(){return e.call(this,"TinyFaceFeatureExtractor")||this}return Object(Ci.c)(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("TinyFaceFeatureExtractor - load model before inference");return Ei.tidy((function(){var n=$a($i(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(Ei.scalar(255)),t.dense0,!0);return n=$a(n=$a(n,t.dense1),t.dense2),Ei.avgPool(n,[14,14],[2,2],"valid")}))},t.prototype.forward=function(e){return Object(Ci.b)(this,void 0,void 0,(function(){var t;return Object(Ci.d)(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,Ba(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(e){var t=[],n=co(e,t).extractDenseBlock3Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2")};return Qa(e,t),{params:r,paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function(e){var t=[],n=oo(e),r=n.extractWeights,i=n.getRemainingWeights,a=so(r,t).extractDenseBlock3Params,o=a(3,32,"dense0",!0),s=a(32,64,"dense1"),u=a(64,128,"dense2");if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:t,params:{dense0:o,dense1:s,dense2:u}}}(e)},t}(Ka),Ro=function(e){function t(t){return void 0===t&&(t=new No),e.call(this,"FaceLandmark68TinyNet",t)||this}return Object(Ci.c)(t,e),t.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},t.prototype.getClassifierChannelsIn=function(){return 128},t}(Fo),Po=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(Ci.c)(t,e),t}(Io);function Bo(e,t,n,r,i){void 0===i&&(i="same");var a=t.conv,o=a.filters,s=a.bias,u=Ei.conv2d(e,o,n,i);return u=function(e,t){return Ei.add(Ei.mul(e,t.weights),t.biases)}(u=Ei.add(u,s),t.scale),r?Ei.relu(u):u}function Lo(e,t){return Bo(e,t,[1,1],!1)}function zo(e,t){return Bo(e,t,[2,2],!0,"valid")}function Uo(e,t){function n(n,r,i,a){var o=function(t,n,r){var i=e(t),a=i.length/(n*r*r);if(Fi(a))throw new Error("depth has to be an integer: "+a+", weights.length: "+i.length+", numFilters: "+n+", filterSize: "+r);return Ei.tidy((function(){return Ei.transpose(Ei.tensor4d(i,[n,a,r,r]),[2,3,1,0])}))}(n,r,i),s=Ei.tensor1d(e(r));return t.push({paramPath:a+"/filters"},{paramPath:a+"/bias"}),{filters:o,bias:s}}function r(r,i,a,o){return{conv:n(r,i,a,o+"/conv"),scale:function(n,r){var i=Ei.tensor1d(e(n)),a=Ei.tensor1d(e(n));return t.push({paramPath:r+"/weights"},{paramPath:r+"/biases"}),{weights:i,biases:a}}(i,o+"/scale")}}return{extractConvLayerParams:r,extractResidualLayerParams:function(e,t,n,i,a){return void 0===a&&(a=!1),{conv1:r((a?.5:1)*e,t,n,i+"/conv1"),conv2:r(e,t,n,i+"/conv2")}}}}function Wo(e,t){var n=ao(e,t);function r(e){return{conv:{filters:n(e+"/conv/filters",4),bias:n(e+"/conv/bias",1)},scale:function(e){return{weights:n(e+"/scale/weights",1),biases:n(e+"/scale/biases",1)}}(e)}}return{extractConvLayerParams:r,extractResidualLayerParams:function(e){return{conv1:r(e+"/conv1"),conv2:r(e+"/conv2")}}}}function Vo(e,t){var n=function(e,t){return Bo(e,t,[1,1],!0)}(e,t.conv1);return n=Lo(n,t.conv2),n=Ei.add(n,e),Ei.relu(n)}function Go(e,t){var n=zo(e,t.conv1);n=Lo(n,t.conv2);var r=Ei.avgPool(e,2,2,"valid"),i=Ei.zeros(r.shape),a=r.shape[3]!==n.shape[3];if(r.shape[1]!==n.shape[1]||r.shape[2]!==n.shape[2]){var o=Object(Ci.e)(n.shape);o[1]=1;var s=Ei.zeros(o);n=Ei.concat([n,s],1);var u=Object(Ci.e)(n.shape);u[2]=1;var c=Ei.zeros(u);n=Ei.concat([n,c],2)}return r=a?Ei.concat([r,i],3):r,n=Ei.add(r,n),Ei.relu(n)}var qo=function(e){function t(){return e.call(this,"FaceRecognitionNet")||this}return Object(Ci.c)(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("FaceRecognitionNet - load model before inference");return Ei.tidy((function(){var n=zo($i(e.toBatchTensor(150,!0).toFloat(),[122.782,117.001,104.298]).div(Ei.scalar(256)),t.conv32_down),r=(n=Go(n=Vo(n=Vo(n=Go(n=Vo(n=Vo(n=Go(n=Vo(n=Vo(n=Vo(n=Go(n=Vo(n=Vo(n=Vo(n=Ei.maxPool(n,3,2,"valid"),t.conv32_1),t.conv32_2),t.conv32_3),t.conv64_down),t.conv64_1),t.conv64_2),t.conv64_3),t.conv128_down),t.conv128_1),t.conv128_2),t.conv256_down),t.conv256_1),t.conv256_2),t.conv256_down_out)).mean([1,2]);return Ei.matMul(r,t.fc)}))},t.prototype.forward=function(e){return Object(Ci.b)(this,void 0,void 0,(function(){var t;return Object(Ci.d)(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,Ba(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.computeFaceDescriptor=function(e){return Object(Ci.b)(this,void 0,void 0,(function(){var t,n,r,i=this;return Object(Ci.d)(this,(function(a){switch(a.label){case 0:return[4,Ba(e)];case 1:return t=a.sent(),n=Ei.tidy((function(){return Ei.unstack(i.forwardInput(t))})),[4,Promise.all(n.map((function(e){return e.data()})))];case 2:return r=a.sent(),n.forEach((function(e){return e.dispose()})),[2,t.isBatchInput?r:r[0]]}}))}))},t.prototype.getDefaultModelName=function(){return"face_recognition_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(e){var t=[],n=Wo(e,t),r=n.extractConvLayerParams,i=n.extractResidualLayerParams,a=r("conv32_down"),o=i("conv32_1"),s=i("conv32_2"),u=i("conv32_3"),c=i("conv64_down"),l=i("conv64_1"),f=i("conv64_2"),d=i("conv64_3"),h=i("conv128_down"),p=i("conv128_1"),m=i("conv128_2"),v=i("conv256_down"),g=i("conv256_1"),y=i("conv256_2"),b=i("conv256_down_out"),x=e.fc;if(t.push({originalPath:"fc",paramPath:"fc"}),!Ti(x))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+x);var w={conv32_down:a,conv32_1:o,conv32_2:s,conv32_3:u,conv64_down:c,conv64_1:l,conv64_2:f,conv64_3:d,conv128_down:h,conv128_1:p,conv128_2:m,conv256_down:v,conv256_1:g,conv256_2:y,conv256_down_out:b,fc:x};return Qa(e,t),{params:w,paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function(e){var t=oo(e),n=t.extractWeights,r=t.getRemainingWeights,i=[],a=Uo(n,i),o=a.extractConvLayerParams,s=a.extractResidualLayerParams,u=o(4704,32,7,"conv32_down"),c=s(9216,32,3,"conv32_1"),l=s(9216,32,3,"conv32_2"),f=s(9216,32,3,"conv32_3"),d=s(36864,64,3,"conv64_down",!0),h=s(36864,64,3,"conv64_1"),p=s(36864,64,3,"conv64_2"),m=s(36864,64,3,"conv64_3"),v=s(147456,128,3,"conv128_down",!0),g=s(147456,128,3,"conv128_1"),y=s(147456,128,3,"conv128_2"),b=s(589824,256,3,"conv256_down",!0),x=s(589824,256,3,"conv256_1"),w=s(589824,256,3,"conv256_2"),_=s(589824,256,3,"conv256_down_out"),k=Ei.tidy((function(){return Ei.transpose(Ei.tensor2d(n(32768),[128,256]),[1,0])}));if(i.push({paramPath:"fc"}),0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{conv32_down:u,conv32_1:c,conv32_2:l,conv32_3:f,conv64_down:d,conv64_1:h,conv64_2:p,conv64_3:m,conv128_down:v,conv128_1:g,conv128_2:y,conv256_down:b,conv256_1:x,conv256_2:w,conv256_down_out:_,fc:k},paramMappings:i}}(e)},t}(Ka);function Ho(e){var t=new qo;return t.extractWeights(e),t}function Xo(e,t){var n={descriptor:t};return Object.assign({},e,n)}function Ko(e){return"number"==typeof e.age}function Yo(e,t){var n={age:t};return Object.assign({},e,n)}function $o(e){return(e.gender===To.MALE||e.gender===To.FEMALE)&&Ui(e.genderProbability)}function Jo(e,t,n){var r={gender:t,genderProbability:n};return Object.assign({},e,r)}var Zo=function(){function e(e){var t=void 0===e?{}:e,n=t.minFaceSize,r=t.scaleFactor,i=t.maxNumScales,a=t.scoreThresholds,o=t.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=n||20,this._scaleFactor=r||.709,this._maxNumScales=i||10,this._scoreThresholds=a||[.6,.7,.7],this._scaleSteps=o,"number"!=typeof this._minFaceSize||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if("number"!=typeof this._scaleFactor||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if("number"!=typeof this._maxNumScales||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||3!==this._scoreThresholds.length||this._scoreThresholds.some((function(e){return"number"!=typeof e})))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some((function(e){return"number"!=typeof e}))))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(e.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),e}();function Qo(e,t){function n(n,r,i,a,o){var s=Ei.tensor4d(e(n*r*i*i),[i,i,n,r]),u=Ei.tensor1d(e(r));return t.push({paramPath:a+"/filters"},{paramPath:a+"/"+(o?"batch_norm_offset":"bias")}),{filters:s,bias:u}}function r(e,t,r,i){var a=n(e,t,r,i,!0);return{filters:a.filters,batch_norm_offset:a.bias}}function i(n,i,a){return{depthwise_conv:function(n,r){var i=Ei.tensor4d(e(9*n),[3,3,n,1]),a=Ei.tensor1d(e(n)),o=Ei.tensor1d(e(n)),s=Ei.tensor1d(e(n)),u=Ei.tensor1d(e(n));return t.push({paramPath:r+"/filters"},{paramPath:r+"/batch_norm_scale"},{paramPath:r+"/batch_norm_offset"},{paramPath:r+"/batch_norm_mean"},{paramPath:r+"/batch_norm_variance"}),{filters:i,batch_norm_scale:a,batch_norm_offset:o,batch_norm_mean:s,batch_norm_variance:u}}(n,a+"/depthwise_conv"),pointwise_conv:r(n,i,1,a+"/pointwise_conv")}}return{extractMobilenetV1Params:function(){return{conv_0:r(3,32,3,"mobilenetv1/conv_0"),conv_1:i(32,64,"mobilenetv1/conv_1"),conv_2:i(64,128,"mobilenetv1/conv_2"),conv_3:i(128,128,"mobilenetv1/conv_3"),conv_4:i(128,256,"mobilenetv1/conv_4"),conv_5:i(256,256,"mobilenetv1/conv_5"),conv_6:i(256,512,"mobilenetv1/conv_6"),conv_7:i(512,512,"mobilenetv1/conv_7"),conv_8:i(512,512,"mobilenetv1/conv_8"),conv_9:i(512,512,"mobilenetv1/conv_9"),conv_10:i(512,512,"mobilenetv1/conv_10"),conv_11:i(512,512,"mobilenetv1/conv_11"),conv_12:i(512,1024,"mobilenetv1/conv_12"),conv_13:i(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function(){return{conv_0:r(1024,256,1,"prediction_layer/conv_0"),conv_1:r(256,512,3,"prediction_layer/conv_1"),conv_2:r(512,128,1,"prediction_layer/conv_2"),conv_3:r(128,256,3,"prediction_layer/conv_3"),conv_4:r(256,128,1,"prediction_layer/conv_4"),conv_5:r(128,256,3,"prediction_layer/conv_5"),conv_6:r(256,64,1,"prediction_layer/conv_6"),conv_7:r(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:n(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:n(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:n(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:n(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:n(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:n(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:n(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:n(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}function es(e){var t=[],n=function(e,t){var n=ao(e,t);function r(e,t,r){return{filters:n(e+"/Conv2d_"+t+"_pointwise/weights",4,r+"/filters"),batch_norm_offset:n(e+"/Conv2d_"+t+"_pointwise/convolution_bn_offset",1,r+"/batch_norm_offset")}}function i(e){var t="mobilenetv1/conv_"+e,i="MobilenetV1/Conv2d_"+e+"_depthwise",a=t+"/depthwise_conv",o=t+"/pointwise_conv";return{depthwise_conv:{filters:n(i+"/depthwise_weights",4,a+"/filters"),batch_norm_scale:n(i+"/BatchNorm/gamma",1,a+"/batch_norm_scale"),batch_norm_offset:n(i+"/BatchNorm/beta",1,a+"/batch_norm_offset"),batch_norm_mean:n(i+"/BatchNorm/moving_mean",1,a+"/batch_norm_mean"),batch_norm_variance:n(i+"/BatchNorm/moving_variance",1,a+"/batch_norm_variance")},pointwise_conv:r("MobilenetV1",e,o)}}function a(e,t){return{filters:n(e+"/weights",4,t+"/filters"),bias:n(e+"/biases",1,t+"/bias")}}function o(e){return{box_encoding_predictor:a("Prediction/BoxPredictor_"+e+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+e+"/box_encoding_predictor"),class_predictor:a("Prediction/BoxPredictor_"+e+"/ClassPredictor","prediction_layer/box_predictor_"+e+"/class_predictor")}}return{extractMobilenetV1Params:function(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:i(1),conv_2:i(2),conv_3:i(3),conv_4:i(4),conv_5:i(5),conv_6:i(6),conv_7:i(7),conv_8:i(8),conv_9:i(9),conv_10:i(10),conv_11:i(11),conv_12:i(12),conv_13:i(13)}},extractPredictionLayerParams:function(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:o(0),box_predictor_1:o(1),box_predictor_2:o(2),box_predictor_3:o(3),box_predictor_4:o(4),box_predictor_5:o(5)}}}}(e,t),r=n.extractMobilenetV1Params,i=n.extractPredictionLayerParams,a=e["Output/extra_dim"];if(t.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!ji(a))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+a);var o={mobilenetv1:r(),prediction_layer:i(),output_layer:{extra_dim:a}};return Qa(e,t),{params:o,paramMappings:t}}function ts(e,t,n){return Ei.tidy((function(){var r=Ei.conv2d(e,t.filters,n,"same");return r=Ei.add(r,t.batch_norm_offset),Ei.clipByValue(r,0,6)}))}var ns=.0010000000474974513;function rs(e,t){return Ei.tidy((function(){var n=null,r=ts(e,t.conv_0,[2,2]);if([t.conv_1,t.conv_2,t.conv_3,t.conv_4,t.conv_5,t.conv_6,t.conv_7,t.conv_8,t.conv_9,t.conv_10,t.conv_11,t.conv_12,t.conv_13].forEach((function(e,t){var i=t+1,a=function(e){return[2,4,6,12].some((function(t){return t===e}))?[2,2]:[1,1]}(i);r=ts(r=function(e,t,n){return Ei.tidy((function(){var r=Ei.depthwiseConv2d(e,t.filters,n,"same");return r=Ei.batchNorm(r,t.batch_norm_mean,t.batch_norm_variance,t.batch_norm_offset,t.batch_norm_scale,ns),Ei.clipByValue(r,0,6)}))}(r,e.depthwise_conv,a),e.pointwise_conv,[1,1]),11===i&&(n=r)})),null===n)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:n}}))}function is(e,t,n){var r=e.arraySync(),i=Math.min(r[t][0],r[t][2]),a=Math.min(r[t][1],r[t][3]),o=Math.max(r[t][0],r[t][2]),s=Math.max(r[t][1],r[t][3]),u=Math.min(r[n][0],r[n][2]),c=Math.min(r[n][1],r[n][3]),l=Math.max(r[n][0],r[n][2]),f=Math.max(r[n][1],r[n][3]),d=(o-i)*(s-a),h=(l-u)*(f-c);if(d<=0||h<=0)return 0;var p=Math.max(i,u),m=Math.max(a,c),v=Math.min(o,l),g=Math.min(s,f),y=Math.max(v-p,0)*Math.max(g-m,0);return y/(d+h-y)}function as(e,t){var n=function(e){var t=Ei.unstack(Ei.transpose(e,[1,0])),n=[Ei.sub(t[2],t[0]),Ei.sub(t[3],t[1])];return{sizes:n,centers:[Ei.add(t[0],Ei.div(n[0],Ei.scalar(2))),Ei.add(t[1],Ei.div(n[1],Ei.scalar(2)))]}}(e),r=n.sizes,i=n.centers,a=Ei.unstack(Ei.transpose(t,[1,0])),o=Ei.div(Ei.mul(Ei.exp(Ei.div(a[2],Ei.scalar(5))),r[0]),Ei.scalar(2)),s=Ei.add(Ei.mul(Ei.div(a[0],Ei.scalar(10)),r[0]),i[0]),u=Ei.div(Ei.mul(Ei.exp(Ei.div(a[3],Ei.scalar(5))),r[1]),Ei.scalar(2)),c=Ei.add(Ei.mul(Ei.div(a[1],Ei.scalar(10)),r[1]),i[1]);return Ei.transpose(Ei.stack([Ei.sub(s,o),Ei.sub(c,u),Ei.add(s,o),Ei.add(c,u)]),[1,0])}function os(e,t){return Ei.tidy((function(){var n=e.shape[0];return{boxPredictionEncoding:Ei.reshape(Za(e,t.box_encoding_predictor),[n,-1,1,4]),classPrediction:Ei.reshape(Za(e,t.class_predictor),[n,-1,3])}}))}var ss=function(){function e(e){var t=void 0===e?{}:e,n=t.minConfidence,r=t.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=n||.5,this._maxResults=r||100,"number"!=typeof this._minConfidence||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if("number"!=typeof this._maxResults)throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(e.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),e}(),us=function(e){function t(){return e.call(this,"SsdMobilenetv1")||this}return Object(Ci.c)(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("SsdMobilenetv1 - load model before inference");return Ei.tidy((function(){var n=e.toBatchTensor(512,!1).toFloat(),r=rs(Ei.sub(Ei.mul(n,Ei.scalar(.007843137718737125)),Ei.scalar(1)),t.mobilenetv1),i=function(e,t,n){return Ei.tidy((function(){var r=ts(ts(e,n.conv_0,[1,1]),n.conv_1,[2,2]),i=ts(ts(r,n.conv_2,[1,1]),n.conv_3,[2,2]),a=ts(ts(i,n.conv_4,[1,1]),n.conv_5,[2,2]),o=ts(ts(a,n.conv_6,[1,1]),n.conv_7,[2,2]),s=os(t,n.box_predictor_0),u=os(e,n.box_predictor_1),c=os(r,n.box_predictor_2),l=os(i,n.box_predictor_3),f=os(a,n.box_predictor_4),d=os(o,n.box_predictor_5);return{boxPredictions:Ei.concat([s.boxPredictionEncoding,u.boxPredictionEncoding,c.boxPredictionEncoding,l.boxPredictionEncoding,f.boxPredictionEncoding,d.boxPredictionEncoding],1),classPredictions:Ei.concat([s.classPrediction,u.classPrediction,c.classPrediction,l.classPrediction,f.classPrediction,d.classPrediction],1)}}))}(r.out,r.conv11,t.prediction_layer);return function(e,t,n){return Ei.tidy((function(){var r=e.shape[0],i=as(Ei.reshape(Ei.tile(n.extra_dim,[r,1,1]),[-1,4]),Ei.reshape(e,[-1,4]));i=Ei.reshape(i,[r,i.shape[0]/r,4]);var a=Ei.sigmoid(Ei.slice(t,[0,0,1],[-1,-1,-1])),o=Ei.slice(a,[0,0,0],[-1,-1,1]);return o=Ei.reshape(o,[r,o.shape[1]]),{boxes:Ei.unstack(i),scores:Ei.unstack(o)}}))}(i.boxPredictions,i.classPredictions,t.output_layer)}))},t.prototype.forward=function(e){return Object(Ci.b)(this,void 0,void 0,(function(){var t;return Object(Ci.d)(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,Ba(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.locateFaces=function(e,t){return void 0===t&&(t={}),Object(Ci.b)(this,void 0,void 0,(function(){var n,r,i,a,o,s,u,c,l,f,d,h,p,m,v,g,y,b,x,w;return Object(Ci.d)(this,(function(_){switch(_.label){case 0:return n=new ss(t),r=n.maxResults,i=n.minConfidence,[4,Ba(e)];case 1:for(a=_.sent(),o=this.forwardInput(a),s=o.boxes,u=o.scores,c=s[0],l=u[0],f=1;f<s.length;f++)s[f].dispose(),u[f].dispose();return p=(h=Array).from,[4,l.data()];case 2:return d=p.apply(h,[_.sent()]),m=function(e,t,n,r,i){var a=e.shape[0],o=Math.min(n,a),s=function(e){return e<=r?1:0},u=[];return t.map((function(e,t){return{score:e,boxIndex:t}})).filter((function(e){return e.score>i})).sort((function(e,t){return t.score-e.score})).forEach((function(t){if(!(u.length>=o)){for(var n=t.score,r=u.length-1;r>=0;--r){var a=is(e,t.boxIndex,u[r]);if(0!==a&&(t.score*=s(a),t.score<=i))break}n===t.score&&u.push(t.boxIndex)}})),u}(c,d,r,.5,i),v=a.getReshapedInputDimensions(0),g=a.inputSize,y=g/v.width,b=g/v.height,x=c.arraySync(),w=m.map((function(e){var t=[Math.max(0,x[e][0]),Math.min(1,x[e][2])].map((function(e){return e*b})),n=t[0],r=t[1],i=[Math.max(0,x[e][1]),Math.min(1,x[e][3])].map((function(e){return e*y})),o=i[0],s=i[1];return new Hi(d[e],new ta(o,n,s-o,r-n),{height:a.getInputHeight(0),width:a.getInputWidth(0)})})),c.dispose(),l.dispose(),[2,w]}}))}))},t.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},t.prototype.extractParamsFromWeigthMap=function(e){return es(e)},t.prototype.extractParams=function(e){return function(e){var t=[],n=oo(e),r=n.extractWeights,i=n.getRemainingWeights,a=Qo(r,t),o=a.extractMobilenetV1Params,s=a.extractPredictionLayerParams,u=o(),c=s(),l={extra_dim:Ei.tensor3d(r(20472),[1,5118,4])};if(t.push({paramPath:"output_layer/extra_dim"}),0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{params:{mobilenetv1:u,prediction_layer:c,output_layer:l},paramMappings:t}}(e)},t}(Ka);function cs(e){var t=new us;return t.extractWeights(e),t}function ls(e){return cs(e)}var fs,ds=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(Ci.c)(t,e),t}(us),hs=.4,ps=[new Wi(.738768,.874946),new Wi(2.42204,2.65704),new Wi(4.30971,7.04493),new Wi(10.246,4.59428),new Wi(12.6868,11.8741)],ms=[new Wi(1.603231,2.094468),new Wi(6.041143,7.080126),new Wi(2.882459,3.518061),new Wi(4.266906,5.178857),new Wi(9.041765,10.66308)],vs=[117.001,114.697,97.404],gs=function(e){return"number"==typeof e};function ys(e){if(!e)throw new Error("invalid config: "+e);if("boolean"!=typeof e.withSeparableConvs)throw new Error("config.withSeparableConvs has to be a boolean, have: "+e.withSeparableConvs);if(!gs(e.iouThreshold)||e.iouThreshold<0||e.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+e.iouThreshold);if(!Array.isArray(e.classes)||!e.classes.length||!e.classes.every((function(e){return"string"==typeof e})))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(e.classes));if(!Array.isArray(e.anchors)||!e.anchors.length||!e.anchors.map((function(e){return e||{}})).every((function(e){return gs(e.x)&&gs(e.y)})))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(e.anchors));if(e.meanRgb&&(!Array.isArray(e.meanRgb)||3!==e.meanRgb.length||!e.meanRgb.every(gs)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(e.meanRgb))}function bs(e){return Ei.tidy((function(){var t=Ei.mul(e,Ei.scalar(.10000000149011612));return Ei.add(Ei.relu(Ei.sub(e,t)),t)}))}function xs(e,t){return Ei.tidy((function(){var n=Ei.pad(e,[[0,0],[1,1],[1,1],[0,0]]);return n=Ei.conv2d(n,t.conv.filters,[1,1],"valid"),n=Ei.sub(n,t.bn.sub),n=Ei.mul(n,t.bn.truediv),bs(n=Ei.add(n,t.conv.bias))}))}function ws(e,t){return Ei.tidy((function(){var n=Ei.pad(e,[[0,0],[1,1],[1,1],[0,0]]);return n=Ei.separableConv2d(n,t.depthwise_filter,t.pointwise_filter,[1,1],"valid"),bs(n=Ei.add(n,t.bias))}))}function _s(e,t){var n=eo(e,t),r=ro(e,t);return{extractConvParams:n,extractConvWithBatchNormParams:function(r,i,a){return{conv:n(r,i,3,a+"/conv"),bn:function(n,r){var i=Ei.tensor1d(e(n)),a=Ei.tensor1d(e(n));return t.push({paramPath:r+"/sub"},{paramPath:r+"/truediv"}),{sub:i,truediv:a}}(i,a+"/bn")}},extractSeparableConvParams:r}}function ks(e,t){var n=ao(e,t);function r(e){return{filters:n(e+"/filters",4),bias:n(e+"/bias",1)}}return{extractConvParams:r,extractConvWithBatchNormParams:function(e){return{conv:r(e+"/conv"),bn:function(e){return{sub:n(e+"/sub",1),truediv:n(e+"/truediv",1)}}(e+"/bn")}},extractSeparableConvParams:io(n)}}!function(e){e[e.XS=224]="XS",e[e.SM=320]="SM",e[e.MD=416]="MD",e[e.LG=608]="LG"}(fs||(fs={}));var Es=function(){function e(e){var t=void 0===e?{}:e,n=t.inputSize,r=t.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=n||416,this._scoreThreshold=r||.5,"number"!=typeof this._inputSize||this._inputSize%32!=0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if("number"!=typeof this._scoreThreshold||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),e}(),Ss=function(e){function t(t){var n=e.call(this,"TinyYolov2")||this;return ys(t),n._config=t,n}return Object(Ci.c)(t,e),Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),t.prototype.runTinyYolov2=function(e,t){var n=xs(e,t.conv0);return n=xs(n=Ei.maxPool(n,[2,2],[2,2],"same"),t.conv1),n=xs(n=Ei.maxPool(n,[2,2],[2,2],"same"),t.conv2),n=xs(n=Ei.maxPool(n,[2,2],[2,2],"same"),t.conv3),n=xs(n=Ei.maxPool(n,[2,2],[2,2],"same"),t.conv4),n=xs(n=Ei.maxPool(n,[2,2],[2,2],"same"),t.conv5),Za(n=xs(n=xs(n=Ei.maxPool(n,[2,2],[1,1],"same"),t.conv6),t.conv7),t.conv8,"valid",!1)},t.prototype.runMobilenet=function(e,t){var n=this.config.isFirstLayerConv2d?bs(Za(e,t.conv0,"valid",!1)):ws(e,t.conv0);return n=ws(n=Ei.maxPool(n,[2,2],[2,2],"same"),t.conv1),n=ws(n=Ei.maxPool(n,[2,2],[2,2],"same"),t.conv2),n=ws(n=Ei.maxPool(n,[2,2],[2,2],"same"),t.conv3),n=ws(n=Ei.maxPool(n,[2,2],[2,2],"same"),t.conv4),n=ws(n=Ei.maxPool(n,[2,2],[2,2],"same"),t.conv5),n=Ei.maxPool(n,[2,2],[1,1],"same"),n=t.conv6?ws(n,t.conv6):n,Za(n=t.conv7?ws(n,t.conv7):n,t.conv8,"valid",!1)},t.prototype.forwardInput=function(e,t){var n=this,r=this.params;if(!r)throw new Error("TinyYolov2 - load model before inference");return Ei.tidy((function(){var i=e.toBatchTensor(t,!1).toFloat();return i=(i=n.config.meanRgb?$i(i,n.config.meanRgb):i).div(Ei.scalar(256)),n.config.withSeparableConvs?n.runMobilenet(i,r):n.runTinyYolov2(i,r)}))},t.prototype.forward=function(e,t){return Object(Ci.b)(this,void 0,void 0,(function(){var n;return Object(Ci.d)(this,(function(r){switch(r.label){case 0:return n=this.forwardInput,[4,Ba(e)];case 1:return[4,n.apply(this,[r.sent(),t])];case 2:return[2,r.sent()]}}))}))},t.prototype.detect=function(e,t){return void 0===t&&(t={}),Object(Ci.b)(this,void 0,void 0,(function(){var n,r,i,a,o,s,u,c,l,f,d,h,p,m=this;return Object(Ci.d)(this,(function(v){switch(v.label){case 0:return n=new Es(t),r=n.inputSize,i=n.scoreThreshold,[4,Ba(e)];case 1:return a=v.sent(),[4,this.forwardInput(a,r)];case 2:return o=v.sent(),s=Ei.tidy((function(){return Ei.unstack(o)[0].expandDims()})),u={width:a.getInputWidth(0),height:a.getInputHeight(0)},[4,this.extractBoxes(s,a.getReshapedInputDimensions(0),i)];case 3:return c=v.sent(),o.dispose(),s.dispose(),l=c.map((function(e){return e.box})),f=c.map((function(e){return e.score})),d=c.map((function(e){return e.classScore})),h=c.map((function(e){return m.config.classes[e.label]})),p=Yi(l.map((function(e){return e.rescale(r)})),f,this.config.iouThreshold,!0),[2,p.map((function(e){return new qi(f[e],d[e],h[e],l[e],u)}))]}}))}))},t.prototype.getDefaultModelName=function(){return""},t.prototype.extractParamsFromWeigthMap=function(e){return function(e,t){var n,r=[],i=ks(e,r),a=i.extractConvParams,o=i.extractConvWithBatchNormParams,s=i.extractSeparableConvParams;if(t.withSeparableConvs){var u=t.filterSizes&&t.filterSizes.length||9;n={conv0:t.isFirstLayerConv2d?a("conv0"):s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:u>7?s("conv6"):void 0,conv7:u>8?s("conv7"):void 0,conv8:a("conv8")}}else n={conv0:o("conv0"),conv1:o("conv1"),conv2:o("conv2"),conv3:o("conv3"),conv4:o("conv4"),conv5:o("conv5"),conv6:o("conv6"),conv7:o("conv7"),conv8:a("conv8")};return Qa(e,r),{params:n,paramMappings:r}}(e,this.config)},t.prototype.extractParams=function(e){var n=this.config.filterSizes||t.DEFAULT_FILTER_SIZES,r=n?n.length:void 0;if(7!==r&&8!==r&&9!==r)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+r+" filterSizes in config");return function(e,t,n,r){var i,a=oo(e),o=a.extractWeights,s=a.getRemainingWeights,u=[],c=_s(o,u),l=c.extractConvParams,f=c.extractConvWithBatchNormParams,d=c.extractSeparableConvParams;if(t.withSeparableConvs){var h=r[0],p=r[1],m=r[2],v=r[3],g=r[4],y=r[5],b=r[6],x=r[7],w=r[8];i={conv0:t.isFirstLayerConv2d?l(h,p,3,"conv0"):d(h,p,"conv0"),conv1:d(p,m,"conv1"),conv2:d(m,v,"conv2"),conv3:d(v,g,"conv3"),conv4:d(g,y,"conv4"),conv5:d(y,b,"conv5"),conv6:x?d(b,x,"conv6"):void 0,conv7:w?d(x,w,"conv7"):void 0,conv8:l(w||x||b,5*n,1,"conv8")}}else h=r[0],p=r[1],m=r[2],v=r[3],g=r[4],y=r[5],b=r[6],x=r[7],w=r[8],i={conv0:f(h,p,"conv0"),conv1:f(p,m,"conv1"),conv2:f(m,v,"conv2"),conv3:f(v,g,"conv3"),conv4:f(g,y,"conv4"),conv5:f(y,b,"conv5"),conv6:f(b,x,"conv6"),conv7:f(x,w,"conv7"),conv8:l(w,5*n,1,"conv8")};if(0!==s().length)throw new Error("weights remaing after extract: "+s().length);return{params:i,paramMappings:u}}(e,this.config,this.boxEncodingSize,n)},t.prototype.extractBoxes=function(e,t,n){return Object(Ci.b)(this,void 0,void 0,(function(){var r,i,a,o,s,u,c,l,f,d,h,p,m,v,g,y,b,x,w,_,k,E,S,C,A,O,D,T,j,M=this;return Object(Ci.d)(this,(function(F){switch(F.label){case 0:return r=t.width,i=t.height,a=Math.max(r,i),o=a/r,s=a/i,u=e.shape[1],c=this.config.anchors.length,l=Ei.tidy((function(){var t=e.reshape([u,u,c,M.boxEncodingSize]);return[t.slice([0,0,0,0],[u,u,c,4]),t.slice([0,0,0,4],[u,u,c,1]),M.withClassScores?Ei.softmax(t.slice([0,0,0,5],[u,u,c,M.config.classes.length]),3):Ei.scalar(0)]})),f=l[0],d=l[1],h=l[2],p=[],[4,d.array()];case 1:return m=F.sent(),[4,f.array()];case 2:v=F.sent(),g=0,F.label=3;case 3:if(!(g<u))return[3,12];y=0,F.label=4;case 4:if(!(y<u))return[3,11];b=0,F.label=5;case 5:return b<c?(x=Qi(m[g][y][b][0]),!n||x>n?(w=(y+Qi(v[g][y][b][0]))/u*o,_=(g+Qi(v[g][y][b][1]))/u*s,k=Math.exp(v[g][y][b][2])*this.config.anchors[b].x/u*o,E=Math.exp(v[g][y][b][3])*this.config.anchors[b].y/u*s,S=w-k/2,C=_-E/2,A={row:g,col:y,anchor:b},this.withClassScores?[4,this.extractPredictedClass(h,A)]:[3,7]):[3,9]):[3,10];case 6:return j=F.sent(),[3,8];case 7:j={classScore:1,label:0},F.label=8;case 8:D=(O=j).classScore,T=O.label,p.push(Object(Ci.a)({box:new Gi(S,C,S+k,C+E),score:x,classScore:x*D,label:T},A)),F.label=9;case 9:return b++,[3,5];case 10:return y++,[3,4];case 11:return g++,[3,3];case 12:return f.dispose(),d.dispose(),h.dispose(),[2,p]}}))}))},t.prototype.extractPredictedClass=function(e,t){return Object(Ci.b)(this,void 0,void 0,(function(){var n,r,i,a;return Object(Ci.d)(this,(function(o){switch(o.label){case 0:return n=t.row,r=t.col,i=t.anchor,[4,e.array()];case 1:return a=o.sent(),[2,Array(this.config.classes.length).fill(0).map((function(e,t){return a[n][r][i][t]})).map((function(e,t){return{classScore:e,label:t}})).reduce((function(e,t){return e.classScore>t.classScore?e:t}))]}}))}))},t.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],t}(Ka),Cs=function(e){function t(t){void 0===t&&(t=!0);var n=Object.assign({},{withSeparableConvs:t,iouThreshold:hs,classes:["face"]},t?{anchors:ms,meanRgb:vs}:{anchors:ps,withClassScores:!0});return e.call(this,n)||this}return Object(Ci.c)(t,e),Object.defineProperty(t.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,t){return Object(Ci.b)(this,void 0,void 0,(function(){return Object(Ci.d)(this,(function(n){switch(n.label){case 0:return[4,this.detect(e,t)];case 1:return[2,n.sent().map((function(e){return new Hi(e.score,e.relativeBox,{width:e.imageWidth,height:e.imageHeight})}))]}}))}))},t.prototype.getDefaultModelName=function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"},t.prototype.extractParamsFromWeigthMap=function(t){return e.prototype.extractParamsFromWeigthMap.call(this,t)},t}(Ss);function As(e,t){void 0===t&&(t=!0);var n=new Cs(t);return n.extractWeights(e),n}var Os=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._name="TinyFaceDetectorOptions",t}return Object(Ci.c)(t,e),t}(Es),Ds=function(){function e(){}return e.prototype.then=function(e){return Object(Ci.b)(this,void 0,void 0,(function(){var t;return Object(Ci.d)(this,(function(n){switch(n.label){case 0:return t=e,[4,this.run()];case 1:return[2,t.apply(void 0,[n.sent()])]}}))}))},e.prototype.run=function(){return Object(Ci.b)(this,void 0,void 0,(function(){return Object(Ci.d)(this,(function(e){throw new Error("ComposableTask - run is not implemented")}))}))},e}();function Ts(e,t,n,r,i){return void 0===i&&(i=function(e){return e.alignedRect}),Object(Ci.b)(this,void 0,void 0,(function(){var a,o,s,u,c;return Object(Ci.d)(this,(function(l){switch(l.label){case 0:return a=e.map((function(e){return wo(e)?i(e):e.detection})),(s=r)?[3,5]:t instanceof Ei.Tensor?[4,za(t,a)]:[3,2];case 1:return u=l.sent(),[3,4];case 2:return[4,La(t,a)];case 3:u=l.sent(),l.label=4;case 4:s=u,l.label=5;case 5:return[4,n(o=s)];case 6:return c=l.sent(),o.forEach((function(e){return e instanceof Ei.Tensor&&e.dispose()})),[2,c]}}))}))}function js(e,t,n,r,i){return Object(Ci.b)(this,void 0,void 0,(function(){var a=this;return Object(Ci.d)(this,(function(o){return[2,Ts([e],t,(function(e){return Object(Ci.b)(a,void 0,void 0,(function(){return Object(Ci.d)(this,(function(t){return[2,n(e[0])]}))}))}),r,i)]}))}))}var Ms=2,Fs=12;function Is(e){var t=oo(e),n=t.extractWeights,r=t.getRemainingWeights,i=[],a=function(e,t){var n=eo(e,t),r=to(e,t);function i(n,r){var i=Ei.tensor1d(e(n));return t.push({paramPath:r}),i}function a(e,t,r){return void 0===r&&(r=!1),{conv1:n(e[0],e[1],3,t+"/conv1"),prelu1_alpha:i(e[1],t+"/prelu1_alpha"),conv2:n(e[1],e[2],3,t+"/conv2"),prelu2_alpha:i(e[2],t+"/prelu2_alpha"),conv3:n(e[2],e[3],r?2:3,t+"/conv3"),prelu3_alpha:i(e[3],t+"/prelu3_alpha")}}return{extractPNetParams:function(){var e=a([3,10,16,32],"pnet"),t=n(32,2,1,"pnet/conv4_1"),r=n(32,4,1,"pnet/conv4_2");return Object(Ci.a)(Object(Ci.a)({},e),{conv4_1:t,conv4_2:r})},extractRNetParams:function(){var e=a([3,28,48,64],"rnet",!0),t=r(576,128,"rnet/fc1"),n=i(128,"rnet/prelu4_alpha"),o=r(128,2,"rnet/fc2_1"),s=r(128,4,"rnet/fc2_2");return Object(Ci.a)(Object(Ci.a)({},e),{fc1:t,prelu4_alpha:n,fc2_1:o,fc2_2:s})},extractONetParams:function(){var e=a([3,32,64,64],"onet"),t=n(64,128,2,"onet/conv4"),o=i(128,"onet/prelu4_alpha"),s=r(1152,256,"onet/fc1"),u=i(256,"onet/prelu5_alpha"),c=r(256,2,"onet/fc2_1"),l=r(256,4,"onet/fc2_2"),f=r(256,10,"onet/fc2_3");return Object(Ci.a)(Object(Ci.a)({},e),{conv4:t,prelu4_alpha:o,fc1:s,prelu5_alpha:u,fc2_1:c,fc2_2:l,fc2_3:f})}}}(n,i),o=a.extractPNetParams,s=a.extractRNetParams,u=a.extractONetParams,c=o(),l=s(),f=u();if(0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:c,rnet:l,onet:f},paramMappings:i}}function Ns(e){var t=[],n=function(e,t){var n=ao(e,t);function r(e){return{filters:n(e+"/weights",4,e+"/filters"),bias:n(e+"/bias",1)}}function i(e){return{weights:n(e+"/weights",2),bias:n(e+"/bias",1)}}function a(e){return n(e,1)}function o(e){return{conv1:r(e+"/conv1"),prelu1_alpha:a(e+"/prelu1_alpha"),conv2:r(e+"/conv2"),prelu2_alpha:a(e+"/prelu2_alpha"),conv3:r(e+"/conv3"),prelu3_alpha:a(e+"/prelu3_alpha")}}return{extractPNetParams:function(){var e=o("pnet"),t=r("pnet/conv4_1"),n=r("pnet/conv4_2");return Object(Ci.a)(Object(Ci.a)({},e),{conv4_1:t,conv4_2:n})},extractRNetParams:function(){var e=o("rnet"),t=i("rnet/fc1"),n=a("rnet/prelu4_alpha"),r=i("rnet/fc2_1"),s=i("rnet/fc2_2");return Object(Ci.a)(Object(Ci.a)({},e),{fc1:t,prelu4_alpha:n,fc2_1:r,fc2_2:s})},extractONetParams:function(){var e=o("onet"),t=r("onet/conv4"),n=a("onet/prelu4_alpha"),s=i("onet/fc1"),u=a("onet/prelu5_alpha"),c=i("onet/fc2_1"),l=i("onet/fc2_2"),f=i("onet/fc2_3");return Object(Ci.a)(Object(Ci.a)({},e),{conv4:t,prelu4_alpha:n,fc1:s,prelu5_alpha:u,fc2_1:c,fc2_2:l,fc2_3:f})}}}(e,t),r=n.extractPNetParams,i=n.extractRNetParams,a=n.extractONetParams,o=r(),s=i(),u=a();return Qa(e,t),{params:{pnet:o,rnet:s,onet:u},paramMappings:t}}function Rs(e,t){var n=t[0],r=t[1];return{height:Math.floor(n*e),width:Math.floor(r*e)}}var Ps=function(e){function t(t,n,r,i){return e.call(this,{left:t,top:n,right:r,bottom:i},!0)||this}return Object(Ci.c)(t,e),t}(Vi);function Bs(e){return Ei.tidy((function(){return Ei.mul(Ei.sub(e,Ei.scalar(127.5)),Ei.scalar(.0078125))}))}function Ls(e,t){return Ei.tidy((function(){return Ei.add(Ei.relu(e),Ei.mul(t,Ei.neg(Ei.relu(Ei.neg(e)))))}))}function zs(e,t,n){return void 0===n&&(n=!1),Ei.tidy((function(){var r=Za(e,t.conv1,"valid");return r=Ls(r,t.prelu1_alpha),r=Ls(r=Za(r=Ei.maxPool(r,n?[2,2]:[3,3],[2,2],"same"),t.conv2,"valid"),t.prelu2_alpha),Ls(r=Za(r=n?r:Ei.maxPool(r,[3,3],[2,2],"valid"),t.conv3,"valid"),t.prelu3_alpha)}))}function Us(e,t,n,r,i){i.stage1=[];var a=t.map((function(t){return Ei.tidy((function(){var n={scale:t},i=function(e,t){return Ei.tidy((function(){var n=Rs(t,e.shape.slice(1)),r=n.height,i=n.width,a=Bs(Ei.image.resizeBilinear(e,[r,i]));return Ei.transpose(a,[0,2,1,3])}))}(e,t),a=Date.now(),o=function(e,t){return Ei.tidy((function(){var n=zs(e,t,!0),r=Za(n,t.conv4_1,"valid"),i=Ei.expandDims(Ei.max(r,3),3);return{prob:Ei.softmax(Ei.sub(r,i),3),regions:Za(n,t.conv4_2,"valid")}}))}(i,r),s=o.prob,u=o.regions;return n.pnet=Date.now()-a,{scoresTensor:Ei.unstack(Ei.unstack(s,3)[1])[0],regionsTensor:Ei.unstack(u)[0],scale:t,statsForScale:n}}))})).map((function(e){var t=e.scoresTensor,r=e.regionsTensor,a=e.scale,o=e.statsForScale,s=function(e,t,n,r){for(var i=[],a=e.arraySync(),o=0;o<e.shape[0];o++)for(var s=0;s<e.shape[1];s++)a[o][s]>=r&&i.push(new Wi(s,o));return i.map((function(e){var r=new Gi(Math.round((e.y*Ms+1)/n),Math.round((e.x*Ms+1)/n),Math.round((e.y*Ms+Fs)/n),Math.round((e.x*Ms+Fs)/n)),i=a[e.y][e.x],o=t.arraySync();return{cell:r,score:i,region:new Ps(o[e.y][e.x][0],o[e.y][e.x][1],o[e.y][e.x][2],o[e.y][e.x][3])}}))}(t,r,a,n);if(t.dispose(),r.dispose(),!s.length)return i.stage1.push(o),[];var u=Date.now(),c=Yi(s.map((function(e){return e.cell})),s.map((function(e){return e.score})),.5);return o.nms=Date.now()-u,o.numBoxes=c.length,i.stage1.push(o),c.map((function(e){return s[e]}))})).reduce((function(e,t){return e.concat(t)}),[]),o=[],s=[];if(a.length>0){var u=Date.now(),c=Yi(a.map((function(e){return e.cell})),a.map((function(e){return e.score})),.7);i.stage1_nms=Date.now()-u,s=c.map((function(e){return a[e].score})),o=c.map((function(e){return a[e]})).map((function(e){var t=e.cell,n=e.region;return new Gi(t.left+n.left*t.width,t.top+n.top*t.height,t.right+n.right*t.width,t.bottom+n.bottom*t.height).toSquare().round()}))}return{boxes:o,scores:s}}function Ws(e,t,n){var r=n.width,i=n.height;return Object(Ci.b)(this,void 0,void 0,(function(){var n,a,o,s=this;return Object(Ci.d)(this,(function(u){switch(u.label){case 0:return n=_a(e),[4,Promise.all(t.map((function(t){return Object(Ci.b)(s,void 0,void 0,(function(){var r,i,a,o,s,u,c,l;return Object(Ci.d)(this,(function(f){return r=t.padAtBorders(e.height,e.width),i=r.y,a=r.ey,o=r.x,s=r.ex,u=o-1,c=i-1,l=n.getImageData(u,c,s-u,a-c),[2,xa.isNodejs()?Fa(l):createImageBitmap(l)]}))}))})))];case 1:return a=u.sent(),o=[],a.forEach((function(e){var t=_a(Ma({width:r,height:i}));t.drawImage(e,0,0,r,i);for(var n=t.getImageData(0,0,r,i).data,a=[],s=0;s<n.length;s+=4)a.push(n[s+2]),a.push(n[s+1]),a.push(n[s]);o.push(a)})),[2,o.map((function(e){return Ei.tidy((function(){return Bs(Ei.transpose(Ei.tensor4d(e,[1,r,i,3]),[0,2,1,3]).toFloat())}))}))]}}))}))}function Vs(e,t,n,r,i){return Object(Ci.b)(this,void 0,void 0,(function(){var a,o,s,u,c,l,f,d,h,p,m,v,g,y;return Object(Ci.d)(this,(function(b){switch(b.label){case 0:return a=Date.now(),[4,Ws(e,t,{width:24,height:24})];case 1:return o=b.sent(),i.stage2_extractImagePatches=Date.now()-a,a=Date.now(),s=o.map((function(e){var t=function(e,t){return Ei.tidy((function(){var n=zs(e,t),r=Ls(fo(Ei.reshape(n,[n.shape[0],t.fc1.weights.shape[0]]),t.fc1),t.prelu4_alpha),i=fo(r,t.fc2_1),a=Ei.expandDims(Ei.max(i,1),1),o=Ei.softmax(Ei.sub(i,a),1),s=fo(r,t.fc2_2);return{scores:Ei.unstack(o,1)[1],regions:s}}))}(e,r);return e.dispose(),t})),i.stage2_rnet=Date.now()-a,u=s.length>1?Ei.concat(s.map((function(e){return e.scores}))):s[0].scores,f=(l=Array).from,[4,u.data()];case 2:return c=f.apply(l,[b.sent()]),u.dispose(),d=c.map((function(e,t){return{score:e,idx:t}})).filter((function(e){return e.score>n})).map((function(e){return e.idx})),h=d.map((function(e){return t[e]})),p=d.map((function(e){return c[e]})),m=[],v=[],h.length>0&&(a=Date.now(),g=Yi(h,p,.7),i.stage2_nms=Date.now()-a,y=g.map((function(e){var t=s[d[e]].regions.arraySync();return new Ps(t[0][0],t[0][1],t[0][2],t[0][3])})),v=g.map((function(e){return p[e]})),m=g.map((function(e,t){return h[e].calibrate(y[t])}))),s.forEach((function(e){e.regions.dispose(),e.scores.dispose()})),[2,{boxes:m,scores:v}]}}))}))}function Gs(e,t,n,r,i){return Object(Ci.b)(this,void 0,void 0,(function(){var a,o,s,u,c,l,f,d,h,p,m,v,g,y,b;return Object(Ci.d)(this,(function(x){switch(x.label){case 0:return a=Date.now(),[4,Ws(e,t,{width:48,height:48})];case 1:return o=x.sent(),i.stage3_extractImagePatches=Date.now()-a,a=Date.now(),s=o.map((function(e){var t=function(e,t){return Ei.tidy((function(){var n=zs(e,t);n=Ls(n=Za(n=Ei.maxPool(n,[2,2],[2,2],"same"),t.conv4,"valid"),t.prelu4_alpha);var r=Ls(fo(Ei.reshape(n,[n.shape[0],t.fc1.weights.shape[0]]),t.fc1),t.prelu5_alpha),i=fo(r,t.fc2_1),a=Ei.expandDims(Ei.max(i,1),1),o=Ei.softmax(Ei.sub(i,a),1),s=fo(r,t.fc2_2),u=fo(r,t.fc2_3);return{scores:Ei.unstack(o,1)[1],regions:s,points:u}}))}(e,r);return e.dispose(),t})),i.stage3_onet=Date.now()-a,u=s.length>1?Ei.concat(s.map((function(e){return e.scores}))):s[0].scores,f=(l=Array).from,[4,u.data()];case 2:return c=f.apply(l,[x.sent()]),u.dispose(),d=c.map((function(e,t){return{score:e,idx:t}})).filter((function(e){return e.score>n})).map((function(e){return e.idx})),h=d.map((function(e){var t=s[e].regions.arraySync();return new Ps(t[0][0],t[0][1],t[0][2],t[0][3])})),p=d.map((function(e,n){return t[e].calibrate(h[n])})),m=d.map((function(e){return c[e]})),v=[],g=[],y=[],p.length>0&&(a=Date.now(),b=Yi(p,m,.7,!1),i.stage3_nms=Date.now()-a,v=b.map((function(e){return p[e]})),g=b.map((function(e){return m[e]})),y=b.map((function(e,t){return Array(5).fill(0).map((function(n,r){var i=s[e].points.arraySync();return new Wi(i[0][r]*(v[t].width+1)+v[t].left,i[0][r+5]*(v[t].height+1)+v[t].top)}))}))),s.forEach((function(e){e.regions.dispose(),e.scores.dispose(),e.points.dispose()})),[2,{boxes:v,scores:g,points:y}]}}))}))}var qs=function(e){function t(){return e.call(this,"Mtcnn")||this}return Object(Ci.c)(t,e),t.prototype.load=function(t){return Object(Ci.b)(this,void 0,void 0,(function(){return Object(Ci.d)(this,(function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,e.prototype.load.call(this,t)]}))}))},t.prototype.loadFromDisk=function(t){return Object(Ci.b)(this,void 0,void 0,(function(){return Object(Ci.d)(this,(function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,e.prototype.loadFromDisk.call(this,t)]}))}))},t.prototype.forwardInput=function(e,t){return void 0===t&&(t={}),Object(Ci.b)(this,void 0,void 0,(function(){var n,r,i,a,o,s,u,c,l,f,d,h,p,m,v,g,y,b,x,w,_;return Object(Ci.d)(this,(function(k){switch(k.label){case 0:if(!(n=this.params))throw new Error("Mtcnn - load model before inference");if(!(r=e.canvases[0]))throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return i={},a=Date.now(),o=Ei.tidy((function(){return function(e){return Ei.tidy((function(){return Ei.stack(Ei.unstack(e,3).reverse(),3)}))}(Ei.expandDims(Ei.browser.fromPixels(r)).toFloat())})),s=function(e){return o.dispose(),i.total=Date.now()-a,e},u=o.shape.slice(1),c=u[0],l=u[1],f=new Zo(t),d=f.minFaceSize,h=f.scaleFactor,p=f.maxNumScales,m=f.scoreThresholds,v=f.scaleSteps,g=(v||function(e,t,n){for(var r=n[0],i=n[1],a=Fs/e,o=[],s=Math.min(r,i)*a,u=0;s>=12;)o.push(a*Math.pow(t,u)),s*=t,u+=1;return o}(d,h,[c,l])).filter((function(e){var t=Rs(e,[c,l]);return Math.min(t.width,t.height)>Fs})).slice(0,p),i.scales=g,i.pyramid=g.map((function(e){return Rs(e,[c,l])})),y=Date.now(),[4,Us(o,g,m[0],n.pnet,i)];case 1:return b=k.sent(),i.total_stage1=Date.now()-y,b.boxes.length?(i.stage2_numInputBoxes=b.boxes.length,y=Date.now(),[4,Vs(r,b.boxes,m[1],n.rnet,i)]):[2,s({results:[],stats:i})];case 2:return x=k.sent(),i.total_stage2=Date.now()-y,x.boxes.length?(i.stage3_numInputBoxes=x.boxes.length,y=Date.now(),[4,Gs(r,x.boxes,m[2],n.onet,i)]):[2,s({results:[],stats:i})];case 3:return w=k.sent(),i.total_stage3=Date.now()-y,_=w.boxes.map((function(e,t){return _o(la({},new Hi(w.scores[t],new ta(e.left/l,e.top/c,e.width/l,e.height/c),{height:c,width:l})),new ra(w.points[t].map((function(t){return t.sub(new Wi(e.left,e.top)).div(new Wi(e.width,e.height))})),{width:e.width,height:e.height}))})),[2,s({results:_,stats:i})]}}))}))},t.prototype.forward=function(e,t){return void 0===t&&(t={}),Object(Ci.b)(this,void 0,void 0,(function(){var n;return Object(Ci.d)(this,(function(r){switch(r.label){case 0:return n=this.forwardInput,[4,Ba(e)];case 1:return[4,n.apply(this,[r.sent(),t])];case 2:return[2,r.sent().results]}}))}))},t.prototype.forwardWithStats=function(e,t){return void 0===t&&(t={}),Object(Ci.b)(this,void 0,void 0,(function(){var n;return Object(Ci.d)(this,(function(r){switch(r.label){case 0:return n=this.forwardInput,[4,Ba(e)];case 1:return[2,n.apply(this,[r.sent(),t])]}}))}))},t.prototype.getDefaultModelName=function(){return"mtcnn_model"},t.prototype.extractParamsFromWeigthMap=function(e){return Ns(e)},t.prototype.extractParams=function(e){return Is(e)},t}(Ka),Hs=.4,Xs=[new Wi(1.603231,2.094468),new Wi(6.041143,7.080126),new Wi(2.882459,3.518061),new Wi(4.266906,5.178857),new Wi(9.041765,10.66308)],Ks=[117.001,114.697,97.404],Ys=function(e){function t(){var t={withSeparableConvs:!0,iouThreshold:Hs,classes:["face"],anchors:Xs,meanRgb:Ks,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return e.call(this,t)||this}return Object(Ci.c)(t,e),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,t){return Object(Ci.b)(this,void 0,void 0,(function(){return Object(Ci.d)(this,(function(n){switch(n.label){case 0:return[4,this.detect(e,t)];case 1:return[2,n.sent().map((function(e){return new Hi(e.score,e.relativeBox,{width:e.imageWidth,height:e.imageHeight})}))]}}))}))},t.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},t.prototype.extractParamsFromWeigthMap=function(t){return e.prototype.extractParamsFromWeigthMap.call(this,t)},t}(Ss),$s={ssdMobilenetv1:new us,tinyFaceDetector:new Ys,tinyYolov2:new Cs,mtcnn:new qs,faceLandmark68Net:new Io,faceLandmark68TinyNet:new Ro,faceRecognitionNet:new qo,faceExpressionNet:new go,ageGenderNet:new Mo},Js=function(e,t){return $s.ssdMobilenetv1.locateFaces(e,t)},Zs=function(e,t){return $s.tinyFaceDetector.locateFaces(e,t)},Qs=function(e,t){return $s.tinyYolov2.locateFaces(e,t)},eu=function(e,t){return $s.mtcnn.forward(e,t)},tu=function(e){return $s.faceLandmark68Net.detectLandmarks(e)},nu=function(e){return $s.faceLandmark68TinyNet.detectLandmarks(e)},ru=function(e){return $s.faceRecognitionNet.computeFaceDescriptor(e)},iu=function(e){return $s.faceExpressionNet.predictExpressions(e)},au=function(e){return $s.ageGenderNet.predictAgeAndGender(e)},ou=function(e){return $s.ssdMobilenetv1.load(e)},su=function(e){return $s.tinyFaceDetector.load(e)},uu=function(e){return $s.mtcnn.load(e)},cu=function(e){return $s.tinyYolov2.load(e)},lu=function(e){return $s.faceLandmark68Net.load(e)},fu=function(e){return $s.faceLandmark68TinyNet.load(e)},du=function(e){return $s.faceRecognitionNet.load(e)},hu=function(e){return $s.faceExpressionNet.load(e)},pu=function(e){return $s.ageGenderNet.load(e)},mu=ou,vu=Js,gu=tu,yu=function(e){function t(t,n,r){var i=e.call(this)||this;return i.parentTask=t,i.input=n,i.extractedFaces=r,i}return Object(Ci.c)(t,e),t}(Ds),bu=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(Ci.c)(t,e),t.prototype.run=function(){return Object(Ci.b)(this,void 0,void 0,(function(){var e,t,n=this;return Object(Ci.d)(this,(function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,Ts(e=r.sent(),this.input,(function(e){return Object(Ci.b)(n,void 0,void 0,(function(){return Object(Ci.d)(this,(function(t){switch(t.label){case 0:return[4,Promise.all(e.map((function(e){return $s.faceExpressionNet.predictExpressions(e)})))];case 1:return[2,t.sent()]}}))}))}),this.extractedFaces)];case 2:return t=r.sent(),[2,e.map((function(e,n){return bo(e,t[n])}))]}}))}))},t.prototype.withAgeAndGender=function(){return new Eu(this,this.input)},t}(yu),xu=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(Ci.c)(t,e),t.prototype.run=function(){return Object(Ci.b)(this,void 0,void 0,(function(){var e,t;return Object(Ci.d)(this,(function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return(e=n.sent())?[4,js(e,this.input,(function(e){return $s.faceExpressionNet.predictExpressions(e)}),this.extractedFaces)]:[2];case 2:return t=n.sent(),[2,bo(e,t)]}}))}))},t.prototype.withAgeAndGender=function(){return new Su(this,this.input)},t}(yu),wu=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(Ci.c)(t,e),t.prototype.withAgeAndGender=function(){return new Cu(this,this.input)},t.prototype.withFaceDescriptors=function(){return new Du(this,this.input)},t}(bu),_u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(Ci.c)(t,e),t.prototype.withAgeAndGender=function(){return new Au(this,this.input)},t.prototype.withFaceDescriptor=function(){return new Tu(this,this.input)},t}(xu),ku=function(e){function t(t,n,r){var i=e.call(this)||this;return i.parentTask=t,i.input=n,i.extractedFaces=r,i}return Object(Ci.c)(t,e),t}(Ds),Eu=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(Ci.c)(t,e),t.prototype.run=function(){return Object(Ci.b)(this,void 0,void 0,(function(){var e,t,n=this;return Object(Ci.d)(this,(function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,Ts(e=r.sent(),this.input,(function(e){return Object(Ci.b)(n,void 0,void 0,(function(){return Object(Ci.d)(this,(function(t){switch(t.label){case 0:return[4,Promise.all(e.map((function(e){return $s.ageGenderNet.predictAgeAndGender(e)})))];case 1:return[2,t.sent()]}}))}))}),this.extractedFaces)];case 2:return t=r.sent(),[2,e.map((function(e,n){var r=t[n],i=r.age;return Yo(Jo(e,r.gender,r.genderProbability),i)}))]}}))}))},t.prototype.withFaceExpressions=function(){return new bu(this,this.input)},t}(ku),Su=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(Ci.c)(t,e),t.prototype.run=function(){return Object(Ci.b)(this,void 0,void 0,(function(){var e,t,n,r,i;return Object(Ci.d)(this,(function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return(e=a.sent())?[4,js(e,this.input,(function(e){return $s.ageGenderNet.predictAgeAndGender(e)}),this.extractedFaces)]:[2];case 2:return t=a.sent(),n=t.age,r=t.gender,i=t.genderProbability,[2,Yo(Jo(e,r,i),n)]}}))}))},t.prototype.withFaceExpressions=function(){return new xu(this,this.input)},t}(ku),Cu=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(Ci.c)(t,e),t.prototype.withFaceExpressions=function(){return new wu(this,this.input)},t.prototype.withFaceDescriptors=function(){return new Du(this,this.input)},t}(Eu),Au=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(Ci.c)(t,e),t.prototype.withFaceExpressions=function(){return new _u(this,this.input)},t.prototype.withFaceDescriptor=function(){return new Tu(this,this.input)},t}(Su),Ou=function(e){function t(t,n){var r=e.call(this)||this;return r.parentTask=t,r.input=n,r}return Object(Ci.c)(t,e),t}(Ds),Du=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(Ci.c)(t,e),t.prototype.run=function(){return Object(Ci.b)(this,void 0,void 0,(function(){var e;return Object(Ci.d)(this,(function(t){switch(t.label){case 0:return[4,this.parentTask];case 1:return[4,Ts(e=t.sent(),this.input,(function(e){return Promise.all(e.map((function(e){return $s.faceRecognitionNet.computeFaceDescriptor(e)})))}),null,(function(e){return e.landmarks.align(null,{useDlibAlignment:!0})}))];case 2:return[2,t.sent().map((function(t,n){return Xo(e[n],t)}))]}}))}))},t.prototype.withFaceExpressions=function(){return new wu(this,this.input)},t.prototype.withAgeAndGender=function(){return new Cu(this,this.input)},t}(Ou),Tu=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(Ci.c)(t,e),t.prototype.run=function(){return Object(Ci.b)(this,void 0,void 0,(function(){var e,t;return Object(Ci.d)(this,(function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return(e=n.sent())?[4,js(e,this.input,(function(e){return $s.faceRecognitionNet.computeFaceDescriptor(e)}),null,(function(e){return e.landmarks.align(null,{useDlibAlignment:!0})}))]:[2];case 2:return t=n.sent(),[2,Xo(e,t)]}}))}))},t.prototype.withFaceExpressions=function(){return new _u(this,this.input)},t.prototype.withAgeAndGender=function(){return new Au(this,this.input)},t}(Ou),ju=function(e){function t(t,n,r){var i=e.call(this)||this;return i.parentTask=t,i.input=n,i.useTinyLandmarkNet=r,i}return Object(Ci.c)(t,e),Object.defineProperty(t.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?$s.faceLandmark68TinyNet:$s.faceLandmark68Net},enumerable:!0,configurable:!0}),t}(Ds),Mu=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(Ci.c)(t,e),t.prototype.run=function(){return Object(Ci.b)(this,void 0,void 0,(function(){var e,t,n,r,i,a=this;return Object(Ci.d)(this,(function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return e=o.sent(),t=e.map((function(e){return e.detection})),this.input instanceof Ei.Tensor?[4,za(this.input,t)]:[3,3];case 2:return r=o.sent(),[3,5];case 3:return[4,La(this.input,t)];case 4:r=o.sent(),o.label=5;case 5:return n=r,[4,Promise.all(n.map((function(e){return a.landmarkNet.detectLandmarks(e)})))];case 6:return i=o.sent(),n.forEach((function(e){return e instanceof Ei.Tensor&&e.dispose()})),[2,e.map((function(e,t){return _o(e,i[t])}))]}}))}))},t.prototype.withFaceExpressions=function(){return new wu(this,this.input)},t.prototype.withAgeAndGender=function(){return new Cu(this,this.input)},t.prototype.withFaceDescriptors=function(){return new Du(this,this.input)},t}(ju),Fu=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(Ci.c)(t,e),t.prototype.run=function(){return Object(Ci.b)(this,void 0,void 0,(function(){var e,t,n,r,i;return Object(Ci.d)(this,(function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return(e=a.sent())?(t=e.detection,this.input instanceof Ei.Tensor?[4,za(this.input,[t])]:[3,3]):[2];case 2:return r=a.sent(),[3,5];case 3:return[4,La(this.input,[t])];case 4:r=a.sent(),a.label=5;case 5:return n=r,[4,this.landmarkNet.detectLandmarks(n[0])];case 6:return i=a.sent(),n.forEach((function(e){return e instanceof Ei.Tensor&&e.dispose()})),[2,_o(e,i)]}}))}))},t.prototype.withFaceExpressions=function(){return new _u(this,this.input)},t.prototype.withAgeAndGender=function(){return new Au(this,this.input)},t.prototype.withFaceDescriptor=function(){return new Tu(this,this.input)},t}(ju),Iu=function(e){function t(t,n){void 0===n&&(n=new ss);var r=e.call(this)||this;return r.input=t,r.options=n,r}return Object(Ci.c)(t,e),t}(Ds),Nu=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(Ci.c)(t,e),t.prototype.run=function(){return Object(Ci.b)(this,void 0,void 0,(function(){var e,t,n,r;return Object(Ci.d)(this,(function(i){switch(i.label){case 0:return t=(e=this).input,(n=e.options)instanceof Zo?[4,$s.mtcnn.forward(t,n)]:[3,2];case 1:return[2,i.sent().map((function(e){return e.detection}))];case 2:if(!(r=n instanceof Os?function(e){return $s.tinyFaceDetector.locateFaces(e,n)}:n instanceof ss?function(e){return $s.ssdMobilenetv1.locateFaces(e,n)}:n instanceof Es?function(e){return $s.tinyYolov2.locateFaces(e,n)}:null))throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,r(t)]}}))}))},t.prototype.runAndExtendWithFaceDetections=function(){var e=this;return new Promise((function(t){return Object(Ci.b)(e,void 0,void 0,(function(){var e;return Object(Ci.d)(this,(function(n){switch(n.label){case 0:return[4,this.run()];case 1:return e=n.sent(),[2,t(e.map((function(e){return la({},e)})))]}}))}))}))},t.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new Mu(this.runAndExtendWithFaceDetections(),this.input,e)},t.prototype.withFaceExpressions=function(){return new bu(this.runAndExtendWithFaceDetections(),this.input)},t.prototype.withAgeAndGender=function(){return new Eu(this.runAndExtendWithFaceDetections(),this.input)},t}(Iu),Ru=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(Ci.c)(t,e),t.prototype.run=function(){return Object(Ci.b)(this,void 0,void 0,(function(){var e,t;return Object(Ci.d)(this,(function(n){switch(n.label){case 0:return[4,new Nu(this.input,this.options)];case 1:return e=n.sent(),t=e[0],e.forEach((function(e){e.score>t.score&&(t=e)})),[2,t]}}))}))},t.prototype.runAndExtendWithFaceDetection=function(){var e=this;return new Promise((function(t){return Object(Ci.b)(e,void 0,void 0,(function(){var e;return Object(Ci.d)(this,(function(n){switch(n.label){case 0:return[4,this.run()];case 1:return e=n.sent(),[2,t(e?la({},e):void 0)]}}))}))}))},t.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new Fu(this.runAndExtendWithFaceDetection(),this.input,e)},t.prototype.withFaceExpressions=function(){return new xu(this.runAndExtendWithFaceDetection(),this.input)},t.prototype.withAgeAndGender=function(){return new Su(this.runAndExtendWithFaceDetection(),this.input)},t}(Iu);function Pu(e,t){return void 0===t&&(t=new ss),new Ru(e,t)}function Bu(e,t){return void 0===t&&(t=new ss),new Nu(e,t)}function Lu(e,t){return Object(Ci.b)(this,void 0,void 0,(function(){return Object(Ci.d)(this,(function(n){switch(n.label){case 0:return console.warn("allFacesSsdMobilenetv1 is deprecated and will be removed soon, use the high level api instead"),[4,Bu(e,new ss(t?{minConfidence:t}:{})).withFaceLandmarks().withFaceDescriptors()];case 1:return[2,n.sent()]}}))}))}function zu(e,t){return void 0===t&&(t={}),Object(Ci.b)(this,void 0,void 0,(function(){return Object(Ci.d)(this,(function(n){switch(n.label){case 0:return console.warn("allFacesTinyYolov2 is deprecated and will be removed soon, use the high level api instead"),[4,Bu(e,new Es(t)).withFaceLandmarks().withFaceDescriptors()];case 1:return[2,n.sent()]}}))}))}function Uu(e,t){return void 0===t&&(t={}),Object(Ci.b)(this,void 0,void 0,(function(){return Object(Ci.d)(this,(function(n){switch(n.label){case 0:return console.warn("allFacesMtcnn is deprecated and will be removed soon, use the high level api instead"),[4,Bu(e,new Zo(t)).withFaceLandmarks().withFaceDescriptors()];case 1:return[2,n.sent()]}}))}))}var Wu=Lu;function Vu(e,t){if(e.length!==t.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var n=Array.from(e),r=Array.from(t);return Math.sqrt(n.map((function(e,t){return e-r[t]})).reduce((function(e,t){return e+Math.pow(t,2)}),0))}var Gu=function(){function e(e,t){void 0===t&&(t=.6),this._distanceThreshold=t;var n=Array.isArray(e)?e:[e];if(!n.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var r=1,i=function(){return"person "+r++};this._labeledDescriptors=n.map((function(e){if(e instanceof sa)return e;if(e instanceof Float32Array)return new sa(i(),[e]);if(e.descriptor&&e.descriptor instanceof Float32Array)return new sa(i(),[e.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")}))}return Object.defineProperty(e.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),e.prototype.computeMeanDistance=function(e,t){return t.map((function(t){return Vu(t,e)})).reduce((function(e,t){return e+t}),0)/(t.length||1)},e.prototype.matchDescriptor=function(e){var t=this;return this.labeledDescriptors.map((function(n){var r=n.descriptors,i=n.label;return new aa(i,t.computeMeanDistance(e,r))})).reduce((function(e,t){return e.distance<t.distance?e:t}))},e.prototype.findBestMatch=function(e){var t=this.matchDescriptor(e);return t.distance<this.distanceThreshold?t:new aa("unknown",t.distance)},e.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map((function(e){return e.toJSON()}))}},e.fromJSON=function(t){return new e(t.labeledDescriptors.map((function(e){return sa.fromJSON(e)})),t.distanceThreshold)},e}();function qu(e){var t=new qs;return t.extractWeights(e),t}function Hu(e){var t=new Ys;return t.extractWeights(e),t}function Xu(e,t){var n=new Ai(t.width,t.height),r=n.width,i=n.height;if(r<=0||i<=0)throw new Error("resizeResults - invalid dimensions: "+JSON.stringify({width:r,height:i}));if(Array.isArray(e))return e.map((function(e){return Xu(e,{width:r,height:i})}));if(wo(e)){var a=e.detection.forSize(r,i),o=e.unshiftedLandmarks.forSize(a.box.width,a.box.height);return _o(la(e,a),o)}return ca(e)?la(e,e.detection.forSize(r,i)):e instanceof na||e instanceof Hi?e.forSize(r,i):e}var Ku={withLandmarks:!0,withDescriptors:!0,minConfidence:.5,withTinyNet:!0,MODEL_URLS:{Mobilenetv1Model:"https://raw.githubusercontent.com/ml5js/ml5-data-and-models/main/models/faceapi/ssd_mobilenetv1_model-weights_manifest.json",TinyFaceDetectorModel:"https://raw.githubusercontent.com/ml5js/ml5-data-and-models/main/models/faceapi/tiny_face_detector_model-weights_manifest.json",FaceLandmarkModel:"https://raw.githubusercontent.com/ml5js/ml5-data-and-models/main/models/faceapi/face_landmark_68_model-weights_manifest.json",FaceLandmark68TinyNet:"https://raw.githubusercontent.com/ml5js/ml5-data-and-models/main/models/faceapi/face_landmark_68_tiny_model-weights_manifest.json",FaceRecognitionModel:"https://raw.githubusercontent.com/ml5js/ml5-data-and-models/main/models/faceapi/face_recognition_model-weights_manifest.json"}},Yu=function(){function e(t,n,r){S()(this,e),this.video=t,this.model=null,this.modelReady=!1,this.detectorOptions=null,this.config={minConfidence:this.checkUndefined(n.minConfidence,Ku.minConfidence),withLandmarks:this.checkUndefined(n.withLandmarks,Ku.withLandmarks),withDescriptors:this.checkUndefined(n.withDescriptors,Ku.withDescriptors),withTinyNet:this.checkUndefined(n.withTinyNet,Ku.withTinyNet),MODEL_URLS:{Mobilenetv1Model:this.checkUndefined(n.Mobilenetv1Model,Ku.MODEL_URLS.Mobilenetv1Model),TinyFaceDetectorModel:this.checkUndefined(n.TinyFaceDetectorModel,Ku.MODEL_URLS.TinyFaceDetectorModel),FaceLandmarkModel:this.checkUndefined(n.FaceLandmarkModel,Ku.MODEL_URLS.FaceLandmarkModel),FaceLandmark68TinyNet:this.checkUndefined(n.FaceLandmark68TinyNet,Ku.MODEL_URLS.FaceLandmark68TinyNet),FaceRecognitionModel:this.checkUndefined(n.FaceRecognitionModel,Ku.MODEL_URLS.FaceRecognitionModel)}},this.ready=T(this.loadModel(),r)}return A()(e,[{key:"loadModel",value:function(){var e=k()(D.a.mark((function e(){var t,n,r,i,a,o,s,u=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=["Mobilenetv1Model","TinyFaceDetectorModel","FaceLandmarkModel","FaceLandmark68TinyNet","FaceRecognitionModel"],Object.keys(this.config.MODEL_URLS).forEach((function(e){t.includes(e)&&(u.config.MODEL_URLS[e]=Tt.getModelPath(u.config.MODEL_URLS[e]))})),n=this.config.MODEL_URLS,r=n.Mobilenetv1Model,i=n.TinyFaceDetectorModel,a=n.FaceLandmarkModel,o=n.FaceRecognitionModel,s=n.FaceLandmark68TinyNet,this.model=l,!0===this.config.withTinyNet?this.detectorOptions=new Os({minConfidence:this.minConfidence,inputSize:512}):this.detectorOptions=new ss({minConfidence:this.minConfidence}),!0!==this.config.withTinyNet){e.next=12;break}return e.next=8,this.model.loadFaceLandmarkTinyModel(s);case 8:return e.next=10,this.model.loadTinyFaceDetectorModel(i);case 10:e.next=16;break;case 12:return e.next=14,this.model.loadFaceLandmarkModel(a);case 14:return e.next=16,this.model.loadSsdMobilenetv1Model(r);case 16:return e.next=18,this.model.loadFaceRecognitionModel(o);case 18:return this.modelReady=!0,e.abrupt("return",this);case 20:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"detect",value:function(){var e=k()(D.a.mark((function e(t,n,r){var i,a,o;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.video,o=this.config,"function"!=typeof t){e.next=7;break}i=this.video,a=t,e.next=21;break;case 7:if(!(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData)){e.next=11;break}i=t,e.next=21;break;case 11:if("object"!==I()(t)||!(t.elt instanceof HTMLImageElement||t.elt instanceof HTMLCanvasElement||t.elt instanceof HTMLVideoElement||t.elt instanceof ImageData)){e.next=15;break}i=t.elt,e.next=21;break;case 15:if(!("object"===I()(t)&&t.canvas instanceof HTMLCanvasElement)){e.next=19;break}i=t.canvas,e.next=21;break;case 19:if(this.video instanceof HTMLVideoElement){e.next=21;break}throw new Error("No input image provided. If you want to classify a video, pass the video element in the constructor. ");case 21:return"object"===I()(n)?o=n:"function"==typeof n&&(a=n),"function"==typeof r&&(a=r),e.abrupt("return",T(this.detectInternal(i,o),a));case 24:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"detectInternal",value:function(){var e=k()(D.a.mark((function e(t,n){var r,i,a,o,s=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ready;case 2:return e.next=4,x.nextFrame();case 4:if(!this.video||0!==this.video.readyState){e.next=7;break}return e.next=7,new Promise((function(e){s.video.onloadeddata=function(){return e()}}));case 7:if(this.config=this.setReturnOptions(n),r=this.config,i=r.withLandmarks,a=r.withDescriptors,!i){e.next=21;break}if(!a){e.next=16;break}return e.next=13,this.model.detectAllFaces(t,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet).withFaceDescriptors();case 13:o=e.sent,e.next=19;break;case 16:return e.next=18,this.model.detectAllFaces(t,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet);case 18:o=e.sent;case 19:e.next=30;break;case 21:if(i){e.next=27;break}return e.next=24,this.model.detectAllFaces(t);case 24:o=e.sent,e.next=30;break;case 27:return e.next=29,this.model.detectAllFaces(t,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet).withFaceDescriptors();case 29:o=e.sent;case 30:return o=this.resizeResults(o,t.width,t.height),o=this.landmarkParts(o),e.abrupt("return",o);case 33:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"detectSingle",value:function(){var e=k()(D.a.mark((function e(t,n,r){var i,a,o;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.video,o=this.config,"function"!=typeof t){e.next=7;break}i=this.video,a=t,e.next=21;break;case 7:if(!(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData)){e.next=11;break}i=t,e.next=21;break;case 11:if("object"!==I()(t)||!(t.elt instanceof HTMLImageElement||t.elt instanceof HTMLCanvasElement||t.elt instanceof HTMLVideoElement||t.elt instanceof ImageData)){e.next=15;break}i=t.elt,e.next=21;break;case 15:if(!("object"===I()(t)&&t.canvas instanceof HTMLCanvasElement)){e.next=19;break}i=t.canvas,e.next=21;break;case 19:if(this.video instanceof HTMLVideoElement){e.next=21;break}throw new Error("No input image provided. If you want to classify a video, pass the video element in the constructor. ");case 21:return"object"===I()(n)?o=n:"function"==typeof n&&(a=n),"function"==typeof r&&(a=r),e.abrupt("return",T(this.detectSingleInternal(i,o),a));case 24:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"detectSingleInternal",value:function(){var e=k()(D.a.mark((function e(t,n){var r,i,a,o,s=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ready;case 2:return e.next=4,x.nextFrame();case 4:if(!this.video||0!==this.video.readyState){e.next=7;break}return e.next=7,new Promise((function(e){s.video.onloadeddata=function(){return e()}}));case 7:if(this.config=this.setReturnOptions(n),r=this.config,i=r.withLandmarks,a=r.withDescriptors,!i){e.next=21;break}if(!a){e.next=16;break}return e.next=13,this.model.detectSingleFace(t,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet).withFaceDescriptor();case 13:o=e.sent,e.next=19;break;case 16:return e.next=18,this.model.detectSingleFace(t,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet);case 18:o=e.sent;case 19:e.next=30;break;case 21:if(i){e.next=27;break}return e.next=24,this.model.detectSingleFace(t);case 24:o=e.sent,e.next=30;break;case 27:return e.next=29,this.model.detectSingleFace(t,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet).withFaceDescriptor();case 29:o=e.sent;case 30:return o=this.resizeResults(o,t.width,t.height),o=this.landmarkParts(o),e.abrupt("return",o);case 33:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"checkUndefined",value:function(e,t){return void 0!==e?e:t}},{key:"setReturnOptions",value:function(e){var t=this,n=Object.assign({},this.config);return["withLandmarks","withDescriptors"].forEach((function(r){void 0!==e[r]?t.config[r]=e[r]:n[r]=t.config[r]})),n}},{key:"resizeResults",value:function(e,t,n){if(void 0===t||void 0===n)throw new Error("width and height must be defined");return this.model.resizeResults(e,{width:t,height:n})}},{key:"landmarkParts",value:function(e){var t;if(!0===Array.isArray(e))t=e.map((function(e){var t=Object.assign({},e);if(t.landmarks){var n=t.landmarks;t.parts={mouth:n.getMouth(),nose:n.getNose(),leftEye:n.getLeftEye(),leftEyeBrow:n.getLeftEyeBrow(),rightEye:n.getRightEye(),rightEyeBrow:n.getRightEyeBrow(),jawOutline:n.getJawOutline()}}else t.parts={mouth:[],nose:[],leftEye:[],leftEyeBrow:[],rightEye:[],rightEyeBrow:[],jawOutline:[]};return t}));else if((t=Object.assign({},e)).landmarks){var n=e.landmarks;t.parts={mouth:n.getMouth(),nose:n.getNose(),leftEye:n.getLeftEye(),leftEyeBrow:n.getLeftEyeBrow(),rightEye:n.getRightEye(),rightEyeBrow:n.getRightEyeBrow()}}else t.parts={mouth:[],nose:[],leftEye:[],leftEyeBrow:[],rightEye:[],rightEyeBrow:[]};return t}}]),e}(),$u=function(e,t,n){var r,i={},a=n;e instanceof HTMLVideoElement?r=e:"object"===I()(e)&&e.elt instanceof HTMLVideoElement?r=e.elt:"object"===I()(e)?i=e:"function"==typeof e&&(a=e),"object"===I()(t)?(i=t,console.log(i)):"function"==typeof t&&(a=t);var o=new Yu(r,i,a);return a?o:o.ready},Ju={k:3,maxIter:5,threshold:.5};function Zu(e){return Qu.apply(this,arguments)}function Qu(){return(Qu=k()(D.a.mark((function e(t){var n,r;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=x.data.csv(t),e.next=3,n.toArray();case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ec(e){return tc.apply(this,arguments)}function tc(){return(tc=k()(D.a.mark((function e(t){var n,r;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t){e.next=6;break}return e.next=3,Zu(t);case 3:n=e.sent,e.next=7;break;case 6:n=t;case 7:return r=n.map((function(e){return Object.values(e)})),e.abrupt("return",r);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var nc=function(){function e(t,n,r){S()(this,e),this.config={k:n.k||Ju.k,maxIter:n.maxIter||Ju.maxIter,threshold:n.threshold||Ju.threshold},this.ready=T(this.load(t),r)}return A()(e,[{key:"load",value:function(){var e=k()(D.a.mark((function e(t){var n=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ec(t);case 2:return this.dataset=e.sent,x.tidy((function(){n.dataTensor=x.tensor2d(n.dataset),n.dataset.forEach((function(e){var t=x.tensor1d(Object.values(e));e.tensor=t})),n.centroids=x.tensor2d(ci(n.dataset,n.config.k,!1)),n.fit()})),e.abrupt("return",this);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fit",value:function(){this.getClosestCentroids(),this.recenterCentroids();for(var t=e.getEuclidianDistance(this.centroids,this.centroidsOld),n=0;t>this.config.threshold&&n<this.config.maxIter;)this.getClosestCentroids(),this.recenterCentroids(),t=e.getEuclidianDistance(this.centroids,this.centroidsOld),n+=1}},{key:"getClosestCentroids",value:function(){var e=this;this.dataset.forEach((function(t){var n=e.closestCentroid(t.tensor);t.centroid=n}))}},{key:"closestCentroid",value:function(e){var t=this;return x.tidy((function(){return t.centroids.squaredDifference(e).sum(1).sqrt().argMin().arraySync()}))}},{key:"classify",value:function(e){var t=this;return x.tidy((function(){var n=x.tensor1d(Object.values(e));return t.closestCentroid(n)}))}},{key:"recenterCentroids",value:function(){var e=this,t=x.tidy((function(){return e.centroidsOld=e.centroids,x.stack(e.centroids.unstack().map((function(t,n){var r=e.dataset.filter((function(e){return e.centroid===n})).map((function(e){return e.tensor}));return 0===r.length?t:1===r.length?r[0]:x.tidy((function(){return x.stack(r).mean(0)}))})))}));this.centroids=t}}],[{key:"getEuclidianDistance",value:function(e,t){return x.tidy((function(){return x.squaredDifference(e,t).sum().sqrt().dataSync()}))[0]}}]),e}(),rc=function(e,t,n){return new nc(e,t,n)};function ic(e){return ac.apply(this,arguments)}function ac(){return(ac=k()(D.a.mark((function e(t){var n,r;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=x.data.csv(t),e.next=3,n.toArray();case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function oc(e){return sc.apply(this,arguments)}function sc(){return(sc=k()(D.a.mark((function e(t){var n,r;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t){e.next=6;break}return e.next=3,ic(t);case 3:n=e.sent,e.next=7;break;case 6:n=t;case 7:return r=n.map((function(e){return Object.values(e)})),e.abrupt("return",r);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var uc={eps:50,minPts:3},cc=function(){function e(t,n,r){S()(this,e),this.config={eps:n.eps||uc.eps,minPts:n.minPts||uc.minPts},this.lastClusterId=0,this.status=[],this.ready=T(this.load(t),r)}return A()(e,[{key:"load",value:function(){var e=k()(D.a.mark((function e(t){var n=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,oc(t);case 2:return this.dataset=e.sent,x.tidy((function(){n.dataTensor=x.tensor2d(n.dataset),n.dataset.forEach((function(e){var t=x.tensor1d(Object.values(e));e.tensor=t})),n.fit()})),e.abrupt("return",this);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fit",value:function(){var e=this;this.dataset.forEach((function(t,n){if(void 0===t.status){t.status=0;var r=e.getNeighboursIndices(t);r.length<e.config.minPts?t.status=0:(e.incrementClusterId(),e.extend(n,r))}}))}},{key:"extend",value:function(e,t){var n=this;this.dataset[e].clusterid=this.getClusterId(),this.dataset[e].status=this.dataset[e].clusterid,t.forEach((function(t){if(void 0===n.dataset[t].status){n.dataset[t].status=0;var r=n.getNeighboursIndices(n.dataset[t]);r.length>=n.config.minPts&&n.extend(t,r)}n.dataset[t].status<1&&(n.dataset[t].status=n.dataset[e].clusterid,n.dataset[t].clusterid=n.dataset[e].clusterid)}))}},{key:"getClusterId",value:function(){return this.lastClusterId}},{key:"incrementClusterId",value:function(){this.lastClusterId+=1}},{key:"getNeighboursIndices",value:function(e){var t=this;try{return x.tidy((function(){var n=x.squaredDifference(e.tensor,t.dataTensor).sum(1).sqrt().topk(t.dataTensor.shape[0],!0),r=n.values,i=n.indices;return x.stack([r.asType("float32"),i.asType("float32")],1).arraySync().filter((function(e){return e[0]<=t.config.eps})).reduce((function(e,t){return e.push(t[1]),e}),[])}))||[]}catch(e){console.log("error ".concat(e))}return[]}}]),e}(),lc=function(e,t,n){return new cc(e,t,n)},fc={hosoda:"https://raw.githubusercontent.com/leemengtaiwan/tfjs-models/master/cartoongan/tfjs_json_models/hosoda/model.json",miyazaki:"https://raw.githubusercontent.com/Derek-Wds/training_CartoonGAN/master/tfModels/Miyazaki/model.json"},dc=function(){function e(t,n){S()(this,e),this.config={modelUrl:t.modelUrl?t.modelUrl:fc.miyazaki,returnTensors:!!t.returnTensors&&t.returnTensors},this.model={},this.ready=!1,this.ready=T(this.loadModel(this.config.modelUrl),n)}return A()(e,[{key:"loadModel",value:function(){var e=k()(D.a.mark((function e(t){return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.loadGraphModel(t);case 2:return this.model=e.sent,e.abrupt("return",this);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"generate",value:function(){var e=k()(D.a.mark((function e(t,n){var r,i;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=n,!me(t)){e.next=5;break}r=t,e.next=19;break;case 5:if("object"!==I()(t)||!me(t.elt)){e.next=9;break}r=t.elt,e.next=19;break;case 9:if("object"!==I()(t)||!me(t.canvas)){e.next=13;break}r=t.canvas,e.next=19;break;case 13:if("function"!=typeof t){e.next=18;break}r=this.video,i=t,e.next=19;break;case 18:throw new Error("Detection subject not supported");case 19:return e.abrupt("return",T(this.generateInternal(r),i));case 20:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"generateInternal",value:function(){var e=k()(D.a.mark((function e(t){var n,r,i,a;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ready;case 2:return e.next=4,x.nextFrame();case 4:if(256===(n=x.browser.fromPixels(t).resizeBilinear([256,256])).shape[0]&&256===n.shape[1]){e.next=9;break}throw new Error("Input size should be ".concat(256,"*").concat(256," but ").concat(n.shape," is found"));case 9:if(3===n.shape[2]){e.next=11;break}throw new Error("Input color channel number should be 3 but ".concat(n.shape[2]," is found"));case 11:if(n=n.sub(127.5).div(127.5).reshape([1,256,256,3]),r=x.ones([256,256,1]).tile([1,1,1]).mul(255),i=(i=(i=this.model.predict(n)).add(1).mul(127.5).reshape([256,256,3]).floor()).concat(r,2),a=this.resultFinalize(i),!this.config.returnTensors){e.next=19;break}return e.abrupt("return",a);case 19:return n.dispose(),i.dispose(),e.abrupt("return",a);case 22:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"resultFinalize",value:function(){var e=k()(D.a.mark((function e(t){var n,r,i,a;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t,e.next=3,t.data();case 3:return r=e.sent,e.next=6,ce.rawToBlob(r,t.shape[0],t.shape[1]);case 6:return i=e.sent,e.next=9,ce.blobToP5Image(i);case 9:if(a=e.sent,!this.config.returnTensors){e.next=12;break}return e.abrupt("return",{tensor:n,raw:r,blob:i,image:a});case 12:return e.abrupt("return",{raw:r,blob:i,image:a});case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),hc=function(e,t){var n="object"===I()(e)?e:{},r="function"==typeof e?e:t;return"string"==typeof e&&(n.modelUrl=e),new dc(n,r)};function pc(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))}function mc(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}var vc=function(e){for(var t=[],n=0,r=e;n<r.length;n++){var i=r[n];t.push(i)}return t},gc=function(){this.parent=null,this.children={},this.end=!1,this.word=[[],0,0]},yc=function(){function e(){this.root=new gc}return e.prototype.insert=function(e,t,n){for(var r=this.root,i=vc(e),a=0;a<i.length;a++)r.children[i[a]]||(r.children[i[a]]=new gc,r.children[i[a]].parent=r,r.children[i[a]].word[0]=r.word[0].concat(i[a])),r=r.children[i[a]],a===i.length-1&&(r.end=!0,r.word[1]=t,r.word[2]=n)},e.prototype.commonPrefixSearch=function(e){for(var t=[],n=this.root.children[e[0]],r=0;r<e.length&&n;r++)n.end&&t.push(n.word),n=n.children[e[r+1]];return t.length||t.push([[e[0]],0,0]),t},e}(),bc="\u2581",xc=6,wc=function(){function e(e,t){void 0===t&&(t=xc),this.vocabulary=e,this.reservedSymbolsCount=t,this.trie=new yc;for(var n=this.reservedSymbolsCount;n<this.vocabulary.length;n++)this.trie.insert(this.vocabulary[n][0],this.vocabulary[n][1],n)}return e.prototype.encode=function(e){var t=[],n=[],r=[];e=function(e){var t=e.normalize("NFKC");return t.length>0?bc+t.replace(/ /g,bc):t}(e);for(var i=vc(e),a=0;a<=i.length;a++)t.push({}),n.push(0),r.push(0);for(a=0;a<i.length;a++)for(var o=this.trie.commonPrefixSearch(i.slice(a)),s=0;s<o.length;s++){var u=o[s],c={key:u[0],score:u[1],index:u[2]};null==t[a+(l=u[0].length)][a]&&(t[a+l][a]=[]),t[a+l][a].push(c)}for(var l=0;l<=i.length;l++)for(var f in t[l]){var d=t[l][f];for(s=0;s<d.length;s++){var h=d[s],p=h.score+r[l-h.key.length];(0===r[l]||p>=r[l])&&(r[l]=p,n[l]=d[s].index)}}for(var m=[],v=n.length-1;v>0;)m.push(n[v]),v-=this.vocabulary[n[v]][0].length;var g=[],y=!1;for(a=0;a<m.length;a++){var b=m[a];y&&0===b||g.push(b),y=0===b}return g.reverse()},e}();function _c(e){return pc(this,void 0,void 0,(function(){var t;return mc(this,(function(n){switch(n.label){case 0:return[4,kc(e)];case 1:return t=n.sent(),[2,new wc(t)]}}))}))}function kc(e){return pc(this,void 0,void 0,(function(){return mc(this,(function(t){switch(t.label){case 0:return[4,B.util.fetch(e)];case 1:return[2,t.sent().json()]}}))}))}var Ec=[0,1,2];function Sc(e){return pc(this,void 0,void 0,(function(){var t;return mc(this,(function(n){switch(n.label){case 0:return[4,(t=new Cc).load(e)];case 1:return n.sent(),[2,t]}}))}))}!function(){function e(){}e.prototype.loadModel=function(){return pc(this,void 0,void 0,(function(){return mc(this,(function(e){return[2,Object(P.loadGraphModel)("https://tfhub.dev/google/tfjs-model/universal-sentence-encoder-qa-ondevice/1",{fromTFHub:!0})]}))}))},e.prototype.load=function(){return pc(this,void 0,void 0,(function(){var e,t,n;return mc(this,(function(r){switch(r.label){case 0:return[4,Promise.all([this.loadModel(),kc("https://tfhub.dev/google/tfjs-model/universal-sentence-encoder-qa-ondevice/1/vocab.json?tfjs-format=file")])];case 1:return e=r.sent(),t=e[0],n=e[1],this.model=t,this.tokenizer=new wc(n,3),[2]}}))}))},e.prototype.embed=function(e){var t=this,n=Object(B.tidy)((function(){var n=t.tokenizeStrings(e.queries,192),r=t.tokenizeStrings(e.responses,192);if(null!=e.contexts&&e.contexts.length!==e.responses.length)throw new Error("The length of response strings and context strings need to match.");var i=e.contexts||[];null==e.contexts&&(i.length=e.responses.length,i.fill(""));var a=t.tokenizeStrings(i,192),o={};return o.input_inp_text=n,o.input_res_text=r,o.input_res_context=a,t.model.execute(o,["Final/EncodeQuery/mul","Final/EncodeResult/mul"])}));return{queryEmbedding:n[0],responseEmbedding:n[1]}},e.prototype.tokenizeStrings=function(e,t){var n=this,r=e.map((function(e){return n.shiftTokens(n.tokenizer.encode(e),192)}));return Object(B.tensor2d)(r,[e.length,192],"int32")},e.prototype.shiftTokens=function(e,t){e.unshift(1);for(var n=0;n<t;n++)n>=e.length?e[n]=2:Ec.includes(e[n])||(e[n]+=3);return e.slice(0,t)}}();var Cc=function(){function e(){}return e.prototype.loadModel=function(e){return pc(this,void 0,void 0,(function(){return mc(this,(function(t){return[2,e?Object(P.loadGraphModel)(e):Object(P.loadGraphModel)("https://tfhub.dev/tensorflow/tfjs-model/universal-sentence-encoder-lite/1/default/1",{fromTFHub:!0})]}))}))},e.prototype.load=function(e){return void 0===e&&(e={}),pc(this,void 0,void 0,(function(){var t,n,r;return mc(this,(function(i){switch(i.label){case 0:return[4,Promise.all([this.loadModel(e.modelUrl),kc(e.vocabUrl||"https://storage.googleapis.com/tfjs-models/savedmodel/universal_sentence_encoder/vocab.json")])];case 1:return t=i.sent(),n=t[0],r=t[1],this.model=n,this.tokenizer=new wc(r),[2]}}))}))},e.prototype.embed=function(e){return pc(this,void 0,void 0,(function(){var t,n,r,i,a,o,s,u,c=this;return mc(this,(function(l){switch(l.label){case 0:for("string"==typeof e&&(e=[e]),t=e.map((function(e){return c.tokenizer.encode(e)})),n=t.map((function(e,t){return e.map((function(e,n){return[t,n]}))})),r=[],i=0;i<n.length;i++)r=r.concat(n[i]);return a=Object(B.tensor2d)(r,[r.length,2],"int32"),o=Object(B.tensor1d)(B.util.flatten(t),"int32"),s={indices:a,values:o},[4,this.model.executeAsync(s)];case 1:return u=l.sent(),a.dispose(),o.dispose(),[2,u]}}))}))},e}(),Ac={withTokenizer:!1},Oc=function(){function e(t,n){S()(this,e),this.model=null,this.tokenizer=null,this.config={withTokenizer:t.withTokenizer||Ac.withTokenizer},T(this.loadModel(),n)}return A()(e,[{key:"loadModel",value:function(){var e=k()(D.a.mark((function e(){return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!0!==this.config.withTokenizer){e.next=4;break}return e.next=3,_c();case 3:this.tokenizer=e.sent;case 4:return e.next=6,Sc();case 6:return this.model=e.sent,e.abrupt("return",this);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"predict",value:function(e,t){return T(this.predictInternal(e),t)}},{key:"predictInternal",value:function(){var e=k()(D.a.mark((function e(t){var n,r;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.model.embed(t);case 3:return n=e.sent,e.next=6,n.array();case 6:return r=e.sent,n.dispose(),e.abrupt("return",r);case 11:return e.prev=11,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",e.t0);case 15:case"end":return e.stop()}}),e,this,[[0,11]])})));return function(t){return e.apply(this,arguments)}}()},{key:"encode",value:function(e,t){return T(this.encodeInternal(e),t)}},{key:"encodeInternal",value:function(){var e=k()(D.a.mark((function e(t){return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!0!==this.config.withTokenizer){e.next=2;break}return e.abrupt("return",this.tokenizer.encode(t));case 2:return console.error('withTokenizer must be set to true - please pass "withTokenizer:true" as an option in the constructor'),e.abrupt("return",!1);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),Dc=function(e,t){var n="object"===I()(e)?e:{};return new Oc(n,"function"==typeof e?e:t)},Tc=function(e){e.startEndTensor.dispose(),e.startPoint.dispose(),e.endPoint.dispose()},jc=function(e){return{startEndTensor:e,startPoint:Object(B.slice)(e,[0,0],[-1,2]),endPoint:Object(B.slice)(e,[0,2],[-1,2])}},Mc=function(e,t){var n=Object(B.mul)(e.startPoint,t),r=Object(B.mul)(e.endPoint,t),i=Object(B.concat2d)([n,r],1);return jc(i)},Fc={strides:[8,16],anchors:[2,6]},Ic=6;function Nc(e,t){var n,r,i;if(e.topLeft instanceof B.Tensor&&e.bottomRight instanceof B.Tensor){var a=Object(B.tidy)((function(){return[Object(B.concat)([Object(B.sub)(t-1,e.topLeft.slice(0,1)),e.topLeft.slice(1,1)]),Object(B.concat)([Object(B.sub)(t-1,e.bottomRight.slice(0,1)),e.bottomRight.slice(1,1)])]})),o=f(a,2);n=o[0],r=o[1],null!=e.landmarks&&(i=Object(B.tidy)((function(){var n=Object(B.sub)(Object(B.tensor1d)([t-1,0]),e.landmarks),r=Object(B.tensor1d)([1,-1]);return Object(B.mul)(n,r)})))}else{var s=f(e.topLeft,2),u=s[0],c=s[1],l=f(e.bottomRight,2),d=l[0],h=l[1];n=[t-1-u,c],r=[t-1-d,h],null!=e.landmarks&&(i=e.landmarks.map((function(e){return[t-1-e[0],e[1]]})))}var p={topLeft:n,bottomRight:r};return null!=i&&(p.landmarks=i),null!=e.probability&&(p.probability=e.probability instanceof B.Tensor?e.probability.clone():e.probability),p}function Rc(e,t){return Object(B.tidy)((function(){var n;return n=e.hasOwnProperty("box")?e.box:e,Mc(n,t).startEndTensor.squeeze()}))}var Pc=function(){function e(t,n,r,i,a,o){v(this,e),this.blazeFaceModel=t,this.width=n,this.height=r,this.maxFaces=i,this.anchorsData=function(e,t,n){for(var r=[],i=0;i<n.strides.length;i++)for(var a=n.strides[i],o=Math.floor((t+a-1)/a),s=Math.floor((e+a-1)/a),u=n.anchors[i],c=0;c<o;c++)for(var l=a*(c+.5),f=0;f<s;f++)for(var d=a*(f+.5),h=0;h<u;h++)r.push([d,l]);return r}(n,r,Fc),this.anchors=Object(B.tensor2d)(this.anchorsData),this.inputSizeData=[n,r],this.inputSize=Object(B.tensor1d)([n,r]),this.iouThreshold=a,this.scoreThreshold=o}return g(e,[{key:"getBoundingBoxes",value:function(){var e=d(m().mark((function e(t,n){var r,i,a,o,s,u,c,l,h,p,v,g,y,b,x,w,_=this,k=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=!(k.length>2&&void 0!==k[2])||k[2],i=Object(B.tidy)((function(){var e=t.resizeBilinear([_.width,_.height]),n=Object(B.mul)(Object(B.sub)(e.div(255),.5),2),r=_.blazeFaceModel.predict(n).squeeze(),i=function(e,t,n){var r=Object(B.slice)(e,[0,1],[-1,2]),i=Object(B.add)(r,t),a=Object(B.slice)(e,[0,3],[-1,2]),o=Object(B.div)(a,n),s=Object(B.div)(i,n),u=Object(B.div)(o,2),c=Object(B.sub)(s,u),l=Object(B.add)(s,u),f=Object(B.mul)(c,n),d=Object(B.mul)(l,n);return Object(B.concat2d)([f,d],1)}(r,_.anchors,_.inputSize),a=Object(B.slice)(r,[0,0],[-1,1]);return[r,i,Object(B.sigmoid)(a).squeeze()]})),a=f(i,3),o=a[0],s=a[1],u=a[2],c=console.warn,console.warn=function(){},l=B.image.nonMaxSuppression(s,u,this.maxFaces,this.iouThreshold,this.scoreThreshold),console.warn=c,e.next=7,l.array();case 7:if(h=e.sent,l.dispose(),p=h.map((function(e){return Object(B.slice)(s,[e,0],[1,-1])})),e.t0=n,e.t0){e.next=15;break}return e.next=14,Promise.all(p.map(function(){var e=d(m().mark((function e(t){var n;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.array();case 2:return n=e.sent,e.abrupt("return",(t.dispose(),n));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 14:p=e.sent;case 15:v=t.shape[1],g=t.shape[2],y=n?Object(B.div)([g,v],this.inputSize):[g/this.inputSizeData[0],v/this.inputSizeData[1]],b=[],x=m().mark((function e(t){var i,a;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=p[t],a=Object(B.tidy)((function(){var e=jc(i instanceof B.Tensor?i:Object(B.tensor2d)(i));if(!r)return e;var a,s=h[t];return a=n?_.anchors.slice([s,0],[1,2]):_.anchorsData[s],{box:e,landmarks:Object(B.slice)(o,[s,Ic-1],[1,-1]).squeeze().reshape([Ic,-1]),probability:Object(B.slice)(u,[s],[1]),anchor:a}})),b.push(a);case 2:case"end":return e.stop()}}),e)})),w=0;case 20:if(!(w<p.length)){e.next=25;break}return e.delegateYield(x(w),"t1",22);case 22:w++,e.next=20;break;case 25:return e.abrupt("return",(s.dispose(),u.dispose(),o.dispose(),{boxes:b,scaleFactor:y}));case 26:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"estimateFaces",value:function(){var e=d(m().mark((function e(t){var n,r,i,a,o,s,u,c,l,h,p=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=p.length>1&&void 0!==p[1]&&p[1],r=p.length>2&&void 0!==p[2]&&p[2],i=!(p.length>3&&void 0!==p[3])||p[3],a=function(e){return e instanceof B.Tensor?[e.shape[0],e.shape[1]]:[e.height,e.width]}(t),o=f(a,2),s=o[1],u=Object(B.tidy)((function(){return t instanceof B.Tensor||(t=B.browser.fromPixels(t)),t.toFloat().expandDims(0)})),e.next=9,this.getBoundingBoxes(u,n,i);case 9:return c=e.sent,l=c.boxes,h=c.scaleFactor,e.abrupt("return",(u.dispose(),n?l.map((function(e){var t=Rc(e,h),n={topLeft:t.slice([0],[2]),bottomRight:t.slice([2],[2])};if(i){var a=e.landmarks,o=e.probability,u=e.anchor,c=a.add(u).mul(h);n.landmarks=c,n.probability=o}return r&&(n=Nc(n,s)),n})):Promise.all(l.map(function(){var e=d(m().mark((function e(t){var n,a,o,u,c,l,p,v,g,y,b,x,w;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Rc(t,h),!i){e.next=17;break}return e.next=4,Promise.all([t.landmarks,n,t.probability].map(function(){var e=d(m().mark((function e(t){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.array());case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:o=e.sent,u=f(o,3),c=u[0],l=u[1],p=u[2],v=t.anchor,g=f(h,2),y=g[0],b=g[1],x=c.map((function(e){return[(e[0]+v[0])*y,(e[1]+v[1])*b]})),a={topLeft:l.slice(0,2),bottomRight:l.slice(2),landmarks:x,probability:p},Tc(t.box),t.landmarks.dispose(),t.probability.dispose(),e.next=21;break;case 17:return e.next=19,n.array();case 19:w=e.sent,a={topLeft:w.slice(0,2),bottomRight:w.slice(2)};case 21:return e.abrupt("return",(n.dispose(),r&&(a=Nc(a,s)),a));case 22:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()))));case 13:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}]),e}(),Bc="https://tfhub.dev/tensorflow/tfjs-model/blazeface/1/default/1",Lc={silhouette:[10,338,297,332,284,251,389,356,454,323,361,288,397,365,379,378,400,377,152,148,176,149,150,136,172,58,132,93,234,127,162,21,54,103,67,109],lipsUpperOuter:[61,185,40,39,37,0,267,269,270,409,291],lipsLowerOuter:[146,91,181,84,17,314,405,321,375,291],lipsUpperInner:[78,191,80,81,82,13,312,311,310,415,308],lipsLowerInner:[78,95,88,178,87,14,317,402,318,324,308],rightEyeUpper0:[246,161,160,159,158,157,173],rightEyeLower0:[33,7,163,144,145,153,154,155,133],rightEyeUpper1:[247,30,29,27,28,56,190],rightEyeLower1:[130,25,110,24,23,22,26,112,243],rightEyeUpper2:[113,225,224,223,222,221,189],rightEyeLower2:[226,31,228,229,230,231,232,233,244],rightEyeLower3:[143,111,117,118,119,120,121,128,245],rightEyebrowUpper:[156,70,63,105,66,107,55,193],rightEyebrowLower:[35,124,46,53,52,65],leftEyeUpper0:[466,388,387,386,385,384,398],leftEyeLower0:[263,249,390,373,374,380,381,382,362],leftEyeUpper1:[467,260,259,257,258,286,414],leftEyeLower1:[359,255,339,254,253,252,256,341,463],leftEyeUpper2:[342,445,444,443,442,441,413],leftEyeLower2:[446,261,448,449,450,451,452,453,464],leftEyeLower3:[372,340,346,347,348,349,350,357,465],leftEyebrowUpper:[383,300,293,334,296,336,285,417],leftEyebrowLower:[265,353,276,283,282,295],midwayBetweenEyes:[168],noseTip:[1],noseBottom:[2],noseRightCorner:[98],noseLeftCorner:[327],rightCheek:[205],leftCheek:[425]};function zc(e){null!=e&&null!=e.startPoint&&(e.startEndTensor.dispose(),e.startPoint.dispose(),e.endPoint.dispose())}function Uc(e,t,n){return{startEndTensor:e,startPoint:null!=t?t:Object(B.slice)(e,[0,0],[-1,2]),endPoint:null!=n?n:Object(B.slice)(e,[0,2],[-1,2])}}function Wc(e){return Object(B.tidy)((function(){var t=Object(B.sub)(e.endPoint,e.startPoint);return Object(B.abs)(t)}))}function Vc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1.5;return Object(B.tidy)((function(){var n=function(e){return Object(B.tidy)((function(){var t=Object(B.div)(Object(B.sub)(e.endPoint,e.startPoint),2);return Object(B.add)(e.startPoint,t)}))}(e),r=Wc(e),i=Object(B.mul)(Object(B.div)(r,2),t),a=Object(B.sub)(n,i),o=Object(B.add)(n,i);return Uc(Object(B.concat2d)([a,o],1),a,o)}))}var Gc=468,qc=.25,Hc=function(){function e(t,n,r,i,a,o){v(this,e),this.regionsOfInterest=[],this.runsWithoutFaceDetector=0,this.boundingBoxDetector=t,this.meshDetector=n,this.meshWidth=r,this.meshHeight=i,this.maxContinuousChecks=a,this.maxFaces=o}return g(e,[{key:"predict",value:function(){var e=d(m().mark((function e(t){var n,r,i,a,o,s,u=this;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.shouldUpdateRegionsOfInterest()){e.next=14;break}return n=!0,r=!1,e.next=5,this.boundingBoxDetector.getBoundingBoxes(t,n,r);case 5:if(i=e.sent,a=i.boxes,o=i.scaleFactor,0!==a.length){e.next=10;break}return e.abrupt("return",(o.dispose(),this.clearAllRegionsOfInterest(),null));case 10:s=a.map((function(e){return Vc(function(e,t){var n=Object(B.mul)(e.startPoint,t),r=Object(B.mul)(e.endPoint,t);return Uc(Object(B.concat2d)([n,r],1))}(e,o))})),a.forEach(zc),this.updateRegionsOfInterest(s),this.runsWithoutFaceDetector=0,e.next=15;break;case 14:this.runsWithoutFaceDetector++;case 15:return e.abrupt("return",Object(B.tidy)((function(){return u.regionsOfInterest.map((function(e,n){var r=function(e,t,n){var r=t.shape[1],i=t.shape[2],a=e.startEndTensor;return Object(B.tidy)((function(){var e=Object(B.concat2d)([a.slice([0,1],[-1,1]),a.slice([0,0],[-1,1]),a.slice([0,3],[-1,1]),a.slice([0,2],[-1,1])],0),o=Object(B.div)(e.transpose(),[r,i,r,i]);return B.image.cropAndResize(t,o,[0],n)}))}(e,t,[u.meshHeight,u.meshWidth]).div(255),i=u.meshDetector.predict(r),a=f(i,3),o=a[1],s=a[2],c=Object(B.reshape)(s,[-1,3]),l=Object(B.div)(Wc(e),[u.meshWidth,u.meshHeight]),d=Object(B.mul)(c,l.concat(Object(B.tensor2d)([1],[1,1]),1)).add(e.startPoint.concat(Object(B.tensor2d)([0],[1,1]),1)),h=u.calculateLandmarksBoundingBox(d);return zc(u.regionsOfInterest[n]),u.regionsOfInterest[n]=h,{coords:c,scaledCoords:d,box:h,flag:o.squeeze()}}))})));case 16:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"updateRegionsOfInterest",value:function(e){for(var t=0;t<e.length;t++){var n=e[t],r=this.regionsOfInterest[t],i=0;if(r&&r.startPoint){var a=f(n.startEndTensor.arraySync()[0],4),o=a[0],s=a[1],u=a[2],c=a[3],l=f(r.startEndTensor.arraySync()[0],4),d=l[0],h=l[1],p=l[2],m=l[3],v=Math.max(o,d),g=Math.max(s,h),y=(Math.min(u,p)-v)*(Math.min(c,m)-g);i=y/((u-o)*(c-s)+(p-d)*(m-s)-y)}i>qc?zc(n):(this.regionsOfInterest[t]=n,zc(r))}for(var b=e.length;b<this.regionsOfInterest.length;b++)zc(this.regionsOfInterest[b]);this.regionsOfInterest=this.regionsOfInterest.slice(0,e.length)}},{key:"clearRegionOfInterest",value:function(e){null!=this.regionsOfInterest[e]&&(zc(this.regionsOfInterest[e]),this.regionsOfInterest=[].concat(h(this.regionsOfInterest.slice(0,e)),h(this.regionsOfInterest.slice(e+1))))}},{key:"clearAllRegionsOfInterest",value:function(){for(var e=0;e<this.regionsOfInterest.length;e++)zc(this.regionsOfInterest[e]);this.regionsOfInterest=[]}},{key:"shouldUpdateRegionsOfInterest",value:function(){var e=this.regionsOfInterest.length,t=0===e;return 1===this.maxFaces||t?t:e!==this.maxFaces&&this.runsWithoutFaceDetector>=this.maxContinuousChecks}},{key:"calculateLandmarksBoundingBox",value:function(e){var t=e.slice([0,0],[Gc,1]),n=e.slice([0,1],[Gc,1]);return Vc(Uc(Object(B.stack)([t.min(),n.min(),t.max(),n.max()]).expandDims(0)))}}]),e}(),Xc=[[.499976992607117,.652534008026123],[.500025987625122,.547487020492554],[.499974012374878,.602371990680695],[.482113003730774,.471979022026062],[.500150978565216,.527155995368958],[.499909996986389,.498252987861633],[.499523013830185,.40106201171875],[.289712011814117,.380764007568359],[.499954998493195,.312398016452789],[.499987006187439,.269918978214264],[.500023007392883,.107050001621246],[.500023007392883,.666234016418457],[.5000159740448,.679224014282227],[.500023007392883,.692348003387451],[.499976992607117,.695277988910675],[.499976992607117,.70593398809433],[.499976992607117,.719385027885437],[.499976992607117,.737019002437592],[.499967992305756,.781370997428894],[.499816000461578,.562981009483337],[.473773002624512,.573909997940063],[.104906998574734,.254140973091125],[.365929991006851,.409575998783112],[.338757991790771,.41302502155304],[.311120003461838,.409460008144379],[.274657994508743,.389131009578705],[.393361985683441,.403706014156342],[.345234006643295,.344011008739471],[.370094001293182,.346076011657715],[.319321990013123,.347265005111694],[.297903001308441,.353591024875641],[.24779200553894,.410809993743896],[.396889001131058,.842755019664764],[.280097991228104,.375599980354309],[.106310002505779,.399955987930298],[.2099249958992,.391353011131287],[.355807989835739,.534406006336212],[.471751004457474,.65040397644043],[.474155008792877,.680191993713379],[.439785003662109,.657229006290436],[.414617002010345,.66654098033905],[.450374007225037,.680860996246338],[.428770989179611,.682690978050232],[.374971002340317,.727805018424988],[.486716985702515,.547628998756409],[.485300987958908,.527395009994507],[.257764995098114,.314490020275116],[.401223003864288,.455172002315521],[.429818987846375,.548614978790283],[.421351999044418,.533740997314453],[.276895999908447,.532056987285614],[.483370006084442,.499586999416351],[.33721199631691,.282882988452911],[.296391993761063,.293242990970612],[.169294998049736,.193813979625702],[.447580009698868,.302609980106354],[.392390012741089,.353887975215912],[.354490011930466,.696784019470215],[.067304998636246,.730105042457581],[.442739009857178,.572826027870178],[.457098007202148,.584792017936707],[.381974011659622,.694710969924927],[.392388999462128,.694203019142151],[.277076005935669,.271932005882263],[.422551989555359,.563233017921448],[.385919004678726,.281364023685455],[.383103013038635,.255840003490448],[.331431001424789,.119714021682739],[.229923993349075,.232002973556519],[.364500999450684,.189113974571228],[.229622006416321,.299540996551514],[.173287004232407,.278747975826263],[.472878992557526,.666198015213013],[.446828007698059,.668527007102966],[.422762006521225,.673889994621277],[.445307999849319,.580065965652466],[.388103008270264,.693961024284363],[.403039008378983,.706539988517761],[.403629004955292,.693953037261963],[.460041999816895,.557139039039612],[.431158006191254,.692366003990173],[.452181994915009,.692366003990173],[.475387006998062,.692366003990173],[.465828001499176,.779190003871918],[.472328990697861,.736225962638855],[.473087012767792,.717857003211975],[.473122000694275,.704625964164734],[.473033010959625,.695277988910675],[.427942007780075,.695277988910675],[.426479011774063,.703539967536926],[.423162013292313,.711845993995667],[.4183090031147,.720062971115112],[.390094995498657,.639572978019714],[.013953999616206,.560034036636353],[.499913990497589,.58014702796936],[.413199990987778,.69539999961853],[.409626007080078,.701822996139526],[.468080013990402,.601534962654114],[.422728985548019,.585985004901886],[.463079988956451,.593783974647522],[.37211999297142,.47341400384903],[.334562003612518,.496073007583618],[.411671012639999,.546965003013611],[.242175996303558,.14767599105835],[.290776997804642,.201445996761322],[.327338010072708,.256527006626129],[.399509996175766,.748921036720276],[.441727995872498,.261676013469696],[.429764986038208,.187834024429321],[.412198007106781,.108901023864746],[.288955003023148,.398952007293701],[.218936994671822,.435410976409912],[.41278201341629,.398970007896423],[.257135003805161,.355440020561218],[.427684992551804,.437960982322693],[.448339998722076,.536936044692993],[.178560003638268,.45755398273468],[.247308000922203,.457193970680237],[.286267012357712,.467674970626831],[.332827985286713,.460712015628815],[.368755996227264,.447206974029541],[.398963987827301,.432654976844788],[.476410001516342,.405806005001068],[.189241006970406,.523923993110657],[.228962004184723,.348950982093811],[.490725994110107,.562400996685028],[.404670000076294,.485132992267609],[.019469000399113,.401564002037048],[.426243007183075,.420431017875671],[.396993011236191,.548797011375427],[.266469985246658,.376977026462555],[.439121007919312,.51895797252655],[.032313998788595,.644356966018677],[.419054001569748,.387154996395111],[.462783008813858,.505746960639954],[.238978996872902,.779744982719421],[.198220998048782,.831938028335571],[.107550002634525,.540755033493042],[.183610007166862,.740257024765015],[.134409993886948,.333683013916016],[.385764002799988,.883153975009918],[.490967005491257,.579378008842468],[.382384985685349,.508572995662689],[.174399003386497,.397670984268188],[.318785011768341,.39623498916626],[.343364000320435,.400596976280212],[.396100014448166,.710216999053955],[.187885001301765,.588537991046906],[.430987000465393,.944064974784851],[.318993002176285,.898285031318665],[.266247987747192,.869701027870178],[.500023007392883,.190576016902924],[.499976992607117,.954452991485596],[.366169989109039,.398822009563446],[.393207013607025,.39553701877594],[.410373002290726,.391080021858215],[.194993004202843,.342101991176605],[.388664990663528,.362284004688263],[.365961998701096,.355970978736877],[.343364000320435,.355356991291046],[.318785011768341,.35834002494812],[.301414996385574,.363156020641327],[.058132998645306,.319076001644135],[.301414996385574,.387449026107788],[.499987989664078,.618434011936188],[.415838003158569,.624195992946625],[.445681989192963,.566076993942261],[.465844005346298,.620640993118286],[.49992299079895,.351523995399475],[.288718998432159,.819945991039276],[.335278987884521,.852819979190826],[.440512001514435,.902418971061707],[.128294005990028,.791940987110138],[.408771991729736,.373893976211548],[.455606997013092,.451801002025604],[.499877005815506,.908990025520325],[.375436991453171,.924192011356354],[.11421000212431,.615022003650665],[.448662012815475,.695277988910675],[.4480200111866,.704632043838501],[.447111994028091,.715808033943176],[.444831997156143,.730794012546539],[.430011987686157,.766808986663818],[.406787008047104,.685672998428345],[.400738000869751,.681069016456604],[.392399996519089,.677703022956848],[.367855995893478,.663918972015381],[.247923001646996,.601333022117615],[.452769994735718,.420849978923798],[.43639200925827,.359887003898621],[.416164010763168,.368713974952698],[.413385987281799,.692366003990173],[.228018000721931,.683571994304657],[.468268007040024,.352671027183533],[.411361992359161,.804327011108398],[.499989002943039,.469825029373169],[.479153990745544,.442654013633728],[.499974012374878,.439637005329132],[.432112008333206,.493588984012604],[.499886006116867,.866917014122009],[.49991300702095,.821729004383087],[.456548988819122,.819200992584229],[.344549000263214,.745438992977142],[.37890899181366,.574010014533997],[.374292999505997,.780184984207153],[.319687992334366,.570737957954407],[.357154995203018,.604269981384277],[.295284003019333,.621580958366394],[.447750002145767,.862477004528046],[.410986006259918,.508723020553589],[.31395098567009,.775308012962341],[.354128003120422,.812552988529205],[.324548006057739,.703992962837219],[.189096003770828,.646299958229065],[.279776990413666,.71465802192688],[.1338230073452,.682700991630554],[.336768001317978,.644733011722565],[.429883986711502,.466521978378296],[.455527991056442,.548622965812683],[.437114000320435,.558896005153656],[.467287987470627,.529924988746643],[.414712011814117,.335219979286194],[.37704598903656,.322777986526489],[.344107985496521,.320150971412659],[.312875986099243,.32233202457428],[.283526003360748,.333190023899078],[.241245999932289,.382785975933075],[.102986000478268,.468762993812561],[.267612010240555,.424560010433197],[.297879010438919,.433175981044769],[.333433985710144,.433878004550934],[.366427004337311,.426115989685059],[.396012008190155,.416696012020111],[.420121014118195,.41022801399231],[.007561000064015,.480777025222778],[.432949006557465,.569517970085144],[.458638995885849,.479089021682739],[.473466008901596,.545744001865387],[.476087987422943,.563830018043518],[.468472003936768,.555056989192963],[.433990985155106,.582361996173859],[.483518004417419,.562983989715576],[.482482999563217,.57784903049469],[.42645001411438,.389798998832703],[.438998997211456,.39649498462677],[.450067013502121,.400434017181396],[.289712011814117,.368252992630005],[.276670008897781,.363372981548309],[.517862021923065,.471948027610779],[.710287988185883,.380764007568359],[.526226997375488,.573909997940063],[.895093023777008,.254140973091125],[.634069979190826,.409575998783112],[.661242008209229,.41302502155304],[.688880026340485,.409460008144379],[.725341975688934,.389131009578705],[.606630027294159,.40370500087738],[.654766023159027,.344011008739471],[.629905998706818,.346076011657715],[.680678009986877,.347265005111694],[.702096998691559,.353591024875641],[.75221198797226,.410804986953735],[.602918028831482,.842862963676453],[.719901978969574,.375599980354309],[.893692970275879,.399959981441498],[.790081977844238,.391354024410248],[.643998026847839,.534487962722778],[.528249025344849,.65040397644043],[.525849997997284,.680191040039062],[.560214996337891,.657229006290436],[.585384011268616,.66654098033905],[.549625992774963,.680860996246338],[.57122802734375,.682691991329193],[.624852001667023,.72809898853302],[.513050019741058,.547281980514526],[.51509702205658,.527251958847046],[.742246985435486,.314507007598877],[.598631024360657,.454979002475739],[.570338010787964,.548575043678284],[.578631997108459,.533622980117798],[.723087012767792,.532054007053375],[.516445994377136,.499638974666595],[.662801027297974,.282917976379395],[.70362401008606,.293271005153656],[.830704987049103,.193813979625702],[.552385985851288,.302568018436432],[.607609987258911,.353887975215912],[.645429015159607,.696707010269165],[.932694971561432,.730105042457581],[.557260990142822,.572826027870178],[.542901992797852,.584792017936707],[.6180260181427,.694710969924927],[.607590973377228,.694203019142151],[.722943007946014,.271963000297546],[.577413976192474,.563166975975037],[.614082992076874,.281386971473694],[.616907000541687,.255886018276215],[.668509006500244,.119913995265961],[.770092010498047,.232020974159241],[.635536015033722,.189248979091644],[.77039098739624,.299556016921997],[.826722025871277,.278755009174347],[.527121007442474,.666198015213013],[.553171992301941,.668527007102966],[.577238023281097,.673889994621277],[.554691970348358,.580065965652466],[.611896991729736,.693961024284363],[.59696102142334,.706539988517761],[.596370995044708,.693953037261963],[.539958000183105,.557139039039612],[.568841993808746,.692366003990173],[.547818005084991,.692366003990173],[.52461302280426,.692366003990173],[.534089982509613,.779141008853912],[.527670979499817,.736225962638855],[.526912987232208,.717857003211975],[.526877999305725,.704625964164734],[.526966989040375,.695277988910675],[.572058022022247,.695277988910675],[.573521018028259,.703539967536926],[.57683801651001,.711845993995667],[.581691026687622,.720062971115112],[.609944999217987,.639909982681274],[.986046016216278,.560034036636353],[.5867999792099,.69539999961853],[.590372025966644,.701822996139526],[.531915009021759,.601536989212036],[.577268004417419,.585934996604919],[.536915004253387,.593786001205444],[.627542972564697,.473352015018463],[.665585994720459,.495950996875763],[.588353991508484,.546862006187439],[.757824003696442,.14767599105835],[.709249973297119,.201507985591888],[.672684013843536,.256581008434296],[.600408971309662,.74900496006012],[.55826598405838,.261672019958496],[.570303976535797,.187870979309082],[.588165998458862,.109044015407562],[.711045026779175,.398952007293701],[.781069993972778,.435405015945435],[.587247014045715,.398931980133057],[.742869973182678,.355445981025696],[.572156012058258,.437651991844177],[.55186802148819,.536570012569427],[.821442008018494,.457556009292603],[.752701997756958,.457181990146637],[.71375697851181,.467626988887787],[.66711300611496,.460672974586487],[.631101012229919,.447153985500336],[.6008620262146,.432473003864288],[.523481011390686,.405627012252808],[.810747981071472,.523926019668579],[.771045982837677,.348959028720856],[.509127020835876,.562718033790588],[.595292985439301,.485023975372314],[.980530977249146,.401564002037048],[.573499977588654,.420000016689301],[.602994978427887,.548687994480133],[.733529984951019,.376977026462555],[.560611009597778,.519016981124878],[.967685997486115,.644356966018677],[.580985009670258,.387160003185272],[.537728011608124,.505385041236877],[.760966002941132,.779752969741821],[.801778972148895,.831938028335571],[.892440974712372,.54076099395752],[.816350996494293,.740260004997253],[.865594983100891,.333687007427216],[.614073991775513,.883246004581451],[.508952975273132,.579437971115112],[.617941975593567,.508316040039062],[.825608015060425,.397674977779388],[.681214988231659,.39623498916626],[.656635999679565,.400596976280212],[.603900015354156,.710216999053955],[.81208598613739,.588539004325867],[.56801301240921,.944564998149872],[.681007981300354,.898285031318665],[.733752012252808,.869701027870178],[.633830010890961,.398822009563446],[.606792986392975,.39553701877594],[.589659988880157,.391062021255493],[.805015981197357,.342108011245728],[.611334979534149,.362284004688263],[.634037971496582,.355970978736877],[.656635999679565,.355356991291046],[.681214988231659,.35834002494812],[.698584973812103,.363156020641327],[.941866993904114,.319076001644135],[.698584973812103,.387449026107788],[.584177017211914,.624107003211975],[.554318010807037,.566076993942261],[.534153997898102,.62064003944397],[.711217999458313,.819975018501282],[.664629995822906,.852871000766754],[.559099972248077,.902631998062134],[.871706008911133,.791940987110138],[.591234028339386,.373893976211548],[.544341027736664,.451583981513977],[.624562978744507,.924192011356354],[.88577002286911,.615028977394104],[.551338016986847,.695277988910675],[.551980018615723,.704632043838501],[.552887976169586,.715808033943176],[.555167973041534,.730794012546539],[.569944024085999,.767035007476807],[.593203008174896,.685675978660583],[.599261999130249,.681069016456604],[.607599973678589,.677703022956848],[.631937980651855,.663500010967255],[.752032995223999,.601315021514893],[.547226011753082,.420395016670227],[.563543975353241,.359827995300293],[.583841025829315,.368713974952698],[.586614012718201,.692366003990173],[.771915018558502,.683578014373779],[.531597018241882,.352482974529266],[.588370978832245,.804440975189209],[.52079701423645,.442565023899078],[.567984998226166,.493479013442993],[.543282985687256,.819254994392395],[.655317008495331,.745514988899231],[.621008992195129,.574018001556396],[.625559985637665,.78031200170517],[.680198013782501,.570719003677368],[.64276397228241,.604337990283966],[.704662978649139,.621529996395111],[.552012026309967,.862591981887817],[.589071989059448,.508637011051178],[.685944974422455,.775357007980347],[.645735025405884,.812640011310577],[.675342977046967,.703978002071381],[.810858011245728,.646304965019226],[.72012197971344,.714666962623596],[.866151988506317,.682704985141754],[.663187026977539,.644596993923187],[.570082008838654,.466325998306274],[.544561982154846,.548375964164734],[.562758982181549,.558784961700439],[.531987011432648,.530140042304993],[.585271000862122,.335177004337311],[.622952997684479,.32277899980545],[.655896008014679,.320163011550903],[.687132000923157,.322345972061157],[.716481983661652,.333200991153717],[.758756995201111,.382786989212036],[.897013008594513,.468769013881683],[.732392013072968,.424547016620636],[.70211398601532,.433162987232208],[.66652500629425,.433866024017334],[.633504986763,.426087975502014],[.603875994682312,.416586995124817],[.579657971858978,.409945011138916],[.992439985275269,.480777025222778],[.567192018032074,.569419980049133],[.54136598110199,.478899002075195],[.526564002037048,.546118021011353],[.523913025856018,.563830018043518],[.531529009342194,.555056989192963],[.566035985946655,.582329034805298],[.51631098985672,.563053965568542],[.5174720287323,.577877044677734],[.573594987392426,.389806985855103],[.560697972774506,.395331978797913],[.549755990505219,.399751007556915],[.710287988185883,.368252992630005],[.723330020904541,.363372981548309]],Kc="https://tfhub.dev/mediapipe/tfjs-model/facemesh/1/default/1",Yc=192,$c=192;function Jc(){return Zc.apply(this,arguments)}function Zc(){return Zc=d(m().mark((function e(){var t,n,r,i,a,o,s,u,c,l,h,p,v,g,y,b=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=b.length>0&&void 0!==b[0]?b[0]:{},n=t.maxContinuousChecks,r=void 0===n?5:n,i=t.detectionConfidence,a=void 0===i?.9:i,o=t.maxFaces,s=void 0===o?10:o,u=t.iouThreshold,c=void 0===u?.3:u,l=t.scoreThreshold,h=void 0===l?.75:l,e.next=3,Promise.all([function(){var e=d(m().mark((function e(t,n,r){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",d(m().mark((function e(){var t,n,r,i,a,o,s,u,c,l,f,d,h=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=h.length>0&&void 0!==h[0]?h[0]:{},n=t.maxFaces,r=void 0===n?10:n,i=t.inputWidth,a=void 0===i?128:i,o=t.inputHeight,s=void 0===o?128:o,u=t.iouThreshold,c=void 0===u?.3:u,l=t.scoreThreshold,f=void 0===l?.75:l,e.next=3,Object(P.loadGraphModel)(Bc,{fromTFHub:!0});case 3:return d=e.sent,e.abrupt("return",new Pc(d,a,s,r,c,f));case 5:case"end":return e.stop()}}),e)})))({maxFaces:t,iouThreshold:n,scoreThreshold:r}));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()(s,c,h),d(m().mark((function e(){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(P.loadGraphModel)(Kc,{fromTFHub:!0}));case 1:case"end":return e.stop()}}),e)})))()]);case 3:return p=e.sent,v=f(p,2),g=v[0],y=v[1],e.abrupt("return",new el(g,y,r,a,s));case 8:case"end":return e.stop()}}),e)}))),Zc.apply(this,arguments)}function Qc(e,t){if(e.mesh instanceof B.Tensor){var n=Object(B.tidy)((function(){var n=Object(B.tensor1d)([t-1,0,0]),r=Object(B.tensor1d)([1,-1,1]);return Object(B.tidy)((function(){return[Object(B.concat)([Object(B.sub)(t-1,e.boundingBox.topLeft.slice(0,1)),e.boundingBox.topLeft.slice(1,1)]),Object(B.concat)([Object(B.sub)(t-1,e.boundingBox.bottomRight.slice(0,1)),e.boundingBox.bottomRight.slice(1,1)]),Object(B.sub)(n,e.mesh).mul(r),Object(B.sub)(n,e.scaledMesh).mul(r)]}))})),r=f(n,4),i=r[0],a=r[1],o=r[2],s=r[3];return Object.assign({},e,{boundingBox:{topLeft:i,bottomRight:a},mesh:o,scaledMesh:s})}return Object.assign({},e,{boundingBox:{topLeft:[t-1-e.boundingBox.topLeft[0],e.boundingBox.topLeft[1]],bottomRight:[t-1-e.boundingBox.bottomRight[0],e.boundingBox.bottomRight[1]]},mesh:e.mesh.map((function(e){var n=e.slice(0);return n[0]=t-1-e[0],n})),scaledMesh:e.scaledMesh.map((function(e){var n=e.slice(0);return n[0]=t-1-e[0],n}))})}var el=function(){function e(t,n,r,i,a){v(this,e),this.pipeline=new Hc(t,n,Yc,$c,r,a),this.detectionConfidence=i}return g(e,[{key:"estimateFaces",value:function(){var e=d(m().mark((function e(t){var n,r,i,a,o,s,u,c,l=this,h=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=h.length>1&&void 0!==h[1]&&h[1],r=h.length>2&&void 0!==h[2]&&h[2],i=function(e){return e instanceof B.Tensor?[e.shape[0],e.shape[1]]:[e.height,e.width]}(t),a=f(i,2),o=a[1],s=Object(B.tidy)((function(){return t instanceof B.Tensor||(t=B.browser.fromPixels(t)),t.toFloat().expandDims(0)})),u=Object(B.env)().get("WEBGL_PACK_DEPTHWISECONV"),Object(B.env)().set("WEBGL_PACK_DEPTHWISECONV",!0),e.next=6,this.pipeline.predict(s);case 6:return c=e.sent,e.abrupt("return",(Object(B.env)().set("WEBGL_PACK_DEPTHWISECONV",u),s.dispose(),null!=c&&c.length>0?Promise.all(c.map(function(){var e=d(m().mark((function e(t,i){var a,s,u,c,h,p,v,g,y,b,x,w,_,k,E,S,C;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.coords,s=t.scaledCoords,u=t.box,c=t.flag,h=[c],n||(h=h.concat([a,s,u.startPoint,u.endPoint])),e.next=5,Promise.all(h.map(function(){var e=d(m().mark((function e(t){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.array());case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 5:if(p=e.sent,v=p[0],c.dispose(),v<l.detectionConfidence&&l.pipeline.clearRegionOfInterest(i),!n){e.next=10;break}return g={faceInViewConfidence:v,mesh:a,scaledMesh:s,boundingBox:{topLeft:u.startPoint.squeeze(),bottomRight:u.endPoint.squeeze()}},e.abrupt("return",r?Qc(g,o):g);case 10:for(C in y=p.slice(1),b=f(y,4),x=b[0],w=b[1],_=b[2],k=b[3],s.dispose(),a.dispose(),E={faceInViewConfidence:v,boundingBox:{topLeft:_,bottomRight:k},mesh:x,scaledMesh:w},r&&(E=Qc(E,o)),S={},Lc)S[C]=Lc[C].map((function(e){return E.scaledMesh[e]}));return e.abrupt("return",(E.annotations=S,E));case 17:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())):[]));case 8:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}],[{key:"getAnnotations",value:function(){return Lc}},{key:"getUVCoords",value:function(){return Xc}}]),e}();function tl(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=At()(e);if(t){var i=At()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return St()(this,n)}}var nl=function(e){kt()(n,e);var t=tl(n);function n(e,r,i){var a;return S()(this,n),(a=t.call(this)).video=e,a.model=null,a.modelReady=!1,a.config=r,a.ready=T(a.loadModel(),i),a}return A()(n,[{key:"loadModel",value:function(){var e=k()(D.a.mark((function e(){var t=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Jc(this.config);case 2:if(this.model=e.sent,this.modelReady=!0,!this.video||0!==this.video.readyState){e.next=7;break}return e.next=7,new Promise((function(e){t.video.onloadeddata=function(){e()}}));case 7:return this.video&&this.predict(),e.abrupt("return",this);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"predict",value:function(){var e=k()(D.a.mark((function e(t,n){var r,i,a,o,s=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.getInput(t)){e.next=3;break}throw new Error("No input image found.");case 3:return i=this.config.flipHorizontal,e.next=6,this.model.estimateFaces(r,i);case 6:if(a=e.sent,o=a,this.emit("predict",o),this.emit("face",o),!this.video){e.next=12;break}return e.abrupt("return",x.nextFrame().then((function(){return s.predict()})));case 12:return"function"==typeof n&&n(o),e.abrupt("return",o);case 14:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getInput",value:function(e){return e instanceof HTMLImageElement||e instanceof HTMLVideoElement||e instanceof HTMLCanvasElement||e instanceof ImageData?e:"object"===I()(e)&&(e.elt instanceof HTMLImageElement||e.elt instanceof HTMLVideoElement||e.elt instanceof ImageData)?e.elt:"object"===I()(e)&&e.canvas instanceof HTMLCanvasElement?e.canvas:this.video}}]),n}($t.EventEmitter),rl=function(e,t,n){var r,i={},a=n;e instanceof HTMLVideoElement?r=e:"object"===I()(e)&&e.elt instanceof HTMLVideoElement?r=e.elt:"object"===I()(e)?i=e:"function"==typeof e&&(a=e),"object"===I()(t)?i=t:"function"==typeof t&&(a=t);var o=new nl(r,i,a);return a?o:o.ready};function il(e){return[Math.abs(e.endPoint[0]-e.startPoint[0]),Math.abs(e.endPoint[1]-e.startPoint[1])]}function al(e){return[e.startPoint[0]+(e.endPoint[0]-e.startPoint[0])/2,e.startPoint[1]+(e.endPoint[1]-e.startPoint[1])/2]}function ol(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1.5,n=al(e),r=il(e),i=[t*r[0]/2,t*r[1]/2];return{startPoint:[n[0]-i[0],n[1]-i[1]],endPoint:[n[0]+i[0],n[1]+i[1]],palmLandmarks:e.palmLandmarks}}function sl(e){var t=al(e),n=il(e),r=Math.max.apply(Math,h(n))/2;return{startPoint:[t[0]-r,t[1]-r],endPoint:[t[0]+r,t[1]+r],palmLandmarks:e.palmLandmarks}}function ul(e,t){var n=[e.endPoint[0]-e.startPoint[0],e.endPoint[1]-e.startPoint[1]],r=[n[0]*t[0],n[1]*t[1]];return{startPoint:[e.startPoint[0]+r[0],e.startPoint[1]+r[1]],endPoint:[e.endPoint[0]+r[0],e.endPoint[1]+r[1]],palmLandmarks:e.palmLandmarks}}var cl=function(){function e(t,n,r,i,a,o){v(this,e),this.model=t,this.width=n,this.height=r,this.iouThreshold=a,this.scoreThreshold=o,this.anchors=i.map((function(e){return[e.x_center,e.y_center]})),this.anchorsTensor=Object(B.tensor2d)(this.anchors),this.inputSizeTensor=Object(B.tensor1d)([n,r]),this.doubleInputSizeTensor=Object(B.tensor1d)([2*n,2*r])}return g(e,[{key:"normalizeBoxes",value:function(e){var t=this;return Object(B.tidy)((function(){var n=Object(B.slice)(e,[0,0],[-1,2]),r=Object(B.slice)(e,[0,2],[-1,2]),i=Object(B.add)(Object(B.div)(n,t.inputSizeTensor),t.anchorsTensor),a=Object(B.div)(r,t.doubleInputSizeTensor),o=Object(B.mul)(Object(B.sub)(i,a),t.inputSizeTensor),s=Object(B.mul)(Object(B.add)(i,a),t.inputSizeTensor);return Object(B.concat2d)([o,s],1)}))}},{key:"normalizeLandmarks",value:function(e,t){var n=this;return Object(B.tidy)((function(){var r=Object(B.add)(Object(B.div)(e.reshape([-1,7,2]),n.inputSizeTensor),n.anchors[t]);return Object(B.mul)(r,n.inputSizeTensor)}))}},{key:"getBoundingBoxes",value:function(e){var t=this;return Object(B.tidy)((function(){var n=Object(B.mul)(Object(B.sub)(e,.5),2),r=Object(B.env)().get("WEBGL_PACK_DEPTHWISECONV");Object(B.env)().set("WEBGL_PACK_DEPTHWISECONV",!0);var i=t.model.predict(n).squeeze();Object(B.env)().set("WEBGL_PACK_DEPTHWISECONV",r);var a=Object(B.sigmoid)(Object(B.slice)(i,[0,0],[-1,1])).squeeze(),o=Object(B.slice)(i,[0,1],[-1,4]),s=t.normalizeBoxes(o),u=console.warn;console.warn=function(){};var c=B.image.nonMaxSuppression(s,a,1,t.iouThreshold,t.scoreThreshold).arraySync();if(console.warn=u,0===c.length)return null;var l=c[0],f=Object(B.slice)(s,[l,0],[1,-1]),d=Object(B.slice)(i,[l,5],[1,14]);return{boxes:f,palmLandmarks:t.normalizeLandmarks(d,l).reshape([-1,2])}}))}},{key:"estimateHandBounds",value:function(e){var t=this,n=e.shape[1],r=e.shape[2],i=Object(B.tidy)((function(){return e.resizeBilinear([t.width,t.height]).div(255)})),a=this.getBoundingBoxes(i);if(null===a)return i.dispose(),null;var o=a.boxes.arraySync(),s=o[0].slice(0,2),u=o[0].slice(2,4),c=a.palmLandmarks.arraySync();return i.dispose(),a.boxes.dispose(),a.palmLandmarks.dispose(),function(e,t){return{startPoint:[e.startPoint[0]*t[0],e.startPoint[1]*t[1]],endPoint:[e.endPoint[0]*t[0],e.endPoint[1]*t[1]],palmLandmarks:e.palmLandmarks.map((function(e){return[e[0]*t[0],e[1]*t[1]]}))}}({startPoint:s,endPoint:u,palmLandmarks:c},[r/this.width,n/this.height])}}]),e}(),ll={thumb:[1,2,3,4],indexFinger:[5,6,7,8],middleFinger:[9,10,11,12],ringFinger:[13,14,15,16],pinky:[17,18,19,20],palmBase:[0]};function fl(e,t){return function(e){return e-2*Math.PI*Math.floor((e+Math.PI)/(2*Math.PI))}(Math.PI/2-Math.atan2(-(t[1]-e[1]),t[0]-e[0]))}var dl=function(e,t){return[[1,0,e],[0,1,t],[0,0,1]]};function hl(e,t){for(var n=0,r=0;r<e.length;r++)n+=e[r]*t[r];return n}function pl(e,t){for(var n=[],r=0;r<e.length;r++)n.push(e[r][t]);return n}function ml(e,t){for(var n=[],r=e.length,i=0;i<r;i++){n.push([]);for(var a=0;a<r;a++)n[i].push(hl(e[i],pl(t,a)))}return n}function vl(e,t){var n=Math.cos(e),r=Math.sin(e),i=[[n,-r,0],[r,n,0],[0,0,1]];return ml(ml(dl(t[0],t[1]),i),dl(-t[0],-t[1]))}function gl(e,t){return[hl(e,t[0]),hl(e,t[1])]}var yl=.8,bl=[0,-.4],xl=3,wl=[0,-.1],_l=1.65,kl=[0,5,9,13,17,1,2],El=0,Sl=2,Cl=function(){function e(t,n,r,i,a,o){v(this,e),this.regionsOfInterest=[],this.runsWithoutHandDetector=0,this.boundingBoxDetector=t,this.meshDetector=n,this.maxContinuousChecks=a,this.detectionConfidence=o,this.meshWidth=r,this.meshHeight=i,this.maxHandsNumber=1}return g(e,[{key:"getBoxForPalmLandmarks",value:function(e,t){var n=e.map((function(e){return gl([].concat(h(e),[1]),t)}));return ol(sl(ul(this.calculateLandmarksBoundingBox(n),bl)),xl)}},{key:"getBoxForHandLandmarks",value:function(e){for(var t=ol(sl(ul(this.calculateLandmarksBoundingBox(e),wl)),_l),n=[],r=0;r<kl.length;r++)n.push(e[kl[r]].slice(0,2));return t.palmLandmarks=n,t}},{key:"transformRawCoords",value:function(e,t,n,r){var i=this,a=il(t),o=[a[0]/this.meshWidth,a[1]/this.meshHeight],s=e.map((function(e){return[o[0]*(e[0]-i.meshWidth/2),o[1]*(e[1]-i.meshHeight/2),e[2]]})),u=vl(n,[0,0]),c=s.map((function(e){return[].concat(h(gl(e,u)),[e[2]])})),l=function(e){var t=[[e[0][0],e[1][0]],[e[0][1],e[1][1]]],n=[e[0][2],e[1][2]],r=[-hl(t[0],n),-hl(t[1],n)];return[t[0].concat(r[0]),t[1].concat(r[1]),[0,0,1]]}(r),f=[].concat(h(al(t)),[1]),d=[hl(f,l[0]),hl(f,l[1])];return c.map((function(e){return[e[0]+d[0],e[1]+d[1],e[2]]}))}},{key:"estimateHand",value:function(){var e=d(m().mark((function e(t){var n,r,i,a,o,s,u,c,l,d,h,p,v,g,y,b,x,w,_,k,E,S;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!0!==(n=this.shouldUpdateRegionsOfInterest())){e.next=8;break}if(null!==(r=this.boundingBoxDetector.estimateHandBounds(t))){e.next=5;break}return e.abrupt("return",(t.dispose(),this.regionsOfInterest=[],null));case 5:this.updateRegionsOfInterest(r,!0),this.runsWithoutHandDetector=0,e.next=9;break;case 8:this.runsWithoutHandDetector++;case 9:if(i=this.regionsOfInterest[0],a=fl(i.palmLandmarks[El],i.palmLandmarks[Sl]),o=al(i),s=[o[0]/t.shape[2],o[1]/t.shape[1]],"webgl"!==(c=Object(B.getBackend)())){e.next=15;break}u=function(e,t,n,r){var i=e.shape,a=i[1],o=i[2],s=Math.sin(t),u=Math.cos(t),c=Math.floor(o*("number"==typeof r?r:r[0])),l=Math.floor(a*("number"==typeof r?r:r[1])),f={variableNames:["Image"],outputShape:i,userCode:"\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int x = coords[2];\n        int y = coords[1];\n        int coordX = int(float(x - ".concat(c,") * ").concat(u," -\n          float(y - ").concat(l,") * ").concat(s,");\n        int coordY = int(float(x - ").concat(c,") * ").concat(s," +\n          float(y - ").concat(l,") * ").concat(u,");\n        coordX = int(coordX + ").concat(c,");\n        coordY = int(coordY + ").concat(l,");\n\n        ").concat("number"==typeof n?"float outputValue = ".concat(n.toFixed(2),";"):"\n      vec3 fill = vec3(".concat(n.join(","),");\n      float outputValue = fill[coords[3]];"),"\n\n        if(coordX > 0 && coordX < ").concat(o," && coordY > 0 && coordY < ").concat(a,") {\n          outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n        }\n\n      setOutput(outputValue);\n    }")};return Object(B.backend)().compileAndRun(f,[e])}(t,a,0,s),e.next=18;break;case 15:if("cpu"===c){e.next=17;break}throw new Error("Handpose is not yet supported by the ".concat(c," ")+"backend - rotation kernel is not defined.");case 17:u=function(e,t,n,r){for(var i=Object(B.backend)(),a=Object(B.buffer)(e.shape,e.dtype),o=f(e.shape,4),s=o[0],u=o[1],c=o[2],l=o[3],d=c*("number"==typeof r?r:r[0]),h=u*("number"==typeof r?r:r[1]),p=Math.sin(-t),m=Math.cos(-t),v=i.readSync(e.dataId),g=0;g<s;g++)for(var y=0;y<u;y++)for(var b=0;b<c;b++)for(var x=0;x<l;x++){var w=[s,y,b,x],_=w[2],k=w[1],E=(_-d)*m-(k-h)*p,S=(_-d)*p+(k-h)*m;E=Math.round(E+d),S=Math.round(S+h);var C=n;"number"!=typeof n&&(C=3===x?255:n[x]),E>=0&&E<c&&S>=0&&S<u&&(C=v[g*c*u*l+S*(c*l)+E*l+x]);var A=g*c*u*l+y*(c*l)+b*l+x;a.values[A]=C}return a.toTensor()}(t,a,0,s);case 18:if(l=vl(-a,o),h=function(e,t,n){var r=t.shape[1],i=t.shape[2],a=[[e.startPoint[1]/r,e.startPoint[0]/i,e.endPoint[1]/r,e.endPoint[0]/i]];return B.image.cropAndResize(t,a,[0],n)}(d=!0===n?this.getBoxForPalmLandmarks(i.palmLandmarks,l):i,u,[this.meshWidth,this.meshHeight]),p=h.div(255),h.dispose(),u.dispose(),v=Object(B.env)().get("WEBGL_PACK_DEPTHWISECONV"),Object(B.env)().set("WEBGL_PACK_DEPTHWISECONV",!0),g=this.meshDetector.predict(p),y=f(g,2),b=y[0],x=y[1],Object(B.env)().set("WEBGL_PACK_DEPTHWISECONV",v),p.dispose(),w=b.dataSync()[0],b.dispose(),!(w<this.detectionConfidence)){e.next=28;break}return e.abrupt("return",(x.dispose(),this.regionsOfInterest=[],null));case 28:return _=Object(B.reshape)(x,[-1,3]),k=_.arraySync(),x.dispose(),_.dispose(),E=this.transformRawCoords(k,d,a,l),S=this.getBoxForHandLandmarks(E),e.abrupt("return",(this.updateRegionsOfInterest(S,!1),{landmarks:E,handInViewConfidence:w,boundingBox:{topLeft:S.startPoint,bottomRight:S.endPoint}}));case 32:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"calculateLandmarksBoundingBox",value:function(e){var t=e.map((function(e){return e[0]})),n=e.map((function(e){return e[1]}));return{startPoint:[Math.min.apply(Math,h(t)),Math.min.apply(Math,h(n))],endPoint:[Math.max.apply(Math,h(t)),Math.max.apply(Math,h(n))]}}},{key:"updateRegionsOfInterest",value:function(e,t){if(t)this.regionsOfInterest=[e];else{var n=this.regionsOfInterest[0],r=0;if(null!=n&&null!=n.startPoint){var i=f(e.startPoint,2),a=i[0],o=i[1],s=f(e.endPoint,2),u=s[0],c=s[1],l=f(n.startPoint,2),d=l[0],h=l[1],p=f(n.endPoint,2),m=p[0],v=p[1],g=Math.max(a,d),y=Math.max(o,h),b=(Math.min(u,m)-g)*(Math.min(c,v)-y);r=b/((u-a)*(c-o)+(m-d)*(v-o)-b)}this.regionsOfInterest[0]=r>yl?n:e}}},{key:"shouldUpdateRegionsOfInterest",value:function(){return this.regionsOfInterest.length!==this.maxHandsNumber||this.runsWithoutHandDetector>=this.maxContinuousChecks}}]),e}(),Al=256,Ol=256;function Dl(){return Tl.apply(this,arguments)}function Tl(){return Tl=d(m().mark((function e(){var t,n,r,i,a,o,s,u,c,l,h,p,v,g,y,b,x=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=x.length>0&&void 0!==x[0]?x[0]:{},n=t.maxContinuousChecks,r=void 0===n?1/0:n,i=t.detectionConfidence,a=void 0===i?.8:i,o=t.iouThreshold,s=void 0===o?.3:o,u=t.scoreThreshold,c=void 0===u?.5:u,e.next=3,Promise.all([d(m().mark((function e(){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",B.util.fetch("https://tfhub.dev/mediapipe/tfjs-model/handskeleton/1/default/1/anchors.json?tfjs-format=file").then((function(e){return e.json()})));case 1:case"end":return e.stop()}}),e)})))(),d(m().mark((function e(){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(P.loadGraphModel)("https://tfhub.dev/mediapipe/tfjs-model/handdetector/1/default/1",{fromTFHub:!0}));case 1:case"end":return e.stop()}}),e)})))(),d(m().mark((function e(){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(P.loadGraphModel)("https://tfhub.dev/mediapipe/tfjs-model/handskeleton/1/default/1",{fromTFHub:!0}));case 1:case"end":return e.stop()}}),e)})))()]);case 3:return l=e.sent,h=f(l,3),p=h[0],v=h[1],g=h[2],y=new cl(v,Al,Ol,p,s,c),b=new Cl(y,g,Al,Ol,r,a),e.abrupt("return",new jl(b));case 11:case"end":return e.stop()}}),e)}))),Tl.apply(this,arguments)}var jl=function(){function e(t){v(this,e),this.pipeline=t}return g(e,[{key:"estimateHands",value:function(){var e=d(m().mark((function e(t){var n,r,i,a,o,s,u,c,l,d,h,p=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=p.length>1&&void 0!==p[1]&&p[1],r=function(e){return e instanceof B.Tensor?[e.shape[0],e.shape[1]]:[e.height,e.width]}(t),i=f(r,2),a=i[1],o=Object(B.tidy)((function(){return t instanceof B.Tensor||(t=B.browser.fromPixels(t)),t.toFloat().expandDims(0)})),e.next=7,this.pipeline.estimateHand(o);case 7:if(s=e.sent,o.dispose(),null!==s){e.next=10;break}return e.abrupt("return",[]);case 10:for(u=s,!0===n&&(u=function(e,t){var n=e.handInViewConfidence,r=e.landmarks,i=e.boundingBox;return{handInViewConfidence:n,landmarks:r.map((function(e){return[t-1-e[0],e[1],e[2]]})),boundingBox:{topLeft:[t-1-i.topLeft[0],i.topLeft[1]],bottomRight:[t-1-i.bottomRight[0],i.bottomRight[1]]}}}(s,a)),c={},l=0,d=Object.keys(ll);l<d.length;l++)h=d[l],c[h]=ll[h].map((function(e){return u.landmarks[e]}));return e.abrupt("return",[{handInViewConfidence:u.handInViewConfidence,boundingBox:u.boundingBox,landmarks:u.landmarks,annotations:c}]);case 15:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}],[{key:"getAnnotations",value:function(){return ll}}]),e}();function Ml(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=At()(e);if(t){var i=At()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return St()(this,n)}}var Fl=function(e){kt()(n,e);var t=Ml(n);function n(e,r,i){var a;return S()(this,n),(a=t.call(this)).video=e,a.model=null,a.modelReady=!1,a.config=r,a.ready=T(a.loadModel(),i),a}return A()(n,[{key:"loadModel",value:function(){var e=k()(D.a.mark((function e(){var t=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Dl(this.config);case 2:if(this.model=e.sent,this.modelReady=!0,!this.video||0!==this.video.readyState){e.next=7;break}return e.next=7,new Promise((function(e){t.video.onloadeddata=function(){e()}}));case 7:return this.video&&this.predict(),e.abrupt("return",this);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"predict",value:function(){var e=k()(D.a.mark((function e(t,n){var r,i,a,o,s=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.getInput(t)){e.next=3;break}throw new Error("No input image found.");case 3:return i=this.config.flipHorizontal,e.next=6,this.model.estimateHands(r,i);case 6:if(a=e.sent,o=a,this.emit("predict",o),this.emit("hand",o),!this.video){e.next=12;break}return e.abrupt("return",x.nextFrame().then((function(){return s.predict()})));case 12:return"function"==typeof n&&n(o),e.abrupt("return",o);case 14:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getInput",value:function(e){return e instanceof HTMLImageElement||e instanceof HTMLVideoElement||e instanceof HTMLCanvasElement||e instanceof ImageData?e:"object"===I()(e)&&(e.elt instanceof HTMLImageElement||e.elt instanceof HTMLVideoElement||e.elt instanceof ImageData)?e.elt:"object"===I()(e)&&e.canvas instanceof HTMLCanvasElement?e.canvas:this.video}}]),n}($t.EventEmitter),Il=function(e,t,n){var r,i={},a=n;e instanceof HTMLVideoElement?r=e:"object"===I()(e)&&e.elt instanceof HTMLVideoElement?r=e.elt:"object"===I()(e)?i=e:"function"==typeof e&&(a=e),"object"===I()(t)?i=t:"function"==typeof t&&(a=t);var o=new Fl(r,i,a);return a?o:o.ready},Nl=function(){console.log("\n\ud83c\udf08\ud83c\udf08\ud83c\udf08\ud83c\udf08\ud83c\udf08\ud83c\udf08\ud83c\udf08\ud83c\udf08\ud83c\udf08\ud83c\udf08\ud83c\udf08\ud83c\udf08\ud83c\udf08\ud83c\udf08\ud83c\udf08\ud83c\udf08\ud83c\udf08\ud83c\udf08\ud83c\udf08\ud83c\udf08\ud83c\udf08\ud83c\udf08\n\ud83c\udf1f Thank you for using ml5.js v".concat(Fr.a," \ud83c\udf1f\n\nPlease read our community statement to ensure \nthat the use of this software reflects the values \nof the ml5.js community:\n\u21b3 https://ml5js.org/about\n\nReporting: \n\u21b3 https://github.com/ml5js/ml5-library/issues\n\u21b3 Email: info@ml5js.org \n\ud83c\udf08\ud83c\udf08\ud83c\udf08\ud83c\udf08\ud83c\udf08\ud83c\udf08\ud83c\udf08\ud83c\udf08\ud83c\udf08\ud83c\udf08\ud83c\udf08\ud83c\udf08\ud83c\udf08\ud83c\udf08\ud83c\udf08\ud83c\udf08\ud83c\udf08\ud83c\udf08\ud83c\udf08\ud83c\udf08\ud83c\udf08\ud83c\udf08"))},Rl=function(){var e=k()(D.a.mark((function e(){var t;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new Image).crossOrigin="",t.src="https://cdn.jsdelivr.net/gh/ml5js/ml5-library@main/assets/bird.jpg",e.next=5,new Promise((function(e){t.onload=e}));case 5:return e.abrupt("return",t);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Pl=function(){var e=k()(D.a.mark((function e(){var t,n,r;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=new Uint8ClampedArray(2e4),n=0;n<t.length;n+=4)t[n+0]=0,t[n+1]=190,t[n+2]=0,t[n+3]=255;return r=new ImageData(t,200),e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();function Bl(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ll(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Bl(Object(n),!0).forEach((function(t){b()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Bl(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var zl={charRNN:mr,CVAE:Or,cartoon:hc,DCGAN:Tr,featureExtractor:xt,imageClassifier:xe,kmeans:rc,dbscan:lc,soundClassifier:it,pitchDetection:M,pix2pix:yr,poseNet:rr,sketchRNN:kr,styleTransfer:cr,word2vec:wt,YOLO:Wt,CocoSsd:Ht,objectDetector:Yt,uNet:Cr,sentiment:Rr,bodyPix:oi,faceApi:$u,universalSentenceEncoder:Dc,facemesh:rl,handpose:Il};Nl(),t.default=Object.assign({p5Utils:ce},function(e){if("undefined"==typeof window)return e;if(void 0===window.p5)return e;if(void 0===window.p5.prototype)return e;if(void 0===window.p5.prototype.registerPreloadMethod)return e;var t=e;return Object.keys(e).forEach((function(n){var r=e[n];t[n]=function(){for(var t=null,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];var o=i.length;return"function"==typeof i[o-1]&&(t=i[o-1],o-=1),r.apply(e,[].concat(Mr()(i.slice(0,o)),[function(){try{t&&t()}catch(e){console.error(e)}return window._decrementPreload?window._decrementPreload():null}]))},window.p5.prototype.registerPreloadMethod("".concat(n),e)})),e}(zl),Ll(Ll({KNNClassifier:ft,communityStatement:Nl},o),{},{tf:x,tfvis:w,version:Fr.a,neuralNetwork:ki,testingUtils:p}))},function(e,t){},function(e,t){},function(e,t){},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){var r=n(186);e.exports=function(e){if(Array.isArray(e))return r(e)},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){"use strict";function r(e){return new Uint8Array(atob(e).split("").map((function(e){return e.charCodeAt(0)})))}Object.defineProperty(t,"__esModule",{value:!0}),t.stringToUint8array=r,t.stringToArray=function(e){var t=r(e);return new Int16Array(t.buffer)};var i=!1,a=0;function o(){if(i)return i=!1,a;var e=2*Math.random()-1,t=2*Math.random()-1,n=e*e+t*t;if(0===n||n>1)return o();var r=Math.sqrt(-2*Math.log(n)/n);return a=t*r,i=!0,e*r}function s(e,t){return Math.random()*(t-e)+e}function u(e,t){return e+o()*t}function c(e,t){void 0===t&&(t=2);var n=t;function r(e,t){return[e[0]-t[0],e[1]-t[1]]}function i(e,t){return e[0]*t[0]+e[1]*t[1]}function a(e){return e[0]*e[0]+e[1]*e[1]}function o(e,t){return a(r(e,t))}var s,u,c,l,f=e.length,d=[],h=n*n,p=[],m=[];for(p[0]=e[0],s=u=1,l=0;s<f;s++)o(e[s],e[l])<h||(p[u++]=e[s],l=s);for(l<f-1&&(p[u++]=e[f-1]),m[0]=m[u-1]=1,function e(t,n,s,u,c){if(!(u<=s+1)){for(var l,f,d,h,p=s,m=0,v=t*t,g=[n[s],n[u]],y=r(g[1],g[0]),b=a(y),x=s+1;x<u;x++)(d=i(r(n[x],g[0]),y))<=0?h=o(n[x],g[0]):b<=d?h=o(n[x],g[1]):(f=d/b,l=[g[0][0]+f*y[0],g[0][1]+f*y[1]],h=o(n[x],l)),h<=m||(p=x,m=h);m>v&&(c[p]=1,e(t,n,s,p,c),e(t,n,p,u,c))}}(n,p,0,u-1,m),s=c=0;s<u;s++)m[s]&&(d[c++]=p[s]);return d}t.gaussRandom=o,t.randf=s,t.randi=function(e,t){return Math.floor(Math.random()*(t-e)+e)},t.randn=u,t.birandn=function(e,t,n,r,i){var a=u(0,1),o=u(0,1);return[Math.sqrt(1-i*i)*n*a+i*n*o+e,r*o+t]},t.sampleSoftmax=function(e){var t,n=s(0,1),r=e.length,i=0;for(t=0;t<r;t++)if((i+=e[t])>=n)return t;return console.log("error sampling pi index"),-1},t.simplifyLine=c,t.simplifyLines=function(e,t){var n=[],r=2;t&&(r=t);for(var i=0;i<e.length;i++)n.push(c(e[i],r));return n},t.linesToStrokes=function(e){var t,n,r,i,a,o,s,u,c,l,f=0,d=0,h=[];for(s=0;s<e.length;s++)if((c=e[s].length)>1)for(u=0;u<c;u++)u===c-1?(o=1,a=0):(o=0,a=1),r=(t=(l=e[s][u])[0])-f,i=(n=l[1])-d,f=t,d=n,h.push([r,i,a,o,0]);return h.push([0,0,0,0,1]),h.slice(1)},t.lineToStroke=function(e,t){var n,r,i,a,o,s,u,c,l,f,d,h=[];if(l=t[0],f=t[1],(i=e.length)>1)for(d=0;d<i;d++)d===i-1?(r=1,n=0):(r=0,n=1),o=(u=(a=e[d])[0])-l,s=(c=a[1])-f,l=u,f=c,h.push([o,s,n,r,0]);return h}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),o=n(255),s=function(){function e(e){this.NMIXTURE=20,this.checkpointURL=e,this.initialized=!1}return e.prototype.isInitialized=function(){return this.initialized},e.prototype.instantiateFromJSON=function(e,t,n){var r;this.forgetBias=a.scalar(1),this.info=e,this.setPixelFactor(2),this.weightDims=t,this.numUnits=this.weightDims[0][0],this.weights=[];for(var i=0;i<n.length;i++){for(var s=(r=new Float32Array(o.stringToArray(n[i]))).length,u=0;u<s;u++)r[u]=10*r[u]/32767;this.weights.push(r)}this.outputKernel=a.tensor2d(this.weights[0],[this.weightDims[0][0],this.weightDims[0][1]]),this.outputBias=a.tensor1d(this.weights[1]);var c=a.tensor2d(this.weights[2],[this.weightDims[2][0],this.weightDims[2][1]]),l=a.tensor2d(this.weights[3],[this.weightDims[3][0],this.weightDims[3][1]]);this.lstmKernel=a.concat2d([c,l],0),this.lstmBias=a.tensor1d(this.weights[4]),this.rawVars=[this.outputKernel,this.outputBias,this.lstmKernel,this.lstmBias]},e.prototype.initialize=function(){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return this.dispose(),[4,fetch(this.checkpointURL).then((function(e){return e.json()}))];case 1:return e=t.sent(),this.instantiateFromJSON(e[0],e[1],e[2]),this.initialized=!0,console.log("Initialized SketchRNN."),[2]}}))}))},e.prototype.dispose=function(){if(this.rawVars){for(var e=0;e<this.rawVars.length;e++)this.rawVars[e].dispose();this.rawVars=void 0}this.forgetBias&&(this.forgetBias.dispose(),this.forgetBias=void 0),this.initialized=!1},e.prototype.setPixelFactor=function(e){this.pixelFactor=e,this.scaleFactor=this.info.scale_factor/this.pixelFactor},e.prototype.update=function(e,t){var n=this,r=a.tidy((function(){var r=n.numUnits,i=n.scaleFactor,o=[e[0]/i,e[1]/i,e[2],e[3],e[4]],s=a.tensor2d(o,[1,5]),u=a.tensor2d(t.c,[1,r]),c=a.tensor2d(t.h,[1,r]),l=a.basicLSTMCell(n.forgetBias,n.lstmKernel,n.lstmBias,s,u,c);return a.concat(l,1)})),i=r.dataSync();r.dispose();var o=i.slice(0,this.numUnits),s=i.slice(this.numUnits,2*this.numUnits);return{c:new Float32Array(o),h:new Float32Array(s)}},e.prototype.updateStrokes=function(e,t,n){var r=this,i=a.tidy((function(){var i,o,s,u,c,l=r.numUnits,f=r.scaleFactor,d=e.length;n&&(d=n),s=a.tensor2d(t.c,[1,l]),u=a.tensor2d(t.h,[1,l]);for(var h=0;h<d;h++)i=[e[h][0]/f,e[h][1]/f,e[h][2],e[h][3],e[h][4]],o=a.tensor2d(i,[1,5]),s=(c=a.basicLSTMCell(r.forgetBias,r.lstmKernel,r.lstmBias,o,s,u))[0],u=c[1];return a.concat(c,1)})),o=i.dataSync();i.dispose();var s=o.slice(0,this.numUnits),u=o.slice(this.numUnits,2*this.numUnits);return{c:new Float32Array(s),h:new Float32Array(u)}},e.prototype.getPDF=function(e,t,n){var r=this;void 0===t&&(t=.65);var i=t,o=.5+.5*i;n&&(o=n);var s=this.NMIXTURE,u=a.tidy((function(){var t=r.numUnits,n=a.tensor2d(e.h,[1,t]),u=a.scalar(Math.sqrt(i)),c=a.scalar(o),l=a.add(a.matMul(n,r.outputKernel),r.outputBias).squeeze(),f=a.split(l,[3,6*s]),d=f[0],h=f[1],p=a.split(h,6),m=p[0],v=p[1],g=p[2],y=p[3],b=p[4],x=p[5],w=a.softmax(d.div(c)),_=[a.softmax(m.div(c)),v,g,a.exp(y).mul(u),a.exp(b).mul(u),a.tanh(x),w];return a.concat(_)})),c=u.dataSync();return u.dispose(),{pi:new Float32Array(c.slice(0,s)),muX:new Float32Array(c.slice(1*s,2*s)),muY:new Float32Array(c.slice(2*s,3*s)),sigmaX:new Float32Array(c.slice(3*s,4*s)),sigmaY:new Float32Array(c.slice(4*s,15*s)),corr:new Float32Array(c.slice(5*s,6*s)),pen:new Float32Array(c.slice(6*s,6*s+3))}},e.prototype.zeroState=function(){return{c:new Float32Array(this.numUnits),h:new Float32Array(this.numUnits)}},e.prototype.copyState=function(e){return{c:new Float32Array(e.c),h:new Float32Array(e.h)}},e.prototype.zeroInput=function(){return[0,0,1,0,0]},e.prototype.sample=function(e){var t=o.sampleSoftmax(e.pi),n=e.muX[t],r=e.muY[t],i=e.sigmaX[t],a=e.sigmaY[t],s=e.corr[t],u=[0,0,0];u[o.sampleSoftmax(e.pen)]=1;var c=o.birandn(n,r,i,a,s);return[c[0]*this.scaleFactor,c[1]*this.scaleFactor,u[0],u[1],u[2]]},e.prototype.simplifyLine=function(e,t){return o.simplifyLine(e,t)},e.prototype.simplifyLines=function(e,t){return o.simplifyLines(e,t)},e.prototype.linesToStroke=function(e){return o.linesToStrokes(e)},e.prototype.lineToStroke=function(e,t){return o.lineToStroke(e,t)},e}();t.SketchRNN=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(256);t.SketchRNN=r.SketchRNN},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){function n(t,r){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},e.exports.__esModule=!0,e.exports.default=e.exports,n(t,r)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);o=!0);}catch(e){s=!0,i=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw i}}return a}},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e){if(Array.isArray(e))return e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){"use strict";e.exports=function(e){return"object"==typeof e&&!0===e.isAxiosError}},function(e,t,n){"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},function(e,t,n){"use strict";var r=n(188);function i(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var n=this;e((function(e){n.reason||(n.reason=new r(e),t(n.reason))}))}i.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},i.source=function(){var e;return{token:new i((function(t){e=t})),cancel:e}},e.exports=i},function(e){e.exports={name:"axios",version:"0.21.4",description:"Promise based HTTP client for the browser and node.js",main:"index.js",scripts:{test:"grunt test",start:"node ./sandbox/server.js",build:"NODE_ENV=production grunt build",preversion:"npm test",version:"npm run build && grunt version && git add -A dist && git add CHANGELOG.md bower.json package.json",postversion:"git push && git push --tags",examples:"node ./examples/server.js",coveralls:"cat coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js",fix:"eslint --fix lib/**/*.js"},repository:{type:"git",url:"https://github.com/axios/axios.git"},keywords:["xhr","http","ajax","promise","node"],author:"Matt Zabriskie",license:"MIT",bugs:{url:"https://github.com/axios/axios/issues"},homepage:"https://axios-http.com",devDependencies:{coveralls:"^3.0.0","es6-promise":"^4.2.4",grunt:"^1.3.0","grunt-banner":"^0.6.0","grunt-cli":"^1.2.0","grunt-contrib-clean":"^1.1.0","grunt-contrib-watch":"^1.0.0","grunt-eslint":"^23.0.0","grunt-karma":"^4.0.0","grunt-mocha-test":"^0.13.3","grunt-ts":"^6.0.0-beta.19","grunt-webpack":"^4.0.2","istanbul-instrumenter-loader":"^1.0.0","jasmine-core":"^2.4.1",karma:"^6.3.2","karma-chrome-launcher":"^3.1.0","karma-firefox-launcher":"^2.1.0","karma-jasmine":"^1.1.1","karma-jasmine-ajax":"^0.1.13","karma-safari-launcher":"^1.0.0","karma-sauce-launcher":"^4.3.6","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","load-grunt-tasks":"^3.5.2",minimist:"^1.2.0",mocha:"^8.2.1",sinon:"^4.5.0","terser-webpack-plugin":"^4.2.3",typescript:"^4.0.5","url-search-params":"^0.10.0",webpack:"^4.44.2","webpack-dev-server":"^3.11.0"},browser:{"./lib/adapters/http.js":"./lib/adapters/xhr.js"},jsdelivr:"dist/axios.min.js",unpkg:"dist/axios.min.js",typings:"./index.d.ts",dependencies:{"follow-redirects":"^1.14.0"},bundlesize:[{path:"./dist/axios.min.js",threshold:"5kB"}],_resolved:"https://registry.npmjs.org/axios/-/axios-0.21.4.tgz",_integrity:"sha512-ut5vewkiu8jjGBdqpM44XxjuCjq9LAKeHVmoVfHVzy8eHgxxq8SbAVQNovDA8mVi05kP0Ea/n/UzcSHcTJQfNg==",_from:"axios@0.21.4"}},function(e,t,n){"use strict";var r=n(266),i={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){i[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));var a={},o=r.version.split(".");function s(e,t){for(var n=t?t.split("."):o,r=e.split("."),i=0;i<3;i++){if(n[i]>r[i])return!0;if(n[i]<r[i])return!1}return!1}i.transitional=function(e,t,n){var i=t&&s(t);function o(e,t){return"[Axios v"+r.version+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return function(n,r,s){if(!1===e)throw new Error(o(r," has been removed in "+t));return i&&!a[r]&&(a[r]=!0,console.warn(o(r," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,r,s)}},e.exports={isOlderVersion:s,assertOptions:function(e,t,n){if("object"!=typeof e)throw new TypeError("options must be an object");for(var r=Object.keys(e),i=r.length;i-- >0;){var a=r[i],o=t[a];if(o){var s=e[a],u=void 0===s||o(s,a,e);if(!0!==u)throw new TypeError("option "+a+" must be "+u)}else if(!0!==n)throw Error("Unknown option "+a)}},validators:i}},function(e,t,n){"use strict";var r=n(36);e.exports=r.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function i(e){var r=e;return t&&(n.setAttribute("href",r),r=n.href),n.setAttribute("href",r),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=i(window.location.href),function(t){var n=r.isString(t)?i(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0}},function(e,t,n){"use strict";var r=n(36),i=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,n,a,o={};return e?(r.forEach(e.split("\n"),(function(e){if(a=e.indexOf(":"),t=r.trim(e.substr(0,a)).toLowerCase(),n=r.trim(e.substr(a+1)),t){if(o[t]&&i.indexOf(t)>=0)return;o[t]="set-cookie"===t?(o[t]?o[t]:[]).concat([n]):o[t]?o[t]+", "+n:n}})),o):o}},function(e,t,n){"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},function(e,t,n){"use strict";e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},function(e,t,n){"use strict";var r=n(271),i=n(270);e.exports=function(e,t){return e&&!r(t)?i(e,t):t}},function(e,t,n){"use strict";var r=n(36);e.exports=r.isStandardBrowserEnv()?{write:function(e,t,n,i,a,o){var s=[];s.push(e+"="+encodeURIComponent(t)),r.isNumber(n)&&s.push("expires="+new Date(n).toGMTString()),r.isString(i)&&s.push("path="+i),r.isString(a)&&s.push("domain="+a),!0===o&&s.push("secure"),document.cookie=s.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(e,t,n){"use strict";var r=n(191);e.exports=function(e,t,n){var i=n.config.validateStatus;n.status&&i&&!i(n.status)?t(r("Request failed with status code "+n.status,n.config,null,n.request,n)):e(n)}},function(e,t,n){"use strict";var r=n(36);e.exports=function(e,t){r.forEach(e,(function(n,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[r])}))}},function(e,t,n){"use strict";var r=n(36),i=n(136);e.exports=function(e,t,n){var a=this||i;return r.forEach(n,(function(n){e=n.call(a,e,t)})),e}},function(e,t,n){"use strict";var r=n(36),i=n(276),a=n(190),o=n(136);function s(e){e.cancelToken&&e.cancelToken.throwIfRequested()}e.exports=function(e){return s(e),e.headers=e.headers||{},e.data=i.call(e,e.data,e.headers,e.transformRequest),e.headers=r.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),r.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||o.adapter)(e).then((function(t){return s(e),t.data=i.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return a(t)||(s(e),t&&t.response&&(t.response.data=i.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))}},function(e,t,n){"use strict";var r=n(36);function i(){this.handlers=[]}i.prototype.use=function(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1},i.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},i.prototype.forEach=function(e){r.forEach(this.handlers,(function(t){null!==t&&e(t)}))},e.exports=i},function(e,t,n){"use strict";var r=n(36),i=n(194),a=n(278),o=n(277),s=n(189),u=n(267),c=u.validators;function l(e){this.defaults=e,this.interceptors={request:new a,response:new a}}l.prototype.request=function(e){"string"==typeof e?(e=arguments[1]||{}).url=arguments[0]:e=e||{},(e=s(this.defaults,e)).method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var t=e.transitional;void 0!==t&&u.assertOptions(t,{silentJSONParsing:c.transitional(c.boolean,"1.0.0"),forcedJSONParsing:c.transitional(c.boolean,"1.0.0"),clarifyTimeoutError:c.transitional(c.boolean,"1.0.0")},!1);var n=[],r=!0;this.interceptors.request.forEach((function(t){"function"==typeof t.runWhen&&!1===t.runWhen(e)||(r=r&&t.synchronous,n.unshift(t.fulfilled,t.rejected))}));var i,a=[];if(this.interceptors.response.forEach((function(e){a.push(e.fulfilled,e.rejected)})),!r){var l=[o,void 0];for(Array.prototype.unshift.apply(l,n),l=l.concat(a),i=Promise.resolve(e);l.length;)i=i.then(l.shift(),l.shift());return i}for(var f=e;n.length;){var d=n.shift(),h=n.shift();try{f=d(f)}catch(e){h(e);break}}try{i=o(f)}catch(e){return Promise.reject(e)}for(;a.length;)i=i.then(a.shift(),a.shift());return i},l.prototype.getUri=function(e){return e=s(this.defaults,e),i(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},r.forEach(["delete","get","head","options"],(function(e){l.prototype[e]=function(t,n){return this.request(s(n||{},{method:e,url:t,data:(n||{}).data}))}})),r.forEach(["post","put","patch"],(function(e){l.prototype[e]=function(t,n,r){return this.request(s(r||{},{method:e,url:t,data:n}))}})),e.exports=l},function(e,t,n){"use strict";var r=n(36),i=n(195),a=n(279),o=n(189);function s(e){var t=new a(e),n=i(a.prototype.request,t);return r.extend(n,a.prototype,t),r.extend(n,t),n}var u=s(n(136));u.Axios=a,u.create=function(e){return s(o(u.defaults,e))},u.Cancel=n(188),u.CancelToken=n(265),u.isCancel=n(190),u.all=function(e){return Promise.all(e)},u.spread=n(264),u.isAxiosError=n(263),e.exports=u,e.exports.default=u},function(e,t,n){var r=function(e){"use strict";var t,n=Object.prototype,r=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var i=t&&t.prototype instanceof v?t:v,a=Object.create(i.prototype),o=new O(r||[]);return a._invoke=function(e,t,n){var r=f;return function(i,a){if(r===h)throw new Error("Generator is already running");if(r===p){if("throw"===i)throw a;return T()}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var s=S(o,n);if(s){if(s===m)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===f)throw r=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=h;var u=l(e,t,n);if("normal"===u.type){if(r=n.done?p:d,u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r=p,n.method="throw",n.arg=u.arg)}}}(e,n,o),a}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var f="suspendedStart",d="suspendedYield",h="executing",p="completed",m={};function v(){}function g(){}function y(){}var b={};u(b,a,(function(){return this}));var x=Object.getPrototypeOf,w=x&&x(x(D([])));w&&w!==n&&r.call(w,a)&&(b=w);var _=y.prototype=v.prototype=Object.create(b);function k(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){var n;this._invoke=function(i,a){function o(){return new t((function(n,o){!function n(i,a,o,s){var u=l(e[i],e,a);if("throw"!==u.type){var c=u.arg,f=c.value;return f&&"object"==typeof f&&r.call(f,"__await")?t.resolve(f.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(f).then((function(e){c.value=e,o(c)}),(function(e){return n("throw",e,o,s)}))}s(u.arg)}(i,a,n,o)}))}return n=n?n.then(o,o):o()}}function S(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,S(e,n),"throw"===n.method))return m;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var i=l(r,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,m;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,m):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function D(e){if(e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}return{next:T}}function T(){return{value:t,done:!0}}return g.prototype=y,u(_,"constructor",y),u(y,"constructor",g),g.displayName=u(y,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,u(e,s,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},k(E.prototype),u(E.prototype,o,(function(){return this})),e.AsyncIterator=E,e.async=function(t,n,r,i,a){void 0===a&&(a=Promise);var o=new E(c(t,n,r,i),a);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},k(_),u(_,s,"Generator"),u(_,a,(function(){return this})),u(_,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=D,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(u&&c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,m):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),A(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;A(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:D(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),m}},e}(e.exports);try{regeneratorRuntime=r}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.version="1.5.1"},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(137),a=n(46),o=n(110);t.valuesDistribution=function(e,t){return r(this,void 0,void 0,m().mark((function n(){var r,s,u;return m().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=a.getDrawArea(e),n.next=3,o.tensorStats(t);case 3:return s=n.sent,n.next=6,t.data();case 6:u=n.sent,i.histogram(r,u,{height:150,stats:s});case 8:case"end":return n.stop()}}),n)})))}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(46),a=n(109);t.perClassAccuracy=function(e,t,n){return r(this,void 0,void 0,m().mark((function r(){var o,s,u,c,l;return m().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:for(o=i.getDrawArea(e),s=[],u=0;u<t.length;u++)c=n?n[u]:u.toString(),l=t[u],s.push([c,l.accuracy,l.count]);return r.abrupt("return",a.table(o,{headers:["Class","Accuracy","# Samples"],values:s}));case 3:case"end":return r.stop()}}),r)})))}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(137),a=n(46),o=n(109),s=n(64),u=n(110);function c(e){var t;return t=Array.isArray(e.outputShape[0])?"[".concat(e.outputShape.map((function(e){return l(e)})).join(", "),"]"):l(e.outputShape),{name:e.name,trainable:e.trainable,parameters:e.countParams(),outputShape:t}}function l(e){var t=e.slice();return 0===t.length?"Scalar":(null===t[0]&&(t[0]="batch"),"[".concat(t.join(","),"]"))}t.modelSummary=function(e,t){return r(this,void 0,void 0,m().mark((function n(){var r,i;return m().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=a.getDrawArea(e),i=function(e){return{layers:e.layers.map(c)}}(t).layers.map((function(e){return[e.name,e.outputShape,e.parameters,e.trainable]})),o.table(r,{headers:["Layer Name","Output Shape","# Of Params","Trainable"],values:i});case 2:case"end":return n.stop()}}),n)})))},t.layer=function(e,t){return r(this,void 0,void 0,m().mark((function n(){var c,f,d,h,p,v,g=this;return m().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return c=a.getDrawArea(e),n.next=3,function(e){return r(this,void 0,void 0,m().mark((function t(){var n,r,i,a,o;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.getWeights(),r=e.weights,i=n.map(u.tensorStats),t.next=5,Promise.all(i);case 5:return a=t.sent,o=n.map((function(e){return e.shape})),t.abrupt("return",n.map((function(e,t){return{name:r[t].name,stats:a[t],shape:l(o[t]),weight:e}})));case 8:case"end":return t.stop()}}),t)})))}(t);case 3:f=n.sent,d=s.subSurface(c,"layer-weights-info"),h=f.map((function(e){return[e.name,e.shape,e.stats.min,e.stats.max,e.weight.size,e.stats.numZeros,e.stats.numNans,e.stats.numInfs]})),o.table(d,{headers:["Weight Name","Shape","Min","Max","# Params","# Zeros","# NaNs","# Infinity"],values:h}),p=s.subSurface(c,"select-layer"),v=s.subSurface(c,"param-distribution"),function(e,t,n){var r="<div><button>Show Values Distribution for:</button>".concat("\n    <select>\n      ".concat(e.map((function(e){return"<option value=".concat(e,">").concat(e,"</option>")})),"\n    </select>\n  "),"</div>");t.innerHTML=r;var i=t.querySelector("button"),a=t.querySelector("select");i.addEventListener("click",(function(){n(a.selectedOptions[0].label)}))}(f.map((function(e){return e.name})),p,(function(e){return r(g,void 0,void 0,m().mark((function t(){var n;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,f.filter((function(t){return t.name===e}))[0].weight.data();case 2:n=t.sent,i.histogram(v,n,{height:150,width:460,stats:!1});case 4:case"end":return t.stop()}}),t)})))}));case 9:case"end":return n.stop()}}),n)})))}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(196),a=n(46),o=n(64);function s(e,t,n){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return r(this,void 0,void 0,m().mark((function r(){var l,f,d,h,v,g,y,b,x,w,_,k,E,S,C,A,O,D;return m().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:l=a.getDrawArea(e),f={},d=p(n);try{for(d.s();!(h=d.n()).done;)v=h.value,/val_/.test(v)?(g=v.replace("val_",""),u(f,g),y=c(t,v,n.indexOf(v)),f[g].series.push(v),f[g].values.push(y)):(b=c(t,v,n.indexOf(v)),u(f,v),f[v].series.push(v),f[v].values.push(b))}catch(m){d.e(m)}finally{d.f()}for(x=Object.keys(f),w=Object.assign({},{xLabel:"Iteration",yLabel:"Value"},s),_=[],k=0,E=x;k<E.length;k++)S=E[k],C=o.subSurface(l,S),A=f[S].series,O=f[S].values,A.every((function(e){return Boolean(e.match("acc"))}))&&(w.zoomToFitAccuracy?w.zoomToFit=!0:(w.yAxisDomain=[0,1],delete w.zoomToFit)),D=i.linechart(C,{values:O,series:A},w),_.push(D);return r.next=7,Promise.all(_);case 7:case"end":return r.stop()}}),r)})))}function u(e,t){null==e[t]&&(e[t]={series:[],values:[]})}function c(e,t,n){if(Array.isArray(e)){for(var r=Array.isArray(e[0])?e[n]:e,i=[],a=0;a<r.length;a++){var o=r[a];i.push({x:a,y:o[t]})}return i}return e.history[t].map((function(e,t){return{x:t,y:e}}))}function l(e,t,n){return null==e[t]&&(e[t]={}),null==e[t][n]&&(e[t][n]=[]),e[t][n]}t.history=s,t.fitCallbacks=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i={},u=n.callbacks||["onEpochEnd","onBatchEnd"],c=a.getDrawArea(e),f=Object.assign({},n);delete f.callbacks;var d={};return u.forEach((function(e){d[e]=function(e){var n=this;return function(u,d){return r(n,void 0,void 0,m().mark((function n(){var r,u,h,v,g,b;return m().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:/batch/i.test(e)?f.xLabel="Batch":/epoch/i.test(e)&&(f.xLabel="Epoch"),r=[],u=[],h=p(t);try{for(h.s();!(v=h.n()).done;)g=v.value,null!=d[g]&&(u.push(g),(b=l(i,e,g)).push(y({},g,d[g])),r.push(b))}catch(m){h.e(m)}finally{h.f()}return s(o.subSurface(c,e,{title:e}),r,u,f),n.next=7,a.nextFrame();case 7:case"end":return n.stop()}}),n)})))}}(e)})),d}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=i(n(88)),o=n(64),s=n(111),u=n(46);t.scatterplot=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(this,void 0,void 0,m().mark((function r(){var i,l,f,d,p,v;return m().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i=t.values,l=null==t.series?[]:t.series,f=[],(i=Array.isArray(i[0])?i:[i]).forEach((function(e,t){var n=null!=l[t]?l[t]:"Series ".concat(t+1),r=e.map((function(e){return Object.assign({},e,{series:n})}));f.push.apply(f,h(r))})),null!=n.seriesColors&&s.assert(n.seriesColors.length===i.length,"Must have an equal number of series colors as there are data series"),d=u.getDrawArea(e),p=Object.assign({},c,n),v={width:p.width||o.getDefaultWidth(d),height:p.height||o.getDefaultHeight(d),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:p.fontSize,titleFontSize:p.fontSize},text:{fontSize:p.fontSize},legend:{labelFontSize:p.fontSize,titleFontSize:p.fontSize}},data:{values:f},mark:{type:"point",clip:!0,tooltip:{content:"data"}},encoding:{x:{field:"x",type:p.xType,title:p.xLabel,scale:p.zoomToFit?{zero:!1}:null!=p.xAxisDomain?{domain:p.xAxisDomain}:void 0},y:{field:"y",type:p.yType,title:p.yLabel,scale:p.zoomToFit?{zero:!1}:null!=p.yAxisDomain?{domain:p.yAxisDomain}:void 0},color:{field:"series",type:"nominal",scale:{range:p.seriesColors}},shape:{field:"series",type:"nominal"}}},r.next=6,a.default(d,v,{actions:!1,mode:"vega-lite",defaultStyle:!1});case 6:return r.abrupt("return",Promise.resolve());case 7:case"end":return r.stop()}}),r)})))};var c={xLabel:"x",yLabel:"y",xType:"quantitative",yType:"quantitative",zoomToFit:!1,fontSize:11}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=i(n(0)),s=a(n(88)),u=n(64),c=n(111),l=n(46);function d(e,t,n){var r=e instanceof o.Tensor?e.shape:[e.length,e[0].length];0===n?c.assert(r[0]===t.length,"Length of xTickLabels (".concat(t.length,") must match number of rows")+" (".concat(r[0],")")):1===n&&c.assert(r[1]===t.length,"Length of yTickLabels (".concat(t.length,") must match number of columns (").concat(r[1],")"))}t.heatmap=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(this,void 0,void 0,m().mark((function i(){var a,p,v,g,y,b,x,w,_,k,E,S,C,A,O,D,T,j,M,F,I,N,R,P,B,L;return m().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(a=Object.assign({},h,n),p=l.getDrawArea(e),v=t.values,i.t0=a.rowMajor,!i.t0){i.next=7;break}return i.next=6,function(e){return r(this,void 0,void 0,m().mark((function t(){var n,r,i,a;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e instanceof o.Tensor?(n=e.shape,r=e.transpose()):(n=[e.length,e[0].length],r=o.tidy((function(){return o.tensor2d(e).transpose()}))),c.assert(2===r.rank,"Input to renderHeatmap must be a 2d array or Tensor2d"),t.next=3,r.array();case 3:return i=t.sent,r.dispose(),a=[i.length,i[0].length],t.abrupt("return",(c.assert(n[0]===a[1]&&n[1]===a[0],"Unexpected transposed shape. Original ".concat(n," : Transposed ").concat(a)),i));case 7:case"end":return t.stop()}}),t)})))}(t.values);case 6:v=i.sent;case 7:if(g=t.xTickLabels,y=t.yTickLabels,null!=g&&d(v,g,0),null!=y&&d(v,y,1),b=[],!(v instanceof o.Tensor)){i.next=21;break}return c.assert(2===v.rank,"Input to renderHeatmap must be a 2d array or Tensor2d"),i.next=14,v.data();case 14:for(x=i.sent,w=f(v.shape,2),_=w[0],k=w[1],E=0;E<_;E++)for(S=g?"".concat(g[E],"@tfidx@").concat(E):E,C=0;C<k;C++)A=y?"".concat(y[C],"@tfidx@").concat(C):C,O=x[E*k+C],b.push({x:S,y:A,value:O});i.next=23;break;case 21:for(D=v,T=0;T<D.length;T++)for(j=g?"".concat(g[T],"@tfidx@").concat(T):T,M=0;M<D[T].length;M++)F=y?"".concat(y[M],"@tfidx@").concat(M):M,I=D[T][M],b.push({x:j,y:F,value:I});case 23:N={actions:!1,mode:"vega-lite",defaultStyle:!1},R={width:a.width||u.getDefaultWidth(p),height:a.height||u.getDefaultHeight(p),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:a.fontSize,titleFontSize:a.fontSize},text:{fontSize:a.fontSize},legend:{labelFontSize:a.fontSize,titleFontSize:a.fontSize},scale:{bandPaddingInner:0,bandPaddingOuter:0}},data:{values:b},mark:{type:"rect",tooltip:!0},encoding:{x:{field:"x",type:a.xType,title:a.xLabel,sort:!1},y:{field:"y",type:a.yType,title:a.yLabel,sort:!1},fill:{field:"value",type:"quantitative"}}},P=new RegExp("@tfidx@\\d+$"),i.t1=(g&&(R.encoding.x.axis={labelExpr:"replace(datum.value, regexp(/@tfidx@\\d+$/), '')"}),y&&(R.encoding.y.axis={labelExpr:"replace(datum.value, regexp(/@tfidx@\\d+$/), '')"}),(g||y)&&(N.tooltip={sanitize:function(e){return String(e).replace(P,"")}}),a.colorMap),i.next="blues"===i.t1?27:"greyscale"===i.t1?29:(i.t1,31);break;case 27:return B=["#f7fbff","#4292c6"],i.abrupt("break",32);case 29:return B=["#000000","#ffffff"],i.abrupt("break",32);case 31:B="viridis";case 32:return"viridis"!==B&&(R.encoding.fill.scale={range:B}),a.domain&&(null!=(L=R.encoding.fill).scale?L.scale=Object.assign({},L.scale,{domain:a.domain}):L.scale={domain:a.domain}),i.next=35,s.default(p,R,N);case 35:case"end":return i.stop()}}),i)})))};var h={xLabel:null,yLabel:null,xType:"ordinal",yType:"ordinal",colorMap:"viridis",fontSize:12,domain:null,rowMajor:!1}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=i(n(88)),o=n(64),s=n(46);t.confusionMatrix=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(this,void 0,void 0,m().mark((function r(){var i,c,l,f,d,h,v,g,y,b,x,w,_,k,E,S,C;return m().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:for(i=Object.assign({},u,n),c=s.getDrawArea(e),l=[],f=t.values,d=t.tickLabels||[],h=0===d.length,v=!0,g=0;g<f.length;g++)for(y=h?"Class ".concat(g):d[g],h&&d.push(y),b=0;b<f[g].length;b++)x=h?"Class ".concat(b):d[b],w=f[g][b],g!==b||i.shadeDiagonal?(l.push({label:y,prediction:x,count:w,scaleCount:w}),0!==w&&(v=!1)):l.push({label:y,prediction:x,count:w,noFill:!0});if(!i.shadeDiagonal&&v){_=p(l);try{for(_.s();!(k=_.n()).done;)!0===(E=k.value).noFill&&(E.noFill=!1,E.scaleCount=E.count)}catch(m){_.e(m)}finally{_.f()}}return S={width:i.width||o.getDefaultWidth(c),height:i.height||o.getDefaultHeight(c),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:i.fontSize,titleFontSize:i.fontSize},text:{fontSize:i.fontSize},legend:{labelFontSize:i.fontSize,titleFontSize:i.fontSize}},data:{values:l},encoding:{x:{field:"prediction",type:"ordinal",title:i.xLabel||"prediction",scale:{domain:d}},y:{field:"label",type:"ordinal",title:i.yLabel||"label",scale:{domain:d}}},layer:[{transform:[{filter:"datum.noFill != true"}],mark:{type:"rect"},encoding:{color:{field:"scaleCount",type:"quantitative",scale:{range:i.colorMap}},tooltip:[{field:"label",type:"nominal"},{field:"prediction",type:"nominal"},{field:"count",type:"quantitative"}]}}]},!1===i.shadeDiagonal&&S.layer.push({transform:[{filter:"datum.noFill == true"}],mark:{type:"rect",fill:"white"},encoding:{tooltip:[{field:"label",type:"nominal"},{field:"prediction",type:"nominal"},{field:"count",type:"quantitative"}]}}),i.showTextOverlay&&S.layer.push({mark:{type:"text",baseline:"middle"},encoding:{text:{field:"count",type:"nominal"}}}),C="string"==typeof i.colorMap?{scheme:i.colorMap}:i.colorMap,S.layer[0].encoding.color.scale.range=C,r.next=10,a.default(c,S,{actions:!1,mode:"vega-lite",defaultStyle:!1});case 10:case"end":return r.stop()}}),r)})))};var u={xLabel:null,yLabel:null,xType:"nominal",yType:"nominal",shadeDiagonal:!0,fontSize:12,showTextOverlay:!0,height:400,colorMap:["#f7fbff","#4292c6"]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(138),i=n(102);t.Tabs=function(e){c(n,e);var t=l(n);function n(){return v(this,n),t.apply(this,arguments)}return g(n,[{key:"render",value:function(){var e=this.props,t=e.tabNames,n=e.activeTab,o=e.handleClick,s=t.length>0?t.map((function(e){return r.h(a,{key:e,id:e,handleClick:o,isActive:e===n},e)})):null,u=i.css({overflowX:"scroll",overflowY:"hidden",whiteSpace:"nowrap",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"#eee",paddingBottom:"1rem",marginTop:"1rem"});return r.h("div",{className:"".concat(u," visor-tabs")},s)}}]),n}(r.Component);var a=function(e){c(n,e);var t=l(n);function n(){return v(this,n),t.apply(this,arguments)}return g(n,[{key:"render",value:function(){var e=this.props,t=e.children,n=e.isActive,a=e.handleClick,o=e.id,s=i.css({borderBottomColor:n?"#357EDD":"#AAAAAA",borderBottomWidth:"1px",borderBottomStyle:"solid",cursor:"pointer",":hover":{color:"#357EDD"},display:"inline-block",marginRight:"1rem",padding:".5rem",fontSize:"1rem",fontWeight:"bold"});return r.h("a",{className:"".concat(s," tf-tab"),"data-isactive":n,onClick:function(){return a(o)}},t)}}]),n}(r.Component)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(138),i=n(102),a=function(e){c(n,e);var t=l(n);function n(){return v(this,n),t.apply(this,arguments)}return g(n,[{key:"componentDidMount",value:function(){var e=this.props,t=e.name,n=e.tab;this.props.registerSurface(t,n,this)}},{key:"componentDidUpdate",value:function(){return!1}},{key:"render",value:function(){var e=this,t=this.props,a=t.name,o=t.visible,s=t.styles,u=Object.assign({},n.defaultStyles,s),c=u.width,l=u.height,f=u.maxHeight,d=u.maxWidth;f=l===n.defaultStyles.height?f:l,d=c===n.defaultStyles.width?d:c;var h=i.css({display:o?"block":"none",backgroundColor:"white",marginTop:"10px",marginBottom:"10px",boxShadow:"0 0 6px -3px #777",padding:"10px !important",height:l,width:c,maxHeight:f,maxWidth:d,overflow:"auto"}),p=i.css({backgroundColor:"white",boxSizing:"border-box",borderBottom:"1px solid #357EDD",lineHeight:"2em",marginBottom:"20px",fontWeight:"600",textAlign:"center"}),m=i.css({boxSizing:"border-box"});return r.h("div",{className:"".concat(h," tf-surface"),ref:function(t){return e.container=t},"data-visible":o},r.h("div",{className:"".concat(p," tf-label"),ref:function(t){return e.label=t}},a),r.h("div",{className:"".concat(m," tf-draw-area"),ref:function(t){return e.drawArea=t}}))}}]),n}(r.Component);a.defaultStyles={maxWidth:"550px",maxHeight:"580px",height:"auto",width:"auto"},t.SurfaceComponent=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(138),i=n(102),o=n(291),s=n(290),u=function(e){c(n,e);var t=l(n);function n(e){var r;v(this,n),(r=t.call(this,e)).surfaces=new Map;var i=null==e.startOpen||e.startOpen;return r.state={isOpen:i,isFullscreen:!1,activeTab:null,tabs:new Set},r.keyHandler=r.keyHandler.bind(a(r)),r}return g(n,[{key:"close",value:function(){this.setState({isOpen:!1})}},{key:"open",value:function(){this.setState({isOpen:!0})}},{key:"toggle",value:function(){this.setState({isOpen:!this.state.isOpen})}},{key:"toggleFullScreen",value:function(){this.setState({isFullscreen:!this.state.isFullscreen})}},{key:"isOpen",value:function(){return this.state.isOpen}},{key:"isFullscreen",value:function(){return this.state.isFullscreen}},{key:"getSurface",value:function(e,t){var n,r=this.surfaceId(e,t);if(!this.surfaces.has(r))throw Error("Surface not found with id: ".concat(r));return{container:(n=this.surfaces.get(r)).container,label:n.label,drawArea:n.drawArea}}},{key:"bindKeys",value:function(){document.addEventListener("keydown",this.keyHandler,!1)}},{key:"unbindKeys",value:function(){document.removeEventListener("keydown",this.keyHandler)}},{key:"surfaceId",value:function(e,t){return e+t}},{key:"setTabs",value:function(e){var t,n,r=e.map((function(e){return e.tab})),i=this.state.tabs,a=p(r);try{for(a.s();!(n=a.n()).done;){var o=n.value;i.has(o)||(i.add(o),t=o)}}catch(s){a.e(s)}finally{a.f()}null!=t&&this.setState({tabs:i,activeTab:t})}},{key:"getTabs",value:function(){return this.state.tabs}},{key:"registerSurface",value:function(e,t,n){var r=this.surfaceId(e,t);this.surfaces.set(r,n)}},{key:"keyHandler",value:function(e){192===e.keyCode&&(e.shiftKey?this.toggleFullScreen():this.toggle())}},{key:"setActiveTab",value:function(e){this.setState({activeTab:e})}},{key:"componentDidMount",value:function(){this.bindKeys()}},{key:"componentWillMount",value:function(){this.setTabs(this.props.surfaceList)}},{key:"componentWillReceiveProps",value:function(e){this.setTabs(e.surfaceList)}},{key:"render",value:function(){var e=this,t=this.state,n=t.isOpen,a=t.isFullscreen,u=t.activeTab,c=this.props.surfaceList,l=Array.from(this.getTabs().values()),d=a?"90vw":"550px",h=i.css({width:d,height:"100%",backgroundColor:"#fafafa",boxSizing:"border-box",padding:"10px",position:"fixed",top:"0px",transition:"right 0.5s cubic-bezier(0.645, 0.045, 0.355, 1), width 0.5s cubic-bezier(0.645, 0.045, 0.355, 1)",boxShadow:"0 2px 5px rgba(0, 0, 0, 0.12), 0 2px 5px rgba(0, 0, 0, 0.24)",overflow:"auto",fontFamily:"sans-serif",fontSize:"14px",zIndex:1e3}),p=i.css({right:"0"}),m=i.css({right:"calc(-".concat(d," - 10px)")}),v=n?p:m,g=i.css({});return r.h("div",{className:"".concat(h," ").concat(v," visor"),"data-isopen":n,"data-isfullscreen":a},r.h(f,{fullScreenHandler:this.toggleFullScreen.bind(this),closeHandler:this.close.bind(this),isFullScreen:a}),r.h(s.Tabs,{tabNames:l,activeTab:u,handleClick:this.setActiveTab.bind(this)}),r.h("div",{className:"".concat(g," visor-surfaces")},c.map((function(t){return r.h(o.SurfaceComponent,{key:t.name+t.tab,name:t.name,tab:t.tab,styles:t.styles,registerSurface:e.registerSurface.bind(e),visible:u===t.tab})}))))}}],[{key:"render",value:function(e,t,i){return r.render(r.h(n,Object.assign({},i)),e,t)}}]),n}(r.Component);function f(e){var t=e.isFullScreen,n=e.fullScreenHandler,a=e.closeHandler,o=i.css({display:"flex",backgroundColor:"white",border:"1px solid white",padding:"6px",paddingTop:"10px",marginBottom:"10px",borderRadius:"6px",marginTop:"-16px"}),s=i.css({fontSize:".875rem",borderRadius:".25rem",paddingLeft:"1rem",paddingRight:"1rem",paddingTop:".5rem",paddingBottom:".5rem",textDecoration:"none",transition:"color .15s ease-in",color:"#111"}),u=i.css({marginLeft:"auto"});return r.h("div",{className:"".concat(o," visor-controls")},r.h("button",{className:"".concat(s),onClick:n},t?"Minimize":"Maximize"),r.h("button",{className:"".concat(s," ").concat(u),onClick:a},"Hide"))}t.VisorComponent=u},function(e,t,n){"use strict";function r(e,t){return e.charCodeAt(t++)+(e.charCodeAt(t++)<<8)+(e.charCodeAt(t++)<<16)+(e.charCodeAt(t)<<24)}function i(e,t){return e.charCodeAt(t++)+(e.charCodeAt(t++)<<8)}function a(e,t){return(65535&(e|=0))*(t|=0)+(((e>>>16)*t&65535)<<16)|0}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){for(var n=1540483477,o=t^e.length,s=e.length,u=0;s>=4;){var c=r(e,u);c=a(c,n),c=a(c^=c>>>24,n),o=a(o,n),o^=c,u+=4,s-=4}switch(s){case 3:o^=i(e,u),o=a(o^=e.charCodeAt(u+2)<<16,n);break;case 2:o=a(o^=i(e,u),n);break;case 1:o=a(o^=e.charCodeAt(u),n)}return o=a(o^=o>>>13,n),(o^=o>>>15)>>>0}},function(e,t,n){"use strict";n.r(t);var r=/[A-Z]/g,i=/^ms-/,a={};function o(e){return"-"+e.toLowerCase()}t.default=function(e){if(a.hasOwnProperty(e))return a[e];var t=e.replace(r,o);return a[e]=i.test(t)?"-"+t:t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,r.default)(e)};var r=function(e){return e&&e.__esModule?e:{default:e}}(n(294));e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,o){if("string"==typeof t&&s.hasOwnProperty(e)){var c=function(e,t){if((0,i.default)(e))return e;for(var n=e.split(/,(?![^()]*(?:\([^()]*\))?\))/g),a=0,o=n.length;a<o;++a){var s=n[a],c=[s];for(var l in t){var f=(0,r.default)(l);if(s.indexOf(f)>-1&&"order"!==f)for(var d=t[l],h=0,p=d.length;h<p;++h)c.unshift(s.replace(f,u[d[h]]+f))}n[a]=c.join(",")}return n.join(",")}(t,o),l=c.split(/,(?![^()]*(?:\([^()]*\))?\))/g).filter((function(e){return!/-moz-|-ms-/.test(e)})).join(",");if(e.indexOf("Webkit")>-1)return l;var f=c.split(/,(?![^()]*(?:\([^()]*\))?\))/g).filter((function(e){return!/-webkit-|-ms-/.test(e)})).join(",");return e.indexOf("Moz")>-1?f:(n["Webkit"+(0,a.default)(e)]=l,n["Moz"+(0,a.default)(e)]=f,c)}};var r=o(n(295)),i=o(n(101)),a=o(n(199));function o(e){return e&&e.__esModule?e:{default:e}}var s={transition:!0,transitionProperty:!0,WebkitTransition:!0,WebkitTransitionProperty:!0,MozTransition:!0,MozTransitionProperty:!0},u={Webkit:"-webkit-",Moz:"-moz-",ms:"-ms-"};e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(i.hasOwnProperty(e)&&a.hasOwnProperty(t))return r.map((function(e){return e+t}))};var r=["-webkit-","-moz-",""],i={maxHeight:!0,maxWidth:!0,width:!0,height:!0,columnWidth:!0,minWidth:!0,minHeight:!0},a={"min-content":!0,"max-content":!0,"fill-available":!0,"fit-content":!0,"contain-floats":!0};e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if("position"===e&&"sticky"===t)return["-webkit-sticky","sticky"]},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if("string"==typeof t&&!(0,r.default)(t)&&t.indexOf("image-set(")>-1)return i.map((function(e){return t.replace(/image-set\(/g,e+"image-set(")}))};var r=function(e){return e&&e.__esModule?e:{default:e}}(n(101)),i=["-webkit-",""];e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if("string"==typeof t&&!(0,r.default)(t)&&a.test(t))return i.map((function(e){return e+t}))};var r=function(e){return e&&e.__esModule?e:{default:e}}(n(101)),i=["-webkit-","-moz-",""],a=/linear-gradient|radial-gradient|repeating-linear-gradient|repeating-radial-gradient/;e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){"flexDirection"===e&&"string"==typeof t&&(t.indexOf("column")>-1?n.WebkitBoxOrient="vertical":n.WebkitBoxOrient="horizontal",t.indexOf("reverse")>-1?n.WebkitBoxDirection="reverse":n.WebkitBoxDirection="normal"),i.hasOwnProperty(e)&&(n[i[e]]=r[t]||t)};var r={"space-around":"justify","space-between":"justify","flex-start":"start","flex-end":"end","wrap-reverse":"multiple",wrap:"multiple"},i={alignItems:"WebkitBoxAlign",justifyContent:"WebkitBoxPack",flexWrap:"WebkitBoxLines"};e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if("display"===e&&r.hasOwnProperty(t))return r[t]};var r={flex:["-webkit-box","-moz-box","-ms-flexbox","-webkit-flex","flex"],"inline-flex":["-webkit-inline-box","-moz-inline-box","-ms-inline-flexbox","-webkit-inline-flex","inline-flex"]};e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if("string"==typeof t&&!(0,r.default)(t)&&t.indexOf("filter(")>-1)return i.map((function(e){return t.replace(/filter\(/g,e+"filter(")}))};var r=function(e){return e&&e.__esModule?e:{default:e}}(n(101)),i=["-webkit-",""];e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if("string"==typeof t&&!(0,r.default)(t)&&t.indexOf("cross-fade(")>-1)return i.map((function(e){return t.replace(/cross-fade\(/g,e+"cross-fade(")}))};var r=function(e){return e&&e.__esModule?e:{default:e}}(n(101)),i=["-webkit-",""];e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if("cursor"===e&&i.hasOwnProperty(t))return r.map((function(e){return e+t}))};var r=["-webkit-","-moz-",""],i={"zoom-in":!0,"zoom-out":!0,grab:!0,grabbing:!0};e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,r,i){for(var a=0,o=e.length;a<o;++a){var s=e[a](t,n,r,i);if(s)return s}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(e.hasOwnProperty(t))for(var i=e[t],a=0,o=i.length;a<o;++a)n[i[a]+(0,r.default)(t)]=n[t]};var r=function(e){return e&&e.__esModule?e:{default:e}}(n(199));e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=["Webkit"],i=["Moz"],a=["ms"],o=["Webkit","Moz"],s=["Webkit","ms"],u=["Webkit","Moz","ms"];t.default={plugins:[],prefixMap:{appearance:o,userSelect:u,textEmphasisPosition:r,textEmphasis:r,textEmphasisStyle:r,textEmphasisColor:r,boxDecorationBreak:r,clipPath:r,maskImage:r,maskMode:r,maskRepeat:r,maskPosition:r,maskClip:r,maskOrigin:r,maskSize:r,maskComposite:r,mask:r,maskBorderSource:r,maskBorderMode:r,maskBorderSlice:r,maskBorderWidth:r,maskBorderOutset:r,maskBorderRepeat:r,maskBorder:r,maskType:r,textDecorationStyle:r,textDecorationSkip:r,textDecorationLine:r,textDecorationColor:r,filter:r,fontFeatureSettings:r,breakAfter:u,breakBefore:u,breakInside:u,columnCount:o,columnFill:o,columnGap:o,columnRule:o,columnRuleColor:o,columnRuleStyle:o,columnRuleWidth:o,columns:o,columnSpan:o,columnWidth:o,writingMode:s,flex:r,flexBasis:r,flexDirection:r,flexGrow:r,flexFlow:r,flexShrink:r,flexWrap:r,alignContent:r,alignItems:r,alignSelf:r,justifyContent:r,order:r,transform:r,transformOrigin:r,transformOriginX:r,transformOriginY:r,backfaceVisibility:r,perspective:r,perspectiveOrigin:r,transformStyle:r,transformOriginZ:r,animation:r,animationDelay:r,animationDirection:r,animationFillMode:r,animationDuration:r,animationIterationCount:r,animationName:r,animationPlayState:r,animationTimingFunction:r,backdropFilter:r,fontKerning:r,scrollSnapType:s,scrollSnapPointsX:s,scrollSnapPointsY:s,scrollSnapDestination:s,scrollSnapCoordinate:s,shapeImageThreshold:r,shapeImageMargin:r,shapeImageOutside:r,hyphens:u,flowInto:s,flowFrom:s,regionFragment:s,textAlignLast:i,tabSize:i,wrapFlow:a,wrapThrough:a,wrapMargin:a,gridTemplateColumns:a,gridTemplateRows:a,gridTemplateAreas:a,gridTemplate:a,gridAutoColumns:a,gridAutoRows:a,gridAutoFlow:a,grid:a,gridRowStart:a,gridColumnStart:a,gridRowEnd:a,gridRow:a,gridColumn:a,gridColumnEnd:a,gridColumnGap:a,gridRowGap:a,gridArea:a,gridGap:a,textSizeAdjust:s,borderImage:r,borderImageOutset:r,borderImageRepeat:r,borderImageSlice:r,borderImageSource:r,borderImageWidth:r,transitionDelay:r,transitionDuration:r,transitionProperty:r,transitionTimingFunction:r}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(var t in e){var n=e[t],r=(0,a.default)(g,t,n,e,y);r&&(e[t]=r),(0,i.default)(y,t,e)}return e};var r=v(n(308)),i=v(n(307)),a=v(n(306)),o=v(n(305)),s=v(n(304)),u=v(n(303)),c=v(n(302)),l=v(n(301)),f=v(n(300)),d=v(n(299)),h=v(n(298)),p=v(n(297)),m=v(n(296));function v(e){return e&&e.__esModule?e:{default:e}}var g=[s.default,o.default,u.default,l.default,f.default,d.default,h.default,p.default,m.default,c.default],y=r.default.prefixMap},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};t.PluginSet=u,t.fallbacks=function(e){if(Object.keys(e.style).map((function(t){return Array.isArray(e.style[t])})).indexOf(!0)>=0){var t=e.style,n=Object.keys(t).reduce((function(e,n){return e[n]=Array.isArray(t[n])?t[n].join("; "+(0,a.processStyleName)(n)+": "):t[n],e}),{});return(0,i.default)({},e,{style:n})}return e},t.contentWrap=function(e){if(e.style.content){var t=e.style.content;return c.indexOf(t)>=0||/^(attr|calc|counters?|url)\(/.test(t)?e:t.charAt(0)!==t.charAt(t.length-1)||'"'!==t.charAt(0)&&"'"!==t.charAt(0)?r({},e,{style:r({},e.style,{content:'"'+t+'"'})}):e}return e},t.prefixes=function(e){return(0,i.default)({},e,{style:(0,o.default)(r({},e.style))})};var i=s(n(139)),a=n(201),o=s(n(309));function s(e){return e&&e.__esModule?e:{default:e}}function u(e){this.fns=e||[]}(0,i.default)(u.prototype,{add:function(){for(var e=this,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];n.forEach((function(t){e.fns.indexOf(t)>=0||(e.fns=[t].concat(e.fns))}))},remove:function(e){this.fns=this.fns.filter((function(t){return t!==e}))},clear:function(){this.fns=[]},transform:function(e){return this.fns.reduce((function(e,t){return t(e)}),e)}});var c=["normal","none","counter","open-quote","close-quote","no-open-quote","no-close-quote","initial","inherit"]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function i(e){if(function(e){return null===e||void 0===e||!1===e||"object"===(void 0===e?"undefined":r(e))&&0===Object.keys(e).length}(e))return null;if("object"!==(void 0===e?"undefined":r(e)))return e;for(var t={},n=Object.keys(e),i=!1,o=0;o<n.length;o++){var s=e[n[o]],u=a(s);null!==u&&u===s||(i=!0),null!==u&&(t[n[o]]=u)}return 0===Object.keys(t).length?null:i?t:e}function a(e){return Array.isArray(e)?function(e){var t=!1,n=[];return e.forEach((function(e){var r=a(e);null!==r&&r===e||(t=!0),null!==r&&n.push(r)})),0==n.length?null:t?n:e}(e):i(e)}t.default=a},function(e,t,n){"use strict";e.exports=function(e){var t={};return function(n){return t.hasOwnProperty(n)||(t[n]=e.call(this,n)),t[n]}}},function(e,t,n){"use strict";var r=/([A-Z])/g;e.exports=function(e){return e.replace(r,"-$1").toLowerCase()}},function(e,t,n){"use strict";var r=n(313),i=/^ms-/;e.exports=function(e){return r(e).replace(i,"-ms-")}},function(e,t,n){"use strict";function r(e){return function(){return e}}var i=function(){};i.thatReturns=r,i.thatReturnsFalse=r(!1),i.thatReturnsTrue=r(!0),i.thatReturnsNull=r(null),i.thatReturnsThis=function(){return this},i.thatReturnsArgument=function(e){return e},e.exports=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowStart:!0,gridRowEnd:!0,gridColumn:!0,gridColumnStart:!0,gridColumnEnd:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},i=["Webkit","ms","Moz","O"];Object.keys(r).forEach((function(e){i.forEach((function(t){r[function(e,t){return e+t.charAt(0).toUpperCase()+t.substring(1)}(t,e)]=r[e]}))}));var a={isUnitlessNumber:r,shorthandPropertyExpansions:{background:{backgroundAttachment:!0,backgroundColor:!0,backgroundImage:!0,backgroundPositionX:!0,backgroundPositionY:!0,backgroundRepeat:!0},backgroundPosition:{backgroundPositionX:!0,backgroundPositionY:!0},border:{borderWidth:!0,borderStyle:!0,borderColor:!0},borderBottom:{borderBottomWidth:!0,borderBottomStyle:!0,borderBottomColor:!0},borderLeft:{borderLeftWidth:!0,borderLeftStyle:!0,borderLeftColor:!0},borderRight:{borderRightWidth:!0,borderRightStyle:!0,borderRightColor:!0},borderTop:{borderTopWidth:!0,borderTopStyle:!0,borderTopColor:!0},font:{fontStyle:!0,fontVariant:!0,fontWeight:!0,fontSize:!0,lineHeight:!0,fontFamily:!0},outline:{outlineWidth:!0,outlineStyle:!0,outlineColor:!0}}};t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(n(316));function i(e){return e&&e.__esModule?e:{default:e}}i(n(200));var a=r.default.isUnitlessNumber;t.default=function(e,t,n){return null==t||"boolean"==typeof t||""===t?"":isNaN(t)||0===t||a.hasOwnProperty(e)&&a[e]?""+t:("string"==typeof t&&(t=t.trim()),t+"px")}},function(e,t,n){"use strict";var r=/-(.)/g;e.exports=function(e){return e.replace(r,(function(e,t){return t.toUpperCase()}))}},function(e,t,n){"use strict";var r=n(318),i=/^-ms-/;e.exports=function(e){return r(e.replace(i,"ms-"))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StyleSheet=f;var r=function(e){return e&&e.__esModule?e:{default:e}}(n(139));function i(e){return e[e.length-1]}function a(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]}var o="undefined"!=typeof window,s=!1,u=!1,c=function(){if(o){var e=document.createElement("div");return e.innerHTML="\x3c!--[if lt IE 10]><i></i><![endif]--\x3e",1===e.getElementsByTagName("i").length}}();function l(){var e=document.createElement("style");return e.type="text/css",e.setAttribute("data-glamor",""),e.appendChild(document.createTextNode("")),(document.head||document.getElementsByTagName("head")[0]).appendChild(e),e}function f(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.speedy,n=void 0===t?!s&&!u:t,r=e.maxLength,i=void 0===r?o&&c?4e3:65e3:r;this.isSpeedy=n,this.sheet=void 0,this.tags=[],this.maxLength=i,this.ctr=0}(0,r.default)(f.prototype,{getSheet:function(){return a(i(this.tags))},inject:function(){var e=this;if(this.injected)throw new Error("already injected stylesheet!");o?this.tags[0]=l():this.sheet={cssRules:[],insertRule:function(t){e.sheet.cssRules.push({cssText:t})}},this.injected=!0},speedy:function(e){if(0!==this.ctr)throw new Error("cannot change speedy mode after inserting any rule to sheet. Either call speedy("+e+") earlier in your app, or call flush() before speedy("+e+")");this.isSpeedy=!!e},_insert:function(e){try{var t=this.getSheet();t.insertRule(e,-1!==e.indexOf("@import")?0:t.cssRules.length)}catch(t){s&&console.warn("whoops, illegal rule inserted",e)}},insert:function(e){if(o)if(this.isSpeedy&&this.getSheet().insertRule)this._insert(e);else if(-1!==e.indexOf("@import")){var t=i(this.tags);t.insertBefore(document.createTextNode(e),t.firstChild)}else i(this.tags).appendChild(document.createTextNode(e));else this.sheet.insertRule(e,-1!==e.indexOf("@import")?0:this.sheet.cssRules.length);return this.ctr++,o&&this.ctr%this.maxLength==0&&this.tags.push(l()),this.ctr-1},delete:function(e){return this.replace(e,"")},flush:function(){o?(this.tags.forEach((function(e){return e.parentNode.removeChild(e)})),this.tags=[],this.sheet=null,this.ctr=0):this.sheet.cssRules=[],this.injected=!1},rules:function(){if(!o)return this.sheet.cssRules;var e=[];return this.tags.forEach((function(t){return e.splice.apply(e,[e.length,0].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(Array.from(a(t).cssRules))))})),e}})},function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return u}));var r=n(null),i=n(87),a=n(null),o=n(null),s=n(null);function u(){var e=[],t=o.c;function n(n){if(null!=n&&!isNaN(n=+n))return t((Object(r.c)(e,n,1)-1)/(e.length-1))}return n.domain=function(t){if(!arguments.length)return e.slice();e=[];var r,a=p(t);try{for(a.s();!(r=a.n()).done;){var o=r.value;null==o||isNaN(o=+o)||e.push(o)}}catch(s){a.e(s)}finally{a.f()}return e.sort(i.a),n},n.interpolator=function(e){return arguments.length?(t=e,n):t},n.range=function(){return e.map((function(n,r){return t(r/(e.length-1))}))},n.quantiles=function(t){return Array.from({length:t+1},(function(n,r){return Object(a.b)(e,r/t)}))},n.copy=function(){return u(t).domain(e)},s.b.apply(n,arguments)}},function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return u}));var r=n(null),i=n(null),a=n(null),o=n(null);function s(e){return Math.sign(e)*e*e}function u(){var e,t=Object(r.a)(),n=[0,1],c=!1;function l(n){var r=function(e){return Math.sign(e)*Math.sqrt(Math.abs(e))}(t(n));return isNaN(r)?e:c?Math.round(r):r}return l.invert=function(e){return t.invert(s(e))},l.domain=function(e){return arguments.length?(t.domain(e),l):t.domain()},l.range=function(e){return arguments.length?(t.range((n=Array.from(e,o.a)).map(s)),l):n.slice()},l.rangeRound=function(e){return l.range(e).round(!0)},l.round=function(e){return arguments.length?(c=!!e,l):c},l.clamp=function(e){return arguments.length?(t.clamp(e),l):t.clamp()},l.unknown=function(t){return arguments.length?(e=t,l):e},l.copy=function(){return u(t.domain(),n).round(c).clamp(t.clamp()).unknown(e)},i.a.apply(l,arguments),Object(a.b)(l)}},function(e,t,n){var r=n(47),i=n(113),a=i.ANY,o=n(112),s=n(48),u=function(e,t,n){if(e===t)return!0;if(1===e.length&&e[0].semver===a){if(1===t.length&&t[0].semver===a)return!0;e=n.includePrerelease?[new i(">=0.0.0-0")]:[new i(">=0.0.0")]}if(1===t.length&&t[0].semver===a){if(n.includePrerelease)return!0;t=[new i(">=0.0.0")]}var r,u,f,d,h,m,v,g,y=new Set,b=p(e);try{for(b.s();!(g=b.n()).done;){var x=g.value;">"===x.operator||">="===x.operator?r=c(r,x,n):"<"===x.operator||"<="===x.operator?u=l(u,x,n):y.add(x.semver)}}catch(M){b.e(M)}finally{b.f()}if(y.size>1)return null;if(r&&u){if((f=s(r.semver,u.semver,n))>0)return null;if(0===f&&(">="!==r.operator||"<="!==u.operator))return null}var w,_=p(y);try{for(_.s();!(w=_.n()).done;){var k=w.value;if(r&&!o(k,String(r),n))return null;if(u&&!o(k,String(u),n))return null;var E,S=p(t);try{for(S.s();!(E=S.n()).done;){var C=E.value;if(!o(k,String(C),n))return!1}}catch(M){S.e(M)}finally{S.f()}return!0}}catch(M){_.e(M)}finally{_.f()}var A=!(!u||n.includePrerelease||!u.semver.prerelease.length)&&u.semver,O=!(!r||n.includePrerelease||!r.semver.prerelease.length)&&r.semver;A&&1===A.prerelease.length&&"<"===u.operator&&0===A.prerelease[0]&&(A=!1);var D,T=p(t);try{for(T.s();!(D=T.n()).done;){var j=D.value;if(v=v||">"===j.operator||">="===j.operator,m=m||"<"===j.operator||"<="===j.operator,r)if(O&&j.semver.prerelease&&j.semver.prerelease.length&&j.semver.major===O.major&&j.semver.minor===O.minor&&j.semver.patch===O.patch&&(O=!1),">"===j.operator||">="===j.operator){if((d=c(r,j,n))===j&&d!==r)return!1}else if(">="===r.operator&&!o(r.semver,String(j),n))return!1;if(u)if(A&&j.semver.prerelease&&j.semver.prerelease.length&&j.semver.major===A.major&&j.semver.minor===A.minor&&j.semver.patch===A.patch&&(A=!1),"<"===j.operator||"<="===j.operator){if((h=l(u,j,n))===j&&h!==u)return!1}else if("<="===u.operator&&!o(u.semver,String(j),n))return!1;if(!j.operator&&(u||r)&&0!==f)return!1}}catch(M){T.e(M)}finally{T.f()}return!(r&&m&&!u&&0!==f)&&!(u&&v&&!r&&0!==f)&&!O&&!A},c=function(e,t,n){if(!e)return t;var r=s(e.semver,t.semver,n);return r>0?e:r<0||">"===t.operator&&">="===e.operator?t:e},l=function(e,t,n){if(!e)return t;var r=s(e.semver,t.semver,n);return r<0?e:r>0||"<"===t.operator&&"<="===e.operator?t:e};e.exports=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e===t)return!0;e=new r(e,n),t=new r(t,n);var i,a=!1,o=p(e.set);try{e:for(o.s();!(i=o.n()).done;){var s,c=i.value,l=p(t.set);try{for(l.s();!(s=l.n()).done;){var f=s.value,d=u(c,f,n);if(a=a||null!==d,d)continue e}}catch(h){l.e(h)}finally{l.f()}if(a)return!1}}catch(h){o.e(h)}finally{o.f()}return!0}},function(e,t,n){var r=n(112),i=n(48);e.exports=function(e,t,n){var a,o=[],s=null,u=null,c=e.sort((function(e,t){return i(e,t,n)})),l=p(c);try{for(l.s();!(a=l.n()).done;){var d=a.value;r(d,t,n)?(u=d,s||(s=d)):(u&&o.push([s,u]),u=null,s=null)}}catch(_){l.e(_)}finally{l.f()}s&&o.push([s,null]);for(var h=[],m=0,v=o;m<v.length;m++){var g=f(v[m],2),y=g[0],b=g[1];y===b?h.push(y):b||y!==c[0]?b?y===c[0]?h.push("<=".concat(b)):h.push("".concat(y," - ").concat(b)):h.push(">=".concat(y)):h.push("*")}var x=h.join(" || "),w="string"==typeof t.raw?t.raw:String(t);return x.length<w.length?x:t}},function(e,t,n){var r=n(47);e.exports=function(e,t,n){return e=new r(e,n),t=new r(t,n),e.intersects(t)}},function(e,t,n){var r=n(140);e.exports=function(e,t,n){return r(e,t,"<",n)}},function(e,t,n){var r=n(140);e.exports=function(e,t,n){return r(e,t,">",n)}},function(e,t,n){var r=n(47);e.exports=function(e,t){try{return new r(e,t).range||"*"}catch(e){return null}}},function(e,t,n){var r=n(32),i=n(47),a=n(114);e.exports=function(e,t){e=new i(e,t);var n=new r("0.0.0");if(e.test(n))return n;if(n=new r("0.0.0-0"),e.test(n))return n;n=null;for(var o=function(){var t=null;e.set[s].forEach((function(e){var n=new r(e.semver.version);switch(e.operator){case">":0===n.prerelease.length?n.patch++:n.prerelease.push(0),n.raw=n.format();case"":case">=":t&&!a(n,t)||(t=n);break;case"<":case"<=":break;default:throw new Error("Unexpected operation: ".concat(e.operator))}})),!t||n&&!a(n,t)||(n=t)},s=0;s<e.set.length;++s)o();return n&&e.test(n)?n:null}},function(e,t,n){var r=n(32),i=n(47);e.exports=function(e,t,n){var a=null,o=null,s=null;try{s=new i(t,n)}catch(e){return null}return e.forEach((function(e){s.test(e)&&(a&&1!==o.compare(e)||(o=new r(a=e,n)))})),a}},function(e,t,n){var r=n(32),i=n(47);e.exports=function(e,t,n){var a=null,o=null,s=null;try{s=new i(t,n)}catch(e){return null}return e.forEach((function(e){s.test(e)&&(a&&-1!==o.compare(e)||(o=new r(a=e,n)))})),a}},function(e,t,n){var r=n(47);e.exports=function(e,t){return new r(e,t).set.map((function(e){return e.map((function(e){return e.value})).join(" ").trim().split(" ")}))}},function(e,t,n){"use strict";e.exports=function(e){e.prototype[Symbol.iterator]=m().mark((function e(){var t;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.head;case 1:if(!t){e.next=7;break}return e.next=4,t.value;case 4:t=t.next,e.next=1;break;case 7:case"end":return e.stop()}}),e,this)}))}},function(e,t,n){"use strict";function r(e){var t=this;if(t instanceof r||(t=new r),t.tail=null,t.head=null,t.length=0,e&&"function"==typeof e.forEach)e.forEach((function(e){t.push(e)}));else if(arguments.length>0)for(var n=0,i=arguments.length;n<i;n++)t.push(arguments[n]);return t}function i(e,t,n){var r=t===e.head?new s(n,null,t,e):new s(n,t,t.next,e);return null===r.next&&(e.tail=r),null===r.prev&&(e.head=r),e.length++,r}function a(e,t){e.tail=new s(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function o(e,t){e.head=new s(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function s(e,t,n,r){if(!(this instanceof s))return new s(e,t,n,r);this.list=r,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,n?(n.prev=this,this.next=n):this.next=null}e.exports=r,r.Node=s,r.create=r,r.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,n=e.prev;return t&&(t.prev=n),n&&(n.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=n),e.list.length--,e.next=null,e.prev=null,e.list=null,t},r.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},r.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}},r.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)a(this,arguments[e]);return this.length},r.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)o(this,arguments[e]);return this.length},r.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}},r.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}},r.prototype.forEach=function(e,t){t=t||this;for(var n=this.head,r=0;null!==n;r++)e.call(t,n.value,r,this),n=n.next},r.prototype.forEachReverse=function(e,t){t=t||this;for(var n=this.tail,r=this.length-1;null!==n;r--)e.call(t,n.value,r,this),n=n.prev},r.prototype.get=function(e){for(var t=0,n=this.head;null!==n&&t<e;t++)n=n.next;if(t===e&&null!==n)return n.value},r.prototype.getReverse=function(e){for(var t=0,n=this.tail;null!==n&&t<e;t++)n=n.prev;if(t===e&&null!==n)return n.value},r.prototype.map=function(e,t){t=t||this;for(var n=new r,i=this.head;null!==i;)n.push(e.call(t,i.value,this)),i=i.next;return n},r.prototype.mapReverse=function(e,t){t=t||this;for(var n=new r,i=this.tail;null!==i;)n.push(e.call(t,i.value,this)),i=i.prev;return n},r.prototype.reduce=function(e,t){var n,r=this.head;if(arguments.length>1)n=t;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");r=this.head.next,n=this.head.value}for(var i=0;null!==r;i++)n=e(n,r.value,i),r=r.next;return n},r.prototype.reduceReverse=function(e,t){var n,r=this.tail;if(arguments.length>1)n=t;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");r=this.tail.prev,n=this.tail.value}for(var i=this.length-1;null!==r;i--)n=e(n,r.value,i),r=r.prev;return n},r.prototype.toArray=function(){for(var e=new Array(this.length),t=0,n=this.head;null!==n;t++)e[t]=n.value,n=n.next;return e},r.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,n=this.tail;null!==n;t++)e[t]=n.value,n=n.prev;return e},r.prototype.slice=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var n=new r;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=0,a=this.head;null!==a&&i<e;i++)a=a.next;for(;null!==a&&i<t;i++,a=a.next)n.push(a.value);return n},r.prototype.sliceReverse=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var n=new r;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=this.length,a=this.tail;null!==a&&i>t;i--)a=a.prev;for(;null!==a&&i>e;i--,a=a.prev)n.push(a.value);return n},r.prototype.splice=function(e,t){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var n=0,r=this.head;null!==r&&n<e;n++)r=r.next;var a=[];for(n=0;r&&n<t;n++)a.push(r.value),r=this.removeNode(r);for(null===r&&(r=this.tail),r!==this.head&&r!==this.tail&&(r=r.prev),n=0;n<(arguments.length<=2?0:arguments.length-2);n++)r=i(this,r,n+2<2||arguments.length<=n+2?void 0:arguments[n+2]);return a},r.prototype.reverse=function(){for(var e=this.head,t=this.tail,n=e;null!==n;n=n.prev){var r=n.prev;n.prev=n.next,n.next=r}return this.head=t,this.tail=e,this};try{n(333)(r)}catch(e){}},function(e,t,n){"use strict";var r=n(334),i=Symbol("max"),a=Symbol("length"),o=Symbol("lengthCalculator"),s=Symbol("allowStale"),u=Symbol("maxAge"),c=Symbol("dispose"),l=Symbol("noDisposeOnSet"),f=Symbol("lruList"),d=Symbol("cache"),h=Symbol("updateAgeOnGet"),p=function(){return 1},m=function(e,t,n){var r=e[d].get(t);if(r){var i=r.value;if(y(e,i)){if(x(e,r),!e[s])return}else n&&(e[h]&&(r.value.now=Date.now()),e[f].unshiftNode(r));return i.value}},y=function(e,t){if(!t||!t.maxAge&&!e[u])return!1;var n=Date.now()-t.now;return t.maxAge?n>t.maxAge:e[u]&&n>e[u]},b=function(e){if(e[a]>e[i])for(var t=e[f].tail;e[a]>e[i]&&null!==t;){var n=t.prev;x(e,t),t=n}},x=function(e,t){if(t){var n=t.value;e[c]&&e[c](n.key,n.value),e[a]-=n.length,e[d].delete(n.key),e[f].removeNode(t)}},w=g((function e(t,n,r,i,a){v(this,e),this.key=t,this.value=n,this.length=r,this.now=i,this.maxAge=a||0})),_=function(e,t,n,r){var i=n.value;y(e,i)&&(x(e,n),e[s]||(i=void 0)),i&&t.call(r,i.value,i.key,e)};e.exports=function(){function e(t){if(v(this,e),"number"==typeof t&&(t={max:t}),t||(t={}),t.max&&("number"!=typeof t.max||t.max<0))throw new TypeError("max must be a non-negative number");this[i]=t.max||1/0;var n=t.length||p;if(this[o]="function"!=typeof n?p:n,this[s]=t.stale||!1,t.maxAge&&"number"!=typeof t.maxAge)throw new TypeError("maxAge must be a number");this[u]=t.maxAge||0,this[c]=t.dispose,this[l]=t.noDisposeOnSet||!1,this[h]=t.updateAgeOnGet||!1,this.reset()}return g(e,[{key:"max",get:function(){return this[i]},set:function(e){if("number"!=typeof e||e<0)throw new TypeError("max must be a non-negative number");this[i]=e||1/0,b(this)}},{key:"allowStale",get:function(){return this[s]},set:function(e){this[s]=!!e}},{key:"maxAge",get:function(){return this[u]},set:function(e){if("number"!=typeof e)throw new TypeError("maxAge must be a non-negative number");this[u]=e,b(this)}},{key:"lengthCalculator",get:function(){return this[o]},set:function(e){var t=this;"function"!=typeof e&&(e=p),e!==this[o]&&(this[o]=e,this[a]=0,this[f].forEach((function(e){e.length=t[o](e.value,e.key),t[a]+=e.length}))),b(this)}},{key:"length",get:function(){return this[a]}},{key:"itemCount",get:function(){return this[f].length}},{key:"rforEach",value:function(e,t){t=t||this;for(var n=this[f].tail;null!==n;){var r=n.prev;_(this,e,n,t),n=r}}},{key:"forEach",value:function(e,t){t=t||this;for(var n=this[f].head;null!==n;){var r=n.next;_(this,e,n,t),n=r}}},{key:"keys",value:function(){return this[f].toArray().map((function(e){return e.key}))}},{key:"values",value:function(){return this[f].toArray().map((function(e){return e.value}))}},{key:"reset",value:function(){var e=this;this[c]&&this[f]&&this[f].length&&this[f].forEach((function(t){return e[c](t.key,t.value)})),this[d]=new Map,this[f]=new r,this[a]=0}},{key:"dump",value:function(){var e=this;return this[f].map((function(t){return!y(e,t)&&{k:t.key,v:t.value,e:t.now+(t.maxAge||0)}})).toArray().filter((function(e){return e}))}},{key:"dumpLru",value:function(){return this[f]}},{key:"set",value:function(e,t,n){if((n=n||this[u])&&"number"!=typeof n)throw new TypeError("maxAge must be a number");var r=n?Date.now():0,s=this[o](t,e);if(this[d].has(e)){if(s>this[i])return x(this,this[d].get(e)),!1;var h=this[d].get(e).value;return this[c]&&(this[l]||this[c](e,h.value)),h.now=r,h.maxAge=n,h.value=t,this[a]+=s-h.length,h.length=s,this.get(e),b(this),!0}var p=new w(e,t,s,r,n);return p.length>this[i]?(this[c]&&this[c](e,t),!1):(this[a]+=p.length,this[f].unshift(p),this[d].set(e,this[f].head),b(this),!0)}},{key:"has",value:function(e){if(!this[d].has(e))return!1;var t=this[d].get(e).value;return!y(this,t)}},{key:"get",value:function(e){return m(this,e,!0)}},{key:"peek",value:function(e){return m(this,e,!1)}},{key:"pop",value:function(){var e=this[f].tail;return e?(x(this,e),e.value):null}},{key:"del",value:function(e){x(this,this[d].get(e))}},{key:"load",value:function(e){this.reset();for(var t=Date.now(),n=e.length-1;n>=0;n--){var r=e[n],i=r.e||0;if(0===i)this.set(r.k,r.v);else{var a=i-t;a>0&&this.set(r.k,r.v,a)}}}},{key:"prune",value:function(){var e=this;this[d].forEach((function(t,n){return m(e,n,!1)}))}}]),e}()},function(e,t,n){var r=n(32),i=n(89),a=n(90),o=a.re,s=a.t;e.exports=function(e,t){if(e instanceof r)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;var n=null;if((t=t||{}).rtl){for(var a;(a=o[s.COERCERTL].exec(e))&&(!n||n.index+n[0].length!==e.length);)n&&a.index+a[0].length===n.index+n[0].length||(n=a),o[s.COERCERTL].lastIndex=a.index+a[1].length+a[2].length;o[s.COERCERTL].lastIndex=-1}else n=e.match(o[s.COERCE]);return null===n?null:i("".concat(n[2],".").concat(n[3]||"0",".").concat(n[4]||"0"),t)}},function(e,t,n){var r=n(144);e.exports=function(e,t){return e.sort((function(e,n){return r(n,e,t)}))}},function(e,t,n){var r=n(144);e.exports=function(e,t){return e.sort((function(e,n){return r(e,n,t)}))}},function(e,t,n){var r=n(48);e.exports=function(e,t){return r(e,t,!0)}},function(e,t,n){var r=n(48);e.exports=function(e,t,n){return r(t,e,n)}},function(e,t,n){var r=n(89);e.exports=function(e,t){var n=r(e,t);return n&&n.prerelease.length?n.prerelease:null}},function(e,t,n){var r=n(32);e.exports=function(e,t){return new r(e,t).patch}},function(e,t,n){var r=n(32);e.exports=function(e,t){return new r(e,t).minor}},function(e,t,n){var r=n(32);e.exports=function(e,t){return new r(e,t).major}},function(e,t,n){var r=n(89),i=n(145);e.exports=function(e,t){if(i(e,t))return null;var n=r(e),a=r(t),o=n.prerelease.length||a.prerelease.length,s=o?"pre":"",u=o?"prerelease":"";for(var c in n)if(("major"===c||"minor"===c||"patch"===c)&&n[c]!==a[c])return s+c;return u}},function(e,t,n){var r=n(32);e.exports=function(e,t,n,i){"string"==typeof n&&(i=n,n=void 0);try{return new r(e,n).inc(t,i).version}catch(e){return null}}},function(e,t,n){var r=n(89);e.exports=function(e,t){var n=r(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null}},function(e,t,n){var r=n(89);e.exports=function(e,t){var n=r(e,t);return n?n.version:null}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=i(n(88)),o=n(64),s=n(46);t.barchart=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(this,void 0,void 0,m().mark((function r(){var i,l,f,d,h,p,v,g,y,b,x,w,_,k,E;return m().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=s.getDrawArea(e),l=t,f=Object.assign({},u,n),!c.has(i)){r.next=10;break}if(d=c.get(i),!s.shallowEquals(f,d.lastOptions)){r.next=10;break}return r.next=6,s.nextFrame();case 6:return h=d.view,p=h.changeset().remove((function(){return!0})).insert(l),r.next=9,h.change("values",p).runAsync();case 9:return r.abrupt("return",void r.sent);case 10:return v=f.xLabel,g=f.yLabel,y=f.xType,b=f.yType,x=null,null!=v&&(x={title:v}),_=null,null!=g&&(_={title:g}),w=null!=f.color?Array.isArray(f.color)?{field:"index",type:"nominal",scale:{range:f.color}}:{value:f.color}:{value:"#4C78A0"},k={width:f.width||o.getDefaultWidth(i),height:f.height||o.getDefaultHeight(i),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:f.fontSize,titleFontSize:f.fontSize},text:{fontSize:f.fontSize},legend:{labelFontSize:f.fontSize,titleFontSize:f.fontSize}},data:{values:l,name:"values"},mark:{type:"bar",tooltip:!0},encoding:{x:{field:"index",type:y,axis:x},y:{field:"value",type:b,axis:_},color:w}},r.next=18,s.nextFrame();case 18:return r.next=20,a.default(i,k,{actions:!1,mode:"vega-lite",defaultStyle:!1});case 20:E=r.sent,c.set(i,{view:E.view,lastOptions:f});case 22:case"end":return r.stop()}}),r)})))};var u={xLabel:"",yLabel:"",xType:"ordinal",yType:"quantitative",fontSize:11},c=new Map},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(25),i=n(103),a=n(33),o=n(74);function s(e){i.env().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}t.enableProdMode=function(){i.env().set("PROD",!0)},t.enableDebugMode=function(){i.env().set("DEBUG",!0)},t.disableDeprecationWarnings=function(){i.env().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")},t.deprecationWarn=s,a.setDeprecationWarningFn(s),t.disposeVariables=function(){r.ENGINE.disposeVariables()},t.engine=function(){return r.ENGINE},t.memory=function(){return r.ENGINE.memory()},t.profile=function(e){return r.ENGINE.profile(e)},t.tidy=function(e,t){return r.ENGINE.tidy(e,t)},t.dispose=function(e){o.getTensorsInContainer(e).forEach((function(e){return e.dispose()}))},t.keep=function(e){return r.ENGINE.keep(e)},t.time=function(e){return r.ENGINE.time(e)},t.setBackend=function(e){return r.ENGINE.setBackend(e)},t.ready=function(){return r.ENGINE.ready()},t.getBackend=function(){return r.ENGINE.backendName},t.removeBackend=function(e){r.ENGINE.removeBackend(e)},t.findBackend=function(e){return r.ENGINE.findBackend(e)},t.findBackendFactory=function(e){return r.ENGINE.findBackendFactory(e)},t.registerBackend=function(e,t,n){return void 0===n&&(n=1),r.ENGINE.registerBackend(e,t,n)},t.backend=function(){return r.ENGINE.backend},t.setPlatform=function(e,t){i.env().setPlatform(e,t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(350);t.warnDeprecation=function(){r.deprecationWarn("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")},t.xAs4D=function(e){return 0===e.rank||1===e.rank?e.as4D(1,1,1,e.size):2===e.rank?e.as4D(1,1,e.shape[0],e.shape[1]):3===e.rank?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(25),i=n(29),a=n(21),o=n(351),s=n(28);function u(e,t,n,s,u,l){null==l&&(l=.001);var f,d,h=i.convertToTensor(e,"x","batchNorm"),p=i.convertToTensor(t,"mean","batchNorm"),m=i.convertToTensor(n,"variance","batchNorm");null!=u&&(f=i.convertToTensor(u,"scale","batchNorm")),null!=s&&(d=i.convertToTensor(s,"offset","batchNorm")),a.assert(p.rank===m.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),a.assert(null==d||p.rank===d.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),a.assert(null==f||p.rank===f.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var v={x:h,scale:f,offset:d,mean:p,variance:m},g={varianceEpsilon:l};return r.ENGINE.runKernelFunc((function(e,t){var n=o.xAs4D(h),r=e.batchNormalization(n,c(p),c(m),l,c(f),c(d));return t([h,p,m,f]),r}),v,null,"FusedBatchNorm",g).reshape(h.shape)}function c(e){return null==e?null:0===e.rank?e.as1D():1===e.rank?e:2===e.rank?e.as4D(1,1,e.shape[0],e.shape[1]):3===e.rank?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}t.batchNormalization=s.op({batchNormalization_:function(e,t,n,r,i,a){return void 0===r&&(r=.001),o.warnDeprecation(),u(e,t,n,a,i,r)}}),t.batchNorm=s.op({batchNorm_:u})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(352);n(33).Tensor.prototype.batchNorm=function(e,t,n,i,a){return r.batchNorm(this,e,t,n,i,a)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(25),i=n(73),a=n(29),o=n(28);t.pad=o.op({pad_:function(e,t,n){void 0===n&&(n=0);var o=a.convertToTensor(e,"x","pad");if(0===o.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var s={paddings:t,constantValue:n},u={x:o};return r.ENGINE.runKernelFunc((function(e,r){return r([o]),e.pad(o,t,n)}),u,null,i.PadV2,s)}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(354);n(33).Tensor.prototype.pad=function(e,t){return r.pad(this,e,t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(25),i=n(29),a=n(21),o=n(28);t.transpose=o.op({transpose_:function(e,t){var n=i.convertToTensor(e,"x","transpose");if(null==t&&(t=n.shape.map((function(e,t){return t})).reverse()),a.assert(n.rank===t.length,(function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+t+"."})),t.forEach((function(e){a.assert(e>=0&&e<n.rank,(function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+t}))})),n.rank<=1)return n.clone();var o={perm:t};return r.ENGINE.runKernelFunc((function(e){return e.transpose(n,t)}),{x:n},null,"Transpose",o)}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(356);n(33).Tensor.prototype.transpose=function(e){return r.transpose(this,e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(25),i=n(73),a=n(29),o=n(28);t.oneHot=o.op({oneHot_:function(e,t,n,o){if(void 0===n&&(n=1),void 0===o&&(o=0),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var s=a.convertToTensor(e,"indices","oneHot","int32"),u=s.shape.concat([t]),c={indices:s=s.flatten()},l={depth:t,onValue:n,offValue:o};return r.ENGINE.runKernelFunc((function(e,r){return r([s]),e.oneHot(s,t,n,o)}),c,null,i.OneHot,l).reshape(u)}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(358);n(33).Tensor.prototype.oneHot=function(e,t,n){return void 0===t&&(t=1),void 0===n&&(n=0),r.oneHot(this,e,t,n)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(25),i=n(73),a=n(29),o=n(21),s=n(28);t.tile=s.op({tile_:function(e,t){var n=a.convertToTensor(e,"x","tile",null);o.assert(n.rank===t.length,(function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+t+"."}));var s=[n],u={x:n},c={reps:t};return r.ENGINE.runKernelFunc((function(e,r){var i=e.tile(n,t);return r([n]),i}),u,null,i.Tile,c,s)}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(360);n(33).Tensor.prototype.tile=function(e){return r.tile(this,e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(25),i=n(73),a=n(74),o=n(29),s=n(147),u=n(28),c=n(91);t.squaredDifference=u.op({squaredDifference_:function(e,t){var n,u=o.convertToTensor(e,"a","squaredDifference"),l=o.convertToTensor(t,"b","squaredDifference");n=a.makeTypesMatch(u,l),u=n[0],l=n[1],s.assertAndGetBroadcastShape(u.shape,l.shape);var f={a:u,b:l},d=[u,l];return r.ENGINE.runKernelFunc((function(e,t){var n=e.squaredDifference(u,l);return t([u,l]),n}),f,(function(e,t){var n=t[0],r=t[1],i=c.scalar(2);return{a:function(){return e.mul(n.sub(r).mul(i))},b:function(){return e.mul(r.sub(n).mul(i))}}}),i.SquaredDifference,{},d,[])}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(362);n(33).Tensor.prototype.squaredDifference=function(e){return r.squaredDifference(this,e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(21);t.assertParamsConsistent=function(e,t){var n=e[0].length;e.forEach((function(e,t){r.assert(e.length===n,(function(){return"Error in concat"+n+"D: rank of tensors["+t+"] must be the same as the rank of the rest ("+n+")"}))})),r.assert(t>=0&&t<n,(function(){return"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+"."}));var i=e[0];e.forEach((function(e,a){for(var o=0;o<n;o++)r.assert(o===t||e[o]===i[o],(function(){return"Error in concat"+n+"D: Shape of tensors["+a+"] ("+e+") does not match the shape of the rest ("+i+") along the non-concatenated axis "+a+"."}))}))},t.computeOutShape=function(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(25),i=n(29),a=n(21),o=n(21),s=n(364),u=n(28),c=n(91);t.concat=u.op({concat_:function(e,n){void 0===n&&(n=0),a.assert(e.length>=1,(function(){return"Pass at least one tensor to concat"}));var u=i.convertToTensorArray(e,"tensors","concat");"complex64"===u[0].dtype&&u.forEach((function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+e.dtype+". ")})),n=o.parseAxisParam(n,u[0].shape)[0];var l=s.computeOutShape(u.map((function(e){return e.shape})),n);if(0===a.sizeFromShape(l))return c.tensor([],l);if(1===(u=u.filter((function(e){return e.size>0}))).length)return u[0];var f=u.map((function(e){return e.shape}));s.assertParamsConsistent(f,n);var d=u,h={axis:n};return r.ENGINE.runKernelFunc((function(e){return e.concat(u,n)}),d,(function(e){var r=f.map((function(e){return e[n]}));return t.split(e,r,n).map((function(e){return function(){return e}}))}),"Concat",h)}}),t.concat1d=u.op({concat1d_:function(e){return t.concat(e,0)}}),t.concat2d=u.op({concat2d_:function(e,n){return t.concat(e,n)}}),t.concat3d=u.op({concat3d_:function(e,n){return t.concat(e,n)}}),t.concat4d=u.op({concat4d_:function(e,n){return t.concat(e,n)}}),t.split=u.op({split_:function(e,n,s){void 0===s&&(s=0);var u,c=i.convertToTensor(e,"x","split");return s=o.parseAxisParam(s,c.shape)[0],"number"==typeof n?(a.assert(c.shape[s]%n==0,(function(){return"Number of splits must evenly divide the axis."})),u=new Array(n).fill(c.shape[s]/n)):(a.assert(c.shape[s]===n.reduce((function(e,t){return e+t})),(function(){return"The sum of sizes must match the size of the axis dimension."})),u=n),r.ENGINE.runKernelFunc((function(e){return e.split(c,u,s)}),{$x:c},(function(e){return{$x:function(){return t.concat(e,s)}}}))}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(21);function i(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function a(e,t,n){for(var r=e.length+t.length,i=[],a=0,o=0,s=0;s<r;s++)-1===n.indexOf(s)?i.push(e[a++]):i.push(t[o++]);return i}t.axesAreInnerMostDims=i,t.combineLocations=a,t.computeOutAndReduceShapes=function(e,t){for(var n=[],r=e.length,i=0;i<r;i++)-1===t.indexOf(i)&&n.push(e[i]);return[n,t.map((function(t){return e[t]}))]},t.expandShapeToKeepDim=function(e,t){return a(e,t.map((function(e){return 1})),t)},t.assertAxesAreInnerMostDims=function(e,t,n){r.assert(i(t,n),(function(){return e+" supports only inner-most axes for now. Got axes "+t+" and rank-"+n+" input."}))},t.getAxesPermutation=function(e,t){if(i(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((function(e){return n.push(e)})),n},t.getUndoAxesPermutation=function(e){return e.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))},t.getInnerMostAxes=function(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(25),o=n(33),s=n(29),u=n(21),c=n(366),l=n(365),f=n(28);t.buffer=function(e,t,n){return void 0===t&&(t="float32"),t=t||"float32",u.assertNonNegativeIntegerDimensions(e),new o.TensorBuffer(e,t,n)},t.print=function(e,t){void 0===t&&(t=!1),console.log(e.toString(t))},t.batchToSpaceND=f.op({batchToSpaceND_:function(e,t,n){var r=s.convertToTensor(e,"x","batchToSpaceND"),i=t.reduce((function(e,t){return e*t}));return u.assert(r.rank>=1+t.length,(function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+t.length})),u.assert(n.length===t.length,(function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+t.length})),u.assert(r.shape[0]%i==0,(function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+i})),a.ENGINE.runKernelFunc((function(e){return e.batchToSpaceND(r,t,n)}),{$x:r},(function(e){return{$x:function(){return e.spaceToBatchND(t,n)}}}))}}),t.cast=f.op({cast_:function(e,t){var n=s.convertToTensor(e,"x","cast");if(!u.isValidDtype(t))throw new Error("Failed to cast to unknown dtype "+t);if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={dtype:t};return a.ENGINE.runKernelFunc((function(e){return e.cast(n,t)}),{x:n},(function(e){return{x:function(){return e.clone()}}}),"Cast",r)}}),t.cumsum=f.op({cumsum_:function(e,t,n,r){void 0===t&&(t=0),void 0===n&&(n=!1),void 0===r&&(r=!1);var i=s.convertToTensor(e,"x","cumsum");t|=0;var o=c.getAxesPermutation([t],i.rank),u=i;null!=o&&(u=i.transpose(o));var l=c.getInnerMostAxes(1,i.rank)[0],f=a.ENGINE.runKernelFunc((function(e){return e.cumsum(u,l,n,r)}),{permutedX:u},(function(e){return{permutedX:function(){return e.cumsum(t,n,!r)}}}));return null!=o&&(f=f.transpose(o)),f}}),t.depthToSpace=f.op({depthToSpace_:function(e,t,n){void 0===n&&(n="NHWC");var r=s.convertToTensor(e,"x","depthToSpace"),i="NHWC"===n?r.shape[1]:r.shape[2],o="NHWC"===n?r.shape[2]:r.shape[3],c="NHWC"===n?r.shape[3]:r.shape[1];return u.assert(i*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n      "+i+" and "+t+"  for depthToSpace with input shape\n      "+r.shape})),u.assert(o*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n      "+o+" and "+t+" for depthToSpace with input shape\n          "+r.shape})),u.assert(c%(t*t)==0,(function(){return"Dimension size must be evenly divisible by "+t*t+" but is "+c+" for depthToSpace with input shape "+r.shape})),a.ENGINE.runKernelFunc((function(e){return e.depthToSpace(r,t,n)}),{$x:r})}}),t.expandDims=f.op({expandDims_:function(e,n){void 0===n&&(n=0);var r=s.convertToTensor(e,"x","expandDims",null);u.assert(n<=r.rank,(function(){return"Axis must be <= rank of the tensor"}));var i=r.shape.slice();return n<0&&(u.assert(-(r.rank+1)<=n,(function(){return"Axis must be in the interval ["+-(r.rank+1)+", "+r.rank+"]"})),n=r.rank+n+1),i.splice(n,0,1),t.reshape(r,i)}}),t.reshape=f.op({reshape_:function(e,t){var n=s.convertToTensor(e,"x","reshape",null);t=u.inferFromImplicitShape(t,n.size),u.assert(n.size===u.sizeFromShape(t),(function(){return"new shape and old shape must have the same number of elements."}));var r={shape:t};return a.ENGINE.runKernelFunc((function(e){return e.reshape(n,t)}),{x:n},(function(e){return{x:function(){return e.reshape(n.shape)}}}),"Reshape",r)}}),t.spaceToBatchND=f.op({spaceToBatchND_:function(e,t,n){var r=s.convertToTensor(e,"x","spaceToBatchND");return u.assert(r.rank>=1+t.length,(function(){return"input rank "+r.rank+" should be > than [blockShape] "+t.length})),u.assert(n.length===t.length,(function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+t.length})),u.assert(r.shape.reduce((function(e,r,i){return i>0&&i<=t.length?e&&(r+n[i-1][0]+n[i-1][1])%t[i-1]==0:e}),!0),(function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+t.toString()})),a.ENGINE.runKernelFunc((function(e){return e.spaceToBatchND(r,t,n)}),{$x:r},(function(e){return{$x:function(){return e.batchToSpaceND(t,n)}}}))}}),t.squeeze=f.op({squeeze_:function(e,n){var r=s.convertToTensor(e,"x","squeeze");return t.reshape(r,u.squeezeShape(r.shape,n).newShape)}}),t.stack=f.op({stack_:function(e,t){void 0===t&&(t=0);var n=s.convertToTensorArray(e,"tensors","stack");if(u.assert(n.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),1===n.length)return n[0].expandDims(t);var r=n[0].rank,i=n[0].shape,a=n[0].dtype;u.assert(t<=r,(function(){return"Axis must be <= rank of the tensor"})),n.forEach((function(e){u.assertShapesMatch(i,e.shape,"All tensors passed to stack must have matching shapes")})),n.forEach((function(e){u.assert(a===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=n.map((function(e){return e.expandDims(t)}));return l.concat(o,t)}}),t.unstack=f.op({unstack_:function(e,n){void 0===n&&(n=0),n=n||0;var r=s.convertToTensor(e,"x","unstack");u.assert(n>=-r.shape.length&&n<r.shape.length,(function(){return"Axis = "+n+" is not in [-"+r.shape.length+", "+r.shape.length+")"})),n<0&&(n+=r.shape.length);var i={axis:n};return a.ENGINE.runKernelFunc((function(e){return e.unstack(r,n)}),{x:r},(function(e){return{x:function(){return t.stack(e,n)}}}),"Unpack",i)}}),t.setdiff1dAsync=function(e,t){return r(this,void 0,void 0,(function(){var n,r,a,c,l,f,d,h,p,m;return i(this,(function(i){switch(i.label){case 0:return n=s.convertToTensor(e,"x","setdiff1d"),r=s.convertToTensor(t,"y","setdiff1d"),u.assert(n.dtype===r.dtype,(function(){return"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."})),u.assert(1===n.rank,(function(){return"x should be 1D tensor, but got x ("+n.shape+")."})),u.assert(1===r.rank,(function(){return"y should be 1D tensor, but got y ("+r.shape+")."})),[4,n.data()];case 1:return a=i.sent(),[4,r.data()];case 2:for(c=i.sent(),l=new Set(c),f=0,p=0;p<a.length;p++)l.has(a[p])||f++;for(d=new o.TensorBuffer([f],n.dtype),h=new o.TensorBuffer([f],"int32"),p=0,m=0;p<a.length;p++)l.has(a[p])||(d.values[m]=a[p],h.values[m]=p,m++);return[2,[d.toTensor(),h.toTensor()]]}}))}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(367);t.whereImpl=function(e,t){for(var n=[],i=0;i<t.length;i++)t[i]&&n.push(i);var a=r.buffer(e,"int32"),o=r.buffer([n.length,e.length],"int32");for(i=0;i<n.length;i++){var s=a.indexToLoc(n[i]),u=i*e.length;o.values.set(s,u)}return o.toTensor()}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(368),o=n(25),s=n(29),u=n(21),c=n(147),l=n(28),f=n(91);t.logicalAnd=l.op({logicalAnd_:function(e,t){var n=s.convertToTensor(e,"a","logicalAnd","bool"),r=s.convertToTensor(t,"b","logicalAnd","bool");return c.assertAndGetBroadcastShape(n.shape,r.shape),o.ENGINE.runKernelFunc((function(e){return e.logicalAnd(n,r)}),{a:n,b:r},null,"LogicalAnd")}}),t.logicalNot=l.op({logicalNot_:function(e){var t=s.convertToTensor(e,"x","logicalNot","bool");return o.ENGINE.runKernelFunc((function(e){return e.logicalNot(t)}),{$x:t})}}),t.logicalOr=l.op({logicalOr_:function(e,t){var n=s.convertToTensor(e,"a","logicalOr","bool"),r=s.convertToTensor(t,"b","logicalOr","bool");return c.assertAndGetBroadcastShape(n.shape,r.shape),o.ENGINE.runKernelFunc((function(e){return e.logicalOr(n,r)}),{$a:n,$b:r})}}),t.logicalXor=l.op({logicalXor_:function(e,n){var r=s.convertToTensor(e,"a","logicalXor","bool"),i=s.convertToTensor(n,"b","logicalXor","bool");return c.assertAndGetBroadcastShape(r.shape,i.shape),t.logicalOr(e,n).logicalAnd(t.logicalAnd(e,n).logicalNot())}}),t.where=l.op({where_:function(e,t,n){var r=s.convertToTensor(t,"a","where"),i=s.convertToTensor(n,"b","where"),a=s.convertToTensor(e,"condition","where","bool");return u.assertShapesMatch(r.shape,i.shape,"Error in where: "),1===a.rank?u.assert(a.shape[0]===r.shape[0],(function(){return"The first dimension of `a` must match the size of `condition`."})):u.assertShapesMatch(a.shape,i.shape,"Error in where: "),o.ENGINE.runKernelFunc((function(e,t){var n=e.select(a,r,i);return t([a]),n}),{$condition:a,$a:r,$b:i},(function(e,t){var n=t[0];return{$condition:function(){return f.zerosLike(n).toFloat()},$a:function(){return e.mul(n.cast(e.dtype))},$b:function(){return e.mul(n.logicalNot().cast(e.dtype))}}}))}}),t.whereAsync=function(e){return r(this,void 0,void 0,(function(){var t,n,r;return i(this,(function(i){switch(i.label){case 0:return[4,(t=s.convertToTensor(e,"condition","whereAsync","bool")).data()];case 1:return n=i.sent(),r=a.whereImpl(t.shape,n),e!==t&&t.dispose(),[2,r]}}))}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(74),i=n(29),a=n(205),o=n(369),s=n(28),u=n(91);t.divNoNan=s.op({divNoNan_:function(e,t){var n,s=i.convertToTensor(e,"a","div"),c=i.convertToTensor(t,"b","div");s=(n=r.makeTypesMatch(s,c))[0],c=n[1];var l=a.div(s,c),f=u.zerosLike(l),d=c.equal(f);return o.where(d,f,l)}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(370);n(33).Tensor.prototype.divNoNan=function(e){return r.divNoNan(this,e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(25),i=n(29),a=n(21),o=n(28),s=n(91);t.abs=o.op({abs_:function(e){var t=i.convertToTensor(e,"x","abs");return"complex64"===t.dtype?r.ENGINE.runKernelFunc((function(e){return e.complexAbs(t)}),{$x:t}):r.ENGINE.runKernelFunc((function(e,n){var r=e.abs(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().step(-1))}}}),"Abs")}}),t.acos=o.op({acos_:function(e){var t=i.convertToTensor(e,"x","acos");return r.ENGINE.runKernelFunc((function(e,n){var r=e.acos(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(s.scalar(1).sub(n.toFloat().square()).sqrt()).neg()}}}))}}),t.acosh=o.op({acosh_:function(e){var t=i.convertToTensor(e,"x","acosh");return r.ENGINE.runKernelFunc((function(e,n){var r=e.acosh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(n.toFloat().square().sub(1).sqrt())}}}))}}),t.asin=o.op({asin_:function(e){var t=i.convertToTensor(e,"x","asin");return r.ENGINE.runKernelFunc((function(e,n){var r=e.asin(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(s.scalar(1).sub(n.toFloat().square()).sqrt())}}}))}}),t.asinh=o.op({asinh_:function(e){var t=i.convertToTensor(e,"x","asinh");return r.ENGINE.runKernelFunc((function(e,n){var r=e.asinh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(s.scalar(1).add(n.toFloat().square()).sqrt())}}}))}}),t.atan=o.op({atan_:function(e){var t=i.convertToTensor(e,"x","atan");return r.ENGINE.runKernelFunc((function(e,n){var r=e.atan(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().square().add(1))}}}))}}),t.atanh=o.op({atanh_:function(e){var t=i.convertToTensor(e,"x","atanh");return r.ENGINE.runKernelFunc((function(e,n){var r=e.atanh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(s.scalar(1).sub(n.toFloat().square()))}}}))}}),t.ceil=o.op({ceil_:function(e){var t=i.convertToTensor(e,"x","ceil");return r.ENGINE.runKernelFunc((function(e){return e.ceil(t)}),{$x:t},(function(e){return{$x:function(){return s.zerosLike(e)}}}))}}),t.clipByValue=o.op({clipByValue_:function(e,t,n){var o=i.convertToTensor(e,"x","clipByValue");a.assert(t<=n,(function(){return"Error in clip: min ("+t+") must be less than or equal to max ("+n+")."}));var u=[o],c={min:t,max:n};return r.ENGINE.runKernelFunc((function(e,r){var i=e.clip(o,t,n);return r([o]),i}),{x:o},(function(e,r){var i=r[0];return{x:function(){return e.where(i.greaterEqual(t).logicalAnd(i.lessEqual(n)),s.zerosLike(e))}}}),"ClipByValue",c,u)}}),t.cos=o.op({cos_:function(e){var t=i.convertToTensor(e,"x","cos"),n=[t];return r.ENGINE.runKernelFunc((function(e,n){var r=e.cos(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return n.toFloat().sin().neg().mul(e)}}}),"Cos",{},n)}}),t.cosh=o.op({cosh_:function(e){var t=i.convertToTensor(e,"x","cosh");return r.ENGINE.runKernelFunc((function(e,n){var r=e.cosh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return n.toFloat().sinh().mulStrict(e)}}}))}}),t.erf=o.op({erf_:function(e){var t=i.convertToTensor(e,"x","erf");return a.assert("int32"===t.dtype||"float32"===t.dtype,(function(){return"Input dtype must be `int32` or `float32`."})),"int32"===t.dtype&&(t=t.toFloat()),r.ENGINE.runKernelFunc((function(e,n){var r=e.erf(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}}))}}),t.exp=o.op({exp_:function(e){var t=i.convertToTensor(e,"x","exp");return r.ENGINE.runKernelFunc((function(e,n){var r=e.exp(t);return n([r]),r}),{x:t},(function(e,t){return{x:function(){return e.mulStrict(t[0])}}}),"Exp",{},[],[!0])}}),t.expm1=o.op({expm1_:function(e){var t=i.convertToTensor(e,"x","expm1");return r.ENGINE.runKernelFunc((function(e,n){var r=e.expm1(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.exp())}}}))}}),t.floor=o.op({floor_:function(e){var t=i.convertToTensor(e,"x","floor");return r.ENGINE.runKernelFunc((function(e){return e.floor(t)}),{$x:t},(function(e){return{$x:function(){return s.zerosLike(e)}}}))}}),t.log=o.op({log_:function(e){var t=i.convertToTensor(e,"x","log"),n=[t];return r.ENGINE.runKernelFunc((function(e,n){var r=e.log(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.div(n.toFloat())}}}),"Log",{},n)}}),t.log1p=o.op({log1p_:function(e){var t=i.convertToTensor(e,"x","log1p");return r.ENGINE.runKernelFunc((function(e,n){var r=e.log1p(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.add(1))}}}))}}),t.logSigmoid=o.op({logSigmoid_:function(e){var t=i.convertToTensor(e,"x","logSigmoid");return r.ENGINE.runKernelFunc((function(e,n){var r=e.softplus(t.neg()).neg();return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.neg().sigmoid())}}}))}}),t.neg=o.op({neg_:function(e){var t=i.convertToTensor(e,"x","neg"),n=[t];return r.ENGINE.runKernelFunc((function(e){return e.neg(t)}),{x:t},(function(e){return{x:function(){return e.neg()}}}),"Neg",{},n)}}),t.reciprocal=o.op({reciprocal_:function(e){var t=i.convertToTensor(e,"x","reciprocal");return r.ENGINE.runKernelFunc((function(e,n){var r=e.reciprocal(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.square().neg())}}}))}}),t.round=o.op({round_:function(e){var t=i.convertToTensor(e,"x","round");return r.ENGINE.runKernelFunc((function(e){return e.round(t)}),{$x:t},(function(e){return{$x:function(){return s.zerosLike(e)}}}))}}),t.rsqrt=o.op({rsqrt_:function(e){var t=i.convertToTensor(e,"x","rsqrt"),n=[t];return r.ENGINE.runKernelFunc((function(e,n){var r=e.rsqrt(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.div(n.pow(1.5).mul(2)).neg()}}}),"Rsqrt",{},n)}}),t.sigmoid=o.op({sigmoid_:function(e){var t=i.convertToTensor(e,"x","sigmoid");return r.ENGINE.runKernelFunc((function(e,n){var r=e.sigmoid(t);return n([r]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.mul(n.mul(s.scalar(1).sub(n)))}}}),"Sigmoid")}}),t.sign=o.op({sign_:function(e){var t=i.convertToTensor(e,"x","sign");return r.ENGINE.runKernelFunc((function(e){return e.sign(t)}),{$x:t},(function(e){return{$x:function(){return s.zerosLike(e)}}}))}}),t.isNaN=o.op({isNaN_:function(e){var t=i.convertToTensor(e,"x","isNaN");return r.ENGINE.runKernelFunc((function(e){return e.isNaN(t)}),{$x:t},(function(e){return{$x:function(){return s.zerosLike(e)}}}))}}),t.isInf=o.op({isInf_:function(e){var t=i.convertToTensor(e,"x","isInf");return r.ENGINE.runKernelFunc((function(e){return e.isInf(t)}),{$x:t},(function(e){return{$x:function(){return s.zerosLike(e)}}}))}}),t.isFinite=o.op({isFinite_:function(e){var t=i.convertToTensor(e,"x","isFinite");return r.ENGINE.runKernelFunc((function(e){return e.isFinite(t)}),{$x:t},(function(e){return{$x:function(){return s.zerosLike(e)}}}))}}),t.sin=o.op({sin_:function(e){var t=i.convertToTensor(e,"x","sin"),n=[t];return r.ENGINE.runKernelFunc((function(e,n){var r=e.sin(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return n.toFloat().cos().mul(e)}}}),"Sin",{},n)}}),t.sinh=o.op({sinh_:function(e){var t=i.convertToTensor(e,"x","sinh");return r.ENGINE.runKernelFunc((function(e,n){var r=e.sinh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return n.toFloat().cosh().mulStrict(e)}}}))}}),t.softplus=o.op({softplus_:function(e){var t=i.convertToTensor(e,"x","softplus");return r.ENGINE.runKernelFunc((function(e,n){var r=e.softplus(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.sigmoid())}}}))}}),t.sqrt=o.op({sqrt_:function(e){var t=i.convertToTensor(e,"x","sqrt");return r.ENGINE.runKernelFunc((function(e,n){var r=e.sqrt(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().sqrt().mul(2))}}}))}}),t.step=o.op({step_:function(e,t){void 0===t&&(t=0);var n=i.convertToTensor(e,"x","step");return r.ENGINE.runKernelFunc((function(e){return e.step(n,t)}),{$x:n},(function(e){return{$x:function(){return s.zerosLike(e)}}}))}}),t.tan=o.op({tan_:function(e){var t=i.convertToTensor(e,"x","tan");return r.ENGINE.runKernelFunc((function(e,n){var r=e.tan(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.cos().square())}}}))}}),t.tanh=o.op({tanh_:function(e){var t=i.convertToTensor(e,"x","tanh");return r.ENGINE.runKernelFunc((function(e,n){var r=e.tanh(t);return n([r]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return s.scalar(1).sub(n.square()).mulStrict(e)}}}),"Tanh",{},null,[!0])}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(25),i=n(29),a=n(21),o=n(28);t.complex=o.op({complex_:function(e,t){var n=i.convertToTensor(e,"real","complex"),o=i.convertToTensor(t,"imag","complex");return a.assertShapesMatch(n.shape,o.shape,"real and imag shapes, "+n.shape+" and "+o.shape+", must match in call to tf.complex()."),r.ENGINE.runKernelFunc((function(e){return e.complex(n,o)}),{$real:n,$imag:o})}}),t.real=o.op({real_:function(e){var t=i.convertToTensor(e,"input","real");return r.ENGINE.runKernelFunc((function(e){return e.real(t)}),{$input:t})}}),t.imag=o.op({imag_:function(e){var t=i.convertToTensor(e,"input","imag");return r.ENGINE.runKernelFunc((function(e){return e.imag(t)}),{$input:t})}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(25),i=n(74),a=n(29),o=n(21),s=n(206),u=n(147),c=n(28),l=n(91),f=n(372);t.addStrict=c.op({addStrict_:function(e,t){var n=a.convertToTensor(e,"a","addStrict"),r=a.convertToTensor(t,"b","addStrict");return o.assertShapesMatch(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),t.atan2=c.op({atan2_:function(e,t){var n,o=a.convertToTensor(e,"a","atan2"),c=a.convertToTensor(t,"b","atan2");n=i.makeTypesMatch(o,c),o=n[0],c=n[1];var l=u.assertAndGetBroadcastShape(o.shape,c.shape);return r.ENGINE.runKernelFunc((function(e,t){var n=e.atan2(o,c);return t([o,c]),n}),{$a:o,$b:c},(function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=s.add(n.square(),r.square()),i=e.mul(r.div(t)),a=u.getReductionAxes(n.shape,l);return a.length>0&&(i=i.sum(a)),i.reshape(n.shape)},$b:function(){var t=s.add(n.square(),r.square()),i=f.neg(e.mul(n.div(t))),a=u.getReductionAxes(r.shape,l);return a.length>0&&(i=i.sum(a)),i.reshape(r.shape)}}}))}}),t.divStrict=c.op({divStrict_:function(e,t){var n=a.convertToTensor(e,"a","div"),r=a.convertToTensor(t,"b","div");return o.assertShapesMatch(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),t.floorDiv=c.op({floorDiv_:function(e,t){var n,o=a.convertToTensor(e,"a","floorDiv"),s=a.convertToTensor(t,"b","floorDiv");n=i.makeTypesMatch(o,s),o=n[0],s=n[1];var c=u.assertAndGetBroadcastShape(o.shape,s.shape);return r.ENGINE.runKernelFunc((function(e,t){var n=e.floorDiv(o,s);return t([o,s]),n}),{a:o,b:s},(function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.div(r.toFloat()),i=u.getReductionAxes(n.shape,c);return i.length>0?t.sum(i).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),i=u.getReductionAxes(r.shape,c);i.length>0&&(t=t.sum(i).reshape(r.shape));var a=r.square();return t.div(a.toFloat()).neg()}}}),"FloorDiv")}}),t.maximum=c.op({maximum_:function(e,t){var n,o=a.convertToTensor(e,"a","maximum"),s=a.convertToTensor(t,"b","maximum");return n=i.makeTypesMatch(o,s),o=n[0],s=n[1],"bool"===o.dtype&&(o=o.toInt(),s=s.toInt()),u.assertAndGetBroadcastShape(o.shape,s.shape),r.ENGINE.runKernelFunc((function(e,t){var n=e.maximum(o,s);return t([o,s]),n}),{a:o,b:s},(function(e,t){var n=t[0],r=t[1];return{a:function(){return e.mul(n.greaterEqual(r).toFloat())},b:function(){return e.mul(n.less(r).toFloat())}}}),"Maximum")}}),t.maximumStrict=c.op({maximumStrict_:function(e,t){var n=a.convertToTensor(e,"a","maximumStrict"),r=a.convertToTensor(t,"b","maximumStrict");return o.assertShapesMatch(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),t.minimum=c.op({minimum_:function(e,t){var n,o=a.convertToTensor(e,"a","minimum"),s=a.convertToTensor(t,"b","minimum");return n=i.makeTypesMatch(o,s),o=n[0],s=n[1],"bool"===o.dtype&&(o=o.toInt(),s=s.toInt()),u.assertAndGetBroadcastShape(o.shape,s.shape),r.ENGINE.runKernelFunc((function(e,t){var n=e.minimum(o,s);return t([o,s]),n}),{a:o,b:s},(function(e,t){var n=t[0],r=t[1];return{a:function(){return e.mul(n.lessEqual(r).toFloat())},b:function(){return e.mul(n.greater(r).toFloat())}}}),"Minimum")}}),t.minimumStrict=c.op({minimumStrict_:function(e,t){var n=a.convertToTensor(e,"a","minimumStrict"),r=a.convertToTensor(t,"b","minimumStrict");return o.assertShapesMatch(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),t.mod=c.op({mod_:function(e,t){var n,o=a.convertToTensor(e,"a","mod"),s=a.convertToTensor(t,"b","mod");n=i.makeTypesMatch(o,s),o=n[0],s=n[1];var c=u.assertAndGetBroadcastShape(o.shape,s.shape);return r.ENGINE.runKernelFunc((function(e,t){var n=e.mod(o,s);return t([o,s]),n}),{$a:o,$b:s},(function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=u.getReductionAxes(n.shape,c);return t.length>0?e.sum(t).reshape(n.shape):e},$b:function(){var t=e.mul(n.div(r).floor().neg()),i=u.getReductionAxes(r.shape,c);return i.length>0?t.sum(i).reshape(r.shape):t}}}))}}),t.modStrict=c.op({modStrict_:function(e,t){var n=a.convertToTensor(e,"a","modStrict"),r=a.convertToTensor(t,"b","modStrict");return o.assertShapesMatch(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),t.mul=c.op({mul_:function(e,t){var n,o=a.convertToTensor(e,"a","mul"),s=a.convertToTensor(t,"b","mul");n=i.makeTypesMatch(o,s),o=n[0],s=n[1];var c=u.assertAndGetBroadcastShape(o.shape,s.shape);return r.ENGINE.runKernelFunc((function(e,t){var n=e.multiply(o,s);return t([o,s]),n}),{a:o,b:s},(function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.mul(r.toFloat()),i=u.getReductionAxes(n.shape,c);return i.length>0?t.sum(i).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),i=u.getReductionAxes(r.shape,c);return i.length>0?t.sum(i).reshape(r.shape):t}}}),"Mul")}}),t.mulStrict=c.op({mulStrict_:function(e,t){var n=a.convertToTensor(e,"a","mul"),r=a.convertToTensor(t,"b","mul");return o.assertShapesMatch(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),t.pow=c.op({pow_:function(e,t){var n,o=a.convertToTensor(e,"base","pow"),s=a.convertToTensor(t,"exp","pow");n=i.makeTypesMatch(o,s),o=n[0],s=n[1];var c=u.assertAndGetBroadcastShape(o.shape,s.shape),f=[o,s];return r.ENGINE.runKernelFunc((function(e,t){var n=e.pow(o,s);return t([o,s,n]),n}),{a:o,b:s},(function(e,t){var n=t[0],r=t[1],i=t[2];return{a:function(){var t=r.toFloat(),i=e.mul(t.mul(n.pow(t.sub(l.scalar(1))))),a=u.getReductionAxes(n.shape,c);return a.length>0&&(i=i.sum(a)),i.reshape(n.shape)},b:function(){var t=n.greater(0),a=n.log().where(t,l.zerosLike(n)),o=e.mul(i.mul(a)),s=u.getReductionAxes(r.shape,c);return s.length>0&&(o=o.sum(s)),o.reshape(r.shape)}}}),"Pow",{},f,[!0])}}),t.powStrict=c.op({powStrict_:function(e,t){return o.assertShapesMatch(e.shape,t.shape,"Error in powStrict: "),e.pow(t)}}),t.squaredDifferenceStrict=c.op({squaredDifferenceStrict_:function(e,t){var n=a.convertToTensor(e,"a","squaredDifferenceStrict"),r=a.convertToTensor(t,"b","squaredDifferenceStrict");return o.assertShapesMatch(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),t.sub=c.op({sub_:function(e,t){var n,o=a.convertToTensor(e,"a","sub"),s=a.convertToTensor(t,"b","sub");n=i.makeTypesMatch(o,s),o=n[0],s=n[1];var c=u.assertAndGetBroadcastShape(o.shape,s.shape);return r.ENGINE.runKernelFunc((function(e){return e.subtract(o,s)}),{a:o,b:s},(function(e){return{a:function(){var t=e,n=u.getReductionAxes(o.shape,c);return n.length>0&&(t=t.sum(n)),t.reshape(o.shape)},b:function(){var t=e,n=u.getReductionAxes(s.shape,c);return n.length>0&&(t=t.sum(n)),t.neg().reshape(s.shape)}}}),"Sub")}}),t.subStrict=c.op({subStrict_:function(e,t){var n=a.convertToTensor(e,"a","subStrict"),r=a.convertToTensor(t,"b","subStrict");return o.assertShapesMatch(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(205);n(33).Tensor.prototype.div=function(e){return r.div(this,e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(25),i=n(73),a=n(29),o=n(28);t.broadcastTo=o.op({broadcastTo_:function(e,t){var n=a.convertToTensor(e,"broadcastTo","x"),o=n.shape;if(t.some((function(e){return!(e>0)||e%1!=0})))throw new Error("broadcastTo(): Invalid broadcast shape ["+t+"].");if(t.length<n.rank)throw new Error("broadcastTo(): shape.length="+t.length+" < input.rank="+n.rank+".");if(t.length>n.rank){for(var s=n.shape.slice();s.length<t.length;)s.unshift(1);n=n.reshape(s)}for(var u=n.shape,c=Array.from(t),l=t.length-1;l>=0;l--)if(u[l]===t[l])c[l]=1;else if(1!==n.shape[l])throw new Error("broadcastTo(): ["+o+"] cannot be broadcast to ["+t+"].");var f=c.map((function(e,t){return e>1?t:-1})).filter((function(e){return e>=0}));if(0===f.length)return n.clone();var d={x:n},h={shape:t,inputShape:u};return r.ENGINE.runKernelFunc((function(e){return e.tile(n,c)}),d,(function(e){return{x:function(){return e.sum(f,!0)}}}),i.BroadcastTo,h)}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(376);n(33).Tensor.prototype.broadcastTo=function(e){return r.broadcastTo(this,e)}},function(e,t,n){"use strict";var r,i,a,o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(t.Rank||(t.Rank={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(r||(r={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(i||(i={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(a||(a={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(o||(o={}));var s={float32:a,int32:r,bool:i,complex64:o};function u(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast "+e+" with "+t)}return s[e][t]}t.upcastType=u,t.sumOutType=function(e){return u(e,"int32")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(21),i=20,a=3,o=7;function s(e,t,n){var i;return i=Array.isArray(e)?parseFloat(e[0].toFixed(o))+" + "+parseFloat(e[1].toFixed(o))+"j":r.isString(e)?"'"+e+"'":"bool"===n?u(e):parseFloat(e.toFixed(o)).toString(),r.rightPad(i,t)}function u(e){return 0===e?"false":"true"}function c(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}t.tensorToString=function(e,t,n,o){var l=r.computeStrides(t),f=function(e,t,n,i){var a=r.sizeFromShape(t),o=i[i.length-1],u=new Array(o).fill(0),l=t.length,f="complex64"===n?c(e):e;if(l>1)for(var d=0;d<a/o;d++)for(var h=d*o,p=0;p<o;p++)u[p]=Math.max(u[p],s(f[h+p],0,n).length);return u}(e,t,n,l),d=t.length,h=function e(t,n,r,o,l,f){void 0===f&&(f=!0);var d="complex64"===r?2:1,h=n[0],p=n.length;if(0===p)return"complex64"===r?[s(c(t)[0],0,r)]:"bool"===r?[u(t[0])]:[t[0].toString()];if(1===p){if(h>i){var m=a*d,v=Array.from(t.slice(0,m)),g=Array.from(t.slice((h-a)*d,h*d));return"complex64"===r&&(v=c(v),g=c(g)),["["+v.map((function(e,t){return s(e,l[t],r)})).join(", ")+", ..., "+g.map((function(e,t){return s(e,l[h-a+t],r)})).join(", ")+"]"]}return["["+("complex64"===r?c(t):Array.from(t)).map((function(e,t){return s(e,l[t],r)})).join(", ")+"]"]}var y=n.slice(1),b=o.slice(1),x=o[0]*d,w=[];if(h>i){for(var _=0;_<a;_++){var k=(E=_*x)+x;w.push.apply(w,e(t.slice(E,k),y,r,b,l,!1))}for(w.push("..."),_=h-a;_<h;_++)k=(E=_*x)+x,w.push.apply(w,e(t.slice(E,k),y,r,b,l,_===h-1))}else for(_=0;_<h;_++){var E;k=(E=_*x)+x,w.push.apply(w,e(t.slice(E,k),y,r,b,l,_===h-1))}var S=2===p?",":"";for(w[0]="["+w[0]+S,_=1;_<w.length-1;_++)w[_]=" "+w[_]+S;var C=",\n";for(_=2;_<p;_++)C+="\n";return w[w.length-1]=" "+w[w.length-1]+"]"+(f?"":C),w}(e,t,n,l,f),p=["Tensor"];return o&&(p.push("  dtype: "+n),p.push("  rank: "+d),p.push("  shape: ["+t+"]"),p.push("  values:")),p.push(h.map((function(e){return"    "+e})).join("\n")),p.join("\n")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(21);t.getFilteredNodesXToY=function(e,t,n){for(var r={},i={},a=0;a<t.length;a++)r[t[a].id]=!0;for(a=0;a<e.length;a++){var o=(p=e[a]).inputs;for(var s in o){for(var u=o[s],c=!1,l=0;l<t.length;l++)if(r[u.id]){p.outputs.forEach((function(e){return r[e.id]=!0})),c=!0,i[p.id]=!0;break}if(c)break}}var f={};f[n.id]=!0;var d={};for(a=e.length-1;a>=0;a--)for(o=(p=e[a]).inputs,l=0;l<p.outputs.length;l++)if(f[p.outputs[l].id]){for(var s in o)f[o[s].id]=!0,d[p.id]=!0;break}var h=[];for(a=0;a<e.length;a++){var p;if(i[(p=e[a]).id]&&d[p.id]){var m={};for(var s in p.inputs){var v=p.inputs[s];r[v.id]&&(m[s]=v)}var g=Object.assign({},p);g.inputs=m,g.outputs=p.outputs,h.push(g)}}return h},t.backpropagateGradients=function(e,t,n){for(var i=function(i){var a=t[i],o=[];if(a.outputs.forEach((function(t){var n=e[t.id];null!=n?o.push(n):o.push(null)})),null==a.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+a.kernelName+".");var s=a.gradient(o),u=function(t){if(!(t in s))throw new Error("Cannot backprop through input "+t+". Available gradients found: "+Object.keys(s)+".");var i=n((function(){return s[t]()}));if("float32"!==i.dtype)throw new Error("Error in gradient for op "+a.kernelName+". The gradient of input "+t+" must have 'float32' dtype, but has '"+i.dtype+"'");var o=a.inputs[t];if(!r.arraysEqual(i.shape,o.shape))throw new Error("Error in gradient for op "+a.kernelName+". The gradient of input '"+t+"' has shape '"+i.shape+"', which does not match the shape of the input '"+o.shape+"'");if(null==e[o.id])e[o.id]=i;else{var u=e[o.id];e[o.id]=u.add(i),u.dispose()}};for(var c in a.inputs)u(c)},a=t.length-1;a>=0;a--)i(a)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(21),i=function(){function e(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new o)}return e.prototype.profileKernel=function(e,t,n){var r,i=this,o=this.backendTimer.time((function(){r=n()}));return r.forEach((function(n){n.data().then((function(r){a(r,n.dtype,e),o.then((function(a){var o="";null!=a.getExtraProfileInfo&&(o=a.getExtraProfileInfo()),i.logger.logKernelProfile(e,n,r,a.kernelMs,t,o)}))}))})),r},e}();function a(e,t,n){if("float32"!==t)return!1;for(var r=0;r<e.length;r++){var i=e[r];if(isNaN(i)||!isFinite(i))return console.warn("Found "+i+" in the result of '"+n+"'"),!0}return!1}t.Profiler=i,t.checkComputationForErrors=a;var o=function(){function e(){}return e.prototype.logKernelProfile=function(e,t,n,i,a,o){var s="number"==typeof i?r.rightPad(i+"ms",9):i.error,u=r.rightPad(e,25),c=t.rank,l=t.size,f=r.rightPad(t.shape.toString(),14),d="";for(var h in a){var p=a[h].shape||t.shape,m=p.length;d+=h+": "+m+"D "+(m>0?p:"")+" "}console.log("%c"+u+"\t%c"+s+"\t%c"+c+"D "+f+"\t%c"+l+"\t%c"+d+"\t%c"+o,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},e}();t.Logger=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=new Map,i=new Map;function a(e,t){return t+"_"+e}t.getKernel=function(e,t){var n=a(e,t);return r.get(n)},t.getGradient=function(e){return i.get(e)},t.getKernelsForBackend=function(e){for(var t=r.entries(),n=[];;){var i=t.next(),a=i.done,o=i.value;if(a)break;var s=o[0],u=o[1];s.split("_")[0]===e&&n.push(u)}return n},t.registerKernel=function(e){var t=e.kernelName,n=e.backendName,i=a(t,n);if(r.has(i))throw new Error("The kernel '"+t+"' for backend '"+n+"' is already registered");r.set(i,e)},t.registerGradient=function(e){var t=e.kernelName;i.has(t)&&console.warn("Overriding the gradient for '"+t+"'"),i.set(t,e)},t.unregisterKernel=function(e,t){var n=a(e,t);if(!r.has(n))throw new Error("The kernel '"+e+"' for backend '"+t+"' is not registered");r.delete(n)},t.unregisterGradient=function(e){if(!i.has(e))throw new Error("The gradient '"+e+"' for backend is not registered");i.delete(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(206);n(33).Tensor.prototype.add=function(e){return r.add(this,e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(383),n(377),n(375),n(371),n(363),n(361),n(359),n(357),n(355),n(353)},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){(function(e,t){!function(e,n){"use strict";if(!e.setImmediate){var r,i=1,a={},o=!1,s=e.document,u=Object.getPrototypeOf&&Object.getPrototypeOf(e);u=u&&u.setTimeout?u:e,"[object process]"==={}.toString.call(e.process)?r=function(e){t.nextTick((function(){l(e)}))}:function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?function(){var t="setImmediate$"+Math.random()+"$",n=function(n){n.source===e&&"string"==typeof n.data&&0===n.data.indexOf(t)&&l(+n.data.slice(t.length))};e.addEventListener?e.addEventListener("message",n,!1):e.attachEvent("onmessage",n),r=function(n){e.postMessage(t+n,"*")}}():e.MessageChannel?function(){var e=new MessageChannel;e.port1.onmessage=function(e){l(e.data)},r=function(t){e.port2.postMessage(t)}}():s&&"onreadystatechange"in s.createElement("script")?function(){var e=s.documentElement;r=function(t){var n=s.createElement("script");n.onreadystatechange=function(){l(t),n.onreadystatechange=null,e.removeChild(n),n=null},e.appendChild(n)}}():r=function(e){setTimeout(l,0,e)},u.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var o={callback:e,args:t};return a[i]=o,r(i),i++},u.clearImmediate=c}function c(e){delete a[e]}function l(e){if(o)setTimeout(l,0,e);else{var t=a[e];if(t){o=!0;try{!function(e){var t=e.callback,r=e.args;switch(r.length){case 0:t();break;case 1:t(r[0]);break;case 2:t(r[0],r[1]);break;case 3:t(r[0],r[1],r[2]);break;default:t.apply(n,r)}}(t)}finally{c(e),o=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,n(59),n(75))},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t){t.read=function(e,t,n,r,i){var a,o,s=8*i-r-1,u=(1<<s)-1,c=u>>1,l=-7,f=n?i-1:0,d=n?-1:1,h=e[t+f];for(f+=d,a=h&(1<<-l)-1,h>>=-l,l+=s;l>0;a=256*a+e[t+f],f+=d,l-=8);for(o=a&(1<<-l)-1,a>>=-l,l+=r;l>0;o=256*o+e[t+f],f+=d,l-=8);if(0===a)a=1-c;else{if(a===u)return o?NaN:1/0*(h?-1:1);o+=Math.pow(2,r),a-=c}return(h?-1:1)*o*Math.pow(2,a-r)},t.write=function(e,t,n,r,i,a){var o,s,u,c=8*a-i-1,l=(1<<c)-1,f=l>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:a-1,p=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-o))<1&&(o--,u*=2),(t+=o+f>=1?d/u:d*Math.pow(2,1-f))*u>=2&&(o++,u/=2),o+f>=l?(s=0,o=l):o+f>=1?(s=(t*u-1)*Math.pow(2,i),o+=f):(s=t*Math.pow(2,f-1)*Math.pow(2,i),o=0));i>=8;e[n+h]=255&s,h+=p,s/=256,i-=8);for(o=o<<i|s,c+=i;c>0;e[n+h]=255&o,h+=p,o/=256,c-=8);e[n+h-p]|=128*m}},function(e,t,n){"use strict";t.byteLength=function(e){var t=c(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,r=c(e),o=r[0],s=r[1],u=new a(function(e,t,n){return 3*(t+n)/4-n}(0,o,s)),l=0,f=s>0?o-4:o;for(n=0;n<f;n+=4)t=i[e.charCodeAt(n)]<<18|i[e.charCodeAt(n+1)]<<12|i[e.charCodeAt(n+2)]<<6|i[e.charCodeAt(n+3)],u[l++]=t>>16&255,u[l++]=t>>8&255,u[l++]=255&t;return 2===s&&(t=i[e.charCodeAt(n)]<<2|i[e.charCodeAt(n+1)]>>4,u[l++]=255&t),1===s&&(t=i[e.charCodeAt(n)]<<10|i[e.charCodeAt(n+1)]<<4|i[e.charCodeAt(n+2)]>>2,u[l++]=t>>8&255,u[l++]=255&t),u},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,a=[],o=0,s=n-i;o<s;o+=16383)a.push(f(e,o,o+16383>s?s:o+16383));return 1===i?(t=e[n-1],a.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],a.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"=")),a.join("")};for(var r=[],i=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,u=o.length;s<u;++s)r[s]=o[s],i[o.charCodeAt(s)]=s;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function l(e){return r[e>>18&63]+r[e>>12&63]+r[e>>6&63]+r[63&e]}function f(e,t,n){for(var r,i=[],a=t;a<n;a+=3)r=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),i.push(l(r));return i.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,n){var r=n(149);e.exports=function(e,t){if(!r(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!r(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t,n){var r=n(149),i=n(150).document,a=r(i)&&r(i.createElement);e.exports=function(e){return a?i.createElement(e):{}}},function(e,t,n){e.exports=!n(148)&&!n(208)((function(){return 7!=Object.defineProperty(n(398)("div"),"a",{get:function(){return 7}}).a}))},function(e,t,n){var r=n(149);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},function(e,t,n){var r=n(400),i=n(399),a=n(397),o=Object.defineProperty;t.f=n(148)?Object.defineProperty:function(e,t,n){if(r(e),t=a(t,!0),r(n),i)try{return o(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(e,t,n){var r=n(401),i=n(396);e.exports=n(148)?function(e,t,n){return r.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,n){var r=n(403);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},function(e,t,n){var r=n(150),i=n(209),a=n(404),o=n(402),s=n(395),u=function e(t,n,u){var c,l,f,d=t&e.F,h=t&e.G,p=t&e.S,m=t&e.P,v=t&e.B,g=t&e.W,y=h?i:i[n]||(i[n]={}),b=y.prototype,x=h?r:p?r[n]:(r[n]||{}).prototype;for(c in h&&(u=n),u)(l=!d&&x&&void 0!==x[c])&&s(y,c)||(f=l?x[c]:u[c],y[c]=h&&"function"!=typeof x[c]?u[c]:v&&l?a(f,r):g&&x[c]==f?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(f):m&&"function"==typeof f?a(Function.call,f):f,m&&((y.virtual||(y.virtual={}))[c]=f,t&e.R&&b&&!b[c]&&o(b,c,f)))};u.F=1,u.G=2,u.S=4,u.P=8,u.B=16,u.W=32,u.U=64,u.R=128,e.exports=u},function(e,t,n){var r=n(405);r(r.G,{global:n(150)})},function(e,t,n){n(406),e.exports=n(209).global},function(e,t,n){var r=function(e){"use strict";var t,n=Object.prototype,r=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var i=t&&t.prototype instanceof v?t:v,a=Object.create(i.prototype),o=new O(r||[]);return a._invoke=function(e,t,n){var r=f;return function(i,a){if(r===h)throw new Error("Generator is already running");if(r===p){if("throw"===i)throw a;return T()}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var s=S(o,n);if(s){if(s===m)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===f)throw r=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=h;var u=l(e,t,n);if("normal"===u.type){if(r=n.done?p:d,u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r=p,n.method="throw",n.arg=u.arg)}}}(e,n,o),a}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var f="suspendedStart",d="suspendedYield",h="executing",p="completed",m={};function v(){}function g(){}function y(){}var b={};u(b,a,(function(){return this}));var x=Object.getPrototypeOf,w=x&&x(x(D([])));w&&w!==n&&r.call(w,a)&&(b=w);var _=y.prototype=v.prototype=Object.create(b);function k(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){var n;this._invoke=function(i,a){function o(){return new t((function(n,o){!function n(i,a,o,s){var u=l(e[i],e,a);if("throw"!==u.type){var c=u.arg,f=c.value;return f&&"object"==typeof f&&r.call(f,"__await")?t.resolve(f.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(f).then((function(e){c.value=e,o(c)}),(function(e){return n("throw",e,o,s)}))}s(u.arg)}(i,a,n,o)}))}return n=n?n.then(o,o):o()}}function S(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,S(e,n),"throw"===n.method))return m;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var i=l(r,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,m;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,m):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function D(e){if(e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}return{next:T}}function T(){return{value:t,done:!0}}return g.prototype=y,u(_,"constructor",y),u(y,"constructor",g),g.displayName=u(y,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,u(e,s,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},k(E.prototype),u(E.prototype,o,(function(){return this})),e.AsyncIterator=E,e.async=function(t,n,r,i,a){void 0===a&&(a=Promise);var o=new E(c(t,n,r,i),a);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},k(_),u(_,s,"Generator"),u(_,a,(function(){return this})),u(_,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=D,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(u&&c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,m):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),A(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;A(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:D(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),m}},e}(e.exports);try{regeneratorRuntime=r}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}},function(e,t,n){for(var r=n(155),i=n(82),a=n(38),o=n(16),s=n(42),u=n(96),c=n(19),l=c("iterator"),f=c("toStringTag"),d=u.Array,h={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},p=i(h),m=0;m<p.length;m++){var v,g=p[m],y=h[g],b=o[g],x=b&&b.prototype;if(x&&(x[l]||s(x,l,d),x[f]||s(x,f,g),u[g]=d,y))for(v in r)x[v]||a(x,v,r[v],!0)}},function(e,t,n){var r=n(8),i=n(152);r(r.G+r.B,{setImmediate:i.set,clearImmediate:i.clear})},function(e,t,n){var r=n(16),i=n(8),a=n(120),o=[].slice,s=/MSIE .\./.test(a),u=function(e){return function(t,n){var r=arguments.length>2,i=!!r&&o.call(arguments,2);return e(r?function(){("function"==typeof t?t:Function(t)).apply(this,i)}:t,n)}};i(i.G+i.B+i.F*s,{setTimeout:u(r.setTimeout),setInterval:u(r.setInterval)})},function(e,t,n){n(411),n(410),n(409),e.exports=n(24)},function(e,t,n){"use strict";var r=n(8),i=n(24),a=n(16),o=n(104),s=n(216);r(r.P+r.R,"Promise",{finally:function(e){var t=o(this,i.Promise||a.Promise),n="function"==typeof e;return this.then(n?function(n){return s(t,e()).then((function(){return n}))}:e,n?function(n){return s(t,e()).then((function(){throw n}))}:e)}})},function(e,t,n){"use strict";n(218),n(413),e.exports=n(24).Promise.finally},function(e,t,n){var r=n(8),i=n(210)(!0);r(r.S,"Object",{entries:function(e){return i(e)}})},function(e,t,n){n(415),e.exports=n(24).Object.entries},function(e,t,n){var r=n(8),i=n(210)(!1);r(r.S,"Object",{values:function(e){return i(e)}})},function(e,t,n){n(417),e.exports=n(24).Object.values},function(e,t,n){var r=n(8),i=n(212),a=n(41),o=n(53),s=n(158);r(r.S,"Object",{getOwnPropertyDescriptors:function(e){for(var t,n,r=a(e),u=o.f,c=i(r),l={},f=0;c.length>f;)void 0!==(n=u(r,t=c[f++]))&&s(l,t,n);return l}})},function(e,t,n){n(419),e.exports=n(24).Object.getOwnPropertyDescriptors},function(e,t,n){n(239)("asyncIterator")},function(e,t,n){n(421),e.exports=n(174).f("asyncIterator")},function(e,t,n){"use strict";n(97)("trimRight",(function(e){return function(){return e(this,2)}}),"trimEnd")},function(e,t,n){n(423),e.exports=n(24).String.trimRight},function(e,t,n){"use strict";n(97)("trimLeft",(function(e){return function(){return e(this,1)}}),"trimStart")},function(e,t,n){n(425),e.exports=n(24).String.trimLeft},function(e,t,n){"use strict";var r=n(8),i=n(211),a=n(120),o=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(a);r(r.P+r.F*o,"String",{padEnd:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0,!1)}})},function(e,t,n){n(427),e.exports=n(24).String.padEnd},function(e,t,n){"use strict";var r=n(8),i=n(211),a=n(120),o=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(a);r(r.P+r.F*o,"String",{padStart:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0,!0)}})},function(e,t,n){n(429),e.exports=n(24).String.padStart},function(e,t,n){"use strict";var r=n(126),i=n(13),a=n(22),o=n(56),s=n(19)("isConcatSpreadable");e.exports=function e(t,n,u,c,l,f,d,h){for(var p,m,v=l,g=0,y=!!d&&o(d,h,3);g<c;){if(g in u){if(p=y?y(u[g],g,n):u[g],m=!1,i(p)&&(m=void 0!==(m=p[s])?!!m:r(p)),m&&f>0)v=e(t,n,p,a(p.length),v,f-1)-1;else{if(v>=9007199254740991)throw TypeError();t[v]=p}v++}g++}return v}},function(e,t,n){"use strict";var r=n(8),i=n(431),a=n(34),o=n(22),s=n(55),u=n(224);r(r.P,"Array",{flatMap:function(e){var t,n,r=a(this);return s(e),t=o(r.length),n=u(r,0),i(n,r,r,t,0,1,e,arguments[1]),n}}),n(77)("flatMap")},function(e,t,n){n(432),e.exports=n(24).Array.flatMap},function(e,t,n){"use strict";var r=n(8),i=n(128)(!0);r(r.P,"Array",{includes:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),n(77)("includes")},function(e,t,n){n(434),e.exports=n(24).Array.includes},function(e,t,n){var r=n(8),i=n(170);i&&r(r.S,"Reflect",{setPrototypeOf:function(e,t){i.check(e,t);try{return i.set(e,t),!0}catch(e){return!1}}})},function(e,t,n){var r=n(26),i=n(53),a=n(78),o=n(43),s=n(8),u=n(85),c=n(14),l=n(13);s(s.S,"Reflect",{set:function e(t,n,s){var f,d,h=arguments.length<4?t:arguments[3],p=i.f(c(t),n);if(!p){if(l(d=a(t)))return e(d,n,s,h);p=u(0)}if(o(p,"value")){if(!1===p.writable||!l(h))return!1;if(f=i.f(h,n)){if(f.get||f.set||!1===f.writable)return!1;f.value=s,r.f(h,n,f)}else r.f(h,n,u(0,s));return!0}return void 0!==p.set&&(p.set.call(h,s),!0)}})},function(e,t,n){var r=n(8),i=n(14),a=Object.preventExtensions;r(r.S,"Reflect",{preventExtensions:function(e){i(e);try{return a&&a(e),!0}catch(e){return!1}}})},function(e,t,n){var r=n(8);r(r.S,"Reflect",{ownKeys:n(212)})},function(e,t,n){var r=n(8),i=n(14),a=Object.isExtensible;r(r.S,"Reflect",{isExtensible:function(e){return i(e),!a||a(e)}})},function(e,t,n){var r=n(8);r(r.S,"Reflect",{has:function(e,t){return t in e}})},function(e,t,n){var r=n(8),i=n(78),a=n(14);r(r.S,"Reflect",{getPrototypeOf:function(e){return i(a(e))}})},function(e,t,n){var r=n(53),i=n(8),a=n(14);i(i.S,"Reflect",{getOwnPropertyDescriptor:function(e,t){return r.f(a(e),t)}})},function(e,t,n){var r=n(53),i=n(78),a=n(43),o=n(8),s=n(13),u=n(14);o(o.S,"Reflect",{get:function e(t,n){var o,c,l=arguments.length<3?t:arguments[2];return u(t)===l?t[n]:(o=r.f(t,n))?a(o,"value")?o.value:void 0!==o.get?o.get.call(l):void 0:s(c=i(t))?e(c,n,l):void 0}})},function(e,t,n){"use strict";var r=n(8),i=n(14),a=function(e){this._t=i(e),this._i=0;var t,n=this._k=[];for(t in e)n.push(t)};n(226)(a,"Object",(function(){var e,t=this._k;do{if(this._i>=t.length)return{value:void 0,done:!0}}while(!((e=t[this._i++])in this._t));return{value:e,done:!1}})),r(r.S,"Reflect",{enumerate:function(e){return new a(e)}})},function(e,t,n){var r=n(8),i=n(53).f,a=n(14);r(r.S,"Reflect",{deleteProperty:function(e,t){var n=i(a(e),t);return!(n&&!n.configurable)&&delete e[t]}})},function(e,t,n){var r=n(26),i=n(8),a=n(14),o=n(66);i(i.S+i.F*n(15)((function(){Reflect.defineProperty(r.f({},1,{value:1}),1,{value:2})})),"Reflect",{defineProperty:function(e,t,n){a(e),t=o(t,!0),a(n);try{return r.f(e,t,n),!0}catch(e){return!1}}})},function(e,t,n){var r=n(8),i=n(80),a=n(55),o=n(14),s=n(13),u=n(15),c=n(233),l=(n(16).Reflect||{}).construct,f=u((function(){function e(){}return!(l((function(){}),[],e)instanceof e)})),d=!u((function(){l((function(){}))}));r(r.S+r.F*(f||d),"Reflect",{construct:function(e,t){a(e),o(t);var n=arguments.length<3?e:a(arguments[2]);if(d&&!f)return l(e,t,n);if(e==n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var r=[null];return r.push.apply(r,t),new(c.apply(e,r))}var u=n.prototype,h=i(s(u)?u:Object.prototype),p=Function.apply.call(e,h,t);return s(p)?p:h}})},function(e,t,n){var r=n(8),i=n(55),a=n(14),o=(n(16).Reflect||{}).apply,s=Function.apply;r(r.S+r.F*!n(15)((function(){o((function(){}))})),"Reflect",{apply:function(e,t,n){var r=i(e),u=a(n);return o?o(r,t,u):s.call(r,t,u)}})},function(e,t,n){n(60)("Float64",8,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},function(e,t,n){n(60)("Float32",4,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},function(e,t,n){n(60)("Uint32",4,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},function(e,t,n){n(60)("Int32",4,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},function(e,t,n){n(60)("Uint16",2,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},function(e,t,n){n(60)("Int16",2,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},function(e,t,n){n(60)("Uint8",1,(function(e){return function(t,n,r){return e(this,t,n,r)}}),!0)},function(e,t,n){n(60)("Uint8",1,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},function(e,t,n){n(60)("Int8",1,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},function(e,t,n){var r=n(8);r(r.G+r.W+r.F*!n(118).ABV,{DataView:n(151).DataView})},function(e,t,n){"use strict";var r=n(8),i=n(118),a=n(151),o=n(14),s=n(81),u=n(22),c=n(13),l=n(16).ArrayBuffer,f=n(104),d=a.ArrayBuffer,h=a.DataView,p=i.ABV&&l.isView,m=d.prototype.slice,v=i.VIEW;r(r.G+r.W+r.F*(l!==d),{ArrayBuffer:d}),r(r.S+r.F*!i.CONSTR,"ArrayBuffer",{isView:function(e){return p&&p(e)||c(e)&&v in e}}),r(r.P+r.U+r.F*n(15)((function(){return!new d(2).slice(1,void 0).byteLength})),"ArrayBuffer",{slice:function(e,t){if(void 0!==m&&void 0===t)return m.call(o(this),e);for(var n=o(this).byteLength,r=s(e,n),i=s(void 0===t?n:t,n),a=new(f(this,d))(u(i-r)),c=new h(this),l=new h(a),p=0;r<i;)l.setUint8(p++,c.getUint8(r++));return a}}),n(95)("ArrayBuffer")},function(e,t,n){"use strict";var r=n(214),i=n(76);n(119)("WeakSet",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{add:function(e){return r.def(i(this,"WeakSet"),e,!0)}},r,!1,!0)},function(e,t,n){"use strict";var r,i=n(16),a=n(51)(0),o=n(38),s=n(65),u=n(235),c=n(214),l=n(13),f=n(76),d=n(76),h=!i.ActiveXObject&&"ActiveXObject"in i,p=s.getWeak,m=Object.isExtensible,v=c.ufstore,g=function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},y={get:function(e){if(l(e)){var t=p(e);return!0===t?v(f(this,"WeakMap")).get(e):t?t[this._i]:void 0}},set:function(e,t){return c.def(f(this,"WeakMap"),e,t)}},b=e.exports=n(119)("WeakMap",g,y,c,!0,!0);d&&h&&(u((r=c.getConstructor(g,"WeakMap")).prototype,y),s.NEED=!0,a(["delete","has","get","set"],(function(e){var t=b.prototype,n=t[e];o(t,e,(function(t,i){if(l(t)&&!m(t)){this._f||(this._f=new r);var a=this._f[e](t,i);return"set"==e?this:a}return n.call(this,t,i)}))})))},function(e,t,n){"use strict";var r=n(215),i=n(76);e.exports=n(119)("Set",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{add:function(e){return r.def(i(this,"Set"),e=0===e?0:e,e)}},r)},function(e,t,n){"use strict";var r=n(215),i=n(76);e.exports=n(119)("Map",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{get:function(e){var t=r.getEntry(i(this,"Map"),e);return t&&t.v},set:function(e,t){return r.def(i(this,"Map"),0===e?0:e,t)}},r,!0)},function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},function(e,t,n){var r=n(16),i=n(152).set,a=r.MutationObserver||r.WebKitMutationObserver,o=r.process,s=r.Promise,u="process"==n(62)(o);e.exports=function(){var e,t,n,c=function(){var r,i;for(u&&(r=o.domain)&&r.exit();e;){i=e.fn,e=e.next;try{i()}catch(r){throw e?n():t=void 0,r}}t=void 0,r&&r.enter()};if(u)n=function(){o.nextTick(c)};else if(!a||r.navigator&&r.navigator.standalone)if(s&&s.resolve){var l=s.resolve(void 0);n=function(){l.then(c)}}else n=function(){i.call(r,c)};else{var f=!0,d=document.createTextNode("");new a(c).observe(d,{characterData:!0}),n=function(){d.data=f=!f}}return function(r){var i={fn:r,next:void 0};t&&(t.next=i),e||(e=i,n()),t=i}}},function(e,t,n){"use strict";var r=n(161),i=n(14),a=n(104),o=n(153),s=n(22),u=n(123),c=n(154),l=n(15),f=Math.min,d=[].push,h=!l((function(){RegExp(4294967295,"y")}));n(122)("split",2,(function(e,t,n,l){var p;return p="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,t){var i=String(this);if(void 0===e&&0===t)return[];if(!r(e))return n.call(i,e,t);for(var a,o,s,u=[],l=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),f=0,h=void 0===t?4294967295:t>>>0,p=new RegExp(e.source,l+"g");(a=c.call(p,i))&&!((o=p.lastIndex)>f&&(u.push(i.slice(f,a.index)),a.length>1&&a.index<i.length&&d.apply(u,a.slice(1)),s=a[0].length,f=o,u.length>=h));)p.lastIndex===a.index&&p.lastIndex++;return f===i.length?!s&&p.test("")||u.push(""):u.push(i.slice(f)),u.length>h?u.slice(0,h):u}:"0".split(void 0,0).length?function(e,t){return void 0===e&&0===t?[]:n.call(this,e,t)}:n,[function(n,r){var i=e(this),a=void 0==n?void 0:n[t];return void 0!==a?a.call(n,i,r):p.call(String(i),n,r)},function(e,t){var r=l(p,e,this,t,p!==n);if(r.done)return r.value;var c=i(e),d=String(this),m=a(c,RegExp),v=c.unicode,g=(c.ignoreCase?"i":"")+(c.multiline?"m":"")+(c.unicode?"u":"")+(h?"y":"g"),y=new m(h?c:"^(?:"+c.source+")",g),b=void 0===t?4294967295:t>>>0;if(0===b)return[];if(0===d.length)return null===u(y,d)?[d]:[];for(var x=0,w=0,_=[];w<d.length;){y.lastIndex=h?w:0;var k,E=u(y,h?d:d.slice(w));if(null===E||(k=f(s(y.lastIndex+(h?0:w)),d.length))===x)w=o(d,w,v);else{if(_.push(d.slice(x,w)),_.length===b)return _;for(var S=1;S<=E.length-1;S++)if(_.push(E[S]),_.length===b)return _;w=x=k}}return _.push(d.slice(x)),_}]}))},function(e,t,n){"use strict";var r=n(14),i=n(234),a=n(123);n(122)("search",1,(function(e,t,n,o){return[function(n){var r=e(this),i=void 0==n?void 0:n[t];return void 0!==i?i.call(n,r):new RegExp(n)[t](String(r))},function(e){var t=o(n,e,this);if(t.done)return t.value;var s=r(e),u=String(this),c=s.lastIndex;i(c,0)||(s.lastIndex=0);var l=a(s,u);return i(s.lastIndex,c)||(s.lastIndex=c),null===l?-1:l.index}]}))},function(e,t,n){"use strict";var r=n(14),i=n(34),a=n(22),o=n(54),s=n(153),u=n(123),c=Math.max,l=Math.min,f=Math.floor,d=/\$([$&`']|\d\d?|<[^>]*>)/g,h=/\$([$&`']|\d\d?)/g,p=function(e){return void 0===e?e:String(e)};n(122)("replace",2,(function(e,t,n,m){return[function(r,i){var a=e(this),o=void 0==r?void 0:r[t];return void 0!==o?o.call(r,a,i):n.call(String(a),r,i)},function(e,t){var i=m(n,e,this,t);if(i.done)return i.value;var f=r(e),d=String(this),h="function"==typeof t;h||(t=String(t));var g=f.global;if(g){var y=f.unicode;f.lastIndex=0}for(var b=[];;){var x=u(f,d);if(null===x)break;if(b.push(x),!g)break;""===String(x[0])&&(f.lastIndex=s(d,a(f.lastIndex),y))}for(var w="",_=0,k=0;k<b.length;k++){x=b[k];for(var E=String(x[0]),S=c(l(o(x.index),d.length),0),C=[],A=1;A<x.length;A++)C.push(p(x[A]));var O=x.groups;if(h){var D=[E].concat(C,S,d);void 0!==O&&D.push(O);var T=String(t.apply(void 0,D))}else T=v(E,d,S,C,O,t);S>=_&&(w+=d.slice(_,S)+T,_=S+E.length)}return w+d.slice(_)}];function v(e,t,r,a,o,s){var u=r+e.length,c=a.length,l=h;return void 0!==o&&(o=i(o),l=d),n.call(s,l,(function(n,i){var s;switch(i.charAt(0)){case"$":return"$";case"&":return e;case"`":return t.slice(0,r);case"'":return t.slice(u);case"<":s=o[i.slice(1,-1)];break;default:var l=+i;if(0===l)return n;if(l>c){var d=f(l/10);return 0===d?n:d<=c?void 0===a[d-1]?i.charAt(1):a[d-1]+i.charAt(1):n}s=a[l-1]}return void 0===s?"":s}))}}))},function(e,t,n){"use strict";var r=n(14),i=n(22),a=n(153),o=n(123);n(122)("match",1,(function(e,t,n,s){return[function(n){var r=e(this),i=void 0==n?void 0:n[t];return void 0!==i?i.call(n,r):new RegExp(n)[t](String(r))},function(e){var t=s(n,e,this);if(t.done)return t.value;var u=r(e),c=String(this);if(!u.global)return o(u,c);var l=u.unicode;u.lastIndex=0;for(var f,d=[],h=0;null!==(f=o(u,c));){var p=String(f[0]);d[h]=p,""===p&&(u.lastIndex=a(c,i(u.lastIndex),l)),h++}return 0===h?null:d}]}))},function(e,t,n){"use strict";n(219);var r=n(14),i=n(124),a=n(27),o=/./.toString,s=function(e){n(38)(RegExp.prototype,"toString",e,!0)};n(15)((function(){return"/a/b"!=o.call({source:"a",flags:"b"})}))?s((function(){var e=r(this);return"/".concat(e.source,"/","flags"in e?e.flags:!a&&e instanceof RegExp?i.call(e):void 0)})):"toString"!=o.name&&s((function(){return o.call(this)}))},function(e,t,n){var r=n(16),i=n(168),a=n(26).f,o=n(79).f,s=n(161),u=n(124),c=r.RegExp,l=c,f=c.prototype,d=/a/g,h=/a/g,p=new c(d)!==d;if(n(27)&&(!p||n(15)((function(){return h[n(19)("match")]=!1,c(d)!=d||c(h)==h||"/a/i"!=c(d,"i")})))){c=function(e,t){var n=this instanceof c,r=s(e),a=void 0===t;return!n&&r&&e.constructor===c&&a?e:i(p?new l(r&&!a?e.source:e,t):l((r=e instanceof c)?e.source:e,r&&a?u.call(e):t),n?this:f,c)};for(var m=function(e){e in c||a(c,e,{configurable:!0,get:function(){return l[e]},set:function(t){l[e]=t}})},v=o(l),g=0;v.length>g;)m(v[g++]);f.constructor=c,c.prototype=f,n(38)(r,"RegExp",c)}n(95)("RegExp")},function(e,t,n){n(95)("Array")},function(e,t,n){"use strict";var r=n(8),i=n(51)(6),a="findIndex",o=!0;a in[]&&Array(1)[a]((function(){o=!1})),r(r.P+r.F*o,"Array",{findIndex:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),n(77)(a)},function(e,t,n){"use strict";var r=n(8),i=n(51)(5),a=!0;"find"in[]&&Array(1).find((function(){a=!1})),r(r.P+r.F*a,"Array",{find:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),n(77)("find")},function(e,t,n){var r=n(8);r(r.P,"Array",{fill:n(156)}),n(77)("fill")},function(e,t,n){var r=n(8);r(r.P,"Array",{copyWithin:n(222)}),n(77)("copyWithin")},function(e,t,n){"use strict";var r=n(8),i=n(41),a=n(54),o=n(22),s=[].lastIndexOf,u=!!s&&1/[1].lastIndexOf(1,-0)<0;r(r.P+r.F*(u||!n(49)(s)),"Array",{lastIndexOf:function(e){if(u)return s.apply(this,arguments)||0;var t=i(this),n=o(t.length),r=n-1;for(arguments.length>1&&(r=Math.min(r,a(arguments[1]))),r<0&&(r=n+r);r>=0;r--)if(r in t&&t[r]===e)return r||0;return-1}})},function(e,t,n){"use strict";var r=n(8),i=n(128)(!1),a=[].indexOf,o=!!a&&1/[1].indexOf(1,-0)<0;r(r.P+r.F*(o||!n(49)(a)),"Array",{indexOf:function(e){return o?a.apply(this,arguments)||0:i(this,e,arguments[1])}})},function(e,t,n){"use strict";var r=n(8),i=n(223);r(r.P+r.F*!n(49)([].reduceRight,!0),"Array",{reduceRight:function(e){return i(this,e,arguments.length,arguments[1],!0)}})},function(e,t,n){"use strict";var r=n(8),i=n(223);r(r.P+r.F*!n(49)([].reduce,!0),"Array",{reduce:function(e){return i(this,e,arguments.length,arguments[1],!1)}})},function(e,t,n){"use strict";var r=n(8),i=n(51)(4);r(r.P+r.F*!n(49)([].every,!0),"Array",{every:function(e){return i(this,e,arguments[1])}})},function(e,t,n){"use strict";var r=n(8),i=n(51)(3);r(r.P+r.F*!n(49)([].some,!0),"Array",{some:function(e){return i(this,e,arguments[1])}})},function(e,t,n){"use strict";var r=n(8),i=n(51)(2);r(r.P+r.F*!n(49)([].filter,!0),"Array",{filter:function(e){return i(this,e,arguments[1])}})},function(e,t,n){"use strict";var r=n(8),i=n(51)(1);r(r.P+r.F*!n(49)([].map,!0),"Array",{map:function(e){return i(this,e,arguments[1])}})},function(e,t,n){var r=n(13),i=n(126),a=n(19)("species");e.exports=function(e){var t;return i(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!i(t.prototype)||(t=void 0),r(t)&&null===(t=t[a])&&(t=void 0)),void 0===t?Array:t}},function(e,t,n){"use strict";var r=n(8),i=n(51)(0),a=n(49)([].forEach,!0);r(r.P+r.F*!a,"Array",{forEach:function(e){return i(this,e,arguments[1])}})},function(e,t,n){"use strict";var r=n(8),i=n(55),a=n(34),o=n(15),s=[].sort,u=[1,2,3];r(r.P+r.F*(o((function(){u.sort(void 0)}))||!o((function(){u.sort(null)}))||!n(49)(s)),"Array",{sort:function(e){return void 0===e?s.call(a(this)):s.call(a(this),i(e))}})},function(e,t,n){"use strict";var r=n(8),i=n(171),a=n(62),o=n(81),s=n(22),u=[].slice;r(r.P+r.F*n(15)((function(){i&&u.call(i)})),"Array",{slice:function(e,t){var n=s(this.length),r=a(this);if(t=void 0===t?n:t,"Array"==r)return u.call(this,e,t);for(var i=o(e,n),c=o(t,n),l=s(c-i),f=new Array(l),d=0;d<l;d++)f[d]="String"==r?this.charAt(i+d):this[i+d];return f}})},function(e,t,n){"use strict";var r=n(8),i=n(41),a=[].join;r(r.P+r.F*(n(107)!=Object||!n(49)(a)),"Array",{join:function(e){return a.call(i(this),void 0===e?",":e)}})},function(e,t,n){"use strict";var r=n(8),i=n(158);r(r.S+r.F*n(15)((function(){function e(){}return!(Array.of.call(e)instanceof e)})),"Array",{of:function(){for(var e=0,t=arguments.length,n=new("function"==typeof this?this:Array)(t);t>e;)i(n,e,arguments[e++]);return n.length=t,n}})},function(e,t,n){"use strict";var r=n(56),i=n(8),a=n(34),o=n(225),s=n(159),u=n(22),c=n(158),l=n(157);i(i.S+i.F*!n(125)((function(e){Array.from(e)})),"Array",{from:function(e){var t,n,i,f,d=a(e),h="function"==typeof this?this:Array,p=arguments.length,m=p>1?arguments[1]:void 0,v=void 0!==m,g=0,y=l(d);if(v&&(m=r(m,p>2?arguments[2]:void 0,2)),void 0==y||h==Array&&s(y))for(n=new h(t=u(d.length));t>g;g++)c(n,g,v?m(d[g],g):d[g]);else for(f=y.call(d),n=new h;!(i=f.next()).done;g++)c(n,g,v?o(f,m,[i.value,g],!0):i.value);return n.length=g,n}})},function(e,t,n){var r=n(8);r(r.S,"Array",{isArray:n(126)})},function(e,t,n){"use strict";var r=n(14),i=n(66);e.exports=function(e){if("string"!==e&&"number"!==e&&"default"!==e)throw TypeError("Incorrect hint");return i(r(this),"number"!=e)}},function(e,t,n){var r=n(19)("toPrimitive"),i=Date.prototype;r in i||n(42)(i,r,n(494))},function(e,t,n){var r=Date.prototype,i=r.toString,a=r.getTime;new Date(NaN)+""!="Invalid Date"&&n(38)(r,"toString",(function(){var e=a.call(this);return e==e?i.call(this):"Invalid Date"}))},function(e,t,n){"use strict";var r=n(15),i=Date.prototype.getTime,a=Date.prototype.toISOString,o=function(e){return e>9?e:"0"+e};e.exports=r((function(){return"0385-07-25T07:06:39.999Z"!=a.call(new Date(-50000000000001))}))||!r((function(){a.call(new Date(NaN))}))?function(){if(!isFinite(i.call(this)))throw RangeError("Invalid time value");var e=this,t=e.getUTCFullYear(),n=e.getUTCMilliseconds(),r=t<0?"-":t>9999?"+":"";return r+("00000"+Math.abs(t)).slice(r?-6:-4)+"-"+o(e.getUTCMonth()+1)+"-"+o(e.getUTCDate())+"T"+o(e.getUTCHours())+":"+o(e.getUTCMinutes())+":"+o(e.getUTCSeconds())+"."+(n>99?n:"0"+o(n))+"Z"}:a},function(e,t,n){var r=n(8),i=n(497);r(r.P+r.F*(Date.prototype.toISOString!==i),"Date",{toISOString:i})},function(e,t,n){"use strict";var r=n(8),i=n(34),a=n(66);r(r.P+r.F*n(15)((function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})})),"Date",{toJSON:function(e){var t=i(this),n=a(t);return"number"!=typeof n||isFinite(n)?t.toISOString():null}})},function(e,t,n){var r=n(8);r(r.S,"Date",{now:function(){return(new Date).getTime()}})},function(e,t,n){"use strict";n(37)("sup",(function(e){return function(){return e(this,"sup","","")}}))},function(e,t,n){"use strict";n(37)("sub",(function(e){return function(){return e(this,"sub","","")}}))},function(e,t,n){"use strict";n(37)("strike",(function(e){return function(){return e(this,"strike","","")}}))},function(e,t,n){"use strict";n(37)("small",(function(e){return function(){return e(this,"small","","")}}))},function(e,t,n){"use strict";n(37)("link",(function(e){return function(t){return e(this,"a","href",t)}}))},function(e,t,n){"use strict";n(37)("italics",(function(e){return function(){return e(this,"i","","")}}))},function(e,t,n){"use strict";n(37)("fontsize",(function(e){return function(t){return e(this,"font","size",t)}}))},function(e,t,n){"use strict";n(37)("fontcolor",(function(e){return function(t){return e(this,"font","color",t)}}))},function(e,t,n){"use strict";n(37)("fixed",(function(e){return function(){return e(this,"tt","","")}}))},function(e,t,n){"use strict";n(37)("bold",(function(e){return function(){return e(this,"b","","")}}))},function(e,t,n){"use strict";n(37)("blink",(function(e){return function(){return e(this,"blink","","")}}))},function(e,t,n){"use strict";n(37)("big",(function(e){return function(){return e(this,"big","","")}}))},function(e,t,n){"use strict";n(37)("anchor",(function(e){return function(t){return e(this,"a","name",t)}}))},function(e,t,n){"use strict";var r=n(8),i=n(22),a=n(162),o="".startsWith;r(r.P+r.F*n(160)("startsWith"),"String",{startsWith:function(e){var t=a(this,e,"startsWith"),n=i(Math.min(arguments.length>1?arguments[1]:void 0,t.length)),r=String(e);return o?o.call(t,r,n):t.slice(n,n+r.length)===r}})},function(e,t,n){var r=n(8);r(r.P,"String",{repeat:n(167)})},function(e,t,n){"use strict";var r=n(8),i=n(162);r(r.P+r.F*n(160)("includes"),"String",{includes:function(e){return!!~i(this,e,"includes").indexOf(e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,n){"use strict";var r=n(8),i=n(22),a=n(162),o="".endsWith;r(r.P+r.F*n(160)("endsWith"),"String",{endsWith:function(e){var t=a(this,e,"endsWith"),n=arguments.length>1?arguments[1]:void 0,r=i(t.length),s=void 0===n?r:Math.min(i(n),r),u=String(e);return o?o.call(t,u,s):t.slice(s-u.length,s)===u}})},function(e,t,n){"use strict";var r=n(8),i=n(164)(!1);r(r.P,"String",{codePointAt:function(e){return i(this,e)}})},function(e,t,n){"use strict";var r=n(164)(!0);n(163)(String,"String",(function(e){this._t=String(e),this._i=0}),(function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})}))},function(e,t,n){"use strict";n(97)("trim",(function(e){return function(){return e(this,3)}}))},function(e,t,n){var r=n(8),i=n(41),a=n(22);r(r.S,"String",{raw:function(e){for(var t=i(e.raw),n=a(t.length),r=arguments.length,o=[],s=0;n>s;)o.push(String(t[s++])),s<r&&o.push(String(arguments[s]));return o.join("")}})},function(e,t,n){var r=n(8),i=n(81),a=String.fromCharCode,o=String.fromCodePoint;r(r.S+r.F*(!!o&&1!=o.length),"String",{fromCodePoint:function(e){for(var t,n=[],r=arguments.length,o=0;r>o;){if(t=+arguments[o++],i(t,1114111)!==t)throw RangeError(t+" is not a valid code point");n.push(t<65536?a(t):a(55296+((t-=65536)>>10),t%1024+56320))}return n.join("")}})},function(e,t,n){var r=n(8);r(r.S,"Math",{trunc:function(e){return(e>0?Math.floor:Math.ceil)(e)}})},function(e,t,n){var r=n(8),i=n(165),a=Math.exp;r(r.S,"Math",{tanh:function(e){var t=i(e=+e),n=i(-e);return t==1/0?1:n==1/0?-1:(t-n)/(a(e)+a(-e))}})},function(e,t,n){var r=n(8),i=n(165),a=Math.exp;r(r.S+r.F*n(15)((function(){return-2e-17!=!Math.sinh(-2e-17)})),"Math",{sinh:function(e){return Math.abs(e=+e)<1?(i(e)-i(-e))/2:(a(e-1)-a(-e-1))*(Math.E/2)}})},function(e,t,n){var r=n(8);r(r.S,"Math",{sign:n(166)})},function(e,t,n){var r=n(8);r(r.S,"Math",{log2:function(e){return Math.log(e)/Math.LN2}})},function(e,t,n){var r=n(8);r(r.S,"Math",{log1p:n(227)})},function(e,t,n){var r=n(8);r(r.S,"Math",{log10:function(e){return Math.log(e)*Math.LOG10E}})},function(e,t,n){var r=n(8),i=Math.imul;r(r.S+r.F*n(15)((function(){return-5!=i(4294967295,5)||2!=i.length})),"Math",{imul:function(e,t){var n=+e,r=+t,i=65535&n,a=65535&r;return 0|i*a+((65535&n>>>16)*a+i*(65535&r>>>16)<<16>>>0)}})},function(e,t,n){var r=n(8),i=Math.abs;r(r.S,"Math",{hypot:function(e,t){for(var n,r,a=0,o=0,s=arguments.length,u=0;o<s;)u<(n=i(arguments[o++]))?(a=a*(r=u/n)*r+1,u=n):a+=n>0?(r=n/u)*r:n;return u===1/0?1/0:u*Math.sqrt(a)}})},function(e,t,n){var r=n(166),i=Math.pow,a=i(2,-52),o=i(2,-23),s=i(2,127)*(2-o),u=i(2,-126);e.exports=Math.fround||function(e){var t,n,i=Math.abs(e),c=r(e);return i<u?c*function(e){return e+1/a-1/a}(i/u/o)*u*o:(n=(t=(1+o/a)*i)-(t-i))>s||n!=n?c*(1/0):c*n}},function(e,t,n){var r=n(8);r(r.S,"Math",{fround:n(532)})},function(e,t,n){var r=n(8),i=n(165);r(r.S+r.F*(i!=Math.expm1),"Math",{expm1:i})},function(e,t,n){var r=n(8),i=Math.exp;r(r.S,"Math",{cosh:function(e){return(i(e=+e)+i(-e))/2}})},function(e,t,n){var r=n(8);r(r.S,"Math",{clz32:function(e){return(e>>>=0)?31-Math.floor(Math.log(e+.5)*Math.LOG2E):32}})},function(e,t,n){var r=n(8),i=n(166);r(r.S,"Math",{cbrt:function(e){return i(e=+e)*Math.pow(Math.abs(e),1/3)}})},function(e,t,n){var r=n(8),i=Math.atanh;r(r.S+r.F*!(i&&1/i(-0)<0),"Math",{atanh:function(e){return 0==(e=+e)?e:Math.log((1+e)/(1-e))/2}})},function(e,t,n){var r=n(8),i=Math.asinh;r(r.S+r.F*!(i&&1/i(0)>0),"Math",{asinh:function e(t){return isFinite(t=+t)&&0!=t?t<0?-e(-t):Math.log(t+Math.sqrt(t*t+1)):t}})},function(e,t,n){var r=n(8),i=n(227),a=Math.sqrt,o=Math.acosh;r(r.S+r.F*!(o&&710==Math.floor(o(Number.MAX_VALUE))&&o(1/0)==1/0),"Math",{acosh:function(e){return(e=+e)<1?NaN:e>94906265.62425156?Math.log(e)+Math.LN2:i(e-1+a(e-1)*a(e+1))}})},function(e,t,n){var r=n(8),i=n(231);r(r.S+r.F*(Number.parseInt!=i),"Number",{parseInt:i})},function(e,t,n){var r=n(8),i=n(230);r(r.S+r.F*(Number.parseFloat!=i),"Number",{parseFloat:i})},function(e,t,n){var r=n(8);r(r.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},function(e,t,n){var r=n(8);r(r.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(e,t,n){var r=n(8),i=n(228),a=Math.abs;r(r.S,"Number",{isSafeInteger:function(e){return i(e)&&a(e)<=9007199254740991}})},function(e,t,n){var r=n(8);r(r.S,"Number",{isNaN:function(e){return e!=e}})},function(e,t,n){var r=n(8);r(r.S,"Number",{isInteger:n(228)})},function(e,t,n){var r=n(8),i=n(16).isFinite;r(r.S,"Number",{isFinite:function(e){return"number"==typeof e&&i(e)}})},function(e,t,n){var r=n(8);r(r.S,"Number",{EPSILON:Math.pow(2,-52)})},function(e,t,n){"use strict";var r=n(8),i=n(15),a=n(229),o=1..toPrecision;r(r.P+r.F*(i((function(){return"1"!==o.call(1,void 0)}))||!i((function(){o.call({})}))),"Number",{toPrecision:function(e){var t=a(this,"Number#toPrecision: incorrect invocation!");return void 0===e?o.call(t):o.call(t,e)}})},function(e,t,n){"use strict";var r=n(8),i=n(54),a=n(229),o=n(167),s=1..toFixed,u=Math.floor,c=[0,0,0,0,0,0],l="Number.toFixed: incorrect invocation!",f=function(e,t){for(var n=-1,r=t;++n<6;)r+=e*c[n],c[n]=r%1e7,r=u(r/1e7)},d=function(e){for(var t=6,n=0;--t>=0;)n+=c[t],c[t]=u(n/e),n=n%e*1e7},h=function(){for(var e=6,t="";--e>=0;)if(""!==t||0===e||0!==c[e]){var n=String(c[e]);t=""===t?n:t+o.call("0",7-n.length)+n}return t},p=function e(t,n,r){return 0===n?r:n%2==1?e(t,n-1,r*t):e(t*t,n/2,r)};r(r.P+r.F*(!!s&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!n(15)((function(){s.call({})}))),"Number",{toFixed:function(e){var t,n,r,s,u=a(this,l),c=i(e),m="",v="0";if(c<0||c>20)throw RangeError(l);if(u!=u)return"NaN";if(u<=-1e21||u>=1e21)return String(u);if(u<0&&(m="-",u=-u),u>1e-21)if(n=(t=function(e){for(var t=0,n=e;n>=4096;)t+=12,n/=4096;for(;n>=2;)t+=1,n/=2;return t}(u*p(2,69,1))-69)<0?u*p(2,-t,1):u/p(2,t,1),n*=4503599627370496,(t=52-t)>0){for(f(0,n),r=c;r>=7;)f(1e7,0),r-=7;for(f(p(10,r,1),0),r=t-1;r>=23;)d(1<<23),r-=23;d(1<<r),f(1,1),d(2),v=h()}else f(0,n),f(1<<-t,0),v=h()+o.call("0",c);return c>0?m+((s=v.length)<=c?"0."+o.call("0",c-s)+v:v.slice(0,s-c)+"."+v.slice(s-c)):m+v}})},function(e,t,n){"use strict";var r=n(16),i=n(43),a=n(62),o=n(168),s=n(66),u=n(15),c=n(79).f,l=n(53).f,f=n(26).f,d=n(97).trim,h=r.Number,p=h,m=h.prototype,v="Number"==a(n(80)(m)),g="trim"in String.prototype,y=function(e){var t=s(e,!1);if("string"==typeof t&&t.length>2){var n,r,i,a=(t=g?t.trim():d(t,3)).charCodeAt(0);if(43===a||45===a){if(88===(n=t.charCodeAt(2))||120===n)return NaN}else if(48===a){switch(t.charCodeAt(1)){case 66:case 98:r=2,i=49;break;case 79:case 111:r=8,i=55;break;default:return+t}for(var o,u=t.slice(2),c=0,l=u.length;c<l;c++)if((o=u.charCodeAt(c))<48||o>i)return NaN;return parseInt(u,r)}}return+t};if(!h(" 0o1")||!h("0b1")||h("+0x1")){h=function(e){var t=arguments.length<1?0:e,n=this;return n instanceof h&&(v?u((function(){m.valueOf.call(n)})):"Number"!=a(n))?o(new p(y(t)),n,h):y(t)};for(var b,x=n(27)?c(p):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),w=0;x.length>w;w++)i(p,b=x[w])&&!i(h,b)&&f(h,b,l(p,b));h.prototype=m,m.constructor=h,n(38)(r,"Number",h)}},function(e,t,n){var r=n(8),i=n(230);r(r.G+r.F*(parseFloat!=i),{parseFloat:i})},function(e,t,n){var r=n(8),i=n(231);r(r.G+r.F*(parseInt!=i),{parseInt:i})},function(e,t,n){"use strict";var r=n(13),i=n(78),a=n(19)("hasInstance"),o=Function.prototype;a in o||n(26).f(o,a,{value:function(e){if("function"!=typeof this||!r(e))return!1;if(!r(this.prototype))return e instanceof this;for(;e=i(e);)if(this.prototype===e)return!0;return!1}})},function(e,t,n){var r=n(26).f,i=Function.prototype,a=/^\s*function ([^ (]*)/;"name"in i||n(27)&&r(i,"name",{configurable:!0,get:function(){try{return(""+this).match(a)[1]}catch(e){return""}}})},function(e,t,n){var r=n(8);r(r.P,"Function",{bind:n(233)})},function(e,t,n){"use strict";var r=n(105),i={};i[n(19)("toStringTag")]="z",i+""!="[object z]"&&n(38)(Object.prototype,"toString",(function(){return"[object "+r(this)+"]"}),!0)},function(e,t,n){var r=n(8);r(r.S,"Object",{setPrototypeOf:n(170).set})},function(e,t,n){var r=n(8);r(r.S,"Object",{is:n(234)})},function(e,t,n){var r=n(8);r(r.S+r.F,"Object",{assign:n(235)})},function(e,t,n){var r=n(13);n(52)("isExtensible",(function(e){return function(t){return!!r(t)&&(!e||e(t))}}))},function(e,t,n){var r=n(13);n(52)("isSealed",(function(e){return function(t){return!r(t)||!!e&&e(t)}}))},function(e,t,n){var r=n(13);n(52)("isFrozen",(function(e){return function(t){return!r(t)||!!e&&e(t)}}))},function(e,t,n){var r=n(13),i=n(65).onFreeze;n(52)("preventExtensions",(function(e){return function(t){return e&&r(t)?e(i(t)):t}}))},function(e,t,n){var r=n(13),i=n(65).onFreeze;n(52)("seal",(function(e){return function(t){return e&&r(t)?e(i(t)):t}}))},function(e,t,n){var r=n(13),i=n(65).onFreeze;n(52)("freeze",(function(e){return function(t){return e&&r(t)?e(i(t)):t}}))},function(e,t,n){n(52)("getOwnPropertyNames",(function(){return n(236).f}))},function(e,t,n){var r=n(34),i=n(82);n(52)("keys",(function(){return function(e){return i(r(e))}}))},function(e,t,n){var r=n(34),i=n(78);n(52)("getPrototypeOf",(function(){return function(e){return i(r(e))}}))},function(e,t,n){var r=n(41),i=n(53).f;n(52)("getOwnPropertyDescriptor",(function(){return function(e,t){return i(r(e),t)}}))},function(e,t,n){var r=n(8);r(r.S+r.F*!n(27),"Object",{defineProperties:n(237)})},function(e,t,n){var r=n(8);r(r.S+r.F*!n(27),"Object",{defineProperty:n(26).f})},function(e,t,n){var r=n(8);r(r.S,"Object",{create:n(80)})},function(e,t,n){var r=n(82),i=n(127),a=n(106);e.exports=function(e){var t=r(e),n=i.f;if(n)for(var o,s=n(e),u=a.f,c=0;s.length>c;)u.call(e,o=s[c++])&&t.push(o);return t}},function(e,t,n){e.exports=n(129)("native-function-to-string",Function.toString)},function(e,t,n){"use strict";var r=n(16),i=n(43),a=n(27),o=n(8),s=n(38),u=n(65).KEY,c=n(15),l=n(129),f=n(98),d=n(84),h=n(19),p=n(174),m=n(239),v=n(575),g=n(126),y=n(14),b=n(13),x=n(34),w=n(41),_=n(66),k=n(85),E=n(80),S=n(236),C=n(53),A=n(127),O=n(26),D=n(82),T=C.f,j=O.f,M=S.f,F=r.Symbol,I=r.JSON,N=I&&I.stringify,R=h("_hidden"),P=h("toPrimitive"),B={}.propertyIsEnumerable,L=l("symbol-registry"),z=l("symbols"),U=l("op-symbols"),W=Object.prototype,V="function"==typeof F&&!!A.f,G=r.QObject,q=!G||!G.prototype||!G.prototype.findChild,H=a&&c((function(){return 7!=E(j({},"a",{get:function(){return j(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=T(W,t);r&&delete W[t],j(e,t,n),r&&e!==W&&j(W,t,r)}:j,X=function(e){var t=z[e]=E(F.prototype);return t._k=e,t},K=V&&"symbol"==typeof F.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof F},Y=function e(t,n,r){return t===W&&e(U,n,r),y(t),n=_(n,!0),y(r),i(z,n)?(r.enumerable?(i(t,R)&&t[R][n]&&(t[R][n]=!1),r=E(r,{enumerable:k(0,!1)})):(i(t,R)||j(t,R,k(1,{})),t[R][n]=!0),H(t,n,r)):j(t,n,r)},$=function(e,t){y(e);for(var n,r=v(t=w(t)),i=0,a=r.length;a>i;)Y(e,n=r[i++],t[n]);return e},J=function(e){var t=B.call(this,e=_(e,!0));return!(this===W&&i(z,e)&&!i(U,e))&&(!(t||!i(this,e)||!i(z,e)||i(this,R)&&this[R][e])||t)},Z=function(e,t){if(e=w(e),t=_(t,!0),e!==W||!i(z,t)||i(U,t)){var n=T(e,t);return!n||!i(z,t)||i(e,R)&&e[R][t]||(n.enumerable=!0),n}},Q=function(e){for(var t,n=M(w(e)),r=[],a=0;n.length>a;)i(z,t=n[a++])||t==R||t==u||r.push(t);return r},ee=function(e){for(var t,n=e===W,r=M(n?U:w(e)),a=[],o=0;r.length>o;)!i(z,t=r[o++])||n&&!i(W,t)||a.push(z[t]);return a};V||(s((F=function(){if(this instanceof F)throw TypeError("Symbol is not a constructor!");var e=d(arguments.length>0?arguments[0]:void 0),t=function t(n){this===W&&t.call(U,n),i(this,R)&&i(this[R],e)&&(this[R][e]=!1),H(this,e,k(1,n))};return a&&q&&H(W,e,{configurable:!0,set:t}),X(e)}).prototype,"toString",(function(){return this._k})),C.f=Z,O.f=Y,n(79).f=S.f=Q,n(106).f=J,A.f=ee,a&&!n(83)&&s(W,"propertyIsEnumerable",J,!0),p.f=function(e){return X(h(e))}),o(o.G+o.W+o.F*!V,{Symbol:F});for(var te="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ne=0;te.length>ne;)h(te[ne++]);for(var re=D(h.store),ie=0;re.length>ie;)m(re[ie++]);o(o.S+o.F*!V,"Symbol",{for:function(e){return i(L,e+="")?L[e]:L[e]=F(e)},keyFor:function(e){if(!K(e))throw TypeError(e+" is not a symbol!");for(var t in L)if(L[t]===e)return t},useSetter:function(){q=!0},useSimple:function(){q=!1}}),o(o.S+o.F*!V,"Object",{create:function(e,t){return void 0===t?E(e):$(E(e),t)},defineProperty:Y,defineProperties:$,getOwnPropertyDescriptor:Z,getOwnPropertyNames:Q,getOwnPropertySymbols:ee});var ae=c((function(){A.f(1)}));o(o.S+o.F*ae,"Object",{getOwnPropertySymbols:function(e){return A.f(x(e))}}),I&&o(o.S+o.F*(!V||c((function(){var e=F();return"[null]"!=N([e])||"{}"!=N({a:e})||"{}"!=N(Object(e))}))),"JSON",{stringify:function(e){for(var t,n,r=[e],i=1;arguments.length>i;)r.push(arguments[i++]);if(n=t=r[1],(b(t)||void 0!==e)&&!K(e))return g(t)||(t=function(e,t){if("function"==typeof n&&(t=n.call(this,e,t)),!K(t))return t}),r[1]=t,N.apply(I,r)}}),F.prototype[P]||n(42)(F.prototype,P,F.prototype.valueOf),f(F,"Symbol"),f(Math,"Math",!0),f(r.JSON,"JSON",!0)},function(e,t,n){n(577),n(574),n(573),n(572),n(571),n(570),n(569),n(568),n(567),n(566),n(565),n(564),n(563),n(562),n(561),n(560),n(559),n(558),n(557),n(556),n(555),n(554),n(553),n(552),n(551),n(550),n(549),n(548),n(547),n(546),n(545),n(544),n(543),n(542),n(541),n(540),n(539),n(538),n(537),n(536),n(535),n(534),n(533),n(531),n(530),n(529),n(528),n(527),n(526),n(525),n(524),n(523),n(522),n(521),n(520),n(519),n(518),n(517),n(516),n(515),n(514),n(513),n(512),n(511),n(510),n(509),n(508),n(507),n(506),n(505),n(504),n(503),n(502),n(501),n(500),n(499),n(498),n(496),n(495),n(493),n(492),n(491),n(490),n(489),n(488),n(487),n(485),n(484),n(483),n(482),n(481),n(480),n(479),n(478),n(477),n(476),n(475),n(474),n(473),n(155),n(472),n(220),n(471),n(219),n(470),n(469),n(468),n(467),n(218),n(464),n(463),n(462),n(461),n(460),n(459),n(458),n(457),n(456),n(455),n(454),n(453),n(452),n(451),n(450),n(449),n(448),n(447),n(446),n(445),n(444),n(443),n(442),n(441),n(440),n(439),n(438),n(437),n(436),e.exports=n(24)},function(e,t,n){"use strict";n(578),n(435),n(433),n(430),n(428),n(426),n(424),n(422),n(420),n(418),n(416),n(414),n(412),n(408)},function(e,t,n){"use strict";n(579);var r=function(e){return e&&e.__esModule?e:{default:e}}(n(407));r.default._babelPolyfill&&"undefined"!=typeof console&&console.warn&&console.warn("@babel/polyfill is loaded more than once on this page. This is probably not desirable/intended and may have consequences if different versions of the polyfills are applied sequentially. If you do need to load the polyfill more than once, use @babel/polyfill/noConflict instead to bypass the warning."),r.default._babelPolyfill=!0},function(e,t,n){n(580),e.exports=n(248)},function(e,t,n){"use strict";var r={},i={},a=34,o=10,s=13;function u(e){return new Function("d","return {"+e.map((function(e,t){return JSON.stringify(e)+": d["+t+'] || ""'})).join(",")+"}")}function c(e){var t=Object.create(null),n=[];return e.forEach((function(e){for(var r in e)r in t||n.push(t[r]=r)})),n}function l(e,t){var n=e+"",r=n.length;return r<t?new Array(t-r+1).join(0)+n:n}function f(e){var t=e.getUTCHours(),n=e.getUTCMinutes(),r=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":function(e){return e<0?"-"+l(-e,6):e>9999?"+"+l(e,6):l(e,4)}(e.getUTCFullYear())+"-"+l(e.getUTCMonth()+1,2)+"-"+l(e.getUTCDate(),2)+(i?"T"+l(t,2)+":"+l(n,2)+":"+l(r,2)+"."+l(i,3)+"Z":r?"T"+l(t,2)+":"+l(n,2)+":"+l(r,2)+"Z":n||t?"T"+l(t,2)+":"+l(n,2)+"Z":"")}t.a=function(e){var t=new RegExp('["'+e+"\n\r]"),n=e.charCodeAt(0);function l(e,t){var u,c=[],l=e.length,f=0,d=0,h=l<=0,p=!1;function m(){if(h)return i;if(p)return p=!1,r;var t,u,c=f;if(e.charCodeAt(c)===a){for(;f++<l&&e.charCodeAt(f)!==a||e.charCodeAt(++f)===a;);return(t=f)>=l?h=!0:(u=e.charCodeAt(f++))===o?p=!0:u===s&&(p=!0,e.charCodeAt(f)===o&&++f),e.slice(c+1,t-1).replace(/""/g,'"')}for(;f<l;){if((u=e.charCodeAt(t=f++))===o)p=!0;else if(u===s)p=!0,e.charCodeAt(f)===o&&++f;else if(u!==n)continue;return e.slice(c,t)}return h=!0,e.slice(c,l)}for(e.charCodeAt(l-1)===o&&--l,e.charCodeAt(l-1)===s&&--l;(u=m())!==i;){for(var v=[];u!==r&&u!==i;)v.push(u),u=m();t&&null==(v=t(v,d++))||c.push(v)}return c}function d(t,n){return t.map((function(t){return n.map((function(e){return p(t[e])})).join(e)}))}function h(t){return t.map(p).join(e)}function p(e){return null==e?"":e instanceof Date?f(e):t.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e}return{parse:function(e,t){var n,r,i=l(e,(function(e,i){if(n)return n(e,i-1);r=e,n=t?function(e,t){var n=u(e);return function(r,i){return t(n(r),i,e)}}(e,t):u(e)}));return i.columns=r||[],i},parseRows:l,format:function(t,n){return null==n&&(n=c(t)),[n.map(p).join(e)].concat(d(t,n)).join("\n")},formatBody:function(e,t){return null==t&&(t=c(e)),d(e,t).join("\n")},formatRows:function(e){return e.map(h).join("\n")},formatRow:h,formatValue:p}}}]).default},7721:function(e,t,n){var r;e.exports=(r=n(2791),function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t){e.exports=r},function(e,t,n){(function(t){e.exports=function e(t,n,r){function i(o,s){if(!n[o]){if(!t[o]){if(a)return a(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[o]={exports:{}};t[o][0].call(c.exports,(function(e){return i(t[o][1][e]||e)}),c,c.exports,e,t,n,r)}return n[o].exports}for(var a=!1,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,n){"use strict";n.byteLength=function(e){var t=c(e),n=t[0],r=t[1];return 3*(n+r)/4-r},n.toByteArray=function(e){var t,n,r=c(e),o=r[0],s=r[1],u=new a(function(e,t){return 3*(e+t)/4-t}(o,s)),l=0,f=0<s?o-4:o;for(n=0;n<f;n+=4)t=i[e.charCodeAt(n)]<<18|i[e.charCodeAt(n+1)]<<12|i[e.charCodeAt(n+2)]<<6|i[e.charCodeAt(n+3)],u[l++]=t>>16&255,u[l++]=t>>8&255,u[l++]=255&t;return 2===s&&(t=i[e.charCodeAt(n)]<<2|i[e.charCodeAt(n+1)]>>4,u[l++]=255&t),1===s&&(t=i[e.charCodeAt(n)]<<10|i[e.charCodeAt(n+1)]<<4|i[e.charCodeAt(n+2)]>>2,u[l++]=t>>8&255,u[l++]=255&t),u},n.fromByteArray=function(e){for(var t,n=e.length,i=n%3,a=[],o=0,s=n-i;o<s;o+=16383)a.push(l(e,o,s<o+16383?s:o+16383));return 1==i?(t=e[n-1],a.push(r[t>>2]+r[t<<4&63]+"==")):2==i&&(t=(e[n-2]<<8)+e[n-1],a.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"=")),a.join("")};for(var r=[],i=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,u=o.length;s<u;++s)r[s]=o[s],i[o.charCodeAt(s)]=s;function c(e){var t=e.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function l(e,t,n){for(var i,a,o=[],s=t;s<n;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),o.push(r[(a=i)>>18&63]+r[a>>12&63]+r[a>>6&63]+r[63&a]);return o.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},{}],2:[function(e,t,n){},{}],3:[function(e,t,n){arguments[4][2][0].apply(n,arguments)},{dup:2}],4:[function(e,t,n){(function(t){"use strict";var r=e("base64-js"),i=e("ieee754"),a="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;n.Buffer=t,n.SlowBuffer=function(e){return+e!=e&&(e=0),t.alloc(+e)},n.INSPECT_MAX_BYTES=50;var o=2147483647;function s(e){if(o<e)throw new RangeError('The value "'+e+'" is invalid for option "size"');var n=new Uint8Array(e);return Object.setPrototypeOf(n,t.prototype),n}function t(e,t,n){if("number"!=typeof e)return u(e,t,n);if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return l(e)}function u(e,n,r){if("string"==typeof e)return function(e,n){if("string"==typeof n&&""!==n||(n="utf8"),!t.isEncoding(n))throw new TypeError("Unknown encoding: "+n);var r=0|h(e,n),i=s(r),a=i.write(e,n);return a!==r&&(i=i.slice(0,a)),i}(e,n);if(ArrayBuffer.isView(e))return f(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(R(e,ArrayBuffer)||e&&R(e.buffer,ArrayBuffer))return function(e,n,r){if(n<0||e.byteLength<n)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<n+(r||0))throw new RangeError('"length" is outside of buffer bounds');var i;return i=void 0===n&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,n):new Uint8Array(e,n,r),Object.setPrototypeOf(i,t.prototype),i}(e,n,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var i=e.valueOf&&e.valueOf();if(null!=i&&i!==e)return t.from(i,n,r);var a=function(e){if(t.isBuffer(e)){var n=0|d(e.length),r=s(n);return 0===r.length||e.copy(r,0,0,n),r}return void 0!==e.length?"number"!=typeof e.length||P(e.length)?s(0):f(e):"Buffer"===e.type&&Array.isArray(e.data)?f(e.data):void 0}(e);if(a)return a;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return t.from(e[Symbol.toPrimitive]("string"),n,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function c(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function l(e){return c(e),s(e<0?0:0|d(e))}function f(e){for(var t=e.length<0?0:0|d(e.length),n=s(t),r=0;r<t;r+=1)n[r]=255&e[r];return n}function d(e){if(o<=e)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|e}function h(e,n){if(t.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||R(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,i=2<arguments.length&&!0===arguments[2];if(!i&&0===r)return 0;for(var a=!1;;)switch(n){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return F(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return I(e).length;default:if(a)return i?-1:F(e).length;n=(""+n).toLowerCase(),a=!0}}function p(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function m(e,n,r,i,a){if(0===e.length)return-1;if("string"==typeof r?(i=r,r=0):2147483647<r?r=2147483647:r<-2147483648&&(r=-2147483648),P(r=+r)&&(r=a?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(a)return-1;r=e.length-1}else if(r<0){if(!a)return-1;r=0}if("string"==typeof n&&(n=t.from(n,i)),t.isBuffer(n))return 0===n.length?-1:v(e,n,r,i,a);if("number"==typeof n)return n&=255,"function"==typeof Uint8Array.prototype.indexOf?a?Uint8Array.prototype.indexOf.call(e,n,r):Uint8Array.prototype.lastIndexOf.call(e,n,r):v(e,[n],r,i,a);throw new TypeError("val must be string, number or Buffer")}function v(e,t,n,r,i){var a,o=1,s=e.length,u=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s/=o=2,u/=2,n/=2}function c(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){var l=-1;for(a=n;a<s;a++)if(c(e,a)===c(t,-1===l?0:a-l)){if(-1===l&&(l=a),a-l+1===u)return l*o}else-1!==l&&(a-=a-l),l=-1}else for(s<n+u&&(n=s-u),a=n;0<=a;a--){for(var f=!0,d=0;d<u;d++)if(c(e,a+d)!==c(t,d)){f=!1;break}if(f)return a}return-1}function g(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?i<(r=Number(r))&&(r=i):r=i;var a=t.length;a/2<r&&(r=a/2);for(var o=0;o<r;++o){var s=parseInt(t.substr(2*o,2),16);if(P(s))return o;e[n+o]=s}return o}function y(e,t,n,r){return N(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function b(e,t,n,r){return N(function(e,t){for(var n,r,i,a=[],o=0;o<e.length&&!((t-=2)<0);++o)r=(n=e.charCodeAt(o))>>8,i=n%256,a.push(i),a.push(r);return a}(t,e.length-n),e,n,r)}function x(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function w(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var a,o,s,u,c=e[i],l=null,f=239<c?4:223<c?3:191<c?2:1;if(i+f<=n)switch(f){case 1:c<128&&(l=c);break;case 2:128==(192&(a=e[i+1]))&&127<(u=(31&c)<<6|63&a)&&(l=u);break;case 3:a=e[i+1],o=e[i+2],128==(192&a)&&128==(192&o)&&2047<(u=(15&c)<<12|(63&a)<<6|63&o)&&(u<55296||57343<u)&&(l=u);break;case 4:a=e[i+1],o=e[i+2],s=e[i+3],128==(192&a)&&128==(192&o)&&128==(192&s)&&65535<(u=(15&c)<<18|(63&a)<<12|(63&o)<<6|63&s)&&u<1114112&&(l=u)}null===l?(l=65533,f=1):65535<l&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),i+=f}return function(e){var t=e.length;if(t<=_)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=_));return n}(r)}n.kMaxLength=o,(t.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}())||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(t.prototype,"parent",{enumerable:!0,get:function(){if(t.isBuffer(this))return this.buffer}}),Object.defineProperty(t.prototype,"offset",{enumerable:!0,get:function(){if(t.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&t[Symbol.species]===t&&Object.defineProperty(t,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),t.poolSize=8192,t.from=function(e,t,n){return u(e,t,n)},Object.setPrototypeOf(t.prototype,Uint8Array.prototype),Object.setPrototypeOf(t,Uint8Array),t.alloc=function(e,t,n){return i=t,a=n,c(r=e),r<=0?s(r):void 0!==i?"string"==typeof a?s(r).fill(i,a):s(r).fill(i):s(r);var r,i,a},t.allocUnsafe=function(e){return l(e)},t.allocUnsafeSlow=function(e){return l(e)},t.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==t.prototype},t.compare=function(e,n){if(R(e,Uint8Array)&&(e=t.from(e,e.offset,e.byteLength)),R(n,Uint8Array)&&(n=t.from(n,n.offset,n.byteLength)),!t.isBuffer(e)||!t.isBuffer(n))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===n)return 0;for(var r=e.length,i=n.length,a=0,o=Math.min(r,i);a<o;++a)if(e[a]!==n[a]){r=e[a],i=n[a];break}return r<i?-1:i<r?1:0},t.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},t.concat=function(e,n){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return t.alloc(0);var r;if(void 0===n)for(r=n=0;r<e.length;++r)n+=e[r].length;var i=t.allocUnsafe(n),a=0;for(r=0;r<e.length;++r){var o=e[r];if(R(o,Uint8Array)&&(o=t.from(o)),!t.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(i,a),a+=o.length}return i},t.byteLength=h,t.prototype._isBuffer=!0,t.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)p(this,t,t+1);return this},t.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)p(this,t,t+3),p(this,t+1,t+2);return this},t.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)p(this,t,t+7),p(this,t+1,t+6),p(this,t+2,t+5),p(this,t+3,t+4);return this},t.prototype.toLocaleString=t.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?w(this,0,e):function(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e=e||"utf8";;)switch(e){case"hex":return S(this,t,n);case"utf8":case"utf-8":return w(this,t,n);case"ascii":return k(this,t,n);case"latin1":case"binary":return E(this,t,n);case"base64":return x(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}.apply(this,arguments)},t.prototype.equals=function(e){if(!t.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===t.compare(this,e)},t.prototype.inspect=function(){var e="",t=n.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},a&&(t.prototype[a]=t.prototype.inspect),t.prototype.compare=function(e,n,r,i,a){if(R(e,Uint8Array)&&(e=t.from(e,e.offset,e.byteLength)),!t.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===n&&(n=0),void 0===r&&(r=e?e.length:0),void 0===i&&(i=0),void 0===a&&(a=this.length),n<0||r>e.length||i<0||a>this.length)throw new RangeError("out of range index");if(a<=i&&r<=n)return 0;if(a<=i)return-1;if(r<=n)return 1;if(this===e)return 0;for(var o=(a>>>=0)-(i>>>=0),s=(r>>>=0)-(n>>>=0),u=Math.min(o,s),c=this.slice(i,a),l=e.slice(n,r),f=0;f<u;++f)if(c[f]!==l[f]){o=c[f],s=l[f];break}return o<s?-1:s<o?1:0},t.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},t.prototype.indexOf=function(e,t,n){return m(this,e,t,n,!0)},t.prototype.lastIndexOf=function(e,t,n){return m(this,e,t,n,!1)},t.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||i<n)&&(n=i),0<e.length&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r=r||"utf8";for(var a,o,s,u,c=!1;;)switch(r){case"hex":return g(this,e,t,n);case"utf8":case"utf-8":return s=t,u=n,N(F(e,this.length-s),this,s,u);case"ascii":case"latin1":case"binary":return y(this,e,t,n);case"base64":return a=t,o=n,N(I(e),this,a,o);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return b(this,e,t,n);default:if(c)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),c=!0}},t.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var _=4096;function k(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function E(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function S(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||r<n)&&(n=r);for(var i="",a=t;a<n;++a)i+=B[e[a]];return i}function C(e,t,n){for(var r=e.slice(t,n),i="",a=0;a<r.length;a+=2)i+=String.fromCharCode(r[a]+256*r[a+1]);return i}function A(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(n<e+t)throw new RangeError("Trying to access beyond buffer length")}function O(e,n,r,i,a,o){if(!t.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(a<n||n<o)throw new RangeError('"value" argument is out of bounds');if(r+i>e.length)throw new RangeError("Index out of range")}function D(e,t,n,r){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function T(e,t,n,r,a){return t=+t,n>>>=0,a||D(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function j(e,t,n,r,a){return t=+t,n>>>=0,a||D(e,0,n,8),i.write(e,t,n,r,52,8),n+8}t.prototype.slice=function(e,n){var r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):r<e&&(e=r),(n=void 0===n?r:~~n)<0?(n+=r)<0&&(n=0):r<n&&(n=r),n<e&&(n=e);var i=this.subarray(e,n);return Object.setPrototypeOf(i,t.prototype),i},t.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||A(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r},t.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||A(e,t,this.length);for(var r=this[e+--t],i=1;0<t&&(i*=256);)r+=this[e+--t]*i;return r},t.prototype.readUInt8=function(e,t){return e>>>=0,t||A(e,1,this.length),this[e]},t.prototype.readUInt16LE=function(e,t){return e>>>=0,t||A(e,2,this.length),this[e]|this[e+1]<<8},t.prototype.readUInt16BE=function(e,t){return e>>>=0,t||A(e,2,this.length),this[e]<<8|this[e+1]},t.prototype.readUInt32LE=function(e,t){return e>>>=0,t||A(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},t.prototype.readUInt32BE=function(e,t){return e>>>=0,t||A(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},t.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||A(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return(i*=128)<=r&&(r-=Math.pow(2,8*t)),r},t.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||A(e,t,this.length);for(var r=t,i=1,a=this[e+--r];0<r&&(i*=256);)a+=this[e+--r]*i;return(i*=128)<=a&&(a-=Math.pow(2,8*t)),a},t.prototype.readInt8=function(e,t){return e>>>=0,t||A(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},t.prototype.readInt16LE=function(e,t){e>>>=0,t||A(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},t.prototype.readInt16BE=function(e,t){e>>>=0,t||A(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},t.prototype.readInt32LE=function(e,t){return e>>>=0,t||A(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},t.prototype.readInt32BE=function(e,t){return e>>>=0,t||A(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},t.prototype.readFloatLE=function(e,t){return e>>>=0,t||A(e,4,this.length),i.read(this,e,!0,23,4)},t.prototype.readFloatBE=function(e,t){return e>>>=0,t||A(e,4,this.length),i.read(this,e,!1,23,4)},t.prototype.readDoubleLE=function(e,t){return e>>>=0,t||A(e,8,this.length),i.read(this,e,!0,52,8)},t.prototype.readDoubleBE=function(e,t){return e>>>=0,t||A(e,8,this.length),i.read(this,e,!1,52,8)},t.prototype.writeUIntLE=function(e,t,n,r){e=+e,t>>>=0,n>>>=0,r||O(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,a=0;for(this[t]=255&e;++a<n&&(i*=256);)this[t+a]=e/i&255;return t+n},t.prototype.writeUIntBE=function(e,t,n,r){e=+e,t>>>=0,n>>>=0,r||O(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,a=1;for(this[t+i]=255&e;0<=--i&&(a*=256);)this[t+i]=e/a&255;return t+n},t.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||O(this,e,t,1,255,0),this[t]=255&e,t+1},t.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||O(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},t.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||O(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},t.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||O(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},t.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||O(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},t.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var i=Math.pow(2,8*n-1);O(this,e,t,n,i-1,-i)}var a=0,o=1,s=0;for(this[t]=255&e;++a<n&&(o*=256);)e<0&&0===s&&0!==this[t+a-1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+n},t.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var i=Math.pow(2,8*n-1);O(this,e,t,n,i-1,-i)}var a=n-1,o=1,s=0;for(this[t+a]=255&e;0<=--a&&(o*=256);)e<0&&0===s&&0!==this[t+a+1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+n},t.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||O(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},t.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||O(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},t.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||O(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},t.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||O(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},t.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||O(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},t.prototype.writeFloatLE=function(e,t,n){return T(this,e,t,!0,n)},t.prototype.writeFloatBE=function(e,t,n){return T(this,e,t,!1,n)},t.prototype.writeDoubleLE=function(e,t,n){return j(this,e,t,!0,n)},t.prototype.writeDoubleBE=function(e,t,n){return j(this,e,t,!1,n)},t.prototype.copy=function(e,n,r,i){if(!t.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r=r||0,i||0===i||(i=this.length),n>=e.length&&(n=e.length),n=n||0,0<i&&i<r&&(i=r),i===r)return 0;if(0===e.length||0===this.length)return 0;if(n<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-n<i-r&&(i=e.length-n+r);var a=i-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(n,r,i);else if(this===e&&r<n&&n<i)for(var o=a-1;0<=o;--o)e[o+n]=this[o+r];else Uint8Array.prototype.set.call(e,this.subarray(r,i),n);return a},t.prototype.fill=function(e,n,r,i){if("string"==typeof e){if("string"==typeof n?(i=n,n=0,r=this.length):"string"==typeof r&&(i=r,r=this.length),void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!t.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(1===e.length){var a=e.charCodeAt(0);("utf8"===i&&a<128||"latin1"===i)&&(e=a)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(n<0||this.length<n||this.length<r)throw new RangeError("Out of range index");if(r<=n)return this;var o;if(n>>>=0,r=void 0===r?this.length:r>>>0,"number"==typeof(e=e||0))for(o=n;o<r;++o)this[o]=e;else{var s=t.isBuffer(e)?e:t.from(e,i),u=s.length;if(0===u)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(o=0;o<r-n;++o)this[o+n]=s[o%u]}return this};var M=/[^+/0-9A-Za-z-_]/g;function F(e,t){var n;t=t||1/0;for(var r=e.length,i=null,a=[],o=0;o<r;++o){if(55295<(n=e.charCodeAt(o))&&n<57344){if(!i){if(56319<n){-1<(t-=3)&&a.push(239,191,189);continue}if(o+1===r){-1<(t-=3)&&a.push(239,191,189);continue}i=n;continue}if(n<56320){-1<(t-=3)&&a.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&-1<(t-=3)&&a.push(239,191,189);if(i=null,n<128){if(--t<0)break;a.push(n)}else if(n<2048){if((t-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return a}function I(e){return r.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(M,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function N(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}function R(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function P(e){return e!=e}var B=function(){for(var e="0123456789abcdef",t=new Array(256),n=0;n<16;++n)for(var r=16*n,i=0;i<16;++i)t[r+i]=e[n]+e[i];return t}()}).call(this,e("buffer").Buffer)},{"base64-js":1,buffer:4,ieee754:233}],5:[function(e,t,n){t.exports=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e}},{}],6:[function(e,t,n){var r=e("../internals/is-object");t.exports=function(e){if(!r(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype");return e}},{"../internals/is-object":73}],7:[function(e,t,n){var r=e("../internals/well-known-symbol"),i=e("../internals/object-create"),a=e("../internals/object-define-property"),o=r("unscopables"),s=Array.prototype;null==s[o]&&a.f(s,o,{configurable:!0,value:i(null)}),t.exports=function(e){s[o][e]=!0}},{"../internals/object-create":89,"../internals/object-define-property":91,"../internals/well-known-symbol":145}],8:[function(e,t,n){"use strict";var r=e("../internals/string-multibyte").charAt;t.exports=function(e,t,n){return t+(n?r(e,t).length:1)}},{"../internals/string-multibyte":122}],9:[function(e,t,n){t.exports=function(e,t,n){if(!(e instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e}},{}],10:[function(e,t,n){var r=e("../internals/is-object");t.exports=function(e){if(!r(e))throw TypeError(String(e)+" is not an object");return e}},{"../internals/is-object":73}],11:[function(e,t,n){t.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},{}],12:[function(e,t,n){"use strict";function r(e){return u(e)&&c(T,l(e))}var i,a=e("../internals/array-buffer-native"),o=e("../internals/descriptors"),s=e("../internals/global"),u=e("../internals/is-object"),c=e("../internals/has"),l=e("../internals/classof"),f=e("../internals/create-non-enumerable-property"),d=e("../internals/redefine"),h=e("../internals/object-define-property").f,p=e("../internals/object-get-prototype-of"),m=e("../internals/object-set-prototype-of"),v=e("../internals/well-known-symbol"),g=e("../internals/uid"),y=s.Int8Array,b=y&&y.prototype,x=s.Uint8ClampedArray,w=x&&x.prototype,_=y&&p(y),k=b&&p(b),E=Object.prototype,S=E.isPrototypeOf,C=v("toStringTag"),A=g("TYPED_ARRAY_TAG"),O=a&&!!m&&"Opera"!==l(s.opera),D=!1,T={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8};for(i in T)s[i]||(O=!1);if((!O||"function"!=typeof _||_===Function.prototype)&&(_=function(){throw TypeError("Incorrect invocation")},O))for(i in T)s[i]&&m(s[i],_);if((!O||!k||k===E)&&(k=_.prototype,O))for(i in T)s[i]&&m(s[i].prototype,k);if(O&&p(w)!==k&&m(w,k),o&&!c(k,C))for(i in D=!0,h(k,C,{get:function(){return u(this)?this[A]:void 0}}),T)s[i]&&f(s[i],A,i);t.exports={NATIVE_ARRAY_BUFFER_VIEWS:O,TYPED_ARRAY_TAG:D&&A,aTypedArray:function(e){if(r(e))return e;throw TypeError("Target is not a typed array")},aTypedArrayConstructor:function(e){if(m){if(S.call(_,e))return e}else for(var t in T)if(c(T,i)){var n=s[t];if(n&&(e===n||S.call(n,e)))return e}throw TypeError("Target is not a typed array constructor")},exportTypedArrayMethod:function(e,t,n){if(o){if(n)for(var r in T){var i=s[r];i&&c(i.prototype,e)&&delete i.prototype[e]}k[e]&&!n||d(k,e,n?t:O&&b[e]||t)}},exportTypedArrayStaticMethod:function(e,t,n){var r,i;if(o){if(m){if(n)for(r in T)(i=s[r])&&c(i,e)&&delete i[e];if(_[e]&&!n)return;try{return d(_,e,n?t:O&&y[e]||t)}catch(e){}}for(r in T)!(i=s[r])||i[e]&&!n||d(i,e,t)}},isView:function(e){var t=l(e);return"DataView"===t||c(T,t)},isTypedArray:r,TypedArray:_,TypedArrayPrototype:k}},{"../internals/array-buffer-native":11,"../internals/classof":29,"../internals/create-non-enumerable-property":37,"../internals/descriptors":42,"../internals/global":58,"../internals/has":59,"../internals/is-object":73,"../internals/object-define-property":91,"../internals/object-get-prototype-of":96,"../internals/object-set-prototype-of":100,"../internals/redefine":107,"../internals/uid":142,"../internals/well-known-symbol":145}],13:[function(e,t,n){"use strict";function r(e){return[255&e]}function i(e){return[255&e,e>>8&255]}function a(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]}function o(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]}function s(e){return W(e,23,4)}function u(e){return W(e,52,8)}function c(e,t){C(e[I],t,{get:function(){return T(this)[t]}})}function l(e,t,n,r){var i=w(n),a=T(e);if(i+t>a.byteLength)throw U(N);var o=T(a.buffer).bytes,s=i+a.byteOffset,u=o.slice(s,s+t);return r?u:u.reverse()}function f(e,t,n,r,i,a){var o=w(n),s=T(e);if(o+t>s.byteLength)throw U(N);for(var u=T(s.buffer).bytes,c=o+s.byteOffset,l=r(+i),f=0;f<t;f++)u[c+f]=l[a?f:t-f-1]}var d=e("../internals/global"),h=e("../internals/descriptors"),p=e("../internals/array-buffer-native"),m=e("../internals/create-non-enumerable-property"),v=e("../internals/redefine-all"),g=e("../internals/fails"),y=e("../internals/an-instance"),b=e("../internals/to-integer"),x=e("../internals/to-length"),w=e("../internals/to-index"),_=e("../internals/ieee754"),k=e("../internals/object-get-prototype-of"),E=e("../internals/object-set-prototype-of"),S=e("../internals/object-get-own-property-names").f,C=e("../internals/object-define-property").f,A=e("../internals/array-fill"),O=e("../internals/set-to-string-tag"),D=e("../internals/internal-state"),T=D.get,j=D.set,M="ArrayBuffer",F="DataView",I="prototype",N="Wrong index",R=d[M],P=R,B=d[F],L=B&&B[I],z=Object.prototype,U=d.RangeError,W=_.pack,V=_.unpack;if(p){if(!g((function(){R(1)}))||!g((function(){new R(-1)}))||g((function(){return new R,new R(1.5),new R(NaN),R.name!=M}))){for(var G,q=(P=function(e){return y(this,P),new R(w(e))})[I]=R[I],H=S(R),X=0;H.length>X;)(G=H[X++])in P||m(P,G,R[G]);q.constructor=P}E&&k(L)!==z&&E(L,z);var K=new B(new P(2)),Y=L.setInt8;K.setInt8(0,2147483648),K.setInt8(1,2147483649),!K.getInt8(0)&&K.getInt8(1)||v(L,{setInt8:function(e,t){Y.call(this,e,t<<24>>24)},setUint8:function(e,t){Y.call(this,e,t<<24>>24)}},{unsafe:!0})}else P=function(e){y(this,P,M);var t=w(e);j(this,{bytes:A.call(new Array(t),0),byteLength:t}),h||(this.byteLength=t)},B=function(e,t,n){y(this,B,F),y(e,P,F);var r=T(e).byteLength,i=b(t);if(i<0||r<i)throw U("Wrong offset");if(r<i+(n=void 0===n?r-i:x(n)))throw U("Wrong length");j(this,{buffer:e,byteLength:n,byteOffset:i}),h||(this.buffer=e,this.byteLength=n,this.byteOffset=i)},h&&(c(P,"byteLength"),c(B,"buffer"),c(B,"byteLength"),c(B,"byteOffset")),v(B[I],{getInt8:function(e){return l(this,1,e)[0]<<24>>24},getUint8:function(e){return l(this,1,e)[0]},getInt16:function(e,t){var n=l(this,2,e,1<arguments.length?t:void 0);return(n[1]<<8|n[0])<<16>>16},getUint16:function(e,t){var n=l(this,2,e,1<arguments.length?t:void 0);return n[1]<<8|n[0]},getInt32:function(e,t){return o(l(this,4,e,1<arguments.length?t:void 0))},getUint32:function(e,t){return o(l(this,4,e,1<arguments.length?t:void 0))>>>0},getFloat32:function(e,t){return V(l(this,4,e,1<arguments.length?t:void 0),23)},getFloat64:function(e,t){return V(l(this,8,e,1<arguments.length?t:void 0),52)},setInt8:function(e,t){f(this,1,e,r,t)},setUint8:function(e,t){f(this,1,e,r,t)},setInt16:function(e,t,n){f(this,2,e,i,t,2<arguments.length?n:void 0)},setUint16:function(e,t,n){f(this,2,e,i,t,2<arguments.length?n:void 0)},setInt32:function(e,t,n){f(this,4,e,a,t,2<arguments.length?n:void 0)},setUint32:function(e,t,n){f(this,4,e,a,t,2<arguments.length?n:void 0)},setFloat32:function(e,t,n){f(this,4,e,s,t,2<arguments.length?n:void 0)},setFloat64:function(e,t,n){f(this,8,e,u,t,2<arguments.length?n:void 0)}});O(P,M),O(B,F),t.exports={ArrayBuffer:P,DataView:B}},{"../internals/an-instance":9,"../internals/array-buffer-native":11,"../internals/array-fill":15,"../internals/create-non-enumerable-property":37,"../internals/descriptors":42,"../internals/fails":50,"../internals/global":58,"../internals/ieee754":64,"../internals/internal-state":69,"../internals/object-define-property":91,"../internals/object-get-own-property-names":94,"../internals/object-get-prototype-of":96,"../internals/object-set-prototype-of":100,"../internals/redefine-all":106,"../internals/set-to-string-tag":116,"../internals/to-index":130,"../internals/to-integer":132,"../internals/to-length":133}],14:[function(e,t,n){"use strict";var r=e("../internals/to-object"),i=e("../internals/to-absolute-index"),a=e("../internals/to-length"),o=Math.min;t.exports=[].copyWithin||function(e,t,n){var s=r(this),u=a(s.length),c=i(e,u),l=i(t,u),f=2<arguments.length?n:void 0,d=o((void 0===f?u:i(f,u))-l,u-c),h=1;for(l<c&&c<l+d&&(h=-1,l+=d-1,c+=d-1);0<d--;)l in s?s[c]=s[l]:delete s[c],c+=h,l+=h;return s}},{"../internals/to-absolute-index":129,"../internals/to-length":133,"../internals/to-object":134}],15:[function(e,t,n){"use strict";var r=e("../internals/to-object"),i=e("../internals/to-absolute-index"),a=e("../internals/to-length");t.exports=function(e,t,n){for(var o=r(this),s=a(o.length),u=arguments.length,c=i(1<u?t:void 0,s),l=2<u?n:void 0,f=void 0===l?s:i(l,s);c<f;)o[c++]=e;return o}},{"../internals/to-absolute-index":129,"../internals/to-length":133,"../internals/to-object":134}],16:[function(e,t,n){"use strict";var r=e("../internals/array-iteration").forEach,i=e("../internals/array-method-is-strict"),a=e("../internals/array-method-uses-to-length"),o=i("forEach"),s=a("forEach");t.exports=o&&s?[].forEach:function(e,t){return r(this,e,1<arguments.length?t:void 0)}},{"../internals/array-iteration":19,"../internals/array-method-is-strict":22,"../internals/array-method-uses-to-length":23}],17:[function(e,t,n){"use strict";var r=e("../internals/function-bind-context"),i=e("../internals/to-object"),a=e("../internals/call-with-safe-iteration-closing"),o=e("../internals/is-array-iterator-method"),s=e("../internals/to-length"),u=e("../internals/create-property"),c=e("../internals/get-iterator-method");t.exports=function(e,t,n){var l,f,d,h,p,m,v=i(e),g="function"==typeof this?this:Array,y=arguments.length,b=1<y?t:void 0,x=void 0!==b,w=c(v),_=0;if(x&&(b=r(b,2<y?n:void 0,2)),null==w||g==Array&&o(w))for(f=new g(l=s(v.length));_<l;_++)m=x?b(v[_],_):v[_],u(f,_,m);else for(p=(h=w.call(v)).next,f=new g;!(d=p.call(h)).done;_++)m=x?a(h,b,[d.value,_],!0):d.value,u(f,_,m);return f.length=_,f}},{"../internals/call-with-safe-iteration-closing":26,"../internals/create-property":39,"../internals/function-bind-context":53,"../internals/get-iterator-method":56,"../internals/is-array-iterator-method":70,"../internals/to-length":133,"../internals/to-object":134}],18:[function(e,t,n){function r(e){return function(t,n,r){var s,u=i(t),c=a(u.length),l=o(r,c);if(e&&n!=n){for(;l<c;)if((s=u[l++])!=s)return!0}else for(;l<c;l++)if((e||l in u)&&u[l]===n)return e||l||0;return!e&&-1}}var i=e("../internals/to-indexed-object"),a=e("../internals/to-length"),o=e("../internals/to-absolute-index");t.exports={includes:r(!0),indexOf:r(!1)}},{"../internals/to-absolute-index":129,"../internals/to-indexed-object":131,"../internals/to-length":133}],19:[function(e,t,n){function r(e){var t=1==e,n=2==e,r=3==e,l=4==e,f=6==e,d=5==e||f;return function(h,p,m,v){for(var g,y,b=o(h),x=a(b),w=i(p,m,3),_=s(x.length),k=0,E=v||u,S=t?E(h,_):n?E(h,0):void 0;k<_;k++)if((d||k in x)&&(y=w(g=x[k],k,b),e))if(t)S[k]=y;else if(y)switch(e){case 3:return!0;case 5:return g;case 6:return k;case 2:c.call(S,g)}else if(l)return!1;return f?-1:r||l?l:S}}var i=e("../internals/function-bind-context"),a=e("../internals/indexed-object"),o=e("../internals/to-object"),s=e("../internals/to-length"),u=e("../internals/array-species-create"),c=[].push;t.exports={forEach:r(0),map:r(1),filter:r(2),some:r(3),every:r(4),find:r(5),findIndex:r(6)}},{"../internals/array-species-create":25,"../internals/function-bind-context":53,"../internals/indexed-object":65,"../internals/to-length":133,"../internals/to-object":134}],20:[function(e,t,n){"use strict";var r=e("../internals/to-indexed-object"),i=e("../internals/to-integer"),a=e("../internals/to-length"),o=e("../internals/array-method-is-strict"),s=e("../internals/array-method-uses-to-length"),u=Math.min,c=[].lastIndexOf,l=!!c&&1/[1].lastIndexOf(1,-0)<0,f=o("lastIndexOf"),d=s("indexOf",{ACCESSORS:!0,1:0}),h=l||!f||!d;t.exports=h?function(e,t){if(l)return c.apply(this,arguments)||0;var n=r(this),o=a(n.length),s=o-1;for(1<arguments.length&&(s=u(s,i(t))),s<0&&(s=o+s);0<=s;s--)if(s in n&&n[s]===e)return s||0;return-1}:c},{"../internals/array-method-is-strict":22,"../internals/array-method-uses-to-length":23,"../internals/to-indexed-object":131,"../internals/to-integer":132,"../internals/to-length":133}],21:[function(e,t,n){var r=e("../internals/fails"),i=e("../internals/well-known-symbol"),a=e("../internals/engine-v8-version"),o=i("species");t.exports=function(e){return 51<=a||!r((function(){var t=[];return(t.constructor={})[o]=function(){return{foo:1}},1!==t[e](Boolean).foo}))}},{"../internals/engine-v8-version":47,"../internals/fails":50,"../internals/well-known-symbol":145}],22:[function(e,t,n){"use strict";var r=e("../internals/fails");t.exports=function(e,t){var n=[][e];return!!n&&r((function(){n.call(null,t||function(){throw 1},1)}))}},{"../internals/fails":50}],23:[function(e,t,n){function r(e){throw e}var i=e("../internals/descriptors"),a=e("../internals/fails"),o=e("../internals/has"),s=Object.defineProperty,u={};t.exports=function(e,t){if(o(u,e))return u[e];var n=[][e],c=!!o(t=t||{},"ACCESSORS")&&t.ACCESSORS,l=o(t,0)?t[0]:r,f=o(t,1)?t[1]:void 0;return u[e]=!!n&&!a((function(){if(c&&!i)return!0;var e={length:-1};c?s(e,1,{enumerable:!0,get:r}):e[1]=1,n.call(e,l,f)}))}},{"../internals/descriptors":42,"../internals/fails":50,"../internals/has":59}],24:[function(e,t,n){function r(e){return function(t,n,r,u){i(n);var c=a(t),l=o(c),f=s(c.length),d=e?f-1:0,h=e?-1:1;if(r<2)for(;;){if(d in l){u=l[d],d+=h;break}if(d+=h,e?d<0:f<=d)throw TypeError("Reduce of empty array with no initial value")}for(;e?0<=d:d<f;d+=h)d in l&&(u=n(u,l[d],d,c));return u}}var i=e("../internals/a-function"),a=e("../internals/to-object"),o=e("../internals/indexed-object"),s=e("../internals/to-length");t.exports={left:r(!1),right:r(!0)}},{"../internals/a-function":5,"../internals/indexed-object":65,"../internals/to-length":133,"../internals/to-object":134}],25:[function(e,t,n){var r=e("../internals/is-object"),i=e("../internals/is-array"),a=e("../internals/well-known-symbol")("species");t.exports=function(e,t){var n;return i(e)&&("function"!=typeof(n=e.constructor)||n!==Array&&!i(n.prototype)?r(n)&&null===(n=n[a])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===t?0:t)}},{"../internals/is-array":71,"../internals/is-object":73,"../internals/well-known-symbol":145}],26:[function(e,t,n){var r=e("../internals/an-object");t.exports=function(e,t,n,i){try{return i?t(r(n)[0],n[1]):t(n)}catch(t){var a=e.return;throw void 0!==a&&r(a.call(e)),t}}},{"../internals/an-object":10}],27:[function(e,t,n){var r=e("../internals/well-known-symbol")("iterator"),i=!1;try{var a=0,o={next:function(){return{done:!!a++}},return:function(){i=!0}};o[r]=function(){return this},Array.from(o,(function(){throw 2}))}catch(e){}t.exports=function(e,t){if(!t&&!i)return!1;var n=!1;try{var a={};a[r]=function(){return{next:function(){return{done:n=!0}}}},e(a)}catch(e){}return n}},{"../internals/well-known-symbol":145}],28:[function(e,t,n){var r={}.toString;t.exports=function(e){return r.call(e).slice(8,-1)}},{}],29:[function(e,t,n){var r=e("../internals/to-string-tag-support"),i=e("../internals/classof-raw"),a=e("../internals/well-known-symbol")("toStringTag"),o="Arguments"==i(function(){return arguments}());t.exports=r?i:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),a))?n:o?i(t):"Object"==(r=i(t))&&"function"==typeof t.callee?"Arguments":r}},{"../internals/classof-raw":28,"../internals/to-string-tag-support":138,"../internals/well-known-symbol":145}],30:[function(e,t,n){"use strict";var r=e("../internals/object-define-property").f,i=e("../internals/object-create"),a=e("../internals/redefine-all"),o=e("../internals/function-bind-context"),s=e("../internals/an-instance"),u=e("../internals/iterate"),c=e("../internals/define-iterator"),l=e("../internals/set-species"),f=e("../internals/descriptors"),d=e("../internals/internal-metadata").fastKey,h=e("../internals/internal-state"),p=h.set,m=h.getterFor;t.exports={getConstructor:function(e,t,n,c){function l(e,t,n){var r,i,a=v(e),o=g(e,t);return o?o.value=n:(a.last=o={index:i=d(t,!0),key:t,value:n,previous:r=a.last,next:void 0,removed:!1},a.first||(a.first=o),r&&(r.next=o),f?a.size++:e.size++,"F"!==i&&(a.index[i]=o)),e}var h=e((function(e,r){s(e,h,t),p(e,{type:t,index:i(null),first:void 0,last:void 0,size:0}),f||(e.size=0),null!=r&&u(r,e[c],e,n)})),v=m(t),g=function(e,t){var n,r=v(e),i=d(t);if("F"!==i)return r.index[i];for(n=r.first;n;n=n.next)if(n.key==t)return n};return a(h.prototype,{clear:function(){for(var e=v(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,f?e.size=0:this.size=0},delete:function(e){var t=v(this),n=g(this,e);if(n){var r=n.next,i=n.previous;delete t.index[n.index],n.removed=!0,i&&(i.next=r),r&&(r.previous=i),t.first==n&&(t.first=r),t.last==n&&(t.last=i),f?t.size--:this.size--}return!!n},forEach:function(e,t){for(var n,r=v(this),i=o(e,1<arguments.length?t:void 0,3);n=n?n.next:r.first;)for(i(n.value,n.key,this);n&&n.removed;)n=n.previous},has:function(e){return!!g(this,e)}}),a(h.prototype,n?{get:function(e){var t=g(this,e);return t&&t.value},set:function(e,t){return l(this,0===e?0:e,t)}}:{add:function(e){return l(this,e=0===e?0:e,e)}}),f&&r(h.prototype,"size",{get:function(){return v(this).size}}),h},setStrong:function(e,t,n){var r=t+" Iterator",i=m(t),a=m(r);c(e,t,(function(e,t){p(this,{type:r,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=a(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:{value:e.target=void 0,done:!0}}),n?"entries":"values",!n,!0),l(t)}}},{"../internals/an-instance":9,"../internals/define-iterator":40,"../internals/descriptors":42,"../internals/function-bind-context":53,"../internals/internal-metadata":68,"../internals/internal-state":69,"../internals/iterate":76,"../internals/object-create":89,"../internals/object-define-property":91,"../internals/redefine-all":106,"../internals/set-species":115}],31:[function(e,t,n){"use strict";var r=e("../internals/export"),i=e("../internals/global"),a=e("../internals/is-forced"),o=e("../internals/redefine"),s=e("../internals/internal-metadata"),u=e("../internals/iterate"),c=e("../internals/an-instance"),l=e("../internals/is-object"),f=e("../internals/fails"),d=e("../internals/check-correctness-of-iteration"),h=e("../internals/set-to-string-tag"),p=e("../internals/inherit-if-required");t.exports=function(e,t,n){function m(e){var t=x[e];o(x,e,"add"==e?function(e){return t.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(g&&!l(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return g&&!l(e)?void 0:t.call(this,0===e?0:e)}:"has"==e?function(e){return!(g&&!l(e))&&t.call(this,0===e?0:e)}:function(e,n){return t.call(this,0===e?0:e,n),this})}var v=-1!==e.indexOf("Map"),g=-1!==e.indexOf("Weak"),y=v?"set":"add",b=i[e],x=b&&b.prototype,w=b,_={};if(a(e,"function"!=typeof b||!(g||x.forEach&&!f((function(){(new b).entries().next()})))))w=n.getConstructor(t,e,v,y),s.REQUIRED=!0;else if(a(e,!0)){var k=new w,E=k[y](g?{}:-0,1)!=k,S=f((function(){k.has(1)})),C=d((function(e){new b(e)})),A=!g&&f((function(){for(var e=new b,t=5;t--;)e[y](t,t);return!e.has(-0)}));C||(((w=t((function(t,n){c(t,w,e);var r=p(new b,t,w);return null!=n&&u(n,r[y],r,v),r}))).prototype=x).constructor=w),(S||A)&&(m("delete"),m("has"),v&&m("get")),(A||E)&&m(y),g&&x.clear&&delete x.clear}return _[e]=w,r({global:!0,forced:w!=b},_),h(w,e),g||n.setStrong(w,e,v),w}},{"../internals/an-instance":9,"../internals/check-correctness-of-iteration":27,"../internals/export":49,"../internals/fails":50,"../internals/global":58,"../internals/inherit-if-required":66,"../internals/internal-metadata":68,"../internals/is-forced":72,"../internals/is-object":73,"../internals/iterate":76,"../internals/redefine":107,"../internals/set-to-string-tag":116}],32:[function(e,t,n){var r=e("../internals/has"),i=e("../internals/own-keys"),a=e("../internals/object-get-own-property-descriptor"),o=e("../internals/object-define-property");t.exports=function(e,t){for(var n=i(t),s=o.f,u=a.f,c=0;c<n.length;c++){var l=n[c];r(e,l)||s(e,l,u(t,l))}}},{"../internals/has":59,"../internals/object-define-property":91,"../internals/object-get-own-property-descriptor":92,"../internals/own-keys":102}],33:[function(e,t,n){var r=e("../internals/well-known-symbol")("match");t.exports=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[r]=!1,"/./"[e](t)}catch(e){}}return!1}},{"../internals/well-known-symbol":145}],34:[function(e,t,n){var r=e("../internals/fails");t.exports=!r((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},{"../internals/fails":50}],35:[function(e,t,n){var r=e("../internals/require-object-coercible"),i=/"/g;t.exports=function(e,t,n,a){var o=String(r(e)),s="<"+t;return""!==n&&(s+=" "+n+'="'+String(a).replace(i,"&quot;")+'"'),s+">"+o+"</"+t+">"}},{"../internals/require-object-coercible":112}],36:[function(e,t,n){"use strict";function r(){return this}var i=e("../internals/iterators-core").IteratorPrototype,a=e("../internals/object-create"),o=e("../internals/create-property-descriptor"),s=e("../internals/set-to-string-tag"),u=e("../internals/iterators");t.exports=function(e,t,n){var c=t+" Iterator";return e.prototype=a(i,{next:o(1,n)}),s(e,c,!1,!0),u[c]=r,e}},{"../internals/create-property-descriptor":38,"../internals/iterators":78,"../internals/iterators-core":77,"../internals/object-create":89,"../internals/set-to-string-tag":116}],37:[function(e,t,n){var r=e("../internals/descriptors"),i=e("../internals/object-define-property"),a=e("../internals/create-property-descriptor");t.exports=r?function(e,t,n){return i.f(e,t,a(1,n))}:function(e,t,n){return e[t]=n,e}},{"../internals/create-property-descriptor":38,"../internals/descriptors":42,"../internals/object-define-property":91}],38:[function(e,t,n){t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},{}],39:[function(e,t,n){"use strict";var r=e("../internals/to-primitive"),i=e("../internals/object-define-property"),a=e("../internals/create-property-descriptor");t.exports=function(e,t,n){var o=r(t);o in e?i.f(e,o,a(0,n)):e[o]=n}},{"../internals/create-property-descriptor":38,"../internals/object-define-property":91,"../internals/to-primitive":137}],40:[function(e,t,n){"use strict";function r(){return this}var i=e("../internals/export"),a=e("../internals/create-iterator-constructor"),o=e("../internals/object-get-prototype-of"),s=e("../internals/object-set-prototype-of"),u=e("../internals/set-to-string-tag"),c=e("../internals/create-non-enumerable-property"),l=e("../internals/redefine"),f=e("../internals/well-known-symbol"),d=e("../internals/is-pure"),h=e("../internals/iterators"),p=e("../internals/iterators-core"),m=p.IteratorPrototype,v=p.BUGGY_SAFARI_ITERATORS,g=f("iterator"),y="values",b="entries";t.exports=function(e,t,n,f,p,x,w){function _(e){if(e===p&&T)return T;if(!v&&e in O)return O[e];switch(e){case"keys":case y:case b:return function(){return new n(this,e)}}return function(){return new n(this)}}a(n,t,f);var k,E,S,C=t+" Iterator",A=!1,O=e.prototype,D=O[g]||O["@@iterator"]||p&&O[p],T=!v&&D||_(p),j="Array"==t&&O.entries||D;if(j&&(k=o(j.call(new e)),m!==Object.prototype&&k.next&&(d||o(k)===m||(s?s(k,m):"function"!=typeof k[g]&&c(k,g,r)),u(k,C,!0,!0),d&&(h[C]=r))),p==y&&D&&D.name!==y&&(A=!0,T=function(){return D.call(this)}),d&&!w||O[g]===T||c(O,g,T),h[t]=T,p)if(E={values:_(y),keys:x?T:_("keys"),entries:_(b)},w)for(S in E)!v&&!A&&S in O||l(O,S,E[S]);else i({target:t,proto:!0,forced:v||A},E);return E}},{"../internals/create-iterator-constructor":36,"../internals/create-non-enumerable-property":37,"../internals/export":49,"../internals/is-pure":74,"../internals/iterators":78,"../internals/iterators-core":77,"../internals/object-get-prototype-of":96,"../internals/object-set-prototype-of":100,"../internals/redefine":107,"../internals/set-to-string-tag":116,"../internals/well-known-symbol":145}],41:[function(e,t,n){var r=e("../internals/path"),i=e("../internals/has"),a=e("../internals/well-known-symbol-wrapped"),o=e("../internals/object-define-property").f;t.exports=function(e){var t=r.Symbol||(r.Symbol={});i(t,e)||o(t,e,{value:a.f(e)})}},{"../internals/has":59,"../internals/object-define-property":91,"../internals/path":103,"../internals/well-known-symbol-wrapped":144}],42:[function(e,t,n){var r=e("../internals/fails");t.exports=!r((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},{"../internals/fails":50}],43:[function(e,t,n){var r=e("../internals/global"),i=e("../internals/is-object"),a=r.document,o=i(a)&&i(a.createElement);t.exports=function(e){return o?a.createElement(e):{}}},{"../internals/global":58,"../internals/is-object":73}],44:[function(e,t,n){t.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},{}],45:[function(e,t,n){var r=e("../internals/engine-user-agent");t.exports=/(iphone|ipod|ipad).*applewebkit/i.test(r)},{"../internals/engine-user-agent":46}],46:[function(e,t,n){var r=e("../internals/get-built-in");t.exports=r("navigator","userAgent")||""},{"../internals/get-built-in":55}],47:[function(e,t,n){var r,i,a=e("../internals/global"),o=e("../internals/engine-user-agent"),s=a.process,u=s&&s.versions,c=u&&u.v8;c?i=(r=c.split("."))[0]+r[1]:o&&(!(r=o.match(/Edge\/(\d+)/))||74<=r[1])&&(r=o.match(/Chrome\/(\d+)/))&&(i=r[1]),t.exports=i&&+i},{"../internals/engine-user-agent":46,"../internals/global":58}],48:[function(e,t,n){t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},{}],49:[function(e,t,n){var r=e("../internals/global"),i=e("../internals/object-get-own-property-descriptor").f,a=e("../internals/create-non-enumerable-property"),o=e("../internals/redefine"),s=e("../internals/set-global"),u=e("../internals/copy-constructor-properties"),c=e("../internals/is-forced");t.exports=function(e,t){var n,l,f,d,h,p=e.target,m=e.global,v=e.stat;if(n=m?r:v?r[p]||s(p,{}):(r[p]||{}).prototype)for(l in t){if(d=t[l],f=e.noTargetGet?(h=i(n,l))&&h.value:n[l],!c(m?l:p+(v?".":"#")+l,e.forced)&&void 0!==f){if(typeof d==typeof f)continue;u(d,f)}(e.sham||f&&f.sham)&&a(d,"sham",!0),o(n,l,d,e)}}},{"../internals/copy-constructor-properties":32,"../internals/create-non-enumerable-property":37,"../internals/global":58,"../internals/is-forced":72,"../internals/object-get-own-property-descriptor":92,"../internals/redefine":107,"../internals/set-global":114}],50:[function(e,t,n){t.exports=function(e){try{return!!e()}catch(e){return!0}}},{}],51:[function(e,t,n){"use strict";e("../modules/es.regexp.exec");var r=e("../internals/redefine"),i=e("../internals/fails"),a=e("../internals/well-known-symbol"),o=e("../internals/regexp-exec"),s=e("../internals/create-non-enumerable-property"),u=a("species"),c=!i((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})),l="$0"==="a".replace(/./,"$0"),f=a("replace"),d=!!/./[f]&&""===/./[f]("a","$0"),h=!i((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2!==n.length||"a"!==n[0]||"b"!==n[1]}));t.exports=function(e,t,n,f){var p=a(e),m=!i((function(){var t={};return t[p]=function(){return 7},7!=""[e](t)})),v=m&&!i((function(){var t=!1,n=/a/;return"split"===e&&((n={constructor:{}}).constructor[u]=function(){return n},n.flags="",n[p]=/./[p]),n.exec=function(){return t=!0,null},n[p](""),!t}));if(!m||!v||"replace"===e&&(!c||!l||d)||"split"===e&&!h){var g=/./[p],y=n(p,""[e],(function(e,t,n,r,i){return t.exec===o?m&&!i?{done:!0,value:g.call(t,n,r)}:{done:!0,value:e.call(n,t,r)}:{done:!1}}),{REPLACE_KEEPS_$0:l,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:d}),b=y[0],x=y[1];r(String.prototype,e,b),r(RegExp.prototype,p,2==t?function(e,t){return x.call(e,this,t)}:function(e){return x.call(e,this)})}f&&s(RegExp.prototype[p],"sham",!0)}},{"../internals/create-non-enumerable-property":37,"../internals/fails":50,"../internals/redefine":107,"../internals/regexp-exec":109,"../internals/well-known-symbol":145,"../modules/es.regexp.exec":178}],52:[function(e,t,n){var r=e("../internals/fails");t.exports=!r((function(){return Object.isExtensible(Object.preventExtensions({}))}))},{"../internals/fails":50}],53:[function(e,t,n){var r=e("../internals/a-function");t.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},{"../internals/a-function":5}],54:[function(e,t,n){"use strict";var r=e("../internals/a-function"),i=e("../internals/is-object"),a=[].slice,o={};t.exports=Function.bind||function(e){var t=r(this),n=a.call(arguments,1),s=function r(){var i=n.concat(a.call(arguments));return this instanceof r?function(e,t,n){if(!(t in o)){for(var r=[],i=0;i<t;i++)r[i]="a["+i+"]";o[t]=Function("C,a","return new C("+r.join(",")+")")}return o[t](e,n)}(t,i.length,i):t.apply(e,i)};return i(t.prototype)&&(s.prototype=t.prototype),s}},{"../internals/a-function":5,"../internals/is-object":73}],55:[function(e,t,n){function r(e){return"function"==typeof e?e:void 0}var i=e("../internals/path"),a=e("../internals/global");t.exports=function(e,t){return arguments.length<2?r(i[e])||r(a[e]):i[e]&&i[e][t]||a[e]&&a[e][t]}},{"../internals/global":58,"../internals/path":103}],56:[function(e,t,n){var r=e("../internals/classof"),i=e("../internals/iterators"),a=e("../internals/well-known-symbol")("iterator");t.exports=function(e){if(null!=e)return e[a]||e["@@iterator"]||i[r(e)]}},{"../internals/classof":29,"../internals/iterators":78,"../internals/well-known-symbol":145}],57:[function(e,t,n){var r=e("../internals/an-object"),i=e("../internals/get-iterator-method");t.exports=function(e){var t=i(e);if("function"!=typeof t)throw TypeError(String(e)+" is not iterable");return r(t.call(e))}},{"../internals/an-object":10,"../internals/get-iterator-method":56}],58:[function(e,n,r){(function(e){function t(e){return e&&e.Math==Math&&e}n.exports=t("object"==typeof globalThis&&globalThis)||t("object"==typeof window&&window)||t("object"==typeof self&&self)||t("object"==typeof e&&e)||Function("return this")()}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],59:[function(e,t,n){var r={}.hasOwnProperty;t.exports=function(e,t){return r.call(e,t)}},{}],60:[function(e,t,n){t.exports={}},{}],61:[function(e,t,n){var r=e("../internals/global");t.exports=function(e,t){var n=r.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))}},{"../internals/global":58}],62:[function(e,t,n){var r=e("../internals/get-built-in");t.exports=r("document","documentElement")},{"../internals/get-built-in":55}],63:[function(e,t,n){var r=e("../internals/descriptors"),i=e("../internals/fails"),a=e("../internals/document-create-element");t.exports=!r&&!i((function(){return 7!=Object.defineProperty(a("div"),"a",{get:function(){return 7}}).a}))},{"../internals/descriptors":42,"../internals/document-create-element":43,"../internals/fails":50}],64:[function(e,t,n){var r=Math.abs,i=Math.pow,a=Math.floor,o=Math.log,s=Math.LN2;t.exports={pack:function(e,t,n){var u,c,l,f=new Array(n),d=8*n-t-1,h=(1<<d)-1,p=h>>1,m=23===t?i(2,-24)-i(2,-77):0,v=e<0||0===e&&1/e<0?1:0,g=0;for((e=r(e))!=e||e===1/0?(c=e!=e?1:0,u=h):(u=a(o(e)/s),e*(l=i(2,-u))<1&&(u--,l*=2),2<=(e+=1<=u+p?m/l:m*i(2,1-p))*l&&(u++,l/=2),h<=u+p?(c=0,u=h):1<=u+p?(c=(e*l-1)*i(2,t),u+=p):(c=e*i(2,p-1)*i(2,t),u=0));8<=t;f[g++]=255&c,c/=256,t-=8);for(u=u<<t|c,d+=t;0<d;f[g++]=255&u,u/=256,d-=8);return f[--g]|=128*v,f},unpack:function(e,t){var n,r=e.length,a=8*r-t-1,o=(1<<a)-1,s=o>>1,u=a-7,c=r-1,l=e[c--],f=127&l;for(l>>=7;0<u;f=256*f+e[c],c--,u-=8);for(n=f&(1<<-u)-1,f>>=-u,u+=t;0<u;n=256*n+e[c],c--,u-=8);if(0===f)f=1-s;else{if(f===o)return n?NaN:l?-1/0:1/0;n+=i(2,t),f-=s}return(l?-1:1)*n*i(2,f-t)}}},{}],65:[function(e,t,n){var r=e("../internals/fails"),i=e("../internals/classof-raw"),a="".split;t.exports=r((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==i(e)?a.call(e,""):Object(e)}:Object},{"../internals/classof-raw":28,"../internals/fails":50}],66:[function(e,t,n){var r=e("../internals/is-object"),i=e("../internals/object-set-prototype-of");t.exports=function(e,t,n){var a,o;return i&&"function"==typeof(a=t.constructor)&&a!==n&&r(o=a.prototype)&&o!==n.prototype&&i(e,o),e}},{"../internals/is-object":73,"../internals/object-set-prototype-of":100}],67:[function(e,t,n){var r=e("../internals/shared-store"),i=Function.toString;"function"!=typeof r.inspectSource&&(r.inspectSource=function(e){return i.call(e)}),t.exports=r.inspectSource},{"../internals/shared-store":118}],68:[function(e,t,n){function r(e){s(e,l,{value:{objectID:"O"+ ++f,weakData:{}}})}var i=e("../internals/hidden-keys"),a=e("../internals/is-object"),o=e("../internals/has"),s=e("../internals/object-define-property").f,u=e("../internals/uid"),c=e("../internals/freezing"),l=u("meta"),f=0,d=Object.isExtensible||function(){return!0},h=t.exports={REQUIRED:!1,fastKey:function(e,t){if(!a(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!o(e,l)){if(!d(e))return"F";if(!t)return"E";r(e)}return e[l].objectID},getWeakData:function(e,t){if(!o(e,l)){if(!d(e))return!0;if(!t)return!1;r(e)}return e[l].weakData},onFreeze:function(e){return c&&h.REQUIRED&&d(e)&&!o(e,l)&&r(e),e}};i[l]=!0},{"../internals/freezing":52,"../internals/has":59,"../internals/hidden-keys":60,"../internals/is-object":73,"../internals/object-define-property":91,"../internals/uid":142}],69:[function(e,t,n){var r,i,a,o=e("../internals/native-weak-map"),s=e("../internals/global"),u=e("../internals/is-object"),c=e("../internals/create-non-enumerable-property"),l=e("../internals/has"),f=e("../internals/shared-key"),d=e("../internals/hidden-keys"),h=s.WeakMap;if(o){var p=new h,m=p.get,v=p.has,g=p.set;r=function(e,t){return g.call(p,e,t),t},i=function(e){return m.call(p,e)||{}},a=function(e){return v.call(p,e)}}else{var y=f("state");d[y]=!0,r=function(e,t){return c(e,y,t),t},i=function(e){return l(e,y)?e[y]:{}},a=function(e){return l(e,y)}}t.exports={set:r,get:i,has:a,enforce:function(e){return a(e)?i(e):r(e,{})},getterFor:function(e){return function(t){var n;if(!u(t)||(n=i(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}}},{"../internals/create-non-enumerable-property":37,"../internals/global":58,"../internals/has":59,"../internals/hidden-keys":60,"../internals/is-object":73,"../internals/native-weak-map":84,"../internals/shared-key":117}],70:[function(e,t,n){var r=e("../internals/well-known-symbol"),i=e("../internals/iterators"),a=r("iterator"),o=Array.prototype;t.exports=function(e){return void 0!==e&&(i.Array===e||o[a]===e)}},{"../internals/iterators":78,"../internals/well-known-symbol":145}],71:[function(e,t,n){var r=e("../internals/classof-raw");t.exports=Array.isArray||function(e){return"Array"==r(e)}},{"../internals/classof-raw":28}],72:[function(e,t,n){function r(e,t){var n=s[o(e)];return n==c||n!=u&&("function"==typeof t?i(t):!!t)}var i=e("../internals/fails"),a=/#|\.prototype\./,o=r.normalize=function(e){return String(e).replace(a,".").toLowerCase()},s=r.data={},u=r.NATIVE="N",c=r.POLYFILL="P";t.exports=r},{"../internals/fails":50}],73:[function(e,t,n){t.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},{}],74:[function(e,t,n){t.exports=!1},{}],75:[function(e,t,n){var r=e("../internals/is-object"),i=e("../internals/classof-raw"),a=e("../internals/well-known-symbol")("match");t.exports=function(e){var t;return r(e)&&(void 0!==(t=e[a])?!!t:"RegExp"==i(e))}},{"../internals/classof-raw":28,"../internals/is-object":73,"../internals/well-known-symbol":145}],76:[function(e,t,n){function r(e,t){this.stopped=e,this.result=t}var i=e("../internals/an-object"),a=e("../internals/is-array-iterator-method"),o=e("../internals/to-length"),s=e("../internals/function-bind-context"),u=e("../internals/get-iterator-method"),c=e("../internals/call-with-safe-iteration-closing");(t.exports=function(e,t,n,l,f){var d,h,p,m,v,g,y,b=s(t,n,l?2:1);if(f)d=e;else{if("function"!=typeof(h=u(e)))throw TypeError("Target is not iterable");if(a(h)){for(p=0,m=o(e.length);p<m;p++)if((v=l?b(i(y=e[p])[0],y[1]):b(e[p]))&&v instanceof r)return v;return new r(!1)}d=h.call(e)}for(g=d.next;!(y=g.call(d)).done;)if("object"==typeof(v=c(d,b,y.value,l))&&v&&v instanceof r)return v;return new r(!1)}).stop=function(e){return new r(!0,e)}},{"../internals/an-object":10,"../internals/call-with-safe-iteration-closing":26,"../internals/function-bind-context":53,"../internals/get-iterator-method":56,"../internals/is-array-iterator-method":70,"../internals/to-length":133}],77:[function(e,t,n){"use strict";var r,i,a,o=e("../internals/object-get-prototype-of"),s=e("../internals/create-non-enumerable-property"),u=e("../internals/has"),c=e("../internals/well-known-symbol"),l=e("../internals/is-pure"),f=c("iterator"),d=!1;[].keys&&("next"in(a=[].keys())?(i=o(o(a)))!==Object.prototype&&(r=i):d=!0),null==r&&(r={}),l||u(r,f)||s(r,f,(function(){return this})),t.exports={IteratorPrototype:r,BUGGY_SAFARI_ITERATORS:d}},{"../internals/create-non-enumerable-property":37,"../internals/has":59,"../internals/is-pure":74,"../internals/object-get-prototype-of":96,"../internals/well-known-symbol":145}],78:[function(e,t,n){arguments[4][60][0].apply(n,arguments)},{dup:60}],79:[function(e,t,n){t.exports=Math.sign||function(e){return 0==(e=+e)||e!=e?e:e<0?-1:1}},{}],80:[function(e,t,n){var r,i,a,o,s,u,c,l,f=e("../internals/global"),d=e("../internals/object-get-own-property-descriptor").f,h=e("../internals/classof-raw"),p=e("../internals/task").set,m=e("../internals/engine-is-ios"),v=f.MutationObserver||f.WebKitMutationObserver,g=f.process,y=f.Promise,b="process"==h(g),x=d(f,"queueMicrotask"),w=x&&x.value;w||(r=function(){var e,t;for(b&&(e=g.domain)&&e.exit();i;){t=i.fn,i=i.next;try{t()}catch(e){throw i?o():a=void 0,e}}a=void 0,e&&e.enter()},o=b?function(){g.nextTick(r)}:v&&!m?(s=!0,u=document.createTextNode(""),new v(r).observe(u,{characterData:!0}),function(){u.data=s=!s}):y&&y.resolve?(c=y.resolve(void 0),l=c.then,function(){l.call(c,r)}):function(){p.call(f,r)}),t.exports=w||function(e){var t={fn:e,next:void 0};a&&(a.next=t),i||(i=t,o()),a=t}},{"../internals/classof-raw":28,"../internals/engine-is-ios":45,"../internals/global":58,"../internals/object-get-own-property-descriptor":92,"../internals/task":127}],81:[function(e,t,n){var r=e("../internals/global");t.exports=r.Promise},{"../internals/global":58}],82:[function(e,t,n){var r=e("../internals/fails");t.exports=!!Object.getOwnPropertySymbols&&!r((function(){return!String(Symbol())}))},{"../internals/fails":50}],83:[function(e,t,n){var r=e("../internals/fails"),i=e("../internals/well-known-symbol"),a=e("../internals/is-pure"),o=i("iterator");t.exports=!r((function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,n="";return e.pathname="c%20d",t.forEach((function(e,r){t.delete("b"),n+=r+e})),a&&!e.toJSON||!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[o]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://\u0442\u0435\u0441\u0442").host||"#%D0%B1"!==new URL("http://a#\u0431").hash||"a1c3"!==n||"x"!==new URL("http://x",void 0).host}))},{"../internals/fails":50,"../internals/is-pure":74,"../internals/well-known-symbol":145}],84:[function(e,t,n){var r=e("../internals/global"),i=e("../internals/inspect-source"),a=r.WeakMap;t.exports="function"==typeof a&&/native code/.test(i(a))},{"../internals/global":58,"../internals/inspect-source":67}],85:[function(e,t,n){"use strict";function r(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=i(t),this.reject=i(n)}var i=e("../internals/a-function");t.exports.f=function(e){return new r(e)}},{"../internals/a-function":5}],86:[function(e,t,n){var r=e("../internals/is-regexp");t.exports=function(e){if(r(e))throw TypeError("The method doesn't accept regular expressions");return e}},{"../internals/is-regexp":75}],87:[function(e,t,n){var r=e("../internals/global").isFinite;t.exports=Number.isFinite||function(e){return"number"==typeof e&&r(e)}},{"../internals/global":58}],88:[function(e,t,n){"use strict";var r=e("../internals/descriptors"),i=e("../internals/fails"),a=e("../internals/object-keys"),o=e("../internals/object-get-own-property-symbols"),s=e("../internals/object-property-is-enumerable"),u=e("../internals/to-object"),c=e("../internals/indexed-object"),l=Object.assign,f=Object.defineProperty;t.exports=!l||i((function(){if(r&&1!==l({b:1},l(f({},"a",{enumerable:!0,get:function(){f(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol(),i="abcdefghijklmnopqrst";return e[n]=7,i.split("").forEach((function(e){t[e]=e})),7!=l({},e)[n]||a(l({},t)).join("")!=i}))?function(e,t){for(var n=u(e),i=arguments.length,l=1,f=o.f,d=s.f;l<i;)for(var h,p=c(arguments[l++]),m=f?a(p).concat(f(p)):a(p),v=m.length,g=0;g<v;)h=m[g++],r&&!d.call(p,h)||(n[h]=p[h]);return n}:l},{"../internals/descriptors":42,"../internals/fails":50,"../internals/indexed-object":65,"../internals/object-get-own-property-symbols":95,"../internals/object-keys":98,"../internals/object-property-is-enumerable":99,"../internals/to-object":134}],89:[function(e,t,n){function r(){}function i(e){return"<script>"+e+"</"+p+">"}var a,o=e("../internals/an-object"),s=e("../internals/object-define-properties"),u=e("../internals/enum-bug-keys"),c=e("../internals/hidden-keys"),l=e("../internals/html"),f=e("../internals/document-create-element"),d=e("../internals/shared-key"),h="prototype",p="script",m=d("IE_PROTO"),v=function(){try{a=document.domain&&new ActiveXObject("htmlfile")}catch(e){}var e,t;v=a?function(e){e.write(i("")),e.close();var t=e.parentWindow.Object;return e=null,t}(a):((t=f("iframe")).style.display="none",l.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(i("document.F=Object")),e.close(),e.F);for(var n=u.length;n--;)delete v[h][u[n]];return v()};c[m]=!0,t.exports=Object.create||function(e,t){var n;return null!==e?(r[h]=o(e),n=new r,r[h]=null,n[m]=e):n=v(),void 0===t?n:s(n,t)}},{"../internals/an-object":10,"../internals/document-create-element":43,"../internals/enum-bug-keys":48,"../internals/hidden-keys":60,"../internals/html":62,"../internals/object-define-properties":90,"../internals/shared-key":117}],90:[function(e,t,n){var r=e("../internals/descriptors"),i=e("../internals/object-define-property"),a=e("../internals/an-object"),o=e("../internals/object-keys");t.exports=r?Object.defineProperties:function(e,t){a(e);for(var n,r=o(t),s=r.length,u=0;u<s;)i.f(e,n=r[u++],t[n]);return e}},{"../internals/an-object":10,"../internals/descriptors":42,"../internals/object-define-property":91,"../internals/object-keys":98}],91:[function(e,t,n){var r=e("../internals/descriptors"),i=e("../internals/ie8-dom-define"),a=e("../internals/an-object"),o=e("../internals/to-primitive"),s=Object.defineProperty;n.f=r?s:function(e,t,n){if(a(e),t=o(t,!0),a(n),i)try{return s(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},{"../internals/an-object":10,"../internals/descriptors":42,"../internals/ie8-dom-define":63,"../internals/to-primitive":137}],92:[function(e,t,n){var r=e("../internals/descriptors"),i=e("../internals/object-property-is-enumerable"),a=e("../internals/create-property-descriptor"),o=e("../internals/to-indexed-object"),s=e("../internals/to-primitive"),u=e("../internals/has"),c=e("../internals/ie8-dom-define"),l=Object.getOwnPropertyDescriptor;n.f=r?l:function(e,t){if(e=o(e),t=s(t,!0),c)try{return l(e,t)}catch(e){}if(u(e,t))return a(!i.f.call(e,t),e[t])}},{"../internals/create-property-descriptor":38,"../internals/descriptors":42,"../internals/has":59,"../internals/ie8-dom-define":63,"../internals/object-property-is-enumerable":99,"../internals/to-indexed-object":131,"../internals/to-primitive":137}],93:[function(e,t,n){var r=e("../internals/to-indexed-object"),i=e("../internals/object-get-own-property-names").f,a={}.toString,o="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.f=function(e){return o&&"[object Window]"==a.call(e)?function(e){try{return i(e)}catch(e){return o.slice()}}(e):i(r(e))}},{"../internals/object-get-own-property-names":94,"../internals/to-indexed-object":131}],94:[function(e,t,n){var r=e("../internals/object-keys-internal"),i=e("../internals/enum-bug-keys").concat("length","prototype");n.f=Object.getOwnPropertyNames||function(e){return r(e,i)}},{"../internals/enum-bug-keys":48,"../internals/object-keys-internal":97}],95:[function(e,t,n){n.f=Object.getOwnPropertySymbols},{}],96:[function(e,t,n){var r=e("../internals/has"),i=e("../internals/to-object"),a=e("../internals/shared-key"),o=e("../internals/correct-prototype-getter"),s=a("IE_PROTO"),u=Object.prototype;t.exports=o?Object.getPrototypeOf:function(e){return e=i(e),r(e,s)?e[s]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?u:null}},{"../internals/correct-prototype-getter":34,"../internals/has":59,"../internals/shared-key":117,"../internals/to-object":134}],97:[function(e,t,n){var r=e("../internals/has"),i=e("../internals/to-indexed-object"),a=e("../internals/array-includes").indexOf,o=e("../internals/hidden-keys");t.exports=function(e,t){var n,s=i(e),u=0,c=[];for(n in s)!r(o,n)&&r(s,n)&&c.push(n);for(;t.length>u;)r(s,n=t[u++])&&(~a(c,n)||c.push(n));return c}},{"../internals/array-includes":18,"../internals/has":59,"../internals/hidden-keys":60,"../internals/to-indexed-object":131}],98:[function(e,t,n){var r=e("../internals/object-keys-internal"),i=e("../internals/enum-bug-keys");t.exports=Object.keys||function(e){return r(e,i)}},{"../internals/enum-bug-keys":48,"../internals/object-keys-internal":97}],99:[function(e,t,n){"use strict";var r={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,a=i&&!r.call({1:2},1);n.f=a?function(e){var t=i(this,e);return!!t&&t.enumerable}:r},{}],100:[function(e,t,n){var r=e("../internals/an-object"),i=e("../internals/a-possible-prototype");t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),t=n instanceof Array}catch(n){}return function(n,a){return r(n),i(a),t?e.call(n,a):n.__proto__=a,n}}():void 0)},{"../internals/a-possible-prototype":6,"../internals/an-object":10}],101:[function(e,t,n){"use strict";var r=e("../internals/to-string-tag-support"),i=e("../internals/classof");t.exports=r?{}.toString:function(){return"[object "+i(this)+"]"}},{"../internals/classof":29,"../internals/to-string-tag-support":138}],102:[function(e,t,n){var r=e("../internals/get-built-in"),i=e("../internals/object-get-own-property-names"),a=e("../internals/object-get-own-property-symbols"),o=e("../internals/an-object");t.exports=r("Reflect","ownKeys")||function(e){var t=i.f(o(e)),n=a.f;return n?t.concat(n(e)):t}},{"../internals/an-object":10,"../internals/get-built-in":55,"../internals/object-get-own-property-names":94,"../internals/object-get-own-property-symbols":95}],103:[function(e,t,n){var r=e("../internals/global");t.exports=r},{"../internals/global":58}],104:[function(e,t,n){t.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}},{}],105:[function(e,t,n){var r=e("../internals/an-object"),i=e("../internals/is-object"),a=e("../internals/new-promise-capability");t.exports=function(e,t){if(r(e),i(t)&&t.constructor===e)return t;var n=a.f(e);return(0,n.resolve)(t),n.promise}},{"../internals/an-object":10,"../internals/is-object":73,"../internals/new-promise-capability":85}],106:[function(e,t,n){var r=e("../internals/redefine");t.exports=function(e,t,n){for(var i in t)r(e,i,t[i],n);return e}},{"../internals/redefine":107}],107:[function(e,t,n){var r=e("../internals/global"),i=e("../internals/create-non-enumerable-property"),a=e("../internals/has"),o=e("../internals/set-global"),s=e("../internals/inspect-source"),u=e("../internals/internal-state"),c=u.get,l=u.enforce,f=String(String).split("String");(t.exports=function(e,t,n,s){var u=!!s&&!!s.unsafe,c=!!s&&!!s.enumerable,d=!!s&&!!s.noTargetGet;"function"==typeof n&&("string"!=typeof t||a(n,"name")||i(n,"name",t),l(n).source=f.join("string"==typeof t?t:"")),e!==r?(u?!d&&e[t]&&(c=!0):delete e[t],c?e[t]=n:i(e,t,n)):c?e[t]=n:o(t,n)})(Function.prototype,"toString",(function(){return"function"==typeof this&&c(this).source||s(this)}))},{"../internals/create-non-enumerable-property":37,"../internals/global":58,"../internals/has":59,"../internals/inspect-source":67,"../internals/internal-state":69,"../internals/set-global":114}],108:[function(e,t,n){var r=e("./classof-raw"),i=e("./regexp-exec");t.exports=function(e,t){var n=e.exec;if("function"==typeof n){var a=n.call(e,t);if("object"!=typeof a)throw TypeError("RegExp exec method returned something other than an Object or null");return a}if("RegExp"!==r(e))throw TypeError("RegExp#exec called on incompatible receiver");return i.call(e,t)}},{"./classof-raw":28,"./regexp-exec":109}],109:[function(e,t,n){"use strict";var r,i,a=e("./regexp-flags"),o=e("./regexp-sticky-helpers"),s=RegExp.prototype.exec,u=String.prototype.replace,c=s,l=(r=/a/,i=/b*/g,s.call(r,"a"),s.call(i,"a"),0!==r.lastIndex||0!==i.lastIndex),f=o.UNSUPPORTED_Y||o.BROKEN_CARET,d=void 0!==/()??/.exec("")[1];(l||d||f)&&(c=function(e){var t,n,r,i,o=this,c=f&&o.sticky,h=a.call(o),p=o.source,m=0,v=e;return c&&(-1===(h=h.replace("y","")).indexOf("g")&&(h+="g"),v=String(e).slice(o.lastIndex),0<o.lastIndex&&(!o.multiline||o.multiline&&"\n"!==e[o.lastIndex-1])&&(p="(?: "+p+")",v=" "+v,m++),n=new RegExp("^(?:"+p+")",h)),d&&(n=new RegExp("^"+p+"$(?!\\s)",h)),l&&(t=o.lastIndex),r=s.call(c?n:o,v),c?r?(r.input=r.input.slice(m),r[0]=r[0].slice(m),r.index=o.lastIndex,o.lastIndex+=r[0].length):o.lastIndex=0:l&&r&&(o.lastIndex=o.global?r.index+r[0].length:t),d&&r&&1<r.length&&u.call(r[0],n,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(r[i]=void 0)})),r}),t.exports=c},{"./regexp-flags":110,"./regexp-sticky-helpers":111}],110:[function(e,t,n){"use strict";var r=e("../internals/an-object");t.exports=function(){var e=r(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},{"../internals/an-object":10}],111:[function(e,t,n){"use strict";var r=e("./fails");function i(e,t){return RegExp(e,t)}n.UNSUPPORTED_Y=r((function(){var e=i("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),n.BROKEN_CARET=r((function(){var e=i("^r","gy");return e.lastIndex=2,null!=e.exec("str")}))},{"./fails":50}],112:[function(e,t,n){t.exports=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e}},{}],113:[function(e,t,n){t.exports=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}},{}],114:[function(e,t,n){var r=e("../internals/global"),i=e("../internals/create-non-enumerable-property");t.exports=function(e,t){try{i(r,e,t)}catch(n){r[e]=t}return t}},{"../internals/create-non-enumerable-property":37,"../internals/global":58}],115:[function(e,t,n){"use strict";var r=e("../internals/get-built-in"),i=e("../internals/object-define-property"),a=e("../internals/well-known-symbol"),o=e("../internals/descriptors"),s=a("species");t.exports=function(e){var t=r(e),n=i.f;o&&t&&!t[s]&&n(t,s,{configurable:!0,get:function(){return this}})}},{"../internals/descriptors":42,"../internals/get-built-in":55,"../internals/object-define-property":91,"../internals/well-known-symbol":145}],116:[function(e,t,n){var r=e("../internals/object-define-property").f,i=e("../internals/has"),a=e("../internals/well-known-symbol")("toStringTag");t.exports=function(e,t,n){e&&!i(e=n?e:e.prototype,a)&&r(e,a,{configurable:!0,value:t})}},{"../internals/has":59,"../internals/object-define-property":91,"../internals/well-known-symbol":145}],117:[function(e,t,n){var r=e("../internals/shared"),i=e("../internals/uid"),a=r("keys");t.exports=function(e){return a[e]||(a[e]=i(e))}},{"../internals/shared":119,"../internals/uid":142}],118:[function(e,t,n){var r=e("../internals/global"),i=e("../internals/set-global"),a="__core-js_shared__",o=r[a]||i(a,{});t.exports=o},{"../internals/global":58,"../internals/set-global":114}],119:[function(e,t,n){var r=e("../internals/is-pure"),i=e("../internals/shared-store");(t.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.6.5",mode:r?"pure":"global",copyright:"\xa9 2020 Denis Pushkarev (zloirock.ru)"})},{"../internals/is-pure":74,"../internals/shared-store":118}],120:[function(e,t,n){var r=e("../internals/an-object"),i=e("../internals/a-function"),a=e("../internals/well-known-symbol")("species");t.exports=function(e,t){var n,o=r(e).constructor;return void 0===o||null==(n=r(o)[a])?t:i(n)}},{"../internals/a-function":5,"../internals/an-object":10,"../internals/well-known-symbol":145}],121:[function(e,t,n){var r=e("../internals/fails");t.exports=function(e){return r((function(){var t=""[e]('"');return t!==t.toLowerCase()||3<t.split('"').length}))}},{"../internals/fails":50}],122:[function(e,t,n){function r(e){return function(t,n){var r,o,s=String(a(t)),u=i(n),c=s.length;return u<0||c<=u?e?"":void 0:(r=s.charCodeAt(u))<55296||56319<r||u+1===c||(o=s.charCodeAt(u+1))<56320||57343<o?e?s.charAt(u):r:e?s.slice(u,u+2):o-56320+(r-55296<<10)+65536}}var i=e("../internals/to-integer"),a=e("../internals/require-object-coercible");t.exports={codeAt:r(!1),charAt:r(!0)}},{"../internals/require-object-coercible":112,"../internals/to-integer":132}],123:[function(e,t,n){"use strict";function r(e){return e+22+75*(e<26)}function i(e,t,n){var r=0;for(e=n?l(e/700):e>>1,e+=l(e/t);455<e;r+=36)e=l(e/35);return l(r+36*e/(e+38))}function a(e){var t,n,a=[],s=(e=function(e){for(var t=[],n=0,r=e.length;n<r;){var i=e.charCodeAt(n++);if(55296<=i&&i<=56319&&n<r){var a=e.charCodeAt(n++);56320==(64512&a)?t.push(((1023&i)<<10)+(1023&a)+65536):(t.push(i),n--)}else t.push(i)}return t}(e)).length,u=128,d=0,h=72;for(t=0;t<e.length;t++)(n=e[t])<128&&a.push(f(n));var p=a.length,m=p;for(p&&a.push("-");m<s;){var v=o;for(t=0;t<e.length;t++)u<=(n=e[t])&&n<v&&(v=n);var g=m+1;if(v-u>l((o-d)/g))throw RangeError(c);for(d+=(v-u)*g,u=v,t=0;t<e.length;t++){if((n=e[t])<u&&++d>o)throw RangeError(c);if(n==u){for(var y=d,b=36;;b+=36){var x=b<=h?1:h+26<=b?26:b-h;if(y<x)break;var w=y-x,_=36-x;a.push(f(r(x+w%_))),y=l(w/_)}a.push(f(r(y))),h=i(d,g,m==p),d=0,++m}}++d,++u}return a.join("")}var o=2147483647,s=/[^\0-\u007E]/,u=/[.\u3002\uFF0E\uFF61]/g,c="Overflow: input needs wider integers to process",l=Math.floor,f=String.fromCharCode;t.exports=function(e){var t,n,r=[],i=e.toLowerCase().replace(u,".").split(".");for(t=0;t<i.length;t++)n=i[t],r.push(s.test(n)?"xn--"+a(n):n);return r.join(".")}},{}],124:[function(e,t,n){"use strict";var r=e("../internals/to-integer"),i=e("../internals/require-object-coercible");t.exports="".repeat||function(e){var t=String(i(this)),n="",a=r(e);if(a<0||a==1/0)throw RangeError("Wrong number of repetitions");for(;0<a;(a>>>=1)&&(t+=t))1&a&&(n+=t);return n}},{"../internals/require-object-coercible":112,"../internals/to-integer":132}],125:[function(e,t,n){var r=e("../internals/fails"),i=e("../internals/whitespaces");t.exports=function(e){return r((function(){return!!i[e]()||"\u200b\x85\u180e"!="\u200b\x85\u180e"[e]()||i[e].name!==e}))}},{"../internals/fails":50,"../internals/whitespaces":146}],126:[function(e,t,n){function r(e){return function(t){var n=String(i(t));return 1&e&&(n=n.replace(o,"")),2&e&&(n=n.replace(s,"")),n}}var i=e("../internals/require-object-coercible"),a="["+e("../internals/whitespaces")+"]",o=RegExp("^"+a+a+"*"),s=RegExp(a+a+"*$");t.exports={start:r(1),end:r(2),trim:r(3)}},{"../internals/require-object-coercible":112,"../internals/whitespaces":146}],127:[function(e,t,n){function r(e){if(E.hasOwnProperty(e)){var t=E[e];delete E[e],t()}}function i(e){return function(){r(e)}}function a(e){r(e.data)}function o(e){l.postMessage(e+"",g.protocol+"//"+g.host)}var s,u,c,l=e("../internals/global"),f=e("../internals/fails"),d=e("../internals/classof-raw"),h=e("../internals/function-bind-context"),p=e("../internals/html"),m=e("../internals/document-create-element"),v=e("../internals/engine-is-ios"),g=l.location,y=l.setImmediate,b=l.clearImmediate,x=l.process,w=l.MessageChannel,_=l.Dispatch,k=0,E={},S="onreadystatechange";y&&b||(y=function(e){for(var t=[],n=1;n<arguments.length;)t.push(arguments[n++]);return E[++k]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},s(k),k},b=function(e){delete E[e]},"process"==d(x)?s=function(e){x.nextTick(i(e))}:_&&_.now?s=function(e){_.now(i(e))}:w&&!v?(c=(u=new w).port2,u.port1.onmessage=a,s=h(c.postMessage,c,1)):!l.addEventListener||"function"!=typeof postMessage||l.importScripts||f(o)||"file:"===g.protocol?s=S in m("script")?function(e){p.appendChild(m("script"))[S]=function(){p.removeChild(this),r(e)}}:function(e){setTimeout(i(e),0)}:(s=o,l.addEventListener("message",a,!1))),t.exports={set:y,clear:b}},{"../internals/classof-raw":28,"../internals/document-create-element":43,"../internals/engine-is-ios":45,"../internals/fails":50,"../internals/function-bind-context":53,"../internals/global":58,"../internals/html":62}],128:[function(e,t,n){var r=e("../internals/classof-raw");t.exports=function(e){if("number"!=typeof e&&"Number"!=r(e))throw TypeError("Incorrect invocation");return+e}},{"../internals/classof-raw":28}],129:[function(e,t,n){var r=e("../internals/to-integer"),i=Math.max,a=Math.min;t.exports=function(e,t){var n=r(e);return n<0?i(n+t,0):a(n,t)}},{"../internals/to-integer":132}],130:[function(e,t,n){var r=e("../internals/to-integer"),i=e("../internals/to-length");t.exports=function(e){if(void 0===e)return 0;var t=r(e),n=i(t);if(t!==n)throw RangeError("Wrong length or index");return n}},{"../internals/to-integer":132,"../internals/to-length":133}],131:[function(e,t,n){var r=e("../internals/indexed-object"),i=e("../internals/require-object-coercible");t.exports=function(e){return r(i(e))}},{"../internals/indexed-object":65,"../internals/require-object-coercible":112}],132:[function(e,t,n){var r=Math.ceil,i=Math.floor;t.exports=function(e){return isNaN(e=+e)?0:(0<e?i:r)(e)}},{}],133:[function(e,t,n){var r=e("../internals/to-integer"),i=Math.min;t.exports=function(e){return 0<e?i(r(e),9007199254740991):0}},{"../internals/to-integer":132}],134:[function(e,t,n){var r=e("../internals/require-object-coercible");t.exports=function(e){return Object(r(e))}},{"../internals/require-object-coercible":112}],135:[function(e,t,n){var r=e("../internals/to-positive-integer");t.exports=function(e,t){var n=r(e);if(n%t)throw RangeError("Wrong offset");return n}},{"../internals/to-positive-integer":136}],136:[function(e,t,n){var r=e("../internals/to-integer");t.exports=function(e){var t=r(e);if(t<0)throw RangeError("The argument can't be less than 0");return t}},{"../internals/to-integer":132}],137:[function(e,t,n){var r=e("../internals/is-object");t.exports=function(e,t){if(!r(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!r(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},{"../internals/is-object":73}],138:[function(e,t,n){var r={};r[e("../internals/well-known-symbol")("toStringTag")]="z",t.exports="[object z]"===String(r)},{"../internals/well-known-symbol":145}],139:[function(e,t,n){"use strict";function r(e,t){for(var n=0,r=t.length,i=new(X(e))(r);n<r;)i[n]=t[n++];return i}function i(e,t){P(e,t,{get:function(){return N(this)[t]}})}function a(e){var t;return e instanceof U||"ArrayBuffer"==(t=k(e))||"SharedArrayBuffer"==t}function o(e,t){return K(e)&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)}function s(e,t){return o(e,t=w(t,!0))?v(2,e[t]):B(e,t)}function u(e,t,n){return!(o(e,t=w(t,!0))&&E(n)&&_(n,"value"))||_(n,"get")||_(n,"set")||n.configurable||_(n,"writable")&&!n.writable||_(n,"enumerable")&&!n.enumerable?P(e,t,n):(e[t]=n.value,e)}var c=e("../internals/export"),l=e("../internals/global"),f=e("../internals/descriptors"),d=e("../internals/typed-array-constructors-require-wrappers"),h=e("../internals/array-buffer-view-core"),p=e("../internals/array-buffer"),m=e("../internals/an-instance"),v=e("../internals/create-property-descriptor"),g=e("../internals/create-non-enumerable-property"),y=e("../internals/to-length"),b=e("../internals/to-index"),x=e("../internals/to-offset"),w=e("../internals/to-primitive"),_=e("../internals/has"),k=e("../internals/classof"),E=e("../internals/is-object"),S=e("../internals/object-create"),C=e("../internals/object-set-prototype-of"),A=e("../internals/object-get-own-property-names").f,O=e("../internals/typed-array-from"),D=e("../internals/array-iteration").forEach,T=e("../internals/set-species"),j=e("../internals/object-define-property"),M=e("../internals/object-get-own-property-descriptor"),F=e("../internals/internal-state"),I=e("../internals/inherit-if-required"),N=F.get,R=F.set,P=j.f,B=M.f,L=Math.round,z=l.RangeError,U=p.ArrayBuffer,W=p.DataView,V=h.NATIVE_ARRAY_BUFFER_VIEWS,G=h.TYPED_ARRAY_TAG,q=h.TypedArray,H=h.TypedArrayPrototype,X=h.aTypedArrayConstructor,K=h.isTypedArray,Y="BYTES_PER_ELEMENT",$="Wrong length";f?(V||(M.f=s,j.f=u,i(H,"buffer"),i(H,"byteOffset"),i(H,"byteLength"),i(H,"length")),c({target:"Object",stat:!0,forced:!V},{getOwnPropertyDescriptor:s,defineProperty:u}),t.exports=function(e,t,n){function i(e,t){P(e,t,{get:function(){return e=t,(n=N(this)).view[u](e*o+n.byteOffset,!0);var e,n},set:function(e){return r=t,i=e,a=N(this),n&&(i=(i=L(i))<0?0:255<i?255:255&i),void a.view[f](r*o+a.byteOffset,i,!0);var r,i,a},enumerable:!0})}var o=e.match(/\d+$/)[0]/8,s=e+(n?"Clamped":"")+"Array",u="get"+e,f="set"+e,h=l[s],p=h,v=p&&p.prototype,w={};V?d&&(p=t((function(e,t,n,i){return m(e,p,s),I(E(t)?a(t)?void 0!==i?new h(t,x(n,o),i):void 0!==n?new h(t,x(n,o)):new h(t):K(t)?r(p,t):O.call(p,t):new h(b(t)),e,p)})),C&&C(p,q),D(A(h),(function(e){e in p||g(p,e,h[e])})),p.prototype=v):(p=t((function(e,t,n,u){m(e,p,s);var c,l,f,d=0,h=0;if(E(t)){if(!a(t))return K(t)?r(p,t):O.call(p,t);c=t,h=x(n,o);var v=t.byteLength;if(void 0===u){if(v%o)throw z($);if((l=v-h)<0)throw z($)}else if(v<(l=y(u)*o)+h)throw z($);f=l/o}else f=b(t),c=new U(l=f*o);for(R(e,{buffer:c,byteOffset:h,byteLength:l,length:f,view:new W(c)});d<f;)i(e,d++)})),C&&C(p,q),v=p.prototype=S(H)),v.constructor!==p&&g(v,"constructor",p),G&&g(v,G,s),w[s]=p,c({global:!0,forced:p!=h,sham:!V},w),Y in p||g(p,Y,o),Y in v||g(v,Y,o),T(s)}):t.exports=function(){}},{"../internals/an-instance":9,"../internals/array-buffer":13,"../internals/array-buffer-view-core":12,"../internals/array-iteration":19,"../internals/classof":29,"../internals/create-non-enumerable-property":37,"../internals/create-property-descriptor":38,"../internals/descriptors":42,"../internals/export":49,"../internals/global":58,"../internals/has":59,"../internals/inherit-if-required":66,"../internals/internal-state":69,"../internals/is-object":73,"../internals/object-create":89,"../internals/object-define-property":91,"../internals/object-get-own-property-descriptor":92,"../internals/object-get-own-property-names":94,"../internals/object-set-prototype-of":100,"../internals/set-species":115,"../internals/to-index":130,"../internals/to-length":133,"../internals/to-offset":135,"../internals/to-primitive":137,"../internals/typed-array-constructors-require-wrappers":140,"../internals/typed-array-from":141}],140:[function(e,t,n){var r=e("../internals/global"),i=e("../internals/fails"),a=e("../internals/check-correctness-of-iteration"),o=e("../internals/array-buffer-view-core").NATIVE_ARRAY_BUFFER_VIEWS,s=r.ArrayBuffer,u=r.Int8Array;t.exports=!o||!i((function(){u(1)}))||!i((function(){new u(-1)}))||!a((function(e){new u,new u(null),new u(1.5),new u(e)}),!0)||i((function(){return 1!==new u(new s(2),1,void 0).length}))},{"../internals/array-buffer-view-core":12,"../internals/check-correctness-of-iteration":27,"../internals/fails":50,"../internals/global":58}],141:[function(e,t,n){var r=e("../internals/to-object"),i=e("../internals/to-length"),a=e("../internals/get-iterator-method"),o=e("../internals/is-array-iterator-method"),s=e("../internals/function-bind-context"),u=e("../internals/array-buffer-view-core").aTypedArrayConstructor;t.exports=function(e,t,n){var c,l,f,d,h,p,m=r(e),v=arguments.length,g=1<v?t:void 0,y=void 0!==g,b=a(m);if(null!=b&&!o(b))for(p=(h=b.call(m)).next,m=[];!(d=p.call(h)).done;)m.push(d.value);for(y&&2<v&&(g=s(g,n,2)),l=i(m.length),f=new(u(this))(l),c=0;c<l;c++)f[c]=y?g(m[c],c):m[c];return f}},{"../internals/array-buffer-view-core":12,"../internals/function-bind-context":53,"../internals/get-iterator-method":56,"../internals/is-array-iterator-method":70,"../internals/to-length":133,"../internals/to-object":134}],142:[function(e,t,n){var r=0,i=Math.random();t.exports=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++r+i).toString(36)}},{}],143:[function(e,t,n){var r=e("../internals/native-symbol");t.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},{"../internals/native-symbol":82}],144:[function(e,t,n){var r=e("../internals/well-known-symbol");n.f=r},{"../internals/well-known-symbol":145}],145:[function(e,t,n){var r=e("../internals/global"),i=e("../internals/shared"),a=e("../internals/has"),o=e("../internals/uid"),s=e("../internals/native-symbol"),u=e("../internals/use-symbol-as-uid"),c=i("wks"),l=r.Symbol,f=u?l:l&&l.withoutSetter||o;t.exports=function(e){return a(c,e)||(s&&a(l,e)?c[e]=l[e]:c[e]=f("Symbol."+e)),c[e]}},{"../internals/global":58,"../internals/has":59,"../internals/native-symbol":82,"../internals/shared":119,"../internals/uid":142,"../internals/use-symbol-as-uid":143}],146:[function(e,t,n){t.exports="\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff"},{}],147:[function(e,t,n){"use strict";var r=e("../internals/export"),i=e("../internals/global"),a=e("../internals/array-buffer"),o=e("../internals/set-species"),s="ArrayBuffer",u=a[s];r({global:!0,forced:i[s]!==u},{ArrayBuffer:u}),o(s)},{"../internals/array-buffer":13,"../internals/export":49,"../internals/global":58,"../internals/set-species":115}],148:[function(e,t,n){"use strict";function r(e){if(!s(e))return!1;var t=e[m];return void 0!==t?!!t:o(e)}var i=e("../internals/export"),a=e("../internals/fails"),o=e("../internals/is-array"),s=e("../internals/is-object"),u=e("../internals/to-object"),c=e("../internals/to-length"),l=e("../internals/create-property"),f=e("../internals/array-species-create"),d=e("../internals/array-method-has-species-support"),h=e("../internals/well-known-symbol"),p=e("../internals/engine-v8-version"),m=h("isConcatSpreadable"),v=9007199254740991,g="Maximum allowed index exceeded",y=51<=p||!a((function(){var e=[];return e[m]=!1,e.concat()[0]!==e})),b=d("concat");i({target:"Array",proto:!0,forced:!y||!b},{concat:function(e){var t,n,i,a,o,s=u(this),d=f(s,0),h=0;for(t=-1,i=arguments.length;t<i;t++)if(r(o=-1===t?s:arguments[t])){if(a=c(o.length),v<h+a)throw TypeError(g);for(n=0;n<a;n++,h++)n in o&&l(d,h,o[n])}else{if(v<=h)throw TypeError(g);l(d,h++,o)}return d.length=h,d}})},{"../internals/array-method-has-species-support":21,"../internals/array-species-create":25,"../internals/create-property":39,"../internals/engine-v8-version":47,"../internals/export":49,"../internals/fails":50,"../internals/is-array":71,"../internals/is-object":73,"../internals/to-length":133,"../internals/to-object":134,"../internals/well-known-symbol":145}],149:[function(e,t,n){"use strict";var r=e("../internals/export"),i=e("../internals/array-iteration").every,a=e("../internals/array-method-is-strict"),o=e("../internals/array-method-uses-to-length"),s=a("every"),u=o("every");r({target:"Array",proto:!0,forced:!s||!u},{every:function(e,t){return i(this,e,1<arguments.length?t:void 0)}})},{"../internals/array-iteration":19,"../internals/array-method-is-strict":22,"../internals/array-method-uses-to-length":23,"../internals/export":49}],150:[function(e,t,n){var r=e("../internals/export"),i=e("../internals/array-fill"),a=e("../internals/add-to-unscopables");r({target:"Array",proto:!0},{fill:i}),a("fill")},{"../internals/add-to-unscopables":7,"../internals/array-fill":15,"../internals/export":49}],151:[function(e,t,n){"use strict";var r=e("../internals/export"),i=e("../internals/array-iteration").filter,a=e("../internals/array-method-has-species-support"),o=e("../internals/array-method-uses-to-length"),s=a("filter"),u=o("filter");r({target:"Array",proto:!0,forced:!s||!u},{filter:function(e,t){return i(this,e,1<arguments.length?t:void 0)}})},{"../internals/array-iteration":19,"../internals/array-method-has-species-support":21,"../internals/array-method-uses-to-length":23,"../internals/export":49}],152:[function(e,t,n){"use strict";var r=e("../internals/export"),i=e("../internals/array-for-each");r({target:"Array",proto:!0,forced:[].forEach!=i},{forEach:i})},{"../internals/array-for-each":16,"../internals/export":49}],153:[function(e,t,n){var r=e("../internals/export"),i=e("../internals/array-from");r({target:"Array",stat:!0,forced:!e("../internals/check-correctness-of-iteration")((function(e){Array.from(e)}))},{from:i})},{"../internals/array-from":17,"../internals/check-correctness-of-iteration":27,"../internals/export":49}],154:[function(e,t,n){"use strict";var r=e("../internals/export"),i=e("../internals/array-includes").includes,a=e("../internals/add-to-unscopables");r({target:"Array",proto:!0,forced:!e("../internals/array-method-uses-to-length")("indexOf",{ACCESSORS:!0,1:0})},{includes:function(e,t){return i(this,e,1<arguments.length?t:void 0)}}),a("includes")},{"../internals/add-to-unscopables":7,"../internals/array-includes":18,"../internals/array-method-uses-to-length":23,"../internals/export":49}],155:[function(e,t,n){"use strict";var r=e("../internals/export"),i=e("../internals/array-includes").indexOf,a=e("../internals/array-method-is-strict"),o=e("../internals/array-method-uses-to-length"),s=[].indexOf,u=!!s&&1/[1].indexOf(1,-0)<0,c=a("indexOf"),l=o("indexOf",{ACCESSORS:!0,1:0});r({target:"Array",proto:!0,forced:u||!c||!l},{indexOf:function(e,t){return u?s.apply(this,arguments)||0:i(this,e,1<arguments.length?t:void 0)}})},{"../internals/array-includes":18,"../internals/array-method-is-strict":22,"../internals/array-method-uses-to-length":23,"../internals/export":49}],156:[function(e,t,n){"use strict";var r=e("../internals/to-indexed-object"),i=e("../internals/add-to-unscopables"),a=e("../internals/iterators"),o=e("../internals/internal-state"),s=e("../internals/define-iterator"),u="Array Iterator",c=o.set,l=o.getterFor(u);t.exports=s(Array,"Array",(function(e,t){c(this,{type:u,target:r(e),index:0,kind:t})}),(function(){var e=l(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?{value:e.target=void 0,done:!0}:"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}}),"values"),a.Arguments=a.Array,i("keys"),i("values"),i("entries")},{"../internals/add-to-unscopables":7,"../internals/define-iterator":40,"../internals/internal-state":69,"../internals/iterators":78,"../internals/to-indexed-object":131}],157:[function(e,t,n){"use strict";var r=e("../internals/export"),i=e("../internals/indexed-object"),a=e("../internals/to-indexed-object"),o=e("../internals/array-method-is-strict"),s=[].join,u=i!=Object,c=o("join",",");r({target:"Array",proto:!0,forced:u||!c},{join:function(e){return s.call(a(this),void 0===e?",":e)}})},{"../internals/array-method-is-strict":22,"../internals/export":49,"../internals/indexed-object":65,"../internals/to-indexed-object":131}],158:[function(e,t,n){var r=e("../internals/export"),i=e("../internals/array-last-index-of");r({target:"Array",proto:!0,forced:i!==[].lastIndexOf},{lastIndexOf:i})},{"../internals/array-last-index-of":20,"../internals/export":49}],159:[function(e,t,n){"use strict";var r=e("../internals/export"),i=e("../internals/array-iteration").map,a=e("../internals/array-method-has-species-support"),o=e("../internals/array-method-uses-to-length"),s=a("map"),u=o("map");r({target:"Array",proto:!0,forced:!s||!u},{map:function(e,t){return i(this,e,1<arguments.length?t:void 0)}})},{"../internals/array-iteration":19,"../internals/array-method-has-species-support":21,"../internals/array-method-uses-to-length":23,"../internals/export":49}],160:[function(e,t,n){"use strict";var r=e("../internals/export"),i=e("../internals/is-object"),a=e("../internals/is-array"),o=e("../internals/to-absolute-index"),s=e("../internals/to-length"),u=e("../internals/to-indexed-object"),c=e("../internals/create-property"),l=e("../internals/well-known-symbol"),f=e("../internals/array-method-has-species-support"),d=e("../internals/array-method-uses-to-length"),h=f("slice"),p=d("slice",{ACCESSORS:!0,0:0,1:2}),m=l("species"),v=[].slice,g=Math.max;r({target:"Array",proto:!0,forced:!h||!p},{slice:function(e,t){var n,r,l,f=u(this),d=s(f.length),h=o(e,d),p=o(void 0===t?d:t,d);if(a(f)&&("function"!=typeof(n=f.constructor)||n!==Array&&!a(n.prototype)?i(n)&&null===(n=n[m])&&(n=void 0):n=void 0,n===Array||void 0===n))return v.call(f,h,p);for(r=new(void 0===n?Array:n)(g(p-h,0)),l=0;h<p;h++,l++)h in f&&c(r,l,f[h]);return r.length=l,r}})},{"../internals/array-method-has-species-support":21,"../internals/array-method-uses-to-length":23,"../internals/create-property":39,"../internals/export":49,"../internals/is-array":71,"../internals/is-object":73,"../internals/to-absolute-index":129,"../internals/to-indexed-object":131,"../internals/to-length":133,"../internals/well-known-symbol":145}],161:[function(e,t,n){"use strict";var r=e("../internals/export"),i=e("../internals/array-iteration").some,a=e("../internals/array-method-is-strict"),o=e("../internals/array-method-uses-to-length"),s=a("some"),u=o("some");r({target:"Array",proto:!0,forced:!s||!u},{some:function(e,t){return i(this,e,1<arguments.length?t:void 0)}})},{"../internals/array-iteration":19,"../internals/array-method-is-strict":22,"../internals/array-method-uses-to-length":23,"../internals/export":49}],162:[function(e,t,n){"use strict";var r=e("../internals/export"),i=e("../internals/to-absolute-index"),a=e("../internals/to-integer"),o=e("../internals/to-length"),s=e("../internals/to-object"),u=e("../internals/array-species-create"),c=e("../internals/create-property"),l=e("../internals/array-method-has-species-support"),f=e("../internals/array-method-uses-to-length"),d=l("splice"),h=f("splice",{ACCESSORS:!0,0:0,1:2}),p=Math.max,m=Math.min;r({target:"Array",proto:!0,forced:!d||!h},{splice:function(e,t){var n,r,l,f,d,h,v=s(this),g=o(v.length),y=i(e,g),b=arguments.length;if(0===b?n=r=0:r=1===b?(n=0,g-y):(n=b-2,m(p(a(t),0),g-y)),9007199254740991<g+n-r)throw TypeError("Maximum allowed length exceeded");for(l=u(v,r),f=0;f<r;f++)(d=y+f)in v&&c(l,f,v[d]);if(n<(l.length=r)){for(f=y;f<g-r;f++)h=f+n,(d=f+r)in v?v[h]=v[d]:delete v[h];for(f=g;g-r+n<f;f--)delete v[f-1]}else if(r<n)for(f=g-r;y<f;f--)h=f+n-1,(d=f+r-1)in v?v[h]=v[d]:delete v[h];for(f=0;f<n;f++)v[f+y]=arguments[f+2];return v.length=g-r+n,l}})},{"../internals/array-method-has-species-support":21,"../internals/array-method-uses-to-length":23,"../internals/array-species-create":25,"../internals/create-property":39,"../internals/export":49,"../internals/to-absolute-index":129,"../internals/to-integer":132,"../internals/to-length":133,"../internals/to-object":134}],163:[function(e,t,n){var r=e("../internals/descriptors"),i=e("../internals/object-define-property").f,a=Function.prototype,o=a.toString,s=/^\s*function ([^ (]*)/;!r||"name"in a||i(a,"name",{configurable:!0,get:function(){try{return o.call(this).match(s)[1]}catch(e){return""}}})},{"../internals/descriptors":42,"../internals/object-define-property":91}],164:[function(e,t,n){"use strict";var r=e("../internals/collection"),i=e("../internals/collection-strong");t.exports=r("Map",(function(e){return function(t){return e(this,arguments.length?t:void 0)}}),i)},{"../internals/collection":31,"../internals/collection-strong":30}],165:[function(e,t,n){var r=e("../internals/export"),i=Math.hypot,a=Math.abs,o=Math.sqrt;r({target:"Math",stat:!0,forced:!!i&&i(1/0,NaN)!==1/0},{hypot:function(e,t){for(var n,r,i=0,s=0,u=arguments.length,c=0;s<u;)c<(n=a(arguments[s++]))?(i=i*(r=c/n)*r+1,c=n):i+=0<n?(r=n/c)*r:n;return c===1/0?1/0:c*o(i)}})},{"../internals/export":49}],166:[function(e,t,n){e("../internals/export")({target:"Math",stat:!0},{sign:e("../internals/math-sign")})},{"../internals/export":49,"../internals/math-sign":79}],167:[function(e,t,n){"use strict";function r(e){var t,n,r,i,a,o,s,u,c=f(e,!1);if("string"==typeof c&&2<c.length)if(43===(t=(c=g(c)).charCodeAt(0))||45===t){if(88===(n=c.charCodeAt(2))||120===n)return NaN}else if(48===t){switch(c.charCodeAt(1)){case 66:case 98:r=2,i=49;break;case 79:case 111:r=8,i=55;break;default:return+c}for(o=(a=c.slice(2)).length,s=0;s<o;s++)if((u=a.charCodeAt(s))<48||i<u)return NaN;return parseInt(a,r)}return+c}var i=e("../internals/descriptors"),a=e("../internals/global"),o=e("../internals/is-forced"),s=e("../internals/redefine"),u=e("../internals/has"),c=e("../internals/classof-raw"),l=e("../internals/inherit-if-required"),f=e("../internals/to-primitive"),d=e("../internals/fails"),h=e("../internals/object-create"),p=e("../internals/object-get-own-property-names").f,m=e("../internals/object-get-own-property-descriptor").f,v=e("../internals/object-define-property").f,g=e("../internals/string-trim").trim,y="Number",b=a[y],x=b.prototype,w=c(h(x))==y;if(o(y,!b(" 0o1")||!b("0b1")||b("+0x1"))){for(var _,k=function e(t){var n=arguments.length<1?0:t,i=this;return i instanceof e&&(w?d((function(){x.valueOf.call(i)})):c(i)!=y)?l(new b(r(n)),i,e):r(n)},E=i?p(b):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),S=0;E.length>S;S++)u(b,_=E[S])&&!u(k,_)&&v(k,_,m(b,_));(k.prototype=x).constructor=k,s(a,y,k)}},{"../internals/classof-raw":28,"../internals/descriptors":42,"../internals/fails":50,"../internals/global":58,"../internals/has":59,"../internals/inherit-if-required":66,"../internals/is-forced":72,"../internals/object-create":89,"../internals/object-define-property":91,"../internals/object-get-own-property-descriptor":92,"../internals/object-get-own-property-names":94,"../internals/redefine":107,"../internals/string-trim":126,"../internals/to-primitive":137}],168:[function(e,t,n){e("../internals/export")({target:"Number",stat:!0},{isFinite:e("../internals/number-is-finite")})},{"../internals/export":49,"../internals/number-is-finite":87}],169:[function(e,t,n){"use strict";var r=e("../internals/export"),i=e("../internals/to-integer"),a=e("../internals/this-number-value"),o=e("../internals/string-repeat"),s=e("../internals/fails"),u=1..toFixed,c=Math.floor,l=function e(t,n,r){return 0===n?r:n%2==1?e(t,n-1,r*t):e(t*t,n/2,r)};r({target:"Number",proto:!0,forced:u&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!s((function(){u.call({})}))},{toFixed:function(e){function t(e,t){for(var n=-1,r=t;++n<6;)r+=e*m[n],m[n]=r%1e7,r=c(r/1e7)}function n(e){for(var t=6,n=0;0<=--t;)n+=m[t],m[t]=c(n/e),n=n%e*1e7}function r(){for(var e=6,t="";0<=--e;)if(""!==t||0===e||0!==m[e]){var n=String(m[e]);t=""===t?n:t+o.call("0",7-n.length)+n}return t}var s,u,f,d,h=a(this),p=i(e),m=[0,0,0,0,0,0],v="",g="0";if(p<0||20<p)throw RangeError("Incorrect fraction digits");if(h!=h)return"NaN";if(h<=-1e21||1e21<=h)return String(h);if(h<0&&(v="-",h=-h),1e-21<h)if(u=(s=function(e){for(var t=0,n=e;4096<=n;)t+=12,n/=4096;for(;2<=n;)t+=1,n/=2;return t}(h*l(2,69,1))-69)<0?h*l(2,-s,1):h/l(2,s,1),u*=4503599627370496,0<(s=52-s)){for(t(0,u),f=p;7<=f;)t(1e7,0),f-=7;for(t(l(10,f,1),0),f=s-1;23<=f;)n(1<<23),f-=23;n(1<<f),t(1,1),n(2),g=r()}else t(0,u),t(1<<-s,0),g=r()+o.call("0",p);return 0<p?v+((d=g.length)<=p?"0."+o.call("0",p-d)+g:g.slice(0,d-p)+"."+g.slice(d-p)):v+g}})},{"../internals/export":49,"../internals/fails":50,"../internals/string-repeat":124,"../internals/this-number-value":128,"../internals/to-integer":132}],170:[function(e,t,n){var r=e("../internals/export"),i=e("../internals/object-assign");r({target:"Object",stat:!0,forced:Object.assign!==i},{assign:i})},{"../internals/export":49,"../internals/object-assign":88}],171:[function(e,t,n){var r=e("../internals/export"),i=e("../internals/fails"),a=e("../internals/object-get-own-property-names-external").f;r({target:"Object",stat:!0,forced:i((function(){return!Object.getOwnPropertyNames(1)}))},{getOwnPropertyNames:a})},{"../internals/export":49,"../internals/fails":50,"../internals/object-get-own-property-names-external":93}],172:[function(e,t,n){var r=e("../internals/export"),i=e("../internals/fails"),a=e("../internals/to-object"),o=e("../internals/object-get-prototype-of"),s=e("../internals/correct-prototype-getter");r({target:"Object",stat:!0,forced:i((function(){o(1)})),sham:!s},{getPrototypeOf:function(e){return o(a(e))}})},{"../internals/correct-prototype-getter":34,"../internals/export":49,"../internals/fails":50,"../internals/object-get-prototype-of":96,"../internals/to-object":134}],173:[function(e,t,n){var r=e("../internals/export"),i=e("../internals/to-object"),a=e("../internals/object-keys");r({target:"Object",stat:!0,forced:e("../internals/fails")((function(){a(1)}))},{keys:function(e){return a(i(e))}})},{"../internals/export":49,"../internals/fails":50,"../internals/object-keys":98,"../internals/to-object":134}],174:[function(e,t,n){var r=e("../internals/to-string-tag-support"),i=e("../internals/redefine"),a=e("../internals/object-to-string");r||i(Object.prototype,"toString",a,{unsafe:!0})},{"../internals/object-to-string":101,"../internals/redefine":107,"../internals/to-string-tag-support":138}],175:[function(e,t,n){"use strict";function r(e){var t;return!(!w(e)||"function"!=typeof(t=e.then))&&t}function i(e,t,n){if(!t.notified){t.notified=!0;var i=t.reactions;T((function(){for(var a=t.value,o=1==t.state,s=0;i.length>s;){var u,c,l,f=i[s++],d=o?f.ok:f.fail,h=f.resolve,p=f.reject,m=f.domain;try{d?(o||(2===t.rejection&&ie(e,t),t.rejection=1),!0===d?u=a:(m&&m.enter(),u=d(a),m&&(m.exit(),l=!0)),u===f.promise?p(q("Promise-chain cycle")):(c=r(u))?c.call(u,h,p):h(u)):p(a)}catch(a){m&&!l&&m.exit(),p(a)}}t.reactions=[],t.notified=!1,n&&!t.rejection&&ne(e,t)}))}}function a(e,t,n){var r,i;Z?((r=H.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),p.dispatchEvent(r)):r={promise:t,reason:n},(i=p["on"+e])?i(r):e===Q&&M("Unhandled promise rejection",n)}function o(e,t,n,r){return function(i){e(t,n,i,r)}}function s(e,t,n,r){t.done||(t.done=!0,r&&(t=r),t.value=n,t.state=2,i(e,t,!0))}var u,c,l,f,d=e("../internals/export"),h=e("../internals/is-pure"),p=e("../internals/global"),m=e("../internals/get-built-in"),v=e("../internals/native-promise-constructor"),g=e("../internals/redefine"),y=e("../internals/redefine-all"),b=e("../internals/set-to-string-tag"),x=e("../internals/set-species"),w=e("../internals/is-object"),_=e("../internals/a-function"),k=e("../internals/an-instance"),E=e("../internals/classof-raw"),S=e("../internals/inspect-source"),C=e("../internals/iterate"),A=e("../internals/check-correctness-of-iteration"),O=e("../internals/species-constructor"),D=e("../internals/task").set,T=e("../internals/microtask"),j=e("../internals/promise-resolve"),M=e("../internals/host-report-errors"),F=e("../internals/new-promise-capability"),I=e("../internals/perform"),N=e("../internals/internal-state"),R=e("../internals/is-forced"),P=e("../internals/well-known-symbol"),B=e("../internals/engine-v8-version"),L=P("species"),z="Promise",U=N.get,W=N.set,V=N.getterFor(z),G=v,q=p.TypeError,H=p.document,X=p.process,K=m("fetch"),Y=F.f,$=Y,J="process"==E(X),Z=!!(H&&H.createEvent&&p.dispatchEvent),Q="unhandledrejection",ee=R(z,(function(){if(S(G)===String(G)){if(66===B)return!0;if(!J&&"function"!=typeof PromiseRejectionEvent)return!0}if(h&&!G.prototype.finally)return!0;if(51<=B&&/native code/.test(G))return!1;function e(e){e((function(){}),(function(){}))}var t=G.resolve(1);return(t.constructor={})[L]=e,!(t.then((function(){}))instanceof e)})),te=ee||!A((function(e){G.all(e).catch((function(){}))})),ne=function(e,t){D.call(p,(function(){var n,r=t.value;if(re(t)&&(n=I((function(){J?X.emit("unhandledRejection",r,e):a(Q,e,r)})),t.rejection=J||re(t)?2:1,n.error))throw n.value}))},re=function(e){return 1!==e.rejection&&!e.parent},ie=function(e,t){D.call(p,(function(){J?X.emit("rejectionHandled",e):a("rejectionhandled",e,t.value)}))},ae=function e(t,n,a,u){if(!n.done){n.done=!0,u&&(n=u);try{if(t===a)throw q("Promise can't be resolved itself");var c=r(a);c?T((function(){var r={done:!1};try{c.call(a,o(e,t,r,n),o(s,t,r,n))}catch(a){s(t,r,a,n)}})):(n.value=a,n.state=1,i(t,n,!1))}catch(a){s(t,{done:!1},a,n)}}};ee&&(G=function(e){k(this,G,z),_(e),u.call(this);var t=U(this);try{e(o(ae,this,t),o(s,this,t))}catch(e){s(this,t,e)}},(u=function(){W(this,{type:z,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=y(G.prototype,{then:function(e,t){var n=V(this),r=Y(O(this,G));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=J?X.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&i(this,n,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),c=function(){var e=new u,t=U(e);this.promise=e,this.resolve=o(ae,e,t),this.reject=o(s,e,t)},F.f=Y=function(e){return e===G||e===l?new c(e):$(e)},h||"function"!=typeof v||(f=v.prototype.then,g(v.prototype,"then",(function(e,t){var n=this;return new G((function(e,t){f.call(n,e,t)})).then(e,t)}),{unsafe:!0}),"function"==typeof K&&d({global:!0,enumerable:!0,forced:!0},{fetch:function(e){return j(G,K.apply(p,arguments))}}))),d({global:!0,wrap:!0,forced:ee},{Promise:G}),b(G,z,!1,!0),x(z),l=m(z),d({target:z,stat:!0,forced:ee},{reject:function(e){var t=Y(this);return t.reject.call(void 0,e),t.promise}}),d({target:z,stat:!0,forced:h||ee},{resolve:function(e){return j(h&&this===l?G:this,e)}}),d({target:z,stat:!0,forced:te},{all:function(e){var t=this,n=Y(t),r=n.resolve,i=n.reject,a=I((function(){var n=_(t.resolve),a=[],o=0,s=1;C(e,(function(e){var u=o++,c=!1;a.push(void 0),s++,n.call(t,e).then((function(e){c||(c=!0,a[u]=e,--s||r(a))}),i)})),--s||r(a)}));return a.error&&i(a.value),n.promise},race:function(e){var t=this,n=Y(t),r=n.reject,i=I((function(){var i=_(t.resolve);C(e,(function(e){i.call(t,e).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}})},{"../internals/a-function":5,"../internals/an-instance":9,"../internals/check-correctness-of-iteration":27,"../internals/classof-raw":28,"../internals/engine-v8-version":47,"../internals/export":49,"../internals/get-built-in":55,"../internals/global":58,"../internals/host-report-errors":61,"../internals/inspect-source":67,"../internals/internal-state":69,"../internals/is-forced":72,"../internals/is-object":73,"../internals/is-pure":74,"../internals/iterate":76,"../internals/microtask":80,"../internals/native-promise-constructor":81,"../internals/new-promise-capability":85,"../internals/perform":104,"../internals/promise-resolve":105,"../internals/redefine":107,"../internals/redefine-all":106,"../internals/set-species":115,"../internals/set-to-string-tag":116,"../internals/species-constructor":120,"../internals/task":127,"../internals/well-known-symbol":145}],176:[function(e,t,n){var r=e("../internals/export"),i=e("../internals/get-built-in"),a=e("../internals/a-function"),o=e("../internals/an-object"),s=e("../internals/is-object"),u=e("../internals/object-create"),c=e("../internals/function-bind"),l=e("../internals/fails"),f=i("Reflect","construct"),d=l((function(){function e(){}return!(f((function(){}),[],e)instanceof e)})),h=!l((function(){f((function(){}))})),p=d||h;r({target:"Reflect",stat:!0,forced:p,sham:p},{construct:function(e,t,n){a(e),o(t);var r=arguments.length<3?e:a(n);if(h&&!d)return f(e,t,r);if(e==r){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var i=[null];return i.push.apply(i,t),new(c.apply(e,i))}var l=r.prototype,p=u(s(l)?l:Object.prototype),m=Function.apply.call(e,p,t);return s(m)?m:p}})},{"../internals/a-function":5,"../internals/an-object":10,"../internals/export":49,"../internals/fails":50,"../internals/function-bind":54,"../internals/get-built-in":55,"../internals/is-object":73,"../internals/object-create":89}],177:[function(e,t,n){var r=e("../internals/descriptors"),i=e("../internals/global"),a=e("../internals/is-forced"),o=e("../internals/inherit-if-required"),s=e("../internals/object-define-property").f,u=e("../internals/object-get-own-property-names").f,c=e("../internals/is-regexp"),l=e("../internals/regexp-flags"),f=e("../internals/regexp-sticky-helpers"),d=e("../internals/redefine"),h=e("../internals/fails"),p=e("../internals/internal-state").set,m=e("../internals/set-species"),v=e("../internals/well-known-symbol")("match"),g=i.RegExp,y=g.prototype,b=/a/g,x=/a/g,w=new g(b)!==b,_=f.UNSUPPORTED_Y;if(r&&a("RegExp",!w||_||h((function(){return x[v]=!1,g(b)!=b||g(x)==x||"/a/i"!=g(b,"i")})))){for(var k=function(e){e in E||s(E,e,{configurable:!0,get:function(){return g[e]},set:function(t){g[e]=t}})},E=function e(t,n){var r,i=this instanceof e,a=c(t),s=void 0===n;if(!i&&a&&t.constructor===e&&s)return t;w?a&&!s&&(t=t.source):t instanceof e&&(s&&(n=l.call(t)),t=t.source),_&&(r=!!n&&-1<n.indexOf("y"))&&(n=n.replace(/y/g,""));var u=o(w?new g(t,n):g(t,n),i?this:y,e);return _&&r&&p(u,{sticky:r}),u},S=u(g),C=0;S.length>C;)k(S[C++]);(y.constructor=E).prototype=y,d(i,"RegExp",E)}m("RegExp")},{"../internals/descriptors":42,"../internals/fails":50,"../internals/global":58,"../internals/inherit-if-required":66,"../internals/internal-state":69,"../internals/is-forced":72,"../internals/is-regexp":75,"../internals/object-define-property":91,"../internals/object-get-own-property-names":94,"../internals/redefine":107,"../internals/regexp-flags":110,"../internals/regexp-sticky-helpers":111,"../internals/set-species":115,"../internals/well-known-symbol":145}],178:[function(e,t,n){"use strict";var r=e("../internals/export"),i=e("../internals/regexp-exec");r({target:"RegExp",proto:!0,forced:/./.exec!==i},{exec:i})},{"../internals/export":49,"../internals/regexp-exec":109}],179:[function(e,t,n){"use strict";var r=e("../internals/redefine"),i=e("../internals/an-object"),a=e("../internals/fails"),o=e("../internals/regexp-flags"),s="toString",u=RegExp.prototype,c=u[s],l=a((function(){return"/a/b"!=c.call({source:"a",flags:"b"})})),f=c.name!=s;(l||f)&&r(RegExp.prototype,s,(function(){var e=i(this),t=String(e.source),n=e.flags;return"/"+t+"/"+String(void 0===n&&e instanceof RegExp&&!("flags"in u)?o.call(e):n)}),{unsafe:!0})},{"../internals/an-object":10,"../internals/fails":50,"../internals/redefine":107,"../internals/regexp-flags":110}],180:[function(e,t,n){"use strict";var r=e("../internals/collection"),i=e("../internals/collection-strong");t.exports=r("Set",(function(e){return function(t){return e(this,arguments.length?t:void 0)}}),i)},{"../internals/collection":31,"../internals/collection-strong":30}],181:[function(e,t,n){"use strict";var r,i=e("../internals/export"),a=e("../internals/object-get-own-property-descriptor").f,o=e("../internals/to-length"),s=e("../internals/not-a-regexp"),u=e("../internals/require-object-coercible"),c=e("../internals/correct-is-regexp-logic"),l=e("../internals/is-pure"),f="".endsWith,d=Math.min,h=c("endsWith");i({target:"String",proto:!0,forced:!(!l&&!h&&(r=a(String.prototype,"endsWith"))&&!r.writable||h)},{endsWith:function(e,t){var n=String(u(this));s(e);var r=1<arguments.length?t:void 0,i=o(n.length),a=void 0===r?i:d(o(r),i),c=String(e);return f?f.call(n,c,a):n.slice(a-c.length,a)===c}})},{"../internals/correct-is-regexp-logic":33,"../internals/export":49,"../internals/is-pure":74,"../internals/not-a-regexp":86,"../internals/object-get-own-property-descriptor":92,"../internals/require-object-coercible":112,"../internals/to-length":133}],182:[function(e,t,n){"use strict";var r=e("../internals/export"),i=e("../internals/not-a-regexp"),a=e("../internals/require-object-coercible");r({target:"String",proto:!0,forced:!e("../internals/correct-is-regexp-logic")("includes")},{includes:function(e,t){return!!~String(a(this)).indexOf(i(e),1<arguments.length?t:void 0)}})},{"../internals/correct-is-regexp-logic":33,"../internals/export":49,"../internals/not-a-regexp":86,"../internals/require-object-coercible":112}],183:[function(e,t,n){"use strict";var r=e("../internals/string-multibyte").charAt,i=e("../internals/internal-state"),a=e("../internals/define-iterator"),o="String Iterator",s=i.set,u=i.getterFor(o);a(String,"String",(function(e){s(this,{type:o,string:String(e),index:0})}),(function(){var e,t=u(this),n=t.string,i=t.index;return i>=n.length?{value:void 0,done:!0}:(e=r(n,i),t.index+=e.length,{value:e,done:!1})}))},{"../internals/define-iterator":40,"../internals/internal-state":69,"../internals/string-multibyte":122}],184:[function(e,t,n){"use strict";var r=e("../internals/fix-regexp-well-known-symbol-logic"),i=e("../internals/an-object"),a=e("../internals/to-length"),o=e("../internals/require-object-coercible"),s=e("../internals/advance-string-index"),u=e("../internals/regexp-exec-abstract");r("match",1,(function(e,t,n){return[function(t){var n=o(this),r=null==t?void 0:t[e];return void 0!==r?r.call(t,n):new RegExp(t)[e](String(n))},function(e){var r=n(t,e,this);if(r.done)return r.value;var o=i(e),c=String(this);if(!o.global)return u(o,c);for(var l,f=o.unicode,d=[],h=o.lastIndex=0;null!==(l=u(o,c));){var p=String(l[0]);""===(d[h]=p)&&(o.lastIndex=s(c,a(o.lastIndex),f)),h++}return 0===h?null:d}]}))},{"../internals/advance-string-index":8,"../internals/an-object":10,"../internals/fix-regexp-well-known-symbol-logic":51,"../internals/regexp-exec-abstract":108,"../internals/require-object-coercible":112,"../internals/to-length":133}],185:[function(e,t,n){e("../internals/export")({target:"String",proto:!0},{repeat:e("../internals/string-repeat")})},{"../internals/export":49,"../internals/string-repeat":124}],186:[function(e,t,n){"use strict";var r=e("../internals/fix-regexp-well-known-symbol-logic"),i=e("../internals/an-object"),a=e("../internals/to-object"),o=e("../internals/to-length"),s=e("../internals/to-integer"),u=e("../internals/require-object-coercible"),c=e("../internals/advance-string-index"),l=e("../internals/regexp-exec-abstract"),f=Math.max,d=Math.min,h=Math.floor,p=/\$([$&'`]|\d\d?|<[^>]*>)/g,m=/\$([$&'`]|\d\d?)/g;r("replace",2,(function(e,t,n,r){var v=r.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,g=r.REPLACE_KEEPS_$0,y=v?"$":"$0";return[function(n,r){var i=u(this),a=null==n?void 0:n[e];return void 0!==a?a.call(n,i,r):t.call(String(i),n,r)},function(e,r){if(!v&&g||"string"==typeof r&&-1===r.indexOf(y)){var a=n(t,e,this,r);if(a.done)return a.value}var u=i(e),h=String(this),p="function"==typeof r;p||(r=String(r));var m=u.global;if(m){var x=u.unicode;u.lastIndex=0}for(var w=[];;){var _=l(u,h);if(null===_)break;if(w.push(_),!m)break;""===String(_[0])&&(u.lastIndex=c(h,o(u.lastIndex),x))}for(var k,E="",S=0,C=0;C<w.length;C++){_=w[C];for(var A=String(_[0]),O=f(d(s(_.index),h.length),0),D=[],T=1;T<_.length;T++)D.push(void 0===(k=_[T])?k:String(k));var j=_.groups;if(p){var M=[A].concat(D,O,h);void 0!==j&&M.push(j);var F=String(r.apply(void 0,M))}else F=b(A,h,O,D,j,r);S<=O&&(E+=h.slice(S,O)+F,S=O+A.length)}return E+h.slice(S)}];function b(e,n,r,i,o,s){var u=r+e.length,c=i.length,l=m;return void 0!==o&&(o=a(o),l=p),t.call(s,l,(function(t,a){var s;switch(a.charAt(0)){case"$":return"$";case"&":return e;case"`":return n.slice(0,r);case"'":return n.slice(u);case"<":s=o[a.slice(1,-1)];break;default:var l=+a;if(0==l)return t;if(c<l){var f=h(l/10);return 0===f?t:f<=c?void 0===i[f-1]?a.charAt(1):i[f-1]+a.charAt(1):t}s=i[l-1]}return void 0===s?"":s}))}}))},{"../internals/advance-string-index":8,"../internals/an-object":10,"../internals/fix-regexp-well-known-symbol-logic":51,"../internals/regexp-exec-abstract":108,"../internals/require-object-coercible":112,"../internals/to-integer":132,"../internals/to-length":133,"../internals/to-object":134}],187:[function(e,t,n){"use strict";var r=e("../internals/fix-regexp-well-known-symbol-logic"),i=e("../internals/an-object"),a=e("../internals/require-object-coercible"),o=e("../internals/same-value"),s=e("../internals/regexp-exec-abstract");r("search",1,(function(e,t,n){return[function(t){var n=a(this),r=null==t?void 0:t[e];return void 0!==r?r.call(t,n):new RegExp(t)[e](String(n))},function(e){var r=n(t,e,this);if(r.done)return r.value;var a=i(e),u=String(this),c=a.lastIndex;o(c,0)||(a.lastIndex=0);var l=s(a,u);return o(a.lastIndex,c)||(a.lastIndex=c),null===l?-1:l.index}]}))},{"../internals/an-object":10,"../internals/fix-regexp-well-known-symbol-logic":51,"../internals/regexp-exec-abstract":108,"../internals/require-object-coercible":112,"../internals/same-value":113}],188:[function(e,t,n){"use strict";var r=e("../internals/fix-regexp-well-known-symbol-logic"),i=e("../internals/is-regexp"),a=e("../internals/an-object"),o=e("../internals/require-object-coercible"),s=e("../internals/species-constructor"),u=e("../internals/advance-string-index"),c=e("../internals/to-length"),l=e("../internals/regexp-exec-abstract"),f=e("../internals/regexp-exec"),d=e("../internals/fails"),h=[].push,p=Math.min,m=4294967295,v=!d((function(){return!RegExp(m,"y")}));r("split",2,(function(e,t,n){var r;return r="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||1<".".split(/()()/).length||"".split(/.?/).length?function(e,n){var r=String(o(this)),a=void 0===n?m:n>>>0;if(0==a)return[];if(void 0===e)return[r];if(!i(e))return t.call(r,e,a);for(var s,u,c,l=[],d=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),p=0,v=new RegExp(e.source,d+"g");(s=f.call(v,r))&&!(p<(u=v.lastIndex)&&(l.push(r.slice(p,s.index)),1<s.length&&s.index<r.length&&h.apply(l,s.slice(1)),c=s[0].length,p=u,l.length>=a));)v.lastIndex===s.index&&v.lastIndex++;return p===r.length?!c&&v.test("")||l.push(""):l.push(r.slice(p)),l.length>a?l.slice(0,a):l}:"0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:t.call(this,e,n)}:t,[function(t,n){var i=o(this),a=null==t?void 0:t[e];return void 0!==a?a.call(t,i,n):r.call(String(i),t,n)},function(e,i){var o=n(r,e,this,i,r!==t);if(o.done)return o.value;var f=a(e),d=String(this),h=s(f,RegExp),g=f.unicode,y=(f.ignoreCase?"i":"")+(f.multiline?"m":"")+(f.unicode?"u":"")+(v?"y":"g"),b=new h(v?f:"^(?:"+f.source+")",y),x=void 0===i?m:i>>>0;if(0==x)return[];if(0===d.length)return null===l(b,d)?[d]:[];for(var w=0,_=0,k=[];_<d.length;){b.lastIndex=v?_:0;var E,S=l(b,v?d:d.slice(_));if(null===S||(E=p(c(b.lastIndex+(v?0:_)),d.length))===w)_=u(d,_,g);else{if(k.push(d.slice(w,_)),k.length===x)return k;for(var C=1;C<=S.length-1;C++)if(k.push(S[C]),k.length===x)return k;_=w=E}}return k.push(d.slice(w)),k}]}),!v)},{"../internals/advance-string-index":8,"../internals/an-object":10,"../internals/fails":50,"../internals/fix-regexp-well-known-symbol-logic":51,"../internals/is-regexp":75,"../internals/regexp-exec":109,"../internals/regexp-exec-abstract":108,"../internals/require-object-coercible":112,"../internals/species-constructor":120,"../internals/to-length":133}],189:[function(e,t,n){"use strict";var r=e("../internals/export"),i=e("../internals/create-html");r({target:"String",proto:!0,forced:e("../internals/string-html-forced")("sub")},{sub:function(){return i(this,"sub","","")}})},{"../internals/create-html":35,"../internals/export":49,"../internals/string-html-forced":121}],190:[function(e,t,n){"use strict";var r=e("../internals/export"),i=e("../internals/string-trim").trim;r({target:"String",proto:!0,forced:e("../internals/string-trim-forced")("trim")},{trim:function(){return i(this)}})},{"../internals/export":49,"../internals/string-trim":126,"../internals/string-trim-forced":125}],191:[function(e,t,n){"use strict";var r=e("../internals/export"),i=e("../internals/descriptors"),a=e("../internals/global"),o=e("../internals/has"),s=e("../internals/is-object"),u=e("../internals/object-define-property").f,c=e("../internals/copy-constructor-properties"),l=a.Symbol;if(i&&"function"==typeof l&&(!("description"in l.prototype)||void 0!==l().description)){var f={},d=function e(t){var n=arguments.length<1||void 0===t?void 0:String(t),r=this instanceof e?new l(n):void 0===n?l():l(n);return""===n&&(f[r]=!0),r};c(d,l);var h=d.prototype=l.prototype;h.constructor=d;var p=h.toString,m="Symbol(test)"==String(l("test")),v=/^Symbol\((.*)\)[^)]+$/;u(h,"description",{configurable:!0,get:function(){var e=s(this)?this.valueOf():this,t=p.call(e);if(o(f,e))return"";var n=m?t.slice(7,-1):t.replace(v,"$1");return""===n?void 0:n}}),r({global:!0,forced:!0},{Symbol:d})}},{"../internals/copy-constructor-properties":32,"../internals/descriptors":42,"../internals/export":49,"../internals/global":58,"../internals/has":59,"../internals/is-object":73,"../internals/object-define-property":91}],192:[function(e,t,n){e("../internals/define-well-known-symbol")("iterator")},{"../internals/define-well-known-symbol":41}],193:[function(e,t,n){"use strict";function r(e,t){var n=ne[e]=k($[q]);return X(n,{type:G,tag:e,description:t}),f||(n.description=t),n}function i(e,t){y(e);var n=x(t),r=E(n).concat(he(n));return W(r,(function(t){f&&!de.call(n,t)||fe(e,t,n[t])})),e}function a(e,t){var n=x(e),r=w(t,!0);if(n!==Y||!m(ne,r)||m(re,r)){var i=Z(n,r);return!i||!m(ne,r)||m(n,V)&&n[V][r]||(i.enumerable=!0),i}}function o(e){var t=ee(x(e)),n=[];return W(t,(function(e){m(ne,e)||m(N,e)||n.push(e)})),n}var s=e("../internals/export"),u=e("../internals/global"),c=e("../internals/get-built-in"),l=e("../internals/is-pure"),f=e("../internals/descriptors"),d=e("../internals/native-symbol"),h=e("../internals/use-symbol-as-uid"),p=e("../internals/fails"),m=e("../internals/has"),v=e("../internals/is-array"),g=e("../internals/is-object"),y=e("../internals/an-object"),b=e("../internals/to-object"),x=e("../internals/to-indexed-object"),w=e("../internals/to-primitive"),_=e("../internals/create-property-descriptor"),k=e("../internals/object-create"),E=e("../internals/object-keys"),S=e("../internals/object-get-own-property-names"),C=e("../internals/object-get-own-property-names-external"),A=e("../internals/object-get-own-property-symbols"),O=e("../internals/object-get-own-property-descriptor"),D=e("../internals/object-define-property"),T=e("../internals/object-property-is-enumerable"),j=e("../internals/create-non-enumerable-property"),M=e("../internals/redefine"),F=e("../internals/shared"),I=e("../internals/shared-key"),N=e("../internals/hidden-keys"),R=e("../internals/uid"),P=e("../internals/well-known-symbol"),B=e("../internals/well-known-symbol-wrapped"),L=e("../internals/define-well-known-symbol"),z=e("../internals/set-to-string-tag"),U=e("../internals/internal-state"),W=e("../internals/array-iteration").forEach,V=I("hidden"),G="Symbol",q="prototype",H=P("toPrimitive"),X=U.set,K=U.getterFor(G),Y=Object[q],$=u.Symbol,J=c("JSON","stringify"),Z=O.f,Q=D.f,ee=C.f,te=T.f,ne=F("symbols"),re=F("op-symbols"),ie=F("string-to-symbol-registry"),ae=F("symbol-to-string-registry"),oe=F("wks"),se=u.QObject,ue=!se||!se[q]||!se[q].findChild,ce=f&&p((function(){return 7!=k(Q({},"a",{get:function(){return Q(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=Z(Y,t);r&&delete Y[t],Q(e,t,n),r&&e!==Y&&Q(Y,t,r)}:Q,le=h?function(e){return"symbol"==typeof e}:function(e){return Object(e)instanceof $},fe=function e(t,n,r){t===Y&&e(re,n,r),y(t);var i=w(n,!0);return y(r),m(ne,i)?(r.enumerable?(m(t,V)&&t[V][i]&&(t[V][i]=!1),r=k(r,{enumerable:_(0,!1)})):(m(t,V)||Q(t,V,_(1,{})),t[V][i]=!0),ce(t,i,r)):Q(t,i,r)},de=function(e){var t=w(e,!0),n=te.call(this,t);return!(this===Y&&m(ne,t)&&!m(re,t))&&(!(n||!m(this,t)||!m(ne,t)||m(this,V)&&this[V][t])||n)},he=function(e){var t=e===Y,n=ee(t?re:x(e)),r=[];return W(n,(function(e){!m(ne,e)||t&&!m(Y,e)||r.push(ne[e])})),r};d||(M(($=function(e){if(this instanceof $)throw TypeError("Symbol is not a constructor");var t=arguments.length&&void 0!==e?String(e):void 0,n=R(t),i=function e(t){this===Y&&e.call(re,t),m(this,V)&&m(this[V],n)&&(this[V][n]=!1),ce(this,n,_(1,t))};return f&&ue&&ce(Y,n,{configurable:!0,set:i}),r(n,t)})[q],"toString",(function(){return K(this).tag})),M($,"withoutSetter",(function(e){return r(R(e),e)})),T.f=de,D.f=fe,O.f=a,S.f=C.f=o,A.f=he,B.f=function(e){return r(P(e),e)},f&&(Q($[q],"description",{configurable:!0,get:function(){return K(this).description}}),l||M(Y,"propertyIsEnumerable",de,{unsafe:!0}))),s({global:!0,wrap:!0,forced:!d,sham:!d},{Symbol:$}),W(E(oe),(function(e){L(e)})),s({target:G,stat:!0,forced:!d},{for:function(e){var t=String(e);if(m(ie,t))return ie[t];var n=$(t);return ie[t]=n,ae[n]=t,n},keyFor:function(e){if(!le(e))throw TypeError(e+" is not a symbol");if(m(ae,e))return ae[e]},useSetter:function(){ue=!0},useSimple:function(){ue=!1}}),s({target:"Object",stat:!0,forced:!d,sham:!f},{create:function(e,t){return void 0===t?k(e):i(k(e),t)},defineProperty:fe,defineProperties:i,getOwnPropertyDescriptor:a}),s({target:"Object",stat:!0,forced:!d},{getOwnPropertyNames:o,getOwnPropertySymbols:he}),s({target:"Object",stat:!0,forced:p((function(){A.f(1)}))},{getOwnPropertySymbols:function(e){return A.f(b(e))}}),J&&s({target:"JSON",stat:!0,forced:!d||p((function(){var e=$();return"[null]"!=J([e])||"{}"!=J({a:e})||"{}"!=J(Object(e))}))},{stringify:function(e,t,n){for(var r,i=[e],a=1;a<arguments.length;)i.push(arguments[a++]);if((g(r=t)||void 0!==e)&&!le(e))return v(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!le(t))return t}),i[1]=t,J.apply(null,i)}}),$[q][H]||j($[q],H,$[q].valueOf),z($,G),N[V]=!0},{"../internals/an-object":10,"../internals/array-iteration":19,"../internals/create-non-enumerable-property":37,"../internals/create-property-descriptor":38,"../internals/define-well-known-symbol":41,"../internals/descriptors":42,"../internals/export":49,"../internals/fails":50,"../internals/get-built-in":55,"../internals/global":58,"../internals/has":59,"../internals/hidden-keys":60,"../internals/internal-state":69,"../internals/is-array":71,"../internals/is-object":73,"../internals/is-pure":74,"../internals/native-symbol":82,"../internals/object-create":89,"../internals/object-define-property":91,"../internals/object-get-own-property-descriptor":92,"../internals/object-get-own-property-names":94,"../internals/object-get-own-property-names-external":93,"../internals/object-get-own-property-symbols":95,"../internals/object-keys":98,"../internals/object-property-is-enumerable":99,"../internals/redefine":107,"../internals/set-to-string-tag":116,"../internals/shared":119,"../internals/shared-key":117,"../internals/to-indexed-object":131,"../internals/to-object":134,"../internals/to-primitive":137,"../internals/uid":142,"../internals/use-symbol-as-uid":143,"../internals/well-known-symbol":145,"../internals/well-known-symbol-wrapped":144}],194:[function(e,t,n){"use strict";var r=e("../internals/array-buffer-view-core"),i=e("../internals/array-copy-within"),a=r.aTypedArray;(0,r.exportTypedArrayMethod)("copyWithin",(function(e,t,n){return i.call(a(this),e,t,2<arguments.length?n:void 0)}))},{"../internals/array-buffer-view-core":12,"../internals/array-copy-within":14}],195:[function(e,t,n){"use strict";var r=e("../internals/array-buffer-view-core"),i=e("../internals/array-iteration").every,a=r.aTypedArray;(0,r.exportTypedArrayMethod)("every",(function(e,t){return i(a(this),e,1<arguments.length?t:void 0)}))},{"../internals/array-buffer-view-core":12,"../internals/array-iteration":19}],196:[function(e,t,n){"use strict";var r=e("../internals/array-buffer-view-core"),i=e("../internals/array-fill"),a=r.aTypedArray;(0,r.exportTypedArrayMethod)("fill",(function(e){return i.apply(a(this),arguments)}))},{"../internals/array-buffer-view-core":12,"../internals/array-fill":15}],197:[function(e,t,n){"use strict";var r=e("../internals/array-buffer-view-core"),i=e("../internals/array-iteration").filter,a=e("../internals/species-constructor"),o=r.aTypedArray,s=r.aTypedArrayConstructor;(0,r.exportTypedArrayMethod)("filter",(function(e,t){for(var n=i(o(this),e,1<arguments.length?t:void 0),r=a(this,this.constructor),u=0,c=n.length,l=new(s(r))(c);u<c;)l[u]=n[u++];return l}))},{"../internals/array-buffer-view-core":12,"../internals/array-iteration":19,"../internals/species-constructor":120}],198:[function(e,t,n){"use strict";var r=e("../internals/array-buffer-view-core"),i=e("../internals/array-iteration").findIndex,a=r.aTypedArray;(0,r.exportTypedArrayMethod)("findIndex",(function(e,t){return i(a(this),e,1<arguments.length?t:void 0)}))},{"../internals/array-buffer-view-core":12,"../internals/array-iteration":19}],199:[function(e,t,n){"use strict";var r=e("../internals/array-buffer-view-core"),i=e("../internals/array-iteration").find,a=r.aTypedArray;(0,r.exportTypedArrayMethod)("find",(function(e,t){return i(a(this),e,1<arguments.length?t:void 0)}))},{"../internals/array-buffer-view-core":12,"../internals/array-iteration":19}],200:[function(e,t,n){e("../internals/typed-array-constructor")("Float32",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},{"../internals/typed-array-constructor":139}],201:[function(e,t,n){e("../internals/typed-array-constructor")("Float64",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},{"../internals/typed-array-constructor":139}],202:[function(e,t,n){"use strict";var r=e("../internals/array-buffer-view-core"),i=e("../internals/array-iteration").forEach,a=r.aTypedArray;(0,r.exportTypedArrayMethod)("forEach",(function(e,t){i(a(this),e,1<arguments.length?t:void 0)}))},{"../internals/array-buffer-view-core":12,"../internals/array-iteration":19}],203:[function(e,t,n){"use strict";var r=e("../internals/array-buffer-view-core"),i=e("../internals/array-includes").includes,a=r.aTypedArray;(0,r.exportTypedArrayMethod)("includes",(function(e,t){return i(a(this),e,1<arguments.length?t:void 0)}))},{"../internals/array-buffer-view-core":12,"../internals/array-includes":18}],204:[function(e,t,n){"use strict";var r=e("../internals/array-buffer-view-core"),i=e("../internals/array-includes").indexOf,a=r.aTypedArray;(0,r.exportTypedArrayMethod)("indexOf",(function(e,t){return i(a(this),e,1<arguments.length?t:void 0)}))},{"../internals/array-buffer-view-core":12,"../internals/array-includes":18}],205:[function(e,t,n){e("../internals/typed-array-constructor")("Int16",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},{"../internals/typed-array-constructor":139}],206:[function(e,t,n){e("../internals/typed-array-constructor")("Int32",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},{"../internals/typed-array-constructor":139}],207:[function(e,t,n){"use strict";function r(){return c.call(d(this))}var i=e("../internals/global"),a=e("../internals/array-buffer-view-core"),o=e("../modules/es.array.iterator"),s=e("../internals/well-known-symbol")("iterator"),u=i.Uint8Array,c=o.values,l=o.keys,f=o.entries,d=a.aTypedArray,h=a.exportTypedArrayMethod,p=u&&u.prototype[s],m=!!p&&("values"==p.name||null==p.name);h("entries",(function(){return f.call(d(this))})),h("keys",(function(){return l.call(d(this))})),h("values",r,!m),h(s,r,!m)},{"../internals/array-buffer-view-core":12,"../internals/global":58,"../internals/well-known-symbol":145,"../modules/es.array.iterator":156}],208:[function(e,t,n){"use strict";var r=e("../internals/array-buffer-view-core"),i=r.aTypedArray,a=r.exportTypedArrayMethod,o=[].join;a("join",(function(e){return o.apply(i(this),arguments)}))},{"../internals/array-buffer-view-core":12}],209:[function(e,t,n){"use strict";var r=e("../internals/array-buffer-view-core"),i=e("../internals/array-last-index-of"),a=r.aTypedArray;(0,r.exportTypedArrayMethod)("lastIndexOf",(function(e){return i.apply(a(this),arguments)}))},{"../internals/array-buffer-view-core":12,"../internals/array-last-index-of":20}],210:[function(e,t,n){"use strict";var r=e("../internals/array-buffer-view-core"),i=e("../internals/array-iteration").map,a=e("../internals/species-constructor"),o=r.aTypedArray,s=r.aTypedArrayConstructor;(0,r.exportTypedArrayMethod)("map",(function(e,t){return i(o(this),e,1<arguments.length?t:void 0,(function(e,t){return new(s(a(e,e.constructor)))(t)}))}))},{"../internals/array-buffer-view-core":12,"../internals/array-iteration":19,"../internals/species-constructor":120}],211:[function(e,t,n){"use strict";var r=e("../internals/array-buffer-view-core"),i=e("../internals/array-reduce").right,a=r.aTypedArray;(0,r.exportTypedArrayMethod)("reduceRight",(function(e,t){return i(a(this),e,arguments.length,1<arguments.length?t:void 0)}))},{"../internals/array-buffer-view-core":12,"../internals/array-reduce":24}],212:[function(e,t,n){"use strict";var r=e("../internals/array-buffer-view-core"),i=e("../internals/array-reduce").left,a=r.aTypedArray;(0,r.exportTypedArrayMethod)("reduce",(function(e,t){return i(a(this),e,arguments.length,1<arguments.length?t:void 0)}))},{"../internals/array-buffer-view-core":12,"../internals/array-reduce":24}],213:[function(e,t,n){"use strict";var r=e("../internals/array-buffer-view-core"),i=r.aTypedArray,a=r.exportTypedArrayMethod,o=Math.floor;a("reverse",(function(){for(var e,t=i(this).length,n=o(t/2),r=0;r<n;)e=this[r],this[r++]=this[--t],this[t]=e;return this}))},{"../internals/array-buffer-view-core":12}],214:[function(e,t,n){"use strict";var r=e("../internals/array-buffer-view-core"),i=e("../internals/to-length"),a=e("../internals/to-offset"),o=e("../internals/to-object"),s=e("../internals/fails"),u=r.aTypedArray;(0,r.exportTypedArrayMethod)("set",(function(e,t){u(this);var n=a(1<arguments.length?t:void 0,1),r=this.length,s=o(e),c=i(s.length),l=0;if(r<c+n)throw RangeError("Wrong length");for(;l<c;)this[n+l]=s[l++]}),s((function(){new Int8Array(1).set({})})))},{"../internals/array-buffer-view-core":12,"../internals/fails":50,"../internals/to-length":133,"../internals/to-object":134,"../internals/to-offset":135}],215:[function(e,t,n){"use strict";var r=e("../internals/array-buffer-view-core"),i=e("../internals/species-constructor"),a=e("../internals/fails"),o=r.aTypedArray,s=r.aTypedArrayConstructor,u=r.exportTypedArrayMethod,c=[].slice;u("slice",(function(e,t){for(var n=c.call(o(this),e,t),r=i(this,this.constructor),a=0,u=n.length,l=new(s(r))(u);a<u;)l[a]=n[a++];return l}),a((function(){new Int8Array(1).slice()})))},{"../internals/array-buffer-view-core":12,"../internals/fails":50,"../internals/species-constructor":120}],216:[function(e,t,n){"use strict";var r=e("../internals/array-buffer-view-core"),i=e("../internals/array-iteration").some,a=r.aTypedArray;(0,r.exportTypedArrayMethod)("some",(function(e,t){return i(a(this),e,1<arguments.length?t:void 0)}))},{"../internals/array-buffer-view-core":12,"../internals/array-iteration":19}],217:[function(e,t,n){"use strict";var r=e("../internals/array-buffer-view-core"),i=r.aTypedArray,a=r.exportTypedArrayMethod,o=[].sort;a("sort",(function(e){return o.call(i(this),e)}))},{"../internals/array-buffer-view-core":12}],218:[function(e,t,n){"use strict";var r=e("../internals/array-buffer-view-core"),i=e("../internals/to-length"),a=e("../internals/to-absolute-index"),o=e("../internals/species-constructor"),s=r.aTypedArray;(0,r.exportTypedArrayMethod)("subarray",(function(e,t){var n=s(this),r=n.length,u=a(e,r);return new(o(n,n.constructor))(n.buffer,n.byteOffset+u*n.BYTES_PER_ELEMENT,i((void 0===t?r:a(t,r))-u))}))},{"../internals/array-buffer-view-core":12,"../internals/species-constructor":120,"../internals/to-absolute-index":129,"../internals/to-length":133}],219:[function(e,t,n){"use strict";var r=e("../internals/global"),i=e("../internals/array-buffer-view-core"),a=e("../internals/fails"),o=r.Int8Array,s=i.aTypedArray,u=i.exportTypedArrayMethod,c=[].toLocaleString,l=[].slice,f=!!o&&a((function(){c.call(new o(1))}));u("toLocaleString",(function(){return c.apply(f?l.call(s(this)):s(this),arguments)}),a((function(){return[1,2].toLocaleString()!=new o([1,2]).toLocaleString()}))||!a((function(){o.prototype.toLocaleString.call([1,2])})))},{"../internals/array-buffer-view-core":12,"../internals/fails":50,"../internals/global":58}],220:[function(e,t,n){"use strict";var r=e("../internals/array-buffer-view-core").exportTypedArrayMethod,i=e("../internals/fails"),a=e("../internals/global").Uint8Array,o=a&&a.prototype||{},s=[].toString,u=[].join;i((function(){s.call({})}))&&(s=function(){return u.call(this)}),r("toString",s,o.toString!=s)},{"../internals/array-buffer-view-core":12,"../internals/fails":50,"../internals/global":58}],221:[function(e,t,n){e("../internals/typed-array-constructor")("Uint16",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},{"../internals/typed-array-constructor":139}],222:[function(e,t,n){e("../internals/typed-array-constructor")("Uint32",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},{"../internals/typed-array-constructor":139}],223:[function(e,t,n){e("../internals/typed-array-constructor")("Uint8",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},{"../internals/typed-array-constructor":139}],224:[function(e,t,n){e("../internals/typed-array-constructor")("Uint8",(function(e){return function(t,n,r){return e(this,t,n,r)}}),!0)},{"../internals/typed-array-constructor":139}],225:[function(e,t,n){var r=e("../internals/global"),i=e("../internals/dom-iterables"),a=e("../internals/array-for-each"),o=e("../internals/create-non-enumerable-property");for(var s in i){var u=r[s],c=u&&u.prototype;if(c&&c.forEach!==a)try{o(c,"forEach",a)}catch(e){c.forEach=a}}},{"../internals/array-for-each":16,"../internals/create-non-enumerable-property":37,"../internals/dom-iterables":44,"../internals/global":58}],226:[function(e,t,n){var r=e("../internals/global"),i=e("../internals/dom-iterables"),a=e("../modules/es.array.iterator"),o=e("../internals/create-non-enumerable-property"),s=e("../internals/well-known-symbol"),u=s("iterator"),c=s("toStringTag"),l=a.values;for(var f in i){var d=r[f],h=d&&d.prototype;if(h){if(h[u]!==l)try{o(h,u,l)}catch(e){h[u]=l}if(h[c]||o(h,c,f),i[f])for(var p in a)if(h[p]!==a[p])try{o(h,p,a[p])}catch(e){h[p]=a[p]}}}},{"../internals/create-non-enumerable-property":37,"../internals/dom-iterables":44,"../internals/global":58,"../internals/well-known-symbol":145,"../modules/es.array.iterator":156}],227:[function(e,t,n){"use strict";function r(e){try{return decodeURIComponent(e)}catch(t){return e}}function i(e){var t,n=e.replace(P," "),i=4;try{return decodeURIComponent(n)}catch(e){for(;i;)n=n.replace((t=i--,B[t-1]||(B[t-1]=RegExp("((?:%[\\da-f]{2}){"+t+"})","gi"))),r);return n}}function a(e){return z[e]}function o(e){return encodeURIComponent(e).replace(L,a)}function s(e,t){if(t)for(var n,r,a=t.split("&"),o=0;o<a.length;)(n=a[o++]).length&&(r=n.split("="),e.push({key:i(r.shift()),value:i(r.join("="))}))}function u(e){this.entries.length=0,s(this.entries,e)}function c(e,t){if(e<t)throw TypeError("Not enough arguments")}e("../modules/es.array.iterator");var l=e("../internals/export"),f=e("../internals/get-built-in"),d=e("../internals/native-url"),h=e("../internals/redefine"),p=e("../internals/redefine-all"),m=e("../internals/set-to-string-tag"),v=e("../internals/create-iterator-constructor"),g=e("../internals/internal-state"),y=e("../internals/an-instance"),b=e("../internals/has"),x=e("../internals/function-bind-context"),w=e("../internals/classof"),_=e("../internals/an-object"),k=e("../internals/is-object"),E=e("../internals/object-create"),S=e("../internals/create-property-descriptor"),C=e("../internals/get-iterator"),A=e("../internals/get-iterator-method"),O=e("../internals/well-known-symbol"),D=f("fetch"),T=f("Headers"),j=O("iterator"),M="URLSearchParams",F=M+"Iterator",I=g.set,N=g.getterFor(M),R=g.getterFor(F),P=/\+/g,B=Array(4),L=/[!'()~]|%20/g,z={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},U=v((function(e,t){I(this,{type:F,iterator:C(N(e).entries),kind:t})}),"Iterator",(function(){var e=R(this),t=e.kind,n=e.iterator.next(),r=n.value;return n.done||(n.value="keys"===t?r.key:"values"===t?r.value:[r.key,r.value]),n})),W=function e(t){y(this,e,M);var n,r,i,a,o,c,l,f,d,h=0<arguments.length?t:void 0,p=[];if(I(this,{type:M,entries:p,updateURL:function(){},updateSearchParams:u}),void 0!==h)if(k(h))if("function"==typeof(n=A(h)))for(i=(r=n.call(h)).next;!(a=i.call(r)).done;){if((l=(c=(o=C(_(a.value))).next).call(o)).done||(f=c.call(o)).done||!c.call(o).done)throw TypeError("Expected sequence with length 2");p.push({key:l.value+"",value:f.value+""})}else for(d in h)b(h,d)&&p.push({key:d,value:h[d]+""});else s(p,"string"==typeof h?"?"===h.charAt(0)?h.slice(1):h:h+"")},V=W.prototype;p(V,{append:function(e,t){c(arguments.length,2);var n=N(this);n.entries.push({key:e+"",value:t+""}),n.updateURL()},delete:function(e){c(arguments.length,1);for(var t=N(this),n=t.entries,r=e+"",i=0;i<n.length;)n[i].key===r?n.splice(i,1):i++;t.updateURL()},get:function(e){c(arguments.length,1);for(var t=N(this).entries,n=e+"",r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){c(arguments.length,1);for(var t=N(this).entries,n=e+"",r=[],i=0;i<t.length;i++)t[i].key===n&&r.push(t[i].value);return r},has:function(e){c(arguments.length,1);for(var t=N(this).entries,n=e+"",r=0;r<t.length;)if(t[r++].key===n)return!0;return!1},set:function(e,t){c(arguments.length,1);for(var n,r=N(this),i=r.entries,a=!1,o=e+"",s=t+"",u=0;u<i.length;u++)(n=i[u]).key===o&&(a?i.splice(u--,1):(a=!0,n.value=s));a||i.push({key:o,value:s}),r.updateURL()},sort:function(){var e,t,n,r=N(this),i=r.entries,a=i.slice();for(n=i.length=0;n<a.length;n++){for(e=a[n],t=0;t<n;t++)if(i[t].key>e.key){i.splice(t,0,e);break}t===n&&i.push(e)}r.updateURL()},forEach:function(e,t){for(var n,r=N(this).entries,i=x(e,1<arguments.length?t:void 0,3),a=0;a<r.length;)i((n=r[a++]).value,n.key,this)},keys:function(){return new U(this,"keys")},values:function(){return new U(this,"values")},entries:function(){return new U(this,"entries")}},{enumerable:!0}),h(V,j,V.entries),h(V,"toString",(function(){for(var e,t=N(this).entries,n=[],r=0;r<t.length;)e=t[r++],n.push(o(e.key)+"="+o(e.value));return n.join("&")}),{enumerable:!0}),m(W,M),l({global:!0,forced:!d},{URLSearchParams:W}),d||"function"!=typeof D||"function"!=typeof T||l({global:!0,enumerable:!0,forced:!0},{fetch:function(e,t){var n,r,i,a=[e];return 1<arguments.length&&(k(n=t)&&(r=n.body,w(r)===M&&((i=n.headers?new T(n.headers):new T).has("content-type")||i.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),n=E(n,{body:S(0,String(r)),headers:S(0,i)}))),a.push(n)),D.apply(this,a)}}),t.exports={URLSearchParams:W,getState:N}},{"../internals/an-instance":9,"../internals/an-object":10,"../internals/classof":29,"../internals/create-iterator-constructor":36,"../internals/create-property-descriptor":38,"../internals/export":49,"../internals/function-bind-context":53,"../internals/get-built-in":55,"../internals/get-iterator":57,"../internals/get-iterator-method":56,"../internals/has":59,"../internals/internal-state":69,"../internals/is-object":73,"../internals/native-url":83,"../internals/object-create":89,"../internals/redefine":107,"../internals/redefine-all":106,"../internals/set-to-string-tag":116,"../internals/well-known-symbol":145,"../modules/es.array.iterator":156}],228:[function(e,t,n){"use strict";function r(e,t){var n,r,i;if("["==t.charAt(0)){if("]"!=t.charAt(t.length-1))return R;if(!(n=$(t.slice(1,-1))))return R;e.host=n}else if(re(e)){if(t=E(t),q.test(t))return R;if(null===(n=Y(t)))return R;e.host=n}else{if(H.test(t))return R;for(n="",r=_(t),i=0;i<r.length;i++)n+=te(r[i],J);e.host=n}}function i(e){var t,n,r,i;if("number"==typeof e){for(t=[],n=0;n<4;n++)t.unshift(e%256),e=F(e/256);return t.join(".")}if("object"!=typeof e)return e;for(t="",r=function(e){for(var t=null,n=1,r=null,i=0,a=0;a<8;a++)0!==e[a]?(n<i&&(t=r,n=i),r=null,i=0):(null===r&&(r=a),++i);return n<i&&(t=r,n=i),t}(e),n=0;n<8;n++)i&&0===e[n]||(i=i&&!1,r===n?(t+=n?":":"::",i=!0):(t+=e[n].toString(16),n<7&&(t+=":")));return"["+t+"]"}function a(e){return""!=e.username||""!=e.password}function o(e){return!e.host||e.cannotBeABaseURL||"file"==e.scheme}function s(e,t){var n;return 2==e.length&&B.test(e.charAt(0))&&(":"==(n=e.charAt(1))||!t&&"|"==n)}function u(e){var t;return 1<e.length&&s(e.slice(0,2))&&(2==e.length||"/"===(t=e.charAt(2))||"\\"===t||"?"===t||"#"===t)}function c(e){var t=e.path,n=t.length;!n||"file"==e.scheme&&1==n&&s(t[0],!0)||t.pop()}function l(e,t,n,i){var o,l,f,h,p,m,v=n||ie,g=0,y="",b=!1,w=!1,k=!1;for(n||(e.scheme="",e.username="",e.password="",e.host=null,e.port=null,e.path=[],e.query=null,e.fragment=null,e.cannotBeABaseURL=!1,t=t.replace(X,"")),t=t.replace(K,""),o=_(t);g<=o.length;){switch(l=o[g],v){case ie:if(!l||!B.test(l)){if(n)return N;v=oe;continue}y+=l.toLowerCase(),v=ae;break;case ae:if(l&&(L.test(l)||"+"==l||"-"==l||"."==l))y+=l.toLowerCase();else{if(":"!=l){if(n)return N;y="",v=oe,g=0;continue}if(n&&(re(e)!=x(ne,y)||"file"==y&&(a(e)||null!==e.port)||"file"==e.scheme&&!e.host))return;if(e.scheme=y,n)return void(re(e)&&ne[e.scheme]==e.port&&(e.port=null));y="","file"==e.scheme?v=ge:re(e)&&i&&i.scheme==e.scheme?v=se:re(e)?v=fe:"/"==o[g+1]?(v=ue,g++):(e.cannotBeABaseURL=!0,e.path.push(""),v=_e)}break;case oe:if(!i||i.cannotBeABaseURL&&"#"!=l)return N;if(i.cannotBeABaseURL&&"#"==l){e.scheme=i.scheme,e.path=i.path.slice(),e.query=i.query,e.fragment="",e.cannotBeABaseURL=!0,v=Ee;break}v="file"==i.scheme?ge:ce;continue;case se:if("/"!=l||"/"!=o[g+1]){v=ce;continue}v=de,g++;break;case ue:if("/"==l){v=he;break}v=we;continue;case ce:if(e.scheme=i.scheme,l==d)e.username=i.username,e.password=i.password,e.host=i.host,e.port=i.port,e.path=i.path.slice(),e.query=i.query;else if("/"==l||"\\"==l&&re(e))v=le;else if("?"==l)e.username=i.username,e.password=i.password,e.host=i.host,e.port=i.port,e.path=i.path.slice(),e.query="",v=ke;else{if("#"!=l){e.username=i.username,e.password=i.password,e.host=i.host,e.port=i.port,e.path=i.path.slice(),e.path.pop(),v=we;continue}e.username=i.username,e.password=i.password,e.host=i.host,e.port=i.port,e.path=i.path.slice(),e.query=i.query,e.fragment="",v=Ee}break;case le:if(!re(e)||"/"!=l&&"\\"!=l){if("/"!=l){e.username=i.username,e.password=i.password,e.host=i.host,e.port=i.port,v=we;continue}v=he}else v=de;break;case fe:if(v=de,"/"!=l||"/"!=y.charAt(g+1))continue;g++;break;case de:if("/"==l||"\\"==l)break;v=he;continue;case he:if("@"==l){b&&(y="%40"+y),b=!0,f=_(y);for(var E=0;E<f.length;E++){var S=f[E];if(":"!=S||k){var C=te(S,ee);k?e.password+=C:e.username+=C}else k=!0}y=""}else if(l==d||"/"==l||"?"==l||"#"==l||"\\"==l&&re(e)){if(b&&""==y)return"Invalid authority";g-=_(y).length+1,y="",v=pe}else y+=l;break;case pe:case me:if(n&&"file"==e.scheme){v=be;continue}if(":"!=l||w){if(l==d||"/"==l||"?"==l||"#"==l||"\\"==l&&re(e)){if(re(e)&&""==y)return R;if(n&&""==y&&(a(e)||null!==e.port))return;if(h=r(e,y))return h;if(y="",v=xe,n)return;continue}"["==l?w=!0:"]"==l&&(w=!1),y+=l}else{if(""==y)return R;if(h=r(e,y))return h;if(y="",v=ve,n==me)return}break;case ve:if(!z.test(l)){if(l==d||"/"==l||"?"==l||"#"==l||"\\"==l&&re(e)||n){if(""!=y){var A=parseInt(y,10);if(65535<A)return P;e.port=re(e)&&A===ne[e.scheme]?null:A,y=""}if(n)return;v=xe;continue}return P}y+=l;break;case ge:if(e.scheme="file","/"==l||"\\"==l)v=ye;else{if(!i||"file"!=i.scheme){v=we;continue}if(l==d)e.host=i.host,e.path=i.path.slice(),e.query=i.query;else if("?"==l)e.host=i.host,e.path=i.path.slice(),e.query="",v=ke;else{if("#"!=l){u(o.slice(g).join(""))||(e.host=i.host,e.path=i.path.slice(),c(e)),v=we;continue}e.host=i.host,e.path=i.path.slice(),e.query=i.query,e.fragment="",v=Ee}}break;case ye:if("/"==l||"\\"==l){v=be;break}i&&"file"==i.scheme&&!u(o.slice(g).join(""))&&(s(i.path[0],!0)?e.path.push(i.path[0]):e.host=i.host),v=we;continue;case be:if(l==d||"/"==l||"\\"==l||"?"==l||"#"==l){if(!n&&s(y))v=we;else if(""==y){if(e.host="",n)return;v=xe}else{if(h=r(e,y))return h;if("localhost"==e.host&&(e.host=""),n)return;y="",v=xe}continue}y+=l;break;case xe:if(re(e)){if(v=we,"/"!=l&&"\\"!=l)continue}else if(n||"?"!=l)if(n||"#"!=l){if(l!=d&&(v=we,"/"!=l))continue}else e.fragment="",v=Ee;else e.query="",v=ke;break;case we:if(l==d||"/"==l||"\\"==l&&re(e)||!n&&("?"==l||"#"==l)){if(".."===(m=(m=y).toLowerCase())||"%2e."===m||".%2e"===m||"%2e%2e"===m?(c(e),"/"==l||"\\"==l&&re(e)||e.path.push("")):"."===(p=y)||"%2e"===p.toLowerCase()?"/"==l||"\\"==l&&re(e)||e.path.push(""):("file"==e.scheme&&!e.path.length&&s(y)&&(e.host&&(e.host=""),y=y.charAt(0)+":"),e.path.push(y)),y="","file"==e.scheme&&(l==d||"?"==l||"#"==l))for(;1<e.path.length&&""===e.path[0];)e.path.shift();"?"==l?(e.query="",v=ke):"#"==l&&(e.fragment="",v=Ee)}else y+=te(l,Q);break;case _e:"?"==l?(e.query="",v=ke):"#"==l?(e.fragment="",v=Ee):l!=d&&(e.path[0]+=te(l,J));break;case ke:n||"#"!=l?l!=d&&("'"==l&&re(e)?e.query+="%27":e.query+="#"==l?"%23":te(l,J)):(e.fragment="",v=Ee);break;case Ee:l!=d&&(e.fragment+=te(l,Z))}g++}}function f(e,t){return{get:e,set:t,configurable:!0,enumerable:!0}}e("../modules/es.string.iterator");var d,h=e("../internals/export"),p=e("../internals/descriptors"),m=e("../internals/native-url"),v=e("../internals/global"),g=e("../internals/object-define-properties"),y=e("../internals/redefine"),b=e("../internals/an-instance"),x=e("../internals/has"),w=e("../internals/object-assign"),_=e("../internals/array-from"),k=e("../internals/string-multibyte").codeAt,E=e("../internals/string-punycode-to-ascii"),S=e("../internals/set-to-string-tag"),C=e("../modules/web.url-search-params"),A=e("../internals/internal-state"),O=v.URL,D=C.URLSearchParams,T=C.getState,j=A.set,M=A.getterFor("URL"),F=Math.floor,I=Math.pow,N="Invalid scheme",R="Invalid host",P="Invalid port",B=/[A-Za-z]/,L=/[\d+-.A-Za-z]/,z=/\d/,U=/^(0x|0X)/,W=/^[0-7]+$/,V=/^\d+$/,G=/^[\dA-Fa-f]+$/,q=/[\u0000\u0009\u000A\u000D #%/:?@[\\]]/,H=/[\u0000\u0009\u000A\u000D #/:?@[\\]]/,X=/^[\u0000-\u001F ]+|[\u0000-\u001F ]+$/g,K=/[\u0009\u000A\u000D]/g,Y=function(e){var t,n,r,i,a,o,s,u=e.split(".");if(u.length&&""==u[u.length-1]&&u.pop(),4<(t=u.length))return e;for(n=[],r=0;r<t;r++){if(""==(i=u[r]))return e;if(a=10,1<i.length&&"0"==i.charAt(0)&&(a=U.test(i)?16:8,i=i.slice(8==a?1:2)),""===i)o=0;else{if(!(10==a?V:8==a?W:G).test(i))return e;o=parseInt(i,a)}n.push(o)}for(r=0;r<t;r++)if(o=n[r],r==t-1){if(o>=I(256,5-t))return null}else if(255<o)return null;for(s=n.pop(),r=0;r<n.length;r++)s+=n[r]*I(256,3-r);return s},$=function(e){function t(){return e.charAt(d)}var n,r,i,a,o,s,u,c=[0,0,0,0,0,0,0,0],l=0,f=null,d=0;if(":"==t()){if(":"!=e.charAt(1))return;d+=2,f=++l}for(;t();){if(8==l)return;if(":"!=t()){for(n=r=0;r<4&&G.test(t());)n=16*n+parseInt(t(),16),d++,r++;if("."==t()){if(0==r)return;if(d-=r,6<l)return;for(i=0;t();){if(a=null,0<i){if(!("."==t()&&i<4))return;d++}if(!z.test(t()))return;for(;z.test(t());){if(o=parseInt(t(),10),null===a)a=o;else{if(0==a)return;a=10*a+o}if(255<a)return;d++}c[l]=256*c[l]+a,2!=++i&&4!=i||l++}if(4!=i)return;break}if(":"==t()){if(d++,!t())return}else if(t())return;c[l++]=n}else{if(null!==f)return;d++,f=++l}}if(null!==f)for(s=l-f,l=7;0!=l&&0<s;)u=c[l],c[l--]=c[f+s-1],c[f+--s]=u;else if(8!=l)return;return c},J={},Z=w({},J,{" ":1,'"':1,"<":1,">":1,"`":1}),Q=w({},Z,{"#":1,"?":1,"{":1,"}":1}),ee=w({},Q,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),te=function(e,t){var n=k(e,0);return 32<n&&n<127&&!x(t,e)?e:encodeURIComponent(e)},ne={ftp:21,file:null,http:80,https:443,ws:80,wss:443},re=function(e){return x(ne,e.scheme)},ie={},ae={},oe={},se={},ue={},ce={},le={},fe={},de={},he={},pe={},me={},ve={},ge={},ye={},be={},xe={},we={},_e={},ke={},Ee={},Se=function e(t,n){var r,i,a=b(this,e,"URL"),o=1<arguments.length?n:void 0,s=String(t),u=j(a,{type:"URL"});if(void 0!==o)if(o instanceof e)r=M(o);else if(i=l(r={},String(o)))throw TypeError(i);if(i=l(u,s,null,r))throw TypeError(i);var c=u.searchParams=new D,f=T(c);f.updateSearchParams(u.query),f.updateURL=function(){u.query=String(c)||null},p||(a.href=Ae.call(a),a.origin=Oe.call(a),a.protocol=De.call(a),a.username=Te.call(a),a.password=je.call(a),a.host=Me.call(a),a.hostname=Fe.call(a),a.port=Ie.call(a),a.pathname=Ne.call(a),a.search=Re.call(a),a.searchParams=Pe.call(a),a.hash=Be.call(a))},Ce=Se.prototype,Ae=function(){var e=M(this),t=e.scheme,n=e.username,r=e.password,o=e.host,s=e.port,u=e.path,c=e.query,l=e.fragment,f=t+":";return null!==o?(f+="//",a(e)&&(f+=n+(r?":"+r:"")+"@"),f+=i(o),null!==s&&(f+=":"+s)):"file"==t&&(f+="//"),f+=e.cannotBeABaseURL?u[0]:u.length?"/"+u.join("/"):"",null!==c&&(f+="?"+c),null!==l&&(f+="#"+l),f},Oe=function(){var e=M(this),t=e.scheme,n=e.port;if("blob"==t)try{return new URL(t.path[0]).origin}catch(e){return"null"}return"file"!=t&&re(e)?t+"://"+i(e.host)+(null!==n?":"+n:""):"null"},De=function(){return M(this).scheme+":"},Te=function(){return M(this).username},je=function(){return M(this).password},Me=function(){var e=M(this),t=e.host,n=e.port;return null===t?"":null===n?i(t):i(t)+":"+n},Fe=function(){var e=M(this).host;return null===e?"":i(e)},Ie=function(){var e=M(this).port;return null===e?"":String(e)},Ne=function(){var e=M(this),t=e.path;return e.cannotBeABaseURL?t[0]:t.length?"/"+t.join("/"):""},Re=function(){var e=M(this).query;return e?"?"+e:""},Pe=function(){return M(this).searchParams},Be=function(){var e=M(this).fragment;return e?"#"+e:""};if(p&&g(Ce,{href:f(Ae,(function(e){var t=M(this),n=l(t,String(e));if(n)throw TypeError(n);T(t.searchParams).updateSearchParams(t.query)})),origin:f(Oe),protocol:f(De,(function(e){l(M(this),String(e)+":",ie)})),username:f(Te,(function(e){var t=M(this),n=_(String(e));if(!o(t)){t.username="";for(var r=0;r<n.length;r++)t.username+=te(n[r],ee)}})),password:f(je,(function(e){var t=M(this),n=_(String(e));if(!o(t)){t.password="";for(var r=0;r<n.length;r++)t.password+=te(n[r],ee)}})),host:f(Me,(function(e){var t=M(this);t.cannotBeABaseURL||l(t,String(e),pe)})),hostname:f(Fe,(function(e){var t=M(this);t.cannotBeABaseURL||l(t,String(e),me)})),port:f(Ie,(function(e){var t=M(this);o(t)||(""==(e=String(e))?t.port=null:l(t,e,ve))})),pathname:f(Ne,(function(e){var t=M(this);t.cannotBeABaseURL||(t.path=[],l(t,e+"",xe))})),search:f(Re,(function(e){var t=M(this);""==(e=String(e))?t.query=null:("?"==e.charAt(0)&&(e=e.slice(1)),t.query="",l(t,e,ke)),T(t.searchParams).updateSearchParams(t.query)})),searchParams:f(Pe),hash:f(Be,(function(e){var t=M(this);""!=(e=String(e))?("#"==e.charAt(0)&&(e=e.slice(1)),t.fragment="",l(t,e,Ee)):t.fragment=null}))}),y(Ce,"toJSON",(function(){return Ae.call(this)}),{enumerable:!0}),y(Ce,"toString",(function(){return Ae.call(this)}),{enumerable:!0}),O){var Le=O.createObjectURL,ze=O.revokeObjectURL;Le&&y(Se,"createObjectURL",(function(e){return Le.apply(O,arguments)})),ze&&y(Se,"revokeObjectURL",(function(e){return ze.apply(O,arguments)}))}S(Se,"URL"),h({global:!0,forced:!m,sham:!p},{URL:Se})},{"../internals/an-instance":9,"../internals/array-from":17,"../internals/descriptors":42,"../internals/export":49,"../internals/global":58,"../internals/has":59,"../internals/internal-state":69,"../internals/native-url":83,"../internals/object-assign":88,"../internals/object-define-properties":90,"../internals/redefine":107,"../internals/set-to-string-tag":116,"../internals/string-multibyte":122,"../internals/string-punycode-to-ascii":123,"../modules/es.string.iterator":183,"../modules/web.url-search-params":227}],229:[function(e,t,n){"use strict";t.exports=e("./").polyfill()},{"./":230}],230:[function(e,n,r){(function(t,i){var a;a=function(){"use strict";function n(e){return"function"==typeof e}var r=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},a=0,o=void 0,s=void 0,u=function(e,t){m[a]=e,m[a+1]=t,2===(a+=2)&&(s?s(v):w())},c="undefined"!=typeof window?window:void 0,l=c||{},f=l.MutationObserver||l.WebKitMutationObserver,d="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),h="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function p(){var e=setTimeout;return function(){return e(v,1)}}var m=new Array(1e3);function v(){for(var e=0;e<a;e+=2)(0,m[e])(m[e+1]),m[e]=void 0,m[e+1]=void 0;a=0}var g,y,b,x,w=void 0;function _(e,t){var n=this,r=new this.constructor(S);void 0===r[E]&&R(r);var i=n._state;if(i){var a=arguments[i-1];u((function(){return I(i,r,a,n._result)}))}else M(n,r,e,t);return r}function k(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(S);return O(t,e),t}w=d?function(){return t.nextTick(v)}:f?(y=0,b=new f(v),x=document.createTextNode(""),b.observe(x,{characterData:!0}),function(){x.data=y=++y%2}):h?((g=new MessageChannel).port1.onmessage=v,function(){return g.port2.postMessage(0)}):void 0===c&&"function"==typeof e?function(){try{var e=Function("return this")().require("vertx");return void 0!==(o=e.runOnLoop||e.runOnContext)?function(){o(v)}:p()}catch(e){return p()}}():p();var E=Math.random().toString(36).substring(2);function S(){}var C=void 0;function A(e,t,r){var i,a;t.constructor===e.constructor&&r===_&&t.constructor.resolve===k?(i=e,1===(a=t)._state?T(i,a._result):2===a._state?j(i,a._result):M(a,void 0,(function(e){return O(i,e)}),(function(e){return j(i,e)}))):void 0===r?T(e,t):n(r)?function(e,t,n){u((function(e){var r=!1,i=function(e,t,n,r){try{e.call(t,n,r)}catch(e){return e}}(n,t,(function(n){r||(r=!0,t!==n?O(e,n):T(e,n))}),(function(t){r||(r=!0,j(e,t))}),e._label);!r&&i&&(r=!0,j(e,i))}),e)}(e,t,r):T(e,t)}function O(e,t){if(e===t)j(e,new TypeError("You cannot resolve a promise with itself"));else if(i=typeof(r=t),null===r||"object"!=i&&"function"!=i)T(e,t);else{var n=void 0;try{n=t.then}catch(t){return void j(e,t)}A(e,t,n)}var r,i}function D(e){e._onerror&&e._onerror(e._result),F(e)}function T(e,t){e._state===C&&(e._result=t,e._state=1,0!==e._subscribers.length&&u(F,e))}function j(e,t){e._state===C&&(e._state=2,e._result=t,u(D,e))}function M(e,t,n,r){var i=e._subscribers,a=i.length;e._onerror=null,i[a]=t,i[a+1]=n,i[a+2]=r,0===a&&e._state&&u(F,e)}function F(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r=void 0,i=void 0,a=e._result,o=0;o<t.length;o+=3)r=t[o],i=t[o+n],r?I(n,r,i,a):i(a);e._subscribers.length=0}}function I(e,t,r,i){var a=n(r),o=void 0,s=void 0,u=!0;if(a){try{o=r(i)}catch(e){u=!1,s=e}if(t===o)return void j(t,new TypeError("A promises callback cannot return that same promise."))}else o=i;t._state!==C||(a&&u?O(t,o):!1===u?j(t,s):1===e?T(t,o):2===e&&j(t,o))}var N=0;function R(e){e[E]=N++,e._state=void 0,e._result=void 0,e._subscribers=[]}var P=(B.prototype._enumerate=function(e){for(var t=0;this._state===C&&t<e.length;t++)this._eachEntry(e[t],t)},B.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,r=n.resolve;if(r===k){var i=void 0,a=void 0,o=!1;try{i=e.then}catch(t){o=!0,a=t}if(i===_&&e._state!==C)this._settledAt(e._state,t,e._result);else if("function"!=typeof i)this._remaining--,this._result[t]=e;else if(n===L){var s=new n(S);o?j(s,a):A(s,e,i),this._willSettleAt(s,t)}else this._willSettleAt(new n((function(t){return t(e)})),t)}else this._willSettleAt(r(e),t)},B.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===C&&(this._remaining--,2===e?j(r,n):this._result[t]=n),0===this._remaining&&T(r,this._result)},B.prototype._willSettleAt=function(e,t){var n=this;M(e,void 0,(function(e){return n._settledAt(1,t,e)}),(function(e){return n._settledAt(2,t,e)}))},B);function B(e,t){this._instanceConstructor=e,this.promise=new e(S),this.promise[E]||R(this.promise),r(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?T(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&T(this.promise,this._result))):j(this.promise,new Error("Array Methods must be provided an Array"))}var L=(z.prototype.catch=function(e){return this.then(null,e)},z.prototype.finally=function(e){var t=this.constructor;return n(e)?this.then((function(n){return t.resolve(e()).then((function(){return n}))}),(function(n){return t.resolve(e()).then((function(){throw n}))})):this.then(e,e)},z);function z(e){this[E]=N++,this._result=this._state=void 0,this._subscribers=[],S!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof z?function(e,t){try{t((function(t){O(e,t)}),(function(t){j(e,t)}))}catch(t){j(e,t)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return L.prototype.then=_,L.all=function(e){return new P(this,e).promise},L.race=function(e){var t=this;return r(e)?new t((function(n,r){for(var i=e.length,a=0;a<i;a++)t.resolve(e[a]).then(n,r)})):new t((function(e,t){return t(new TypeError("You must pass an array to race."))}))},L.resolve=k,L.reject=function(e){var t=new this(S);return j(t,e),t},L._setScheduler=function(e){s=e},L._setAsap=function(e){u=e},L._asap=u,L.polyfill=function(){var e=void 0;if(void 0!==i)e=i;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=L},L.Promise=L},"object"==typeof r&&void 0!==n?n.exports=a():this.ES6Promise=a()}).call(this,e("_process"),void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:238}],231:[function(e,t,n){!function(e,r){if(void 0!==n&&void 0!==t)r(0,t);else{var i={exports:{}};r(0,i),e.fetchJsonp=i.exports}}(this,(function(e,t){"use strict";var n="callback";function r(e){try{delete window[e]}catch(t){window[e]=void 0}}function i(e){var t=document.getElementById(e);t&&document.getElementsByTagName("head")[0].removeChild(t)}t.exports=function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],a=e,o=t.timeout||5e3,s=t.jsonpCallback||n,u=void 0;return new Promise((function(n,c){var l=t.jsonpCallbackFunction||"jsonp_"+Date.now()+"_"+Math.ceil(1e5*Math.random()),f=s+"_"+l;window[l]=function(e){n({ok:!0,json:function(){return Promise.resolve(e)}}),u&&clearTimeout(u),i(f),r(l)},a+=-1===a.indexOf("?")?"?":"&";var d=document.createElement("script");d.setAttribute("src",""+a+s+"="+l),t.charset&&d.setAttribute("charset",t.charset),d.id=f,document.getElementsByTagName("head")[0].appendChild(d),u=setTimeout((function(){c(new Error("JSONP request to "+e+" timed out")),r(l),i(f),window[l]=function(){r(l)}}),o),d.onerror=function(){c(new Error("JSONP request to "+e+" failed")),r(l),i(f),u&&clearTimeout(u)}}))}}))},{}],232:[function(e,t,n){var r=r||function(e){"use strict";if(!(void 0===e||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var t=e.document,n=function(){return e.URL||e.webkitURL||e},r=t.createElementNS("http://www.w3.org/1999/xhtml","a"),i="download"in r,a=/constructor/i.test(e.HTMLElement)||e.safari,o=/CriOS\/[\d]+/.test(navigator.userAgent),s=function(t){(e.setImmediate||e.setTimeout)((function(){throw t}),0)},u=function(e){setTimeout((function(){"string"==typeof e?n().revokeObjectURL(e):e.remove()}),4e4)},c=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e},l=function(t,l,f){function d(){!function(e,t,n){for(var r=(t=[].concat(t)).length;r--;){var i=e["on"+t[r]];if("function"==typeof i)try{i.call(e,e)}catch(e){s(e)}}}(p,"writestart progress write writeend".split(" "))}f||(t=c(t));var h,p=this,m="application/octet-stream"===t.type;if(p.readyState=p.INIT,i)return h=n().createObjectURL(t),void setTimeout((function(){var e,t;r.href=h,r.download=l,e=r,t=new MouseEvent("click"),e.dispatchEvent(t),d(),u(h),p.readyState=p.DONE}));!function(){if((o||m&&a)&&e.FileReader){var r=new FileReader;return r.onloadend=function(){var t=o?r.result:r.result.replace(/^data:[^;]*;/,"data:attachment/file;");e.open(t,"_blank")||(e.location.href=t),t=void 0,p.readyState=p.DONE,d()},r.readAsDataURL(t),p.readyState=p.INIT}h=h||n().createObjectURL(t),m?e.location.href=h:e.open(h,"_blank")||(e.location.href=h),p.readyState=p.DONE,d(),u(h)}()},f=l.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,n){return t=t||e.name||"download",n||(e=c(e)),navigator.msSaveOrOpenBlob(e,t)}:(f.abort=function(){},f.readyState=f.INIT=0,f.WRITING=1,f.DONE=2,f.error=f.onwritestart=f.onprogress=f.onwrite=f.onabort=f.onerror=f.onwriteend=null,function(e,t,n){return new l(e,t||e.name||"download",n)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);void 0!==t&&t.exports&&(t.exports.saveAs=r)},{}],233:[function(e,t,n){n.read=function(e,t,n,r,i){var a,o,s=8*i-r-1,u=(1<<s)-1,c=u>>1,l=-7,f=n?i-1:0,d=n?-1:1,h=e[t+f];for(f+=d,a=h&(1<<-l)-1,h>>=-l,l+=s;0<l;a=256*a+e[t+f],f+=d,l-=8);for(o=a&(1<<-l)-1,a>>=-l,l+=r;0<l;o=256*o+e[t+f],f+=d,l-=8);if(0===a)a=1-c;else{if(a===u)return o?NaN:1/0*(h?-1:1);o+=Math.pow(2,r),a-=c}return(h?-1:1)*o*Math.pow(2,a-r)},n.write=function(e,t,n,r,i,a){var o,s,u,c=8*a-i-1,l=(1<<c)-1,f=l>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:a-1,p=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-o))<1&&(o--,u*=2),2<=(t+=1<=o+f?d/u:d*Math.pow(2,1-f))*u&&(o++,u/=2),l<=o+f?(s=0,o=l):1<=o+f?(s=(t*u-1)*Math.pow(2,i),o+=f):(s=t*Math.pow(2,f-1)*Math.pow(2,i),o=0));8<=i;e[n+h]=255&s,h+=p,s/=256,i-=8);for(o=o<<i|s,c+=i;0<c;e[n+h]=255&o,h+=p,o/=256,c-=8);e[n+h-p]|=128*m}},{}],234:[function(e,t,n){"use strict";var r;function i(e,t){return e.b===t.b&&e.a===t.a}function a(e,t){return e.b<t.b||e.b===t.b&&e.a<=t.a}function o(e,t,n){var r=t.b-e.b,i=n.b-t.b;return 0<r+i?r<i?t.a-e.a+r/(r+i)*(e.a-n.a):t.a-n.a+i/(r+i)*(n.a-e.a):0}function s(e,t,n){var r=t.b-e.b,i=n.b-t.b;return 0<r+i?(t.a-n.a)*r+(t.a-e.a)*i:0}function u(e,t){return e.a<t.a||e.a===t.a&&e.b<=t.b}function c(e,t,n){var r=t.a-e.a,i=n.a-t.a;return 0<r+i?r<i?t.b-e.b+r/(r+i)*(e.b-n.b):t.b-n.b+i/(r+i)*(n.b-e.b):0}function l(e,t,n){var r=t.a-e.a,i=n.a-t.a;return 0<r+i?(t.b-n.b)*r+(t.b-e.b)*i:0}function f(e,t,n,r){return(e=e<0?0:e)<=(n=n<0?0:n)?0===n?(t+r)/2:t+e/(e+n)*(r-t):r+n/(e+n)*(t-r)}function d(e){var t=g(e.b);return b(t,e.c),b(t.b,e.c),x(t,e.a),t}function h(e,t){var n=!1,r=!1;e!==t&&(t.a!==e.a&&(r=!0,_(t.a,e.a)),t.d!==e.d&&(n=!0,k(t.d,e.d)),y(t,e),r||(b(t,e.a),e.a.c=e),n||(x(t,e.d),e.d.a=e))}function p(e){var t=e.b,n=!1;e.d!==e.b.d&&(n=!0,k(e.d,e.b.d)),e.c===e?_(e.a,null):(e.b.d.a=J(e),e.a.c=e.c,y(e,J(e)),n||x(e,e.d)),t.c===t?(_(t.a,null),k(t.d,null)):(e.d.a=J(t),t.a.c=t.c,y(t,J(t))),w(e)}function m(e){var t=g(e),n=t.b;return y(t,e.e),t.a=e.b.a,b(n,t.a),t.d=n.d=e.d,t=t.b,y(e.b,J(e.b)),y(e.b,t),e.b.a=t.a,t.b.a.c=t.b,t.b.d=e.b.d,t.f=e.f,t.b.f=e.b.f,t}function v(e,t){var n=!1,r=g(e),i=r.b;return t.d!==e.d&&(n=!0,k(t.d,e.d)),y(r,e.e),y(i,t),r.a=e.b.a,i.a=t.a,r.d=i.d=e.d,e.d.a=i,n||x(r,e.d),r}function g(e){var t=new $,n=new $,r=e.b.h;return(((n.h=r).b.h=t).h=e).b.h=n,t.b=n,((t.c=t).e=n).b=t,(n.c=n).e=t}function y(e,t){var n=e.c,r=t.c;n.b.e=t,(r.b.e=e).c=r,t.c=n}function b(e,t){var n=t.f,r=new Q(t,n);for(n.e=r,n=(t.f=r).c=e;n.a=r,(n=n.c)!==e;);}function x(e,t){var n=t.d,r=new Y(t,n);for(n.b=r,(t.d=r).a=e,r.c=t.c,n=e;n.d=r,(n=n.e)!==e;);}function w(e){var t=e.h;e=e.b.h,(t.b.h=e).b.h=t}function _(e,t){for(var n=e.c,r=n;r.a=t,(r=r.c)!==n;);n=e.f,((r=e.e).f=n).e=r}function k(e,t){for(var n=e.a,r=n;r.d=t,(r=r.e)!==n;);n=e.d,((r=e.b).d=n).b=r}function E(e){var t=0;return Math.abs(e[1])>Math.abs(e[0])&&(t=1),Math.abs(e[2])>Math.abs(e[t])&&(t=2),t}function S(e,t){e.f+=t.f,e.b.f+=t.b.f}function C(e,t,n){return e=e.a,t=t.a,n=n.a,t.b.a===e?n.b.a===e?a(t.a,n.a)?s(n.b.a,t.a,n.a)<=0:0<=s(t.b.a,n.a,t.a):s(n.b.a,e,n.a)<=0:n.b.a===e?0<=s(t.b.a,e,t.a):(t=o(t.b.a,e,t.a),(e=o(n.b.a,e,n.a))<=t)}function A(e){e.a.i=null;var t=e.e;t.a.c=t.c,t.c.a=t.a,e.e=null}function O(e,t){p(e.a),e.c=!1,(e.a=t).i=e}function D(e){for(var t=e.a.a;(e=fe(e)).a.a===t;);return e.c&&(O(e,t=v(le(e).a.b,e.a.e)),e=fe(e)),e}function T(e,t,n){var r=new ce;return r.a=n,r.e=G(e.f,t.e,r),n.i=r}function j(e,t){switch(e.s){case 100130:return 0!=(1&t);case 100131:return 0!==t;case 100132:return 0<t;case 100133:return t<0;case 100134:return 2<=t||t<=-2}return!1}function M(e){var t=e.a,n=t.d;n.c=e.d,n.a=t,A(e)}function F(e,t,n){for(t=(e=t).a;e!==n;){e.c=!1;var r=le(e),i=r.a;if(i.a!==t.a){if(!r.c){M(e);break}O(r,i=v(t.c.b,i.b))}t.c!==i&&(h(J(i),i),h(t,i)),M(e),t=r.a,e=r}return t}function I(e,t,n,r,i,a){for(var o=!0;T(e,t,n.b),(n=n.c)!==r;);for(null===i&&(i=le(t).a.b.c);(n=(r=le(t)).a.b).a===i.a;)n.c!==i&&(h(J(n),n),h(J(i),n)),r.f=t.f-n.f,r.d=j(e,r.f),t.b=!0,!o&&B(e,t)&&(S(n,i),A(t),p(i)),o=!1,t=r,i=n;t.b=!0,a&&z(e,t)}function N(e,t,n,r,i){var a=[t.g[0],t.g[1],t.g[2]];t.d=null,t.d=e.o&&e.o(a,n,r,e.c)||null,null===t.d&&(i?e.n||(K(e,100156),e.n=!0):t.d=n[0])}function R(e,t,n){var r=[null,null,null,null];r[0]=t.a.d,r[1]=n.a.d,N(e,t.a,r,[.5,.5,0,0],!1),h(t,n)}function P(e,t,n,r,i){var a=Math.abs(t.b-e.b)+Math.abs(t.a-e.a),o=Math.abs(n.b-e.b)+Math.abs(n.a-e.a),s=i+1;r[i]=.5*o/(a+o),r[s]=.5*a/(a+o),e.g[0]+=r[i]*t.g[0]+r[s]*n.g[0],e.g[1]+=r[i]*t.g[1]+r[s]*n.g[1],e.g[2]+=r[i]*t.g[2]+r[s]*n.g[2]}function B(e,t){var n=le(t),r=t.a,o=n.a;if(a(r.a,o.a)){if(0<s(o.b.a,r.a,o.a))return!1;if(i(r.a,o.a)){if(r.a!==o.a){n=e.e;var u=r.a.h;if(0<=u){var c=(n=n.b).d,l=n.e,f=n.c,d=f[u];c[d]=c[n.a],(f[c[d]]=d)<=--n.a&&(d<=1||a(l[c[d>>1]],l[c[d]])?se(n,d):ue(n,d)),l[u]=null,f[u]=n.b,n.b=u}else for(n.c[-(u+1)]=null;0<n.a&&null===n.c[n.d[n.a-1]];)--n.a;R(e,J(o),r)}}else m(o.b),h(r,J(o)),t.b=n.b=!0}else{if(s(r.b.a,o.a,r.a)<0)return!1;fe(t).b=t.b=!0,m(r.b),h(J(o),r)}return!0}function L(e,t){var n=le(t),r=t.a,d=n.a,p=r.a,v=d.a,g=r.b.a,y=d.b.a,b=new Q;if(s(g,e.a,p),s(y,e.a,v),p===v||Math.min(p.a,g.a)>Math.max(v.a,y.a))return!1;if(a(p,v)){if(0<s(y,p,v))return!1}else if(s(g,v,p)<0)return!1;var x,w,_=g,k=p,E=y,S=v;if(a(_,k)||(x=_,_=k,k=x),a(E,S)||(x=E,E=S,S=x),a(_,E)||(x=_,_=E,E=x,x=k,k=S,S=x),a(E,k)?a(k,S)?((x=o(_,E,k))+(w=o(E,k,S))<0&&(x=-x,w=-w),b.b=f(x,E.b,w,k.b)):((x=s(_,E,k))+(w=-s(_,S,k))<0&&(x=-x,w=-w),b.b=f(x,E.b,w,S.b)):b.b=(E.b+k.b)/2,u(_,k)||(x=_,_=k,k=x),u(E,S)||(x=E,E=S,S=x),u(_,E)||(x=_,_=E,E=x,x=k,k=S,S=x),u(E,k)?u(k,S)?((x=c(_,E,k))+(w=c(E,k,S))<0&&(x=-x,w=-w),b.a=f(x,E.a,w,k.a)):((x=l(_,E,k))+(w=-l(_,S,k))<0&&(x=-x,w=-w),b.a=f(x,E.a,w,S.a)):b.a=(E.a+k.a)/2,a(b,e.a)&&(b.b=e.a.b,b.a=e.a.a),_=a(p,v)?p:v,a(_,b)&&(b.b=_.b,b.a=_.a),i(b,p)||i(b,v))return B(e,t),!1;if(!i(g,e.a)&&0<=s(g,e.a,b)||!i(y,e.a)&&s(y,e.a,b)<=0){if(y===e.a)return m(r.b),h(d.b,r),r=le(t=D(t)).a,F(e,le(t),n),I(e,t,J(r),r,r,!0),!0;if(g!==e.a)return 0<=s(g,e.a,b)&&(fe(t).b=t.b=!0,m(r.b),r.a.b=e.a.b,r.a.a=e.a.a),s(y,e.a,b)<=0&&(t.b=n.b=!0,m(d.b),d.a.b=e.a.b,d.a.a=e.a.a),!1;for(m(d.b),h(r.e,J(d)),v=(p=n=t).a.b.a;(p=fe(p)).a.b.a===v;);return p=le(t=p).a.b.c,n.a=J(d),I(e,t,(d=F(e,n,null)).c,r.b.c,p,!0),!0}return m(r.b),m(d.b),h(J(d),r),r.a.b=b.b,r.a.a=b.a,r.a.h=te(e.e,r.a),r=r.a,d=[0,0,0,0],b=[p.d,g.d,v.d,y.d],r.g[0]=r.g[1]=r.g[2]=0,P(r,p,g,d,0),P(r,v,y,d,2),N(e,r,b,d,!0),fe(t).b=t.b=n.b=!0,!1}function z(e,t){for(var n=le(t);;){for(;n.b;)n=le(t=n);if(!(t.b||null!==(t=fe(n=t))&&t.b))break;t.b=!1;var r,i=t.a,o=n.a;if(r=i.b.a!==o.b.a)e:{var u=le(r=t),c=r.a,l=u.a,f=void 0;if(a(c.b.a,l.b.a)){if(s(c.b.a,l.b.a,c.a)<0){r=!1;break e}fe(r).b=r.b=!0,f=m(c),h(l.b,f),f.d.c=r.d}else{if(0<s(l.b.a,c.b.a,l.a)){r=!1;break e}r.b=u.b=!0,f=m(l),h(c.e,l.b),f.b.d.c=r.d}r=!0}if(r&&(n.c?(A(n),p(o),o=(n=le(t)).a):t.c&&(A(t),p(i),i=(t=fe(n)).a)),i.a!==o.a)if(i.b.a===o.b.a||t.c||n.c||i.b.a!==e.a&&o.b.a!==e.a)B(e,t);else if(L(e,t))break;i.a===o.a&&i.b.a===o.b.a&&(S(o,i),A(t),p(i),t=fe(n))}}function U(e,t){for(var n=(e.a=t).c;null===n.i;)if((n=n.c)===t.c){n=e;var r=t;(c=new ce).a=r.c.b;for(var o=(f=n.f).a;null!==(o=o.a).b&&!f.c(f.b,c,o.b););var u=le(f=o.b),c=f.a;if(o=u.a,0===s(c.b.a,r,c.a))i((c=f.a).a,r)||i(c.b.a,r)||(m(c.b),f.c&&(p(c.c),f.c=!1),h(r.c,c),U(n,r));else{var l=a(o.b.a,c.b.a)?f:u;u=void 0,f.d||l.c?(u=l===f?v(r.c.b,c.e):v(o.b.c.b,r.c).b,l.c?O(l,u):((f=T(c=n,f,u)).f=fe(f).f+f.a.f,f.d=j(c,f.f)),U(n,r)):I(n,f,r.c,r.c,null,!0)}return}if(f=(c=le(n=D(n.i))).a,(c=F(e,c,null)).c===f){c=(f=c).c,o=le(n),u=n.a,l=o.a;var f,d=!1;u.b.a!==l.b.a&&L(e,n),i(u.a,e.a)&&(h(J(c),u),c=le(n=D(n)).a,F(e,le(n),o),d=!0),i(l.a,e.a)&&(h(f,J(l)),f=F(e,o,null),d=!0),d?I(e,n,f.c,c,c,!0):(r=a(l.a,u.a)?J(l):u,I(e,n,r=v(f.c.b,r),r.c,r.c,!1),r.b.i.c=!0,z(e,n))}else I(e,n,c.c,f,f,!0)}function W(e,t){var n=new ce,r=d(e.b);r.a.b=4e150,r.a.a=t,r.b.a.b=-4e150,r.b.a.a=t,e.a=r.b.a,n.a=r,n.f=0,n.d=!1,n.c=!1,n.h=!0,n.b=!1,r=G(r=e.f,r.a,n),n.e=r}function V(e){this.a=new q,this.b=e,this.c=C}function G(e,t,n){for(;null!==(t=t.c).b&&!e.c(e.b,t.b,n););return e=new q(n,t.a,t),t.a.c=e,t.a=e}function q(e,t,n){this.b=e||null,this.a=t||this,this.c=n||this}function H(){this.d=0,this.p=this.b=this.q=null,this.j=[0,0,0],this.s=100130,this.n=!1,this.o=this.a=this.e=this.f=null,this.m=!1,this.c=this.r=this.i=this.k=this.l=this.h=null}function X(e,t){if(e.d!==t)for(;e.d!==t;)if(e.d<t)switch(e.d){case 0:K(e,100151),e.u(null);break;case 1:K(e,100152),e.t()}else switch(e.d){case 2:K(e,100154),e.v();break;case 1:K(e,100153),e.w()}}function K(e,t){e.p&&e.p(t,e.c)}function Y(e,t){this.b=e||this,this.d=t||this,this.a=null,this.c=!1}function $(){(this.h=this).i=this.d=this.a=this.e=this.c=this.b=null,this.f=0}function J(e){return e.b.e}function Z(){this.c=new Q,this.a=new Y,this.b=new $,this.d=new $,this.b.b=this.d,this.d.b=this.b}function Q(e,t){this.e=e||this,this.f=t||this,this.d=this.c=null,this.g=[0,0,0],this.h=this.a=this.b=0}function ee(){this.c=[],this.d=null,this.a=0,this.e=!1,this.b=new re}function te(e,t){if(e.e){var n,r=e.b,i=++r.a;return 2*i>r.f&&(r.f*=2,r.c=ie(r.c,r.f+1)),0===r.b?n=i:(n=r.b,r.b=r.c[r.b]),r.e[n]=t,r.c[n]=i,r.d[i]=n,r.h&&ue(r,i),n}return r=e.a++,e.c[r]=t,-(r+1)}function ne(e){if(0===e.a)return oe(e.b);var t=e.c[e.d[e.a-1]];if(0!==e.b.a&&a(ae(e.b),t))return oe(e.b);for(;--e.a,0<e.a&&null===e.c[e.d[e.a-1]];);return t}function re(){this.d=ie([0],33),this.e=[null,null],this.c=[0,0],this.a=0,this.f=32,this.b=0,this.h=!1,this.d[1]=1}function ie(e,t){for(var n=Array(t),r=0;r<e.length;r++)n[r]=e[r];for(;r<t;r++)n[r]=0;return n}function ae(e){return e.e[e.d[1]]}function oe(e){var t=e.d,n=e.e,r=e.c,i=t[1],a=n[i];return 0<e.a&&(t[1]=t[e.a],r[t[1]]=1,n[i]=null,r[i]=e.b,e.b=i,0<--e.a&&se(e,1)),a}function se(e,t){for(var n=e.d,r=e.e,i=e.c,o=t,s=n[o];;){var u=o<<1;u<e.a&&a(r[n[u+1]],r[n[u]])&&(u+=1);var c=n[u];if(u>e.a||a(r[s],r[c])){i[n[o]=s]=o;break}i[n[o]=c]=o,o=u}}function ue(e,t){for(var n=e.d,r=e.e,i=e.c,o=t,s=n[o];;){var u=o>>1,c=n[u];if(0==u||a(r[c],r[s])){i[n[o]=s]=o;break}i[n[o]=c]=o,o=u}}function ce(){this.e=this.a=null,this.f=0,this.c=this.b=this.h=this.d=!1}function le(e){return e.e.c.b}function fe(e){return e.e.a.b}(r=H.prototype).x=function(){X(this,0)},r.B=function(e,t){switch(e){case 100142:return;case 100140:switch(t){case 100130:case 100131:case 100132:case 100133:case 100134:return void(this.s=t)}break;case 100141:return void(this.m=!!t);default:return void K(this,100900)}K(this,100901)},r.y=function(e){switch(e){case 100142:return 0;case 100140:return this.s;case 100141:return this.m;default:K(this,100900)}return!1},r.A=function(e,t,n){this.j[0]=e,this.j[1]=t,this.j[2]=n},r.z=function(e,t){var n=t||null;switch(e){case 100100:case 100106:this.h=n;break;case 100104:case 100110:this.l=n;break;case 100101:case 100107:this.k=n;break;case 100102:case 100108:this.i=n;break;case 100103:case 100109:this.p=n;break;case 100105:case 100111:this.o=n;break;case 100112:this.r=n;break;default:K(this,100900)}},r.C=function(e,t){var n=!1,r=[0,0,0];X(this,2);for(var i=0;i<3;++i){var a=e[i];a<-1e150&&(a=-1e150,n=!0),1e150<a&&(a=1e150,n=!0),r[i]=a}n&&K(this,100155),null===(n=this.q)?h(n=d(this.b),n.b):(m(n),n=n.e),n.a.d=t,n.a.g[0]=r[0],n.a.g[1]=r[1],n.a.g[2]=r[2],n.f=1,n.b.f=-1,this.q=n},r.u=function(e){X(this,0),this.d=1,this.b=new Z,this.c=e},r.t=function(){X(this,1),this.d=2,this.q=null},r.v=function(){X(this,2),this.d=1},r.w=function(){X(this,1),this.d=0;var e,t,n=!1,r=[f=this.j[0],o=this.j[1],c=this.j[2]];if(0===f&&0===o&&0===c){for(var o=[-2e150,-2e150,-2e150],u=[2e150,2e150,2e150],c=[],l=[],f=(n=this.b.c).e;f!==n;f=f.e)for(var d=0;d<3;++d){var h=f.g[d];h<u[d]&&(u[d]=h,l[d]=f),h>o[d]&&(o[d]=h,c[d]=f)}if(f=0,o[1]-u[1]>o[0]-u[0]&&(f=1),o[2]-u[2]>o[f]-u[f]&&(f=2),u[f]>=o[f])r[0]=0,r[1]=0,r[2]=1;else{for(o=0,u=l[f],c=c[f],l=[0,0,0],u=[u.g[0]-c.g[0],u.g[1]-c.g[1],u.g[2]-c.g[2]],d=[0,0,0],f=n.e;f!==n;f=f.e)d[0]=f.g[0]-c.g[0],d[1]=f.g[1]-c.g[1],d[2]=f.g[2]-c.g[2],l[0]=u[1]*d[2]-u[2]*d[1],l[1]=u[2]*d[0]-u[0]*d[2],l[2]=u[0]*d[1]-u[1]*d[0],o<(h=l[0]*l[0]+l[1]*l[1]+l[2]*l[2])&&(o=h,r[0]=l[0],r[1]=l[1],r[2]=l[2]);o<=0&&(r[0]=r[1]=r[2]=0,r[E(u)]=1)}n=!0}for(l=E(r),f=this.b.c,o=(l+1)%3,c=(l+2)%3,l=0<r[l]?1:-1,r=f.e;r!==f;r=r.e)r.b=r.g[o],r.a=l*r.g[c];if(n){for(r=0,f=(n=this.b.a).b;f!==n;f=f.b)if(!((o=f.a).f<=0))for(;r+=(o.a.b-o.b.a.b)*(o.a.a+o.b.a.a),(o=o.e)!==f.a;);if(r<0)for(n=(r=this.b.c).e;n!==r;n=n.e)n.a=-n.a}for(this.n=!1,f=(r=this.b.b).h;f!==r;f=n)n=f.h,o=f.e,i(f.a,f.b.a)&&f.e.e!==f&&(R(this,o,f),p(f),o=(f=o).e),o.e===f&&(o!==f&&(o!==n&&o!==n.b||(n=n.h),p(o)),f!==n&&f!==n.b||(n=n.h),p(f));for(this.e=r=new ee,f=(n=this.b.c).e;f!==n;f=f.e)f.h=te(r,f);for(function(e){e.d=[];for(var t=0;t<e.a;t++)e.d[t]=t;e.d.sort(function(e){return function(t,n){return a(e[t],e[n])?1:-1}}(e.c)),e.e=!0,function(e){for(var t=e.a;1<=t;--t)se(e,t);e.h=!0}(e.b)}(r),this.f=new V(this),W(this,-4e150),W(this,4e150);null!==(r=ne(this.e));){for(;;){e:if(f=this.e,0===f.a)n=ae(f.b);else if(n=f.c[f.d[f.a-1]],0!==f.b.a&&(f=ae(f.b),a(f,n))){n=f;break e}if(null===n||!i(n,r))break;n=ne(this.e),R(this,r.c,n.c)}U(this,r)}for(this.a=this.f.a.a.b.a.a,r=0;null!==(n=this.f.a.a.b);)n.h||++r,A(n);for(this.f=null,(r=this.e).b=null,r.d=null,this.e=r.c=null,f=(r=this.b).a.b;f!==r.a;f=n)n=f.b,(f=f.a).e.e===f&&(S(f.c,f),p(f));if(!this.n){if(r=this.b,this.m)for(f=r.b.h;f!==r.b;f=n)n=f.h,f.b.d.c!==f.d.c?f.f=f.d.c?1:-1:p(f);else for(f=r.a.b;f!==r.a;f=n)if(n=f.b,f.c){for(f=f.a;a(f.b.a,f.a);f=f.c.b);for(;a(f.a,f.b.a);f=f.e);for(o=f.c.b,c=void 0;f.e!==o;)if(a(f.b.a,o.a)){for(;o.e!==f&&(a((t=o.e).b.a,t.a)||s(o.a,o.b.a,o.e.b.a)<=0);)o=(c=v(o.e,o)).b;o=o.c.b}else{for(;o.e!==f&&(a((e=f.c.b).a,e.b.a)||0<=s(f.b.a,f.a,f.c.b.a));)f=(c=v(f,f.c.b)).b;f=f.e}for(;o.e.e!==f;)o=(c=v(o.e,o)).b}if(this.h||this.i||this.k||this.l)if(this.m){for(n=(r=this.b).a.b;n!==r.a;n=n.b)if(n.c){for(this.h&&this.h(2,this.c),f=n.a;this.k&&this.k(f.a.d,this.c),(f=f.e)!==n.a;);this.i&&this.i(this.c)}}else{for(r=this.b,n=!!this.l,f=!1,o=-1,c=r.a.d;c!==r.a;c=c.d)if(c.c)for(f||(this.h&&this.h(4,this.c),f=!0),l=c.a;n&&o!==(u=l.b.d.c?0:1)&&(o=u,this.l&&this.l(!!o,this.c)),this.k&&this.k(l.a.d,this.c),(l=l.e)!==c.a;);f&&this.i&&this.i(this.c)}if(this.r){for(f=(r=this.b).a.b;f!==r.a;f=n)if(n=f.b,!f.c){for(c=(o=f.a).e,l=void 0;c=(l=c).e,(l.d=null)===l.b.d&&(l.c===l?_(l.a,null):(l.a.c=l.c,y(l,J(l))),(u=l.b).c===u?_(u.a,null):(u.a.c=u.c,y(u,J(u))),w(l)),l!==o;);o=f.d,((f=f.b).d=o).b=f}return this.r(this.b),void(this.c=this.b=null)}}this.b=this.c=null},this.libtess={GluTesselator:H,windingRule:{GLU_TESS_WINDING_ODD:100130,GLU_TESS_WINDING_NONZERO:100131,GLU_TESS_WINDING_POSITIVE:100132,GLU_TESS_WINDING_NEGATIVE:100133,GLU_TESS_WINDING_ABS_GEQ_TWO:100134},primitiveType:{GL_LINE_LOOP:2,GL_TRIANGLES:4,GL_TRIANGLE_STRIP:5,GL_TRIANGLE_FAN:6},errorType:{GLU_TESS_MISSING_BEGIN_POLYGON:100151,GLU_TESS_MISSING_END_POLYGON:100153,GLU_TESS_MISSING_BEGIN_CONTOUR:100152,GLU_TESS_MISSING_END_CONTOUR:100154,GLU_TESS_COORD_TOO_LARGE:100155,GLU_TESS_NEED_COMBINE_CALLBACK:100156},gluEnum:{GLU_TESS_MESH:100112,GLU_TESS_TOLERANCE:100142,GLU_TESS_WINDING_RULE:100140,GLU_TESS_BOUNDARY_ONLY:100141,GLU_INVALID_ENUM:100900,GLU_INVALID_VALUE:100901,GLU_TESS_BEGIN:100100,GLU_TESS_VERTEX:100101,GLU_TESS_END:100102,GLU_TESS_ERROR:100103,GLU_TESS_EDGE_FLAG:100104,GLU_TESS_COMBINE:100105,GLU_TESS_BEGIN_DATA:100106,GLU_TESS_VERTEX_DATA:100107,GLU_TESS_END_DATA:100108,GLU_TESS_ERROR_DATA:100109,GLU_TESS_EDGE_FLAG_DATA:100110,GLU_TESS_COMBINE_DATA:100111}},H.prototype.gluDeleteTess=H.prototype.x,H.prototype.gluTessProperty=H.prototype.B,H.prototype.gluGetTessProperty=H.prototype.y,H.prototype.gluTessNormal=H.prototype.A,H.prototype.gluTessCallback=H.prototype.z,H.prototype.gluTessVertex=H.prototype.C,H.prototype.gluTessBeginPolygon=H.prototype.u,H.prototype.gluTessBeginContour=H.prototype.t,H.prototype.gluTessEndContour=H.prototype.v,H.prototype.gluTessEndPolygon=H.prototype.w,void 0!==t&&(t.exports=this.libtess)},{}],235:[function(e,t,n){"use strict";function r(e,t,n,r){for(var i=e[t++],a=1<<i,o=1+a,s=1+o,u=i+1,c=(1<<u)-1,l=0,f=0,d=0,h=e[t++],p=new Int32Array(4096),m=null;;){for(;l<16&&0!==h;)f|=e[t++]<<l,l+=8,1===h?h=e[t++]:--h;if(l<u)break;var v=f&c;if(f>>=u,l-=u,v!=a){if(v==o)break;for(var g=v<s?v:m,y=0,b=g;a<b;)b=p[b]>>8,++y;var x=b;if(r<d+y+(g!==v?1:0))return void console.log("Warning, gif stream longer than expected.");n[d++]=x;var w=d+=y;for(g!==v&&(n[d++]=x),b=g;y--;)b=p[b],n[--w]=255&b,b>>=8;null!==m&&s<4096&&(p[s++]=m<<8|x,c+1<=s&&u<12&&(++u,c=c<<1|1)),m=v}else s=1+o,c=(1<<(u=i+1))-1,m=null}return d!==r&&console.log("Warning, gif stream shorter than expected."),n}try{n.GifWriter=function(e,t,n,r){var i=0,a=void 0===(r=void 0===r?{}:r).loop?null:r.loop,o=void 0===r.palette?null:r.palette;if(t<=0||n<=0||65535<t||65535<n)throw new Error("Width/Height invalid.");function s(e){var t=e.length;if(t<2||256<t||t&t-1)throw new Error("Invalid code/color length, must be power of 2 and 2 .. 256.");return t}e[i++]=71,e[i++]=73,e[i++]=70,e[i++]=56,e[i++]=57,e[i++]=97;var u=0,c=0;if(null!==o){for(var l=s(o);l>>=1;)++u;if(l=1<<u,--u,void 0!==r.background){if(l<=(c=r.background))throw new Error("Background index out of range.");if(0===c)throw new Error("Background index explicitly passed as 0.")}}if(e[i++]=255&t,e[i++]=t>>8&255,e[i++]=255&n,e[i++]=n>>8&255,e[i++]=(null!==o?128:0)|u,e[i++]=c,e[i++]=0,null!==o)for(var f=0,d=o.length;f<d;++f){var h=o[f];e[i++]=h>>16&255,e[i++]=h>>8&255,e[i++]=255&h}if(null!==a){if(a<0||65535<a)throw new Error("Loop count invalid.");e[i++]=33,e[i++]=255,e[i++]=11,e[i++]=78,e[i++]=69,e[i++]=84,e[i++]=83,e[i++]=67,e[i++]=65,e[i++]=80,e[i++]=69,e[i++]=50,e[i++]=46,e[i++]=48,e[i++]=3,e[i++]=1,e[i++]=255&a,e[i++]=a>>8&255,e[i++]=0}var p=!1;this.addFrame=function(t,n,r,a,u,c){if(!0===p&&(--i,p=!1),c=void 0===c?{}:c,t<0||n<0||65535<t||65535<n)throw new Error("x/y invalid.");if(r<=0||a<=0||65535<r||65535<a)throw new Error("Width/Height invalid.");if(u.length<r*a)throw new Error("Not enough pixels for the frame size.");var l=!0,f=c.palette;if(null==f&&(l=!1,f=o),null==f)throw new Error("Must supply either a local or global palette.");for(var d=s(f),h=0;d>>=1;)++h;d=1<<h;var m=void 0===c.delay?0:c.delay,v=void 0===c.disposal?0:c.disposal;if(v<0||3<v)throw new Error("Disposal out of range.");var g=!1,y=0;if(void 0!==c.transparent&&null!==c.transparent&&(g=!0,(y=c.transparent)<0||d<=y))throw new Error("Transparent color index.");if(0===v&&!g&&0===m||(e[i++]=33,e[i++]=249,e[i++]=4,e[i++]=v<<2|(!0===g?1:0),e[i++]=255&m,e[i++]=m>>8&255,e[i++]=y,e[i++]=0),e[i++]=44,e[i++]=255&t,e[i++]=t>>8&255,e[i++]=255&n,e[i++]=n>>8&255,e[i++]=255&r,e[i++]=r>>8&255,e[i++]=255&a,e[i++]=a>>8&255,e[i++]=!0===l?128|h-1:0,!0===l)for(var b=0,x=f.length;b<x;++b){var w=f[b];e[i++]=w>>16&255,e[i++]=w>>8&255,e[i++]=255&w}return i=function(e,t,n,r){e[t++]=n;var i=t++,a=1<<n,o=a-1,s=1+a,u=1+s,c=n+1,l=0,f=0;function d(n){for(;n<=l;)e[t++]=255&f,f>>=8,l-=8,t===i+256&&(e[i]=255,i=t++)}function h(e){f|=e<<l,l+=c,d(8)}var p=r[0]&o,m={};h(a);for(var v=1,g=r.length;v<g;++v){var y=r[v]&o,b=p<<8|y,x=m[b];if(void 0===x){for(f|=p<<l,l+=c;8<=l;)e[t++]=255&f,f>>=8,l-=8,t===i+256&&(e[i]=255,i=t++);4096===u?(h(a),u=1+s,c=n+1,m={}):(1<<c<=u&&++c,m[b]=u++),p=y}else p=x}return h(p),h(s),d(1),i+1===t?e[i]=0:(e[i]=t-i-1,e[t++]=0),t}(e,i,h<2?2:h,u)},this.end=function(){return!1===p&&(e[i++]=59,p=!0),i},this.getOutputBuffer=function(){return e},this.setOutputBuffer=function(t){e=t},this.getOutputBufferPosition=function(){return i},this.setOutputBufferPosition=function(e){i=e}},n.GifReader=function(e){var t=0;if(71!==e[t++]||73!==e[t++]||70!==e[t++]||56!==e[t++]||56!=(e[t++]+1&253)||97!==e[t++])throw new Error("Invalid GIF 87a/89a header.");var n=e[t++]|e[t++]<<8,i=e[t++]|e[t++]<<8,a=e[t++],o=a>>7,s=1<<1+(7&a);e[t++],e[t++];var u=null,c=null;o&&(u=t,t+=3*(c=s));var l=!0,f=[],d=0,h=null,p=0,m=null;for(this.width=n,this.height=i;l&&t<e.length;)switch(e[t++]){case 33:switch(e[t++]){case 255:if(11!==e[t]||78==e[t+1]&&69==e[t+2]&&84==e[t+3]&&83==e[t+4]&&67==e[t+5]&&65==e[t+6]&&80==e[t+7]&&69==e[t+8]&&50==e[t+9]&&46==e[t+10]&&48==e[t+11]&&3==e[t+12]&&1==e[t+13]&&0==e[t+16])t+=14,m=e[t++]|e[t++]<<8,t++;else for(t+=12;;){if(!(0<=(A=e[t++])))throw Error("Invalid block size");if(0===A)break;t+=A}break;case 249:if(4!==e[t++]||0!==e[t+4])throw new Error("Invalid graphics extension block.");var v=e[t++];d=e[t++]|e[t++]<<8,h=e[t++],0==(1&v)&&(h=null),p=v>>2&7,t++;break;case 254:for(;;){if(!(0<=(A=e[t++])))throw Error("Invalid block size");if(0===A)break;t+=A}break;default:throw new Error("Unknown graphic control label: 0x"+e[t-1].toString(16))}break;case 44:var g=e[t++]|e[t++]<<8,y=e[t++]|e[t++]<<8,b=e[t++]|e[t++]<<8,x=e[t++]|e[t++]<<8,w=e[t++],_=w>>6&1,k=u,E=c,S=!1;w>>7&&(S=!0,k=t,t+=3*(E=1<<1+(7&w)));var C=t;for(t++;;){var A;if(!(0<=(A=e[t++])))throw Error("Invalid block size");if(0===A)break;t+=A}f.push({x:g,y:y,width:b,height:x,has_local_palette:S,palette_offset:k,palette_size:E,data_offset:C,data_length:t-C,transparent_index:h,interlaced:!!_,delay:d,disposal:p});break;case 59:l=!1;break;default:throw new Error("Unknown gif block: 0x"+e[t-1].toString(16))}this.numFrames=function(){return f.length},this.loopCount=function(){return m},this.frameInfo=function(e){if(e<0||e>=f.length)throw new Error("Frame index out of range.");return f[e]},this.decodeAndBlitFrameBGRA=function(t,i){var a=this.frameInfo(t),o=a.width*a.height,s=new Uint8Array(o);r(e,a.data_offset,s,o);var u=a.palette_offset,c=a.transparent_index;null===c&&(c=256);var l=a.width,f=n-l,d=l,h=4*(a.y*n+a.x),p=4*((a.y+a.height)*n+a.x),m=h,v=4*f;!0===a.interlaced&&(v+=4*n*7);for(var g=8,y=0,b=s.length;y<b;++y){var x=s[y];if(0===d&&(d=l,p<=(m+=v)&&(v=4*f+4*n*(g-1),m=h+(l+f)*(g<<1),g>>=1)),x===c)m+=4;else{var w=e[u+3*x],_=e[u+3*x+1],k=e[u+3*x+2];i[m++]=k,i[m++]=_,i[m++]=w,i[m++]=255}--d}},this.decodeAndBlitFrameRGBA=function(t,i){var a=this.frameInfo(t),o=a.width*a.height,s=new Uint8Array(o);r(e,a.data_offset,s,o);var u=a.palette_offset,c=a.transparent_index;null===c&&(c=256);var l=a.width,f=n-l,d=l,h=4*(a.y*n+a.x),p=4*((a.y+a.height)*n+a.x),m=h,v=4*f;!0===a.interlaced&&(v+=4*n*7);for(var g=8,y=0,b=s.length;y<b;++y){var x=s[y];if(0===d&&(d=l,p<=(m+=v)&&(v=4*f+4*n*(g-1),m=h+(l+f)*(g<<1),g>>=1)),x===c)m+=4;else{var w=e[u+3*x],_=e[u+3*x+1],k=e[u+3*x+2];i[m++]=w,i[m++]=_,i[m++]=k,i[m++]=255}--d}}}}catch(e){}},{}],236:[function(e,t,n){(function(r){!function(t){"use strict";function n(e){if(null==this)throw TypeError();var t=String(this),n=t.length,r=e?Number(e):0;if(r!=r&&(r=0),!(r<0||n<=r)){var i,a=t.charCodeAt(r);return 55296<=a&&a<=56319&&r+1<n&&56320<=(i=t.charCodeAt(r+1))&&i<=57343?1024*(a-55296)+i-56320+65536:a}}var i;function a(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}function o(e,t){this.source=e,this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=t,this.destLen=0,this.ltree=new a,this.dtree=new a}String.prototype.codePointAt||((i=function(){try{var e={},t=Object.defineProperty,n=t(e,e,e)&&t}catch(e){}return n}())?i(String.prototype,"codePointAt",{value:n,configurable:!0,writable:!0}):String.prototype.codePointAt=n);var s=new a,u=new a,c=new Uint8Array(30),l=new Uint16Array(30),f=new Uint8Array(30),d=new Uint16Array(30),h=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),p=new a,m=new Uint8Array(320);function v(e,t,n,r){var i,a;for(i=0;i<n;++i)e[i]=0;for(i=0;i<30-n;++i)e[i+n]=i/n|0;for(a=r,i=0;i<30;++i)t[i]=a,a+=1<<e[i]}var g=new Uint16Array(16);function y(e,t,n,r){var i,a;for(i=0;i<16;++i)e.table[i]=0;for(i=0;i<r;++i)e.table[t[n+i]]++;for(i=a=e.table[0]=0;i<16;++i)g[i]=a,a+=e.table[i];for(i=0;i<r;++i)t[n+i]&&(e.trans[g[t[n+i]]++]=i)}function b(e){e.bitcount--||(e.tag=e.source[e.sourceIndex++],e.bitcount=7);var t=1&e.tag;return e.tag>>>=1,t}function x(e,t,n){if(!t)return n;for(;e.bitcount<24;)e.tag|=e.source[e.sourceIndex++]<<e.bitcount,e.bitcount+=8;var r=e.tag&65535>>>16-t;return e.tag>>>=t,e.bitcount-=t,r+n}function w(e,t){for(;e.bitcount<24;)e.tag|=e.source[e.sourceIndex++]<<e.bitcount,e.bitcount+=8;for(var n=0,r=0,i=0,a=e.tag;r=2*r+(1&a),a>>>=1,++i,n+=t.table[i],0<=(r-=t.table[i]););return e.tag=a,e.bitcount-=i,t.trans[n+r]}function _(e,t,n){var r,i,a,o,s,u;for(r=x(e,5,257),i=x(e,5,1),a=x(e,4,4),o=0;o<19;++o)m[o]=0;for(o=0;o<a;++o){var c=x(e,3,0);m[h[o]]=c}for(y(p,m,0,19),s=0;s<r+i;){var l=w(e,p);switch(l){case 16:var f=m[s-1];for(u=x(e,2,3);u;--u)m[s++]=f;break;case 17:for(u=x(e,3,3);u;--u)m[s++]=0;break;case 18:for(u=x(e,7,11);u;--u)m[s++]=0;break;default:m[s++]=l}}y(t,m,0,r),y(n,m,r,i)}function k(e,t,n){for(;;){var r,i,a,o,s=w(e,t);if(256===s)return 0;if(s<256)e.dest[e.destLen++]=s;else for(r=x(e,c[s-=257],l[s]),i=w(e,n),o=a=e.destLen-x(e,f[i],d[i]);o<a+r;++o)e.dest[e.destLen++]=e.dest[o]}}function E(e){for(var t,n;8<e.bitcount;)e.sourceIndex--,e.bitcount-=8;if((t=256*(t=e.source[e.sourceIndex+1])+e.source[e.sourceIndex])!==(65535&~(256*e.source[e.sourceIndex+3]+e.source[e.sourceIndex+2])))return-3;for(e.sourceIndex+=4,n=t;n;--n)e.dest[e.destLen++]=e.source[e.sourceIndex++];return e.bitcount=0,0}function S(e,t,n,r,i){return Math.pow(1-i,3)*e+3*Math.pow(1-i,2)*i*t+3*(1-i)*Math.pow(i,2)*n+Math.pow(i,3)*r}function C(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}function A(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}function O(e){throw new Error(e)}function D(e,t){e||O(t)}!function(e,t){var n;for(n=0;n<7;++n)e.table[n]=0;for(e.table[7]=24,e.table[8]=152,e.table[9]=112,n=0;n<24;++n)e.trans[n]=256+n;for(n=0;n<144;++n)e.trans[24+n]=n;for(n=0;n<8;++n)e.trans[168+n]=280+n;for(n=0;n<112;++n)e.trans[176+n]=144+n;for(n=0;n<5;++n)t.table[n]=0;for(t.table[5]=32,n=0;n<32;++n)t.trans[n]=n}(s,u),v(c,l,4,3),v(f,d,2,1),c[28]=0,l[28]=258,C.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)},C.prototype.addPoint=function(e,t){"number"==typeof e&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=e,this.x2=e),e<this.x1&&(this.x1=e),e>this.x2&&(this.x2=e)),"number"==typeof t&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=t,this.y2=t),t<this.y1&&(this.y1=t),t>this.y2&&(this.y2=t))},C.prototype.addX=function(e){this.addPoint(e,null)},C.prototype.addY=function(e){this.addPoint(null,e)},C.prototype.addBezier=function(e,t,n,r,i,a,o,s){var u=[e,t],c=[n,r],l=[i,a],f=[o,s];this.addPoint(e,t),this.addPoint(o,s);for(var d=0;d<=1;d++){var h=6*u[d]-12*c[d]+6*l[d],p=-3*u[d]+9*c[d]-9*l[d]+3*f[d],m=3*c[d]-3*u[d];if(0!=p){var v=Math.pow(h,2)-4*m*p;if(!(v<0)){var g=(-h+Math.sqrt(v))/(2*p);0<g&&g<1&&(0===d&&this.addX(S(u[d],c[d],l[d],f[d],g)),1===d&&this.addY(S(u[d],c[d],l[d],f[d],g)));var y=(-h-Math.sqrt(v))/(2*p);0<y&&y<1&&(0===d&&this.addX(S(u[d],c[d],l[d],f[d],y)),1===d&&this.addY(S(u[d],c[d],l[d],f[d],y)))}}else{if(0==h)continue;var b=-m/h;0<b&&b<1&&(0===d&&this.addX(S(u[d],c[d],l[d],f[d],b)),1===d&&this.addY(S(u[d],c[d],l[d],f[d],b)))}}},C.prototype.addQuad=function(e,t,n,r,i,a){var o=e+2/3*(n-e),s=t+2/3*(r-t),u=o+1/3*(i-e),c=s+1/3*(a-t);this.addBezier(e,t,o,s,u,c,i,a)},A.prototype.moveTo=function(e,t){this.commands.push({type:"M",x:e,y:t})},A.prototype.lineTo=function(e,t){this.commands.push({type:"L",x:e,y:t})},A.prototype.curveTo=A.prototype.bezierCurveTo=function(e,t,n,r,i,a){this.commands.push({type:"C",x1:e,y1:t,x2:n,y2:r,x:i,y:a})},A.prototype.quadTo=A.prototype.quadraticCurveTo=function(e,t,n,r){this.commands.push({type:"Q",x1:e,y1:t,x:n,y:r})},A.prototype.close=A.prototype.closePath=function(){this.commands.push({type:"Z"})},A.prototype.extend=function(e){if(e.commands)e=e.commands;else if(e instanceof C){var t=e;return this.moveTo(t.x1,t.y1),this.lineTo(t.x2,t.y1),this.lineTo(t.x2,t.y2),this.lineTo(t.x1,t.y2),void this.close()}Array.prototype.push.apply(this.commands,e)},A.prototype.getBoundingBox=function(){for(var e=new C,t=0,n=0,r=0,i=0,a=0;a<this.commands.length;a++){var o=this.commands[a];switch(o.type){case"M":e.addPoint(o.x,o.y),t=r=o.x,n=i=o.y;break;case"L":e.addPoint(o.x,o.y),r=o.x,i=o.y;break;case"Q":e.addQuad(r,i,o.x1,o.y1,o.x,o.y),r=o.x,i=o.y;break;case"C":e.addBezier(r,i,o.x1,o.y1,o.x2,o.y2,o.x,o.y),r=o.x,i=o.y;break;case"Z":r=t,i=n;break;default:throw new Error("Unexpected path command "+o.type)}}return e.isEmpty()&&e.addPoint(0,0),e},A.prototype.draw=function(e){e.beginPath();for(var t=0;t<this.commands.length;t+=1){var n=this.commands[t];"M"===n.type?e.moveTo(n.x,n.y):"L"===n.type?e.lineTo(n.x,n.y):"C"===n.type?e.bezierCurveTo(n.x1,n.y1,n.x2,n.y2,n.x,n.y):"Q"===n.type?e.quadraticCurveTo(n.x1,n.y1,n.x,n.y):"Z"===n.type&&e.closePath()}this.fill&&(e.fillStyle=this.fill,e.fill()),this.stroke&&(e.strokeStyle=this.stroke,e.lineWidth=this.strokeWidth,e.stroke())},A.prototype.toPathData=function(e){function t(){for(var t,n=arguments,r="",i=0;i<arguments.length;i+=1){var a=n[i];0<=a&&0<i&&(r+=" "),r+=(t=a,Math.round(t)===t?""+Math.round(t):t.toFixed(e))}return r}e=void 0!==e?e:2;for(var n="",r=0;r<this.commands.length;r+=1){var i=this.commands[r];"M"===i.type?n+="M"+t(i.x,i.y):"L"===i.type?n+="L"+t(i.x,i.y):"C"===i.type?n+="C"+t(i.x1,i.y1,i.x2,i.y2,i.x,i.y):"Q"===i.type?n+="Q"+t(i.x1,i.y1,i.x,i.y):"Z"===i.type&&(n+="Z")}return n},A.prototype.toSVG=function(e){var t='<path d="';return t+=this.toPathData(e),t+='"',this.fill&&"black"!==this.fill&&(null===this.fill?t+=' fill="none"':t+=' fill="'+this.fill+'"'),this.stroke&&(t+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),t+"/>"},A.prototype.toDOMElement=function(e){var t=this.toPathData(e),n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d",t),n};var T={fail:O,argument:D,assert:D},j={},M={},F={};function I(e){return function(){return e}}M.BYTE=function(e){return T.argument(0<=e&&e<=255,"Byte value should be between 0 and 255."),[e]},F.BYTE=I(1),M.CHAR=function(e){return[e.charCodeAt(0)]},F.CHAR=I(1),M.CHARARRAY=function(e){for(var t=[],n=0;n<e.length;n+=1)t[n]=e.charCodeAt(n);return t},F.CHARARRAY=function(e){return e.length},M.USHORT=function(e){return[e>>8&255,255&e]},F.USHORT=I(2),M.SHORT=function(e){return 32768<=e&&(e=-(65536-e)),[e>>8&255,255&e]},F.SHORT=I(2),M.UINT24=function(e){return[e>>16&255,e>>8&255,255&e]},F.UINT24=I(3),M.ULONG=function(e){return[e>>24&255,e>>16&255,e>>8&255,255&e]},F.ULONG=I(4),M.LONG=function(e){return 2147483648<=e&&(e=-(4294967296-e)),[e>>24&255,e>>16&255,e>>8&255,255&e]},F.LONG=I(4),M.FIXED=M.ULONG,F.FIXED=F.ULONG,M.FWORD=M.SHORT,F.FWORD=F.SHORT,M.UFWORD=M.USHORT,F.UFWORD=F.USHORT,M.LONGDATETIME=function(e){return[0,0,0,0,e>>24&255,e>>16&255,e>>8&255,255&e]},F.LONGDATETIME=I(8),M.TAG=function(e){return T.argument(4===e.length,"Tag should be exactly 4 ASCII characters."),[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]},F.TAG=I(4),M.Card8=M.BYTE,F.Card8=F.BYTE,M.Card16=M.USHORT,F.Card16=F.USHORT,M.OffSize=M.BYTE,F.OffSize=F.BYTE,M.SID=M.USHORT,F.SID=F.USHORT,M.NUMBER=function(e){return-107<=e&&e<=107?[e+139]:108<=e&&e<=1131?[247+((e-=108)>>8),255&e]:-1131<=e&&e<=-108?[251+((e=-e-108)>>8),255&e]:-32768<=e&&e<=32767?M.NUMBER16(e):M.NUMBER32(e)},F.NUMBER=function(e){return M.NUMBER(e).length},M.NUMBER16=function(e){return[28,e>>8&255,255&e]},F.NUMBER16=I(3),M.NUMBER32=function(e){return[29,e>>24&255,e>>16&255,e>>8&255,255&e]},F.NUMBER32=I(5),M.REAL=function(e){var t=e.toString(),n=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(t);if(n){var r=parseFloat("1e"+((n[2]?+n[2]:0)+n[1].length));t=(Math.round(e*r)/r).toString()}for(var i="",a=0,o=t.length;a<o;a+=1){var s=t[a];i+="e"===s?"-"===t[++a]?"c":"b":"."===s?"a":"-"===s?"e":s}for(var u=[30],c=0,l=(i+=1&i.length?"f":"ff").length;c<l;c+=2)u.push(parseInt(i.substr(c,2),16));return u},F.REAL=function(e){return M.REAL(e).length},M.NAME=M.CHARARRAY,F.NAME=F.CHARARRAY,M.STRING=M.CHARARRAY,F.STRING=F.CHARARRAY,j.UTF8=function(e,t,n){for(var r=[],i=n,a=0;a<i;a++,t+=1)r[a]=e.getUint8(t);return String.fromCharCode.apply(null,r)},j.UTF16=function(e,t,n){for(var r=[],i=n/2,a=0;a<i;a++,t+=2)r[a]=e.getUint16(t);return String.fromCharCode.apply(null,r)},M.UTF16=function(e){for(var t=[],n=0;n<e.length;n+=1){var r=e.charCodeAt(n);t[t.length]=r>>8&255,t[t.length]=255&r}return t},F.UTF16=function(e){return 2*e.length};var N={"x-mac-croatian":"\xc4\xc5\xc7\xc9\xd1\xd6\xdc\xe1\xe0\xe2\xe4\xe3\xe5\xe7\xe9\xe8\xea\xeb\xed\xec\xee\xef\xf1\xf3\xf2\xf4\xf6\xf5\xfa\xf9\xfb\xfc\u2020\xb0\xa2\xa3\xa7\u2022\xb6\xdf\xae\u0160\u2122\xb4\xa8\u2260\u017d\xd8\u221e\xb1\u2264\u2265\u2206\xb5\u2202\u2211\u220f\u0161\u222b\xaa\xba\u03a9\u017e\xf8\xbf\xa1\xac\u221a\u0192\u2248\u0106\xab\u010c\u2026\xa0\xc0\xc3\xd5\u0152\u0153\u0110\u2014\u201c\u201d\u2018\u2019\xf7\u25ca\uf8ff\xa9\u2044\u20ac\u2039\u203a\xc6\xbb\u2013\xb7\u201a\u201e\u2030\xc2\u0107\xc1\u010d\xc8\xcd\xce\xcf\xcc\xd3\xd4\u0111\xd2\xda\xdb\xd9\u0131\u02c6\u02dc\xaf\u03c0\xcb\u02da\xb8\xca\xe6\u02c7","x-mac-cyrillic":"\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041a\u041b\u041c\u041d\u041e\u041f\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042a\u042b\u042c\u042d\u042e\u042f\u2020\xb0\u0490\xa3\xa7\u2022\xb6\u0406\xae\xa9\u2122\u0402\u0452\u2260\u0403\u0453\u221e\xb1\u2264\u2265\u0456\xb5\u0491\u0408\u0404\u0454\u0407\u0457\u0409\u0459\u040a\u045a\u0458\u0405\xac\u221a\u0192\u2248\u2206\xab\xbb\u2026\xa0\u040b\u045b\u040c\u045c\u0455\u2013\u2014\u201c\u201d\u2018\u2019\xf7\u201e\u040e\u045e\u040f\u045f\u2116\u0401\u0451\u044f\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043a\u043b\u043c\u043d\u043e\u043f\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044a\u044b\u044c\u044d\u044e","x-mac-gaelic":"\xc4\xc5\xc7\xc9\xd1\xd6\xdc\xe1\xe0\xe2\xe4\xe3\xe5\xe7\xe9\xe8\xea\xeb\xed\xec\xee\xef\xf1\xf3\xf2\xf4\xf6\xf5\xfa\xf9\xfb\xfc\u2020\xb0\xa2\xa3\xa7\u2022\xb6\xdf\xae\xa9\u2122\xb4\xa8\u2260\xc6\xd8\u1e02\xb1\u2264\u2265\u1e03\u010a\u010b\u1e0a\u1e0b\u1e1e\u1e1f\u0120\u0121\u1e40\xe6\xf8\u1e41\u1e56\u1e57\u027c\u0192\u017f\u1e60\xab\xbb\u2026\xa0\xc0\xc3\xd5\u0152\u0153\u2013\u2014\u201c\u201d\u2018\u2019\u1e61\u1e9b\xff\u0178\u1e6a\u20ac\u2039\u203a\u0176\u0177\u1e6b\xb7\u1ef2\u1ef3\u204a\xc2\xca\xc1\xcb\xc8\xcd\xce\xcf\xcc\xd3\xd4\u2663\xd2\xda\xdb\xd9\u0131\xdd\xfd\u0174\u0175\u1e84\u1e85\u1e80\u1e81\u1e82\u1e83","x-mac-greek":"\xc4\xb9\xb2\xc9\xb3\xd6\xdc\u0385\xe0\xe2\xe4\u0384\xa8\xe7\xe9\xe8\xea\xeb\xa3\u2122\xee\xef\u2022\xbd\u2030\xf4\xf6\xa6\u20ac\xf9\xfb\xfc\u2020\u0393\u0394\u0398\u039b\u039e\u03a0\xdf\xae\xa9\u03a3\u03aa\xa7\u2260\xb0\xb7\u0391\xb1\u2264\u2265\xa5\u0392\u0395\u0396\u0397\u0399\u039a\u039c\u03a6\u03ab\u03a8\u03a9\u03ac\u039d\xac\u039f\u03a1\u2248\u03a4\xab\xbb\u2026\xa0\u03a5\u03a7\u0386\u0388\u0153\u2013\u2015\u201c\u201d\u2018\u2019\xf7\u0389\u038a\u038c\u038e\u03ad\u03ae\u03af\u03cc\u038f\u03cd\u03b1\u03b2\u03c8\u03b4\u03b5\u03c6\u03b3\u03b7\u03b9\u03be\u03ba\u03bb\u03bc\u03bd\u03bf\u03c0\u03ce\u03c1\u03c3\u03c4\u03b8\u03c9\u03c2\u03c7\u03c5\u03b6\u03ca\u03cb\u0390\u03b0\xad","x-mac-icelandic":"\xc4\xc5\xc7\xc9\xd1\xd6\xdc\xe1\xe0\xe2\xe4\xe3\xe5\xe7\xe9\xe8\xea\xeb\xed\xec\xee\xef\xf1\xf3\xf2\xf4\xf6\xf5\xfa\xf9\xfb\xfc\xdd\xb0\xa2\xa3\xa7\u2022\xb6\xdf\xae\xa9\u2122\xb4\xa8\u2260\xc6\xd8\u221e\xb1\u2264\u2265\xa5\xb5\u2202\u2211\u220f\u03c0\u222b\xaa\xba\u03a9\xe6\xf8\xbf\xa1\xac\u221a\u0192\u2248\u2206\xab\xbb\u2026\xa0\xc0\xc3\xd5\u0152\u0153\u2013\u2014\u201c\u201d\u2018\u2019\xf7\u25ca\xff\u0178\u2044\u20ac\xd0\xf0\xde\xfe\xfd\xb7\u201a\u201e\u2030\xc2\xca\xc1\xcb\xc8\xcd\xce\xcf\xcc\xd3\xd4\uf8ff\xd2\xda\xdb\xd9\u0131\u02c6\u02dc\xaf\u02d8\u02d9\u02da\xb8\u02dd\u02db\u02c7","x-mac-inuit":"\u1403\u1404\u1405\u1406\u140a\u140b\u1431\u1432\u1433\u1434\u1438\u1439\u1449\u144e\u144f\u1450\u1451\u1455\u1456\u1466\u146d\u146e\u146f\u1470\u1472\u1473\u1483\u148b\u148c\u148d\u148e\u1490\u1491\xb0\u14a1\u14a5\u14a6\u2022\xb6\u14a7\xae\xa9\u2122\u14a8\u14aa\u14ab\u14bb\u14c2\u14c3\u14c4\u14c5\u14c7\u14c8\u14d0\u14ef\u14f0\u14f1\u14f2\u14f4\u14f5\u1505\u14d5\u14d6\u14d7\u14d8\u14da\u14db\u14ea\u1528\u1529\u152a\u152b\u152d\u2026\xa0\u152e\u153e\u1555\u1556\u1557\u2013\u2014\u201c\u201d\u2018\u2019\u1558\u1559\u155a\u155d\u1546\u1547\u1548\u1549\u154b\u154c\u1550\u157f\u1580\u1581\u1582\u1583\u1584\u1585\u158f\u1590\u1591\u1592\u1593\u1594\u1595\u1671\u1672\u1673\u1674\u1675\u1676\u1596\u15a0\u15a1\u15a2\u15a3\u15a4\u15a5\u15a6\u157c\u0141\u0142","x-mac-ce":"\xc4\u0100\u0101\xc9\u0104\xd6\xdc\xe1\u0105\u010c\xe4\u010d\u0106\u0107\xe9\u0179\u017a\u010e\xed\u010f\u0112\u0113\u0116\xf3\u0117\xf4\xf6\xf5\xfa\u011a\u011b\xfc\u2020\xb0\u0118\xa3\xa7\u2022\xb6\xdf\xae\xa9\u2122\u0119\xa8\u2260\u0123\u012e\u012f\u012a\u2264\u2265\u012b\u0136\u2202\u2211\u0142\u013b\u013c\u013d\u013e\u0139\u013a\u0145\u0146\u0143\xac\u221a\u0144\u0147\u2206\xab\xbb\u2026\xa0\u0148\u0150\xd5\u0151\u014c\u2013\u2014\u201c\u201d\u2018\u2019\xf7\u25ca\u014d\u0154\u0155\u0158\u2039\u203a\u0159\u0156\u0157\u0160\u201a\u201e\u0161\u015a\u015b\xc1\u0164\u0165\xcd\u017d\u017e\u016a\xd3\xd4\u016b\u016e\xda\u016f\u0170\u0171\u0172\u0173\xdd\xfd\u0137\u017b\u0141\u017c\u0122\u02c7",macintosh:"\xc4\xc5\xc7\xc9\xd1\xd6\xdc\xe1\xe0\xe2\xe4\xe3\xe5\xe7\xe9\xe8\xea\xeb\xed\xec\xee\xef\xf1\xf3\xf2\xf4\xf6\xf5\xfa\xf9\xfb\xfc\u2020\xb0\xa2\xa3\xa7\u2022\xb6\xdf\xae\xa9\u2122\xb4\xa8\u2260\xc6\xd8\u221e\xb1\u2264\u2265\xa5\xb5\u2202\u2211\u220f\u03c0\u222b\xaa\xba\u03a9\xe6\xf8\xbf\xa1\xac\u221a\u0192\u2248\u2206\xab\xbb\u2026\xa0\xc0\xc3\xd5\u0152\u0153\u2013\u2014\u201c\u201d\u2018\u2019\xf7\u25ca\xff\u0178\u2044\u20ac\u2039\u203a\ufb01\ufb02\u2021\xb7\u201a\u201e\u2030\xc2\xca\xc1\xcb\xc8\xcd\xce\xcf\xcc\xd3\xd4\uf8ff\xd2\xda\xdb\xd9\u0131\u02c6\u02dc\xaf\u02d8\u02d9\u02da\xb8\u02dd\u02db\u02c7","x-mac-romanian":"\xc4\xc5\xc7\xc9\xd1\xd6\xdc\xe1\xe0\xe2\xe4\xe3\xe5\xe7\xe9\xe8\xea\xeb\xed\xec\xee\xef\xf1\xf3\xf2\xf4\xf6\xf5\xfa\xf9\xfb\xfc\u2020\xb0\xa2\xa3\xa7\u2022\xb6\xdf\xae\xa9\u2122\xb4\xa8\u2260\u0102\u0218\u221e\xb1\u2264\u2265\xa5\xb5\u2202\u2211\u220f\u03c0\u222b\xaa\xba\u03a9\u0103\u0219\xbf\xa1\xac\u221a\u0192\u2248\u2206\xab\xbb\u2026\xa0\xc0\xc3\xd5\u0152\u0153\u2013\u2014\u201c\u201d\u2018\u2019\xf7\u25ca\xff\u0178\u2044\u20ac\u2039\u203a\u021a\u021b\u2021\xb7\u201a\u201e\u2030\xc2\xca\xc1\xcb\xc8\xcd\xce\xcf\xcc\xd3\xd4\uf8ff\xd2\xda\xdb\xd9\u0131\u02c6\u02dc\xaf\u02d8\u02d9\u02da\xb8\u02dd\u02db\u02c7","x-mac-turkish":"\xc4\xc5\xc7\xc9\xd1\xd6\xdc\xe1\xe0\xe2\xe4\xe3\xe5\xe7\xe9\xe8\xea\xeb\xed\xec\xee\xef\xf1\xf3\xf2\xf4\xf6\xf5\xfa\xf9\xfb\xfc\u2020\xb0\xa2\xa3\xa7\u2022\xb6\xdf\xae\xa9\u2122\xb4\xa8\u2260\xc6\xd8\u221e\xb1\u2264\u2265\xa5\xb5\u2202\u2211\u220f\u03c0\u222b\xaa\xba\u03a9\xe6\xf8\xbf\xa1\xac\u221a\u0192\u2248\u2206\xab\xbb\u2026\xa0\xc0\xc3\xd5\u0152\u0153\u2013\u2014\u201c\u201d\u2018\u2019\xf7\u25ca\xff\u0178\u011e\u011f\u0130\u0131\u015e\u015f\u2021\xb7\u201a\u201e\u2030\xc2\xca\xc1\xcb\xc8\xcd\xce\xcf\xcc\xd3\xd4\uf8ff\xd2\xda\xdb\xd9\uf8a0\u02c6\u02dc\xaf\u02d8\u02d9\u02da\xb8\u02dd\u02db\u02c7"};j.MACSTRING=function(e,t,n,r){var i=N[r];if(void 0!==i){for(var a="",o=0;o<n;o++){var s=e.getUint8(t+o);a+=s<=127?String.fromCharCode(s):i[127&s]}return a}};var R,P="function"==typeof WeakMap&&new WeakMap;function B(e){return-128<=e&&e<=127}function L(e,t,n){for(var r=0,i=e.length;t<i&&r<64&&0===e[t];)++t,++r;return n.push(128|r-1),t}function z(e,t,n){for(var r=0,i=e.length,a=t;a<i&&r<64;){var o=e[a];if(!B(o))break;if(0===o&&a+1<i&&0===e[a+1])break;++a,++r}n.push(r-1);for(var s=t;s<a;++s)n.push(e[s]+256&255);return a}function U(e,t,n){for(var r=0,i=e.length,a=t;a<i&&r<64;){var o=e[a];if(0===o)break;if(B(o)&&a+1<i&&B(e[a+1]))break;++a,++r}n.push(64|r-1);for(var s=t;s<a;++s){var u=e[s];n.push(u+65536>>8&255,u+256&255)}return a}M.MACSTRING=function(e,t){var n=function(e){if(!R)for(var t in R={},N)R[t]=new String(t);var n=R[e];if(void 0!==n){if(P){var r=P.get(n);if(void 0!==r)return r}var i=N[e];if(void 0!==i){for(var a={},o=0;o<i.length;o++)a[i.charCodeAt(o)]=o+128;return P&&P.set(n,a),a}}}(t);if(void 0!==n){for(var r=[],i=0;i<e.length;i++){var a=e.charCodeAt(i);if(128<=a&&void 0===(a=n[a]))return;r[i]=a}return r}},F.MACSTRING=function(e,t){var n=M.MACSTRING(e,t);return void 0!==n?n.length:0},M.VARDELTAS=function(e){for(var t=0,n=[];t<e.length;){var r=e[t];t=0===r?L(e,t,n):-128<=r&&r<=127?z(e,t,n):U(e,t,n)}return n},M.INDEX=function(e){for(var t=1,n=[t],r=[],i=0;i<e.length;i+=1){var a=M.OBJECT(e[i]);Array.prototype.push.apply(r,a),t+=a.length,n.push(t)}if(0===r.length)return[0,0];for(var o=[],s=1+Math.floor(Math.log(t)/Math.log(2))/8|0,u=[void 0,M.BYTE,M.USHORT,M.UINT24,M.ULONG][s],c=0;c<n.length;c+=1){var l=u(n[c]);Array.prototype.push.apply(o,l)}return Array.prototype.concat(M.Card16(e.length),M.OffSize(s),o,r)},F.INDEX=function(e){return M.INDEX(e).length},M.DICT=function(e){for(var t=[],n=Object.keys(e),r=n.length,i=0;i<r;i+=1){var a=parseInt(n[i],0),o=e[a];t=(t=t.concat(M.OPERAND(o.value,o.type))).concat(M.OPERATOR(a))}return t},F.DICT=function(e){return M.DICT(e).length},M.OPERATOR=function(e){return e<1200?[e]:[12,e-1200]},M.OPERAND=function(e,t){var n=[];if(Array.isArray(t))for(var r=0;r<t.length;r+=1)T.argument(e.length===t.length,"Not enough arguments given for type"+t),n=n.concat(M.OPERAND(e[r],t[r]));else if("SID"===t)n=n.concat(M.NUMBER(e));else if("offset"===t)n=n.concat(M.NUMBER32(e));else if("number"===t)n=n.concat(M.NUMBER(e));else{if("real"!==t)throw new Error("Unknown operand type "+t);n=n.concat(M.REAL(e))}return n},M.OP=M.BYTE,F.OP=F.BYTE;var W="function"==typeof WeakMap&&new WeakMap;function V(e,t,n){for(var r=0;r<t.length;r+=1){var i=t[r];this[i.name]=i.value}if(this.tableName=e,this.fields=t,n)for(var a=Object.keys(n),o=0;o<a.length;o+=1){var s=a[o],u=n[s];void 0!==this[s]&&(this[s]=u)}}function G(e,t,n){void 0===n&&(n=t.length);var r=new Array(t.length+1);r[0]={name:e+"Count",type:"USHORT",value:n};for(var i=0;i<t.length;i++)r[i+1]={name:e+i,type:"USHORT",value:t[i]};return r}function q(e,t,n){var r=t.length,i=new Array(r+1);i[0]={name:e+"Count",type:"USHORT",value:r};for(var a=0;a<r;a++)i[a+1]={name:e+a,type:"TABLE",value:n(t[a],a)};return i}function H(e,t,n){var r=t.length,i=[];i[0]={name:e+"Count",type:"USHORT",value:r};for(var a=0;a<r;a++)i=i.concat(n(t[a],a));return i}function X(e){1===e.format?V.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(G("glyph",e.glyphs))):T.assert(!1,"Can't create coverage table format 2 yet.")}function K(e){V.call(this,"scriptListTable",H("scriptRecord",e,(function(e,t){var n=e.script,r=n.defaultLangSys;return T.assert(!!r,"Unable to write GSUB: script "+e.tag+" has no default language system."),[{name:"scriptTag"+t,type:"TAG",value:e.tag},{name:"script"+t,type:"TABLE",value:new V("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new V("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:r.reqFeatureIndex}].concat(G("featureIndex",r.featureIndexes)))}].concat(H("langSys",n.langSysRecords,(function(e,t){var n=e.langSys;return[{name:"langSysTag"+t,type:"TAG",value:e.tag},{name:"langSys"+t,type:"TABLE",value:new V("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:n.reqFeatureIndex}].concat(G("featureIndex",n.featureIndexes)))}]}))))}]})))}function Y(e){V.call(this,"featureListTable",H("featureRecord",e,(function(e,t){var n=e.feature;return[{name:"featureTag"+t,type:"TAG",value:e.tag},{name:"feature"+t,type:"TABLE",value:new V("featureTable",[{name:"featureParams",type:"USHORT",value:n.featureParams}].concat(G("lookupListIndex",n.lookupListIndexes)))}]})))}function $(e,t){V.call(this,"lookupListTable",q("lookup",e,(function(e){var n=t[e.lookupType];return T.assert(!!n,"Unable to write GSUB lookup type "+e.lookupType+" tables."),new V("lookupTable",[{name:"lookupType",type:"USHORT",value:e.lookupType},{name:"lookupFlag",type:"USHORT",value:e.lookupFlag}].concat(q("subtable",e.subtables,n)))})))}M.CHARSTRING=function(e){if(W){var t=W.get(e);if(void 0!==t)return t}for(var n=[],r=e.length,i=0;i<r;i+=1){var a=e[i];n=n.concat(M[a.type](a.value))}return W&&W.set(e,n),n},F.CHARSTRING=function(e){return M.CHARSTRING(e).length},M.OBJECT=function(e){var t=M[e.type];return T.argument(void 0!==t,"No encoding function for type "+e.type),t(e.value)},F.OBJECT=function(e){var t=F[e.type];return T.argument(void 0!==t,"No sizeOf function for type "+e.type),t(e.value)},M.TABLE=function(e){for(var t=[],n=e.fields.length,r=[],i=[],a=0;a<n;a+=1){var o=e.fields[a],s=M[o.type];T.argument(void 0!==s,"No encoding function for field type "+o.type+" ("+o.name+")");var u=e[o.name];void 0===u&&(u=o.value);var c=s(u);"TABLE"===o.type?(i.push(t.length),t=t.concat([0,0]),r.push(c)):t=t.concat(c)}for(var l=0;l<r.length;l+=1){var f=i[l],d=t.length;T.argument(d<65536,"Table "+e.tableName+" too big."),t[f]=d>>8,t[f+1]=255&d,t=t.concat(r[l])}return t},F.TABLE=function(e){for(var t=0,n=e.fields.length,r=0;r<n;r+=1){var i=e.fields[r],a=F[i.type];T.argument(void 0!==a,"No sizeOf function for field type "+i.type+" ("+i.name+")");var o=e[i.name];void 0===o&&(o=i.value),t+=a(o),"TABLE"===i.type&&(t+=2)}return t},M.RECORD=M.TABLE,F.RECORD=F.TABLE,M.LITERAL=function(e){return e},F.LITERAL=function(e){return e.length},V.prototype.encode=function(){return M.TABLE(this)},V.prototype.sizeOf=function(){return F.TABLE(this)};var J={Table:V,Record:V,Coverage:(X.prototype=Object.create(V.prototype)).constructor=X,ScriptList:(K.prototype=Object.create(V.prototype)).constructor=K,FeatureList:(Y.prototype=Object.create(V.prototype)).constructor=Y,LookupList:($.prototype=Object.create(V.prototype)).constructor=$,ushortList:G,tableList:q,recordList:H};function Z(e,t){return e.getUint8(t)}function Q(e,t){return e.getUint16(t,!1)}function ee(e,t){return e.getUint32(t,!1)}function te(e,t){return e.getInt16(t,!1)+e.getUint16(t+2,!1)/65535}var ne={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function re(e,t){this.data=e,this.offset=t,this.relativeOffset=0}re.prototype.parseByte=function(){var e=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,e},re.prototype.parseChar=function(){var e=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,e},re.prototype.parseCard8=re.prototype.parseByte,re.prototype.parseCard16=re.prototype.parseUShort=function(){var e=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,e},re.prototype.parseSID=re.prototype.parseUShort,re.prototype.parseOffset16=re.prototype.parseUShort,re.prototype.parseShort=function(){var e=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,e},re.prototype.parseF2Dot14=function(){var e=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,e},re.prototype.parseOffset32=re.prototype.parseULong=function(){var e=ee(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,e},re.prototype.parseFixed=function(){var e=te(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,e},re.prototype.parseString=function(e){var t=this.data,n=this.offset+this.relativeOffset,r="";this.relativeOffset+=e;for(var i=0;i<e;i++)r+=String.fromCharCode(t.getUint8(n+i));return r},re.prototype.parseTag=function(){return this.parseString(4)},re.prototype.parseLongDateTime=function(){var e=ee(this.data,this.offset+this.relativeOffset+4);return e-=2082844800,this.relativeOffset+=8,e},re.prototype.parseVersion=function(e){var t=Q(this.data,this.offset+this.relativeOffset),n=Q(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,void 0===e&&(e=4096),t+n/e/10},re.prototype.skip=function(e,t){void 0===t&&(t=1),this.relativeOffset+=ne[e]*t},re.prototype.parseULongList=function(e){void 0===e&&(e=this.parseULong());for(var t=new Array(e),n=this.data,r=this.offset+this.relativeOffset,i=0;i<e;i++)t[i]=n.getUint32(r),r+=4;return this.relativeOffset+=4*e,t},re.prototype.parseOffset16List=re.prototype.parseUShortList=function(e){void 0===e&&(e=this.parseUShort());for(var t=new Array(e),n=this.data,r=this.offset+this.relativeOffset,i=0;i<e;i++)t[i]=n.getUint16(r),r+=2;return this.relativeOffset+=2*e,t},re.prototype.parseShortList=function(e){for(var t=new Array(e),n=this.data,r=this.offset+this.relativeOffset,i=0;i<e;i++)t[i]=n.getInt16(r),r+=2;return this.relativeOffset+=2*e,t},re.prototype.parseByteList=function(e){for(var t=new Array(e),n=this.data,r=this.offset+this.relativeOffset,i=0;i<e;i++)t[i]=n.getUint8(r++);return this.relativeOffset+=e,t},re.prototype.parseList=function(e,t){t||(t=e,e=this.parseUShort());for(var n=new Array(e),r=0;r<e;r++)n[r]=t.call(this);return n},re.prototype.parseList32=function(e,t){t||(t=e,e=this.parseULong());for(var n=new Array(e),r=0;r<e;r++)n[r]=t.call(this);return n},re.prototype.parseRecordList=function(e,t){t||(t=e,e=this.parseUShort());for(var n=new Array(e),r=Object.keys(t),i=0;i<e;i++){for(var a={},o=0;o<r.length;o++){var s=r[o],u=t[s];a[s]=u.call(this)}n[i]=a}return n},re.prototype.parseRecordList32=function(e,t){t||(t=e,e=this.parseULong());for(var n=new Array(e),r=Object.keys(t),i=0;i<e;i++){for(var a={},o=0;o<r.length;o++){var s=r[o],u=t[s];a[s]=u.call(this)}n[i]=a}return n},re.prototype.parseStruct=function(e){if("function"==typeof e)return e.call(this);for(var t=Object.keys(e),n={},r=0;r<t.length;r++){var i=t[r],a=e[i];n[i]=a.call(this)}return n},re.prototype.parseValueRecord=function(e){if(void 0===e&&(e=this.parseUShort()),0!==e){var t={};return 1&e&&(t.xPlacement=this.parseShort()),2&e&&(t.yPlacement=this.parseShort()),4&e&&(t.xAdvance=this.parseShort()),8&e&&(t.yAdvance=this.parseShort()),16&e&&(t.xPlaDevice=void 0,this.parseShort()),32&e&&(t.yPlaDevice=void 0,this.parseShort()),64&e&&(t.xAdvDevice=void 0,this.parseShort()),128&e&&(t.yAdvDevice=void 0,this.parseShort()),t}},re.prototype.parseValueRecordList=function(){for(var e=this.parseUShort(),t=this.parseUShort(),n=new Array(t),r=0;r<t;r++)n[r]=this.parseValueRecord(e);return n},re.prototype.parsePointer=function(e){var t=this.parseOffset16();if(0<t)return new re(this.data,this.offset+t).parseStruct(e)},re.prototype.parsePointer32=function(e){var t=this.parseOffset32();if(0<t)return new re(this.data,this.offset+t).parseStruct(e)},re.prototype.parseListOfLists=function(e){for(var t=this.parseOffset16List(),n=t.length,r=this.relativeOffset,i=new Array(n),a=0;a<n;a++){var o=t[a];if(0!==o)if(this.relativeOffset=o,e){for(var s=this.parseOffset16List(),u=new Array(s.length),c=0;c<s.length;c++)this.relativeOffset=o+s[c],u[c]=e.call(this);i[a]=u}else i[a]=this.parseUShortList();else i[a]=void 0}return this.relativeOffset=r,i},re.prototype.parseCoverage=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort(),n=this.parseUShort();if(1===t)return{format:1,glyphs:this.parseUShortList(n)};if(2!==t)throw new Error("0x"+e.toString(16)+": Coverage format must be 1 or 2.");for(var r=new Array(n),i=0;i<n;i++)r[i]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:r}},re.prototype.parseClassDef=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();if(1===t)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(2===t)return{format:2,ranges:this.parseRecordList({start:re.uShort,end:re.uShort,classId:re.uShort})};throw new Error("0x"+e.toString(16)+": ClassDef format must be 1 or 2.")},re.list=function(e,t){return function(){return this.parseList(e,t)}},re.list32=function(e,t){return function(){return this.parseList32(e,t)}},re.recordList=function(e,t){return function(){return this.parseRecordList(e,t)}},re.recordList32=function(e,t){return function(){return this.parseRecordList32(e,t)}},re.pointer=function(e){return function(){return this.parsePointer(e)}},re.pointer32=function(e){return function(){return this.parsePointer32(e)}},re.tag=re.prototype.parseTag,re.byte=re.prototype.parseByte,re.uShort=re.offset16=re.prototype.parseUShort,re.uShortList=re.prototype.parseUShortList,re.uLong=re.offset32=re.prototype.parseULong,re.uLongList=re.prototype.parseULongList,re.struct=re.prototype.parseStruct,re.coverage=re.prototype.parseCoverage,re.classDef=re.prototype.parseClassDef;var ie={reserved:re.uShort,reqFeatureIndex:re.uShort,featureIndexes:re.uShortList};re.prototype.parseScriptList=function(){return this.parsePointer(re.recordList({tag:re.tag,script:re.pointer({defaultLangSys:re.pointer(ie),langSysRecords:re.recordList({tag:re.tag,langSys:re.pointer(ie)})})}))||[]},re.prototype.parseFeatureList=function(){return this.parsePointer(re.recordList({tag:re.tag,feature:re.pointer({featureParams:re.offset16,lookupListIndexes:re.uShortList})}))||[]},re.prototype.parseLookupList=function(e){return this.parsePointer(re.list(re.pointer((function(){var t=this.parseUShort();T.argument(1<=t&&t<=9,"GPOS/GSUB lookup type "+t+" unknown.");var n=this.parseUShort(),r=16&n;return{lookupType:t,lookupFlag:n,subtables:this.parseList(re.pointer(e[t])),markFilteringSet:r?this.parseUShort():void 0}}))))||[]},re.prototype.parseFeatureVariationsList=function(){return this.parsePointer32((function(){var e=this.parseUShort(),t=this.parseUShort();return T.argument(1===e&&t<1,"GPOS/GSUB feature variations table unknown."),this.parseRecordList32({conditionSetOffset:re.offset32,featureTableSubstitutionOffset:re.offset32})}))||[]};var ae={getByte:Z,getCard8:Z,getUShort:Q,getCard16:Q,getShort:function(e,t){return e.getInt16(t,!1)},getULong:ee,getFixed:te,getTag:function(e,t){for(var n="",r=t;r<t+4;r+=1)n+=String.fromCharCode(e.getInt8(r));return n},getOffset:function(e,t,n){for(var r=0,i=0;i<n;i+=1)r<<=8,r+=e.getUint8(t+i);return r},getBytes:function(e,t,n){for(var r=[],i=t;i<n;i+=1)r.push(e.getUint8(i));return r},bytesToString:function(e){for(var t="",n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return t},Parser:re},oe=function(e,t){var n={};n.version=ae.getUShort(e,t),T.argument(0===n.version,"cmap table version should be 0."),n.numTables=ae.getUShort(e,t+2);for(var r=-1,i=n.numTables-1;0<=i;--i){var a=ae.getUShort(e,t+4+8*i),o=ae.getUShort(e,t+4+8*i+2);if(3===a&&(0===o||1===o||10===o)||0===a&&(0===o||1===o||2===o||3===o||4===o)){r=ae.getULong(e,t+4+8*i+4);break}}if(-1===r)throw new Error("No valid cmap sub-tables found.");var s=new ae.Parser(e,t+r);if(n.format=s.parseUShort(),12===n.format)!function(e,t){var n;t.parseUShort(),e.length=t.parseULong(),e.language=t.parseULong(),e.groupCount=n=t.parseULong(),e.glyphIndexMap={};for(var r=0;r<n;r+=1)for(var i=t.parseULong(),a=t.parseULong(),o=t.parseULong(),s=i;s<=a;s+=1)e.glyphIndexMap[s]=o,o++}(n,s);else{if(4!==n.format)throw new Error("Only format 4 and 12 cmap tables are supported (found format "+n.format+").");!function(e,t,n,r,i){var a;e.length=t.parseUShort(),e.language=t.parseUShort(),e.segCount=a=t.parseUShort()>>1,t.skip("uShort",3),e.glyphIndexMap={};for(var o=new ae.Parser(n,r+i+14),s=new ae.Parser(n,r+i+16+2*a),u=new ae.Parser(n,r+i+16+4*a),c=new ae.Parser(n,r+i+16+6*a),l=r+i+16+8*a,f=0;f<a-1;f+=1)for(var d=void 0,h=o.parseUShort(),p=s.parseUShort(),m=u.parseShort(),v=c.parseUShort(),g=p;g<=h;g+=1)0!==v?(l=c.offset+c.relativeOffset-2,l+=v,l+=2*(g-p),0!==(d=ae.getUShort(n,l))&&(d=d+m&65535)):d=g+m&65535,e.glyphIndexMap[g]=d}(n,s,e,t,r)}return n},se=function(e){var t,n=!0;for(t=e.length-1;0<t;--t)if(65535<e.get(t).unicode){console.log("Adding CMAP format 12 (needed!)"),n=!1;break}var r=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:n?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:n?12:20}];n||(r=r.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),r=r.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var i,a,o,s=new J.Table("cmap",r);for(s.segments=[],t=0;t<e.length;t+=1){for(var u=e.get(t),c=0;c<u.unicodes.length;c+=1)i=s,a=u.unicodes[c],o=t,i.segments.push({end:a,start:a,delta:-(a-o),offset:0,glyphIndex:o});s.segments=s.segments.sort((function(e,t){return e.start-t.start}))}s.segments.push({end:65535,start:65535,delta:1,offset:0});var l=s.segments.length,f=0,d=[],h=[],p=[],m=[],v=[],g=[];for(t=0;t<l;t+=1){var y=s.segments[t];y.end<=65535&&y.start<=65535?(d=d.concat({name:"end_"+t,type:"USHORT",value:y.end}),h=h.concat({name:"start_"+t,type:"USHORT",value:y.start}),p=p.concat({name:"idDelta_"+t,type:"SHORT",value:y.delta}),m=m.concat({name:"idRangeOffset_"+t,type:"USHORT",value:y.offset}),void 0!==y.glyphId&&(v=v.concat({name:"glyph_"+t,type:"USHORT",value:y.glyphId}))):f+=1,n||void 0===y.glyphIndex||(g=(g=(g=g.concat({name:"cmap12Start_"+t,type:"ULONG",value:y.start})).concat({name:"cmap12End_"+t,type:"ULONG",value:y.end})).concat({name:"cmap12Glyph_"+t,type:"ULONG",value:y.glyphIndex}))}if(s.segCountX2=2*(l-f),s.searchRange=2*Math.pow(2,Math.floor(Math.log(l-f)/Math.log(2))),s.entrySelector=Math.log(s.searchRange/2)/Math.log(2),s.rangeShift=s.segCountX2-s.searchRange,s.fields=s.fields.concat(d),s.fields.push({name:"reservedPad",type:"USHORT",value:0}),s.fields=s.fields.concat(h),s.fields=s.fields.concat(p),s.fields=s.fields.concat(m),s.fields=s.fields.concat(v),s.cmap4Length=14+2*d.length+2+2*h.length+2*p.length+2*m.length+2*v.length,!n){var b=16+4*g.length;s.cmap12Offset=20+s.cmap4Length,s.fields=s.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:b},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:g.length/3}]),s.fields=s.fields.concat(g)}return s},ue=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],ce=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],le=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],fe=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function de(e){this.font=e}function he(e){this.cmap=e}function pe(e,t){this.encoding=e,this.charset=t}function me(e){switch(e.version){case 1:this.names=fe.slice();break;case 2:this.names=new Array(e.numberOfGlyphs);for(var t=0;t<e.numberOfGlyphs;t++)e.glyphNameIndex[t]<fe.length?this.names[t]=fe[e.glyphNameIndex[t]]:this.names[t]=e.names[e.glyphNameIndex[t]-fe.length];break;case 2.5:this.names=new Array(e.numberOfGlyphs);for(var n=0;n<e.numberOfGlyphs;n++)this.names[n]=fe[n+e.glyphNameIndex[n]];break;default:this.names=[]}}de.prototype.charToGlyphIndex=function(e){var t=e.codePointAt(0),n=this.font.glyphs;if(n)for(var r=0;r<n.length;r+=1)for(var i=n.get(r),a=0;a<i.unicodes.length;a+=1)if(i.unicodes[a]===t)return r;return null},he.prototype.charToGlyphIndex=function(e){return this.cmap.glyphIndexMap[e.codePointAt(0)]||0},pe.prototype.charToGlyphIndex=function(e){var t=e.codePointAt(0),n=this.encoding[t];return this.charset.indexOf(n)},me.prototype.nameToGlyphIndex=function(e){return this.names.indexOf(e)},me.prototype.glyphIndexToName=function(e){return this.names[e]};var ve=function(e,t,n,r,i){e.beginPath(),e.moveTo(t,n),e.lineTo(r,i),e.stroke()};function ge(e){this.bindConstructorValues(e)}function ye(e,t,n){Object.defineProperty(e,t,{get:function(){return e.path,e[n]},set:function(t){e[n]=t},enumerable:!0,configurable:!0})}function be(e,t){if(this.font=e,this.glyphs={},Array.isArray(t))for(var n=0;n<t.length;n++)this.glyphs[n]=t[n];this.length=t&&t.length||0}ge.prototype.bindConstructorValues=function(e){var t,n;this.index=e.index||0,this.name=e.name||null,this.unicode=e.unicode||void 0,this.unicodes=e.unicodes||void 0!==e.unicode?[e.unicode]:[],e.xMin&&(this.xMin=e.xMin),e.yMin&&(this.yMin=e.yMin),e.xMax&&(this.xMax=e.xMax),e.yMax&&(this.yMax=e.yMax),e.advanceWidth&&(this.advanceWidth=e.advanceWidth),Object.defineProperty(this,"path",(t=e.path,n=t||new A,{configurable:!0,get:function(){return"function"==typeof n&&(n=n()),n},set:function(e){n=e}}))},ge.prototype.addUnicode=function(e){0===this.unicodes.length&&(this.unicode=e),this.unicodes.push(e)},ge.prototype.getBoundingBox=function(){return this.path.getBoundingBox()},ge.prototype.getPath=function(e,t,n,r,i){var a,o;e=void 0!==e?e:0,t=void 0!==t?t:0,n=void 0!==n?n:72;var s=(r=r||{}).xScale,u=r.yScale;if(r.hinting&&i&&i.hinting&&(o=this.path&&i.hinting.exec(this,n)),o)a=i.hinting.getCommands(o),e=Math.round(e),t=Math.round(t),s=u=1;else{a=this.path.commands;var c=1/this.path.unitsPerEm*n;void 0===s&&(s=c),void 0===u&&(u=c)}for(var l=new A,f=0;f<a.length;f+=1){var d=a[f];"M"===d.type?l.moveTo(e+d.x*s,t+-d.y*u):"L"===d.type?l.lineTo(e+d.x*s,t+-d.y*u):"Q"===d.type?l.quadraticCurveTo(e+d.x1*s,t+-d.y1*u,e+d.x*s,t+-d.y*u):"C"===d.type?l.curveTo(e+d.x1*s,t+-d.y1*u,e+d.x2*s,t+-d.y2*u,e+d.x*s,t+-d.y*u):"Z"===d.type&&l.closePath()}return l},ge.prototype.getContours=function(){if(void 0===this.points)return[];for(var e=[],t=[],n=0;n<this.points.length;n+=1){var r=this.points[n];t.push(r),r.lastPointOfContour&&(e.push(t),t=[])}return T.argument(0===t.length,"There are still points left in the current contour."),e},ge.prototype.getMetrics=function(){for(var e=this.path.commands,t=[],n=[],r=0;r<e.length;r+=1){var i=e[r];"Z"!==i.type&&(t.push(i.x),n.push(i.y)),"Q"!==i.type&&"C"!==i.type||(t.push(i.x1),n.push(i.y1)),"C"===i.type&&(t.push(i.x2),n.push(i.y2))}var a={xMin:Math.min.apply(null,t),yMin:Math.min.apply(null,n),xMax:Math.max.apply(null,t),yMax:Math.max.apply(null,n),leftSideBearing:this.leftSideBearing};return isFinite(a.xMin)||(a.xMin=0),isFinite(a.xMax)||(a.xMax=this.advanceWidth),isFinite(a.yMin)||(a.yMin=0),isFinite(a.yMax)||(a.yMax=0),a.rightSideBearing=this.advanceWidth-a.leftSideBearing-(a.xMax-a.xMin),a},ge.prototype.draw=function(e,t,n,r,i){this.getPath(t,n,r,i).draw(e)},ge.prototype.drawPoints=function(e,t,n,r){function i(t,n,r,i){var a=2*Math.PI;e.beginPath();for(var o=0;o<t.length;o+=1)e.moveTo(n+t[o].x*i,r+t[o].y*i),e.arc(n+t[o].x*i,r+t[o].y*i,2,0,a,!1);e.closePath(),e.fill()}t=void 0!==t?t:0,n=void 0!==n?n:0,r=void 0!==r?r:24;for(var a=1/this.path.unitsPerEm*r,o=[],s=[],u=this.path,c=0;c<u.commands.length;c+=1){var l=u.commands[c];void 0!==l.x&&o.push({x:l.x,y:-l.y}),void 0!==l.x1&&s.push({x:l.x1,y:-l.y1}),void 0!==l.x2&&s.push({x:l.x2,y:-l.y2})}e.fillStyle="blue",i(o,t,n,a),e.fillStyle="red",i(s,t,n,a)},ge.prototype.drawMetrics=function(e,t,n,r){var i;t=void 0!==t?t:0,n=void 0!==n?n:0,r=void 0!==r?r:24,i=1/this.path.unitsPerEm*r,e.lineWidth=1,e.strokeStyle="black",ve(e,t,-1e4,t,1e4),ve(e,-1e4,n,1e4,n);var a=this.xMin||0,o=this.yMin||0,s=this.xMax||0,u=this.yMax||0,c=this.advanceWidth||0;e.strokeStyle="blue",ve(e,t+a*i,-1e4,t+a*i,1e4),ve(e,t+s*i,-1e4,t+s*i,1e4),ve(e,-1e4,n+-o*i,1e4,n+-o*i),ve(e,-1e4,n+-u*i,1e4,n+-u*i),e.strokeStyle="green",ve(e,t+c*i,-1e4,t+c*i,1e4)},be.prototype.get=function(e){return"function"==typeof this.glyphs[e]&&(this.glyphs[e]=this.glyphs[e]()),this.glyphs[e]},be.prototype.push=function(e,t){this.glyphs[e]=t,this.length++};var xe={GlyphSet:be,glyphLoader:function(e,t){return new ge({index:t,font:e})},ttfGlyphLoader:function(e,t,n,r,i,a){return function(){var o=new ge({index:t,font:e});return o.path=function(){n(o,r,i);var t=a(e.glyphs,o);return t.unitsPerEm=e.unitsPerEm,t},ye(o,"xMin","_xMin"),ye(o,"xMax","_xMax"),ye(o,"yMin","_yMin"),ye(o,"yMax","_yMax"),o}},cffGlyphLoader:function(e,t,n,r){return function(){var i=new ge({index:t,font:e});return i.path=function(){var t=n(e,i,r);return t.unitsPerEm=e.unitsPerEm,t},i}}};function we(e,t){if(e===t)return!0;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n+=1)if(!we(e[n],t[n]))return!1;return!0}return!1}function _e(e){return e.length<1240?107:e.length<33900?1131:32768}function ke(e,t,n){var r,i,a=[],o=[],s=ae.getCard16(e,t);if(0!==s){var u=ae.getByte(e,t+2);r=t+(s+1)*u+2;for(var c=t+3,l=0;l<s+1;l+=1)a.push(ae.getOffset(e,c,u)),c+=u;i=r+a[s]}else i=t+2;for(var f=0;f<a.length-1;f+=1){var d=ae.getBytes(e,r+a[f],r+a[f+1]);n&&(d=n(d)),o.push(d)}return{objects:o,startOffset:t,endOffset:i}}function Ee(e,t){if(28===t)return e.parseByte()<<8|e.parseByte();if(29===t)return e.parseByte()<<24|e.parseByte()<<16|e.parseByte()<<8|e.parseByte();if(30===t)return function(e){for(var t="",n=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var r=e.parseByte(),i=r>>4,a=15&r;if(15==i)break;if(t+=n[i],15==a)break;t+=n[a]}return parseFloat(t)}(e);if(32<=t&&t<=246)return t-139;if(247<=t&&t<=250)return 256*(t-247)+e.parseByte()+108;if(251<=t&&t<=254)return 256*-(t-251)-e.parseByte()-108;throw new Error("Invalid b0 "+t)}function Se(e,t,n){t=void 0!==t?t:0;var r=new ae.Parser(e,t),i=[],a=[];for(n=void 0!==n?n:e.length;r.relativeOffset<n;){var o=r.parseByte();o<=21?(12===o&&(o=1200+r.parseByte()),i.push([o,a]),a=[]):a.push(Ee(r,o))}return function(e){for(var t={},n=0;n<e.length;n+=1){var r,i=e[n][0],a=e[n][1];if(r=1===a.length?a[0]:a,t.hasOwnProperty(i)&&!isNaN(t[i]))throw new Error("Object "+t+" already has key "+i);t[i]=r}return t}(i)}function Ce(e,t){return t<=390?ue[t]:e[t-391]}function Ae(e,t,n){for(var r,i={},a=0;a<t.length;a+=1){var o=t[a];if(Array.isArray(o.type)){var s=[];s.length=o.type.length;for(var u=0;u<o.type.length;u++)void 0===(r=void 0!==e[o.op]?e[o.op][u]:void 0)&&(r=void 0!==o.value&&void 0!==o.value[u]?o.value[u]:null),"SID"===o.type[u]&&(r=Ce(n,r)),s[u]=r;i[o.name]=s}else void 0===(r=e[o.op])&&(r=void 0!==o.value?o.value:null),"SID"===o.type&&(r=Ce(n,r)),i[o.name]=r}return i}var Oe=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],De=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function Te(e,t,n,r){return Ae(Se(e,t,n),De,r)}function je(e,t,n,r){for(var i,a,o=[],s=0;s<n.length;s+=1){var u=(a=r,Ae(Se(i=new DataView(new Uint8Array(n[s]).buffer),0,i.byteLength),Oe,a));u._subrs=[],u._subrsBias=0;var c=u.private[0],l=u.private[1];if(0!==c&&0!==l){var f=Te(e,l+t,c,r);if(u._defaultWidthX=f.defaultWidthX,u._nominalWidthX=f.nominalWidthX,0!==f.subrs){var d=ke(e,l+f.subrs+t);u._subrs=d.objects,u._subrsBias=_e(u._subrs)}u._privateDict=f}o.push(u)}return o}function Me(e,t,n){var r,i,a,o,s,u,c,l,f=new A,d=[],h=0,p=!1,m=!1,v=0,g=0;if(e.isCIDFont){var y=e.tables.cff.topDict._fdSelect[t.index],b=e.tables.cff.topDict._fdArray[y];s=b._subrs,u=b._subrsBias,c=b._defaultWidthX,l=b._nominalWidthX}else s=e.tables.cff.topDict._subrs,u=e.tables.cff.topDict._subrsBias,c=e.tables.cff.topDict._defaultWidthX,l=e.tables.cff.topDict._nominalWidthX;var x=c;function w(e,t){m&&f.closePath(),f.moveTo(e,t),m=!0}function _(){d.length%2==0||p||(x=d.shift()+l),h+=d.length>>1,d.length=0,p=!0}return function n(c){for(var y,b,k,E,S,C,A,O,D,T,j,M,F=0;F<c.length;){var I=c[F];switch(F+=1,I){case 1:case 3:case 18:case 23:_();break;case 4:1<d.length&&!p&&(x=d.shift()+l,p=!0),g+=d.pop(),w(v,g);break;case 5:for(;0<d.length;)v+=d.shift(),g+=d.shift(),f.lineTo(v,g);break;case 6:for(;0<d.length&&(v+=d.shift(),f.lineTo(v,g),0!==d.length);)g+=d.shift(),f.lineTo(v,g);break;case 7:for(;0<d.length&&(g+=d.shift(),f.lineTo(v,g),0!==d.length);)v+=d.shift(),f.lineTo(v,g);break;case 8:for(;0<d.length;)r=v+d.shift(),i=g+d.shift(),a=r+d.shift(),o=i+d.shift(),v=a+d.shift(),g=o+d.shift(),f.curveTo(r,i,a,o,v,g);break;case 10:S=d.pop()+u,(C=s[S])&&n(C);break;case 11:return;case 12:switch(I=c[F],F+=1,I){case 35:r=v+d.shift(),i=g+d.shift(),a=r+d.shift(),o=i+d.shift(),A=a+d.shift(),O=o+d.shift(),D=A+d.shift(),T=O+d.shift(),j=D+d.shift(),M=T+d.shift(),v=j+d.shift(),g=M+d.shift(),d.shift(),f.curveTo(r,i,a,o,A,O),f.curveTo(D,T,j,M,v,g);break;case 34:r=v+d.shift(),i=g,a=r+d.shift(),o=i+d.shift(),A=a+d.shift(),O=o,D=A+d.shift(),T=o,j=D+d.shift(),M=g,v=j+d.shift(),f.curveTo(r,i,a,o,A,O),f.curveTo(D,T,j,M,v,g);break;case 36:r=v+d.shift(),i=g+d.shift(),a=r+d.shift(),o=i+d.shift(),A=a+d.shift(),O=o,D=A+d.shift(),T=o,j=D+d.shift(),M=T+d.shift(),v=j+d.shift(),f.curveTo(r,i,a,o,A,O),f.curveTo(D,T,j,M,v,g);break;case 37:r=v+d.shift(),i=g+d.shift(),a=r+d.shift(),o=i+d.shift(),A=a+d.shift(),O=o+d.shift(),D=A+d.shift(),T=O+d.shift(),j=D+d.shift(),M=T+d.shift(),Math.abs(j-v)>Math.abs(M-g)?v=j+d.shift():g=M+d.shift(),f.curveTo(r,i,a,o,A,O),f.curveTo(D,T,j,M,v,g);break;default:console.log("Glyph "+t.index+": unknown operator 1200"+I),d.length=0}break;case 14:0<d.length&&!p&&(x=d.shift()+l,p=!0),m&&(f.closePath(),m=!1);break;case 19:case 20:_(),F+=h+7>>3;break;case 21:2<d.length&&!p&&(x=d.shift()+l,p=!0),g+=d.pop(),w(v+=d.pop(),g);break;case 22:1<d.length&&!p&&(x=d.shift()+l,p=!0),w(v+=d.pop(),g);break;case 24:for(;2<d.length;)r=v+d.shift(),i=g+d.shift(),a=r+d.shift(),o=i+d.shift(),v=a+d.shift(),g=o+d.shift(),f.curveTo(r,i,a,o,v,g);v+=d.shift(),g+=d.shift(),f.lineTo(v,g);break;case 25:for(;6<d.length;)v+=d.shift(),g+=d.shift(),f.lineTo(v,g);r=v+d.shift(),i=g+d.shift(),a=r+d.shift(),o=i+d.shift(),v=a+d.shift(),g=o+d.shift(),f.curveTo(r,i,a,o,v,g);break;case 26:for(d.length%2&&(v+=d.shift());0<d.length;)r=v,i=g+d.shift(),a=r+d.shift(),o=i+d.shift(),v=a,g=o+d.shift(),f.curveTo(r,i,a,o,v,g);break;case 27:for(d.length%2&&(g+=d.shift());0<d.length;)r=v+d.shift(),i=g,a=r+d.shift(),o=i+d.shift(),v=a+d.shift(),g=o,f.curveTo(r,i,a,o,v,g);break;case 28:y=c[F],b=c[F+1],d.push((y<<24|b<<16)>>16),F+=2;break;case 29:S=d.pop()+e.gsubrsBias,(C=e.gsubrs[S])&&n(C);break;case 30:for(;0<d.length&&(r=v,i=g+d.shift(),a=r+d.shift(),o=i+d.shift(),v=a+d.shift(),g=o+(1===d.length?d.shift():0),f.curveTo(r,i,a,o,v,g),0!==d.length);)r=v+d.shift(),i=g,a=r+d.shift(),o=i+d.shift(),g=o+d.shift(),v=a+(1===d.length?d.shift():0),f.curveTo(r,i,a,o,v,g);break;case 31:for(;0<d.length&&(r=v+d.shift(),i=g,a=r+d.shift(),o=i+d.shift(),g=o+d.shift(),v=a+(1===d.length?d.shift():0),f.curveTo(r,i,a,o,v,g),0!==d.length);)r=v,i=g+d.shift(),a=r+d.shift(),o=i+d.shift(),v=a+d.shift(),g=o+(1===d.length?d.shift():0),f.curveTo(r,i,a,o,v,g);break;default:I<32?console.log("Glyph "+t.index+": unknown operator "+I):I<247?d.push(I-139):I<251?(y=c[F],F+=1,d.push(256*(I-247)+y+108)):I<255?(y=c[F],F+=1,d.push(256*-(I-251)-y-108)):(y=c[F],b=c[F+1],k=c[F+2],E=c[F+3],F+=4,d.push((y<<24|b<<16|k<<8|E)/65536))}}}(n),t.advanceWidth=x,f}function Fe(e,t){var n,r=ue.indexOf(e);return 0<=r&&(n=r),0<=(r=t.indexOf(e))?n=r+ue.length:(n=ue.length+t.length,t.push(e)),n}function Ie(e,t,n){for(var r={},i=0;i<e.length;i+=1){var a=e[i],o=t[a.name];void 0===o||we(o,a.value)||("SID"===a.type&&(o=Fe(o,n)),r[a.op]={name:a.name,type:a.type,value:o})}return r}function Ne(e,t){var n=new J.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return n.dict=Ie(Oe,e,t),n}function Re(e){var t=new J.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return t.topDicts=[{name:"topDict_0",type:"TABLE",value:e}],t}function Pe(e){var t=[],n=e.path;t.push({name:"width",type:"NUMBER",value:e.advanceWidth});for(var r=0,i=0,a=0;a<n.commands.length;a+=1){var o=void 0,s=void 0,u=n.commands[a];if("Q"===u.type&&(u={type:"C",x:u.x,y:u.y,x1:1/3*r+2/3*u.x1,y1:1/3*i+2/3*u.y1,x2:1/3*u.x+2/3*u.x1,y2:1/3*u.y+2/3*u.y1}),"M"===u.type)o=Math.round(u.x-r),s=Math.round(u.y-i),t.push({name:"dx",type:"NUMBER",value:o}),t.push({name:"dy",type:"NUMBER",value:s}),t.push({name:"rmoveto",type:"OP",value:21}),r=Math.round(u.x),i=Math.round(u.y);else if("L"===u.type)o=Math.round(u.x-r),s=Math.round(u.y-i),t.push({name:"dx",type:"NUMBER",value:o}),t.push({name:"dy",type:"NUMBER",value:s}),t.push({name:"rlineto",type:"OP",value:5}),r=Math.round(u.x),i=Math.round(u.y);else if("C"===u.type){var c=Math.round(u.x1-r),l=Math.round(u.y1-i),f=Math.round(u.x2-u.x1),d=Math.round(u.y2-u.y1);o=Math.round(u.x-u.x2),s=Math.round(u.y-u.y2),t.push({name:"dx1",type:"NUMBER",value:c}),t.push({name:"dy1",type:"NUMBER",value:l}),t.push({name:"dx2",type:"NUMBER",value:f}),t.push({name:"dy2",type:"NUMBER",value:d}),t.push({name:"dx",type:"NUMBER",value:o}),t.push({name:"dy",type:"NUMBER",value:s}),t.push({name:"rrcurveto",type:"OP",value:8}),r=Math.round(u.x),i=Math.round(u.y)}}return t.push({name:"endchar",type:"OP",value:14}),t}var Be=function(e,t,n){n.tables.cff={};var r,i,a,o=ke(e,(r=e,i=t,(a={}).formatMajor=ae.getCard8(r,i),a.formatMinor=ae.getCard8(r,i+1),a.size=ae.getCard8(r,i+2),a.offsetSize=ae.getCard8(r,i+3),a.startOffset=i,a.endOffset=i+4,a).endOffset,ae.bytesToString),s=ke(e,o.endOffset),u=ke(e,s.endOffset,ae.bytesToString),c=ke(e,u.endOffset);n.gsubrs=c.objects,n.gsubrsBias=_e(n.gsubrs);var l=je(e,t,s.objects,u.objects);if(1!==l.length)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+l.length);var f=l[0];if((n.tables.cff.topDict=f)._privateDict&&(n.defaultWidthX=f._privateDict.defaultWidthX,n.nominalWidthX=f._privateDict.nominalWidthX),void 0!==f.ros[0]&&void 0!==f.ros[1]&&(n.isCIDFont=!0),n.isCIDFont){var d=f.fdArray,h=f.fdSelect;if(0===d||0===h)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");var p=je(e,t,ke(e,d+=t).objects,u.objects);f._fdArray=p,h+=t,f._fdSelect=function(e,t,n,r){var i,a=[],o=new ae.Parser(e,t),s=o.parseCard8();if(0===s)for(var u=0;u<n;u++){if(r<=(i=o.parseCard8()))throw new Error("CFF table CID Font FDSelect has bad FD index value "+i+" (FD count "+r+")");a.push(i)}else{if(3!==s)throw new Error("CFF Table CID Font FDSelect table has unsupported format "+s);var c,l=o.parseCard16(),f=o.parseCard16();if(0!==f)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+f);for(var d=0;d<l;d++){if(i=o.parseCard8(),c=o.parseCard16(),r<=i)throw new Error("CFF table CID Font FDSelect has bad FD index value "+i+" (FD count "+r+")");if(n<c)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+c);for(;f<c;f++)a.push(i);f=c}if(c!==n)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+c)}return a}(e,h,n.numGlyphs,p.length)}var m=t+f.private[1],v=Te(e,m,f.private[0],u.objects);if(n.defaultWidthX=v.defaultWidthX,n.nominalWidthX=v.nominalWidthX,0!==v.subrs){var g=ke(e,m+v.subrs);n.subrs=g.objects,n.subrsBias=_e(n.subrs)}else n.subrs=[],n.subrsBias=0;var y=ke(e,t+f.charStrings);n.nGlyphs=y.objects.length;var b=function(e,t,n,r){var i,a,o=new ae.Parser(e,t);--n;var s=[".notdef"],u=o.parseCard8();if(0===u)for(var c=0;c<n;c+=1)i=o.parseSID(),s.push(Ce(r,i));else if(1===u)for(;s.length<=n;){i=o.parseSID(),a=o.parseCard8();for(var l=0;l<=a;l+=1)s.push(Ce(r,i)),i+=1}else{if(2!==u)throw new Error("Unknown charset format "+u);for(;s.length<=n;){i=o.parseSID(),a=o.parseCard16();for(var f=0;f<=a;f+=1)s.push(Ce(r,i)),i+=1}}return s}(e,t+f.charset,n.nGlyphs,u.objects);0===f.encoding?n.cffEncoding=new pe(ce,b):1===f.encoding?n.cffEncoding=new pe(le,b):n.cffEncoding=function(e,t,n){var r,i={},a=new ae.Parser(e,t),o=a.parseCard8();if(0===o)for(var s=a.parseCard8(),u=0;u<s;u+=1)i[r=a.parseCard8()]=u;else{if(1!==o)throw new Error("Unknown encoding format "+o);var c=a.parseCard8();r=1;for(var l=0;l<c;l+=1)for(var f=a.parseCard8(),d=a.parseCard8(),h=f;h<=f+d;h+=1)i[h]=r,r+=1}return new pe(i,n)}(e,t+f.encoding,b),n.encoding=n.encoding||n.cffEncoding,n.glyphs=new xe.GlyphSet(n);for(var x=0;x<n.nGlyphs;x+=1){var w=y.objects[x];n.glyphs.push(x,xe.cffGlyphLoader(n,x,Me,w))}},Le=function(e,t){for(var n,r=new J.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),i=1/t.unitsPerEm,a={version:t.version,fullName:t.fullName,familyName:t.familyName,weight:t.weightName,fontBBox:t.fontBBox||[0,0,0,0],fontMatrix:[i,0,0,i,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},o=[],s=1;s<e.length;s+=1)n=e.get(s),o.push(n.name);var u=[];r.header=new J.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}]),r.nameIndex=function(e){var t=new J.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);t.names=[];for(var n=0;n<e.length;n+=1)t.names.push({name:"name_"+n,type:"NAME",value:e[n]});return t}([t.postScriptName]);var c,l,f,d=Ne(a,u);r.topDictIndex=Re(d),r.globalSubrIndex=new J.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}]),r.charsets=function(e,t){for(var n=new J.Record("Charsets",[{name:"format",type:"Card8",value:0}]),r=0;r<e.length;r+=1){var i=Fe(e[r],t);n.fields.push({name:"glyph_"+r,type:"SID",value:i})}return n}(o,u),r.charStringsIndex=function(e){for(var t=new J.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),n=0;n<e.length;n+=1){var r=e.get(n),i=Pe(r);t.charStrings.push({name:r.name,type:"CHARSTRING",value:i})}return t}(e),r.privateDict=(c={},l=u,(f=new J.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}])).dict=Ie(De,c,l),f),r.stringIndex=function(e){var t=new J.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);t.strings=[];for(var n=0;n<e.length;n+=1)t.strings.push({name:"string_"+n,type:"STRING",value:e[n]});return t}(u);var h=r.header.sizeOf()+r.nameIndex.sizeOf()+r.topDictIndex.sizeOf()+r.stringIndex.sizeOf()+r.globalSubrIndex.sizeOf();return a.charset=h,a.encoding=0,a.charStrings=a.charset+r.charsets.sizeOf(),a.private[1]=a.charStrings+r.charStringsIndex.sizeOf(),d=Ne(a,u),r.topDictIndex=Re(d),r},ze=function(e,t){var n={},r=new ae.Parser(e,t);return n.version=r.parseVersion(),n.fontRevision=Math.round(1e3*r.parseFixed())/1e3,n.checkSumAdjustment=r.parseULong(),n.magicNumber=r.parseULong(),T.argument(1594834165===n.magicNumber,"Font header has wrong magic number."),n.flags=r.parseUShort(),n.unitsPerEm=r.parseUShort(),n.created=r.parseLongDateTime(),n.modified=r.parseLongDateTime(),n.xMin=r.parseShort(),n.yMin=r.parseShort(),n.xMax=r.parseShort(),n.yMax=r.parseShort(),n.macStyle=r.parseUShort(),n.lowestRecPPEM=r.parseUShort(),n.fontDirectionHint=r.parseShort(),n.indexToLocFormat=r.parseShort(),n.glyphDataFormat=r.parseShort(),n},Ue=function(e){var t=Math.round((new Date).getTime()/1e3)+2082844800,n=t;return e.createdTimestamp&&(n=e.createdTimestamp+2082844800),new J.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:n},{name:"modified",type:"LONGDATETIME",value:t},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],e)},We=function(e,t){var n={},r=new ae.Parser(e,t);return n.version=r.parseVersion(),n.ascender=r.parseShort(),n.descender=r.parseShort(),n.lineGap=r.parseShort(),n.advanceWidthMax=r.parseUShort(),n.minLeftSideBearing=r.parseShort(),n.minRightSideBearing=r.parseShort(),n.xMaxExtent=r.parseShort(),n.caretSlopeRise=r.parseShort(),n.caretSlopeRun=r.parseShort(),n.caretOffset=r.parseShort(),r.relativeOffset+=8,n.metricDataFormat=r.parseShort(),n.numberOfHMetrics=r.parseUShort(),n},Ve=function(e){return new J.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],e)},Ge=function(e,t,n,r,i){for(var a,o,s=new ae.Parser(e,t),u=0;u<r;u+=1){u<n&&(a=s.parseUShort(),o=s.parseShort());var c=i.get(u);c.advanceWidth=a,c.leftSideBearing=o}},qe=function(e){for(var t=new J.Table("hmtx",[]),n=0;n<e.length;n+=1){var r=e.get(n),i=r.advanceWidth||0,a=r.leftSideBearing||0;t.fields.push({name:"advanceWidth_"+n,type:"USHORT",value:i}),t.fields.push({name:"leftSideBearing_"+n,type:"SHORT",value:a})}return t},He=function(e){for(var t=new J.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:e.length}]),n="",r=12+4*e.length,i=0;i<e.length;++i){var a=n.indexOf(e[i]);a<0&&(a=n.length,n+=e[i]),t.fields.push({name:"offset "+i,type:"USHORT",value:r+a}),t.fields.push({name:"length "+i,type:"USHORT",value:e[i].length})}return t.fields.push({name:"stringPool",type:"CHARARRAY",value:n}),t},Xe=function(e,t){var n=new ae.Parser(e,t),r=n.parseULong();T.argument(1===r,"Unsupported ltag table version."),n.skip("uLong",1);for(var i=n.parseULong(),a=[],o=0;o<i;o++){for(var s="",u=t+n.parseUShort(),c=n.parseUShort(),l=u;l<u+c;++l)s+=String.fromCharCode(e.getInt8(l));a.push(s)}return a},Ke=function(e,t){var n={},r=new ae.Parser(e,t);return n.version=r.parseVersion(),n.numGlyphs=r.parseUShort(),1===n.version&&(n.maxPoints=r.parseUShort(),n.maxContours=r.parseUShort(),n.maxCompositePoints=r.parseUShort(),n.maxCompositeContours=r.parseUShort(),n.maxZones=r.parseUShort(),n.maxTwilightPoints=r.parseUShort(),n.maxStorage=r.parseUShort(),n.maxFunctionDefs=r.parseUShort(),n.maxInstructionDefs=r.parseUShort(),n.maxStackElements=r.parseUShort(),n.maxSizeOfInstructions=r.parseUShort(),n.maxComponentElements=r.parseUShort(),n.maxComponentDepth=r.parseUShort()),n},Ye=function(e){return new J.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:e}])},$e=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],Je={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},Ze={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},Qe={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function et(e,t,n){switch(e){case 0:if(65535===t)return"und";if(n)return n[t];break;case 1:return Je[t];case 3:return Qe[t]}}var tt="utf-16",nt={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},rt={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function it(e,t,n){switch(e){case 0:return tt;case 1:return rt[n]||nt[t];case 3:if(1===t||10===t)return tt}}function at(e){var t={};for(var n in e)t[e[n]]=parseInt(n);return t}function ot(e,t,n,r,i,a){return new J.Record("NameRecord",[{name:"platformID",type:"USHORT",value:e},{name:"encodingID",type:"USHORT",value:t},{name:"languageID",type:"USHORT",value:n},{name:"nameID",type:"USHORT",value:r},{name:"length",type:"USHORT",value:i},{name:"offset",type:"USHORT",value:a}])}function st(e,t){var n=function(e,t){var n=e.length,r=t.length-n+1;e:for(var i=0;i<r;i++)for(;i<r;i++){for(var a=0;a<n;a++)if(t[i+a]!==e[a])continue e;return i}return-1}(e,t);if(n<0){n=t.length;for(var r=0,i=e.length;r<i;++r)t.push(e[r])}return n}var ut=function(e,t,n){for(var r={},i=new ae.Parser(e,t),a=i.parseUShort(),o=i.parseUShort(),s=i.offset+i.parseUShort(),u=0;u<o;u++){var c,l=i.parseUShort(),f=i.parseUShort(),d=i.parseUShort(),h=i.parseUShort(),p=$e[h]||h,m=i.parseUShort(),v=i.parseUShort(),g=et(l,d,n),y=it(l,f,d);if(void 0!==y&&void 0!==g&&(c=y===tt?j.UTF16(e,s+v,m):j.MACSTRING(e,s+v,m,y))){var b=r[p];void 0===b&&(b=r[p]={}),b[g]=c}}return 1===a&&i.parseUShort(),r},ct=function(e,t){var n,r=[],i={},a=at($e);for(var o in e){var s=a[o];if(void 0===s&&(s=o),n=parseInt(s),isNaN(n))throw new Error('Name table entry "'+o+'" does not exist, see nameTableNames for complete list.');i[n]=e[o],r.push(n)}for(var u=at(Je),c=at(Qe),l=[],f=[],d=0;d<r.length;d++){var h=i[n=r[d]];for(var p in h){var m=h[p],v=1,g=u[p],y=Ze[g],b=it(v,y,g),x=M.MACSTRING(m,b);void 0===x&&(v=0,(g=t.indexOf(p))<0&&(g=t.length,t.push(p)),y=4,x=M.UTF16(m));var w=st(x,f);l.push(ot(v,y,g,n,x.length,w));var _=c[p];if(void 0!==_){var k=M.UTF16(m),E=st(k,f);l.push(ot(3,1,_,n,k.length,E))}}}l.sort((function(e,t){return e.platformID-t.platformID||e.encodingID-t.encodingID||e.languageID-t.languageID||e.nameID-t.nameID}));for(var S=new J.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:l.length},{name:"stringOffset",type:"USHORT",value:6+12*l.length}]),C=0;C<l.length;C++)S.fields.push({name:"record_"+C,type:"RECORD",value:l[C]});return S.fields.push({name:"strings",type:"LITERAL",value:f}),S},lt=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}],ft=function(e,t){var n={},r=new ae.Parser(e,t);n.version=r.parseUShort(),n.xAvgCharWidth=r.parseShort(),n.usWeightClass=r.parseUShort(),n.usWidthClass=r.parseUShort(),n.fsType=r.parseUShort(),n.ySubscriptXSize=r.parseShort(),n.ySubscriptYSize=r.parseShort(),n.ySubscriptXOffset=r.parseShort(),n.ySubscriptYOffset=r.parseShort(),n.ySuperscriptXSize=r.parseShort(),n.ySuperscriptYSize=r.parseShort(),n.ySuperscriptXOffset=r.parseShort(),n.ySuperscriptYOffset=r.parseShort(),n.yStrikeoutSize=r.parseShort(),n.yStrikeoutPosition=r.parseShort(),n.sFamilyClass=r.parseShort(),n.panose=[];for(var i=0;i<10;i++)n.panose[i]=r.parseByte();return n.ulUnicodeRange1=r.parseULong(),n.ulUnicodeRange2=r.parseULong(),n.ulUnicodeRange3=r.parseULong(),n.ulUnicodeRange4=r.parseULong(),n.achVendID=String.fromCharCode(r.parseByte(),r.parseByte(),r.parseByte(),r.parseByte()),n.fsSelection=r.parseUShort(),n.usFirstCharIndex=r.parseUShort(),n.usLastCharIndex=r.parseUShort(),n.sTypoAscender=r.parseShort(),n.sTypoDescender=r.parseShort(),n.sTypoLineGap=r.parseShort(),n.usWinAscent=r.parseUShort(),n.usWinDescent=r.parseUShort(),1<=n.version&&(n.ulCodePageRange1=r.parseULong(),n.ulCodePageRange2=r.parseULong()),2<=n.version&&(n.sxHeight=r.parseShort(),n.sCapHeight=r.parseShort(),n.usDefaultChar=r.parseUShort(),n.usBreakChar=r.parseUShort(),n.usMaxContent=r.parseUShort()),n},dt=function(e){return new J.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],e)},ht=function(e){for(var t=0;t<lt.length;t+=1){var n=lt[t];if(e>=n.begin&&e<n.end)return t}return-1},pt=function(e,t){var n={},r=new ae.Parser(e,t);switch(n.version=r.parseVersion(),n.italicAngle=r.parseFixed(),n.underlinePosition=r.parseShort(),n.underlineThickness=r.parseShort(),n.isFixedPitch=r.parseULong(),n.minMemType42=r.parseULong(),n.maxMemType42=r.parseULong(),n.minMemType1=r.parseULong(),n.maxMemType1=r.parseULong(),n.version){case 1:n.names=fe.slice();break;case 2:n.numberOfGlyphs=r.parseUShort(),n.glyphNameIndex=new Array(n.numberOfGlyphs);for(var i=0;i<n.numberOfGlyphs;i++)n.glyphNameIndex[i]=r.parseUShort();n.names=[];for(var a=0;a<n.numberOfGlyphs;a++)if(n.glyphNameIndex[a]>=fe.length){var o=r.parseChar();n.names.push(r.parseString(o))}break;case 2.5:n.numberOfGlyphs=r.parseUShort(),n.offset=new Array(n.numberOfGlyphs);for(var s=0;s<n.numberOfGlyphs;s++)n.offset[s]=r.parseChar()}return n},mt=function(){return new J.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])},vt=new Array(9);vt[1]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();return 1===t?{substFormat:1,coverage:this.parsePointer(re.coverage),deltaGlyphId:this.parseUShort()}:2===t?{substFormat:2,coverage:this.parsePointer(re.coverage),substitute:this.parseOffset16List()}:void T.assert(!1,"0x"+e.toString(16)+": lookup type 1 format must be 1 or 2.")},vt[2]=function(){var e=this.parseUShort();return T.argument(1===e,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(re.coverage),sequences:this.parseListOfLists()}},vt[3]=function(){var e=this.parseUShort();return T.argument(1===e,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(re.coverage),alternateSets:this.parseListOfLists()}},vt[4]=function(){var e=this.parseUShort();return T.argument(1===e,"GSUB ligature table identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(re.coverage),ligatureSets:this.parseListOfLists((function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}}))}};var gt={sequenceIndex:re.uShort,lookupListIndex:re.uShort};vt[5]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();if(1===t)return{substFormat:t,coverage:this.parsePointer(re.coverage),ruleSets:this.parseListOfLists((function(){var e=this.parseUShort(),t=this.parseUShort();return{input:this.parseUShortList(e-1),lookupRecords:this.parseRecordList(t,gt)}}))};if(2===t)return{substFormat:t,coverage:this.parsePointer(re.coverage),classDef:this.parsePointer(re.classDef),classSets:this.parseListOfLists((function(){var e=this.parseUShort(),t=this.parseUShort();return{classes:this.parseUShortList(e-1),lookupRecords:this.parseRecordList(t,gt)}}))};if(3===t){var n=this.parseUShort(),r=this.parseUShort();return{substFormat:t,coverages:this.parseList(n,re.pointer(re.coverage)),lookupRecords:this.parseRecordList(r,gt)}}T.assert(!1,"0x"+e.toString(16)+": lookup type 5 format must be 1, 2 or 3.")},vt[6]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();return 1===t?{substFormat:1,coverage:this.parsePointer(re.coverage),chainRuleSets:this.parseListOfLists((function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(gt)}}))}:2===t?{substFormat:2,coverage:this.parsePointer(re.coverage),backtrackClassDef:this.parsePointer(re.classDef),inputClassDef:this.parsePointer(re.classDef),lookaheadClassDef:this.parsePointer(re.classDef),chainClassSet:this.parseListOfLists((function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(gt)}}))}:3===t?{substFormat:3,backtrackCoverage:this.parseList(re.pointer(re.coverage)),inputCoverage:this.parseList(re.pointer(re.coverage)),lookaheadCoverage:this.parseList(re.pointer(re.coverage)),lookupRecords:this.parseRecordList(gt)}:void T.assert(!1,"0x"+e.toString(16)+": lookup type 6 format must be 1, 2 or 3.")},vt[7]=function(){var e=this.parseUShort();T.argument(1===e,"GSUB Extension Substitution subtable identifier-format must be 1");var t=this.parseUShort(),n=new re(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:t,extension:vt[t].call(n)}},vt[8]=function(){var e=this.parseUShort();return T.argument(1===e,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(re.coverage),backtrackCoverage:this.parseList(re.pointer(re.coverage)),lookaheadCoverage:this.parseList(re.pointer(re.coverage)),substitutes:this.parseUShortList()}};var yt=new Array(9);yt[1]=function(e){return 1===e.substFormat?new J.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new J.Coverage(e.coverage)},{name:"deltaGlyphID",type:"USHORT",value:e.deltaGlyphId}]):new J.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new J.Coverage(e.coverage)}].concat(J.ushortList("substitute",e.substitute)))},yt[3]=function(e){return T.assert(1===e.substFormat,"Lookup type 3 substFormat must be 1."),new J.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new J.Coverage(e.coverage)}].concat(J.tableList("altSet",e.alternateSets,(function(e){return new J.Table("alternateSetTable",J.ushortList("alternate",e))}))))},yt[4]=function(e){return T.assert(1===e.substFormat,"Lookup type 4 substFormat must be 1."),new J.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new J.Coverage(e.coverage)}].concat(J.tableList("ligSet",e.ligatureSets,(function(e){return new J.Table("ligatureSetTable",J.tableList("ligature",e,(function(e){return new J.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:e.ligGlyph}].concat(J.ushortList("component",e.components,e.components.length+1)))})))}))))};var bt=function(e,t){var n=new re(e,t=t||0),r=n.parseVersion(1);return T.argument(1===r||1.1===r,"Unsupported GSUB table version."),1===r?{version:r,scripts:n.parseScriptList(),features:n.parseFeatureList(),lookups:n.parseLookupList(vt)}:{version:r,scripts:n.parseScriptList(),features:n.parseFeatureList(),lookups:n.parseLookupList(vt),variations:n.parseFeatureVariationsList()}},xt=function(e){return new J.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new J.ScriptList(e.scripts)},{name:"features",type:"TABLE",value:new J.FeatureList(e.features)},{name:"lookups",type:"TABLE",value:new J.LookupList(e.lookups,yt)}])},wt=function(e,t){var n=new ae.Parser(e,t),r=n.parseULong();T.argument(1===r,"Unsupported META table version."),n.parseULong(),n.parseULong();for(var i=n.parseULong(),a={},o=0;o<i;o++){var s=n.parseTag(),u=n.parseULong(),c=n.parseULong(),l=j.UTF8(e,t+u,c);a[s]=l}return a},_t=function(e){var t=Object.keys(e).length,n="",r=16+12*t,i=new J.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:r},{name:"numTags",type:"ULONG",value:t}]);for(var a in e){var o=n.length;n+=e[a],i.fields.push({name:"tag "+a,type:"TAG",value:a}),i.fields.push({name:"offset "+a,type:"ULONG",value:r+o}),i.fields.push({name:"length "+a,type:"ULONG",value:e[a].length})}return i.fields.push({name:"stringPool",type:"CHARARRAY",value:n}),i};function kt(e){return Math.log(e)/Math.log(2)|0}function Et(e){for(;e.length%4!=0;)e.push(0);for(var t=0,n=0;n<e.length;n+=4)t+=(e[n]<<24)+(e[n+1]<<16)+(e[n+2]<<8)+e[n+3];return t%Math.pow(2,32)}function St(e,t,n,r){return new J.Record("Table Record",[{name:"tag",type:"TAG",value:void 0!==e?e:""},{name:"checkSum",type:"ULONG",value:void 0!==t?t:0},{name:"offset",type:"ULONG",value:void 0!==n?n:0},{name:"length",type:"ULONG",value:void 0!==r?r:0}])}function Ct(e){var t=new J.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);t.tables=e,t.numTables=e.length;var n=Math.pow(2,kt(t.numTables));t.searchRange=16*n,t.entrySelector=kt(n),t.rangeShift=16*t.numTables-t.searchRange;for(var r=[],i=[],a=t.sizeOf()+St().sizeOf()*t.numTables;a%4!=0;)a+=1,i.push({name:"padding",type:"BYTE",value:0});for(var o=0;o<e.length;o+=1){var s=e[o];T.argument(4===s.tableName.length,"Table name"+s.tableName+" is invalid.");var u=s.sizeOf(),c=St(s.tableName,Et(s.encode()),a,u);for(r.push({name:c.tag+" Table Record",type:"RECORD",value:c}),i.push({name:s.tableName+" table",type:"RECORD",value:s}),a+=u,T.argument(!isNaN(a),"Something went wrong calculating the offset.");a%4!=0;)a+=1,i.push({name:"padding",type:"BYTE",value:0})}return r.sort((function(e,t){return e.value.tag>t.value.tag?1:-1})),t.fields=t.fields.concat(r),t.fields=t.fields.concat(i),t}function At(e,t,n){for(var r=0;r<t.length;r+=1){var i=e.charToGlyphIndex(t[r]);if(0<i)return e.glyphs.get(i).getMetrics()}return n}var Ot=function(e){for(var t,n=[],r=[],i=[],a=[],o=[],s=[],u=[],c=0,l=0,f=0,d=0,h=0,p=0;p<e.glyphs.length;p+=1){var m=e.glyphs.get(p),v=0|m.unicode;if(isNaN(m.advanceWidth))throw new Error("Glyph "+m.name+" ("+p+"): advanceWidth is not a number.");(v<t||void 0===t)&&0<v&&(t=v),c<v&&(c=v);var g=ht(v);if(g<32)l|=1<<g;else if(g<64)f|=1<<g-32;else if(g<96)d|=1<<g-64;else{if(!(g<123))throw new Error("Unicode ranges bits > 123 are reserved for internal usage");h|=1<<g-96}if(".notdef"!==m.name){var y=m.getMetrics();n.push(y.xMin),r.push(y.yMin),i.push(y.xMax),a.push(y.yMax),s.push(y.leftSideBearing),u.push(y.rightSideBearing),o.push(m.advanceWidth)}}var b={xMin:Math.min.apply(null,n),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,i),yMax:Math.max.apply(null,a),advanceWidthMax:Math.max.apply(null,o),advanceWidthAvg:function(e){for(var t=0,n=0;n<e.length;n+=1)t+=e[n];return t/e.length}(o),minLeftSideBearing:Math.min.apply(null,s),maxLeftSideBearing:Math.max.apply(null,s),minRightSideBearing:Math.min.apply(null,u)};b.ascender=e.ascender,b.descender=e.descender;var x=Ue({flags:3,unitsPerEm:e.unitsPerEm,xMin:b.xMin,yMin:b.yMin,xMax:b.xMax,yMax:b.yMax,lowestRecPPEM:3,createdTimestamp:e.createdTimestamp}),w=Ve({ascender:b.ascender,descender:b.descender,advanceWidthMax:b.advanceWidthMax,minLeftSideBearing:b.minLeftSideBearing,minRightSideBearing:b.minRightSideBearing,xMaxExtent:b.maxLeftSideBearing+(b.xMax-b.xMin),numberOfHMetrics:e.glyphs.length}),_=Ye(e.glyphs.length),k=dt({xAvgCharWidth:Math.round(b.advanceWidthAvg),usWeightClass:e.tables.os2.usWeightClass,usWidthClass:e.tables.os2.usWidthClass,usFirstCharIndex:t,usLastCharIndex:c,ulUnicodeRange1:l,ulUnicodeRange2:f,ulUnicodeRange3:d,ulUnicodeRange4:h,fsSelection:e.tables.os2.fsSelection,sTypoAscender:b.ascender,sTypoDescender:b.descender,sTypoLineGap:0,usWinAscent:b.yMax,usWinDescent:Math.abs(b.yMin),ulCodePageRange1:1,sxHeight:At(e,"xyvw",{yMax:Math.round(b.ascender/2)}).yMax,sCapHeight:At(e,"HIKLEFJMNTZBDPRAGOQSUVWXY",b).yMax,usDefaultChar:e.hasChar(" ")?32:0,usBreakChar:e.hasChar(" ")?32:0}),E=qe(e.glyphs),S=se(e.glyphs),C=e.getEnglishName("fontFamily"),A=e.getEnglishName("fontSubfamily"),O=C+" "+A,D=e.getEnglishName("postScriptName");D=D||C.replace(/\s/g,"")+"-"+A;var T={};for(var j in e.names)T[j]=e.names[j];T.uniqueID||(T.uniqueID={en:e.getEnglishName("manufacturer")+":"+O}),T.postScriptName||(T.postScriptName={en:D}),T.preferredFamily||(T.preferredFamily=e.names.fontFamily),T.preferredSubfamily||(T.preferredSubfamily=e.names.fontSubfamily);var M=[],F=ct(T,M),I=0<M.length?He(M):void 0,N=mt(),R=Le(e.glyphs,{version:e.getEnglishName("version"),fullName:O,familyName:C,weightName:A,postScriptName:D,unitsPerEm:e.unitsPerEm,fontBBox:[0,b.yMin,b.ascender,b.advanceWidthMax]}),P=e.metas&&0<Object.keys(e.metas).length?_t(e.metas):void 0,B=[x,w,_,k,F,S,N,R,E];I&&B.push(I),e.tables.gsub&&B.push(xt(e.tables.gsub)),P&&B.push(P);for(var L=Ct(B),z=Et(L.encode()),U=L.fields,W=!1,V=0;V<U.length;V+=1)if("head table"===U[V].name){U[V].value.checkSumAdjustment=2981146554-z,W=!0;break}if(!W)throw new Error("Could not find head table with checkSum to adjust.");return L};function Dt(e,t){for(var n=0,r=e.length-1;n<=r;){var i=n+r>>>1,a=e[i].tag;if(a===t)return i;a<t?n=1+i:r=i-1}return-n-1}function Tt(e,t){for(var n=0,r=e.length-1;n<=r;){var i=n+r>>>1,a=e[i];if(a===t)return i;a<t?n=1+i:r=i-1}return-n-1}function jt(e,t){for(var n,r=0,i=e.length-1;r<=i;){var a=r+i>>>1,o=(n=e[a]).start;if(o===t)return n;o<t?r=1+a:i=a-1}if(0<r)return t>(n=e[r-1]).end?0:n}function Mt(e,t){this.font=e,this.tableName=t}function Ft(e){Mt.call(this,e,"gpos")}function It(e){Mt.call(this,e,"gsub")}function Nt(e,t){var n=e.length;if(n!==t.length)return!1;for(var r=0;r<n;r++)if(e[r]!==t[r])return!1;return!0}function Rt(e,t,n){for(var r=e.subtables,i=0;i<r.length;i++){var a=r[i];if(a.substFormat===t)return a}if(n)return r.push(n),n}function Pt(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),r=0;r<e.length;++r)n[r]=e[r];return t}function Bt(e,t){if(!e)throw t}function Lt(e,t,n,r,i){var a;return 0<(t&r)?(a=e.parseByte(),0==(t&i)&&(a=-a),n+a):0<(t&i)?n:n+e.parseShort()}function zt(e,t,n){var r,i,a=new ae.Parser(t,n);if(e.numberOfContours=a.parseShort(),e._xMin=a.parseShort(),e._yMin=a.parseShort(),e._xMax=a.parseShort(),e._yMax=a.parseShort(),0<e.numberOfContours){for(var o=e.endPointIndices=[],s=0;s<e.numberOfContours;s+=1)o.push(a.parseUShort());e.instructionLength=a.parseUShort(),e.instructions=[];for(var u=0;u<e.instructionLength;u+=1)e.instructions.push(a.parseByte());var c=o[o.length-1]+1;r=[];for(var l=0;l<c;l+=1)if(i=a.parseByte(),r.push(i),0<(8&i))for(var f=a.parseByte(),d=0;d<f;d+=1)r.push(i),l+=1;if(T.argument(r.length===c,"Bad flags."),0<o.length){var h,p=[];if(0<c){for(var m=0;m<c;m+=1)i=r[m],(h={}).onCurve=!!(1&i),h.lastPointOfContour=0<=o.indexOf(m),p.push(h);for(var v=0,g=0;g<c;g+=1)i=r[g],(h=p[g]).x=Lt(a,i,v,2,16),v=h.x;for(var y=0,b=0;b<c;b+=1)i=r[b],(h=p[b]).y=Lt(a,i,y,4,32),y=h.y}e.points=p}else e.points=[]}else if(0===e.numberOfContours)e.points=[];else{e.isComposite=!0,e.points=[],e.components=[];for(var x=!0;x;){r=a.parseUShort();var w={glyphIndex:a.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};0<(1&r)?0<(2&r)?(w.dx=a.parseShort(),w.dy=a.parseShort()):w.matchedPoints=[a.parseUShort(),a.parseUShort()]:0<(2&r)?(w.dx=a.parseChar(),w.dy=a.parseChar()):w.matchedPoints=[a.parseByte(),a.parseByte()],0<(8&r)?w.xScale=w.yScale=a.parseF2Dot14():0<(64&r)?(w.xScale=a.parseF2Dot14(),w.yScale=a.parseF2Dot14()):0<(128&r)&&(w.xScale=a.parseF2Dot14(),w.scale01=a.parseF2Dot14(),w.scale10=a.parseF2Dot14(),w.yScale=a.parseF2Dot14()),e.components.push(w),x=!!(32&r)}if(256&r){e.instructionLength=a.parseUShort(),e.instructions=[];for(var _=0;_<e.instructionLength;_+=1)e.instructions.push(a.parseByte())}}}function Ut(e,t){for(var n=[],r=0;r<e.length;r+=1){var i=e[r],a={x:t.xScale*i.x+t.scale01*i.y+t.dx,y:t.scale10*i.x+t.yScale*i.y+t.dy,onCurve:i.onCurve,lastPointOfContour:i.lastPointOfContour};n.push(a)}return n}function Wt(e){var t=new A;if(!e)return t;for(var n=function(e){for(var t=[],n=[],r=0;r<e.length;r+=1){var i=e[r];n.push(i),i.lastPointOfContour&&(t.push(n),n=[])}return T.argument(0===n.length,"There are still points left in the current contour."),t}(e),r=0;r<n.length;++r){var i=n[r],a=null,o=i[i.length-1],s=i[0];if(o.onCurve)t.moveTo(o.x,o.y);else if(s.onCurve)t.moveTo(s.x,s.y);else{var u={x:.5*(o.x+s.x),y:.5*(o.y+s.y)};t.moveTo(u.x,u.y)}for(var c=0;c<i.length;++c)if(a=o,o=s,s=i[(c+1)%i.length],o.onCurve)t.lineTo(o.x,o.y);else{var l=s;a.onCurve||(o.x,a.x,o.y,a.y),s.onCurve||(l={x:.5*(o.x+s.x),y:.5*(o.y+s.y)}),t.quadraticCurveTo(o.x,o.y,l.x,l.y)}t.closePath()}return t}function Vt(e,t){if(t.isComposite)for(var n=0;n<t.components.length;n+=1){var r=t.components[n],i=e.get(r.glyphIndex);if(i.getPath(),i.points){var a=void 0;if(void 0===r.matchedPoints)a=Ut(i.points,r);else{if(r.matchedPoints[0]>t.points.length-1||r.matchedPoints[1]>i.points.length-1)throw Error("Matched points out of range in "+t.name);var o=t.points[r.matchedPoints[0]],s=i.points[r.matchedPoints[1]],u={xScale:r.xScale,scale01:r.scale01,scale10:r.scale10,yScale:r.yScale,dx:0,dy:0};s=Ut([s],u)[0],u.dx=o.x-s.x,u.dy=o.y-s.y,a=Ut(i.points,u)}t.points=t.points.concat(a)}}return Wt(t.points)}(Ft.prototype=Mt.prototype={searchTag:Dt,binSearch:Tt,getTable:function(e){var t=this.font.tables[this.tableName];return!t&&e&&(t=this.font.tables[this.tableName]=this.createDefaultTable()),t},getScriptNames:function(){var e=this.getTable();return e?e.scripts.map((function(e){return e.tag})):[]},getDefaultScriptName:function(){var e=this.getTable();if(e){for(var t=!1,n=0;n<e.scripts.length;n++){var r=e.scripts[n].tag;if("DFLT"===r)return r;"latn"===r&&(t=!0)}return t?"latn":void 0}},getScriptTable:function(e,t){var n=this.getTable(t);if(n){e=e||"DFLT";var r=n.scripts,i=Dt(n.scripts,e);if(0<=i)return r[i].script;if(t){var a={tag:e,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return r.splice(-1-i,0,a),a.script}}},getLangSysTable:function(e,t,n){var r=this.getScriptTable(e,n);if(r){if(!t||"dflt"===t||"DFLT"===t)return r.defaultLangSys;var i=Dt(r.langSysRecords,t);if(0<=i)return r.langSysRecords[i].langSys;if(n){var a={tag:t,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return r.langSysRecords.splice(-1-i,0,a),a.langSys}}},getFeatureTable:function(e,t,n,r){var i=this.getLangSysTable(e,t,r);if(i){for(var a,o=i.featureIndexes,s=this.font.tables[this.tableName].features,u=0;u<o.length;u++)if((a=s[o[u]]).tag===n)return a.feature;if(r){var c=s.length;return T.assert(0===c||n>=s[c-1].tag,"Features must be added in alphabetical order."),a={tag:n,feature:{params:0,lookupListIndexes:[]}},s.push(a),o.push(c),a.feature}}},getLookupTables:function(e,t,n,r,i){var a=this.getFeatureTable(e,t,n,i),o=[];if(a){for(var s,u=a.lookupListIndexes,c=this.font.tables[this.tableName].lookups,l=0;l<u.length;l++)(s=c[u[l]]).lookupType===r&&o.push(s);if(0===o.length&&i){s={lookupType:r,lookupFlag:0,subtables:[],markFilteringSet:void 0};var f=c.length;return c.push(s),u.push(f),[s]}}return o},getGlyphClass:function(e,t){switch(e.format){case 1:return e.startGlyph<=t&&t<e.startGlyph+e.classes.length?e.classes[t-e.startGlyph]:0;case 2:var n=jt(e.ranges,t);return n?n.classId:0}},getCoverageIndex:function(e,t){switch(e.format){case 1:var n=Tt(e.glyphs,t);return 0<=n?n:-1;case 2:var r=jt(e.ranges,t);return r?r.index+t-r.start:-1}},expandCoverage:function(e){if(1===e.format)return e.glyphs;for(var t=[],n=e.ranges,r=0;r<n.length;r++)for(var i=n[r],a=i.start,o=i.end,s=a;s<=o;s++)t.push(s);return t}}).init=function(){var e=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(e)},Ft.prototype.getKerningValue=function(e,t,n){for(var r=0;r<e.length;r++)for(var i=e[r].subtables,a=0;a<i.length;a++){var o=i[a],s=this.getCoverageIndex(o.coverage,t);if(!(s<0))switch(o.posFormat){case 1:for(var u=o.pairSets[s],c=0;c<u.length;c++){var l=u[c];if(l.secondGlyph===n)return l.value1&&l.value1.xAdvance||0}break;case 2:var f=this.getGlyphClass(o.classDef1,t),d=this.getGlyphClass(o.classDef2,n),h=o.classRecords[f][d];return h.value1&&h.value1.xAdvance||0}}return 0},Ft.prototype.getKerningTables=function(e,t){if(this.font.tables.gpos)return this.getLookupTables(e,t,"kern",2)},(It.prototype=Mt.prototype).createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}},It.prototype.getSingle=function(e,t,n){for(var r=[],i=this.getLookupTables(t,n,e,1),a=0;a<i.length;a++)for(var o=i[a].subtables,s=0;s<o.length;s++){var u=o[s],c=this.expandCoverage(u.coverage),l=void 0;if(1===u.substFormat){var f=u.deltaGlyphId;for(l=0;l<c.length;l++){var d=c[l];r.push({sub:d,by:d+f})}}else{var h=u.substitute;for(l=0;l<c.length;l++)r.push({sub:c[l],by:h[l]})}}return r},It.prototype.getAlternates=function(e,t,n){for(var r=[],i=this.getLookupTables(t,n,e,3),a=0;a<i.length;a++)for(var o=i[a].subtables,s=0;s<o.length;s++)for(var u=o[s],c=this.expandCoverage(u.coverage),l=u.alternateSets,f=0;f<c.length;f++)r.push({sub:c[f],by:l[f]});return r},It.prototype.getLigatures=function(e,t,n){for(var r=[],i=this.getLookupTables(t,n,e,4),a=0;a<i.length;a++)for(var o=i[a].subtables,s=0;s<o.length;s++)for(var u=o[s],c=this.expandCoverage(u.coverage),l=u.ligatureSets,f=0;f<c.length;f++)for(var d=c[f],h=l[f],p=0;p<h.length;p++){var m=h[p];r.push({sub:[d].concat(m.components),by:m.ligGlyph})}return r},It.prototype.addSingle=function(e,t,n,r){var i=Rt(this.getLookupTables(n,r,e,1,!0)[0],2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});T.assert(1===i.coverage.format,"Ligature: unable to modify coverage table format "+i.coverage.format);var a=t.sub,o=this.binSearch(i.coverage.glyphs,a);o<0&&(o=-1-o,i.coverage.glyphs.splice(o,0,a),i.substitute.splice(o,0,0)),i.substitute[o]=t.by},It.prototype.addAlternate=function(e,t,n,r){var i=Rt(this.getLookupTables(n,r,e,3,!0)[0],1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});T.assert(1===i.coverage.format,"Ligature: unable to modify coverage table format "+i.coverage.format);var a=t.sub,o=this.binSearch(i.coverage.glyphs,a);o<0&&(o=-1-o,i.coverage.glyphs.splice(o,0,a),i.alternateSets.splice(o,0,0)),i.alternateSets[o]=t.by},It.prototype.addLigature=function(e,t,n,r){var i=this.getLookupTables(n,r,e,4,!0)[0],a=i.subtables[0];a||(a={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},i.subtables[0]=a),T.assert(1===a.coverage.format,"Ligature: unable to modify coverage table format "+a.coverage.format);var o=t.sub[0],s=t.sub.slice(1),u={ligGlyph:t.by,components:s},c=this.binSearch(a.coverage.glyphs,o);if(0<=c){for(var l=a.ligatureSets[c],f=0;f<l.length;f++)if(Nt(l[f].components,s))return;l.push(u)}else c=-1-c,a.coverage.glyphs.splice(c,0,o),a.ligatureSets.splice(c,0,[u])},It.prototype.getFeature=function(e,t,n){if(/ss\d\d/.test(e))return this.getSingle(e,t,n);switch(e){case"aalt":case"salt":return this.getSingle(e,t,n).concat(this.getAlternates(e,t,n));case"dlig":case"liga":case"rlig":return this.getLigatures(e,t,n)}},It.prototype.add=function(e,t,n,r){if(/ss\d\d/.test(e))return this.addSingle(e,t,n,r);switch(e){case"aalt":case"salt":return"number"==typeof t.by?this.addSingle(e,t,n,r):this.addAlternate(e,t,n,r);case"dlig":case"liga":case"rlig":return this.addLigature(e,t,n,r)}};var Gt,qt,Ht,Xt,Kt={getPath:Wt,parse:function(e,t,n,r){for(var i=new xe.GlyphSet(r),a=0;a<n.length-1;a+=1){var o=n[a];o!==n[a+1]?i.push(a,xe.ttfGlyphLoader(r,a,zt,e,t+o,Vt)):i.push(a,xe.glyphLoader(r,a))}return i}};function Yt(e){this.font=e,this.getCommands=function(e){return Kt.getPath(e).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function $t(e){return e}function Jt(e){return Math.sign(e)*Math.round(Math.abs(e))}function Zt(e){return Math.sign(e)*Math.round(Math.abs(2*e))/2}function Qt(e){return Math.sign(e)*(Math.round(Math.abs(e)+.5)-.5)}function en(e){return Math.sign(e)*Math.ceil(Math.abs(e))}function tn(e){return Math.sign(e)*Math.floor(Math.abs(e))}function nn(e){var t=this.srPeriod,n=this.srPhase,r=1;return e<0&&(e=-e,r=-1),e+=this.srThreshold-n,e=Math.trunc(e/t)*t,(e+=n)<0?n*r:e*r}var rn={x:1,y:0,axis:"x",distance:function(e,t,n,r){return(n?e.xo:e.x)-(r?t.xo:t.x)},interpolate:function(e,t,n,r){var i,a,o,s,u,c,l;if(!r||r===this)return i=e.xo-t.xo,a=e.xo-n.xo,u=t.x-t.xo,c=n.x-n.xo,0===(l=(o=Math.abs(i))+(s=Math.abs(a)))?void(e.x=e.xo+(u+c)/2):void(e.x=e.xo+(u*s+c*o)/l);i=r.distance(e,t,!0,!0),a=r.distance(e,n,!0,!0),u=r.distance(t,t,!1,!0),c=r.distance(n,n,!1,!0),0!==(l=(o=Math.abs(i))+(s=Math.abs(a)))?rn.setRelative(e,e,(u*s+c*o)/l,r,!0):rn.setRelative(e,e,(u+c)/2,r,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(e,t,n,r,i){if(r&&r!==this){var a=i?t.xo:t.x,o=i?t.yo:t.y,s=a+n*r.x,u=o+n*r.y;e.x=s+(e.y-u)/r.normalSlope}else e.x=(i?t.xo:t.x)+n},slope:0,touch:function(e){e.xTouched=!0},touched:function(e){return e.xTouched},untouch:function(e){e.xTouched=!1}},an={x:0,y:1,axis:"y",distance:function(e,t,n,r){return(n?e.yo:e.y)-(r?t.yo:t.y)},interpolate:function(e,t,n,r){var i,a,o,s,u,c,l;if(!r||r===this)return i=e.yo-t.yo,a=e.yo-n.yo,u=t.y-t.yo,c=n.y-n.yo,0===(l=(o=Math.abs(i))+(s=Math.abs(a)))?void(e.y=e.yo+(u+c)/2):void(e.y=e.yo+(u*s+c*o)/l);i=r.distance(e,t,!0,!0),a=r.distance(e,n,!0,!0),u=r.distance(t,t,!1,!0),c=r.distance(n,n,!1,!0),0!==(l=(o=Math.abs(i))+(s=Math.abs(a)))?an.setRelative(e,e,(u*s+c*o)/l,r,!0):an.setRelative(e,e,(u+c)/2,r,!0)},normalSlope:0,setRelative:function(e,t,n,r,i){if(r&&r!==this){var a=i?t.xo:t.x,o=i?t.yo:t.y,s=a+n*r.x,u=o+n*r.y;e.y=u+r.normalSlope*(e.x-s)}else e.y=(i?t.yo:t.y)+n},slope:Number.POSITIVE_INFINITY,touch:function(e){e.yTouched=!0},touched:function(e){return e.yTouched},untouch:function(e){e.yTouched=!1}};function on(e,t){this.x=e,this.y=t,this.axis=void 0,this.slope=t/e,this.normalSlope=-e/t,Object.freeze(this)}function sn(e,t){var n=Math.sqrt(e*e+t*t);return t/=n,1==(e/=n)&&0===t?rn:0===e&&1===t?an:new on(e,t)}function un(e,t,n,r){this.x=this.xo=Math.round(64*e)/64,this.y=this.yo=Math.round(64*t)/64,this.lastPointOfContour=n,this.onCurve=r,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}Object.freeze(rn),Object.freeze(an),on.prototype.distance=function(e,t,n,r){return this.x*rn.distance(e,t,n,r)+this.y*an.distance(e,t,n,r)},on.prototype.interpolate=function(e,t,n,r){var i,a,o,s,u,c,l;o=r.distance(e,t,!0,!0),s=r.distance(e,n,!0,!0),i=r.distance(t,t,!1,!0),a=r.distance(n,n,!1,!0),0!==(l=(u=Math.abs(o))+(c=Math.abs(s)))?this.setRelative(e,e,(i*c+a*u)/l,r,!0):this.setRelative(e,e,(i+a)/2,r,!0)},on.prototype.setRelative=function(e,t,n,r,i){r=r||this;var a=i?t.xo:t.x,o=i?t.yo:t.y,s=a+n*r.x,u=o+n*r.y,c=r.normalSlope,l=this.slope,f=e.x,d=e.y;e.x=(l*f-c*s+u-d)/(l-c),e.y=l*(e.x-f)+d},on.prototype.touch=function(e){e.xTouched=!0,e.yTouched=!0},un.prototype.nextTouched=function(e){for(var t=this.nextPointOnContour;!e.touched(t)&&t!==this;)t=t.nextPointOnContour;return t},un.prototype.prevTouched=function(e){for(var t=this.prevPointOnContour;!e.touched(t)&&t!==this;)t=t.prevPointOnContour;return t};var cn=Object.freeze(new un(0,0)),ln={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function fn(e,t){switch(this.env=e,this.stack=[],this.prog=t,e){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=rn,this.round=Jt}}function dn(e){for(var t=e.tZone=new Array(e.gZone.length),n=0;n<t.length;n++)t[n]=new un(0,0)}function hn(e,t){var n,r=e.prog,i=e.ip,a=1;do{if(88===(n=r[++i]))a++;else if(89===n)a--;else if(64===n)i+=r[i+1]+1;else if(65===n)i+=2*r[i+1]+1;else if(176<=n&&n<=183)i+=n-176+1;else if(184<=n&&n<=191)i+=2*(n-184+1);else if(t&&1===a&&27===n)break}while(0<a);e.ip=i}function pn(e,n){t.DEBUG&&console.log(n.step,"SVTCA["+e.axis+"]"),n.fv=n.pv=n.dpv=e}function mn(e,n){t.DEBUG&&console.log(n.step,"SPVTCA["+e.axis+"]"),n.pv=n.dpv=e}function vn(e,n){t.DEBUG&&console.log(n.step,"SFVTCA["+e.axis+"]"),n.fv=e}function gn(e,n){var r,i,a=n.stack,o=a.pop(),s=a.pop(),u=n.z2[o],c=n.z1[s];t.DEBUG&&console.log("SPVTL["+e+"]",o,s),i=e?(r=u.y-c.y,c.x-u.x):(r=c.x-u.x,c.y-u.y),n.pv=n.dpv=sn(r,i)}function yn(e,n){var r,i,a=n.stack,o=a.pop(),s=a.pop(),u=n.z2[o],c=n.z1[s];t.DEBUG&&console.log("SFVTL["+e+"]",o,s),i=e?(r=u.y-c.y,c.x-u.x):(r=c.x-u.x,c.y-u.y),n.fv=sn(r,i)}function bn(e){t.DEBUG&&console.log(e.step,"POP[]"),e.stack.pop()}function xn(e,n){var r=n.stack.pop(),i=n.z0[r],a=n.fv,o=n.pv;t.DEBUG&&console.log(n.step,"MDAP["+e+"]",r);var s=o.distance(i,cn);e&&(s=n.round(s)),a.setRelative(i,cn,s,o),a.touch(i),n.rp0=n.rp1=r}function wn(e,n){var r,i,a,o=n.z2,s=o.length-2;t.DEBUG&&console.log(n.step,"IUP["+e.axis+"]");for(var u=0;u<s;u++)r=o[u],e.touched(r)||(i=r.prevTouched(e))!==r&&(i===(a=r.nextTouched(e))&&e.setRelative(r,r,e.distance(i,i,!1,!0),e,!0),e.interpolate(r,i,a,e))}function _n(e,n){for(var r=n.stack,i=e?n.rp1:n.rp2,a=(e?n.z0:n.z1)[i],o=n.fv,s=n.pv,u=n.loop,c=n.z2;u--;){var l=r.pop(),f=c[l],d=s.distance(a,a,!1,!0);o.setRelative(f,f,d,s),o.touch(f),t.DEBUG&&console.log(n.step,(1<n.loop?"loop "+(n.loop-u)+": ":"")+"SHP["+(e?"rp1":"rp2")+"]",l)}n.loop=1}function kn(e,n){var r=n.stack,i=e?n.rp1:n.rp2,a=(e?n.z0:n.z1)[i],o=n.fv,s=n.pv,u=r.pop(),c=n.z2[n.contours[u]],l=c;t.DEBUG&&console.log(n.step,"SHC["+e+"]",u);for(var f=s.distance(a,a,!1,!0);l!==a&&o.setRelative(l,l,f,s),(l=l.nextPointOnContour)!==c;);}function En(e,n){var r,i,a=n.stack,o=e?n.rp1:n.rp2,s=(e?n.z0:n.z1)[o],u=n.fv,c=n.pv,l=a.pop();switch(t.DEBUG&&console.log(n.step,"SHZ["+e+"]",l),l){case 0:r=n.tZone;break;case 1:r=n.gZone;break;default:throw new Error("Invalid zone")}for(var f=c.distance(s,s,!1,!0),d=r.length-2,h=0;h<d;h++)i=r[h],u.setRelative(i,i,f,c)}function Sn(e,n){var r=n.stack,i=r.pop()/64,a=r.pop(),o=n.z1[a],s=n.z0[n.rp0],u=n.fv,c=n.pv;u.setRelative(o,s,i,c),u.touch(o),t.DEBUG&&console.log(n.step,"MSIRP["+e+"]",i,a),n.rp1=n.rp0,n.rp2=a,e&&(n.rp0=a)}function Cn(e,n){var r=n.stack,i=r.pop(),a=r.pop(),o=n.z0[a],s=n.fv,u=n.pv,c=n.cvt[i];t.DEBUG&&console.log(n.step,"MIAP["+e+"]",i,"(",c,")",a);var l=u.distance(o,cn);e&&(Math.abs(l-c)<n.cvCutIn&&(l=c),l=n.round(l)),s.setRelative(o,cn,l,u),0===n.zp0&&(o.xo=o.x,o.yo=o.y),s.touch(o),n.rp0=n.rp1=a}function An(e,n){var r=n.stack,i=r.pop(),a=n.z2[i];t.DEBUG&&console.log(n.step,"GC["+e+"]",i),r.push(64*n.dpv.distance(a,cn,e,!1))}function On(e,n){var r=n.stack,i=r.pop(),a=r.pop(),o=n.z1[i],s=n.z0[a],u=n.dpv.distance(s,o,e,e);t.DEBUG&&console.log(n.step,"MD["+e+"]",i,a,"->",u),n.stack.push(Math.round(64*u))}function Dn(e,n){var r=n.stack,i=r.pop(),a=n.fv,o=n.pv,s=n.ppem,u=n.deltaBase+16*(e-1),c=n.deltaShift,l=n.z0;t.DEBUG&&console.log(n.step,"DELTAP["+e+"]",i,r);for(var f=0;f<i;f++){var d=r.pop(),h=r.pop();if(u+((240&h)>>4)===s){var p=(15&h)-8;0<=p&&p++,t.DEBUG&&console.log(n.step,"DELTAPFIX",d,"by",p*c);var m=l[d];a.setRelative(m,m,p*c,o)}}}function Tn(e,n){var r=n.stack,i=r.pop();t.DEBUG&&console.log(n.step,"ROUND[]"),r.push(64*n.round(i/64))}function jn(e,n){var r=n.stack,i=r.pop(),a=n.ppem,o=n.deltaBase+16*(e-1),s=n.deltaShift;t.DEBUG&&console.log(n.step,"DELTAC["+e+"]",i,r);for(var u=0;u<i;u++){var c=r.pop(),l=r.pop();if(o+((240&l)>>4)===a){var f=(15&l)-8;0<=f&&f++;var d=f*s;t.DEBUG&&console.log(n.step,"DELTACFIX",c,"by",d),n.cvt[c]+=d}}}function Mn(e,n){var r,i,a=n.stack,o=a.pop(),s=a.pop(),u=n.z2[o],c=n.z1[s];t.DEBUG&&console.log(n.step,"SDPVTL["+e+"]",o,s),i=e?(r=u.y-c.y,c.x-u.x):(r=c.x-u.x,c.y-u.y),n.dpv=sn(r,i)}function Fn(e,n){var r=n.stack,i=n.prog,a=n.ip;t.DEBUG&&console.log(n.step,"PUSHB["+e+"]");for(var o=0;o<e;o++)r.push(i[++a]);n.ip=a}function In(e,n){var r=n.ip,i=n.prog,a=n.stack;t.DEBUG&&console.log(n.ip,"PUSHW["+e+"]");for(var o=0;o<e;o++){var s=i[++r]<<8|i[++r];32768&s&&(s=-(1+(65535^s))),a.push(s)}n.ip=r}function Nn(e,n,r,i,a,o){var s,u,c,l,f=o.stack,d=e&&f.pop(),h=f.pop(),p=o.rp0,m=o.z0[p],v=o.z1[h],g=o.minDis,y=o.fv,b=o.dpv;c=0<=(u=s=b.distance(v,m,!0,!0))?1:-1,u=Math.abs(u),e&&(l=o.cvt[d],i&&Math.abs(u-l)<o.cvCutIn&&(u=l)),r&&u<g&&(u=g),i&&(u=o.round(u)),y.setRelative(v,m,c*u,b),y.touch(v),t.DEBUG&&console.log(o.step,(e?"MIRP[":"MDRP[")+(n?"M":"m")+(r?">":"_")+(i?"R":"_")+(0===a?"Gr":1===a?"Bl":2===a?"Wh":"")+"]",e?d+"("+o.cvt[d]+","+l+")":"",h,"(d =",s,"->",c*u,")"),o.rp1=o.rp0,o.rp2=h,n&&(o.rp0=h)}Yt.prototype.exec=function(e,n){if("number"!=typeof n)throw new Error("Point size is not a number!");if(!(2<this._errorState)){var r=this.font,i=this._prepState;if(!i||i.ppem!==n){var a=this._fpgmState;if(!a){fn.prototype=ln,(a=this._fpgmState=new fn("fpgm",r.tables.fpgm)).funcs=[],a.font=r,t.DEBUG&&(console.log("---EXEC FPGM---"),a.step=-1);try{qt(a)}catch(e){return console.log("Hinting error in FPGM:"+e),void(this._errorState=3)}}fn.prototype=a,(i=this._prepState=new fn("prep",r.tables.prep)).ppem=n;var o=r.tables.cvt;if(o)for(var s=i.cvt=new Array(o.length),u=n/r.unitsPerEm,c=0;c<o.length;c++)s[c]=o[c]*u;else i.cvt=[];t.DEBUG&&(console.log("---EXEC PREP---"),i.step=-1);try{qt(i)}catch(e){this._errorState<2&&console.log("Hinting error in PREP:"+e),this._errorState=2}}if(!(1<this._errorState))try{return Ht(e,i)}catch(e){return this._errorState<1&&(console.log("Hinting error:"+e),console.log("Note: further hinting errors are silenced")),void(this._errorState=1)}}},Ht=function(e,n){var r,i,a,o=n.ppem/n.font.unitsPerEm,s=o,u=e.components;if(fn.prototype=n,u){var c=n.font;i=[],r=[];for(var l=0;l<u.length;l++){var f=u[l],d=c.glyphs.get(f.glyphIndex);a=new fn("glyf",d.instructions),t.DEBUG&&(console.log("---EXEC COMP "+l+"---"),a.step=-1),Xt(d,a,o,s);for(var h=Math.round(f.dx*o),p=Math.round(f.dy*s),m=a.gZone,v=a.contours,g=0;g<m.length;g++){var y=m[g];y.xTouched=y.yTouched=!1,y.xo=y.x=y.x+h,y.yo=y.y=y.y+p}var b=i.length;i.push.apply(i,m);for(var x=0;x<v.length;x++)r.push(v[x]+b)}e.instructions&&!a.inhibitGridFit&&((a=new fn("glyf",e.instructions)).gZone=a.z0=a.z1=a.z2=i,a.contours=r,i.push(new un(0,0),new un(Math.round(e.advanceWidth*o),0)),t.DEBUG&&(console.log("---EXEC COMPOSITE---"),a.step=-1),qt(a),i.length-=2)}else a=new fn("glyf",e.instructions),t.DEBUG&&(console.log("---EXEC GLYPH---"),a.step=-1),Xt(e,a,o,s),i=a.gZone;return i},Xt=function(e,n,r,i){for(var a,o,s,u=e.points||[],c=u.length,l=n.gZone=n.z0=n.z1=n.z2=[],f=n.contours=[],d=0;d<c;d++)a=u[d],l[d]=new un(a.x*r,a.y*i,a.lastPointOfContour,a.onCurve);for(var h=0;h<c;h++)a=l[h],o||(o=a,f.push(h)),a.lastPointOfContour?((a.nextPointOnContour=o).prevPointOnContour=a,o=void 0):(s=l[h+1],(a.nextPointOnContour=s).prevPointOnContour=a);if(!n.inhibitGridFit){if(t.DEBUG){console.log("PROCESSING GLYPH",n.stack);for(var p=0;p<c;p++)console.log(p,l[p].x,l[p].y)}if(l.push(new un(0,0),new un(Math.round(e.advanceWidth*r),0)),qt(n),l.length-=2,t.DEBUG){console.log("FINISHED GLYPH",n.stack);for(var m=0;m<c;m++)console.log(m,l[m].x,l[m].y)}}},qt=function(e){var n=e.prog;if(n){var r,i=n.length;for(e.ip=0;e.ip<i;e.ip++){if(t.DEBUG&&e.step++,!(r=Gt[n[e.ip]]))throw new Error("unknown instruction: 0x"+Number(n[e.ip]).toString(16));r(e)}}},Gt=[pn.bind(void 0,an),pn.bind(void 0,rn),mn.bind(void 0,an),mn.bind(void 0,rn),vn.bind(void 0,an),vn.bind(void 0,rn),gn.bind(void 0,0),gn.bind(void 0,1),yn.bind(void 0,0),yn.bind(void 0,1),function(e){var n=e.stack,r=n.pop(),i=n.pop();t.DEBUG&&console.log(e.step,"SPVFS[]",r,i),e.pv=e.dpv=sn(i,r)},function(e){var n=e.stack,r=n.pop(),i=n.pop();t.DEBUG&&console.log(e.step,"SPVFS[]",r,i),e.fv=sn(i,r)},function(e){var n=e.stack,r=e.pv;t.DEBUG&&console.log(e.step,"GPV[]"),n.push(16384*r.x),n.push(16384*r.y)},function(e){var n=e.stack,r=e.fv;t.DEBUG&&console.log(e.step,"GFV[]"),n.push(16384*r.x),n.push(16384*r.y)},function(e){e.fv=e.pv,t.DEBUG&&console.log(e.step,"SFVTPV[]")},function(e){var n=e.stack,r=n.pop(),i=n.pop(),a=n.pop(),o=n.pop(),s=n.pop(),u=e.z0,c=e.z1,l=u[r],f=u[i],d=c[a],h=c[o],p=e.z2[s];t.DEBUG&&console.log("ISECT[], ",r,i,a,o,s);var m=l.x,v=l.y,g=f.x,y=f.y,b=d.x,x=d.y,w=h.x,_=h.y,k=(m-g)*(x-_)-(v-y)*(b-w),E=m*y-v*g,S=b*_-x*w;p.x=(E*(b-w)-S*(m-g))/k,p.y=(E*(x-_)-S*(v-y))/k},function(e){e.rp0=e.stack.pop(),t.DEBUG&&console.log(e.step,"SRP0[]",e.rp0)},function(e){e.rp1=e.stack.pop(),t.DEBUG&&console.log(e.step,"SRP1[]",e.rp1)},function(e){e.rp2=e.stack.pop(),t.DEBUG&&console.log(e.step,"SRP2[]",e.rp2)},function(e){var n=e.stack.pop();switch(t.DEBUG&&console.log(e.step,"SZP0[]",n),e.zp0=n){case 0:e.tZone||dn(e),e.z0=e.tZone;break;case 1:e.z0=e.gZone;break;default:throw new Error("Invalid zone pointer")}},function(e){var n=e.stack.pop();switch(t.DEBUG&&console.log(e.step,"SZP1[]",n),e.zp1=n){case 0:e.tZone||dn(e),e.z1=e.tZone;break;case 1:e.z1=e.gZone;break;default:throw new Error("Invalid zone pointer")}},function(e){var n=e.stack.pop();switch(t.DEBUG&&console.log(e.step,"SZP2[]",n),e.zp2=n){case 0:e.tZone||dn(e),e.z2=e.tZone;break;case 1:e.z2=e.gZone;break;default:throw new Error("Invalid zone pointer")}},function(e){var n=e.stack.pop();switch(t.DEBUG&&console.log(e.step,"SZPS[]",n),e.zp0=e.zp1=e.zp2=n,n){case 0:e.tZone||dn(e),e.z0=e.z1=e.z2=e.tZone;break;case 1:e.z0=e.z1=e.z2=e.gZone;break;default:throw new Error("Invalid zone pointer")}},function(e){e.loop=e.stack.pop(),t.DEBUG&&console.log(e.step,"SLOOP[]",e.loop)},function(e){t.DEBUG&&console.log(e.step,"RTG[]"),e.round=Jt},function(e){t.DEBUG&&console.log(e.step,"RTHG[]"),e.round=Qt},function(e){var n=e.stack.pop();t.DEBUG&&console.log(e.step,"SMD[]",n),e.minDis=n/64},function(e){t.DEBUG&&console.log(e.step,"ELSE[]"),hn(e,!1)},function(e){var n=e.stack.pop();t.DEBUG&&console.log(e.step,"JMPR[]",n),e.ip+=n-1},function(e){var n=e.stack.pop();t.DEBUG&&console.log(e.step,"SCVTCI[]",n),e.cvCutIn=n/64},void 0,void 0,function(e){var n=e.stack;t.DEBUG&&console.log(e.step,"DUP[]"),n.push(n[n.length-1])},bn,function(e){t.DEBUG&&console.log(e.step,"CLEAR[]"),e.stack.length=0},function(e){var n=e.stack,r=n.pop(),i=n.pop();t.DEBUG&&console.log(e.step,"SWAP[]"),n.push(r),n.push(i)},function(e){var n=e.stack;t.DEBUG&&console.log(e.step,"DEPTH[]"),n.push(n.length)},function(e){var n=e.stack,r=n.pop();t.DEBUG&&console.log(e.step,"CINDEX[]",r),n.push(n[n.length-r])},function(e){var n=e.stack,r=n.pop();t.DEBUG&&console.log(e.step,"MINDEX[]",r),n.push(n.splice(n.length-r,1)[0])},void 0,void 0,void 0,function(e){var n=e.stack,r=n.pop(),i=n.pop();t.DEBUG&&console.log(e.step,"LOOPCALL[]",r,i);var a=e.ip,o=e.prog;e.prog=e.funcs[r];for(var s=0;s<i;s++)qt(e),t.DEBUG&&console.log(++e.step,s+1<i?"next loopcall":"done loopcall",s);e.ip=a,e.prog=o},function(e){var n=e.stack.pop();t.DEBUG&&console.log(e.step,"CALL[]",n);var r=e.ip,i=e.prog;e.prog=e.funcs[n],qt(e),e.ip=r,e.prog=i,t.DEBUG&&console.log(++e.step,"returning from",n)},function(e){if("fpgm"!==e.env)throw new Error("FDEF not allowed here");var n=e.stack,r=e.prog,i=e.ip,a=n.pop(),o=i;for(t.DEBUG&&console.log(e.step,"FDEF[]",a);45!==r[++i];);e.ip=i,e.funcs[a]=r.slice(o+1,i)},void 0,xn.bind(void 0,0),xn.bind(void 0,1),wn.bind(void 0,an),wn.bind(void 0,rn),_n.bind(void 0,0),_n.bind(void 0,1),kn.bind(void 0,0),kn.bind(void 0,1),En.bind(void 0,0),En.bind(void 0,1),function(e){for(var n=e.stack,r=e.loop,i=e.fv,a=n.pop()/64,o=e.z2;r--;){var s=n.pop(),u=o[s];t.DEBUG&&console.log(e.step,(1<e.loop?"loop "+(e.loop-r)+": ":"")+"SHPIX[]",s,a),i.setRelative(u,u,a),i.touch(u)}e.loop=1},function(e){for(var n=e.stack,r=e.rp1,i=e.rp2,a=e.loop,o=e.z0[r],s=e.z1[i],u=e.fv,c=e.dpv,l=e.z2;a--;){var f=n.pop(),d=l[f];t.DEBUG&&console.log(e.step,(1<e.loop?"loop "+(e.loop-a)+": ":"")+"IP[]",f,r,"<->",i),u.interpolate(d,o,s,c),u.touch(d)}e.loop=1},Sn.bind(void 0,0),Sn.bind(void 0,1),function(e){for(var n=e.stack,r=e.rp0,i=e.z0[r],a=e.loop,o=e.fv,s=e.pv,u=e.z1;a--;){var c=n.pop(),l=u[c];t.DEBUG&&console.log(e.step,(1<e.loop?"loop "+(e.loop-a)+": ":"")+"ALIGNRP[]",c),o.setRelative(l,i,0,s),o.touch(l)}e.loop=1},function(e){t.DEBUG&&console.log(e.step,"RTDG[]"),e.round=Zt},Cn.bind(void 0,0),Cn.bind(void 0,1),function(e){var n=e.prog,r=e.ip,i=e.stack,a=n[++r];t.DEBUG&&console.log(e.step,"NPUSHB[]",a);for(var o=0;o<a;o++)i.push(n[++r]);e.ip=r},function(e){var n=e.ip,r=e.prog,i=e.stack,a=r[++n];t.DEBUG&&console.log(e.step,"NPUSHW[]",a);for(var o=0;o<a;o++){var s=r[++n]<<8|r[++n];32768&s&&(s=-(1+(65535^s))),i.push(s)}e.ip=n},function(e){var n=e.stack,r=e.store;r=r||(e.store=[]);var i=n.pop(),a=n.pop();t.DEBUG&&console.log(e.step,"WS",i,a),r[a]=i},function(e){var n=e.stack,r=e.store,i=n.pop();t.DEBUG&&console.log(e.step,"RS",i);var a=r&&r[i]||0;n.push(a)},function(e){var n=e.stack,r=n.pop(),i=n.pop();t.DEBUG&&console.log(e.step,"WCVTP",r,i),e.cvt[i]=r/64},function(e){var n=e.stack,r=n.pop();t.DEBUG&&console.log(e.step,"RCVT",r),n.push(64*e.cvt[r])},An.bind(void 0,0),An.bind(void 0,1),void 0,On.bind(void 0,0),On.bind(void 0,1),function(e){t.DEBUG&&console.log(e.step,"MPPEM[]"),e.stack.push(e.ppem)},void 0,function(e){t.DEBUG&&console.log(e.step,"FLIPON[]"),e.autoFlip=!0},void 0,void 0,function(e){var n=e.stack,r=n.pop(),i=n.pop();t.DEBUG&&console.log(e.step,"LT[]",r,i),n.push(i<r?1:0)},function(e){var n=e.stack,r=n.pop(),i=n.pop();t.DEBUG&&console.log(e.step,"LTEQ[]",r,i),n.push(i<=r?1:0)},function(e){var n=e.stack,r=n.pop(),i=n.pop();t.DEBUG&&console.log(e.step,"GT[]",r,i),n.push(r<i?1:0)},function(e){var n=e.stack,r=n.pop(),i=n.pop();t.DEBUG&&console.log(e.step,"GTEQ[]",r,i),n.push(r<=i?1:0)},function(e){var n=e.stack,r=n.pop(),i=n.pop();t.DEBUG&&console.log(e.step,"EQ[]",r,i),n.push(r===i?1:0)},function(e){var n=e.stack,r=n.pop(),i=n.pop();t.DEBUG&&console.log(e.step,"NEQ[]",r,i),n.push(r!==i?1:0)},function(e){var n=e.stack,r=n.pop();t.DEBUG&&console.log(e.step,"ODD[]",r),n.push(Math.trunc(r)%2?1:0)},function(e){var n=e.stack,r=n.pop();t.DEBUG&&console.log(e.step,"EVEN[]",r),n.push(Math.trunc(r)%2?0:1)},function(e){var n=e.stack.pop();t.DEBUG&&console.log(e.step,"IF[]",n),n||(hn(e,!0),t.DEBUG&&console.log(e.step,"EIF[]"))},function(e){t.DEBUG&&console.log(e.step,"EIF[]")},function(e){var n=e.stack,r=n.pop(),i=n.pop();t.DEBUG&&console.log(e.step,"AND[]",r,i),n.push(r&&i?1:0)},function(e){var n=e.stack,r=n.pop(),i=n.pop();t.DEBUG&&console.log(e.step,"OR[]",r,i),n.push(r||i?1:0)},function(e){var n=e.stack,r=n.pop();t.DEBUG&&console.log(e.step,"NOT[]",r),n.push(r?0:1)},Dn.bind(void 0,1),function(e){var n=e.stack.pop();t.DEBUG&&console.log(e.step,"SDB[]",n),e.deltaBase=n},function(e){var n=e.stack.pop();t.DEBUG&&console.log(e.step,"SDS[]",n),e.deltaShift=Math.pow(.5,n)},function(e){var n=e.stack,r=n.pop(),i=n.pop();t.DEBUG&&console.log(e.step,"ADD[]",r,i),n.push(i+r)},function(e){var n=e.stack,r=n.pop(),i=n.pop();t.DEBUG&&console.log(e.step,"SUB[]",r,i),n.push(i-r)},function(e){var n=e.stack,r=n.pop(),i=n.pop();t.DEBUG&&console.log(e.step,"DIV[]",r,i),n.push(64*i/r)},function(e){var n=e.stack,r=n.pop(),i=n.pop();t.DEBUG&&console.log(e.step,"MUL[]",r,i),n.push(i*r/64)},function(e){var n=e.stack,r=n.pop();t.DEBUG&&console.log(e.step,"ABS[]",r),n.push(Math.abs(r))},function(e){var n=e.stack,r=n.pop();t.DEBUG&&console.log(e.step,"NEG[]",r),n.push(-r)},function(e){var n=e.stack,r=n.pop();t.DEBUG&&console.log(e.step,"FLOOR[]",r),n.push(64*Math.floor(r/64))},function(e){var n=e.stack,r=n.pop();t.DEBUG&&console.log(e.step,"CEILING[]",r),n.push(64*Math.ceil(r/64))},Tn.bind(void 0,0),Tn.bind(void 0,1),Tn.bind(void 0,2),Tn.bind(void 0,3),void 0,void 0,void 0,void 0,function(e){var n=e.stack,r=n.pop(),i=n.pop();t.DEBUG&&console.log(e.step,"WCVTF[]",r,i),e.cvt[i]=r*e.ppem/e.font.unitsPerEm},Dn.bind(void 0,2),Dn.bind(void 0,3),jn.bind(void 0,1),jn.bind(void 0,2),jn.bind(void 0,3),function(e){var n,r=e.stack.pop();switch(t.DEBUG&&console.log(e.step,"SROUND[]",r),e.round=nn,192&r){case 0:n=.5;break;case 64:n=1;break;case 128:n=2;break;default:throw new Error("invalid SROUND value")}switch(e.srPeriod=n,48&r){case 0:e.srPhase=0;break;case 16:e.srPhase=.25*n;break;case 32:e.srPhase=.5*n;break;case 48:e.srPhase=.75*n;break;default:throw new Error("invalid SROUND value")}r&=15,e.srThreshold=0===r?0:(r/8-.5)*n},function(e){var n,r=e.stack.pop();switch(t.DEBUG&&console.log(e.step,"S45ROUND[]",r),e.round=nn,192&r){case 0:n=Math.sqrt(2)/2;break;case 64:n=Math.sqrt(2);break;case 128:n=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(e.srPeriod=n,48&r){case 0:e.srPhase=0;break;case 16:e.srPhase=.25*n;break;case 32:e.srPhase=.5*n;break;case 48:e.srPhase=.75*n;break;default:throw new Error("invalid S45ROUND value")}r&=15,e.srThreshold=0===r?0:(r/8-.5)*n},void 0,void 0,function(e){t.DEBUG&&console.log(e.step,"ROFF[]"),e.round=$t},void 0,function(e){t.DEBUG&&console.log(e.step,"RUTG[]"),e.round=en},function(e){t.DEBUG&&console.log(e.step,"RDTG[]"),e.round=tn},bn,bn,void 0,void 0,void 0,void 0,void 0,function(e){var n=e.stack.pop();t.DEBUG&&console.log(e.step,"SCANCTRL[]",n)},Mn.bind(void 0,0),Mn.bind(void 0,1),function(e){var n=e.stack,r=n.pop(),i=0;t.DEBUG&&console.log(e.step,"GETINFO[]",r),1&r&&(i=35),32&r&&(i|=4096),n.push(i)},void 0,function(e){var n=e.stack,r=n.pop(),i=n.pop(),a=n.pop();t.DEBUG&&console.log(e.step,"ROLL[]"),n.push(i),n.push(r),n.push(a)},function(e){var n=e.stack,r=n.pop(),i=n.pop();t.DEBUG&&console.log(e.step,"MAX[]",r,i),n.push(Math.max(i,r))},function(e){var n=e.stack,r=n.pop(),i=n.pop();t.DEBUG&&console.log(e.step,"MIN[]",r,i),n.push(Math.min(i,r))},function(e){var n=e.stack.pop();t.DEBUG&&console.log(e.step,"SCANTYPE[]",n)},function(e){var n=e.stack.pop(),r=e.stack.pop();switch(t.DEBUG&&console.log(e.step,"INSTCTRL[]",n,r),n){case 1:return void(e.inhibitGridFit=!!r);case 2:return void(e.ignoreCvt=!!r);default:throw new Error("invalid INSTCTRL[] selector")}},void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Fn.bind(void 0,1),Fn.bind(void 0,2),Fn.bind(void 0,3),Fn.bind(void 0,4),Fn.bind(void 0,5),Fn.bind(void 0,6),Fn.bind(void 0,7),Fn.bind(void 0,8),In.bind(void 0,1),In.bind(void 0,2),In.bind(void 0,3),In.bind(void 0,4),In.bind(void 0,5),In.bind(void 0,6),In.bind(void 0,7),In.bind(void 0,8),Nn.bind(void 0,0,0,0,0,0),Nn.bind(void 0,0,0,0,0,1),Nn.bind(void 0,0,0,0,0,2),Nn.bind(void 0,0,0,0,0,3),Nn.bind(void 0,0,0,0,1,0),Nn.bind(void 0,0,0,0,1,1),Nn.bind(void 0,0,0,0,1,2),Nn.bind(void 0,0,0,0,1,3),Nn.bind(void 0,0,0,1,0,0),Nn.bind(void 0,0,0,1,0,1),Nn.bind(void 0,0,0,1,0,2),Nn.bind(void 0,0,0,1,0,3),Nn.bind(void 0,0,0,1,1,0),Nn.bind(void 0,0,0,1,1,1),Nn.bind(void 0,0,0,1,1,2),Nn.bind(void 0,0,0,1,1,3),Nn.bind(void 0,0,1,0,0,0),Nn.bind(void 0,0,1,0,0,1),Nn.bind(void 0,0,1,0,0,2),Nn.bind(void 0,0,1,0,0,3),Nn.bind(void 0,0,1,0,1,0),Nn.bind(void 0,0,1,0,1,1),Nn.bind(void 0,0,1,0,1,2),Nn.bind(void 0,0,1,0,1,3),Nn.bind(void 0,0,1,1,0,0),Nn.bind(void 0,0,1,1,0,1),Nn.bind(void 0,0,1,1,0,2),Nn.bind(void 0,0,1,1,0,3),Nn.bind(void 0,0,1,1,1,0),Nn.bind(void 0,0,1,1,1,1),Nn.bind(void 0,0,1,1,1,2),Nn.bind(void 0,0,1,1,1,3),Nn.bind(void 0,1,0,0,0,0),Nn.bind(void 0,1,0,0,0,1),Nn.bind(void 0,1,0,0,0,2),Nn.bind(void 0,1,0,0,0,3),Nn.bind(void 0,1,0,0,1,0),Nn.bind(void 0,1,0,0,1,1),Nn.bind(void 0,1,0,0,1,2),Nn.bind(void 0,1,0,0,1,3),Nn.bind(void 0,1,0,1,0,0),Nn.bind(void 0,1,0,1,0,1),Nn.bind(void 0,1,0,1,0,2),Nn.bind(void 0,1,0,1,0,3),Nn.bind(void 0,1,0,1,1,0),Nn.bind(void 0,1,0,1,1,1),Nn.bind(void 0,1,0,1,1,2),Nn.bind(void 0,1,0,1,1,3),Nn.bind(void 0,1,1,0,0,0),Nn.bind(void 0,1,1,0,0,1),Nn.bind(void 0,1,1,0,0,2),Nn.bind(void 0,1,1,0,0,3),Nn.bind(void 0,1,1,0,1,0),Nn.bind(void 0,1,1,0,1,1),Nn.bind(void 0,1,1,0,1,2),Nn.bind(void 0,1,1,0,1,3),Nn.bind(void 0,1,1,1,0,0),Nn.bind(void 0,1,1,1,0,1),Nn.bind(void 0,1,1,1,0,2),Nn.bind(void 0,1,1,1,0,3),Nn.bind(void 0,1,1,1,1,0),Nn.bind(void 0,1,1,1,1,1),Nn.bind(void 0,1,1,1,1,2),Nn.bind(void 0,1,1,1,1,3)];var Rn=Array.from||function(e){return e.match(/[\uD800-\uDBFF][\uDC00-\uDFFF]?|[^\uD800-\uDFFF]|./g)||[]};function Pn(e){(e=e||{}).empty||(Bt(e.familyName,"When creating a new Font object, familyName is required."),Bt(e.styleName,"When creating a new Font object, styleName is required."),Bt(e.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),Bt(e.ascender,"When creating a new Font object, ascender is required."),Bt(e.descender,"When creating a new Font object, descender is required."),Bt(e.descender<0,"Descender should be negative (e.g. -512)."),this.names={fontFamily:{en:e.familyName||" "},fontSubfamily:{en:e.styleName||" "},fullName:{en:e.fullName||e.familyName+" "+e.styleName},postScriptName:{en:e.postScriptName||(e.familyName+e.styleName).replace(/\s/g,"")},designer:{en:e.designer||" "},designerURL:{en:e.designerURL||" "},manufacturer:{en:e.manufacturer||" "},manufacturerURL:{en:e.manufacturerURL||" "},license:{en:e.license||" "},licenseURL:{en:e.licenseURL||" "},version:{en:e.version||"Version 0.1"},description:{en:e.description||" "},copyright:{en:e.copyright||" "},trademark:{en:e.trademark||" "}},this.unitsPerEm=e.unitsPerEm||1e3,this.ascender=e.ascender,this.descender=e.descender,this.createdTimestamp=e.createdTimestamp,this.tables={os2:{usWeightClass:e.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:e.widthClass||this.usWidthClasses.MEDIUM,fsSelection:e.fsSelection||this.fsSelectionValues.REGULAR}}),this.supported=!0,this.glyphs=new xe.GlyphSet(this,e.glyphs||[]),this.encoding=new de(this),this.position=new Ft(this),this.substitution=new It(this),this.tables=this.tables||{},Object.defineProperty(this,"hinting",{get:function(){return this._hinting?this._hinting:"truetype"===this.outlinesFormat?this._hinting=new Yt(this):void 0}})}function Bn(e,t,n,r){var i={},a=new ae.Parser(e,t);i.name=r[a.parseUShort()]||{},a.skip("uShort",1),i.coordinates={};for(var o=0;o<n.length;++o)i.coordinates[n[o].tag]=a.parseFixed();return i}Pn.prototype.hasChar=function(e){return null!==this.encoding.charToGlyphIndex(e)},Pn.prototype.charToGlyphIndex=function(e){return this.encoding.charToGlyphIndex(e)},Pn.prototype.charToGlyph=function(e){var t=this.charToGlyphIndex(e);return this.glyphs.get(t)||this.glyphs.get(0)},Pn.prototype.stringToGlyphs=function(e,t){t=t||this.defaultRenderOptions;for(var n=Rn(e),r=[],i=0;i<n.length;i+=1){var a=n[i];r.push(this.charToGlyphIndex(a))}var o=r.length;if(t.features){var s=t.script||this.substitution.getDefaultScriptName(),u=[];t.features.liga&&(u=u.concat(this.substitution.getFeature("liga",s,t.language))),t.features.rlig&&(u=u.concat(this.substitution.getFeature("rlig",s,t.language)));for(var c=0;c<o;c+=1)for(var l=0;l<u.length;l++){for(var f=u[l],d=f.sub,h=d.length,p=0;p<h&&d[p]===r[c+p];)p++;p===h&&(r.splice(c,h,f.by),o=o-h+1)}}for(var m=new Array(o),v=this.glyphs.get(0),g=0;g<o;g+=1)m[g]=this.glyphs.get(r[g])||v;return m},Pn.prototype.nameToGlyphIndex=function(e){return this.glyphNames.nameToGlyphIndex(e)},Pn.prototype.nameToGlyph=function(e){var t=this.nameToGlyphIndex(e);return this.glyphs.get(t)||this.glyphs.get(0)},Pn.prototype.glyphIndexToName=function(e){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(e):""},Pn.prototype.getKerningValue=function(e,t){e=e.index||e,t=t.index||t;var n=this.position.defaultKerningTables;return n?this.position.getKerningValue(n,e,t):this.kerningPairs[e+","+t]||0},Pn.prototype.defaultRenderOptions={kerning:!0,features:{liga:!0,rlig:!0}},Pn.prototype.forEachGlyph=function(e,t,n,r,i,a){t=void 0!==t?t:0,n=void 0!==n?n:0,r=void 0!==r?r:72,i=i||this.defaultRenderOptions;var o,s=1/this.unitsPerEm*r,u=this.stringToGlyphs(e,i);if(i.kerning){var c=i.script||this.position.getDefaultScriptName();o=this.position.getKerningTables(c,i.language)}for(var l=0;l<u.length;l+=1){var f=u[l];a.call(this,f,t,n,r,i),f.advanceWidth&&(t+=f.advanceWidth*s),i.kerning&&l<u.length-1&&(t+=(o?this.position.getKerningValue(o,f.index,u[l+1].index):this.getKerningValue(f,u[l+1]))*s),i.letterSpacing?t+=i.letterSpacing*r:i.tracking&&(t+=i.tracking/1e3*r)}return t},Pn.prototype.getPath=function(e,t,n,r,i){var a=new A;return this.forEachGlyph(e,t,n,r,i,(function(e,t,n,r){var o=e.getPath(t,n,r,i,this);a.extend(o)})),a},Pn.prototype.getPaths=function(e,t,n,r,i){var a=[];return this.forEachGlyph(e,t,n,r,i,(function(e,t,n,r){var o=e.getPath(t,n,r,i,this);a.push(o)})),a},Pn.prototype.getAdvanceWidth=function(e,t,n){return this.forEachGlyph(e,0,0,t,n,(function(){}))},Pn.prototype.draw=function(e,t,n,r,i,a){this.getPath(t,n,r,i,a).draw(e)},Pn.prototype.drawPoints=function(e,t,n,r,i,a){this.forEachGlyph(t,n,r,i,a,(function(t,n,r,i){t.drawPoints(e,n,r,i)}))},Pn.prototype.drawMetrics=function(e,t,n,r,i,a){this.forEachGlyph(t,n,r,i,a,(function(t,n,r,i){t.drawMetrics(e,n,r,i)}))},Pn.prototype.getEnglishName=function(e){var t=this.names[e];if(t)return t.en},Pn.prototype.validate=function(){var e=this;function t(t){var n=e.getEnglishName(t);n&&n.trim().length}t("fontFamily"),t("weightName"),t("manufacturer"),t("copyright"),t("version"),this.unitsPerEm},Pn.prototype.toTables=function(){return Ot(this)},Pn.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()},Pn.prototype.toArrayBuffer=function(){for(var e=this.toTables().encode(),t=new ArrayBuffer(e.length),n=new Uint8Array(t),r=0;r<e.length;r++)n[r]=e[r];return t},Pn.prototype.download=function(t){var n=this.getEnglishName("fontFamily"),i=this.getEnglishName("fontSubfamily");t=t||n.replace(/\s/g,"")+"-"+i+".otf";var a=this.toArrayBuffer();if("undefined"!=typeof window)window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,window.requestFileSystem(window.TEMPORARY,a.byteLength,(function(e){e.root.getFile(t,{create:!0},(function(e){e.createWriter((function(t){var n=new DataView(a),r=new Blob([n],{type:"font/opentype"});t.write(r),t.addEventListener("writeend",(function(){location.href=e.toURL()}),!1)}))}))}),(function(e){throw new Error(e.name+": "+e.message)}));else{var o=e("fs"),s=function(e){for(var t=new r(e.byteLength),n=new Uint8Array(e),i=0;i<t.length;++i)t[i]=n[i];return t}(a);o.writeFileSync(t,s)}},Pn.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512},Pn.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9},Pn.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};var Ln=function(e,t,n){var r=new ae.Parser(e,t),i=r.parseULong();T.argument(65536===i,"Unsupported fvar table version.");var a=r.parseOffset16();r.skip("uShort",1);for(var o,s,u,c,l,f=r.parseUShort(),d=r.parseUShort(),h=r.parseUShort(),p=r.parseUShort(),m=[],v=0;v<f;v++)m.push((o=e,s=t+a+v*d,u=n,l=c=void 0,c={},l=new ae.Parser(o,s),c.tag=l.parseTag(),c.minValue=l.parseFixed(),c.defaultValue=l.parseFixed(),c.maxValue=l.parseFixed(),l.skip("uShort",1),c.name=u[l.parseUShort()]||{},c));for(var g=[],y=t+a+f*d,b=0;b<h;b++)g.push(Bn(e,y+b*p,m,n));return{axes:m,instances:g}},zn=new Array(10);zn[1]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();return 1===t?{posFormat:1,coverage:this.parsePointer(re.coverage),value:this.parseValueRecord()}:2===t?{posFormat:2,coverage:this.parsePointer(re.coverage),values:this.parseValueRecordList()}:void T.assert(!1,"0x"+e.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")},zn[2]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();T.assert(1===t||2===t,"0x"+e.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var n=this.parsePointer(re.coverage),r=this.parseUShort(),i=this.parseUShort();if(1===t)return{posFormat:t,coverage:n,valueFormat1:r,valueFormat2:i,pairSets:this.parseList(re.pointer(re.list((function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(r),value2:this.parseValueRecord(i)}}))))};if(2===t){var a=this.parsePointer(re.classDef),o=this.parsePointer(re.classDef),s=this.parseUShort(),u=this.parseUShort();return{posFormat:t,coverage:n,valueFormat1:r,valueFormat2:i,classDef1:a,classDef2:o,class1Count:s,class2Count:u,classRecords:this.parseList(s,re.list(u,(function(){return{value1:this.parseValueRecord(r),value2:this.parseValueRecord(i)}})))}}},zn[3]=function(){return{error:"GPOS Lookup 3 not supported"}},zn[4]=function(){return{error:"GPOS Lookup 4 not supported"}},zn[5]=function(){return{error:"GPOS Lookup 5 not supported"}},zn[6]=function(){return{error:"GPOS Lookup 6 not supported"}},zn[7]=function(){return{error:"GPOS Lookup 7 not supported"}},zn[8]=function(){return{error:"GPOS Lookup 8 not supported"}},zn[9]=function(){return{error:"GPOS Lookup 9 not supported"}},new Array(10);var Un=function(e,t){var n=new re(e,t=t||0),r=n.parseVersion(1);return T.argument(1===r||1.1===r,"Unsupported GPOS table version "+r),1===r?{version:r,scripts:n.parseScriptList(),features:n.parseFeatureList(),lookups:n.parseLookupList(zn)}:{version:r,scripts:n.parseScriptList(),features:n.parseFeatureList(),lookups:n.parseLookupList(zn),variations:n.parseFeatureVariationsList()}},Wn=function(e,t){var n=new ae.Parser(e,t),r=n.parseUShort();if(0===r)return function(e){var t={};e.skip("uShort");var n=e.parseUShort();T.argument(0===n,"Unsupported kern sub-table version."),e.skip("uShort",2);var r=e.parseUShort();e.skip("uShort",3);for(var i=0;i<r;i+=1){var a=e.parseUShort(),o=e.parseUShort(),s=e.parseShort();t[a+","+o]=s}return t}(n);if(1===r)return function(e){var t={};e.skip("uShort"),1<e.parseULong()&&console.warn("Only the first kern subtable is supported."),e.skip("uLong");var n=255&e.parseUShort();if(e.skip("uShort"),0==n){var r=e.parseUShort();e.skip("uShort",3);for(var i=0;i<r;i+=1){var a=e.parseUShort(),o=e.parseUShort(),s=e.parseShort();t[a+","+o]=s}}return t}(n);throw new Error("Unsupported kern table version ("+r+").")},Vn=function(e,t,n,r){for(var i=new ae.Parser(e,t),a=r?i.parseUShort:i.parseULong,o=[],s=0;s<n+1;s+=1){var u=a.call(i);r&&(u*=2),o.push(u)}return o};function Gn(t,n){e("fs").readFile(t,(function(e,t){if(e)return n(e.message);n(null,Pt(t))}))}function qn(e,t){var n=new XMLHttpRequest;n.open("get",e,!0),n.responseType="arraybuffer",n.onload=function(){return n.response?t(null,n.response):t("Font could not be loaded: "+n.statusText)},n.onerror=function(){t("Font could not be loaded")},n.send()}function Hn(e,t){for(var n=[],r=12,i=0;i<t;i+=1){var a=ae.getTag(e,r),o=ae.getULong(e,r+4),s=ae.getULong(e,r+8),u=ae.getULong(e,r+12);n.push({tag:a,checksum:o,offset:s,length:u,compression:!1}),r+=16}return n}function Xn(e,t){if("WOFF"!==t.compression)return{data:e,offset:t.offset};var n=new Uint8Array(e.buffer,t.offset+2,t.compressedLength-2),r=new Uint8Array(t.length);if(function(e,t){var n,r,i=new o(e,t);do{switch(n=b(i),x(i,2,0)){case 0:r=E(i);break;case 1:r=k(i,s,u);break;case 2:_(i,i.ltree,i.dtree),r=k(i,i.ltree,i.dtree);break;default:r=-3}if(0!==r)throw new Error("Data error")}while(!n);i.destLen<i.dest.length?"function"==typeof i.dest.slice?i.dest.slice(0,i.destLen):i.dest.subarray(0,i.destLen):i.dest}(n,r),r.byteLength!==t.length)throw new Error("Decompression error: "+t.tag+" decompressed length doesn't match recorded length");return{data:new DataView(r.buffer,0),offset:0}}function Kn(e){var t,n,r,i,a,o,s,u,c,l,f,d,h,p,m=new Pn({empty:!0}),v=new DataView(e,0),g=[],y=ae.getTag(v,0);if(y===String.fromCharCode(0,1,0,0)||"true"===y||"typ1"===y)m.outlinesFormat="truetype",g=Hn(v,r=ae.getUShort(v,4));else if("OTTO"===y)m.outlinesFormat="cff",g=Hn(v,r=ae.getUShort(v,4));else{if("wOFF"!==y)throw new Error("Unsupported OpenType signature "+y);var b=ae.getTag(v,4);if(b===String.fromCharCode(0,1,0,0))m.outlinesFormat="truetype";else{if("OTTO"!==b)throw new Error("Unsupported OpenType flavor "+y);m.outlinesFormat="cff"}g=function(e,t){for(var n=[],r=44,i=0;i<t;i+=1){var a,o=ae.getTag(e,r),s=ae.getULong(e,r+4),u=ae.getULong(e,r+8),c=ae.getULong(e,r+12);a=u<c&&"WOFF",n.push({tag:o,offset:s,compression:a,compressedLength:u,length:c}),r+=20}return n}(v,r=ae.getUShort(v,12))}for(var x=0;x<r;x+=1){var w=g[x],_=void 0;switch(w.tag){case"cmap":_=Xn(v,w),m.tables.cmap=oe(_.data,_.offset),m.encoding=new he(m.tables.cmap);break;case"cvt ":_=Xn(v,w),p=new ae.Parser(_.data,_.offset),m.tables.cvt=p.parseShortList(w.length/2);break;case"fvar":a=w;break;case"fpgm":_=Xn(v,w),p=new ae.Parser(_.data,_.offset),m.tables.fpgm=p.parseByteList(w.length);break;case"head":_=Xn(v,w),m.tables.head=ze(_.data,_.offset),m.unitsPerEm=m.tables.head.unitsPerEm,t=m.tables.head.indexToLocFormat;break;case"hhea":_=Xn(v,w),m.tables.hhea=We(_.data,_.offset),m.ascender=m.tables.hhea.ascender,m.descender=m.tables.hhea.descender,m.numberOfHMetrics=m.tables.hhea.numberOfHMetrics;break;case"hmtx":c=w;break;case"ltag":_=Xn(v,w),n=Xe(_.data,_.offset);break;case"maxp":_=Xn(v,w),m.tables.maxp=Ke(_.data,_.offset),m.numGlyphs=m.tables.maxp.numGlyphs;break;case"name":d=w;break;case"OS/2":_=Xn(v,w),m.tables.os2=ft(_.data,_.offset);break;case"post":_=Xn(v,w),m.tables.post=pt(_.data,_.offset),m.glyphNames=new me(m.tables.post);break;case"prep":_=Xn(v,w),p=new ae.Parser(_.data,_.offset),m.tables.prep=p.parseByteList(w.length);break;case"glyf":o=w;break;case"loca":f=w;break;case"CFF ":i=w;break;case"kern":l=w;break;case"GPOS":s=w;break;case"GSUB":u=w;break;case"meta":h=w}}var k=Xn(v,d);if(m.tables.name=ut(k.data,k.offset,n),m.names=m.tables.name,o&&f){var E=0===t,S=Xn(v,f),C=Vn(S.data,S.offset,m.numGlyphs,E),A=Xn(v,o);m.glyphs=Kt.parse(A.data,A.offset,C,m)}else{if(!i)throw new Error("Font doesn't contain TrueType or CFF outlines.");var O=Xn(v,i);Be(O.data,O.offset,m)}var D=Xn(v,c);if(Ge(D.data,D.offset,m.numberOfHMetrics,m.numGlyphs,m.glyphs),function(e){for(var t,n=e.tables.cmap.glyphIndexMap,r=Object.keys(n),i=0;i<r.length;i+=1){var a=r[i],o=n[a];(t=e.glyphs.get(o)).addUnicode(parseInt(a))}for(var s=0;s<e.glyphs.length;s+=1)t=e.glyphs.get(s),e.cffEncoding?e.isCIDFont?t.name="gid"+s:t.name=e.cffEncoding.charset[s]:e.glyphNames.names&&(t.name=e.glyphNames.glyphIndexToName(s))}(m),l){var T=Xn(v,l);m.kerningPairs=Wn(T.data,T.offset)}else m.kerningPairs={};if(s){var j=Xn(v,s);m.tables.gpos=Un(j.data,j.offset),m.position.init()}if(u){var M=Xn(v,u);m.tables.gsub=bt(M.data,M.offset)}if(a){var F=Xn(v,a);m.tables.fvar=Ln(F.data,F.offset,m.names)}if(h){var I=Xn(v,h);m.tables.meta=wt(I.data,I.offset),m.metas=m.tables.meta}return m}t.Font=Pn,t.Glyph=ge,t.Path=A,t.BoundingBox=C,t._parse=ae,t.parse=Kn,t.load=function(e,t){("undefined"==typeof window?Gn:qn)(e,(function(e,n){if(e)return t(e);var r;try{r=Kn(n)}catch(e){return t(e,null)}return t(null,r)}))},t.loadSync=function(t){return Kn(Pt(e("fs").readFileSync(t)))},Object.defineProperty(t,"__esModule",{value:!0})}("object"==typeof n&&void 0!==t?n:this.opentype={})}).call(this,e("buffer").Buffer)},{buffer:4,fs:2}],237:[function(e,t,n){(function(e){function t(e,t){for(var n=0,r=e.length-1;0<=r;r--){var i=e[r];"."===i?e.splice(r,1):".."===i?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n--;)e.unshift("..");return e}function r(e,t){if(e.filter)return e.filter(t);for(var n=[],r=0;r<e.length;r++)t(e[r],r,e)&&n.push(e[r]);return n}n.resolve=function(){for(var n="",i=!1,a=arguments.length-1;-1<=a&&!i;a--){var o=0<=a?arguments[a]:e.cwd();if("string"!=typeof o)throw new TypeError("Arguments to path.resolve must be strings");o&&(n=o+"/"+n,i="/"===o.charAt(0))}return(i?"/":"")+(n=t(r(n.split("/"),(function(e){return!!e})),!i).join("/"))||"."},n.normalize=function(e){var a=n.isAbsolute(e),o="/"===i(e,-1);return(e=t(r(e.split("/"),(function(e){return!!e})),!a).join("/"))||a||(e="."),e&&o&&(e+="/"),(a?"/":"")+e},n.isAbsolute=function(e){return"/"===e.charAt(0)},n.join=function(){var e=Array.prototype.slice.call(arguments,0);return n.normalize(r(e,(function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e})).join("/"))},n.relative=function(e,t){function r(e){for(var t=0;t<e.length&&""===e[t];t++);for(var n=e.length-1;0<=n&&""===e[n];n--);return n<t?[]:e.slice(t,n-t+1)}e=n.resolve(e).substr(1),t=n.resolve(t).substr(1);for(var i=r(e.split("/")),a=r(t.split("/")),o=Math.min(i.length,a.length),s=o,u=0;u<o;u++)if(i[u]!==a[u]){s=u;break}var c=[];for(u=s;u<i.length;u++)c.push("..");return(c=c.concat(a.slice(s))).join("/")},n.sep="/",n.delimiter=":",n.dirname=function(e){if("string"!=typeof e&&(e+=""),0===e.length)return".";for(var t=e.charCodeAt(0),n=47===t,r=-1,i=!0,a=e.length-1;1<=a;--a)if(47===(t=e.charCodeAt(a))){if(!i){r=a;break}}else i=!1;return-1===r?n?"/":".":n&&1===r?"/":e.slice(0,r)},n.basename=function(e,t){var n=function(e){"string"!=typeof e&&(e+="");var t,n=0,r=-1,i=!0;for(t=e.length-1;0<=t;--t)if(47===e.charCodeAt(t)){if(!i){n=t+1;break}}else-1===r&&(i=!1,r=t+1);return-1===r?"":e.slice(n,r)}(e);return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},n.extname=function(e){"string"!=typeof e&&(e+="");for(var t=-1,n=0,r=-1,i=!0,a=0,o=e.length-1;0<=o;--o){var s=e.charCodeAt(o);if(47===s){if(i)continue;n=o+1;break}-1===r&&(i=!1,r=o+1),46===s?-1===t?t=o:1!==a&&(a=1):-1!==t&&(a=-1)}return-1===t||-1===r||0===a||1===a&&t===r-1&&t===n+1?"":e.slice(t,r)};var i=function(e,t,n){return e.substr(t,n)}}).call(this,e("_process"))},{_process:238}],238:[function(e,t,n){var r,i,a=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function u(e){if(r===setTimeout)return setTimeout(e,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(e){r=o}try{i="function"==typeof clearTimeout?clearTimeout:s}catch(e){i=s}}();var c,l=[],f=!1,d=-1;function h(){f&&c&&(f=!1,c.length?l=c.concat(l):d=-1,l.length&&p())}function p(){if(!f){var e=u(h);f=!0;for(var t=l.length;t;){for(c=l,l=[];++d<t;)c&&c[d].run();d=-1,t=l.length}c=null,f=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function v(){}a.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new m(e,t)),1!==l.length||f||u(p)},m.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=v,a.addListener=v,a.once=v,a.off=v,a.removeListener=v,a.removeAllListeners=v,a.emit=v,a.prependListener=v,a.prependOnceListener=v,a.listeners=function(e){return[]},a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},{}],239:[function(e,t,n){!function(e){"use strict";if(!e.fetch){var t="URLSearchParams"in e,n="Symbol"in e&&"iterator"in Symbol,r="FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),i="FormData"in e,a="ArrayBuffer"in e;if(a)var o=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],s=function(e){return e&&DataView.prototype.isPrototypeOf(e)},u=ArrayBuffer.isView||function(e){return e&&-1<o.indexOf(Object.prototype.toString.call(e))};p.prototype.append=function(e,t){e=f(e),t=d(t);var n=this.map[e];this.map[e]=n?n+","+t:t},p.prototype.delete=function(e){delete this.map[f(e)]},p.prototype.get=function(e){return e=f(e),this.has(e)?this.map[e]:null},p.prototype.has=function(e){return this.map.hasOwnProperty(f(e))},p.prototype.set=function(e,t){this.map[f(e)]=d(t)},p.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},p.prototype.keys=function(){var e=[];return this.forEach((function(t,n){e.push(n)})),h(e)},p.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),h(e)},p.prototype.entries=function(){var e=[];return this.forEach((function(t,n){e.push([n,t])})),h(e)},n&&(p.prototype[Symbol.iterator]=p.prototype.entries);var c=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];x.prototype.clone=function(){return new x(this,{body:this._bodyInit})},b.call(x.prototype),b.call(_.prototype),_.prototype.clone=function(){return new _(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new p(this.headers),url:this.url})},_.error=function(){var e=new _(null,{status:0,statusText:""});return e.type="error",e};var l=[301,302,303,307,308];_.redirect=function(e,t){if(-1===l.indexOf(t))throw new RangeError("Invalid status code");return new _(null,{status:t,headers:{location:e}})},e.Headers=p,e.Request=x,e.Response=_,e.fetch=function(e,t){return new Promise((function(n,i){var a=new x(e,t),o=new XMLHttpRequest;o.onload=function(){var e,t,r={status:o.status,statusText:o.statusText,headers:(e=o.getAllResponseHeaders()||"",t=new p,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(e){var n=e.split(":"),r=n.shift().trim();if(r){var i=n.join(":").trim();t.append(r,i)}})),t)};r.url="responseURL"in o?o.responseURL:r.headers.get("X-Request-URL");var i="response"in o?o.response:o.responseText;n(new _(i,r))},o.onerror=function(){i(new TypeError("Network request failed"))},o.ontimeout=function(){i(new TypeError("Network request failed"))},o.open(a.method,a.url,!0),"include"===a.credentials?o.withCredentials=!0:"omit"===a.credentials&&(o.withCredentials=!1),"responseType"in o&&r&&(o.responseType="blob"),a.headers.forEach((function(e,t){o.setRequestHeader(t,e)})),o.send(void 0===a._bodyInit?null:a._bodyInit)}))},e.fetch.polyfill=!0}function f(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function d(e){return"string"!=typeof e&&(e=String(e)),e}function h(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return n&&(t[Symbol.iterator]=function(){return t}),t}function p(e){this.map={},e instanceof p?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function m(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function v(e){return new Promise((function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}}))}function g(e){var t=new FileReader,n=v(t);return t.readAsArrayBuffer(e),n}function y(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function b(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e)if("string"==typeof e)this._bodyText=e;else if(r&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(i&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(t&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(a&&r&&s(e))this._bodyArrayBuffer=y(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!a||!ArrayBuffer.prototype.isPrototypeOf(e)&&!u(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=y(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},r&&(this.blob=function(){var e=m(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?m(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(g)}),this.text=function(){var e,t,n,r=m(this);if(r)return r;if(this._bodyBlob)return e=this._bodyBlob,n=v(t=new FileReader),t.readAsText(e),n;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),n=new Array(t.length),r=0;r<t.length;r++)n[r]=String.fromCharCode(t[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},i&&(this.formData=function(){return this.text().then(w)}),this.json=function(){return this.text().then(JSON.parse)},this}function x(e,t){var n,r,i=(t=t||{}).body;if(e instanceof x){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new p(e.headers)),this.method=e.method,this.mode=e.mode,i||null==e._bodyInit||(i=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new p(t.headers)),this.method=(r=(n=t.method||this.method||"GET").toUpperCase(),-1<c.indexOf(r)?r:n),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function w(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var n=e.split("="),r=n.shift().replace(/\+/g," "),i=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(r),decodeURIComponent(i))}})),t}function _(e,t){t=t||{},this.type="default",this.status=void 0===t.status?200:t.status,this.ok=200<=this.status&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new p(t.headers),this.url=t.url||"",this._initBody(e)}}("undefined"!=typeof self?self:this)},{}],240:[function(e,t,n){"use strict";e("core-js/modules/es.function.name"),e("core-js/modules/es.object.to-string"),e("core-js/modules/es.regexp.exec"),e("core-js/modules/es.regexp.to-string"),e("core-js/modules/es.string.split"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=o(e("../core/main")),a=o(e("../color/color_conversion"));function o(e){return e&&e.__esModule?e:{default:e}}var s=[{h:0,s:0,b:.8275,name:"gray"},{h:0,s:0,b:.8627,name:"gray"},{h:0,s:0,b:.7529,name:"gray"},{h:.0167,s:.1176,b:1,name:"light pink"}],u=[{h:0,s:0,b:0,name:"black"},{h:0,s:0,b:.5,name:"gray"},{h:0,s:0,b:1,name:"white"},{h:0,s:.5,b:.5,name:"dark maroon"},{h:0,s:.5,b:1,name:"salmon pink"},{h:0,s:1,b:0,name:"black"},{h:0,s:1,b:.5,name:"dark red"},{h:0,s:1,b:1,name:"red"},{h:5,s:0,b:1,name:"very light peach"},{h:5,s:.5,b:.5,name:"brown"},{h:5,s:.5,b:1,name:"peach"},{h:5,s:1,b:.5,name:"brick red"},{h:5,s:1,b:1,name:"crimson"},{h:10,s:0,b:1,name:"light peach"},{h:10,s:.5,b:.5,name:"brown"},{h:10,s:.5,b:1,name:"light orange"},{h:10,s:1,b:.5,name:"brown"},{h:10,s:1,b:1,name:"orange"},{h:15,s:0,b:1,name:"very light yellow"},{h:15,s:.5,b:.5,name:"olive green"},{h:15,s:.5,b:1,name:"light yellow"},{h:15,s:1,b:0,name:"dark olive green"},{h:15,s:1,b:.5,name:"olive green"},{h:15,s:1,b:1,name:"yellow"},{h:20,s:0,b:1,name:"very light yellow"},{h:20,s:.5,b:.5,name:"olive green"},{h:20,s:.5,b:1,name:"light yellow green"},{h:20,s:1,b:0,name:"dark olive green"},{h:20,s:1,b:.5,name:"dark yellow green"},{h:20,s:1,b:1,name:"yellow green"},{h:25,s:.5,b:.5,name:"dark yellow green"},{h:25,s:.5,b:1,name:"light green"},{h:25,s:1,b:.5,name:"dark green"},{h:25,s:1,b:1,name:"green"},{h:30,s:.5,b:1,name:"light green"},{h:30,s:1,b:.5,name:"dark green"},{h:30,s:1,b:1,name:"green"},{h:35,s:0,b:.5,name:"light green"},{h:35,s:0,b:1,name:"very light green"},{h:35,s:.5,b:.5,name:"dark green"},{h:35,s:.5,b:1,name:"light green"},{h:35,s:1,b:0,name:"very dark green"},{h:35,s:1,b:.5,name:"dark green"},{h:35,s:1,b:1,name:"green"},{h:40,s:0,b:1,name:"very light green"},{h:40,s:.5,b:.5,name:"dark green"},{h:40,s:.5,b:1,name:"light green"},{h:40,s:1,b:.5,name:"dark green"},{h:40,s:1,b:1,name:"green"},{h:45,s:.5,b:1,name:"light turquoise"},{h:45,s:1,b:.5,name:"dark turquoise"},{h:45,s:1,b:1,name:"turquoise"},{h:50,s:0,b:1,name:"light sky blue"},{h:50,s:.5,b:.5,name:"dark cyan"},{h:50,s:.5,b:1,name:"light cyan"},{h:50,s:1,b:.5,name:"dark cyan"},{h:50,s:1,b:1,name:"cyan"},{h:55,s:0,b:1,name:"light sky blue"},{h:55,s:.5,b:1,name:"light sky blue"},{h:55,s:1,b:.5,name:"dark blue"},{h:55,s:1,b:1,name:"sky blue"},{h:60,s:0,b:.5,name:"gray"},{h:60,s:0,b:1,name:"very light blue"},{h:60,s:.5,b:.5,name:"blue"},{h:60,s:.5,b:1,name:"light blue"},{h:60,s:1,b:.5,name:"navy blue"},{h:60,s:1,b:1,name:"blue"},{h:65,s:0,b:1,name:"lavender"},{h:65,s:.5,b:.5,name:"navy blue"},{h:65,s:.5,b:1,name:"light purple"},{h:65,s:1,b:.5,name:"dark navy blue"},{h:65,s:1,b:1,name:"blue"},{h:70,s:0,b:1,name:"lavender"},{h:70,s:.5,b:.5,name:"navy blue"},{h:70,s:.5,b:1,name:"lavender blue"},{h:70,s:1,b:.5,name:"dark navy blue"},{h:70,s:1,b:1,name:"blue"},{h:75,s:.5,b:1,name:"lavender"},{h:75,s:1,b:.5,name:"dark purple"},{h:75,s:1,b:1,name:"purple"},{h:80,s:.5,b:1,name:"pinkish purple"},{h:80,s:1,b:.5,name:"dark purple"},{h:80,s:1,b:1,name:"purple"},{h:85,s:0,b:1,name:"light pink"},{h:85,s:.5,b:.5,name:"purple"},{h:85,s:.5,b:1,name:"light fuchsia"},{h:85,s:1,b:.5,name:"dark fuchsia"},{h:85,s:1,b:1,name:"fuchsia"},{h:90,s:.5,b:.5,name:"dark fuchsia"},{h:90,s:.5,b:1,name:"hot pink"},{h:90,s:1,b:.5,name:"dark fuchsia"},{h:90,s:1,b:1,name:"fuchsia"},{h:95,s:0,b:1,name:"pink"},{h:95,s:.5,b:1,name:"light pink"},{h:95,s:1,b:.5,name:"dark magenta"},{h:95,s:1,b:1,name:"magenta"}];i.default.prototype._rgbColorName=function(e){var t=a.default._rgbaToHSBA(e);return function(e){var t;if(0!==e[0]){e[0]=Math.round(100*e[0]);var n=e[0].toString().split(""),i=n.length-1;n[i]=parseInt(n[i]),n[i]<2.5?n[i]=0:2.5<=n[i]&&n[i]<7.5&&(n[i]=5),2===n.length?(n[0]=parseInt(n[0]),7.5<=n[i]&&(n[i]=0,n[0]=n[0]+1),e[0]=10*n[0]+n[1]):7.5<=n[i]?e[0]=10:e[0]=n[i]}e[2]=e[2]/255;for(var a=e.length-1;1<=a;a--)e[a]<=.25?e[a]=0:.25<e[a]&&e[a]<.75?e[a]=.5:e[a]=1;if(0===e[0]&&0===e[1]&&1===e[2]){for(var o=2;0<=o;o--)r[o]=Math.round(1e4*r[o])/1e4;for(var c=0;c<s.length;c++){if(s[c].h===r[0]&&s[c].s===r[1]&&s[c].b===r[2]){t=s[c].name;break}t="white"}}else for(var l=0;l<u.length;l++)if(u[l].h===e[0]&&u[l].s===e[1]&&u[l].b===e[2]){t=u[l].name;break}return t}([(r=t)[0],t[1],t[2]])};var c=i.default;n.default=c},{"../color/color_conversion":246,"../core/main":260,"core-js/modules/es.function.name":163,"core-js/modules/es.object.to-string":174,"core-js/modules/es.regexp.exec":178,"core-js/modules/es.regexp.to-string":179,"core-js/modules/es.string.split":188}],241:[function(e,t,n){"use strict";e("core-js/modules/es.array.concat"),e("core-js/modules/es.regexp.exec"),e("core-js/modules/es.string.ends-with"),e("core-js/modules/es.string.replace"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=(r=e("../core/main"))&&r.__esModule?r:{default:r},a="_Description",o="_fallbackDesc",s="_fallbackTable",u="_Label",c="_labelDesc",l="_labelTable";function f(e){if("label"===e||"fallback"===e)throw new Error("description should not be LABEL or FALLBACK");return e.endsWith(".")||e.endsWith(";")||e.endsWith(",")||e.endsWith("?")||e.endsWith("!")||(e+="."),e}i.default.prototype.describe=function(e,t){if(i.default._validateParameters("describe",arguments),"string"==typeof e){var n=this.canvas.id;e=f(e),this.dummyDOM||(this.dummyDOM=document.getElementById(n).parentNode),this.descriptions||(this.descriptions={}),this.descriptions.fallback?this.descriptions.fallback.innerHTML!==e&&(this.descriptions.fallback.innerHTML=e):this._describeHTML("fallback",e),t===this.LABEL&&(this.descriptions.label?this.descriptions.label.innerHTML!==e&&(this.descriptions.label.innerHTML=e):this._describeHTML("label",e))}},i.default.prototype.describeElement=function(e,t,n){if(i.default._validateParameters("describeElement",arguments),"string"==typeof t&&"string"==typeof e){var r=this.canvas.id;t=f(t);var a=function(e){if("label"===e||"fallback"===e)throw new Error("element name should not be LABEL or FALLBACK");return e.endsWith(".")||e.endsWith(";")||e.endsWith(",")?e=e.replace(/.$/,":"):e.endsWith(":")||(e+=":"),e}(e);e=e.replace(/[^a-zA-Z0-9 ]/g,"");var o='<th scope="row">'.concat(a,"</th><td>").concat(t,"</td>");this.dummyDOM||(this.dummyDOM=document.getElementById(r).parentNode),this.descriptions?this.descriptions.fallbackElements||(this.descriptions.fallbackElements={}):this.descriptions={fallbackElements:{}},this.descriptions.fallbackElements[e]?this.descriptions.fallbackElements[e].innerHTML!==o&&(this.descriptions.fallbackElements[e].innerHTML=o):this._describeElementHTML("fallback",e,o),n===this.LABEL&&(this.descriptions.labelElements||(this.descriptions.labelElements={}),this.descriptions.labelElements[e]?this.descriptions.labelElements[e].innerHTML!==o&&(this.descriptions.labelElements[e].innerHTML=o):this._describeElementHTML("label",e,o))}},i.default.prototype._describeHTML=function(e,t){var n=this.canvas.id;if("fallback"===e){if(this.dummyDOM.querySelector("#".concat(n+a)))this.dummyDOM.querySelector("#"+n+s).insertAdjacentHTML("beforebegin",'<p id="'.concat(n+o,'"></p>'));else{var r='<div id="'.concat(n).concat(a,'" role="region" aria-label="Canvas Description"><p id="').concat(n).concat(o,'"></p></div>');this.dummyDOM.querySelector("#".concat(n,"accessibleOutput"))?this.dummyDOM.querySelector("#".concat(n,"accessibleOutput")).insertAdjacentHTML("beforebegin",r):this.dummyDOM.querySelector("#".concat(n)).innerHTML=r}return this.descriptions.fallback=this.dummyDOM.querySelector("#".concat(n).concat(o)),void(this.descriptions.fallback.innerHTML=t)}if("label"===e){if(this.dummyDOM.querySelector("#".concat(n+u)))this.dummyDOM.querySelector("#".concat(n+l))&&this.dummyDOM.querySelector("#".concat(n+l)).insertAdjacentHTML("beforebegin",'<p id="'.concat(n).concat(c,'"></p>'));else{var i='<div id="'.concat(n).concat(u,'" class="p5Label"><p id="').concat(n).concat(c,'"></p></div>');this.dummyDOM.querySelector("#".concat(n,"accessibleOutputLabel"))?this.dummyDOM.querySelector("#".concat(n,"accessibleOutputLabel")).insertAdjacentHTML("beforebegin",i):this.dummyDOM.querySelector("#"+n).insertAdjacentHTML("afterend",i)}return this.descriptions.label=this.dummyDOM.querySelector("#"+n+c),void(this.descriptions.label.innerHTML=t)}},i.default.prototype._describeElementHTML=function(e,t,n){var r=this.canvas.id;if("fallback"===e){if(this.dummyDOM.querySelector("#".concat(r+a)))this.dummyDOM.querySelector("#"+r+s)||this.dummyDOM.querySelector("#"+r+o).insertAdjacentHTML("afterend",'<table id="'.concat(r).concat(s,'"><caption>Canvas elements and their descriptions</caption></table>'));else{var i='<div id="'.concat(r).concat(a,'" role="region" aria-label="Canvas Description"><table id="').concat(r).concat(s,'"><caption>Canvas elements and their descriptions</caption></table></div>');this.dummyDOM.querySelector("#".concat(r,"accessibleOutput"))?this.dummyDOM.querySelector("#".concat(r,"accessibleOutput")).insertAdjacentHTML("beforebegin",i):this.dummyDOM.querySelector("#"+r).innerHTML=i}var f=document.createElement("tr");return f.id=r+"_fte_"+t,this.dummyDOM.querySelector("#"+r+s).appendChild(f),this.descriptions.fallbackElements[t]=this.dummyDOM.querySelector("#".concat(r).concat("_fte_").concat(t)),void(this.descriptions.fallbackElements[t].innerHTML=n)}if("label"===e){if(this.dummyDOM.querySelector("#".concat(r+u)))this.dummyDOM.querySelector("#".concat(r+l))||this.dummyDOM.querySelector("#"+r+c).insertAdjacentHTML("afterend",'<table id="'.concat(r+l,'"></table>'));else{var d='<div id="'.concat(r).concat(u,'" class="p5Label"><table id="').concat(r).concat(l,'"></table></div>');this.dummyDOM.querySelector("#".concat(r,"accessibleOutputLabel"))?this.dummyDOM.querySelector("#".concat(r,"accessibleOutputLabel")).insertAdjacentHTML("beforebegin",d):this.dummyDOM.querySelector("#"+r).insertAdjacentHTML("afterend",d)}var h=document.createElement("tr");h.id=r+"_lte_"+t,this.dummyDOM.querySelector("#"+r+l).appendChild(h),this.descriptions.labelElements[t]=this.dummyDOM.querySelector("#".concat(r).concat("_lte_").concat(t)),this.descriptions.labelElements[t].innerHTML=n}};var d=i.default;n.default=d},{"../core/main":260,"core-js/modules/es.array.concat":148,"core-js/modules/es.regexp.exec":178,"core-js/modules/es.string.ends-with":181,"core-js/modules/es.string.replace":186}],242:[function(e,t,n){"use strict";e("core-js/modules/es.array.concat"),e("core-js/modules/es.array.map"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=(r=e("../core/main"))&&r.__esModule?r:{default:r};i.default.prototype._updateGridOutput=function(e){if(this.dummyDOM.querySelector("#".concat(e,"_summary"))){var t=this._accessibleOutputs[e],n=function(e,t){var n="",r="",i=0;for(var a in t){var o=0;for(var s in t[a]){var u='<li id="'.concat(e,"shape").concat(i,'">').concat(t[a][s].color," ").concat(a,",");"line"===a?u+=" location = ".concat(t[a][s].pos,", length = ").concat(t[a][s].length," pixels"):(u+=" location = ".concat(t[a][s].pos),"point"!==a&&(u+=", area = ".concat(t[a][s].area," %")),u+="</li>"),n+=u,o++,i++}r=1<o?"".concat(r," ").concat(o," ").concat(a,"s"):"".concat(r," ").concat(o," ").concat(a)}return{numShapes:[i,r],details:n}}(e,this.ingredients.shapes),r=function(e,t,n,r){var i="".concat(t," canvas, ").concat(n," by ").concat(r," pixels, contains ").concat(e[0]);return 1===e[0]?"".concat(i," shape: ").concat(e[1]):"".concat(i," shapes: ").concat(e[1])}(n.numShapes,this.ingredients.colors.background,this.width,this.height),i=function(e,t){var n=0,r="",i=Array.apply(null,Array(10)).map((function(){}));for(var a in i)i[a]=Array.apply(null,Array(10)).map((function(){}));for(var o in t)for(var s in t[o]){var u;u="line"!==o?'<a href="#'.concat(e,"shape").concat(n,'">').concat(t[o][s].color," ").concat(o,"</a>"):'<a href="#'.concat(e,"shape").concat(n,'">').concat(t[o][s].color," ").concat(o," midpoint</a>"),i[t[o][s].loc.locY][t[o][s].loc.locX]?i[t[o][s].loc.locY][t[o][s].loc.locX]=i[t[o][s].loc.locY][t[o][s].loc.locX]+"  "+u:i[t[o][s].loc.locY][t[o][s].loc.locX]=u,n++}for(var c in i){var l="<tr>";for(var f in i[c])l+="<td>",void 0!==i[c][f]&&(l+=i[c][f]),l+="</td>";r=r+l+"</tr>"}return r}(e,this.ingredients.shapes);r!==t.summary.innerHTML&&(t.summary.innerHTML=r),i!==t.map.innerHTML&&(t.map.innerHTML=i),n.details!==t.shapeDetails.innerHTML&&(t.shapeDetails.innerHTML=n.details),this._accessibleOutputs[e]=t}};var a=i.default;n.default=a},{"../core/main":260,"core-js/modules/es.array.concat":148,"core-js/modules/es.array.map":159}],243:[function(e,t,n){"use strict";e("core-js/modules/es.array.concat"),e("core-js/modules/es.array.fill"),e("core-js/modules/es.array.map"),e("core-js/modules/es.number.to-fixed"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=(r=e("../core/main"))&&r.__esModule?r:{default:r};function a(e,t,n){return e[0]<.4*t?e[1]<.4*n?"top left":e[1]>.6*n?"bottom left":"mid left":e[0]>.6*t?e[1]<.4*n?"top right":e[1]>.6*n?"bottom right":"mid right":e[1]<.4*n?"top middle":e[1]>.6*n?"bottom middle":"middle"}function o(e,t,n){var r=Math.floor(e[0]/t*10),i=Math.floor(e[1]/n*10);return 10===r&&--r,10===i&&--i,{locX:r,locY:i}}i.default.prototype.textOutput=function(e){i.default._validateParameters("textOutput",arguments),this._accessibleOutputs.text||(this._accessibleOutputs.text=!0,this._createOutput("textOutput","Fallback"),e===this.LABEL&&(this._accessibleOutputs.textLabel=!0,this._createOutput("textOutput","Label")))},i.default.prototype.gridOutput=function(e){i.default._validateParameters("gridOutput",arguments),this._accessibleOutputs.grid||(this._accessibleOutputs.grid=!0,this._createOutput("gridOutput","Fallback"),e===this.LABEL&&(this._accessibleOutputs.gridLabel=!0,this._createOutput("gridOutput","Label")))},i.default.prototype._addAccsOutput=function(){return this._accessibleOutputs||(this._accessibleOutputs={text:!1,grid:!1,textLabel:!1,gridLabel:!1}),this._accessibleOutputs.grid||this._accessibleOutputs.text},i.default.prototype._createOutput=function(e,t){var n,r,i,a=this.canvas.id;this.ingredients||(this.ingredients={shapes:{},colors:{background:"white",fill:"white",stroke:"black"},pShapes:""}),this.dummyDOM||(this.dummyDOM=document.getElementById(a).parentNode);var o="";"Fallback"===t?(n=a+e,r=a+"accessibleOutput",this.dummyDOM.querySelector("#".concat(r))||(this.dummyDOM.querySelector("#".concat(a,"_Description"))?this.dummyDOM.querySelector("#".concat(a,"_Description")).insertAdjacentHTML("afterend",'<div id="'.concat(r,'" role="region" aria-label="Canvas Outputs"></div>')):this.dummyDOM.querySelector("#".concat(a)).innerHTML='<div id="'.concat(r,'" role="region" aria-label="Canvas Outputs"></div>'))):"Label"===t&&(n=a+e+(o=t),r=a+"accessibleOutput"+t,this.dummyDOM.querySelector("#".concat(r))||(this.dummyDOM.querySelector("#".concat(a,"_Label"))?this.dummyDOM.querySelector("#".concat(a,"_Label")).insertAdjacentHTML("afterend",'<div id="'.concat(r,'"></div>')):this.dummyDOM.querySelector("#".concat(a)).insertAdjacentHTML("afterend",'<div id="'.concat(r,'"></div>')))),this._accessibleOutputs[n]={},"textOutput"===e?(o="#".concat(a,"gridOutput").concat(o),i='<div id="'.concat(n,'">Text Output<div id="').concat(n,'Summary" aria-label="text output summary"><p id="').concat(n,'_summary"></p><ul id="').concat(n,'_list"></ul></div><table id="').concat(n,'_shapeDetails" summary="text output shape details"></table></div>'),this.dummyDOM.querySelector(o)?this.dummyDOM.querySelector(o).insertAdjacentHTML("beforebegin",i):this.dummyDOM.querySelector("#".concat(r)).innerHTML=i,this._accessibleOutputs[n].list=this.dummyDOM.querySelector("#".concat(n,"_list"))):"gridOutput"===e&&(o="#".concat(a,"textOutput").concat(o),i='<div id="'.concat(n,'">Grid Output<p id="').concat(n,'_summary" aria-label="grid output summary"><table id="').concat(n,'_map" summary="grid output content"></table><ul id="').concat(n,'_shapeDetails" aria-label="grid output shape details"></ul></div>'),this.dummyDOM.querySelector(o)?this.dummyDOM.querySelector(o).insertAdjacentHTML("afterend",i):this.dummyDOM.querySelector("#".concat(r)).innerHTML=i,this._accessibleOutputs[n].map=this.dummyDOM.querySelector("#".concat(n,"_map"))),this._accessibleOutputs[n].shapeDetails=this.dummyDOM.querySelector("#".concat(n,"_shapeDetails")),this._accessibleOutputs[n].summary=this.dummyDOM.querySelector("#".concat(n,"_summary"))},i.default.prototype._updateAccsOutput=function(){var e=this.canvas.id;JSON.stringify(this.ingredients.shapes)!==this.ingredients.pShapes&&(this.ingredients.pShapes=JSON.stringify(this.ingredients.shapes),this._accessibleOutputs.text&&this._updateTextOutput(e+"textOutput"),this._accessibleOutputs.grid&&this._updateGridOutput(e+"gridOutput"),this._accessibleOutputs.textLabel&&this._updateTextOutput(e+"textOutputLabel"),this._accessibleOutputs.gridLabel&&this._updateGridOutput(e+"gridOutputLabel"))},i.default.prototype._accsBackground=function(e){this.ingredients.pShapes=JSON.stringify(this.ingredients.shapes),this.ingredients.shapes={},this.ingredients.colors.backgroundRGBA!==e&&(this.ingredients.colors.backgroundRGBA=e,this.ingredients.colors.background=this._rgbColorName(e))},i.default.prototype._accsCanvasColors=function(e,t){"fill"===e?this.ingredients.colors.fillRGBA!==t&&(this.ingredients.colors.fillRGBA=t,this.ingredients.colors.fill=this._rgbColorName(t)):"stroke"===e&&this.ingredients.colors.strokeRGBA!==t&&(this.ingredients.colors.strokeRGBA=t,this.ingredients.colors.stroke=this._rgbColorName(t))},i.default.prototype._accsOutput=function(e,t){"ellipse"===e&&t[2]===t[3]?e="circle":"rectangle"===e&&t[2]===t[3]&&(e="square");var n={},r=!0,i=function(e,t){var n,r;return r="rectangle"===e||"ellipse"===e||"arc"===e||"circle"===e||"square"===e?(n=Math.round(t[0]+t[2]/2),Math.round(t[1]+t[3]/2)):"triangle"===e?(n=(t[0]+t[2]+t[4])/3,(t[1]+t[3]+t[5])/3):"quadrilateral"===e?(n=(t[0]+t[2]+t[4]+t[6])/4,(t[1]+t[3]+t[5]+t[7])/4):"line"===e?(n=(t[0]+t[2])/2,(t[1]+t[3])/2):(n=t[0],t[1]),[n,r]}(e,t);if("line"===e){n.color=this.ingredients.colors.stroke,n.length=Math.round(this.dist(t[0],t[1],t[2],t[3]));var s=a([t[0],[1]],this.width,this.height),u=a([t[2],[3]],this.width,this.height);n.loc=o(i,this.width,this.height),n.pos=s===u?"at ".concat(s):"from ".concat(s," to ").concat(u)}else"point"===e?n.color=this.ingredients.colors.stroke:(n.color=this.ingredients.colors.fill,n.area=function(e,t,n,r){var i=0;if("arc"===e){var a=((t[5]-t[4])%(2*Math.PI)+2*Math.PI)%(2*Math.PI);if(i=a*t[2]*t[3]/8,"open"===t[6]||"chord"===t[6]){var o=t[0],s=t[1],u=t[0]+t[2]/2*Math.cos(t[4]).toFixed(2),c=t[1]+t[3]/2*Math.sin(t[4]).toFixed(2),l=t[0]+t[2]/2*Math.cos(t[5]).toFixed(2),f=t[1]+t[3]/2*Math.sin(t[5]).toFixed(2),d=Math.abs(o*(c-f)+u*(f-s)+l*(s-c))/2;a>Math.PI?i+=d:i-=d}}else"ellipse"===e||"circle"===e?i=3.14*t[2]/2*t[3]/2:"line"===e||"point"===e?i=0:"quadrilateral"===e?i=Math.abs((t[6]+t[0])*(t[7]-t[1])+(t[0]+t[2])*(t[1]-t[3])+(t[2]+t[4])*(t[3]-t[5])+(t[4]+t[6])*(t[5]-t[7]))/2:"rectangle"===e||"square"===e?i=t[2]*t[3]:"triangle"===e&&(i=Math.abs(t[0]*(t[3]-t[5])+t[2]*(t[5]-t[1])+t[4]*(t[1]-t[3]))/2);return Math.round(100*i/(n*r))}(e,t,this.width,this.height)),n.pos=a(i,this.width,this.height),n.loc=o(i,this.width,this.height);if(this.ingredients.shapes[e]){if(this.ingredients.shapes[e]!==[n]){for(var c in this.ingredients.shapes[e])JSON.stringify(this.ingredients.shapes[e][c])===JSON.stringify(n)&&(r=!1);!0===r&&this.ingredients.shapes[e].push(n)}}else this.ingredients.shapes[e]=[n]};var s=i.default;n.default=s},{"../core/main":260,"core-js/modules/es.array.concat":148,"core-js/modules/es.array.fill":150,"core-js/modules/es.array.map":159,"core-js/modules/es.number.to-fixed":169}],244:[function(e,t,n){"use strict";e("core-js/modules/es.array.concat"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=(r=e("../core/main"))&&r.__esModule?r:{default:r};i.default.prototype._updateTextOutput=function(e){if(this.dummyDOM.querySelector("#".concat(e,"_summary"))){var t=this._accessibleOutputs[e],n=function(e,t){var n="",r=0;for(var i in t)for(var a in t[i]){var o='<li><a href="#'.concat(e,"shape").concat(r,'">').concat(t[i][a].color," ").concat(i,"</a>");"line"===i?o+=", ".concat(t[i][a].pos,", ").concat(t[i][a].length," pixels long.</li>"):(o+=", at ".concat(t[i][a].pos),"point"!==i&&(o+=", covering ".concat(t[i][a].area,"% of the canvas")),o+=".</li>"),n+=o,r++}return{numShapes:r,listShapes:n}}(e,this.ingredients.shapes),r=function(e,t,n,r){var i="Your output is a, ".concat(n," by ").concat(r," pixels, ").concat(t," canvas containing the following");return 1===e?"".concat(i," shape:"):"".concat(i," ").concat(e," shapes:")}(n.numShapes,this.ingredients.colors.background,this.width,this.height),i=function(e,t){var n="",r=0;for(var i in t)for(var a in t[i]){var o='<tr id="'.concat(e,"shape").concat(r,'"><th>').concat(t[i][a].color," ").concat(i,"</th>");"line"===i?o+="<td>location = ".concat(t[i][a].pos,"</td><td>length = ").concat(t[i][a].length," pixels</td></tr>"):(o+="<td>location = ".concat(t[i][a].pos,"</td>"),"point"!==i&&(o+="<td> area = ".concat(t[i][a].area,"%</td>")),o+="</tr>"),n+=o,r++}return n}(e,this.ingredients.shapes);r!==t.summary.innerHTML&&(t.summary.innerHTML=r),n.listShapes!==t.list.innerHTML&&(t.list.innerHTML=n.listShapes),i!==t.shapeDetails.innerHTML&&(t.shapeDetails.innerHTML=i),this._accessibleOutputs[e]=t}};var a=i.default;n.default=a},{"../core/main":260,"core-js/modules/es.array.concat":148}],245:[function(e,t,n){"use strict";var r,i=(r=e("./core/main"))&&r.__esModule?r:{default:r};e("./core/constants"),e("./core/environment"),e("./core/friendly_errors/stacktrace"),e("./core/friendly_errors/validate_params"),e("./core/friendly_errors/file_errors"),e("./core/friendly_errors/fes_core"),e("./core/helpers"),e("./core/legacy"),e("./core/preload"),e("./core/p5.Element"),e("./core/p5.Graphics"),e("./core/p5.Renderer"),e("./core/p5.Renderer2D"),e("./core/rendering"),e("./core/shim"),e("./core/structure"),e("./core/transform"),e("./core/shape/2d_primitives"),e("./core/shape/attributes"),e("./core/shape/curves"),e("./core/shape/vertex"),e("./accessibility/outputs"),e("./accessibility/textOutput"),e("./accessibility/gridOutput"),e("./accessibility/color_namer"),e("./color/color_conversion"),e("./color/creating_reading"),e("./color/p5.Color"),e("./color/setting"),e("./data/p5.TypedDict"),e("./data/local_storage.js"),e("./dom/dom"),e("./accessibility/describe"),e("./events/acceleration"),e("./events/keyboard"),e("./events/mouse"),e("./events/touch"),e("./image/filters"),e("./image/image"),e("./image/loading_displaying"),e("./image/p5.Image"),e("./image/pixels"),e("./io/files"),e("./io/p5.Table"),e("./io/p5.TableRow"),e("./io/p5.XML"),e("./math/calculation"),e("./math/math"),e("./math/noise"),e("./math/p5.Vector"),e("./math/random"),e("./math/trigonometry"),e("./typography/attributes"),e("./typography/loading_displaying"),e("./typography/p5.Font"),e("./utilities/array_functions"),e("./utilities/conversion"),e("./utilities/string_functions"),e("./utilities/time_date"),e("./webgl/3d_primitives"),e("./webgl/interaction"),e("./webgl/light"),e("./webgl/loading"),e("./webgl/material"),e("./webgl/p5.Camera"),e("./webgl/p5.Geometry"),e("./webgl/p5.Matrix"),e("./webgl/p5.RendererGL.Immediate"),e("./webgl/p5.RendererGL"),e("./webgl/p5.RendererGL.Retained"),e("./webgl/p5.Shader"),e("./webgl/p5.RenderBuffer"),e("./webgl/p5.Texture"),e("./webgl/text"),e("./core/init"),t.exports=i.default},{"./accessibility/color_namer":240,"./accessibility/describe":241,"./accessibility/gridOutput":242,"./accessibility/outputs":243,"./accessibility/textOutput":244,"./color/color_conversion":246,"./color/creating_reading":247,"./color/p5.Color":248,"./color/setting":249,"./core/constants":250,"./core/environment":251,"./core/friendly_errors/fes_core":252,"./core/friendly_errors/file_errors":253,"./core/friendly_errors/stacktrace":254,"./core/friendly_errors/validate_params":255,"./core/helpers":256,"./core/init":257,"./core/legacy":259,"./core/main":260,"./core/p5.Element":261,"./core/p5.Graphics":262,"./core/p5.Renderer":263,"./core/p5.Renderer2D":264,"./core/preload":265,"./core/rendering":266,"./core/shape/2d_primitives":267,"./core/shape/attributes":268,"./core/shape/curves":269,"./core/shape/vertex":270,"./core/shim":271,"./core/structure":272,"./core/transform":273,"./data/local_storage.js":274,"./data/p5.TypedDict":275,"./dom/dom":276,"./events/acceleration":277,"./events/keyboard":278,"./events/mouse":279,"./events/touch":280,"./image/filters":281,"./image/image":282,"./image/loading_displaying":283,"./image/p5.Image":284,"./image/pixels":285,"./io/files":286,"./io/p5.Table":287,"./io/p5.TableRow":288,"./io/p5.XML":289,"./math/calculation":290,"./math/math":291,"./math/noise":292,"./math/p5.Vector":293,"./math/random":294,"./math/trigonometry":295,"./typography/attributes":296,"./typography/loading_displaying":297,"./typography/p5.Font":298,"./utilities/array_functions":299,"./utilities/conversion":300,"./utilities/string_functions":301,"./utilities/time_date":302,"./webgl/3d_primitives":303,"./webgl/interaction":304,"./webgl/light":305,"./webgl/loading":306,"./webgl/material":307,"./webgl/p5.Camera":308,"./webgl/p5.Geometry":309,"./webgl/p5.Matrix":310,"./webgl/p5.RenderBuffer":311,"./webgl/p5.RendererGL":314,"./webgl/p5.RendererGL.Immediate":312,"./webgl/p5.RendererGL.Retained":313,"./webgl/p5.Shader":315,"./webgl/p5.Texture":316,"./webgl/text":317}],246:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=(r=e("../core/main"))&&r.__esModule?r:{default:r};i.default.ColorConversion={},i.default.ColorConversion._hsbaToHSLA=function(e){var t=e[0],n=e[1],r=e[2],i=(2-n)*r/2;return 0!=i&&(1==i?n=0:i<.5?n/=2-n:n=n*r/(2-2*i)),[t,n,i,e[3]]},i.default.ColorConversion._hsbaToRGBA=function(e){var t=6*e[0],n=e[1],r=e[2],i=[];if(0===n)i=[r,r,r,e[3]];else{var a,o,s,u=Math.floor(t),c=r*(1-n),l=r*(1-n*(t-u)),f=r*(1-n*(1+u-t));s=1===u?(a=l,o=r,c):2===u?(a=c,o=r,f):3===u?(a=c,o=l,r):4===u?(a=f,o=c,r):5===u?(a=r,o=c,l):(a=r,o=f,c),i=[a,o,s,e[3]]}return i},i.default.ColorConversion._hslaToHSBA=function(e){var t,n=e[0],r=e[1],i=e[2];return[n,r=2*((t=i<.5?(1+r)*i:i+r-i*r)-i)/t,t,e[3]]},i.default.ColorConversion._hslaToRGBA=function(e){var t=6*e[0],n=e[1],r=e[2],i=[];if(0===n)i=[r,r,r,e[3]];else{var a,o=2*r-(a=r<.5?(1+n)*r:r+n-r*n),s=function(e,t,n){return e<0?e+=6:6<=e&&(e-=6),e<1?t+(n-t)*e:e<3?n:e<4?t+(n-t)*(4-e):t};i=[s(2+t,o,a),s(t,o,a),s(t-2,o,a),e[3]]}return i},i.default.ColorConversion._rgbaToHSBA=function(e){var t,n,r=e[0],i=e[1],a=e[2],o=Math.max(r,i,a),s=o-Math.min(r,i,a);return 0==s?n=t=0:(n=s/o,r===o?t=(i-a)/s:i===o?t=2+(a-r)/s:a===o&&(t=4+(r-i)/s),t<0?t+=6:6<=t&&(t-=6)),[t/6,n,o,e[3]]},i.default.ColorConversion._rgbaToHSLA=function(e){var t,n,r=e[0],i=e[1],a=e[2],o=Math.max(r,i,a),s=Math.min(r,i,a),u=o+s,c=o-s;return 0==c?n=t=0:(n=u<1?c/u:c/(2-u),r===o?t=(i-a)/c:i===o?t=2+(a-r)/c:a===o&&(t=4+(r-i)/c),t<0?t+=6:6<=t&&(t-=6)),[t/6,n,u/2,e[3]]};var a=i.default.ColorConversion;n.default=a},{"../core/main":260}],247:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e("core-js/modules/es.array.map"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i,a=(i=e("../core/main"))&&i.__esModule?i:{default:i},o=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var t="function"!=typeof WeakMap?null:new WeakMap;if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,t&&t.set(e,n),n}(e("../core/constants"));e("./p5.Color"),e("../core/friendly_errors/validate_params"),e("../core/friendly_errors/file_errors"),e("../core/friendly_errors/fes_core"),a.default.prototype.alpha=function(e){return a.default._validateParameters("alpha",arguments),this.color(e)._getAlpha()},a.default.prototype.blue=function(e){return a.default._validateParameters("blue",arguments),this.color(e)._getBlue()},a.default.prototype.brightness=function(e){return a.default._validateParameters("brightness",arguments),this.color(e)._getBrightness()},a.default.prototype.color=function(){if(a.default._validateParameters("color",arguments),arguments[0]instanceof a.default.Color)return arguments[0];var e=arguments[0]instanceof Array?arguments[0]:arguments;return new a.default.Color(this,e)},a.default.prototype.green=function(e){return a.default._validateParameters("green",arguments),this.color(e)._getGreen()},a.default.prototype.hue=function(e){return a.default._validateParameters("hue",arguments),this.color(e)._getHue()},a.default.prototype.lerpColor=function(e,t,n){a.default._validateParameters("lerpColor",arguments);var r,i,s,u,c,l,f=this._colorMode,d=this._colorMaxes;if(f===o.RGB)c=e.levels.map((function(e){return e/255})),l=t.levels.map((function(e){return e/255}));else if(f===o.HSB)e._getBrightness(),t._getBrightness(),c=e.hsba,l=t.hsba;else{if(f!==o.HSL)throw new Error("".concat(f,"cannot be used for interpolation."));e._getLightness(),t._getLightness(),c=e.hsla,l=t.hsla}return n=Math.max(Math.min(n,1),0),void 0===this.lerp&&(this.lerp=function(e,t,n){return n*(t-e)+e}),r=this.lerp(c[0],l[0],n),i=this.lerp(c[1],l[1],n),s=this.lerp(c[2],l[2],n),u=this.lerp(c[3],l[3],n),r*=d[f][0],i*=d[f][1],s*=d[f][2],u*=d[f][3],this.color(r,i,s,u)},a.default.prototype.lightness=function(e){return a.default._validateParameters("lightness",arguments),this.color(e)._getLightness()},a.default.prototype.red=function(e){return a.default._validateParameters("red",arguments),this.color(e)._getRed()},a.default.prototype.saturation=function(e){return a.default._validateParameters("saturation",arguments),this.color(e)._getSaturation()};var s=a.default;n.default=s},{"../core/constants":250,"../core/friendly_errors/fes_core":252,"../core/friendly_errors/file_errors":253,"../core/friendly_errors/validate_params":255,"../core/main":260,"./p5.Color":248,"core-js/modules/es.array.map":159}],248:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e("core-js/modules/es.array.join"),e("core-js/modules/es.array.map"),e("core-js/modules/es.array.slice"),e("core-js/modules/es.object.to-string"),e("core-js/modules/es.regexp.constructor"),e("core-js/modules/es.regexp.exec"),e("core-js/modules/es.regexp.to-string"),e("core-js/modules/es.string.trim"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=s(e("../core/main")),a=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var t="function"!=typeof WeakMap?null:new WeakMap;if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,t&&t.set(e,n),n}(e("../core/constants")),o=s(e("./color_conversion"));function s(e){return e&&e.__esModule?e:{default:e}}i.default.Color=function(e,t){if(this._storeModeAndMaxes(e._colorMode,e._colorMaxes),this.mode!==a.RGB&&this.mode!==a.HSL&&this.mode!==a.HSB)throw new Error("".concat(this.mode," is an invalid colorMode."));return this._array=i.default.Color._parseInputs.apply(this,t),this._calculateLevels(),this},i.default.Color.prototype.toString=function(e){var t=this.levels,n=this._array,r=n[3];switch(e){case"#rrggbb":return"#".concat(t[0]<16?"0".concat(t[0].toString(16)):t[0].toString(16),t[1]<16?"0".concat(t[1].toString(16)):t[1].toString(16),t[2]<16?"0".concat(t[2].toString(16)):t[2].toString(16));case"#rrggbbaa":return"#".concat(t[0]<16?"0".concat(t[0].toString(16)):t[0].toString(16),t[1]<16?"0".concat(t[1].toString(16)):t[1].toString(16),t[2]<16?"0".concat(t[2].toString(16)):t[2].toString(16),t[3]<16?"0".concat(t[3].toString(16)):t[3].toString(16));case"#rgb":return"#".concat(Math.round(15*n[0]).toString(16),Math.round(15*n[1]).toString(16),Math.round(15*n[2]).toString(16));case"#rgba":return"#".concat(Math.round(15*n[0]).toString(16),Math.round(15*n[1]).toString(16),Math.round(15*n[2]).toString(16),Math.round(15*n[3]).toString(16));case"rgb":return"rgb(".concat(t[0],", ",t[1],", ",t[2],")");case"rgb%":return"rgb(".concat((100*n[0]).toPrecision(3),"%, ",(100*n[1]).toPrecision(3),"%, ",(100*n[2]).toPrecision(3),"%)");case"rgba%":return"rgba(".concat((100*n[0]).toPrecision(3),"%, ",(100*n[1]).toPrecision(3),"%, ",(100*n[2]).toPrecision(3),"%, ",(100*n[3]).toPrecision(3),"%)");case"hsb":case"hsv":return this.hsba||(this.hsba=o.default._rgbaToHSBA(this._array)),"hsb(".concat(this.hsba[0]*this.maxes[a.HSB][0],", ",this.hsba[1]*this.maxes[a.HSB][1],", ",this.hsba[2]*this.maxes[a.HSB][2],")");case"hsb%":case"hsv%":return this.hsba||(this.hsba=o.default._rgbaToHSBA(this._array)),"hsb(".concat((100*this.hsba[0]).toPrecision(3),"%, ",(100*this.hsba[1]).toPrecision(3),"%, ",(100*this.hsba[2]).toPrecision(3),"%)");case"hsba":case"hsva":return this.hsba||(this.hsba=o.default._rgbaToHSBA(this._array)),"hsba(".concat(this.hsba[0]*this.maxes[a.HSB][0],", ",this.hsba[1]*this.maxes[a.HSB][1],", ",this.hsba[2]*this.maxes[a.HSB][2],", ",r,")");case"hsba%":case"hsva%":return this.hsba||(this.hsba=o.default._rgbaToHSBA(this._array)),"hsba(".concat((100*this.hsba[0]).toPrecision(3),"%, ",(100*this.hsba[1]).toPrecision(3),"%, ",(100*this.hsba[2]).toPrecision(3),"%, ",(100*r).toPrecision(3),"%)");case"hsl":return this.hsla||(this.hsla=o.default._rgbaToHSLA(this._array)),"hsl(".concat(this.hsla[0]*this.maxes[a.HSL][0],", ",this.hsla[1]*this.maxes[a.HSL][1],", ",this.hsla[2]*this.maxes[a.HSL][2],")");case"hsl%":return this.hsla||(this.hsla=o.default._rgbaToHSLA(this._array)),"hsl(".concat((100*this.hsla[0]).toPrecision(3),"%, ",(100*this.hsla[1]).toPrecision(3),"%, ",(100*this.hsla[2]).toPrecision(3),"%)");case"hsla":return this.hsla||(this.hsla=o.default._rgbaToHSLA(this._array)),"hsla(".concat(this.hsla[0]*this.maxes[a.HSL][0],", ",this.hsla[1]*this.maxes[a.HSL][1],", ",this.hsla[2]*this.maxes[a.HSL][2],", ",r,")");case"hsla%":return this.hsla||(this.hsla=o.default._rgbaToHSLA(this._array)),"hsl(".concat((100*this.hsla[0]).toPrecision(3),"%, ",(100*this.hsla[1]).toPrecision(3),"%, ",(100*this.hsla[2]).toPrecision(3),"%, ",(100*r).toPrecision(3),"%)");default:return"rgba(".concat(t[0],",",t[1],",",t[2],",",r,")")}},i.default.Color.prototype.setRed=function(e){this._array[0]=e/this.maxes[a.RGB][0],this._calculateLevels()},i.default.Color.prototype.setGreen=function(e){this._array[1]=e/this.maxes[a.RGB][1],this._calculateLevels()},i.default.Color.prototype.setBlue=function(e){this._array[2]=e/this.maxes[a.RGB][2],this._calculateLevels()},i.default.Color.prototype.setAlpha=function(e){this._array[3]=e/this.maxes[this.mode][3],this._calculateLevels()},i.default.Color.prototype._calculateLevels=function(){for(var e=this._array,t=this.levels=new Array(e.length),n=e.length-1;0<=n;--n)t[n]=Math.round(255*e[n])},i.default.Color.prototype._getAlpha=function(){return this._array[3]*this.maxes[this.mode][3]},i.default.Color.prototype._storeModeAndMaxes=function(e,t){this.mode=e,this.maxes=t},i.default.Color.prototype._getMode=function(){return this.mode},i.default.Color.prototype._getMaxes=function(){return this.maxes},i.default.Color.prototype._getBlue=function(){return this._array[2]*this.maxes[a.RGB][2]},i.default.Color.prototype._getBrightness=function(){return this.hsba||(this.hsba=o.default._rgbaToHSBA(this._array)),this.hsba[2]*this.maxes[a.HSB][2]},i.default.Color.prototype._getGreen=function(){return this._array[1]*this.maxes[a.RGB][1]},i.default.Color.prototype._getHue=function(){return this.mode===a.HSB?(this.hsba||(this.hsba=o.default._rgbaToHSBA(this._array)),this.hsba[0]*this.maxes[a.HSB][0]):(this.hsla||(this.hsla=o.default._rgbaToHSLA(this._array)),this.hsla[0]*this.maxes[a.HSL][0])},i.default.Color.prototype._getLightness=function(){return this.hsla||(this.hsla=o.default._rgbaToHSLA(this._array)),this.hsla[2]*this.maxes[a.HSL][2]},i.default.Color.prototype._getRed=function(){return this._array[0]*this.maxes[a.RGB][0]},i.default.Color.prototype._getSaturation=function(){return this.mode===a.HSB?(this.hsba||(this.hsba=o.default._rgbaToHSBA(this._array)),this.hsba[1]*this.maxes[a.HSB][1]):(this.hsla||(this.hsla=o.default._rgbaToHSLA(this._array)),this.hsla[1]*this.maxes[a.HSL][1])};var u={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},c=/\s*/,l=/(\d{1,3})/,f=/((?:\d+(?:\.\d+)?)|(?:\.\d+))/,d=new RegExp("".concat(f.source,"%")),h={HEX3:/^#([a-f0-9])([a-f0-9])([a-f0-9])$/i,HEX4:/^#([a-f0-9])([a-f0-9])([a-f0-9])([a-f0-9])$/i,HEX6:/^#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})$/i,HEX8:/^#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})$/i,RGB:new RegExp(["^rgb\\(",l.source,",",l.source,",",l.source,"\\)$"].join(c.source),"i"),RGB_PERCENT:new RegExp(["^rgb\\(",d.source,",",d.source,",",d.source,"\\)$"].join(c.source),"i"),RGBA:new RegExp(["^rgba\\(",l.source,",",l.source,",",l.source,",",f.source,"\\)$"].join(c.source),"i"),RGBA_PERCENT:new RegExp(["^rgba\\(",d.source,",",d.source,",",d.source,",",f.source,"\\)$"].join(c.source),"i"),HSL:new RegExp(["^hsl\\(",l.source,",",d.source,",",d.source,"\\)$"].join(c.source),"i"),HSLA:new RegExp(["^hsla\\(",l.source,",",d.source,",",d.source,",",f.source,"\\)$"].join(c.source),"i"),HSB:new RegExp(["^hsb\\(",l.source,",",d.source,",",d.source,"\\)$"].join(c.source),"i"),HSBA:new RegExp(["^hsba\\(",l.source,",",d.source,",",d.source,",",f.source,"\\)$"].join(c.source),"i")};i.default.Color._parseInputs=function(e,t,n,r){var s,c=arguments.length,l=this.mode,f=this.maxes[l],d=[];if(3<=c){for(d[0]=e/f[0],d[1]=t/f[1],d[2]=n/f[2],d[3]="number"==typeof r?r/f[3]:1,s=d.length-1;0<=s;--s){var p=d[s];p<0?d[s]=0:1<p&&(d[s]=1)}return l===a.HSL?o.default._hslaToRGBA(d):l===a.HSB?o.default._hsbaToRGBA(d):d}if(1===c&&"string"==typeof e){var m=e.trim().toLowerCase();if(u[m])return i.default.Color._parseInputs.call(this,u[m]);if(h.HEX3.test(m))return(d=h.HEX3.exec(m).slice(1).map((function(e){return parseInt(e+e,16)/255})))[3]=1,d;if(h.HEX6.test(m))return(d=h.HEX6.exec(m).slice(1).map((function(e){return parseInt(e,16)/255})))[3]=1,d;if(h.HEX4.test(m))return h.HEX4.exec(m).slice(1).map((function(e){return parseInt(e+e,16)/255}));if(h.HEX8.test(m))return h.HEX8.exec(m).slice(1).map((function(e){return parseInt(e,16)/255}));if(h.RGB.test(m))return(d=h.RGB.exec(m).slice(1).map((function(e){return e/255})))[3]=1,d;if(h.RGB_PERCENT.test(m))return(d=h.RGB_PERCENT.exec(m).slice(1).map((function(e){return parseFloat(e)/100})))[3]=1,d;if(h.RGBA.test(m))return h.RGBA.exec(m).slice(1).map((function(e,t){return 3===t?parseFloat(e):e/255}));if(h.RGBA_PERCENT.test(m))return h.RGBA_PERCENT.exec(m).slice(1).map((function(e,t){return 3===t?parseFloat(e):parseFloat(e)/100}));if(h.HSL.test(m)?(d=h.HSL.exec(m).slice(1).map((function(e,t){return 0===t?parseInt(e,10)/360:parseInt(e,10)/100})))[3]=1:h.HSLA.test(m)&&(d=h.HSLA.exec(m).slice(1).map((function(e,t){return 0===t?parseInt(e,10)/360:3===t?parseFloat(e):parseInt(e,10)/100}))),(d=d.map((function(e){return Math.max(Math.min(e,1),0)}))).length)return o.default._hslaToRGBA(d);if(h.HSB.test(m)?(d=h.HSB.exec(m).slice(1).map((function(e,t){return 0===t?parseInt(e,10)/360:parseInt(e,10)/100})))[3]=1:h.HSBA.test(m)&&(d=h.HSBA.exec(m).slice(1).map((function(e,t){return 0===t?parseInt(e,10)/360:3===t?parseFloat(e):parseInt(e,10)/100}))),d.length){for(s=d.length-1;0<=s;--s)d[s]=Math.max(Math.min(d[s],1),0);return o.default._hsbaToRGBA(d)}d=[1,1,1,1]}else{if(1!==c&&2!==c||"number"!=typeof e)throw new Error("".concat(arguments,"is not a valid color representation."));d[0]=e/f[2],d[1]=e/f[2],d[2]=e/f[2],d[3]="number"==typeof t?t/f[3]:1,d=d.map((function(e){return Math.max(Math.min(e,1),0)}))}return d};var p=i.default.Color;n.default=p},{"../core/constants":250,"../core/main":260,"./color_conversion":246,"core-js/modules/es.array.join":157,"core-js/modules/es.array.map":159,"core-js/modules/es.array.slice":160,"core-js/modules/es.object.to-string":174,"core-js/modules/es.regexp.constructor":177,"core-js/modules/es.regexp.exec":178,"core-js/modules/es.regexp.to-string":179,"core-js/modules/es.string.trim":190}],249:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e("core-js/modules/es.array.fill"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i,a=(i=e("../core/main"))&&i.__esModule?i:{default:i},o=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var t="function"!=typeof WeakMap?null:new WeakMap;if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,t&&t.set(e,n),n}(e("../core/constants"));e("./p5.Color"),a.default.prototype.background=function(){var e;return(e=this._renderer).background.apply(e,arguments),this},a.default.prototype.clear=function(){return this._renderer.clear(),this},a.default.prototype.colorMode=function(e,t,n,r,i){if(a.default._validateParameters("colorMode",arguments),e===o.RGB||e===o.HSB||e===o.HSL){this._colorMode=e;var s=this._colorMaxes[e];2===arguments.length?(s[0]=t,s[1]=t,s[2]=t,s[3]=t):4===arguments.length?(s[0]=t,s[1]=n,s[2]=r):5===arguments.length&&(s[0]=t,s[1]=n,s[2]=r,s[3]=i)}return this},a.default.prototype.fill=function(){var e;return this._renderer._setProperty("_fillSet",!0),this._renderer._setProperty("_doFill",!0),(e=this._renderer).fill.apply(e,arguments),this},a.default.prototype.noFill=function(){return this._renderer._setProperty("_doFill",!1),this},a.default.prototype.noStroke=function(){return this._renderer._setProperty("_doStroke",!1),this},a.default.prototype.stroke=function(){var e;return this._renderer._setProperty("_strokeSet",!0),this._renderer._setProperty("_doStroke",!0),(e=this._renderer).stroke.apply(e,arguments),this},a.default.prototype.erase=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:255,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:255;return this._renderer.erase(e,t),this},a.default.prototype.noErase=function(){return this._renderer.noErase(),this};var s=a.default;n.default=s},{"../core/constants":250,"../core/main":260,"./p5.Color":248,"core-js/modules/es.array.fill":150}],250:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.STROKE=n.CURVE=n.BEZIER=n.QUADRATIC=n.LINEAR=n._CTX_MIDDLE=n._DEFAULT_LEADMULT=n._DEFAULT_TEXT_FILL=n.BOLDITALIC=n.BOLD=n.ITALIC=n.NORMAL=n.BLUR=n.ERODE=n.DILATE=n.POSTERIZE=n.INVERT=n.OPAQUE=n.GRAY=n.THRESHOLD=n.BURN=n.DODGE=n.SOFT_LIGHT=n.HARD_LIGHT=n.OVERLAY=n.REPLACE=n.SCREEN=n.MULTIPLY=n.EXCLUSION=n.SUBTRACT=n.DIFFERENCE=n.LIGHTEST=n.DARKEST=n.ADD=n.REMOVE=n.BLEND=n.UP_ARROW=n.TAB=n.SHIFT=n.RIGHT_ARROW=n.RETURN=n.OPTION=n.LEFT_ARROW=n.ESCAPE=n.ENTER=n.DOWN_ARROW=n.DELETE=n.CONTROL=n.BACKSPACE=n.ALT=n.AUTO=n.HSL=n.HSB=n.RGB=n.MITER=n.BEVEL=n.ROUND=n.SQUARE=n.PROJECT=n.PIE=n.CHORD=n.OPEN=n.CLOSE=n.TESS=n.QUAD_STRIP=n.QUADS=n.TRIANGLE_STRIP=n.TRIANGLE_FAN=n.TRIANGLES=n.LINE_LOOP=n.LINE_STRIP=n.LINES=n.POINTS=n.BASELINE=n.BOTTOM=n.TOP=n.CENTER=n.LEFT=n.RIGHT=n.RADIUS=n.CORNERS=n.CORNER=n.RAD_TO_DEG=n.DEG_TO_RAD=n.RADIANS=n.DEGREES=n.TWO_PI=n.TAU=n.QUARTER_PI=n.PI=n.HALF_PI=n.WAIT=n.TEXT=n.MOVE=n.HAND=n.CROSS=n.ARROW=n.WEBGL=n.P2D=n.VERSION=void 0,n.FALLBACK=n.LABEL=n.AXES=n.GRID=n._DEFAULT_FILL=n._DEFAULT_STROKE=n.PORTRAIT=n.LANDSCAPE=n.MIRROR=n.CLAMP=n.REPEAT=n.NEAREST=n.IMAGE=n.IMMEDIATE=n.TEXTURE=n.FILL=void 0;var r=Math.PI;n.VERSION="1.3.1",n.P2D="p2d",n.WEBGL="webgl",n.ARROW="default",n.CROSS="crosshair",n.HAND="pointer",n.MOVE="move",n.TEXT="text",n.WAIT="wait";var i=r/2;n.HALF_PI=i;var a=r;n.PI=a;var o=r/4;n.QUARTER_PI=o;var s=2*r;n.TAU=s;var u=2*r;n.TWO_PI=u,n.DEGREES="degrees",n.RADIANS="radians";var c=r/180;n.DEG_TO_RAD=c;var l=180/r;n.RAD_TO_DEG=l,n.CORNER="corner",n.CORNERS="corners",n.RADIUS="radius",n.RIGHT="right",n.LEFT="left",n.CENTER="center",n.TOP="top",n.BOTTOM="bottom",n.BASELINE="alphabetic",n.POINTS=0,n.LINES=1,n.LINE_STRIP=3,n.LINE_LOOP=2,n.TRIANGLES=4,n.TRIANGLE_FAN=6,n.TRIANGLE_STRIP=5,n.QUADS="quads",n.QUAD_STRIP="quad_strip",n.TESS="tess",n.CLOSE="close",n.OPEN="open",n.CHORD="chord",n.PIE="pie",n.PROJECT="square",n.SQUARE="butt",n.ROUND="round",n.BEVEL="bevel",n.MITER="miter",n.RGB="rgb",n.HSB="hsb",n.HSL="hsl",n.AUTO="auto",n.ALT=18,n.BACKSPACE=8,n.CONTROL=17,n.DELETE=46,n.DOWN_ARROW=40,n.ENTER=13,n.ESCAPE=27,n.LEFT_ARROW=37,n.OPTION=18,n.RETURN=13,n.RIGHT_ARROW=39,n.SHIFT=16,n.TAB=9,n.UP_ARROW=38,n.BLEND="source-over",n.REMOVE="destination-out",n.ADD="lighter",n.DARKEST="darken",n.LIGHTEST="lighten",n.DIFFERENCE="difference",n.SUBTRACT="subtract",n.EXCLUSION="exclusion",n.MULTIPLY="multiply",n.SCREEN="screen",n.REPLACE="copy",n.OVERLAY="overlay",n.HARD_LIGHT="hard-light",n.SOFT_LIGHT="soft-light",n.DODGE="color-dodge",n.BURN="color-burn",n.THRESHOLD="threshold",n.GRAY="gray",n.OPAQUE="opaque",n.INVERT="invert",n.POSTERIZE="posterize",n.DILATE="dilate",n.ERODE="erode",n.BLUR="blur",n.NORMAL="normal",n.ITALIC="italic",n.BOLD="bold",n.BOLDITALIC="bold italic",n._DEFAULT_TEXT_FILL="#000000",n._DEFAULT_LEADMULT=1.25,n._CTX_MIDDLE="middle",n.LINEAR="linear",n.QUADRATIC="quadratic",n.BEZIER="bezier",n.CURVE="curve",n.STROKE="stroke",n.FILL="fill",n.TEXTURE="texture",n.IMMEDIATE="immediate",n.IMAGE="image",n.NEAREST="nearest",n.REPEAT="repeat",n.CLAMP="clamp",n.MIRROR="mirror",n.LANDSCAPE="landscape",n.PORTRAIT="portrait",n._DEFAULT_STROKE="#000000",n._DEFAULT_FILL="#FFFFFF",n.GRID="grid",n.AXES="axes",n.LABEL="label",n.FALLBACK="fallback"},{}],251:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e("core-js/modules/es.array.concat"),e("core-js/modules/es.array.filter"),e("core-js/modules/es.array.includes"),e("core-js/modules/es.regexp.exec"),e("core-js/modules/es.string.includes"),e("core-js/modules/es.string.search"),e("core-js/modules/es.string.split"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i,a=(i=e("./main"))&&i.__esModule?i:{default:i},o=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var t="function"!=typeof WeakMap?null:new WeakMap;if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,t&&t.set(e,n),n}(e("./constants")),s=[o.ARROW,o.CROSS,o.HAND,o.MOVE,o.TEXT,o.WAIT];a.default.prototype._frameRate=0,a.default.prototype._lastFrameTime=window.performance.now(),a.default.prototype._targetFrameRate=60;var u=window.print;function c(){return window.innerWidth||document.documentElement&&document.documentElement.clientWidth||document.body&&document.body.clientWidth||0}function l(){return window.innerHeight||document.documentElement&&document.documentElement.clientHeight||document.body&&document.body.clientHeight||0}a.default.prototype.print=function(){var e;arguments.length?(e=console).log.apply(e,arguments):u()},a.default.prototype.frameCount=0,a.default.prototype.deltaTime=0,a.default.prototype.focused=document.hasFocus(),a.default.prototype.cursor=function(e,t,n){var r="auto",i=this._curElement.elt;if(s.includes(e))r=e;else if("string"==typeof e){var a="";t&&n&&"number"==typeof t&&"number"==typeof n&&(a="".concat(t," ").concat(n)),r="http://"===e.substring(0,7)||"https://"===e.substring(0,8)||/\.(cur|jpg|jpeg|gif|png|CUR|JPG|JPEG|GIF|PNG)$/.test(e)?"url(".concat(e,") ").concat(a,", auto"):e}i.style.cursor=r},a.default.prototype.frameRate=function(e){return a.default._validateParameters("frameRate",arguments),"number"!=typeof e||e<0?this._frameRate:(this._setProperty("_targetFrameRate",e),0===e&&this._setProperty("_frameRate",e),this)},a.default.prototype.getFrameRate=function(){return this.frameRate()},a.default.prototype.setFrameRate=function(e){return this.frameRate(e)},a.default.prototype.noCursor=function(){this._curElement.elt.style.cursor="none"},a.default.prototype.displayWidth=screen.width,a.default.prototype.displayHeight=screen.height,a.default.prototype.windowWidth=c(),a.default.prototype.windowHeight=l(),a.default.prototype._onresize=function(e){this._setProperty("windowWidth",c()),this._setProperty("windowHeight",l());var t,n=this._isGlobal?window:this;"function"==typeof n.windowResized&&(void 0===(t=n.windowResized(e))||t||e.preventDefault())},a.default.prototype.width=0,a.default.prototype.height=0,a.default.prototype.fullscreen=function(e){if(a.default._validateParameters("fullscreen",arguments),void 0===e)return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;e?function(e){if(!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled))throw new Error("Fullscreen not enabled in this browser.");e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}(document.documentElement):document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()},a.default.prototype.pixelDensity=function(e){var t;return a.default._validateParameters("pixelDensity",arguments),"number"==typeof e?(e!==this._pixelDensity&&(this._pixelDensity=e),(t=this).resizeCanvas(this.width,this.height,!0)):t=this._pixelDensity,t},a.default.prototype.displayDensity=function(){return window.devicePixelRatio},a.default.prototype.getURL=function(){return location.href},a.default.prototype.getURLPath=function(){return location.pathname.split("/").filter((function(e){return""!==e}))},a.default.prototype.getURLParams=function(){for(var e,t=/[?&]([^&=]+)(?:[&=])([^&=]+)/gim,n={};null!=(e=t.exec(location.search));)e.index===t.lastIndex&&t.lastIndex++,n[e[1]]=e[2];return n};var f=a.default;n.default=f},{"./constants":250,"./main":260,"core-js/modules/es.array.concat":148,"core-js/modules/es.array.filter":151,"core-js/modules/es.array.includes":154,"core-js/modules/es.regexp.exec":178,"core-js/modules/es.string.includes":182,"core-js/modules/es.string.search":187,"core-js/modules/es.string.split":188}],252:[function(e,t,n){"use strict";e("core-js/modules/es.symbol"),e("core-js/modules/es.symbol.description"),e("core-js/modules/es.symbol.iterator"),e("core-js/modules/es.array.concat"),e("core-js/modules/es.array.filter"),e("core-js/modules/es.array.for-each"),e("core-js/modules/es.array.includes"),e("core-js/modules/es.array.iterator"),e("core-js/modules/es.array.join"),e("core-js/modules/es.array.map"),e("core-js/modules/es.array.slice"),e("core-js/modules/es.array.some"),e("core-js/modules/es.function.name"),e("core-js/modules/es.object.assign"),e("core-js/modules/es.object.get-own-property-names"),e("core-js/modules/es.object.keys"),e("core-js/modules/es.object.to-string"),e("core-js/modules/es.regexp.constructor"),e("core-js/modules/es.regexp.exec"),e("core-js/modules/es.regexp.to-string"),e("core-js/modules/es.string.iterator"),e("core-js/modules/es.string.match"),e("core-js/modules/es.string.replace"),e("core-js/modules/es.string.search"),e("core-js/modules/es.string.split"),e("core-js/modules/web.dom-collections.for-each"),e("core-js/modules/web.dom-collections.iterator"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=(r=e("../main"))&&r.__esModule?r:{default:r};e("../internationalization");var a,o=null;function s(e,t){t=t||console.log.bind(console),o||a(),o.some((function(n){if(e.message&&null!==e.message.match("\\W?".concat(n.name,"\\W"))){var r="function"===n.type?"".concat(n.name,"()"):n.name;return t("Did you just try to use p5.js's ".concat(r," ").concat(n.type,"? If so, you may want to move it into your sketch's setup() function.\n\nFor more details, see: ").concat("https://github.com/processing/p5.js/wiki/p5.js-overview#why-cant-i-assign-variables-using-p5-functions-and-variables-before-setup")),!0}}))}i.default._friendlyError=i.default._checkForUserDefinedFunctions=i.default._fesErrorMonitor=function(){},o=null,a=function(){function t(e){return Object.getOwnPropertyNames(e).filter((function(e){return"_"!==e[0]&&!(e in n)&&(n[e]=!0)})).map((function(t){var n;return n="function"==typeof e[t]?"function":t===t.toUpperCase()?"constant":"variable",{name:t,type:n}}))}var n={};(o=[].concat(t(i.default.prototype),t(e("../constants")))).sort((function(e,t){return t.name.length-e.name.length}))},i.default.prototype._helpForMisusedAtTopLevelCode=s,"complete"!==document.readyState&&(window.addEventListener("error",s,!1),window.addEventListener("load",(function(){window.removeEventListener("error",s,!1)})));var u=i.default;n.default=u},{"../constants":250,"../internationalization":258,"../main":260,"./browser_errors":void 0,"core-js/modules/es.array.concat":148,"core-js/modules/es.array.filter":151,"core-js/modules/es.array.for-each":152,"core-js/modules/es.array.includes":154,"core-js/modules/es.array.iterator":156,"core-js/modules/es.array.join":157,"core-js/modules/es.array.map":159,"core-js/modules/es.array.slice":160,"core-js/modules/es.array.some":161,"core-js/modules/es.function.name":163,"core-js/modules/es.object.assign":170,"core-js/modules/es.object.get-own-property-names":171,"core-js/modules/es.object.keys":173,"core-js/modules/es.object.to-string":174,"core-js/modules/es.regexp.constructor":177,"core-js/modules/es.regexp.exec":178,"core-js/modules/es.regexp.to-string":179,"core-js/modules/es.string.iterator":183,"core-js/modules/es.string.match":184,"core-js/modules/es.string.replace":186,"core-js/modules/es.string.search":187,"core-js/modules/es.string.split":188,"core-js/modules/es.symbol":193,"core-js/modules/es.symbol.description":191,"core-js/modules/es.symbol.iterator":192,"core-js/modules/web.dom-collections.for-each":225,"core-js/modules/web.dom-collections.iterator":226}],253:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=(r=e("../main"))&&r.__esModule?r:{default:r};e("../internationalization"),i.default._friendlyFileLoadError=function(){};var a=i.default;n.default=a},{"../internationalization":258,"../main":260}],254:[function(e,t,n){"use strict";e("core-js/modules/es.array.filter"),e("core-js/modules/es.array.index-of"),e("core-js/modules/es.array.join"),e("core-js/modules/es.array.map"),e("core-js/modules/es.array.slice"),e("core-js/modules/es.regexp.exec"),e("core-js/modules/es.string.match"),e("core-js/modules/es.string.replace"),e("core-js/modules/es.string.split"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=(r=e("../main"))&&r.__esModule?r:{default:r};function a(){var e=/(^|@)\S+:\d+/,t=/^\s*at .*(\S+:\d+|\(native\))/m,n=/^(eval@)?(\[native code])?$/;return{parse:function(e){return void 0!==e.stacktrace||void 0!==e["opera#sourceloc"]?this.parseOpera(e):e.stack&&e.stack.match(t)?this.parseV8OrIE(e):e.stack?this.parseFFOrSafari(e):void 0},extractLocation:function(e){if(-1===e.indexOf(":"))return[e];var t=/(.+?)(?::(\d+))?(?::(\d+))?$/.exec(e.replace(/[()]/g,""));return[t[1],t[2]||void 0,t[3]||void 0]},parseV8OrIE:function(e){return e.stack.split("\n").filter((function(e){return!!e.match(t)}),this).map((function(e){-1<e.indexOf("(eval ")&&(e=e.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(\),.*$)/g,""));var t=e.replace(/^\s+/,"").replace(/\(eval code/g,"("),n=t.match(/ (\((.+):(\d+):(\d+)\)$)/),r=(t=n?t.replace(n[0],""):t).split(/\s+/).slice(1),i=this.extractLocation(n?n[1]:r.pop());return{functionName:r.join(" ")||void 0,fileName:-1<["eval","<anonymous>"].indexOf(i[0])?void 0:i[0],lineNumber:i[1],columnNumber:i[2],source:e}}),this)},parseFFOrSafari:function(e){return e.stack.split("\n").filter((function(e){return!e.match(n)}),this).map((function(e){if(-1<e.indexOf(" > eval")&&(e=e.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),-1===e.indexOf("@")&&-1===e.indexOf(":"))return{functionName:e};var t=/((.*".+"[^@]*)?[^@]*)(?:@)/,n=e.match(t),r=n&&n[1]?n[1]:void 0,i=this.extractLocation(e.replace(t,""));return{functionName:r,fileName:i[0],lineNumber:i[1],columnNumber:i[2],source:e}}),this)},parseOpera:function(e){return!e.stacktrace||-1<e.message.indexOf("\n")&&e.message.split("\n").length>e.stacktrace.split("\n").length?this.parseOpera9(e):e.stack?this.parseOpera11(e):this.parseOpera10(e)},parseOpera9:function(e){for(var t=/Line (\d+).*script (?:in )?(\S+)/i,n=e.message.split("\n"),r=[],i=2,a=n.length;i<a;i+=2){var o=t.exec(n[i]);o&&r.push({fileName:o[2],lineNumber:o[1],source:n[i]})}return r},parseOpera10:function(e){for(var t=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,n=e.stacktrace.split("\n"),r=[],i=0,a=n.length;i<a;i+=2){var o=t.exec(n[i]);o&&r.push({functionName:o[3]||void 0,fileName:o[2],lineNumber:o[1],source:n[i]})}return r},parseOpera11:function(t){return t.stack.split("\n").filter((function(t){return!!t.match(e)&&!t.match(/^Error created at/)}),this).map((function(e){var t,n=e.split("@"),r=this.extractLocation(n.pop()),i=n.shift()||"",a=i.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0;return i.match(/\(([^)]*)\)/)&&(t=i.replace(/^[^(]+\(([^)]*)\)$/,"$1")),{functionName:a,args:void 0===t||"[arguments not available]"===t?void 0:t.split(","),fileName:r[0],lineNumber:r[1],columnNumber:r[2],source:e}}),this)}}}i.default._getErrorStackParser=function(){return new a};var o=i.default;n.default=o},{"../main":260,"core-js/modules/es.array.filter":151,"core-js/modules/es.array.index-of":155,"core-js/modules/es.array.join":157,"core-js/modules/es.array.map":159,"core-js/modules/es.array.slice":160,"core-js/modules/es.regexp.exec":178,"core-js/modules/es.string.match":184,"core-js/modules/es.string.replace":186,"core-js/modules/es.string.split":188}],255:[function(e,t,n){"use strict";e("core-js/modules/es.symbol"),e("core-js/modules/es.symbol.description"),e("core-js/modules/es.symbol.iterator"),e("core-js/modules/es.array.concat"),e("core-js/modules/es.array.for-each"),e("core-js/modules/es.array.includes"),e("core-js/modules/es.array.index-of"),e("core-js/modules/es.array.iterator"),e("core-js/modules/es.array.join"),e("core-js/modules/es.array.last-index-of"),e("core-js/modules/es.array.map"),e("core-js/modules/es.array.slice"),e("core-js/modules/es.function.name"),e("core-js/modules/es.map"),e("core-js/modules/es.number.constructor"),e("core-js/modules/es.object.get-prototype-of"),e("core-js/modules/es.object.keys"),e("core-js/modules/es.object.to-string"),e("core-js/modules/es.reflect.construct"),e("core-js/modules/es.regexp.exec"),e("core-js/modules/es.regexp.to-string"),e("core-js/modules/es.set"),e("core-js/modules/es.string.includes"),e("core-js/modules/es.string.iterator"),e("core-js/modules/es.string.split"),e("core-js/modules/web.dom-collections.for-each"),e("core-js/modules/web.dom-collections.iterator"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=(r=e("../main"))&&r.__esModule?r:{default:r};(function(e){if(!(e&&e.__esModule||null===e||"object"!==function(e){return("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}(e)&&"function"!=typeof e)){var t="function"!=typeof WeakMap?null:new WeakMap;if(t&&t.has(e))return t.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var a=r?Object.getOwnPropertyDescriptor(e,i):null;a&&(a.get||a.set)?Object.defineProperty(n,i,a):n[i]=e[i]}n.default=e,t&&t.set(e,n)}})(e("../constants")),e("../internationalization"),i.default._validateParameters=i.default._clearValidateParamsCache=function(){};var a=i.default;n.default=a},{"../../../docs/parameterData.json":void 0,"../constants":250,"../internationalization":258,"../main":260,"core-js/modules/es.array.concat":148,"core-js/modules/es.array.for-each":152,"core-js/modules/es.array.includes":154,"core-js/modules/es.array.index-of":155,"core-js/modules/es.array.iterator":156,"core-js/modules/es.array.join":157,"core-js/modules/es.array.last-index-of":158,"core-js/modules/es.array.map":159,"core-js/modules/es.array.slice":160,"core-js/modules/es.function.name":163,"core-js/modules/es.map":164,"core-js/modules/es.number.constructor":167,"core-js/modules/es.object.get-prototype-of":172,"core-js/modules/es.object.keys":173,"core-js/modules/es.object.to-string":174,"core-js/modules/es.reflect.construct":176,"core-js/modules/es.regexp.exec":178,"core-js/modules/es.regexp.to-string":179,"core-js/modules/es.set":180,"core-js/modules/es.string.includes":182,"core-js/modules/es.string.iterator":183,"core-js/modules/es.string.split":188,"core-js/modules/es.symbol":193,"core-js/modules/es.symbol.description":191,"core-js/modules/es.symbol.iterator":192,"core-js/modules/web.dom-collections.for-each":225,"core-js/modules/web.dom-collections.iterator":226}],256:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var t="function"!=typeof WeakMap?null:new WeakMap;if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,t&&t.set(e,n),n}(e("./constants")),a={modeAdjust:function(e,t,n,r,a){return a===i.CORNER?{x:e,y:t,w:n,h:r}:a===i.CORNERS?{x:e,y:t,w:n-e,h:r-t}:a===i.RADIUS?{x:e-n,y:t-r,w:2*n,h:2*r}:a===i.CENTER?{x:e-.5*n,y:t-.5*r,w:n,h:r}:void 0}};n.default=a},{"./constants":250}],257:[function(e,t,n){"use strict";e("core-js/modules/es.array.iterator"),e("core-js/modules/es.object.to-string"),e("core-js/modules/es.promise"),e("core-js/modules/es.string.iterator"),e("core-js/modules/web.dom-collections.iterator");var r,i=(r=e("../core/main"))&&r.__esModule?r:{default:r};e("./internationalization");var a=Promise.resolve();Promise.all([new Promise((function(e,t){"complete"===document.readyState?e():window.addEventListener("load",e,!1)})),a]).then((function(){void 0===window._setupDone?window.mocha||(window.setup&&"function"==typeof window.setup||window.draw&&"function"==typeof window.draw)&&!i.default.instance&&new i.default:console.warn("p5.js seems to have been imported multiple times. Please remove the duplicate import")}))},{"../core/main":260,"./internationalization":258,"core-js/modules/es.array.iterator":156,"core-js/modules/es.object.to-string":174,"core-js/modules/es.promise":175,"core-js/modules/es.string.iterator":183,"core-js/modules/web.dom-collections.iterator":226}],258:[function(e,t,n){"use strict";e("core-js/modules/es.array.includes"),e("core-js/modules/es.array.iterator"),e("core-js/modules/es.array.join"),e("core-js/modules/es.array.slice"),e("core-js/modules/es.object.keys"),e("core-js/modules/es.object.to-string"),e("core-js/modules/es.promise"),e("core-js/modules/es.regexp.exec"),e("core-js/modules/es.string.includes"),e("core-js/modules/es.string.iterator"),e("core-js/modules/es.string.split"),e("core-js/modules/web.dom-collections.iterator"),Object.defineProperty(n,"__esModule",{value:!0}),n.initialize=n.translator=void 0;var r,i=o(e("i18next")),a=o(e("i18next-browser-languagedetector"));function o(e){return e&&e.__esModule?e:{default:e}}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init(t,n)}var t;return(t=[{key:"fetchWithTimeout",value:function(e,t,n){var r=2<arguments.length&&void 0!==n?n:2e3;return Promise.race([fetch(e,t),new Promise((function(e,t){return setTimeout((function(){return t(new Error("timeout"))}),r)}))])}},{key:"init",value:function(e,t){var n=1<arguments.length&&void 0!==t?t:{};this.services=e,this.options=n}},{key:"read",value:function(e,t,n){var i=this.options.loadPath;if(e===this.options.fallback)n(null,r[e][t]);else if((void 0).includes(e)){var a=this.services.interpolator.interpolate(i,{lng:e,ns:t});this.loadUrl(a,n)}else n("Not found",!1)}},{key:"loadUrl",value:function(e,t){this.fetchWithTimeout(e).then((function(t){if(!t.ok)throw new Error("failed loading ".concat(e));return t.json()}),(function(){throw new Error("failed loading ".concat(e))})).then((function(e){return t(null,e)})).catch(t)}}])&&s(e.prototype,t),e}();u.type="backend";var c=function(e,t){console.debug("p5.js translator called before translations were loaded"),i.default.t(e,t)};n.translator=c,n.initialize=function(){return i.default.use(a.default).use(u).init({fallbackLng:"en",nestingPrefix:"$tr(",nestingSuffix:")",defaultNS:"translation",returnEmptyString:!1,interpolation:{escapeValue:!1},detection:{checkWhitelist:!1,order:["querystring","navigator","htmlTag","path","subdomain"],caches:[]},backend:{fallback:"en",loadPath:"https://cdn.jsdelivr.net/npm/p5/translations/{{lng}}/{{ns}}.json"},partialBundledLanguages:!0,resources:r}).then((function(e){n.translator=c=e}),(function(e){return console.debug("Translations failed to load (".concat(e,")"))}))}},{"../../translations":void 0,"../../translations/dev":void 0,"core-js/modules/es.array.includes":154,"core-js/modules/es.array.iterator":156,"core-js/modules/es.array.join":157,"core-js/modules/es.array.slice":160,"core-js/modules/es.object.keys":173,"core-js/modules/es.object.to-string":174,"core-js/modules/es.promise":175,"core-js/modules/es.regexp.exec":178,"core-js/modules/es.string.includes":182,"core-js/modules/es.string.iterator":183,"core-js/modules/es.string.split":188,"core-js/modules/web.dom-collections.iterator":226,i18next:3,"i18next-browser-languagedetector":3}],259:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=(r=e("./main"))&&r.__esModule?r:{default:r};i.default.prototype.pushStyle=function(){throw new Error("pushStyle() not used, see push()")},i.default.prototype.popStyle=function(){throw new Error("popStyle() not used, see pop()")},i.default.prototype.popMatrix=function(){throw new Error("popMatrix() not used, see pop()")},i.default.prototype.pushMatrix=function(){throw new Error("pushMatrix() not used, see push()")};var a=i.default;n.default=a},{"./main":260}],260:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e("core-js/modules/es.symbol"),e("core-js/modules/es.symbol.description"),e("core-js/modules/es.symbol.iterator"),e("core-js/modules/es.array.for-each"),e("core-js/modules/es.array.iterator"),e("core-js/modules/es.array.slice"),e("core-js/modules/es.object.get-own-property-names"),e("core-js/modules/es.object.to-string"),e("core-js/modules/es.string.iterator"),e("core-js/modules/web.dom-collections.for-each"),e("core-js/modules/web.dom-collections.iterator"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0,e("./shim");var i=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var t="function"!=typeof WeakMap?null:new WeakMap;if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,t&&t.set(e,n),n}(e("./constants"));function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(t,n,r){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._setupDone=!1,this._pixelDensity=Math.ceil(window.devicePixelRatio)||1,this._userNode=n,this._curElement=null,this._elements=[],this._glAttributes=null,this._requestAnimId=0,this._preloadCount=0,this._isGlobal=!1,this._loop=!0,this._initializeInstanceVariables(),this._defaultCanvasSize={width:100,height:100},this._events={mousemove:null,mousedown:null,mouseup:null,dragend:null,dragover:null,click:null,dblclick:null,mouseover:null,mouseout:null,keydown:null,keyup:null,keypress:null,touchstart:null,touchmove:null,touchend:null,resize:null,blur:null},this._millisStart=-1,this._lcg_random_state=null,this._gaussian_previous=!1,this._events.wheel=null,this._loadingScreenId="p5_loading",this._registeredMethods={};var a=Object.getOwnPropertyNames(e.prototype._registeredMethods),o=!0,s=!1,u=void 0;try{for(var c,l=a[Symbol.iterator]();!(o=(c=l.next()).done);o=!0){var f=c.value;this._registeredMethods[f]=e.prototype._registeredMethods[f].slice()}}catch(t){s=!0,u=t}finally{try{o||null==l.return||l.return()}finally{if(s)throw u}}window.DeviceOrientationEvent&&(this._events.deviceorientation=null),window.DeviceMotionEvent&&!window._isNodeWebkit&&(this._events.devicemotion=null),this._start=function(){i._userNode&&"string"==typeof i._userNode&&(i._userNode=document.getElementById(i._userNode));var t=i._isGlobal?window:i;if(t.preload){var n=document.getElementById(i._loadingScreenId);n||((n=document.createElement("div")).innerHTML="Loading...",n.style.position="absolute",n.id=i._loadingScreenId,(i._userNode||document.body).appendChild(n));var r=i._preloadMethods;for(var a in r){r[a]=r[a]||e;var o=r[a];o!==e.prototype&&o!==e||(i._isGlobal&&(window[a]=i._wrapPreload(i,a)),o=i),i._registeredPreloadMethods[a]=o[a],o[a]=i._wrapPreload(o,a)}t.preload(),i._runIfPreloadsAreDone()}else i._setup(),i._draw()},this._runIfPreloadsAreDone=function(){var e=this._isGlobal?window:this;if(0===e._preloadCount){var t=document.getElementById(e._loadingScreenId);t&&t.parentNode.removeChild(t),this._setupDone||(this._lastFrameTime=window.performance.now(),e._setup(),e._draw())}},this._decrementPreload=function(){var e=this._isGlobal?window:this;"function"==typeof e.preload&&(e._setProperty("_preloadCount",e._preloadCount-1),e._runIfPreloadsAreDone())},this._wrapPreload=function(e,t){var n=this;return function(){n._incrementPreload();for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return n._registeredPreloadMethods[t].apply(e,i)}},this._incrementPreload=function(){var e=this._isGlobal?window:this;e._setProperty("_preloadCount",e._preloadCount+1)},this._setup=function(){i.createCanvas(i._defaultCanvasSize.width,i._defaultCanvasSize.height,"p2d");var e=i._isGlobal?window:i;if("function"==typeof e.preload)for(var t in i._preloadMethods)e[t]=i._preloadMethods[t][t],e[t]&&i&&(e[t]=e[t].bind(i));i._millisStart=window.performance.now(),"function"==typeof e.setup&&e.setup();var n=document.getElementsByTagName("canvas"),r=!0,a=!1,o=void 0;try{for(var s,u=n[Symbol.iterator]();!(r=(s=u.next()).done);r=!0){var c=s.value;"true"===c.dataset.hidden&&(c.style.visibility="",delete c.dataset.hidden)}}catch(e){a=!0,o=e}finally{try{r||null==u.return||u.return()}finally{if(a)throw o}}i._lastFrameTime=window.performance.now(),i._setupDone=!0,(i._accessibleOutputs.grid||i._accessibleOutputs.text)&&i._updateAccsOutput()},this._draw=function(){var e=window.performance.now(),t=e-i._lastFrameTime,n=1e3/i._targetFrameRate;(!i._loop||n-5<=t)&&(i.redraw(),i._frameRate=1e3/(e-i._lastFrameTime),i.deltaTime=e-i._lastFrameTime,i._setProperty("deltaTime",i.deltaTime),i._lastFrameTime=e,void 0!==i._updateMouseCoords&&(i._updateMouseCoords(),i._setProperty("movedX",0),i._setProperty("movedY",0))),i._loop&&(i._requestAnimId=window.requestAnimationFrame(i._draw))},this._setProperty=function(e,t){i[e]=t,i._isGlobal&&(window[e]=t)},this.remove=function(){var t=document.getElementById(i._loadingScreenId);if(t&&(t.parentNode.removeChild(t),i._incrementPreload()),i._curElement){for(var n in i._loop=!1,i._requestAnimId&&window.cancelAnimationFrame(i._requestAnimId),i._events)window.removeEventListener(n,i._events[n]);var r=!0,a=!1,o=void 0;try{for(var s,u=i._elements[Symbol.iterator]();!(r=(s=u.next()).done);r=!0){var c=s.value;for(var l in c.elt&&c.elt.parentNode&&c.elt.parentNode.removeChild(c.elt),c._events)c.elt.removeEventListener(l,c._events[l])}}catch(t){a=!0,o=t}finally{try{r||null==u.return||u.return()}finally{if(a)throw o}}var f=i;i._registeredMethods.remove.forEach((function(e){void 0!==e&&e.call(f)}))}if(i._isGlobal){for(var d in e.prototype)try{delete window[d]}catch(t){window[d]=void 0}for(var h in i)if(i.hasOwnProperty(h))try{delete window[h]}catch(t){window[h]=void 0}e.instance=null}},this._registeredMethods.init.forEach((function(e){void 0!==e&&e.call(this)}),this),this._setupPromisePreloads();var d=this._createFriendlyGlobalFunctionBinder();if(t)t(this),e._checkForUserDefinedFunctions(this);else{for(var h in this._isGlobal=!0,e.instance=this,e.prototype)if("function"==typeof e.prototype[h]){var p=h.substring(2);this._events.hasOwnProperty(p)||(Math.hasOwnProperty(h)&&Math[h]===e.prototype[h]?d(h,e.prototype[h]):d(h,e.prototype[h].bind(this)))}else d(h,e.prototype[h]);for(var m in this)this.hasOwnProperty(m)&&d(m,this[m])}for(var v in this._events){var g=this["_on".concat(v)];if(g){var y=g.bind(this);window.addEventListener(v,y,{passive:!1}),this._events[v]=y}}function b(){i._setProperty("focused",!0)}function x(){i._setProperty("focused",!1)}window.addEventListener("focus",b),window.addEventListener("blur",x),this.registerMethod("remove",(function(){window.removeEventListener("focus",b),window.removeEventListener("blur",x)})),"complete"===document.readyState?this._start():window.addEventListener("load",this._start.bind(this),!1)}var t;return(t=[{key:"_initializeInstanceVariables",value:function(){this._accessibleOutputs={text:!1,grid:!1,textLabel:!1,gridLabel:!1},this._styles=[],this._bezierDetail=20,this._curveDetail=20,this._colorMode=i.RGB,this._colorMaxes={rgb:[255,255,255,255],hsb:[360,100,100,1],hsl:[360,100,100,1]},this._downKeys={}}},{key:"registerPreloadMethod",value:function(t,n){e.prototype._preloadMethods.hasOwnProperty(t)||(e.prototype._preloadMethods[t]=n)}},{key:"registerMethod",value:function(t,n){var r=this||e.prototype;r._registeredMethods.hasOwnProperty(t)||(r._registeredMethods[t]=[]),r._registeredMethods[t].push(n)}},{key:"_createFriendlyGlobalFunctionBinder",value:function(e){var t=0<arguments.length&&void 0!==e?e:{},n=t.globalObject||window;return t.log||console.log.bind(console),function(e,t){n[e]=t}}}])&&a(e.prototype,t),e}();for(var s in o.instance=null,o.disableFriendlyErrors=!1,i)o.prototype[s]=i[s];o.prototype._preloadMethods={loadJSON:o.prototype,loadImage:o.prototype,loadStrings:o.prototype,loadXML:o.prototype,loadBytes:o.prototype,loadTable:o.prototype,loadFont:o.prototype,loadModel:o.prototype,loadShader:o.prototype},o.prototype._registeredMethods={init:[],pre:[],post:[],remove:[]},o.prototype._registeredPreloadMethods={};var u=o;n.default=u},{"./constants":250,"./shim":271,"core-js/modules/es.array.for-each":152,"core-js/modules/es.array.iterator":156,"core-js/modules/es.array.slice":160,"core-js/modules/es.object.get-own-property-names":171,"core-js/modules/es.object.to-string":174,"core-js/modules/es.string.iterator":183,"core-js/modules/es.symbol":193,"core-js/modules/es.symbol.description":191,"core-js/modules/es.symbol.iterator":192,"core-js/modules/web.dom-collections.for-each":225,"core-js/modules/web.dom-collections.iterator":226}],261:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=(r=e("./main"))&&r.__esModule?r:{default:r};i.default.Element=function(e,t){this.elt=e,this._pInst=this._pixelsState=t,this._events={},this.width=this.elt.offsetWidth,this.height=this.elt.offsetHeight},i.default.Element.prototype.parent=function(e){return void 0===e?this.elt.parentNode:("string"==typeof e?("#"===e[0]&&(e=e.substring(1)),e=document.getElementById(e)):e instanceof i.default.Element&&(e=e.elt),e.appendChild(this.elt),this)},i.default.Element.prototype.id=function(e){return void 0===e?this.elt.id:(this.elt.id=e,this.width=this.elt.offsetWidth,this.height=this.elt.offsetHeight,this)},i.default.Element.prototype.class=function(e){return void 0===e?this.elt.className:(this.elt.className=e,this)},i.default.Element.prototype.mousePressed=function(e){return i.default.Element._adjustListener("mousedown",(function(t){return this._pInst._setProperty("mouseIsPressed",!0),this._pInst._setMouseButton(t),e.call(this)}),this),this},i.default.Element.prototype.doubleClicked=function(e){return i.default.Element._adjustListener("dblclick",e,this),this},i.default.Element.prototype.mouseWheel=function(e){return i.default.Element._adjustListener("wheel",e,this),this},i.default.Element.prototype.mouseReleased=function(e){return i.default.Element._adjustListener("mouseup",e,this),this},i.default.Element.prototype.mouseClicked=function(e){return i.default.Element._adjustListener("click",e,this),this},i.default.Element.prototype.mouseMoved=function(e){return i.default.Element._adjustListener("mousemove",e,this),this},i.default.Element.prototype.mouseOver=function(e){return i.default.Element._adjustListener("mouseover",e,this),this},i.default.Element.prototype.mouseOut=function(e){return i.default.Element._adjustListener("mouseout",e,this),this},i.default.Element.prototype.touchStarted=function(e){return i.default.Element._adjustListener("touchstart",e,this),this},i.default.Element.prototype.touchMoved=function(e){return i.default.Element._adjustListener("touchmove",e,this),this},i.default.Element.prototype.touchEnded=function(e){return i.default.Element._adjustListener("touchend",e,this),this},i.default.Element.prototype.dragOver=function(e){return i.default.Element._adjustListener("dragover",e,this),this},i.default.Element.prototype.dragLeave=function(e){return i.default.Element._adjustListener("dragleave",e,this),this},i.default.Element._adjustListener=function(e,t,n){return!1===t?i.default.Element._detachListener(e,n):i.default.Element._attachListener(e,t,n),this},i.default.Element._attachListener=function(e,t,n){n._events[e]&&i.default.Element._detachListener(e,n);var r=t.bind(n);n.elt.addEventListener(e,r,!1),n._events[e]=r},i.default.Element._detachListener=function(e,t){var n=t._events[e];t.elt.removeEventListener(e,n,!1),t._events[e]=null},i.default.Element.prototype._setProperty=function(e,t){this[e]=t};var a=i.default.Element;n.default=a},{"./main":260}],262:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e("core-js/modules/es.array.index-of"),e("core-js/modules/es.array.splice"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i,a=(i=e("./main"))&&i.__esModule?i:{default:i},o=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var t="function"!=typeof WeakMap?null:new WeakMap;if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,t&&t.set(e,n),n}(e("./constants"));a.default.Graphics=function(e,t,n,r){var i=n||o.P2D;this.canvas=document.createElement("canvas");var s=r._userNode||document.body;for(var u in s.appendChild(this.canvas),a.default.Element.call(this,this.canvas,r),a.default.prototype)this[u]||("function"==typeof a.default.prototype[u]?this[u]=a.default.prototype[u].bind(this):this[u]=a.default.prototype[u]);return a.default.prototype._initializeInstanceVariables.apply(this),this.width=e,this.height=t,this._pixelDensity=r._pixelDensity,i===o.WEBGL?this._renderer=new a.default.RendererGL(this.canvas,this,!1):this._renderer=new a.default.Renderer2D(this.canvas,this,!1),r._elements.push(this),Object.defineProperty(this,"deltaTime",{get:function(){return this._pInst.deltaTime}}),this._renderer.resize(e,t),this._renderer._applyDefaults(),this},a.default.Graphics.prototype=Object.create(a.default.Element.prototype),a.default.Graphics.prototype.reset=function(){this._renderer.resetMatrix(),this._renderer.isP3D&&this._renderer._update()},a.default.Graphics.prototype.remove=function(){this.elt.parentNode&&this.elt.parentNode.removeChild(this.elt);var e=this._pInst._elements.indexOf(this);for(var t in-1!==e&&this._pInst._elements.splice(e,1),this._events)this.elt.removeEventListener(t,this._events[t])};var s=a.default.Graphics;n.default=s},{"./constants":250,"./main":260,"core-js/modules/es.array.index-of":155,"core-js/modules/es.array.splice":162}],263:[function(e,t,n){"use strict";e("core-js/modules/es.symbol"),e("core-js/modules/es.symbol.description"),e("core-js/modules/es.symbol.iterator"),e("core-js/modules/es.array.iterator"),e("core-js/modules/es.number.constructor"),e("core-js/modules/es.object.assign"),e("core-js/modules/es.object.to-string"),e("core-js/modules/es.regexp.exec"),e("core-js/modules/es.regexp.to-string"),e("core-js/modules/es.string.iterator"),e("core-js/modules/es.string.replace"),e("core-js/modules/es.string.split"),e("core-js/modules/web.dom-collections.iterator"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=(r=e("./main"))&&r.__esModule?r:{default:r},a=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==o(e)&&"function"!=typeof e)return{default:e};var t="function"!=typeof WeakMap?null:new WeakMap;if(t&&t.has(e))return t.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var a=r?Object.getOwnPropertyDescriptor(e,i):null;a&&(a.get||a.set)?Object.defineProperty(n,i,a):n[i]=e[i]}return n.default=e,t&&t.set(e,n),n}(e("../core/constants"));function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e){var t=0,n=0;if(e.offsetParent)for(;t+=e.offsetLeft,n+=e.offsetTop,e=e.offsetParent;);else t+=e.offsetLeft,n+=e.offsetTop;return[t,n]}i.default.Renderer=function(e,t,n){i.default.Element.call(this,e,t),this.canvas=e,this._pixelsState=t,n?(this._isMainCanvas=!0,this._pInst._setProperty("_curElement",this),this._pInst._setProperty("canvas",this.canvas),this._pInst._setProperty("width",this.width),this._pInst._setProperty("height",this.height)):(this.canvas.style.display="none",this._styles=[]),this._textSize=12,this._textLeading=15,this._textFont="sans-serif",this._textStyle=a.NORMAL,this._textAscent=null,this._textDescent=null,this._textAlign=a.LEFT,this._textBaseline=a.BASELINE,this._rectMode=a.CORNER,this._ellipseMode=a.CENTER,this._curveTightness=0,this._imageMode=a.CORNER,this._tint=null,this._doStroke=!0,this._doFill=!0,this._strokeSet=!1,this._fillSet=!1},i.default.Renderer.prototype=Object.create(i.default.Element.prototype),i.default.Renderer.prototype.push=function(){return{properties:{_doStroke:this._doStroke,_strokeSet:this._strokeSet,_doFill:this._doFill,_fillSet:this._fillSet,_tint:this._tint,_imageMode:this._imageMode,_rectMode:this._rectMode,_ellipseMode:this._ellipseMode,_textFont:this._textFont,_textLeading:this._textLeading,_textSize:this._textSize,_textAlign:this._textAlign,_textBaseline:this._textBaseline,_textStyle:this._textStyle}}},i.default.Renderer.prototype.pop=function(e){e.properties&&Object.assign(this,e.properties)},i.default.Renderer.prototype.resize=function(e,t){this.width=e,this.height=t,this.elt.width=e*this._pInst._pixelDensity,this.elt.height=t*this._pInst._pixelDensity,this.elt.style.width="".concat(e,"px"),this.elt.style.height="".concat(t,"px"),this._isMainCanvas&&(this._pInst._setProperty("width",this.width),this._pInst._setProperty("height",this.height))},i.default.Renderer.prototype.get=function(e,t,n,r){var a=this._pixelsState,o=a._pixelDensity,s=this.canvas;if(void 0===e&&void 0===t)e=t=0,n=a.width,r=a.height;else if(e*=o,t*=o,void 0===n&&void 0===r)return e<0||t<0||e>=s.width||t>=s.height?[0,0,0,0]:this._getPixel(e,t);var u=new i.default.Image(n,r);return u.canvas.getContext("2d").drawImage(s,e,t,n*o,r*o,0,0,n,r),u},i.default.Renderer.prototype.textLeading=function(e){return"number"==typeof e?(this._setProperty("_textLeading",e),this._pInst):this._textLeading},i.default.Renderer.prototype.textSize=function(e){return"number"==typeof e?(this._setProperty("_textSize",e),this._setProperty("_textLeading",e*a._DEFAULT_LEADMULT),this._applyTextProperties()):this._textSize},i.default.Renderer.prototype.textStyle=function(e){return e?(e!==a.NORMAL&&e!==a.ITALIC&&e!==a.BOLD&&e!==a.BOLDITALIC||this._setProperty("_textStyle",e),this._applyTextProperties()):this._textStyle},i.default.Renderer.prototype.textAscent=function(){return null===this._textAscent&&this._updateTextMetrics(),this._textAscent},i.default.Renderer.prototype.textDescent=function(){return null===this._textDescent&&this._updateTextMetrics(),this._textDescent},i.default.Renderer.prototype.textAlign=function(e,t){return void 0!==e?(this._setProperty("_textAlign",e),void 0!==t&&this._setProperty("_textBaseline",t),this._applyTextProperties()):{horizontal:this._textAlign,vertical:this._textBaseline}},i.default.Renderer.prototype.text=function(e,t,n,r,i){var o,s,u,c,l,f,d,h,p,m,v=this._pInst,g=Number.MAX_VALUE;if((this._doFill||this._doStroke)&&void 0!==e){if("string"!=typeof e&&(e=e.toString()),o=(e=e.replace(/(\t)/g,"  ")).split("\n"),void 0!==r){for(d=1,u=p=0;u<o.length;u++){for(l="",h=o[u].split(" "),s=0;s<h.length;s++)f="".concat(l+h[s]," "),r<this.textWidth(f)&&1<d?(l="".concat(h[s]," "),p+=v.textLeading(),d=1):(l=f,d+=1);u<o.length-1&&(p+=v.textLeading())}switch(this._rectMode===a.CENTER&&(t-=r/2,n-=i/2),this._textAlign){case a.CENTER:t+=r/2;break;case a.RIGHT:t+=r}var y=!1;if(void 0!==i){switch(this._textBaseline){case a.BOTTOM:m=n+(i-p),n=Math.max(m,n);break;case a.CENTER:m=n+(i-p)/2,n=Math.max(m,n);break;case a.BASELINE:y=!0,this._textBaseline=a.TOP}g=n+i-v.textAscent()}for(u=0;u<o.length;u++){for(l="",h=o[u].split(" "),s=0;s<h.length;s++)f="".concat(l+h[s]," "),r<this.textWidth(f)&&0<l.length?(this._renderText(v,l,t,n,g),l="".concat(h[s]," "),n+=v.textLeading()):l=f;this._renderText(v,l,t,n,g),n+=v.textLeading(),y&&(this._textBaseline=a.BASELINE)}}else{var b=0,x=v.textAlign().vertical;for(x===a.CENTER?b=(o.length-1)*v.textLeading()/2:x===a.BOTTOM&&(b=(o.length-1)*v.textLeading()),c=0;c<o.length;c++)this._renderText(v,o[c],t,n-b,g),n+=v.textLeading()}return v}},i.default.Renderer.prototype._applyDefaults=function(){return this},i.default.Renderer.prototype._isOpenType=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._textFont;return"object"===o(e)&&e.font&&e.font.supported},i.default.Renderer.prototype._updateTextMetrics=function(){if(this._isOpenType())return this._setProperty("_textAscent",this._textFont._textAscent()),this._setProperty("_textDescent",this._textFont._textDescent()),this;var e=document.createElement("span");e.style.fontFamily=this._textFont,e.style.fontSize="".concat(this._textSize,"px"),e.innerHTML="ABCjgq|";var t=document.createElement("div");t.style.display="inline-block",t.style.width="1px",t.style.height="0px";var n=document.createElement("div");n.appendChild(e),n.appendChild(t),n.style.height="0px",n.style.overflow="hidden",document.body.appendChild(n),t.style.verticalAlign="baseline";var r=s(t),i=s(e),a=r[1]-i[1];t.style.verticalAlign="bottom",r=s(t),i=s(e);var o=r[1]-i[1]-a;return document.body.removeChild(n),this._setProperty("_textAscent",a),this._setProperty("_textDescent",o),this};var u=i.default.Renderer;n.default=u},{"../core/constants":250,"./main":260,"core-js/modules/es.array.iterator":156,"core-js/modules/es.number.constructor":167,"core-js/modules/es.object.assign":170,"core-js/modules/es.object.to-string":174,"core-js/modules/es.regexp.exec":178,"core-js/modules/es.regexp.to-string":179,"core-js/modules/es.string.iterator":183,"core-js/modules/es.string.replace":186,"core-js/modules/es.string.split":188,"core-js/modules/es.symbol":193,"core-js/modules/es.symbol.description":191,"core-js/modules/es.symbol.iterator":192,"core-js/modules/web.dom-collections.iterator":226}],264:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e("core-js/modules/es.array.concat"),e("core-js/modules/es.array.fill"),e("core-js/modules/es.array.for-each"),e("core-js/modules/es.array.slice"),e("core-js/modules/es.function.name"),e("core-js/modules/es.number.to-fixed"),e("core-js/modules/es.object.to-string"),e("core-js/modules/es.regexp.to-string"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=s(e("./main")),a=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var t="function"!=typeof WeakMap?null:new WeakMap;if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,t&&t.set(e,n),n}(e("./constants")),o=s(e("../image/filters"));function s(e){return e&&e.__esModule?e:{default:e}}e("./p5.Renderer");var u="rgba(0,0,0,0)";i.default.Renderer2D=function(e,t,n){return i.default.Renderer.call(this,e,t,n),this.drawingContext=this.canvas.getContext("2d"),this._pInst._setProperty("drawingContext",this.drawingContext),this},i.default.Renderer2D.prototype=Object.create(i.default.Renderer.prototype),i.default.Renderer2D.prototype._applyDefaults=function(){this._cachedFillStyle=this._cachedStrokeStyle=void 0,this._cachedBlendMode=a.BLEND,this._setFill(a._DEFAULT_FILL),this._setStroke(a._DEFAULT_STROKE),this.drawingContext.lineCap=a.ROUND,this.drawingContext.font="normal 12px sans-serif"},i.default.Renderer2D.prototype.resize=function(e,t){i.default.Renderer.prototype.resize.call(this,e,t),this.drawingContext.scale(this._pInst._pixelDensity,this._pInst._pixelDensity)},i.default.Renderer2D.prototype.background=function(){if(this.drawingContext.save(),this.resetMatrix(),(arguments.length<=0?void 0:arguments[0])instanceof i.default.Image)this._pInst.image(arguments.length<=0?void 0:arguments[0],0,0,this.width,this.height);else{var e,t=this._getFill(),n=(e=this._pInst).color.apply(e,arguments);this._pInst._addAccsOutput()&&this._pInst._accsBackground(n.levels);var r=n.toString();this._setFill(r),this._isErasing&&this.blendMode(this._cachedBlendMode),this.drawingContext.fillRect(0,0,this.width,this.height),this._setFill(t),this._isErasing&&this._pInst.erase()}this.drawingContext.restore()},i.default.Renderer2D.prototype.clear=function(){this.drawingContext.save(),this.resetMatrix(),this.drawingContext.clearRect(0,0,this.width,this.height),this.drawingContext.restore()},i.default.Renderer2D.prototype.fill=function(){var e,t=(e=this._pInst).color.apply(e,arguments);this._setFill(t.toString()),this._pInst._addAccsOutput()&&this._pInst._accsCanvasColors("fill",t.levels)},i.default.Renderer2D.prototype.stroke=function(){var e,t=(e=this._pInst).color.apply(e,arguments);this._setStroke(t.toString()),this._pInst._addAccsOutput()&&this._pInst._accsCanvasColors("stroke",t.levels)},i.default.Renderer2D.prototype.erase=function(e,t){if(!this._isErasing){this._cachedFillStyle=this.drawingContext.fillStyle;var n=this._pInst.color(255,e).toString();this.drawingContext.fillStyle=n,this._cachedStrokeStyle=this.drawingContext.strokeStyle;var r=this._pInst.color(255,t).toString();this.drawingContext.strokeStyle=r;var i=this._cachedBlendMode;this.blendMode(a.REMOVE),this._cachedBlendMode=i,this._isErasing=!0}},i.default.Renderer2D.prototype.noErase=function(){this._isErasing&&(this.drawingContext.fillStyle=this._cachedFillStyle,this.drawingContext.strokeStyle=this._cachedStrokeStyle,this.blendMode(this._cachedBlendMode),this._isErasing=!1)},i.default.Renderer2D.prototype.image=function(e,t,n,r,a,o,s,u,c){var l;e.gifProperties&&e._animateGif(this._pInst);try{this._tint&&(i.default.MediaElement&&e instanceof i.default.MediaElement&&e.loadPixels(),e.canvas&&(l=this._getTintedImageCanvas(e))),l=l||e.canvas||e.elt;var f=1;e.width&&0<e.width&&(f=l.width/e.width),this._isErasing&&this.blendMode(this._cachedBlendMode),this.drawingContext.drawImage(l,f*t,f*n,f*r,f*a,o,s,u,c),this._isErasing&&this._pInst.erase()}catch(e){if("NS_ERROR_NOT_AVAILABLE"!==e.name)throw e}},i.default.Renderer2D.prototype._getTintedImageCanvas=function(e){if(!e.canvas)return e;var t=o.default._toPixels(e.canvas),n=document.createElement("canvas");n.width=e.canvas.width,n.height=e.canvas.height;for(var r=n.getContext("2d"),i=r.createImageData(e.canvas.width,e.canvas.height),a=i.data,s=0;s<t.length;s+=4){var u=t[s],c=t[s+1],l=t[s+2],f=t[s+3];a[s]=u*this._tint[0]/255,a[s+1]=c*this._tint[1]/255,a[s+2]=l*this._tint[2]/255,a[s+3]=f*this._tint[3]/255}return r.putImageData(i,0,0),n},i.default.Renderer2D.prototype.blendMode=function(e){if(e===a.SUBTRACT)console.warn("blendMode(SUBTRACT) only works in WEBGL mode.");else{if(e!==a.BLEND&&e!==a.REMOVE&&e!==a.DARKEST&&e!==a.LIGHTEST&&e!==a.DIFFERENCE&&e!==a.MULTIPLY&&e!==a.EXCLUSION&&e!==a.SCREEN&&e!==a.REPLACE&&e!==a.OVERLAY&&e!==a.HARD_LIGHT&&e!==a.SOFT_LIGHT&&e!==a.DODGE&&e!==a.BURN&&e!==a.ADD)throw new Error("Mode ".concat(e," not recognized."));this._cachedBlendMode=e,this.drawingContext.globalCompositeOperation=e}},i.default.Renderer2D.prototype.blend=function(){for(var e=this.drawingContext.globalCompositeOperation,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var a=n[n.length-1],o=Array.prototype.slice.call(n,0,n.length-1);this.drawingContext.globalCompositeOperation=a,i.default.prototype.copy.apply(this,o),this.drawingContext.globalCompositeOperation=e},i.default.Renderer2D.prototype._getPixel=function(e,t){var n;return[(n=this.drawingContext.getImageData(e,t,1,1).data)[0],n[1],n[2],n[3]]},i.default.Renderer2D.prototype.loadPixels=function(){var e=this._pixelsState,t=e._pixelDensity,n=this.width*t,r=this.height*t,i=this.drawingContext.getImageData(0,0,n,r);e._setProperty("imageData",i),e._setProperty("pixels",i.data)},i.default.Renderer2D.prototype.set=function(e,t,n){e=Math.floor(e),t=Math.floor(t);var r=this._pixelsState;if(n instanceof i.default.Image)this.drawingContext.save(),this.drawingContext.setTransform(1,0,0,1,0,0),this.drawingContext.scale(r._pixelDensity,r._pixelDensity),this.drawingContext.clearRect(e,t,n.width,n.height),this.drawingContext.drawImage(n.canvas,e,t),this.drawingContext.restore();else{var a=0,o=0,s=0,u=0,c=4*(t*r._pixelDensity*(this.width*r._pixelDensity)+e*r._pixelDensity);if(r.imageData||r.loadPixels.call(r),"number"==typeof n)c<r.pixels.length&&(s=o=a=n,u=255);else if(n instanceof Array){if(n.length<4)throw new Error("pixel array must be of the form [R, G, B, A]");c<r.pixels.length&&(a=n[0],o=n[1],s=n[2],u=n[3])}else n instanceof i.default.Color&&c<r.pixels.length&&(a=n.levels[0],o=n.levels[1],s=n.levels[2],u=n.levels[3]);for(var l=0;l<r._pixelDensity;l++)for(var f=0;f<r._pixelDensity;f++)c=4*((t*r._pixelDensity+f)*this.width*r._pixelDensity+(e*r._pixelDensity+l)),r.pixels[c]=a,r.pixels[c+1]=o,r.pixels[c+2]=s,r.pixels[c+3]=u}},i.default.Renderer2D.prototype.updatePixels=function(e,t,n,r){var i=this._pixelsState,a=i._pixelDensity;void 0===e&&void 0===t&&void 0===n&&void 0===r&&(t=e=0,n=this.width,r=this.height),e*=a,t*=a,n*=a,r*=a,this.gifProperties&&(this.gifProperties.frames[this.gifProperties.displayIndex].image=i.imageData),this.drawingContext.putImageData(i.imageData,e,t,0,0,n,r)},i.default.Renderer2D.prototype._acuteArcToBezier=function(e,t){var n=t/2,r=Math.cos(n),i=Math.sin(n),a=1/Math.tan(n),o=e+n,s=Math.cos(o),u=Math.sin(o),c=(4-r)/3,l=i+(r-c)*a;return{ax:Math.cos(e).toFixed(7),ay:Math.sin(e).toFixed(7),bx:(c*s+l*u).toFixed(7),by:(c*u-l*s).toFixed(7),cx:(c*s-l*u).toFixed(7),cy:(c*u+l*s).toFixed(7),dx:Math.cos(e+t).toFixed(7),dy:Math.sin(e+t).toFixed(7)}},i.default.Renderer2D.prototype.arc=function(e,t,n,r,i,o,s){var u=this.drawingContext,c=n/2,l=r/2,f=0,d=[];for(e+=c,t+=l;1e-5<=o-i;)f=Math.min(o-i,a.HALF_PI),d.push(this._acuteArcToBezier(i,f)),i+=f;return this._doFill&&(u.beginPath(),d.forEach((function(n,r){0===r&&u.moveTo(e+n.ax*c,t+n.ay*l),u.bezierCurveTo(e+n.bx*c,t+n.by*l,e+n.cx*c,t+n.cy*l,e+n.dx*c,t+n.dy*l)})),s!==a.PIE&&null!=s||u.lineTo(e,t),u.closePath(),u.fill()),this._doStroke&&(u.beginPath(),d.forEach((function(n,r){0===r&&u.moveTo(e+n.ax*c,t+n.ay*l),u.bezierCurveTo(e+n.bx*c,t+n.by*l,e+n.cx*c,t+n.cy*l,e+n.dx*c,t+n.dy*l)})),s===a.PIE?(u.lineTo(e,t),u.closePath()):s===a.CHORD&&u.closePath(),u.stroke()),this},i.default.Renderer2D.prototype.ellipse=function(e){var t=this.drawingContext,n=this._doFill,r=this._doStroke,i=parseFloat(e[0]),a=parseFloat(e[1]),o=parseFloat(e[2]),s=parseFloat(e[3]);if(n&&!r){if(this._getFill()===u)return this}else if(!n&&r&&this._getStroke()===u)return this;var c=o/2*.5522847498,l=s/2*.5522847498,f=i+o,d=a+s,h=i+o/2,p=a+s/2;t.beginPath(),t.moveTo(i,p),t.bezierCurveTo(i,p-l,h-c,a,h,a),t.bezierCurveTo(h+c,a,f,p-l,f,p),t.bezierCurveTo(f,p+l,h+c,d,h,d),t.bezierCurveTo(h-c,d,i,p+l,i,p),n&&t.fill(),r&&t.stroke()},i.default.Renderer2D.prototype.line=function(e,t,n,r){var i=this.drawingContext;return this._doStroke&&(this._getStroke()===u||(i.beginPath(),i.moveTo(e,t),i.lineTo(n,r),i.stroke())),this},i.default.Renderer2D.prototype.point=function(e,t){var n=this.drawingContext;if(!this._doStroke)return this;if(this._getStroke()===u)return this;var r=this._getStroke(),i=this._getFill();this._setFill(r),n.beginPath(),n.arc(e,t,n.lineWidth/2,0,a.TWO_PI,!1),n.fill(),this._setFill(i)},i.default.Renderer2D.prototype.quad=function(e,t,n,r,i,a,o,s){var c=this.drawingContext,l=this._doFill,f=this._doStroke;if(l&&!f){if(this._getFill()===u)return this}else if(!l&&f&&this._getStroke()===u)return this;return c.beginPath(),c.moveTo(e,t),c.lineTo(n,r),c.lineTo(i,a),c.lineTo(o,s),c.closePath(),l&&c.fill(),f&&c.stroke(),this},i.default.Renderer2D.prototype.rect=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],c=e[7],l=this.drawingContext,f=this._doFill,d=this._doStroke;if(f&&!d){if(this._getFill()===u)return this}else if(!f&&d&&this._getStroke()===u)return this;if(l.beginPath(),void 0===a)l.rect(t,n,r,i);else{void 0===o&&(o=a),void 0===s&&(s=o),void 0===c&&(c=s);var h=Math.abs(r),p=Math.abs(i),m=h/2,v=p/2;h<2*a&&(a=m),p<2*a&&(a=v),h<2*o&&(o=m),p<2*o&&(o=v),h<2*s&&(s=m),p<2*s&&(s=v),h<2*c&&(c=m),p<2*c&&(c=v),l.beginPath(),l.moveTo(t+a,n),l.arcTo(t+r,n,t+r,n+i,o),l.arcTo(t+r,n+i,t,n+i,s),l.arcTo(t,n+i,t,n,c),l.arcTo(t,n,t+r,n,a),l.closePath()}return this._doFill&&l.fill(),this._doStroke&&l.stroke(),this},i.default.Renderer2D.prototype.triangle=function(e){var t=this.drawingContext,n=this._doFill,r=this._doStroke,i=e[0],a=e[1],o=e[2],s=e[3],c=e[4],l=e[5];if(n&&!r){if(this._getFill()===u)return this}else if(!n&&r&&this._getStroke()===u)return this;t.beginPath(),t.moveTo(i,a),t.lineTo(o,s),t.lineTo(c,l),t.closePath(),n&&t.fill(),r&&t.stroke()},i.default.Renderer2D.prototype.endShape=function(e,t,n,r,i,o,s){if(0===t.length)return this;if(!this._doStroke&&!this._doFill)return this;var u,c,l,f=e===a.CLOSE;f&&!o&&t.push(t[0]);var d=t.length;if(!n||s!==a.POLYGON&&null!==s)if(!r||s!==a.POLYGON&&null!==s)if(!i||s!==a.POLYGON&&null!==s)if(s===a.POINTS)for(c=0;c<d;c++)u=t[c],this._doStroke&&this._pInst.stroke(u[6]),this._pInst.point(u[0],u[1]);else if(s===a.LINES)for(c=0;c+1<d;c+=2)u=t[c],this._doStroke&&this._pInst.stroke(t[c+1][6]),this._pInst.line(u[0],u[1],t[c+1][0],t[c+1][1]);else if(s===a.TRIANGLES)for(c=0;c+2<d;c+=3)u=t[c],this.drawingContext.beginPath(),this.drawingContext.moveTo(u[0],u[1]),this.drawingContext.lineTo(t[c+1][0],t[c+1][1]),this.drawingContext.lineTo(t[c+2][0],t[c+2][1]),this.drawingContext.closePath(),this._doFill&&(this._pInst.fill(t[c+2][5]),this.drawingContext.fill()),this._doStroke&&(this._pInst.stroke(t[c+2][6]),this.drawingContext.stroke());else if(s===a.TRIANGLE_STRIP)for(c=0;c+1<d;c++)u=t[c],this.drawingContext.beginPath(),this.drawingContext.moveTo(t[c+1][0],t[c+1][1]),this.drawingContext.lineTo(u[0],u[1]),this._doStroke&&this._pInst.stroke(t[c+1][6]),this._doFill&&this._pInst.fill(t[c+1][5]),c+2<d&&(this.drawingContext.lineTo(t[c+2][0],t[c+2][1]),this._doStroke&&this._pInst.stroke(t[c+2][6]),this._doFill&&this._pInst.fill(t[c+2][5])),this._doFillStrokeClose(f);else if(s===a.TRIANGLE_FAN){if(2<d){for(this.drawingContext.beginPath(),c=2;c<d;c++)u=t[c],this.drawingContext.moveTo(t[0][0],t[0][1]),this.drawingContext.lineTo(t[c-1][0],t[c-1][1]),this.drawingContext.lineTo(u[0],u[1]),this.drawingContext.lineTo(t[0][0],t[0][1]),c<d-1&&(this._doFill&&u[5]!==t[c+1][5]||this._doStroke&&u[6]!==t[c+1][6])&&(this._doFill&&(this._pInst.fill(u[5]),this.drawingContext.fill(),this._pInst.fill(t[c+1][5])),this._doStroke&&(this._pInst.stroke(u[6]),this.drawingContext.stroke(),this._pInst.stroke(t[c+1][6])),this.drawingContext.closePath(),this.drawingContext.beginPath());this._doFillStrokeClose(f)}}else if(s===a.QUADS)for(c=0;c+3<d;c+=4){for(u=t[c],this.drawingContext.beginPath(),this.drawingContext.moveTo(u[0],u[1]),l=1;l<4;l++)this.drawingContext.lineTo(t[c+l][0],t[c+l][1]);this.drawingContext.lineTo(u[0],u[1]),this._doFill&&this._pInst.fill(t[c+3][5]),this._doStroke&&this._pInst.stroke(t[c+3][6]),this._doFillStrokeClose(f)}else if(s===a.QUAD_STRIP){if(3<d)for(c=0;c+1<d;c+=2)u=t[c],this.drawingContext.beginPath(),c+3<d?(this.drawingContext.moveTo(t[c+2][0],t[c+2][1]),this.drawingContext.lineTo(u[0],u[1]),this.drawingContext.lineTo(t[c+1][0],t[c+1][1]),this.drawingContext.lineTo(t[c+3][0],t[c+3][1]),this._doFill&&this._pInst.fill(t[c+3][5]),this._doStroke&&this._pInst.stroke(t[c+3][6])):(this.drawingContext.moveTo(u[0],u[1]),this.drawingContext.lineTo(t[c+1][0],t[c+1][1])),this._doFillStrokeClose(f)}else{for(this.drawingContext.beginPath(),this.drawingContext.moveTo(t[0][0],t[0][1]),c=1;c<d;c++)(u=t[c]).isVert&&(u.moveTo?this.drawingContext.moveTo(u[0],u[1]):this.drawingContext.lineTo(u[0],u[1]));this._doFillStrokeClose(f)}else{for(this.drawingContext.beginPath(),c=0;c<d;c++)t[c].isVert?t[c].moveTo?this.drawingContext.moveTo(t[c][0],t[c][1]):this.drawingContext.lineTo(t[c][0],t[c][1]):this.drawingContext.quadraticCurveTo(t[c][0],t[c][1],t[c][2],t[c][3]);this._doFillStrokeClose(f)}else{for(this.drawingContext.beginPath(),c=0;c<d;c++)t[c].isVert?t[c].moveTo?this.drawingContext.moveTo(t[c][0],t[c][1]):this.drawingContext.lineTo(t[c][0],t[c][1]):this.drawingContext.bezierCurveTo(t[c][0],t[c][1],t[c][2],t[c][3],t[c][4],t[c][5]);this._doFillStrokeClose(f)}else if(3<d){var h=[],p=1-this._curveTightness;for(this.drawingContext.beginPath(),this.drawingContext.moveTo(t[1][0],t[1][1]),c=1;c+2<d;c++)u=t[c],h[0]=[u[0],u[1]],h[1]=[u[0]+(p*t[c+1][0]-p*t[c-1][0])/6,u[1]+(p*t[c+1][1]-p*t[c-1][1])/6],h[2]=[t[c+1][0]+(p*t[c][0]-p*t[c+2][0])/6,t[c+1][1]+(p*t[c][1]-p*t[c+2][1])/6],h[3]=[t[c+1][0],t[c+1][1]],this.drawingContext.bezierCurveTo(h[1][0],h[1][1],h[2][0],h[2][1],h[3][0],h[3][1]);f&&this.drawingContext.lineTo(t[c+1][0],t[c+1][1]),this._doFillStrokeClose(f)}return o=i=r=n=!1,f&&t.pop(),this},i.default.Renderer2D.prototype.strokeCap=function(e){return e!==a.ROUND&&e!==a.SQUARE&&e!==a.PROJECT||(this.drawingContext.lineCap=e),this},i.default.Renderer2D.prototype.strokeJoin=function(e){return e!==a.ROUND&&e!==a.BEVEL&&e!==a.MITER||(this.drawingContext.lineJoin=e),this},i.default.Renderer2D.prototype.strokeWeight=function(e){return this.drawingContext.lineWidth=void 0===e||0===e?1e-4:e,this},i.default.Renderer2D.prototype._getFill=function(){return this._cachedFillStyle||(this._cachedFillStyle=this.drawingContext.fillStyle),this._cachedFillStyle},i.default.Renderer2D.prototype._setFill=function(e){e!==this._cachedFillStyle&&(this.drawingContext.fillStyle=e,this._cachedFillStyle=e)},i.default.Renderer2D.prototype._getStroke=function(){return this._cachedStrokeStyle||(this._cachedStrokeStyle=this.drawingContext.strokeStyle),this._cachedStrokeStyle},i.default.Renderer2D.prototype._setStroke=function(e){e!==this._cachedStrokeStyle&&(this.drawingContext.strokeStyle=e,this._cachedStrokeStyle=e)},i.default.Renderer2D.prototype.bezier=function(e,t,n,r,i,a,o,s){return this._pInst.beginShape(),this._pInst.vertex(e,t),this._pInst.bezierVertex(n,r,i,a,o,s),this._pInst.endShape(),this},i.default.Renderer2D.prototype.curve=function(e,t,n,r,i,a,o,s){return this._pInst.beginShape(),this._pInst.curveVertex(e,t),this._pInst.curveVertex(n,r),this._pInst.curveVertex(i,a),this._pInst.curveVertex(o,s),this._pInst.endShape(),this},i.default.Renderer2D.prototype._doFillStrokeClose=function(e){e&&this.drawingContext.closePath(),this._doFill&&this.drawingContext.fill(),this._doStroke&&this.drawingContext.stroke()},i.default.Renderer2D.prototype.applyMatrix=function(e,t,n,r,i,a){this.drawingContext.transform(e,t,n,r,i,a)},i.default.Renderer2D.prototype.resetMatrix=function(){return this.drawingContext.setTransform(1,0,0,1,0,0),this.drawingContext.scale(this._pInst._pixelDensity,this._pInst._pixelDensity),this},i.default.Renderer2D.prototype.rotate=function(e){this.drawingContext.rotate(e)},i.default.Renderer2D.prototype.scale=function(e,t){return this.drawingContext.scale(e,t),this},i.default.Renderer2D.prototype.translate=function(e,t){return e instanceof i.default.Vector&&(t=e.y,e=e.x),this.drawingContext.translate(e,t),this},i.default.Renderer2D.prototype.text=function(e,t,n,r,o){var s;void 0!==r&&this.drawingContext.textBaseline===a.BASELINE&&(s=!0,this.drawingContext.textBaseline=a.TOP);var u=i.default.Renderer.prototype.text.apply(this,arguments);return s&&(this.drawingContext.textBaseline=a.BASELINE),u},i.default.Renderer2D.prototype._renderText=function(e,t,n,r,i){if(!(i<=r))return e.push(),this._isOpenType()?this._textFont._renderPath(t,n,r,{renderer:this}):(this._doStroke&&this._strokeSet&&this.drawingContext.strokeText(t,n,r),this._doFill&&(this._fillSet||this._setFill(a._DEFAULT_TEXT_FILL),this.drawingContext.fillText(t,n,r))),e.pop(),e},i.default.Renderer2D.prototype.textWidth=function(e){return this._isOpenType()?this._textFont._textWidth(e,this._textSize):this.drawingContext.measureText(e).width},i.default.Renderer2D.prototype._applyTextProperties=function(){var e,t=this._pInst;return this._setProperty("_textAscent",null),this._setProperty("_textDescent",null),e=this._textFont,this._isOpenType()&&(e=this._textFont.font.familyName,this._setProperty("_textStyle",this._textFont.font.styleName)),this.drawingContext.font="".concat(this._textStyle||"normal"," ").concat(this._textSize||12,"px ").concat(e||"sans-serif"),this.drawingContext.textAlign=this._textAlign,this._textBaseline===a.CENTER?this.drawingContext.textBaseline=a._CTX_MIDDLE:this.drawingContext.textBaseline=this._textBaseline,t},i.default.Renderer2D.prototype.push=function(){return this.drawingContext.save(),i.default.Renderer.prototype.push.apply(this)},i.default.Renderer2D.prototype.pop=function(e){this.drawingContext.restore(),this._cachedFillStyle=this.drawingContext.fillStyle,this._cachedStrokeStyle=this.drawingContext.strokeStyle,i.default.Renderer.prototype.pop.call(this,e)};var c=i.default.Renderer2D;n.default=c},{"../image/filters":281,"./constants":250,"./main":260,"./p5.Renderer":263,"core-js/modules/es.array.concat":148,"core-js/modules/es.array.fill":150,"core-js/modules/es.array.for-each":152,"core-js/modules/es.array.slice":160,"core-js/modules/es.function.name":163,"core-js/modules/es.number.to-fixed":169,"core-js/modules/es.object.to-string":174,"core-js/modules/es.regexp.to-string":179}],265:[function(e,t,n){"use strict";e("core-js/modules/es.symbol"),e("core-js/modules/es.symbol.description"),e("core-js/modules/es.symbol.iterator"),e("core-js/modules/es.array.iterator"),e("core-js/modules/es.object.assign"),e("core-js/modules/es.object.to-string"),e("core-js/modules/es.promise"),e("core-js/modules/es.string.iterator"),e("core-js/modules/web.dom-collections.iterator");var r,i=(r=e("./main"))&&r.__esModule?r:{default:r};i.default.prototype._promisePreloads=[];var a=!(i.default.prototype.registerPromisePreload=function(e){i.default.prototype._promisePreloads.push(e)});function o(){return{}}i.default.prototype._setupPromisePreloads=function(){var e=!0,t=!1,n=void 0;try{for(var r,o=this._promisePreloads[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,u=this,c=s.method,l=s.addCallbacks,f=s.legacyPreloadSetup,d=s.target||this,h=d[c].bind(d);if(d===i.default.prototype){if(a)continue;u=null,h=d[c]}d[c]=this._wrapPromisePreload(u,h,l),f&&(d[f.method]=this._legacyPreloadGenerator(u,f,d[c]))}}catch(e){t=!0,n=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw n}}a=!0},i.default.prototype._wrapPromisePreload=function(e,t,n){var r=function(){var e=this;this._incrementPreload();for(var r=null,i=null,a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];if(n)for(var u=o.length-1;0<=u&&!i&&"function"==typeof o[u];u--)i=r,r=o.pop();var c=Promise.resolve(t.apply(this,o));return r&&c.then(r),i&&c.catch(i),c.then((function(){return e._decrementPreload()})),c};return e&&(r=r.bind(e)),r},i.default.prototype._legacyPreloadGenerator=function(e,t,n){var r=t.createBaseObject||o,i=function(){var e=this;this._incrementPreload();var t=r.apply(this,arguments);return n.apply(this,arguments).then((function(n){Object.assign(t,n),e._decrementPreload()})),t};return e&&(i=i.bind(e)),i}},{"./main":260,"core-js/modules/es.array.iterator":156,"core-js/modules/es.object.assign":170,"core-js/modules/es.object.to-string":174,"core-js/modules/es.promise":175,"core-js/modules/es.string.iterator":183,"core-js/modules/es.symbol":193,"core-js/modules/es.symbol.description":191,"core-js/modules/es.symbol.iterator":192,"core-js/modules/web.dom-collections.iterator":226}],266:[function(e,t,n){"use strict";e("core-js/modules/es.symbol"),e("core-js/modules/es.symbol.description"),e("core-js/modules/es.symbol.iterator"),e("core-js/modules/es.array.filter"),e("core-js/modules/es.array.iterator"),e("core-js/modules/es.object.to-string"),e("core-js/modules/es.string.iterator"),e("core-js/modules/web.dom-collections.iterator"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=(r=e("./main"))&&r.__esModule?r:{default:r},a=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==o(e)&&"function"!=typeof e)return{default:e};var t="function"!=typeof WeakMap?null:new WeakMap;if(t&&t.has(e))return t.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var a=r?Object.getOwnPropertyDescriptor(e,i):null;a&&(a.get||a.set)?Object.defineProperty(n,i,a):n[i]=e[i]}return n.default=e,t&&t.set(e,n),n}(e("./constants"));function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e("./p5.Graphics"),e("./p5.Renderer2D"),e("../webgl/p5.RendererGL");var s="defaultCanvas0";i.default.prototype.createCanvas=function(e,t,n){i.default._validateParameters("createCanvas",arguments);var r,o=n||a.P2D;if(o===a.WEBGL){if(r=document.getElementById(s)){r.parentNode.removeChild(r);var u=this._renderer;this._elements=this._elements.filter((function(e){return e!==u}))}(r=document.createElement("canvas")).id=s,r.classList.add("p5Canvas")}else if(this._defaultGraphicsCreated)r=this.canvas;else{r=document.createElement("canvas");for(var c=0;document.getElementById("defaultCanvas".concat(c));)c++;s="defaultCanvas".concat(c),r.id=s,r.classList.add("p5Canvas")}if(this._setupDone||(r.dataset.hidden=!0,r.style.visibility="hidden"),this._userNode)this._userNode.appendChild(r);else{if(0===document.getElementsByTagName("main").length){var l=document.createElement("main");document.body.appendChild(l)}document.getElementsByTagName("main")[0].appendChild(r)}return o===a.WEBGL?(this._setProperty("_renderer",new i.default.RendererGL(r,this,!0)),this._elements.push(this._renderer)):this._defaultGraphicsCreated||(this._setProperty("_renderer",new i.default.Renderer2D(r,this,!0)),this._defaultGraphicsCreated=!0,this._elements.push(this._renderer)),this._renderer.resize(e,t),this._renderer._applyDefaults(),this._renderer},i.default.prototype.resizeCanvas=function(e,t,n){if(i.default._validateParameters("resizeCanvas",arguments),this._renderer){var r={};for(var a in this.drawingContext){var s=this.drawingContext[a];"object"!==o(s)&&"function"!=typeof s&&(r[a]=s)}for(var u in this._renderer.resize(e,t),this.width=e,this.height=t,r)try{this.drawingContext[u]=r[u]}catch(e){}n||this.redraw()}this._addAccsOutput()&&this._updateAccsOutput()},i.default.prototype.noCanvas=function(){this.canvas&&this.canvas.parentNode.removeChild(this.canvas)},i.default.prototype.createGraphics=function(e,t,n){return i.default._validateParameters("createGraphics",arguments),new i.default.Graphics(e,t,n,this)},i.default.prototype.blendMode=function(e){i.default._validateParameters("blendMode",arguments),e===a.NORMAL&&(console.warn("NORMAL has been deprecated for use in blendMode. defaulting to BLEND instead."),e=a.BLEND),this._renderer.blendMode(e)};var u=i.default;n.default=u},{"../webgl/p5.RendererGL":314,"./constants":250,"./main":260,"./p5.Graphics":262,"./p5.Renderer2D":264,"core-js/modules/es.array.filter":151,"core-js/modules/es.array.iterator":156,"core-js/modules/es.object.to-string":174,"core-js/modules/es.string.iterator":183,"core-js/modules/es.symbol":193,"core-js/modules/es.symbol.description":191,"core-js/modules/es.symbol.iterator":192,"core-js/modules/web.dom-collections.iterator":226}],267:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e("core-js/modules/es.array.slice"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=s(e("../main")),a=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var t="function"!=typeof WeakMap?null:new WeakMap;if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,t&&t.set(e,n),n}(e("../constants")),o=s(e("../helpers"));function s(e){return e&&e.__esModule?e:{default:e}}e("../friendly_errors/fes_core"),e("../friendly_errors/file_errors"),e("../friendly_errors/validate_params"),i.default.prototype._normalizeArcAngles=function(e,t,n,r,i){var o;return e-=a.TWO_PI*Math.floor(e/a.TWO_PI),t-=a.TWO_PI*Math.floor(t/a.TWO_PI),o=Math.min(Math.abs(e-t),a.TWO_PI-Math.abs(e-t)),i&&(e=e<=a.HALF_PI?Math.atan(n/r*Math.tan(e)):e>a.HALF_PI&&e<=3*a.HALF_PI?Math.atan(n/r*Math.tan(e))+a.PI:Math.atan(n/r*Math.tan(e))+a.TWO_PI,t=t<=a.HALF_PI?Math.atan(n/r*Math.tan(t)):t>a.HALF_PI&&t<=3*a.HALF_PI?Math.atan(n/r*Math.tan(t))+a.PI:Math.atan(n/r*Math.tan(t))+a.TWO_PI),t<e&&(t+=a.TWO_PI),{start:e,stop:t,correspondToSamePoint:o<1e-5}},i.default.prototype.arc=function(e,t,n,r,a,s,u,c){if(i.default._validateParameters("arc",arguments),!this._renderer._doStroke&&!this._renderer._doFill)return this;if(a===s)return this;a=this._toRadians(a),s=this._toRadians(s),n=Math.abs(n),r=Math.abs(r);var l=o.default.modeAdjust(e,t,n,r,this._renderer._ellipseMode),f=this._normalizeArcAngles(a,s,l.w,l.h,!0);return f.correspondToSamePoint?this._renderer.ellipse([l.x,l.y,l.w,l.h,c]):(this._renderer.arc(l.x,l.y,l.w,l.h,f.start,f.stop,u,c),(this._accessibleOutputs.grid||this._accessibleOutputs.text)&&this._accsOutput("arc",[l.x,l.y,l.w,l.h,f.start,f.stop,u])),this},i.default.prototype.ellipse=function(e,t,n,r,a){return i.default._validateParameters("ellipse",arguments),this._renderEllipse.apply(this,arguments)},i.default.prototype.circle=function(){i.default._validateParameters("circle",arguments);var e=Array.prototype.slice.call(arguments,0,2);return e.push(arguments[2]),e.push(arguments[2]),this._renderEllipse.apply(this,e)},i.default.prototype._renderEllipse=function(e,t,n,r,i){if(!this._renderer._doStroke&&!this._renderer._doFill)return this;n<0&&(n=Math.abs(n)),void 0===r?r=n:r<0&&(r=Math.abs(r));var a=o.default.modeAdjust(e,t,n,r,this._renderer._ellipseMode);return this._renderer.ellipse([a.x,a.y,a.w,a.h,i]),(this._accessibleOutputs.grid||this._accessibleOutputs.text)&&this._accsOutput("ellipse",[a.x,a.y,a.w,a.h]),this},i.default.prototype.line=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r;return i.default._validateParameters("line",t),this._renderer._doStroke&&(r=this._renderer).line.apply(r,t),(this._accessibleOutputs.grid||this._accessibleOutputs.text)&&this._accsOutput("line",t),this},i.default.prototype.point=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r;return i.default._validateParameters("point",t),this._renderer._doStroke&&(1===t.length&&t[0]instanceof i.default.Vector?this._renderer.point.call(this._renderer,t[0].x,t[0].y,t[0].z):((r=this._renderer).point.apply(r,t),(this._accessibleOutputs.grid||this._accessibleOutputs.text)&&this._accsOutput("point",t))),this},i.default.prototype.quad=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r;return i.default._validateParameters("quad",t),(this._renderer._doStroke||this._renderer._doFill)&&(this._renderer.isP3D&&t.length<=12?this._renderer.quad.call(this._renderer,t[0],t[1],0,t[2],t[3],0,t[4],t[5],0,t[6],t[7],0,t[8],t[9]):((r=this._renderer).quad.apply(r,t),(this._accessibleOutputs.grid||this._accessibleOutputs.text)&&this._accsOutput("quadrilateral",t))),this},i.default.prototype.rect=function(){return i.default._validateParameters("rect",arguments),this._renderRect.apply(this,arguments)},i.default.prototype.square=function(e,t,n,r,a,o,s){return i.default._validateParameters("square",arguments),this._renderRect.call(this,e,t,n,n,r,a,o,s)},i.default.prototype._renderRect=function(){if(this._renderer._doStroke||this._renderer._doFill){3===arguments.length&&(arguments[3]=arguments[2]);for(var e=o.default.modeAdjust(arguments[0],arguments[1],arguments[2],arguments[3],this._renderer._rectMode),t=[e.x,e.y,e.w,e.h],n=4;n<arguments.length;n++)t[n]=arguments[n];this._renderer.rect(t),(this._accessibleOutputs.grid||this._accessibleOutputs.text)&&this._accsOutput("rectangle",[e.x,e.y,e.w,e.h])}return this},i.default.prototype.triangle=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return i.default._validateParameters("triangle",t),(this._renderer._doStroke||this._renderer._doFill)&&this._renderer.triangle(t),(this._accessibleOutputs.grid||this._accessibleOutputs.text)&&this._accsOutput("triangle",t),this};var u=i.default;n.default=u},{"../constants":250,"../friendly_errors/fes_core":252,"../friendly_errors/file_errors":253,"../friendly_errors/validate_params":255,"../helpers":256,"../main":260,"core-js/modules/es.array.slice":160}],268:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i,a=(i=e("../main"))&&i.__esModule?i:{default:i},o=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var t="function"!=typeof WeakMap?null:new WeakMap;if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,t&&t.set(e,n),n}(e("../constants"));a.default.prototype.ellipseMode=function(e){return a.default._validateParameters("ellipseMode",arguments),e!==o.CORNER&&e!==o.CORNERS&&e!==o.RADIUS&&e!==o.CENTER||(this._renderer._ellipseMode=e),this},a.default.prototype.noSmooth=function(){return this.setAttributes("antialias",!1),this._renderer.isP3D||"imageSmoothingEnabled"in this.drawingContext&&(this.drawingContext.imageSmoothingEnabled=!1),this},a.default.prototype.rectMode=function(e){return a.default._validateParameters("rectMode",arguments),e!==o.CORNER&&e!==o.CORNERS&&e!==o.RADIUS&&e!==o.CENTER||(this._renderer._rectMode=e),this},a.default.prototype.smooth=function(){return this.setAttributes("antialias",!0),this._renderer.isP3D||"imageSmoothingEnabled"in this.drawingContext&&(this.drawingContext.imageSmoothingEnabled=!0),this},a.default.prototype.strokeCap=function(e){return a.default._validateParameters("strokeCap",arguments),e!==o.ROUND&&e!==o.SQUARE&&e!==o.PROJECT||this._renderer.strokeCap(e),this},a.default.prototype.strokeJoin=function(e){return a.default._validateParameters("strokeJoin",arguments),e!==o.ROUND&&e!==o.BEVEL&&e!==o.MITER||this._renderer.strokeJoin(e),this},a.default.prototype.strokeWeight=function(e){return a.default._validateParameters("strokeWeight",arguments),this._renderer.strokeWeight(e),this};var s=a.default;n.default=s},{"../constants":250,"../main":260}],269:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=(r=e("../main"))&&r.__esModule?r:{default:r};e("../friendly_errors/fes_core"),e("../friendly_errors/file_errors"),e("../friendly_errors/validate_params"),i.default.prototype.bezier=function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return i.default._validateParameters("bezier",n),(this._renderer._doStroke||this._renderer._doFill)&&(e=this._renderer).bezier.apply(e,n),this},i.default.prototype.bezierDetail=function(e){return i.default._validateParameters("bezierDetail",arguments),this._bezierDetail=e,this},i.default.prototype.bezierPoint=function(e,t,n,r,a){i.default._validateParameters("bezierPoint",arguments);var o=1-a;return Math.pow(o,3)*e+3*Math.pow(o,2)*a*t+3*o*Math.pow(a,2)*n+Math.pow(a,3)*r},i.default.prototype.bezierTangent=function(e,t,n,r,a){i.default._validateParameters("bezierTangent",arguments);var o=1-a;return 3*r*Math.pow(a,2)-3*n*Math.pow(a,2)+6*n*o*a-6*t*o*a+3*t*Math.pow(o,2)-3*e*Math.pow(o,2)},i.default.prototype.curve=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r;return i.default._validateParameters("curve",t),this._renderer._doStroke&&(r=this._renderer).curve.apply(r,t),this},i.default.prototype.curveDetail=function(e){return i.default._validateParameters("curveDetail",arguments),this._curveDetail=e<3?3:e,this},i.default.prototype.curveTightness=function(e){return i.default._validateParameters("curveTightness",arguments),this._renderer._curveTightness=e,this},i.default.prototype.curvePoint=function(e,t,n,r,a){i.default._validateParameters("curvePoint",arguments);var o=a*a*a,s=a*a;return e*(-.5*o+s-.5*a)+t*(1.5*o-2.5*s+1)+n*(-1.5*o+2*s+.5*a)+r*(.5*o-.5*s)},i.default.prototype.curveTangent=function(e,t,n,r,a){i.default._validateParameters("curveTangent",arguments);var o=a*a;return e*(-3*o/2+2*a-.5)+t*(9*o/2-5*a)+n*(-9*o/2+4*a+.5)+r*(3*o/2-a)};var a=i.default;n.default=a},{"../friendly_errors/fes_core":252,"../friendly_errors/file_errors":253,"../friendly_errors/validate_params":255,"../main":260}],270:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e("core-js/modules/es.array.slice"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i,a=(i=e("../main"))&&i.__esModule?i:{default:i},o=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var t="function"!=typeof WeakMap?null:new WeakMap;if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,t&&t.set(e,n),n}(e("../constants")),s=null,u=[],c=[],l=!1,f=!1,d=!1,h=!1,p=!0;a.default.prototype.beginContour=function(){return c=[],h=!0,this},a.default.prototype.beginShape=function(e){var t;return a.default._validateParameters("beginShape",arguments),this._renderer.isP3D?(t=this._renderer).beginShape.apply(t,arguments):(s=e===o.POINTS||e===o.LINES||e===o.TRIANGLES||e===o.TRIANGLE_FAN||e===o.TRIANGLE_STRIP||e===o.QUADS||e===o.QUAD_STRIP?e:null,u=[],c=[]),this},a.default.prototype.bezierVertex=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r;if(a.default._validateParameters("bezierVertex",t),this._renderer.isP3D)(r=this._renderer).bezierVertex.apply(r,t);else if(0===u.length)a.default._friendlyError("vertex() must be used once before calling bezierVertex()","bezierVertex");else{l=!0;for(var i=[],o=0;o<t.length;o++)i[o]=t[o];i.isVert=!1,h?c.push(i):u.push(i)}return this},a.default.prototype.curveVertex=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r;return a.default._validateParameters("curveVertex",t),this._renderer.isP3D?(r=this._renderer).curveVertex.apply(r,t):(f=!0,this.vertex(t[0],t[1])),this},a.default.prototype.endContour=function(){var e=c[0].slice();e.isVert=c[0].isVert,e.moveTo=!1,c.push(e),p&&(u.push(u[0]),p=!1);for(var t=0;t<c.length;t++)u.push(c[t]);return this},a.default.prototype.endShape=function(e){if(a.default._validateParameters("endShape",arguments),this._renderer.isP3D)this._renderer.endShape(e,f,l,d,h,s);else{if(0===u.length)return this;if(!this._renderer._doStroke&&!this._renderer._doFill)return this;var t=e===o.CLOSE;t&&!h&&u.push(u[0]),this._renderer.endShape(e,u,f,l,d,h,s),p=!(h=d=l=f=!1),t&&u.pop()}return this},a.default.prototype.quadraticVertex=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(a.default._validateParameters("quadraticVertex",t),this._renderer.isP3D){var r;(r=this._renderer).quadraticVertex.apply(r,t)}else{if(this._contourInited){var i={};return i.x=t[0],i.y=t[1],i.x3=t[2],i.y3=t[3],i.type=o.QUADRATIC,this._contourVertices.push(i),this}if(0<u.length){d=!0;for(var s=[],l=0;l<t.length;l++)s[l]=t[l];s.isVert=!1,h?c.push(s):u.push(s)}else a.default._friendlyError("vertex() must be used once before calling quadraticVertex()","quadraticVertex")}return this},a.default.prototype.vertex=function(e,t,n,r,i){if(this._renderer.isP3D){var a;(a=this._renderer).vertex.apply(a,arguments)}else{var o=[];o.isVert=!0,o[0]=e,o[1]=t,o[2]=0,o[3]=0,o[4]=0,o[5]=this._renderer._getFill(),o[6]=this._renderer._getStroke(),n&&(o.moveTo=n),h?(0===c.length&&(o.moveTo=!0),c.push(o)):u.push(o)}return this};var m=a.default;n.default=m},{"../constants":250,"../main":260,"core-js/modules/es.array.slice":160}],271:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e("core-js/modules/es.symbol"),e("core-js/modules/es.symbol.description"),e("core-js/modules/es.symbol.iterator"),e("core-js/modules/es.array.filter"),e("core-js/modules/es.array.iterator"),e("core-js/modules/es.array.slice"),e("core-js/modules/es.object.assign"),e("core-js/modules/es.object.keys"),e("core-js/modules/es.object.to-string"),e("core-js/modules/es.string.iterator"),e("core-js/modules/es.typed-array.uint8-clamped-array"),e("core-js/modules/es.typed-array.copy-within"),e("core-js/modules/es.typed-array.every"),e("core-js/modules/es.typed-array.fill"),e("core-js/modules/es.typed-array.filter"),e("core-js/modules/es.typed-array.find"),e("core-js/modules/es.typed-array.find-index"),e("core-js/modules/es.typed-array.for-each"),e("core-js/modules/es.typed-array.includes"),e("core-js/modules/es.typed-array.index-of"),e("core-js/modules/es.typed-array.iterator"),e("core-js/modules/es.typed-array.join"),e("core-js/modules/es.typed-array.last-index-of"),e("core-js/modules/es.typed-array.map"),e("core-js/modules/es.typed-array.reduce"),e("core-js/modules/es.typed-array.reduce-right"),e("core-js/modules/es.typed-array.reverse"),e("core-js/modules/es.typed-array.set"),e("core-js/modules/es.typed-array.slice"),e("core-js/modules/es.typed-array.some"),e("core-js/modules/es.typed-array.sort"),e("core-js/modules/es.typed-array.subarray"),e("core-js/modules/es.typed-array.to-locale-string"),e("core-js/modules/es.typed-array.to-string"),e("core-js/modules/web.dom-collections.iterator"),window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)},"undefined"==typeof Uint8ClampedArray||Uint8ClampedArray.prototype.slice||Object.defineProperty(Uint8ClampedArray.prototype,"slice",{value:Array.prototype.slice,writable:!0,configurable:!0,enumerable:!1}),function(){if(!Object.assign){var e=Object.keys,t=Object.defineProperty,n="function"==typeof Symbol&&"symbol"===r(Symbol()),i=Object.prototype.propertyIsEnumerable,a=function(e){return function(t){return i.call(e,t)}};t(Object,"assign",{value:function(t,r){if(null==t)throw new TypeError("target must be an object");var i,o,s,u,c=Object(t);for(i=1;i<arguments.length;++i)for(o=Object(arguments[i]),u=e(o),n&&Object.getOwnPropertySymbols&&u.push.apply(u,Object.getOwnPropertySymbols(o).filter(a(o))),s=0;s<u.length;++s)c[u[s]]=o[u[s]];return c},configurable:!0,enumerable:!1,writable:!0})}}()},{"core-js/modules/es.array.filter":151,"core-js/modules/es.array.iterator":156,"core-js/modules/es.array.slice":160,"core-js/modules/es.object.assign":170,"core-js/modules/es.object.keys":173,"core-js/modules/es.object.to-string":174,"core-js/modules/es.string.iterator":183,"core-js/modules/es.symbol":193,"core-js/modules/es.symbol.description":191,"core-js/modules/es.symbol.iterator":192,"core-js/modules/es.typed-array.copy-within":194,"core-js/modules/es.typed-array.every":195,"core-js/modules/es.typed-array.fill":196,"core-js/modules/es.typed-array.filter":197,"core-js/modules/es.typed-array.find":199,"core-js/modules/es.typed-array.find-index":198,"core-js/modules/es.typed-array.for-each":202,"core-js/modules/es.typed-array.includes":203,"core-js/modules/es.typed-array.index-of":204,"core-js/modules/es.typed-array.iterator":207,"core-js/modules/es.typed-array.join":208,"core-js/modules/es.typed-array.last-index-of":209,"core-js/modules/es.typed-array.map":210,"core-js/modules/es.typed-array.reduce":212,"core-js/modules/es.typed-array.reduce-right":211,"core-js/modules/es.typed-array.reverse":213,"core-js/modules/es.typed-array.set":214,"core-js/modules/es.typed-array.slice":215,"core-js/modules/es.typed-array.some":216,"core-js/modules/es.typed-array.sort":217,"core-js/modules/es.typed-array.subarray":218,"core-js/modules/es.typed-array.to-locale-string":219,"core-js/modules/es.typed-array.to-string":220,"core-js/modules/es.typed-array.uint8-clamped-array":224,"core-js/modules/web.dom-collections.iterator":226}],272:[function(e,t,n){"use strict";e("core-js/modules/es.array.for-each"),e("core-js/modules/es.object.assign"),e("core-js/modules/web.dom-collections.for-each"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=(r=e("./main"))&&r.__esModule?r:{default:r};i.default.prototype.noLoop=function(){this._loop=!1},i.default.prototype.loop=function(){this._loop||(this._loop=!0,this._setupDone&&this._draw())},i.default.prototype.isLooping=function(){return this._loop},i.default.prototype.push=function(){this._styles.push({props:{_colorMode:this._colorMode},renderer:this._renderer.push()})},i.default.prototype.pop=function(){var e=this._styles.pop();e?(this._renderer.pop(e.renderer),Object.assign(this,e.props)):console.warn("pop() was called without matching push()")},i.default.prototype.redraw=function(e){if(!this._inUserDraw&&this._setupDone){var t=parseInt(e);(isNaN(t)||t<1)&&(t=1);var n=this._isGlobal?window:this;if("function"==typeof n.draw){void 0===n.setup&&n.scale(n._pixelDensity,n._pixelDensity);for(var r=function(e){e.call(n)},i=0;i<t;i++){n.resetMatrix(),(this._accessibleOutputs.grid||this._accessibleOutputs.text)&&this._updateAccsOutput(),n._renderer.isP3D&&n._renderer._update(),n._setProperty("frameCount",n.frameCount+1),n._registeredMethods.pre.forEach(r),this._inUserDraw=!0;try{n.draw()}finally{this._inUserDraw=!1}n._registeredMethods.post.forEach(r)}}}};var a=i.default;n.default=a},{"./main":260,"core-js/modules/es.array.for-each":152,"core-js/modules/es.object.assign":170,"core-js/modules/web.dom-collections.for-each":225}],273:[function(e,t,n){"use strict";e("core-js/modules/es.symbol"),e("core-js/modules/es.symbol.description"),e("core-js/modules/es.symbol.iterator"),e("core-js/modules/es.array.from"),e("core-js/modules/es.array.iterator"),e("core-js/modules/es.object.get-prototype-of"),e("core-js/modules/es.object.to-string"),e("core-js/modules/es.regexp.to-string"),e("core-js/modules/es.string.iterator"),e("core-js/modules/es.typed-array.uint8-array"),e("core-js/modules/es.typed-array.copy-within"),e("core-js/modules/es.typed-array.every"),e("core-js/modules/es.typed-array.fill"),e("core-js/modules/es.typed-array.filter"),e("core-js/modules/es.typed-array.find"),e("core-js/modules/es.typed-array.find-index"),e("core-js/modules/es.typed-array.for-each"),e("core-js/modules/es.typed-array.includes"),e("core-js/modules/es.typed-array.index-of"),e("core-js/modules/es.typed-array.iterator"),e("core-js/modules/es.typed-array.join"),e("core-js/modules/es.typed-array.last-index-of"),e("core-js/modules/es.typed-array.map"),e("core-js/modules/es.typed-array.reduce"),e("core-js/modules/es.typed-array.reduce-right"),e("core-js/modules/es.typed-array.reverse"),e("core-js/modules/es.typed-array.set"),e("core-js/modules/es.typed-array.slice"),e("core-js/modules/es.typed-array.some"),e("core-js/modules/es.typed-array.sort"),e("core-js/modules/es.typed-array.subarray"),e("core-js/modules/es.typed-array.to-locale-string"),e("core-js/modules/es.typed-array.to-string"),e("core-js/modules/web.dom-collections.iterator"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=(r=e("./main"))&&r.__esModule?r:{default:r};function a(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}i.default.prototype.applyMatrix=function(){var e,t,n=arguments[0]instanceof Object.getPrototypeOf(Uint8Array);return Array.isArray(arguments[0])||n?(e=this._renderer).applyMatrix.apply(e,a(arguments[0])):(t=this._renderer).applyMatrix.apply(t,arguments),this},i.default.prototype.resetMatrix=function(){return this._renderer.resetMatrix(),this},i.default.prototype.rotate=function(e,t){return i.default._validateParameters("rotate",arguments),this._renderer.rotate(this._toRadians(e),t),this},i.default.prototype.rotateX=function(e){return this._assert3d("rotateX"),i.default._validateParameters("rotateX",arguments),this._renderer.rotateX(this._toRadians(e)),this},i.default.prototype.rotateY=function(e){return this._assert3d("rotateY"),i.default._validateParameters("rotateY",arguments),this._renderer.rotateY(this._toRadians(e)),this},i.default.prototype.rotateZ=function(e){return this._assert3d("rotateZ"),i.default._validateParameters("rotateZ",arguments),this._renderer.rotateZ(this._toRadians(e)),this},i.default.prototype.scale=function(e,t,n){if(i.default._validateParameters("scale",arguments),e instanceof i.default.Vector){var r=e;e=r.x,t=r.y,n=r.z}else if(e instanceof Array){var a=e;e=a[0],t=a[1],n=a[2]||1}return isNaN(t)?t=n=e:isNaN(n)&&(n=1),this._renderer.scale.call(this._renderer,e,t,n),this},i.default.prototype.shearX=function(e){i.default._validateParameters("shearX",arguments);var t=this._toRadians(e);return this._renderer.applyMatrix(1,0,Math.tan(t),1,0,0),this},i.default.prototype.shearY=function(e){i.default._validateParameters("shearY",arguments);var t=this._toRadians(e);return this._renderer.applyMatrix(1,Math.tan(t),0,1,0,0),this},i.default.prototype.translate=function(e,t,n){return i.default._validateParameters("translate",arguments),this._renderer.isP3D?this._renderer.translate(e,t,n):this._renderer.translate(e,t),this};var o=i.default;n.default=o},{"./main":260,"core-js/modules/es.array.from":153,"core-js/modules/es.array.iterator":156,"core-js/modules/es.object.get-prototype-of":172,"core-js/modules/es.object.to-string":174,"core-js/modules/es.regexp.to-string":179,"core-js/modules/es.string.iterator":183,"core-js/modules/es.symbol":193,"core-js/modules/es.symbol.description":191,"core-js/modules/es.symbol.iterator":192,"core-js/modules/es.typed-array.copy-within":194,"core-js/modules/es.typed-array.every":195,"core-js/modules/es.typed-array.fill":196,"core-js/modules/es.typed-array.filter":197,"core-js/modules/es.typed-array.find":199,"core-js/modules/es.typed-array.find-index":198,"core-js/modules/es.typed-array.for-each":202,"core-js/modules/es.typed-array.includes":203,"core-js/modules/es.typed-array.index-of":204,"core-js/modules/es.typed-array.iterator":207,"core-js/modules/es.typed-array.join":208,"core-js/modules/es.typed-array.last-index-of":209,"core-js/modules/es.typed-array.map":210,"core-js/modules/es.typed-array.reduce":212,"core-js/modules/es.typed-array.reduce-right":211,"core-js/modules/es.typed-array.reverse":213,"core-js/modules/es.typed-array.set":214,"core-js/modules/es.typed-array.slice":215,"core-js/modules/es.typed-array.some":216,"core-js/modules/es.typed-array.sort":217,"core-js/modules/es.typed-array.subarray":218,"core-js/modules/es.typed-array.to-locale-string":219,"core-js/modules/es.typed-array.to-string":220,"core-js/modules/es.typed-array.uint8-array":223,"core-js/modules/web.dom-collections.iterator":226}],274:[function(e,t,n){"use strict";e("core-js/modules/es.symbol"),e("core-js/modules/es.symbol.description"),e("core-js/modules/es.symbol.iterator"),e("core-js/modules/es.array.from"),e("core-js/modules/es.array.iterator"),e("core-js/modules/es.object.to-string"),e("core-js/modules/es.regexp.to-string"),e("core-js/modules/es.string.ends-with"),e("core-js/modules/es.string.iterator"),e("core-js/modules/web.dom-collections.iterator");var r,i=(r=e("../core/main"))&&r.__esModule?r:{default:r};function a(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}i.default.prototype.storeItem=function(e,t){"string"!=typeof e&&console.log("The argument that you passed to storeItem() - ".concat(e," is not a string.")),e.endsWith("p5TypeID")&&console.log("The argument that you passed to storeItem() - ".concat(e," must not end with 'p5TypeID'.")),void 0===t&&console.log("You cannot store undefined variables using storeItem().");var n=o(t);switch(n){case"number":case"boolean":t=t.toString();break;case"object":t instanceof i.default.Color?n="p5.Color":t instanceof i.default.Vector&&(n="p5.Vector",t=[t.x,t.y,t.z]),t=JSON.stringify(t)}localStorage.setItem(e,t);var r="".concat(e,"p5TypeID");localStorage.setItem(r,n)},i.default.prototype.getItem=function(e){var t=localStorage.getItem(e),n=localStorage.getItem("".concat(e,"p5TypeID"));if(void 0===n)console.log("Unable to determine type of item stored under ".concat(e,"in local storage. Did you save the item with something other than setItem()?"));else if(null!==t)switch(n){case"number":t=parseFloat(t);break;case"boolean":t="true"===t;break;case"object":t=JSON.parse(t);break;case"p5.Color":t=JSON.parse(t),t=this.color.apply(this,a(t.levels));break;case"p5.Vector":t=JSON.parse(t),t=this.createVector.apply(this,a(t))}return t},i.default.prototype.clearStorage=function(){localStorage.clear()},i.default.prototype.removeItem=function(e){"string"!=typeof e&&console.log("The argument that you passed to removeItem() - ".concat(e," is not a string.")),localStorage.removeItem(e),localStorage.removeItem("".concat(e,"p5TypeID"))}},{"../core/main":260,"core-js/modules/es.array.from":153,"core-js/modules/es.array.iterator":156,"core-js/modules/es.object.to-string":174,"core-js/modules/es.regexp.to-string":179,"core-js/modules/es.string.ends-with":181,"core-js/modules/es.string.iterator":183,"core-js/modules/es.symbol":193,"core-js/modules/es.symbol.description":191,"core-js/modules/es.symbol.iterator":192,"core-js/modules/web.dom-collections.iterator":226}],275:[function(e,t,n){"use strict";e("core-js/modules/es.array.concat"),e("core-js/modules/es.object.keys"),e("core-js/modules/es.string.sub"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=(r=e("../core/main"))&&r.__esModule?r:{default:r};i.default.prototype.createStringDict=function(e,t){return i.default._validateParameters("createStringDict",arguments),new i.default.StringDict(e,t)},i.default.prototype.createNumberDict=function(e,t){return i.default._validateParameters("createNumberDict",arguments),new i.default.NumberDict(e,t)},i.default.TypedDict=function(e,t){return e instanceof Object?this.data=e:(this.data={},this.data[e]=t),this},i.default.TypedDict.prototype.size=function(){return Object.keys(this.data).length},i.default.TypedDict.prototype.hasKey=function(e){return this.data.hasOwnProperty(e)},i.default.TypedDict.prototype.get=function(e){if(this.data.hasOwnProperty(e))return this.data[e];console.log("".concat(e," does not exist in this Dictionary"))},i.default.TypedDict.prototype.set=function(e,t){this._validate(t)?this.data[e]=t:console.log("Those values dont work for this dictionary type.")},i.default.TypedDict.prototype._addObj=function(e){for(var t in e)this.set(t,e[t])},i.default.TypedDict.prototype.create=function(e,t){e instanceof Object&&void 0===t?this._addObj(e):void 0!==e?this.set(e,t):console.log("In order to create a new Dictionary entry you must pass an object or a key, value pair")},i.default.TypedDict.prototype.clear=function(){this.data={}},i.default.TypedDict.prototype.remove=function(e){if(!this.data.hasOwnProperty(e))throw new Error("".concat(e," does not exist in this Dictionary"));delete this.data[e]},i.default.TypedDict.prototype.print=function(){for(var e in this.data)console.log("key:".concat(e," value:").concat(this.data[e]))},i.default.TypedDict.prototype.saveTable=function(e){var t="";for(var n in this.data)t+="".concat(n,",").concat(this.data[n],"\n");var r=new Blob([t],{type:"text/csv"});i.default.prototype.downloadFile(r,e||"mycsv","csv")},i.default.TypedDict.prototype.saveJSON=function(e,t){i.default.prototype.saveJSON(this.data,e,t)},i.default.TypedDict.prototype._validate=function(e){return!0},i.default.StringDict=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];i.default.TypedDict.apply(this,t)},i.default.StringDict.prototype=Object.create(i.default.TypedDict.prototype),i.default.StringDict.prototype._validate=function(e){return"string"==typeof e},i.default.NumberDict=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];i.default.TypedDict.apply(this,t)},i.default.NumberDict.prototype=Object.create(i.default.TypedDict.prototype),i.default.NumberDict.prototype._validate=function(e){return"number"==typeof e},i.default.NumberDict.prototype.add=function(e,t){this.data.hasOwnProperty(e)?this.data[e]+=t:console.log("The key - ".concat(e," does not exist in this dictionary."))},i.default.NumberDict.prototype.sub=function(e,t){this.add(e,-t)},i.default.NumberDict.prototype.mult=function(e,t){this.data.hasOwnProperty(e)?this.data[e]*=t:console.log("The key - ".concat(e," does not exist in this dictionary."))},i.default.NumberDict.prototype.div=function(e,t){this.data.hasOwnProperty(e)?this.data[e]/=t:console.log("The key - ".concat(e," does not exist in this dictionary."))},i.default.NumberDict.prototype._valueTest=function(e){if(0===Object.keys(this.data).length)throw new Error("Unable to search for a minimum or maximum value on an empty NumberDict");if(1===Object.keys(this.data).length)return this.data[Object.keys(this.data)[0]];var t=this.data[Object.keys(this.data)[0]];for(var n in this.data)this.data[n]*e<t*e&&(t=this.data[n]);return t},i.default.NumberDict.prototype.minValue=function(){return this._valueTest(1)},i.default.NumberDict.prototype.maxValue=function(){return this._valueTest(-1)},i.default.NumberDict.prototype._keyTest=function(e){if(0===Object.keys(this.data).length)throw new Error("Unable to use minValue on an empty NumberDict");if(1===Object.keys(this.data).length)return Object.keys(this.data)[0];for(var t=Object.keys(this.data)[0],n=1;n<Object.keys(this.data).length;n++)Object.keys(this.data)[n]*e<t*e&&(t=Object.keys(this.data)[n]);return t},i.default.NumberDict.prototype.minKey=function(){return this._keyTest(1)},i.default.NumberDict.prototype.maxKey=function(){return this._keyTest(-1)};var a=i.default.TypedDict;n.default=a},{"../core/main":260,"core-js/modules/es.array.concat":148,"core-js/modules/es.object.keys":173,"core-js/modules/es.string.sub":189}],276:[function(e,t,n){"use strict";e("core-js/modules/es.symbol"),e("core-js/modules/es.symbol.description"),e("core-js/modules/es.symbol.iterator"),e("core-js/modules/es.array.every"),e("core-js/modules/es.array.filter"),e("core-js/modules/es.array.for-each"),e("core-js/modules/es.array.from"),e("core-js/modules/es.array.index-of"),e("core-js/modules/es.array.iterator"),e("core-js/modules/es.array.map"),e("core-js/modules/es.array.slice"),e("core-js/modules/es.array.splice"),e("core-js/modules/es.function.name"),e("core-js/modules/es.object.to-string"),e("core-js/modules/es.promise"),e("core-js/modules/es.regexp.exec"),e("core-js/modules/es.regexp.to-string"),e("core-js/modules/es.string.iterator"),e("core-js/modules/es.string.replace"),e("core-js/modules/es.string.split"),e("core-js/modules/es.string.trim"),e("core-js/modules/web.dom-collections.for-each"),e("core-js/modules/web.dom-collections.iterator"),e("core-js/modules/web.url"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=(r=e("../core/main"))&&r.__esModule?r:{default:r};function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t,n){(t._userNode?t._userNode:document.body).appendChild(e);var r=n?new i.default.MediaElement(e,t):new i.default.Element(e,t);return t._elements.push(r),r}function s(e,t,n,r){var i=document.createElement(t);"string"==typeof(n=n||"")&&(n=[n]);var a=!0,s=!1,u=void 0;try{for(var c,l=n[Symbol.iterator]();!(a=(c=l.next()).done);a=!0){var f=c.value,d=document.createElement("source");d.setAttribute("src",f),i.appendChild(d)}}catch(e){s=!0,u=e}finally{try{a||null==l.return||l.return()}finally{if(s)throw u}}"function"==typeof r&&i.addEventListener("canplaythrough",(function e(){r(),i.removeEventListener("canplaythrough",e)}));var h=o(i,e,!0);return h.loadedmetadata=!1,i.addEventListener("loadedmetadata",(function(){h.width=i.videoWidth,h.height=i.videoHeight,0===h.elt.width&&(h.elt.width=i.videoWidth),0===h.elt.height&&(h.elt.height=i.videoHeight),h.presetPlaybackRate&&(h.elt.playbackRate=h.presetPlaybackRate,delete h.presetPlaybackRate),h.loadedmetadata=!0})),h}function u(e,t,n,r){this.callback=e,this.time=t,this.id=n,this.val=r}i.default.prototype.select=function(e,t){i.default._validateParameters("select",arguments);var n=this._getContainer(t).querySelector(e);return n?this._wrapElement(n):null},i.default.prototype.selectAll=function(e,t){i.default._validateParameters("selectAll",arguments);var n=[],r=this._getContainer(t).querySelectorAll(e);if(r)for(var a=0;a<r.length;a++){var o=this._wrapElement(r[a]);n.push(o)}return n},i.default.prototype._getContainer=function(e){var t=document;return"string"==typeof e?t=document.querySelector(e)||document:e instanceof i.default.Element?t=e.elt:e instanceof HTMLElement&&(t=e),t},i.default.prototype._wrapElement=function(e){var t=Array.prototype.slice.call(e.children);if("INPUT"!==e.tagName||"checkbox"!==e.type)return"VIDEO"===e.tagName||"AUDIO"===e.tagName?new i.default.MediaElement(e,this):"SELECT"===e.tagName?this.createSelect(new i.default.Element(e,this)):0<t.length&&t.every((function(e){return"INPUT"===e.tagName||"LABEL"===e.tagName}))?this.createRadio(new i.default.Element(e,this)):new i.default.Element(e,this);var n=new i.default.Element(e,this);return n.checked=function(){return 0===arguments.length?this.elt.checked:(this.elt.checked=!!arguments[0],this)},n},i.default.prototype.removeElements=function(e){i.default._validateParameters("removeElements",arguments),this._elements.filter((function(e){return!(e.elt instanceof HTMLCanvasElement)})).map((function(e){return e.remove()}))},i.default.Element.prototype.changed=function(e){return i.default.Element._adjustListener("change",e,this),this},i.default.Element.prototype.input=function(e){return i.default.Element._adjustListener("input",e,this),this},i.default.prototype.createDiv=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",t=document.createElement("div");return t.innerHTML=e,o(t,this)},i.default.prototype.createP=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",t=document.createElement("p");return t.innerHTML=e,o(t,this)},i.default.prototype.createSpan=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",t=document.createElement("span");return t.innerHTML=e,o(t,this)},i.default.prototype.createImg=function(){i.default._validateParameters("createImg",arguments);var e,t=document.createElement("img"),n=arguments;return 1<n.length&&"string"==typeof n[1]&&(t.alt=n[1]),2<n.length&&"string"==typeof n[2]&&(t.crossOrigin=n[2]),t.src=n[0],e=o(t,this),t.addEventListener("load",(function(){e.width=t.offsetWidth||t.width,e.height=t.offsetHeight||t.height;var r=n[n.length-1];"function"==typeof r&&r(e)})),e},i.default.prototype.createA=function(e,t,n){i.default._validateParameters("createA",arguments);var r=document.createElement("a");return r.href=e,r.innerHTML=t,n&&(r.target=n),o(r,this)},i.default.prototype.createSlider=function(e,t,n,r){i.default._validateParameters("createSlider",arguments);var a=document.createElement("input");return a.type="range",a.min=e,a.max=t,0===r?a.step=1e-18:r&&(a.step=r),"number"==typeof n&&(a.value=n),o(a,this)},i.default.prototype.createButton=function(e,t){i.default._validateParameters("createButton",arguments);var n=document.createElement("button");return n.innerHTML=e,t&&(n.value=t),o(n,this)},i.default.prototype.createCheckbox=function(){i.default._validateParameters("createCheckbox",arguments);var e=document.createElement("div"),t=document.createElement("input");t.type="checkbox",e.appendChild(t);var n=o(e,this);if(n.checked=function(){var e=n.elt.getElementsByTagName("input")[0];if(e){if(0===arguments.length)return e.checked;e.checked=!!arguments[0]}return n},this.value=function(e){return n.value=e,this},arguments[0]){var r=Math.random().toString(36).slice(2),a=document.createElement("label");t.setAttribute("id",r),a.htmlFor=r,n.value(arguments[0]),a.appendChild(document.createTextNode(arguments[0])),e.appendChild(a)}return arguments[1]&&(t.checked=!0),n},i.default.prototype.createSelect=function(){var e;i.default._validateParameters("createSelect",arguments);var t=arguments[0];if(t instanceof i.default.Element&&t.elt instanceof HTMLSelectElement)e=t,this.elt=t.elt;else if(t instanceof HTMLSelectElement)e=o(t,this),this.elt=t;else{var n=document.createElement("select");t&&"boolean"==typeof t&&n.setAttribute("multiple","true"),e=o(n,this),this.elt=n}return e.option=function(e,t){var n;if(void 0!==e){for(var r=0;r<this.elt.length;r+=1)if(this.elt[r].innerHTML===e){n=r;break}if(void 0!==n)!1===t?this.elt.remove(n):this.elt[n].value=t;else{var i=document.createElement("option");i.innerHTML=e,i.value=void 0===t?e:t,this.elt.appendChild(i),this._pInst._elements.push(i)}}},e.selected=function(e){if(void 0!==e){for(var t=0;t<this.elt.length;t+=1)this.elt[t].value.toString()===e.toString()&&(this.elt.selectedIndex=t);return this}if(this.elt.getAttribute("multiple")){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=this.elt.selectedOptions[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value;n.push(u.value)}}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}return this.elt.value},e.disable=function(e){if("string"==typeof e)for(var t=0;t<this.elt.length;t++)this.elt[t].value.toString()===e&&(this.elt[t].disabled=!0,this.elt[t].selected=!1);else this.elt.disabled=!0;return this},e},i.default.prototype.createRadio=function(){var e,t,n=arguments[0];n instanceof HTMLDivElement||n instanceof HTMLSpanElement?(e=n,"string"==typeof arguments[1]&&(t=arguments[1])):("string"==typeof n&&(t=n),e=document.createElement("div"));var r=o(this.elt=e,this);function i(e){return e instanceof HTMLInputElement&&"radio"===e.type}function a(e){return e.nextElementSibling instanceof HTMLLabelElement}return r._name=t||"radioOption",r._getOptionsArray=function(){return Array.from(this.elt.children).filter(i)},r.option=function(e,t){var n,i,o=!0,s=!1,u=void 0;try{for(var c,l=r._getOptionsArray()[Symbol.iterator]();!(o=(c=l.next()).done);o=!0){var f=c.value;if(f.value===e){n=f;break}}}catch(e){s=!0,u=e}finally{try{o||null==l.return||l.return()}finally{if(s)throw u}}return void 0===n&&((n=document.createElement("input")).setAttribute("type","radio"),n.setAttribute("value",e),this.elt.appendChild(n)),a(n)?i=n.nextElementSibling:(i=document.createElement("label"),n.insertAdjacentElement("afterend",i)),i.innerHTML=void 0===t?e:t,n.setAttribute("name",r._name),n},r.remove=function(e){var t=!0,n=!1,i=void 0;try{for(var o,s=r._getOptionsArray()[Symbol.iterator]();!(t=(o=s.next()).done);t=!0){var u=o.value;if(u.value===e)return a(u)&&u.nextElementSibling.remove(),void u.remove()}}catch(e){n=!0,i=e}finally{try{t||null==s.return||s.return()}finally{if(n)throw i}}},r.value=function(){var e="",t=!0,n=!1,i=void 0;try{for(var a,o=r._getOptionsArray()[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var s=a.value;if(s.checked){e=s.value;break}}}catch(e){n=!0,i=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw i}}return e},r.selected=function(e){var t=null;if(void 0===e){var n=!0,i=!1,a=void 0;try{for(var o,s=r._getOptionsArray()[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var u=o.value;if(u.checked){t=u;break}}}catch(e){i=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}}else{var c=!0,l=!1,f=void 0;try{for(var d,h=r._getOptionsArray()[Symbol.iterator]();!(c=(d=h.next()).done);c=!0){var p=d.value;p.value===e&&(p.setAttribute("checked",!0),t=p)}}catch(e){l=!0,f=e}finally{try{c||null==h.return||h.return()}finally{if(l)throw f}}}return t},r.disable=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=!0,n=!1,i=void 0;try{for(var a,o=r._getOptionsArray()[Symbol.iterator]();!(t=(a=o.next()).done);t=!0)a.value.setAttribute("disabled",e)}catch(e){n=!0,i=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw i}}},r},i.default.prototype.createColorPicker=function(e){i.default._validateParameters("createColorPicker",arguments);var t,n=document.createElement("input");return n.type="color",e?e instanceof i.default.Color?n.value=e.toString("#rrggbb"):(i.default.prototype._colorMode="rgb",i.default.prototype._colorMaxes={rgb:[255,255,255,255],hsb:[360,100,100,1],hsl:[360,100,100,1]},n.value=i.default.prototype.color(e).toString("#rrggbb")):n.value="#000000",(t=o(n,this)).color=function(){return e&&(e.mode&&(i.default.prototype._colorMode=e.mode),e.maxes&&(i.default.prototype._colorMaxes=e.maxes)),i.default.prototype.color(this.elt.value)},t},i.default.prototype.createInput=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"text";i.default._validateParameters("createInput",arguments);var n=document.createElement("input");return n.setAttribute("value",e),n.setAttribute("type",t),o(n,this)},i.default.prototype.createFileInput=function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(i.default._validateParameters("createFileInput",arguments),window.File&&window.FileReader&&window.FileList&&window.Blob){var n=document.createElement("input");return n.setAttribute("type","file"),t&&n.setAttribute("multiple",!0),n.addEventListener("change",(function(t){var n=!0,r=!1,a=void 0;try{for(var o,s=t.target.files[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var u=o.value;i.default.File._load(u,e)}}catch(t){r=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(r)throw a}}}),!1),o(n,this)}console.log("The File APIs are not fully supported in this browser. Cannot create element.")},i.default.prototype.createVideo=function(e,t){return i.default._validateParameters("createVideo",arguments),s(this,"video",e,t)},i.default.prototype.createAudio=function(e,t){return i.default._validateParameters("createAudio",arguments),s(this,"audio",e,t)},i.default.prototype.VIDEO="video",i.default.prototype.AUDIO="audio",void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(e){var t=navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return t?new Promise((function(n,r){t.call(navigator,e,n,r)})):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}),i.default.prototype.createCapture=function(){if(i.default._validateParameters("createCapture",arguments),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new DOMException("getUserMedia not supported in this browser");var e,t,n=!0,r=!0,s=!0,u=!1,c=void 0;try{for(var l,f=arguments[Symbol.iterator]();!(s=(l=f.next()).done);s=!0){var d=l.value;d===i.default.prototype.VIDEO?r=!1:d===i.default.prototype.AUDIO?n=!1:"object"===a(d)?e=d:"function"==typeof d&&(t=d)}}catch(e){u=!0,c=e}finally{try{s||null==f.return||f.return()}finally{if(u)throw c}}e=e||{video:n,audio:r};var h=document.createElement("video");h.setAttribute("playsinline",""),navigator.mediaDevices.getUserMedia(e).then((function(e){try{"srcObject"in h?h.srcObject=e:h.src=window.URL.createObjectURL(e)}catch(t){h.src=e}}),console.log);var p=o(h,this,!0);return p.loadedmetadata=!1,h.addEventListener("loadedmetadata",(function(){h.play(),h.width?(p.width=h.width,p.height=h.height):(p.width=p.elt.width=h.videoWidth,p.height=p.elt.height=h.videoHeight),p.loadedmetadata=!0,t&&t(h.srcObject)})),p},i.default.prototype.createElement=function(e,t){i.default._validateParameters("createElement",arguments);var n=document.createElement(e);return void 0!==t&&(n.innerHTML=t),o(n,this)},i.default.Element.prototype.addClass=function(e){return this.elt.className?this.hasClass(e)||(this.elt.className=this.elt.className+" "+e):this.elt.className=e,this},i.default.Element.prototype.removeClass=function(e){return this.elt.classList.remove(e),this},i.default.Element.prototype.hasClass=function(e){return this.elt.classList.contains(e)},i.default.Element.prototype.toggleClass=function(e){return this.elt.classList.contains(e)?this.elt.classList.remove(e):this.elt.classList.add(e),this},i.default.Element.prototype.child=function(e){return void 0===e?this.elt.childNodes:("string"==typeof e?("#"===e[0]&&(e=e.substring(1)),e=document.getElementById(e)):e instanceof i.default.Element&&(e=e.elt),e instanceof HTMLElement&&this.elt.appendChild(e),this)},i.default.Element.prototype.center=function(e){var t=this.elt.style.display,n="none"===this.elt.style.display,r="none"===this.parent().style.display,i={x:this.elt.offsetLeft,y:this.elt.offsetTop};n&&this.show(),r&&this.parent().show(),this.elt.style.display="block",this.position(0,0);var a=Math.abs(this.parent().offsetWidth-this.elt.offsetWidth),o=Math.abs(this.parent().offsetHeight-this.elt.offsetHeight);return"both"===e||void 0===e?this.position(a/2+this.parent().offsetLeft,o/2+this.parent().offsetTop):"horizontal"===e?this.position(a/2+this.parent().offsetLeft,i.y):"vertical"===e&&this.position(i.x,o/2+this.parent().offsetTop),this.style("display",t),n&&this.hide(),r&&this.parent().hide(),this},i.default.Element.prototype.html=function(){return 0===arguments.length?this.elt.innerHTML:(arguments[1]?this.elt.insertAdjacentHTML("beforeend",arguments[0]):this.elt.innerHTML=arguments[0],this)},i.default.Element.prototype.position=function(){if(0===arguments.length)return{x:this.elt.offsetLeft,y:this.elt.offsetTop};var e="absolute";return"static"!==arguments[2]&&"fixed"!==arguments[2]&&"relative"!==arguments[2]&&"sticky"!==arguments[2]&&"initial"!==arguments[2]&&"inherit"!==arguments[2]||(e=arguments[2]),this.elt.style.position=e,this.elt.style.left=arguments[0]+"px",this.elt.style.top=arguments[1]+"px",this.x=arguments[0],this.y=arguments[1],this},i.default.Element.prototype._translate=function(){this.elt.style.position="absolute";var e="";return this.elt.style.transform&&(e=(e=this.elt.style.transform.replace(/translate3d\(.*\)/g,"")).replace(/translate[X-Z]?\(.*\)/g,"")),2===arguments.length?this.elt.style.transform="translate("+arguments[0]+"px, "+arguments[1]+"px)":2<arguments.length&&(this.elt.style.transform="translate3d("+arguments[0]+"px,"+arguments[1]+"px,"+arguments[2]+"px)",this.elt.parentElement.style.perspective=3===arguments.length?"1000px":arguments[3]+"px"),this.elt.style.transform+=e,this},i.default.Element.prototype._rotate=function(){var e="";return this.elt.style.transform&&(e=(e=this.elt.style.transform.replace(/rotate3d\(.*\)/g,"")).replace(/rotate[X-Z]?\(.*\)/g,"")),1===arguments.length?this.elt.style.transform="rotate("+arguments[0]+"deg)":2===arguments.length?this.elt.style.transform="rotate("+arguments[0]+"deg, "+arguments[1]+"deg)":3===arguments.length&&(this.elt.style.transform="rotateX("+arguments[0]+"deg)",this.elt.style.transform+="rotateY("+arguments[1]+"deg)",this.elt.style.transform+="rotateZ("+arguments[2]+"deg)"),this.elt.style.transform+=e,this},i.default.Element.prototype.style=function(e,t){if(t instanceof i.default.Color&&(t="rgba("+t.levels[0]+","+t.levels[1]+","+t.levels[2]+","+t.levels[3]/255+")"),void 0===t){if(-1===e.indexOf(":"))return window.getComputedStyle(this.elt).getPropertyValue(e);for(var n=e.split(";"),r=0;r<n.length;r++){var a=n[r].split(":");a[0]&&a[1]&&(this.elt.style[a[0].trim()]=a[1].trim())}}else if(this.elt.style[e]=t,"width"===e||"height"===e||"left"===e||"top"===e){var o=window.getComputedStyle(this.elt).getPropertyValue(e).replace(/\D+/g,"");this[e]=parseInt(o,10)}return this},i.default.Element.prototype.attribute=function(e,t){if(null==this.elt.firstChild||"checkbox"!==this.elt.firstChild.type&&"radio"!==this.elt.firstChild.type)return void 0===t?this.elt.getAttribute(e):(this.elt.setAttribute(e,t),this);if(void 0===t)return this.elt.firstChild.getAttribute(e);for(var n=0;n<this.elt.childNodes.length;n++)this.elt.childNodes[n].setAttribute(e,t)},i.default.Element.prototype.removeAttribute=function(e){if(null!=this.elt.firstChild&&("checkbox"===this.elt.firstChild.type||"radio"===this.elt.firstChild.type))for(var t=0;t<this.elt.childNodes.length;t++)this.elt.childNodes[t].removeAttribute(e);return this.elt.removeAttribute(e),this},i.default.Element.prototype.value=function(){return 0<arguments.length?(this.elt.value=arguments[0],this):"range"===this.elt.type?parseFloat(this.elt.value):this.elt.value},i.default.Element.prototype.show=function(){return this.elt.style.display="block",this},i.default.Element.prototype.hide=function(){return this.elt.style.display="none",this},i.default.Element.prototype.size=function(e,t){if(0===arguments.length)return{width:this.elt.offsetWidth,height:this.elt.offsetHeight};var n=e,r=t,a=i.default.prototype.AUTO;if(n!==a||r!==a){if(n===a?n=t*this.width/this.height:r===a&&(r=e*this.height/this.width),this.elt instanceof HTMLCanvasElement){var o,s={},u=this.elt.getContext("2d");for(o in u)s[o]=u[o];for(o in this.elt.setAttribute("width",n*this._pInst._pixelDensity),this.elt.setAttribute("height",r*this._pInst._pixelDensity),this.elt.style.width=n+"px",this.elt.style.height=r+"px",this._pInst.scale(this._pInst._pixelDensity,this._pInst._pixelDensity),s)this.elt.getContext("2d")[o]=s[o]}else this.elt.style.width=n+"px",this.elt.style.height=r+"px",this.elt.width=n,this.elt.height=r;this.width=this.elt.offsetWidth,this.height=this.elt.offsetHeight,this._pInst&&this._pInst._curElement&&this._pInst._curElement.elt===this.elt&&(this._pInst._setProperty("width",this.elt.offsetWidth),this._pInst._setProperty("height",this.elt.offsetHeight))}return this},i.default.Element.prototype.remove=function(){if(this instanceof i.default.MediaElement){this.stop();var e=this.elt.srcObject;null!==e&&e.getTracks().forEach((function(e){e.stop()}))}var t=this._pInst._elements.indexOf(this);for(var n in-1!==t&&this._pInst._elements.splice(t,1),this._events)this.elt.removeEventListener(n,this._events[n]);this.elt&&this.elt.parentNode&&this.elt.parentNode.removeChild(this.elt)},i.default.Element.prototype.drop=function(e,t){if(window.File&&window.FileReader&&window.FileList&&window.Blob){if(!this._dragDisabled){this._dragDisabled=!0;var n=function(e){e.preventDefault()};this.elt.addEventListener("dragover",n),this.elt.addEventListener("dragleave",n)}i.default.Element._attachListener("drop",(function(n){n.preventDefault(),"function"==typeof t&&t.call(this,n);for(var r=n.dataTransfer.files,a=0;a<r.length;a++){var o=r[a];i.default.File._load(o,e)}}),this)}else console.log("The File APIs are not fully supported in this browser.");return this},i.default.MediaElement=function(e,t){i.default.Element.call(this,e,t);var n=this;this.elt.crossOrigin="anonymous",this._prevTime=0,this._cueIDCounter=0,this._cues=[],(this._pixelsState=this)._pixelDensity=1,this._modified=!1,Object.defineProperty(n,"src",{get:function(){var e=n.elt.children[0].src,t=n.elt.src===window.location.href?"":n.elt.src;return e===window.location.href?t:e},set:function(t){for(var r=0;r<n.elt.children.length;r++)n.elt.removeChild(n.elt.children[r]);var i=document.createElement("source");i.src=t,e.appendChild(i),n.elt.src=t,n.modified=!0}}),n._onended=function(){},n.elt.onended=function(){n._onended(n)}},i.default.MediaElement.prototype=Object.create(i.default.Element.prototype),i.default.MediaElement.prototype.play=function(){var e,t=this;return this.elt.currentTime===this.elt.duration&&(this.elt.currentTime=0),1<this.elt.readyState||this.elt.load(),(e=this.elt.play())&&e.catch&&e.catch((function(e){"NotAllowedError"===e.name?i.default._friendlyAutoplayError(t.src):console.error("Media play method encountered an unexpected error",e)})),this},i.default.MediaElement.prototype.stop=function(){return this.elt.pause(),this.elt.currentTime=0,this},i.default.MediaElement.prototype.pause=function(){return this.elt.pause(),this},i.default.MediaElement.prototype.loop=function(){return this.elt.setAttribute("loop",!0),this.play(),this},i.default.MediaElement.prototype.noLoop=function(){return this.elt.removeAttribute("loop"),this},i.default.MediaElement.prototype._setupAutoplayFailDetection=function(){var e=this,t=setTimeout((function(){return i.default._friendlyAutoplayError(e.src)}),500);this.elt.addEventListener("play",(function(){return clearTimeout(t)}),{passive:!0,once:!0})},i.default.MediaElement.prototype.autoplay=function(e){var t=this,n=this.elt.getAttribute("autoplay");if(this.elt.setAttribute("autoplay",e),e&&!n){var r=function(){return t._setupAutoplayFailDetection()};4===this.elt.readyState?r():this.elt.addEventListener("canplay",r,{passive:!0,once:!0})}return this},i.default.MediaElement.prototype.volume=function(e){if(void 0===e)return this.elt.volume;this.elt.volume=e},i.default.MediaElement.prototype.speed=function(e){if(void 0===e)return this.presetPlaybackRate||this.elt.playbackRate;this.loadedmetadata?this.elt.playbackRate=e:this.presetPlaybackRate=e},i.default.MediaElement.prototype.time=function(e){return void 0===e?this.elt.currentTime:(this.elt.currentTime=e,this)},i.default.MediaElement.prototype.duration=function(){return this.elt.duration},i.default.MediaElement.prototype.pixels=[],i.default.MediaElement.prototype._ensureCanvas=function(){this.canvas||(this.canvas=document.createElement("canvas"),this.drawingContext=this.canvas.getContext("2d"),this.setModified(!0)),this.loadedmetadata&&(this.canvas.width!==this.elt.width&&(this.canvas.width=this.elt.width,this.canvas.height=this.elt.height,this.width=this.canvas.width,this.height=this.canvas.height),this.drawingContext.drawImage(this.elt,0,0,this.canvas.width,this.canvas.height),this.setModified(!0))},i.default.MediaElement.prototype.loadPixels=function(){return this._ensureCanvas(),i.default.Renderer2D.prototype.loadPixels.apply(this,arguments)},i.default.MediaElement.prototype.updatePixels=function(e,t,n,r){return this.loadedmetadata&&(this._ensureCanvas(),i.default.Renderer2D.prototype.updatePixels.call(this,e,t,n,r)),this.setModified(!0),this},i.default.MediaElement.prototype.get=function(){return this._ensureCanvas(),i.default.Renderer2D.prototype.get.apply(this,arguments)},i.default.MediaElement.prototype._getPixel=function(){return this.loadPixels(),i.default.Renderer2D.prototype._getPixel.apply(this,arguments)},i.default.MediaElement.prototype.set=function(e,t,n){this.loadedmetadata&&(this._ensureCanvas(),i.default.Renderer2D.prototype.set.call(this,e,t,n),this.setModified(!0))},i.default.MediaElement.prototype.copy=function(){this._ensureCanvas(),i.default.prototype.copy.apply(this,arguments)},i.default.MediaElement.prototype.mask=function(){this.loadPixels(),this.setModified(!0),i.default.Image.prototype.mask.apply(this,arguments)},i.default.MediaElement.prototype.isModified=function(){return this._modified},i.default.MediaElement.prototype.setModified=function(e){this._modified=e},i.default.MediaElement.prototype.onended=function(e){return this._onended=e,this},i.default.MediaElement.prototype.connect=function(e){var t,n;if("function"==typeof i.default.prototype.getAudioContext)t=i.default.prototype.getAudioContext(),n=i.default.soundOut.input;else try{n=(t=e.context).destination}catch(e){throw"connect() is meant to be used with Web Audio API or p5.sound.js"}this.audioSourceNode||(this.audioSourceNode=t.createMediaElementSource(this.elt),this.audioSourceNode.connect(n)),e?e.input?this.audioSourceNode.connect(e.input):this.audioSourceNode.connect(e):this.audioSourceNode.connect(n)},i.default.MediaElement.prototype.disconnect=function(){if(!this.audioSourceNode)throw"nothing to disconnect";this.audioSourceNode.disconnect()},i.default.MediaElement.prototype.showControls=function(){this.elt.style["text-align"]="inherit",this.elt.controls=!0},i.default.MediaElement.prototype.hideControls=function(){this.elt.controls=!1},i.default.MediaElement.prototype.addCue=function(e,t,n){var r=this._cueIDCounter++,i=new u(t,e,r,n);return this._cues.push(i),this.elt.ontimeupdate||(this.elt.ontimeupdate=this._onTimeUpdate.bind(this)),r},i.default.MediaElement.prototype.removeCue=function(e){for(var t=0;t<this._cues.length;t++)this._cues[t].id===e&&(console.log(e),this._cues.splice(t,1));0===this._cues.length&&(this.elt.ontimeupdate=null)},i.default.MediaElement.prototype.clearCues=function(){this._cues=[],this.elt.ontimeupdate=null},i.default.MediaElement.prototype._onTimeUpdate=function(){for(var e=this.time(),t=0;t<this._cues.length;t++){var n=this._cues[t].time,r=this._cues[t].val;this._prevTime<n&&n<=e&&this._cues[t].callback(r)}this._prevTime=e},i.default.File=function(e,t){this.file=e,this._pInst=t;var n=e.type.split("/");this.type=n[0],this.subtype=n[1],this.name=e.name,this.size=e.size,this.data=void 0},i.default.File._createLoader=function(e,t){var n=new FileReader;return n.onload=function(n){var r=new i.default.File(e);if("application/json"===r.file.type)r.data=JSON.parse(n.target.result);else if("text/xml"===r.file.type){var a=(new DOMParser).parseFromString(n.target.result,"text/xml");r.data=new i.default.XML(a.documentElement)}else r.data=n.target.result;t(r)},n},i.default.File._load=function(e,t){if(/^text\//.test(e.type)||"application/json"===e.type)i.default.File._createLoader(e,t).readAsText(e);else if(/^(video|audio)\//.test(e.type)){var n=new i.default.File(e);n.data=URL.createObjectURL(e),t(n)}else i.default.File._createLoader(e,t).readAsDataURL(e)};var c=i.default;n.default=c},{"../core/main":260,"core-js/modules/es.array.every":149,"core-js/modules/es.array.filter":151,"core-js/modules/es.array.for-each":152,"core-js/modules/es.array.from":153,"core-js/modules/es.array.index-of":155,"core-js/modules/es.array.iterator":156,"core-js/modules/es.array.map":159,"core-js/modules/es.array.slice":160,"core-js/modules/es.array.splice":162,"core-js/modules/es.function.name":163,"core-js/modules/es.object.to-string":174,"core-js/modules/es.promise":175,"core-js/modules/es.regexp.exec":178,"core-js/modules/es.regexp.to-string":179,"core-js/modules/es.string.iterator":183,"core-js/modules/es.string.replace":186,"core-js/modules/es.string.split":188,"core-js/modules/es.string.trim":190,"core-js/modules/es.symbol":193,"core-js/modules/es.symbol.description":191,"core-js/modules/es.symbol.iterator":192,"core-js/modules/web.dom-collections.for-each":225,"core-js/modules/web.dom-collections.iterator":226,"core-js/modules/web.url":228}],277:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i,a=(i=e("../core/main"))&&i.__esModule?i:{default:i},o=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var t="function"!=typeof WeakMap?null:new WeakMap;if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,t&&t.set(e,n),n}(e("../core/constants"));a.default.prototype.deviceOrientation=1<window.innerWidth/window.innerHeight?"landscape":"portrait",a.default.prototype.accelerationX=0,a.default.prototype.accelerationY=0,a.default.prototype.accelerationZ=0,a.default.prototype.pAccelerationX=0,a.default.prototype.pAccelerationY=0,a.default.prototype.pAccelerationZ=0,a.default.prototype._updatePAccelerations=function(){this._setProperty("pAccelerationX",this.accelerationX),this._setProperty("pAccelerationY",this.accelerationY),this._setProperty("pAccelerationZ",this.accelerationZ)},a.default.prototype.rotationX=0,a.default.prototype.rotationY=0,a.default.prototype.rotationZ=0,a.default.prototype.pRotationX=0,a.default.prototype.pRotationY=0;var s=a.default.prototype.pRotationZ=0,u=0,c=0,l="clockwise",f="clockwise",d="clockwise";a.default.prototype.pRotateDirectionX=void 0,a.default.prototype.pRotateDirectionY=void 0,a.default.prototype.pRotateDirectionZ=void 0,a.default.prototype._updatePRotations=function(){this._setProperty("pRotationX",this.rotationX),this._setProperty("pRotationY",this.rotationY),this._setProperty("pRotationZ",this.rotationZ)},a.default.prototype.turnAxis=void 0;var h=.5,p=30;a.default.prototype.setMoveThreshold=function(e){a.default._validateParameters("setMoveThreshold",arguments),h=e},a.default.prototype.setShakeThreshold=function(e){a.default._validateParameters("setShakeThreshold",arguments),p=e},a.default.prototype._ondeviceorientation=function(e){this._updatePRotations(),this._angleMode===o.radians&&(e.beta=e.beta*(_PI/180),e.gamma=e.gamma*(_PI/180),e.alpha=e.alpha*(_PI/180)),this._setProperty("rotationX",e.beta),this._setProperty("rotationY",e.gamma),this._setProperty("rotationZ",e.alpha),this._handleMotion()},a.default.prototype._ondevicemotion=function(e){this._updatePAccelerations(),this._setProperty("accelerationX",2*e.acceleration.x),this._setProperty("accelerationY",2*e.acceleration.y),this._setProperty("accelerationZ",2*e.acceleration.z),this._handleMotion()},a.default.prototype._handleMotion=function(){90===window.orientation||-90===window.orientation?this._setProperty("deviceOrientation","landscape"):0===window.orientation?this._setProperty("deviceOrientation","portrait"):void 0===window.orientation&&this._setProperty("deviceOrientation","undefined");var e,t,n=this._isGlobal?window:this;if("function"==typeof n.deviceMoved&&(Math.abs(this.accelerationX-this.pAccelerationX)>h||Math.abs(this.accelerationY-this.pAccelerationY)>h||Math.abs(this.accelerationZ-this.pAccelerationZ)>h)&&n.deviceMoved(),"function"==typeof n.deviceTurned){var r=this.rotationX+180,i=this.pRotationX+180,a=s+180;0<r-i&&r-i<270||r-i<-270?l="clockwise":(r-i<0||270<r-i)&&(l="counter-clockwise"),l!==this.pRotateDirectionX&&(a=r),90<Math.abs(r-a)&&Math.abs(r-a)<270&&(a=r,this._setProperty("turnAxis","X"),n.deviceTurned()),this.pRotateDirectionX=l,s=a-180;var o=this.rotationY+180,m=this.pRotationY+180,v=u+180;0<o-m&&o-m<270||o-m<-270?f="clockwise":(o-m<0||270<o-this.pRotationY)&&(f="counter-clockwise"),f!==this.pRotateDirectionY&&(v=o),90<Math.abs(o-v)&&Math.abs(o-v)<270&&(v=o,this._setProperty("turnAxis","Y"),n.deviceTurned()),this.pRotateDirectionY=f,u=v-180,0<this.rotationZ-this.pRotationZ&&this.rotationZ-this.pRotationZ<270||this.rotationZ-this.pRotationZ<-270?d="clockwise":(this.rotationZ-this.pRotationZ<0||270<this.rotationZ-this.pRotationZ)&&(d="counter-clockwise"),d!==this.pRotateDirectionZ&&(c=this.rotationZ),90<Math.abs(this.rotationZ-c)&&Math.abs(this.rotationZ-c)<270&&(c=this.rotationZ,this._setProperty("turnAxis","Z"),n.deviceTurned()),this.pRotateDirectionZ=d,this._setProperty("turnAxis",void 0)}"function"==typeof n.deviceShaken&&(null!==this.pAccelerationX&&(e=Math.abs(this.accelerationX-this.pAccelerationX),t=Math.abs(this.accelerationY-this.pAccelerationY)),p<e+t&&n.deviceShaken())};var m=a.default;n.default=m},{"../core/constants":250,"../core/main":260}],278:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=(r=e("../core/main"))&&r.__esModule?r:{default:r};i.default.prototype.isKeyPressed=!1,i.default.prototype.keyIsPressed=!1,i.default.prototype.key="",i.default.prototype.keyCode=0,i.default.prototype._onkeydown=function(e){if(!this._downKeys[e.which]){this._setProperty("isKeyPressed",!0),this._setProperty("keyIsPressed",!0),this._setProperty("keyCode",e.which),this._downKeys[e.which]=!0,this._setProperty("key",e.key||String.fromCharCode(e.which)||e.which);var t=this._isGlobal?window:this;"function"!=typeof t.keyPressed||e.charCode||!1===t.keyPressed(e)&&e.preventDefault()}},i.default.prototype._onkeyup=function(e){this._downKeys[e.which]=!1,this._areDownKeys()||(this._setProperty("isKeyPressed",!1),this._setProperty("keyIsPressed",!1)),this._setProperty("_lastKeyCodeTyped",null),this._setProperty("key",e.key||String.fromCharCode(e.which)||e.which),this._setProperty("keyCode",e.which);var t=this._isGlobal?window:this;"function"==typeof t.keyReleased&&!1===t.keyReleased(e)&&e.preventDefault()},i.default.prototype._onkeypress=function(e){if(e.which!==this._lastKeyCodeTyped){this._setProperty("_lastKeyCodeTyped",e.which),this._setProperty("key",e.key||String.fromCharCode(e.which)||e.which);var t=this._isGlobal?window:this;"function"==typeof t.keyTyped&&!1===t.keyTyped(e)&&e.preventDefault()}},i.default.prototype._onblur=function(e){this._downKeys={}},i.default.prototype.keyIsDown=function(e){return i.default._validateParameters("keyIsDown",arguments),this._downKeys[e]||!1},i.default.prototype._areDownKeys=function(){for(var e in this._downKeys)if(this._downKeys.hasOwnProperty(e)&&!0===this._downKeys[e])return!0;return!1};var a=i.default;n.default=a},{"../core/main":260}],279:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e("core-js/modules/es.array.includes"),e("core-js/modules/es.string.includes"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i,a=(i=e("../core/main"))&&i.__esModule?i:{default:i},o=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var t="function"!=typeof WeakMap?null:new WeakMap;if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,t&&t.set(e,n),n}(e("../core/constants"));a.default.prototype.movedX=0,a.default.prototype.movedY=0,a.default.prototype._hasMouseInteracted=!1,a.default.prototype.mouseX=0,a.default.prototype.mouseY=0,a.default.prototype.pmouseX=0,a.default.prototype.pmouseY=0,a.default.prototype.winMouseX=0,a.default.prototype.winMouseY=0,a.default.prototype.pwinMouseX=0,a.default.prototype.pwinMouseY=0,a.default.prototype.mouseButton=0,a.default.prototype.mouseIsPressed=!1,a.default.prototype._updateNextMouseCoords=function(e){if(null!==this._curElement&&(!e.touches||0<e.touches.length)){var t=function(e,t,n,r){r&&!r.clientX&&(r.touches?r=r.touches[0]:r.changedTouches&&(r=r.changedTouches[0]));var i=e.getBoundingClientRect(),a=e.scrollWidth/t||1,o=e.scrollHeight/n||1;return{x:(r.clientX-i.left)/a,y:(r.clientY-i.top)/o,winX:r.clientX,winY:r.clientY,id:r.identifier}}(this._curElement.elt,this.width,this.height,e);this._setProperty("movedX",e.movementX),this._setProperty("movedY",e.movementY),this._setProperty("mouseX",t.x),this._setProperty("mouseY",t.y),this._setProperty("winMouseX",t.winX),this._setProperty("winMouseY",t.winY)}this._hasMouseInteracted||(this._updateMouseCoords(),this._setProperty("_hasMouseInteracted",!0))},a.default.prototype._updateMouseCoords=function(){this._setProperty("pmouseX",this.mouseX),this._setProperty("pmouseY",this.mouseY),this._setProperty("pwinMouseX",this.winMouseX),this._setProperty("pwinMouseY",this.winMouseY),this._setProperty("_pmouseWheelDeltaY",this._mouseWheelDeltaY)},a.default.prototype._setMouseButton=function(e){1===e.button?this._setProperty("mouseButton",o.CENTER):2===e.button?this._setProperty("mouseButton",o.RIGHT):this._setProperty("mouseButton",o.LEFT)},a.default.prototype._onmousemove=function(e){var t=this._isGlobal?window:this;this._updateNextMouseCoords(e),this.mouseIsPressed?"function"==typeof t.mouseDragged?!1===t.mouseDragged(e)&&e.preventDefault():"function"==typeof t.touchMoved&&!1===t.touchMoved(e)&&e.preventDefault():"function"==typeof t.mouseMoved&&!1===t.mouseMoved(e)&&e.preventDefault()},a.default.prototype._onmousedown=function(e){var t=this._isGlobal?window:this;this._setProperty("mouseIsPressed",!0),this._setMouseButton(e),this._updateNextMouseCoords(e),"function"==typeof t.mousePressed?!1===t.mousePressed(e)&&e.preventDefault():navigator.userAgent.toLowerCase().includes("safari")&&"function"==typeof t.touchStarted&&!1===t.touchStarted(e)&&e.preventDefault()},a.default.prototype._onmouseup=function(e){var t=this._isGlobal?window:this;this._setProperty("mouseIsPressed",!1),"function"==typeof t.mouseReleased?!1===t.mouseReleased(e)&&e.preventDefault():"function"==typeof t.touchEnded&&!1===t.touchEnded(e)&&e.preventDefault()},a.default.prototype._ondragend=a.default.prototype._onmouseup,a.default.prototype._ondragover=a.default.prototype._onmousemove,a.default.prototype._onclick=function(e){var t=this._isGlobal?window:this;"function"==typeof t.mouseClicked&&!1===t.mouseClicked(e)&&e.preventDefault()},a.default.prototype._ondblclick=function(e){var t=this._isGlobal?window:this;"function"==typeof t.doubleClicked&&!1===t.doubleClicked(e)&&e.preventDefault()},a.default.prototype._mouseWheelDeltaY=0,a.default.prototype._pmouseWheelDeltaY=0,a.default.prototype._onwheel=function(e){var t=this._isGlobal?window:this;this._setProperty("_mouseWheelDeltaY",e.deltaY),"function"==typeof t.mouseWheel&&(e.delta=e.deltaY,!1===t.mouseWheel(e)&&e.preventDefault())},a.default.prototype.requestPointerLock=function(){var e=this._curElement.elt;return e.requestPointerLock=e.requestPointerLock||e.mozRequestPointerLock,e.requestPointerLock?(e.requestPointerLock(),!0):(console.log("requestPointerLock is not implemented in this browser"),!1)},a.default.prototype.exitPointerLock=function(){document.exitPointerLock()};var s=a.default;n.default=s},{"../core/constants":250,"../core/main":260,"core-js/modules/es.array.includes":154,"core-js/modules/es.string.includes":182}],280:[function(e,t,n){"use strict";e("core-js/modules/es.array.includes"),e("core-js/modules/es.string.includes"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=(r=e("../core/main"))&&r.__esModule?r:{default:r};function a(e,t,n,r,i){var a=4<arguments.length&&void 0!==i?i:0,o=e.getBoundingClientRect(),s=e.scrollWidth/t||1,u=e.scrollHeight/n||1,c=r.touches[a]||r.changedTouches[a];return{x:(c.clientX-o.left)/s,y:(c.clientY-o.top)/u,winX:c.clientX,winY:c.clientY,id:c.identifier}}i.default.prototype.touches=[],i.default.prototype._updateTouchCoords=function(e){if(null!==this._curElement){for(var t=[],n=0;n<e.touches.length;n++)t[n]=a(this._curElement.elt,this.width,this.height,e,n);this._setProperty("touches",t)}},i.default.prototype._ontouchstart=function(e){var t=this._isGlobal?window:this;this._setProperty("mouseIsPressed",!0),this._updateTouchCoords(e),this._updateNextMouseCoords(e),this._updateMouseCoords(),"function"==typeof t.touchStarted?!1===t.touchStarted(e)&&e.preventDefault():navigator.userAgent.toLowerCase().includes("safari")&&"function"==typeof t.mousePressed&&!1===t.mousePressed(e)&&e.preventDefault()},i.default.prototype._ontouchmove=function(e){var t=this._isGlobal?window:this;this._updateTouchCoords(e),this._updateNextMouseCoords(e),"function"==typeof t.touchMoved?!1===t.touchMoved(e)&&e.preventDefault():"function"==typeof t.mouseDragged&&!1===t.mouseDragged(e)&&e.preventDefault()},i.default.prototype._ontouchend=function(e){this._setProperty("mouseIsPressed",!1),this._updateTouchCoords(e),this._updateNextMouseCoords(e);var t=this._isGlobal?window:this;"function"==typeof t.touchEnded?!1===t.touchEnded(e)&&e.preventDefault():"function"==typeof t.mouseReleased&&!1===t.mouseReleased(e)&&e.preventDefault()};var o=i.default;n.default=o},{"../core/main":260,"core-js/modules/es.array.includes":154,"core-js/modules/es.string.includes":182}],281:[function(e,t,n){"use strict";e("core-js/modules/es.array.iterator"),e("core-js/modules/es.object.to-string"),e("core-js/modules/es.typed-array.int32-array"),e("core-js/modules/es.typed-array.uint8-array"),e("core-js/modules/es.typed-array.copy-within"),e("core-js/modules/es.typed-array.every"),e("core-js/modules/es.typed-array.fill"),e("core-js/modules/es.typed-array.filter"),e("core-js/modules/es.typed-array.find"),e("core-js/modules/es.typed-array.find-index"),e("core-js/modules/es.typed-array.for-each"),e("core-js/modules/es.typed-array.includes"),e("core-js/modules/es.typed-array.index-of"),e("core-js/modules/es.typed-array.iterator"),e("core-js/modules/es.typed-array.join"),e("core-js/modules/es.typed-array.last-index-of"),e("core-js/modules/es.typed-array.map"),e("core-js/modules/es.typed-array.reduce"),e("core-js/modules/es.typed-array.reduce-right"),e("core-js/modules/es.typed-array.reverse"),e("core-js/modules/es.typed-array.set"),e("core-js/modules/es.typed-array.slice"),e("core-js/modules/es.typed-array.some"),e("core-js/modules/es.typed-array.sort"),e("core-js/modules/es.typed-array.subarray"),e("core-js/modules/es.typed-array.to-locale-string"),e("core-js/modules/es.typed-array.to-string"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i,a,o,s={_toPixels:function(e){if(e instanceof ImageData)return e.data;if(e.getContext("2d"))return e.getContext("2d").getImageData(0,0,e.width,e.height).data;if(e.getContext("webgl")){var t=e.getContext("webgl"),n=t.drawingBufferWidth*t.drawingBufferHeight*4,r=new Uint8Array(n);return t.readPixels(0,0,e.width,e.height,t.RGBA,t.UNSIGNED_BYTE,r),r}},_getARGB:function(e,t){var n=4*t;return e[3+n]<<24&4278190080|e[n]<<16&16711680|e[1+n]<<8&65280|255&e[2+n]},_setPixels:function(e,t){for(var n=0,r=0,i=e.length;r<i;r++)e[0+(n=4*r)]=(16711680&t[r])>>>16,e[n+1]=(65280&t[r])>>>8,e[n+2]=255&t[r],e[n+3]=(4278190080&t[r])>>>24},_toImageData:function(e){return e instanceof ImageData?e:e.getContext("2d").getImageData(0,0,e.width,e.height)},_createImageData:function(e,t){return s._tmpCanvas=document.createElement("canvas"),s._tmpCtx=s._tmpCanvas.getContext("2d"),this._tmpCtx.createImageData(e,t)},apply:function(e,t,n){var r=e.getContext("2d"),i=r.getImageData(0,0,e.width,e.height),a=t(i,n);a instanceof ImageData?r.putImageData(a,0,0,0,0,e.width,e.height):r.putImageData(i,0,0,0,0,e.width,e.height)},threshold:function(e,t){var n=s._toPixels(e);void 0===t&&(t=.5);for(var r=Math.floor(255*t),i=0;i<n.length;i+=4){var a;a=r<=.2126*n[i]+.7152*n[i+1]+.0722*n[i+2]?255:0,n[i]=n[i+1]=n[i+2]=a}},gray:function(e){for(var t=s._toPixels(e),n=0;n<t.length;n+=4){var r=.2126*t[n]+.7152*t[n+1]+.0722*t[n+2];t[n]=t[n+1]=t[n+2]=r}},opaque:function(e){for(var t=s._toPixels(e),n=0;n<t.length;n+=4)t[n+3]=255;return t},invert:function(e){for(var t=s._toPixels(e),n=0;n<t.length;n+=4)t[n]=255-t[n],t[n+1]=255-t[n+1],t[n+2]=255-t[n+2]},posterize:function(e,t){var n=s._toPixels(e);if(t<2||255<t)throw new Error("Level must be greater than 2 and less than 255 for posterize");for(var r=t-1,i=0;i<n.length;i+=4){var a=n[i],o=n[i+1],u=n[i+2];n[i]=255*(a*t>>8)/r,n[i+1]=255*(o*t>>8)/r,n[i+2]=255*(u*t>>8)/r}},dilate:function(e){for(var t,n,r,i,a,o,u,c,l,f,d,h,p,m,v,g,y,b=s._toPixels(e),x=0,w=b.length?b.length/4:0,_=new Int32Array(w);x<w;)for(n=(t=x)+e.width;x<n;)r=i=s._getARGB(b,x),(u=x-1)<t&&(u=x),n<=(o=x+1)&&(o=x),(c=x-e.width)<0&&(c=0),w<=(l=x+e.width)&&(l=x),h=s._getARGB(b,c),d=s._getARGB(b,u),p=s._getARGB(b,l),(a=77*(r>>16&255)+151*(r>>8&255)+28*(255&r))<(v=77*(d>>16&255)+151*(d>>8&255)+28*(255&d))&&(i=d,a=v),a<(m=77*((f=s._getARGB(b,o))>>16&255)+151*(f>>8&255)+28*(255&f))&&(i=f,a=m),a<(g=77*(h>>16&255)+151*(h>>8&255)+28*(255&h))&&(i=h,a=g),a<(y=77*(p>>16&255)+151*(p>>8&255)+28*(255&p))&&(i=p,a=y),_[x++]=i;s._setPixels(b,_)},erode:function(e){for(var t,n,r,i,a,o,u,c,l,f,d,h,p,m,v,g,y,b=s._toPixels(e),x=0,w=b.length?b.length/4:0,_=new Int32Array(w);x<w;)for(n=(t=x)+e.width;x<n;)r=i=s._getARGB(b,x),(u=x-1)<t&&(u=x),n<=(o=x+1)&&(o=x),(c=x-e.width)<0&&(c=0),w<=(l=x+e.width)&&(l=x),h=s._getARGB(b,c),d=s._getARGB(b,u),p=s._getARGB(b,l),(v=77*(d>>16&255)+151*(d>>8&255)+28*(255&d))<(a=77*(r>>16&255)+151*(r>>8&255)+28*(255&r))&&(i=d,a=v),(m=77*((f=s._getARGB(b,o))>>16&255)+151*(f>>8&255)+28*(255&f))<a&&(i=f,a=m),(g=77*(h>>16&255)+151*(h>>8&255)+28*(255&h))<a&&(i=h,a=g),(y=77*(p>>16&255)+151*(p>>8&255)+28*(255&p))<a&&(i=p,a=y),_[x++]=i;s._setPixels(b,_)},blur:function(e,t){!function(e,t){for(var n,u,c,l,f,d,h,p,m,v,g=s._toPixels(e),y=e.width,b=e.height,x=y*b,w=new Int32Array(x),_=0;_<x;_++)w[_]=s._getARGB(g,_);var k,E,S,C,A=new Int32Array(x),O=new Int32Array(x),D=new Int32Array(x),T=new Int32Array(x),j=0;for(function(e){var t=3.5*e|0;if(r!==(t=t<1?1:t<248?t:248)){i=1+(r=t)<<1,a=new Int32Array(i),o=new Array(i);for(var n=0;n<i;n++)o[n]=new Int32Array(256);for(var s,u,c,l,f=1,d=t-1;f<t;f++){a[t+f]=a[d]=u=d*d,c=o[t+f],l=o[d--];for(var h=0;h<256;h++)c[h]=l[h]=u*h}s=a[t]=t*t,c=o[t];for(var p=0;p<256;p++)c[p]=s*p}}(t),E=0;E<b;E++){for(k=0;k<y;k++){if(l=c=u=f=n=0,(d=k-r)<0)v=-d,d=0;else{if(y<=d)break;v=0}for(S=v;S<i&&!(y<=d);S++){var M=w[d+j];f+=(C=o[S])[(-16777216&M)>>>24],u+=C[(16711680&M)>>16],c+=C[(65280&M)>>8],l+=C[255&M],n+=a[S],d++}A[h=j+k]=f/n,O[h]=u/n,D[h]=c/n,T[h]=l/n}j+=y}for(m=(p=-r)*y,E=j=0;E<b;E++){for(k=0;k<y;k++){if(l=c=u=f=n=0,p<0)v=h=-p,d=k;else{if(b<=p)break;v=0,h=p,d=k+m}for(S=v;S<i&&!(b<=h);S++)f+=(C=o[S])[A[d]],u+=C[O[d]],c+=C[D[d]],l+=C[T[d]],n+=a[S],h++,d+=y;w[k+j]=f/n<<24|u/n<<16|c/n<<8|l/n}j+=y,m+=y,p++}s._setPixels(g,w)}(e,t)}},u=s;n.default=u},{"core-js/modules/es.array.iterator":156,"core-js/modules/es.object.to-string":174,"core-js/modules/es.typed-array.copy-within":194,"core-js/modules/es.typed-array.every":195,"core-js/modules/es.typed-array.fill":196,"core-js/modules/es.typed-array.filter":197,"core-js/modules/es.typed-array.find":199,"core-js/modules/es.typed-array.find-index":198,"core-js/modules/es.typed-array.for-each":202,"core-js/modules/es.typed-array.includes":203,"core-js/modules/es.typed-array.index-of":204,"core-js/modules/es.typed-array.int32-array":206,"core-js/modules/es.typed-array.iterator":207,"core-js/modules/es.typed-array.join":208,"core-js/modules/es.typed-array.last-index-of":209,"core-js/modules/es.typed-array.map":210,"core-js/modules/es.typed-array.reduce":212,"core-js/modules/es.typed-array.reduce-right":211,"core-js/modules/es.typed-array.reverse":213,"core-js/modules/es.typed-array.set":214,"core-js/modules/es.typed-array.slice":215,"core-js/modules/es.typed-array.some":216,"core-js/modules/es.typed-array.sort":217,"core-js/modules/es.typed-array.subarray":218,"core-js/modules/es.typed-array.to-locale-string":219,"core-js/modules/es.typed-array.to-string":220,"core-js/modules/es.typed-array.uint8-array":223}],282:[function(e,t,n){"use strict";e("core-js/modules/es.symbol"),e("core-js/modules/es.symbol.description"),e("core-js/modules/es.symbol.iterator"),e("core-js/modules/es.array.concat"),e("core-js/modules/es.array.filter"),e("core-js/modules/es.array.from"),e("core-js/modules/es.array.iterator"),e("core-js/modules/es.array.map"),e("core-js/modules/es.array.slice"),e("core-js/modules/es.object.keys"),e("core-js/modules/es.object.to-string"),e("core-js/modules/es.regexp.exec"),e("core-js/modules/es.regexp.to-string"),e("core-js/modules/es.set"),e("core-js/modules/es.string.iterator"),e("core-js/modules/es.string.replace"),e("core-js/modules/es.string.split"),e("core-js/modules/es.typed-array.uint8-array"),e("core-js/modules/es.typed-array.uint32-array"),e("core-js/modules/es.typed-array.copy-within"),e("core-js/modules/es.typed-array.every"),e("core-js/modules/es.typed-array.fill"),e("core-js/modules/es.typed-array.filter"),e("core-js/modules/es.typed-array.find"),e("core-js/modules/es.typed-array.find-index"),e("core-js/modules/es.typed-array.for-each"),e("core-js/modules/es.typed-array.includes"),e("core-js/modules/es.typed-array.index-of"),e("core-js/modules/es.typed-array.iterator"),e("core-js/modules/es.typed-array.join"),e("core-js/modules/es.typed-array.last-index-of"),e("core-js/modules/es.typed-array.map"),e("core-js/modules/es.typed-array.reduce"),e("core-js/modules/es.typed-array.reduce-right"),e("core-js/modules/es.typed-array.reverse"),e("core-js/modules/es.typed-array.set"),e("core-js/modules/es.typed-array.slice"),e("core-js/modules/es.typed-array.some"),e("core-js/modules/es.typed-array.sort"),e("core-js/modules/es.typed-array.subarray"),e("core-js/modules/es.typed-array.to-locale-string"),e("core-js/modules/es.typed-array.to-string"),e("core-js/modules/web.dom-collections.iterator"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=a(e("../core/main")),i=a(e("omggif"));function a(e){return e&&e.__esModule?e:{default:e}}function o(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}r.default.prototype.createImage=function(e,t){return r.default._validateParameters("createImage",arguments),new r.default.Image(e,t)},r.default.prototype.saveCanvas=function(){r.default._validateParameters("saveCanvas",arguments);var e,t,n,i,a=[].slice.call(arguments);switch(arguments[0]instanceof HTMLCanvasElement?(e=arguments[0],a.shift()):arguments[0]instanceof r.default.Element?(e=arguments[0].elt,a.shift()):e=this._curElement&&this._curElement.elt,1<=a.length&&(t=a[0]),2<=a.length&&(n=a[1]),n=n||r.default.prototype._checkFileExtension(t,n)[1]||"png"){default:i="image/png";break;case"jpeg":case"jpg":i="image/jpeg"}e.toBlob((function(e){r.default.prototype.downloadFile(e,t,n)}),i)},r.default.prototype.saveGif=function(e,t){var n=e.gifProperties,a=n.loopLimit;1===a?a=null:null===a&&(a=0);for(var s=new Uint8Array(e.width*e.height*n.numFrames),u=[],c={},l=0;l<n.numFrames;l++){for(var f=new Set,d=n.frames[l].image.data,h=d.length,p=new Uint32Array(e.width*e.height),m=0,v=0;m<h;m+=4,v++){var g=d[m+0]<<16|d[m+1]<<8|d[m+2]<<0;f.add(g),p[v]=g}var y=o(f).sort().toString();void 0===c[y]?c[y]={freq:1,frames:[l]}:(c[y].freq+=1,c[y].frames.push(l)),u.push(p)}var b=[],x=Object.keys(c).sort((function(e,t){return c[t].freq-c[e].freq})),w=x[0].split(",").map((function(e){return parseInt(e)}));b=b.concat(c[w].frames);for(var _=new Set(w),k=1;k<x.length;k++){var E=x[k].split(",").map((function(e){return parseInt(e)})).filter((function(e){return!_.has(e)}));if(w.length+E.length<=256){for(var S=0;S<E.length;S++)w.push(E[S]),_.add(E[S]);b=b.concat(c[x[k]].frames)}}b=new Set(b);for(var C={},A=0;A<w.length;A++)C[w[A]]||(C[w[A]]=A);for(var O=1;O<w.length;)O<<=1;w.length=O;for(var D={loop:a,palette:new Uint32Array(w)},T=new i.default.GifWriter(s,e.width,e.height,D),j={},M=function(t){for(var r=!b.has(t),i=r?[]:w,a=new Uint8Array(e.width*e.height),o={},s=new Set,c=0;c<u[t].length;c++){var l=u[t][c];r?(void 0===o[l]&&(o[l]=i.length,i.push(l)),a[c]=o[l]):a[c]=C[l],0<t&&u[t-1][c]!==l&&s.add(l)}var f={},d=i.filter((function(e){return!s.has(e)}));if(0<d.length){var h=d[0],p=r?o[h]:C[h];if(0<t){for(var m=0;m<u[t].length;m++)u[t-1][m]===u[t][m]&&(a[m]=p);f.transparent=p,j.frameOpts.disposal=1}}if(f.delay=n.frames[t].delay/10,r){for(var v=1;v<i.length;)v<<=1;i.length=v,f.palette=new Uint32Array(i)}0<t&&T.addFrame(0,0,e.width,e.height,j.pixelPaletteIndex,j.frameOpts),j={pixelPaletteIndex:a,frameOpts:f}},F=0;F<n.numFrames;F++)M(F);j.frameOpts.disposal=1,T.addFrame(0,0,e.width,e.height,j.pixelPaletteIndex,j.frameOpts);var I=new Blob([s.slice(0,T.end())],{type:"image/gif"});r.default.prototype.downloadFile(I,t,"gif")},r.default.prototype.saveFrames=function(e,t,n,i,a){r.default._validateParameters("saveFrames",arguments);var o=n||3;o=r.default.prototype.constrain(o,0,15),o*=1e3;var s=i||15;s=r.default.prototype.constrain(s,0,22);var u=0,c=r.default.prototype._makeFrame,l=this._curElement.elt,f=[],d=setInterval((function(){f.push(c(e+u,t,l)),u++}),1e3/s);setTimeout((function(){if(clearInterval(d),a)a(f);else{var e=!0,t=!1,n=void 0;try{for(var i,o=f[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var s=i.value;r.default.prototype.downloadFile(s.imageData,s.filename,s.ext)}}catch(e){t=!0,n=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw n}}}f=[]}),o+.01)},r.default.prototype._makeFrame=function(e,t,n){var r,i;if(r=this?this._curElement.elt:n,t)switch(t.toLowerCase()){case"png":default:i="image/png";break;case"jpeg":case"jpg":i="image/jpeg"}else t="png",i="image/png";var a=r.toDataURL(i);a=a.replace(i,"image/octet-stream");var o={};return o.imageData=a,o.filename=e,o.ext=t,o};var s=r.default;n.default=s},{"../core/main":260,"core-js/modules/es.array.concat":148,"core-js/modules/es.array.filter":151,"core-js/modules/es.array.from":153,"core-js/modules/es.array.iterator":156,"core-js/modules/es.array.map":159,"core-js/modules/es.array.slice":160,"core-js/modules/es.object.keys":173,"core-js/modules/es.object.to-string":174,"core-js/modules/es.regexp.exec":178,"core-js/modules/es.regexp.to-string":179,"core-js/modules/es.set":180,"core-js/modules/es.string.iterator":183,"core-js/modules/es.string.replace":186,"core-js/modules/es.string.split":188,"core-js/modules/es.symbol":193,"core-js/modules/es.symbol.description":191,"core-js/modules/es.symbol.iterator":192,"core-js/modules/es.typed-array.copy-within":194,"core-js/modules/es.typed-array.every":195,"core-js/modules/es.typed-array.fill":196,"core-js/modules/es.typed-array.filter":197,"core-js/modules/es.typed-array.find":199,"core-js/modules/es.typed-array.find-index":198,"core-js/modules/es.typed-array.for-each":202,"core-js/modules/es.typed-array.includes":203,"core-js/modules/es.typed-array.index-of":204,"core-js/modules/es.typed-array.iterator":207,"core-js/modules/es.typed-array.join":208,"core-js/modules/es.typed-array.last-index-of":209,"core-js/modules/es.typed-array.map":210,"core-js/modules/es.typed-array.reduce":212,"core-js/modules/es.typed-array.reduce-right":211,"core-js/modules/es.typed-array.reverse":213,"core-js/modules/es.typed-array.set":214,"core-js/modules/es.typed-array.slice":215,"core-js/modules/es.typed-array.some":216,"core-js/modules/es.typed-array.sort":217,"core-js/modules/es.typed-array.subarray":218,"core-js/modules/es.typed-array.to-locale-string":219,"core-js/modules/es.typed-array.to-string":220,"core-js/modules/es.typed-array.uint32-array":222,"core-js/modules/es.typed-array.uint8-array":223,"core-js/modules/web.dom-collections.iterator":226,omggif:235}],283:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e("core-js/modules/es.array.includes"),e("core-js/modules/es.array.index-of"),e("core-js/modules/es.array.iterator"),e("core-js/modules/es.object.to-string"),e("core-js/modules/es.promise"),e("core-js/modules/es.string.includes"),e("core-js/modules/es.typed-array.uint8-array"),e("core-js/modules/es.typed-array.uint8-clamped-array"),e("core-js/modules/es.typed-array.copy-within"),e("core-js/modules/es.typed-array.every"),e("core-js/modules/es.typed-array.fill"),e("core-js/modules/es.typed-array.filter"),e("core-js/modules/es.typed-array.find"),e("core-js/modules/es.typed-array.find-index"),e("core-js/modules/es.typed-array.for-each"),e("core-js/modules/es.typed-array.includes"),e("core-js/modules/es.typed-array.index-of"),e("core-js/modules/es.typed-array.iterator"),e("core-js/modules/es.typed-array.join"),e("core-js/modules/es.typed-array.last-index-of"),e("core-js/modules/es.typed-array.map"),e("core-js/modules/es.typed-array.reduce"),e("core-js/modules/es.typed-array.reduce-right"),e("core-js/modules/es.typed-array.reverse"),e("core-js/modules/es.typed-array.set"),e("core-js/modules/es.typed-array.slice"),e("core-js/modules/es.typed-array.some"),e("core-js/modules/es.typed-array.sort"),e("core-js/modules/es.typed-array.subarray"),e("core-js/modules/es.typed-array.to-locale-string"),e("core-js/modules/es.typed-array.to-string"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=c(e("../core/main")),a=c(e("./filters")),o=c(e("../core/helpers")),s=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var t="function"!=typeof WeakMap?null:new WeakMap;if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,t&&t.set(e,n),n}(e("../core/constants")),u=c(e("omggif"));function c(e){return e&&e.__esModule?e:{default:e}}function l(e,t){return 0<e&&e<t?e:t}e("../core/friendly_errors/validate_params"),e("../core/friendly_errors/file_errors"),e("../core/friendly_errors/fes_core"),i.default.prototype.loadImage=function(e,t,n){i.default._validateParameters("loadImage",arguments);var r=new i.default.Image(1,1,this),a=this,o=new Request(e,{method:"GET",mode:"cors"});return fetch(e,o).then((function(o){var s=o.headers.get("content-type");if(null===s&&console.warn("The image you loaded does not have a Content-Type header. If you are using the online editor consider reuploading the asset."),s&&s.includes("image/gif"))o.arrayBuffer().then((function(e){e&&function(e,t,n,r,a){var o=new u.default.GifReader(e);t.width=t.canvas.width=o.width,t.height=t.canvas.height=o.height;var s=[],c=o.numFrames(),l=new Uint8ClampedArray(t.width*t.height*4);if(1<c){for(var f=function(e,n){try{n.decodeAndBlitFrameRGBA(e,l)}catch(e){i.default._friendlyFileLoadError(8,t.src),"function"==typeof r?r(e):console.error(e)}},d=0;d<c;d++){var h=o.frameInfo(d);1===o.frameInfo(d).disposal&&0<d?t.drawingContext.putImageData(s[d-1].image,0,0):(t.drawingContext.clearRect(0,0,t.width,t.height),l=new Uint8ClampedArray(t.width*t.height*4)),f(d,o);var p=new ImageData(l,t.width,t.height);t.drawingContext.putImageData(p,0,0);var m=h.delay;0===m&&(m=10),s.push({image:t.drawingContext.getImageData(0,0,t.width,t.height),delay:10*m})}var v=o.loopCount();null===v?v=1:0===v&&(v=null),t.drawingContext.putImageData(s[0].image,0,0),t.gifProperties={displayIndex:0,loopLimit:v,loopCount:0,frames:s,numFrames:c,playing:!0,timeDisplayed:0,lastChangeTime:0}}"function"==typeof n&&n(t),a()}(new Uint8Array(e),r,t,n,function(e){a._decrementPreload()}.bind(a))}),(function(e){"function"==typeof n?n(e):console.error(e)}));else{var c=new Image;c.onload=function(){r.width=r.canvas.width=c.width,r.height=r.canvas.height=c.height,r.drawingContext.drawImage(c,0,0),r.modified=!0,"function"==typeof t&&t(r),a._decrementPreload()},c.onerror=function(e){i.default._friendlyFileLoadError(0,c.src),"function"==typeof n?n(e):console.error(e)},0!==e.indexOf("data:image/")&&(c.crossOrigin="Anonymous"),c.src=e}r.modified=!0})).catch((function(t){i.default._friendlyFileLoadError(0,e),"function"==typeof n?n(t):console.error(t)})),r},i.default.prototype.image=function(e,t,n,r,a,s,u,c,f){i.default._validateParameters("image",arguments);var d=e.width,h=e.height;e.elt&&e.elt.videoWidth&&!e.canvas&&(d=e.elt.videoWidth,h=e.elt.videoHeight);var p=t,m=n,v=r||d,g=a||h,y=s||0,b=u||0,x=c||d,w=f||h;x=l(x,d),w=l(w,h);var _=1;e.elt&&!e.canvas&&e.elt.style.width&&(_=e.elt.videoWidth&&!r?e.elt.videoWidth:e.elt.width,_/=parseInt(e.elt.style.width,10)),y*=_,b*=_,w*=_,x*=_;var k=o.default.modeAdjust(p,m,v,g,this._renderer._imageMode);this._renderer.image(e,y,b,x,w,k.x,k.y,k.w,k.h)},i.default.prototype.tint=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];i.default._validateParameters("tint",t);var r=this.color.apply(this,t);this._renderer._tint=r.levels},i.default.prototype.noTint=function(){this._renderer._tint=null},i.default.prototype._getTintedImageCanvas=function(e){if(!e.canvas)return e;var t=a.default._toPixels(e.canvas),n=document.createElement("canvas");n.width=e.canvas.width,n.height=e.canvas.height;for(var r=n.getContext("2d"),i=r.createImageData(e.canvas.width,e.canvas.height),o=i.data,s=0;s<t.length;s+=4){var u=t[s],c=t[s+1],l=t[s+2],f=t[s+3];o[s]=u*this._renderer._tint[0]/255,o[s+1]=c*this._renderer._tint[1]/255,o[s+2]=l*this._renderer._tint[2]/255,o[s+3]=f*this._renderer._tint[3]/255}return r.putImageData(i,0,0),n},i.default.prototype.imageMode=function(e){i.default._validateParameters("imageMode",arguments),e!==s.CORNER&&e!==s.CORNERS&&e!==s.CENTER||(this._renderer._imageMode=e)};var f=i.default;n.default=f},{"../core/constants":250,"../core/friendly_errors/fes_core":252,"../core/friendly_errors/file_errors":253,"../core/friendly_errors/validate_params":255,"../core/helpers":256,"../core/main":260,"./filters":281,"core-js/modules/es.array.includes":154,"core-js/modules/es.array.index-of":155,"core-js/modules/es.array.iterator":156,"core-js/modules/es.object.to-string":174,"core-js/modules/es.promise":175,"core-js/modules/es.string.includes":182,"core-js/modules/es.typed-array.copy-within":194,"core-js/modules/es.typed-array.every":195,"core-js/modules/es.typed-array.fill":196,"core-js/modules/es.typed-array.filter":197,"core-js/modules/es.typed-array.find":199,"core-js/modules/es.typed-array.find-index":198,"core-js/modules/es.typed-array.for-each":202,"core-js/modules/es.typed-array.includes":203,"core-js/modules/es.typed-array.index-of":204,"core-js/modules/es.typed-array.iterator":207,"core-js/modules/es.typed-array.join":208,"core-js/modules/es.typed-array.last-index-of":209,"core-js/modules/es.typed-array.map":210,"core-js/modules/es.typed-array.reduce":212,"core-js/modules/es.typed-array.reduce-right":211,"core-js/modules/es.typed-array.reverse":213,"core-js/modules/es.typed-array.set":214,"core-js/modules/es.typed-array.slice":215,"core-js/modules/es.typed-array.some":216,"core-js/modules/es.typed-array.sort":217,"core-js/modules/es.typed-array.subarray":218,"core-js/modules/es.typed-array.to-locale-string":219,"core-js/modules/es.typed-array.to-string":220,"core-js/modules/es.typed-array.uint8-array":223,"core-js/modules/es.typed-array.uint8-clamped-array":224,omggif:235}],284:[function(e,t,n){"use strict";e("core-js/modules/es.symbol"),e("core-js/modules/es.symbol.description"),e("core-js/modules/es.symbol.iterator"),e("core-js/modules/es.array.filter"),e("core-js/modules/es.array.iterator"),e("core-js/modules/es.object.to-string"),e("core-js/modules/es.string.iterator"),e("core-js/modules/web.dom-collections.iterator"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=a(e("../core/main")),i=a(e("./filters"));function a(e){return e&&e.__esModule?e:{default:e}}r.default.Image=function(e,t){this.width=e,this.height=t,this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.drawingContext=this.canvas.getContext("2d"),(this._pixelsState=this)._pixelDensity=1,this.gifProperties=null,this._modified=!1,this.pixels=[]},r.default.Image.prototype._animateGif=function(e){var t=this.gifProperties,n=e._lastFrameTime+e.deltaTime;if(0===t.lastChangeTime&&(t.lastChangeTime=n),t.playing){t.timeDisplayed=n-t.lastChangeTime;var r=t.frames[t.displayIndex].delay;if(t.timeDisplayed>=r){var i=Math.floor(t.timeDisplayed/r);if(t.timeDisplayed=0,t.lastChangeTime=n,t.displayIndex+=i,t.loopCount=Math.floor(t.displayIndex/t.numFrames),null!==t.loopLimit&&t.loopCount>=t.loopLimit)t.playing=!1;else{var a=t.displayIndex%t.numFrames;this.drawingContext.putImageData(t.frames[a].image,0,0),t.displayIndex=a,this.setModified(!0)}}}},r.default.Image.prototype._setProperty=function(e,t){this[e]=t,this.setModified(!0)},r.default.Image.prototype.loadPixels=function(){r.default.Renderer2D.prototype.loadPixels.call(this),this.setModified(!0)},r.default.Image.prototype.updatePixels=function(e,t,n,i){r.default.Renderer2D.prototype.updatePixels.call(this,e,t,n,i),this.setModified(!0)},r.default.Image.prototype.get=function(e,t,n,i){return r.default._validateParameters("p5.Image.get",arguments),r.default.Renderer2D.prototype.get.apply(this,arguments)},r.default.Image.prototype._getPixel=r.default.Renderer2D.prototype._getPixel,r.default.Image.prototype.set=function(e,t,n){r.default.Renderer2D.prototype.set.call(this,e,t,n),this.setModified(!0)},r.default.Image.prototype.resize=function(e,t){0===e&&0===t?(e=this.canvas.width,t=this.canvas.height):0===e?e=this.canvas.width*t/this.canvas.height:0===t&&(t=this.canvas.height*e/this.canvas.width),e=Math.floor(e),t=Math.floor(t);var n=document.createElement("canvas");if(n.width=e,n.height=t,this.gifProperties)for(var r=this.gifProperties,i=function(e,t){for(var n=0,r=0;r<t.height;r++)for(var i=0;i<t.width;i++){var a=Math.floor(i*e.width/t.width),o=4*(Math.floor(r*e.height/t.height)*e.width+a);t.data[n++]=e.data[o++],t.data[n++]=e.data[o++],t.data[n++]=e.data[o++],t.data[n++]=e.data[o++]}},a=0;a<r.numFrames;a++){var o=this.drawingContext.createImageData(e,t);i(r.frames[a].image,o),r.frames[a].image=o}n.getContext("2d").drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height,0,0,n.width,n.height),this.canvas.width=this.width=e,this.canvas.height=this.height=t,this.drawingContext.drawImage(n,0,0,e,t,0,0,e,t),0<this.pixels.length&&this.loadPixels(),this.setModified(!0)},r.default.Image.prototype.copy=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];r.default.prototype.copy.apply(this,t)},r.default.Image.prototype.mask=function(e){void 0===e&&(e=this);var t=this.drawingContext.globalCompositeOperation,n=1;e instanceof r.default.Renderer&&(n=e._pInst._pixelDensity);var i=[e,0,0,n*e.width,n*e.height,0,0,this.width,this.height];this.drawingContext.globalCompositeOperation="destination-in",r.default.Image.prototype.copy.apply(this,i),this.drawingContext.globalCompositeOperation=t,this.setModified(!0)},r.default.Image.prototype.filter=function(e,t){i.default.apply(this.canvas,i.default[e],t),this.setModified(!0)},r.default.Image.prototype.blend=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];r.default._validateParameters("p5.Image.blend",arguments),r.default.prototype.blend.apply(this,t),this.setModified(!0)},r.default.Image.prototype.setModified=function(e){this._modified=e},r.default.Image.prototype.isModified=function(){return this._modified},r.default.Image.prototype.save=function(e,t){this.gifProperties?r.default.prototype.saveGif(this,e):r.default.prototype.saveCanvas(this.canvas,e,t)},r.default.Image.prototype.reset=function(){if(this.gifProperties){var e=this.gifProperties;e.playing=!0,e.timeSinceStart=0,e.timeDisplayed=0,e.lastChangeTime=0,e.loopCount=0,e.displayIndex=0,this.drawingContext.putImageData(e.frames[0].image,0,0)}},r.default.Image.prototype.getCurrentFrame=function(){if(this.gifProperties){var e=this.gifProperties;return e.displayIndex%e.numFrames}},r.default.Image.prototype.setFrame=function(e){if(this.gifProperties){var t=this.gifProperties;e<t.numFrames&&0<=e?(t.timeDisplayed=0,t.lastChangeTime=0,t.displayIndex=e,this.drawingContext.putImageData(t.frames[e].image,0,0)):console.log("Cannot set GIF to a frame number that is higher than total number of frames or below zero.")}},r.default.Image.prototype.numFrames=function(){if(this.gifProperties)return this.gifProperties.numFrames},r.default.Image.prototype.play=function(){this.gifProperties&&(this.gifProperties.playing=!0)},r.default.Image.prototype.pause=function(){this.gifProperties&&(this.gifProperties.playing=!1)},r.default.Image.prototype.delay=function(e,t){if(this.gifProperties){var n=this.gifProperties;if(t<n.numFrames&&0<=t)n.frames[t].delay=e;else{var r=!0,i=!1,a=void 0;try{for(var o,s=n.frames[Symbol.iterator]();!(r=(o=s.next()).done);r=!0)o.value.delay=e}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}}}};var o=r.default.Image;n.default=o},{"../core/main":260,"./filters":281,"core-js/modules/es.array.filter":151,"core-js/modules/es.array.iterator":156,"core-js/modules/es.object.to-string":174,"core-js/modules/es.string.iterator":183,"core-js/modules/es.symbol":193,"core-js/modules/es.symbol.description":191,"core-js/modules/es.symbol.iterator":192,"core-js/modules/web.dom-collections.iterator":226}],285:[function(e,t,n){"use strict";e("core-js/modules/es.array.filter"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=a(e("../core/main")),i=a(e("./filters"));function a(e){return e&&e.__esModule?e:{default:e}}e("../color/p5.Color"),r.default.prototype.pixels=[],r.default.prototype.blend=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i;r.default._validateParameters("blend",t),this._renderer?(i=this._renderer).blend.apply(i,t):r.default.Renderer2D.prototype.blend.apply(this,t)},r.default.prototype.copy=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i,a,o,s,u,c,l,f,d;if(r.default._validateParameters("copy",t),9===t.length)i=t[0],a=t[1],o=t[2],s=t[3],u=t[4],c=t[5],l=t[6],f=t[7],d=t[8];else{if(8!==t.length)throw new Error("Signature not supported");i=this,a=t[0],o=t[1],s=t[2],u=t[3],c=t[4],l=t[5],f=t[6],d=t[7]}r.default.prototype._copyHelper(this,i,a,o,s,u,c,l,f,d)},r.default.prototype._copyHelper=function(e,t,n,i,a,o,s,u,c,l){t.loadPixels();var f=t.canvas.width/t.width,d=0,h=0;t._renderer&&t._renderer.isP3D&&(d=t.width/2,h=t.height/2),e._renderer&&e._renderer.isP3D?r.default.RendererGL.prototype.image.call(e._renderer,t,n+d,i+h,a,o,s,u,c,l):e.drawingContext.drawImage(t.canvas,f*(n+d),f*(i+h),f*a,f*o,s,u,c,l)},r.default.prototype.filter=function(e,t){r.default._validateParameters("filter",arguments),void 0!==this.canvas?i.default.apply(this.canvas,i.default[e],t):i.default.apply(this.elt,i.default[e],t)},r.default.prototype.get=function(e,t,n,i){var a;return r.default._validateParameters("get",arguments),(a=this._renderer).get.apply(a,arguments)},r.default.prototype.loadPixels=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];r.default._validateParameters("loadPixels",t),this._renderer.loadPixels()},r.default.prototype.set=function(e,t,n){this._renderer.set(e,t,n)},r.default.prototype.updatePixels=function(e,t,n,i){r.default._validateParameters("updatePixels",arguments),0!==this.pixels.length&&this._renderer.updatePixels(e,t,n,i)};var o=r.default;n.default=o},{"../color/p5.Color":248,"../core/main":260,"./filters":281,"core-js/modules/es.array.filter":151}],286:[function(e,t,n){"use strict";e("core-js/modules/es.symbol"),e("core-js/modules/es.symbol.description"),e("core-js/modules/es.symbol.iterator"),e("core-js/modules/es.array.concat"),e("core-js/modules/es.array.includes"),e("core-js/modules/es.array.index-of"),e("core-js/modules/es.array.iterator"),e("core-js/modules/es.array.last-index-of"),e("core-js/modules/es.array.slice"),e("core-js/modules/es.array.splice"),e("core-js/modules/es.function.name"),e("core-js/modules/es.object.to-string"),e("core-js/modules/es.promise"),e("core-js/modules/es.regexp.exec"),e("core-js/modules/es.regexp.to-string"),e("core-js/modules/es.string.includes"),e("core-js/modules/es.string.iterator"),e("core-js/modules/es.string.replace"),e("core-js/modules/es.string.split"),e("core-js/modules/es.typed-array.uint8-array"),e("core-js/modules/es.typed-array.copy-within"),e("core-js/modules/es.typed-array.every"),e("core-js/modules/es.typed-array.fill"),e("core-js/modules/es.typed-array.filter"),e("core-js/modules/es.typed-array.find"),e("core-js/modules/es.typed-array.find-index"),e("core-js/modules/es.typed-array.for-each"),e("core-js/modules/es.typed-array.includes"),e("core-js/modules/es.typed-array.index-of"),e("core-js/modules/es.typed-array.iterator"),e("core-js/modules/es.typed-array.join"),e("core-js/modules/es.typed-array.last-index-of"),e("core-js/modules/es.typed-array.map"),e("core-js/modules/es.typed-array.reduce"),e("core-js/modules/es.typed-array.reduce-right"),e("core-js/modules/es.typed-array.reverse"),e("core-js/modules/es.typed-array.set"),e("core-js/modules/es.typed-array.slice"),e("core-js/modules/es.typed-array.some"),e("core-js/modules/es.typed-array.sort"),e("core-js/modules/es.typed-array.subarray"),e("core-js/modules/es.typed-array.to-locale-string"),e("core-js/modules/es.typed-array.to-string"),e("core-js/modules/web.dom-collections.iterator"),e("core-js/modules/web.url"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=o(e("../core/main"));e("whatwg-fetch"),e("es6-promise/auto");var i=o(e("fetch-jsonp")),a=o(e("file-saver"));function o(e){return e&&e.__esModule?e:{default:e}}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){var n={};if(void 0===(t=t||[]))for(var r=0;r<e.length;r++)t[r.toString()]=r;for(var i=0;i<t.length;i++){var a=t[i],o=e[i];n[a]=o}return n}function c(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function l(e,t){t&&!0!==t&&"true"!==t||(t="");var n="";return(e=e||"untitled")&&e.includes(".")&&(n=e.split(".").pop()),t&&n!==t&&(n=t,e="".concat(e,".").concat(n)),[e,n]}e("../core/friendly_errors/validate_params"),e("../core/friendly_errors/file_errors"),e("../core/friendly_errors/fes_core"),r.default.prototype.loadJSON=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];r.default._validateParameters("loadJSON",t);for(var i,a,o,u=t[0],c={},l="json",f=1;f<t.length;f++){var d=t[f];"string"==typeof d?"jsonp"!==d&&"json"!==d||(l=d):"function"==typeof d?i?a=d:i=d:"object"===s(d)&&(d.hasOwnProperty("jsonpCallback")||d.hasOwnProperty("jsonpCallbackFunction"))&&(l="jsonp",o=d)}var h=this;return this.httpDo(u,"GET",o,l,(function(e){for(var t in e)c[t]=e[t];void 0!==i&&i(e),h._decrementPreload()}),(function(e){if(r.default._friendlyFileLoadError(5,u),!a)throw e;a(e)})),c},r.default.prototype.loadStrings=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];r.default._validateParameters("loadStrings",t);for(var i,a,o=[],s=1;s<t.length;s++){var u=t[s];"function"==typeof u&&(void 0===i?i=u:void 0===a&&(a=u))}var c=this;return r.default.prototype.httpDo.call(this,t[0],"GET","text",(function(e){for(var t=e.replace(/\r\n/g,"\r").replace(/\n/g,"\r").split(/\r/),n=0,r=t.length;n<r;n+=32768)Array.prototype.push.apply(o,t.slice(n,Math.min(n+32768,r)));void 0!==i&&i(o),c._decrementPreload()}),(function(e){if(r.default._friendlyFileLoadError(3,e),!a)throw e;a(e)})),o},r.default.prototype.loadTable=function(e){var t,n,i,a=[],o=!1,s=e.substring(e.lastIndexOf(".")+1,e.length);"csv"===s?i=",":"ssv"===s?i=";":"tsv"===s&&(i="\t");for(var c=1;c<arguments.length;c++)"function"==typeof arguments[c]?void 0===t?t=arguments[c]:void 0===n&&(n=arguments[c]):"string"==typeof arguments[c]&&(a.push(arguments[c]),"header"===arguments[c]&&(o=!0),"csv"===arguments[c]?i=",":"ssv"===arguments[c]?i=";":"tsv"===arguments[c]&&(i="\t"));var l=new r.default.Table,f=this;return this.httpDo(e,"GET","table",(function(e){for(var n,a,s={},c=[],d=0,h=null,p=function(){s.currentState=0,s.token=""},m=function(){h.push(s.token),p()},v=function(){s.currentState=4,c.push(h),h=null};;){if(null==(n=e[d++])){if(s.escaped)throw new Error("Unclosed quote in file.");if(h){m(),v();break}}if(null===h&&(s.escaped=!1,h=[],p()),0===s.currentState){if('"'===n){s.escaped=!0,s.currentState=1;continue}s.currentState=1}if(1===s.currentState&&s.escaped)if('"'===n)'"'===e[d]?(s.token+='"',d++):(s.escaped=!1,s.currentState=2);else{if("\r"===n)continue;s.token+=n}else"\r"===n?("\n"===e[d]&&d++,m(),v()):"\n"===n?(m(),v()):n===i?m():1===s.currentState&&(s.token+=n)}if(o)l.columns=c.shift();else for(var g=0;g<c[0].length;g++)l.columns[g]="null";for(var y=0;y<c.length;y++)(1!==c[y].length||"undefined"!==c[y][0]&&""!==c[y][0])&&((a=new r.default.TableRow).arr=c[y],a.obj=u(c[y],l.columns),l.addRow(a));"function"==typeof t&&t(l),f._decrementPreload()}),(function(t){r.default._friendlyFileLoadError(2,e),n?n(t):console.error(t)})),l},r.default.prototype.loadXML=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var i,a,o=new r.default.XML,s=1;s<t.length;s++){var u=t[s];"function"==typeof u&&(void 0===i?i=u:void 0===a&&(a=u))}var c=this;return this.httpDo(t[0],"GET","xml",(function(e){for(var t in e)o[t]=e[t];void 0!==i&&i(o),c._decrementPreload()}),(function(e){if(r.default._friendlyFileLoadError(1,e),!a)throw e;a(e)})),o},r.default.prototype.loadBytes=function(e,t,n){var i={},a=this;return this.httpDo(e,"GET","arrayBuffer",(function(e){i.bytes=new Uint8Array(e),"function"==typeof t&&t(i),a._decrementPreload()}),(function(t){if(r.default._friendlyFileLoadError(6,e),!n)throw t;n(t)})),i},r.default.prototype.httpGet=function(){r.default._validateParameters("httpGet",arguments);var e=Array.prototype.slice.call(arguments);return e.splice(1,0,"GET"),r.default.prototype.httpDo.apply(this,e)},r.default.prototype.httpPost=function(){r.default._validateParameters("httpPost",arguments);var e=Array.prototype.slice.call(arguments);return e.splice(1,0,"POST"),r.default.prototype.httpDo.apply(this,e)},r.default.prototype.httpDo=function(){for(var e,t,n,a,o,u={},c=0,l="text/plain",f=arguments.length-1;0<f&&"function"==typeof(f<0||arguments.length<=f?void 0:arguments[f]);f--)c++;var d=arguments.length<=0?void 0:arguments[0];if(2==arguments.length-c&&"string"==typeof d&&"object"===s(arguments.length<=1?void 0:arguments[1]))a=new Request(d,arguments.length<=1?void 0:arguments[1]),t=arguments.length<=2?void 0:arguments[2],n=arguments.length<=3?void 0:arguments[3];else{for(var h,p="GET",m=1;m<arguments.length;m++){var v=m<0||arguments.length<=m?void 0:arguments[m];if("string"==typeof v)"GET"===v||"POST"===v||"PUT"===v||"DELETE"===v?p=v:"json"===v||"jsonp"===v||"binary"===v||"arrayBuffer"===v||"xml"===v||"text"===v||"table"===v?e=v:h=v;else if("number"==typeof v)h=v.toString();else if("object"===s(v))if(v.hasOwnProperty("jsonpCallback")||v.hasOwnProperty("jsonpCallbackFunction"))for(var g in v)u[g]=v[g];else l=v instanceof r.default.XML?(h=v.serialize(),"application/xml"):(h=JSON.stringify(v),"application/json");else"function"==typeof v&&(t?n=v:t=v)}var y="GET"===p?new Headers:new Headers({"Content-Type":l});a=new Request(d,{method:p,mode:"cors",body:h,headers:y})}return(o=(o="jsonp"===(e=e||(d.includes("json")?"json":d.includes("xml")?"xml":"text"))?(0,i.default)(d,u):fetch(a)).then((function(t){if(!t.ok){var n=new Error(t.body);throw n.status=t.status,n.ok=!1,n}var i=0;switch("jsonp"!==e&&(i=t.headers.get("content-length")),i&&64e6<i&&r.default._friendlyFileLoadError(7,d),e){case"json":case"jsonp":return t.json();case"binary":return t.blob();case"arrayBuffer":return t.arrayBuffer();case"xml":return t.text().then((function(e){var t=(new DOMParser).parseFromString(e,"text/xml");return new r.default.XML(t.documentElement)}));default:return t.text()}}))).then(t||function(){}),o.catch(n||console.error),o},window.URL=window.URL||window.webkitURL,r.default.prototype._pWriters=[],r.default.prototype.createWriter=function(e,t){var n;for(var i in r.default.prototype._pWriters)if(r.default.prototype._pWriters[i].name===e)return n=new r.default.PrintWriter(e+this.millis(),t),r.default.prototype._pWriters.push(n),n;return n=new r.default.PrintWriter(e,t),r.default.prototype._pWriters.push(n),n},r.default.PrintWriter=function(e,t){var n=this;this.name=e,this.content="",this.write=function(e){this.content+=e},this.print=function(e){this.content+="".concat(e,"\n")},this.clear=function(){this.content=""},this.close=function(){var i=[];for(var a in i.push(this.content),r.default.prototype.writeFile(i,e,t),r.default.prototype._pWriters)r.default.prototype._pWriters[a].name===this.name&&r.default.prototype._pWriters.splice(a,1);n.clear(),n={}}},r.default.prototype.save=function(e,t,n){var i=arguments,a=this._curElement?this._curElement.elt:this.elt;if(0!==i.length)if(i[0]instanceof r.default.Renderer||i[0]instanceof r.default.Graphics)r.default.prototype.saveCanvas(i[0].elt,i[1],i[2]);else if(1===i.length&&"string"==typeof i[0])r.default.prototype.saveCanvas(a,i[0]);else switch(l(i[1],i[2])[1]){case"json":return void r.default.prototype.saveJSON(i[0],i[1],i[2]);case"txt":return void r.default.prototype.saveStrings(i[0],i[1],i[2]);default:i[0]instanceof Array?r.default.prototype.saveStrings(i[0],i[1],i[2]):i[0]instanceof r.default.Table?r.default.prototype.saveTable(i[0],i[1],i[2]):i[0]instanceof r.default.Image?r.default.prototype.saveCanvas(i[0].canvas,i[1]):i[0]instanceof r.default.SoundFile&&r.default.prototype.saveSound(i[0],i[1],i[2],i[3])}else r.default.prototype.saveCanvas(a)},r.default.prototype.saveJSON=function(e,t,n){var i;r.default._validateParameters("saveJSON",arguments),i=n?JSON.stringify(e):JSON.stringify(e,void 0,2),this.saveStrings(i.split("\n"),t,"json")},r.default.prototype.saveJSONObject=r.default.prototype.saveJSON,r.default.prototype.saveJSONArray=r.default.prototype.saveJSON,r.default.prototype.saveStrings=function(e,t,n,i){r.default._validateParameters("saveStrings",arguments);for(var a=n||"txt",o=this.createWriter(t,a),s=0;s<e.length;s++)i?o.write(e[s]+"\r\n"):o.write(e[s]+"\n");o.close(),o.clear()},r.default.prototype.saveTable=function(e,t,n){var i;r.default._validateParameters("saveTable",arguments),i=void 0===n?t.substring(t.lastIndexOf(".")+1,t.length):n;var a=this.createWriter(t,i),o=e.columns,s=",";if("tsv"===i&&(s="\t"),"html"!==i){if("0"!==o[0]){for(var u=0;u<o.length;u++)u<o.length-1?a.write(o[u]+s):a.write(o[u]);a.write("\n")}for(var l=0;l<e.rows.length;l++){var f=void 0;for(f=0;f<e.rows[l].arr.length;f++)f<e.rows[l].arr.length-1?"csv"===i&&String(e.rows[l].arr[f]).includes(",")?a.write('"'+e.rows[l].arr[f]+'"'+s):a.write(e.rows[l].arr[f]+s):"csv"===i&&String(e.rows[l].arr[f]).includes(",")?a.write('"'+e.rows[l].arr[f]+'"'):a.write(e.rows[l].arr[f]);a.write("\n")}}else{if(a.print("<html>"),a.print("<head>"),a.print('  <meta http-equiv="content-type" content="text/html;charset=utf-8" />'),a.print("</head>"),a.print("<body>"),a.print("  <table>"),"0"!==o[0]){a.print("    <tr>");for(var d=0;d<o.length;d++){var h=c(o[d]);a.print("      <td>".concat(h)),a.print("      </td>")}a.print("    </tr>")}for(var p=0;p<e.rows.length;p++){a.print("    <tr>");for(var m=0;m<e.columns.length;m++){var v=c(e.rows[p].getString(m));a.print("      <td>".concat(v)),a.print("      </td>")}a.print("    </tr>")}a.print("  </table>"),a.print("</body>"),a.print("</html>")}a.close(),a.clear()},r.default.prototype.writeFile=function(e,t,n){var i="application/octet-stream";r.default.prototype._isSafari()&&(i="text/plain");var a=new Blob(e,{type:i});r.default.prototype.downloadFile(a,t,n)},r.default.prototype.downloadFile=function(e,t,n){var i=l(t,n),o=i[0];if(e instanceof Blob)a.default.saveAs(e,o);else{var s=document.createElement("a");if(s.href=e,s.download=o,s.onclick=function(e){var t;t=e,document.body.removeChild(t.target),e.stopPropagation()},s.style.display="none",document.body.appendChild(s),r.default.prototype._isSafari()){var u="Hello, Safari user! To download this file...\n";u+="1. Go to File --\x3e Save As.\n",u+='2. Choose "Page Source" as the Format.\n',u+='3. Name it with this extension: ."'.concat(i[1],'"'),alert(u)}s.click()}},r.default.prototype._checkFileExtension=l,r.default.prototype._isSafari=function(){return 0<Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")};var f=r.default;n.default=f},{"../core/friendly_errors/fes_core":252,"../core/friendly_errors/file_errors":253,"../core/friendly_errors/validate_params":255,"../core/main":260,"core-js/modules/es.array.concat":148,"core-js/modules/es.array.includes":154,"core-js/modules/es.array.index-of":155,"core-js/modules/es.array.iterator":156,"core-js/modules/es.array.last-index-of":158,"core-js/modules/es.array.slice":160,"core-js/modules/es.array.splice":162,"core-js/modules/es.function.name":163,"core-js/modules/es.object.to-string":174,"core-js/modules/es.promise":175,"core-js/modules/es.regexp.exec":178,"core-js/modules/es.regexp.to-string":179,"core-js/modules/es.string.includes":182,"core-js/modules/es.string.iterator":183,"core-js/modules/es.string.replace":186,"core-js/modules/es.string.split":188,"core-js/modules/es.symbol":193,"core-js/modules/es.symbol.description":191,"core-js/modules/es.symbol.iterator":192,"core-js/modules/es.typed-array.copy-within":194,"core-js/modules/es.typed-array.every":195,"core-js/modules/es.typed-array.fill":196,"core-js/modules/es.typed-array.filter":197,"core-js/modules/es.typed-array.find":199,"core-js/modules/es.typed-array.find-index":198,"core-js/modules/es.typed-array.for-each":202,"core-js/modules/es.typed-array.includes":203,"core-js/modules/es.typed-array.index-of":204,"core-js/modules/es.typed-array.iterator":207,"core-js/modules/es.typed-array.join":208,"core-js/modules/es.typed-array.last-index-of":209,"core-js/modules/es.typed-array.map":210,"core-js/modules/es.typed-array.reduce":212,"core-js/modules/es.typed-array.reduce-right":211,"core-js/modules/es.typed-array.reverse":213,"core-js/modules/es.typed-array.set":214,"core-js/modules/es.typed-array.slice":215,"core-js/modules/es.typed-array.some":216,"core-js/modules/es.typed-array.sort":217,"core-js/modules/es.typed-array.subarray":218,"core-js/modules/es.typed-array.to-locale-string":219,"core-js/modules/es.typed-array.to-string":220,"core-js/modules/es.typed-array.uint8-array":223,"core-js/modules/web.dom-collections.iterator":226,"core-js/modules/web.url":228,"es6-promise/auto":229,"fetch-jsonp":231,"file-saver":232,"whatwg-fetch":239}],287:[function(e,t,n){"use strict";e("core-js/modules/es.array.concat"),e("core-js/modules/es.array.index-of"),e("core-js/modules/es.array.join"),e("core-js/modules/es.array.splice"),e("core-js/modules/es.regexp.constructor"),e("core-js/modules/es.regexp.exec"),e("core-js/modules/es.regexp.to-string"),e("core-js/modules/es.string.match"),e("core-js/modules/es.string.replace"),e("core-js/modules/es.string.trim"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=(r=e("../core/main"))&&r.__esModule?r:{default:r};i.default.Table=function(e){this.columns=[],this.rows=[]},i.default.Table.prototype.addRow=function(e){var t=e||new i.default.TableRow;if(void 0===t.arr||void 0===t.obj)throw new Error("invalid TableRow: ".concat(t));return(t.table=this).rows.push(t),t},i.default.Table.prototype.removeRow=function(e){this.rows[e].table=null;var t=this.rows.splice(e+1,this.rows.length);this.rows.pop(),this.rows=this.rows.concat(t)},i.default.Table.prototype.getRow=function(e){return this.rows[e]},i.default.Table.prototype.getRows=function(){return this.rows},i.default.Table.prototype.findRow=function(e,t){if("string"==typeof t){for(var n=0;n<this.rows.length;n++)if(this.rows[n].obj[t]===e)return this.rows[n]}else for(var r=0;r<this.rows.length;r++)if(this.rows[r].arr[t]===e)return this.rows[r];return null},i.default.Table.prototype.findRows=function(e,t){var n=[];if("string"==typeof t)for(var r=0;r<this.rows.length;r++)this.rows[r].obj[t]===e&&n.push(this.rows[r]);else for(var i=0;i<this.rows.length;i++)this.rows[i].arr[t]===e&&n.push(this.rows[i]);return n},i.default.Table.prototype.matchRow=function(e,t){if("number"==typeof t){for(var n=0;n<this.rows.length;n++)if(this.rows[n].arr[t].match(e))return this.rows[n]}else for(var r=0;r<this.rows.length;r++)if(this.rows[r].obj[t].match(e))return this.rows[r];return null},i.default.Table.prototype.matchRows=function(e,t){var n=[];if("number"==typeof t)for(var r=0;r<this.rows.length;r++)this.rows[r].arr[t].match(e)&&n.push(this.rows[r]);else for(var i=0;i<this.rows.length;i++)this.rows[i].obj[t].match(e)&&n.push(this.rows[i]);return n},i.default.Table.prototype.getColumn=function(e){var t=[];if("string"==typeof e)for(var n=0;n<this.rows.length;n++)t.push(this.rows[n].obj[e]);else for(var r=0;r<this.rows.length;r++)t.push(this.rows[r].arr[e]);return t},i.default.Table.prototype.clearRows=function(){delete this.rows,this.rows=[]},i.default.Table.prototype.addColumn=function(e){var t=e||null;this.columns.push(t)},i.default.Table.prototype.getColumnCount=function(){return this.columns.length},i.default.Table.prototype.getRowCount=function(){return this.rows.length},i.default.Table.prototype.removeTokens=function(e,t){for(var n=[],r=0;r<e.length;r++)n.push(e.charAt(r).replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"));var i=new RegExp(n.join("|"),"g");if(void 0===t)for(var a=0;a<this.columns.length;a++)for(var o=0;o<this.rows.length;o++){var s=this.rows[o].arr[a];s=s.replace(i,""),this.rows[o].arr[a]=s,this.rows[o].obj[this.columns[a]]=s}else if("string"==typeof t)for(var u=0;u<this.rows.length;u++){var c=this.rows[u].obj[t];c=c.replace(i,""),this.rows[u].obj[t]=c;var l=this.columns.indexOf(t);this.rows[u].arr[l]=c}else for(var f=0;f<this.rows.length;f++){var d=this.rows[f].arr[t];d=d.replace(i,""),this.rows[f].arr[t]=d,this.rows[f].obj[this.columns[t]]=d}},i.default.Table.prototype.trim=function(e){var t=new RegExp(" ","g");if(void 0===e)for(var n=0;n<this.columns.length;n++)for(var r=0;r<this.rows.length;r++){var i=this.rows[r].arr[n];i=i.replace(t,""),this.rows[r].arr[n]=i,this.rows[r].obj[this.columns[n]]=i}else if("string"==typeof e)for(var a=0;a<this.rows.length;a++){var o=this.rows[a].obj[e];o=o.replace(t,""),this.rows[a].obj[e]=o;var s=this.columns.indexOf(e);this.rows[a].arr[s]=o}else for(var u=0;u<this.rows.length;u++){var c=this.rows[u].arr[e];c=c.replace(t,""),this.rows[u].arr[e]=c,this.rows[u].obj[this.columns[e]]=c}},i.default.Table.prototype.removeColumn=function(e){var t,n;"string"==typeof e?(t=e,n=this.columns.indexOf(e)):(n=e,t=this.columns[e]);var r=this.columns.splice(n+1,this.columns.length);this.columns.pop(),this.columns=this.columns.concat(r);for(var i=0;i<this.rows.length;i++){var a=this.rows[i].arr,o=a.splice(n+1,a.length);a.pop(),this.rows[i].arr=a.concat(o),delete this.rows[i].obj[t]}},i.default.Table.prototype.set=function(e,t,n){this.rows[e].set(t,n)},i.default.Table.prototype.setNum=function(e,t,n){this.rows[e].setNum(t,n)},i.default.Table.prototype.setString=function(e,t,n){this.rows[e].setString(t,n)},i.default.Table.prototype.get=function(e,t){return this.rows[e].get(t)},i.default.Table.prototype.getNum=function(e,t){return this.rows[e].getNum(t)},i.default.Table.prototype.getString=function(e,t){return this.rows[e].getString(t)},i.default.Table.prototype.getObject=function(e){for(var t,n={},r=0;r<this.rows.length;r++)if(t=this.rows[r].obj,"string"==typeof e){if(!(0<=this.columns.indexOf(e)))throw new Error('This table has no column named "'.concat(e,'"'));n[t[e]]=t}else n[r]=this.rows[r].obj;return n},i.default.Table.prototype.getArray=function(){for(var e=[],t=0;t<this.rows.length;t++)e.push(this.rows[t].arr);return e};var a=i.default;n.default=a},{"../core/main":260,"core-js/modules/es.array.concat":148,"core-js/modules/es.array.index-of":155,"core-js/modules/es.array.join":157,"core-js/modules/es.array.splice":162,"core-js/modules/es.regexp.constructor":177,"core-js/modules/es.regexp.exec":178,"core-js/modules/es.regexp.to-string":179,"core-js/modules/es.string.match":184,"core-js/modules/es.string.replace":186,"core-js/modules/es.string.trim":190}],288:[function(e,t,n){"use strict";e("core-js/modules/es.array.index-of"),e("core-js/modules/es.object.to-string"),e("core-js/modules/es.regexp.exec"),e("core-js/modules/es.regexp.to-string"),e("core-js/modules/es.string.split"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=(r=e("../core/main"))&&r.__esModule?r:{default:r};i.default.TableRow=function(e,t){var n=[],r={};e&&(t=t||",",n=e.split(t));for(var i=0;i<n.length;i++){var a=i,o=n[i];r[a]=o}this.arr=n,this.obj=r,this.table=null},i.default.TableRow.prototype.set=function(e,t){if("string"==typeof e){var n=this.table.columns.indexOf(e);if(!(0<=n))throw new Error('This table has no column named "'.concat(e,'"'));this.obj[e]=t,this.arr[n]=t}else{if(!(e<this.table.columns.length))throw new Error("Column #".concat(e," is out of the range of this table"));this.arr[e]=t;var r=this.table.columns[e];this.obj[r]=t}},i.default.TableRow.prototype.setNum=function(e,t){var n=parseFloat(t);this.set(e,n)},i.default.TableRow.prototype.setString=function(e,t){var n=t.toString();this.set(e,n)},i.default.TableRow.prototype.get=function(e){return"string"==typeof e?this.obj[e]:this.arr[e]},i.default.TableRow.prototype.getNum=function(e){var t;if("NaN"===(t="string"==typeof e?parseFloat(this.obj[e]):parseFloat(this.arr[e])).toString())throw"Error: ".concat(this.obj[e]," is NaN (Not a Number)");return t},i.default.TableRow.prototype.getString=function(e){return"string"==typeof e?this.obj[e].toString():this.arr[e].toString()};var a=i.default;n.default=a},{"../core/main":260,"core-js/modules/es.array.index-of":155,"core-js/modules/es.object.to-string":174,"core-js/modules/es.regexp.exec":178,"core-js/modules/es.regexp.to-string":179,"core-js/modules/es.string.split":188}],289:[function(e,t,n){"use strict";e("core-js/modules/es.symbol"),e("core-js/modules/es.symbol.description"),e("core-js/modules/es.symbol.iterator"),e("core-js/modules/es.array.iterator"),e("core-js/modules/es.number.constructor"),e("core-js/modules/es.object.to-string"),e("core-js/modules/es.regexp.exec"),e("core-js/modules/es.string.iterator"),e("core-js/modules/es.string.replace"),e("core-js/modules/web.dom-collections.iterator"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=(r=e("../core/main"))&&r.__esModule?r:{default:r};i.default.XML=function(e){if(e)this.DOM=e;else{var t=document.implementation.createDocument(null,"doc");this.DOM=t.createElement("root")}},i.default.XML.prototype.getParent=function(){return new i.default.XML(this.DOM.parentElement)},i.default.XML.prototype.getName=function(){return this.DOM.tagName},i.default.XML.prototype.setName=function(e){var t=this.DOM.innerHTML,n=this.DOM.attributes,r=document.implementation.createDocument(null,"default").createElement(e);r.innerHTML=t;for(var i=0;i<n.length;i++)r.setAttribute(n[i].nodeName,n.nodeValue);this.DOM=r},i.default.XML.prototype.hasChildren=function(){return 0<this.DOM.children.length},i.default.XML.prototype.listChildren=function(){for(var e=[],t=0;t<this.DOM.childNodes.length;t++)e.push(this.DOM.childNodes[t].nodeName);return e},i.default.XML.prototype.getChildren=function(e){return function(e){for(var t=[],n=0;n<e.length;n++)t.push(new i.default.XML(e[n]));return t}(e?this.DOM.getElementsByTagName(e):this.DOM.children)},i.default.XML.prototype.getChild=function(e){if("string"!=typeof e)return new i.default.XML(this.DOM.children[e]);var t=!0,n=!1,r=void 0;try{for(var a,o=this.DOM.children[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var s=a.value;if(s.tagName===e)return new i.default.XML(s)}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}},i.default.XML.prototype.addChild=function(e){e instanceof i.default.XML&&this.DOM.appendChild(e.DOM)},i.default.XML.prototype.removeChild=function(e){var t=-1;if("string"==typeof e){for(var n=0;n<this.DOM.children.length;n++)if(this.DOM.children[n].tagName===e){t=n;break}}else t=e;-1!==t&&this.DOM.removeChild(this.DOM.children[t])},i.default.XML.prototype.getAttributeCount=function(){return this.DOM.attributes.length},i.default.XML.prototype.listAttributes=function(){var e=[],t=!0,n=!1,r=void 0;try{for(var i,a=this.DOM.attributes[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;e.push(o.nodeName)}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}return e},i.default.XML.prototype.hasAttribute=function(e){var t={},n=!0,r=!1,i=void 0;try{for(var a,o=this.DOM.attributes[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;t[s.nodeName]=s.nodeValue}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}return!!t[e]},i.default.XML.prototype.getNum=function(e,t){var n={},r=!0,i=!1,a=void 0;try{for(var o,s=this.DOM.attributes[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value;n[u.nodeName]=u.nodeValue}}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return Number(n[e])||t||0},i.default.XML.prototype.getString=function(e,t){var n={},r=!0,i=!1,a=void 0;try{for(var o,s=this.DOM.attributes[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value;n[u.nodeName]=u.nodeValue}}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n[e]?String(n[e]):t||null},i.default.XML.prototype.setAttribute=function(e,t){this.DOM.setAttribute(e,t)},i.default.XML.prototype.getContent=function(e){return this.DOM.textContent.replace(/\s\s+/g,",")||e||null},i.default.XML.prototype.setContent=function(e){this.DOM.children.length||(this.DOM.textContent=e)},i.default.XML.prototype.serialize=function(){return(new XMLSerializer).serializeToString(this.DOM)};var a=i.default;n.default=a},{"../core/main":260,"core-js/modules/es.array.iterator":156,"core-js/modules/es.number.constructor":167,"core-js/modules/es.object.to-string":174,"core-js/modules/es.regexp.exec":178,"core-js/modules/es.string.iterator":183,"core-js/modules/es.string.replace":186,"core-js/modules/es.symbol":193,"core-js/modules/es.symbol.description":191,"core-js/modules/es.symbol.iterator":192,"core-js/modules/web.dom-collections.iterator":226}],290:[function(e,t,n){"use strict";e("core-js/modules/es.array.includes"),e("core-js/modules/es.array.index-of"),e("core-js/modules/es.array.map"),e("core-js/modules/es.array.slice"),e("core-js/modules/es.math.hypot"),e("core-js/modules/es.number.constructor"),e("core-js/modules/es.string.includes"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=(r=e("../core/main"))&&r.__esModule?r:{default:r};function a(){if("function"==typeof Math.hypot)return Math.hypot.apply(null,arguments);for(var e=arguments.length,t=[],n=0,r=0;r<e;r++){var i=arguments[r];if((i=+i)==1/0||i===-1/0)return 1/0;n<(i=Math.abs(i))&&(n=i),t[r]=i}0===n&&(n=1);for(var a=0,o=0,s=0;s<e;s++){var u=t[s]/n,c=u*u-o,l=a+c;o=l-a-c,a=l}return Math.sqrt(a)*n}i.default.prototype.abs=Math.abs,i.default.prototype.ceil=Math.ceil,i.default.prototype.constrain=function(e,t,n){return i.default._validateParameters("constrain",arguments),Math.max(Math.min(e,n),t)},i.default.prototype.dist=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return i.default._validateParameters("dist",t),4===t.length?a(t[2]-t[0],t[3]-t[1]):6===t.length?a(t[3]-t[0],t[4]-t[1],t[5]-t[2]):void 0},i.default.prototype.exp=Math.exp,i.default.prototype.floor=Math.floor,i.default.prototype.lerp=function(e,t,n){return i.default._validateParameters("lerp",arguments),n*(t-e)+e},i.default.prototype.log=Math.log,i.default.prototype.mag=function(e,t){return i.default._validateParameters("mag",arguments),a(e,t)},i.default.prototype.map=function(e,t,n,r,a,o){i.default._validateParameters("map",arguments);var s=(e-t)/(n-t)*(a-r)+r;return o?r<a?this.constrain(s,r,a):this.constrain(s,a,r):s},i.default.prototype.max=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t[0]instanceof Array?Math.max.apply(null,t[0]):Math.max.apply(null,t)},i.default.prototype.min=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t[0]instanceof Array?Math.min.apply(null,t[0]):Math.min.apply(null,t)},i.default.prototype.norm=function(e,t,n){return i.default._validateParameters("norm",arguments),this.map(e,t,n,0,1)},i.default.prototype.pow=Math.pow,i.default.prototype.round=function(e,t){return t?Number(Math.round(e+"e"+t)+"e-"+t):Math.round(e)},i.default.prototype.sq=function(e){return e*e},i.default.prototype.sqrt=Math.sqrt,i.default.prototype.fract=function(e){i.default._validateParameters("fract",arguments);var t=0,n=Number(e);if(isNaN(n)||Math.abs(n)===1/0)return n;if(n<0&&(n=-n,t=1),!String(n).includes(".")||String(n).includes("e"))return n<1?Math.abs(t-n):0;var r=String(n);return r=Number("0"+r.slice(r.indexOf("."))),Math.abs(t-r)};var o=i.default;n.default=o},{"../core/main":260,"core-js/modules/es.array.includes":154,"core-js/modules/es.array.index-of":155,"core-js/modules/es.array.map":159,"core-js/modules/es.array.slice":160,"core-js/modules/es.math.hypot":165,"core-js/modules/es.number.constructor":167,"core-js/modules/es.string.includes":182}],291:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=(r=e("../core/main"))&&r.__esModule?r:{default:r};i.default.prototype.createVector=function(e,t,n){return this instanceof i.default?new i.default.Vector(this,arguments):new i.default.Vector(e,t,n)};var a=i.default;n.default=a},{"../core/main":260}],292:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=(r=e("../core/main"))&&r.__esModule?r:{default:r};function a(e){return.5*(1-Math.cos(e*Math.PI))}var o,s=4095,u=4,c=.5;i.default.prototype.noise=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;if(null==o){o=new Array(4096);for(var r=0;r<4096;r++)o[r]=Math.random()}e<0&&(e=-e),t<0&&(t=-t),n<0&&(n=-n);for(var i,l,f,d,h,p=Math.floor(e),m=Math.floor(t),v=Math.floor(n),g=e-p,y=t-m,b=n-v,x=0,w=.5,_=0;_<u;_++){var k=p+(m<<4)+(v<<8);i=a(g),l=a(y),f=o[k&s],f+=i*(o[k+1&s]-f),d=o[k+16&s],f+=l*((d+=i*(o[k+16+1&s]-d))-f),d=o[(k+=256)&s],d+=i*(o[k+1&s]-d),h=o[k+16&s],d+=l*((h+=i*(o[k+16+1&s]-h))-d),x+=(f+=a(b)*(d-f))*w,w*=c,p<<=1,m<<=1,v<<=1,1<=(g*=2)&&(p++,g--),1<=(y*=2)&&(m++,y--),1<=(b*=2)&&(v++,b--)}return x},i.default.prototype.noiseDetail=function(e,t){0<e&&(u=e),0<t&&(c=t)},i.default.prototype.noiseSeed=function(e){var t,n,r,i=(r=4294967296,{setSeed:function(e){n=t=(null==e?Math.random()*r:e)>>>0},getSeed:function(){return t},rand:function(){return(n=(1664525*n+1013904223)%r)/r}});i.setSeed(e),o=new Array(4096);for(var a=0;a<4096;a++)o[a]=i.rand()};var l=i.default;n.default=l},{"../core/main":260}],293:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e("core-js/modules/es.array.concat"),e("core-js/modules/es.array.every"),e("core-js/modules/es.array.slice"),e("core-js/modules/es.array.some"),e("core-js/modules/es.math.sign"),e("core-js/modules/es.number.constructor"),e("core-js/modules/es.number.is-finite"),e("core-js/modules/es.object.to-string"),e("core-js/modules/es.regexp.to-string"),e("core-js/modules/es.string.sub"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i,a=(i=e("../core/main"))&&i.__esModule?i:{default:i},o=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var t="function"!=typeof WeakMap?null:new WeakMap;if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,t&&t.set(e,n),n}(e("../core/constants"));function s(e,t){return 0!==e&&(this.x=this.x%e),0!==t&&(this.y=this.y%t),this}function u(e,t,n){return 0!==e&&(this.x=this.x%e),0!==t&&(this.y=this.y%t),0!==n&&(this.z=this.z%n),this}a.default.Vector=function(e,t,n){var r,i,o;o=e instanceof a.default?(this.p5=e,r=t[0]||0,i=t[1]||0,t[2]||0):(r=e||0,i=t||0,n||0),this.x=r,this.y=i,this.z=o},a.default.Vector.prototype.toString=function(){return"p5.Vector Object : [".concat(this.x,", ").concat(this.y,", ").concat(this.z,"]")},a.default.Vector.prototype.set=function(e,t,n){return e instanceof a.default.Vector?(this.x=e.x||0,this.y=e.y||0,this.z=e.z||0):e instanceof Array?(this.x=e[0]||0,this.y=e[1]||0,this.z=e[2]||0):(this.x=e||0,this.y=t||0,this.z=n||0),this},a.default.Vector.prototype.copy=function(){return this.p5?new a.default.Vector(this.p5,[this.x,this.y,this.z]):new a.default.Vector(this.x,this.y,this.z)},a.default.Vector.prototype.add=function(e,t,n){return e instanceof a.default.Vector?(this.x+=e.x||0,this.y+=e.y||0,this.z+=e.z||0):e instanceof Array?(this.x+=e[0]||0,this.y+=e[1]||0,this.z+=e[2]||0):(this.x+=e||0,this.y+=t||0,this.z+=n||0),this},a.default.Vector.prototype.rem=function(e,t,n){if(e instanceof a.default.Vector){if(Number.isFinite(e.x)&&Number.isFinite(e.y)&&Number.isFinite(e.z)){var r=parseFloat(e.x),i=parseFloat(e.y),o=parseFloat(e.z);u.call(this,r,i,o)}}else if(e instanceof Array)e.every((function(e){return Number.isFinite(e)}))&&(2===e.length&&s.call(this,e[0],e[1]),3===e.length&&u.call(this,e[0],e[1],e[2]));else if(1===arguments.length){if(Number.isFinite(e)&&0!==e)return this.x=this.x%e,this.y=this.y%e,this.z=this.z%e,this}else if(2===arguments.length){var c=Array.prototype.slice.call(arguments);c.every((function(e){return Number.isFinite(e)}))&&2===c.length&&s.call(this,c[0],c[1])}else if(3===arguments.length){var l=Array.prototype.slice.call(arguments);l.every((function(e){return Number.isFinite(e)}))&&3===l.length&&u.call(this,l[0],l[1],l[2])}},a.default.Vector.prototype.sub=function(e,t,n){return e instanceof a.default.Vector?(this.x-=e.x||0,this.y-=e.y||0,this.z-=e.z||0):e instanceof Array?(this.x-=e[0]||0,this.y-=e[1]||0,this.z-=e[2]||0):(this.x-=e||0,this.y-=t||0,this.z-=n||0),this},a.default.Vector.prototype.mult=function(e,t,n){if(e instanceof a.default.Vector)return Number.isFinite(e.x)&&Number.isFinite(e.y)&&Number.isFinite(e.z)&&"number"==typeof e.x&&"number"==typeof e.y&&"number"==typeof e.z?(this.x*=e.x,this.y*=e.y,this.z*=e.z):console.warn("p5.Vector.prototype.mult:","x contains components that are either undefined or not finite numbers"),this;if(e instanceof Array)return e.every((function(e){return Number.isFinite(e)}))&&e.every((function(e){return"number"==typeof e}))?1===e.length?(this.x*=e[0],this.y*=e[0],this.z*=e[0]):2===e.length?(this.x*=e[0],this.y*=e[1]):3===e.length&&(this.x*=e[0],this.y*=e[1],this.z*=e[2]):console.warn("p5.Vector.prototype.mult:","x contains elements that are either undefined or not finite numbers"),this;var r=Array.prototype.slice.call(arguments);return r.every((function(e){return Number.isFinite(e)}))&&r.every((function(e){return"number"==typeof e}))?(1===arguments.length&&(this.x*=e,this.y*=e,this.z*=e),2===arguments.length&&(this.x*=e,this.y*=t),3===arguments.length&&(this.x*=e,this.y*=t,this.z*=n)):console.warn("p5.Vector.prototype.mult:","x, y, or z arguments are either undefined or not a finite number"),this},a.default.Vector.prototype.div=function(e,t,n){if(e instanceof a.default.Vector){if(Number.isFinite(e.x)&&Number.isFinite(e.y)&&Number.isFinite(e.z)&&"number"==typeof e.x&&"number"==typeof e.y&&"number"==typeof e.z){if(0===e.x||0===e.y||0===e.z)return console.warn("p5.Vector.prototype.div:","divide by 0"),this;this.x/=e.x,this.y/=e.y,this.z/=e.z}else console.warn("p5.Vector.prototype.div:","x contains components that are either undefined or not finite numbers");return this}if(e instanceof Array){if(e.every((function(e){return Number.isFinite(e)}))&&e.every((function(e){return"number"==typeof e}))){if(e.some((function(e){return 0===e})))return console.warn("p5.Vector.prototype.div:","divide by 0"),this;1===e.length?(this.x/=e[0],this.y/=e[0],this.z/=e[0]):2===e.length?(this.x/=e[0],this.y/=e[1]):3===e.length&&(this.x/=e[0],this.y/=e[1],this.z/=e[2])}else console.warn("p5.Vector.prototype.div:","x contains components that are either undefined or not finite numbers");return this}var r=Array.prototype.slice.call(arguments);if(r.every((function(e){return Number.isFinite(e)}))&&r.every((function(e){return"number"==typeof e}))){if(r.some((function(e){return 0===e})))return console.warn("p5.Vector.prototype.div:","divide by 0"),this;1===arguments.length&&(this.x/=e,this.y/=e,this.z/=e),2===arguments.length&&(this.x/=e,this.y/=t),3===arguments.length&&(this.x/=e,this.y/=t,this.z/=n)}else console.warn("p5.Vector.prototype.div:","x, y, or z arguments are either undefined or not a finite number");return this},a.default.Vector.prototype.mag=function(){return Math.sqrt(this.magSq())},a.default.Vector.prototype.magSq=function(){var e=this.x,t=this.y,n=this.z;return e*e+t*t+n*n},a.default.Vector.prototype.dot=function(e,t,n){return e instanceof a.default.Vector?this.dot(e.x,e.y,e.z):this.x*(e||0)+this.y*(t||0)+this.z*(n||0)},a.default.Vector.prototype.cross=function(e){var t=this.y*e.z-this.z*e.y,n=this.z*e.x-this.x*e.z,r=this.x*e.y-this.y*e.x;return this.p5?new a.default.Vector(this.p5,[t,n,r]):new a.default.Vector(t,n,r)},a.default.Vector.prototype.dist=function(e){return e.copy().sub(this).mag()},a.default.Vector.prototype.normalize=function(){var e=this.mag();return 0!==e&&this.mult(1/e),this},a.default.Vector.prototype.limit=function(e){var t=this.magSq();return e*e<t&&this.div(Math.sqrt(t)).mult(e),this},a.default.Vector.prototype.setMag=function(e){return this.normalize().mult(e)},a.default.Vector.prototype.heading=function(){var e=Math.atan2(this.y,this.x);return this.p5?this.p5._fromRadians(e):e},a.default.Vector.prototype.setHeading=function(e){var t=this.mag();return this.x=t*Math.cos(e),this.y=t*Math.sin(e),this},a.default.Vector.prototype.rotate=function(e){var t=this.heading()+e;this.p5&&(t=this.p5._toRadians(t));var n=this.mag();return this.x=Math.cos(t)*n,this.y=Math.sin(t)*n,this},a.default.Vector.prototype.angleBetween=function(e){var t,n=this.dot(e)/(this.mag()*e.mag());return t=Math.acos(Math.min(1,Math.max(-1,n))),t*=Math.sign(this.cross(e).z||1),this.p5&&(t=this.p5._fromRadians(t)),t},a.default.Vector.prototype.lerp=function(e,t,n,r){return e instanceof a.default.Vector?this.lerp(e.x,e.y,e.z,t):(this.x+=(e-this.x)*r||0,this.y+=(t-this.y)*r||0,this.z+=(n-this.z)*r||0,this)},a.default.Vector.prototype.reflect=function(e){return e.normalize(),this.sub(e.mult(2*this.dot(e)))},a.default.Vector.prototype.array=function(){return[this.x||0,this.y||0,this.z||0]},a.default.Vector.prototype.equals=function(e,t,n){var r,i,o;return o=e instanceof a.default.Vector?(r=e.x||0,i=e.y||0,e.z||0):e instanceof Array?(r=e[0]||0,i=e[1]||0,e[2]||0):(r=e||0,i=t||0,n||0),this.x===r&&this.y===i&&this.z===o},a.default.Vector.fromAngle=function(e,t){return void 0===t&&(t=1),new a.default.Vector(t*Math.cos(e),t*Math.sin(e),0)},a.default.Vector.fromAngles=function(e,t,n){void 0===n&&(n=1);var r=Math.cos(t),i=Math.sin(t),o=Math.cos(e),s=Math.sin(e);return new a.default.Vector(n*s*i,-n*o,n*s*r)},a.default.Vector.random2D=function(){return this.fromAngle(Math.random()*o.TWO_PI)},a.default.Vector.random3D=function(){var e=Math.random()*o.TWO_PI,t=2*Math.random()-1,n=Math.sqrt(1-t*t),r=n*Math.cos(e),i=n*Math.sin(e);return new a.default.Vector(r,i,t)},a.default.Vector.add=function(e,t,n){return n?n.set(e):(n=e.copy(),3===arguments.length&&a.default._friendlyError("The target parameter is undefined, it should be of type p5.Vector","p5.Vector.add")),n.add(t),n},a.default.Vector.rem=function(e,t){if(e instanceof a.default.Vector&&t instanceof a.default.Vector){var n=e.copy();return n.rem(t),n}},a.default.Vector.sub=function(e,t,n){return n?n.set(e):(n=e.copy(),3===arguments.length&&a.default._friendlyError("The target parameter is undefined, it should be of type p5.Vector","p5.Vector.sub")),n.sub(t),n},a.default.Vector.mult=function(e,t,n){return n?n.set(e):(n=e.copy(),3===arguments.length&&a.default._friendlyError("The target parameter is undefined, it should be of type p5.Vector","p5.Vector.mult")),n.mult(t),n},a.default.Vector.rotate=function(e,t,n){return 2===arguments.length?n=e.copy():(n instanceof a.default.Vector||a.default._friendlyError("The target parameter should be of type p5.Vector","p5.Vector.rotate"),n.set(e)),n.rotate(t),n},a.default.Vector.div=function(e,t,n){return n?n.set(e):(n=e.copy(),3===arguments.length&&a.default._friendlyError("The target parameter is undefined, it should be of type p5.Vector","p5.Vector.div")),n.div(t),n},a.default.Vector.dot=function(e,t){return e.dot(t)},a.default.Vector.cross=function(e,t){return e.cross(t)},a.default.Vector.dist=function(e,t){return e.dist(t)},a.default.Vector.lerp=function(e,t,n,r){return r?r.set(e):(r=e.copy(),4===arguments.length&&a.default._friendlyError("The target parameter is undefined, it should be of type p5.Vector","p5.Vector.lerp")),r.lerp(t,n),r},a.default.Vector.mag=function(e){var t=e.x,n=e.y,r=e.z,i=t*t+n*n+r*r;return Math.sqrt(i)},a.default.Vector.normalize=function(e,t){return arguments.length<2?t=e.copy():(t instanceof a.default.Vector||a.default._friendlyError("The target parameter should be of type p5.Vector","p5.Vector.normalize"),t.set(e)),t.normalize()};var c=a.default.Vector;n.default=c},{"../core/constants":250,"../core/main":260,"core-js/modules/es.array.concat":148,"core-js/modules/es.array.every":149,"core-js/modules/es.array.slice":160,"core-js/modules/es.array.some":161,"core-js/modules/es.math.sign":166,"core-js/modules/es.number.constructor":167,"core-js/modules/es.number.is-finite":168,"core-js/modules/es.object.to-string":174,"core-js/modules/es.regexp.to-string":179,"core-js/modules/es.string.sub":189}],294:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=(r=e("../core/main"))&&r.__esModule?r:{default:r},a="_lcg_random_state",o=4294967296,s=0;i.default.prototype._lcg=function(e){return this[e]=(1664525*this[e]+1013904223)%o,this[e]/o},i.default.prototype._lcgSetSeed=function(e,t){this[e]=(null==t?Math.random()*o:t)>>>0},i.default.prototype.randomSeed=function(e){this._lcgSetSeed(a,e),this._gaussian_previous=!1},i.default.prototype.random=function(e,t){var n;if(i.default._validateParameters("random",arguments),n=null!=this[a]?this._lcg(a):Math.random(),void 0===e)return n;if(void 0===t)return e instanceof Array?e[Math.floor(n*e.length)]:n*e;if(t<e){var r=e;e=t,t=r}return n*(t-e)+e},i.default.prototype.randomGaussian=function(e){var t,n,r,i,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;if(this._gaussian_previous)t=s,this._gaussian_previous=!1;else{for(;1<=(i=(n=this.random(2)-1)*n+(r=this.random(2)-1)*r););t=n*(i=Math.sqrt(-2*Math.log(i)/i)),s=r*i,this._gaussian_previous=!0}return t*a+(e||0)};var u=i.default;n.default=u},{"../core/main":260}],295:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i,a=(i=e("../core/main"))&&i.__esModule?i:{default:i},o=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var t="function"!=typeof WeakMap?null:new WeakMap;if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,t&&t.set(e,n),n}(e("../core/constants"));a.default.prototype._angleMode=o.RADIANS,a.default.prototype.acos=function(e){return this._fromRadians(Math.acos(e))},a.default.prototype.asin=function(e){return this._fromRadians(Math.asin(e))},a.default.prototype.atan=function(e){return this._fromRadians(Math.atan(e))},a.default.prototype.atan2=function(e,t){return this._fromRadians(Math.atan2(e,t))},a.default.prototype.cos=function(e){return Math.cos(this._toRadians(e))},a.default.prototype.sin=function(e){return Math.sin(this._toRadians(e))},a.default.prototype.tan=function(e){return Math.tan(this._toRadians(e))},a.default.prototype.degrees=function(e){return e*o.RAD_TO_DEG},a.default.prototype.radians=function(e){return e*o.DEG_TO_RAD},a.default.prototype.angleMode=function(e){e!==o.DEGREES&&e!==o.RADIANS||(this._angleMode=e)},a.default.prototype._toRadians=function(e){return this._angleMode===o.DEGREES?e*o.DEG_TO_RAD:e},a.default.prototype._toDegrees=function(e){return this._angleMode===o.RADIANS?e*o.RAD_TO_DEG:e},a.default.prototype._fromRadians=function(e){return this._angleMode===o.DEGREES?e*o.RAD_TO_DEG:e};var s=a.default;n.default=s},{"../core/constants":250,"../core/main":260}],296:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=(r=e("../core/main"))&&r.__esModule?r:{default:r};i.default.prototype.textAlign=function(e,t){var n;return i.default._validateParameters("textAlign",arguments),(n=this._renderer).textAlign.apply(n,arguments)},i.default.prototype.textLeading=function(e){var t;return i.default._validateParameters("textLeading",arguments),(t=this._renderer).textLeading.apply(t,arguments)},i.default.prototype.textSize=function(e){var t;return i.default._validateParameters("textSize",arguments),(t=this._renderer).textSize.apply(t,arguments)},i.default.prototype.textStyle=function(e){var t;return i.default._validateParameters("textStyle",arguments),(t=this._renderer).textStyle.apply(t,arguments)},i.default.prototype.textWidth=function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n[0]+="",i.default._validateParameters("textWidth",n),0===n[0].length?0:(e=this._renderer).textWidth.apply(e,n)},i.default.prototype.textAscent=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return i.default._validateParameters("textAscent",t),this._renderer.textAscent()},i.default.prototype.textDescent=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return i.default._validateParameters("textDescent",t),this._renderer.textDescent()},i.default.prototype._updateTextMetrics=function(){return this._renderer._updateTextMetrics()};var a=i.default;n.default=a},{"../core/main":260}],297:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e("core-js/modules/es.array.concat"),e("core-js/modules/es.array.includes"),e("core-js/modules/es.array.last-index-of"),e("core-js/modules/es.regexp.exec"),e("core-js/modules/es.string.split"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i,a=(i=e("../core/main"))&&i.__esModule?i:{default:i},o=c(e("../core/constants")),s=c(e("opentype.js"));function u(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return u=function(){return e},e}function c(e){if(e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var t=u();if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,t&&t.set(e,n),n}e("../core/friendly_errors/validate_params"),e("../core/friendly_errors/file_errors"),e("../core/friendly_errors/fes_core"),a.default.prototype.loadFont=function(e,t,n){a.default._validateParameters("loadFont",arguments);var r=new a.default.Font(this),i=this;return s.load(e,(function(o,s){if(o)return a.default._friendlyFileLoadError(4,e),void 0!==n?n(o):void console.error(o,e);r.font=s,void 0!==t&&t(r),i._decrementPreload();var u,c,l=e.split("\\").pop().split("/").pop(),f=l.lastIndexOf("."),d=f<1?null:l.substr(f+1);["ttf","otf","woff","woff2"].includes(d)&&(u=l.substr(0,f),(c=document.createElement("style")).appendChild(document.createTextNode("\n@font-face {\nfont-family: ".concat(u,";\nsrc: url(").concat(e,");\n}\n"))),document.head.appendChild(c))})),r},a.default.prototype.text=function(e,t,n,r,i){var o;return a.default._validateParameters("text",arguments),this._renderer._doFill||this._renderer._doStroke?(o=this._renderer).text.apply(o,arguments):this},a.default.prototype.textFont=function(e,t){if(a.default._validateParameters("textFont",arguments),arguments.length){if(!e)throw new Error("null font passed to textFont");return this._renderer._setProperty("_textFont",e),t&&(this._renderer._setProperty("_textSize",t),this._renderer._setProperty("_textLeading",t*o._DEFAULT_LEADMULT)),this._renderer._applyTextProperties()}return this._renderer._textFont};var l=a.default;n.default=l},{"../core/constants":250,"../core/friendly_errors/fes_core":252,"../core/friendly_errors/file_errors":253,"../core/friendly_errors/validate_params":255,"../core/main":260,"core-js/modules/es.array.concat":148,"core-js/modules/es.array.includes":154,"core-js/modules/es.array.last-index-of":158,"core-js/modules/es.regexp.exec":178,"core-js/modules/es.string.split":188,"opentype.js":236}],298:[function(e,t,n){"use strict";e("core-js/modules/es.symbol"),e("core-js/modules/es.symbol.description"),e("core-js/modules/es.symbol.iterator"),e("core-js/modules/es.array.concat"),e("core-js/modules/es.array.fill"),e("core-js/modules/es.array.iterator"),e("core-js/modules/es.array.join"),e("core-js/modules/es.array.slice"),e("core-js/modules/es.array.splice"),e("core-js/modules/es.function.name"),e("core-js/modules/es.number.to-fixed"),e("core-js/modules/es.object.to-string"),e("core-js/modules/es.regexp.exec"),e("core-js/modules/es.string.iterator"),e("core-js/modules/es.string.split"),e("core-js/modules/web.dom-collections.iterator"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=(r=e("../core/main"))&&r.__esModule?r:{default:r},a=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==o(e)&&"function"!=typeof e)return{default:e};var t="function"!=typeof WeakMap?null:new WeakMap;if(t&&t.has(e))return t.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var a=r?Object.getOwnPropertyDescriptor(e,i):null;a&&(a.get||a.set)?Object.defineProperty(n,i,a):n[i]=e[i]}return n.default=e,t&&t.set(e,n),n}(e("../core/constants"));function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var n=function(e,t){if("object"!==o(e))e=t;else for(var n in t)void 0===e[n]&&(e[n]=t[n]);return e}(t,{sampleFactor:.1,simplifyThreshold:0}),r=p(e,0,1),i=r/(r*n.sampleFactor),a=[],s=0;s<r;s+=i)a.push(p(e,s));return n.simplifyThreshold&&function(e){for(var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=e.length-1;3<e.length&&0<=n;--n)f(l(e,n-1),l(e,n),l(e,n+1),t)&&e.splice(n%e.length,1)}(a,n.simplifyThreshold),a}function u(e){for(var t,n=[],r=0;r<e.length;r++)"M"===e[r].type&&(t&&n.push(t),t=[]),t.push(c(e[r]));return n.push(t),n}function c(e){var t=[e.type];return"M"===e.type||"L"===e.type?t.push(e.x,e.y):"C"===e.type?t.push(e.x1,e.y1,e.x2,e.y2,e.x,e.y):"Q"===e.type&&t.push(e.x1,e.y1,e.x,e.y),t}function l(e,t){var n=e.length;return e[t<0?t%n+n:t%n]}function f(e,t,n,r){if(!r)return 0==(i=e,o=n,((a=t)[0]-i[0])*(o[1]-i[1])-(o[0]-i[0])*(a[1]-i[1]));var i,a,o;void 0===f.tmpPoint1&&(f.tmpPoint1=[],f.tmpPoint2=[]);var s=f.tmpPoint1,u=f.tmpPoint2;s.x=t.x-e.x,s.y=t.y-e.y,u.x=n.x-t.x,u.y=n.y-t.y;var c=s.x*u.x+s.y*u.y,l=Math.sqrt(s.x*s.x+s.y*s.y),d=Math.sqrt(u.x*u.x+u.y*u.y);return Math.acos(c/(l*d))<r}function d(e,t,n,r,i,a,o,s,u){var c=1-u,l=Math.pow(c,3),f=Math.pow(c,2),d=u*u,h=d*u,p=l*e+3*f*u*n+3*c*u*u*i+h*o,m=l*t+3*f*u*r+3*c*u*u*a+h*s,v=e+2*u*(n-e)+d*(i-2*n+e),g=t+2*u*(r-t)+d*(a-2*r+t),y=n+2*u*(i-n)+d*(o-2*i+n),b=r+2*u*(a-r)+d*(s-2*a+r),x=c*e+u*n,w=c*t+u*r,_=c*i+u*o,k=c*a+u*s,E=90-180*Math.atan2(v-y,g-b)/Math.PI;return(y<v||g<b)&&(E+=180),{x:p,y:m,m:{x:v,y:g},n:{x:y,y:b},start:{x:x,y:w},end:{x:_,y:k},alpha:E}}function h(e,t,n,r,i,a,o,s,u){return null==u?b(e,t,n,r,i,a,o,s):d(e,t,n,r,i,a,o,s,function(e,t,n,r,i,a,o,s,u){if(!(u<0||b(e,t,n,r,i,a,o,s)<u)){var c,l=.5,f=1-l;for(c=b(e,t,n,r,i,a,o,s,f);.01<Math.abs(c-u);)c=b(e,t,n,r,i,a,o,s,f+=(c<u?1:-1)*(l/=2));return f}}(e,t,n,r,i,a,o,s,u))}function p(e,t,n){for(var r,i,a,o,s,u=0,c=0,l=(e=function(e,t){function n(e,t,n){var r,i;if(!e)return["C",t.x,t.y,t.x,t.y,t.x,t.y];switch(e[0]in{T:1,Q:1}||(t.qx=t.qy=null),e[0]){case"M":t.X=e[1],t.Y=e[2];break;case"A":e=["C"].concat(function e(t,n,r,i,a,o,s,u,c,l){var f,d,h,p,m,v=Math.PI,g=120*v/180,y=v/180*(+a||0),b=[],x=function(e,t,n){return{x:e*Math.cos(n)-t*Math.sin(n),y:e*Math.sin(n)+t*Math.cos(n)}};if(l)f=l[0],d=l[1],h=l[2],p=l[3];else{t=(m=x(t,n,-y)).x,n=m.y;var w=(t-(u=(m=x(u,c,-y)).x))/2,_=(n-(c=m.y))/2,k=w*w/(r*r)+_*_/(i*i);1<k&&(r*=k=Math.sqrt(k),i*=k);var E=r*r,S=i*i,C=(o===s?-1:1)*Math.sqrt(Math.abs((E*S-E*_*_-S*w*w)/(E*_*_+S*w*w)));h=C*r*_/i+(t+u)/2,p=C*-i*w/r+(n+c)/2,f=Math.asin(((n-p)/i).toFixed(9)),d=Math.asin(((c-p)/i).toFixed(9)),(f=t<h?v-f:f)<0&&(f=2*v+f),(d=u<h?v-d:d)<0&&(d=2*v+d),s&&d<f&&(f-=2*v),!s&&f<d&&(d-=2*v)}var A=d-f;if(Math.abs(A)>g){var O=d,D=u,T=c;d=f+g*(s&&f<d?1:-1),b=e(u=h+r*Math.cos(d),c=p+i*Math.sin(d),r,i,a,0,s,D,T,[d,O,h,p])}A=d-f;var j=Math.cos(f),M=Math.sin(f),F=Math.cos(d),I=Math.sin(d),N=Math.tan(A/4),R=4/3*r*N,P=4/3*i*N,B=[t,n],L=[t+R*M,n-P*j],z=[u+R*I,c-P*F],U=[u,c];if(L[0]=2*B[0]-L[0],L[1]=2*B[1]-L[1],l)return[L,z,U].concat(b);for(var W=[],V=0,G=(b=[L,z,U].concat(b).join().split(",")).length;V<G;V++)W[V]=V%2?x(b[V-1],b[V],y).y:x(b[V],b[V+1],y).x;return W}.apply(0,[t.x,t.y].concat(e.slice(1))));break;case"S":i="C"===n||"S"===n?(r=2*t.x-t.bx,2*t.y-t.by):(r=t.x,t.y),e=["C",r,i].concat(e.slice(1));break;case"T":"Q"===n||"T"===n?(t.qx=2*t.x-t.qx,t.qy=2*t.y-t.qy):(t.qx=t.x,t.qy=t.y),e=["C"].concat(y(t.x,t.y,t.qx,t.qy,e[1],e[2]));break;case"Q":t.qx=e[1],t.qy=e[2],e=["C"].concat(y(t.x,t.y,e[1],e[2],e[3],e[4]));break;case"L":e=["C"].concat(g(t.x,t.y,e[1],e[2]));break;case"H":e=["C"].concat(g(t.x,t.y,e[1],t.y));break;case"V":e=["C"].concat(g(t.x,t.y,t.x,e[1]));break;case"Z":e=["C"].concat(g(t.x,t.y,t.X,t.Y))}return e}function r(e,t){if(7<e[t].length){e[t].shift();for(var n=e[t];n.length;)l[t]="A",s&&(f[t]="A"),e.splice(t++,0,["C"].concat(n.splice(0,6)));e.splice(t,1),a=Math.max(o.length,s&&s.length||0)}}function i(e,t,n,r,i){e&&t&&"M"===e[i][0]&&"M"!==t[i][0]&&(t.splice(i,0,["M",r.x,r.y]),n.bx=0,n.by=0,n.x=e[i][1],n.y=e[i][2],a=Math.max(o.length,s&&s.length||0))}var a,o=m(e),s=t,u={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},c={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},l=[],f=[],d="",h="";a=Math.max(o.length,s&&s.length||0);for(var p=0;p<a;p++){o[p]&&(d=o[p][0]),"C"!==d&&(l[p]=d,p&&(h=l[p-1])),o[p]=n(o[p],u,h),"A"!==l[p]&&"C"===d&&(l[p]="C"),r(o,p),s&&(s[p]&&(d=s[p][0]),"C"!==d&&(f[p]=d,p&&(h=f[p-1])),s[p]=n(s[p],c,h),"A"!==f[p]&&"C"===d&&(f[p]="C"),r(s,p)),i(o,s,u,c,p),i(s,o,c,u,p);var v=o[p],b=s&&s[p],x=v.length,w=s&&b.length;u.x=v[x-2],u.y=v[x-1],u.bx=parseFloat(v[x-4])||u.x,u.by=parseFloat(v[x-3])||u.y,c.bx=s&&(parseFloat(b[w-4])||c.x),c.by=s&&(parseFloat(b[w-3])||c.y),c.x=s&&b[w-2],c.y=s&&b[w-1]}return s?[o,s]:o}(e)).length;c<l;c++){if("M"===(a=e[c])[0])r=+a[1],i=+a[2];else{if(t<u+(o=h(r,i,a[1],a[2],a[3],a[4],a[5],a[6]))&&!n)return{x:(s=h(r,i,a[1],a[2],a[3],a[4],a[5],a[6],t-u)).x,y:s.y,alpha:s.alpha};u+=o,r=+a[5],i=+a[6]}a.shift()}return(s=n?u:d(r,i,a[0],a[1],a[2],a[3],a[4],a[5],1)).alpha&&(s={x:s.x,y:s.y,alpha:s.alpha}),s}function m(e){var t,n=[],r=0,i=0,a=0,o=0,s=0;if(!e)return n;"M"===e[0][0]&&(a=r=+e[0][1],o=i=+e[0][2],s++,n[0]=["M",r,i]);for(var u,c,l=3===e.length&&"M"===e[0][0]&&"R"===e[1][0].toUpperCase()&&"Z"===e[2][0].toUpperCase(),f=s,d=e.length;f<d;f++){if(n.push(u=[]),(c=e[f])[0]!==String.prototype.toUpperCase.call(c[0]))switch(u[0]=String.prototype.toUpperCase.call(c[0]),u[0]){case"A":u[1]=c[1],u[2]=c[2],u[3]=c[3],u[4]=c[4],u[5]=c[5],u[6]=+(c[6]+r),u[7]=+(c[7]+i);break;case"V":u[1]=+c[1]+i;break;case"H":u[1]=+c[1]+r;break;case"R":for(var h=2,p=(t=[r,i].concat(c.slice(1))).length;h<p;h++)t[h]=+t[h]+r,t[++h]=+t[h]+i;n.pop(),n=n.concat(v(t,l));break;case"M":a=+c[1]+r,o=+c[2]+i;break;default:for(var m=1,g=c.length;m<g;m++)u[m]=+c[m]+(m%2?r:i)}else if("R"===c[0])t=[r,i].concat(c.slice(1)),n.pop(),n=n.concat(v(t,l)),u=["R"].concat(c.slice(-2));else for(var y=0,b=c.length;y<b;y++)u[y]=c[y];switch(u[0]){case"Z":r=a,i=o;break;case"H":r=u[1];break;case"V":i=u[1];break;case"M":a=u[u.length-2],o=u[u.length-1];break;default:r=u[u.length-2],i=u[u.length-1]}}return n}function v(e,t){for(var n=[],r=0,i=e.length;r<i-2*!t;r+=2){var a=[{x:+e[r-2],y:+e[r-1]},{x:+e[r],y:+e[r+1]},{x:+e[r+2],y:+e[r+3]},{x:+e[r+4],y:+e[r+5]}];t?r?i-4===r?a[3]={x:+e[0],y:+e[1]}:i-2===r&&(a[2]={x:+e[0],y:+e[1]},a[3]={x:+e[2],y:+e[3]}):a[0]={x:+e[i-2],y:+e[i-1]}:i-4===r?a[3]=a[2]:r||(a[0]={x:+e[r],y:+e[r+1]}),n.push(["C",(-a[0].x+6*a[1].x+a[2].x)/6,(-a[0].y+6*a[1].y+a[2].y)/6,(a[1].x+6*a[2].x-a[3].x)/6,(a[1].y+6*a[2].y-a[3].y)/6,a[2].x,a[2].y])}return n}function g(e,t,n,r){return[e,t,n,r,n,r]}function y(e,t,n,r,i,a){return[1/3*e+2/3*n,1/3*t+2/3*r,1/3*i+2/3*n,1/3*a+2/3*r,i,a]}function b(e,t,n,r,i,a,o,s,u){null==u&&(u=1);for(var c=(u=1<u?1:u<0?0:u)/2,l=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],f=0,d=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],h=0;h<12;h++){var p=c*l[h]+c,m=x(p,e,n,i,o),v=x(p,t,r,a,s),g=m*m+v*v;f+=d[h]*Math.sqrt(g)}return c*f}function x(e,t,n,r,i){return e*(e*(-3*t+9*n-9*r+3*i)+6*t-12*n+6*r)-3*t+3*n}i.default.Font=function(e){this.parent=e,this.cache={},this.font=void 0},i.default.Font.prototype.textBounds=function(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length?arguments[3]:void 0,o=4<arguments.length?arguments[4]:void 0,s=o&&o.renderer&&o.renderer._pInst||this.parent,u=s._renderer.drawingContext;if(u.textAlign||a.LEFT,u.textBaseline||a.BASELINE,i=i||s._renderer._textSize,!t){var c,l,f=[],d=[],h=[];h[0]=[];var p=[],m=this._scale(i),v=s._renderer.textLeading(),g=0;this.font.forEachGlyph(e,n,r,i,o,(function(e,t,n,r){var i=e.getMetrics();0===e.index||10===e.index?h[g+=1]=[]:(h[g].push(t+i.xMin*m),h[g].push(t+i.xMax*m),p.push(n+g*v+-i.yMin*m),p.push(n+g*v+-i.yMax*m))})),0<h[g].length&&(f[g]=Math.min.apply(null,h[g]),d[g]=Math.max.apply(null,h[g]));for(var y=0,b=0;b<=g;b++){f[b]=Math.min.apply(null,h[b]),d[b]=Math.max.apply(null,h[b]);var x=d[b]-f[b];y<x&&(y=x)}var w=Math.min.apply(null,f);t={x:w,y:c=Math.min.apply(null,p),h:Math.max.apply(null,p)-c,w:y,advance:w-n},l=this._handleAlignment(s._renderer,e,t.x,t.y,t.w+t.advance),t.x=l.x,t.y=l.y}return t},i.default.Font.prototype.textToPoints=function(e,t,n,r,i){var a,o=0,c=[],l=this._getGlyphs(e);r=r||this.parent._renderer._textSize;for(var f=0;f<l.length;f++){if(!(l[a=f].name&&"space"===l[a].name||e.length===l.length&&" "===e[a]||l[a].index&&3===l[a].index))for(var d=u(l[f].getPath(t,n,r).commands),h=0;h<d.length;h++)for(var p=s(d[h],i),m=0;m<p.length;m++)p[m].x+=o,c.push(p[m]);o+=l[f].advanceWidth*this._scale(r)}return c},i.default.Font.prototype._getGlyphs=function(e){return this.font.stringToGlyphs(e)},i.default.Font.prototype._getPath=function(e,t,n,r){var i=(r&&r.renderer&&r.renderer._pInst||this.parent)._renderer,a=this._handleAlignment(i,e,t,n);return this.font.getPath(e,a.x,a.y,i._textSize,r)},i.default.Font.prototype._getPathData=function(e,t,n,r){var i=3;return"string"==typeof e&&2<arguments.length?e=this._getPath(e,t,n,r):"object"===o(t)&&(r=t),r&&"number"==typeof r.decimals&&(i=r.decimals),e.toPathData(i)},i.default.Font.prototype._getSVG=function(e,t,n,r){var i=3;return"string"==typeof e&&2<arguments.length?e=this._getPath(e,t,n,r):"object"===o(t)&&(r=t),r&&("number"==typeof r.decimals&&(i=r.decimals),"number"==typeof r.strokeWidth&&(e.strokeWidth=r.strokeWidth),void 0!==r.fill&&(e.fill=r.fill),void 0!==r.stroke&&(e.stroke=r.stroke)),e.toSVG(i)},i.default.Font.prototype._renderPath=function(e,t,n,r){var i,s=r&&r.renderer||this.parent._renderer,u=s.drawingContext;i="object"===o(e)&&e.commands?e.commands:this._getPath(e,t,n,r).commands,u.beginPath();var c=!0,l=!1,f=void 0;try{for(var d,h=i[Symbol.iterator]();!(c=(d=h.next()).done);c=!0){var p=d.value;"M"===p.type?u.moveTo(p.x,p.y):"L"===p.type?u.lineTo(p.x,p.y):"C"===p.type?u.bezierCurveTo(p.x1,p.y1,p.x2,p.y2,p.x,p.y):"Q"===p.type?u.quadraticCurveTo(p.x1,p.y1,p.x,p.y):"Z"===p.type&&u.closePath()}}catch(e){l=!0,f=e}finally{try{c||null==h.return||h.return()}finally{if(l)throw f}}return s._doStroke&&s._strokeSet&&u.stroke(),s._doFill&&(s._fillSet||s._setFill(a._DEFAULT_TEXT_FILL),u.fill()),this},i.default.Font.prototype._textWidth=function(e,t){return this.font.getAdvanceWidth(e,t)},i.default.Font.prototype._textAscent=function(e){return this.font.ascender*this._scale(e)},i.default.Font.prototype._textDescent=function(e){return-this.font.descender*this._scale(e)},i.default.Font.prototype._scale=function(e){return 1/this.font.unitsPerEm*(e||this.parent._renderer._textSize)},i.default.Font.prototype._handleAlignment=function(e,t,n,r,i){var o=e._textSize;switch(void 0===i&&(i=this._textWidth(t,o)),e._textAlign){case a.CENTER:n-=i/2;break;case a.RIGHT:n-=i}switch(e._textBaseline){case a.TOP:r+=this._textAscent(o);break;case a.CENTER:r+=this._textAscent(o)/2;break;case a.BOTTOM:r-=this._textDescent(o)}return{x:n,y:r}};var w=i.default;n.default=w},{"../core/constants":250,"../core/main":260,"core-js/modules/es.array.concat":148,"core-js/modules/es.array.fill":150,"core-js/modules/es.array.iterator":156,"core-js/modules/es.array.join":157,"core-js/modules/es.array.slice":160,"core-js/modules/es.array.splice":162,"core-js/modules/es.function.name":163,"core-js/modules/es.number.to-fixed":169,"core-js/modules/es.object.to-string":174,"core-js/modules/es.regexp.exec":178,"core-js/modules/es.string.iterator":183,"core-js/modules/es.string.split":188,"core-js/modules/es.symbol":193,"core-js/modules/es.symbol.description":191,"core-js/modules/es.symbol.iterator":192,"core-js/modules/web.dom-collections.iterator":226}],299:[function(e,t,n){"use strict";e("core-js/modules/es.array.concat"),e("core-js/modules/es.array.slice"),e("core-js/modules/es.array.splice"),e("core-js/modules/es.array-buffer.constructor"),e("core-js/modules/es.object.to-string"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=(r=e("../core/main"))&&r.__esModule?r:{default:r};i.default.prototype.append=function(e,t){return e.push(t),e},i.default.prototype.arrayCopy=function(e,t,n,r,i){var a,o;e=void 0!==i?(o=Math.min(i,e.length),a=r,e.slice(t,o+t)):(o=void 0!==n?(o=n,Math.min(o,e.length)):e.length,a=0,n=t,e.slice(0,o)),Array.prototype.splice.apply(n,[a,o].concat(e))},i.default.prototype.concat=function(e,t){return e.concat(t)},i.default.prototype.reverse=function(e){return e.reverse()},i.default.prototype.shorten=function(e){return e.pop(),e},i.default.prototype.shuffle=function(e,t){for(var n,r,i=ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(e),a=(e=t||i?e:e.slice()).length;1<a;)n=this.random(0,1)*a|0,r=e[--a],e[a]=e[n],e[n]=r;return e},i.default.prototype.sort=function(e,t){var n=t?e.slice(0,Math.min(t,e.length)):e,r=t?e.slice(Math.min(t,e.length)):[];return(n="string"==typeof n[0]?n.sort():n.sort((function(e,t){return e-t}))).concat(r)},i.default.prototype.splice=function(e,t,n){return Array.prototype.splice.apply(e,[n,0].concat(t)),e},i.default.prototype.subset=function(e,t,n){return void 0!==n?e.slice(t,t+n):e.slice(t,e.length)};var a=i.default;n.default=a},{"../core/main":260,"core-js/modules/es.array-buffer.constructor":147,"core-js/modules/es.array.concat":148,"core-js/modules/es.array.slice":160,"core-js/modules/es.array.splice":162,"core-js/modules/es.object.to-string":174}],300:[function(e,t,n){"use strict";e("core-js/modules/es.array.map"),e("core-js/modules/es.number.constructor"),e("core-js/modules/es.object.to-string"),e("core-js/modules/es.regexp.to-string"),e("core-js/modules/es.string.repeat"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=(r=e("../core/main"))&&r.__esModule?r:{default:r};i.default.prototype.float=function(e){return e instanceof Array?e.map(parseFloat):parseFloat(e)},i.default.prototype.int=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:10;return e===1/0||"Infinity"===e?1/0:e===-1/0||"-Infinity"===e?-1/0:"string"==typeof e?parseInt(e,t):"number"==typeof e?0|e:"boolean"==typeof e?e?1:0:e instanceof Array?e.map((function(e){return i.default.prototype.int(e,t)})):void 0},i.default.prototype.str=function(e){return e instanceof Array?e.map(i.default.prototype.str):String(e)},i.default.prototype.boolean=function(e){return"number"==typeof e?0!==e:"string"==typeof e?"true"===e.toLowerCase():"boolean"==typeof e?e:e instanceof Array?e.map(i.default.prototype.boolean):void 0},i.default.prototype.byte=function(e){var t=i.default.prototype.int(e,10);return"number"==typeof t?(t+128)%256-128:t instanceof Array?t.map(i.default.prototype.byte):void 0},i.default.prototype.char=function(e){return"number"!=typeof e||isNaN(e)?e instanceof Array?e.map(i.default.prototype.char):"string"==typeof e?i.default.prototype.char(parseInt(e,10)):void 0:String.fromCharCode(e)},i.default.prototype.unchar=function(e){return"string"==typeof e&&1===e.length?e.charCodeAt(0):e instanceof Array?e.map(i.default.prototype.unchar):void 0},i.default.prototype.hex=function(e,t){if(t=null==t?t=8:t,e instanceof Array)return e.map((function(e){return i.default.prototype.hex(e,t)}));if(e===1/0||e===-1/0)return(e===1/0?"F":"0").repeat(t);if("number"==typeof e){e<0&&(e=4294967295+e+1);for(var n=Number(e).toString(16).toUpperCase();n.length<t;)n="0".concat(n);return n.length>=t&&(n=n.substring(n.length-t,n.length)),n}},i.default.prototype.unhex=function(e){return e instanceof Array?e.map(i.default.prototype.unhex):parseInt("0x".concat(e),16)};var a=i.default;n.default=a},{"../core/main":260,"core-js/modules/es.array.map":159,"core-js/modules/es.number.constructor":167,"core-js/modules/es.object.to-string":174,"core-js/modules/es.regexp.to-string":179,"core-js/modules/es.string.repeat":185}],301:[function(e,t,n){"use strict";e("core-js/modules/es.array.filter"),e("core-js/modules/es.array.index-of"),e("core-js/modules/es.array.join"),e("core-js/modules/es.array.map"),e("core-js/modules/es.array.slice"),e("core-js/modules/es.object.to-string"),e("core-js/modules/es.regexp.constructor"),e("core-js/modules/es.regexp.exec"),e("core-js/modules/es.regexp.to-string"),e("core-js/modules/es.string.match"),e("core-js/modules/es.string.replace"),e("core-js/modules/es.string.split"),e("core-js/modules/es.string.trim"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=(r=e("../core/main"))&&r.__esModule?r:{default:r};function a(e,t,n){var r=e<0,i=r?e.toString().substring(1):e.toString(),a=i.indexOf("."),o=-1!==a?i.substring(0,a):i,s=-1!==a?i.substring(a+1):"",u=r?"-":"";if(void 0!==n){var c="";(-1!==a||0<n-s.length)&&(c="."),s.length>n&&(s=s.substring(0,n));for(var l=0;l<t-o.length;l++)u+="0";u+=o,u+=c,u+=s;for(var f=0;f<n-s.length;f++)u+="0";return u}for(var d=0;d<Math.max(t-o.length,0);d++)u+="0";return u+i}function o(e,t){var n=(e=e.toString()).indexOf("."),r=-1!==n?e.substring(n):"",i=-1!==n?e.substring(0,n):e;if(i=i.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),0===t)r="";else if(void 0!==t)if(t>r.length)for(var a=t-(r+=-1===n?".":"").length+1,o=0;o<a;o++)r+="0";else r=r.substring(0,t+1);return i+r}function s(e){return 0<parseFloat(e)?"+".concat(e.toString()):e.toString()}function u(e){return 0<=parseFloat(e)?" ".concat(e.toString()):e.toString()}e("../core/friendly_errors/validate_params"),e("../core/friendly_errors/file_errors"),e("../core/friendly_errors/fes_core"),i.default.prototype.join=function(e,t){return i.default._validateParameters("join",arguments),e.join(t)},i.default.prototype.match=function(e,t){return i.default._validateParameters("match",arguments),e.match(t)},i.default.prototype.matchAll=function(e,t){i.default._validateParameters("matchAll",arguments);for(var n=new RegExp(t,"g"),r=n.exec(e),a=[];null!==r;)a.push(r),r=n.exec(e);return a},i.default.prototype.nf=function(e,t,n){return i.default._validateParameters("nf",arguments),e instanceof Array?e.map((function(e){return a(e,t,n)})):"[object Arguments]"===Object.prototype.toString.call(e)?3===e.length?this.nf(e[0],e[1],e[2]):2===e.length?this.nf(e[0],e[1]):this.nf(e[0]):a(e,t,n)},i.default.prototype.nfc=function(e,t){return i.default._validateParameters("nfc",arguments),e instanceof Array?e.map((function(e){return o(e,t)})):o(e,t)},i.default.prototype.nfp=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];i.default._validateParameters("nfp",t);var r=i.default.prototype.nf.apply(this,t);return r instanceof Array?r.map(s):s(r)},i.default.prototype.nfs=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];i.default._validateParameters("nfs",t);var r=i.default.prototype.nf.apply(this,t);return r instanceof Array?r.map(u):u(r)},i.default.prototype.split=function(e,t){return i.default._validateParameters("split",arguments),e.split(t)},i.default.prototype.splitTokens=function(e,t){var n;if(i.default._validateParameters("splitTokens",arguments),void 0!==t){var r=t,a=/\]/g.exec(r),o=/\[/g.exec(r);n=o&&a?(r=r.slice(0,a.index)+r.slice(a.index+1),o=/\[/g.exec(r),r=r.slice(0,o.index)+r.slice(o.index+1),new RegExp("[\\[".concat(r,"\\]]"),"g")):a?(r=r.slice(0,a.index)+r.slice(a.index+1),new RegExp("[".concat(r,"\\]]"),"g")):o?(r=r.slice(0,o.index)+r.slice(o.index+1),new RegExp("[".concat(r,"\\[]"),"g")):new RegExp("[".concat(r,"]"),"g")}else n=/\s/g;return e.split(n).filter((function(e){return e}))},i.default.prototype.trim=function(e){return i.default._validateParameters("trim",arguments),e instanceof Array?e.map(this.trim):e.trim()};var c=i.default;n.default=c},{"../core/friendly_errors/fes_core":252,"../core/friendly_errors/file_errors":253,"../core/friendly_errors/validate_params":255,"../core/main":260,"core-js/modules/es.array.filter":151,"core-js/modules/es.array.index-of":155,"core-js/modules/es.array.join":157,"core-js/modules/es.array.map":159,"core-js/modules/es.array.slice":160,"core-js/modules/es.object.to-string":174,"core-js/modules/es.regexp.constructor":177,"core-js/modules/es.regexp.exec":178,"core-js/modules/es.regexp.to-string":179,"core-js/modules/es.string.match":184,"core-js/modules/es.string.replace":186,"core-js/modules/es.string.split":188,"core-js/modules/es.string.trim":190}],302:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=(r=e("../core/main"))&&r.__esModule?r:{default:r};i.default.prototype.day=function(){return(new Date).getDate()},i.default.prototype.hour=function(){return(new Date).getHours()},i.default.prototype.minute=function(){return(new Date).getMinutes()},i.default.prototype.millis=function(){return-1===this._millisStart?0:window.performance.now()-this._millisStart},i.default.prototype.month=function(){return(new Date).getMonth()+1},i.default.prototype.second=function(){return(new Date).getSeconds()},i.default.prototype.year=function(){return(new Date).getFullYear()};var a=i.default;n.default=a},{"../core/main":260}],303:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e("core-js/modules/es.array.concat"),e("core-js/modules/es.number.to-fixed"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i,a=(i=e("../core/main"))&&i.__esModule?i:{default:i};e("./p5.Geometry");var o=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var t="function"!=typeof WeakMap?null:new WeakMap;if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,t&&t.set(e,n),n}(e("../core/constants"));function s(e,t,n,r,i,o,s){e=e<=0?1:e,t=t<0?0:t,n=n<=0?e:n,r=r<3?3:r;var u,c,l,f=(o=void 0===o||o)?-2:0,d=(i=i<1?1:i)+((s=void 0===s?0!==t:s)?2:0),h=Math.atan2(e-t,n),p=Math.sin(h),m=Math.cos(h);for(u=f;u<=d;++u){var v=u/i,g=n*v,y=void 0;for(y=u<0?(v=g=0,e):i<u?(g=n,v=1,t):e+(t-e)*v,-2!==u&&u!==i+2||(y=0),g-=n/2,c=0;c<r;++c){var b,x=c/(r-1),w=2*Math.PI*x,_=Math.sin(w),k=Math.cos(w);this.vertices.push(new a.default.Vector(_*y,g,k*y)),b=u<0?new a.default.Vector(0,-1,0):i<u&&t?new a.default.Vector(0,1,0):new a.default.Vector(_*m,p,k*m),this.vertexNormals.push(b),this.uvs.push(x,v)}}var E=0;if(o){for(l=0;l<r;++l){var S=(l+1)%r;this.faces.push([E+l,E+r+S,E+r+l])}E+=2*r}for(u=0;u<i;++u){for(c=0;c<r;++c){var C=(c+1)%r;this.faces.push([E+c,E+C,E+r+C]),this.faces.push([E+c,E+r+C,E+r+c])}E+=r}if(s)for(E+=r,c=0;c<r;++c)this.faces.push([E+c,E+(c+1)%r,E+r])}a.default.prototype.plane=function(e,t,n,r){this._assert3d("plane"),a.default._validateParameters("plane",arguments),void 0===e&&(e=50),void 0===t&&(t=e),void 0===n&&(n=1),void 0===r&&(r=1);var i="plane|".concat(n,"|").concat(r);if(!this._renderer.geometryInHash(i)){var o=new a.default.Geometry(n,r,(function(){for(var e,t,n,r=0;r<=this.detailY;r++){t=r/this.detailY;for(var i=0;i<=this.detailX;i++)e=i/this.detailX,n=new a.default.Vector(e-.5,t-.5,0),this.vertices.push(n),this.uvs.push(e,t)}}));o.computeFaces().computeNormals(),n<=1&&r<=1?o._makeTriangleEdges()._edgesToVertices():this._renderer._doStroke&&console.log("Cannot draw stroke on plane objects with more than 1 detailX or 1 detailY"),this._renderer.createBuffers(i,o)}return this._renderer.drawBuffersScaled(i,e,t,1),this},a.default.prototype.box=function(e,t,n,r,i){this._assert3d("box"),a.default._validateParameters("box",arguments),void 0===e&&(e=50),void 0===t&&(t=e),void 0===n&&(n=t);var o=this._renderer.attributes&&this._renderer.attributes.perPixelLighting;void 0===r&&(r=o?1:4),void 0===i&&(i=o?1:4);var s="box|".concat(r,"|").concat(i);if(!this._renderer.geometryInHash(s)){var u=new a.default.Geometry(r,i,(function(){var e=[[0,4,2,6],[1,3,5,7],[0,1,4,5],[2,6,3,7],[0,2,1,3],[4,5,6,7]];this.strokeIndices=[[0,1],[1,3],[3,2],[6,7],[8,9],[9,11],[14,15],[16,17],[17,19],[18,19],[20,21],[22,23]];for(var t=0;t<e.length;t++){for(var n=e[t],r=4*t,i=0;i<4;i++){var o=n[i],s=new a.default.Vector((2*(1&o)-1)/2,((2&o)-1)/2,((4&o)/2-1)/2);this.vertices.push(s),this.uvs.push(1&i,(2&i)/2)}this.faces.push([r,1+r,2+r]),this.faces.push([2+r,1+r,3+r])}}));u.computeNormals(),r<=4&&i<=4?u._makeTriangleEdges()._edgesToVertices():this._renderer._doStroke&&console.log("Cannot draw stroke on box objects with more than 4 detailX or 4 detailY"),this._renderer.createBuffers(s,u)}return this._renderer.drawBuffersScaled(s,e,t,n),this},a.default.prototype.sphere=function(e,t,n){return this._assert3d("sphere"),a.default._validateParameters("sphere",arguments),void 0===e&&(e=50),void 0===t&&(t=24),void 0===n&&(n=16),this.ellipsoid(e,e,e,t,n),this},a.default.prototype.cylinder=function(e,t,n,r,i,o){this._assert3d("cylinder"),a.default._validateParameters("cylinder",arguments),void 0===e&&(e=50),void 0===t&&(t=e),void 0===n&&(n=24),void 0===r&&(r=1),void 0===o&&(o=!0),void 0===i&&(i=!0);var u="cylinder|".concat(n,"|").concat(r,"|").concat(i,"|").concat(o);if(!this._renderer.geometryInHash(u)){var c=new a.default.Geometry(n,r);s.call(c,1,1,1,n,r,i,o),n<=24&&r<=16?c._makeTriangleEdges()._edgesToVertices():this._renderer._doStroke&&console.log("Cannot draw stroke on cylinder objects with more than 24 detailX or 16 detailY"),this._renderer.createBuffers(u,c)}return this._renderer.drawBuffersScaled(u,e,t,e),this},a.default.prototype.cone=function(e,t,n,r,i){this._assert3d("cone"),a.default._validateParameters("cone",arguments),void 0===e&&(e=50),void 0===t&&(t=e),void 0===n&&(n=24),void 0===r&&(r=1),void 0===i&&(i=!0);var o="cone|".concat(n,"|").concat(r,"|").concat(i);if(!this._renderer.geometryInHash(o)){var u=new a.default.Geometry(n,r);s.call(u,1,0,1,n,r,i,!1),n<=24&&r<=16?u._makeTriangleEdges()._edgesToVertices():this._renderer._doStroke&&console.log("Cannot draw stroke on cone objects with more than 24 detailX or 16 detailY"),this._renderer.createBuffers(o,u)}return this._renderer.drawBuffersScaled(o,e,t,e),this},a.default.prototype.ellipsoid=function(e,t,n,r,i){this._assert3d("ellipsoid"),a.default._validateParameters("ellipsoid",arguments),void 0===e&&(e=50),void 0===t&&(t=e),void 0===n&&(n=e),void 0===r&&(r=24),void 0===i&&(i=16);var o="ellipsoid|".concat(r,"|").concat(i);if(!this._renderer.geometryInHash(o)){var s=new a.default.Geometry(r,i,(function(){for(var e=0;e<=this.detailY;e++)for(var t=e/this.detailY,n=Math.PI*t-Math.PI/2,r=Math.cos(n),i=Math.sin(n),o=0;o<=this.detailX;o++){var s=o/this.detailX,u=2*Math.PI*s,c=Math.cos(u),l=Math.sin(u),f=new a.default.Vector(r*l,i,r*c);this.vertices.push(f),this.vertexNormals.push(f),this.uvs.push(s,t)}}));s.computeFaces(),r<=24&&i<=24?s._makeTriangleEdges()._edgesToVertices():this._renderer._doStroke&&console.log("Cannot draw stroke on ellipsoids with more than 24 detailX or 24 detailY"),this._renderer.createBuffers(o,s)}return this._renderer.drawBuffersScaled(o,e,t,n),this},a.default.prototype.torus=function(e,t,n,r){if(this._assert3d("torus"),a.default._validateParameters("torus",arguments),void 0===e)e=50;else if(!e)return;if(void 0===t)t=10;else if(!t)return;void 0===n&&(n=24),void 0===r&&(r=16);var i=(t/e).toPrecision(4),o="torus|".concat(i,"|").concat(n,"|").concat(r);if(!this._renderer.geometryInHash(o)){var s=new a.default.Geometry(n,r,(function(){for(var e=0;e<=this.detailY;e++)for(var t=e/this.detailY,n=2*Math.PI*t,r=Math.cos(n),o=Math.sin(n),s=1+i*r,u=0;u<=this.detailX;u++){var c=u/this.detailX,l=2*Math.PI*c,f=Math.cos(l),d=Math.sin(l),h=new a.default.Vector(s*f,s*d,i*o),p=new a.default.Vector(r*f,r*d,o);this.vertices.push(h),this.vertexNormals.push(p),this.uvs.push(c,t)}}));s.computeFaces(),n<=24&&r<=16?s._makeTriangleEdges()._edgesToVertices():this._renderer._doStroke&&console.log("Cannot draw strokes on torus object with more than 24 detailX or 16 detailY"),this._renderer.createBuffers(o,s)}return this._renderer.drawBuffersScaled(o,e,e,e),this},a.default.RendererGL.prototype.point=function(e,t,n){void 0===n&&(n=0);var r=[];return r.push(new a.default.Vector(e,t,n)),this._drawPoints(r,this.immediateMode.buffers.point),this},a.default.RendererGL.prototype.triangle=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],s=e[5];if(!this.geometryInHash("tri")){var u=new a.default.Geometry(1,1,(function(){var e=[];e.push(new a.default.Vector(0,0,0)),e.push(new a.default.Vector(0,1,0)),e.push(new a.default.Vector(1,0,0)),this.strokeIndices=[[0,1],[1,2],[2,0]],this.vertices=e,this.faces=[[0,1,2]],this.uvs=[0,0,0,1,1,1]}));u._makeTriangleEdges()._edgesToVertices(),u.computeNormals(),this.createBuffers("tri",u)}var c=this.uMVMatrix.copy();try{var l=new a.default.Matrix([r-t,i-n,0,0,o-t,s-n,0,0,0,0,1,0,t,n,0,1]).mult(this.uMVMatrix);this.uMVMatrix=l,this.drawBuffers("tri")}finally{this.uMVMatrix=c}return this},a.default.RendererGL.prototype.ellipse=function(e){this.arc(e[0],e[1],e[2],e[3],0,o.TWO_PI,o.OPEN,e[4])},a.default.RendererGL.prototype.arc=function(e){var t,n,r=e,i=arguments[1],s=arguments[2],u=arguments[3],c=arguments[4],l=arguments[5],f=arguments[6],d=arguments[7]||25;if(n=Math.abs(l-c)>=o.TWO_PI?"".concat(t="ellipse","|").concat(d,"|"):"".concat(t="arc","|").concat(c,"|").concat(l,"|").concat(f,"|").concat(d,"|"),!this.geometryInHash(n)){var h=new a.default.Geometry(d,1,(function(){if(this.strokeIndices=[],c.toFixed(10)!==l.toFixed(10)){f!==o.PIE&&void 0!==f||(this.vertices.push(new a.default.Vector(.5,.5,0)),this.uvs.push([.5,.5]));for(var e=0;e<=d;e++){var t=e/d*(l-c)+c,n=.5+Math.cos(t)/2,r=.5+Math.sin(t)/2;this.vertices.push(new a.default.Vector(n,r,0)),this.uvs.push([n,r]),e<d-1&&(this.faces.push([0,e+1,e+2]),this.strokeIndices.push([e+1,e+2]))}switch(f){case o.PIE:this.faces.push([0,this.vertices.length-2,this.vertices.length-1]),this.strokeIndices.push([0,1]),this.strokeIndices.push([this.vertices.length-2,this.vertices.length-1]),this.strokeIndices.push([0,this.vertices.length-1]);break;case o.CHORD:this.strokeIndices.push([0,1]),this.strokeIndices.push([0,this.vertices.length-1]);break;case o.OPEN:this.strokeIndices.push([0,1]);break;default:this.faces.push([0,this.vertices.length-2,this.vertices.length-1]),this.strokeIndices.push([this.vertices.length-2,this.vertices.length-1])}}}));h.computeNormals(),d<=50?h._makeTriangleEdges()._edgesToVertices(h):this._doStroke&&console.log("Cannot apply a stroke to an ".concat(t," with more than 50 detail")),this.createBuffers(n,h)}var p=this.uMVMatrix.copy();try{this.uMVMatrix.translate([r,i,0]),this.uMVMatrix.scale(s,u,1),this.drawBuffers(n)}finally{this.uMVMatrix=p}return this},a.default.RendererGL.prototype.rect=function(e){var t=this._pInst._glAttributes.perPixelLighting,n=e[0],r=e[1],i=e[2],o=e[3],s=e[4]||(t?1:24),u=e[5]||(t?1:16),c="rect|".concat(s,"|").concat(u);if(!this.geometryInHash(c)){var l=new a.default.Geometry(s,u,(function(){for(var e=0;e<=this.detailY;e++)for(var t=e/this.detailY,n=0;n<=this.detailX;n++){var r=n/this.detailX,i=new a.default.Vector(r,t,0);this.vertices.push(i),this.uvs.push(r,t)}0<s&&0<u&&(this.strokeIndices=[[0,s],[s,(s+1)*(u+1)-1],[(s+1)*(u+1)-1,(s+1)*u],[(s+1)*u,0]])}));l.computeFaces().computeNormals()._makeTriangleEdges()._edgesToVertices(),this.createBuffers(c,l)}var f=this.uMVMatrix.copy();try{this.uMVMatrix.translate([n,r,0]),this.uMVMatrix.scale(i,o,1),this.drawBuffers(c)}finally{this.uMVMatrix=f}return this},a.default.RendererGL.prototype.quad=function(e,t,n,r,i,o,s,u,c,l,f,d,h,p){void 0===h&&(h=2),void 0===p&&(p=2);var m="quad|".concat(e,"|").concat(t,"|").concat(n,"|").concat(r,"|").concat(i,"|").concat(o,"|").concat(s,"|").concat(u,"|").concat(c,"|").concat(l,"|").concat(f,"|").concat(d,"|").concat(h,"|").concat(p);if(!this.geometryInHash(m)){var v=new a.default.Geometry(h,p,(function(){for(var h=1/(this.detailX-1),p=1/(this.detailY-1),m=0;m<this.detailY;m++)for(var v=0;v<this.detailX;v++){var g=v*h,y=m*p,b=(1-g)*((1-y)*e+y*l)+g*((1-y)*r+y*s),x=(1-g)*((1-y)*t+y*f)+g*((1-y)*i+y*u),w=(1-g)*((1-y)*n+y*d)+g*((1-y)*o+y*c);this.vertices.push(new a.default.Vector(b,x,w)),this.uvs.push([g,y])}}));v.faces=[];for(var g=0;g<p-1;g++)for(var y=0;y<h-1;y++){var b=y+g*h,x=y+1+g*h,w=y+1+(g+1)*h,_=y+(g+1)*h;v.faces.push([b,x,w]),v.faces.push([b,w,_])}v.computeNormals()._makeTriangleEdges()._edgesToVertices(),this.createBuffers(m,v)}return this.drawBuffers(m),this},a.default.RendererGL.prototype.bezier=function(e,t,n,r,i,a,o,s,u,c,l,f){8===arguments.length&&(l=s,c=o,s=a,o=i,i=r,r=n,n=a=u=f=0);var d=this._pInst._bezierDetail||20;this.beginShape();for(var h=0;h<=d;h++){var p=Math.pow(1-h/d,3),m=h/d*3*Math.pow(1-h/d,2),v=3*Math.pow(h/d,2)*(1-h/d),g=Math.pow(h/d,3);this.vertex(e*p+r*m+o*v+c*g,t*p+i*m+s*v+l*g,n*p+a*m+u*v+f*g)}return this.endShape(),this},a.default.RendererGL.prototype.curve=function(e,t,n,r,i,a,o,s,u,c,l,f){8===arguments.length&&(c=o,l=s,o=i,s=r,i=r=n,n=a=u=f=0);var d=this._pInst._curveDetail;this.beginShape();for(var h=0;h<=d;h++){var p=.5*Math.pow(h/d,3),m=.5*Math.pow(h/d,2),v=h/d*.5,g=p*(3*r-e-3*o+c)+m*(2*e-5*r+4*o-c)+v*(-e+o)+2*r*.5,y=p*(3*i-t-3*s+l)+m*(2*t-5*i+4*s-l)+v*(-t+s)+2*i*.5,b=p*(3*a-n-3*u+f)+m*(2*n-5*a+4*u-f)+v*(-n+u)+2*a*.5;this.vertex(g,y,b)}return this.endShape(),this},a.default.RendererGL.prototype.line=function(){return 6===arguments.length?(this.beginShape(o.LINES),this.vertex(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2]),this.vertex(arguments.length<=3?void 0:arguments[3],arguments.length<=4?void 0:arguments[4],arguments.length<=5?void 0:arguments[5]),this.endShape()):4===arguments.length&&(this.beginShape(o.LINES),this.vertex(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],0),this.vertex(arguments.length<=2?void 0:arguments[2],arguments.length<=3?void 0:arguments[3],0),this.endShape()),this},a.default.RendererGL.prototype.bezierVertex=function(){if(0===this.immediateMode._bezierVertex.length)throw Error("vertex() must be used once before calling bezierVertex()");var e,t,n,r,i,a=[],o=[],s=[],u=arguments.length;if((e=0)===this._lookUpTableBezier.length||this._lutBezierDetail!==this._pInst._curveDetail){this._lookUpTableBezier=[],this._lutBezierDetail=this._pInst._curveDetail;for(var c=1/this._lutBezierDetail,l=0,f=1,d=0;l<1;){if(e=parseFloat(l.toFixed(6)),this._lookUpTableBezier[d]=this._bezierCoefficients(e),f.toFixed(6)===c.toFixed(6)){e=parseFloat(f.toFixed(6))+parseFloat(l.toFixed(6)),++d,this._lookUpTableBezier[d]=this._bezierCoefficients(e);break}l+=c,f-=c,++d}}var h=this._lookUpTableBezier.length;if(6===u){for(this.isBezier=!0,a=[this.immediateMode._bezierVertex[0],arguments.length<=0?void 0:arguments[0],arguments.length<=2?void 0:arguments[2],arguments.length<=4?void 0:arguments[4]],o=[this.immediateMode._bezierVertex[1],arguments.length<=1?void 0:arguments[1],arguments.length<=3?void 0:arguments[3],arguments.length<=5?void 0:arguments[5]],i=0;i<h;i++)t=a[0]*this._lookUpTableBezier[i][0]+a[1]*this._lookUpTableBezier[i][1]+a[2]*this._lookUpTableBezier[i][2]+a[3]*this._lookUpTableBezier[i][3],n=o[0]*this._lookUpTableBezier[i][0]+o[1]*this._lookUpTableBezier[i][1]+o[2]*this._lookUpTableBezier[i][2]+o[3]*this._lookUpTableBezier[i][3],this.vertex(t,n);this.immediateMode._bezierVertex[0]=arguments.length<=4?void 0:arguments[4],this.immediateMode._bezierVertex[1]=arguments.length<=5?void 0:arguments[5]}else if(9===u){for(this.isBezier=!0,a=[this.immediateMode._bezierVertex[0],arguments.length<=0?void 0:arguments[0],arguments.length<=3?void 0:arguments[3],arguments.length<=6?void 0:arguments[6]],o=[this.immediateMode._bezierVertex[1],arguments.length<=1?void 0:arguments[1],arguments.length<=4?void 0:arguments[4],arguments.length<=7?void 0:arguments[7]],s=[this.immediateMode._bezierVertex[2],arguments.length<=2?void 0:arguments[2],arguments.length<=5?void 0:arguments[5],arguments.length<=8?void 0:arguments[8]],i=0;i<h;i++)t=a[0]*this._lookUpTableBezier[i][0]+a[1]*this._lookUpTableBezier[i][1]+a[2]*this._lookUpTableBezier[i][2]+a[3]*this._lookUpTableBezier[i][3],n=o[0]*this._lookUpTableBezier[i][0]+o[1]*this._lookUpTableBezier[i][1]+o[2]*this._lookUpTableBezier[i][2]+o[3]*this._lookUpTableBezier[i][3],r=s[0]*this._lookUpTableBezier[i][0]+s[1]*this._lookUpTableBezier[i][1]+s[2]*this._lookUpTableBezier[i][2]+s[3]*this._lookUpTableBezier[i][3],this.vertex(t,n,r);this.immediateMode._bezierVertex[0]=arguments.length<=6?void 0:arguments[6],this.immediateMode._bezierVertex[1]=arguments.length<=7?void 0:arguments[7],this.immediateMode._bezierVertex[2]=arguments.length<=8?void 0:arguments[8]}},a.default.RendererGL.prototype.quadraticVertex=function(){if(0===this.immediateMode._quadraticVertex.length)throw Error("vertex() must be used once before calling quadraticVertex()");var e,t,n,r,i,a=[],o=[],s=[],u=arguments.length;if((e=0)===this._lookUpTableQuadratic.length||this._lutQuadraticDetail!==this._pInst._curveDetail){this._lookUpTableQuadratic=[],this._lutQuadraticDetail=this._pInst._curveDetail;for(var c=1/this._lutQuadraticDetail,l=0,f=1,d=0;l<1;){if(e=parseFloat(l.toFixed(6)),this._lookUpTableQuadratic[d]=this._quadraticCoefficients(e),f.toFixed(6)===c.toFixed(6)){e=parseFloat(f.toFixed(6))+parseFloat(l.toFixed(6)),++d,this._lookUpTableQuadratic[d]=this._quadraticCoefficients(e);break}l+=c,f-=c,++d}}var h=this._lookUpTableQuadratic.length;if(4===u){for(this.isQuadratic=!0,a=[this.immediateMode._quadraticVertex[0],arguments.length<=0?void 0:arguments[0],arguments.length<=2?void 0:arguments[2]],o=[this.immediateMode._quadraticVertex[1],arguments.length<=1?void 0:arguments[1],arguments.length<=3?void 0:arguments[3]],i=0;i<h;i++)t=a[0]*this._lookUpTableQuadratic[i][0]+a[1]*this._lookUpTableQuadratic[i][1]+a[2]*this._lookUpTableQuadratic[i][2],n=o[0]*this._lookUpTableQuadratic[i][0]+o[1]*this._lookUpTableQuadratic[i][1]+o[2]*this._lookUpTableQuadratic[i][2],this.vertex(t,n);this.immediateMode._quadraticVertex[0]=arguments.length<=2?void 0:arguments[2],this.immediateMode._quadraticVertex[1]=arguments.length<=3?void 0:arguments[3]}else if(6===u){for(this.isQuadratic=!0,a=[this.immediateMode._quadraticVertex[0],arguments.length<=0?void 0:arguments[0],arguments.length<=3?void 0:arguments[3]],o=[this.immediateMode._quadraticVertex[1],arguments.length<=1?void 0:arguments[1],arguments.length<=4?void 0:arguments[4]],s=[this.immediateMode._quadraticVertex[2],arguments.length<=2?void 0:arguments[2],arguments.length<=5?void 0:arguments[5]],i=0;i<h;i++)t=a[0]*this._lookUpTableQuadratic[i][0]+a[1]*this._lookUpTableQuadratic[i][1]+a[2]*this._lookUpTableQuadratic[i][2],n=o[0]*this._lookUpTableQuadratic[i][0]+o[1]*this._lookUpTableQuadratic[i][1]+o[2]*this._lookUpTableQuadratic[i][2],r=s[0]*this._lookUpTableQuadratic[i][0]+s[1]*this._lookUpTableQuadratic[i][1]+s[2]*this._lookUpTableQuadratic[i][2],this.vertex(t,n,r);this.immediateMode._quadraticVertex[0]=arguments.length<=3?void 0:arguments[3],this.immediateMode._quadraticVertex[1]=arguments.length<=4?void 0:arguments[4],this.immediateMode._quadraticVertex[2]=arguments.length<=5?void 0:arguments[5]}},a.default.RendererGL.prototype.curveVertex=function(){var e,t,n,r,i,a=[],o=[],s=[],u=arguments.length;if((e=0)===this._lookUpTableBezier.length||this._lutBezierDetail!==this._pInst._curveDetail){this._lookUpTableBezier=[],this._lutBezierDetail=this._pInst._curveDetail;for(var c=1/this._lutBezierDetail,l=0,f=1,d=0;l<1;){if(e=parseFloat(l.toFixed(6)),this._lookUpTableBezier[d]=this._bezierCoefficients(e),f.toFixed(6)===c.toFixed(6)){e=parseFloat(f.toFixed(6))+parseFloat(l.toFixed(6)),++d,this._lookUpTableBezier[d]=this._bezierCoefficients(e);break}l+=c,f-=c,++d}}var h=this._lookUpTableBezier.length;if(2===u){if(this.immediateMode._curveVertex.push(arguments.length<=0?void 0:arguments[0]),this.immediateMode._curveVertex.push(arguments.length<=1?void 0:arguments[1]),8===this.immediateMode._curveVertex.length){for(this.isCurve=!0,a=this._bezierToCatmull([this.immediateMode._curveVertex[0],this.immediateMode._curveVertex[2],this.immediateMode._curveVertex[4],this.immediateMode._curveVertex[6]]),o=this._bezierToCatmull([this.immediateMode._curveVertex[1],this.immediateMode._curveVertex[3],this.immediateMode._curveVertex[5],this.immediateMode._curveVertex[7]]),i=0;i<h;i++)t=a[0]*this._lookUpTableBezier[i][0]+a[1]*this._lookUpTableBezier[i][1]+a[2]*this._lookUpTableBezier[i][2]+a[3]*this._lookUpTableBezier[i][3],n=o[0]*this._lookUpTableBezier[i][0]+o[1]*this._lookUpTableBezier[i][1]+o[2]*this._lookUpTableBezier[i][2]+o[3]*this._lookUpTableBezier[i][3],this.vertex(t,n);for(i=0;i<u;i++)this.immediateMode._curveVertex.shift()}}else if(3===u&&(this.immediateMode._curveVertex.push(arguments.length<=0?void 0:arguments[0]),this.immediateMode._curveVertex.push(arguments.length<=1?void 0:arguments[1]),this.immediateMode._curveVertex.push(arguments.length<=2?void 0:arguments[2]),12===this.immediateMode._curveVertex.length)){for(this.isCurve=!0,a=this._bezierToCatmull([this.immediateMode._curveVertex[0],this.immediateMode._curveVertex[3],this.immediateMode._curveVertex[6],this.immediateMode._curveVertex[9]]),o=this._bezierToCatmull([this.immediateMode._curveVertex[1],this.immediateMode._curveVertex[4],this.immediateMode._curveVertex[7],this.immediateMode._curveVertex[10]]),s=this._bezierToCatmull([this.immediateMode._curveVertex[2],this.immediateMode._curveVertex[5],this.immediateMode._curveVertex[8],this.immediateMode._curveVertex[11]]),i=0;i<h;i++)t=a[0]*this._lookUpTableBezier[i][0]+a[1]*this._lookUpTableBezier[i][1]+a[2]*this._lookUpTableBezier[i][2]+a[3]*this._lookUpTableBezier[i][3],n=o[0]*this._lookUpTableBezier[i][0]+o[1]*this._lookUpTableBezier[i][1]+o[2]*this._lookUpTableBezier[i][2]+o[3]*this._lookUpTableBezier[i][3],r=s[0]*this._lookUpTableBezier[i][0]+s[1]*this._lookUpTableBezier[i][1]+s[2]*this._lookUpTableBezier[i][2]+s[3]*this._lookUpTableBezier[i][3],this.vertex(t,n,r);for(i=0;i<u;i++)this.immediateMode._curveVertex.shift()}},a.default.RendererGL.prototype.image=function(e,t,n,r,i,a,s,u,c){this._isErasing&&this.blendMode(this._cachedBlendMode),this._pInst.push(),this._pInst.noLights(),this._pInst.texture(e),this._pInst.textureMode(o.NORMAL);var l=0;t<=e.width&&(l=t/e.width);var f=1;t+r<=e.width&&(f=(t+r)/e.width);var d=0;n<=e.height&&(d=n/e.height);var h=1;n+i<=e.height&&(h=(n+i)/e.height),this.beginShape(),this.vertex(a,s,0,l,d),this.vertex(a+u,s,0,f,d),this.vertex(a+u,s+c,0,f,h),this.vertex(a,s+c,0,l,h),this.endShape(o.CLOSE),this._pInst.pop(),this._isErasing&&this.blendMode(o.REMOVE)};var u=a.default;n.default=u},{"../core/constants":250,"../core/main":260,"./p5.Geometry":309,"core-js/modules/es.array.concat":148,"core-js/modules/es.number.to-fixed":169}],304:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e("core-js/modules/es.array.splice"),e("core-js/modules/es.object.to-string"),e("core-js/modules/es.regexp.to-string"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i,a=(i=e("../core/main"))&&i.__esModule?i:{default:i},o=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var t="function"!=typeof WeakMap?null:new WeakMap;if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,t&&t.set(e,n),n}(e("../core/constants"));a.default.prototype.orbitControl=function(e,t,n){if(this._assert3d("orbitControl"),a.default._validateParameters("orbitControl",arguments),this.mouseX<this.width&&0<this.mouseX&&this.mouseY<this.height&&0<this.mouseY){var r=this._renderer._curCamera;void 0===e&&(e=1),void 0===t&&(t=e),void 0===n&&(n=.5),!0!==this.contextMenuDisabled&&(this.canvas.oncontextmenu=function(){return!1},this._setProperty("contextMenuDisabled",!0)),!0!==this.wheelDefaultDisabled&&(this.canvas.onwheel=function(){return!1},this._setProperty("wheelDefaultDisabled",!0));var i=this.height<this.width?this.height:this.width;if(this._mouseWheelDeltaY!==this._pmouseWheelDeltaY&&(0<this._mouseWheelDeltaY?this._renderer._curCamera._orbit(0,0,n*i):this._renderer._curCamera._orbit(0,0,-n*i)),this.mouseIsPressed)if(this.mouseButton===this.LEFT){var o=-e*(this.mouseX-this.pmouseX)/i,s=t*(this.mouseY-this.pmouseY)/i;this._renderer._curCamera._orbit(o,s,0)}else if(this.mouseButton===this.RIGHT){var u=r._getLocalAxes(),c=Math.sqrt(u.x[0]*u.x[0]+u.x[2]*u.x[2]);0!==c&&(u.x[0]/=c,u.x[2]/=c);var l=Math.sqrt(u.y[0]*u.y[0]+u.y[2]*u.y[2]);0!==l&&(u.y[0]/=l,u.y[2]/=l);var f=-1*e*(this.mouseX-this.pmouseX),d=-1*t*(this.mouseY-this.pmouseY);r.setPosition(r.eyeX+f*u.x[0]+d*u.z[0],r.eyeY,r.eyeZ+f*u.x[2]+d*u.z[2])}return this}},a.default.prototype.debugMode=function(){this._assert3d("debugMode");for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];a.default._validateParameters("debugMode",t);for(var r=this._registeredMethods.post.length-1;0<=r;r--)this._registeredMethods.post[r].toString()!==this._grid().toString()&&this._registeredMethods.post[r].toString()!==this._axesIcon().toString()||this._registeredMethods.post.splice(r,1);t[0]===o.GRID?this.registerMethod("post",this._grid.call(this,t[1],t[2],t[3],t[4],t[5])):t[0]===o.AXES?this.registerMethod("post",this._axesIcon.call(this,t[1],t[2],t[3],t[4])):(this.registerMethod("post",this._grid.call(this,t[0],t[1],t[2],t[3],t[4])),this.registerMethod("post",this._axesIcon.call(this,t[5],t[6],t[7],t[8])))},a.default.prototype.noDebugMode=function(){this._assert3d("noDebugMode");for(var e=this._registeredMethods.post.length-1;0<=e;e--)this._registeredMethods.post[e].toString()!==this._grid().toString()&&this._registeredMethods.post[e].toString()!==this._axesIcon().toString()||this._registeredMethods.post.splice(e,1)},a.default.prototype._grid=function(e,t,n,r,i){void 0===e&&(e=this.width/2),void 0===t&&(t=Math.round(e/30)<4?4:Math.round(e/30)),void 0===n&&(n=0),void 0===r&&(r=0),void 0===i&&(i=0);var a=e/t,o=e/2;return function(){this.push(),this.stroke(255*this._renderer.curStrokeColor[0],255*this._renderer.curStrokeColor[1],255*this._renderer.curStrokeColor[2]),this._renderer.uMVMatrix.set(this._renderer._curCamera.cameraMatrix.mat4[0],this._renderer._curCamera.cameraMatrix.mat4[1],this._renderer._curCamera.cameraMatrix.mat4[2],this._renderer._curCamera.cameraMatrix.mat4[3],this._renderer._curCamera.cameraMatrix.mat4[4],this._renderer._curCamera.cameraMatrix.mat4[5],this._renderer._curCamera.cameraMatrix.mat4[6],this._renderer._curCamera.cameraMatrix.mat4[7],this._renderer._curCamera.cameraMatrix.mat4[8],this._renderer._curCamera.cameraMatrix.mat4[9],this._renderer._curCamera.cameraMatrix.mat4[10],this._renderer._curCamera.cameraMatrix.mat4[11],this._renderer._curCamera.cameraMatrix.mat4[12],this._renderer._curCamera.cameraMatrix.mat4[13],this._renderer._curCamera.cameraMatrix.mat4[14],this._renderer._curCamera.cameraMatrix.mat4[15]);for(var e=0;e<=t;e++)this.beginShape(this.LINES),this.vertex(-o+n,r,e*a-o+i),this.vertex(+o+n,r,e*a-o+i),this.endShape();for(var s=0;s<=t;s++)this.beginShape(this.LINES),this.vertex(s*a-o+n,r,-o+i),this.vertex(s*a-o+n,r,+o+i),this.endShape();this.pop()}},a.default.prototype._axesIcon=function(e,t,n,r){return void 0===e&&(e=40<this.width/20?this.width/20:40),void 0===t&&(t=-this.width/4),void 0===n&&(n=t),void 0===r&&(r=t),function(){this.push(),this._renderer.uMVMatrix.set(this._renderer._curCamera.cameraMatrix.mat4[0],this._renderer._curCamera.cameraMatrix.mat4[1],this._renderer._curCamera.cameraMatrix.mat4[2],this._renderer._curCamera.cameraMatrix.mat4[3],this._renderer._curCamera.cameraMatrix.mat4[4],this._renderer._curCamera.cameraMatrix.mat4[5],this._renderer._curCamera.cameraMatrix.mat4[6],this._renderer._curCamera.cameraMatrix.mat4[7],this._renderer._curCamera.cameraMatrix.mat4[8],this._renderer._curCamera.cameraMatrix.mat4[9],this._renderer._curCamera.cameraMatrix.mat4[10],this._renderer._curCamera.cameraMatrix.mat4[11],this._renderer._curCamera.cameraMatrix.mat4[12],this._renderer._curCamera.cameraMatrix.mat4[13],this._renderer._curCamera.cameraMatrix.mat4[14],this._renderer._curCamera.cameraMatrix.mat4[15]),this.strokeWeight(2),this.stroke(255,0,0),this.beginShape(this.LINES),this.vertex(t,n,r),this.vertex(t+e,n,r),this.endShape(),this.stroke(0,255,0),this.beginShape(this.LINES),this.vertex(t,n,r),this.vertex(t,n+e,r),this.endShape(),this.stroke(0,0,255),this.beginShape(this.LINES),this.vertex(t,n,r),this.vertex(t,n,r+e),this.endShape(),this.pop()}};var s=a.default;n.default=s},{"../core/constants":250,"../core/main":260,"core-js/modules/es.array.splice":162,"core-js/modules/es.object.to-string":174,"core-js/modules/es.regexp.to-string":179}],305:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i,a=(i=e("../core/main"))&&i.__esModule?i:{default:i},o=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var t="function"!=typeof WeakMap?null:new WeakMap;if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,t&&t.set(e,n),n}(e("../core/constants"));a.default.prototype.ambientLight=function(e,t,n,r){this._assert3d("ambientLight"),a.default._validateParameters("ambientLight",arguments);var i=this.color.apply(this,arguments);return this._renderer.ambientLightColors.push(i._array[0],i._array[1],i._array[2]),this._renderer._enableLighting=!0,this},a.default.prototype.specularColor=function(e,t,n){this._assert3d("specularColor"),a.default._validateParameters("specularColor",arguments);var r=this.color.apply(this,arguments);return this._renderer.specularColors=[r._array[0],r._array[1],r._array[2]],this},a.default.prototype.directionalLight=function(e,t,n,r,i,o){var s,u,c,l;this._assert3d("directionalLight"),a.default._validateParameters("directionalLight",arguments),s=e instanceof a.default.Color?e:this.color(e,t,n);var f=arguments[arguments.length-1];l="number"==typeof f?(u=arguments[arguments.length-3],c=arguments[arguments.length-2],arguments[arguments.length-1]):(u=f.x,c=f.y,f.z);var d=Math.sqrt(u*u+c*c+l*l);return this._renderer.directionalLightDirections.push(u/d,c/d,l/d),this._renderer.directionalLightDiffuseColors.push(s._array[0],s._array[1],s._array[2]),Array.prototype.push.apply(this._renderer.directionalLightSpecularColors,this._renderer.specularColors),this._renderer._enableLighting=!0,this},a.default.prototype.pointLight=function(e,t,n,r,i,o){var s,u,c,l;this._assert3d("pointLight"),a.default._validateParameters("pointLight",arguments),s=e instanceof a.default.Color?e:this.color(e,t,n);var f=arguments[arguments.length-1];return l="number"==typeof f?(u=arguments[arguments.length-3],c=arguments[arguments.length-2],arguments[arguments.length-1]):(u=f.x,c=f.y,f.z),this._renderer.pointLightPositions.push(u,c,l),this._renderer.pointLightDiffuseColors.push(s._array[0],s._array[1],s._array[2]),Array.prototype.push.apply(this._renderer.pointLightSpecularColors,this._renderer.specularColors),this._renderer._enableLighting=!0,this},a.default.prototype.lights=function(){if(this._assert3d("lights"),this._colorMode===o.RGB)this.ambientLight(128,128,128),this.directionalLight(128,128,128,0,0,-1);else{var e=this._colorMaxes[this._colorMode][2];this.ambientLight(0,0,e),this.directionalLight(0,0,e,0,0,-1)}return this},a.default.prototype.lightFalloff=function(e,t,n){return this._assert3d("lightFalloff"),a.default._validateParameters("lightFalloff",arguments),e<0&&(e=0,console.warn("Value of constant argument in lightFalloff() should be never be negative. Set to 0.")),t<0&&(t=0,console.warn("Value of linear argument in lightFalloff() should be never be negative. Set to 0.")),n<0&&(n=0,console.warn("Value of quadratic argument in lightFalloff() should be never be negative. Set to 0.")),0===e&&0===t&&0===n&&(e=1,console.warn("Either one of the three arguments in lightFalloff() should be greater than zero. Set constant argument to 1.")),this._renderer.constantAttenuation=e,this._renderer.linearAttenuation=t,this._renderer.quadraticAttenuation=n,this},a.default.prototype.spotLight=function(e,t,n,r,i,o,s,u,c,l,f){var d,h,p;this._assert3d("spotLight"),a.default._validateParameters("spotLight",arguments);var m=arguments.length;switch(m){case 11:case 10:d=this.color(e,t,n),h=new a.default.Vector(r,i,o),p=new a.default.Vector(s,u,c);break;case 9:e instanceof a.default.Color?(d=e,h=new a.default.Vector(t,n,r),p=new a.default.Vector(i,o,s),l=u,f=c):r instanceof a.default.Vector?(d=this.color(e,t,n),h=r,p=new a.default.Vector(i,o,s),l=u,f=c):s instanceof a.default.Vector?(d=this.color(e,t,n),h=new a.default.Vector(r,i,o),p=s,l=u,f=c):(d=this.color(e,t,n),h=new a.default.Vector(r,i,o),p=new a.default.Vector(s,u,c));break;case 8:p=e instanceof a.default.Color?(d=e,h=new a.default.Vector(t,n,r),new a.default.Vector(i,o,s)):r instanceof a.default.Vector?(d=this.color(e,t,n),h=r,new a.default.Vector(i,o,s)):(d=this.color(e,t,n),h=new a.default.Vector(r,i,o),s),l=u;break;case 7:e instanceof a.default.Color&&t instanceof a.default.Vector?(d=e,h=t,p=new a.default.Vector(n,r,i),l=o,f=s):e instanceof a.default.Color&&i instanceof a.default.Vector?(d=e,h=new a.default.Vector(t,n,r),p=i,l=o,f=s):r instanceof a.default.Vector&&i instanceof a.default.Vector?(d=this.color(e,t,n),h=r,p=i,l=o,f=s):p=e instanceof a.default.Color?(d=e,h=new a.default.Vector(t,n,r),new a.default.Vector(i,o,s)):r instanceof a.default.Vector?(d=this.color(e,t,n),h=r,new a.default.Vector(i,o,s)):(d=this.color(e,t,n),h=new a.default.Vector(r,i,o),s);break;case 6:r instanceof a.default.Vector&&i instanceof a.default.Vector?(d=this.color(e,t,n),h=r,p=i,l=o):e instanceof a.default.Color&&i instanceof a.default.Vector?(d=e,h=new a.default.Vector(t,n,r),p=i,l=o):e instanceof a.default.Color&&t instanceof a.default.Vector&&(d=e,h=t,p=new a.default.Vector(n,r,i),l=o);break;case 5:e instanceof a.default.Color&&t instanceof a.default.Vector&&n instanceof a.default.Vector?(d=e,h=t,p=n,l=r,f=i):r instanceof a.default.Vector&&i instanceof a.default.Vector?(d=this.color(e,t,n),h=r,p=i):e instanceof a.default.Color&&i instanceof a.default.Vector?(d=e,h=new a.default.Vector(t,n,r),p=i):e instanceof a.default.Color&&t instanceof a.default.Vector&&(d=e,h=t,p=new a.default.Vector(n,r,i));break;case 4:d=e,h=t,p=n,l=r;break;case 3:d=e,h=t,p=n;break;default:return console.warn("Sorry, input for spotlight() is not in prescribed format. Too ".concat(m<3?"few":"many"," arguments were provided")),this}return this._renderer.spotLightDiffuseColors.push(d._array[0],d._array[1],d._array[2]),Array.prototype.push.apply(this._renderer.spotLightSpecularColors,this._renderer.specularColors),this._renderer.spotLightPositions.push(h.x,h.y,h.z),p.normalize(),this._renderer.spotLightDirections.push(p.x,p.y,p.z),void 0===l&&(l=Math.PI/3),void 0!==f&&f<1?(f=1,console.warn("Value of concentration needs to be greater than 1. Setting it to 1")):void 0===f&&(f=100),l=this._renderer._pInst._toRadians(l),this._renderer.spotLightAngle.push(Math.cos(l)),this._renderer.spotLightConc.push(f),this._renderer._enableLighting=!0,this},a.default.prototype.noLights=function(){return this._assert3d("noLights"),a.default._validateParameters("noLights",arguments),this._renderer._enableLighting=!1,this._renderer.ambientLightColors.length=0,this._renderer.specularColors=[1,1,1],this._renderer.directionalLightDirections.length=0,this._renderer.directionalLightDiffuseColors.length=0,this._renderer.directionalLightSpecularColors.length=0,this._renderer.pointLightPositions.length=0,this._renderer.pointLightDiffuseColors.length=0,this._renderer.pointLightSpecularColors.length=0,this._renderer.spotLightPositions.length=0,this._renderer.spotLightDirections.length=0,this._renderer.spotLightDiffuseColors.length=0,this._renderer.spotLightSpecularColors.length=0,this._renderer.spotLightAngle.length=0,this._renderer.spotLightConc.length=0,this._renderer.constantAttenuation=1,this._renderer.linearAttenuation=0,this._renderer.quadraticAttenuation=0,this._renderer._useShininess=1,this};var s=a.default;n.default=s},{"../core/constants":250,"../core/main":260}],306:[function(e,t,n){"use strict";e("core-js/modules/es.array.concat"),e("core-js/modules/es.array.index-of"),e("core-js/modules/es.array.slice"),e("core-js/modules/es.array.splice"),e("core-js/modules/es.object.to-string"),e("core-js/modules/es.regexp.exec"),e("core-js/modules/es.string.match"),e("core-js/modules/es.string.split"),e("core-js/modules/es.string.trim"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=(r=e("../core/main"))&&r.__esModule?r:{default:r};function a(e,t,n){for(var r=0,i=e.length;r<i;r++)if(e[r]!==t.getUint8(n+r,!1))return!1;return!0}e("./p5.Geometry"),i.default.prototype.loadModel=function(e){var t,n,r;i.default._validateParameters("loadModel",arguments);var o=e.slice(-4);"boolean"==typeof arguments[1]?(t=arguments[1],n=arguments[2],r=arguments[3],void 0!==arguments[4]&&(o=arguments[4])):(t=!1,n=arguments[1],r=arguments[2],void 0!==arguments[3]&&(o=arguments[3]));var s=new i.default.Geometry;s.gid="".concat(e,"|").concat(t);var u=this;return o.match(/\.stl$/i)?this.httpDo(e,"GET","arrayBuffer",(function(e){!function(e,t){if(function(e){for(var t=new DataView(e),n=[115,111,108,105,100],r=0;r<5;r++)if(a(n,t,r))return!1;return!0}(t))!function(e,t){for(var n,r,a,o,s,u,c,l=new DataView(t),f=l.getUint32(80,!0),d=!1,h=0;h<70;h++)1129270351===l.getUint32(h,!1)&&82===l.getUint8(h+4)&&61===l.getUint8(h+5)&&(d=!0,o=[],s=l.getUint8(h+6)/255,u=l.getUint8(h+7)/255,c=l.getUint8(h+8)/255);for(var p=0;p<f;p++){var m=84+50*p,v=l.getFloat32(m,!0),g=l.getFloat32(4+m,!0),y=l.getFloat32(8+m,!0);if(d){var b=l.getUint16(48+m,!0);a=0==(32768&b)?(n=(31&b)/31,r=(b>>5&31)/31,(b>>10&31)/31):(n=s,r=u,c)}for(var x=new i.default.Vector(v,g,y),w=1;w<=3;w++){var _=m+12*w,k=new i.default.Vector(l.getFloat32(_,!0),l.getFloat32(4+_,!0),l.getFloat32(8+_,!0));e.vertices.push(k),e.vertexNormals.push(x),d&&o.push(n,r,a)}e.faces.push([3*p,3*p+1,3*p+2]),e.uvs.push([0,0],[0,0],[0,0])}}(e,t);else{var n=new DataView(t);if(!("TextDecoder"in window))return console.warn("Sorry, ASCII STL loading only works in browsers that support TextDecoder (https://caniuse.com/#feat=textencoder)");!function(e,t){for(var n,r,a="",o=[],s=0;s<t.length;++s){for(var u=t[s].trim(),c=u.split(" "),l=0;l<c.length;++l)""===c[l]&&c.splice(l,1);if(0!==c.length)switch(a){case"":if("solid"!==c[0])return console.error(u),console.error('Invalid state "'.concat(c[0],'", should be "solid"'));a="solid";break;case"solid":if("facet"!==c[0]||"normal"!==c[1])return console.error(u),console.error('Invalid state "'.concat(c[0],'", should be "facet normal"'));n=new i.default.Vector(parseFloat(c[2]),parseFloat(c[3]),parseFloat(c[4])),e.vertexNormals.push(n,n,n),a="facet normal";break;case"facet normal":if("outer"!==c[0]||"loop"!==c[1])return console.error(u),console.error('Invalid state "'.concat(c[0],'", should be "outer loop"'));a="vertex";break;case"vertex":if("vertex"===c[0])r=new i.default.Vector(parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3])),e.vertices.push(r),e.uvs.push([0,0]),o.push(e.vertices.indexOf(r));else{if("endloop"!==c[0])return console.error(u),console.error('Invalid state "'.concat(c[0],'", should be "vertex" or "endloop"'));e.faces.push(o),o=[],a="endloop"}break;case"endloop":if("endfacet"!==c[0])return console.error(u),console.error('Invalid state "'.concat(c[0],'", should be "endfacet"'));a="endfacet";break;case"endfacet":if("endsolid"!==c[0]){if("facet"!==c[0]||"normal"!==c[1])return console.error(u),console.error('Invalid state "'.concat(c[0],'", should be "endsolid" or "facet normal"'));n=new i.default.Vector(parseFloat(c[2]),parseFloat(c[3]),parseFloat(c[4])),e.vertexNormals.push(n,n,n),a="facet normal"}break;default:console.error('Invalid state "'.concat(a,'"'))}}}(e,new TextDecoder("utf-8").decode(n).split("\n"))}}(s,e),t&&s.normalize(),u._decrementPreload(),"function"==typeof n&&n(s)}),r):o.match(/\.obj$/i)?this.loadStrings(e,(function(e){!function(e,t){for(var n={v:[],vt:[],vn:[]},r={},a=0;a<t.length;++a){var o=t[a].trim().split(/\b\s+/);if(0<o.length)if("v"===o[0]||"vn"===o[0]){var s=new i.default.Vector(parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3]));n[o[0]].push(s)}else if("vt"===o[0]){var u=[parseFloat(o[1]),1-parseFloat(o[2])];n[o[0]].push(u)}else if("f"===o[0])for(var c=3;c<o.length;++c){for(var l=[],f=[1,c-1,c],d=0;d<f.length;++d){var h=o[f[d]],p=0;if(void 0!==r[h])p=r[h];else{for(var m=h.split("/"),v=0;v<m.length;v++)m[v]=parseInt(m[v])-1;p=r[h]=e.vertices.length,e.vertices.push(n.v[m[0]].copy()),n.vt[m[1]]?e.uvs.push(n.vt[m[1]].slice()):e.uvs.push([0,0]),n.vn[m[2]]&&e.vertexNormals.push(n.vn[m[2]].copy())}l.push(p)}l[0]!==l[1]&&l[0]!==l[2]&&l[1]!==l[2]&&e.faces.push(l)}}0===e.vertexNormals.length&&e.computeNormals()}(s,e),t&&s.normalize(),u._decrementPreload(),"function"==typeof n&&n(s)}),r):(i.default._friendlyFileLoadError(3,e),r?r():console.error("Sorry, the file type is invalid. Only OBJ and STL files are supported.")),s},i.default.prototype.model=function(e){this._assert3d("model"),i.default._validateParameters("model",arguments),0<e.vertices.length&&(this._renderer.geometryInHash(e.gid)||(e._makeTriangleEdges()._edgesToVertices(),this._renderer.createBuffers(e.gid,e)),this._renderer.drawBuffers(e.gid))};var o=i.default;n.default=o},{"../core/main":260,"./p5.Geometry":309,"core-js/modules/es.array.concat":148,"core-js/modules/es.array.index-of":155,"core-js/modules/es.array.slice":160,"core-js/modules/es.array.splice":162,"core-js/modules/es.object.to-string":174,"core-js/modules/es.regexp.exec":178,"core-js/modules/es.string.match":184,"core-js/modules/es.string.split":188,"core-js/modules/es.string.trim":190}],307:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e("core-js/modules/es.array.join"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i,a=(i=e("../core/main"))&&i.__esModule?i:{default:i},o=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var t="function"!=typeof WeakMap?null:new WeakMap;if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,t&&t.set(e,n),n}(e("../core/constants"));e("./p5.Texture"),a.default.prototype.loadShader=function(e,t,n,r){function i(){s._decrementPreload(),n&&n(o)}a.default._validateParameters("loadShader",arguments),r=r||console.error;var o=new a.default.Shader,s=this,u=!1,c=!1;return this.loadStrings(e,(function(e){o._vertSrc=e.join("\n"),c=!0,u&&i()}),r),this.loadStrings(t,(function(e){o._fragSrc=e.join("\n"),u=!0,c&&i()}),r),o},a.default.prototype.createShader=function(e,t){return this._assert3d("createShader"),a.default._validateParameters("createShader",arguments),new a.default.Shader(this._renderer,e,t)},a.default.prototype.shader=function(e){return this._assert3d("shader"),a.default._validateParameters("shader",arguments),void 0===e._renderer&&(e._renderer=this._renderer),e.isStrokeShader()?this._renderer.userStrokeShader=e:(this._renderer.userFillShader=e,this._renderer._useNormalMaterial=!1),e.init(),this},a.default.prototype.resetShader=function(){return this._renderer.userFillShader=this._renderer.userStrokeShader=null,this},a.default.prototype.normalMaterial=function(){this._assert3d("normalMaterial");for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return a.default._validateParameters("normalMaterial",t),this._renderer.drawMode=o.FILL,this._renderer._useSpecularMaterial=!1,this._renderer._useEmissiveMaterial=!1,this._renderer._useNormalMaterial=!0,this._renderer.curFillColor=[1,1,1,1],this._renderer._setProperty("_doFill",!0),this.noStroke(),this},a.default.prototype.texture=function(e){return this._assert3d("texture"),a.default._validateParameters("texture",arguments),e.gifProperties&&e._animateGif(this),this._renderer.drawMode=o.TEXTURE,this._renderer._useSpecularMaterial=!1,this._renderer._useEmissiveMaterial=!1,this._renderer._useNormalMaterial=!1,this._renderer._tex=e,this._renderer._setProperty("_doFill",!0),this},a.default.prototype.textureMode=function(e){e!==o.IMAGE&&e!==o.NORMAL?console.warn("You tried to set ".concat(e," textureMode only supports IMAGE & NORMAL ")):this._renderer.textureMode=e},a.default.prototype.textureWrap=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:e;this._renderer.textureWrapX=e,this._renderer.textureWrapY=t;for(var n=this._renderer.textures,r=0;r<n.length;r++)n[r].setWrapMode(e,t)},a.default.prototype.ambientMaterial=function(e,t,n){this._assert3d("ambientMaterial"),a.default._validateParameters("ambientMaterial",arguments);var r=a.default.prototype.color.apply(this,arguments);return this._renderer.curFillColor=r._array,this._renderer._useSpecularMaterial=!1,this._renderer._useEmissiveMaterial=!1,this._renderer._useNormalMaterial=!1,this._renderer._enableLighting=!0,this._renderer._tex=null,this},a.default.prototype.emissiveMaterial=function(e,t,n,r){this._assert3d("emissiveMaterial"),a.default._validateParameters("emissiveMaterial",arguments);var i=a.default.prototype.color.apply(this,arguments);return this._renderer.curFillColor=i._array,this._renderer._useSpecularMaterial=!1,this._renderer._useEmissiveMaterial=!0,this._renderer._useNormalMaterial=!1,this._renderer._enableLighting=!0,this._renderer._tex=null,this},a.default.prototype.specularMaterial=function(e,t,n,r){this._assert3d("specularMaterial"),a.default._validateParameters("specularMaterial",arguments);var i=a.default.prototype.color.apply(this,arguments);return this._renderer.curFillColor=i._array,this._renderer._useSpecularMaterial=!0,this._renderer._useEmissiveMaterial=!1,this._renderer._useNormalMaterial=!1,this._renderer._enableLighting=!0,this._renderer._tex=null,this},a.default.prototype.shininess=function(e){return this._assert3d("shininess"),a.default._validateParameters("shininess",arguments),e<1&&(e=1),this._renderer._useShininess=e,this},a.default.RendererGL.prototype._applyColorBlend=function(e){var t=this.GL,n=this.drawMode===o.TEXTURE||e[e.length-1]<1||this._isErasing;return n!==this._isBlending&&(n||this.curBlendMode!==o.BLEND&&this.curBlendMode!==o.ADD?t.enable(t.BLEND):t.disable(t.BLEND),t.depthMask(!0),this._isBlending=n),this._applyBlendMode(),e},a.default.RendererGL.prototype._applyBlendMode=function(){if(this._cachedBlendMode!==this.curBlendMode){var e=this.GL;switch(this.curBlendMode){case o.BLEND:case o.ADD:e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA);break;case o.REMOVE:e.blendEquation(e.FUNC_REVERSE_SUBTRACT),e.blendFunc(e.SRC_ALPHA,e.DST_ALPHA);break;case o.MULTIPLY:e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ONE,e.ONE);break;case o.SCREEN:e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE_MINUS_DST_COLOR,e.ONE,e.ONE,e.ONE);break;case o.EXCLUSION:e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE_MINUS_DST_COLOR,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE);break;case o.REPLACE:e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO);break;case o.SUBTRACT:e.blendEquationSeparate(e.FUNC_REVERSE_SUBTRACT,e.FUNC_ADD),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE,e.ONE,e.ONE);break;case o.DARKEST:this.blendExt?(e.blendEquationSeparate(this.blendExt.MIN_EXT,e.FUNC_ADD),e.blendFuncSeparate(e.ONE,e.ONE,e.ONE,e.ONE)):console.warn("blendMode(DARKEST) does not work in your browser in WEBGL mode.");break;case o.LIGHTEST:this.blendExt?(e.blendEquationSeparate(this.blendExt.MAX_EXT,e.FUNC_ADD),e.blendFuncSeparate(e.ONE,e.ONE,e.ONE,e.ONE)):console.warn("blendMode(LIGHTEST) does not work in your browser in WEBGL mode.");break;default:console.error("Oops! Somehow RendererGL set curBlendMode to an unsupported mode.")}this._isErasing||(this._cachedBlendMode=this.curBlendMode)}};var s=a.default;n.default=s},{"../core/constants":250,"../core/main":260,"./p5.Texture":316,"core-js/modules/es.array.join":157}],308:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=(r=e("../core/main"))&&r.__esModule?r:{default:r};i.default.prototype.camera=function(){var e;this._assert3d("camera");for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return i.default._validateParameters("camera",n),(e=this._renderer._curCamera).camera.apply(e,n),this},i.default.prototype.perspective=function(){var e;this._assert3d("perspective");for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return i.default._validateParameters("perspective",n),(e=this._renderer._curCamera).perspective.apply(e,n),this},i.default.prototype.ortho=function(){var e;this._assert3d("ortho");for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return i.default._validateParameters("ortho",n),(e=this._renderer._curCamera).ortho.apply(e,n),this},i.default.prototype.frustum=function(){var e;this._assert3d("frustum");for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return i.default._validateParameters("frustum",n),(e=this._renderer._curCamera).frustum.apply(e,n),this},i.default.prototype.createCamera=function(){this._assert3d("createCamera");var e=new i.default.Camera(this._renderer);return e._computeCameraDefaultSettings(),e._setDefaultCamera(),this._renderer._curCamera=e},i.default.Camera=function(e){this._renderer=e,this.cameraType="default",this.cameraMatrix=new i.default.Matrix,this.projMatrix=new i.default.Matrix},i.default.Camera.prototype.perspective=function(e,t,n,r){this.cameraType=0<arguments.length?"custom":"default",void 0===e?(e=this.defaultCameraFOV,this.cameraFOV=e):this.cameraFOV=this._renderer._pInst._toRadians(e),void 0===t&&(t=this.defaultAspectRatio),void 0===n&&(n=this.defaultCameraNear),void 0===r&&(r=this.defaultCameraFar),n<=1e-4&&(n=.01,console.log("Avoid perspective near plane values close to or below 0. Setting value to 0.01.")),r<n&&console.log("Perspective far plane value is less than near plane value. Nothing will be shown."),this.aspectRatio=t,this.cameraNear=n,this.cameraFar=r,this.projMatrix=i.default.Matrix.identity();var a=1/Math.tan(this.cameraFOV/2),o=1/(this.cameraNear-this.cameraFar);this.projMatrix.set(a/t,0,0,0,0,-a,0,0,0,0,(r+n)*o,-1,0,0,2*r*n*o,0),this._isActive()&&this._renderer.uPMatrix.set(this.projMatrix.mat4[0],this.projMatrix.mat4[1],this.projMatrix.mat4[2],this.projMatrix.mat4[3],this.projMatrix.mat4[4],this.projMatrix.mat4[5],this.projMatrix.mat4[6],this.projMatrix.mat4[7],this.projMatrix.mat4[8],this.projMatrix.mat4[9],this.projMatrix.mat4[10],this.projMatrix.mat4[11],this.projMatrix.mat4[12],this.projMatrix.mat4[13],this.projMatrix.mat4[14],this.projMatrix.mat4[15])},i.default.Camera.prototype.ortho=function(e,t,n,r,a,o){void 0===e&&(e=-this._renderer.width/2),void 0===t&&(t=this._renderer.width/2),void 0===n&&(n=-this._renderer.height/2),void 0===r&&(r=this._renderer.height/2),void 0===a&&(a=0),void 0===o&&(o=Math.max(this._renderer.width,this._renderer.height));var s=t-e,u=r-n,c=o-a,l=2/s,f=2/u,d=-2/c,h=-(t+e)/s,p=-(r+n)/u,m=-(o+a)/c;this.projMatrix=i.default.Matrix.identity(),this.projMatrix.set(l,0,0,0,0,-f,0,0,0,0,d,0,h,p,m,1),this._isActive()&&this._renderer.uPMatrix.set(this.projMatrix.mat4[0],this.projMatrix.mat4[1],this.projMatrix.mat4[2],this.projMatrix.mat4[3],this.projMatrix.mat4[4],this.projMatrix.mat4[5],this.projMatrix.mat4[6],this.projMatrix.mat4[7],this.projMatrix.mat4[8],this.projMatrix.mat4[9],this.projMatrix.mat4[10],this.projMatrix.mat4[11],this.projMatrix.mat4[12],this.projMatrix.mat4[13],this.projMatrix.mat4[14],this.projMatrix.mat4[15]),this.cameraType="custom"},i.default.Camera.prototype.frustum=function(e,t,n,r,a,o){void 0===e&&(e=-this._renderer.width/2),void 0===t&&(t=this._renderer.width/2),void 0===n&&(n=-this._renderer.height/2),void 0===r&&(r=this._renderer.height/2),void 0===a&&(a=0),void 0===o&&(o=Math.max(this._renderer.width,this._renderer.height));var s=t-e,u=r-n,c=o-a,l=2*a/s,f=2*a/u,d=-2*o*a/c,h=(t+e)/s,p=(r+n)/u,m=-(o+a)/c;this.projMatrix=i.default.Matrix.identity(),this.projMatrix.set(l,0,0,0,0,f,0,0,h,p,m,-1,0,0,d,0),this._isActive()&&this._renderer.uPMatrix.set(this.projMatrix.mat4[0],this.projMatrix.mat4[1],this.projMatrix.mat4[2],this.projMatrix.mat4[3],this.projMatrix.mat4[4],this.projMatrix.mat4[5],this.projMatrix.mat4[6],this.projMatrix.mat4[7],this.projMatrix.mat4[8],this.projMatrix.mat4[9],this.projMatrix.mat4[10],this.projMatrix.mat4[11],this.projMatrix.mat4[12],this.projMatrix.mat4[13],this.projMatrix.mat4[14],this.projMatrix.mat4[15]),this.cameraType="custom"},i.default.Camera.prototype._rotateView=function(e,t,n,r){var a=this.centerX,o=this.centerY,s=this.centerZ;a-=this.eyeX,o-=this.eyeY,s-=this.eyeZ;var u=i.default.Matrix.identity(this._renderer._pInst);u.rotate(this._renderer._pInst._toRadians(e),t,n,r);var c=[a*u.mat4[0]+o*u.mat4[4]+s*u.mat4[8],a*u.mat4[1]+o*u.mat4[5]+s*u.mat4[9],a*u.mat4[2]+o*u.mat4[6]+s*u.mat4[10]];c[0]+=this.eyeX,c[1]+=this.eyeY,c[2]+=this.eyeZ,this.camera(this.eyeX,this.eyeY,this.eyeZ,c[0],c[1],c[2],this.upX,this.upY,this.upZ)},i.default.Camera.prototype.pan=function(e){var t=this._getLocalAxes();this._rotateView(e,t.y[0],t.y[1],t.y[2])},i.default.Camera.prototype.tilt=function(e){var t=this._getLocalAxes();this._rotateView(e,t.x[0],t.x[1],t.x[2])},i.default.Camera.prototype.lookAt=function(e,t,n){this.camera(this.eyeX,this.eyeY,this.eyeZ,e,t,n,this.upX,this.upY,this.upZ)},i.default.Camera.prototype.camera=function(e,t,n,r,i,a,o,s,u){void 0===e&&(e=this.defaultEyeX,t=this.defaultEyeY,n=this.defaultEyeZ,r=e,i=t,s=1,u=o=a=0),this.eyeX=e,this.eyeY=t,this.eyeZ=n,void 0!==r&&(this.centerX=r,this.centerY=i,this.centerZ=a),void 0!==o&&(this.upX=o,this.upY=s,this.upZ=u);var c=this._getLocalAxes();this.cameraMatrix.set(c.x[0],c.y[0],c.z[0],0,c.x[1],c.y[1],c.z[1],0,c.x[2],c.y[2],c.z[2],0,0,0,0,1);var l=-e,f=-t,d=-n;return this.cameraMatrix.translate([l,f,d]),this._isActive()&&this._renderer.uMVMatrix.set(this.cameraMatrix.mat4[0],this.cameraMatrix.mat4[1],this.cameraMatrix.mat4[2],this.cameraMatrix.mat4[3],this.cameraMatrix.mat4[4],this.cameraMatrix.mat4[5],this.cameraMatrix.mat4[6],this.cameraMatrix.mat4[7],this.cameraMatrix.mat4[8],this.cameraMatrix.mat4[9],this.cameraMatrix.mat4[10],this.cameraMatrix.mat4[11],this.cameraMatrix.mat4[12],this.cameraMatrix.mat4[13],this.cameraMatrix.mat4[14],this.cameraMatrix.mat4[15]),this},i.default.Camera.prototype.move=function(e,t,n){var r=this._getLocalAxes(),i=[r.x[0]*e,r.x[1]*e,r.x[2]*e],a=[r.y[0]*t,r.y[1]*t,r.y[2]*t],o=[r.z[0]*n,r.z[1]*n,r.z[2]*n];this.camera(this.eyeX+i[0]+a[0]+o[0],this.eyeY+i[1]+a[1]+o[1],this.eyeZ+i[2]+a[2]+o[2],this.centerX+i[0]+a[0]+o[0],this.centerY+i[1]+a[1]+o[1],this.centerZ+i[2]+a[2]+o[2],0,1,0)},i.default.Camera.prototype.setPosition=function(e,t,n){var r=e-this.eyeX,i=t-this.eyeY,a=n-this.eyeZ;this.camera(e,t,n,this.centerX+r,this.centerY+i,this.centerZ+a,0,1,0)},i.default.Camera.prototype._computeCameraDefaultSettings=function(){this.defaultCameraFOV=60/180*Math.PI,this.defaultAspectRatio=this._renderer.width/this._renderer.height,this.defaultEyeX=0,this.defaultEyeY=0,this.defaultEyeZ=this._renderer.height/2/Math.tan(this.defaultCameraFOV/2),this.defaultCenterX=0,this.defaultCenterY=0,this.defaultCenterZ=0,this.defaultCameraNear=.1*this.defaultEyeZ,this.defaultCameraFar=10*this.defaultEyeZ},i.default.Camera.prototype._setDefaultCamera=function(){this.cameraFOV=this.defaultCameraFOV,this.aspectRatio=this.defaultAspectRatio,this.eyeX=this.defaultEyeX,this.eyeY=this.defaultEyeY,this.eyeZ=this.defaultEyeZ,this.centerX=this.defaultCenterX,this.centerY=this.defaultCenterY,this.centerZ=this.defaultCenterZ,this.upX=0,this.upY=1,this.upZ=0,this.cameraNear=this.defaultCameraNear,this.cameraFar=this.defaultCameraFar,this.perspective(),this.camera(),this.cameraType="default"},i.default.Camera.prototype._resize=function(){"default"===this.cameraType?(this._computeCameraDefaultSettings(),this._setDefaultCamera()):this.perspective(this.cameraFOV,this._renderer.width/this._renderer.height)},i.default.Camera.prototype.copy=function(){var e=new i.default.Camera(this._renderer);return e.cameraFOV=this.cameraFOV,e.aspectRatio=this.aspectRatio,e.eyeX=this.eyeX,e.eyeY=this.eyeY,e.eyeZ=this.eyeZ,e.centerX=this.centerX,e.centerY=this.centerY,e.centerZ=this.centerZ,e.cameraNear=this.cameraNear,e.cameraFar=this.cameraFar,e.cameraType=this.cameraType,e.cameraMatrix=this.cameraMatrix.copy(),e.projMatrix=this.projMatrix.copy(),e},i.default.Camera.prototype._getLocalAxes=function(){var e=this.eyeX-this.centerX,t=this.eyeY-this.centerY,n=this.eyeZ-this.centerZ,r=Math.sqrt(e*e+t*t+n*n);0!==r&&(e/=r,t/=r,n/=r);var i=this.upX,a=this.upY,o=this.upZ,s=a*n-o*t,u=-i*n+o*e,c=i*t-a*e;i=t*c-n*u,a=-e*c+n*s,o=e*u-t*s;var l=Math.sqrt(s*s+u*u+c*c);0!==l&&(s/=l,u/=l,c/=l);var f=Math.sqrt(i*i+a*a+o*o);return 0!==f&&(i/=f,a/=f,o/=f),{x:[s,u,c],y:[i,a,o],z:[e,t,n]}},i.default.Camera.prototype._orbit=function(e,t,n){var r=this.eyeX-this.centerX,i=this.eyeY-this.centerY,a=this.eyeZ-this.centerZ,o=Math.sqrt(r*r+i*i+a*a),s=Math.atan2(r,a),u=Math.acos(Math.max(-1,Math.min(1,i/o)));s+=e,(o+=n)<0&&(o=.1),(u+=t)>Math.PI?u=Math.PI:u<=0&&(u=.001);var c=Math.sin(u)*o*Math.sin(s),l=Math.cos(u)*o,f=Math.sin(u)*o*Math.cos(s);this.camera(c+this.centerX,l+this.centerY,f+this.centerZ,this.centerX,this.centerY,this.centerZ,0,1,0)},i.default.Camera.prototype._isActive=function(){return this===this._renderer._curCamera},i.default.prototype.setCamera=function(e){this._renderer._curCamera=e,this._renderer.uPMatrix.set(e.projMatrix.mat4[0],e.projMatrix.mat4[1],e.projMatrix.mat4[2],e.projMatrix.mat4[3],e.projMatrix.mat4[4],e.projMatrix.mat4[5],e.projMatrix.mat4[6],e.projMatrix.mat4[7],e.projMatrix.mat4[8],e.projMatrix.mat4[9],e.projMatrix.mat4[10],e.projMatrix.mat4[11],e.projMatrix.mat4[12],e.projMatrix.mat4[13],e.projMatrix.mat4[14],e.projMatrix.mat4[15])};var a=i.default.Camera;n.default=a},{"../core/main":260}],309:[function(e,t,n){"use strict";e("core-js/modules/es.string.sub"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=(r=e("../core/main"))&&r.__esModule?r:{default:r};i.default.Geometry=function(e,t,n){return this.vertices=[],this.lineVertices=[],this.lineNormals=[],this.vertexNormals=[],this.faces=[],this.uvs=[],this.edges=[],this.vertexColors=[],this.detailX=void 0!==e?e:1,this.detailY=void 0!==t?t:1,this.dirtyFlags={},n instanceof Function&&n.call(this),this},i.default.Geometry.prototype.reset=function(){this.lineVertices.length=0,this.lineNormals.length=0,this.vertices.length=0,this.edges.length=0,this.vertexColors.length=0,this.vertexNormals.length=0,this.uvs.length=0,this.dirtyFlags={}},i.default.Geometry.prototype.computeFaces=function(){this.faces.length=0;for(var e,t,n,r,i=this.detailX+1,a=0;a<this.detailY;a++)for(var o=0;o<this.detailX;o++)t=(e=a*i+o)+1,n=(a+1)*i+o+1,r=(a+1)*i+o,this.faces.push([e,t,r]),this.faces.push([r,t,n]);return this},i.default.Geometry.prototype._getFaceNormal=function(e){var t=this.faces[e],n=this.vertices[t[0]],r=this.vertices[t[1]],a=this.vertices[t[2]],o=i.default.Vector.sub(r,n),s=i.default.Vector.sub(a,n),u=i.default.Vector.cross(o,s),c=i.default.Vector.mag(u),l=c/(i.default.Vector.mag(o)*i.default.Vector.mag(s));return 0===l||isNaN(l)?(console.warn("p5.Geometry.prototype._getFaceNormal:","face has colinear sides or a repeated vertex"),u):(1<l&&(l=1),u.mult(Math.asin(l)/c))},i.default.Geometry.prototype.computeNormals=function(){var e,t=this.vertexNormals,n=this.vertices,r=this.faces;for(e=t.length=0;e<n.length;++e)t.push(new i.default.Vector);for(var a=0;a<r.length;++a)for(var o=r[a],s=this._getFaceNormal(a),u=0;u<3;++u)t[o[u]].add(s);for(e=0;e<n.length;++e)t[e].normalize();return this},i.default.Geometry.prototype.averageNormals=function(){for(var e=0;e<=this.detailY;e++){var t=this.detailX+1,n=i.default.Vector.add(this.vertexNormals[e*t],this.vertexNormals[e*t+this.detailX]);n=i.default.Vector.div(n,2),this.vertexNormals[e*t]=n,this.vertexNormals[e*t+this.detailX]=n}return this},i.default.Geometry.prototype.averagePoleNormals=function(){for(var e=new i.default.Vector(0,0,0),t=0;t<this.detailX;t++)e.add(this.vertexNormals[t]);e=i.default.Vector.div(e,this.detailX);for(var n=0;n<this.detailX;n++)this.vertexNormals[n]=e;e=new i.default.Vector(0,0,0);for(var r=this.vertices.length-1;r>this.vertices.length-1-this.detailX;r--)e.add(this.vertexNormals[r]);e=i.default.Vector.div(e,this.detailX);for(var a=this.vertices.length-1;a>this.vertices.length-1-this.detailX;a--)this.vertexNormals[a]=e;return this},i.default.Geometry.prototype._makeTriangleEdges=function(){if(this.edges.length=0,Array.isArray(this.strokeIndices))for(var e=0,t=this.strokeIndices.length;e<t;e++)this.edges.push(this.strokeIndices[e]);else for(var n=0;n<this.faces.length;n++)this.edges.push([this.faces[n][0],this.faces[n][1]]),this.edges.push([this.faces[n][1],this.faces[n][2]]),this.edges.push([this.faces[n][2],this.faces[n][0]]);return this},i.default.Geometry.prototype._edgesToVertices=function(){this.lineVertices.length=0;for(var e=this.lineNormals.length=0;e<this.edges.length;e++){var t=this.vertices[this.edges[e][0]],n=this.vertices[this.edges[e][1]],r=n.copy().sub(t).normalize(),i=t.array(),a=t.array(),o=n.array(),s=n.array(),u=r.array(),c=r.array();u.push(1),c.push(-1),this.lineNormals.push(u,c,u,u,c,c),this.lineVertices.push(i,a,o,o,a,s)}return this},i.default.Geometry.prototype.normalize=function(){if(0<this.vertices.length){for(var e=this.vertices[0].copy(),t=this.vertices[0].copy(),n=0;n<this.vertices.length;n++)e.x=Math.max(e.x,this.vertices[n].x),t.x=Math.min(t.x,this.vertices[n].x),e.y=Math.max(e.y,this.vertices[n].y),t.y=Math.min(t.y,this.vertices[n].y),e.z=Math.max(e.z,this.vertices[n].z),t.z=Math.min(t.z,this.vertices[n].z);for(var r=i.default.Vector.lerp(e,t,.5),a=i.default.Vector.sub(e,t),o=200/Math.max(Math.max(a.x,a.y),a.z),s=0;s<this.vertices.length;s++)this.vertices[s].sub(r),this.vertices[s].mult(o)}return this};var a=i.default.Geometry;n.default=a},{"../core/main":260,"core-js/modules/es.string.sub":189}],310:[function(e,t,n){"use strict";e("core-js/modules/es.array.iterator"),e("core-js/modules/es.object.to-string"),e("core-js/modules/es.typed-array.float32-array"),e("core-js/modules/es.typed-array.copy-within"),e("core-js/modules/es.typed-array.every"),e("core-js/modules/es.typed-array.fill"),e("core-js/modules/es.typed-array.filter"),e("core-js/modules/es.typed-array.find"),e("core-js/modules/es.typed-array.find-index"),e("core-js/modules/es.typed-array.for-each"),e("core-js/modules/es.typed-array.includes"),e("core-js/modules/es.typed-array.index-of"),e("core-js/modules/es.typed-array.iterator"),e("core-js/modules/es.typed-array.join"),e("core-js/modules/es.typed-array.last-index-of"),e("core-js/modules/es.typed-array.map"),e("core-js/modules/es.typed-array.reduce"),e("core-js/modules/es.typed-array.reduce-right"),e("core-js/modules/es.typed-array.reverse"),e("core-js/modules/es.typed-array.set"),e("core-js/modules/es.typed-array.slice"),e("core-js/modules/es.typed-array.some"),e("core-js/modules/es.typed-array.sort"),e("core-js/modules/es.typed-array.subarray"),e("core-js/modules/es.typed-array.to-locale-string"),e("core-js/modules/es.typed-array.to-string"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=(r=e("../core/main"))&&r.__esModule?r:{default:r},a=Array,o=function(e){return e instanceof Array};"undefined"!=typeof Float32Array&&(a=Float32Array,o=function(e){return e instanceof Array||e instanceof Float32Array}),i.default.Matrix=function(){for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];return e.length&&e[e.length-1]instanceof i.default&&(this.p5=e[e.length-1]),"mat3"===e[0]?this.mat3=Array.isArray(e[1])?e[1]:new a([1,0,0,0,1,0,0,0,1]):this.mat4=Array.isArray(e[0])?e[0]:new a([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this},i.default.Matrix.prototype.set=function(e){return e instanceof i.default.Matrix?this.mat4=e.mat4:o(e)?this.mat4=e:16===arguments.length&&(this.mat4[0]=e,this.mat4[1]=arguments[1],this.mat4[2]=arguments[2],this.mat4[3]=arguments[3],this.mat4[4]=arguments[4],this.mat4[5]=arguments[5],this.mat4[6]=arguments[6],this.mat4[7]=arguments[7],this.mat4[8]=arguments[8],this.mat4[9]=arguments[9],this.mat4[10]=arguments[10],this.mat4[11]=arguments[11],this.mat4[12]=arguments[12],this.mat4[13]=arguments[13],this.mat4[14]=arguments[14],this.mat4[15]=arguments[15]),this},i.default.Matrix.prototype.get=function(){return new i.default.Matrix(this.mat4,this.p5)},i.default.Matrix.prototype.copy=function(){var e=new i.default.Matrix(this.p5);return e.mat4[0]=this.mat4[0],e.mat4[1]=this.mat4[1],e.mat4[2]=this.mat4[2],e.mat4[3]=this.mat4[3],e.mat4[4]=this.mat4[4],e.mat4[5]=this.mat4[5],e.mat4[6]=this.mat4[6],e.mat4[7]=this.mat4[7],e.mat4[8]=this.mat4[8],e.mat4[9]=this.mat4[9],e.mat4[10]=this.mat4[10],e.mat4[11]=this.mat4[11],e.mat4[12]=this.mat4[12],e.mat4[13]=this.mat4[13],e.mat4[14]=this.mat4[14],e.mat4[15]=this.mat4[15],e},i.default.Matrix.identity=function(e){return new i.default.Matrix(e)},i.default.Matrix.prototype.transpose=function(e){var t,n,r,a,s,u;return e instanceof i.default.Matrix?(t=e.mat4[1],n=e.mat4[2],r=e.mat4[3],a=e.mat4[6],s=e.mat4[7],u=e.mat4[11],this.mat4[0]=e.mat4[0],this.mat4[1]=e.mat4[4],this.mat4[2]=e.mat4[8],this.mat4[3]=e.mat4[12],this.mat4[4]=t,this.mat4[5]=e.mat4[5],this.mat4[6]=e.mat4[9],this.mat4[7]=e.mat4[13],this.mat4[8]=n,this.mat4[9]=a,this.mat4[10]=e.mat4[10],this.mat4[11]=e.mat4[14],this.mat4[12]=r,this.mat4[13]=s,this.mat4[14]=u,this.mat4[15]=e.mat4[15]):o(e)&&(t=e[1],n=e[2],r=e[3],a=e[6],s=e[7],u=e[11],this.mat4[0]=e[0],this.mat4[1]=e[4],this.mat4[2]=e[8],this.mat4[3]=e[12],this.mat4[4]=t,this.mat4[5]=e[5],this.mat4[6]=e[9],this.mat4[7]=e[13],this.mat4[8]=n,this.mat4[9]=a,this.mat4[10]=e[10],this.mat4[11]=e[14],this.mat4[12]=r,this.mat4[13]=s,this.mat4[14]=u,this.mat4[15]=e[15]),this},i.default.Matrix.prototype.invert=function(e){var t,n,r,a,s,u,c,l,f,d,h,p,m,v,g,y;e instanceof i.default.Matrix?(t=e.mat4[0],n=e.mat4[1],r=e.mat4[2],a=e.mat4[3],s=e.mat4[4],u=e.mat4[5],c=e.mat4[6],l=e.mat4[7],f=e.mat4[8],d=e.mat4[9],h=e.mat4[10],p=e.mat4[11],m=e.mat4[12],v=e.mat4[13],g=e.mat4[14],y=e.mat4[15]):o(e)&&(t=e[0],n=e[1],r=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],f=e[8],d=e[9],h=e[10],p=e[11],m=e[12],v=e[13],g=e[14],y=e[15]);var b=t*u-n*s,x=t*c-r*s,w=t*l-a*s,_=n*c-r*u,k=n*l-a*u,E=r*l-a*c,S=f*v-d*m,C=f*g-h*m,A=f*y-p*m,O=d*g-h*v,D=d*y-p*v,T=h*y-p*g,j=b*T-x*D+w*O+_*A-k*C+E*S;return j?(j=1/j,this.mat4[0]=(u*T-c*D+l*O)*j,this.mat4[1]=(r*D-n*T-a*O)*j,this.mat4[2]=(v*E-g*k+y*_)*j,this.mat4[3]=(h*k-d*E-p*_)*j,this.mat4[4]=(c*A-s*T-l*C)*j,this.mat4[5]=(t*T-r*A+a*C)*j,this.mat4[6]=(g*w-m*E-y*x)*j,this.mat4[7]=(f*E-h*w+p*x)*j,this.mat4[8]=(s*D-u*A+l*S)*j,this.mat4[9]=(n*A-t*D-a*S)*j,this.mat4[10]=(m*k-v*w+y*b)*j,this.mat4[11]=(d*w-f*k-p*b)*j,this.mat4[12]=(u*C-s*O-c*S)*j,this.mat4[13]=(t*O-n*C+r*S)*j,this.mat4[14]=(v*x-m*_-g*b)*j,this.mat4[15]=(f*_-d*x+h*b)*j,this):null},i.default.Matrix.prototype.invert3x3=function(){var e=this.mat3[0],t=this.mat3[1],n=this.mat3[2],r=this.mat3[3],i=this.mat3[4],a=this.mat3[5],o=this.mat3[6],s=this.mat3[7],u=this.mat3[8],c=u*i-a*s,l=-u*r+a*o,f=s*r-i*o,d=e*c+t*l+n*f;return d?(d=1/d,this.mat3[0]=c*d,this.mat3[1]=(-u*t+n*s)*d,this.mat3[2]=(a*t-n*i)*d,this.mat3[3]=l*d,this.mat3[4]=(u*e-n*o)*d,this.mat3[5]=(-a*e+n*r)*d,this.mat3[6]=f*d,this.mat3[7]=(-s*e+t*o)*d,this.mat3[8]=(i*e-t*r)*d,this):null},i.default.Matrix.prototype.transpose3x3=function(e){var t=e[1],n=e[2],r=e[5];return this.mat3[1]=e[3],this.mat3[2]=e[6],this.mat3[3]=t,this.mat3[5]=e[7],this.mat3[6]=n,this.mat3[7]=r,this},i.default.Matrix.prototype.inverseTranspose=function(e){void 0===this.mat3?console.error("sorry, this function only works with mat3"):(this.mat3[0]=e.mat4[0],this.mat3[1]=e.mat4[1],this.mat3[2]=e.mat4[2],this.mat3[3]=e.mat4[4],this.mat3[4]=e.mat4[5],this.mat3[5]=e.mat4[6],this.mat3[6]=e.mat4[8],this.mat3[7]=e.mat4[9],this.mat3[8]=e.mat4[10]);var t=this.invert3x3();if(t)t.transpose3x3(this.mat3);else for(var n=0;n<9;n++)this.mat3[n]=0;return this},i.default.Matrix.prototype.determinant=function(){var e=this.mat4[0]*this.mat4[5]-this.mat4[1]*this.mat4[4],t=this.mat4[0]*this.mat4[6]-this.mat4[2]*this.mat4[4],n=this.mat4[0]*this.mat4[7]-this.mat4[3]*this.mat4[4],r=this.mat4[1]*this.mat4[6]-this.mat4[2]*this.mat4[5],i=this.mat4[1]*this.mat4[7]-this.mat4[3]*this.mat4[5],a=this.mat4[2]*this.mat4[7]-this.mat4[3]*this.mat4[6],o=this.mat4[8]*this.mat4[13]-this.mat4[9]*this.mat4[12],s=this.mat4[8]*this.mat4[14]-this.mat4[10]*this.mat4[12],u=this.mat4[8]*this.mat4[15]-this.mat4[11]*this.mat4[12],c=this.mat4[9]*this.mat4[14]-this.mat4[10]*this.mat4[13],l=this.mat4[9]*this.mat4[15]-this.mat4[11]*this.mat4[13];return e*(this.mat4[10]*this.mat4[15]-this.mat4[11]*this.mat4[14])-t*l+n*c+r*u-i*s+a*o},i.default.Matrix.prototype.mult=function(e){var t;if(e===this||e===this.mat4)t=this.copy().mat4;else if(e instanceof i.default.Matrix)t=e.mat4;else if(o(e))t=e;else{if(16!==arguments.length)return;t=arguments}var n=this.mat4[0],r=this.mat4[1],a=this.mat4[2],s=this.mat4[3];return this.mat4[0]=n*t[0]+r*t[4]+a*t[8]+s*t[12],this.mat4[1]=n*t[1]+r*t[5]+a*t[9]+s*t[13],this.mat4[2]=n*t[2]+r*t[6]+a*t[10]+s*t[14],this.mat4[3]=n*t[3]+r*t[7]+a*t[11]+s*t[15],n=this.mat4[4],r=this.mat4[5],a=this.mat4[6],s=this.mat4[7],this.mat4[4]=n*t[0]+r*t[4]+a*t[8]+s*t[12],this.mat4[5]=n*t[1]+r*t[5]+a*t[9]+s*t[13],this.mat4[6]=n*t[2]+r*t[6]+a*t[10]+s*t[14],this.mat4[7]=n*t[3]+r*t[7]+a*t[11]+s*t[15],n=this.mat4[8],r=this.mat4[9],a=this.mat4[10],s=this.mat4[11],this.mat4[8]=n*t[0]+r*t[4]+a*t[8]+s*t[12],this.mat4[9]=n*t[1]+r*t[5]+a*t[9]+s*t[13],this.mat4[10]=n*t[2]+r*t[6]+a*t[10]+s*t[14],this.mat4[11]=n*t[3]+r*t[7]+a*t[11]+s*t[15],n=this.mat4[12],r=this.mat4[13],a=this.mat4[14],s=this.mat4[15],this.mat4[12]=n*t[0]+r*t[4]+a*t[8]+s*t[12],this.mat4[13]=n*t[1]+r*t[5]+a*t[9]+s*t[13],this.mat4[14]=n*t[2]+r*t[6]+a*t[10]+s*t[14],this.mat4[15]=n*t[3]+r*t[7]+a*t[11]+s*t[15],this},i.default.Matrix.prototype.apply=function(e){var t;if(e===this||e===this.mat4)t=this.copy().mat4;else if(e instanceof i.default.Matrix)t=e.mat4;else if(o(e))t=e;else{if(16!==arguments.length)return;t=arguments}var n=this.mat4,r=n[0],a=n[4],s=n[8],u=n[12];n[0]=t[0]*r+t[1]*a+t[2]*s+t[3]*u,n[4]=t[4]*r+t[5]*a+t[6]*s+t[7]*u,n[8]=t[8]*r+t[9]*a+t[10]*s+t[11]*u,n[12]=t[12]*r+t[13]*a+t[14]*s+t[15]*u;var c=n[1],l=n[5],f=n[9],d=n[13];n[1]=t[0]*c+t[1]*l+t[2]*f+t[3]*d,n[5]=t[4]*c+t[5]*l+t[6]*f+t[7]*d,n[9]=t[8]*c+t[9]*l+t[10]*f+t[11]*d,n[13]=t[12]*c+t[13]*l+t[14]*f+t[15]*d;var h=n[2],p=n[6],m=n[10],v=n[14];n[2]=t[0]*h+t[1]*p+t[2]*m+t[3]*v,n[6]=t[4]*h+t[5]*p+t[6]*m+t[7]*v,n[10]=t[8]*h+t[9]*p+t[10]*m+t[11]*v,n[14]=t[12]*h+t[13]*p+t[14]*m+t[15]*v;var g=n[3],y=n[7],b=n[11],x=n[15];return n[3]=t[0]*g+t[1]*y+t[2]*b+t[3]*x,n[7]=t[4]*g+t[5]*y+t[6]*b+t[7]*x,n[11]=t[8]*g+t[9]*y+t[10]*b+t[11]*x,n[15]=t[12]*g+t[13]*y+t[14]*b+t[15]*x,this},i.default.Matrix.prototype.scale=function(e,t,n){return e instanceof i.default.Vector?(t=e.y,n=e.z,e=e.x):e instanceof Array&&(t=e[1],n=e[2],e=e[0]),this.mat4[0]*=e,this.mat4[1]*=e,this.mat4[2]*=e,this.mat4[3]*=e,this.mat4[4]*=t,this.mat4[5]*=t,this.mat4[6]*=t,this.mat4[7]*=t,this.mat4[8]*=n,this.mat4[9]*=n,this.mat4[10]*=n,this.mat4[11]*=n,this},i.default.Matrix.prototype.rotate=function(e,t,n,r){t instanceof i.default.Vector?(n=t.y,r=t.z,t=t.x):t instanceof Array&&(n=t[1],r=t[2],t=t[0]);var a=Math.sqrt(t*t+n*n+r*r);t*=1/a,n*=1/a,r*=1/a;var o=this.mat4[0],s=this.mat4[1],u=this.mat4[2],c=this.mat4[3],l=this.mat4[4],f=this.mat4[5],d=this.mat4[6],h=this.mat4[7],p=this.mat4[8],m=this.mat4[9],v=this.mat4[10],g=this.mat4[11],y=Math.sin(e),b=Math.cos(e),x=1-b,w=t*t*x+b,_=n*t*x+r*y,k=r*t*x-n*y,E=t*n*x-r*y,S=n*n*x+b,C=r*n*x+t*y,A=t*r*x+n*y,O=n*r*x-t*y,D=r*r*x+b;return this.mat4[0]=o*w+l*_+p*k,this.mat4[1]=s*w+f*_+m*k,this.mat4[2]=u*w+d*_+v*k,this.mat4[3]=c*w+h*_+g*k,this.mat4[4]=o*E+l*S+p*C,this.mat4[5]=s*E+f*S+m*C,this.mat4[6]=u*E+d*S+v*C,this.mat4[7]=c*E+h*S+g*C,this.mat4[8]=o*A+l*O+p*D,this.mat4[9]=s*A+f*O+m*D,this.mat4[10]=u*A+d*O+v*D,this.mat4[11]=c*A+h*O+g*D,this},i.default.Matrix.prototype.translate=function(e){var t=e[0],n=e[1],r=e[2]||0;this.mat4[12]+=this.mat4[0]*t+this.mat4[4]*n+this.mat4[8]*r,this.mat4[13]+=this.mat4[1]*t+this.mat4[5]*n+this.mat4[9]*r,this.mat4[14]+=this.mat4[2]*t+this.mat4[6]*n+this.mat4[10]*r,this.mat4[15]+=this.mat4[3]*t+this.mat4[7]*n+this.mat4[11]*r},i.default.Matrix.prototype.rotateX=function(e){this.rotate(e,1,0,0)},i.default.Matrix.prototype.rotateY=function(e){this.rotate(e,0,1,0)},i.default.Matrix.prototype.rotateZ=function(e){this.rotate(e,0,0,1)},i.default.Matrix.prototype.perspective=function(e,t,n,r){var i=1/Math.tan(e/2),a=1/(n-r);return this.mat4[0]=i/t,this.mat4[1]=0,this.mat4[2]=0,this.mat4[3]=0,this.mat4[4]=0,this.mat4[5]=i,this.mat4[6]=0,this.mat4[7]=0,this.mat4[8]=0,this.mat4[9]=0,this.mat4[10]=(r+n)*a,this.mat4[11]=-1,this.mat4[12]=0,this.mat4[13]=0,this.mat4[14]=2*r*n*a,this.mat4[15]=0,this},i.default.Matrix.prototype.ortho=function(e,t,n,r,i,a){var o=1/(e-t),s=1/(n-r),u=1/(i-a);return this.mat4[0]=-2*o,this.mat4[1]=0,this.mat4[2]=0,this.mat4[3]=0,this.mat4[4]=0,this.mat4[5]=-2*s,this.mat4[6]=0,this.mat4[7]=0,this.mat4[8]=0,this.mat4[9]=0,this.mat4[10]=2*u,this.mat4[11]=0,this.mat4[12]=(e+t)*o,this.mat4[13]=(r+n)*s,this.mat4[14]=(a+i)*u,this.mat4[15]=1,this};var s=i.default.Matrix;n.default=s},{"../core/main":260,"core-js/modules/es.array.iterator":156,"core-js/modules/es.object.to-string":174,"core-js/modules/es.typed-array.copy-within":194,"core-js/modules/es.typed-array.every":195,"core-js/modules/es.typed-array.fill":196,"core-js/modules/es.typed-array.filter":197,"core-js/modules/es.typed-array.find":199,"core-js/modules/es.typed-array.find-index":198,"core-js/modules/es.typed-array.float32-array":200,"core-js/modules/es.typed-array.for-each":202,"core-js/modules/es.typed-array.includes":203,"core-js/modules/es.typed-array.index-of":204,"core-js/modules/es.typed-array.iterator":207,"core-js/modules/es.typed-array.join":208,"core-js/modules/es.typed-array.last-index-of":209,"core-js/modules/es.typed-array.map":210,"core-js/modules/es.typed-array.reduce":212,"core-js/modules/es.typed-array.reduce-right":211,"core-js/modules/es.typed-array.reverse":213,"core-js/modules/es.typed-array.set":214,"core-js/modules/es.typed-array.slice":215,"core-js/modules/es.typed-array.some":216,"core-js/modules/es.typed-array.sort":217,"core-js/modules/es.typed-array.subarray":218,"core-js/modules/es.typed-array.to-locale-string":219,"core-js/modules/es.typed-array.to-string":220}],311:[function(e,t,n){"use strict";e("core-js/modules/es.array.map"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=(r=e("../core/main"))&&r.__esModule?r:{default:r};i.default.RenderBuffer=function(e,t,n,r,i,a){this.size=e,this.src=t,this.dst=n,this.attr=r,this._renderer=i,this.map=a},i.default.RenderBuffer.prototype._prepareBuffer=function(e,t){var n,r=t.attributes,i=this._renderer.GL;n=e.model?e.model:e;var a=r[this.attr];if(a){var o=e[this.dst],s=n[this.src];if(0<s.length){var u=!o;if(u&&(e[this.dst]=o=i.createBuffer()),i.bindBuffer(i.ARRAY_BUFFER,o),u||!1!==n.dirtyFlags[this.src]){var c=this.map,l=c?c(s):s;this._renderer._bindBuffer(o,i.ARRAY_BUFFER,l),n.dirtyFlags[this.src]=!1}t.enableAttrib(a,this.size)}}};var a=i.default.RenderBuffer;n.default=a},{"../core/main":260,"core-js/modules/es.array.map":159}],312:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e("core-js/modules/es.symbol"),e("core-js/modules/es.symbol.description"),e("core-js/modules/es.symbol.iterator"),e("core-js/modules/es.array.fill"),e("core-js/modules/es.array.for-each"),e("core-js/modules/es.array.iterator"),e("core-js/modules/es.object.to-string"),e("core-js/modules/es.string.iterator"),e("core-js/modules/es.typed-array.float32-array"),e("core-js/modules/es.typed-array.copy-within"),e("core-js/modules/es.typed-array.every"),e("core-js/modules/es.typed-array.fill"),e("core-js/modules/es.typed-array.filter"),e("core-js/modules/es.typed-array.find"),e("core-js/modules/es.typed-array.find-index"),e("core-js/modules/es.typed-array.for-each"),e("core-js/modules/es.typed-array.includes"),e("core-js/modules/es.typed-array.index-of"),e("core-js/modules/es.typed-array.iterator"),e("core-js/modules/es.typed-array.join"),e("core-js/modules/es.typed-array.last-index-of"),e("core-js/modules/es.typed-array.map"),e("core-js/modules/es.typed-array.reduce"),e("core-js/modules/es.typed-array.reduce-right"),e("core-js/modules/es.typed-array.reverse"),e("core-js/modules/es.typed-array.set"),e("core-js/modules/es.typed-array.slice"),e("core-js/modules/es.typed-array.some"),e("core-js/modules/es.typed-array.sort"),e("core-js/modules/es.typed-array.subarray"),e("core-js/modules/es.typed-array.to-locale-string"),e("core-js/modules/es.typed-array.to-string"),e("core-js/modules/web.dom-collections.for-each"),e("core-js/modules/web.dom-collections.iterator"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i,a=(i=e("../core/main"))&&i.__esModule?i:{default:i},o=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var t="function"!=typeof WeakMap?null:new WeakMap;if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,t&&t.set(e,n),n}(e("../core/constants"));e("./p5.RenderBuffer"),a.default.RendererGL.prototype.beginShape=function(e){return this.immediateMode.shapeMode=void 0!==e?e:o.TRIANGLE_FAN,this.immediateMode.geometry.reset(),this},a.default.RendererGL.prototype.vertex=function(e,t){var n,r,i;n=r=i=0,3===arguments.length?n=arguments[2]:4===arguments.length?(r=arguments[2],i=arguments[3]):5===arguments.length&&(n=arguments[2],r=arguments[3],i=arguments[4]);var s=new a.default.Vector(e,t,n);this.immediateMode.geometry.vertices.push(s);var u=this.curFillColor||[.5,.5,.5,1];return this.immediateMode.geometry.vertexColors.push(u[0],u[1],u[2],u[3]),this.textureMode===o.IMAGE&&(null!==this._tex?0<this._tex.width&&0<this._tex.height&&(r/=this._tex.width,i/=this._tex.height):null===this._tex&&4<=arguments.length&&console.warn("You must first call texture() before using vertex() with image based u and v coordinates")),this.immediateMode.geometry.uvs.push(r,i),this.immediateMode._bezierVertex[0]=e,this.immediateMode._bezierVertex[1]=t,this.immediateMode._bezierVertex[2]=n,this.immediateMode._quadraticVertex[0]=e,this.immediateMode._quadraticVertex[1]=t,this.immediateMode._quadraticVertex[2]=n,this},a.default.RendererGL.prototype.endShape=function(e,t,n,r,i,a){return this.immediateMode.shapeMode===o.POINTS?this._drawPoints(this.immediateMode.geometry.vertices,this.immediateMode.buffers.point):(this._processVertices.apply(this,arguments),this._doFill&&1<this.immediateMode.geometry.vertices.length&&this._drawImmediateFill(),this._doStroke&&1<this.immediateMode.geometry.lineVertices.length&&this._drawImmediateStroke(),this.isBezier=!1,this.isQuadratic=!1,this.isCurve=!1,this.immediateMode._bezierVertex.length=0,this.immediateMode._quadraticVertex.length=0,this.immediateMode._curveVertex.length=0),this},a.default.RendererGL.prototype._processVertices=function(e){if(0!==this.immediateMode.geometry.vertices.length){var t=this._doStroke&&this.drawMode!==o.TEXTURE,n=e===o.CLOSE;t&&(this.immediateMode.geometry.edges=this._calculateEdges(this.immediateMode.shapeMode,this.immediateMode.geometry.vertices,n),this.immediateMode.geometry._edgesToVertices());var r=this.immediateMode.shapeMode===o.TESS;(this.isBezier||this.isQuadratic||this.isCurve||r)&&this.immediateMode.shapeMode!==o.LINES&&this._tesselateShape()}},a.default.RendererGL.prototype._calculateEdges=function(e,t,n){var r=[],i=0;switch(e){case o.TRIANGLE_STRIP:for(i=0;i<t.length-2;i++)r.push([i,i+1]),r.push([i,i+2]);r.push([i,i+1]);break;case o.TRIANGLES:for(i=0;i<t.length-2;i+=3)r.push([i,i+1]),r.push([i+1,i+2]),r.push([i+2,i]);break;case o.LINES:for(i=0;i<t.length-1;i+=2)r.push([i,i+1]);break;default:for(i=0;i<t.length-1;i++)r.push([i,i+1])}return n&&r.push([t.length-1,0]),r},a.default.RendererGL.prototype._tesselateShape=function(){this.immediateMode.shapeMode=o.TRIANGLES;var e=[new Float32Array(this._vToNArray(this.immediateMode.geometry.vertices))],t=this._triangulate(e);this.immediateMode.geometry.vertices=[];for(var n=0,r=t.length;n<r;n+=3)this.vertex(t[n],t[n+1],t[n+2])},a.default.RendererGL.prototype._drawImmediateFill=function(){var e=this.GL,t=this._getImmediateFillShader();this._calculateNormals(this.immediateMode.geometry),this._setFillUniforms(t);var n=!0,r=!1,i=void 0;try{for(var a,s=this.immediateMode.buffers.fill[Symbol.iterator]();!(n=(a=s.next()).done);n=!0)a.value._prepareBuffer(this.immediateMode.geometry,t)}catch(e){r=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(r)throw i}}this.immediateMode.shapeMode!==o.LINE_STRIP&&this.immediateMode.shapeMode!==o.LINES||(this.immediateMode.shapeMode=o.TRIANGLE_FAN),this._applyColorBlend(this.curFillColor),e.drawArrays(this.immediateMode.shapeMode,0,this.immediateMode.geometry.vertices.length),t.unbindShader()},a.default.RendererGL.prototype._drawImmediateStroke=function(){var e=this.GL,t=this._getImmediateStrokeShader();this._setStrokeUniforms(t);var n=!0,r=!1,i=void 0;try{for(var a,o=this.immediateMode.buffers.stroke[Symbol.iterator]();!(n=(a=o.next()).done);n=!0)a.value._prepareBuffer(this.immediateMode.geometry,t)}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}this._applyColorBlend(this.curStrokeColor),e.drawArrays(e.TRIANGLES,0,this.immediateMode.geometry.lineVertices.length),t.unbindShader()},a.default.RendererGL.prototype._calculateNormals=function(e){e.vertices.forEach((function(){e.vertexNormals.push(new a.default.Vector(0,0,1))}))};var s=a.default.RendererGL;n.default=s},{"../core/constants":250,"../core/main":260,"./p5.RenderBuffer":311,"core-js/modules/es.array.fill":150,"core-js/modules/es.array.for-each":152,"core-js/modules/es.array.iterator":156,"core-js/modules/es.object.to-string":174,"core-js/modules/es.string.iterator":183,"core-js/modules/es.symbol":193,"core-js/modules/es.symbol.description":191,"core-js/modules/es.symbol.iterator":192,"core-js/modules/es.typed-array.copy-within":194,"core-js/modules/es.typed-array.every":195,"core-js/modules/es.typed-array.fill":196,"core-js/modules/es.typed-array.filter":197,"core-js/modules/es.typed-array.find":199,"core-js/modules/es.typed-array.find-index":198,"core-js/modules/es.typed-array.float32-array":200,"core-js/modules/es.typed-array.for-each":202,"core-js/modules/es.typed-array.includes":203,"core-js/modules/es.typed-array.index-of":204,"core-js/modules/es.typed-array.iterator":207,"core-js/modules/es.typed-array.join":208,"core-js/modules/es.typed-array.last-index-of":209,"core-js/modules/es.typed-array.map":210,"core-js/modules/es.typed-array.reduce":212,"core-js/modules/es.typed-array.reduce-right":211,"core-js/modules/es.typed-array.reverse":213,"core-js/modules/es.typed-array.set":214,"core-js/modules/es.typed-array.slice":215,"core-js/modules/es.typed-array.some":216,"core-js/modules/es.typed-array.sort":217,"core-js/modules/es.typed-array.subarray":218,"core-js/modules/es.typed-array.to-locale-string":219,"core-js/modules/es.typed-array.to-string":220,"core-js/modules/web.dom-collections.for-each":225,"core-js/modules/web.dom-collections.iterator":226}],313:[function(e,t,n){"use strict";e("core-js/modules/es.symbol"),e("core-js/modules/es.symbol.description"),e("core-js/modules/es.symbol.iterator"),e("core-js/modules/es.array.fill"),e("core-js/modules/es.array.iterator"),e("core-js/modules/es.object.keys"),e("core-js/modules/es.object.to-string"),e("core-js/modules/es.string.iterator"),e("core-js/modules/es.typed-array.float32-array"),e("core-js/modules/es.typed-array.uint16-array"),e("core-js/modules/es.typed-array.copy-within"),e("core-js/modules/es.typed-array.every"),e("core-js/modules/es.typed-array.fill"),e("core-js/modules/es.typed-array.filter"),e("core-js/modules/es.typed-array.find"),e("core-js/modules/es.typed-array.find-index"),e("core-js/modules/es.typed-array.for-each"),e("core-js/modules/es.typed-array.includes"),e("core-js/modules/es.typed-array.index-of"),e("core-js/modules/es.typed-array.iterator"),e("core-js/modules/es.typed-array.join"),e("core-js/modules/es.typed-array.last-index-of"),e("core-js/modules/es.typed-array.map"),e("core-js/modules/es.typed-array.reduce"),e("core-js/modules/es.typed-array.reduce-right"),e("core-js/modules/es.typed-array.reverse"),e("core-js/modules/es.typed-array.set"),e("core-js/modules/es.typed-array.slice"),e("core-js/modules/es.typed-array.some"),e("core-js/modules/es.typed-array.sort"),e("core-js/modules/es.typed-array.subarray"),e("core-js/modules/es.typed-array.to-locale-string"),e("core-js/modules/es.typed-array.to-string"),e("core-js/modules/web.dom-collections.iterator"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=(r=e("../core/main"))&&r.__esModule?r:{default:r};e("./p5.RendererGL"),e("./p5.RenderBuffer");var a=0;i.default.RendererGL.prototype._initBufferDefaults=function(e){if(this._freeBuffers(e),1e3<++a){var t=Object.keys(this.retainedMode.geometry)[0];delete this.retainedMode.geometry[t],a--}return this.retainedMode.geometry[e]={}},i.default.RendererGL.prototype._freeBuffers=function(e){var t=this.retainedMode.geometry[e];if(t){delete this.retainedMode.geometry[e],a--;var n=this.GL;t.indexBuffer&&n.deleteBuffer(t.indexBuffer),r(this.retainedMode.buffers.stroke),r(this.retainedMode.buffers.fill)}function r(e){var r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value;t[u.dst]&&(n.deleteBuffer(t[u.dst]),t[u.dst]=null)}}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}}},i.default.RendererGL.prototype.createBuffers=function(e,t){var n=this.GL,r=this._initBufferDefaults(e);r.model=t;var a=r.indexBuffer;if(t.faces.length){a=a||(r.indexBuffer=n.createBuffer());var o=i.default.RendererGL.prototype._flatten(t.faces);this._bindBuffer(a,n.ELEMENT_ARRAY_BUFFER,o,Uint16Array),r.vertexCount=3*t.faces.length}else a&&(n.deleteBuffer(a),r.indexBuffer=null),r.vertexCount=t.vertices?t.vertices.length:0;return r.lineVertexCount=t.lineVertices?t.lineVertices.length:0,r},i.default.RendererGL.prototype.drawBuffers=function(e){var t=this.GL,n=this.retainedMode.geometry[e];if(this._doStroke&&0<n.lineVertexCount){var r=this._getRetainedStrokeShader();this._setStrokeUniforms(r);var i=!0,a=!1,o=void 0;try{for(var s,u=this.retainedMode.buffers.stroke[Symbol.iterator]();!(i=(s=u.next()).done);i=!0)s.value._prepareBuffer(n,r)}catch(e){a=!0,o=e}finally{try{i||null==u.return||u.return()}finally{if(a)throw o}}this._applyColorBlend(this.curStrokeColor),this._drawArrays(t.TRIANGLES,e),r.unbindShader()}if(this._doFill){var c=this._getRetainedFillShader();this._setFillUniforms(c);var l=!0,f=!1,d=void 0;try{for(var h,p=this.retainedMode.buffers.fill[Symbol.iterator]();!(l=(h=p.next()).done);l=!0)h.value._prepareBuffer(n,c)}catch(e){f=!0,d=e}finally{try{l||null==p.return||p.return()}finally{if(f)throw d}}n.indexBuffer&&this._bindBuffer(n.indexBuffer,t.ELEMENT_ARRAY_BUFFER),this._applyColorBlend(this.curFillColor),this._drawElements(t.TRIANGLES,e),c.unbindShader()}return this},i.default.RendererGL.prototype.drawBuffersScaled=function(e,t,n,r){var i=this.uMVMatrix.copy();try{this.uMVMatrix.scale(t,n,r),this.drawBuffers(e)}finally{this.uMVMatrix=i}},i.default.RendererGL.prototype._drawArrays=function(e,t){return this.GL.drawArrays(e,0,this.retainedMode.geometry[t].lineVertexCount),this},i.default.RendererGL.prototype._drawElements=function(e,t){var n=this.retainedMode.geometry[t],r=this.GL;n.indexBuffer?r.drawElements(r.TRIANGLES,n.vertexCount,r.UNSIGNED_SHORT,0):r.drawArrays(e||r.TRIANGLES,0,n.vertexCount)},i.default.RendererGL.prototype._drawPoints=function(e,t){var n=this.GL,r=this._getImmediatePointShader();this._setPointUniforms(r),this._bindBuffer(t,n.ARRAY_BUFFER,this._vToNArray(e),Float32Array,n.STATIC_DRAW),r.enableAttrib(r.attributes.aPosition,3),n.drawArrays(n.Points,0,e.length),r.unbindShader()};var o=i.default.RendererGL;n.default=o},{"../core/main":260,"./p5.RenderBuffer":311,"./p5.RendererGL":314,"core-js/modules/es.array.fill":150,"core-js/modules/es.array.iterator":156,"core-js/modules/es.object.keys":173,"core-js/modules/es.object.to-string":174,"core-js/modules/es.string.iterator":183,"core-js/modules/es.symbol":193,"core-js/modules/es.symbol.description":191,"core-js/modules/es.symbol.iterator":192,"core-js/modules/es.typed-array.copy-within":194,"core-js/modules/es.typed-array.every":195,"core-js/modules/es.typed-array.fill":196,"core-js/modules/es.typed-array.filter":197,"core-js/modules/es.typed-array.find":199,"core-js/modules/es.typed-array.find-index":198,"core-js/modules/es.typed-array.float32-array":200,"core-js/modules/es.typed-array.for-each":202,"core-js/modules/es.typed-array.includes":203,"core-js/modules/es.typed-array.index-of":204,"core-js/modules/es.typed-array.iterator":207,"core-js/modules/es.typed-array.join":208,"core-js/modules/es.typed-array.last-index-of":209,"core-js/modules/es.typed-array.map":210,"core-js/modules/es.typed-array.reduce":212,"core-js/modules/es.typed-array.reduce-right":211,"core-js/modules/es.typed-array.reverse":213,"core-js/modules/es.typed-array.set":214,"core-js/modules/es.typed-array.slice":215,"core-js/modules/es.typed-array.some":216,"core-js/modules/es.typed-array.sort":217,"core-js/modules/es.typed-array.subarray":218,"core-js/modules/es.typed-array.to-locale-string":219,"core-js/modules/es.typed-array.to-string":220,"core-js/modules/es.typed-array.uint16-array":221,"core-js/modules/web.dom-collections.iterator":226}],314:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e("core-js/modules/es.symbol"),e("core-js/modules/es.symbol.description"),e("core-js/modules/es.symbol.iterator"),e("core-js/modules/es.array.concat"),e("core-js/modules/es.array.fill"),e("core-js/modules/es.array.filter"),e("core-js/modules/es.array.from"),e("core-js/modules/es.array.includes"),e("core-js/modules/es.array.iterator"),e("core-js/modules/es.array.slice"),e("core-js/modules/es.object.assign"),e("core-js/modules/es.object.to-string"),e("core-js/modules/es.regexp.to-string"),e("core-js/modules/es.string.includes"),e("core-js/modules/es.string.iterator"),e("core-js/modules/es.typed-array.float32-array"),e("core-js/modules/es.typed-array.float64-array"),e("core-js/modules/es.typed-array.int16-array"),e("core-js/modules/es.typed-array.uint8-array"),e("core-js/modules/es.typed-array.uint16-array"),e("core-js/modules/es.typed-array.uint32-array"),e("core-js/modules/es.typed-array.copy-within"),e("core-js/modules/es.typed-array.every"),e("core-js/modules/es.typed-array.fill"),e("core-js/modules/es.typed-array.filter"),e("core-js/modules/es.typed-array.find"),e("core-js/modules/es.typed-array.find-index"),e("core-js/modules/es.typed-array.for-each"),e("core-js/modules/es.typed-array.includes"),e("core-js/modules/es.typed-array.index-of"),e("core-js/modules/es.typed-array.iterator"),e("core-js/modules/es.typed-array.join"),e("core-js/modules/es.typed-array.last-index-of"),e("core-js/modules/es.typed-array.map"),e("core-js/modules/es.typed-array.reduce"),e("core-js/modules/es.typed-array.reduce-right"),e("core-js/modules/es.typed-array.reverse"),e("core-js/modules/es.typed-array.set"),e("core-js/modules/es.typed-array.slice"),e("core-js/modules/es.typed-array.some"),e("core-js/modules/es.typed-array.sort"),e("core-js/modules/es.typed-array.subarray"),e("core-js/modules/es.typed-array.to-locale-string"),e("core-js/modules/es.typed-array.to-string"),e("core-js/modules/web.dom-collections.iterator"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=s(e("../core/main")),a=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var t="function"!=typeof WeakMap?null:new WeakMap;if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,t&&t.set(e,n),n}(e("../core/constants")),o=s(e("libtess"));function s(e){return e&&e.__esModule?e:{default:e}}function u(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}e("./p5.Shader"),e("./p5.Camera"),e("../core/p5.Renderer"),e("./p5.Matrix"),e("path");var c="precision highp float;\nprecision highp int;\n\nuniform mat4 uViewMatrix;\n\nuniform bool uUseLighting;\n\nuniform int uAmbientLightCount;\nuniform vec3 uAmbientColor[5];\n\nuniform int uDirectionalLightCount;\nuniform vec3 uLightingDirection[5];\nuniform vec3 uDirectionalDiffuseColors[5];\nuniform vec3 uDirectionalSpecularColors[5];\n\nuniform int uPointLightCount;\nuniform vec3 uPointLightLocation[5];\nuniform vec3 uPointLightDiffuseColors[5];\t\nuniform vec3 uPointLightSpecularColors[5];\n\nuniform int uSpotLightCount;\nuniform float uSpotLightAngle[5];\nuniform float uSpotLightConc[5];\nuniform vec3 uSpotLightDiffuseColors[5];\nuniform vec3 uSpotLightSpecularColors[5];\nuniform vec3 uSpotLightLocation[5];\nuniform vec3 uSpotLightDirection[5];\n\nuniform bool uSpecular;\nuniform float uShininess;\n\nuniform float uConstantAttenuation;\nuniform float uLinearAttenuation;\nuniform float uQuadraticAttenuation;\n\nconst float specularFactor = 2.0;\nconst float diffuseFactor = 0.73;\n\nstruct LightResult {\n  float specular;\n  float diffuse;\n};\n\nfloat _phongSpecular(\n  vec3 lightDirection,\n  vec3 viewDirection,\n  vec3 surfaceNormal,\n  float shininess) {\n\n  vec3 R = reflect(lightDirection, surfaceNormal);\n  return pow(max(0.0, dot(R, viewDirection)), shininess);\n}\n\nfloat _lambertDiffuse(vec3 lightDirection, vec3 surfaceNormal) {\n  return max(0.0, dot(-lightDirection, surfaceNormal));\n}\n\nLightResult _light(vec3 viewDirection, vec3 normal, vec3 lightVector) {\n\n  vec3 lightDir = normalize(lightVector);\n\n  //compute our diffuse & specular terms\n  LightResult lr;\n  if (uSpecular)\n    lr.specular = _phongSpecular(lightDir, viewDirection, normal, uShininess);\n  lr.diffuse = _lambertDiffuse(lightDir, normal);\n  return lr;\n}\n\nvoid totalLight(\n  vec3 modelPosition,\n  vec3 normal,\n  out vec3 totalDiffuse,\n  out vec3 totalSpecular\n) {\n\n  totalSpecular = vec3(0.0);\n\n  if (!uUseLighting) {\n    totalDiffuse = vec3(1.0);\n    return;\n  }\n\n  totalDiffuse = vec3(0.0);\n\n  vec3 viewDirection = normalize(-modelPosition);\n\n  for (int j = 0; j < 5; j++) {\n    if (j < uDirectionalLightCount) {\n      vec3 lightVector = (uViewMatrix * vec4(uLightingDirection[j], 0.0)).xyz;\n      vec3 lightColor = uDirectionalDiffuseColors[j];\n      vec3 specularColor = uDirectionalSpecularColors[j];\n      LightResult result = _light(viewDirection, normal, lightVector);\n      totalDiffuse += result.diffuse * lightColor;\n      totalSpecular += result.specular * lightColor * specularColor;\n    }\n\n    if (j < uPointLightCount) {\n      vec3 lightPosition = (uViewMatrix * vec4(uPointLightLocation[j], 1.0)).xyz;\n      vec3 lightVector = modelPosition - lightPosition;\n    \n      //calculate attenuation\n      float lightDistance = length(lightVector);\n      float lightFalloff = 1.0 / (uConstantAttenuation + lightDistance * uLinearAttenuation + (lightDistance * lightDistance) * uQuadraticAttenuation);\n      vec3 lightColor = lightFalloff * uPointLightDiffuseColors[j];\n      vec3 specularColor = lightFalloff * uPointLightSpecularColors[j];\n\n      LightResult result = _light(viewDirection, normal, lightVector);\n      totalDiffuse += result.diffuse * lightColor;\n      totalSpecular += result.specular * lightColor * specularColor;\n    }\n\n    if(j < uSpotLightCount) {\n      vec3 lightPosition = (uViewMatrix * vec4(uSpotLightLocation[j], 1.0)).xyz;\n      vec3 lightVector = modelPosition - lightPosition;\n    \n      float lightDistance = length(lightVector);\n      float lightFalloff = 1.0 / (uConstantAttenuation + lightDistance * uLinearAttenuation + (lightDistance * lightDistance) * uQuadraticAttenuation);\n\n      vec3 lightDirection = (uViewMatrix * vec4(uSpotLightDirection[j], 0.0)).xyz;\n      float spotDot = dot(normalize(lightVector), normalize(lightDirection));\n      float spotFalloff;\n      if(spotDot < uSpotLightAngle[j]) {\n        spotFalloff = 0.0;\n      }\n      else {\n        spotFalloff = pow(spotDot, uSpotLightConc[j]);\n      }\n      lightFalloff *= spotFalloff;\n\n      vec3 lightColor = uSpotLightDiffuseColors[j];\n      vec3 specularColor = uSpotLightSpecularColors[j];\n     \n      LightResult result = _light(viewDirection, normal, lightVector);\n      \n      totalDiffuse += result.diffuse * lightColor * lightFalloff;\n      totalSpecular += result.specular * lightColor * specularColor * lightFalloff;\n    }\n  }\n\n  totalDiffuse *= diffuseFactor;\n  totalSpecular *= specularFactor;\n}\n",l={immediateVert:"attribute vec3 aPosition;\nattribute vec4 aVertexColor;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\nuniform float uResolution;\nuniform float uPointSize;\n\nvarying vec4 vColor;\nvoid main(void) {\n  vec4 positionVec4 = vec4(aPosition, 1.0);\n  gl_Position = uProjectionMatrix * uModelViewMatrix * positionVec4;\n  vColor = aVertexColor;\n  gl_PointSize = uPointSize;\n}\n",vertexColorVert:"attribute vec3 aPosition;\nattribute vec4 aVertexColor;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  vec4 positionVec4 = vec4(aPosition, 1.0);\n  gl_Position = uProjectionMatrix * uModelViewMatrix * positionVec4;\n  vColor = aVertexColor;\n}\n",vertexColorFrag:"precision mediump float;\nvarying vec4 vColor;\nvoid main(void) {\n  gl_FragColor = vColor;\n}",normalVert:"attribute vec3 aPosition;\nattribute vec3 aNormal;\nattribute vec2 aTexCoord;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\nuniform mat3 uNormalMatrix;\n\nvarying vec3 vVertexNormal;\nvarying highp vec2 vVertTexCoord;\n\nvoid main(void) {\n  vec4 positionVec4 = vec4(aPosition, 1.0);\n  gl_Position = uProjectionMatrix * uModelViewMatrix * positionVec4;\n  vVertexNormal = normalize(vec3( uNormalMatrix * aNormal ));\n  vVertTexCoord = aTexCoord;\n}\n",normalFrag:"precision mediump float;\nvarying vec3 vVertexNormal;\nvoid main(void) {\n  gl_FragColor = vec4(vVertexNormal, 1.0);\n}",basicFrag:"precision mediump float;\nuniform vec4 uMaterialColor;\nvoid main(void) {\n  gl_FragColor = uMaterialColor;\n}",lightVert:c+"// include lighting.glgl\n\nattribute vec3 aPosition;\nattribute vec3 aNormal;\nattribute vec2 aTexCoord;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\nuniform mat3 uNormalMatrix;\n\nvarying highp vec2 vVertTexCoord;\nvarying vec3 vDiffuseColor;\nvarying vec3 vSpecularColor;\n\nvoid main(void) {\n\n  vec4 viewModelPosition = uModelViewMatrix * vec4(aPosition, 1.0);\n  gl_Position = uProjectionMatrix * viewModelPosition;\n\n  vec3 vertexNormal = normalize(uNormalMatrix * aNormal);\n  vVertTexCoord = aTexCoord;\n\n  totalLight(viewModelPosition.xyz, vertexNormal, vDiffuseColor, vSpecularColor);\n\n  for (int i = 0; i < 8; i++) {\n    if (i < uAmbientLightCount) {\n      vDiffuseColor += uAmbientColor[i];\n    }\n  }\n}\n",lightTextureFrag:"precision highp float;\n\nuniform vec4 uMaterialColor;\nuniform vec4 uTint;\nuniform sampler2D uSampler;\nuniform bool isTexture;\nuniform bool uEmissive;\n\nvarying highp vec2 vVertTexCoord;\nvarying vec3 vDiffuseColor;\nvarying vec3 vSpecularColor;\n\nvoid main(void) {\n  if(uEmissive && !isTexture) {\n    gl_FragColor = uMaterialColor;\n  }\n  else {\n    gl_FragColor = isTexture ? texture2D(uSampler, vVertTexCoord) * (uTint / vec4(255, 255, 255, 255)) : uMaterialColor;\n    gl_FragColor.rgb = gl_FragColor.rgb * vDiffuseColor + vSpecularColor;\n  }\n}",phongVert:"precision highp float;\nprecision highp int;\n\nattribute vec3 aPosition;\nattribute vec3 aNormal;\nattribute vec2 aTexCoord;\n\nuniform vec3 uAmbientColor[5];\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\nuniform mat3 uNormalMatrix;\nuniform int uAmbientLightCount;\n\nvarying vec3 vNormal;\nvarying vec2 vTexCoord;\nvarying vec3 vViewPosition;\nvarying vec3 vAmbientColor;\n\nvoid main(void) {\n\n  vec4 viewModelPosition = uModelViewMatrix * vec4(aPosition, 1.0);\n\n  // Pass varyings to fragment shader\n  vViewPosition = viewModelPosition.xyz;\n  gl_Position = uProjectionMatrix * viewModelPosition;  \n\n  vNormal = uNormalMatrix * aNormal;\n  vTexCoord = aTexCoord;\n\n  // TODO: this should be a uniform\n  vAmbientColor = vec3(0.0);\n  for (int i = 0; i < 5; i++) {\n    if (i < uAmbientLightCount) {\n      vAmbientColor += uAmbientColor[i];\n    }\n  }\n}\n",phongFrag:c+"// include lighting.glsl\nprecision highp float;\nprecision highp int;\n\nuniform vec4 uMaterialColor;\nuniform vec4 uTint;\nuniform sampler2D uSampler;\nuniform bool isTexture;\nuniform bool uEmissive;\n\nvarying vec3 vNormal;\nvarying vec2 vTexCoord;\nvarying vec3 vViewPosition;\nvarying vec3 vAmbientColor;\n\nvoid main(void) {\n\n  vec3 diffuse;\n  vec3 specular;\n  totalLight(vViewPosition, normalize(vNormal), diffuse, specular);\n\n  if(uEmissive && !isTexture) {\n    gl_FragColor = uMaterialColor;\n  }\n  else {\n    gl_FragColor = isTexture ? texture2D(uSampler, vTexCoord) * (uTint / vec4(255, 255, 255, 255)) : uMaterialColor;\n    gl_FragColor.rgb = gl_FragColor.rgb * (diffuse + vAmbientColor) + specular;\n  }\n}",fontVert:"precision mediump float;\n\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nuniform vec4 uGlyphRect;\nuniform float uGlyphOffset;\n\nvarying vec2 vTexCoord;\nvarying float w;\n\nvoid main() {\n  vec4 positionVec4 = vec4(aPosition, 1.0);\n\n  // scale by the size of the glyph's rectangle\n  positionVec4.xy *= uGlyphRect.zw - uGlyphRect.xy;\n\n  // move to the corner of the glyph\n  positionVec4.xy += uGlyphRect.xy;\n\n  // move to the letter's line offset\n  positionVec4.x += uGlyphOffset;\n  \n  gl_Position = uProjectionMatrix * uModelViewMatrix * positionVec4;\n  vTexCoord = aTexCoord;\n  w = gl_Position.w;\n}\n",fontFrag:"#extension GL_OES_standard_derivatives : enable\nprecision mediump float;\n\n#if 0\n  // simulate integer math using floats\n\t#define int float\n\t#define ivec2 vec2\n\t#define INT(x) float(x)\n\n\tint ifloor(float v) { return floor(v); }\n\tivec2 ifloor(vec2 v) { return floor(v); }\n\n#else\n  // use native integer math\n\tprecision highp int;\n\t#define INT(x) x\n\n\tint ifloor(float v) { return int(v); }\n\tint ifloor(int v) { return v; }\n\tivec2 ifloor(vec2 v) { return ivec2(v); }\n\n#endif\n\nuniform sampler2D uSamplerStrokes;\nuniform sampler2D uSamplerRowStrokes;\nuniform sampler2D uSamplerRows;\nuniform sampler2D uSamplerColStrokes;\nuniform sampler2D uSamplerCols;\n\nuniform ivec2 uStrokeImageSize;\nuniform ivec2 uCellsImageSize;\nuniform ivec2 uGridImageSize;\n\nuniform ivec2 uGridOffset;\nuniform ivec2 uGridSize;\nuniform vec4 uMaterialColor;\n\nvarying vec2 vTexCoord;\n\n// some helper functions\nint round(float v) { return ifloor(v + 0.5); }\nivec2 round(vec2 v) { return ifloor(v + 0.5); }\nfloat saturate(float v) { return clamp(v, 0.0, 1.0); }\nvec2 saturate(vec2 v) { return clamp(v, 0.0, 1.0); }\n\nint mul(float v1, int v2) {\n  return ifloor(v1 * float(v2));\n}\n\nivec2 mul(vec2 v1, ivec2 v2) {\n  return ifloor(v1 * vec2(v2) + 0.5);\n}\n\n// unpack a 16-bit integer from a float vec2\nint getInt16(vec2 v) {\n  ivec2 iv = round(v * 255.0);\n  return iv.x * INT(128) + iv.y;\n}\n\nvec2 pixelScale;\nvec2 coverage = vec2(0.0);\nvec2 weight = vec2(0.5);\nconst float minDistance = 1.0/8192.0;\nconst float hardness = 1.05; // amount of antialias\n\n// the maximum number of curves in a glyph\nconst int N = INT(250);\n\n// retrieves an indexed pixel from a sampler\nvec4 getTexel(sampler2D sampler, int pos, ivec2 size) {\n  int width = size.x;\n  int y = ifloor(pos / width);\n  int x = pos - y * width;  // pos % width\n\n  return texture2D(sampler, (vec2(x, y) + 0.5) / vec2(size));\n}\n\nvoid calulateCrossings(vec2 p0, vec2 p1, vec2 p2, out vec2 C1, out vec2 C2) {\n\n  // get the coefficients of the quadratic in t\n  vec2 a = p0 - p1 * 2.0 + p2;\n  vec2 b = p0 - p1;\n  vec2 c = p0 - vTexCoord;\n\n  // found out which values of 't' it crosses the axes\n  vec2 surd = sqrt(max(vec2(0.0), b * b - a * c));\n  vec2 t1 = ((b - surd) / a).yx;\n  vec2 t2 = ((b + surd) / a).yx;\n\n  // approximate straight lines to avoid rounding errors\n  if (abs(a.y) < 0.001)\n    t1.x = t2.x = c.y / (2.0 * b.y);\n\n  if (abs(a.x) < 0.001)\n    t1.y = t2.y = c.x / (2.0 * b.x);\n\n  // plug into quadratic formula to find the corrdinates of the crossings\n  C1 = ((a * t1 - b * 2.0) * t1 + c) * pixelScale;\n  C2 = ((a * t2 - b * 2.0) * t2 + c) * pixelScale;\n}\n\nvoid coverageX(vec2 p0, vec2 p1, vec2 p2) {\n\n  vec2 C1, C2;\n  calulateCrossings(p0, p1, p2, C1, C2);\n\n  // determine on which side of the x-axis the points lie\n  bool y0 = p0.y > vTexCoord.y;\n  bool y1 = p1.y > vTexCoord.y;\n  bool y2 = p2.y > vTexCoord.y;\n\n  // could web be under the curve (after t1)?\n  if (y1 ? !y2 : y0) {\n    // add the coverage for t1\n    coverage.x += saturate(C1.x + 0.5);\n    // calculate the anti-aliasing for t1\n    weight.x = min(weight.x, abs(C1.x));\n  }\n\n  // are we outside the curve (after t2)?\n  if (y1 ? !y0 : y2) {\n    // subtract the coverage for t2\n    coverage.x -= saturate(C2.x + 0.5);\n    // calculate the anti-aliasing for t2\n    weight.x = min(weight.x, abs(C2.x));\n  }\n}\n\n// this is essentially the same as coverageX, but with the axes swapped\nvoid coverageY(vec2 p0, vec2 p1, vec2 p2) {\n\n  vec2 C1, C2;\n  calulateCrossings(p0, p1, p2, C1, C2);\n\n  bool x0 = p0.x > vTexCoord.x;\n  bool x1 = p1.x > vTexCoord.x;\n  bool x2 = p2.x > vTexCoord.x;\n\n  if (x1 ? !x2 : x0) {\n    coverage.y -= saturate(C1.y + 0.5);\n    weight.y = min(weight.y, abs(C1.y));\n  }\n\n  if (x1 ? !x0 : x2) {\n    coverage.y += saturate(C2.y + 0.5);\n    weight.y = min(weight.y, abs(C2.y));\n  }\n}\n\nvoid main() {\n\n  // calculate the pixel scale based on screen-coordinates\n  pixelScale = hardness / fwidth(vTexCoord);\n\n  // which grid cell is this pixel in?\n  ivec2 gridCoord = ifloor(vTexCoord * vec2(uGridSize));\n\n  // intersect curves in this row\n  {\n    // the index into the row info bitmap\n    int rowIndex = gridCoord.y + uGridOffset.y;\n    // fetch the info texel\n    vec4 rowInfo = getTexel(uSamplerRows, rowIndex, uGridImageSize);\n    // unpack the rowInfo\n    int rowStrokeIndex = getInt16(rowInfo.xy);\n    int rowStrokeCount = getInt16(rowInfo.zw);\n\n    for (int iRowStroke = INT(0); iRowStroke < N; iRowStroke++) {\n      if (iRowStroke >= rowStrokeCount)\n        break;\n\n      // each stroke is made up of 3 points: the start and control point\n      // and the start of the next curve.\n      // fetch the indices of this pair of strokes:\n      vec4 strokeIndices = getTexel(uSamplerRowStrokes, rowStrokeIndex++, uCellsImageSize);\n\n      // unpack the stroke index\n      int strokePos = getInt16(strokeIndices.xy);\n\n      // fetch the two strokes\n      vec4 stroke0 = getTexel(uSamplerStrokes, strokePos + INT(0), uStrokeImageSize);\n      vec4 stroke1 = getTexel(uSamplerStrokes, strokePos + INT(1), uStrokeImageSize);\n\n      // calculate the coverage\n      coverageX(stroke0.xy, stroke0.zw, stroke1.xy);\n    }\n  }\n\n  // intersect curves in this column\n  {\n    int colIndex = gridCoord.x + uGridOffset.x;\n    vec4 colInfo = getTexel(uSamplerCols, colIndex, uGridImageSize);\n    int colStrokeIndex = getInt16(colInfo.xy);\n    int colStrokeCount = getInt16(colInfo.zw);\n    \n    for (int iColStroke = INT(0); iColStroke < N; iColStroke++) {\n      if (iColStroke >= colStrokeCount)\n        break;\n\n      vec4 strokeIndices = getTexel(uSamplerColStrokes, colStrokeIndex++, uCellsImageSize);\n\n      int strokePos = getInt16(strokeIndices.xy);\n      vec4 stroke0 = getTexel(uSamplerStrokes, strokePos + INT(0), uStrokeImageSize);\n      vec4 stroke1 = getTexel(uSamplerStrokes, strokePos + INT(1), uStrokeImageSize);\n      coverageY(stroke0.xy, stroke0.zw, stroke1.xy);\n    }\n  }\n\n  weight = saturate(1.0 - weight * 2.0);\n  float distance = max(weight.x + weight.y, minDistance); // manhattan approx.\n  float antialias = abs(dot(coverage, weight) / distance);\n  float cover = min(abs(coverage.x), abs(coverage.y));\n  gl_FragColor = uMaterialColor;\n  gl_FragColor.a *= saturate(max(antialias, cover));\n}",lineVert:"/*\n  Part of the Processing project - http://processing.org\n  Copyright (c) 2012-15 The Processing Foundation\n  Copyright (c) 2004-12 Ben Fry and Casey Reas\n  Copyright (c) 2001-04 Massachusetts Institute of Technology\n  This library is free software; you can redistribute it and/or\n  modify it under the terms of the GNU Lesser General Public\n  License as published by the Free Software Foundation, version 2.1.\n  This library is distributed in the hope that it will be useful,\n  but WITHOUT ANY WARRANTY; without even the implied warranty of\n  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n  Lesser General Public License for more details.\n  You should have received a copy of the GNU Lesser General\n  Public License along with this library; if not, write to the\n  Free Software Foundation, Inc., 59 Temple Place, Suite 330,\n  Boston, MA  02111-1307  USA\n*/\n\n#define PROCESSING_LINE_SHADER\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\nuniform float uStrokeWeight;\n\nuniform vec4 uViewport;\nuniform int uPerspective;\n\nattribute vec4 aPosition;\nattribute vec4 aDirection;\n  \nvoid main() {\n  // using a scale <1 moves the lines towards the camera\n  // in order to prevent popping effects due to half of\n  // the line disappearing behind the geometry faces.\n  vec3 scale = vec3(0.9995);\n\n  vec4 posp = uModelViewMatrix * aPosition;\n  vec4 posq = uModelViewMatrix * (aPosition + vec4(aDirection.xyz, 0));\n\n  // Moving vertices slightly toward the camera\n  // to avoid depth-fighting with the fill triangles.\n  // Discussed here:\n  // http://www.opengl.org/discussion_boards/ubbthreads.php?ubb=showflat&Number=252848  \n  posp.xyz = posp.xyz * scale;\n  posq.xyz = posq.xyz * scale;\n\n  vec4 p = uProjectionMatrix * posp;\n  vec4 q = uProjectionMatrix * posq;\n\n  // formula to convert from clip space (range -1..1) to screen space (range 0..[width or height])\n  // screen_p = (p.xy/p.w + <1,1>) * 0.5 * uViewport.zw\n\n  // prevent division by W by transforming the tangent formula (div by 0 causes\n  // the line to disappear, see https://github.com/processing/processing/issues/5183)\n  // t = screen_q - screen_p\n  //\n  // tangent is normalized and we don't care which aDirection it points to (+-)\n  // t = +- normalize( screen_q - screen_p )\n  // t = +- normalize( (q.xy/q.w+<1,1>)*0.5*uViewport.zw - (p.xy/p.w+<1,1>)*0.5*uViewport.zw )\n  //\n  // extract common factor, <1,1> - <1,1> cancels out\n  // t = +- normalize( (q.xy/q.w - p.xy/p.w) * 0.5 * uViewport.zw )\n  //\n  // convert to common divisor\n  // t = +- normalize( ((q.xy*p.w - p.xy*q.w) / (p.w*q.w)) * 0.5 * uViewport.zw )\n  //\n  // remove the common scalar divisor/factor, not needed due to normalize and +-\n  // (keep uViewport - can't remove because it has different components for x and y\n  //  and corrects for aspect ratio, see https://github.com/processing/processing/issues/5181)\n  // t = +- normalize( (q.xy*p.w - p.xy*q.w) * uViewport.zw )\n\n  vec2 tangent = normalize((q.xy*p.w - p.xy*q.w) * uViewport.zw);\n\n  // flip tangent to normal (it's already normalized)\n  vec2 normal = vec2(-tangent.y, tangent.x);\n\n  float thickness = aDirection.w * uStrokeWeight;\n  vec2 offset = normal * thickness / 2.0;\n\n  vec2 curPerspScale;\n\n  if(uPerspective == 1) {\n    // Perspective ---\n    // convert from world to clip by multiplying with projection scaling factor\n    // to get the right thickness (see https://github.com/processing/processing/issues/5182)\n    // invert Y, projections in Processing invert Y\n    curPerspScale = (uProjectionMatrix * vec4(1, -1, 0, 0)).xy;\n  } else {\n    // No Perspective ---\n    // multiply by W (to cancel out division by W later in the pipeline) and\n    // convert from screen to clip (derived from clip to screen above)\n    curPerspScale = p.w / (0.5 * uViewport.zw);\n  }\n\n  gl_Position.xy = p.xy + offset.xy * curPerspScale;\n  gl_Position.zw = p.zw;\n}\n",lineFrag:"precision mediump float;\nprecision mediump int;\n\nuniform vec4 uMaterialColor;\n\nvoid main() {\n  gl_FragColor = uMaterialColor;\n}",pointVert:"attribute vec3 aPosition;\nuniform float uPointSize;\nvarying float vStrokeWeight;\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\nvoid main() {\n\tvec4 positionVec4 =  vec4(aPosition, 1.0);\n\tgl_Position = uProjectionMatrix * uModelViewMatrix * positionVec4;\n\tgl_PointSize = uPointSize;\n\tvStrokeWeight = uPointSize;\n}",pointFrag:"precision mediump float;\nprecision mediump int;\nuniform vec4 uMaterialColor;\nvarying float vStrokeWeight;\n\nvoid main(){\n\tfloat mask = 0.0;\n\n\t// make a circular mask using the gl_PointCoord (goes from 0 - 1 on a point)\n    // might be able to get a nicer edge on big strokeweights with smoothstep but slightly less performant\n\n\tmask = step(0.98, length(gl_PointCoord * 2.0 - 1.0));\n\n\t// if strokeWeight is 1 or less lets just draw a square\n\t// this prevents weird artifacting from carving circles when our points are really small\n\t// if strokeWeight is larger than 1, we just use it as is\n\n\tmask = mix(0.0, mask, clamp(floor(vStrokeWeight - 0.5),0.0,1.0));\n\n\t// throw away the borders of the mask\n    // otherwise we get weird alpha blending issues\n\n\tif(mask > 0.98){\n      discard;\n  \t}\n\n  \tgl_FragColor = vec4(uMaterialColor.rgb * (1.0 - mask), uMaterialColor.a) ;\n}"};i.default.RendererGL=function(e,t,n,r){return i.default.Renderer.call(this,e,t,n),this._setAttributeDefaults(t),this._initContext(),this.isP3D=!0,this.GL=this.drawingContext,this._pInst._setProperty("drawingContext",this.drawingContext),this._isErasing=!1,this._enableLighting=!1,this.ambientLightColors=[],this.specularColors=[1,1,1],this.directionalLightDirections=[],this.directionalLightDiffuseColors=[],this.directionalLightSpecularColors=[],this.pointLightPositions=[],this.pointLightDiffuseColors=[],this.pointLightSpecularColors=[],this.spotLightPositions=[],this.spotLightDirections=[],this.spotLightDiffuseColors=[],this.spotLightSpecularColors=[],this.spotLightAngle=[],this.spotLightConc=[],this.drawMode=a.FILL,this.curFillColor=this._cachedFillStyle=[1,1,1,1],this.curStrokeColor=this._cachedStrokeStyle=[0,0,0,1],this.curBlendMode=a.BLEND,this._cachedBlendMode=void 0,this.blendExt=this.GL.getExtension("EXT_blend_minmax"),this._isBlending=!1,this._useSpecularMaterial=!1,this._useEmissiveMaterial=!1,this._useNormalMaterial=!1,this._useShininess=1,this._tint=[255,255,255,255],this.constantAttenuation=1,this.linearAttenuation=0,this.quadraticAttenuation=0,this.uMVMatrix=new i.default.Matrix,this.uPMatrix=new i.default.Matrix,this.uNMatrix=new i.default.Matrix("mat3"),this._curCamera=new i.default.Camera(this),this._curCamera._computeCameraDefaultSettings(),this._curCamera._setDefaultCamera(),this._defaultLightShader=void 0,this._defaultImmediateModeShader=void 0,this._defaultNormalShader=void 0,this._defaultColorShader=void 0,this._defaultPointShader=void 0,this.userFillShader=void 0,this.userStrokeShader=void 0,this.userPointShader=void 0,this.retainedMode={geometry:{},buffers:{stroke:[new i.default.RenderBuffer(3,"lineVertices","lineVertexBuffer","aPosition",this,this._flatten),new i.default.RenderBuffer(4,"lineNormals","lineNormalBuffer","aDirection",this,this._flatten)],fill:[new i.default.RenderBuffer(3,"vertices","vertexBuffer","aPosition",this,this._vToNArray),new i.default.RenderBuffer(3,"vertexNormals","normalBuffer","aNormal",this,this._vToNArray),new i.default.RenderBuffer(4,"vertexColors","colorBuffer","aMaterialColor",this),new i.default.RenderBuffer(3,"vertexAmbients","ambientBuffer","aAmbientColor",this),new i.default.RenderBuffer(2,"uvs","uvBuffer","aTexCoord",this,this._flatten)],text:[new i.default.RenderBuffer(3,"vertices","vertexBuffer","aPosition",this,this._vToNArray),new i.default.RenderBuffer(2,"uvs","uvBuffer","aTexCoord",this,this._flatten)]}},this.immediateMode={geometry:new i.default.Geometry,shapeMode:a.TRIANGLE_FAN,_bezierVertex:[],_quadraticVertex:[],_curveVertex:[],buffers:{fill:[new i.default.RenderBuffer(3,"vertices","vertexBuffer","aPosition",this,this._vToNArray),new i.default.RenderBuffer(3,"vertexNormals","normalBuffer","aNormal",this,this._vToNArray),new i.default.RenderBuffer(4,"vertexColors","colorBuffer","aVertexColor",this),new i.default.RenderBuffer(3,"vertexAmbients","ambientBuffer","aAmbientColor",this),new i.default.RenderBuffer(2,"uvs","uvBuffer","aTexCoord",this,this._flatten)],stroke:[new i.default.RenderBuffer(3,"lineVertices","lineVertexBuffer","aPosition",this,this._flatten),new i.default.RenderBuffer(4,"lineNormals","lineNormalBuffer","aDirection",this,this._flatten)],point:this.GL.createBuffer()}},this.pointSize=5,this.curStrokeWeight=1,this.textures=[],this.textureMode=a.IMAGE,this.textureWrapX=a.CLAMP,this.textureWrapY=a.CLAMP,this._tex=null,this._curveTightness=6,this._lookUpTableBezier=[],this._lookUpTableQuadratic=[],this._lutBezierDetail=0,this._lutQuadraticDetail=0,this._tessy=this._initTessy(),this.fontInfos={},this._curShader=void 0,this},i.default.RendererGL.prototype=Object.create(i.default.Renderer.prototype),i.default.RendererGL.prototype._setAttributeDefaults=function(e){var t={alpha:!0,depth:!0,stencil:!0,antialias:navigator.userAgent.toLowerCase().includes("safari"),premultipliedAlpha:!1,preserveDrawingBuffer:!0,perPixelLighting:!0};null===e._glAttributes?e._glAttributes=t:e._glAttributes=Object.assign(t,e._glAttributes)},i.default.RendererGL.prototype._initContext=function(){try{if(this.drawingContext=this.canvas.getContext("webgl",this._pInst._glAttributes)||this.canvas.getContext("experimental-webgl",this._pInst._glAttributes),null===this.drawingContext)throw new Error("Error creating webgl context");var e=this.drawingContext;e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),this._viewport=this.drawingContext.getParameter(this.drawingContext.VIEWPORT)}catch(e){throw e}},i.default.RendererGL.prototype._resetContext=function(e,t){var n=this.width,r=this.height,a=this.canvas.id,o=this._pInst instanceof i.default.Graphics;if(o){var s=this._pInst;s.canvas.parentNode.removeChild(s.canvas),s.canvas=document.createElement("canvas"),(s._pInst._userNode||document.body).appendChild(s.canvas),i.default.Element.call(s,s.canvas,s._pInst),s.width=n,s.height=r}else{var u=this.canvas;u&&u.parentNode.removeChild(u),(u=document.createElement("canvas")).id=a,this._pInst._userNode?this._pInst._userNode.appendChild(u):document.body.appendChild(u),this._pInst.canvas=u}var c=new i.default.RendererGL(this._pInst.canvas,this._pInst,!o);this._pInst._setProperty("_renderer",c),c.resize(n,r),c._applyDefaults(),o||this._pInst._elements.push(c),"function"==typeof t&&setTimeout((function(){t.apply(window._renderer,e)}),0)},i.default.prototype.setAttributes=function(e,t){if(void 0!==this._glAttributes){var n=!0;if(void 0!==t?(null===this._glAttributes&&(this._glAttributes={}),this._glAttributes[e]!==t&&(this._glAttributes[e]=t,n=!1)):e instanceof Object&&this._glAttributes!==e&&(this._glAttributes=e,n=!1),this._renderer.isP3D&&!n){if(!this._setupDone)for(var r in this._renderer.retainedMode.geometry)if(this._renderer.retainedMode.geometry.hasOwnProperty(r))return void console.error("Sorry, Could not set the attributes, you need to call setAttributes() before calling the other drawing methods in setup()");this.push(),this._renderer._resetContext(),this.pop(),this._renderer._curCamera&&(this._renderer._curCamera._renderer=this._renderer)}}else console.log("You are trying to use setAttributes on a p5.Graphics object that does not use a WEBGL renderer.")},i.default.RendererGL.prototype._update=function(){this.uMVMatrix.set(this._curCamera.cameraMatrix.mat4[0],this._curCamera.cameraMatrix.mat4[1],this._curCamera.cameraMatrix.mat4[2],this._curCamera.cameraMatrix.mat4[3],this._curCamera.cameraMatrix.mat4[4],this._curCamera.cameraMatrix.mat4[5],this._curCamera.cameraMatrix.mat4[6],this._curCamera.cameraMatrix.mat4[7],this._curCamera.cameraMatrix.mat4[8],this._curCamera.cameraMatrix.mat4[9],this._curCamera.cameraMatrix.mat4[10],this._curCamera.cameraMatrix.mat4[11],this._curCamera.cameraMatrix.mat4[12],this._curCamera.cameraMatrix.mat4[13],this._curCamera.cameraMatrix.mat4[14],this._curCamera.cameraMatrix.mat4[15]),this.ambientLightColors.length=0,this.specularColors=[1,1,1],this.directionalLightDirections.length=0,this.directionalLightDiffuseColors.length=0,this.directionalLightSpecularColors.length=0,this.pointLightPositions.length=0,this.pointLightDiffuseColors.length=0,this.pointLightSpecularColors.length=0,this.spotLightPositions.length=0,this.spotLightDirections.length=0,this.spotLightDiffuseColors.length=0,this.spotLightSpecularColors.length=0,this.spotLightAngle.length=0,this.spotLightConc.length=0,this._enableLighting=!1,this._tint=[255,255,255,255],this.GL.clear(this.GL.DEPTH_BUFFER_BIT)},i.default.RendererGL.prototype.background=function(){var e,t=(e=this._pInst).color.apply(e,arguments),n=t.levels[0]/255,r=t.levels[1]/255,i=t.levels[2]/255,a=t.levels[3]/255;this.GL.clearColor(n,r,i,a),this.GL.clear(this.GL.COLOR_BUFFER_BIT)},i.default.RendererGL.prototype.fill=function(e,t,n,r){var o=i.default.prototype.color.apply(this._pInst,arguments);this.curFillColor=o._array,this.drawMode=a.FILL,this._useNormalMaterial=!1,this._tex=null},i.default.RendererGL.prototype.stroke=function(e,t,n,r){arguments[3]=255;var a=i.default.prototype.color.apply(this._pInst,arguments);this.curStrokeColor=a._array},i.default.RendererGL.prototype.strokeCap=function(e){console.error("Sorry, strokeCap() is not yet implemented in WEBGL mode")},i.default.RendererGL.prototype.strokeJoin=function(e){console.error("Sorry, strokeJoin() is not yet implemented in WEBGL mode")},i.default.RendererGL.prototype.filter=function(e){console.error("filter() does not work in WEBGL mode")},i.default.RendererGL.prototype.blendMode=function(e){e===a.DARKEST||e===a.LIGHTEST||e===a.ADD||e===a.BLEND||e===a.SUBTRACT||e===a.SCREEN||e===a.EXCLUSION||e===a.REPLACE||e===a.MULTIPLY||e===a.REMOVE?this.curBlendMode=e:e!==a.BURN&&e!==a.OVERLAY&&e!==a.HARD_LIGHT&&e!==a.SOFT_LIGHT&&e!==a.DODGE||console.warn("BURN, OVERLAY, HARD_LIGHT, SOFT_LIGHT, and DODGE only work for blendMode in 2D mode.")},i.default.RendererGL.prototype.erase=function(e,t){this._isErasing||(this._applyBlendMode(a.REMOVE),this._isErasing=!0,this._cachedFillStyle=this.curFillColor.slice(),this.curFillColor=[1,1,1,e/255],this._cachedStrokeStyle=this.curStrokeColor.slice(),this.curStrokeColor=[1,1,1,t/255])},i.default.RendererGL.prototype.noErase=function(){this._isErasing&&(this._isErasing=!1,this.curFillColor=this._cachedFillStyle.slice(),this.curStrokeColor=this._cachedStrokeStyle.slice(),this.blendMode(this._cachedBlendMode))},i.default.RendererGL.prototype.strokeWeight=function(e){this.curStrokeWeight!==e&&(this.pointSize=e,this.curStrokeWeight=e)},i.default.RendererGL.prototype._getPixel=function(e,t){var n;return n=new Uint8Array(4),this.drawingContext.readPixels(e,t,1,1,this.drawingContext.RGBA,this.drawingContext.UNSIGNED_BYTE,n),[n[0],n[1],n[2],n[3]]},i.default.RendererGL.prototype.loadPixels=function(){var e=this._pixelsState;if(!0===this._pInst._glAttributes.preserveDrawingBuffer){var t=e.pixels,n=this.GL.drawingBufferWidth*this.GL.drawingBufferHeight*4;t instanceof Uint8Array&&t.length===n||(t=new Uint8Array(n),this._pixelsState._setProperty("pixels",t));var r=this._pInst._pixelDensity;this.GL.readPixels(0,0,this.width*r,this.height*r,this.GL.RGBA,this.GL.UNSIGNED_BYTE,t)}else console.log("loadPixels only works in WebGL when preserveDrawingBuffer is true.")},i.default.RendererGL.prototype.geometryInHash=function(e){return void 0!==this.retainedMode.geometry[e]},i.default.RendererGL.prototype.resize=function(e,t){i.default.Renderer.prototype.resize.call(this,e,t),this.GL.viewport(0,0,this.GL.drawingBufferWidth,this.GL.drawingBufferHeight),this._viewport=this.GL.getParameter(this.GL.VIEWPORT),this._curCamera._resize();var n=this._pixelsState;void 0!==n.pixels&&n._setProperty("pixels",new Uint8Array(this.GL.drawingBufferWidth*this.GL.drawingBufferHeight*4))},i.default.RendererGL.prototype.clear=function(){var e=(arguments.length<=0?void 0:arguments[0])||0,t=(arguments.length<=1?void 0:arguments[1])||0,n=(arguments.length<=2?void 0:arguments[2])||0,r=(arguments.length<=3?void 0:arguments[3])||0;this.GL.clearColor(e,t,n,r),this.GL.clear(this.GL.COLOR_BUFFER_BIT|this.GL.DEPTH_BUFFER_BIT)},i.default.RendererGL.prototype.applyMatrix=function(e,t,n,r,a,o){16===arguments.length?i.default.Matrix.prototype.apply.apply(this.uMVMatrix,arguments):this.uMVMatrix.apply([e,t,0,0,n,r,0,0,0,0,1,0,a,o,0,1])},i.default.RendererGL.prototype.translate=function(e,t,n){return e instanceof i.default.Vector&&(n=e.z,t=e.y,e=e.x),this.uMVMatrix.translate([e,t,n]),this},i.default.RendererGL.prototype.scale=function(e,t,n){return this.uMVMatrix.scale(e,t,n),this},i.default.RendererGL.prototype.rotate=function(e,t){return void 0===t?this.rotateZ(e):(i.default.Matrix.prototype.rotate.apply(this.uMVMatrix,arguments),this)},i.default.RendererGL.prototype.rotateX=function(e){return this.rotate(e,1,0,0),this},i.default.RendererGL.prototype.rotateY=function(e){return this.rotate(e,0,1,0),this},i.default.RendererGL.prototype.rotateZ=function(e){return this.rotate(e,0,0,1),this},i.default.RendererGL.prototype.push=function(){var e=i.default.Renderer.prototype.push.apply(this),t=e.properties;return t.uMVMatrix=this.uMVMatrix.copy(),t.uPMatrix=this.uPMatrix.copy(),t._curCamera=this._curCamera,this._curCamera=this._curCamera.copy(),t.ambientLightColors=this.ambientLightColors.slice(),t.specularColors=this.specularColors.slice(),t.directionalLightDirections=this.directionalLightDirections.slice(),t.directionalLightDiffuseColors=this.directionalLightDiffuseColors.slice(),t.directionalLightSpecularColors=this.directionalLightSpecularColors.slice(),t.pointLightPositions=this.pointLightPositions.slice(),t.pointLightDiffuseColors=this.pointLightDiffuseColors.slice(),t.pointLightSpecularColors=this.pointLightSpecularColors.slice(),t.spotLightPositions=this.spotLightPositions.slice(),t.spotLightDirections=this.spotLightDirections.slice(),t.spotLightDiffuseColors=this.spotLightDiffuseColors.slice(),t.spotLightSpecularColors=this.spotLightSpecularColors.slice(),t.spotLightAngle=this.spotLightAngle.slice(),t.spotLightConc=this.spotLightConc.slice(),t.userFillShader=this.userFillShader,t.userStrokeShader=this.userStrokeShader,t.userPointShader=this.userPointShader,t.pointSize=this.pointSize,t.curStrokeWeight=this.curStrokeWeight,t.curStrokeColor=this.curStrokeColor,t.curFillColor=this.curFillColor,t._useSpecularMaterial=this._useSpecularMaterial,t._useEmissiveMaterial=this._useEmissiveMaterial,t._useShininess=this._useShininess,t.constantAttenuation=this.constantAttenuation,t.linearAttenuation=this.linearAttenuation,t.quadraticAttenuation=this.quadraticAttenuation,t._enableLighting=this._enableLighting,t._useNormalMaterial=this._useNormalMaterial,t._tex=this._tex,t.drawMode=this.drawMode,e},i.default.RendererGL.prototype.resetMatrix=function(){return this.uMVMatrix=i.default.Matrix.identity(this._pInst),this},i.default.RendererGL.prototype._getImmediateStrokeShader=function(){var e=this.userStrokeShader;return e&&e.isStrokeShader()?e:this._getLineShader()},i.default.RendererGL.prototype._getRetainedStrokeShader=i.default.RendererGL.prototype._getImmediateStrokeShader,i.default.RendererGL.prototype._getImmediateFillShader=function(){var e=this.userFillShader;if(this._useNormalMaterial&&(!e||!e.isNormalShader()))return this._getNormalShader();if(this._enableLighting){if(!e||!e.isLightShader())return this._getLightShader()}else if(this._tex){if(!e||!e.isTextureShader())return this._getLightShader()}else if(!e)return this._getImmediateModeShader();return e},i.default.RendererGL.prototype._getRetainedFillShader=function(){if(this._useNormalMaterial)return this._getNormalShader();var e=this.userFillShader;if(this._enableLighting){if(!e||!e.isLightShader())return this._getLightShader()}else if(this._tex){if(!e||!e.isTextureShader())return this._getLightShader()}else if(!e)return this._getColorShader();return e},i.default.RendererGL.prototype._getImmediatePointShader=function(){var e=this.userPointShader;return e&&e.isPointShader()?e:this._getPointShader()},i.default.RendererGL.prototype._getRetainedLineShader=i.default.RendererGL.prototype._getImmediateLineShader,i.default.RendererGL.prototype._getLightShader=function(){return this._defaultLightShader||(this._pInst._glAttributes.perPixelLighting?this._defaultLightShader=new i.default.Shader(this,l.phongVert,l.phongFrag):this._defaultLightShader=new i.default.Shader(this,l.lightVert,l.lightTextureFrag)),this._defaultLightShader},i.default.RendererGL.prototype._getImmediateModeShader=function(){return this._defaultImmediateModeShader||(this._defaultImmediateModeShader=new i.default.Shader(this,l.immediateVert,l.vertexColorFrag)),this._defaultImmediateModeShader},i.default.RendererGL.prototype._getNormalShader=function(){return this._defaultNormalShader||(this._defaultNormalShader=new i.default.Shader(this,l.normalVert,l.normalFrag)),this._defaultNormalShader},i.default.RendererGL.prototype._getColorShader=function(){return this._defaultColorShader||(this._defaultColorShader=new i.default.Shader(this,l.normalVert,l.basicFrag)),this._defaultColorShader},i.default.RendererGL.prototype._getPointShader=function(){return this._defaultPointShader||(this._defaultPointShader=new i.default.Shader(this,l.pointVert,l.pointFrag)),this._defaultPointShader},i.default.RendererGL.prototype._getLineShader=function(){return this._defaultLineShader||(this._defaultLineShader=new i.default.Shader(this,l.lineVert,l.lineFrag)),this._defaultLineShader},i.default.RendererGL.prototype._getFontShader=function(){return this._defaultFontShader||(this.GL.getExtension("OES_standard_derivatives"),this._defaultFontShader=new i.default.Shader(this,l.fontVert,l.fontFrag)),this._defaultFontShader},i.default.RendererGL.prototype._getEmptyTexture=function(){if(!this._emptyTexture){var e=new i.default.Image(1,1);e.set(0,0,255),this._emptyTexture=new i.default.Texture(this,e)}return this._emptyTexture},i.default.RendererGL.prototype.getTexture=function(e){var t=this.textures,n=!0,r=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var u=o.value;if(u.src===e)return u}}catch(e){r=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(r)throw a}}var c=new i.default.Texture(this,e);return t.push(c),c},i.default.RendererGL.prototype._setStrokeUniforms=function(e){e.bindShader(),e.setUniform("uMaterialColor",this.curStrokeColor),e.setUniform("uStrokeWeight",this.curStrokeWeight)},i.default.RendererGL.prototype._setFillUniforms=function(e){e.bindShader(),e.setUniform("uMaterialColor",this.curFillColor),e.setUniform("isTexture",!!this._tex),this._tex&&e.setUniform("uSampler",this._tex),e.setUniform("uTint",this._tint),e.setUniform("uSpecular",this._useSpecularMaterial),e.setUniform("uEmissive",this._useEmissiveMaterial),e.setUniform("uShininess",this._useShininess),e.setUniform("uUseLighting",this._enableLighting);var t=this.pointLightDiffuseColors.length/3;e.setUniform("uPointLightCount",t),e.setUniform("uPointLightLocation",this.pointLightPositions),e.setUniform("uPointLightDiffuseColors",this.pointLightDiffuseColors),e.setUniform("uPointLightSpecularColors",this.pointLightSpecularColors);var n=this.directionalLightDiffuseColors.length/3;e.setUniform("uDirectionalLightCount",n),e.setUniform("uLightingDirection",this.directionalLightDirections),e.setUniform("uDirectionalDiffuseColors",this.directionalLightDiffuseColors),e.setUniform("uDirectionalSpecularColors",this.directionalLightSpecularColors);var r=this.ambientLightColors.length/3;e.setUniform("uAmbientLightCount",r),e.setUniform("uAmbientColor",this.ambientLightColors);var i=this.spotLightDiffuseColors.length/3;e.setUniform("uSpotLightCount",i),e.setUniform("uSpotLightAngle",this.spotLightAngle),e.setUniform("uSpotLightConc",this.spotLightConc),e.setUniform("uSpotLightDiffuseColors",this.spotLightDiffuseColors),e.setUniform("uSpotLightSpecularColors",this.spotLightSpecularColors),e.setUniform("uSpotLightLocation",this.spotLightPositions),e.setUniform("uSpotLightDirection",this.spotLightDirections),e.setUniform("uConstantAttenuation",this.constantAttenuation),e.setUniform("uLinearAttenuation",this.linearAttenuation),e.setUniform("uQuadraticAttenuation",this.quadraticAttenuation),e.bindTextures()},i.default.RendererGL.prototype._setPointUniforms=function(e){e.bindShader(),e.setUniform("uMaterialColor",this.curStrokeColor),e.setUniform("uPointSize",this.pointSize*this._pInst._pixelDensity)},i.default.RendererGL.prototype._bindBuffer=function(e,t,n,r,i){if(t=t||this.GL.ARRAY_BUFFER,this.GL.bindBuffer(t,e),void 0!==n){var a=new(r||Float32Array)(n);this.GL.bufferData(t,a,i||this.GL.STATIC_DRAW)}},i.default.RendererGL.prototype._arraysEqual=function(e,t){var n=e.length;if(n!==t.length)return!1;for(var r=0;r<n;r++)if(e[r]!==t[r])return!1;return!0},i.default.RendererGL.prototype._isTypedArray=function(e){return Float32Array,Float64Array,Int16Array,Uint16Array,e instanceof Uint32Array},i.default.RendererGL.prototype._flatten=function(e){if(0===e.length)return[];if(2e4<e.length){var t,n=Object.prototype.toString,r=[],i=e.slice();for(t=i.pop();"[object Array]"===n.call(t)?i.push.apply(i,u(t)):r.push(t),i.length&&void 0!==(t=i.pop()););return r.reverse(),r}var a;return(a=[]).concat.apply(a,u(e))},i.default.RendererGL.prototype._vToNArray=function(e){var t=[],n=!0,r=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;t.push(s.x,s.y,s.z)}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}return t},i.default.prototype._assert3d=function(e){if(!this._renderer.isP3D)throw new Error("".concat(e,"() is only supported in WEBGL mode. If you'd like to use 3D graphics and WebGL, see  https://p5js.org/examples/form-3d-primitives.html for more information."))},i.default.RendererGL.prototype._initTessy=function(){var e=new o.default.GluTesselator;return e.gluTessCallback(o.default.gluEnum.GLU_TESS_VERTEX_DATA,(function(e,t){t[t.length]=e[0],t[t.length]=e[1],t[t.length]=e[2]})),e.gluTessCallback(o.default.gluEnum.GLU_TESS_BEGIN,(function(e){e!==o.default.primitiveType.GL_TRIANGLES&&console.log("expected TRIANGLES but got type: ".concat(e))})),e.gluTessCallback(o.default.gluEnum.GLU_TESS_ERROR,(function(e){console.log("error callback"),console.log("error number: ".concat(e))})),e.gluTessCallback(o.default.gluEnum.GLU_TESS_COMBINE,(function(e,t,n){return[e[0],e[1],e[2]]})),e.gluTessCallback(o.default.gluEnum.GLU_TESS_EDGE_FLAG,(function(e){})),e},i.default.RendererGL.prototype._triangulate=function(e){this._tessy.gluTessNormal(0,0,1);var t=[];this._tessy.gluTessBeginPolygon(t);for(var n=0;n<e.length;n++){this._tessy.gluTessBeginContour();for(var r=e[n],i=0;i<r.length;i+=3){var a=[r[i],r[i+1],r[i+2]];this._tessy.gluTessVertex(a,a)}this._tessy.gluTessEndContour()}return this._tessy.gluTessEndPolygon(),t},i.default.RendererGL.prototype._bezierCoefficients=function(e){var t=e*e,n=1-e,r=n*n;return[r*n,3*r*e,3*n*t,t*e]},i.default.RendererGL.prototype._quadraticCoefficients=function(e){var t=1-e;return[t*t,2*t*e,e*e]},i.default.RendererGL.prototype._bezierToCatmull=function(e){return[e[1],e[1]+(e[2]-e[0])/this._curveTightness,e[2]-(e[3]-e[1])/this._curveTightness,e[2]]};var f=i.default.RendererGL;n.default=f},{"../core/constants":250,"../core/main":260,"../core/p5.Renderer":263,"./p5.Camera":308,"./p5.Matrix":310,"./p5.Shader":315,"core-js/modules/es.array.concat":148,"core-js/modules/es.array.fill":150,"core-js/modules/es.array.filter":151,"core-js/modules/es.array.from":153,"core-js/modules/es.array.includes":154,"core-js/modules/es.array.iterator":156,"core-js/modules/es.array.slice":160,"core-js/modules/es.object.assign":170,"core-js/modules/es.object.to-string":174,"core-js/modules/es.regexp.to-string":179,"core-js/modules/es.string.includes":182,"core-js/modules/es.string.iterator":183,"core-js/modules/es.symbol":193,"core-js/modules/es.symbol.description":191,"core-js/modules/es.symbol.iterator":192,"core-js/modules/es.typed-array.copy-within":194,"core-js/modules/es.typed-array.every":195,"core-js/modules/es.typed-array.fill":196,"core-js/modules/es.typed-array.filter":197,"core-js/modules/es.typed-array.find":199,"core-js/modules/es.typed-array.find-index":198,"core-js/modules/es.typed-array.float32-array":200,"core-js/modules/es.typed-array.float64-array":201,"core-js/modules/es.typed-array.for-each":202,"core-js/modules/es.typed-array.includes":203,"core-js/modules/es.typed-array.index-of":204,"core-js/modules/es.typed-array.int16-array":205,"core-js/modules/es.typed-array.iterator":207,"core-js/modules/es.typed-array.join":208,"core-js/modules/es.typed-array.last-index-of":209,"core-js/modules/es.typed-array.map":210,"core-js/modules/es.typed-array.reduce":212,"core-js/modules/es.typed-array.reduce-right":211,"core-js/modules/es.typed-array.reverse":213,"core-js/modules/es.typed-array.set":214,"core-js/modules/es.typed-array.slice":215,"core-js/modules/es.typed-array.some":216,"core-js/modules/es.typed-array.sort":217,"core-js/modules/es.typed-array.subarray":218,"core-js/modules/es.typed-array.to-locale-string":219,"core-js/modules/es.typed-array.to-string":220,"core-js/modules/es.typed-array.uint16-array":221,"core-js/modules/es.typed-array.uint32-array":222,"core-js/modules/es.typed-array.uint8-array":223,"core-js/modules/web.dom-collections.iterator":226,libtess:234,path:237}],315:[function(e,t,n){"use strict";e("core-js/modules/es.symbol"),e("core-js/modules/es.symbol.description"),e("core-js/modules/es.symbol.iterator"),e("core-js/modules/es.array.index-of"),e("core-js/modules/es.array.iterator"),e("core-js/modules/es.array.slice"),e("core-js/modules/es.function.name"),e("core-js/modules/es.object.to-string"),e("core-js/modules/es.string.iterator"),e("core-js/modules/web.dom-collections.iterator"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=(r=e("../core/main"))&&r.__esModule?r:{default:r};i.default.Shader=function(e,t,n){this._renderer=e,this._vertSrc=t,this._fragSrc=n,this._vertShader=-1,this._fragShader=-1,this._glProgram=0,this._loadedAttributes=!1,this.attributes={},this._loadedUniforms=!1,this.uniforms={},this._bound=!1,this.samplers=[]},i.default.Shader.prototype.init=function(){if(0===this._glProgram){var e=this._renderer.GL;if(this._vertShader=e.createShader(e.VERTEX_SHADER),e.shaderSource(this._vertShader,this._vertSrc),e.compileShader(this._vertShader),!e.getShaderParameter(this._vertShader,e.COMPILE_STATUS))return console.error("Yikes! An error occurred compiling the vertex shader:".concat(e.getShaderInfoLog(this._vertShader))),null;if(this._fragShader=e.createShader(e.FRAGMENT_SHADER),e.shaderSource(this._fragShader,this._fragSrc),e.compileShader(this._fragShader),!e.getShaderParameter(this._fragShader,e.COMPILE_STATUS))return console.error("Darn! An error occurred compiling the fragment shader:".concat(e.getShaderInfoLog(this._fragShader))),null;this._glProgram=e.createProgram(),e.attachShader(this._glProgram,this._vertShader),e.attachShader(this._glProgram,this._fragShader),e.linkProgram(this._glProgram),e.getProgramParameter(this._glProgram,e.LINK_STATUS)||console.error("Snap! Error linking shader program: ".concat(e.getProgramInfoLog(this._glProgram))),this._loadAttributes(),this._loadUniforms()}return this},i.default.Shader.prototype._loadAttributes=function(){if(!this._loadedAttributes){this.attributes={};for(var e=this._renderer.GL,t=e.getProgramParameter(this._glProgram,e.ACTIVE_ATTRIBUTES),n=0;n<t;++n){var r=e.getActiveAttrib(this._glProgram,n),i=r.name,a=e.getAttribLocation(this._glProgram,i),o={};o.name=i,o.location=a,o.index=n,o.type=r.type,o.size=r.size,this.attributes[i]=o}this._loadedAttributes=!0}},i.default.Shader.prototype._loadUniforms=function(){if(!this._loadedUniforms){for(var e=this._renderer.GL,t=e.getProgramParameter(this._glProgram,e.ACTIVE_UNIFORMS),n=0,r=0;r<t;++r){var i=e.getActiveUniform(this._glProgram,r),a={};a.location=e.getUniformLocation(this._glProgram,i.name),a.size=i.size;var o=i.name;1<i.size&&(o=o.substring(0,o.indexOf("[0]"))),a.name=o,a.type=i.type,a._cachedData=void 0,a.type===e.SAMPLER_2D&&(a.samplerIndex=n,n++,this.samplers.push(a)),a.isArray=a.type===e.FLOAT_MAT3||a.type===e.FLOAT_MAT4||a.type===e.FLOAT_VEC2||a.type===e.FLOAT_VEC3||a.type===e.FLOAT_VEC4||a.type===e.INT_VEC2||a.type===e.INT_VEC3||a.type===e.INT_VEC4,this.uniforms[o]=a}this._loadedUniforms=!0}},i.default.Shader.prototype.compile=function(){},i.default.Shader.prototype.bindShader=function(){this.init(),this._bound||(this.useProgram(),this._bound=!0,this._setMatrixUniforms(),this.setUniform("uViewport",this._renderer._viewport))},i.default.Shader.prototype.unbindShader=function(){return this._bound&&(this.unbindTextures(),this._bound=!1),this},i.default.Shader.prototype.bindTextures=function(){var e=this._renderer.GL,t=!0,n=!1,r=void 0;try{for(var i,a=this.samplers[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value,s=o.texture;void 0===s&&(s=this._renderer._getEmptyTexture()),e.activeTexture(e.TEXTURE0+o.samplerIndex),s.bindTexture(),s.update(),e.uniform1i(o.location,o.samplerIndex)}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}},i.default.Shader.prototype.updateTextures=function(){var e=!0,t=!1,n=void 0;try{for(var r,i=this.samplers[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var a=r.value.texture;a&&a.update()}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}},i.default.Shader.prototype.unbindTextures=function(){},i.default.Shader.prototype._setMatrixUniforms=function(){this.setUniform("uProjectionMatrix",this._renderer.uPMatrix.mat4),this.isStrokeShader()&&("default"===this._renderer._curCamera.cameraType?this.setUniform("uPerspective",1):this.setUniform("uPerspective",0)),this.setUniform("uModelViewMatrix",this._renderer.uMVMatrix.mat4),this.setUniform("uViewMatrix",this._renderer._curCamera.cameraMatrix.mat4),this.uniforms.uNormalMatrix&&(this._renderer.uNMatrix.inverseTranspose(this._renderer.uMVMatrix),this.setUniform("uNormalMatrix",this._renderer.uNMatrix.mat3))},i.default.Shader.prototype.useProgram=function(){var e=this._renderer.GL;return this._renderer._curShader!==this&&(e.useProgram(this._glProgram),this._renderer._curShader=this),this},i.default.Shader.prototype.setUniform=function(e,t){var n=this.uniforms[e];if(n){var r=this._renderer.GL;if(n.isArray){if(n._cachedData&&this._renderer._arraysEqual(n._cachedData,t))return;n._cachedData=t.slice(0)}else{if(n._cachedData&&n._cachedData===t)return;n._cachedData=t}var i=n.location;switch(this.useProgram(),n.type){case r.BOOL:!0===t?r.uniform1i(i,1):r.uniform1i(i,0);break;case r.INT:1<n.size?t.length&&r.uniform1iv(i,t):r.uniform1i(i,t);break;case r.FLOAT:1<n.size?t.length&&r.uniform1fv(i,t):r.uniform1f(i,t);break;case r.FLOAT_MAT3:r.uniformMatrix3fv(i,!1,t);break;case r.FLOAT_MAT4:r.uniformMatrix4fv(i,!1,t);break;case r.FLOAT_VEC2:1<n.size?t.length&&r.uniform2fv(i,t):r.uniform2f(i,t[0],t[1]);break;case r.FLOAT_VEC3:1<n.size?t.length&&r.uniform3fv(i,t):r.uniform3f(i,t[0],t[1],t[2]);break;case r.FLOAT_VEC4:1<n.size?t.length&&r.uniform4fv(i,t):r.uniform4f(i,t[0],t[1],t[2],t[3]);break;case r.INT_VEC2:1<n.size?t.length&&r.uniform2iv(i,t):r.uniform2i(i,t[0],t[1]);break;case r.INT_VEC3:1<n.size?t.length&&r.uniform3iv(i,t):r.uniform3i(i,t[0],t[1],t[2]);break;case r.INT_VEC4:1<n.size?t.length&&r.uniform4iv(i,t):r.uniform4i(i,t[0],t[1],t[2],t[3]);break;case r.SAMPLER_2D:r.activeTexture(r.TEXTURE0+n.samplerIndex),n.texture=this._renderer.getTexture(t),r.uniform1i(n.location,n.samplerIndex)}return this}},i.default.Shader.prototype.isLightShader=function(){return void 0!==this.attributes.aNormal||void 0!==this.uniforms.uUseLighting||void 0!==this.uniforms.uAmbientLightCount||void 0!==this.uniforms.uDirectionalLightCount||void 0!==this.uniforms.uPointLightCount||void 0!==this.uniforms.uAmbientColor||void 0!==this.uniforms.uDirectionalDiffuseColors||void 0!==this.uniforms.uDirectionalSpecularColors||void 0!==this.uniforms.uPointLightLocation||void 0!==this.uniforms.uPointLightDiffuseColors||void 0!==this.uniforms.uPointLightSpecularColors||void 0!==this.uniforms.uLightingDirection||void 0!==this.uniforms.uSpecular},i.default.Shader.prototype.isNormalShader=function(){return void 0!==this.attributes.aNormal},i.default.Shader.prototype.isTextureShader=function(){return 0<this.samplerIndex},i.default.Shader.prototype.isColorShader=function(){return void 0!==this.attributes.aVertexColor||void 0!==this.uniforms.uMaterialColor},i.default.Shader.prototype.isTexLightShader=function(){return this.isLightShader()&&this.isTextureShader()},i.default.Shader.prototype.isStrokeShader=function(){return void 0!==this.uniforms.uStrokeWeight},i.default.Shader.prototype.enableAttrib=function(e,t,n,r,i,a){if(e){var o=e.location;if(-1!==o){var s=this._renderer.GL;e.enabled||(s.enableVertexAttribArray(o),e.enabled=!0),this._renderer.GL.vertexAttribPointer(o,t,n||s.FLOAT,r||!1,i||0,a||0)}}return this};var a=i.default.Shader;n.default=a},{"../core/main":260,"core-js/modules/es.array.index-of":155,"core-js/modules/es.array.iterator":156,"core-js/modules/es.array.slice":160,"core-js/modules/es.function.name":163,"core-js/modules/es.object.to-string":174,"core-js/modules/es.string.iterator":183,"core-js/modules/es.symbol":193,"core-js/modules/es.symbol.description":191,"core-js/modules/es.symbol.iterator":192,"core-js/modules/web.dom-collections.iterator":226}],316:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e("core-js/modules/es.array.iterator"),e("core-js/modules/es.object.to-string"),e("core-js/modules/es.typed-array.uint8-array"),e("core-js/modules/es.typed-array.copy-within"),e("core-js/modules/es.typed-array.every"),e("core-js/modules/es.typed-array.fill"),e("core-js/modules/es.typed-array.filter"),e("core-js/modules/es.typed-array.find"),e("core-js/modules/es.typed-array.find-index"),e("core-js/modules/es.typed-array.for-each"),e("core-js/modules/es.typed-array.includes"),e("core-js/modules/es.typed-array.index-of"),e("core-js/modules/es.typed-array.iterator"),e("core-js/modules/es.typed-array.join"),e("core-js/modules/es.typed-array.last-index-of"),e("core-js/modules/es.typed-array.map"),e("core-js/modules/es.typed-array.reduce"),e("core-js/modules/es.typed-array.reduce-right"),e("core-js/modules/es.typed-array.reverse"),e("core-js/modules/es.typed-array.set"),e("core-js/modules/es.typed-array.slice"),e("core-js/modules/es.typed-array.some"),e("core-js/modules/es.typed-array.sort"),e("core-js/modules/es.typed-array.subarray"),e("core-js/modules/es.typed-array.to-locale-string"),e("core-js/modules/es.typed-array.to-string"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i,a=(i=e("../core/main"))&&i.__esModule?i:{default:i},o=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var t="function"!=typeof WeakMap?null:new WeakMap;if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,t&&t.set(e,n),n}(e("../core/constants"));a.default.Texture=function(e,t){this._renderer=e;var n=this._renderer.GL;this.src=t,this.glTex=void 0,this.glTarget=n.TEXTURE_2D,this.glFormat=n.RGBA,this.mipmaps=!1,this.glMinFilter=n.LINEAR,this.glMagFilter=n.LINEAR,this.glWrapS=n.CLAMP_TO_EDGE,this.glWrapT=n.CLAMP_TO_EDGE,this.isSrcMediaElement=void 0!==a.default.MediaElement&&t instanceof a.default.MediaElement,this._videoPrevUpdateTime=0,this.isSrcHTMLElement=void 0!==a.default.Element&&t instanceof a.default.Element&&!(t instanceof a.default.Graphics),this.isSrcP5Image=t instanceof a.default.Image,this.isSrcP5Graphics=t instanceof a.default.Graphics,this.isImageData="undefined"!=typeof ImageData&&t instanceof ImageData;var r=this._getTextureDataFromSource();return this.width=r.width,this.height=r.height,this.init(r),this},a.default.Texture.prototype._getTextureDataFromSource=function(){var e;return this.isSrcP5Image?e=this.src.canvas:this.isSrcMediaElement||this.isSrcP5Graphics||this.isSrcHTMLElement?e=this.src.elt:this.isImageData&&(e=this.src),e},a.default.Texture.prototype.init=function(e){var t=this._renderer.GL;if(this.glTex=t.createTexture(),this.glWrapS=this._renderer.textureWrapX,this.glWrapT=this._renderer.textureWrapY,this.setWrapMode(this.glWrapS,this.glWrapT),this.bindTexture(),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,this.glMagFilter),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,this.glMinFilter),0===this.width||0===this.height||this.isSrcMediaElement&&!this.src.loadedmetadata){var n=new Uint8Array([1,1,1,1]);t.texImage2D(this.glTarget,0,t.RGBA,1,1,0,this.glFormat,t.UNSIGNED_BYTE,n)}else t.texImage2D(this.glTarget,0,this.glFormat,this.glFormat,t.UNSIGNED_BYTE,e)},a.default.Texture.prototype.update=function(){var e=this.src;if(0===e.width||0===e.height)return!1;var t=this._getTextureDataFromSource(),n=!1,r=this._renderer.GL;return t.width!==this.width||t.height!==this.height?(n=!0,this.width=t.width,this.height=t.height,this.isSrcP5Image?e.setModified(!1):(this.isSrcMediaElement||this.isSrcHTMLElement)&&e.setModified(!0)):this.isSrcP5Image?e.isModified()&&(n=!0,e.setModified(!1)):this.isSrcMediaElement?e.isModified()?(n=!0,e.setModified(!1)):e.loadedmetadata&&this._videoPrevUpdateTime!==e.time()&&(this._videoPrevUpdateTime=e.time(),n=!0):this.isImageData?e._dirty&&(n=!(e._dirty=!1)):n=!0,n&&(this.bindTexture(),r.texImage2D(this.glTarget,0,this.glFormat,this.glFormat,r.UNSIGNED_BYTE,t)),n},a.default.Texture.prototype.bindTexture=function(){return this._renderer.GL.bindTexture(this.glTarget,this.glTex),this},a.default.Texture.prototype.unbindTexture=function(){this._renderer.GL.bindTexture(this.glTarget,null)},a.default.Texture.prototype.setInterpolation=function(e,t){var n=this._renderer.GL;e===o.NEAREST?this.glMinFilter=n.NEAREST:this.glMinFilter=n.LINEAR,t===o.NEAREST?this.glMagFilter=n.NEAREST:this.glMagFilter=n.LINEAR,this.bindTexture(),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,this.glMinFilter),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,this.glMagFilter),this.unbindTexture()},a.default.Texture.prototype.setWrapMode=function(e,t){function n(e){return 0==(e&e-1)}var r=this._renderer.GL,i=n(this.width),a=n(this.height);e===o.REPEAT?i&&a?this.glWrapS=r.REPEAT:(console.warn("You tried to set the wrap mode to REPEAT but the texture size is not a power of two. Setting to CLAMP instead"),this.glWrapS=r.CLAMP_TO_EDGE):e===o.MIRROR?i&&a?this.glWrapS=r.MIRRORED_REPEAT:(console.warn("You tried to set the wrap mode to MIRROR but the texture size is not a power of two. Setting to CLAMP instead"),this.glWrapS=r.CLAMP_TO_EDGE):this.glWrapS=r.CLAMP_TO_EDGE,t===o.REPEAT?i&&a?this.glWrapT=r.REPEAT:(console.warn("You tried to set the wrap mode to REPEAT but the texture size is not a power of two. Setting to CLAMP instead"),this.glWrapT=r.CLAMP_TO_EDGE):t===o.MIRROR?i&&a?this.glWrapT=r.MIRRORED_REPEAT:(console.warn("You tried to set the wrap mode to MIRROR but the texture size is not a power of two. Setting to CLAMP instead"),this.glWrapT=r.CLAMP_TO_EDGE):this.glWrapT=r.CLAMP_TO_EDGE,this.bindTexture(),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,this.glWrapS),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,this.glWrapT),this.unbindTexture()};var s=a.default.Texture;n.default=s},{"../core/constants":250,"../core/main":260,"core-js/modules/es.array.iterator":156,"core-js/modules/es.object.to-string":174,"core-js/modules/es.typed-array.copy-within":194,"core-js/modules/es.typed-array.every":195,"core-js/modules/es.typed-array.fill":196,"core-js/modules/es.typed-array.filter":197,"core-js/modules/es.typed-array.find":199,"core-js/modules/es.typed-array.find-index":198,"core-js/modules/es.typed-array.for-each":202,"core-js/modules/es.typed-array.includes":203,"core-js/modules/es.typed-array.index-of":204,"core-js/modules/es.typed-array.iterator":207,"core-js/modules/es.typed-array.join":208,"core-js/modules/es.typed-array.last-index-of":209,"core-js/modules/es.typed-array.map":210,"core-js/modules/es.typed-array.reduce":212,"core-js/modules/es.typed-array.reduce-right":211,"core-js/modules/es.typed-array.reverse":213,"core-js/modules/es.typed-array.set":214,"core-js/modules/es.typed-array.slice":215,"core-js/modules/es.typed-array.some":216,"core-js/modules/es.typed-array.sort":217,"core-js/modules/es.typed-array.subarray":218,"core-js/modules/es.typed-array.to-locale-string":219,"core-js/modules/es.typed-array.to-string":220,"core-js/modules/es.typed-array.uint8-array":223}],317:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e("core-js/modules/es.symbol"),e("core-js/modules/es.symbol.description"),e("core-js/modules/es.symbol.iterator"),e("core-js/modules/es.array.iterator"),e("core-js/modules/es.object.to-string"),e("core-js/modules/es.regexp.exec"),e("core-js/modules/es.string.iterator"),e("core-js/modules/es.string.split"),e("core-js/modules/es.string.sub"),e("core-js/modules/web.dom-collections.iterator");var i,a=(i=e("../core/main"))&&i.__esModule?i:{default:i},o=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var t="function"!=typeof WeakMap?null:new WeakMap;if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,t&&t.set(e,n),n}(e("../core/constants"));function s(e,t){this.width=e,this.height=t,this.infos=[],this.findImage=function(e){var t,n,r=this.width*this.height;if(r<e)throw new Error("font is too complex to render in 3D");for(var i=this.infos.length-1;0<=i;--i){var a=this.infos[i];if(a.index+e<r){n=(t=a).imageData;break}}if(!t){try{n=new ImageData(this.width,this.height)}catch(e){var o=document.getElementsByTagName("canvas")[0],s=!o;o||((o=document.createElement("canvas")).style.display="none",document.body.appendChild(o));var u=o.getContext("2d");u&&(n=u.createImageData(this.width,this.height)),s&&document.body.removeChild(o)}t={index:0,imageData:n},this.infos.push(t)}var c=t.index;return t.index+=e,n._dirty=!0,{imageData:n,index:c}}}function u(e,t,n,r,i){var a=e.imageData.data,o=4*e.index++;a[o++]=t,a[o++]=n,a[o++]=r,a[o++]=i}function c(e){this.font=e,this.strokeImageInfos=new s(64,64),this.colDimImageInfos=new s(64,64),this.rowDimImageInfos=new s(64,64),this.colCellImageInfos=new s(64,64),this.rowCellImageInfos=new s(64,64),this.glyphInfos={},this.getGlyphInfo=function(e){var t=this.glyphInfos[e.index];if(t)return t;var n,r=e.getBoundingBox(),i=r.x1,o=r.y1,s=r.x2-i,c=r.y2-o,f=e.path.commands;if(0==s||0==c||!f.length)return this.glyphInfos[e.index]={};var d,h,p,m,v=[],g=[],y=[];for(n=8;0<=n;--n)y.push([]);for(n=8;0<=n;--n)g.push([]);function b(e,t,n){var r=v.length;function i(e,t,n){for(var r=e.length;0<r--;){var i=e[r];i<t&&(t=i),n<i&&(n=i)}return{min:t,max:n}}v.push(n);for(var a=i(e,1,0),o=Math.max(Math.floor(9*a.min),0),s=Math.min(Math.ceil(9*a.max),9),u=o;u<s;++u)y[u].push(r);for(var c=i(t,1,0),l=Math.max(Math.floor(9*c.min),0),f=Math.min(Math.ceil(9*c.max),9),d=l;d<f;++d)g[d].push(r)}function x(e){return(t=255*e)<0?0:255<t?255:t;var t}function w(e,t,n,r){this.p0=e,this.c0=t,this.c1=n,this.p1=r,this.toQuadratic=function(){return{x:this.p0.x,y:this.p0.y,x1:this.p1.x,y1:this.p1.y,cx:(3*(this.c0.x+this.c1.x)-(this.p0.x+this.p1.x))/4,cy:(3*(this.c0.y+this.c1.y)-(this.p0.y+this.p1.y))/4}},this.quadError=function(){return a.default.Vector.sub(a.default.Vector.sub(this.p1,this.p0),a.default.Vector.mult(a.default.Vector.sub(this.c1,this.c0),3)).mag()/2},this.split=function(e){var t=a.default.Vector.lerp(this.p0,this.c0,e),n=a.default.Vector.lerp(this.c0,this.c1,e),r=a.default.Vector.lerp(t,n,e);this.c1=a.default.Vector.lerp(this.c1,this.p1,e),this.c0=a.default.Vector.lerp(n,this.c1,e);var i=a.default.Vector.lerp(r,this.c0,e),o=new w(this.p0,t,r,i);return this.p0=i,o},this.splitInflections=function(){var e=a.default.Vector.sub(this.c0,this.p0),t=a.default.Vector.sub(a.default.Vector.sub(this.c1,this.c0),e),n=a.default.Vector.sub(a.default.Vector.sub(a.default.Vector.sub(this.p1,this.c1),e),a.default.Vector.mult(t,2)),r=[],i=t.x*n.y-t.y*n.x;if(0!==i){var o=e.x*n.y-e.y*n.x,s=e.x*t.y-e.y*t.x,u=o*o-4*i*s;if(0<=u){i<0&&(i=-i,o=-o,s=-s);var c=Math.sqrt(u),l=(-o-c)/(2*i),f=(-o+c)/(2*i);0<l&&l<1&&(r.push(this.split(l)),f=1-(1-f)/(1-l)),0<f&&f<1&&r.push(this.split(f))}}return r.push(this),r}}function _(e,t,n,r,i,o,s,u){var c=new w(new a.default.Vector(e,t),new a.default.Vector(n,r),new a.default.Vector(i,o),new a.default.Vector(s,u)).splitInflections(),f=[],d=30/l,h=!0,p=!1,m=void 0;try{for(var v,g=c[Symbol.iterator]();!(h=(v=g.next()).done);h=!0){for(var y=v.value,b=[],x=void 0;!(.125<=(x=d/y.quadError()));){var _=Math.pow(x,1/3),k=y.split(_),E=y.split(1-_/(1-_));f.push(k),b.push(y),y=E}x<1&&f.push(y.split(.5)),f.push(y),Array.prototype.push.apply(f,b.reverse())}}catch(e){p=!0,m=e}finally{try{h||null==g.return||g.return()}finally{if(p)throw m}}return f}function k(e,t,n,r){b([e,n],[t,r],{x:e,y:t,cx:(e+n)/2,cy:(t+r)/2})}function E(e,t,n,r){return Math.abs(n-e)<1e-5&&Math.abs(r-t)<1e-5}var S=!0,C=!1,A=void 0;try{for(var O,D=f[Symbol.iterator]();!(S=(O=D.next()).done);S=!0){var T=O.value,j=(T.x-i)/s,M=(T.y-o)/c;if(!E(d,h,j,M)){switch(T.type){case"M":p=j,m=M;break;case"L":k(d,h,j,M);break;case"Q":var F=(T.x1-i)/s,I=(T.y1-o)/c;b([d,j,F],[h,M,I],{x:d,y:h,cx:F,cy:I});break;case"Z":E(d,h,p,m)?v.push({x:d,y:h}):(k(d,h,p,m),v.push({x:p,y:m}));break;case"C":for(var N=_(d,h,(T.x1-i)/s,(T.y1-o)/c,(T.x2-i)/s,(T.y2-o)/c,j,M),R=0;R<N.length;R++){var P=N[R].toQuadratic();b([P.x,P.x1,P.cx],[P.y,P.y1,P.cy],P)}break;default:throw new Error("unknown command type: ".concat(T.type))}d=j,h=M}}}catch(e){C=!0,A=e}finally{try{S||null==D.return||D.return()}finally{if(C)throw A}}for(var B=v.length,L=this.strokeImageInfos.findImage(B),z=L.index,U=0;U<B;++U){var W=v[U];u(L,x(W.x),x(W.y),x(W.cx),x(W.cy))}function V(e,t,n){for(var r=e.length,i=t.findImage(r),a=i.index,o=0,s=0;s<r;++s)o+=e[s].length;for(var c=n.findImage(o),l=0;l<r;++l){var f=e[l],d=f.length,h=c.index;u(i,h>>7,127&h,d>>7,127&d);for(var p=0;p<d;++p){var m=f[p]+z;u(c,m>>7,127&m,0,0)}}return{cellImageInfo:c,dimOffset:a,dimImageInfo:i}}return(t=this.glyphInfos[e.index]={glyph:e,uGlyphRect:[r.x1,-r.y1,r.x2,-r.y2],strokeImageInfo:L,strokes:v,colInfo:V(y,this.colDimImageInfos,this.colCellImageInfos),rowInfo:V(g,this.rowDimImageInfos,this.rowCellImageInfos)}).uGridOffset=[t.colInfo.dimOffset,t.rowInfo.dimOffset],t}}e("./p5.Shader"),e("./p5.RendererGL.Retained"),a.default.RendererGL.prototype._applyTextProperties=function(){},a.default.RendererGL.prototype.textWidth=function(e){return this._isOpenType()?this._textFont._textWidth(e,this._textSize):0};var l=Math.sqrt(3);a.default.RendererGL.prototype._renderText=function(e,t,n,r,i){if(this._textFont&&"string"!=typeof this._textFont){if(!(i<=r)&&this._doFill){if(!this._isOpenType())return console.log("WEBGL: only Opentype (.otf) and Truetype (.ttf) fonts are supported"),e;e.push();var s=this._doStroke,u=this.drawMode;this._doStroke=!1,this.drawMode=o.TEXTURE;var l=this._textFont.font,f=this._textFont._fontInfo;f=f||(this._textFont._fontInfo=new c(l));var d=this._textFont._handleAlignment(this,t,n,r),h=this._textSize/l.unitsPerEm;this.translate(d.x,d.y,0),this.scale(h,h,1);var p=this.GL,m=!this._defaultFontShader,v=this._getFontShader();v.init(),v.bindShader(),m&&(v.setUniform("uGridImageSize",[64,64]),v.setUniform("uCellsImageSize",[64,64]),v.setUniform("uStrokeImageSize",[64,64]),v.setUniform("uGridSize",[9,9])),this._applyColorBlend(this.curFillColor);var g=this.retainedMode.geometry.glyph;if(!g){var y=this._textGeom=new a.default.Geometry(1,1,(function(){for(var e=0;e<=1;e++)for(var t=0;t<=1;t++)this.vertices.push(new a.default.Vector(t,e,0)),this.uvs.push(t,e)}));y.computeFaces().computeNormals(),g=this.createBuffers("glyph",y)}var b=!0,x=!1,w=void 0;try{for(var _,k=this.retainedMode.buffers.text[Symbol.iterator]();!(b=(_=k.next()).done);b=!0)_.value._prepareBuffer(g,v)}catch(e){x=!0,w=e}finally{try{b||null==k.return||k.return()}finally{if(x)throw w}}this._bindBuffer(g.indexBuffer,p.ELEMENT_ARRAY_BUFFER),v.setUniform("uMaterialColor",this.curFillColor);try{var E=0,S=null,C=l.stringToGlyphs(t),A=!0,O=!1,D=void 0;try{for(var T,j=C[Symbol.iterator]();!(A=(T=j.next()).done);A=!0){var M=T.value;S&&(E+=l.getKerningValue(S,M));var F=f.getGlyphInfo(M);if(F.uGlyphRect){var I=F.rowInfo,N=F.colInfo;v.setUniform("uSamplerStrokes",F.strokeImageInfo.imageData),v.setUniform("uSamplerRowStrokes",I.cellImageInfo.imageData),v.setUniform("uSamplerRows",I.dimImageInfo.imageData),v.setUniform("uSamplerColStrokes",N.cellImageInfo.imageData),v.setUniform("uSamplerCols",N.dimImageInfo.imageData),v.setUniform("uGridOffset",F.uGridOffset),v.setUniform("uGlyphRect",F.uGlyphRect),v.setUniform("uGlyphOffset",E),v.bindTextures(),p.drawElements(p.TRIANGLES,6,this.GL.UNSIGNED_SHORT,0)}E+=M.advanceWidth,S=M}}catch(e){O=!0,D=e}finally{try{A||null==j.return||j.return()}finally{if(O)throw D}}}finally{v.unbindShader(),this._doStroke=s,this.drawMode=u,e.pop()}return e}}else console.log("WEBGL: you must load and set a font before drawing text. See `loadFont` and `textFont` for more details.")}},{"../core/constants":250,"../core/main":260,"./p5.RendererGL.Retained":313,"./p5.Shader":315,"core-js/modules/es.array.iterator":156,"core-js/modules/es.object.to-string":174,"core-js/modules/es.regexp.exec":178,"core-js/modules/es.string.iterator":183,"core-js/modules/es.string.split":188,"core-js/modules/es.string.sub":189,"core-js/modules/es.symbol":193,"core-js/modules/es.symbol.description":191,"core-js/modules/es.symbol.iterator":192,"core-js/modules/web.dom-collections.iterator":226}]},{},[245])(245)}).call(this,n(3))},function(e,t,n){"use strict";n.r(t),n.d(t,"p5Events",(function(){return h})),n.d(t,"default",(function(){return p}));var r=n(0),i=n.n(r),a=n(1),o=n.n(a);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(i=void 0,i=function(e,t){if("object"!==s(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==s(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(r.key,"string"),"symbol"===s(i)?i:String(i)),r)}var i}function c(e,t){return(c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var i=d(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f(this,n)}}function f(e,t){if(t&&("object"===s(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}"undefined"!=typeof window&&(window.p5=o.a);var h=["draw","windowResized","preload","mouseClicked","doubleClicked","mouseMoved","mousePressed","mouseWheel","mouseDragged","mouseReleased","keyPressed","keyReleased","keyTyped","touchStarted","touchMoved","touchEnded","deviceMoved","deviceTurned","deviceShaken"],p=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t)}(s,e);var t,n,r,a=l(s);function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this,e)).canvasParentRef=i.a.createRef(),t}return t=s,(n=[{key:"componentDidMount",value:function(){var e=this;this.sketch=new o.a((function(t){t.setup=function(){e.props.setup(t,e.canvasParentRef.current)},h.forEach((function(n){e.props[n]&&(t[n]=function(){for(var r,i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];(r=e.props)[n].apply(r,[t].concat(a))})}))}))}},{key:"shouldComponentUpdate",value:function(){return!1}},{key:"componentWillUnmount",value:function(){this.sketch.remove()}},{key:"render",value:function(){return i.a.createElement("div",{ref:this.canvasParentRef,className:this.props.className||"react-p5","data-testid":"react-p5",style:this.props.style||{}})}}])&&u(t.prototype,n),r&&u(t,r),Object.defineProperty(t,"prototype",{writable:!1}),s}(i.a.Component)},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n}]).default)},3897:function(e){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r},e.exports.__esModule=!0,e.exports.default=e.exports},5372:function(e){e.exports=function(e){if(Array.isArray(e))return e},e.exports.__esModule=!0,e.exports.default=e.exports},3405:function(e,t,n){var r=n(3897);e.exports=function(e){if(Array.isArray(e))return r(e)},e.exports.__esModule=!0,e.exports.default=e.exports},6115:function(e){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.__esModule=!0,e.exports.default=e.exports},7156:function(e){function t(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(c){return void n(c)}s.done?t(u):Promise.resolve(u).then(r,i)}e.exports=function(e){return function(){var n=this,r=arguments;return new Promise((function(i,a){var o=e.apply(n,r);function s(e){t(o,i,a,s,u,"next",e)}function u(e){t(o,i,a,s,u,"throw",e)}s(void 0)}))}},e.exports.__esModule=!0,e.exports.default=e.exports},6690:function(e){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports},3515:function(e,t,n){var r=n(6015),i=n(9617);function a(t,n,o){return i()?(e.exports=a=Reflect.construct.bind(),e.exports.__esModule=!0,e.exports.default=e.exports):(e.exports=a=function(e,t,n){var i=[null];i.push.apply(i,t);var a=new(Function.bind.apply(e,i));return n&&r(a,n.prototype),a},e.exports.__esModule=!0,e.exports.default=e.exports),a.apply(null,arguments)}e.exports=a,e.exports.__esModule=!0,e.exports.default=e.exports},9728:function(e,t,n){var r=n(4062);function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,r(i.key),i)}}e.exports=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports},4704:function(e,t,n){var r=n(6116);e.exports=function(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=r(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){u=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw o}}}},e.exports.__esModule=!0,e.exports.default=e.exports},6389:function(e,t,n){var r=n(3808),i=n(9617),a=n(4993);e.exports=function(e){var t=i();return function(){var n,i=r(e);if(t){var o=r(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return a(this,n)}},e.exports.__esModule=!0,e.exports.default=e.exports},8416:function(e,t,n){var r=n(4062);e.exports=function(e,t,n){return(t=r(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.__esModule=!0,e.exports.default=e.exports},1588:function(e,t,n){var r=n(1753);function i(){return"undefined"!==typeof Reflect&&Reflect.get?(e.exports=i=Reflect.get.bind(),e.exports.__esModule=!0,e.exports.default=e.exports):(e.exports=i=function(e,t,n){var i=r(e,t);if(i){var a=Object.getOwnPropertyDescriptor(i,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},e.exports.__esModule=!0,e.exports.default=e.exports),i.apply(this,arguments)}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},3808:function(e){function t(n){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},1655:function(e,t,n){var r=n(6015);e.exports=function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&r(e,t)},e.exports.__esModule=!0,e.exports.default=e.exports},9617:function(e){e.exports=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}},e.exports.__esModule=!0,e.exports.default=e.exports},9498:function(e){e.exports=function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.__esModule=!0,e.exports.default=e.exports},8872:function(e){e.exports=function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],u=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(l){c=!0,i=l}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}},e.exports.__esModule=!0,e.exports.default=e.exports},2218:function(e){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},2281:function(e){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},4993:function(e,t,n){var r=n(8698).default,i=n(6115);e.exports=function(e,t){if(t&&("object"===r(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return i(e)},e.exports.__esModule=!0,e.exports.default=e.exports},7061:function(e,t,n){var r=n(8698).default;function i(){"use strict";e.exports=i=function(){return t},e.exports.__esModule=!0,e.exports.default=e.exports;var t={},n=Object.prototype,a=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},u=s.iterator||"@@iterator",c=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function f(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(j){f=function(e,t,n){return e[t]=n}}function d(e,t,n,r){var i=t&&t.prototype instanceof m?t:m,a=Object.create(i.prototype),s=new O(r||[]);return o(a,"_invoke",{value:E(e,n,s)}),a}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(j){return{type:"throw",arg:j}}}t.wrap=d;var p={};function m(){}function v(){}function g(){}var y={};f(y,u,(function(){return this}));var b=Object.getPrototypeOf,x=b&&b(b(D([])));x&&x!==n&&a.call(x,u)&&(y=x);var w=g.prototype=m.prototype=Object.create(y);function _(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function n(i,o,s,u){var c=h(e[i],e,o);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==r(f)&&a.call(f,"__await")?t.resolve(f.__await).then((function(e){n("next",e,s,u)}),(function(e){n("throw",e,s,u)})):t.resolve(f).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,u)}))}u(c.arg)}var i;o(this,"_invoke",{value:function(e,r){function a(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(a,a):a()}})}function E(e,t,n){var r="suspendedStart";return function(i,a){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw a;return T()}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var s=S(o,n);if(s){if(s===p)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=h(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===p)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}function S(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),p;var i=h(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,p;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function D(e){if(e){var t=e[u];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(a.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:T}}function T(){return{value:void 0,done:!0}}return v.prototype=g,o(w,"constructor",{value:g,configurable:!0}),o(g,"constructor",{value:v,configurable:!0}),v.displayName=f(g,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,f(e,l,"GeneratorFunction")),e.prototype=Object.create(w),e},t.awrap=function(e){return{__await:e}},_(k.prototype),f(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,n,r,i,a){void 0===a&&(a=Promise);var o=new k(d(e,n,r,i),a);return t.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},_(w),f(w,l,"Generator"),f(w,u,(function(){return this})),f(w,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=D,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(A),!e)for(var t in this)"t"===t.charAt(0)&&a.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],o=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=a.call(i,"catchLoc"),u=a.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,p):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),A(n),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;A(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:D(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),p}},t}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},6015:function(e){function t(n,r){return e.exports=t=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n,r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},7424:function(e,t,n){var r=n(5372),i=n(8872),a=n(6116),o=n(2218);e.exports=function(e,t){return r(e)||i(e,t)||a(e,t)||o()},e.exports.__esModule=!0,e.exports.default=e.exports},1753:function(e,t,n){var r=n(3808);e.exports=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=r(e)););return e},e.exports.__esModule=!0,e.exports.default=e.exports},1589:function(e,t,n){var r=n(5372),i=n(9498),a=n(6116),o=n(2218);e.exports=function(e){return r(e)||i(e)||a(e)||o()},e.exports.__esModule=!0,e.exports.default=e.exports},861:function(e,t,n){var r=n(3405),i=n(9498),a=n(6116),o=n(2281);e.exports=function(e){return r(e)||i(e)||a(e)||o()},e.exports.__esModule=!0,e.exports.default=e.exports},5036:function(e,t,n){var r=n(8698).default;e.exports=function(e,t){if("object"!==r(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports},4062:function(e,t,n){var r=n(8698).default,i=n(5036);e.exports=function(e){var t=i(e,"string");return"symbol"===r(t)?t:String(t)},e.exports.__esModule=!0,e.exports.default=e.exports},8698:function(e){function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},6116:function(e,t,n){var r=n(3897);e.exports=function(e,t){if(e){if("string"===typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports}}]);
//# sourceMappingURL=680.6114197c.chunk.js.map